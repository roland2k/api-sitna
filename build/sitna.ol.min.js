!function(e,t,o){function r(e,t){return typeof e===t}function i(){return"function"!=typeof t.createElement?t.createElement(arguments[0]):d?t.createElementNS.call(t,"http://www.w3.org/2000/svg",arguments[0]):t.createElement.apply(t,arguments)}function n(){var e=t.body;return e||((e=i(d?"svg":"body")).fake=!0),e}function a(e,o,r,a){var l,s,p,c,g="modernizr",d=i("div"),h=n();if(parseInt(r,10))for(;r--;)(p=i("div")).id=a?a[r]:g+(r+1),d.appendChild(p);return(l=i("style")).type="text/css",l.id="s"+g,(h.fake?h:d).appendChild(l),h.appendChild(d),l.styleSheet?l.styleSheet.cssText=e:l.appendChild(t.createTextNode(e)),d.id=g,h.fake&&(h.style.background="",h.style.overflow="hidden",c=u.style.overflow,u.style.overflow="hidden",u.appendChild(h)),s=o(d,e),h.fake?(h.parentNode.removeChild(h),u.style.overflow=c,u.offsetHeight):d.parentNode.removeChild(d),!!s}var l=[],s={_version:"3.6.0",_config:{classPrefix:"",enableClasses:!0,enableJSClass:!0,usePrefixes:!0},_q:[],on:function(e,t){var o=this;setTimeout(function(){t(o[e])},0)},addTest:function(e,t,o){l.push({name:e,fn:t,options:o})},addAsyncTest:function(e){l.push({name:null,fn:e})}},p=function(){};p.prototype=s,(p=new p).addTest("urlparser",function(){try{return"http://modernizr.com/"===new URL("http://modernizr.com/").href}catch(e){return!1}});var c=[],u=t.documentElement,g=s._config.usePrefixes?" -webkit- -moz- -o- -ms- ".split(" "):["",""];s._prefixes=g;var d="svg"===u.nodeName.toLowerCase(),h=i("input"),f="search tel url email datetime date month week time datetime-local number range color".split(" "),y={};p.inputtypes=function(e){for(var o,r,i,n=e.length,a=0;n>a;a++)h.setAttribute("type",o=e[a]),(i="text"!==h.type&&"style"in h)&&(h.value="1)",h.style.cssText="position:absolute;visibility:hidden;",/^range$/.test(o)&&void 0!==h.style.WebkitAppearance?(u.appendChild(h),i=(r=t.defaultView).getComputedStyle&&"textfield"!==r.getComputedStyle(h,null).WebkitAppearance&&0!==h.offsetHeight,u.removeChild(h)):/^(search|tel)$/.test(o)||(i=/^(url|email)$/.test(o)?h.checkValidity&&!1===h.checkValidity():"1)"!=h.value)),y[e[a]]=!!i;return y}(f);var m=function(){var t=e.matchMedia||e.msMatchMedia;return t?function(e){var o=t(e);return o&&o.matches||!1}:function(t){var o=!1;return a("@media "+t+" { #modernizr { position: absolute; } }",function(t){o="absolute"==(e.getComputedStyle?e.getComputedStyle(t,null):t.currentStyle).position}),o}}();s.mq=m;var v=s.testStyles=a;p.addTest("touchevents",function(){var o;if("ontouchstart"in e||e.DocumentTouch&&t instanceof DocumentTouch)o=!0;else{var r=["@media (",g.join("touch-enabled),("),"heartz",")","{#modernizr{top:9px;position:absolute}}"].join("");v(r,function(e){o=9===e.offsetTop})}return o}),p.addTest("canvas",function(){var e=i("canvas");return!(!e.getContext||!e.getContext("2d"))}),function(){var e,t,o,i,n,a;for(var s in l)if(l.hasOwnProperty(s)){if(e=[],(t=l[s]).name&&(e.push(t.name.toLowerCase()),t.options&&t.options.aliases&&t.options.aliases.length))for(o=0;o<t.options.aliases.length;o++)e.push(t.options.aliases[o].toLowerCase());for(i=r(t.fn,"function")?t.fn():t.fn,n=0;n<e.length;n++)1===(a=e[n].split(".")).length?p[a[0]]=i:(!p[a[0]]||p[a[0]]instanceof Boolean||(p[a[0]]=new Boolean(p[a[0]])),p[a[0]][a[1]]=i),c.push((i?"":"no-")+a.join("-"))}}(),delete s.addTest,delete s.addAsyncTest;for(var C=0;C<p._q.length;C++)p._q[C]();e.Modernizr=p}(window,document);!function(e,t){"function"==typeof define&&define.amd&&!0===define.amd.dust?define("dust.core",[],t):"object"==typeof exports?module.exports=t():e.dust=t()}(this,function(){function c(e,t){if(e)return"function"==typeof e&&e.template?e.template:n.isTemplateFn(e)?e:!1!==t?n.cache[e]:void 0}function o(e,t,o){if(!e)return t.setError(new Error("No template or template name provided to render"));var r=c(e,n.config.cache);return r?r(t,i.wrap(o,r.templateName)):n.onLoad?t.map(function(t){function r(e,r){var l;if(e)return t.setError(e);if(!(l=c(r,!1)||c(a,n.config.cache))){if(!n.compile)return t.setError(new Error("Dust compiler not available"));l=n.loadSource(n.compile(r,a))}l(t,i.wrap(o,l.templateName)).end()}var a=e;3===n.onLoad.length?n.onLoad(a,o.options,r):n.onLoad(a,r)}):t.setError(new Error("Template Not Found: "+e))}function i(e,t,o,r,i){void 0===e||e instanceof l||(e=new l(e));this.stack=e;this.global=t;this.options=o;this.blocks=r;this.templateName=i}function k(e,t,o){return function(r){return e.push(r)._get(t,o)}}function l(e,t,o,r){this.tail=t;this.isObject=e&&"object"==typeof e;this.head=e;this.index=o;this.of=r}function a(e){this.head=new t(this);this.callback=e;this.out=""}function e(){this.head=new t(this)}function t(e,t,o){this.root=e;this.next=t;this.data=[];this.flushable=!1;this.taps=o}function s(e,t){this.head=e;this.tail=t}var n={version:"2.7.1"},d="NONE",r="ERROR",u="WARN",v="INFO",f="DEBUG",y=function(){},h;n.config={whitespace:!1,amd:!1,cjs:!1,cache:!0};n._aliases={write:"w",end:"e",map:"m",render:"r",reference:"f",section:"s",exists:"x",notexists:"nx",block:"b",partial:"p",helper:"h"},function(){var e,t,o={DEBUG:0,INFO:1,WARN:2,ERROR:3,NONE:4};"undefined"!=typeof console&&console.log?(e=console.log,t="function"==typeof e?function(){e.apply(console,arguments)}:function(){e(Array.prototype.slice.apply(arguments).join(" "))}):t=y;n.log=function(e,r){o[r=r||v]>=o[n.debugLevel]&&t("[DUST:"+r+"]",e)};n.debugLevel=d;"undefined"!=typeof process&&process.env&&/\bdust\b/.test(process.env.DEBUG)&&(n.debugLevel=f)}();n.helpers={};n.cache={};n.register=function(e,t){e&&(t.templateName=e,!1!==n.config.cache&&(n.cache[e]=t))};n.render=function(e,t,r){var i=new a(r).head;try{o(e,i,t).end()}catch(e){i.setError(e)}};n.stream=function(t,r){var i=new e,a=i.head;return n.nextTick(function(){try{o(t,a,r).end()}catch(e){a.setError(e)}}),i};n.loadSource=function(source){return eval(source)};n.isArray=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)};n.nextTick=function(e){setTimeout(e,0)};n.isEmpty=function(e){return 0!==e&&(!(!n.isArray(e)||e.length)||!e)};n.isEmptyObject=function(e){var t;if(null===e||void 0===e||e.length>0)return!1;for(t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0};n.isTemplateFn=function(e){return"function"==typeof e&&e.__dustBody};n.isThenable=function(e){return e&&"object"==typeof e&&"function"==typeof e.then};n.isStreamable=function(e){return e&&"function"==typeof e.on};n.filter=function(e,t,o){var r,i,a;if(o)for(r=0,i=o.length;i>r;r++)"s"===(a=o[r])?t=null:"function"==typeof n.filters[a]?e=n.filters[a](e):n.log("Invalid filter `"+a+"`",u);return t&&(e=n.filters[t](e)),e};n.filters={h:function(e){return n.escapeHtml(e)},j:function(e){return n.escapeJs(e)},u:encodeURI,uc:encodeURIComponent,js:function(e){return n.escapeJSON(e)},jp:function(e){return JSON?JSON.parse(e):(n.log("JSON is undefined; could not parse `"+e+"`",u),e)}};n.makeBase=n.context=function(e,t){return new i(void 0,e,t)};i.wrap=function(e,t){return e instanceof i?e:new i(e,{},{},null,t)};i.prototype.get=function(e,t){return"string"==typeof e&&("."===e[0]&&(t=!0,e=e.substr(1)),e=e.split(".")),this._get(t,e)};i.prototype._get=function(e,t){var o,i,a,l,s,p=this.stack||{},c=1;if(i=t[0],a=t.length,e&&0===a)l=p,p=p.head;else{if(e)p&&(p=p.head?p.head[i]:void 0);else{for(;p&&(!p.isObject||(l=p.head,void 0===(o=p.head[i])));)p=p.tail;p=void 0!==o?o:this.global&&this.global[i]}for(;p&&a>c;){if(n.isThenable(p))return p.then(k(this,e,t.slice(c)));l=p;p=p[t[c]];c++}}return"function"==typeof p?((s=function(){try{return p.apply(l,arguments)}catch(e){throw n.log(e,r),e}}).__dustBody=!!p.__dustBody,s):(void 0===p&&n.log("Cannot find reference `{"+t.join(".")+"}` in template `"+this.getTemplateName()+"`",v),p)};i.prototype.getPath=function(e,t){return this._get(e,t)};i.prototype.push=function(e,t,o){return void 0===e?(n.log("Not pushing an undefined variable onto the context",v),this):this.rebase(new l(e,this.stack,t,o))};i.prototype.pop=function(){var e=this.current();return this.stack=this.stack&&this.stack.tail,e};i.prototype.rebase=function(e){return new i(e,this.global,this.options,this.blocks,this.getTemplateName())};i.prototype.clone=function(){var e=this.rebase();return e.stack=this.stack,e};i.prototype.current=function(){return this.stack&&this.stack.head};i.prototype.getBlock=function(e){var o,r,i;if("function"==typeof e&&(e=e(new t,this).data.join("")),!(o=this.blocks))return n.log("No blocks for context `"+e+"` in template `"+this.getTemplateName()+"`",f),!1;for(r=o.length;r--;)if(i=o[r][e])return i;return n.log("Malformed template `"+this.getTemplateName()+"` was missing one or more blocks."),!1};i.prototype.shiftBlocks=function(e){var t,o=this.blocks;return e?(t=o?o.concat([e]):[e],new i(this.stack,this.global,this.options,t,this.getTemplateName())):this};i.prototype.resolve=function(e){var o;return"function"!=typeof e?e:(o=(new t).render(e,this))instanceof t?o.data.join(""):o};i.prototype.getTemplateName=function(){return this.templateName};a.prototype.flush=function(){for(var e=this.head;e;){if(!e.flushable)return e.error?(this.callback(e.error),n.log("Rendering failed with error `"+e.error+"`",r),void(this.flush=y)):void 0;this.out+=e.data.join("");e=e.next;this.head=e}this.callback(null,this.out)};e.prototype.flush=function(){for(var e=this.head;e;){if(!e.flushable)return e.error?(this.emit("error",e.error),this.emit("end"),n.log("Streaming failed with error `"+e.error+"`",r),void(this.flush=y)):void 0;this.emit("data",e.data.join(""));e=e.next;this.head=e}this.emit("end")};e.prototype.emit=function(e,t){var o,r,i=(this.events||{})[e]||[];if(!i.length)return n.log("Stream broadcasting, but no listeners for `"+e+"`",f),!1;for(o=0,r=(i=i.slice(0)).length;r>o;o++)i[o](t);return!0};e.prototype.on=function(e,t){var o=this.events=this.events||{},r=o[e]=o[e]||[];return"function"!=typeof t?n.log("No callback function provided for `"+e+"` event listener",u):r.push(t),this};e.prototype.pipe=function(e){if("function"!=typeof e.write||"function"!=typeof e.end)return n.log("Incompatible stream passed to `pipe`",u),this;var t=!1;return"function"==typeof e.emit&&e.emit("pipe",this),"function"==typeof e.on&&e.on("error",function(){t=!0}),this.on("data",function(o){if(!t)try{e.write(o,"utf8")}catch(e){n.log(e,r)}}).on("end",function(){if(!t)try{e.end();t=!0}catch(e){n.log(e,r)}})};t.prototype.write=function(e){var t=this.taps;return t&&(e=t.go(e)),this.data.push(e),this};t.prototype.end=function(e){return e&&this.write(e),this.flushable=!0,this.root.flush(),this};t.prototype.map=function(e){var o=new t(this.root,this.next,this.taps),i=new t(this.root,o,this.taps);this.next=i;this.flushable=!0;try{e(i)}catch(e){n.log(e,r);i.setError(e)}return o};t.prototype.tap=function(e){var t=this.taps;return this.taps=t?t.push(e):new s(e),this};t.prototype.untap=function(){return this.taps=this.taps.tail,this};t.prototype.render=function(e,t){return e(this,t)};t.prototype.reference=function(e,o,r,i){return"function"==typeof e?(e=e.apply(o.current(),[this,o,null,{auto:r,filters:i}]))instanceof t?e:this.reference(e,o,r,i):n.isThenable(e)?this.await(e,o,null,r,i):n.isStreamable(e)?this.stream(e,o,null,r,i):n.isEmpty(e)?this:this.write(n.filter(e,r,i))};t.prototype.section=function(e,o,i,a){var l,s,p,c=i.block,u=i.else,g=this;if("function"==typeof e&&!n.isTemplateFn(e)){try{e=e.apply(o.current(),[this,o,i,a])}catch(e){return n.log(e,r),this.setError(e)}if(e instanceof t)return e}if(n.isEmptyObject(a)||(o=o.push(a)),n.isArray(e)){if(c){if((s=e.length)>0){for((p=o.stack&&o.stack.head||{}).$len=s,l=0;s>l;l++)p.$idx=l,g=c(g,o.push(e[l],l,s));return p.$idx=void 0,p.$len=void 0,g}if(u)return u(this,o)}}else{if(n.isThenable(e))return this.await(e,o,i);if(n.isStreamable(e))return this.stream(e,o,i);if(!0===e){if(c)return c(this,o)}else if(e||0===e){if(c)return c(this,o.push(e))}else if(u)return u(this,o)}return n.log("Section without corresponding key in template `"+o.getTemplateName()+"`",f),this};t.prototype.exists=function(e,t,o){var r=o.block,i=o.else;if(n.isEmpty(e)){if(i)return i(this,t)}else{if(r)return r(this,t);n.log("No block for exists check in template `"+t.getTemplateName()+"`",f)}return this};t.prototype.notexists=function(e,t,o){var r=o.block,i=o.else;if(n.isEmpty(e)){if(r)return r(this,t);n.log("No block for not-exists check in template `"+t.getTemplateName()+"`",f)}else if(i)return i(this,t);return this};t.prototype.block=function(e,t,o){var r=e||o.block;return r?r(this,t):this};t.prototype.partial=function(e,t,r,i){var a;return void 0===i&&(i=r,r=t),n.isEmptyObject(i)||(a=(r=r.clone()).pop(),r=r.push(i).push(a)),n.isTemplateFn(e)?this.capture(e,t,function(e,t){r.templateName=e;o(e,t,r).end()}):(r.templateName=e,o(e,this,r))};t.prototype.helper=function(e,t,o,i){var a,l=this;if(!n.helpers[e])return n.log("Helper `"+e+"` does not exist",u),l;try{return a=n.helpers[e](l,t,o,i),n.isThenable(a)?this.await(a,t,o):a}catch(t){return n.log("Error in helper `"+e+"`: "+t.message,r),l.setError(t)}};t.prototype.await=function(e,t,o,r,i){var a=o&&o.block,l=o&&o.error;return this.map(function(o){e.then(function(e){a?o.render(a,t.push(e)).end():o.reference(e,t,r,i).end()},function(e){l?o.render(l,t.push(e)).end():(n.log("Unhandled promise rejection in `"+t.getTemplateName()+"`"),o.end())})})};t.prototype.stream=function(e,t,o,r,i){var a=o&&o.block,l=o&&o.error;return this.map(function(o){var s=!1;e.on("data",function(e){s||(o=a?o.map(function(o){o.render(a,t.push(e)).end()}):o.reference(e,t,r,i))}).on("error",function(e){s||(l?o.render(l,t.push(e)):n.log("Unhandled stream error in `"+t.getTemplateName()+"`"),s||(s=!0,o.end()))}).on("end",function(){s||(s=!0,o.end())})})};t.prototype.capture=function(e,t,o){return this.map(function(r){var i=new a(function(e,t){e?r.setError(e):o(t,r)});e(i.head,t).end()})};t.prototype.setError=function(e){return this.error=e,this.root.flush(),this};for(h in t.prototype)n._aliases[h]&&(t.prototype[n._aliases[h]]=t.prototype[h]);s.prototype.push=function(e){return new s(e,this)};s.prototype.go=function(e){for(var t=this;t;)e=t.head(e),t=t.tail;return e};var g=/[&<>"']/,nt=/&/g,p=/</g,tt=/>/g,it=/\"/g,rt=/\'/g;n.escapeHtml=function(e){return"string"==typeof e||e&&"function"==typeof e.toString?("string"!=typeof e&&(e=e.toString()),g.test(e)?e.replace(nt,"&amp;").replace(p,"&lt;").replace(tt,"&gt;").replace(it,"&quot;").replace(rt,"&#39;"):e):e};var ut=/\\/g,ft=/\//g,et=/\r/g,w=/\u2028/g,b=/\u2029/g,ot=/\n/g,st=/\f/g,ht=/'/g,ct=/"/g,lt=/\t/g;return n.escapeJs=function(e){return"string"==typeof e?e.replace(ut,"\\\\").replace(ft,"\\/").replace(ct,'\\"').replace(ht,"\\'").replace(et,"\\r").replace(w,"\\u2028").replace(b,"\\u2029").replace(ot,"\\n").replace(st,"\\f").replace(lt,"\\t"):e},n.escapeJSON=function(e){return JSON?JSON.stringify(e).replace(w,"\\u2028").replace(b,"\\u2029").replace(p,"\\u003c"):(n.log("JSON is undefined; could not escape `"+e+"`",u),e)},n}),function(e,t){"function"==typeof define&&define.amd&&!0===define.amd.dust?define("dust.parse",["dust.core"],function(e){return t(e).parse}):"object"==typeof exports?module.exports=t(require("./dust")):t(e.dust)}(this,function(e){var t=function(){function e(e,t,o,r,i,n){this.message=e;this.expected=t;this.found=o;this.offset=r;this.line=i;this.column=n;this.name="SyntaxError"}return function(e,t){function o(){this.constructor=e}o.prototype=t.prototype;e.prototype=new o}(e,Error),{SyntaxError:e,parse:function(t){function o(e){return fo!==e&&(fo>e&&(fo=0,yo={line:1,column:1,seenCR:!1}),function(e,o,r){for(var i,n=o;r>n;n++)"\n"===(i=t.charAt(n))?(e.seenCR||e.line++,e.column=1,e.seenCR=!1):"\r"===i||"\u2028"===i||"\u2029"===i?(e.line++,e.column=1,e.seenCR=!0):(e.column++,e.seenCR=!1)}(yo,fo,e),fo=e),yo}function r(e){mo>go||(go>mo&&(mo=go,vo=[]),vo.push(e))}function i(r,i,n){var a=o(n),l=n<t.length?t.charAt(n):null;return null!==i&&function(e){var t=1;for(e.sort(function(e,t){return e.description<t.description?-1:e.description>t.description?1:0});t<e.length;)e[t-1]===e[t]?e.splice(t,1):t++}(i),new e(null!==r?r:function(e,t){for(var o=new Array(e.length),r=0;r<e.length;r++)o[r]=e[r].description;return"Expected "+(e.length>1?o.slice(0,-1).join(", ")+" or "+o[e.length-1]:o[0])+" but "+(t?'"'+function(e){function t(e){return e.charCodeAt(0).toString(16).toUpperCase()}return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E\x0F]/g,function(e){return"\\x0"+t(e)}).replace(/[\x10-\x1F\x80-\xFF]/g,function(e){return"\\x"+t(e)}).replace(/[\u0180-\u0FFF]/g,function(e){return"\\u0"+t(e)}).replace(/[\u1080-\uFFFF]/g,function(e){return"\\u"+t(e)})}(t)+'"':"end of input")+" found."}(i,l),i,l,n,a.line,a.column)}function n(){return a()}function a(){var e,t,o;for(e=go,t=[],o=l();o!==B;)t.push(o),o=l();return t!==B&&(ho=e,t=j(t)),t}function l(){var e;return(e=A())===B&&(e=M())===B&&(e=function(){var e,o,i,n,l,c,u;if(Co++,e=go,(o=s())!==B){for(i=[],n=F();n!==B;)i.push(n),n=F();i!==B&&(n=N())!==B&&(l=a())!==B&&(c=g())!==B?((u=p())===B&&(u=Y),u!==B?(ho=go,(K(o,l,c,u)?X:V)!==B?(ho=e,o=H(o,l,c,u),e=o):(go=e,e=V)):(go=e,e=V)):(go=e,e=V)}else go=e,e=V;if(e===B)if(e=go,(o=s())!==B){for(i=[],n=F();n!==B;)i.push(n),n=F();i!==B?(47===t.charCodeAt(go)?(n=z,go++):(n=B,0===Co&&r(Z)),n!==B&&(l=N())!==B?(ho=e,o=J(o),e=o):(go=e,e=V)):(go=e,e=V)}else go=e,e=V;return Co--,e===B&&(o=B,0===Co&&r(W)),e}())===B&&(e=function(){var e,o,i,n,a,l,s,p,g;if(Co++,e=go,(o=O())!==B)if(62===t.charCodeAt(go)?(i=ve,go++):(i=B,0===Co&&r(Ce)),i===B&&(43===t.charCodeAt(go)?(i=Te,go++):(i=B,0===Co&&r(Se))),i!==B){for(n=[],a=F();a!==B;)n.push(a),a=F();if(n!==B)if(a=go,(l=E())!==B&&(ho=a,l=_e(l)),(a=l)===B&&(a=L()),a!==B)if((l=c())!==B)if((s=u())!==B){for(p=[],g=F();g!==B;)p.push(g),g=F();p!==B?(47===t.charCodeAt(go)?(g=z,go++):(g=B,0===Co&&r(Z)),g!==B&&N()!==B?(ho=e,o=Ee(i,a,l,s),e=o):(go=e,e=V)):(go=e,e=V)}else go=e,e=V;else go=e,e=V;else go=e,e=V;else go=e,e=V}else go=e,e=V;else go=e,e=V;return Co--,e===B&&(o=B,0===Co&&r(me)),e}())===B&&(e=f())===B&&(e=d())===B&&(e=function(){var e,o,i,n,a,l,s,p;if(Co++,e=go,(o=D())!==B){for(i=[],n=F();n!==B;)i.push(n),n=F();i!==B?(ho=e,o=Tt(o,i),e=o):(go=e,e=V)}else go=e,e=V;if(e===B){if(e=go,o=[],i=go,n=go,Co++,a=I(),Co--,a===B?n=X:(go=n,n=V),n!==B?(a=go,Co++,l=A(),Co--,l===B?a=X:(go=a,a=V),a!==B?(l=go,Co++,s=M(),Co--,s===B?l=X:(go=l,l=V),l!==B?(s=go,Co++,p=D(),Co--,p===B?s=X:(go=s,s=V),s!==B?(t.length>go?(p=t.charAt(go),go++):(p=B,0===Co&&r(St)),p!==B?(ho=i,n=_t(p),i=n):(go=i,i=V)):(go=i,i=V)):(go=i,i=V)):(go=i,i=V)):(go=i,i=V),i!==B)for(;i!==B;)o.push(i),i=go,n=go,Co++,a=I(),Co--,a===B?n=X:(go=n,n=V),n!==B?(a=go,Co++,l=A(),Co--,l===B?a=X:(go=a,a=V),a!==B?(l=go,Co++,s=M(),Co--,s===B?l=X:(go=l,l=V),l!==B?(s=go,Co++,p=D(),Co--,p===B?s=X:(go=s,s=V),s!==B?(t.length>go?(p=t.charAt(go),go++):(p=B,0===Co&&r(St)),p!==B?(ho=i,n=_t(p),i=n):(go=i,i=V)):(go=i,i=V)):(go=i,i=V)):(go=i,i=V)):(go=i,i=V);else o=V;o!==B&&(ho=e,o=Et(o));e=o}return Co--,e===B&&(o=B,0===Co&&r(Ct)),e}()),e}function s(){var e,o,i,n,a,l;if(e=go,O()!==B)if(Q.test(t.charAt(go))?(o=t.charAt(go),go++):(o=B,0===Co&&r(ee)),o!==B){for(i=[],n=F();n!==B;)i.push(n),n=F();i!==B&&(n=y())!==B&&(a=c())!==B&&(l=u())!==B?(ho=e,e=te(o,n,a,l)):(go=e,e=V)}else go=e,e=V;else go=e,e=V;return e}function p(){var e,o,i,n,a,l;if(Co++,e=go,O()!==B)if(47===t.charCodeAt(go)?(o=z,go++):(o=B,0===Co&&r(Z)),o!==B){for(i=[],n=F();n!==B;)i.push(n),n=F();if(i!==B)if((n=y())!==B){for(a=[],l=F();l!==B;)a.push(l),l=F();a!==B&&(l=N())!==B?(ho=e,e=re(n)):(go=e,e=V)}else go=e,e=V;else go=e,e=V}else go=e,e=V;else go=e,e=V;return Co--,e===B&&0===Co&&r(oe),e}function c(){var e,o,i,n;return e=go,o=go,58===t.charCodeAt(go)?(i=ie,go++):(i=B,0===Co&&r(ne)),i!==B&&(n=y())!==B?(ho=o,o=i=ae(n)):(go=o,o=V),o===B&&(o=Y),o!==B&&(ho=e,o=le(o)),o}function u(){var e,o,i,n,a,l,s;if(Co++,e=go,o=[],i=go,n=[],(a=F())!==B)for(;a!==B;)n.push(a),a=F();else n=V;for(n!==B&&(a=E())!==B?(61===t.charCodeAt(go)?(l=pe,go++):(l=B,0===Co&&r(ce)),l!==B?((s=m())===B&&(s=y())===B&&(s=L()),s!==B?(ho=i,i=n=ue(a,s)):(go=i,i=V)):(go=i,i=V)):(go=i,i=V);i!==B;){if(o.push(i),i=go,n=[],(a=F())!==B)for(;a!==B;)n.push(a),a=F();else n=V;n!==B&&(a=E())!==B?(61===t.charCodeAt(go)?(l=pe,go++):(l=B,0===Co&&r(ce)),l!==B?((s=m())===B&&(s=y())===B&&(s=L()),s!==B?(ho=i,i=n=ue(a,s)):(go=i,i=V)):(go=i,i=V)):(go=i,i=V)}return o!==B&&(ho=e,o=ge(o)),Co--,(e=o)===B&&(o=B,0===Co&&r(se)),e}function g(){var e,o,i,n,l,s;for(Co++,e=go,o=[],i=go,O()!==B?(58===t.charCodeAt(go)?(n=ie,go++):(n=B,0===Co&&r(ne)),n!==B&&(l=E())!==B&&N()!==B&&(s=a())!==B?(ho=i,i=ue(l,s)):(go=i,i=V)):(go=i,i=V);i!==B;)o.push(i),i=go,O()!==B?(58===t.charCodeAt(go)?(n=ie,go++):(n=B,0===Co&&r(ne)),n!==B&&(l=E())!==B&&N()!==B&&(s=a())!==B?(ho=i,i=ue(l,s)):(go=i,i=V)):(go=i,i=V);return o!==B&&(ho=e,o=he(o)),Co--,(e=o)===B&&(o=B,0===Co&&r(de)),e}function d(){var e,t,o;return Co++,e=go,O()!==B&&(t=y())!==B&&(o=h())!==B&&N()!==B?(ho=e,e=ye(t,o)):(go=e,e=V),Co--,e===B&&0===Co&&r(fe),e}function h(){var e,o,i,n,a;for(Co++,e=go,o=[],i=go,124===t.charCodeAt(go)?(n=Pe,go++):(n=B,0===Co&&r(Le)),n!==B&&(a=E())!==B?(ho=i,i=n=ae(a)):(go=i,i=V);i!==B;)o.push(i),i=go,124===t.charCodeAt(go)?(n=Pe,go++):(n=B,0===Co&&r(Le)),n!==B&&(a=E())!==B?(ho=i,i=n=ae(a)):(go=i,i=V);return o!==B&&(ho=e,o=we(o)),Co--,(e=o)===B&&(o=B,0===Co&&r(xe)),e}function f(){var e,o,i;return Co++,e=go,O()!==B?(126===t.charCodeAt(go)?(o=Re,go++):(o=B,0===Co&&r(Ae)),o!==B&&(i=E())!==B&&N()!==B?(ho=e,e=Me(i)):(go=e,e=V)):(go=e,e=V),Co--,e===B&&0===Co&&r(be),e}function y(){var e,t;return Co++,e=go,(t=_())!==B&&(ho=e,t=Oe(t)),(e=t)===B&&(e=go,(t=E())!==B&&(ho=e,t=Ne(t)),e=t),Co--,e===B&&(t=B,0===Co&&r(Ie)),e}function m(){var e,t;return Co++,e=go,(t=v())===B&&(t=S()),t!==B&&(ho=e,t=Fe(t)),Co--,(e=t)===B&&(t=B,0===Co&&r(De)),e}function v(){var e,o,i,n;return Co++,e=go,(o=S())!==B?(46===t.charCodeAt(go)?(i=Ge,go++):(i=B,0===Co&&r(Ue)),i!==B&&(n=C())!==B?(ho=e,e=o=Be(o,n)):(go=e,e=V)):(go=e,e=V),Co--,e===B&&(o=B,0===Co&&r(ke)),e}function C(){var e,o,i;if(Co++,e=go,o=[],qe.test(t.charAt(go))?(i=t.charAt(go),go++):(i=B,0===Co&&r(je)),i!==B)for(;i!==B;)o.push(i),qe.test(t.charAt(go))?(i=t.charAt(go),go++):(i=B,0===Co&&r(je));else o=V;return o!==B&&(ho=e,o=We(o)),Co--,(e=o)===B&&(o=B,0===Co&&r($e)),e}function T(){var e,o,i;return Co++,e=go,45===t.charCodeAt(go)?(o=Ye,go++):(o=B,0===Co&&r(Ke)),o!==B&&(i=C())!==B?(ho=e,e=o=Xe(o,i)):(go=e,e=V),Co--,e===B&&(o=B,0===Co&&r(Ve)),e}function S(){var e;return Co++,(e=T())===B&&(e=C()),Co--,e===B&&0===Co&&r(He),e}function _(){var e,o,i,n;if(Co++,e=go,(o=E())===B&&(o=Y),o!==B){if(i=[],(n=P())===B&&(n=x()),n!==B)for(;n!==B;)i.push(n),(n=P())===B&&(n=x());else i=V;i!==B?(ho=e,e=o=Ze(o,i)):(go=e,e=V)}else go=e,e=V;if(e===B)if(e=go,46===t.charCodeAt(go)?(o=Ge,go++):(o=B,0===Co&&r(Ue)),o!==B){for(i=[],(n=P())===B&&(n=x());n!==B;)i.push(n),(n=P())===B&&(n=x());i!==B?(ho=e,e=o=Je(i)):(go=e,e=V)}else go=e,e=V;return Co--,e===B&&(o=B,0===Co&&r(ze)),e}function E(){var e,o,i,n;if(Co++,e=go,et.test(t.charAt(go))?(o=t.charAt(go),go++):(o=B,0===Co&&r(tt)),o!==B){for(i=[],ot.test(t.charAt(go))?(n=t.charAt(go),go++):(n=B,0===Co&&r(rt));n!==B;)i.push(n),ot.test(t.charAt(go))?(n=t.charAt(go),go++):(n=B,0===Co&&r(rt));i!==B?(ho=e,e=o=it(o,i)):(go=e,e=V)}else go=e,e=V;return Co--,e===B&&(o=B,0===Co&&r(Qe)),e}function x(){var e,o,i,n,a,l;if(Co++,e=go,o=go,(i=function(){var e;return 91===t.charCodeAt(go)?(e=zt,go++):(e=B,0===Co&&r(Zt)),e}())!==B){if(n=go,a=[],qe.test(t.charAt(go))?(l=t.charAt(go),go++):(l=B,0===Co&&r(je)),l!==B)for(;l!==B;)a.push(l),qe.test(t.charAt(go))?(l=t.charAt(go),go++):(l=B,0===Co&&r(je));else a=V;a!==B&&(ho=n,a=at(a));(n=a)===B&&(n=y());n!==B&&(a=function(){var e;return 93===t.charCodeAt(go)?(e=Jt,go++):(e=B,0===Co&&r(Qt)),e}())!==B?(ho=o,o=i=lt(n)):(go=o,o=V)}else go=o,o=V;return o!==B?((i=P())===B&&(i=Y),i!==B?(ho=e,e=o=st(o,i)):(go=e,e=V)):(go=e,e=V),Co--,e===B&&(o=B,0===Co&&r(nt)),e}function P(){var e,o,i,n,a;if(Co++,e=go,o=[],i=go,46===t.charCodeAt(go)?(n=Ge,go++):(n=B,0===Co&&r(Ue)),n!==B&&(a=E())!==B?(ho=i,i=n=ct(a)):(go=i,i=V),i!==B)for(;i!==B;)o.push(i),i=go,46===t.charCodeAt(go)?(n=Ge,go++):(n=B,0===Co&&r(Ue)),n!==B&&(a=E())!==B?(ho=i,i=n=ct(a)):(go=i,i=V);else o=V;return o!==B?((i=x())===B&&(i=Y),i!==B?(ho=e,e=o=ut(o,i)):(go=e,e=V)):(go=e,e=V),Co--,e===B&&(o=B,0===Co&&r(pt)),e}function L(){var e,o,i,n;if(Co++,e=go,34===t.charCodeAt(go)?(o=dt,go++):(o=B,0===Co&&r(ht)),o!==B?(34===t.charCodeAt(go)?(i=dt,go++):(i=B,0===Co&&r(ht)),i!==B?(ho=e,e=o=ft()):(go=e,e=V)):(go=e,e=V),e===B&&(e=go,34===t.charCodeAt(go)?(o=dt,go++):(o=B,0===Co&&r(ht)),o!==B&&(i=b())!==B?(34===t.charCodeAt(go)?(n=dt,go++):(n=B,0===Co&&r(ht)),n!==B?(ho=e,e=o=yt(i)):(go=e,e=V)):(go=e,e=V),e===B))if(e=go,34===t.charCodeAt(go)?(o=dt,go++):(o=B,0===Co&&r(ht)),o!==B){if(i=[],(n=w())!==B)for(;n!==B;)i.push(n),n=w();else i=V;i!==B?(34===t.charCodeAt(go)?(n=dt,go++):(n=B,0===Co&&r(ht)),n!==B?(ho=e,e=o=mt(i)):(go=e,e=V)):(go=e,e=V)}else go=e,e=V;return Co--,e===B&&(o=B,0===Co&&r(gt)),e}function w(){var e,t;return(e=f())===B&&(e=d())===B&&(e=go,(t=b())!==B&&(ho=e,t=vt(t)),e=t),e}function b(){var e,o,i,n,a;if(Co++,e=go,o=[],i=go,n=go,Co++,a=I(),Co--,a===B?n=X:(go=n,n=V),n!==B?((a=R())===B&&(Pt.test(t.charAt(go))?(a=t.charAt(go),go++):(a=B,0===Co&&r(Lt))),a!==B?(ho=i,i=n=_t(a)):(go=i,i=V)):(go=i,i=V),i!==B)for(;i!==B;)o.push(i),i=go,n=go,Co++,a=I(),Co--,a===B?n=X:(go=n,n=V),n!==B?((a=R())===B&&(Pt.test(t.charAt(go))?(a=t.charAt(go),go++):(a=B,0===Co&&r(Lt))),a!==B?(ho=i,i=n=_t(a)):(go=i,i=V)):(go=i,i=V);else o=V;return o!==B&&(ho=e,o=wt(o)),Co--,(e=o)===B&&(o=B,0===Co&&r(xt)),e}function R(){var e,o;return e=go,t.substr(go,2)===bt?(o=bt,go+=2):(o=B,0===Co&&r(Rt)),o!==B&&(ho=e,o=At()),o}function A(){var e,o,i,n,a,l;if(Co++,e=go,t.substr(go,2)===It?(o=It,go+=2):(o=B,0===Co&&r(Ot)),o!==B){for(i=[],n=go,a=go,Co++,t.substr(go,2)===Nt?(l=Nt,go+=2):(l=B,0===Co&&r(Dt)),Co--,l===B?a=X:(go=a,a=V),a!==B?(t.length>go?(l=t.charAt(go),go++):(l=B,0===Co&&r(St)),l!==B?(ho=n,n=a=Ft(l)):(go=n,n=V)):(go=n,n=V);n!==B;)i.push(n),n=go,a=go,Co++,t.substr(go,2)===Nt?(l=Nt,go+=2):(l=B,0===Co&&r(Dt)),Co--,l===B?a=X:(go=a,a=V),a!==B?(t.length>go?(l=t.charAt(go),go++):(l=B,0===Co&&r(St)),l!==B?(ho=n,n=a=Ft(l)):(go=n,n=V)):(go=n,n=V);i!==B?(t.substr(go,2)===Nt?(n=Nt,go+=2):(n=B,0===Co&&r(Dt)),n!==B?(ho=e,e=o=kt(i)):(go=e,e=V)):(go=e,e=V)}else go=e,e=V;return Co--,e===B&&(o=B,0===Co&&r(Mt)),e}function M(){var e,o,i,n,a,l;if(Co++,e=go,t.substr(go,2)===Ut?(o=Ut,go+=2):(o=B,0===Co&&r(Bt)),o!==B){for(i=[],n=go,a=go,Co++,t.substr(go,2)===$t?(l=$t,go+=2):(l=B,0===Co&&r(qt)),Co--,l===B?a=X:(go=a,a=V),a!==B?(t.length>go?(l=t.charAt(go),go++):(l=B,0===Co&&r(St)),l!==B?(ho=n,n=a=_t(l)):(go=n,n=V)):(go=n,n=V);n!==B;)i.push(n),n=go,a=go,Co++,t.substr(go,2)===$t?(l=$t,go+=2):(l=B,0===Co&&r(qt)),Co--,l===B?a=X:(go=a,a=V),a!==B?(t.length>go?(l=t.charAt(go),go++):(l=B,0===Co&&r(St)),l!==B?(ho=n,n=a=_t(l)):(go=n,n=V)):(go=n,n=V);i!==B?(t.substr(go,2)===$t?(n=$t,go+=2):(n=B,0===Co&&r(qt)),n!==B?(ho=e,e=o=jt(i)):(go=e,e=V)):(go=e,e=V)}else go=e,e=V;return Co--,e===B&&(o=B,0===Co&&r(Gt)),e}function I(){var e,o,i,n,a,l,s,p,c,u;if(e=go,(o=O())!==B){for(i=[],n=F();n!==B;)i.push(n),n=F();if(i!==B)if(Wt.test(t.charAt(go))?(n=t.charAt(go),go++):(n=B,0===Co&&r(Vt)),n!==B){for(a=[],l=F();l!==B;)a.push(l),l=F();if(a!==B){if(l=[],s=go,p=go,Co++,c=N(),Co--,c===B?p=X:(go=p,p=V),p!==B?(c=go,Co++,u=D(),Co--,u===B?c=X:(go=c,c=V),c!==B?(t.length>go?(u=t.charAt(go),go++):(u=B,0===Co&&r(St)),u!==B?s=p=[p,c,u]:(go=s,s=V)):(go=s,s=V)):(go=s,s=V),s!==B)for(;s!==B;)l.push(s),s=go,p=go,Co++,c=N(),Co--,c===B?p=X:(go=p,p=V),p!==B?(c=go,Co++,u=D(),Co--,u===B?c=X:(go=c,c=V),c!==B?(t.length>go?(u=t.charAt(go),go++):(u=B,0===Co&&r(St)),u!==B?s=p=[p,c,u]:(go=s,s=V)):(go=s,s=V)):(go=s,s=V);else l=V;if(l!==B){for(s=[],p=F();p!==B;)s.push(p),p=F();s!==B&&(p=N())!==B?e=o=[o,i,n,a,l,s,p]:(go=e,e=V)}else go=e,e=V}else go=e,e=V}else go=e,e=V;else go=e,e=V}else go=e,e=V;return e===B&&(e=d()),e}function O(){var e;return 123===t.charCodeAt(go)?(e=Yt,go++):(e=B,0===Co&&r(Kt)),e}function N(){var e;return 125===t.charCodeAt(go)?(e=Xt,go++):(e=B,0===Co&&r(Ht)),e}function D(){var e;return 10===t.charCodeAt(go)?(e=eo,go++):(e=B,0===Co&&r(to)),e===B&&(t.substr(go,2)===oo?(e=oo,go+=2):(e=B,0===Co&&r(ro)),e===B&&(13===t.charCodeAt(go)?(e=io,go++):(e=B,0===Co&&r(no)),e===B&&(8232===t.charCodeAt(go)?(e=ao,go++):(e=B,0===Co&&r(lo)),e===B&&(8233===t.charCodeAt(go)?(e=so,go++):(e=B,0===Co&&r(po)))))),e}function F(){var e;return co.test(t.charAt(go))?(e=t.charAt(go),go++):(e=B,0===Co&&r(uo)),e===B&&(e=D()),e}function k(e){return e.concat([["line",o(ho).line],["col",o(ho).column]])}var G,U=arguments.length>1?arguments[1]:{},B={},$={start:n},q=n,j=function(e){return k(["body"].concat(e))},W={type:"other",description:"section"},V=B,Y=null,K=function(e,t,o,r){return r&&e[1].text===r.text||function(e){throw i(e,null,ho)}("Expected end tag for "+e[1].text+" but it was not found."),!0},X=void 0,H=function(e,t,o){return o.push(["param",["literal","block"],t]),e.push(o),k(e)},z="/",Z={type:"literal",value:"/",description:'"/"'},J=function(e){return e.push(["bodies"]),k(e)},Q=/^[#?\^<+@%]/,ee={type:"class",value:"[#?\\^<+@%]",description:"[#?\\^<+@%]"},te=function(e,t,o,r){return[e,t,o,r]},oe={type:"other",description:"end tag"},re=function(e){return e},ie=":",ne={type:"literal",value:":",description:'":"'},ae=function(e){return e},le=function(e){return e?["context",e]:["context"]},se={type:"other",description:"params"},pe="=",ce={type:"literal",value:"=",description:'"="'},ue=function(e,t){return["param",["literal",e],t]},ge=function(e){return["params"].concat(e)},de={type:"other",description:"bodies"},he=function(e){return["bodies"].concat(e)},fe={type:"other",description:"reference"},ye=function(e,t){return k(["reference",e,t])},me={type:"other",description:"partial"},ve=">",Ce={type:"literal",value:">",description:'">"'},Te="+",Se={type:"literal",value:"+",description:'"+"'},_e=function(e){return["literal",e]},Ee=function(e,t,o,r){return k([">"===e?"partial":e,t,o,r])},xe={type:"other",description:"filters"},Pe="|",Le={type:"literal",value:"|",description:'"|"'},we=function(e){return["filters"].concat(e)},be={type:"other",description:"special"},Re="~",Ae={type:"literal",value:"~",description:'"~"'},Me=function(e){return k(["special",e])},Ie={type:"other",description:"identifier"},Oe=function(e){var t=["path"].concat(e);return t.text=e[1].join(".").replace(/,line,\d+,col,\d+/g,""),t},Ne=function(e){var t=["key",e];return t.text=e,t},De={type:"other",description:"number"},Fe=function(e){return["literal",e]},ke={type:"other",description:"float"},Ge=".",Ue={type:"literal",value:".",description:'"."'},Be=function(e,t){return parseFloat(e+"."+t)},$e={type:"other",description:"unsigned_integer"},qe=/^[0-9]/,je={type:"class",value:"[0-9]",description:"[0-9]"},We=function(e){return function(e){return parseInt(e.join(""),10)}(e)},Ve={type:"other",description:"signed_integer"},Ye="-",Ke={type:"literal",value:"-",description:'"-"'},Xe=function(e,t){return-1*t},He={type:"other",description:"integer"},ze={type:"other",description:"path"},Ze=function(e,t){return t=t[0],e&&t?(t.unshift(e),k([!1,t])):k([!0,t])},Je=function(e){return k(e.length>0?[!0,e[0]]:[!0,[]])},Qe={type:"other",description:"key"},et=/^[a-zA-Z_$]/,tt={type:"class",value:"[a-zA-Z_$]",description:"[a-zA-Z_$]"},ot=/^[0-9a-zA-Z_$\-]/,rt={type:"class",value:"[0-9a-zA-Z_$\\-]",description:"[0-9a-zA-Z_$\\-]"},it=function(e,t){return e+t.join("")},nt={type:"other",description:"array"},at=function(e){return e.join("")},lt=function(e){return e},st=function(e,t){return t?t.unshift(e):t=[e],t},pt={type:"other",description:"array_part"},ct=function(e){return e},ut=function(e,t){return t?e.concat(t):e},gt={type:"other",description:"inline"},dt='"',ht={type:"literal",value:'"',description:'"\\""'},ft=function(){return k(["literal",""])},yt=function(e){return k(["literal",e])},mt=function(e){return k(["body"].concat(e))},vt=function(e){return["buffer",e]},Ct={type:"other",description:"buffer"},Tt=function(e,t){return k(["format",e,t.join("")])},St={type:"any",description:"any character"},_t=function(e){return e},Et=function(e){return k(["buffer",e.join("")])},xt={type:"other",description:"literal"},Pt=/^[^"]/,Lt={type:"class",value:'[^"]',description:'[^"]'},wt=function(e){return e.join("")},bt='\\"',Rt={type:"literal",value:'\\"',description:'"\\\\\\""'},At=function(){return'"'},Mt={type:"other",description:"raw"},It="{`",Ot={type:"literal",value:"{`",description:'"{`"'},Nt="`}",Dt={type:"literal",value:"`}",description:'"`}"'},Ft=function(e){return e},kt=function(e){return k(["raw",e.join("")])},Gt={type:"other",description:"comment"},Ut="{!",Bt={type:"literal",value:"{!",description:'"{!"'},$t="!}",qt={type:"literal",value:"!}",description:'"!}"'},jt=function(e){return k(["comment",e.join("")])},Wt=/^[#?\^><+%:@\/~%]/,Vt={type:"class",value:"[#?\\^><+%:@\\/~%]",description:"[#?\\^><+%:@\\/~%]"},Yt="{",Kt={type:"literal",value:"{",description:'"{"'},Xt="}",Ht={type:"literal",value:"}",description:'"}"'},zt="[",Zt={type:"literal",value:"[",description:'"["'},Jt="]",Qt={type:"literal",value:"]",description:'"]"'},eo="\n",to={type:"literal",value:"\n",description:'"\\n"'},oo="\r\n",ro={type:"literal",value:"\r\n",description:'"\\r\\n"'},io="\r",no={type:"literal",value:"\r",description:'"\\r"'},ao="\u2028",lo={type:"literal",value:"\u2028",description:'"\\u2028"'},so="\u2029",po={type:"literal",value:"\u2029",description:'"\\u2029"'},co=/^[\t\x0B\f \xA0\uFEFF]/,uo={type:"class",value:"[\\t\\x0B\\f \\xA0\\uFEFF]",description:"[\\t\\x0B\\f \\xA0\\uFEFF]"},go=0,ho=0,fo=0,yo={line:1,column:1,seenCR:!1},mo=0,vo=[],Co=0;if("startRule"in U){if(!(U.startRule in $))throw new Error("Can't start parsing from rule \""+U.startRule+'".');q=$[U.startRule]}if((G=q())!==B&&go===t.length)return G;throw G!==B&&go<t.length&&r({type:"end",description:"end of input"}),i(null,vo,mo)}}}();return e.parse=t.parse,t}),function(e,t){"function"==typeof define&&define.amd&&!0===define.amd.dust?define("dust.compile",["dust.core","dust.parse"],function(e,o){return t(o,e).compile}):"object"==typeof exports?module.exports=t(require("./parser").parse,require("./dust")):t(e.dust.parse,e.dust)}(this,function(e,t){function o(e){return u.filterNode({},e)}function r(e,t){for(var o,r=[t[0]],i=1,n=t.length;n>i;i++)(o=u.filterNode(e,t[i]))&&r.push(o);return r}function i(e,t){return t}function n(){}function a(e,o){var r,i={name:o,bodies:[],blocks:{},index:0,auto:"h"},n=t.escapeJs(o),a=o?'"'+n+'",':"",l="function(dust){",s=u.compileNode(i,e);return o&&(l+='dust.register("'+n+'",'+s+");"),r="("+(l+=function(e){var t,o=[],r=e.blocks;for(t in r)o.push('"'+t+'":'+r[t]);return o.length?(e.blocks="ctx=ctx.shiftBlocks(blocks);","var blocks={"+o.join(",")+"};"):(e.blocks="",e.blocks)}(i)+function(e){for(var t=[],o=e.bodies,r=e.blocks,i=0,n=o.length;n>i;i++)t[i]="function body_"+i+"(chk,ctx){"+r+"return chk"+o[i]+";}body_"+i+".__dustBody=!0;";return t.join("")}(i)+"return "+s+"}")+"(dust));",t.config.amd?"define("+a+'["dust.core"],'+l+");":t.config.cjs?"module.exports=function(dust){var tmpl="+r+"var f="+p().toString()+";f.template=tmpl;return f}":r}function l(e,t){for(var o="",r=1,i=t.length;i>r;r++)o+=u.compileNode(e,t[r]);return o}function s(e,o,r){return"."+(t._aliases[r]||r)+"("+u.compileNode(e,o[1])+","+u.compileNode(e,o[2])+","+u.compileNode(e,o[4])+","+u.compileNode(e,o[3])+")"}function p(e){return function(o,r){return t[r?"render":"stream"](e,o,r)}}var c,u={},g=t.isArray;u.compile=function(t,r){try{return a(o(e(t)),r)}catch(e){if(!e.line||!e.column)throw e;throw new SyntaxError(e.message+" At line : "+e.line+", column : "+e.column)}};u.filterNode=function(e,t){return u.optimizers[t[0]](e,t)};u.optimizers={body:function(e,t){for(var o,r,i=[t[0]],n=1,a=t.length;a>n;n++)(r=u.filterNode(e,t[n]))&&("buffer"===r[0]||"format"===r[0]?o?(o[0]="buffer"===r[0]?"buffer":o[0],o[1]+=r.slice(1,-2).join("")):(o=r,i.push(r)):(o=null,i.push(r)));return i},buffer:i,special:function(e,t){return["buffer",c[t[1]],t[2],t[3]]},format:function(e,o){return t.config.whitespace?(o.splice(1,2,o.slice(1,-2).join("")),o):null},reference:r,"#":r,"?":r,"^":r,"<":r,"+":r,"@":r,"%":r,partial:r,context:r,params:r,bodies:r,param:r,filters:i,key:i,path:i,literal:i,raw:i,comment:n,line:n,col:n};u.pragmas={esc:function(e,t,o){var r,i=e.auto;return t||(t="h"),e.auto="s"===t?"":t,r=l(e,o.block),e.auto=i,r}};c={s:" ",n:"\n",r:"\r",lb:"{",rb:"}"};u.compileNode=function(e,t){return u.nodes[t[0]](e,t)};u.nodes={body:function(e,t){var o=e.index++,r="body_"+o;return e.bodies[o]=l(e,t),r},buffer:function(e,t){return".w("+C(t[1])+")"},format:function(e,t){return".w("+C(t[1])+")"},reference:function(e,t){return".f("+u.compileNode(e,t[1])+",ctx,"+u.compileNode(e,t[2])+")"},"#":function(e,t){return s(e,t,"section")},"?":function(e,t){return s(e,t,"exists")},"^":function(e,t){return s(e,t,"notexists")},"<":function(e,t){for(var o,r=t[4],i=1,n=r.length;n>i;i++)if("block"===(o=r[i])[1][1])return e.blocks[t[1].text]=u.compileNode(e,o[2]),"";return""},"+":function(e,t){return void 0===t[1].text&&void 0===t[4]?".b(ctx.getBlock("+u.compileNode(e,t[1])+",chk, ctx),"+u.compileNode(e,t[2])+", {},"+u.compileNode(e,t[3])+")":".b(ctx.getBlock("+C(t[1].text)+"),"+u.compileNode(e,t[2])+","+u.compileNode(e,t[4])+","+u.compileNode(e,t[3])+")"},"@":function(e,t){return".h("+C(t[1].text)+","+u.compileNode(e,t[2])+","+u.compileNode(e,t[4])+","+u.compileNode(e,t[3])+")"},"%":function(e,t){var o,r,i,n,a,l,s,p,c,g=t[1][1];if(!u.pragmas[g])return"";for(r={},p=1,c=(o=t[4]).length;c>p;p++)r[(l=o[p])[1][1]]=l[2];for(n={},p=1,c=(i=t[3]).length;c>p;p++)n[(s=i[p])[1][1]]=s[2][1];return a=t[2][1]?t[2][1].text:null,u.pragmas[g](e,a,r,n)},partial:function(e,t){return".p("+u.compileNode(e,t[1])+",ctx,"+u.compileNode(e,t[2])+","+u.compileNode(e,t[3])+")"},context:function(e,t){return t[1]?"ctx.rebase("+u.compileNode(e,t[1])+")":"ctx"},params:function(e,t){for(var o=[],r=1,i=t.length;i>r;r++)o.push(u.compileNode(e,t[r]));return o.length?"{"+o.join(",")+"}":"{}"},bodies:function(e,t){for(var o=[],r=1,i=t.length;i>r;r++)o.push(u.compileNode(e,t[r]));return"{"+o.join(",")+"}"},param:function(e,t){return u.compileNode(e,t[1])+":"+u.compileNode(e,t[2])},filters:function(e,t){for(var o,r=[],i=1,n=t.length;n>i;i++)o=t[i],r.push('"'+o+'"');return'"'+e.auto+'"'+(r.length?",["+r.join(",")+"]":"")},key:function(e,t){return'ctx.get(["'+t[1]+'"], false)'},path:function(e,t){for(var o=t[1],r=t[2],i=[],n=0,a=r.length;a>n;n++)i.push(g(r[n])?u.compileNode(e,r[n]):'"'+r[n]+'"');return"ctx.getPath("+o+", ["+i.join(",")+"])"},literal:function(e,t){return C(t[1])},raw:function(e,t){return".w("+C(t[1])+")"}};var d=/\\/g,h=/"/g,f=/\f/g,y=/\n/g,m=/\r/g,v=/\t/g,C="undefined"==typeof JSON?function(e){return'"'+function(e){return e.replace(d,"\\\\").replace(h,'\\"').replace(f,"\\f").replace(y,"\\n").replace(m,"\\r").replace(v,"\\t")}(e)+'"'}:JSON.stringify;return t.compiler=u,t.compile=t.compiler.compile,t.renderSource=function(e,o,r){return p(t.loadSource(t.compile(e)))(o,r)},t.compileFn=function(e,o){return p(t.loadSource(t.compile(e,o)))},t.filterNode=u.filterNode,t.optimizers=u.optimizers,t.pragmas=u.pragmas,t.compileNode=u.compileNode,t.nodes=u.nodes,u});"function"==typeof define&&define.amd&&!0===define.amd.dust&&define(["require","dust.core","dust.compile"],function(e,t){return t.onLoad=function(t,o){e([t],function(){o()})},t});!function(e,t){"function"==typeof define&&define.amd&&!0===define.amd.dust?define(["dust.core"],t):"object"==typeof exports?module.exports=t(require("dustjs-linkedin")):t(e.dust)}(this,function(e){function t(t,o,r){r=r||"INFO";t=t?"{@"+t+"}: ":"";e.log(t+o,r)}function o(e){c[e]||(t(e,"Deprecation warning: "+e+" is deprecated and will be removed in a future version of dustjs-helpers","WARN"),t(null,"For help and a deprecation timeline, see https://github.com/linkedin/dustjs-helpers/wiki/Deprecated-Features#"+e.replace(/\W+/g,""),"WARN"),c[e]=!0)}function r(e){return function(e){return e.stack.tail&&e.stack.tail.head&&void 0!==e.stack.tail.head.__select__}(e)&&e.get("__select__")}function i(e,t){var o,r,i=e.stack.head,n=e.rebase();e.stack&&e.stack.tail&&(n.stack=e.stack.tail);r={isPending:!1,isResolved:!1,isDeferredComplete:!1,deferreds:[]};for(o in t)r[o]=t[o];return n.push({__select__:r}).push(i,e.stack.index,e.stack.of)}function n(e){var t,o;if(e.isDeferredPending=!0,e.deferreds.length)for(e.isDeferredComplete=!0,t=0,o=e.deferreds.length;t<o;t++)e.deferreds[t]();e.isDeferredPending=!1}function a(e,t){return"function"==typeof t?t.toString().replace(/(^\s+|\s+$)/gm,"").replace(/\n/gm,"").replace(/,\s*/gm,", ").replace(/\)\{/gm,") {"):t}function l(e,t){return function(o,r,i,n){return s(o,r,i,n,e,t)}}function s(e,o,i,n,a,l){var s,c,u,g=i.block,d=i.else,h=r(o)||{};if(h.isResolved&&!h.isDeferredPending)return e;if(n.hasOwnProperty("key"))c=n.key;else{if(!h.hasOwnProperty("key"))return t(a,"No key specified","WARN"),e;c=h.key}return u=n.type||h.type,l(c=p(o.resolve(c),u),p(o.resolve(n.value),u))?(h.isPending||(s=!0,h.isPending=!0),g&&(e=e.render(g,o)),s&&(h.isResolved=!0)):d&&(e=e.render(d,o)),e}function p(e,t){t&&(t=t.toLowerCase());switch(t){case"number":return+e;case"string":return String(e);case"boolean":return e="false"!==e&&e,Boolean(e);case"date":return new Date(e)}return e}var c={},u={tap:function(e,t,r){return o("tap"),r.resolve(e)},sep:function(e,t,o){var r=o.block;return t.stack.index===t.stack.of-1?e:r?r(e,t):e},first:function(e,t,o){return 0===t.stack.index?o.block(e,t):e},last:function(e,t,o){return t.stack.index===t.stack.of-1?o.block(e,t):e},contextDump:function(e,o,r,i){var n,l,s=o.resolve(i.to);switch(o.resolve(i.key)){case"full":n=o.stack;break;default:n=o.stack.head}l=JSON.stringify(n,a,2);switch(s){case"console":t("contextDump",l);break;default:l=l.replace(/</g,"\\u003c");e=e.write(l)}return e},math:function(e,o,a,l){var s,p=l.key,c=l.method,u=l.operand,g=l.round;if(!l.hasOwnProperty("key")||!l.method)return t("math","`key` or `method` was not provided","ERROR"),e;p=parseFloat(o.resolve(p));u=parseFloat(o.resolve(u));switch(c){case"mod":0===u&&t("math","Division by 0","ERROR");s=p%u;break;case"add":s=p+u;break;case"subtract":s=p-u;break;case"multiply":s=p*u;break;case"divide":0===u&&t("math","Division by 0","ERROR");s=p/u;break;case"ceil":case"floor":case"round":case"abs":s=Math[c](p);break;case"toint":s=parseInt(p,10);break;default:t("math","Method `"+c+"` is not supported","ERROR")}return void 0!==s&&(g&&(s=Math.round(s)),a&&a.block?(o=i(o,{key:s}),e=e.render(a.block,o),n(r(o))):e=e.write(s)),e},select:function(e,o,a,l){var s=a.block,p={};return l.hasOwnProperty("key")&&(p.key=o.resolve(l.key)),l.hasOwnProperty("type")&&(p.type=l.type),s?(o=i(o,p),e=e.render(s,o),n(r(o))):t("select","Missing body block","WARN"),e},eq:l("eq",function(e,t){return e===t}),ne:l("ne",function(e,t){return e!==t}),lt:l("lt",function(e,t){return e<t}),lte:l("lte",function(e,t){return e<=t}),gt:l("gt",function(e,t){return e>t}),gte:l("gte",function(e,t){return e>=t}),any:function(e,o,i){var n=r(o);return n?n.isDeferredComplete?t("any","Must not be nested inside {@any} or {@none} block","ERROR"):e=e.map(function(e){n.deferreds.push(function(){n.isResolved&&(e=e.render(i.block,o));e.end()})}):t("any","Must be used inside a {@select} block","ERROR"),e},none:function(e,o,i){var n=r(o);return n?n.isDeferredComplete?t("none","Must not be nested inside {@any} or {@none} block","ERROR"):e=e.map(function(e){n.deferreds.push(function(){n.isResolved||(e=e.render(i.block,o));e.end()})}):t("none","Must be used inside a {@select} block","ERROR"),e},size:function(t,o,r,i){var n,a,l=i.key;if((l=o.resolve(i.key))&&!0!==l)if(e.isArray(l))n=l.length;else if(!isNaN(parseFloat(l))&&isFinite(l))n=l;else if("object"==typeof l){n=0;for(a in l)l.hasOwnProperty(a)&&n++}else n=(l+"").length;else n=0;return t.write(n)}};for(var g in u)e.helpers[g]=u[g];return e});!function(e,t){"function"==typeof define&&define.amd?define(["dustjs-linkedin"],function(o){return t(o,e)}):"object"==typeof module&&module.exports?module.exports=t(require("dustjs-linkedin"),this):e.dust=t(e.dust,e)}(this,function(e,t,o){"use strict";var r=Object.prototype.toString,i=typeof console!==o?console:{log:function(){}},n={isArray:Array.isArray||function(e){return"[object Array]"===r.call(e)},isAvailable:function(e){return l[e]!==o},log:i.log},a={selected:o,languages:{},filters:{}},l=a.languages;return typeof String.prototype.trim===o&&(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),e.i18n={resetContext:function(){a.selected=o,Object.keys(l).forEach(function(e){delete l[e]})},setLanguage:function(e){if(!n.isAvailable(e))throw new Error("language '"+e+"' not available!");a.selected=e},setLanguages:function(e){n.isArray(e)&&e.forEach(function(e){n.isAvailable(e)||(l[e]={}),a.selected===o&&(a.selected=e)})},add:function(e,t){if(n.isAvailable(e)){var o=l[e];Object.keys(t).forEach(function(e){o[e]=t[e]})}},addFilter:function(e,t){e in a.filters||(a.filters[e]=t)}},e.helpers.i18n=function(t,r,i,s){if(s&&s.$key!==o){var p,c,u,g,d=a.selected,h=l[d],f=/\{(\s*[\w]+\s*)\}/g;u=e.helpers.tap(s.$key,t,r).split("|");var y=e.helpers.tap(u.shift(),t,r);for(g=h!==o&&h[y]!==o?h[y]:null;null!==(p=f.exec(g));)"$key"===p[1].trim()?(c="",n.log("$key can't be used as a parameter")):c=e.helpers.tap(s[p[1].trim()],t,r),g=g.replace(p[0],c);u.forEach(function(e){e in a.filters&&(g=a.filters[e](g))}),t.write(g)}else n.log("No key given in the i18n helper");return t},e});!function(){dust.helpers.iterate=function(e,t,o,r){var i=(r=r||{}).on||t.current(),n=null!=r.excludedKeys?r.excludedKeys.split(","):null;for(var a in i)(null==n||n.indexOf(a)<0)&&(e=e.render(o.block,t.push({key:a,value:i[a]})));return e};dust.helpers.startsWith=function(e,t,o,r){var i=(r=r||{}).with||t.current();for(var n in i.split(","))if(t.current().toLowerCase().startsWith(n.toLowerCase()))return!0;return!1}}();!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).localforage=e()}}(function(){return function e(t,o,r){function i(a,l){if(!o[a]){if(!t[a]){var s="function"==typeof require&&require;if(!l&&s)return s(a,!0);if(n)return n(a,!0);var p=new Error("Cannot find module '"+a+"'");throw p.code="MODULE_NOT_FOUND",p}var c=o[a]={exports:{}};t[a][0].call(c.exports,function(e){return i(t[a][1][e]||e)},c,c.exports,e,t,o,r)}return o[a].exports}for(var n="function"==typeof require&&require,a=0;a<r.length;a++)i(r[a]);return i}({1:[function(e,t,o){(function(e){"use strict";function o(){p=!0;for(var e,t,o=c.length;o;){for(t=c,c=[],e=-1;++e<o;)t[e]();o=c.length}p=!1}var r,i=e.MutationObserver||e.WebKitMutationObserver;if(i){var n=0,a=new i(o),l=e.document.createTextNode("");a.observe(l,{characterData:!0}),r=function(){l.data=n=++n%2}}else if(e.setImmediate||void 0===e.MessageChannel)r="document"in e&&"onreadystatechange"in e.document.createElement("script")?function(){var t=e.document.createElement("script");t.onreadystatechange=function(){o(),t.onreadystatechange=null,t.parentNode.removeChild(t),t=null},e.document.documentElement.appendChild(t)}:function(){setTimeout(o,0)};else{var s=new e.MessageChannel;s.port1.onmessage=o,r=function(){s.port2.postMessage(0)}}var p,c=[];t.exports=function(e){1!==c.push(e)||p||r()}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(e,t,o){"use strict";function r(){}function i(e){if("function"!=typeof e)throw new TypeError("resolver must be a function");this.state=h,this.queue=[],this.outcome=void 0,e!==r&&s(this,e)}function n(e,t,o){this.promise=e,"function"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"==typeof o&&(this.onRejected=o,this.callRejected=this.otherCallRejected)}function a(e,t,o){c(function(){var r;try{r=t(o)}catch(t){return u.reject(e,t)}r===e?u.reject(e,new TypeError("Cannot resolve promise with itself")):u.resolve(e,r)})}function l(e){var t=e&&e.then;if(e&&"object"==typeof e&&"function"==typeof t)return function(){t.apply(e,arguments)}}function s(e,t){function o(t){i||(i=!0,u.reject(e,t))}function r(t){i||(i=!0,u.resolve(e,t))}var i=!1,n=p(function(){t(r,o)});"error"===n.status&&o(n.value)}function p(e,t){var o={};try{o.value=e(t),o.status="success"}catch(e){o.status="error",o.value=e}return o}var c=e(1),u={},g=["REJECTED"],d=["FULFILLED"],h=["PENDING"];t.exports=o=i,i.prototype.catch=function(e){return this.then(null,e)},i.prototype.then=function(e,t){if("function"!=typeof e&&this.state===d||"function"!=typeof t&&this.state===g)return this;var o=new this.constructor(r);this.state!==h?a(o,this.state===d?e:t,this.outcome):this.queue.push(new n(o,e,t));return o},n.prototype.callFulfilled=function(e){u.resolve(this.promise,e)},n.prototype.otherCallFulfilled=function(e){a(this.promise,this.onFulfilled,e)},n.prototype.callRejected=function(e){u.reject(this.promise,e)},n.prototype.otherCallRejected=function(e){a(this.promise,this.onRejected,e)},u.resolve=function(e,t){var o=p(l,t);if("error"===o.status)return u.reject(e,o.value);var r=o.value;if(r)s(e,r);else{e.state=d,e.outcome=t;for(var i=-1,n=e.queue.length;++i<n;)e.queue[i].callFulfilled(t)}return e},u.reject=function(e,t){e.state=g,e.outcome=t;for(var o=-1,r=e.queue.length;++o<r;)e.queue[o].callRejected(t);return e},o.resolve=function(e){return e instanceof this?e:u.resolve(new this(r),e)},o.reject=function(e){var t=new this(r);return u.reject(t,e)},o.all=function(e){function t(e,t){o.resolve(e).then(function(e){a[t]=e,++l!==i||n||(n=!0,u.resolve(p,a))},function(e){n||(n=!0,u.reject(p,e))})}var o=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var i=e.length,n=!1;if(!i)return this.resolve([]);for(var a=new Array(i),l=0,s=-1,p=new this(r);++s<i;)t(e[s],s);return p},o.race=function(e){function t(e){o.resolve(e).then(function(e){n||(n=!0,u.resolve(l,e))},function(e){n||(n=!0,u.reject(l,e))})}var o=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var i=e.length,n=!1;if(!i)return this.resolve([]);for(var a=-1,l=new this(r);++a<i;)t(e[a]);return l}},{1:1}],3:[function(e,t,o){(function(t){"use strict";"function"!=typeof t.Promise&&(t.Promise=e(2))}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{2:2}],4:[function(e,t,o){"use strict";function r(e,t){e=e||[],t=t||{};try{return new Blob(e,t)}catch(i){if("TypeError"!==i.name)throw i;for(var o=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),r=0;r<e.length;r+=1)o.append(e[r]);return o.getBlob(t.type)}}function i(e,t){t&&e.then(function(e){t(null,e)},function(e){t(e)})}function n(e,t,o){"function"==typeof t&&e.then(t),"function"==typeof o&&e.catch(o)}function a(e){return"string"!=typeof e&&(console.warn(e+" used as a key, but it is not a string."),e=String(e)),e}function l(e){return"boolean"==typeof _?x.resolve(_):function(e){return new x(function(t){var o=e.transaction(P,b),i=r([""]);o.objectStore(P).put(i,"key"),o.onabort=function(e){e.preventDefault(),e.stopPropagation(),t(!1)},o.oncomplete=function(){var e=navigator.userAgent.match(/Chrome\/(\d+)/),o=navigator.userAgent.match(/Edge\//);t(o||!e||parseInt(e[1],10)>=43)}}).catch(function(){return!1})}(e).then(function(e){return _=e})}function s(e){var t=E[e.name],o={};o.promise=new x(function(e){o.resolve=e}),t.deferredOperations.push(o),t.dbReady?t.dbReady=t.dbReady.then(function(){return o.promise}):t.dbReady=o.promise}function p(e,t){return new x(function(o,r){if(e.db){if(!t)return o(e.db);s(e),e.db.close()}var i=[e.name];t&&i.push(e.version);var n=S.open.apply(S,i);t&&(n.onupgradeneeded=function(t){var o=n.result;try{o.createObjectStore(e.storeName),t.oldVersion<=1&&o.createObjectStore(P)}catch(o){if("ConstraintError"!==o.name)throw o;console.warn('The database "'+e.name+'" has been upgraded from version '+t.oldVersion+" to version "+t.newVersion+', but the storage "'+e.storeName+'" already exists.')}}),n.onerror=function(e){e.preventDefault(),r(n.error)},n.onsuccess=function(){o(n.result),function(e){var t=E[e.name].deferredOperations.pop();t&&t.resolve()}(e)}})}function c(e){return r([function(e){for(var t=e.length,o=new ArrayBuffer(t),r=new Uint8Array(o),i=0;i<t;i++)r[i]=e.charCodeAt(i);return o}(atob(e.data))],{type:e.type})}function u(e){return e&&e.__local_forage_encoded_blob}function g(e){var t=this,o=t._initReady().then(function(){var e=E[t._dbInfo.name];if(e&&e.dbReady)return e.dbReady});return n(o,e,e),o}function d(e){s(e);for(var t=E[e.name].forages,o=0;o<t.length;o++)t[o]._dbInfo.db&&(t[o]._dbInfo.db.close(),t[o]._dbInfo.db=null);return p(e,!1).then(function(e){for(var o=0;o<t.length;o++)t[o]._dbInfo.db=e}).catch(function(t){throw function(e,t){var o=E[e.name].deferredOperations.pop();o&&o.reject(t)}(e,t),t})}function h(e,t,o){try{var r=e.db.transaction(e.storeName,t);o(null,r)}catch(r){if(!e.db||"InvalidStateError"===r.name)return d(e).then(function(){var r=e.db.transaction(e.storeName,t);o(null,r)});o(r)}}function f(e){var t,o,r,i,n,a=.75*e.length,l=e.length,s=0;"="===e[e.length-1]&&(a--,"="===e[e.length-2]&&a--);var p=new ArrayBuffer(a),c=new Uint8Array(p);for(t=0;t<l;t+=4)o=A.indexOf(e[t]),r=A.indexOf(e[t+1]),i=A.indexOf(e[t+2]),n=A.indexOf(e[t+3]),c[s++]=o<<2|r>>4,c[s++]=(15&r)<<4|i>>2,c[s++]=(3&i)<<6|63&n;return p}function y(e){var t,o=new Uint8Array(e),r="";for(t=0;t<o.length;t+=3)r+=A[o[t]>>2],r+=A[(3&o[t])<<4|o[t+1]>>4],r+=A[(15&o[t+1])<<2|o[t+2]>>6],r+=A[63&o[t+2]];return o.length%3==2?r=r.substring(0,r.length-1)+"=":o.length%3==1&&(r=r.substring(0,r.length-2)+"=="),r}function m(){return!function(){var e="_localforage_support_test";try{return localStorage.setItem(e,!0),localStorage.removeItem(e),!1}catch(e){return!0}}()||localStorage.length>0}function v(e,t){e[t]=function(){var o=arguments;return e.ready().then(function(){return e[t].apply(e,o)})}}function C(){for(var e=1;e<arguments.length;e++){var t=arguments[e];if(t)for(var o in t)t.hasOwnProperty(o)&&(Z(t[o])?arguments[0][o]=t[o].slice():arguments[0][o]=t[o])}return arguments[0]}var T="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},S=function(){try{if("undefined"!=typeof indexedDB)return indexedDB;if("undefined"!=typeof webkitIndexedDB)return webkitIndexedDB;if("undefined"!=typeof mozIndexedDB)return mozIndexedDB;if("undefined"!=typeof OIndexedDB)return OIndexedDB;if("undefined"!=typeof msIndexedDB)return msIndexedDB}catch(e){return}}();"undefined"==typeof Promise&&e(3);var _,E,x=Promise,P="local-forage-detect-blob-support",L=Object.prototype.toString,w="readonly",b="readwrite",R={_driver:"asyncStorage",_initStorage:function(e){function t(){return x.resolve()}var o=this,r={db:null};if(e)for(var i in e)r[i]=e[i];E||(E={});var n=E[r.name];n||(n={forages:[],db:null,dbReady:null,deferredOperations:[]},E[r.name]=n),n.forages.push(o),o._initReady||(o._initReady=o.ready,o.ready=g);for(var a=[],l=0;l<n.forages.length;l++){var s=n.forages[l];s!==o&&a.push(s._initReady().catch(t))}var c=n.forages.slice(0);return x.all(a).then(function(){return r.db=n.db,p(r,!1)}).then(function(e){return r.db=e,function(e,t){if(!e.db)return!0;var o=!e.db.objectStoreNames.contains(e.storeName),r=e.version<e.db.version,i=e.version>e.db.version;if(r&&(e.version!==t&&console.warn('The database "'+e.name+"\" can't be downgraded from version "+e.db.version+" to version "+e.version+"."),e.version=e.db.version),i||o){if(o){var n=e.db.version+1;n>e.version&&(e.version=n)}return!0}return!1}(r,o._defaultConfig.version)?function(e){return p(e,!0)}(r):e}).then(function(e){r.db=n.db=e,o._dbInfo=r;for(var t=0;t<c.length;t++){var i=c[t];i!==o&&(i._dbInfo.db=r.db,i._dbInfo.version=r.version)}})},_support:function(){try{if(!S)return!1;var e="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),t="function"==typeof fetch&&-1!==fetch.toString().indexOf("[native code");return(!e||t)&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange}catch(e){return!1}}(),iterate:function(e,t){var o=this,r=new x(function(t,r){o.ready().then(function(){h(o._dbInfo,w,function(i,n){if(i)return r(i);try{var a=n.objectStore(o._dbInfo.storeName).openCursor(),l=1;a.onsuccess=function(){var o=a.result;if(o){var r=o.value;u(r)&&(r=c(r));var i=e(r,o.key,l++);void 0!==i?t(i):o.continue()}else t()},a.onerror=function(){r(a.error)}}catch(e){r(e)}})}).catch(r)});return i(r,t),r},getItem:function(e,t){var o=this;e=a(e);var r=new x(function(t,r){o.ready().then(function(){h(o._dbInfo,w,function(i,n){if(i)return r(i);try{var a=n.objectStore(o._dbInfo.storeName).get(e);a.onsuccess=function(){var e=a.result;void 0===e&&(e=null),u(e)&&(e=c(e)),t(e)},a.onerror=function(){r(a.error)}}catch(e){r(e)}})}).catch(r)});return i(r,t),r},setItem:function(e,t,o){var r=this;e=a(e);var n=new x(function(o,i){var n;r.ready().then(function(){return n=r._dbInfo,"[object Blob]"===L.call(t)?l(n.db).then(function(e){return e?t:function(e){return new x(function(t,o){var r=new FileReader;r.onerror=o,r.onloadend=function(o){var r=btoa(o.target.result||"");t({__local_forage_encoded_blob:!0,data:r,type:e.type})},r.readAsBinaryString(e)})}(t)}):t}).then(function(t){h(r._dbInfo,b,function(n,a){if(n)return i(n);try{var l=a.objectStore(r._dbInfo.storeName);null===t&&(t=void 0);var s=l.put(t,e);a.oncomplete=function(){void 0===t&&(t=null),o(t)},a.onabort=a.onerror=function(){var e=s.error?s.error:s.transaction.error;i(e)}}catch(e){i(e)}})}).catch(i)});return i(n,o),n},removeItem:function(e,t){var o=this;e=a(e);var r=new x(function(t,r){o.ready().then(function(){h(o._dbInfo,b,function(i,n){if(i)return r(i);try{var a=n.objectStore(o._dbInfo.storeName).delete(e);n.oncomplete=function(){t()},n.onerror=function(){r(a.error)},n.onabort=function(){var e=a.error?a.error:a.transaction.error;r(e)}}catch(e){r(e)}})}).catch(r)});return i(r,t),r},clear:function(e){var t=this,o=new x(function(e,o){t.ready().then(function(){h(t._dbInfo,b,function(r,i){if(r)return o(r);try{var n=i.objectStore(t._dbInfo.storeName).clear();i.oncomplete=function(){e()},i.onabort=i.onerror=function(){var e=n.error?n.error:n.transaction.error;o(e)}}catch(e){o(e)}})}).catch(o)});return i(o,e),o},length:function(e){var t=this,o=new x(function(e,o){t.ready().then(function(){h(t._dbInfo,w,function(r,i){if(r)return o(r);try{var n=i.objectStore(t._dbInfo.storeName).count();n.onsuccess=function(){e(n.result)},n.onerror=function(){o(n.error)}}catch(e){o(e)}})}).catch(o)});return i(o,e),o},key:function(e,t){var o=this,r=new x(function(t,r){e<0?t(null):o.ready().then(function(){h(o._dbInfo,w,function(i,n){if(i)return r(i);try{var a=n.objectStore(o._dbInfo.storeName),l=!1,s=a.openCursor();s.onsuccess=function(){var o=s.result;o?0===e?t(o.key):l?t(o.key):(l=!0,o.advance(e)):t(null)},s.onerror=function(){r(s.error)}}catch(e){r(e)}})}).catch(r)});return i(r,t),r},keys:function(e){var t=this,o=new x(function(e,o){t.ready().then(function(){h(t._dbInfo,w,function(r,i){if(r)return o(r);try{var n=i.objectStore(t._dbInfo.storeName).openCursor(),a=[];n.onsuccess=function(){var t=n.result;t?(a.push(t.key),t.continue()):e(a)},n.onerror=function(){o(n.error)}}catch(e){o(e)}})}).catch(o)});return i(o,e),o}},A="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",M="~~local_forage_type~",I=/^~~local_forage_type~([^~]+)~/,O="__lfsc__:",N=O.length,D="arbf",F="blob",k="si08",G="ui08",U="uic8",B="si16",$="si32",q="ur16",j="ui32",W="fl32",V="fl64",Y=N+D.length,K=Object.prototype.toString,X={serialize:function(e,t){var o="";if(e&&(o=K.call(e)),e&&("[object ArrayBuffer]"===o||e.buffer&&"[object ArrayBuffer]"===K.call(e.buffer))){var r,i=O;e instanceof ArrayBuffer?(r=e,i+=D):(r=e.buffer,"[object Int8Array]"===o?i+=k:"[object Uint8Array]"===o?i+=G:"[object Uint8ClampedArray]"===o?i+=U:"[object Int16Array]"===o?i+=B:"[object Uint16Array]"===o?i+=q:"[object Int32Array]"===o?i+=$:"[object Uint32Array]"===o?i+=j:"[object Float32Array]"===o?i+=W:"[object Float64Array]"===o?i+=V:t(new Error("Failed to get type for BinaryArray"))),t(i+y(r))}else if("[object Blob]"===o){var n=new FileReader;n.onload=function(){var o=M+e.type+"~"+y(this.result);t(O+F+o)},n.readAsArrayBuffer(e)}else try{t(JSON.stringify(e))}catch(o){console.error("Couldn't convert value into a JSON string: ",e),t(null,o)}},deserialize:function(e){if(e.substring(0,N)!==O)return JSON.parse(e);var t,o=e.substring(Y),i=e.substring(N,Y);if(i===F&&I.test(o)){var n=o.match(I);t=n[1],o=o.substring(n[0].length)}var a=f(o);switch(i){case D:return a;case F:return r([a],{type:t});case k:return new Int8Array(a);case G:return new Uint8Array(a);case U:return new Uint8ClampedArray(a);case B:return new Int16Array(a);case q:return new Uint16Array(a);case $:return new Int32Array(a);case j:return new Uint32Array(a);case W:return new Float32Array(a);case V:return new Float64Array(a);default:throw new Error("Unkown type: "+i)}},stringToBuffer:f,bufferToString:y},H={_driver:"webSQLStorage",_initStorage:function(e){var t=this,o={db:null};if(e)for(var r in e)o[r]="string"!=typeof e[r]?e[r].toString():e[r];var i=new x(function(e,r){try{o.db=openDatabase(o.name,String(o.version),o.description,o.size)}catch(e){return r(e)}o.db.transaction(function(i){i.executeSql("CREATE TABLE IF NOT EXISTS "+o.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],function(){t._dbInfo=o,e()},function(e,t){r(t)})})});return o.serializer=X,i},_support:"function"==typeof openDatabase,iterate:function(e,t){var o=this,r=new x(function(t,r){o.ready().then(function(){var i=o._dbInfo;i.db.transaction(function(o){o.executeSql("SELECT * FROM "+i.storeName,[],function(o,r){for(var n=r.rows,a=n.length,l=0;l<a;l++){var s=n.item(l),p=s.value;if(p&&(p=i.serializer.deserialize(p)),void 0!==(p=e(p,s.key,l+1)))return void t(p)}t()},function(e,t){r(t)})})}).catch(r)});return i(r,t),r},getItem:function(e,t){var o=this;e=a(e);var r=new x(function(t,r){o.ready().then(function(){var i=o._dbInfo;i.db.transaction(function(o){o.executeSql("SELECT * FROM "+i.storeName+" WHERE key = ? LIMIT 1",[e],function(e,o){var r=o.rows.length?o.rows.item(0).value:null;r&&(r=i.serializer.deserialize(r)),t(r)},function(e,t){r(t)})})}).catch(r)});return i(r,t),r},setItem:function(e,t,o){return function e(t,o,r,n){var l=this;t=a(t);var s=new x(function(i,a){l.ready().then(function(){void 0===o&&(o=null);var s=o,p=l._dbInfo;p.serializer.serialize(o,function(o,c){c?a(c):p.db.transaction(function(e){e.executeSql("INSERT OR REPLACE INTO "+p.storeName+" (key, value) VALUES (?, ?)",[t,o],function(){i(s)},function(e,t){a(t)})},function(o){if(o.code===o.QUOTA_ERR){if(n>0)return void i(e.apply(l,[t,s,r,n-1]));a(o)}})})}).catch(a)});return i(s,r),s}.apply(this,[e,t,o,1])},removeItem:function(e,t){var o=this;e=a(e);var r=new x(function(t,r){o.ready().then(function(){var i=o._dbInfo;i.db.transaction(function(o){o.executeSql("DELETE FROM "+i.storeName+" WHERE key = ?",[e],function(){t()},function(e,t){r(t)})})}).catch(r)});return i(r,t),r},clear:function(e){var t=this,o=new x(function(e,o){t.ready().then(function(){var r=t._dbInfo;r.db.transaction(function(t){t.executeSql("DELETE FROM "+r.storeName,[],function(){e()},function(e,t){o(t)})})}).catch(o)});return i(o,e),o},length:function(e){var t=this,o=new x(function(e,o){t.ready().then(function(){var r=t._dbInfo;r.db.transaction(function(t){t.executeSql("SELECT COUNT(key) as c FROM "+r.storeName,[],function(t,o){var r=o.rows.item(0).c;e(r)},function(e,t){o(t)})})}).catch(o)});return i(o,e),o},key:function(e,t){var o=this,r=new x(function(t,r){o.ready().then(function(){var i=o._dbInfo;i.db.transaction(function(o){o.executeSql("SELECT key FROM "+i.storeName+" WHERE id = ? LIMIT 1",[e+1],function(e,o){var r=o.rows.length?o.rows.item(0).key:null;t(r)},function(e,t){r(t)})})}).catch(r)});return i(r,t),r},keys:function(e){var t=this,o=new x(function(e,o){t.ready().then(function(){var r=t._dbInfo;r.db.transaction(function(t){t.executeSql("SELECT key FROM "+r.storeName,[],function(t,o){for(var r=[],i=0;i<o.rows.length;i++)r.push(o.rows.item(i).key);e(r)},function(e,t){o(t)})})}).catch(o)});return i(o,e),o}},z={_driver:"localStorageWrapper",_initStorage:function(e){var t={};if(e)for(var o in e)t[o]=e[o];return t.keyPrefix=t.name+"/",t.storeName!==this._defaultConfig.storeName&&(t.keyPrefix+=t.storeName+"/"),m()?(this._dbInfo=t,t.serializer=X,x.resolve()):x.reject()},_support:function(){try{return"undefined"!=typeof localStorage&&"setItem"in localStorage&&"function"==typeof localStorage.setItem}catch(e){return!1}}(),iterate:function(e,t){var o=this,r=o.ready().then(function(){for(var t=o._dbInfo,r=t.keyPrefix,i=r.length,n=localStorage.length,a=1,l=0;l<n;l++){var s=localStorage.key(l);if(0===s.indexOf(r)){var p=localStorage.getItem(s);if(p&&(p=t.serializer.deserialize(p)),void 0!==(p=e(p,s.substring(i),a++)))return p}}});return i(r,t),r},getItem:function(e,t){var o=this;e=a(e);var r=o.ready().then(function(){var t=o._dbInfo,r=localStorage.getItem(t.keyPrefix+e);return r&&(r=t.serializer.deserialize(r)),r});return i(r,t),r},setItem:function(e,t,o){var r=this;e=a(e);var n=r.ready().then(function(){void 0===t&&(t=null);var o=t;return new x(function(i,n){var a=r._dbInfo;a.serializer.serialize(t,function(t,r){if(r)n(r);else try{localStorage.setItem(a.keyPrefix+e,t),i(o)}catch(e){"QuotaExceededError"!==e.name&&"NS_ERROR_DOM_QUOTA_REACHED"!==e.name||n(e),n(e)}})})});return i(n,o),n},removeItem:function(e,t){var o=this;e=a(e);var r=o.ready().then(function(){var t=o._dbInfo;localStorage.removeItem(t.keyPrefix+e)});return i(r,t),r},clear:function(e){var t=this,o=t.ready().then(function(){for(var e=t._dbInfo.keyPrefix,o=localStorage.length-1;o>=0;o--){var r=localStorage.key(o);0===r.indexOf(e)&&localStorage.removeItem(r)}});return i(o,e),o},length:function(e){var t=this.keys().then(function(e){return e.length});return i(t,e),t},key:function(e,t){var o=this,r=o.ready().then(function(){var t,r=o._dbInfo;try{t=localStorage.key(e)}catch(e){t=null}return t&&(t=t.substring(r.keyPrefix.length)),t});return i(r,t),r},keys:function(e){var t=this,o=t.ready().then(function(){for(var e=t._dbInfo,o=localStorage.length,r=[],i=0;i<o;i++){var n=localStorage.key(i);0===n.indexOf(e.keyPrefix)&&r.push(n.substring(e.keyPrefix.length))}return r});return i(o,e),o}},Z=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},J={},Q={},ee={INDEXEDDB:R,WEBSQL:H,LOCALSTORAGE:z},te=["clear","getItem","iterate","key","keys","length","removeItem","setItem"],oe={description:"",driver:[ee.INDEXEDDB._driver,ee.WEBSQL._driver,ee.LOCALSTORAGE._driver].slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1},re=new(function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);for(var o in ee)if(ee.hasOwnProperty(o)){var r=ee[o],i=r._driver;this[o]=i,J[i]||this.defineDriver(r)}this._defaultConfig=C({},oe),this._config=C({},this._defaultConfig,t),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch(function(){})}return e.prototype.config=function(e){if("object"===(void 0===e?"undefined":T(e))){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var t in e){if("storeName"===t&&(e[t]=e[t].replace(/\W/g,"_")),"version"===t&&"number"!=typeof e[t])return new Error("Database version must be a number.");this._config[t]=e[t]}return!("driver"in e&&e.driver)||this.setDriver(this._config.driver)}return"string"==typeof e?this._config[e]:this._config},e.prototype.defineDriver=function(e,t,o){var r=new x(function(t,o){try{var r=e._driver,i=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!e._driver)return void o(i);for(var n=te.concat("_initStorage"),a=0,l=n.length;a<l;a++){var s=n[a];if(!s||!e[s]||"function"!=typeof e[s])return void o(i)}var p=function(o){J[r]&&console.info("Redefining LocalForage driver: "+r),J[r]=e,Q[r]=o,t()};"_support"in e?e._support&&"function"==typeof e._support?e._support().then(p,o):p(!!e._support):p(!0)}catch(e){o(e)}});return n(r,t,o),r},e.prototype.driver=function(){return this._driver||null},e.prototype.getDriver=function(e,t,o){var r=J[e]?x.resolve(J[e]):x.reject(new Error("Driver not found."));return n(r,t,o),r},e.prototype.getSerializer=function(e){var t=x.resolve(X);return n(t,e),t},e.prototype.ready=function(e){var t=this,o=t._driverSet.then(function(){return null===t._ready&&(t._ready=t._initDriver()),t._ready});return n(o,e,e),o},e.prototype.setDriver=function(e,t,o){function r(){a._config.driver=a.driver()}function i(e){return a._extend(e),r(),a._ready=a._initStorage(a._config),a._ready}var a=this;Z(e)||(e=[e]);var l=this._getSupportedDrivers(e),s=null!==this._driverSet?this._driverSet.catch(function(){return x.resolve()}):x.resolve();return this._driverSet=s.then(function(){var e=l[0];return a._dbInfo=null,a._ready=null,a.getDriver(e).then(function(e){a._driver=e._driver,r(),a._wrapLibraryMethodsWithReady(),a._initDriver=function(e){return function(){var t=0;return function o(){for(;t<e.length;){var n=e[t];return t++,a._dbInfo=null,a._ready=null,a.getDriver(n).then(i).catch(o)}r();var l=new Error("No available storage method found.");return a._driverSet=x.reject(l),a._driverSet}()}}(l)})}).catch(function(){r();var e=new Error("No available storage method found.");return a._driverSet=x.reject(e),a._driverSet}),n(this._driverSet,t,o),this._driverSet},e.prototype.supports=function(e){return!!Q[e]},e.prototype._extend=function(e){C(this,e)},e.prototype._getSupportedDrivers=function(e){for(var t=[],o=0,r=e.length;o<r;o++){var i=e[o];this.supports(i)&&t.push(i)}return t},e.prototype._wrapLibraryMethodsWithReady=function(){for(var e=0,t=te.length;e<t;e++)v(this,te[e])},e.prototype.createInstance=function(t){return new e(t)},e}());t.exports=re},{3:3}]},{},[4])(4)});var __extends=this.__extends||function(e,t){function o(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);o.prototype=t.prototype;e.prototype=new o},exports,define,QRCode;function JL(e){if(!e)return JL.__;Array.prototype.reduce||(Array.prototype.reduce=function(e,t){for(var o=t,r=0;r<this.length;r++)o=e(o,this[r],r,this);return o});var t="";return("."+e).split(".").reduce(function(e,o,r,i){void 0===(o=e["__"+(t=t?t+"."+o:o)])&&(JL.Logger.prototype=e,o=new JL.Logger(t),e["__"+t]=o);return o},JL.__)}!function(e){function t(e,t,o){void 0!==t[e]&&(null===t[e]?delete o[e]:o[e]=t[e])}function o(t){if(null!=e.enabled&&!e.enabled||null!=e.maxMessages&&1>e.maxMessages)return!1;try{if(t.userAgentRegex&&!RegExp(t.userAgentRegex).test(navigator.userAgent))return!1}catch(e){}try{if(t.ipRegex&&e.clientIP&&!RegExp(t.ipRegex).test(e.clientIP))return!1}catch(e){}return!0}function r(e,t){try{if(e.disallow&&RegExp(e.disallow).test(t))return!1}catch(e){}return!0}function i(e){return"function"==typeof e?e instanceof RegExp?e.toString():e():e}function n(e){switch(typeof(e=i(e))){case"string":return new a(e,null,e);case"number":case"boolean":return e=e.toString(),new a(e,null,e);case"undefined":return new a("undefined",null,"undefined");case"object":return e instanceof RegExp||e instanceof String||e instanceof Number||e instanceof Boolean?(e=e.toString(),new a(e,null,e)):new a(null,e,JSON.stringify(e));default:return new a("unknown",null,"unknown")}}e.enabled;e.maxMessages;e.defaultAjaxUrl;e.clientIP;e.defaultBeforeSend;e.requestId="";var a=function(e,t,o){this.msg=e;this.meta=t;this.finalString=o};e.setOptions=function(e){t("enabled",e,this);t("maxMessages",e,this);t("defaultAjaxUrl",e,this);t("clientIP",e,this);t("requestId",e,this);t("defaultBeforeSend",e,this);return this};e.getAllLevel=function(){return-2147483648};e.getTraceLevel=function(){return 1e3};e.getDebugLevel=function(){return 2e3};e.getInfoLevel=function(){return 3e3};e.getWarnLevel=function(){return 4e3};e.getErrorLevel=function(){return 5e3};e.getFatalLevel=function(){return 6e3};e.getOffLevel=function(){return 2147483647};var l=function(e,t){this.inner=t;this.name="JL.Exception";this.message=n(e).finalString};e.Exception=l;l.prototype=Error();var s=function(e,t,o,r){this.l=e;this.m=t;this.n=o;this.t=r};e.LogItem=s;l=function(){function i(t,o){this.appenderName=t;this.sendLogItems=o;this.level=e.getTraceLevel();this.sendWithBufferLevel=2147483647;this.storeInBufferLevel=-2147483648;this.bufferSize=0;this.batchSize=1;this.buffer=[];this.batchBuffer=[]}i.prototype.setOptions=function(e){t("level",e,this);t("ipRegex",e,this);t("userAgentRegex",e,this);t("disallow",e,this);t("sendWithBufferLevel",e,this);t("storeInBufferLevel",e,this);t("bufferSize",e,this);t("batchSize",e,this);this.bufferSize<this.buffer.length&&(this.buffer.length=this.bufferSize);return this};i.prototype.log=function(e,t,i,n,a,l,p){!o(this)||!r(this,l)||a<this.storeInBufferLevel||(e=new s(a,l,p,(new Date).getTime()),a<this.level?0<this.bufferSize&&(this.buffer.push(e),this.buffer.length>this.bufferSize&&this.buffer.shift()):(a<this.sendWithBufferLevel||!this.buffer.length||(this.batchBuffer=this.batchBuffer.concat(this.buffer),this.buffer.length=0),this.batchBuffer.push(e),this.batchBuffer.length>=this.batchSize&&this.sendBatch()))};i.prototype.sendBatch=function(){0==this.batchBuffer.length||null!=e.maxMessages&&1>e.maxMessages||(null!=e.maxMessages&&(e.maxMessages-=this.batchBuffer.length),this.sendLogItems(this.batchBuffer),this.batchBuffer.length=0)};return i}();e.Appender=l;var p=function(o){function r(e){o.call(this,e,r.prototype.sendLogItemsAjax)}__extends(r,o);r.prototype.setOptions=function(e){t("url",e,this);t("beforeSend",e,this);o.prototype.setOptions.call(this,e);return this};r.prototype.sendLogItemsAjax=function(t){try{var o="/jsnlog.logger";null!=e.defaultAjaxUrl&&(o=e.defaultAjaxUrl);this.url&&(o=this.url);var r=JSON.stringify({r:e.requestId,lg:t}),i=this.getXhr(o);"function"==typeof this.beforeSend?this.beforeSend.call(this,i):"function"==typeof e.defaultBeforeSend&&e.defaultBeforeSend.call(this,i);i.send(r)}catch(e){}};r.prototype.getXhr=function(t){var o=new XMLHttpRequest;if(!("withCredentials"in o)&&"undefined"!=typeof XDomainRequest)return(o=new XDomainRequest).open("POST",t),o;o.open("POST",t);o.setRequestHeader("Content-Type","application/json");o.setRequestHeader("JSNLog-RequestId",e.requestId);return o};return r}(l);e.AjaxAppender=p;var c=function(t){function o(e){t.call(this,e,o.prototype.sendLogItemsConsole)}__extends(o,t);o.prototype.clog=function(e){console.log(e)};o.prototype.cerror=function(e){console.error?console.error(e):this.clog(e)};o.prototype.cwarn=function(e){console.warn?console.warn(e):this.clog(e)};o.prototype.cinfo=function(e){console.info?console.info(e):this.clog(e)};o.prototype.cdebug=function(e){console.debug?console.debug(e):this.cinfo(e)};o.prototype.sendLogItemsConsole=function(t){try{if(console){var o;for(o=0;o<t.length;++o){var r=t[o],i=r.n+": "+r.m;"undefined"==typeof window&&(i=new Date(r.t)+" | "+i);r.l<=e.getDebugLevel()?this.cdebug(i):r.l<=e.getInfoLevel()?this.cinfo(i):r.l<=e.getWarnLevel()?this.cwarn(i):this.cerror(i)}}}catch(e){}};return o}(l);e.ConsoleAppender=c;l=function(){function e(e){this.loggerName=e;this.seenRegexes=[]}e.prototype.setOptions=function(e){t("level",e,this);t("userAgentRegex",e,this);t("disallow",e,this);t("ipRegex",e,this);t("appenders",e,this);t("onceOnly",e,this);this.seenRegexes=[];return this};e.prototype.buildExceptionObject=function(e){var t={};e.stack?t.stack=e.stack:t.e=e;e.message&&(t.message=e.message);e.name&&(t.name=e.name);e.data&&(t.data=e.data);e.inner&&(t.inner=this.buildExceptionObject(e.inner));return t};e.prototype.log=function(e,t,a){var l=0;if(!this.appenders)return this;if(e>=this.level&&o(this)&&(a?(l=this.buildExceptionObject(a)).logData=i(t):l=t,r(this,(t=n(l)).finalString))){if(this.onceOnly)for(l=this.onceOnly.length-1;0<=l;){if(RegExp(this.onceOnly[l]).test(t.finalString)){if(this.seenRegexes[l])return this;this.seenRegexes[l]=!0}l--}t.meta=t.meta||{};t.meta.loggerName=this.loggerName;for(l=this.appenders.length-1;0<=l;)this.appenders[l].log(1e3>=e?"trace":2e3>=e?"debug":3e3>=e?"info":4e3>=e?"warn":5e3>=e?"error":"fatal",t.msg,t.meta,function(){},e,t.finalString,this.loggerName),l--}return this};e.prototype.trace=function(e){return this.log(1e3,e)};e.prototype.debug=function(e){return this.log(2e3,e)};e.prototype.info=function(e){return this.log(3e3,e)};e.prototype.warn=function(e){return this.log(4e3,e)};e.prototype.error=function(e){return this.log(5e3,e)};e.prototype.fatal=function(e){return this.log(6e3,e)};e.prototype.fatalException=function(e,t){return this.log(6e3,e,t)};return e}();e.Logger=l;e.createAjaxAppender=function(e){return new p(e)};e.createConsoleAppender=function(e){return new c(e)};l=new p("");"undefined"==typeof window&&(l=new c(""));e.__=new e.Logger("");e.__.setOptions({level:e.getDebugLevel(),appenders:[l]})}(JL||(JL={}));void 0!==exports&&(exports.JL=JL);"function"==typeof define&&define.amd&&define("jsnlog",[],function(){return JL});"function"==typeof __jsnlog_configure&&__jsnlog_configure(JL);!function(e,t){"object"==typeof exports?module.exports=t():"function"==typeof define&&define.amd?define([],t):e.ol=t()}(this,function(){var OPENLAYERS={},goog=this.goog={};this.CLOSURE_NO_DEPS=!0;var COMPILED=!1,goog=goog||{};goog.global=this;goog.global.CLOSURE_UNCOMPILED_DEFINES;goog.global.CLOSURE_DEFINES;goog.isDef=function(e){return void 0!==e};goog.isString=function(e){return"string"==typeof e};goog.isBoolean=function(e){return"boolean"==typeof e};goog.isNumber=function(e){return"number"==typeof e};goog.exportPath_=function(e,t,o){var r,i=e.split("."),n=o||goog.global;i[0]in n||!n.execScript||n.execScript("var "+i[0]);for(;i.length&&(r=i.shift());)!i.length&&goog.isDef(t)?n[r]=t:n=n[r]&&n[r]!==Object.prototype[r]?n[r]:n[r]={}};goog.define=function(e,t){var o=t;COMPILED||(goog.global.CLOSURE_UNCOMPILED_DEFINES&&void 0===goog.global.CLOSURE_UNCOMPILED_DEFINES.nodeType&&Object.prototype.hasOwnProperty.call(goog.global.CLOSURE_UNCOMPILED_DEFINES,e)?o=goog.global.CLOSURE_UNCOMPILED_DEFINES[e]:goog.global.CLOSURE_DEFINES&&void 0===goog.global.CLOSURE_DEFINES.nodeType&&Object.prototype.hasOwnProperty.call(goog.global.CLOSURE_DEFINES,e)&&(o=goog.global.CLOSURE_DEFINES[e]));goog.exportPath_(e,o)};goog.define("goog.DEBUG",!0);goog.define("goog.LOCALE","en");goog.define("goog.TRUSTED_SITE",!0);goog.define("goog.STRICT_MODE_COMPATIBLE",!1);goog.define("goog.DISALLOW_TEST_ONLY_CODE",COMPILED&&!goog.DEBUG);goog.define("goog.ENABLE_CHROME_APP_SAFE_SCRIPT_LOADING",!1);goog.provide=function(e){if(goog.isInModuleLoader_())throw new Error("goog.provide can not be used within a goog.module.");if(!COMPILED&&goog.isProvided_(e))throw new Error('Namespace "'+e+'" already declared.');goog.constructNamespace_(e)};goog.constructNamespace_=function(e,t){if(!COMPILED){delete goog.implicitNamespaces_[e];for(var o=e;(o=o.substring(0,o.lastIndexOf(".")))&&!goog.getObjectByName(o);)goog.implicitNamespaces_[o]=!0}goog.exportPath_(e,t)};goog.VALID_MODULE_RE_=/^[a-zA-Z_$][a-zA-Z0-9._$]*$/;goog.module=function(e){if(!goog.isString(e)||!e||-1==e.search(goog.VALID_MODULE_RE_))throw new Error("Invalid module identifier");if(!goog.isInModuleLoader_())throw new Error("Module "+e+" has been loaded incorrectly. Note, modules cannot be loaded as normal scripts. They require some kind of pre-processing step. You're likely trying to load a module via a script tag or as a part of a concatenated bundle without rewriting the module. For more info see: https://github.com/google/closure-library/wiki/goog.module:-an-ES6-module-like-alternative-to-goog.provide.");if(goog.moduleLoaderState_.moduleName)throw new Error("goog.module may only be called once per module.");goog.moduleLoaderState_.moduleName=e;if(!COMPILED){if(goog.isProvided_(e))throw new Error('Namespace "'+e+'" already declared.');delete goog.implicitNamespaces_[e]}};goog.module.get=function(e){return goog.module.getInternal_(e)};goog.module.getInternal_=function(e){if(!COMPILED){if(e in goog.loadedModules_)return goog.loadedModules_[e];if(!goog.implicitNamespaces_[e]){var t=goog.getObjectByName(e);return null!=t?t:null}}return null};goog.moduleLoaderState_=null;goog.isInModuleLoader_=function(){return null!=goog.moduleLoaderState_};goog.module.declareLegacyNamespace=function(){if(!COMPILED&&!goog.isInModuleLoader_())throw new Error("goog.module.declareLegacyNamespace must be called from within a goog.module");if(!COMPILED&&!goog.moduleLoaderState_.moduleName)throw new Error("goog.module must be called prior to goog.module.declareLegacyNamespace.");goog.moduleLoaderState_.declareLegacyNamespace=!0};goog.setTestOnly=function(e){if(goog.DISALLOW_TEST_ONLY_CODE){e=e||"";throw new Error("Importing test-only code into non-debug environment"+(e?": "+e:"."))}};goog.forwardDeclare=function(e){};goog.forwardDeclare("Document");goog.forwardDeclare("HTMLScriptElement");goog.forwardDeclare("XMLHttpRequest");if(!COMPILED){goog.isProvided_=function(e){return e in goog.loadedModules_||!goog.implicitNamespaces_[e]&&goog.isDefAndNotNull(goog.getObjectByName(e))};goog.implicitNamespaces_={"goog.module":!0}}goog.getObjectByName=function(e,t){for(var o=e.split("."),r=t||goog.global,i=0;i<o.length;i++){r=r[o[i]];if(!goog.isDefAndNotNull(r))return null}return r};goog.globalize=function(e,t){var o=t||goog.global;for(var r in e)o[r]=e[r]};goog.addDependency=function(e,t,o,r){if(goog.DEPENDENCIES_ENABLED){var i,n,a=e.replace(/\\/g,"/"),l=goog.dependencies_;r&&"boolean"!=typeof r||(r=r?{module:"goog"}:{});for(var s=0;i=t[s];s++){l.nameToPath[i]=a;l.loadFlags[a]=r}for(var p=0;n=o[p];p++){a in l.requires||(l.requires[a]={});l.requires[a][n]=!0}}};goog.define("goog.ENABLE_DEBUG_LOADER",!0);goog.logToConsole_=function(e){goog.global.console&&goog.global.console.error(e)};goog.require=function(e){if(!COMPILED){goog.ENABLE_DEBUG_LOADER&&goog.IS_OLD_IE_&&goog.maybeProcessDeferredDep_(e);if(goog.isProvided_(e)){if(goog.isInModuleLoader_())return goog.module.getInternal_(e)}else if(goog.ENABLE_DEBUG_LOADER){var t=goog.getPathFromDeps_(e);if(!t){var o="goog.require could not find: "+e;goog.logToConsole_(o);throw new Error(o)}goog.writeScripts_(t)}return null}};goog.basePath="";goog.global.CLOSURE_BASE_PATH;goog.global.CLOSURE_NO_DEPS;goog.global.CLOSURE_IMPORT_SCRIPT;goog.nullFunction=function(){};goog.abstractMethod=function(){throw new Error("unimplemented abstract method")};goog.addSingletonGetter=function(e){e.instance_=void 0;e.getInstance=function(){if(e.instance_)return e.instance_;goog.DEBUG&&(goog.instantiatedSingletons_[goog.instantiatedSingletons_.length]=e);return e.instance_=new e}};goog.instantiatedSingletons_=[];goog.define("goog.LOAD_MODULE_USING_EVAL",!0);goog.define("goog.SEAL_MODULE_EXPORTS",goog.DEBUG);goog.loadedModules_={};goog.DEPENDENCIES_ENABLED=!COMPILED&&goog.ENABLE_DEBUG_LOADER;goog.define("goog.TRANSPILE","detect");goog.define("goog.TRANSPILER","transpile.js");if(goog.DEPENDENCIES_ENABLED){goog.dependencies_={loadFlags:{},nameToPath:{},requires:{},visited:{},written:{},deferred:{}};goog.inHtmlDocument_=function(){var e=goog.global.document;return null!=e&&"write"in e};goog.findBasePath_=function(){if(goog.isDef(goog.global.CLOSURE_BASE_PATH)&&goog.isString(goog.global.CLOSURE_BASE_PATH))goog.basePath=goog.global.CLOSURE_BASE_PATH;else if(goog.inHtmlDocument_()){var e=goog.global.document,t=e.currentScript;if(t)var o=[t];else o=e.getElementsByTagName("SCRIPT");for(var r=o.length-1;r>=0;--r){var i=o[r].src,n=i.lastIndexOf("?"),a=-1==n?i.length:n;if("base.js"==i.substr(a-7,7)){goog.basePath=i.substr(0,a-7);return}}}};goog.importScript_=function(e,t){(goog.global.CLOSURE_IMPORT_SCRIPT||goog.writeScriptTag_)(e,t)&&(goog.dependencies_.written[e]=!0)};goog.IS_OLD_IE_=!(goog.global.atob||!goog.global.document||!goog.global.document.all);goog.oldIeWaiting_=!1;goog.importProcessedScript_=function(e,t,o){var r='goog.retrieveAndExec_("'+e+'", '+t+", "+o+");";goog.importScript_("",r)};goog.queuedModules_=[];goog.wrapModule_=function(e,t){return goog.LOAD_MODULE_USING_EVAL&&goog.isDef(goog.global.JSON)?"goog.loadModule("+goog.global.JSON.stringify(t+"\n//# sourceURL="+e+"\n")+");":'goog.loadModule(function(exports) {"use strict";'+t+"\n;return exports});\n//# sourceURL="+e+"\n"};goog.loadQueuedModules_=function(){var e=goog.queuedModules_.length;if(e>0){var t=goog.queuedModules_;goog.queuedModules_=[];for(var o=0;o<e;o++){var r=t[o];goog.maybeProcessDeferredPath_(r)}}goog.oldIeWaiting_=!1};goog.maybeProcessDeferredDep_=function(e){if(goog.isDeferredModule_(e)&&goog.allDepsAreAvailable_(e)){var t=goog.getPathFromDeps_(e);goog.maybeProcessDeferredPath_(goog.basePath+t)}};goog.isDeferredModule_=function(e){var t=goog.getPathFromDeps_(e),o=t&&goog.dependencies_.loadFlags[t]||{},r=o.lang||"es3";if(t&&("goog"==o.module||goog.needsTranspile_(r))){return goog.basePath+t in goog.dependencies_.deferred}return!1};goog.allDepsAreAvailable_=function(e){var t=goog.getPathFromDeps_(e);if(t&&t in goog.dependencies_.requires)for(var o in goog.dependencies_.requires[t])if(!goog.isProvided_(o)&&!goog.isDeferredModule_(o))return!1;return!0};goog.maybeProcessDeferredPath_=function(e){if(e in goog.dependencies_.deferred){var t=goog.dependencies_.deferred[e];delete goog.dependencies_.deferred[e];goog.globalEval(t)}};goog.loadModuleFromUrl=function(e){goog.retrieveAndExec_(e,!0,!1)};goog.writeScriptSrcNode_=function(e){goog.global.document.write('<script type="text/javascript" src="'+e+'"><\/script>')};goog.appendScriptSrcNode_=function(e){var t=goog.global.document,o=t.createElement("script");o.type="text/javascript";o.src=e;o.defer=!1;o.async=!1;t.head.appendChild(o)};goog.writeScriptTag_=function(e,t){if(goog.inHtmlDocument_()){var o=goog.global.document;if(!goog.ENABLE_CHROME_APP_SAFE_SCRIPT_LOADING&&"complete"==o.readyState){if(/\bdeps.js$/.test(e))return!1;throw new Error('Cannot write "'+e+'" after document load')}if(void 0===t)if(goog.IS_OLD_IE_){goog.oldIeWaiting_=!0;var r=" onreadystatechange='goog.onScriptLoad_(this, "+ ++goog.lastNonModuleScriptIndex_+")' ";o.write('<script type="text/javascript" src="'+e+'"'+r+"><\/script>")}else goog.ENABLE_CHROME_APP_SAFE_SCRIPT_LOADING?goog.appendScriptSrcNode_(e):goog.writeScriptSrcNode_(e);else o.write('<script type="text/javascript">'+goog.protectScriptTag_(t)+"<\/script>");return!0}return!1};goog.protectScriptTag_=function(e){return e.replace(/<\/(SCRIPT)/gi,"\\x3c/$1")};goog.needsTranspile_=function(e){if("always"==goog.TRANSPILE)return!0;if("never"==goog.TRANSPILE)return!1;goog.requiresTranspilation_||(goog.requiresTranspilation_=goog.createRequiresTranspilation_());if(e in goog.requiresTranspilation_)return goog.requiresTranspilation_[e];throw new Error("Unknown language mode: "+e)};goog.requiresTranspilation_=null;goog.lastNonModuleScriptIndex_=0;goog.onScriptLoad_=function(e,t){"complete"==e.readyState&&goog.lastNonModuleScriptIndex_==t&&goog.loadQueuedModules_();return!0};goog.writeScripts_=function(e){var t=[],o={},r=goog.dependencies_;!function e(i){if(!(i in r.written||i in r.visited)){r.visited[i]=!0;if(i in r.requires)for(var n in r.requires[i])if(!goog.isProvided_(n)){if(!(n in r.nameToPath))throw new Error("Undefined nameToPath for "+n);e(r.nameToPath[n])}if(!(i in o)){o[i]=!0;t.push(i)}}}(e);for(var i=0;i<t.length;i++){var n=t[i];goog.dependencies_.written[n]=!0}var a=goog.moduleLoaderState_;goog.moduleLoaderState_=null;for(i=0;i<t.length;i++){if(!(n=t[i])){goog.moduleLoaderState_=a;throw new Error("Undefined script input")}var l=r.loadFlags[n]||{},s=l.lang||"es3",p=goog.needsTranspile_(s);"goog"==l.module||p?goog.importProcessedScript_(goog.basePath+n,"goog"==l.module,p):goog.importScript_(goog.basePath+n)}goog.moduleLoaderState_=a};goog.getPathFromDeps_=function(e){return e in goog.dependencies_.nameToPath?goog.dependencies_.nameToPath[e]:null};goog.findBasePath_();goog.global.CLOSURE_NO_DEPS||goog.importScript_(goog.basePath+"deps.js")}goog.hasBadLetScoping=null;goog.useSafari10Workaround=function(){if(null==goog.hasBadLetScoping){var hasBadLetScoping;try{hasBadLetScoping=!eval('"use strict";let x = 1; function f() { return typeof x; };f() == "number";')}catch(e){hasBadLetScoping=!1}goog.hasBadLetScoping=hasBadLetScoping}return goog.hasBadLetScoping};goog.workaroundSafari10EvalBug=function(e){return"(function(){"+e+"\n;})();\n"};goog.loadModule=function(e){var t=goog.moduleLoaderState_;try{goog.moduleLoaderState_={moduleName:void 0,declareLegacyNamespace:!1};var o;if(goog.isFunction(e))o=e.call(void 0,{});else{if(!goog.isString(e))throw new Error("Invalid module definition");goog.useSafari10Workaround()&&(e=goog.workaroundSafari10EvalBug(e));o=goog.loadModuleFromSource_.call(void 0,e)}var r=goog.moduleLoaderState_.moduleName;if(!goog.isString(r)||!r)throw new Error('Invalid module name "'+r+'"');goog.moduleLoaderState_.declareLegacyNamespace?goog.constructNamespace_(r,o):goog.SEAL_MODULE_EXPORTS&&Object.seal&&"object"==typeof o&&null!=o&&Object.seal(o);goog.loadedModules_[r]=o}finally{goog.moduleLoaderState_=t}};goog.loadModuleFromSource_=function(){"use strict";var exports={};eval(arguments[0]);return exports};goog.normalizePath_=function(e){for(var t=e.split("/"),o=0;o<t.length;)"."==t[o]?t.splice(o,1):o&&".."==t[o]&&t[o-1]&&".."!=t[o-1]?t.splice(--o,2):o++;return t.join("/")};goog.global.CLOSURE_LOAD_FILE_SYNC;goog.loadFileSync_=function(e){if(goog.global.CLOSURE_LOAD_FILE_SYNC)return goog.global.CLOSURE_LOAD_FILE_SYNC(e);try{var t=new goog.global.XMLHttpRequest;t.open("get",e,!1);t.send();return 0==t.status||200==t.status?t.responseText:null}catch(e){return null}};goog.retrieveAndExec_=function(e,t,o){if(!COMPILED){var r=e;e=goog.normalizePath_(e);var i=goog.global.CLOSURE_IMPORT_SCRIPT||goog.writeScriptTag_,n=goog.loadFileSync_(e);if(null==n)throw new Error('Load of "'+e+'" failed');o&&(n=goog.transpile_.call(goog.global,n,e));t?n=goog.wrapModule_(e,n):n+="\n//# sourceURL="+e;if(goog.IS_OLD_IE_&&goog.oldIeWaiting_){goog.dependencies_.deferred[r]=n;goog.queuedModules_.push(r)}else i(e,n)}};goog.transpile_=function(code,path){var jscomp=goog.global.$jscomp;jscomp||(goog.global.$jscomp=jscomp={});var transpile=jscomp.transpile;if(!transpile){var transpilerPath=goog.basePath+goog.TRANSPILER,transpilerCode=goog.loadFileSync_(transpilerPath);if(transpilerCode){eval(transpilerCode+"\n//# sourceURL="+transpilerPath);if(goog.global.$gwtExport&&goog.global.$gwtExport.$jscomp&&!goog.global.$gwtExport.$jscomp.transpile)throw new Error('The transpiler did not properly export the "transpile" method. $gwtExport: '+JSON.stringify(goog.global.$gwtExport));goog.global.$jscomp.transpile=goog.global.$gwtExport.$jscomp.transpile;jscomp=goog.global.$jscomp;transpile=jscomp.transpile}}if(!transpile){var suffix=" requires transpilation but no transpiler was found.";transpile=jscomp.transpile=function(e,t){goog.logToConsole_(t+suffix);return e}}return transpile(code,path)};goog.typeOf=function(e){var t=typeof e;if("object"==t){if(!e)return"null";if(e instanceof Array)return"array";if(e instanceof Object)return t;var o=Object.prototype.toString.call(e);if("[object Window]"==o)return"object";if("[object Array]"==o||"number"==typeof e.length&&void 0!==e.splice&&void 0!==e.propertyIsEnumerable&&!e.propertyIsEnumerable("splice"))return"array";if("[object Function]"==o||void 0!==e.call&&void 0!==e.propertyIsEnumerable&&!e.propertyIsEnumerable("call"))return"function"}else if("function"==t&&void 0===e.call)return"object";return t};goog.isNull=function(e){return null===e};goog.isDefAndNotNull=function(e){return null!=e};goog.isArray=function(e){return"array"==goog.typeOf(e)};goog.isArrayLike=function(e){var t=goog.typeOf(e);return"array"==t||"object"==t&&"number"==typeof e.length};goog.isDateLike=function(e){return goog.isObject(e)&&"function"==typeof e.getFullYear};goog.isFunction=function(e){return"function"==goog.typeOf(e)};goog.isObject=function(e){var t=typeof e;return"object"==t&&null!=e||"function"==t};goog.getUid=function(e){return e[goog.UID_PROPERTY_]||(e[goog.UID_PROPERTY_]=++goog.uidCounter_)};goog.hasUid=function(e){return!!e[goog.UID_PROPERTY_]};goog.removeUid=function(e){null!==e&&"removeAttribute"in e&&e.removeAttribute(goog.UID_PROPERTY_);try{delete e[goog.UID_PROPERTY_]}catch(e){}};goog.UID_PROPERTY_="closure_uid_"+(1e9*Math.random()>>>0);goog.uidCounter_=0;goog.getHashCode=goog.getUid;goog.removeHashCode=goog.removeUid;goog.cloneObject=function(e){var t=goog.typeOf(e);if("object"==t||"array"==t){if(e.clone)return e.clone();var o="array"==t?[]:{};for(var r in e)o[r]=goog.cloneObject(e[r]);return o}return e};goog.bindNative_=function(e,t,o){return e.call.apply(e.bind,arguments)};goog.bindJs_=function(e,t,o){if(!e)throw new Error;if(arguments.length>2){var r=Array.prototype.slice.call(arguments,2);return function(){var o=Array.prototype.slice.call(arguments);Array.prototype.unshift.apply(o,r);return e.apply(t,o)}}return function(){return e.apply(t,arguments)}};goog.bind=function(e,t,o){Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?goog.bind=goog.bindNative_:goog.bind=goog.bindJs_;return goog.bind.apply(null,arguments)};goog.partial=function(e,t){var o=Array.prototype.slice.call(arguments,1);return function(){var t=o.slice();t.push.apply(t,arguments);return e.apply(this,t)}};goog.mixin=function(e,t){for(var o in t)e[o]=t[o]};goog.now=goog.TRUSTED_SITE&&Date.now||function(){return+new Date};goog.globalEval=function(e){if(goog.global.execScript)goog.global.execScript(e,"JavaScript");else{if(!goog.global.eval)throw new Error("goog.globalEval not available");if(null==goog.evalWorksForGlobals_){goog.global.eval("var _evalTest_ = 1;");if(void 0!==goog.global._evalTest_){try{delete goog.global._evalTest_}catch(e){}goog.evalWorksForGlobals_=!0}else goog.evalWorksForGlobals_=!1}if(goog.evalWorksForGlobals_)goog.global.eval(e);else{var t=goog.global.document,o=t.createElement("SCRIPT");o.type="text/javascript";o.defer=!1;o.appendChild(t.createTextNode(e));t.body.appendChild(o);t.body.removeChild(o)}}};goog.evalWorksForGlobals_=null;goog.cssNameMapping_;goog.cssNameMappingStyle_;goog.global.CLOSURE_CSS_NAME_MAP_FN;goog.getCssName=function(e,t){if("."==String(e).charAt(0))throw new Error('className passed in goog.getCssName must not start with ".". You passed: '+e);var o,r=function(e){return goog.cssNameMapping_[e]||e};o=goog.cssNameMapping_?"BY_WHOLE"==goog.cssNameMappingStyle_?r:function(e){for(var t=e.split("-"),o=[],i=0;i<t.length;i++)o.push(r(t[i]));return o.join("-")}:function(e){return e};var i=t?e+"-"+o(t):o(e);return goog.global.CLOSURE_CSS_NAME_MAP_FN?goog.global.CLOSURE_CSS_NAME_MAP_FN(i):i};goog.setCssNameMapping=function(e,t){goog.cssNameMapping_=e;goog.cssNameMappingStyle_=t};goog.global.CLOSURE_CSS_NAME_MAPPING;!COMPILED&&goog.global.CLOSURE_CSS_NAME_MAPPING&&(goog.cssNameMapping_=goog.global.CLOSURE_CSS_NAME_MAPPING);goog.getMsg=function(e,t){t&&(e=e.replace(/\{\$([^}]+)}/g,function(e,o){return null!=t&&o in t?t[o]:e}));return e};goog.getMsgWithFallback=function(e,t){return e};goog.exportSymbol=function(e,t,o){goog.exportPath_(e,t,o)};goog.exportProperty=function(e,t,o){e[t]=o};goog.inherits=function(e,t){function o(){}o.prototype=t.prototype;e.superClass_=t.prototype;e.prototype=new o;e.prototype.constructor=e;e.base=function(e,o,r){for(var i=new Array(arguments.length-2),n=2;n<arguments.length;n++)i[n-2]=arguments[n];return t.prototype[o].apply(e,i)}};goog.base=function(e,t,o){var r=arguments.callee.caller;if(goog.STRICT_MODE_COMPATIBLE||goog.DEBUG&&!r)throw new Error("arguments.caller not defined.  goog.base() cannot be used with strict mode code. See http://www.ecma-international.org/ecma-262/5.1/#sec-C");if(r.superClass_){for(var i=new Array(arguments.length-1),n=1;n<arguments.length;n++)i[n-1]=arguments[n];return r.superClass_.constructor.apply(e,i)}var a=new Array(arguments.length-2);for(n=2;n<arguments.length;n++)a[n-2]=arguments[n];for(var l=!1,s=e.constructor;s;s=s.superClass_&&s.superClass_.constructor)if(s.prototype[t]===r)l=!0;else if(l)return s.prototype[t].apply(e,a);if(e[t]===r)return e.constructor.prototype[t].apply(e,a);throw new Error("goog.base called from a method of one name to a method of a different name")};goog.scope=function(e){if(goog.isInModuleLoader_())throw new Error("goog.scope is not supported within a goog.module.");e.call(goog.global)};COMPILED||(goog.global.COMPILED=COMPILED);goog.defineClass=function(e,t){var o=t.constructor,r=t.statics;o&&o!=Object.prototype.constructor||(o=function(){throw new Error("cannot instantiate an interface (no constructor defined).")});var i=goog.defineClass.createSealingConstructor_(o,e);e&&goog.inherits(i,e);delete t.constructor;delete t.statics;goog.defineClass.applyProperties_(i.prototype,t);null!=r&&(r instanceof Function?r(i):goog.defineClass.applyProperties_(i,r));return i};goog.defineClass.ClassDescriptor;goog.define("goog.defineClass.SEAL_CLASS_INSTANCES",goog.DEBUG);goog.defineClass.createSealingConstructor_=function(e,t){if(!goog.defineClass.SEAL_CLASS_INSTANCES)return e;var o=!goog.defineClass.isUnsealable_(t),r=function(){var t=e.apply(this,arguments)||this;t[goog.UID_PROPERTY_]=t[goog.UID_PROPERTY_];this.constructor===r&&o&&Object.seal instanceof Function&&Object.seal(t);return t};return r};goog.defineClass.isUnsealable_=function(e){return e&&e.prototype&&e.prototype[goog.UNSEALABLE_CONSTRUCTOR_PROPERTY_]};goog.defineClass.OBJECT_PROTOTYPE_FIELDS_=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"];goog.defineClass.applyProperties_=function(e,t){var o;for(o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);for(var r=0;r<goog.defineClass.OBJECT_PROTOTYPE_FIELDS_.length;r++){o=goog.defineClass.OBJECT_PROTOTYPE_FIELDS_[r];Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}};goog.tagUnsealableClass=function(e){!COMPILED&&goog.defineClass.SEAL_CLASS_INSTANCES&&(e.prototype[goog.UNSEALABLE_CONSTRUCTOR_PROPERTY_]=!0)};goog.UNSEALABLE_CONSTRUCTOR_PROPERTY_="goog_defineClass_legacy_unsealable";goog.createRequiresTranspilation_=function(){var requiresTranspilation={es3:!1},transpilationRequiredForAllLaterModes=!1;function addNewerLanguageTranspilationCheck(e,t){if(transpilationRequiredForAllLaterModes)requiresTranspilation[e]=!0;else if(t())requiresTranspilation[e]=!1;else{requiresTranspilation[e]=!0;transpilationRequiredForAllLaterModes=!0}}function evalCheck(code){try{return!!eval(code)}catch(e){return!1}}var userAgent=goog.global.navigator&&goog.global.navigator.userAgent?goog.global.navigator.userAgent:"";addNewerLanguageTranspilationCheck("es5",function(){return evalCheck("[1,].length==1")});addNewerLanguageTranspilationCheck("es6",function(){var e=userAgent.match(/Edge\/(\d+)(\.\d)*/i);if(e&&Number(e[1])<15)return!1;return evalCheck('(()=>{"use strict";class X{constructor(){if(new.target!=String)throw 1;this.x=42}}let q=Reflect.construct(X,[],String);if(q.x!=42||!(q instanceof String))throw 1;for(const a of[2,3]){if(a==2)continue;function f(z={a}){let a=0;return z.a}{function f(){return 0;}}return f()==3}})()')});addNewerLanguageTranspilationCheck("es6-impl",function(){return!0});addNewerLanguageTranspilationCheck("es7",function(){return evalCheck("2 ** 2 == 4")});addNewerLanguageTranspilationCheck("es8",function(){return evalCheck("async () => 1, true")});return requiresTranspilation};goog.provide("ol.array");ol.array.binarySearch=function(e,t,o){for(var r,i,n=o||ol.array.numberSafeCompareFunction,a=0,l=e.length,s=!1;a<l;)if((i=+n(e[r=a+(l-a>>1)],t))<0)a=r+1;else{l=r;s=!i}return s?a:~a};ol.array.numberSafeCompareFunction=function(e,t){return e>t?1:e<t?-1:0};ol.array.includes=function(e,t){return e.indexOf(t)>=0};ol.array.linearFindNearest=function(e,t,o){var r,i=e.length;if(e[0]<=t)return 0;if(t<=e[i-1])return i-1;if(o>0){for(r=1;r<i;++r)if(e[r]<t)return r-1}else if(o<0){for(r=1;r<i;++r)if(e[r]<=t)return r}else for(r=1;r<i;++r){if(e[r]==t)return r;if(e[r]<t)return e[r-1]-t<t-e[r]?r-1:r}return i-1};ol.array.reverseSubArray=function(e,t,o){for(;t<o;){var r=e[t];e[t]=e[o];e[o]=r;++t;--o}};ol.array.extend=function(e,t){var o,r=Array.isArray(t)?t:[t],i=r.length;for(o=0;o<i;o++)e[e.length]=r[o]};ol.array.remove=function(e,t){var o=e.indexOf(t),r=o>-1;r&&e.splice(o,1);return r};ol.array.find=function(e,t){for(var o,r=e.length>>>0,i=0;i<r;i++)if(t(o=e[i],i,e))return o;return null};ol.array.equals=function(e,t){var o=e.length;if(o!==t.length)return!1;for(var r=0;r<o;r++)if(e[r]!==t[r])return!1;return!0};ol.array.stableSort=function(e,t){var o,r=e.length,i=Array(e.length);for(o=0;o<r;o++)i[o]={index:o,value:e[o]};i.sort(function(e,o){return t(e.value,o.value)||e.index-o.index});for(o=0;o<e.length;o++)e[o]=i[o].value};ol.array.findIndex=function(e,t){var o;return!e.every(function(r,i){o=i;return!t(r,i,e)})?o:-1};ol.array.isSorted=function(e,t,o){var r=t||ol.array.numberSafeCompareFunction;return e.every(function(t,i){if(0===i)return!0;var n=r(e[i-1],t);return!(n>0||o&&0===n)})};goog.provide("ol");ol.ASSUME_TOUCH=!1;ol.DEFAULT_MAX_ZOOM=42;ol.DEFAULT_MIN_ZOOM=0;ol.DEFAULT_RASTER_REPROJECTION_ERROR_THRESHOLD=.5;ol.DEFAULT_TILE_SIZE=256;ol.DEFAULT_WMS_VERSION="1.3.0";ol.ENABLE_CANVAS=!0;ol.ENABLE_PROJ4JS=!0;ol.ENABLE_RASTER_REPROJECTION=!0;ol.ENABLE_WEBGL=!0;ol.DEBUG_WEBGL=!0;ol.INITIAL_ATLAS_SIZE=256;ol.MAX_ATLAS_SIZE=-1;ol.MOUSEWHEELZOOM_MAXDELTA=1;ol.OVERVIEWMAP_MAX_RATIO=.75;ol.OVERVIEWMAP_MIN_RATIO=.1;ol.RASTER_REPROJECTION_MAX_SOURCE_TILES=100;ol.RASTER_REPROJECTION_MAX_SUBDIVISION=10;ol.RASTER_REPROJECTION_MAX_TRIANGLE_WIDTH=.25;ol.SIMPLIFY_TOLERANCE=.5;ol.WEBGL_TEXTURE_CACHE_HIGH_WATER_MARK=1024;ol.VERSION="";ol.WEBGL_MAX_TEXTURE_SIZE;ol.WEBGL_EXTENSIONS;ol.inherits=function(e,t){e.prototype=Object.create(t.prototype);e.prototype.constructor=e};ol.nullFunction=function(){};ol.getUid=function(e){return e.ol_uid||(e.ol_uid=++ol.uidCounter_)};ol.uidCounter_=0;goog.provide("ol.AssertionError");goog.require("ol");ol.AssertionError=function(e){var t=ol.VERSION?ol.VERSION.split("-")[0]:"latest";this.message="Assertion failed. See https://openlayers.org/en/"+t+"/doc/errors/#"+e+" for details.";this.code=e;this.name="AssertionError"};ol.inherits(ol.AssertionError,Error);goog.provide("ol.asserts");goog.require("ol.AssertionError");ol.asserts.assert=function(e,t){if(!e)throw new ol.AssertionError(t)};goog.provide("ol.TileRange");ol.TileRange=function(e,t,o,r){this.minX=e;this.maxX=t;this.minY=o;this.maxY=r};ol.TileRange.createOrUpdate=function(e,t,o,r,i){if(void 0!==i){i.minX=e;i.maxX=t;i.minY=o;i.maxY=r;return i}return new ol.TileRange(e,t,o,r)};ol.TileRange.prototype.contains=function(e){return this.containsXY(e[1],e[2])};ol.TileRange.prototype.containsTileRange=function(e){return this.minX<=e.minX&&e.maxX<=this.maxX&&this.minY<=e.minY&&e.maxY<=this.maxY};ol.TileRange.prototype.containsXY=function(e,t){return this.minX<=e&&e<=this.maxX&&this.minY<=t&&t<=this.maxY};ol.TileRange.prototype.equals=function(e){return this.minX==e.minX&&this.minY==e.minY&&this.maxX==e.maxX&&this.maxY==e.maxY};ol.TileRange.prototype.extend=function(e){e.minX<this.minX&&(this.minX=e.minX);e.maxX>this.maxX&&(this.maxX=e.maxX);e.minY<this.minY&&(this.minY=e.minY);e.maxY>this.maxY&&(this.maxY=e.maxY)};ol.TileRange.prototype.getHeight=function(){return this.maxY-this.minY+1};ol.TileRange.prototype.getSize=function(){return[this.getWidth(),this.getHeight()]};ol.TileRange.prototype.getWidth=function(){return this.maxX-this.minX+1};ol.TileRange.prototype.intersects=function(e){return this.minX<=e.maxX&&this.maxX>=e.minX&&this.minY<=e.maxY&&this.maxY>=e.minY};goog.provide("ol.math");goog.require("ol.asserts");ol.math.clamp=function(e,t,o){return Math.min(Math.max(e,t),o)};ol.math.cosh="cosh"in Math?Math.cosh:function(e){var t=Math.exp(e);return(t+1/t)/2};ol.math.roundUpToPowerOfTwo=function(e){ol.asserts.assert(0<e,29);return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))};ol.math.squaredSegmentDistance=function(e,t,o,r,i,n){var a=i-o,l=n-r;if(0!==a||0!==l){var s=((e-o)*a+(t-r)*l)/(a*a+l*l);if(s>1){o=i;r=n}else if(s>0){o+=a*s;r+=l*s}}return ol.math.squaredDistance(e,t,o,r)};ol.math.squaredDistance=function(e,t,o,r){var i=o-e,n=r-t;return i*i+n*n};ol.math.solveLinearSystem=function(e){for(var t=e.length,o=0;o<t;o++){for(var r=o,i=Math.abs(e[o][o]),n=o+1;n<t;n++){var a=Math.abs(e[n][o]);if(a>i){i=a;r=n}}if(0===i)return null;var l=e[r];e[r]=e[o];e[o]=l;for(var s=o+1;s<t;s++)for(var p=-e[s][o]/e[o][o],c=o;c<t+1;c++)o==c?e[s][c]=0:e[s][c]+=p*e[o][c]}for(var u=new Array(t),g=t-1;g>=0;g--){u[g]=e[g][t]/e[g][g];for(var d=g-1;d>=0;d--)e[d][t]-=e[d][g]*u[g]}return u};ol.math.toDegrees=function(e){return 180*e/Math.PI};ol.math.toRadians=function(e){return e*Math.PI/180};ol.math.modulo=function(e,t){var o=e%t;return o*t<0?o+t:o};ol.math.lerp=function(e,t,o){return e+o*(t-e)};goog.provide("ol.size");ol.size.buffer=function(e,t,o){void 0===o&&(o=[0,0]);o[0]=e[0]+2*t;o[1]=e[1]+2*t;return o};ol.size.hasArea=function(e){return e[0]>0&&e[1]>0};ol.size.scale=function(e,t,o){void 0===o&&(o=[0,0]);o[0]=e[0]*t+.5|0;o[1]=e[1]*t+.5|0;return o};ol.size.toSize=function(e,t){if(Array.isArray(e))return e;void 0===t?t=[e,e]:t[0]=t[1]=e;return t};goog.provide("ol.extent.Corner");ol.extent.Corner={BOTTOM_LEFT:"bottom-left",BOTTOM_RIGHT:"bottom-right",TOP_LEFT:"top-left",TOP_RIGHT:"top-right"};goog.provide("ol.extent.Relationship");ol.extent.Relationship={UNKNOWN:0,INTERSECTING:1,ABOVE:2,RIGHT:4,BELOW:8,LEFT:16};goog.provide("ol.extent");goog.require("ol.asserts");goog.require("ol.extent.Corner");goog.require("ol.extent.Relationship");ol.extent.boundingExtent=function(e){for(var t=ol.extent.createEmpty(),o=0,r=e.length;o<r;++o)ol.extent.extendCoordinate(t,e[o]);return t};ol.extent.boundingExtentXYs_=function(e,t,o){var r=Math.min.apply(null,e),i=Math.min.apply(null,t),n=Math.max.apply(null,e),a=Math.max.apply(null,t);return ol.extent.createOrUpdate(r,i,n,a,o)};ol.extent.buffer=function(e,t,o){if(o){o[0]=e[0]-t;o[1]=e[1]-t;o[2]=e[2]+t;o[3]=e[3]+t;return o}return[e[0]-t,e[1]-t,e[2]+t,e[3]+t]};ol.extent.clone=function(e,t){if(t){t[0]=e[0];t[1]=e[1];t[2]=e[2];t[3]=e[3];return t}return e.slice()};ol.extent.closestSquaredDistanceXY=function(e,t,o){var r,i;return(r=t<e[0]?e[0]-t:e[2]<t?t-e[2]:0)*r+(i=o<e[1]?e[1]-o:e[3]<o?o-e[3]:0)*i};ol.extent.containsCoordinate=function(e,t){return ol.extent.containsXY(e,t[0],t[1])};ol.extent.containsExtent=function(e,t){return e[0]<=t[0]&&t[2]<=e[2]&&e[1]<=t[1]&&t[3]<=e[3]};ol.extent.containsXY=function(e,t,o){return e[0]<=t&&t<=e[2]&&e[1]<=o&&o<=e[3]};ol.extent.coordinateRelationship=function(e,t){var o=e[0],r=e[1],i=e[2],n=e[3],a=t[0],l=t[1],s=ol.extent.Relationship.UNKNOWN;a<o?s|=ol.extent.Relationship.LEFT:a>i&&(s|=ol.extent.Relationship.RIGHT);l<r?s|=ol.extent.Relationship.BELOW:l>n&&(s|=ol.extent.Relationship.ABOVE);s===ol.extent.Relationship.UNKNOWN&&(s=ol.extent.Relationship.INTERSECTING);return s};ol.extent.createEmpty=function(){return[1/0,1/0,-1/0,-1/0]};ol.extent.createOrUpdate=function(e,t,o,r,i){if(i){i[0]=e;i[1]=t;i[2]=o;i[3]=r;return i}return[e,t,o,r]};ol.extent.createOrUpdateEmpty=function(e){return ol.extent.createOrUpdate(1/0,1/0,-1/0,-1/0,e)};ol.extent.createOrUpdateFromCoordinate=function(e,t){var o=e[0],r=e[1];return ol.extent.createOrUpdate(o,r,o,r,t)};ol.extent.createOrUpdateFromCoordinates=function(e,t){var o=ol.extent.createOrUpdateEmpty(t);return ol.extent.extendCoordinates(o,e)};ol.extent.createOrUpdateFromFlatCoordinates=function(e,t,o,r,i){var n=ol.extent.createOrUpdateEmpty(i);return ol.extent.extendFlatCoordinates(n,e,t,o,r)};ol.extent.createOrUpdateFromRings=function(e,t){var o=ol.extent.createOrUpdateEmpty(t);return ol.extent.extendRings(o,e)};ol.extent.equals=function(e,t){return e[0]==t[0]&&e[2]==t[2]&&e[1]==t[1]&&e[3]==t[3]};ol.extent.extend=function(e,t){t[0]<e[0]&&(e[0]=t[0]);t[2]>e[2]&&(e[2]=t[2]);t[1]<e[1]&&(e[1]=t[1]);t[3]>e[3]&&(e[3]=t[3]);return e};ol.extent.extendCoordinate=function(e,t){t[0]<e[0]&&(e[0]=t[0]);t[0]>e[2]&&(e[2]=t[0]);t[1]<e[1]&&(e[1]=t[1]);t[1]>e[3]&&(e[3]=t[1])};ol.extent.extendCoordinates=function(e,t){var o,r;for(o=0,r=t.length;o<r;++o)ol.extent.extendCoordinate(e,t[o]);return e};ol.extent.extendFlatCoordinates=function(e,t,o,r,i){for(;o<r;o+=i)ol.extent.extendXY(e,t[o],t[o+1]);return e};ol.extent.extendRings=function(e,t){var o,r;for(o=0,r=t.length;o<r;++o)ol.extent.extendCoordinates(e,t[o]);return e};ol.extent.extendXY=function(e,t,o){e[0]=Math.min(e[0],t);e[1]=Math.min(e[1],o);e[2]=Math.max(e[2],t);e[3]=Math.max(e[3],o)};ol.extent.forEachCorner=function(e,t,o){var r;return(r=t.call(o,ol.extent.getBottomLeft(e)))?r:(r=t.call(o,ol.extent.getBottomRight(e)))?r:(r=t.call(o,ol.extent.getTopRight(e)))?r:(r=t.call(o,ol.extent.getTopLeft(e)))||!1};ol.extent.getArea=function(e){var t=0;ol.extent.isEmpty(e)||(t=ol.extent.getWidth(e)*ol.extent.getHeight(e));return t};ol.extent.getBottomLeft=function(e){return[e[0],e[1]]};ol.extent.getBottomRight=function(e){return[e[2],e[1]]};ol.extent.getCenter=function(e){return[(e[0]+e[2])/2,(e[1]+e[3])/2]};ol.extent.getCorner=function(e,t){var o;t===ol.extent.Corner.BOTTOM_LEFT?o=ol.extent.getBottomLeft(e):t===ol.extent.Corner.BOTTOM_RIGHT?o=ol.extent.getBottomRight(e):t===ol.extent.Corner.TOP_LEFT?o=ol.extent.getTopLeft(e):t===ol.extent.Corner.TOP_RIGHT?o=ol.extent.getTopRight(e):ol.asserts.assert(!1,13);return o};ol.extent.getEnlargedArea=function(e,t){var o=Math.min(e[0],t[0]),r=Math.min(e[1],t[1]);return(Math.max(e[2],t[2])-o)*(Math.max(e[3],t[3])-r)};ol.extent.getForViewAndSize=function(e,t,o,r,i){var n=t*r[0]/2,a=t*r[1]/2,l=Math.cos(o),s=Math.sin(o),p=n*l,c=n*s,u=a*l,g=a*s,d=e[0],h=e[1],f=d-p+g,y=d-p-g,m=d+p-g,v=d+p+g,C=h-c-u,T=h-c+u,S=h+c+u,_=h+c-u;return ol.extent.createOrUpdate(Math.min(f,y,m,v),Math.min(C,T,S,_),Math.max(f,y,m,v),Math.max(C,T,S,_),i)};ol.extent.getHeight=function(e){return e[3]-e[1]};ol.extent.getIntersectionArea=function(e,t){var o=ol.extent.getIntersection(e,t);return ol.extent.getArea(o)};ol.extent.getIntersection=function(e,t,o){var r=o||ol.extent.createEmpty();if(ol.extent.intersects(e,t)){e[0]>t[0]?r[0]=e[0]:r[0]=t[0];e[1]>t[1]?r[1]=e[1]:r[1]=t[1];e[2]<t[2]?r[2]=e[2]:r[2]=t[2];e[3]<t[3]?r[3]=e[3]:r[3]=t[3]}return r};ol.extent.getMargin=function(e){return ol.extent.getWidth(e)+ol.extent.getHeight(e)};ol.extent.getSize=function(e){return[e[2]-e[0],e[3]-e[1]]};ol.extent.getTopLeft=function(e){return[e[0],e[3]]};ol.extent.getTopRight=function(e){return[e[2],e[3]]};ol.extent.getWidth=function(e){return e[2]-e[0]};ol.extent.intersects=function(e,t){return e[0]<=t[2]&&e[2]>=t[0]&&e[1]<=t[3]&&e[3]>=t[1]};ol.extent.isEmpty=function(e){return e[2]<e[0]||e[3]<e[1]};ol.extent.returnOrUpdate=function(e,t){if(t){t[0]=e[0];t[1]=e[1];t[2]=e[2];t[3]=e[3];return t}return e};ol.extent.scaleFromCenter=function(e,t){var o=(e[2]-e[0])/2*(t-1),r=(e[3]-e[1])/2*(t-1);e[0]-=o;e[2]+=o;e[1]-=r;e[3]+=r};ol.extent.intersectsSegment=function(e,t,o){var r=!1,i=ol.extent.coordinateRelationship(e,t),n=ol.extent.coordinateRelationship(e,o);if(i===ol.extent.Relationship.INTERSECTING||n===ol.extent.Relationship.INTERSECTING)r=!0;else{var a,l,s=e[0],p=e[1],c=e[2],u=e[3],g=t[0],d=t[1],h=o[0],f=o[1],y=(f-d)/(h-g);n&ol.extent.Relationship.ABOVE&&!(i&ol.extent.Relationship.ABOVE)&&(r=(a=h-(f-u)/y)>=s&&a<=c);r||!(n&ol.extent.Relationship.RIGHT)||i&ol.extent.Relationship.RIGHT||(r=(l=f-(h-c)*y)>=p&&l<=u);r||!(n&ol.extent.Relationship.BELOW)||i&ol.extent.Relationship.BELOW||(r=(a=h-(f-p)/y)>=s&&a<=c);r||!(n&ol.extent.Relationship.LEFT)||i&ol.extent.Relationship.LEFT||(r=(l=f-(h-s)*y)>=p&&l<=u)}return r};ol.extent.applyTransform=function(e,t,o){var r=[e[0],e[1],e[0],e[3],e[2],e[1],e[2],e[3]];t(r,r,2);var i=[r[0],r[2],r[4],r[6]],n=[r[1],r[3],r[5],r[7]];return ol.extent.boundingExtentXYs_(i,n,o)};goog.provide("ol.obj");ol.obj.assign="function"==typeof Object.assign?Object.assign:function(e,t){if(void 0===e||null===e)throw new TypeError("Cannot convert undefined or null to object");for(var o=Object(e),r=1,i=arguments.length;r<i;++r){var n=arguments[r];if(void 0!==n&&null!==n)for(var a in n)n.hasOwnProperty(a)&&(o[a]=n[a])}return o};ol.obj.clear=function(e){for(var t in e)delete e[t]};ol.obj.getValues=function(e){var t=[];for(var o in e)t.push(e[o]);return t};ol.obj.isEmpty=function(e){var t;for(t in e)return!1;return!t};goog.provide("ol.geom.GeometryType");ol.geom.GeometryType={POINT:"Point",LINE_STRING:"LineString",LINEAR_RING:"LinearRing",POLYGON:"Polygon",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon",GEOMETRY_COLLECTION:"GeometryCollection",CIRCLE:"Circle"};goog.provide("ol.Sphere");goog.require("ol.math");goog.require("ol.geom.GeometryType");ol.Sphere=function(e){this.radius=e};ol.Sphere.prototype.geodesicArea=function(e){return ol.Sphere.getArea_(e,this.radius)};ol.Sphere.prototype.haversineDistance=function(e,t){return ol.Sphere.getDistance_(e,t,this.radius)};ol.Sphere.prototype.offset=function(e,t,o){var r=ol.math.toRadians(e[1]),i=ol.math.toRadians(e[0]),n=t/this.radius,a=Math.asin(Math.sin(r)*Math.cos(n)+Math.cos(r)*Math.sin(n)*Math.cos(o)),l=i+Math.atan2(Math.sin(o)*Math.sin(n)*Math.cos(r),Math.cos(n)-Math.sin(r)*Math.sin(a));return[ol.math.toDegrees(l),ol.math.toDegrees(a)]};ol.Sphere.DEFAULT_RADIUS=6371008.8;ol.Sphere.getLength=function(e,t){var o,r,i,n,a,l,s=t||{},p=s.radius||ol.Sphere.DEFAULT_RADIUS,c=s.projection||"EPSG:3857",u=(e=e.clone().transform(c,"EPSG:4326")).getType(),g=0;switch(u){case ol.geom.GeometryType.POINT:case ol.geom.GeometryType.MULTI_POINT:break;case ol.geom.GeometryType.LINE_STRING:case ol.geom.GeometryType.LINEAR_RING:o=e.getCoordinates();g=ol.Sphere.getLength_(o,p);break;case ol.geom.GeometryType.MULTI_LINE_STRING:case ol.geom.GeometryType.POLYGON:for(i=0,n=(o=e.getCoordinates()).length;i<n;++i)g+=ol.Sphere.getLength_(o[i],p);break;case ol.geom.GeometryType.MULTI_POLYGON:for(i=0,n=(o=e.getCoordinates()).length;i<n;++i)for(a=0,l=(r=o[i]).length;a<l;++a)g+=ol.Sphere.getLength_(r[a],p);break;case ol.geom.GeometryType.GEOMETRY_COLLECTION:var d=e.getGeometries();for(i=0,n=d.length;i<n;++i)g+=ol.Sphere.getLength(d[i],t);break;default:throw new Error("Unsupported geometry type: "+u)}return g};ol.Sphere.getLength_=function(e,t){for(var o=0,r=0,i=e.length;r<i-1;++r)o+=ol.Sphere.getDistance_(e[r],e[r+1],t);return o};ol.Sphere.getDistance_=function(e,t,o){var r=ol.math.toRadians(e[1]),i=ol.math.toRadians(t[1]),n=(i-r)/2,a=ol.math.toRadians(t[0]-e[0])/2,l=Math.sin(n)*Math.sin(n)+Math.sin(a)*Math.sin(a)*Math.cos(r)*Math.cos(i);return 2*o*Math.atan2(Math.sqrt(l),Math.sqrt(1-l))};ol.Sphere.getArea=function(e,t){var o,r,i,n,a,l,s=t||{},p=s.radius||ol.Sphere.DEFAULT_RADIUS,c=s.projection||"EPSG:3857",u=(e=e.clone().transform(c,"EPSG:4326")).getType(),g=0;switch(u){case ol.geom.GeometryType.POINT:case ol.geom.GeometryType.MULTI_POINT:case ol.geom.GeometryType.LINE_STRING:case ol.geom.GeometryType.MULTI_LINE_STRING:case ol.geom.GeometryType.LINEAR_RING:break;case ol.geom.GeometryType.POLYGON:o=e.getCoordinates();g=Math.abs(ol.Sphere.getArea_(o[0],p));for(i=1,n=o.length;i<n;++i)g-=Math.abs(ol.Sphere.getArea_(o[i],p));break;case ol.geom.GeometryType.MULTI_POLYGON:for(i=0,n=(o=e.getCoordinates()).length;i<n;++i){r=o[i];g+=Math.abs(ol.Sphere.getArea_(r[0],p));for(a=1,l=r.length;a<l;++a)g-=Math.abs(ol.Sphere.getArea_(r[a],p))}break;case ol.geom.GeometryType.GEOMETRY_COLLECTION:var d=e.getGeometries();for(i=0,n=d.length;i<n;++i)g+=ol.Sphere.getArea(d[i],t);break;default:throw new Error("Unsupported geometry type: "+u)}return g};ol.Sphere.getArea_=function(e,t){for(var o=0,r=e.length,i=e[r-1][0],n=e[r-1][1],a=0;a<r;a++){var l=e[a][0],s=e[a][1];o+=ol.math.toRadians(l-i)*(2+Math.sin(ol.math.toRadians(n))+Math.sin(ol.math.toRadians(s)));i=l;n=s}return o*t*t/2};goog.provide("ol.proj.Units");ol.proj.Units={DEGREES:"degrees",FEET:"ft",METERS:"m",PIXELS:"pixels",TILE_PIXELS:"tile-pixels",USFEET:"us-ft"};ol.proj.Units.METERS_PER_UNIT={};ol.proj.Units.METERS_PER_UNIT[ol.proj.Units.DEGREES]=2*Math.PI*6370997/360;ol.proj.Units.METERS_PER_UNIT[ol.proj.Units.FEET]=.3048;ol.proj.Units.METERS_PER_UNIT[ol.proj.Units.METERS]=1;ol.proj.Units.METERS_PER_UNIT[ol.proj.Units.USFEET]=1200/3937;goog.provide("ol.proj.proj4");ol.proj.proj4.cache_=null;ol.proj.proj4.set=function(e){ol.proj.proj4.cache_=e};ol.proj.proj4.get=function(){return ol.proj.proj4.cache_||window.proj4};goog.provide("ol.proj.Projection");goog.require("ol");goog.require("ol.proj.Units");goog.require("ol.proj.proj4");ol.proj.Projection=function(e){this.code_=e.code;this.units_=e.units;this.extent_=void 0!==e.extent?e.extent:null;this.worldExtent_=void 0!==e.worldExtent?e.worldExtent:null;this.axisOrientation_=void 0!==e.axisOrientation?e.axisOrientation:"enu";this.global_=void 0!==e.global&&e.global;this.canWrapX_=!(!this.global_||!this.extent_);this.getPointResolutionFunc_=e.getPointResolution;this.defaultTileGrid_=null;this.metersPerUnit_=e.metersPerUnit;var t=e.code;if(ol.ENABLE_PROJ4JS){var o=ol.proj.proj4.get();if("function"==typeof o){var r=o.defs(t);if(void 0!==r){void 0!==r.axis&&void 0===e.axisOrientation&&(this.axisOrientation_=r.axis);void 0===e.metersPerUnit&&(this.metersPerUnit_=r.to_meter);void 0===e.units&&(this.units_=r.units)}}}};ol.proj.Projection.prototype.canWrapX=function(){return this.canWrapX_};ol.proj.Projection.prototype.getCode=function(){return this.code_};ol.proj.Projection.prototype.getExtent=function(){return this.extent_};ol.proj.Projection.prototype.getUnits=function(){return this.units_};ol.proj.Projection.prototype.getMetersPerUnit=function(){return this.metersPerUnit_||ol.proj.Units.METERS_PER_UNIT[this.units_]};ol.proj.Projection.prototype.getWorldExtent=function(){return this.worldExtent_};ol.proj.Projection.prototype.getAxisOrientation=function(){return this.axisOrientation_};ol.proj.Projection.prototype.isGlobal=function(){return this.global_};ol.proj.Projection.prototype.setGlobal=function(e){this.global_=e;this.canWrapX_=!(!e||!this.extent_)};ol.proj.Projection.prototype.getDefaultTileGrid=function(){return this.defaultTileGrid_};ol.proj.Projection.prototype.setDefaultTileGrid=function(e){this.defaultTileGrid_=e};ol.proj.Projection.prototype.setExtent=function(e){this.extent_=e;this.canWrapX_=!(!this.global_||!e)};ol.proj.Projection.prototype.setWorldExtent=function(e){this.worldExtent_=e};ol.proj.Projection.prototype.setGetPointResolution=function(e){this.getPointResolutionFunc_=e};ol.proj.Projection.prototype.getPointResolutionFunc=function(){return this.getPointResolutionFunc_};goog.provide("ol.proj.EPSG3857");goog.require("ol");goog.require("ol.math");goog.require("ol.proj.Projection");goog.require("ol.proj.Units");ol.proj.EPSG3857.Projection_=function(e){ol.proj.Projection.call(this,{code:e,units:ol.proj.Units.METERS,extent:ol.proj.EPSG3857.EXTENT,global:!0,worldExtent:ol.proj.EPSG3857.WORLD_EXTENT,getPointResolution:function(e,t){return e/ol.math.cosh(t[1]/ol.proj.EPSG3857.RADIUS)}})};ol.inherits(ol.proj.EPSG3857.Projection_,ol.proj.Projection);ol.proj.EPSG3857.RADIUS=6378137;ol.proj.EPSG3857.HALF_SIZE=Math.PI*ol.proj.EPSG3857.RADIUS;ol.proj.EPSG3857.EXTENT=[-ol.proj.EPSG3857.HALF_SIZE,-ol.proj.EPSG3857.HALF_SIZE,ol.proj.EPSG3857.HALF_SIZE,ol.proj.EPSG3857.HALF_SIZE];ol.proj.EPSG3857.WORLD_EXTENT=[-180,-85,180,85];ol.proj.EPSG3857.PROJECTIONS=[new ol.proj.EPSG3857.Projection_("EPSG:3857"),new ol.proj.EPSG3857.Projection_("EPSG:102100"),new ol.proj.EPSG3857.Projection_("EPSG:102113"),new ol.proj.EPSG3857.Projection_("EPSG:900913"),new ol.proj.EPSG3857.Projection_("urn:ogc:def:crs:EPSG:6.18:3:3857"),new ol.proj.EPSG3857.Projection_("urn:ogc:def:crs:EPSG::3857"),new ol.proj.EPSG3857.Projection_("http://www.opengis.net/gml/srs/epsg.xml#3857")];ol.proj.EPSG3857.fromEPSG4326=function(e,t,o){var r=e.length,i=o>1?o:2,n=t;void 0===n&&(n=i>2?e.slice():new Array(r));for(var a=ol.proj.EPSG3857.HALF_SIZE,l=0;l<r;l+=i){n[l]=a*e[l]/180;var s=ol.proj.EPSG3857.RADIUS*Math.log(Math.tan(Math.PI*(e[l+1]+90)/360));s>a?s=a:s<-a&&(s=-a);n[l+1]=s}return n};ol.proj.EPSG3857.toEPSG4326=function(e,t,o){var r=e.length,i=o>1?o:2,n=t;void 0===n&&(n=i>2?e.slice():new Array(r));for(var a=0;a<r;a+=i){n[a]=180*e[a]/ol.proj.EPSG3857.HALF_SIZE;n[a+1]=360*Math.atan(Math.exp(e[a+1]/ol.proj.EPSG3857.RADIUS))/Math.PI-90}return n};goog.provide("ol.proj.EPSG4326");goog.require("ol");goog.require("ol.proj.Projection");goog.require("ol.proj.Units");ol.proj.EPSG4326.Projection_=function(e,t){ol.proj.Projection.call(this,{code:e,units:ol.proj.Units.DEGREES,extent:ol.proj.EPSG4326.EXTENT,axisOrientation:t,global:!0,metersPerUnit:ol.proj.EPSG4326.METERS_PER_UNIT,worldExtent:ol.proj.EPSG4326.EXTENT})};ol.inherits(ol.proj.EPSG4326.Projection_,ol.proj.Projection);ol.proj.EPSG4326.RADIUS=6378137;ol.proj.EPSG4326.EXTENT=[-180,-90,180,90];ol.proj.EPSG4326.METERS_PER_UNIT=Math.PI*ol.proj.EPSG4326.RADIUS/180;ol.proj.EPSG4326.PROJECTIONS=[new ol.proj.EPSG4326.Projection_("CRS:84"),new ol.proj.EPSG4326.Projection_("EPSG:4326","neu"),new ol.proj.EPSG4326.Projection_("urn:ogc:def:crs:EPSG::4326","neu"),new ol.proj.EPSG4326.Projection_("urn:ogc:def:crs:EPSG:6.6:4326","neu"),new ol.proj.EPSG4326.Projection_("urn:ogc:def:crs:OGC:1.3:CRS84"),new ol.proj.EPSG4326.Projection_("urn:ogc:def:crs:OGC:2:84"),new ol.proj.EPSG4326.Projection_("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new ol.proj.EPSG4326.Projection_("urn:x-ogc:def:crs:EPSG:4326","neu")];goog.provide("ol.proj.projections");ol.proj.projections.cache_={};ol.proj.projections.clear=function(){ol.proj.projections.cache_={}};ol.proj.projections.get=function(e){return ol.proj.projections.cache_[e]||null};ol.proj.projections.add=function(e,t){ol.proj.projections.cache_[e]=t};goog.provide("ol.proj.transforms");goog.require("ol.obj");ol.proj.transforms.cache_={};ol.proj.transforms.clear=function(){ol.proj.transforms.cache_={}};ol.proj.transforms.add=function(e,t,o){var r=e.getCode(),i=t.getCode(),n=ol.proj.transforms.cache_;r in n||(n[r]={});n[r][i]=o};ol.proj.transforms.remove=function(e,t){var o=e.getCode(),r=t.getCode(),i=ol.proj.transforms.cache_,n=i[o][r];delete i[o][r];ol.obj.isEmpty(i[o])&&delete i[o];return n};ol.proj.transforms.get=function(e,t){var o,r=ol.proj.transforms.cache_;e in r&&t in r[e]&&(o=r[e][t]);return o};goog.provide("ol.proj");goog.require("ol");goog.require("ol.Sphere");goog.require("ol.extent");goog.require("ol.math");goog.require("ol.proj.EPSG3857");goog.require("ol.proj.EPSG4326");goog.require("ol.proj.Projection");goog.require("ol.proj.Units");goog.require("ol.proj.proj4");goog.require("ol.proj.projections");goog.require("ol.proj.transforms");ol.proj.METERS_PER_UNIT=ol.proj.Units.METERS_PER_UNIT;ol.proj.SPHERE_=new ol.Sphere(ol.Sphere.DEFAULT_RADIUS);ol.ENABLE_PROJ4JS&&(ol.proj.setProj4=function(e){ol.proj.proj4.set(e)});ol.proj.getPointResolution=function(e,t,o,r){var i,n=(e=ol.proj.get(e)).getPointResolutionFunc();if(n)i=n(t,o);else{if(e.getUnits()==ol.proj.Units.DEGREES&&!r||r==ol.proj.Units.DEGREES)i=t;else{var a=ol.proj.getTransformFromProjections(e,ol.proj.get("EPSG:4326")),l=[o[0]-t/2,o[1],o[0]+t/2,o[1],o[0],o[1]-t/2,o[0],o[1]+t/2];l=a(l,l,2);i=(ol.proj.SPHERE_.haversineDistance(l.slice(0,2),l.slice(2,4))+ol.proj.SPHERE_.haversineDistance(l.slice(4,6),l.slice(6,8)))/2;var s=r?ol.proj.Units.METERS_PER_UNIT[r]:e.getMetersPerUnit();void 0!==s&&(i/=s)}}return i};ol.proj.addEquivalentProjections=function(e){ol.proj.addProjections(e);e.forEach(function(t){e.forEach(function(e){t!==e&&ol.proj.transforms.add(t,e,ol.proj.cloneTransform)})})};ol.proj.addEquivalentTransforms=function(e,t,o,r){e.forEach(function(e){t.forEach(function(t){ol.proj.transforms.add(e,t,o);ol.proj.transforms.add(t,e,r)})})};ol.proj.addProjection=function(e){ol.proj.projections.add(e.getCode(),e);ol.proj.transforms.add(e,e,ol.proj.cloneTransform)};ol.proj.addProjections=function(e){e.forEach(ol.proj.addProjection)};ol.proj.clearAllProjections=function(){ol.proj.projections.clear();ol.proj.transforms.clear()};ol.proj.createProjection=function(e,t){return e?"string"==typeof e?ol.proj.get(e):e:ol.proj.get(t)};ol.proj.addCoordinateTransforms=function(e,t,o,r){var i=ol.proj.get(e),n=ol.proj.get(t);ol.proj.transforms.add(i,n,ol.proj.createTransformFromCoordinateTransform(o));ol.proj.transforms.add(n,i,ol.proj.createTransformFromCoordinateTransform(r))};ol.proj.createTransformFromCoordinateTransform=function(e){return function(t,o,r){var i,n,a,l=t.length,s=void 0!==r?r:2,p=void 0!==o?o:new Array(l);for(n=0;n<l;n+=s){i=e([t[n],t[n+1]]);p[n]=i[0];p[n+1]=i[1];for(a=s-1;a>=2;--a)p[n+a]=t[n+a]}return p}};ol.proj.fromLonLat=function(e,t){return ol.proj.transform(e,"EPSG:4326",void 0!==t?t:"EPSG:3857")};ol.proj.toLonLat=function(e,t){var o=ol.proj.transform(e,void 0!==t?t:"EPSG:3857","EPSG:4326"),r=o[0];(r<-180||r>180)&&(o[0]=ol.math.modulo(r+180,360)-180);return o};ol.proj.get=function(e){var t=null;if(e instanceof ol.proj.Projection)t=e;else if("string"==typeof e){var o=e;t=ol.proj.projections.get(o);if(ol.ENABLE_PROJ4JS&&!t){var r=ol.proj.proj4.get();if("function"==typeof r&&void 0!==r.defs(o)){t=new ol.proj.Projection({code:o});ol.proj.addProjection(t)}}}return t};ol.proj.equivalent=function(e,t){if(e===t)return!0;var o=e.getUnits()===t.getUnits();return e.getCode()===t.getCode()?o:ol.proj.getTransformFromProjections(e,t)===ol.proj.cloneTransform&&o};ol.proj.getTransform=function(e,t){var o=ol.proj.get(e),r=ol.proj.get(t);return ol.proj.getTransformFromProjections(o,r)};ol.proj.getTransformFromProjections=function(e,t){var o=e.getCode(),r=t.getCode(),i=ol.proj.transforms.get(o,r);if(ol.ENABLE_PROJ4JS&&!i){var n=ol.proj.proj4.get();if("function"==typeof n){var a=n.defs(o),l=n.defs(r);if(void 0!==a&&void 0!==l){if(a===l)ol.proj.addEquivalentProjections([t,e]);else{var s=n(r,o);ol.proj.addCoordinateTransforms(t,e,s.forward,s.inverse)}i=ol.proj.transforms.get(o,r)}}}i||(i=ol.proj.identityTransform);return i};ol.proj.identityTransform=function(e,t,o){if(void 0!==t&&e!==t){for(var r=0,i=e.length;r<i;++r)t[r]=e[r];e=t}return e};ol.proj.cloneTransform=function(e,t,o){var r;if(void 0!==t){for(var i=0,n=e.length;i<n;++i)t[i]=e[i];r=t}else r=e.slice();return r};ol.proj.transform=function(e,t,o){return ol.proj.getTransform(t,o)(e,void 0,e.length)};ol.proj.transformExtent=function(e,t,o){var r=ol.proj.getTransform(t,o);return ol.extent.applyTransform(e,r)};ol.proj.transformWithProjections=function(e,t,o){return ol.proj.getTransformFromProjections(t,o)(e)};ol.proj.addCommon=function(){ol.proj.addEquivalentProjections(ol.proj.EPSG3857.PROJECTIONS);ol.proj.addEquivalentProjections(ol.proj.EPSG4326.PROJECTIONS);ol.proj.addEquivalentTransforms(ol.proj.EPSG4326.PROJECTIONS,ol.proj.EPSG3857.PROJECTIONS,ol.proj.EPSG3857.fromEPSG4326,ol.proj.EPSG3857.toEPSG4326)};ol.proj.addCommon();goog.provide("ol.tilecoord");ol.tilecoord.createOrUpdate=function(e,t,o,r){if(void 0!==r){r[0]=e;r[1]=t;r[2]=o;return r}return[e,t,o]};ol.tilecoord.getKeyZXY=function(e,t,o){return e+"/"+t+"/"+o};ol.tilecoord.getKey=function(e){return ol.tilecoord.getKeyZXY(e[0],e[1],e[2])};ol.tilecoord.fromKey=function(e){return e.split("/").map(Number)};ol.tilecoord.hash=function(e){return(e[1]<<e[0])+e[2]};ol.tilecoord.quadKey=function(e){var t,o,r=e[0],i=new Array(r),n=1<<r-1;for(t=0;t<r;++t){o=48;e[1]&n&&(o+=1);e[2]&n&&(o+=2);i[t]=String.fromCharCode(o);n>>=1}return i.join("")};ol.tilecoord.withinExtentAndZ=function(e,t){var o=e[0],r=e[1],i=e[2];if(t.getMinZoom()>o||o>t.getMaxZoom())return!1;var n,a=t.getExtent();return!(n=a?t.getTileRangeForExtentAndZ(a,o):t.getFullTileRange(o))||n.containsXY(r,i)};goog.provide("ol.tilegrid.TileGrid");goog.require("ol");goog.require("ol.asserts");goog.require("ol.TileRange");goog.require("ol.array");goog.require("ol.extent");goog.require("ol.math");goog.require("ol.size");goog.require("ol.tilecoord");ol.tilegrid.TileGrid=function(e){this.minZoom=void 0!==e.minZoom?e.minZoom:0;this.resolutions_=e.resolutions;ol.asserts.assert(ol.array.isSorted(this.resolutions_,function(e,t){return t-e},!0),17);var t;if(!e.origins)for(var o=0,r=this.resolutions_.length-1;o<r;++o)if(t){if(this.resolutions_[o]/this.resolutions_[o+1]!==t){t=void 0;break}}else t=this.resolutions_[o]/this.resolutions_[o+1];this.zoomFactor_=t;this.maxZoom=this.resolutions_.length-1;this.origin_=void 0!==e.origin?e.origin:null;this.origins_=null;if(void 0!==e.origins){this.origins_=e.origins;ol.asserts.assert(this.origins_.length==this.resolutions_.length,20)}var i=e.extent;void 0===i||this.origin_||this.origins_||(this.origin_=ol.extent.getTopLeft(i));ol.asserts.assert(!this.origin_&&this.origins_||this.origin_&&!this.origins_,18);this.tileSizes_=null;if(void 0!==e.tileSizes){this.tileSizes_=e.tileSizes;ol.asserts.assert(this.tileSizes_.length==this.resolutions_.length,19)}this.tileSize_=void 0!==e.tileSize?e.tileSize:this.tileSizes_?null:ol.DEFAULT_TILE_SIZE;ol.asserts.assert(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,22);this.extent_=void 0!==i?i:null;this.fullTileRanges_=null;this.tmpSize_=[0,0];void 0!==e.sizes?this.fullTileRanges_=e.sizes.map(function(e,t){return new ol.TileRange(Math.min(0,e[0]),Math.max(e[0]-1,-1),Math.min(0,e[1]),Math.max(e[1]-1,-1))},this):i&&this.calculateTileRanges_(i)};ol.tilegrid.TileGrid.tmpTileCoord_=[0,0,0];ol.tilegrid.TileGrid.prototype.forEachTileCoord=function(e,t,o){for(var r=this.getTileRangeForExtentAndZ(e,t),i=r.minX,n=r.maxX;i<=n;++i)for(var a=r.minY,l=r.maxY;a<=l;++a)o([t,i,a])};ol.tilegrid.TileGrid.prototype.forEachTileCoordParentTileRange=function(e,t,o,r,i){var n,a,l,s=null,p=e[0]-1;if(2===this.zoomFactor_){a=e[1];l=e[2]}else s=this.getTileCoordExtent(e,i);for(;p>=this.minZoom;){if(2===this.zoomFactor_){a=Math.floor(a/2);l=Math.floor(l/2);n=ol.TileRange.createOrUpdate(a,a,l,l,r)}else n=this.getTileRangeForExtentAndZ(s,p,r);if(t.call(o,p,n))return!0;--p}return!1};ol.tilegrid.TileGrid.prototype.getExtent=function(){return this.extent_};ol.tilegrid.TileGrid.prototype.getMaxZoom=function(){return this.maxZoom};ol.tilegrid.TileGrid.prototype.getMinZoom=function(){return this.minZoom};ol.tilegrid.TileGrid.prototype.getOrigin=function(e){return this.origin_?this.origin_:this.origins_[e]};ol.tilegrid.TileGrid.prototype.getResolution=function(e){return this.resolutions_[e]};ol.tilegrid.TileGrid.prototype.getResolutions=function(){return this.resolutions_};ol.tilegrid.TileGrid.prototype.getTileCoordChildTileRange=function(e,t,o){if(e[0]<this.maxZoom){if(2===this.zoomFactor_){var r=2*e[1],i=2*e[2];return ol.TileRange.createOrUpdate(r,r+1,i,i+1,t)}var n=this.getTileCoordExtent(e,o);return this.getTileRangeForExtentAndZ(n,e[0]+1,t)}return null};ol.tilegrid.TileGrid.prototype.getTileRangeExtent=function(e,t,o){var r=this.getOrigin(e),i=this.getResolution(e),n=ol.size.toSize(this.getTileSize(e),this.tmpSize_),a=r[0]+t.minX*n[0]*i,l=r[0]+(t.maxX+1)*n[0]*i,s=r[1]+t.minY*n[1]*i,p=r[1]+(t.maxY+1)*n[1]*i;return ol.extent.createOrUpdate(a,s,l,p,o)};ol.tilegrid.TileGrid.prototype.getTileRangeForExtentAndZ=function(e,t,o){var r=ol.tilegrid.TileGrid.tmpTileCoord_;this.getTileCoordForXYAndZ_(e[0],e[1],t,!1,r);var i=r[1],n=r[2];this.getTileCoordForXYAndZ_(e[2],e[3],t,!0,r);return ol.TileRange.createOrUpdate(i,r[1],n,r[2],o)};ol.tilegrid.TileGrid.prototype.getTileCoordCenter=function(e){var t=this.getOrigin(e[0]),o=this.getResolution(e[0]),r=ol.size.toSize(this.getTileSize(e[0]),this.tmpSize_);return[t[0]+(e[1]+.5)*r[0]*o,t[1]+(e[2]+.5)*r[1]*o]};ol.tilegrid.TileGrid.prototype.getTileCoordExtent=function(e,t){var o=this.getOrigin(e[0]),r=this.getResolution(e[0]),i=ol.size.toSize(this.getTileSize(e[0]),this.tmpSize_),n=o[0]+e[1]*i[0]*r,a=o[1]+e[2]*i[1]*r,l=n+i[0]*r,s=a+i[1]*r;return ol.extent.createOrUpdate(n,a,l,s,t)};ol.tilegrid.TileGrid.prototype.getTileCoordForCoordAndResolution=function(e,t,o){return this.getTileCoordForXYAndResolution_(e[0],e[1],t,!1,o)};ol.tilegrid.TileGrid.prototype.getTileCoordForXYAndResolution_=function(e,t,o,r,i){var n=this.getZForResolution(o),a=o/this.getResolution(n),l=this.getOrigin(n),s=ol.size.toSize(this.getTileSize(n),this.tmpSize_),p=r?.5:0,c=r?0:.5,u=Math.floor((e-l[0])/o+p),g=Math.floor((t-l[1])/o+c),d=a*u/s[0],h=a*g/s[1];if(r){d=Math.ceil(d)-1;h=Math.ceil(h)-1}else{d=Math.floor(d);h=Math.floor(h)}return ol.tilecoord.createOrUpdate(n,d,h,i)};ol.tilegrid.TileGrid.prototype.getTileCoordForXYAndZ_=function(e,t,o,r,i){var n=this.getOrigin(o),a=this.getResolution(o),l=ol.size.toSize(this.getTileSize(o),this.tmpSize_),s=r?.5:0,p=r?0:.5,c=Math.floor((e-n[0])/a+s),u=Math.floor((t-n[1])/a+p),g=c/l[0],d=u/l[1];if(r){g=Math.ceil(g)-1;d=Math.ceil(d)-1}else{g=Math.floor(g);d=Math.floor(d)}return ol.tilecoord.createOrUpdate(o,g,d,i)};ol.tilegrid.TileGrid.prototype.getTileCoordForCoordAndZ=function(e,t,o){return this.getTileCoordForXYAndZ_(e[0],e[1],t,!1,o)};ol.tilegrid.TileGrid.prototype.getTileCoordResolution=function(e){return this.resolutions_[e[0]]};ol.tilegrid.TileGrid.prototype.getTileSize=function(e){return this.tileSize_?this.tileSize_:this.tileSizes_[e]};ol.tilegrid.TileGrid.prototype.getFullTileRange=function(e){return this.fullTileRanges_?this.fullTileRanges_[e]:null};ol.tilegrid.TileGrid.prototype.getZForResolution=function(e,t){var o=ol.array.linearFindNearest(this.resolutions_,e,t||0);return ol.math.clamp(o,this.minZoom,this.maxZoom)};ol.tilegrid.TileGrid.prototype.calculateTileRanges_=function(e){for(var t=this.resolutions_.length,o=new Array(t),r=this.minZoom;r<t;++r)o[r]=this.getTileRangeForExtentAndZ(e,r);this.fullTileRanges_=o};goog.provide("ol.tilegrid");goog.require("ol");goog.require("ol.size");goog.require("ol.extent");goog.require("ol.extent.Corner");goog.require("ol.obj");goog.require("ol.proj");goog.require("ol.proj.Units");goog.require("ol.tilegrid.TileGrid");ol.tilegrid.getForProjection=function(e){var t=e.getDefaultTileGrid();if(!t){t=ol.tilegrid.createForProjection(e);e.setDefaultTileGrid(t)}return t};ol.tilegrid.wrapX=function(e,t,o){var r=t[0],i=e.getTileCoordCenter(t),n=ol.tilegrid.extentFromProjection(o);if(ol.extent.containsCoordinate(n,i))return t;var a=ol.extent.getWidth(n),l=Math.ceil((n[0]-i[0])/a);i[0]+=a*l;return e.getTileCoordForCoordAndZ(i,r)};ol.tilegrid.createForExtent=function(e,t,o,r){var i=void 0!==r?r:ol.extent.Corner.TOP_LEFT,n=ol.tilegrid.resolutionsFromExtent(e,t,o);return new ol.tilegrid.TileGrid({extent:e,origin:ol.extent.getCorner(e,i),resolutions:n,tileSize:o})};ol.tilegrid.createXYZ=function(e){var t={};ol.obj.assign(t,void 0!==e?e:{});void 0===t.extent&&(t.extent=ol.proj.get("EPSG:3857").getExtent());t.resolutions=ol.tilegrid.resolutionsFromExtent(t.extent,t.maxZoom,t.tileSize);delete t.maxZoom;return new ol.tilegrid.TileGrid(t)};ol.tilegrid.resolutionsFromExtent=function(e,t,o){for(var r=void 0!==t?t:ol.DEFAULT_MAX_ZOOM,i=ol.extent.getHeight(e),n=ol.extent.getWidth(e),a=ol.size.toSize(void 0!==o?o:ol.DEFAULT_TILE_SIZE),l=Math.max(n/a[0],i/a[1]),s=r+1,p=new Array(s),c=0;c<s;++c)p[c]=l/Math.pow(2,c);return p};ol.tilegrid.createForProjection=function(e,t,o,r){var i=ol.tilegrid.extentFromProjection(e);return ol.tilegrid.createForExtent(i,t,o,r)};ol.tilegrid.extentFromProjection=function(e){var t=(e=ol.proj.get(e)).getExtent();if(!t){var o=180*ol.proj.METERS_PER_UNIT[ol.proj.Units.DEGREES]/e.getMetersPerUnit();t=ol.extent.createOrUpdate(-o,-o,o,o)}return t};goog.provide("ol.Attribution");goog.require("ol.TileRange");goog.require("ol.math");goog.require("ol.tilegrid");ol.Attribution=function(e){this.html_=e.html;this.tileRanges_=e.tileRanges?e.tileRanges:null};ol.Attribution.prototype.getHTML=function(){return this.html_};ol.Attribution.prototype.intersectsAnyTileRange=function(e,t,o){if(!this.tileRanges_)return!0;var r,i,n,a;for(a in e)if(a in this.tileRanges_){n=e[a];var l;for(r=0,i=this.tileRanges_[a].length;r<i;++r){if((l=this.tileRanges_[a][r]).intersects(n))return!0;var s=t.getTileRangeForExtentAndZ(ol.tilegrid.extentFromProjection(o),parseInt(a,10)),p=s.getWidth();if(n.minX<s.minX||n.maxX>s.maxX){if(l.intersects(new ol.TileRange(ol.math.modulo(n.minX,p),ol.math.modulo(n.maxX,p),n.minY,n.maxY)))return!0;if(n.getWidth()>p&&l.intersects(s))return!0}}}return!1};goog.provide("ol.CollectionEventType");ol.CollectionEventType={ADD:"add",REMOVE:"remove"};goog.provide("ol.ObjectEventType");ol.ObjectEventType={PROPERTYCHANGE:"propertychange"};goog.provide("ol.events");goog.require("ol.obj");ol.events.bindListener_=function(e){var t=function(t){var o=e.listener,r=e.bindTo||e.target;e.callOnce&&ol.events.unlistenByKey(e);return o.call(r,t)};e.boundListener=t;return t};ol.events.findListener_=function(e,t,o,r){for(var i,n=0,a=e.length;n<a;++n)if((i=e[n]).listener===t&&i.bindTo===o){r&&(i.deleteIndex=n);return i}};ol.events.getListeners=function(e,t){var o=e.ol_lm;return o?o[t]:void 0};ol.events.getListenerMap_=function(e){var t=e.ol_lm;t||(t=e.ol_lm={});return t};ol.events.removeListeners_=function(e,t){var o=ol.events.getListeners(e,t);if(o){for(var r=0,i=o.length;r<i;++r){e.removeEventListener(t,o[r].boundListener);ol.obj.clear(o[r])}o.length=0;var n=e.ol_lm;if(n){delete n[t];0===Object.keys(n).length&&delete e.ol_lm}}};ol.events.listen=function(e,t,o,r,i){var n=ol.events.getListenerMap_(e),a=n[t];a||(a=n[t]=[]);var l=ol.events.findListener_(a,o,r,!1);if(l)i||(l.callOnce=!1);else{l={bindTo:r,callOnce:!!i,listener:o,target:e,type:t};e.addEventListener(t,ol.events.bindListener_(l));a.push(l)}return l};ol.events.listenOnce=function(e,t,o,r){return ol.events.listen(e,t,o,r,!0)};ol.events.unlisten=function(e,t,o,r){var i=ol.events.getListeners(e,t);if(i){var n=ol.events.findListener_(i,o,r,!0);n&&ol.events.unlistenByKey(n)}};ol.events.unlistenByKey=function(e){if(e&&e.target){e.target.removeEventListener(e.type,e.boundListener);var t=ol.events.getListeners(e.target,e.type);if(t){var o="deleteIndex"in e?e.deleteIndex:t.indexOf(e);-1!==o&&t.splice(o,1);0===t.length&&ol.events.removeListeners_(e.target,e.type)}ol.obj.clear(e)}};ol.events.unlistenAll=function(e){var t=ol.events.getListenerMap_(e);for(var o in t)ol.events.removeListeners_(e,o)};goog.provide("ol.Disposable");goog.require("ol");ol.Disposable=function(){};ol.Disposable.prototype.disposed_=!1;ol.Disposable.prototype.dispose=function(){if(!this.disposed_){this.disposed_=!0;this.disposeInternal()}};ol.Disposable.prototype.disposeInternal=ol.nullFunction;goog.provide("ol.events.Event");ol.events.Event=function(e){this.propagationStopped;this.type=e;this.target=null};ol.events.Event.prototype.preventDefault=ol.events.Event.prototype.stopPropagation=function(){this.propagationStopped=!0};ol.events.Event.stopPropagation=function(e){e.stopPropagation()};ol.events.Event.preventDefault=function(e){e.preventDefault()};goog.provide("ol.events.EventTarget");goog.require("ol");goog.require("ol.Disposable");goog.require("ol.events");goog.require("ol.events.Event");ol.events.EventTarget=function(){ol.Disposable.call(this);this.pendingRemovals_={};this.dispatching_={};this.listeners_={}};ol.inherits(ol.events.EventTarget,ol.Disposable);ol.events.EventTarget.prototype.addEventListener=function(e,t){var o=this.listeners_[e];o||(o=this.listeners_[e]=[]);-1===o.indexOf(t)&&o.push(t)};ol.events.EventTarget.prototype.dispatchEvent=function(e){var t="string"==typeof e?new ol.events.Event(e):e,o=t.type;t.target=this;var r,i=this.listeners_[o];if(i){if(!(o in this.dispatching_)){this.dispatching_[o]=0;this.pendingRemovals_[o]=0}++this.dispatching_[o];for(var n=0,a=i.length;n<a;++n)if(!1===i[n].call(this,t)||t.propagationStopped){r=!1;break}--this.dispatching_[o];if(0===this.dispatching_[o]){var l=this.pendingRemovals_[o];delete this.pendingRemovals_[o];for(;l--;)this.removeEventListener(o,ol.nullFunction);delete this.dispatching_[o]}return r}};ol.events.EventTarget.prototype.disposeInternal=function(){ol.events.unlistenAll(this)};ol.events.EventTarget.prototype.getListeners=function(e){return this.listeners_[e]};ol.events.EventTarget.prototype.hasListener=function(e){return e?e in this.listeners_:Object.keys(this.listeners_).length>0};ol.events.EventTarget.prototype.removeEventListener=function(e,t){var o=this.listeners_[e];if(o){var r=o.indexOf(t);if(e in this.pendingRemovals_){o[r]=ol.nullFunction;++this.pendingRemovals_[e]}else{o.splice(r,1);0===o.length&&delete this.listeners_[e]}}};goog.provide("ol.events.EventType");ol.events.EventType={CHANGE:"change",CLEAR:"clear",CLICK:"click",DBLCLICK:"dblclick",DRAGENTER:"dragenter",DRAGOVER:"dragover",DROP:"drop",ERROR:"error",KEYDOWN:"keydown",KEYPRESS:"keypress",LOAD:"load",MOUSEDOWN:"mousedown",MOUSEMOVE:"mousemove",MOUSEOUT:"mouseout",MOUSEUP:"mouseup",MOUSEWHEEL:"mousewheel",MSPOINTERDOWN:"MSPointerDown",RESIZE:"resize",TOUCHSTART:"touchstart",TOUCHMOVE:"touchmove",TOUCHEND:"touchend",WHEEL:"wheel"};goog.provide("ol.Observable");goog.require("ol");goog.require("ol.events");goog.require("ol.events.EventTarget");goog.require("ol.events.EventType");ol.Observable=function(){ol.events.EventTarget.call(this);this.revision_=0};ol.inherits(ol.Observable,ol.events.EventTarget);ol.Observable.unByKey=function(e){if(Array.isArray(e))for(var t=0,o=e.length;t<o;++t)ol.events.unlistenByKey(e[t]);else ol.events.unlistenByKey(e)};ol.Observable.prototype.changed=function(){++this.revision_;this.dispatchEvent(ol.events.EventType.CHANGE)};ol.Observable.prototype.dispatchEvent;ol.Observable.prototype.getRevision=function(){return this.revision_};ol.Observable.prototype.on=function(e,t,o){if(Array.isArray(e)){for(var r=e.length,i=new Array(r),n=0;n<r;++n)i[n]=ol.events.listen(this,e[n],t,o);return i}return ol.events.listen(this,e,t,o)};ol.Observable.prototype.once=function(e,t,o){if(Array.isArray(e)){for(var r=e.length,i=new Array(r),n=0;n<r;++n)i[n]=ol.events.listenOnce(this,e[n],t,o);return i}return ol.events.listenOnce(this,e,t,o)};ol.Observable.prototype.un=function(e,t,o){if(Array.isArray(e))for(var r=0,i=e.length;r<i;++r)ol.events.unlisten(this,e[r],t,o);else ol.events.unlisten(this,e,t,o)};goog.provide("ol.Object");goog.require("ol");goog.require("ol.ObjectEventType");goog.require("ol.Observable");goog.require("ol.events.Event");goog.require("ol.obj");ol.Object=function(e){ol.Observable.call(this);ol.getUid(this);this.values_={};void 0!==e&&this.setProperties(e)};ol.inherits(ol.Object,ol.Observable);ol.Object.changeEventTypeCache_={};ol.Object.getChangeEventType=function(e){return ol.Object.changeEventTypeCache_.hasOwnProperty(e)?ol.Object.changeEventTypeCache_[e]:ol.Object.changeEventTypeCache_[e]="change:"+e};ol.Object.prototype.get=function(e){var t;this.values_.hasOwnProperty(e)&&(t=this.values_[e]);return t};ol.Object.prototype.getKeys=function(){return Object.keys(this.values_)};ol.Object.prototype.getProperties=function(){return ol.obj.assign({},this.values_)};ol.Object.prototype.notify=function(e,t){var o;o=ol.Object.getChangeEventType(e);this.dispatchEvent(new ol.Object.Event(o,e,t));o=ol.ObjectEventType.PROPERTYCHANGE;this.dispatchEvent(new ol.Object.Event(o,e,t))};ol.Object.prototype.set=function(e,t,o){if(o)this.values_[e]=t;else{var r=this.values_[e];this.values_[e]=t;r!==t&&this.notify(e,r)}};ol.Object.prototype.setProperties=function(e,t){var o;for(o in e)this.set(o,e[o],t)};ol.Object.prototype.unset=function(e,t){if(e in this.values_){var o=this.values_[e];delete this.values_[e];t||this.notify(e,o)}};ol.Object.Event=function(e,t,o){ol.events.Event.call(this,e);this.key=t;this.oldValue=o};ol.inherits(ol.Object.Event,ol.events.Event);goog.provide("ol.Collection");goog.require("ol");goog.require("ol.AssertionError");goog.require("ol.CollectionEventType");goog.require("ol.Object");goog.require("ol.events.Event");ol.Collection=function(e,t){ol.Object.call(this);var o=t||{};this.unique_=!!o.unique;this.array_=e||[];if(this.unique_)for(var r=0,i=this.array_.length;r<i;++r)this.assertUnique_(this.array_[r],r);this.updateLength_()};ol.inherits(ol.Collection,ol.Object);ol.Collection.prototype.clear=function(){for(;this.getLength()>0;)this.pop()};ol.Collection.prototype.extend=function(e){var t,o;for(t=0,o=e.length;t<o;++t)this.push(e[t]);return this};ol.Collection.prototype.forEach=function(e,t){for(var o=t?e.bind(t):e,r=this.array_,i=0,n=r.length;i<n;++i)o(r[i],i,r)};ol.Collection.prototype.getArray=function(){return this.array_};ol.Collection.prototype.item=function(e){return this.array_[e]};ol.Collection.prototype.getLength=function(){return this.get(ol.Collection.Property_.LENGTH)};ol.Collection.prototype.insertAt=function(e,t){this.unique_&&this.assertUnique_(t);this.array_.splice(e,0,t);this.updateLength_();this.dispatchEvent(new ol.Collection.Event(ol.CollectionEventType.ADD,t))};ol.Collection.prototype.pop=function(){return this.removeAt(this.getLength()-1)};ol.Collection.prototype.push=function(e){this.unique_&&this.assertUnique_(e);var t=this.getLength();this.insertAt(t,e);return this.getLength()};ol.Collection.prototype.remove=function(e){var t,o,r=this.array_;for(t=0,o=r.length;t<o;++t)if(r[t]===e)return this.removeAt(t)};ol.Collection.prototype.removeAt=function(e){var t=this.array_[e];this.array_.splice(e,1);this.updateLength_();this.dispatchEvent(new ol.Collection.Event(ol.CollectionEventType.REMOVE,t));return t};ol.Collection.prototype.setAt=function(e,t){var o=this.getLength();if(e<o){this.unique_&&this.assertUnique_(t,e);var r=this.array_[e];this.array_[e]=t;this.dispatchEvent(new ol.Collection.Event(ol.CollectionEventType.REMOVE,r));this.dispatchEvent(new ol.Collection.Event(ol.CollectionEventType.ADD,t))}else{var i;for(i=o;i<e;++i)this.insertAt(i,void 0);this.insertAt(e,t)}};ol.Collection.prototype.updateLength_=function(){this.set(ol.Collection.Property_.LENGTH,this.array_.length)};ol.Collection.prototype.assertUnique_=function(e,t){for(var o=0,r=this.array_.length;o<r;++o)if(this.array_[o]===e&&o!==t)throw new ol.AssertionError(58)};ol.Collection.Property_={LENGTH:"length"};ol.Collection.Event=function(e,t){ol.events.Event.call(this,e);this.element=t};ol.inherits(ol.Collection.Event,ol.events.Event);goog.provide("ol.MapEvent");goog.require("ol");goog.require("ol.events.Event");ol.MapEvent=function(e,t,o){ol.events.Event.call(this,e);this.map=t;this.frameState=void 0!==o?o:null};ol.inherits(ol.MapEvent,ol.events.Event);goog.provide("ol.MapBrowserEvent");goog.require("ol");goog.require("ol.MapEvent");ol.MapBrowserEvent=function(e,t,o,r,i){ol.MapEvent.call(this,e,t,i);this.originalEvent=o;this.pixel=t.getEventPixel(o);this.coordinate=t.getCoordinateFromPixel(this.pixel);this.dragging=void 0!==r&&r};ol.inherits(ol.MapBrowserEvent,ol.MapEvent);ol.MapBrowserEvent.prototype.preventDefault=function(){ol.MapEvent.prototype.preventDefault.call(this);this.originalEvent.preventDefault()};ol.MapBrowserEvent.prototype.stopPropagation=function(){ol.MapEvent.prototype.stopPropagation.call(this);this.originalEvent.stopPropagation()};goog.provide("ol.webgl");ol.webgl.ONE=1;ol.webgl.SRC_ALPHA=770;ol.webgl.COLOR_ATTACHMENT0=36064;ol.webgl.COLOR_BUFFER_BIT=16384;ol.webgl.TRIANGLES=4;ol.webgl.TRIANGLE_STRIP=5;ol.webgl.ONE_MINUS_SRC_ALPHA=771;ol.webgl.ARRAY_BUFFER=34962;ol.webgl.ELEMENT_ARRAY_BUFFER=34963;ol.webgl.STREAM_DRAW=35040;ol.webgl.STATIC_DRAW=35044;ol.webgl.DYNAMIC_DRAW=35048;ol.webgl.CULL_FACE=2884;ol.webgl.BLEND=3042;ol.webgl.STENCIL_TEST=2960;ol.webgl.DEPTH_TEST=2929;ol.webgl.SCISSOR_TEST=3089;ol.webgl.UNSIGNED_BYTE=5121;ol.webgl.UNSIGNED_SHORT=5123;ol.webgl.UNSIGNED_INT=5125;ol.webgl.FLOAT=5126;ol.webgl.RGBA=6408;ol.webgl.FRAGMENT_SHADER=35632;ol.webgl.VERTEX_SHADER=35633;ol.webgl.LINK_STATUS=35714;ol.webgl.LINEAR=9729;ol.webgl.TEXTURE_MAG_FILTER=10240;ol.webgl.TEXTURE_MIN_FILTER=10241;ol.webgl.TEXTURE_WRAP_S=10242;ol.webgl.TEXTURE_WRAP_T=10243;ol.webgl.TEXTURE_2D=3553;ol.webgl.TEXTURE0=33984;ol.webgl.CLAMP_TO_EDGE=33071;ol.webgl.COMPILE_STATUS=35713;ol.webgl.FRAMEBUFFER=36160;ol.webgl.CONTEXT_IDS_=["experimental-webgl","webgl","webkit-3d","moz-webgl"];ol.webgl.getContext=function(e,t){var o,r,i=ol.webgl.CONTEXT_IDS_.length;for(r=0;r<i;++r)try{if(o=e.getContext(ol.webgl.CONTEXT_IDS_[r],t))return o}catch(e){}return null};goog.provide("ol.has");goog.require("ol");goog.require("ol.webgl");var ua="undefined"!=typeof navigator?navigator.userAgent.toLowerCase():"",style,cache,span,heights,changeType;ol.has.FIREFOX=-1!==ua.indexOf("firefox");ol.has.SAFARI=-1!==ua.indexOf("safari")&&-1==ua.indexOf("chrom");ol.has.WEBKIT=-1!==ua.indexOf("webkit")&&-1==ua.indexOf("edge");ol.has.MAC=-1!==ua.indexOf("macintosh");ol.has.DEVICE_PIXEL_RATIO=window.devicePixelRatio||1;ol.has.CANVAS_LINE_DASH=!1;ol.has.CANVAS=ol.ENABLE_CANVAS&&function(){if(!("HTMLCanvasElement"in window))return!1;try{var e=document.createElement("CANVAS").getContext("2d");if(e){void 0!==e.setLineDash&&(ol.has.CANVAS_LINE_DASH=!0);return!0}return!1}catch(e){return!1}}();ol.has.DEVICE_ORIENTATION="DeviceOrientationEvent"in window;ol.has.GEOLOCATION="geolocation"in navigator;ol.has.TOUCH=ol.ASSUME_TOUCH||"ontouchstart"in window;ol.has.POINTER="PointerEvent"in window;ol.has.MSPOINTER=!!navigator.msPointerEnabled;ol.has.WEBGL;!function(){if(ol.ENABLE_WEBGL){var e,t=!1,o=[];if("WebGLRenderingContext"in window)try{var r=document.createElement("CANVAS"),i=ol.webgl.getContext(r,{failIfMajorPerformanceCaveat:!0});if(i){t=!0;e=i.getParameter(i.MAX_TEXTURE_SIZE);o=i.getSupportedExtensions()}}catch(e){}ol.has.WEBGL=t;ol.WEBGL_EXTENSIONS=o;ol.WEBGL_MAX_TEXTURE_SIZE=e}}();goog.provide("ol.MapBrowserEventType");goog.require("ol.events.EventType");ol.MapBrowserEventType={SINGLECLICK:"singleclick",CLICK:ol.events.EventType.CLICK,DBLCLICK:ol.events.EventType.DBLCLICK,POINTERDRAG:"pointerdrag",POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"};goog.provide("ol.MapBrowserPointerEvent");goog.require("ol");goog.require("ol.MapBrowserEvent");ol.MapBrowserPointerEvent=function(e,t,o,r,i){ol.MapBrowserEvent.call(this,e,t,o.originalEvent,r,i);this.pointerEvent=o};ol.inherits(ol.MapBrowserPointerEvent,ol.MapBrowserEvent);goog.provide("ol.pointer.EventType");ol.pointer.EventType={POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"};goog.provide("ol.pointer.EventSource");ol.pointer.EventSource=function(e,t){this.dispatcher=e;this.mapping_=t};ol.pointer.EventSource.prototype.getEvents=function(){return Object.keys(this.mapping_)};ol.pointer.EventSource.prototype.getHandlerForEvent=function(e){return this.mapping_[e]};goog.provide("ol.pointer.MouseSource");goog.require("ol");goog.require("ol.pointer.EventSource");ol.pointer.MouseSource=function(e){var t={mousedown:this.mousedown,mousemove:this.mousemove,mouseup:this.mouseup,mouseover:this.mouseover,mouseout:this.mouseout};ol.pointer.EventSource.call(this,e,t);this.pointerMap=e.pointerMap;this.lastTouches=[]};ol.inherits(ol.pointer.MouseSource,ol.pointer.EventSource);ol.pointer.MouseSource.POINTER_ID=1;ol.pointer.MouseSource.POINTER_TYPE="mouse";ol.pointer.MouseSource.DEDUP_DIST=25;ol.pointer.MouseSource.prototype.isEventSimulatedFromTouch_=function(e){for(var t,o=this.lastTouches,r=e.clientX,i=e.clientY,n=0,a=o.length;n<a&&(t=o[n]);n++){var l=Math.abs(r-t[0]),s=Math.abs(i-t[1]);if(l<=ol.pointer.MouseSource.DEDUP_DIST&&s<=ol.pointer.MouseSource.DEDUP_DIST)return!0}return!1};ol.pointer.MouseSource.prepareEvent=function(e,t){var o=t.cloneEvent(e,e),r=o.preventDefault;o.preventDefault=function(){e.preventDefault();r()};o.pointerId=ol.pointer.MouseSource.POINTER_ID;o.isPrimary=!0;o.pointerType=ol.pointer.MouseSource.POINTER_TYPE;return o};ol.pointer.MouseSource.prototype.mousedown=function(e){if(!this.isEventSimulatedFromTouch_(e)){ol.pointer.MouseSource.POINTER_ID.toString()in this.pointerMap&&this.cancel(e);var t=ol.pointer.MouseSource.prepareEvent(e,this.dispatcher);this.pointerMap[ol.pointer.MouseSource.POINTER_ID.toString()]=e;this.dispatcher.down(t,e)}};ol.pointer.MouseSource.prototype.mousemove=function(e){if(!this.isEventSimulatedFromTouch_(e)){var t=ol.pointer.MouseSource.prepareEvent(e,this.dispatcher);this.dispatcher.move(t,e)}};ol.pointer.MouseSource.prototype.mouseup=function(e){if(!this.isEventSimulatedFromTouch_(e)){var t=this.pointerMap[ol.pointer.MouseSource.POINTER_ID.toString()];if(t&&t.button===e.button){var o=ol.pointer.MouseSource.prepareEvent(e,this.dispatcher);this.dispatcher.up(o,e);this.cleanupMouse()}}};ol.pointer.MouseSource.prototype.mouseover=function(e){if(!this.isEventSimulatedFromTouch_(e)){var t=ol.pointer.MouseSource.prepareEvent(e,this.dispatcher);this.dispatcher.enterOver(t,e)}};ol.pointer.MouseSource.prototype.mouseout=function(e){if(!this.isEventSimulatedFromTouch_(e)){var t=ol.pointer.MouseSource.prepareEvent(e,this.dispatcher);this.dispatcher.leaveOut(t,e)}};ol.pointer.MouseSource.prototype.cancel=function(e){var t=ol.pointer.MouseSource.prepareEvent(e,this.dispatcher);this.dispatcher.cancel(t,e);this.cleanupMouse()};ol.pointer.MouseSource.prototype.cleanupMouse=function(){delete this.pointerMap[ol.pointer.MouseSource.POINTER_ID.toString()]};goog.provide("ol.pointer.MsSource");goog.require("ol");goog.require("ol.pointer.EventSource");ol.pointer.MsSource=function(e){var t={MSPointerDown:this.msPointerDown,MSPointerMove:this.msPointerMove,MSPointerUp:this.msPointerUp,MSPointerOut:this.msPointerOut,MSPointerOver:this.msPointerOver,MSPointerCancel:this.msPointerCancel,MSGotPointerCapture:this.msGotPointerCapture,MSLostPointerCapture:this.msLostPointerCapture};ol.pointer.EventSource.call(this,e,t);this.pointerMap=e.pointerMap;this.POINTER_TYPES=["","unavailable","touch","pen","mouse"]};ol.inherits(ol.pointer.MsSource,ol.pointer.EventSource);ol.pointer.MsSource.prototype.prepareEvent_=function(e){var t=e;"number"==typeof e.pointerType&&((t=this.dispatcher.cloneEvent(e,e)).pointerType=this.POINTER_TYPES[e.pointerType]);return t};ol.pointer.MsSource.prototype.cleanup=function(e){delete this.pointerMap[e.toString()]};ol.pointer.MsSource.prototype.msPointerDown=function(e){this.pointerMap[e.pointerId.toString()]=e;var t=this.prepareEvent_(e);this.dispatcher.down(t,e)};ol.pointer.MsSource.prototype.msPointerMove=function(e){var t=this.prepareEvent_(e);this.dispatcher.move(t,e)};ol.pointer.MsSource.prototype.msPointerUp=function(e){var t=this.prepareEvent_(e);this.dispatcher.up(t,e);this.cleanup(e.pointerId)};ol.pointer.MsSource.prototype.msPointerOut=function(e){var t=this.prepareEvent_(e);this.dispatcher.leaveOut(t,e)};ol.pointer.MsSource.prototype.msPointerOver=function(e){var t=this.prepareEvent_(e);this.dispatcher.enterOver(t,e)};ol.pointer.MsSource.prototype.msPointerCancel=function(e){var t=this.prepareEvent_(e);this.dispatcher.cancel(t,e);this.cleanup(e.pointerId)};ol.pointer.MsSource.prototype.msLostPointerCapture=function(e){var t=this.dispatcher.makeEvent("lostpointercapture",e,e);this.dispatcher.dispatchEvent(t)};ol.pointer.MsSource.prototype.msGotPointerCapture=function(e){var t=this.dispatcher.makeEvent("gotpointercapture",e,e);this.dispatcher.dispatchEvent(t)};goog.provide("ol.pointer.NativeSource");goog.require("ol");goog.require("ol.pointer.EventSource");ol.pointer.NativeSource=function(e){var t={pointerdown:this.pointerDown,pointermove:this.pointerMove,pointerup:this.pointerUp,pointerout:this.pointerOut,pointerover:this.pointerOver,pointercancel:this.pointerCancel,gotpointercapture:this.gotPointerCapture,lostpointercapture:this.lostPointerCapture};ol.pointer.EventSource.call(this,e,t)};ol.inherits(ol.pointer.NativeSource,ol.pointer.EventSource);ol.pointer.NativeSource.prototype.pointerDown=function(e){this.dispatcher.fireNativeEvent(e)};ol.pointer.NativeSource.prototype.pointerMove=function(e){this.dispatcher.fireNativeEvent(e)};ol.pointer.NativeSource.prototype.pointerUp=function(e){this.dispatcher.fireNativeEvent(e)};ol.pointer.NativeSource.prototype.pointerOut=function(e){this.dispatcher.fireNativeEvent(e)};ol.pointer.NativeSource.prototype.pointerOver=function(e){this.dispatcher.fireNativeEvent(e)};ol.pointer.NativeSource.prototype.pointerCancel=function(e){this.dispatcher.fireNativeEvent(e)};ol.pointer.NativeSource.prototype.lostPointerCapture=function(e){this.dispatcher.fireNativeEvent(e)};ol.pointer.NativeSource.prototype.gotPointerCapture=function(e){this.dispatcher.fireNativeEvent(e)};goog.provide("ol.pointer.PointerEvent");goog.require("ol");goog.require("ol.events.Event");ol.pointer.PointerEvent=function(e,t,o){ol.events.Event.call(this,e);this.originalEvent=t;var r=o||{};this.buttons=this.getButtons_(r);this.pressure=this.getPressure_(r,this.buttons);this.bubbles="bubbles"in r&&r.bubbles;this.cancelable="cancelable"in r&&r.cancelable;this.view="view"in r?r.view:null;this.detail="detail"in r?r.detail:null;this.screenX="screenX"in r?r.screenX:0;this.screenY="screenY"in r?r.screenY:0;this.clientX="clientX"in r?r.clientX:0;this.clientY="clientY"in r?r.clientY:0;this.ctrlKey="ctrlKey"in r&&r.ctrlKey;this.altKey="altKey"in r&&r.altKey;this.shiftKey="shiftKey"in r&&r.shiftKey;this.metaKey="metaKey"in r&&r.metaKey;this.button="button"in r?r.button:0;this.relatedTarget="relatedTarget"in r?r.relatedTarget:null;this.pointerId="pointerId"in r?r.pointerId:0;this.width="width"in r?r.width:0;this.height="height"in r?r.height:0;this.tiltX="tiltX"in r?r.tiltX:0;this.tiltY="tiltY"in r?r.tiltY:0;this.pointerType="pointerType"in r?r.pointerType:"";this.hwTimestamp="hwTimestamp"in r?r.hwTimestamp:0;this.isPrimary="isPrimary"in r&&r.isPrimary;t.preventDefault&&(this.preventDefault=function(){t.preventDefault()})};ol.inherits(ol.pointer.PointerEvent,ol.events.Event);ol.pointer.PointerEvent.prototype.getButtons_=function(e){var t;if(e.buttons||ol.pointer.PointerEvent.HAS_BUTTONS)t=e.buttons;else switch(e.which){case 1:t=1;break;case 2:t=4;break;case 3:t=2;break;default:t=0}return t};ol.pointer.PointerEvent.prototype.getPressure_=function(e,t){return e.pressure?e.pressure:t?.5:0};ol.pointer.PointerEvent.HAS_BUTTONS=!1;!function(){try{var e=new MouseEvent("click",{buttons:1});ol.pointer.PointerEvent.HAS_BUTTONS=1===e.buttons}catch(e){}}();goog.provide("ol.pointer.TouchSource");goog.require("ol");goog.require("ol.array");goog.require("ol.pointer.EventSource");goog.require("ol.pointer.MouseSource");ol.pointer.TouchSource=function(e,t){var o={touchstart:this.touchstart,touchmove:this.touchmove,touchend:this.touchend,touchcancel:this.touchcancel};ol.pointer.EventSource.call(this,e,o);this.pointerMap=e.pointerMap;this.mouseSource=t;this.firstTouchId_=void 0;this.clickCount_=0;this.resetId_=void 0};ol.inherits(ol.pointer.TouchSource,ol.pointer.EventSource);ol.pointer.TouchSource.DEDUP_TIMEOUT=2500;ol.pointer.TouchSource.CLICK_COUNT_TIMEOUT=200;ol.pointer.TouchSource.POINTER_TYPE="touch";ol.pointer.TouchSource.prototype.isPrimaryTouch_=function(e){return this.firstTouchId_===e.identifier};ol.pointer.TouchSource.prototype.setPrimaryTouch_=function(e){var t=Object.keys(this.pointerMap).length;if(0===t||1===t&&ol.pointer.MouseSource.POINTER_ID.toString()in this.pointerMap){this.firstTouchId_=e.identifier;this.cancelResetClickCount_()}};ol.pointer.TouchSource.prototype.removePrimaryPointer_=function(e){if(e.isPrimary){this.firstTouchId_=void 0;this.resetClickCount_()}};ol.pointer.TouchSource.prototype.resetClickCount_=function(){this.resetId_=setTimeout(this.resetClickCountHandler_.bind(this),ol.pointer.TouchSource.CLICK_COUNT_TIMEOUT)};ol.pointer.TouchSource.prototype.resetClickCountHandler_=function(){this.clickCount_=0;this.resetId_=void 0};ol.pointer.TouchSource.prototype.cancelResetClickCount_=function(){void 0!==this.resetId_&&clearTimeout(this.resetId_)};ol.pointer.TouchSource.prototype.touchToPointer_=function(e,t){var o=this.dispatcher.cloneEvent(e,t);o.pointerId=t.identifier+2;o.bubbles=!0;o.cancelable=!0;o.detail=this.clickCount_;o.button=0;o.buttons=1;o.width=t.webkitRadiusX||t.radiusX||0;o.height=t.webkitRadiusY||t.radiusY||0;o.pressure=t.webkitForce||t.force||.5;o.isPrimary=this.isPrimaryTouch_(t);o.pointerType=ol.pointer.TouchSource.POINTER_TYPE;o.clientX=t.clientX;o.clientY=t.clientY;o.screenX=t.screenX;o.screenY=t.screenY;return o};ol.pointer.TouchSource.prototype.processTouches_=function(e,t){var o,r,i=Array.prototype.slice.call(e.changedTouches),n=i.length;function a(){e.preventDefault()}for(o=0;o<n;++o){(r=this.touchToPointer_(e,i[o])).preventDefault=a;t.call(this,e,r)}};ol.pointer.TouchSource.prototype.findTouch_=function(e,t){for(var o=e.length,r=0;r<o;r++)if(e[r].identifier===t)return!0;return!1};ol.pointer.TouchSource.prototype.vacuumTouches_=function(e){var t=e.touches,o=Object.keys(this.pointerMap),r=o.length;if(r>=t.length){var i,n,a,l=[];for(i=0;i<r;++i){n=o[i];a=this.pointerMap[n];n==ol.pointer.MouseSource.POINTER_ID||this.findTouch_(t,n-2)||l.push(a.out)}for(i=0;i<l.length;++i)this.cancelOut_(e,l[i])}};ol.pointer.TouchSource.prototype.touchstart=function(e){this.vacuumTouches_(e);this.setPrimaryTouch_(e.changedTouches[0]);this.dedupSynthMouse_(e);this.clickCount_++;this.processTouches_(e,this.overDown_)};ol.pointer.TouchSource.prototype.overDown_=function(e,t){this.pointerMap[t.pointerId]={target:t.target,out:t,outTarget:t.target};this.dispatcher.over(t,e);this.dispatcher.enter(t,e);this.dispatcher.down(t,e)};ol.pointer.TouchSource.prototype.touchmove=function(e){e.preventDefault();this.processTouches_(e,this.moveOverOut_)};ol.pointer.TouchSource.prototype.moveOverOut_=function(e,t){var o=t,r=this.pointerMap[o.pointerId];if(r){var i=r.out,n=r.outTarget;this.dispatcher.move(o,e);if(i&&n!==o.target){i.relatedTarget=o.target;o.relatedTarget=n;i.target=n;if(o.target){this.dispatcher.leaveOut(i,e);this.dispatcher.enterOver(o,e)}else{o.target=n;o.relatedTarget=null;this.cancelOut_(e,o)}}r.out=o;r.outTarget=o.target}};ol.pointer.TouchSource.prototype.touchend=function(e){this.dedupSynthMouse_(e);this.processTouches_(e,this.upOut_)};ol.pointer.TouchSource.prototype.upOut_=function(e,t){this.dispatcher.up(t,e);this.dispatcher.out(t,e);this.dispatcher.leave(t,e);this.cleanUpPointer_(t)};ol.pointer.TouchSource.prototype.touchcancel=function(e){this.processTouches_(e,this.cancelOut_)};ol.pointer.TouchSource.prototype.cancelOut_=function(e,t){this.dispatcher.cancel(t,e);this.dispatcher.out(t,e);this.dispatcher.leave(t,e);this.cleanUpPointer_(t)};ol.pointer.TouchSource.prototype.cleanUpPointer_=function(e){delete this.pointerMap[e.pointerId];this.removePrimaryPointer_(e)};ol.pointer.TouchSource.prototype.dedupSynthMouse_=function(e){var t=this.mouseSource.lastTouches,o=e.changedTouches[0];if(this.isPrimaryTouch_(o)){var r=[o.clientX,o.clientY];t.push(r);setTimeout(function(){ol.array.remove(t,r)},ol.pointer.TouchSource.DEDUP_TIMEOUT)}};goog.provide("ol.pointer.PointerEventHandler");goog.require("ol");goog.require("ol.events");goog.require("ol.events.EventTarget");goog.require("ol.has");goog.require("ol.pointer.EventType");goog.require("ol.pointer.MouseSource");goog.require("ol.pointer.MsSource");goog.require("ol.pointer.NativeSource");goog.require("ol.pointer.PointerEvent");goog.require("ol.pointer.TouchSource");ol.pointer.PointerEventHandler=function(e){ol.events.EventTarget.call(this);this.element_=e;this.pointerMap={};this.eventMap_={};this.eventSourceList_=[];this.registerSources()};ol.inherits(ol.pointer.PointerEventHandler,ol.events.EventTarget);ol.pointer.PointerEventHandler.prototype.registerSources=function(){if(ol.has.POINTER)this.registerSource("native",new ol.pointer.NativeSource(this));else if(ol.has.MSPOINTER)this.registerSource("ms",new ol.pointer.MsSource(this));else{var e=new ol.pointer.MouseSource(this);this.registerSource("mouse",e);ol.has.TOUCH&&this.registerSource("touch",new ol.pointer.TouchSource(this,e))}this.register_()};ol.pointer.PointerEventHandler.prototype.registerSource=function(e,t){var o=t,r=o.getEvents();if(r){r.forEach(function(e){var t=o.getHandlerForEvent(e);t&&(this.eventMap_[e]=t.bind(o))},this);this.eventSourceList_.push(o)}};ol.pointer.PointerEventHandler.prototype.register_=function(){for(var e,t=this.eventSourceList_.length,o=0;o<t;o++){e=this.eventSourceList_[o];this.addEvents_(e.getEvents())}};ol.pointer.PointerEventHandler.prototype.unregister_=function(){for(var e,t=this.eventSourceList_.length,o=0;o<t;o++){e=this.eventSourceList_[o];this.removeEvents_(e.getEvents())}};ol.pointer.PointerEventHandler.prototype.eventHandler_=function(e){var t=e.type,o=this.eventMap_[t];o&&o(e)};ol.pointer.PointerEventHandler.prototype.addEvents_=function(e){e.forEach(function(e){ol.events.listen(this.element_,e,this.eventHandler_,this)},this)};ol.pointer.PointerEventHandler.prototype.removeEvents_=function(e){e.forEach(function(e){ol.events.unlisten(this.element_,e,this.eventHandler_,this)},this)};ol.pointer.PointerEventHandler.prototype.cloneEvent=function(e,t){for(var o,r={},i=0,n=ol.pointer.PointerEventHandler.CLONE_PROPS.length;i<n;i++)r[o=ol.pointer.PointerEventHandler.CLONE_PROPS[i][0]]=e[o]||t[o]||ol.pointer.PointerEventHandler.CLONE_PROPS[i][1];return r};ol.pointer.PointerEventHandler.prototype.down=function(e,t){this.fireEvent(ol.pointer.EventType.POINTERDOWN,e,t)};ol.pointer.PointerEventHandler.prototype.move=function(e,t){this.fireEvent(ol.pointer.EventType.POINTERMOVE,e,t)};ol.pointer.PointerEventHandler.prototype.up=function(e,t){this.fireEvent(ol.pointer.EventType.POINTERUP,e,t)};ol.pointer.PointerEventHandler.prototype.enter=function(e,t){e.bubbles=!1;this.fireEvent(ol.pointer.EventType.POINTERENTER,e,t)};ol.pointer.PointerEventHandler.prototype.leave=function(e,t){e.bubbles=!1;this.fireEvent(ol.pointer.EventType.POINTERLEAVE,e,t)};ol.pointer.PointerEventHandler.prototype.over=function(e,t){e.bubbles=!0;this.fireEvent(ol.pointer.EventType.POINTEROVER,e,t)};ol.pointer.PointerEventHandler.prototype.out=function(e,t){e.bubbles=!0;this.fireEvent(ol.pointer.EventType.POINTEROUT,e,t)};ol.pointer.PointerEventHandler.prototype.cancel=function(e,t){this.fireEvent(ol.pointer.EventType.POINTERCANCEL,e,t)};ol.pointer.PointerEventHandler.prototype.leaveOut=function(e,t){this.out(e,t);this.contains_(e.target,e.relatedTarget)||this.leave(e,t)};ol.pointer.PointerEventHandler.prototype.enterOver=function(e,t){this.over(e,t);this.contains_(e.target,e.relatedTarget)||this.enter(e,t)};ol.pointer.PointerEventHandler.prototype.contains_=function(e,t){return!(!e||!t)&&e.contains(t)};ol.pointer.PointerEventHandler.prototype.makeEvent=function(e,t,o){return new ol.pointer.PointerEvent(e,o,t)};ol.pointer.PointerEventHandler.prototype.fireEvent=function(e,t,o){var r=this.makeEvent(e,t,o);this.dispatchEvent(r)};ol.pointer.PointerEventHandler.prototype.fireNativeEvent=function(e){var t=this.makeEvent(e.type,e,e);this.dispatchEvent(t)};ol.pointer.PointerEventHandler.prototype.wrapMouseEvent=function(e,t){return this.makeEvent(e,ol.pointer.MouseSource.prepareEvent(t,this),t)};ol.pointer.PointerEventHandler.prototype.disposeInternal=function(){this.unregister_();ol.events.EventTarget.prototype.disposeInternal.call(this)};ol.pointer.PointerEventHandler.CLONE_PROPS=[["bubbles",!1],["cancelable",!1],["view",null],["detail",null],["screenX",0],["screenY",0],["clientX",0],["clientY",0],["ctrlKey",!1],["altKey",!1],["shiftKey",!1],["metaKey",!1],["button",0],["relatedTarget",null],["buttons",0],["pointerId",0],["width",0],["height",0],["pressure",0],["tiltX",0],["tiltY",0],["pointerType",""],["hwTimestamp",0],["isPrimary",!1],["type",""],["target",null],["currentTarget",null],["which",0]];goog.provide("ol.MapBrowserEventHandler");goog.require("ol");goog.require("ol.has");goog.require("ol.MapBrowserEventType");goog.require("ol.MapBrowserPointerEvent");goog.require("ol.events");goog.require("ol.events.EventTarget");goog.require("ol.pointer.EventType");goog.require("ol.pointer.PointerEventHandler");ol.MapBrowserEventHandler=function(e,t){ol.events.EventTarget.call(this);this.map_=e;this.clickTimeoutId_=0;this.dragging_=!1;this.dragListenerKeys_=[];this.moveTolerance_=t?t*ol.has.DEVICE_PIXEL_RATIO:ol.has.DEVICE_PIXEL_RATIO;this.down_=null;var o=this.map_.getViewport();this.activePointers_=0;this.trackedTouches_={};this.pointerEventHandler_=new ol.pointer.PointerEventHandler(o);this.documentPointerEventHandler_=null;this.pointerdownListenerKey_=ol.events.listen(this.pointerEventHandler_,ol.pointer.EventType.POINTERDOWN,this.handlePointerDown_,this);this.relayedListenerKey_=ol.events.listen(this.pointerEventHandler_,ol.pointer.EventType.POINTERMOVE,this.relayEvent_,this)};ol.inherits(ol.MapBrowserEventHandler,ol.events.EventTarget);ol.MapBrowserEventHandler.prototype.emulateClick_=function(e){var t=new ol.MapBrowserPointerEvent(ol.MapBrowserEventType.CLICK,this.map_,e);this.dispatchEvent(t);if(0!==this.clickTimeoutId_){clearTimeout(this.clickTimeoutId_);this.clickTimeoutId_=0;t=new ol.MapBrowserPointerEvent(ol.MapBrowserEventType.DBLCLICK,this.map_,e);this.dispatchEvent(t)}else this.clickTimeoutId_=setTimeout(function(){this.clickTimeoutId_=0;var t=new ol.MapBrowserPointerEvent(ol.MapBrowserEventType.SINGLECLICK,this.map_,e);this.dispatchEvent(t)}.bind(this),250)};ol.MapBrowserEventHandler.prototype.updateActivePointers_=function(e){var t=e;t.type==ol.MapBrowserEventType.POINTERUP||t.type==ol.MapBrowserEventType.POINTERCANCEL?delete this.trackedTouches_[t.pointerId]:t.type==ol.MapBrowserEventType.POINTERDOWN&&(this.trackedTouches_[t.pointerId]=!0);this.activePointers_=Object.keys(this.trackedTouches_).length};ol.MapBrowserEventHandler.prototype.handlePointerUp_=function(e){this.updateActivePointers_(e);var t=new ol.MapBrowserPointerEvent(ol.MapBrowserEventType.POINTERUP,this.map_,e);this.dispatchEvent(t);t.propagationStopped||this.dragging_||!this.isMouseActionButton_(e)||this.emulateClick_(this.down_);if(0===this.activePointers_){this.dragListenerKeys_.forEach(ol.events.unlistenByKey);this.dragListenerKeys_.length=0;this.dragging_=!1;this.down_=null;this.documentPointerEventHandler_.dispose();this.documentPointerEventHandler_=null}};ol.MapBrowserEventHandler.prototype.isMouseActionButton_=function(e){return 0===e.button};ol.MapBrowserEventHandler.prototype.handlePointerDown_=function(e){this.updateActivePointers_(e);var t=new ol.MapBrowserPointerEvent(ol.MapBrowserEventType.POINTERDOWN,this.map_,e);this.dispatchEvent(t);this.down_=e;if(0===this.dragListenerKeys_.length){this.documentPointerEventHandler_=new ol.pointer.PointerEventHandler(document);this.dragListenerKeys_.push(ol.events.listen(this.documentPointerEventHandler_,ol.MapBrowserEventType.POINTERMOVE,this.handlePointerMove_,this),ol.events.listen(this.documentPointerEventHandler_,ol.MapBrowserEventType.POINTERUP,this.handlePointerUp_,this),ol.events.listen(this.pointerEventHandler_,ol.MapBrowserEventType.POINTERCANCEL,this.handlePointerUp_,this))}};ol.MapBrowserEventHandler.prototype.handlePointerMove_=function(e){if(this.isMoving_(e)){this.dragging_=!0;var t=new ol.MapBrowserPointerEvent(ol.MapBrowserEventType.POINTERDRAG,this.map_,e,this.dragging_);this.dispatchEvent(t)}e.preventDefault()};ol.MapBrowserEventHandler.prototype.relayEvent_=function(e){var t=!(!this.down_||!this.isMoving_(e));this.dispatchEvent(new ol.MapBrowserPointerEvent(e.type,this.map_,e,t))};ol.MapBrowserEventHandler.prototype.isMoving_=function(e){return Math.abs(e.clientX-this.down_.clientX)>this.moveTolerance_||Math.abs(e.clientY-this.down_.clientY)>this.moveTolerance_};ol.MapBrowserEventHandler.prototype.disposeInternal=function(){if(this.relayedListenerKey_){ol.events.unlistenByKey(this.relayedListenerKey_);this.relayedListenerKey_=null}if(this.pointerdownListenerKey_){ol.events.unlistenByKey(this.pointerdownListenerKey_);this.pointerdownListenerKey_=null}this.dragListenerKeys_.forEach(ol.events.unlistenByKey);this.dragListenerKeys_.length=0;if(this.documentPointerEventHandler_){this.documentPointerEventHandler_.dispose();this.documentPointerEventHandler_=null}if(this.pointerEventHandler_){this.pointerEventHandler_.dispose();this.pointerEventHandler_=null}ol.events.EventTarget.prototype.disposeInternal.call(this)};goog.provide("ol.MapEventType");ol.MapEventType={POSTRENDER:"postrender",MOVESTART:"movestart",MOVEEND:"moveend"};goog.provide("ol.MapProperty");ol.MapProperty={LAYERGROUP:"layergroup",SIZE:"size",TARGET:"target",VIEW:"view"};goog.provide("ol.TileState");ol.TileState={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4,ABORT:5};goog.provide("ol.structs.PriorityQueue");goog.require("ol.asserts");goog.require("ol.obj");ol.structs.PriorityQueue=function(e,t){this.priorityFunction_=e;this.keyFunction_=t;this.elements_=[];this.priorities_=[];this.queuedElements_={}};ol.structs.PriorityQueue.DROP=1/0;ol.structs.PriorityQueue.prototype.clear=function(){this.elements_.length=0;this.priorities_.length=0;ol.obj.clear(this.queuedElements_)};ol.structs.PriorityQueue.prototype.dequeue=function(){var e=this.elements_,t=this.priorities_,o=e[0];if(1==e.length){e.length=0;t.length=0}else{e[0]=e.pop();t[0]=t.pop();this.siftUp_(0)}var r=this.keyFunction_(o);delete this.queuedElements_[r];return o};ol.structs.PriorityQueue.prototype.enqueue=function(e){ol.asserts.assert(!(this.keyFunction_(e)in this.queuedElements_),31);var t=this.priorityFunction_(e);if(t!=ol.structs.PriorityQueue.DROP){this.elements_.push(e);this.priorities_.push(t);this.queuedElements_[this.keyFunction_(e)]=!0;this.siftDown_(0,this.elements_.length-1);return!0}return!1};ol.structs.PriorityQueue.prototype.getCount=function(){return this.elements_.length};ol.structs.PriorityQueue.prototype.getLeftChildIndex_=function(e){return 2*e+1};ol.structs.PriorityQueue.prototype.getRightChildIndex_=function(e){return 2*e+2};ol.structs.PriorityQueue.prototype.getParentIndex_=function(e){return e-1>>1};ol.structs.PriorityQueue.prototype.heapify_=function(){var e;for(e=(this.elements_.length>>1)-1;e>=0;e--)this.siftUp_(e)};ol.structs.PriorityQueue.prototype.isEmpty=function(){return 0===this.elements_.length};ol.structs.PriorityQueue.prototype.isKeyQueued=function(e){return e in this.queuedElements_};ol.structs.PriorityQueue.prototype.isQueued=function(e){return this.isKeyQueued(this.keyFunction_(e))};ol.structs.PriorityQueue.prototype.siftUp_=function(e){for(var t=this.elements_,o=this.priorities_,r=t.length,i=t[e],n=o[e],a=e;e<r>>1;){var l=this.getLeftChildIndex_(e),s=this.getRightChildIndex_(e),p=s<r&&o[s]<o[l]?s:l;t[e]=t[p];o[e]=o[p];e=p}t[e]=i;o[e]=n;this.siftDown_(a,e)};ol.structs.PriorityQueue.prototype.siftDown_=function(e,t){for(var o=this.elements_,r=this.priorities_,i=o[t],n=r[t];t>e;){var a=this.getParentIndex_(t);if(!(r[a]>n))break;o[t]=o[a];r[t]=r[a];t=a}o[t]=i;r[t]=n};ol.structs.PriorityQueue.prototype.reprioritize=function(){var e,t,o,r=this.priorityFunction_,i=this.elements_,n=this.priorities_,a=0,l=i.length;for(t=0;t<l;++t)if((o=r(e=i[t]))==ol.structs.PriorityQueue.DROP)delete this.queuedElements_[this.keyFunction_(e)];else{n[a]=o;i[a++]=e}i.length=a;n.length=a;this.heapify_()};goog.provide("ol.TileQueue");goog.require("ol");goog.require("ol.TileState");goog.require("ol.events");goog.require("ol.events.EventType");goog.require("ol.structs.PriorityQueue");ol.TileQueue=function(e,t){ol.structs.PriorityQueue.call(this,function(t){return e.apply(null,t)},function(e){return e[0].getKey()});this.tileChangeCallback_=t;this.tilesLoading_=0;this.tilesLoadingKeys_={}};ol.inherits(ol.TileQueue,ol.structs.PriorityQueue);ol.TileQueue.prototype.enqueue=function(e){var t=ol.structs.PriorityQueue.prototype.enqueue.call(this,e);if(t){var o=e[0];ol.events.listen(o,ol.events.EventType.CHANGE,this.handleTileChange,this)}return t};ol.TileQueue.prototype.getTilesLoading=function(){return this.tilesLoading_};ol.TileQueue.prototype.handleTileChange=function(e){var t=e.target,o=t.getState();if(o===ol.TileState.LOADED||o===ol.TileState.ERROR||o===ol.TileState.EMPTY||o===ol.TileState.ABORT){ol.events.unlisten(t,ol.events.EventType.CHANGE,this.handleTileChange,this);var r=t.getKey();if(r in this.tilesLoadingKeys_){delete this.tilesLoadingKeys_[r];--this.tilesLoading_}this.tileChangeCallback_()}};ol.TileQueue.prototype.loadMoreTiles=function(e,t){for(var o,r,i,n=0,a=!1;this.tilesLoading_<e&&n<t&&this.getCount()>0;){i=(r=this.dequeue()[0]).getKey();if((o=r.getState())===ol.TileState.ABORT)a=!0;else if(o===ol.TileState.IDLE&&!(i in this.tilesLoadingKeys_)){this.tilesLoadingKeys_[i]=!0;++this.tilesLoading_;++n;r.load()}}0===n&&a&&this.tileChangeCallback_()};goog.provide("ol.CenterConstraint");goog.require("ol.math");ol.CenterConstraint.createExtent=function(e){return function(t){return t?[ol.math.clamp(t[0],e[0],e[2]),ol.math.clamp(t[1],e[1],e[3])]:void 0}};ol.CenterConstraint.none=function(e){return e};goog.provide("ol.ResolutionConstraint");goog.require("ol.array");goog.require("ol.math");ol.ResolutionConstraint.createSnapToResolutions=function(e){return function(t,o,r){if(void 0!==t){var i=ol.array.linearFindNearest(e,t,r);i=ol.math.clamp(i+o,0,e.length-1);var n=Math.floor(i);if(i!=n&&n<e.length-1){var a=e[n]/e[n+1];return e[n]/Math.pow(a,i-n)}return e[n]}}};ol.ResolutionConstraint.createSnapToPower=function(e,t,o){return function(r,i,n){if(void 0!==r){var a=-n/2+.5,l=Math.floor(Math.log(t/r)/Math.log(e)+a),s=Math.max(l+i,0);void 0!==o&&(s=Math.min(s,o));return t/Math.pow(e,s)}}};goog.provide("ol.RotationConstraint");goog.require("ol.math");ol.RotationConstraint.disable=function(e,t){return void 0!==e?0:void 0};ol.RotationConstraint.none=function(e,t){return void 0!==e?e+t:void 0};ol.RotationConstraint.createSnapToN=function(e){var t=2*Math.PI/e;return function(e,o){return void 0!==e?e=Math.floor((e+o)/t+.5)*t:void 0}};ol.RotationConstraint.createSnapToZero=function(e){var t=e||ol.math.toRadians(5);return function(e,o){return void 0!==e?Math.abs(e+o)<=t?0:e+o:void 0}};goog.provide("ol.ViewHint");ol.ViewHint={ANIMATING:0,INTERACTING:1};goog.provide("ol.ViewProperty");ol.ViewProperty={CENTER:"center",RESOLUTION:"resolution",ROTATION:"rotation"};goog.provide("ol.string");ol.string.padNumber=function(e,t,o){var r=void 0!==o?e.toFixed(o):""+e,i=r.indexOf(".");return(i=-1===i?r.length:i)>t?r:new Array(1+t-i).join("0")+r};ol.string.compareVersions=function(e,t){for(var o=(""+e).split("."),r=(""+t).split("."),i=0;i<Math.max(o.length,r.length);i++){var n=parseInt(o[i]||"0",10),a=parseInt(r[i]||"0",10);if(n>a)return 1;if(a>n)return-1}return 0};goog.provide("ol.coordinate");goog.require("ol.math");goog.require("ol.string");ol.coordinate.add=function(e,t){e[0]+=t[0];e[1]+=t[1];return e};ol.coordinate.closestOnCircle=function(e,t){var o=t.getRadius(),r=t.getCenter(),i=r[0],n=r[1],a=e[0]-i,l=e[1]-n;0===a&&0===l&&(a=1);var s=Math.sqrt(a*a+l*l);return[i+o*a/s,n+o*l/s]};ol.coordinate.closestOnSegment=function(e,t){var o,r,i=e[0],n=e[1],a=t[0],l=t[1],s=a[0],p=a[1],c=l[0],u=l[1],g=c-s,d=u-p,h=0===g&&0===d?0:(g*(i-s)+d*(n-p))/(g*g+d*d||0);if(h<=0){o=s;r=p}else if(h>=1){o=c;r=u}else{o=s+h*g;r=p+h*d}return[o,r]};ol.coordinate.createStringXY=function(e){return function(t){return ol.coordinate.toStringXY(t,e)}};ol.coordinate.degreesToStringHDMS=function(e,t,o){var r=ol.math.modulo(t+180,360)-180,i=Math.abs(3600*r),n=o||0,a=Math.pow(10,n),l=Math.floor(i/3600),s=Math.floor((i-3600*l)/60),p=i-3600*l-60*s;if((p=Math.ceil(p*a)/a)>=60){p=0;s+=1}if(s>=60){s=0;l+=1}return l+"\xb0 "+ol.string.padNumber(s,2)+"\u2032 "+ol.string.padNumber(p,2,n)+"\u2033"+(0==r?"":" "+e.charAt(r<0?1:0))};ol.coordinate.format=function(e,t,o){return e?t.replace("{x}",e[0].toFixed(o)).replace("{y}",e[1].toFixed(o)):""};ol.coordinate.equals=function(e,t){for(var o=!0,r=e.length-1;r>=0;--r)if(e[r]!=t[r]){o=!1;break}return o};ol.coordinate.rotate=function(e,t){var o=Math.cos(t),r=Math.sin(t),i=e[0]*o-e[1]*r,n=e[1]*o+e[0]*r;e[0]=i;e[1]=n;return e};ol.coordinate.scale=function(e,t){e[0]*=t;e[1]*=t;return e};ol.coordinate.sub=function(e,t){e[0]-=t[0];e[1]-=t[1];return e};ol.coordinate.squaredDistance=function(e,t){var o=e[0]-t[0],r=e[1]-t[1];return o*o+r*r};ol.coordinate.distance=function(e,t){return Math.sqrt(ol.coordinate.squaredDistance(e,t))};ol.coordinate.squaredDistanceToSegment=function(e,t){return ol.coordinate.squaredDistance(e,ol.coordinate.closestOnSegment(e,t))};ol.coordinate.toStringHDMS=function(e,t){return e?ol.coordinate.degreesToStringHDMS("NS",e[1],t)+" "+ol.coordinate.degreesToStringHDMS("EW",e[0],t):""};ol.coordinate.toStringXY=function(e,t){return ol.coordinate.format(e,"{x}, {y}",t)};goog.provide("ol.easing");ol.easing.easeIn=function(e){return Math.pow(e,3)};ol.easing.easeOut=function(e){return 1-ol.easing.easeIn(1-e)};ol.easing.inAndOut=function(e){return 3*e*e-2*e*e*e};ol.easing.linear=function(e){return e};ol.easing.upAndDown=function(e){return e<.5?ol.easing.inAndOut(2*e):1-ol.easing.inAndOut(2*(e-.5))};goog.provide("ol.geom.GeometryLayout");ol.geom.GeometryLayout={XY:"XY",XYZ:"XYZ",XYM:"XYM",XYZM:"XYZM"};goog.provide("ol.functions");ol.functions.TRUE=function(){return!0};ol.functions.FALSE=function(){return!1};goog.provide("ol.geom.flat.transform");ol.geom.flat.transform.transform2D=function(e,t,o,r,i,n){var a,l=n||[],s=0;for(a=t;a<o;a+=r){var p=e[a],c=e[a+1];l[s++]=i[0]*p+i[2]*c+i[4];l[s++]=i[1]*p+i[3]*c+i[5]}n&&l.length!=s&&(l.length=s);return l};ol.geom.flat.transform.rotate=function(e,t,o,r,i,n,a){for(var l=a||[],s=Math.cos(i),p=Math.sin(i),c=n[0],u=n[1],g=0,d=t;d<o;d+=r){var h=e[d]-c,f=e[d+1]-u;l[g++]=c+h*s-f*p;l[g++]=u+h*p+f*s;for(var y=d+2;y<d+r;++y)l[g++]=e[y]}a&&l.length!=g&&(l.length=g);return l};ol.geom.flat.transform.scale=function(e,t,o,r,i,n,a,l){for(var s=l||[],p=a[0],c=a[1],u=0,g=t;g<o;g+=r){var d=e[g]-p,h=e[g+1]-c;s[u++]=p+i*d;s[u++]=c+n*h;for(var f=g+2;f<g+r;++f)s[u++]=e[f]}l&&s.length!=u&&(s.length=u);return s};ol.geom.flat.transform.translate=function(e,t,o,r,i,n,a){var l,s,p=a||[],c=0;for(l=t;l<o;l+=r){p[c++]=e[l]+i;p[c++]=e[l+1]+n;for(s=l+2;s<l+r;++s)p[c++]=e[s]}a&&p.length!=c&&(p.length=c);return p};goog.provide("ol.transform");goog.require("ol.asserts");ol.transform.tmp_=new Array(6);ol.transform.create=function(){return[1,0,0,1,0,0]};ol.transform.reset=function(e){return ol.transform.set(e,1,0,0,1,0,0)};ol.transform.multiply=function(e,t){var o=e[0],r=e[1],i=e[2],n=e[3],a=e[4],l=e[5],s=t[0],p=t[1],c=t[2],u=t[3],g=t[4],d=t[5];e[0]=o*s+i*p;e[1]=r*s+n*p;e[2]=o*c+i*u;e[3]=r*c+n*u;e[4]=o*g+i*d+a;e[5]=r*g+n*d+l;return e};ol.transform.set=function(e,t,o,r,i,n,a){e[0]=t;e[1]=o;e[2]=r;e[3]=i;e[4]=n;e[5]=a;return e};ol.transform.setFromArray=function(e,t){e[0]=t[0];e[1]=t[1];e[2]=t[2];e[3]=t[3];e[4]=t[4];e[5]=t[5];return e};ol.transform.apply=function(e,t){var o=t[0],r=t[1];t[0]=e[0]*o+e[2]*r+e[4];t[1]=e[1]*o+e[3]*r+e[5];return t};ol.transform.rotate=function(e,t){var o=Math.cos(t),r=Math.sin(t);return ol.transform.multiply(e,ol.transform.set(ol.transform.tmp_,o,r,-r,o,0,0))};ol.transform.scale=function(e,t,o){return ol.transform.multiply(e,ol.transform.set(ol.transform.tmp_,t,0,0,o,0,0))};ol.transform.translate=function(e,t,o){return ol.transform.multiply(e,ol.transform.set(ol.transform.tmp_,1,0,0,1,t,o))};ol.transform.compose=function(e,t,o,r,i,n,a,l){var s=Math.sin(n),p=Math.cos(n);e[0]=r*p;e[1]=i*s;e[2]=-r*s;e[3]=i*p;e[4]=a*r*p-l*r*s+t;e[5]=a*i*s+l*i*p+o;return e};ol.transform.invert=function(e){var t=ol.transform.determinant(e);ol.asserts.assert(0!==t,32);var o=e[0],r=e[1],i=e[2],n=e[3],a=e[4],l=e[5];e[0]=n/t;e[1]=-r/t;e[2]=-i/t;e[3]=o/t;e[4]=(i*l-n*a)/t;e[5]=-(o*l-r*a)/t;return e};ol.transform.determinant=function(e){return e[0]*e[3]-e[1]*e[2]};goog.provide("ol.geom.Geometry");goog.require("ol");goog.require("ol.Object");goog.require("ol.extent");goog.require("ol.functions");goog.require("ol.geom.flat.transform");goog.require("ol.proj");goog.require("ol.proj.Units");goog.require("ol.transform");ol.geom.Geometry=function(){ol.Object.call(this);this.extent_=ol.extent.createEmpty();this.extentRevision_=-1;this.simplifiedGeometryCache={};this.simplifiedGeometryMaxMinSquaredTolerance=0;this.simplifiedGeometryRevision=0;this.tmpTransform_=ol.transform.create()};ol.inherits(ol.geom.Geometry,ol.Object);ol.geom.Geometry.prototype.clone=function(){};ol.geom.Geometry.prototype.closestPointXY=function(e,t,o,r){};ol.geom.Geometry.prototype.getClosestPoint=function(e,t){var o=t||[NaN,NaN];this.closestPointXY(e[0],e[1],o,1/0);return o};ol.geom.Geometry.prototype.intersectsCoordinate=function(e){return this.containsXY(e[0],e[1])};ol.geom.Geometry.prototype.computeExtent=function(e){};ol.geom.Geometry.prototype.containsXY=ol.functions.FALSE;ol.geom.Geometry.prototype.getExtent=function(e){if(this.extentRevision_!=this.getRevision()){this.extent_=this.computeExtent(this.extent_);this.extentRevision_=this.getRevision()}return ol.extent.returnOrUpdate(this.extent_,e)};ol.geom.Geometry.prototype.rotate=function(e,t){};ol.geom.Geometry.prototype.scale=function(e,t,o){};ol.geom.Geometry.prototype.simplify=function(e){return this.getSimplifiedGeometry(e*e)};ol.geom.Geometry.prototype.getSimplifiedGeometry=function(e){};ol.geom.Geometry.prototype.getType=function(){};ol.geom.Geometry.prototype.applyTransform=function(e){};ol.geom.Geometry.prototype.intersectsExtent=function(e){};ol.geom.Geometry.prototype.translate=function(e,t){};ol.geom.Geometry.prototype.transform=function(e,t){var o=this.tmpTransform_,r=(e=ol.proj.get(e)).getUnits()==ol.proj.Units.TILE_PIXELS?function(r,i,n){var a=e.getExtent(),l=e.getWorldExtent(),s=ol.extent.getHeight(l)/ol.extent.getHeight(a);ol.transform.compose(o,l[0],l[3],s,-s,0,0,0);ol.geom.flat.transform.transform2D(r,0,r.length,n,o,i);return ol.proj.getTransform(e,t)(r,i,n)}:ol.proj.getTransform(e,t);this.applyTransform(r);return this};goog.provide("ol.geom.SimpleGeometry");goog.require("ol");goog.require("ol.functions");goog.require("ol.extent");goog.require("ol.geom.Geometry");goog.require("ol.geom.GeometryLayout");goog.require("ol.geom.flat.transform");goog.require("ol.obj");ol.geom.SimpleGeometry=function(){ol.geom.Geometry.call(this);this.layout=ol.geom.GeometryLayout.XY;this.stride=2;this.flatCoordinates=null};ol.inherits(ol.geom.SimpleGeometry,ol.geom.Geometry);ol.geom.SimpleGeometry.getLayoutForStride_=function(e){var t;2==e?t=ol.geom.GeometryLayout.XY:3==e?t=ol.geom.GeometryLayout.XYZ:4==e&&(t=ol.geom.GeometryLayout.XYZM);return t};ol.geom.SimpleGeometry.getStrideForLayout=function(e){var t;e==ol.geom.GeometryLayout.XY?t=2:e==ol.geom.GeometryLayout.XYZ||e==ol.geom.GeometryLayout.XYM?t=3:e==ol.geom.GeometryLayout.XYZM&&(t=4);return t};ol.geom.SimpleGeometry.prototype.containsXY=ol.functions.FALSE;ol.geom.SimpleGeometry.prototype.computeExtent=function(e){return ol.extent.createOrUpdateFromFlatCoordinates(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e)};ol.geom.SimpleGeometry.prototype.getCoordinates=function(){};ol.geom.SimpleGeometry.prototype.getFirstCoordinate=function(){return this.flatCoordinates.slice(0,this.stride)};ol.geom.SimpleGeometry.prototype.getFlatCoordinates=function(){return this.flatCoordinates};ol.geom.SimpleGeometry.prototype.getLastCoordinate=function(){return this.flatCoordinates.slice(this.flatCoordinates.length-this.stride)};ol.geom.SimpleGeometry.prototype.getLayout=function(){return this.layout};ol.geom.SimpleGeometry.prototype.getSimplifiedGeometry=function(e){if(this.simplifiedGeometryRevision!=this.getRevision()){ol.obj.clear(this.simplifiedGeometryCache);this.simplifiedGeometryMaxMinSquaredTolerance=0;this.simplifiedGeometryRevision=this.getRevision()}if(e<0||0!==this.simplifiedGeometryMaxMinSquaredTolerance&&e<=this.simplifiedGeometryMaxMinSquaredTolerance)return this;var t=e.toString();if(this.simplifiedGeometryCache.hasOwnProperty(t))return this.simplifiedGeometryCache[t];var o=this.getSimplifiedGeometryInternal(e);if(o.getFlatCoordinates().length<this.flatCoordinates.length){this.simplifiedGeometryCache[t]=o;return o}this.simplifiedGeometryMaxMinSquaredTolerance=e;return this};ol.geom.SimpleGeometry.prototype.getSimplifiedGeometryInternal=function(e){return this};ol.geom.SimpleGeometry.prototype.getStride=function(){return this.stride};ol.geom.SimpleGeometry.prototype.setFlatCoordinatesInternal=function(e,t){this.stride=ol.geom.SimpleGeometry.getStrideForLayout(e);this.layout=e;this.flatCoordinates=t};ol.geom.SimpleGeometry.prototype.setCoordinates=function(e,t){};ol.geom.SimpleGeometry.prototype.setLayout=function(e,t,o){var r;if(e)r=ol.geom.SimpleGeometry.getStrideForLayout(e);else{var i;for(i=0;i<o;++i){if(0===t.length){this.layout=ol.geom.GeometryLayout.XY;this.stride=2;return}t=t[0]}r=t.length;e=ol.geom.SimpleGeometry.getLayoutForStride_(r)}this.layout=e;this.stride=r};ol.geom.SimpleGeometry.prototype.applyTransform=function(e){if(this.flatCoordinates){e(this.flatCoordinates,this.flatCoordinates,this.stride);this.changed()}};ol.geom.SimpleGeometry.prototype.rotate=function(e,t){var o=this.getFlatCoordinates();if(o){var r=this.getStride();ol.geom.flat.transform.rotate(o,0,o.length,r,e,t,o);this.changed()}};ol.geom.SimpleGeometry.prototype.scale=function(e,t,o){var r=t;void 0===r&&(r=e);var i=o;i||(i=ol.extent.getCenter(this.getExtent()));var n=this.getFlatCoordinates();if(n){var a=this.getStride();ol.geom.flat.transform.scale(n,0,n.length,a,e,r,i,n);this.changed()}};ol.geom.SimpleGeometry.prototype.translate=function(e,t){var o=this.getFlatCoordinates();if(o){var r=this.getStride();ol.geom.flat.transform.translate(o,0,o.length,r,e,t,o);this.changed()}};ol.geom.SimpleGeometry.transform2D=function(e,t,o){var r=e.getFlatCoordinates();if(r){var i=e.getStride();return ol.geom.flat.transform.transform2D(r,0,r.length,i,t,o)}return null};goog.provide("ol.geom.flat.area");ol.geom.flat.area.linearRing=function(e,t,o,r){for(var i=0,n=e[o-r],a=e[o-r+1];t<o;t+=r){var l=e[t],s=e[t+1];i+=a*l-n*s;n=l;a=s}return i/2};ol.geom.flat.area.linearRings=function(e,t,o,r){var i,n,a=0;for(i=0,n=o.length;i<n;++i){var l=o[i];a+=ol.geom.flat.area.linearRing(e,t,l,r);t=l}return a};ol.geom.flat.area.linearRingss=function(e,t,o,r){var i,n,a=0;for(i=0,n=o.length;i<n;++i){var l=o[i];a+=ol.geom.flat.area.linearRings(e,t,l,r);t=l[l.length-1]}return a};goog.provide("ol.geom.flat.closest");goog.require("ol.math");ol.geom.flat.closest.point=function(e,t,o,r,i,n,a){var l,s,p=e[t],c=e[t+1],u=e[o]-p,g=e[o+1]-c;if(0===u&&0===g)s=t;else{var d=((i-p)*u+(n-c)*g)/(u*u+g*g);if(d>1)s=o;else{if(d>0){for(l=0;l<r;++l)a[l]=ol.math.lerp(e[t+l],e[o+l],d);a.length=r;return}s=t}}for(l=0;l<r;++l)a[l]=e[s+l];a.length=r};ol.geom.flat.closest.getMaxSquaredDelta=function(e,t,o,r,i){var n=e[t],a=e[t+1];for(t+=r;t<o;t+=r){var l=e[t],s=e[t+1],p=ol.math.squaredDistance(n,a,l,s);p>i&&(i=p);n=l;a=s}return i};ol.geom.flat.closest.getsMaxSquaredDelta=function(e,t,o,r,i){var n,a;for(n=0,a=o.length;n<a;++n){var l=o[n];i=ol.geom.flat.closest.getMaxSquaredDelta(e,t,l,r,i);t=l}return i};ol.geom.flat.closest.getssMaxSquaredDelta=function(e,t,o,r,i){var n,a;for(n=0,a=o.length;n<a;++n){var l=o[n];i=ol.geom.flat.closest.getsMaxSquaredDelta(e,t,l,r,i);t=l[l.length-1]}return i};ol.geom.flat.closest.getClosestPoint=function(e,t,o,r,i,n,a,l,s,p,c){if(t==o)return p;var u,g;if(0===i){if((g=ol.math.squaredDistance(a,l,e[t],e[t+1]))<p){for(u=0;u<r;++u)s[u]=e[t+u];s.length=r;return g}return p}for(var d=c||[NaN,NaN],h=t+r;h<o;){ol.geom.flat.closest.point(e,h-r,h,r,a,l,d);if((g=ol.math.squaredDistance(a,l,d[0],d[1]))<p){p=g;for(u=0;u<r;++u)s[u]=d[u];s.length=r;h+=r}else h+=r*Math.max((Math.sqrt(g)-Math.sqrt(p))/i|0,1)}if(n){ol.geom.flat.closest.point(e,o-r,t,r,a,l,d);if((g=ol.math.squaredDistance(a,l,d[0],d[1]))<p){p=g;for(u=0;u<r;++u)s[u]=d[u];s.length=r}}return p};ol.geom.flat.closest.getsClosestPoint=function(e,t,o,r,i,n,a,l,s,p,c){var u,g,d=c||[NaN,NaN];for(u=0,g=o.length;u<g;++u){var h=o[u];p=ol.geom.flat.closest.getClosestPoint(e,t,h,r,i,n,a,l,s,p,d);t=h}return p};ol.geom.flat.closest.getssClosestPoint=function(e,t,o,r,i,n,a,l,s,p,c){var u,g,d=c||[NaN,NaN];for(u=0,g=o.length;u<g;++u){var h=o[u];p=ol.geom.flat.closest.getsClosestPoint(e,t,h,r,i,n,a,l,s,p,d);t=h[h.length-1]}return p};goog.provide("ol.geom.flat.deflate");ol.geom.flat.deflate.coordinate=function(e,t,o,r){var i,n;for(i=0,n=o.length;i<n;++i)e[t++]=o[i];return t};ol.geom.flat.deflate.coordinates=function(e,t,o,r){var i,n;for(i=0,n=o.length;i<n;++i){var a,l=o[i];for(a=0;a<r;++a)e[t++]=l[a]}return t};ol.geom.flat.deflate.coordinatess=function(e,t,o,r,i){var n,a,l=i||[],s=0;for(n=0,a=o.length;n<a;++n){var p=ol.geom.flat.deflate.coordinates(e,t,o[n],r);l[s++]=p;t=p}l.length=s;return l};ol.geom.flat.deflate.coordinatesss=function(e,t,o,r,i){var n,a,l=i||[],s=0;for(n=0,a=o.length;n<a;++n){var p=ol.geom.flat.deflate.coordinatess(e,t,o[n],r,l[s]);l[s++]=p;t=p[p.length-1]}l.length=s;return l};goog.provide("ol.geom.flat.inflate");ol.geom.flat.inflate.coordinates=function(e,t,o,r,i){var n,a=void 0!==i?i:[],l=0;for(n=t;n<o;n+=r)a[l++]=e.slice(n,n+r);a.length=l;return a};ol.geom.flat.inflate.coordinatess=function(e,t,o,r,i){var n,a,l=void 0!==i?i:[],s=0;for(n=0,a=o.length;n<a;++n){var p=o[n];l[s++]=ol.geom.flat.inflate.coordinates(e,t,p,r,l[s]);t=p}l.length=s;return l};ol.geom.flat.inflate.coordinatesss=function(e,t,o,r,i){var n,a,l=void 0!==i?i:[],s=0;for(n=0,a=o.length;n<a;++n){var p=o[n];l[s++]=ol.geom.flat.inflate.coordinatess(e,t,p,r,l[s]);t=p[p.length-1]}l.length=s;return l};goog.provide("ol.geom.flat.simplify");goog.require("ol.math");ol.geom.flat.simplify.lineString=function(e,t,o,r,i,n,a){var l=void 0!==a?a:[];if(!n){o=ol.geom.flat.simplify.radialDistance(e,t,o,r,i,l,0);e=l;t=0;r=2}l.length=ol.geom.flat.simplify.douglasPeucker(e,t,o,r,i,l,0);return l};ol.geom.flat.simplify.douglasPeucker=function(e,t,o,r,i,n,a){var l=(o-t)/r;if(l<3){for(;t<o;t+=r){n[a++]=e[t];n[a++]=e[t+1]}return a}var s=new Array(l);s[0]=1;s[l-1]=1;for(var p,c=[t,o-r],u=0;c.length>0;){var g=c.pop(),d=c.pop(),h=0,f=e[d],y=e[d+1],m=e[g],v=e[g+1];for(p=d+r;p<g;p+=r){var C=e[p],T=e[p+1],S=ol.math.squaredSegmentDistance(C,T,f,y,m,v);if(S>h){u=p;h=S}}if(h>i){s[(u-t)/r]=1;d+r<u&&c.push(d,u);u+r<g&&c.push(u,g)}}for(p=0;p<l;++p)if(s[p]){n[a++]=e[t+p*r];n[a++]=e[t+p*r+1]}return a};ol.geom.flat.simplify.douglasPeuckers=function(e,t,o,r,i,n,a,l){var s,p;for(s=0,p=o.length;s<p;++s){var c=o[s];a=ol.geom.flat.simplify.douglasPeucker(e,t,c,r,i,n,a);l.push(a);t=c}return a};ol.geom.flat.simplify.douglasPeuckerss=function(e,t,o,r,i,n,a,l){var s,p;for(s=0,p=o.length;s<p;++s){var c=o[s],u=[];a=ol.geom.flat.simplify.douglasPeuckers(e,t,c,r,i,n,a,u);l.push(u);t=c[c.length-1]}return a};ol.geom.flat.simplify.radialDistance=function(e,t,o,r,i,n,a){if(o<=t+r){for(;t<o;t+=r){n[a++]=e[t];n[a++]=e[t+1]}return a}var l=e[t],s=e[t+1];n[a++]=l;n[a++]=s;var p=l,c=s;for(t+=r;t<o;t+=r){p=e[t];c=e[t+1];if(ol.math.squaredDistance(l,s,p,c)>i){n[a++]=p;n[a++]=c;l=p;s=c}}if(p!=l||c!=s){n[a++]=p;n[a++]=c}return a};ol.geom.flat.simplify.snap=function(e,t){return t*Math.round(e/t)};ol.geom.flat.simplify.quantize=function(e,t,o,r,i,n,a){if(t==o)return a;var l,s,p=ol.geom.flat.simplify.snap(e[t],i),c=ol.geom.flat.simplify.snap(e[t+1],i);t+=r;n[a++]=p;n[a++]=c;do{l=ol.geom.flat.simplify.snap(e[t],i);s=ol.geom.flat.simplify.snap(e[t+1],i);if((t+=r)==o){n[a++]=l;n[a++]=s;return a}}while(l==p&&s==c);for(;t<o;){var u,g;u=ol.geom.flat.simplify.snap(e[t],i);g=ol.geom.flat.simplify.snap(e[t+1],i);t+=r;if(u!=l||g!=s){var d=l-p,h=s-c,f=u-p,y=g-c;if(d*y==h*f&&(d<0&&f<d||d==f||d>0&&f>d)&&(h<0&&y<h||h==y||h>0&&y>h)){l=u;s=g}else{n[a++]=l;n[a++]=s;p=l;c=s;l=u;s=g}}}n[a++]=l;n[a++]=s;return a};ol.geom.flat.simplify.quantizes=function(e,t,o,r,i,n,a,l){var s,p;for(s=0,p=o.length;s<p;++s){var c=o[s];a=ol.geom.flat.simplify.quantize(e,t,c,r,i,n,a);l.push(a);t=c}return a};ol.geom.flat.simplify.quantizess=function(e,t,o,r,i,n,a,l){var s,p;for(s=0,p=o.length;s<p;++s){var c=o[s],u=[];a=ol.geom.flat.simplify.quantizes(e,t,c,r,i,n,a,u);l.push(u);t=c[c.length-1]}return a};goog.provide("ol.geom.LinearRing");goog.require("ol");goog.require("ol.extent");goog.require("ol.geom.GeometryLayout");goog.require("ol.geom.GeometryType");goog.require("ol.geom.SimpleGeometry");goog.require("ol.geom.flat.area");goog.require("ol.geom.flat.closest");goog.require("ol.geom.flat.deflate");goog.require("ol.geom.flat.inflate");goog.require("ol.geom.flat.simplify");ol.geom.LinearRing=function(e,t){ol.geom.SimpleGeometry.call(this);this.maxDelta_=-1;this.maxDeltaRevision_=-1;this.setCoordinates(e,t)};ol.inherits(ol.geom.LinearRing,ol.geom.SimpleGeometry);ol.geom.LinearRing.prototype.clone=function(){var e=new ol.geom.LinearRing(null);e.setFlatCoordinates(this.layout,this.flatCoordinates.slice());return e};ol.geom.LinearRing.prototype.closestPointXY=function(e,t,o,r){if(r<ol.extent.closestSquaredDistanceXY(this.getExtent(),e,t))return r;if(this.maxDeltaRevision_!=this.getRevision()){this.maxDelta_=Math.sqrt(ol.geom.flat.closest.getMaxSquaredDelta(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0));this.maxDeltaRevision_=this.getRevision()}return ol.geom.flat.closest.getClosestPoint(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!0,e,t,o,r)};ol.geom.LinearRing.prototype.getArea=function(){return ol.geom.flat.area.linearRing(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)};ol.geom.LinearRing.prototype.getCoordinates=function(){return ol.geom.flat.inflate.coordinates(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)};ol.geom.LinearRing.prototype.getSimplifiedGeometryInternal=function(e){var t=[];t.length=ol.geom.flat.simplify.douglasPeucker(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,t,0);var o=new ol.geom.LinearRing(null);o.setFlatCoordinates(ol.geom.GeometryLayout.XY,t);return o};ol.geom.LinearRing.prototype.getType=function(){return ol.geom.GeometryType.LINEAR_RING};ol.geom.LinearRing.prototype.intersectsExtent=function(e){};ol.geom.LinearRing.prototype.setCoordinates=function(e,t){if(e){this.setLayout(t,e,1);this.flatCoordinates||(this.flatCoordinates=[]);this.flatCoordinates.length=ol.geom.flat.deflate.coordinates(this.flatCoordinates,0,e,this.stride);this.changed()}else this.setFlatCoordinates(ol.geom.GeometryLayout.XY,null)};ol.geom.LinearRing.prototype.setFlatCoordinates=function(e,t){this.setFlatCoordinatesInternal(e,t);this.changed()};goog.provide("ol.geom.Point");goog.require("ol");goog.require("ol.extent");goog.require("ol.geom.GeometryLayout");goog.require("ol.geom.GeometryType");goog.require("ol.geom.SimpleGeometry");goog.require("ol.geom.flat.deflate");goog.require("ol.math");ol.geom.Point=function(e,t){ol.geom.SimpleGeometry.call(this);this.setCoordinates(e,t)};ol.inherits(ol.geom.Point,ol.geom.SimpleGeometry);ol.geom.Point.prototype.clone=function(){var e=new ol.geom.Point(null);e.setFlatCoordinates(this.layout,this.flatCoordinates.slice());return e};ol.geom.Point.prototype.closestPointXY=function(e,t,o,r){var i=this.flatCoordinates,n=ol.math.squaredDistance(e,t,i[0],i[1]);if(n<r){var a,l=this.stride;for(a=0;a<l;++a)o[a]=i[a];o.length=l;return n}return r};ol.geom.Point.prototype.getCoordinates=function(){return this.flatCoordinates?this.flatCoordinates.slice():[]};ol.geom.Point.prototype.computeExtent=function(e){return ol.extent.createOrUpdateFromCoordinate(this.flatCoordinates,e)};ol.geom.Point.prototype.getType=function(){return ol.geom.GeometryType.POINT};ol.geom.Point.prototype.intersectsExtent=function(e){return ol.extent.containsXY(e,this.flatCoordinates[0],this.flatCoordinates[1])};ol.geom.Point.prototype.setCoordinates=function(e,t){if(e){this.setLayout(t,e,0);this.flatCoordinates||(this.flatCoordinates=[]);this.flatCoordinates.length=ol.geom.flat.deflate.coordinate(this.flatCoordinates,0,e,this.stride);this.changed()}else this.setFlatCoordinates(ol.geom.GeometryLayout.XY,null)};ol.geom.Point.prototype.setFlatCoordinates=function(e,t){this.setFlatCoordinatesInternal(e,t);this.changed()};goog.provide("ol.geom.flat.contains");goog.require("ol.extent");ol.geom.flat.contains.linearRingContainsExtent=function(e,t,o,r,i){return!ol.extent.forEachCorner(i,function(i){return!ol.geom.flat.contains.linearRingContainsXY(e,t,o,r,i[0],i[1])})};ol.geom.flat.contains.linearRingContainsXY=function(e,t,o,r,i,n){for(var a=0,l=e[o-r],s=e[o-r+1];t<o;t+=r){var p=e[t],c=e[t+1];s<=n?c>n&&(p-l)*(n-s)-(i-l)*(c-s)>0&&a++:c<=n&&(p-l)*(n-s)-(i-l)*(c-s)<0&&a--;l=p;s=c}return 0!==a};ol.geom.flat.contains.linearRingsContainsXY=function(e,t,o,r,i,n){if(0===o.length)return!1;if(!ol.geom.flat.contains.linearRingContainsXY(e,t,o[0],r,i,n))return!1;var a,l;for(a=1,l=o.length;a<l;++a)if(ol.geom.flat.contains.linearRingContainsXY(e,o[a-1],o[a],r,i,n))return!1;return!0};ol.geom.flat.contains.linearRingssContainsXY=function(e,t,o,r,i,n){if(0===o.length)return!1;var a,l;for(a=0,l=o.length;a<l;++a){var s=o[a];if(ol.geom.flat.contains.linearRingsContainsXY(e,t,s,r,i,n))return!0;t=s[s.length-1]}return!1};goog.provide("ol.geom.flat.interiorpoint");goog.require("ol.array");goog.require("ol.geom.flat.contains");ol.geom.flat.interiorpoint.linearRings=function(e,t,o,r,i,n,a){for(var l,s,p,c,u,g,d,h=i[n+1],f=[],y=0,m=o.length;y<m;++y){var v=o[y];c=e[v-r];g=e[v-r+1];for(l=t;l<v;l+=r){u=e[l];d=e[l+1];if(h<=g&&d<=h||g<=h&&h<=d){p=(h-g)/(d-g)*(u-c)+c;f.push(p)}c=u;g=d}}var C=NaN,T=-1/0;f.sort(ol.array.numberSafeCompareFunction);c=f[0];for(l=1,s=f.length;l<s;++l){u=f[l];var S=Math.abs(u-c);if(S>T){p=(c+u)/2;if(ol.geom.flat.contains.linearRingsContainsXY(e,t,o,r,p,h)){C=p;T=S}}c=u}isNaN(C)&&(C=i[n]);if(a){a.push(C,h,T);return a}return[C,h,T]};ol.geom.flat.interiorpoint.linearRingss=function(e,t,o,r,i){var n,a,l=[];for(n=0,a=o.length;n<a;++n){var s=o[n];l=ol.geom.flat.interiorpoint.linearRings(e,t,s,r,i,2*n,l);t=s[s.length-1]}return l};goog.provide("ol.geom.flat.segments");ol.geom.flat.segments.forEach=function(e,t,o,r,i,n){for(var a,l=[e[t],e[t+1]],s=[];t+r<o;t+=r){s[0]=e[t+r];s[1]=e[t+r+1];if(a=i.call(n,l,s))return a;l[0]=s[0];l[1]=s[1]}return!1};goog.provide("ol.geom.flat.intersectsextent");goog.require("ol.extent");goog.require("ol.geom.flat.contains");goog.require("ol.geom.flat.segments");ol.geom.flat.intersectsextent.lineString=function(e,t,o,r,i){var n=ol.extent.extendFlatCoordinates(ol.extent.createEmpty(),e,t,o,r);return!!ol.extent.intersects(i,n)&&(!!ol.extent.containsExtent(i,n)||(n[0]>=i[0]&&n[2]<=i[2]||(n[1]>=i[1]&&n[3]<=i[3]||ol.geom.flat.segments.forEach(e,t,o,r,function(e,t){return ol.extent.intersectsSegment(i,e,t)}))))};ol.geom.flat.intersectsextent.lineStrings=function(e,t,o,r,i){var n,a;for(n=0,a=o.length;n<a;++n){if(ol.geom.flat.intersectsextent.lineString(e,t,o[n],r,i))return!0;t=o[n]}return!1};ol.geom.flat.intersectsextent.linearRing=function(e,t,o,r,i){return!!ol.geom.flat.intersectsextent.lineString(e,t,o,r,i)||(!!ol.geom.flat.contains.linearRingContainsXY(e,t,o,r,i[0],i[1])||(!!ol.geom.flat.contains.linearRingContainsXY(e,t,o,r,i[0],i[3])||(!!ol.geom.flat.contains.linearRingContainsXY(e,t,o,r,i[2],i[1])||!!ol.geom.flat.contains.linearRingContainsXY(e,t,o,r,i[2],i[3]))))};ol.geom.flat.intersectsextent.linearRings=function(e,t,o,r,i){if(!ol.geom.flat.intersectsextent.linearRing(e,t,o[0],r,i))return!1;if(1===o.length)return!0;var n,a;for(n=1,a=o.length;n<a;++n)if(ol.geom.flat.contains.linearRingContainsExtent(e,o[n-1],o[n],r,i))return!1;return!0};ol.geom.flat.intersectsextent.linearRingss=function(e,t,o,r,i){var n,a;for(n=0,a=o.length;n<a;++n){var l=o[n];if(ol.geom.flat.intersectsextent.linearRings(e,t,l,r,i))return!0;t=l[l.length-1]}return!1};goog.provide("ol.geom.flat.reverse");ol.geom.flat.reverse.coordinates=function(e,t,o,r){for(;t<o-r;){var i;for(i=0;i<r;++i){var n=e[t+i];e[t+i]=e[o-r+i];e[o-r+i]=n}t+=r;o-=r}};goog.provide("ol.geom.flat.orient");goog.require("ol.geom.flat.reverse");ol.geom.flat.orient.linearRingIsClockwise=function(e,t,o,r){for(var i=0,n=e[o-r],a=e[o-r+1];t<o;t+=r){var l=e[t],s=e[t+1];i+=(l-n)*(s+a);n=l;a=s}return i>0};ol.geom.flat.orient.linearRingsAreOriented=function(e,t,o,r,i){var n,a,l=void 0!==i&&i;for(n=0,a=o.length;n<a;++n){var s=o[n],p=ol.geom.flat.orient.linearRingIsClockwise(e,t,s,r);if(0===n){if(l&&p||!l&&!p)return!1}else if(l&&!p||!l&&p)return!1;t=s}return!0};ol.geom.flat.orient.linearRingssAreOriented=function(e,t,o,r,i){var n,a;for(n=0,a=o.length;n<a;++n)if(!ol.geom.flat.orient.linearRingsAreOriented(e,t,o[n],r,i))return!1;return!0};ol.geom.flat.orient.orientLinearRings=function(e,t,o,r,i){var n,a,l=void 0!==i&&i;for(n=0,a=o.length;n<a;++n){var s=o[n],p=ol.geom.flat.orient.linearRingIsClockwise(e,t,s,r);(0===n?l&&p||!l&&!p:l&&!p||!l&&p)&&ol.geom.flat.reverse.coordinates(e,t,s,r);t=s}return t};ol.geom.flat.orient.orientLinearRingss=function(e,t,o,r,i){var n,a;for(n=0,a=o.length;n<a;++n)t=ol.geom.flat.orient.orientLinearRings(e,t,o[n],r,i);return t};goog.provide("ol.geom.Polygon");goog.require("ol");goog.require("ol.array");goog.require("ol.extent");goog.require("ol.geom.GeometryLayout");goog.require("ol.geom.GeometryType");goog.require("ol.geom.LinearRing");goog.require("ol.geom.Point");goog.require("ol.geom.SimpleGeometry");goog.require("ol.geom.flat.area");goog.require("ol.geom.flat.closest");goog.require("ol.geom.flat.contains");goog.require("ol.geom.flat.deflate");goog.require("ol.geom.flat.inflate");goog.require("ol.geom.flat.interiorpoint");goog.require("ol.geom.flat.intersectsextent");goog.require("ol.geom.flat.orient");goog.require("ol.geom.flat.simplify");goog.require("ol.math");ol.geom.Polygon=function(e,t){ol.geom.SimpleGeometry.call(this);this.ends_=[];this.flatInteriorPointRevision_=-1;this.flatInteriorPoint_=null;this.maxDelta_=-1;this.maxDeltaRevision_=-1;this.orientedRevision_=-1;this.orientedFlatCoordinates_=null;this.setCoordinates(e,t)};ol.inherits(ol.geom.Polygon,ol.geom.SimpleGeometry);ol.geom.Polygon.prototype.appendLinearRing=function(e){this.flatCoordinates?ol.array.extend(this.flatCoordinates,e.getFlatCoordinates()):this.flatCoordinates=e.getFlatCoordinates().slice();this.ends_.push(this.flatCoordinates.length);this.changed()};ol.geom.Polygon.prototype.clone=function(){var e=new ol.geom.Polygon(null);e.setFlatCoordinates(this.layout,this.flatCoordinates.slice(),this.ends_.slice());return e};ol.geom.Polygon.prototype.closestPointXY=function(e,t,o,r){if(r<ol.extent.closestSquaredDistanceXY(this.getExtent(),e,t))return r;if(this.maxDeltaRevision_!=this.getRevision()){this.maxDelta_=Math.sqrt(ol.geom.flat.closest.getsMaxSquaredDelta(this.flatCoordinates,0,this.ends_,this.stride,0));this.maxDeltaRevision_=this.getRevision()}return ol.geom.flat.closest.getsClosestPoint(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!0,e,t,o,r)};ol.geom.Polygon.prototype.containsXY=function(e,t){return ol.geom.flat.contains.linearRingsContainsXY(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,e,t)};ol.geom.Polygon.prototype.getArea=function(){return ol.geom.flat.area.linearRings(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride)};ol.geom.Polygon.prototype.getCoordinates=function(e){var t;if(void 0!==e){t=this.getOrientedFlatCoordinates().slice();ol.geom.flat.orient.orientLinearRings(t,0,this.ends_,this.stride,e)}else t=this.flatCoordinates;return ol.geom.flat.inflate.coordinatess(t,0,this.ends_,this.stride)};ol.geom.Polygon.prototype.getEnds=function(){return this.ends_};ol.geom.Polygon.prototype.getFlatInteriorPoint=function(){if(this.flatInteriorPointRevision_!=this.getRevision()){var e=ol.extent.getCenter(this.getExtent());this.flatInteriorPoint_=ol.geom.flat.interiorpoint.linearRings(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,e,0);this.flatInteriorPointRevision_=this.getRevision()}return this.flatInteriorPoint_};ol.geom.Polygon.prototype.getInteriorPoint=function(){return new ol.geom.Point(this.getFlatInteriorPoint(),ol.geom.GeometryLayout.XYM)};ol.geom.Polygon.prototype.getLinearRingCount=function(){return this.ends_.length};ol.geom.Polygon.prototype.getLinearRing=function(e){if(e<0||this.ends_.length<=e)return null;var t=new ol.geom.LinearRing(null);t.setFlatCoordinates(this.layout,this.flatCoordinates.slice(0===e?0:this.ends_[e-1],this.ends_[e]));return t};ol.geom.Polygon.prototype.getLinearRings=function(){var e,t,o=this.layout,r=this.flatCoordinates,i=this.ends_,n=[],a=0;for(e=0,t=i.length;e<t;++e){var l=i[e],s=new ol.geom.LinearRing(null);s.setFlatCoordinates(o,r.slice(a,l));n.push(s);a=l}return n};ol.geom.Polygon.prototype.getOrientedFlatCoordinates=function(){if(this.orientedRevision_!=this.getRevision()){var e=this.flatCoordinates;if(ol.geom.flat.orient.linearRingsAreOriented(e,0,this.ends_,this.stride))this.orientedFlatCoordinates_=e;else{this.orientedFlatCoordinates_=e.slice();this.orientedFlatCoordinates_.length=ol.geom.flat.orient.orientLinearRings(this.orientedFlatCoordinates_,0,this.ends_,this.stride)}this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_};ol.geom.Polygon.prototype.getSimplifiedGeometryInternal=function(e){var t=[],o=[];t.length=ol.geom.flat.simplify.quantizes(this.flatCoordinates,0,this.ends_,this.stride,Math.sqrt(e),t,0,o);var r=new ol.geom.Polygon(null);r.setFlatCoordinates(ol.geom.GeometryLayout.XY,t,o);return r};ol.geom.Polygon.prototype.getType=function(){return ol.geom.GeometryType.POLYGON};ol.geom.Polygon.prototype.intersectsExtent=function(e){return ol.geom.flat.intersectsextent.linearRings(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,e)};ol.geom.Polygon.prototype.setCoordinates=function(e,t){if(e){this.setLayout(t,e,2);this.flatCoordinates||(this.flatCoordinates=[]);var o=ol.geom.flat.deflate.coordinatess(this.flatCoordinates,0,e,this.stride,this.ends_);this.flatCoordinates.length=0===o.length?0:o[o.length-1];this.changed()}else this.setFlatCoordinates(ol.geom.GeometryLayout.XY,null,this.ends_)};ol.geom.Polygon.prototype.setFlatCoordinates=function(e,t,o){this.setFlatCoordinatesInternal(e,t);this.ends_=o;this.changed()};ol.geom.Polygon.circular=function(e,t,o,r){var i,n=r||32,a=[];for(i=0;i<n;++i)ol.array.extend(a,e.offset(t,o,2*Math.PI*i/n));a.push(a[0],a[1]);var l=new ol.geom.Polygon(null);l.setFlatCoordinates(ol.geom.GeometryLayout.XY,a,[a.length]);return l};ol.geom.Polygon.fromExtent=function(e){var t=e[0],o=e[1],r=e[2],i=e[3],n=[t,o,t,i,r,i,r,o,t,o],a=new ol.geom.Polygon(null);a.setFlatCoordinates(ol.geom.GeometryLayout.XY,n,[n.length]);return a};ol.geom.Polygon.fromCircle=function(e,t,o){for(var r=t||32,i=e.getStride(),n=e.getLayout(),a=new ol.geom.Polygon(null,n),l=i*(r+1),s=new Array(l),p=0;p<l;p++)s[p]=0;var c=[s.length];a.setFlatCoordinates(n,s,c);ol.geom.Polygon.makeRegular(a,e.getCenter(),e.getRadius(),o);return a};ol.geom.Polygon.makeRegular=function(e,t,o,r){for(var i,n,a=e.getFlatCoordinates(),l=e.getLayout(),s=e.getStride(),p=e.getEnds(),c=a.length/s-1,u=r||0,g=0;g<=c;++g){n=g*s;i=u+2*ol.math.modulo(g,c)*Math.PI/c;a[n]=t[0]+o*Math.cos(i);a[n+1]=t[1]+o*Math.sin(i)}e.setFlatCoordinates(l,a,p)};goog.provide("ol.View");goog.require("ol");goog.require("ol.CenterConstraint");goog.require("ol.Object");goog.require("ol.ResolutionConstraint");goog.require("ol.RotationConstraint");goog.require("ol.ViewHint");goog.require("ol.ViewProperty");goog.require("ol.array");goog.require("ol.asserts");goog.require("ol.coordinate");goog.require("ol.easing");goog.require("ol.extent");goog.require("ol.geom.GeometryType");goog.require("ol.geom.Polygon");goog.require("ol.geom.SimpleGeometry");goog.require("ol.math");goog.require("ol.obj");goog.require("ol.proj");goog.require("ol.proj.Units");ol.View=function(e){ol.Object.call(this);var t=ol.obj.assign({},e);this.hints_=[0,0];this.animations_=[];this.updateAnimationKey_;this.updateAnimations_=this.updateAnimations_.bind(this);this.projection_=ol.proj.createProjection(t.projection,"EPSG:3857");this.applyOptions_(t)};ol.inherits(ol.View,ol.Object);ol.View.prototype.applyOptions_=function(e){var t={};t[ol.ViewProperty.CENTER]=void 0!==e.center?e.center:null;var o=ol.View.createResolutionConstraint_(e);this.maxResolution_=o.maxResolution;this.minResolution_=o.minResolution;this.zoomFactor_=o.zoomFactor;this.resolutions_=e.resolutions;this.minZoom_=o.minZoom;var r=ol.View.createCenterConstraint_(e),i=o.constraint,n=ol.View.createRotationConstraint_(e);this.constraints_={center:r,resolution:i,rotation:n};if(void 0!==e.resolution)t[ol.ViewProperty.RESOLUTION]=e.resolution;else if(void 0!==e.zoom){t[ol.ViewProperty.RESOLUTION]=this.constrainResolution(this.maxResolution_,e.zoom-this.minZoom_);this.resolutions_&&(t[ol.ViewProperty.RESOLUTION]=ol.math.clamp(Number(this.getResolution()||t[ol.ViewProperty.RESOLUTION]),this.minResolution_,this.maxResolution_))}t[ol.ViewProperty.ROTATION]=void 0!==e.rotation?e.rotation:0;this.setProperties(t);this.options_=e};ol.View.prototype.getUpdatedOptions_=function(e){var t=ol.obj.assign({},this.options_);void 0!==t.resolution?t.resolution=this.getResolution():t.zoom=this.getZoom();t.center=this.getCenter();t.rotation=this.getRotation();return ol.obj.assign({},t,e)};ol.View.prototype.animate=function(e){var t,o=arguments.length;if(o>1&&"function"==typeof arguments[o-1]){t=arguments[o-1];--o}if(this.isDef()){for(var r=Date.now(),i=this.getCenter().slice(),n=this.getResolution(),a=this.getRotation(),l=[],s=0;s<o;++s){var p=arguments[s],c={start:r,complete:!1,anchor:p.anchor,duration:void 0!==p.duration?p.duration:1e3,easing:p.easing||ol.easing.inAndOut};if(p.center){c.sourceCenter=i;c.targetCenter=p.center;i=c.targetCenter}if(void 0!==p.zoom){c.sourceResolution=n;c.targetResolution=this.constrainResolution(this.maxResolution_,p.zoom-this.minZoom_,0);n=c.targetResolution}else if(p.resolution){c.sourceResolution=n;c.targetResolution=p.resolution;n=c.targetResolution}if(void 0!==p.rotation){c.sourceRotation=a;var u=ol.math.modulo(p.rotation-a+Math.PI,2*Math.PI)-Math.PI;c.targetRotation=a+u;a=c.targetRotation}c.callback=t;ol.View.isNoopAnimation(c)?c.complete=!0:r+=c.duration;l.push(c)}this.animations_.push(l);this.setHint(ol.ViewHint.ANIMATING,1);this.updateAnimations_()}else{var g=arguments[o-1];g.center&&this.setCenter(g.center);void 0!==g.zoom&&this.setZoom(g.zoom);void 0!==g.rotation&&this.setRotation(g.rotation);t&&t(!0)}};ol.View.prototype.getAnimating=function(){return this.hints_[ol.ViewHint.ANIMATING]>0};ol.View.prototype.getInteracting=function(){return this.hints_[ol.ViewHint.INTERACTING]>0};ol.View.prototype.cancelAnimations=function(){this.setHint(ol.ViewHint.ANIMATING,-this.hints_[ol.ViewHint.ANIMATING]);for(var e=0,t=this.animations_.length;e<t;++e){var o=this.animations_[e];o[0].callback&&o[0].callback(!1)}this.animations_.length=0};ol.View.prototype.updateAnimations_=function(){if(void 0!==this.updateAnimationKey_){cancelAnimationFrame(this.updateAnimationKey_);this.updateAnimationKey_=void 0}if(this.getAnimating()){for(var e=Date.now(),t=!1,o=this.animations_.length-1;o>=0;--o){for(var r=this.animations_[o],i=!0,n=0,a=r.length;n<a;++n){var l=r[n];if(!l.complete){var s=e-l.start,p=l.duration>0?s/l.duration:1;if(p>=1){l.complete=!0;p=1}else i=!1;var c=l.easing(p);if(l.sourceCenter){var u=l.sourceCenter[0],g=l.sourceCenter[1],d=u+c*(l.targetCenter[0]-u),h=g+c*(l.targetCenter[1]-g);this.set(ol.ViewProperty.CENTER,[d,h])}if(l.sourceResolution&&l.targetResolution){var f=1===c?l.targetResolution:l.sourceResolution+c*(l.targetResolution-l.sourceResolution);l.anchor&&this.set(ol.ViewProperty.CENTER,this.calculateCenterZoom(f,l.anchor));this.set(ol.ViewProperty.RESOLUTION,f)}if(void 0!==l.sourceRotation&&void 0!==l.targetRotation){var y=1===c?ol.math.modulo(l.targetRotation+Math.PI,2*Math.PI)-Math.PI:l.sourceRotation+c*(l.targetRotation-l.sourceRotation);l.anchor&&this.set(ol.ViewProperty.CENTER,this.calculateCenterRotate(y,l.anchor));this.set(ol.ViewProperty.ROTATION,y)}t=!0;if(!l.complete)break}}if(i){this.animations_[o]=null;this.setHint(ol.ViewHint.ANIMATING,-1);var m=r[0].callback;m&&m(!0)}}this.animations_=this.animations_.filter(Boolean);t&&void 0===this.updateAnimationKey_&&(this.updateAnimationKey_=requestAnimationFrame(this.updateAnimations_))}};ol.View.prototype.calculateCenterRotate=function(e,t){var o,r=this.getCenter();if(void 0!==r){o=[r[0]-t[0],r[1]-t[1]];ol.coordinate.rotate(o,e-this.getRotation());ol.coordinate.add(o,t)}return o};ol.View.prototype.calculateCenterZoom=function(e,t){var o,r=this.getCenter(),i=this.getResolution();if(void 0!==r&&void 0!==i){o=[t[0]-e*(t[0]-r[0])/i,t[1]-e*(t[1]-r[1])/i]}return o};ol.View.prototype.getSizeFromViewport_=function(){var e=[100,100],t='.ol-viewport[data-view="'+ol.getUid(this)+'"]',o=document.querySelector(t);if(o){var r=getComputedStyle(o);e[0]=parseInt(r.width,10);e[1]=parseInt(r.height,10)}return e};ol.View.prototype.constrainCenter=function(e){return this.constraints_.center(e)};ol.View.prototype.constrainResolution=function(e,t,o){var r=t||0,i=o||0;return this.constraints_.resolution(e,r,i)};ol.View.prototype.constrainRotation=function(e,t){var o=t||0;return this.constraints_.rotation(e,o)};ol.View.prototype.getCenter=function(){return this.get(ol.ViewProperty.CENTER)};ol.View.prototype.getConstraints=function(){return this.constraints_};ol.View.prototype.getHints=function(e){if(void 0!==e){e[0]=this.hints_[0];e[1]=this.hints_[1];return e}return this.hints_.slice()};ol.View.prototype.calculateExtent=function(e){var t=e||this.getSizeFromViewport_(),o=this.getCenter();ol.asserts.assert(o,1);var r=this.getResolution();ol.asserts.assert(void 0!==r,2);var i=this.getRotation();ol.asserts.assert(void 0!==i,3);return ol.extent.getForViewAndSize(o,r,i,t)};ol.View.prototype.getMaxResolution=function(){return this.maxResolution_};ol.View.prototype.getMinResolution=function(){return this.minResolution_};ol.View.prototype.getMaxZoom=function(){return this.getZoomForResolution(this.minResolution_)};ol.View.prototype.setMaxZoom=function(e){this.applyOptions_(this.getUpdatedOptions_({maxZoom:e}))};ol.View.prototype.getMinZoom=function(){return this.getZoomForResolution(this.maxResolution_)};ol.View.prototype.setMinZoom=function(e){this.applyOptions_(this.getUpdatedOptions_({minZoom:e}))};ol.View.prototype.getProjection=function(){return this.projection_};ol.View.prototype.getResolution=function(){return this.get(ol.ViewProperty.RESOLUTION)};ol.View.prototype.getResolutions=function(){return this.resolutions_};ol.View.prototype.getResolutionForExtent=function(e,t){var o=t||this.getSizeFromViewport_(),r=ol.extent.getWidth(e)/o[0],i=ol.extent.getHeight(e)/o[1];return Math.max(r,i)};ol.View.prototype.getResolutionForValueFunction=function(e){var t=e||2,o=this.maxResolution_,r=this.minResolution_,i=Math.log(o/r)/Math.log(t);return function(e){return o/Math.pow(t,e*i)}};ol.View.prototype.getRotation=function(){return this.get(ol.ViewProperty.ROTATION)};ol.View.prototype.getValueForResolutionFunction=function(e){var t=e||2,o=this.maxResolution_,r=this.minResolution_,i=Math.log(o/r)/Math.log(t);return function(e){return Math.log(o/e)/Math.log(t)/i}};ol.View.prototype.getState=function(){var e=this.getCenter(),t=this.getProjection(),o=this.getResolution(),r=this.getRotation();return{center:e.slice(),projection:void 0!==t?t:null,resolution:o,rotation:r,zoom:this.getZoom()}};ol.View.prototype.getZoom=function(){var e,t=this.getResolution();void 0!==t&&(e=this.getZoomForResolution(t));return e};ol.View.prototype.getZoomForResolution=function(e){var t,o,r=this.minZoom_||0;if(this.resolutions_){var i=ol.array.linearFindNearest(this.resolutions_,e,1);r=i;t=this.resolutions_[i];o=i==this.resolutions_.length-1?2:t/this.resolutions_[i+1]}else{t=this.maxResolution_;o=this.zoomFactor_}return r+Math.log(t/e)/Math.log(o)};ol.View.prototype.getResolutionForZoom=function(e){return this.constrainResolution(this.maxResolution_,e-this.minZoom_,0)};ol.View.prototype.fit=function(e,t){var o,r=t||{},i=r.size;i||(i=this.getSizeFromViewport_());if(e instanceof ol.geom.SimpleGeometry)if(e.getType()===ol.geom.GeometryType.CIRCLE){e=e.getExtent();(o=ol.geom.Polygon.fromExtent(e)).rotate(this.getRotation(),ol.extent.getCenter(e))}else o=e;else{ol.asserts.assert(Array.isArray(e),24);ol.asserts.assert(!ol.extent.isEmpty(e),25);o=ol.geom.Polygon.fromExtent(e)}var n,a=void 0!==r.padding?r.padding:[0,0,0,0],l=void 0===r.constrainResolution||r.constrainResolution,s=void 0!==r.nearest&&r.nearest;n=void 0!==r.minResolution?r.minResolution:void 0!==r.maxZoom?this.constrainResolution(this.maxResolution_,r.maxZoom-this.minZoom_,0):0;for(var p=o.getFlatCoordinates(),c=this.getRotation(),u=Math.cos(-c),g=Math.sin(-c),d=1/0,h=1/0,f=-1/0,y=-1/0,m=o.getStride(),v=0,C=p.length;v<C;v+=m){var T=p[v]*u-p[v+1]*g,S=p[v]*g+p[v+1]*u;d=Math.min(d,T);h=Math.min(h,S);f=Math.max(f,T);y=Math.max(y,S)}var _=this.getResolutionForExtent([d,h,f,y],[i[0]-a[1]-a[3],i[1]-a[0]-a[2]]);_=isNaN(_)?n:Math.max(_,n);if(l){var E=this.constrainResolution(_,0,0);!s&&E<_&&(E=this.constrainResolution(E,-1,0));_=E}g=-g;var x=(d+f)/2,P=(h+y)/2,L=[(x+=(a[1]-a[3])/2*_)*u-(P+=(a[0]-a[2])/2*_)*g,P*u+x*g],w=r.callback?r.callback:ol.nullFunction;if(void 0!==r.duration)this.animate({resolution:_,center:L,duration:r.duration,easing:r.easing},w);else{this.setResolution(_);this.setCenter(L);setTimeout(w.bind(void 0,!0),0)}};ol.View.prototype.centerOn=function(e,t,o){var r=this.getRotation(),i=Math.cos(-r),n=Math.sin(-r),a=e[0]*i-e[1]*n,l=e[1]*i+e[0]*n,s=this.getResolution(),p=(a+=(t[0]/2-o[0])*s)*i-(l+=(o[1]-t[1]/2)*s)*(n=-n),c=l*i+a*n;this.setCenter([p,c])};ol.View.prototype.isDef=function(){return!!this.getCenter()&&void 0!==this.getResolution()};ol.View.prototype.rotate=function(e,t){if(void 0!==t){var o=this.calculateCenterRotate(e,t);this.setCenter(o)}this.setRotation(e)};ol.View.prototype.setCenter=function(e){this.set(ol.ViewProperty.CENTER,e);this.getAnimating()&&this.cancelAnimations()};ol.View.prototype.setHint=function(e,t){this.hints_[e]+=t;this.changed();return this.hints_[e]};ol.View.prototype.setResolution=function(e){this.set(ol.ViewProperty.RESOLUTION,e);this.getAnimating()&&this.cancelAnimations()};ol.View.prototype.setRotation=function(e){this.set(ol.ViewProperty.ROTATION,e);this.getAnimating()&&this.cancelAnimations()};ol.View.prototype.setZoom=function(e){this.setResolution(this.getResolutionForZoom(e))};ol.View.createCenterConstraint_=function(e){return void 0!==e.extent?ol.CenterConstraint.createExtent(e.extent):ol.CenterConstraint.none};ol.View.createResolutionConstraint_=function(e){var t,o,r,i=void 0!==e.minZoom?e.minZoom:ol.DEFAULT_MIN_ZOOM,n=void 0!==e.maxZoom?e.maxZoom:28,a=void 0!==e.zoomFactor?e.zoomFactor:2;if(void 0!==e.resolutions){var l=e.resolutions;o=l[i];r=void 0!==l[n]?l[n]:l[l.length-1];t=ol.ResolutionConstraint.createSnapToResolutions(l)}else{var s=ol.proj.createProjection(e.projection,"EPSG:3857"),p=s.getExtent(),c=(p?Math.max(ol.extent.getWidth(p),ol.extent.getHeight(p)):360*ol.proj.METERS_PER_UNIT[ol.proj.Units.DEGREES]/s.getMetersPerUnit())/ol.DEFAULT_TILE_SIZE/Math.pow(2,ol.DEFAULT_MIN_ZOOM),u=c/Math.pow(2,28-ol.DEFAULT_MIN_ZOOM);void 0!==(o=e.maxResolution)?i=0:o=c/Math.pow(a,i);void 0===(r=e.minResolution)&&(r=void 0!==e.maxZoom?void 0!==e.maxResolution?o/Math.pow(a,n):c/Math.pow(a,n):u);n=i+Math.floor(Math.log(o/r)/Math.log(a));r=o/Math.pow(a,n-i);t=ol.ResolutionConstraint.createSnapToPower(a,o,n-i)}return{constraint:t,maxResolution:o,minResolution:r,minZoom:i,zoomFactor:a}};ol.View.createRotationConstraint_=function(e){if(void 0===e.enableRotation||e.enableRotation){var t=e.constrainRotation;return void 0===t||!0===t?ol.RotationConstraint.createSnapToZero():!1===t?ol.RotationConstraint.none:"number"==typeof t?ol.RotationConstraint.createSnapToN(t):ol.RotationConstraint.none}return ol.RotationConstraint.disable};ol.View.isNoopAnimation=function(e){return!(e.sourceCenter&&e.targetCenter&&!ol.coordinate.equals(e.sourceCenter,e.targetCenter))&&(e.sourceResolution===e.targetResolution&&e.sourceRotation===e.targetRotation)};goog.provide("ol.dom");ol.dom.createCanvasContext2D=function(e,t){var o=document.createElement("CANVAS");e&&(o.width=e);t&&(o.height=t);return o.getContext("2d")};ol.dom.outerWidth=function(e){var t=e.offsetWidth,o=getComputedStyle(e);return t+=parseInt(o.marginLeft,10)+parseInt(o.marginRight,10)};ol.dom.outerHeight=function(e){var t=e.offsetHeight,o=getComputedStyle(e);return t+=parseInt(o.marginTop,10)+parseInt(o.marginBottom,10)};ol.dom.replaceNode=function(e,t){var o=t.parentNode;o&&o.replaceChild(e,t)};ol.dom.removeNode=function(e){return e&&e.parentNode?e.parentNode.removeChild(e):null};ol.dom.removeChildren=function(e){for(;e.lastChild;)e.removeChild(e.lastChild)};goog.provide("ol.layer.Property");ol.layer.Property={OPACITY:"opacity",VISIBLE:"visible",EXTENT:"extent",Z_INDEX:"zIndex",MAX_RESOLUTION:"maxResolution",MIN_RESOLUTION:"minResolution",SOURCE:"source"};goog.provide("ol.layer.Base");goog.require("ol");goog.require("ol.Object");goog.require("ol.layer.Property");goog.require("ol.math");goog.require("ol.obj");ol.layer.Base=function(e){ol.Object.call(this);var t=ol.obj.assign({},e);t[ol.layer.Property.OPACITY]=void 0!==e.opacity?e.opacity:1;t[ol.layer.Property.VISIBLE]=void 0===e.visible||e.visible;t[ol.layer.Property.Z_INDEX]=void 0!==e.zIndex?e.zIndex:0;t[ol.layer.Property.MAX_RESOLUTION]=void 0!==e.maxResolution?e.maxResolution:1/0;t[ol.layer.Property.MIN_RESOLUTION]=void 0!==e.minResolution?e.minResolution:0;this.setProperties(t);this.state_={layer:this,managed:!0};this.type};ol.inherits(ol.layer.Base,ol.Object);ol.layer.Base.prototype.getType=function(){return this.type};ol.layer.Base.prototype.getLayerState=function(){this.state_.opacity=ol.math.clamp(this.getOpacity(),0,1);this.state_.sourceState=this.getSourceState();this.state_.visible=this.getVisible();this.state_.extent=this.getExtent();this.state_.zIndex=this.getZIndex();this.state_.maxResolution=this.getMaxResolution();this.state_.minResolution=Math.max(this.getMinResolution(),0);return this.state_};ol.layer.Base.prototype.getLayersArray=function(e){};ol.layer.Base.prototype.getLayerStatesArray=function(e){};ol.layer.Base.prototype.getExtent=function(){return this.get(ol.layer.Property.EXTENT)};ol.layer.Base.prototype.getMaxResolution=function(){return this.get(ol.layer.Property.MAX_RESOLUTION)};ol.layer.Base.prototype.getMinResolution=function(){return this.get(ol.layer.Property.MIN_RESOLUTION)};ol.layer.Base.prototype.getOpacity=function(){return this.get(ol.layer.Property.OPACITY)};ol.layer.Base.prototype.getSourceState=function(){};ol.layer.Base.prototype.getVisible=function(){return this.get(ol.layer.Property.VISIBLE)};ol.layer.Base.prototype.getZIndex=function(){return this.get(ol.layer.Property.Z_INDEX)};ol.layer.Base.prototype.setExtent=function(e){this.set(ol.layer.Property.EXTENT,e)};ol.layer.Base.prototype.setMaxResolution=function(e){this.set(ol.layer.Property.MAX_RESOLUTION,e)};ol.layer.Base.prototype.setMinResolution=function(e){this.set(ol.layer.Property.MIN_RESOLUTION,e)};ol.layer.Base.prototype.setOpacity=function(e){this.set(ol.layer.Property.OPACITY,e)};ol.layer.Base.prototype.setVisible=function(e){this.set(ol.layer.Property.VISIBLE,e)};ol.layer.Base.prototype.setZIndex=function(e){this.set(ol.layer.Property.Z_INDEX,e)};goog.provide("ol.source.State");ol.source.State={UNDEFINED:"undefined",LOADING:"loading",READY:"ready",ERROR:"error"};goog.provide("ol.layer.Group");goog.require("ol");goog.require("ol.Collection");goog.require("ol.CollectionEventType");goog.require("ol.Object");goog.require("ol.ObjectEventType");goog.require("ol.asserts");goog.require("ol.events");goog.require("ol.events.EventType");goog.require("ol.extent");goog.require("ol.layer.Base");goog.require("ol.obj");goog.require("ol.source.State");ol.layer.Group=function(e){var t=e||{},o=ol.obj.assign({},t);delete o.layers;var r=t.layers;ol.layer.Base.call(this,o);this.layersListenerKeys_=[];this.listenerKeys_={};ol.events.listen(this,ol.Object.getChangeEventType(ol.layer.Group.Property_.LAYERS),this.handleLayersChanged_,this);if(r)if(Array.isArray(r))r=new ol.Collection(r.slice(),{unique:!0});else{ol.asserts.assert(r instanceof ol.Collection,43);r=r}else r=new ol.Collection(void 0,{unique:!0});this.setLayers(r)};ol.inherits(ol.layer.Group,ol.layer.Base);ol.layer.Group.prototype.handleLayerChange_=function(){this.changed()};ol.layer.Group.prototype.handleLayersChanged_=function(e){this.layersListenerKeys_.forEach(ol.events.unlistenByKey);this.layersListenerKeys_.length=0;var t=this.getLayers();this.layersListenerKeys_.push(ol.events.listen(t,ol.CollectionEventType.ADD,this.handleLayersAdd_,this),ol.events.listen(t,ol.CollectionEventType.REMOVE,this.handleLayersRemove_,this));for(var o in this.listenerKeys_)this.listenerKeys_[o].forEach(ol.events.unlistenByKey);ol.obj.clear(this.listenerKeys_);var r,i,n,a=t.getArray();for(r=0,i=a.length;r<i;r++){n=a[r];this.listenerKeys_[ol.getUid(n).toString()]=[ol.events.listen(n,ol.ObjectEventType.PROPERTYCHANGE,this.handleLayerChange_,this),ol.events.listen(n,ol.events.EventType.CHANGE,this.handleLayerChange_,this)]}this.changed()};ol.layer.Group.prototype.handleLayersAdd_=function(e){var t=e.element,o=ol.getUid(t).toString();this.listenerKeys_[o]=[ol.events.listen(t,ol.ObjectEventType.PROPERTYCHANGE,this.handleLayerChange_,this),ol.events.listen(t,ol.events.EventType.CHANGE,this.handleLayerChange_,this)];this.changed()};ol.layer.Group.prototype.handleLayersRemove_=function(e){var t=e.element,o=ol.getUid(t).toString();this.listenerKeys_[o].forEach(ol.events.unlistenByKey);delete this.listenerKeys_[o];this.changed()};ol.layer.Group.prototype.getLayers=function(){return this.get(ol.layer.Group.Property_.LAYERS)};ol.layer.Group.prototype.setLayers=function(e){this.set(ol.layer.Group.Property_.LAYERS,e)};ol.layer.Group.prototype.getLayersArray=function(e){var t=void 0!==e?e:[];this.getLayers().forEach(function(e){e.getLayersArray(t)});return t};ol.layer.Group.prototype.getLayerStatesArray=function(e){var t=void 0!==e?e:[],o=t.length;this.getLayers().forEach(function(e){e.getLayerStatesArray(t)});var r,i,n,a=this.getLayerState();for(r=o,i=t.length;r<i;r++){(n=t[r]).opacity*=a.opacity;n.visible=n.visible&&a.visible;n.maxResolution=Math.min(n.maxResolution,a.maxResolution);n.minResolution=Math.max(n.minResolution,a.minResolution);void 0!==a.extent&&(void 0!==n.extent?n.extent=ol.extent.getIntersection(n.extent,a.extent):n.extent=a.extent)}return t};ol.layer.Group.prototype.getSourceState=function(){return ol.source.State.READY};ol.layer.Group.Property_={LAYERS:"layers"};goog.provide("ol.PluginType");ol.PluginType={MAP_RENDERER:"MAP_RENDERER",LAYER_RENDERER:"LAYER_RENDERER"};goog.provide("ol.plugins");goog.require("ol.PluginType");ol.plugins.mapRendererPlugins_=[];ol.plugins.getMapRendererPlugins=function(){return ol.plugins.mapRendererPlugins_};ol.plugins.layerRendererPlugins_=[];ol.plugins.getLayerRendererPlugins=function(){return ol.plugins.layerRendererPlugins_};ol.plugins.register=function(e,t){switch(e){case ol.PluginType.MAP_RENDERER:ol.plugins.mapRendererPlugins_.push(t);break;case ol.PluginType.LAYER_RENDERER:ol.plugins.layerRendererPlugins_.push(t);break;default:throw new Error("Unsupported plugin type: "+e)}};ol.plugins.registerMultiple=function(e,t){for(var o=0,r=t.length;o<r;++o)ol.plugins.register(e,t[o])};goog.provide("ol.renderer.Type");ol.renderer.Type={CANVAS:"canvas",WEBGL:"webgl"};goog.provide("ol.PluggableMap");goog.require("ol");goog.require("ol.Collection");goog.require("ol.CollectionEventType");goog.require("ol.MapBrowserEvent");goog.require("ol.MapBrowserEventHandler");goog.require("ol.MapBrowserEventType");goog.require("ol.MapEvent");goog.require("ol.MapEventType");goog.require("ol.MapProperty");goog.require("ol.Object");goog.require("ol.ObjectEventType");goog.require("ol.TileQueue");goog.require("ol.View");goog.require("ol.ViewHint");goog.require("ol.asserts");goog.require("ol.dom");goog.require("ol.events");goog.require("ol.events.Event");goog.require("ol.events.EventType");goog.require("ol.extent");goog.require("ol.functions");goog.require("ol.has");goog.require("ol.layer.Group");goog.require("ol.obj");goog.require("ol.plugins");goog.require("ol.renderer.Type");goog.require("ol.size");goog.require("ol.structs.PriorityQueue");goog.require("ol.transform");ol.PluggableMap=function(e){ol.Object.call(this);var t=ol.PluggableMap.createOptionsInternal(e);this.loadTilesWhileAnimating_=void 0!==e.loadTilesWhileAnimating&&e.loadTilesWhileAnimating;this.loadTilesWhileInteracting_=void 0!==e.loadTilesWhileInteracting&&e.loadTilesWhileInteracting;this.pixelRatio_=void 0!==e.pixelRatio?e.pixelRatio:ol.has.DEVICE_PIXEL_RATIO;this.logos_=t.logos;this.animationDelayKey_;this.animationDelay_=function(){this.animationDelayKey_=void 0;this.renderFrame_.call(this,Date.now())}.bind(this);this.coordinateToPixelTransform_=ol.transform.create();this.pixelToCoordinateTransform_=ol.transform.create();this.frameIndex_=0;this.frameState_=null;this.previousExtent_=null;this.viewPropertyListenerKey_=null;this.viewChangeListenerKey_=null;this.layerGroupPropertyListenerKeys_=null;this.viewport_=document.createElement("DIV");this.viewport_.className="ol-viewport"+(ol.has.TOUCH?" ol-touch":"");this.viewport_.style.position="relative";this.viewport_.style.overflow="hidden";this.viewport_.style.width="100%";this.viewport_.style.height="100%";this.viewport_.style.msTouchAction="none";this.viewport_.style.touchAction="none";this.overlayContainer_=document.createElement("DIV");this.overlayContainer_.className="ol-overlaycontainer";this.viewport_.appendChild(this.overlayContainer_);this.overlayContainerStopEvent_=document.createElement("DIV");this.overlayContainerStopEvent_.className="ol-overlaycontainer-stopevent";for(var o=[ol.events.EventType.CLICK,ol.events.EventType.DBLCLICK,ol.events.EventType.MOUSEDOWN,ol.events.EventType.TOUCHSTART,ol.events.EventType.MSPOINTERDOWN,ol.MapBrowserEventType.POINTERDOWN,ol.events.EventType.MOUSEWHEEL,ol.events.EventType.WHEEL],r=0,i=o.length;r<i;++r)ol.events.listen(this.overlayContainerStopEvent_,o[r],ol.events.Event.stopPropagation);this.viewport_.appendChild(this.overlayContainerStopEvent_);this.mapBrowserEventHandler_=new ol.MapBrowserEventHandler(this,e.moveTolerance);for(var n in ol.MapBrowserEventType)ol.events.listen(this.mapBrowserEventHandler_,ol.MapBrowserEventType[n],this.handleMapBrowserEvent,this);this.keyboardEventTarget_=t.keyboardEventTarget;this.keyHandlerKeys_=null;ol.events.listen(this.viewport_,ol.events.EventType.WHEEL,this.handleBrowserEvent,this);ol.events.listen(this.viewport_,ol.events.EventType.MOUSEWHEEL,this.handleBrowserEvent,this);this.controls=t.controls||new ol.Collection;this.interactions=t.interactions||new ol.Collection;this.overlays_=t.overlays;this.overlayIdIndex_={};this.renderer_=t.mapRendererPlugin.create(this.viewport_,this);this.handleResize_;this.focus_=null;this.postRenderFunctions_=[];this.tileQueue_=new ol.TileQueue(this.getTilePriority.bind(this),this.handleTileChange_.bind(this));this.skippedFeatureUids_={};ol.events.listen(this,ol.Object.getChangeEventType(ol.MapProperty.LAYERGROUP),this.handleLayerGroupChanged_,this);ol.events.listen(this,ol.Object.getChangeEventType(ol.MapProperty.VIEW),this.handleViewChanged_,this);ol.events.listen(this,ol.Object.getChangeEventType(ol.MapProperty.SIZE),this.handleSizeChanged_,this);ol.events.listen(this,ol.Object.getChangeEventType(ol.MapProperty.TARGET),this.handleTargetChanged_,this);this.setProperties(t.values);this.controls.forEach(function(e){e.setMap(this)},this);ol.events.listen(this.controls,ol.CollectionEventType.ADD,function(e){e.element.setMap(this)},this);ol.events.listen(this.controls,ol.CollectionEventType.REMOVE,function(e){e.element.setMap(null)},this);this.interactions.forEach(function(e){e.setMap(this)},this);ol.events.listen(this.interactions,ol.CollectionEventType.ADD,function(e){e.element.setMap(this)},this);ol.events.listen(this.interactions,ol.CollectionEventType.REMOVE,function(e){e.element.setMap(null)},this);this.overlays_.forEach(this.addOverlayInternal_,this);ol.events.listen(this.overlays_,ol.CollectionEventType.ADD,function(e){this.addOverlayInternal_(e.element)},this);ol.events.listen(this.overlays_,ol.CollectionEventType.REMOVE,function(e){var t=e.element.getId();void 0!==t&&delete this.overlayIdIndex_[t.toString()];e.element.setMap(null)},this)};ol.inherits(ol.PluggableMap,ol.Object);ol.PluggableMap.prototype.addControl=function(e){this.getControls().push(e)};ol.PluggableMap.prototype.addInteraction=function(e){this.getInteractions().push(e)};ol.PluggableMap.prototype.addLayer=function(e){this.getLayerGroup().getLayers().push(e)};ol.PluggableMap.prototype.addOverlay=function(e){this.getOverlays().push(e)};ol.PluggableMap.prototype.addOverlayInternal_=function(e){var t=e.getId();void 0!==t&&(this.overlayIdIndex_[t.toString()]=e);e.setMap(this)};ol.PluggableMap.prototype.disposeInternal=function(){this.mapBrowserEventHandler_.dispose();ol.events.unlisten(this.viewport_,ol.events.EventType.WHEEL,this.handleBrowserEvent,this);ol.events.unlisten(this.viewport_,ol.events.EventType.MOUSEWHEEL,this.handleBrowserEvent,this);if(void 0!==this.handleResize_){window.removeEventListener(ol.events.EventType.RESIZE,this.handleResize_,!1);this.handleResize_=void 0}if(this.animationDelayKey_){cancelAnimationFrame(this.animationDelayKey_);this.animationDelayKey_=void 0}this.setTarget(null);ol.Object.prototype.disposeInternal.call(this)};ol.PluggableMap.prototype.forEachFeatureAtPixel=function(e,t,o){if(this.frameState_){var r=this.getCoordinateFromPixel(e),i=void 0!==(o=void 0!==o?o:{}).hitTolerance?o.hitTolerance*this.frameState_.pixelRatio:0,n=void 0!==o.layerFilter?o.layerFilter:ol.functions.TRUE;return this.renderer_.forEachFeatureAtCoordinate(r,this.frameState_,i,t,null,n,null)}};ol.PluggableMap.prototype.getFeaturesAtPixel=function(e,t){var o=null;this.forEachFeatureAtPixel(e,function(e){o||(o=[]);o.push(e)},t);return o};ol.PluggableMap.prototype.forEachLayerAtPixel=function(e,t,o,r,i){if(this.frameState_){var n=void 0!==o?o:null,a=void 0!==r?r:ol.functions.TRUE,l=void 0!==i?i:null;return this.renderer_.forEachLayerAtPixel(e,this.frameState_,t,n,a,l)}};ol.PluggableMap.prototype.hasFeatureAtPixel=function(e,t){if(!this.frameState_)return!1;var o=this.getCoordinateFromPixel(e),r=void 0!==(t=void 0!==t?t:{}).layerFilter?t.layerFilter:ol.functions.TRUE,i=void 0!==t.hitTolerance?t.hitTolerance*this.frameState_.pixelRatio:0;return this.renderer_.hasFeatureAtCoordinate(o,this.frameState_,i,r,null)};ol.PluggableMap.prototype.getEventCoordinate=function(e){return this.getCoordinateFromPixel(this.getEventPixel(e))};ol.PluggableMap.prototype.getEventPixel=function(e){var t=this.viewport_.getBoundingClientRect(),o=e.changedTouches?e.changedTouches[0]:e;return[o.clientX-t.left,o.clientY-t.top]};ol.PluggableMap.prototype.getTarget=function(){return this.get(ol.MapProperty.TARGET)};ol.PluggableMap.prototype.getTargetElement=function(){var e=this.getTarget();return void 0!==e?"string"==typeof e?document.getElementById(e):e:null};ol.PluggableMap.prototype.getCoordinateFromPixel=function(e){var t=this.frameState_;return t?ol.transform.apply(t.pixelToCoordinateTransform,e.slice()):null};ol.PluggableMap.prototype.getControls=function(){return this.controls};ol.PluggableMap.prototype.getOverlays=function(){return this.overlays_};ol.PluggableMap.prototype.getOverlayById=function(e){var t=this.overlayIdIndex_[e.toString()];return void 0!==t?t:null};ol.PluggableMap.prototype.getInteractions=function(){return this.interactions};ol.PluggableMap.prototype.getLayerGroup=function(){return this.get(ol.MapProperty.LAYERGROUP)};ol.PluggableMap.prototype.getLayers=function(){return this.getLayerGroup().getLayers()};ol.PluggableMap.prototype.getPixelFromCoordinate=function(e){var t=this.frameState_;return t?ol.transform.apply(t.coordinateToPixelTransform,e.slice(0,2)):null};ol.PluggableMap.prototype.getRenderer=function(){return this.renderer_};ol.PluggableMap.prototype.getSize=function(){return this.get(ol.MapProperty.SIZE)};ol.PluggableMap.prototype.getView=function(){return this.get(ol.MapProperty.VIEW)};ol.PluggableMap.prototype.getViewport=function(){return this.viewport_};ol.PluggableMap.prototype.getOverlayContainer=function(){return this.overlayContainer_};ol.PluggableMap.prototype.getOverlayContainerStopEvent=function(){return this.overlayContainerStopEvent_};ol.PluggableMap.prototype.getTilePriority=function(e,t,o,r){var i=this.frameState_;if(!(i&&t in i.wantedTiles))return ol.structs.PriorityQueue.DROP;if(!i.wantedTiles[t][e.getKey()])return ol.structs.PriorityQueue.DROP;var n=o[0]-i.focus[0],a=o[1]-i.focus[1];return 65536*Math.log(r)+Math.sqrt(n*n+a*a)/r};ol.PluggableMap.prototype.handleBrowserEvent=function(e,t){var o=t||e.type,r=new ol.MapBrowserEvent(o,this,e);this.handleMapBrowserEvent(r)};ol.PluggableMap.prototype.handleMapBrowserEvent=function(e){if(this.frameState_){this.focus_=e.coordinate;e.frameState=this.frameState_;var t,o=this.getInteractions().getArray();if(!1!==this.dispatchEvent(e))for(t=o.length-1;t>=0;t--){var r=o[t];if(r.getActive()){if(!r.handleEvent(e))break}}}};ol.PluggableMap.prototype.handlePostRender=function(){var e=this.frameState_,t=this.tileQueue_;if(!t.isEmpty()){var o=16,r=o;if(e){var i=e.viewHints;if(i[ol.ViewHint.ANIMATING]){o=this.loadTilesWhileAnimating_?8:0;r=2}if(i[ol.ViewHint.INTERACTING]){o=this.loadTilesWhileInteracting_?8:0;r=2}}if(t.getTilesLoading()<o){t.reprioritize();t.loadMoreTiles(o,r)}}var n,a,l=this.postRenderFunctions_;for(n=0,a=l.length;n<a;++n)l[n](this,e);l.length=0};ol.PluggableMap.prototype.handleSizeChanged_=function(){this.render()};ol.PluggableMap.prototype.handleTargetChanged_=function(){var e;this.getTarget()&&(e=this.getTargetElement());if(this.keyHandlerKeys_){for(var t=0,o=this.keyHandlerKeys_.length;t<o;++t)ol.events.unlistenByKey(this.keyHandlerKeys_[t]);this.keyHandlerKeys_=null}if(e){e.appendChild(this.viewport_);var r=this.keyboardEventTarget_?this.keyboardEventTarget_:e;this.keyHandlerKeys_=[ol.events.listen(r,ol.events.EventType.KEYDOWN,this.handleBrowserEvent,this),ol.events.listen(r,ol.events.EventType.KEYPRESS,this.handleBrowserEvent,this)];if(!this.handleResize_){this.handleResize_=this.updateSize.bind(this);window.addEventListener(ol.events.EventType.RESIZE,this.handleResize_,!1)}}else{this.renderer_.removeLayerRenderers();ol.dom.removeNode(this.viewport_);if(void 0!==this.handleResize_){window.removeEventListener(ol.events.EventType.RESIZE,this.handleResize_,!1);this.handleResize_=void 0}}this.updateSize()};ol.PluggableMap.prototype.handleTileChange_=function(){this.render()};ol.PluggableMap.prototype.handleViewPropertyChanged_=function(){this.render()};ol.PluggableMap.prototype.handleViewChanged_=function(){if(this.viewPropertyListenerKey_){ol.events.unlistenByKey(this.viewPropertyListenerKey_);this.viewPropertyListenerKey_=null}if(this.viewChangeListenerKey_){ol.events.unlistenByKey(this.viewChangeListenerKey_);this.viewChangeListenerKey_=null}var e=this.getView();if(e){this.viewport_.setAttribute("data-view",ol.getUid(e));this.viewPropertyListenerKey_=ol.events.listen(e,ol.ObjectEventType.PROPERTYCHANGE,this.handleViewPropertyChanged_,this);this.viewChangeListenerKey_=ol.events.listen(e,ol.events.EventType.CHANGE,this.handleViewPropertyChanged_,this)}this.render()};ol.PluggableMap.prototype.handleLayerGroupChanged_=function(){if(this.layerGroupPropertyListenerKeys_){this.layerGroupPropertyListenerKeys_.forEach(ol.events.unlistenByKey);this.layerGroupPropertyListenerKeys_=null}var e=this.getLayerGroup();e&&(this.layerGroupPropertyListenerKeys_=[ol.events.listen(e,ol.ObjectEventType.PROPERTYCHANGE,this.render,this),ol.events.listen(e,ol.events.EventType.CHANGE,this.render,this)]);this.render()};ol.PluggableMap.prototype.isRendered=function(){return!!this.frameState_};ol.PluggableMap.prototype.renderSync=function(){this.animationDelayKey_&&cancelAnimationFrame(this.animationDelayKey_);this.animationDelay_()};ol.PluggableMap.prototype.render=function(){void 0===this.animationDelayKey_&&(this.animationDelayKey_=requestAnimationFrame(this.animationDelay_))};ol.PluggableMap.prototype.removeControl=function(e){return this.getControls().remove(e)};ol.PluggableMap.prototype.removeInteraction=function(e){return this.getInteractions().remove(e)};ol.PluggableMap.prototype.removeLayer=function(e){return this.getLayerGroup().getLayers().remove(e)};ol.PluggableMap.prototype.removeOverlay=function(e){return this.getOverlays().remove(e)};ol.PluggableMap.prototype.renderFrame_=function(e){var t,o,r,i=this.getSize(),n=this.getView(),a=ol.extent.createEmpty(),l=this.frameState_,s=null;if(void 0!==i&&ol.size.hasArea(i)&&n&&n.isDef()){var p=n.getHints(this.frameState_?this.frameState_.viewHints:void 0),c=this.getLayerGroup().getLayerStatesArray(),u={};for(t=0,o=c.length;t<o;++t)u[ol.getUid(c[t].layer)]=c[t];var g=(r=n.getState()).center,d=r.resolution/this.pixelRatio_;g[0]=Math.round(g[0]/d)*d;g[1]=Math.round(g[1]/d)*d;s={animate:!1,coordinateToPixelTransform:this.coordinateToPixelTransform_,extent:a,focus:this.focus_?this.focus_:g,index:this.frameIndex_++,layerStates:u,layerStatesArray:c,logos:ol.obj.assign({},this.logos_),pixelRatio:this.pixelRatio_,pixelToCoordinateTransform:this.pixelToCoordinateTransform_,postRenderFunctions:[],size:i,skippedFeatureUids:this.skippedFeatureUids_,tileQueue:this.tileQueue_,time:e,usedTiles:{},viewState:r,viewHints:p,wantedTiles:{}}}s&&(s.extent=ol.extent.getForViewAndSize(r.center,r.resolution,r.rotation,s.size,a));this.frameState_=s;this.renderer_.renderFrame(s);if(s){s.animate&&this.render();Array.prototype.push.apply(this.postRenderFunctions_,s.postRenderFunctions);if(l){if(!this.previousExtent_||!ol.extent.isEmpty(this.previousExtent_)&&!ol.extent.equals(s.extent,this.previousExtent_)){this.dispatchEvent(new ol.MapEvent(ol.MapEventType.MOVESTART,this,l));this.previousExtent_=ol.extent.createOrUpdateEmpty(this.previousExtent_)}}if(this.previousExtent_&&!s.viewHints[ol.ViewHint.ANIMATING]&&!s.viewHints[ol.ViewHint.INTERACTING]&&!ol.extent.equals(s.extent,this.previousExtent_)){this.dispatchEvent(new ol.MapEvent(ol.MapEventType.MOVEEND,this,s));ol.extent.clone(s.extent,this.previousExtent_)}}this.dispatchEvent(new ol.MapEvent(ol.MapEventType.POSTRENDER,this,s));setTimeout(this.handlePostRender.bind(this),0)};ol.PluggableMap.prototype.setLayerGroup=function(e){this.set(ol.MapProperty.LAYERGROUP,e)};ol.PluggableMap.prototype.setSize=function(e){this.set(ol.MapProperty.SIZE,e)};ol.PluggableMap.prototype.setTarget=function(e){this.set(ol.MapProperty.TARGET,e)};ol.PluggableMap.prototype.setView=function(e){this.set(ol.MapProperty.VIEW,e)};ol.PluggableMap.prototype.skipFeature=function(e){var t=ol.getUid(e).toString();this.skippedFeatureUids_[t]=!0;this.render()};ol.PluggableMap.prototype.updateSize=function(){var e=this.getTargetElement();if(e){var t=getComputedStyle(e);this.setSize([e.offsetWidth-parseFloat(t.borderLeftWidth)-parseFloat(t.paddingLeft)-parseFloat(t.paddingRight)-parseFloat(t.borderRightWidth),e.offsetHeight-parseFloat(t.borderTopWidth)-parseFloat(t.paddingTop)-parseFloat(t.paddingBottom)-parseFloat(t.borderBottomWidth)])}else this.setSize(void 0)};ol.PluggableMap.prototype.unskipFeature=function(e){var t=ol.getUid(e).toString();delete this.skippedFeatureUids_[t];this.render()};ol.PluggableMap.DEFAULT_RENDERER_TYPES=[ol.renderer.Type.CANVAS,ol.renderer.Type.WEBGL];ol.PluggableMap.LOGO_URL="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAAA3NCSVQICAjb4U/gAAAACXBIWXMAAAHGAAABxgEXwfpGAAAAGXRFWHRTb2Z0d2FyZQB3d3cuaW5rc2NhcGUub3Jnm+48GgAAAhNQTFRF////AP//AICAgP//AFVVQECA////K1VVSbbbYL/fJ05idsTYJFtbbcjbJllmZszWWMTOIFhoHlNiZszTa9DdUcHNHlNlV8XRIVdiasrUHlZjIVZjaMnVH1RlIFRkH1RkH1ZlasvYasvXVsPQH1VkacnVa8vWIVZjIFRjVMPQa8rXIVVkXsXRsNveIFVkIFZlIVVj3eDeh6GmbMvXH1ZkIFRka8rWbMvXIFVkIFVjIFVkbMvWH1VjbMvWIFVlbcvWIFVla8vVIFVkbMvWbMvVH1VkbMvWIFVlbcvWIFVkbcvVbMvWjNPbIFVkU8LPwMzNIFVkbczWIFVkbsvWbMvXIFVkRnB8bcvW2+TkW8XRIFVkIlZlJVloJlpoKlxrLl9tMmJwOWd0Omh1RXF8TneCT3iDUHiDU8LPVMLPVcLPVcPQVsPPVsPQV8PQWMTQWsTQW8TQXMXSXsXRX4SNX8bSYMfTYcfTYsfTY8jUZcfSZsnUaIqTacrVasrVa8jTa8rWbI2VbMvWbcvWdJObdcvUdszUd8vVeJaee87Yfc3WgJyjhqGnitDYjaarldPZnrK2oNbborW5o9bbo9fbpLa6q9ndrL3ArtndscDDutzfu8fJwN7gwt7gxc/QyuHhy+HizeHi0NfX0+Pj19zb1+Tj2uXk29/e3uLg3+Lh3+bl4uXj4ufl4+fl5Ofl5ufl5ujm5+jmySDnBAAAAFp0Uk5TAAECAgMEBAYHCA0NDg4UGRogIiMmKSssLzU7PkJJT1JTVFliY2hrdHZ3foSFhYeJjY2QkpugqbG1tre5w8zQ09XY3uXn6+zx8vT09vf4+Pj5+fr6/P39/f3+gz7SsAAAAVVJREFUOMtjYKA7EBDnwCPLrObS1BRiLoJLnte6CQy8FLHLCzs2QUG4FjZ5GbcmBDDjxJBXDWxCBrb8aM4zbkIDzpLYnAcE9VXlJSWlZRU13koIeW57mGx5XjoMZEUqwxWYQaQbSzLSkYGfKFSe0QMsX5WbjgY0YS4MBplemI4BdGBW+DQ11eZiymfqQuXZIjqwyadPNoSZ4L+0FVM6e+oGI6g8a9iKNT3o8kVzNkzRg5lgl7p4wyRUL9Yt2jAxVh6mQCogae6GmflI8p0r13VFWTHBQ0rWPW7ahgWVcPm+9cuLoyy4kCJDzCm6d8PSFoh0zvQNC5OjDJhQopPPJqph1doJBUD5tnkbZiUEqaCnB3bTqLTFG1bPn71kw4b+GFdpLElKIzRxxgYgWNYc5SCENVHKeUaltHdXx0dZ8uBI1hJ2UUDgq82CM2MwKeibqAvSO7MCABq0wXEPiqWEAAAAAElFTkSuQmCC";ol.PluggableMap.createOptionsInternal=function(e){var t=null;void 0!==e.keyboardEventTarget&&(t="string"==typeof e.keyboardEventTarget?document.getElementById(e.keyboardEventTarget):e.keyboardEventTarget);var o={},r={};if(void 0===e.logo||"boolean"==typeof e.logo&&e.logo)r[ol.PluggableMap.LOGO_URL]="https://openlayers.org/";else{var i=e.logo;if("string"==typeof i)r[i]="";else if(i instanceof HTMLElement)r[ol.getUid(i).toString()]=i;else if(i){ol.asserts.assert("string"==typeof i.href,44);ol.asserts.assert("string"==typeof i.src,45);r[i.src]=i.href}}var n,a,l=e.layers instanceof ol.layer.Group?e.layers:new ol.layer.Group({layers:e.layers});o[ol.MapProperty.LAYERGROUP]=l;o[ol.MapProperty.TARGET]=e.target;o[ol.MapProperty.VIEW]=void 0!==e.view?e.view:new ol.View;if(void 0!==e.renderer){Array.isArray(e.renderer)?n=e.renderer:"string"==typeof e.renderer?n=[e.renderer]:ol.asserts.assert(!1,46);n.indexOf("dom")>=0&&(n=n.concat(ol.PluggableMap.DEFAULT_RENDERER_TYPES))}else n=ol.PluggableMap.DEFAULT_RENDERER_TYPES;var s,p,c,u=ol.plugins.getMapRendererPlugins();e:for(var g=0,d=n.length;g<d;++g)for(var h=n[g],f=0,y=u.length;f<y;++f){var m=u[f];if(m.handles(h)){a=m;break e}}if(!a)throw new Error("Unable to create a map renderer for types: "+n.join(", "));if(void 0!==e.controls)if(Array.isArray(e.controls))s=new ol.Collection(e.controls.slice());else{ol.asserts.assert(e.controls instanceof ol.Collection,47);s=e.controls}if(void 0!==e.interactions)if(Array.isArray(e.interactions))p=new ol.Collection(e.interactions.slice());else{ol.asserts.assert(e.interactions instanceof ol.Collection,48);p=e.interactions}if(void 0!==e.overlays)if(Array.isArray(e.overlays))c=new ol.Collection(e.overlays.slice());else{ol.asserts.assert(e.overlays instanceof ol.Collection,49);c=e.overlays}else c=new ol.Collection;return{controls:s,interactions:p,keyboardEventTarget:t,logos:r,overlays:c,mapRendererPlugin:a,values:o}};goog.provide("ol.control.Control");goog.require("ol");goog.require("ol.MapEventType");goog.require("ol.Object");goog.require("ol.dom");goog.require("ol.events");ol.control.Control=function(e){ol.Object.call(this);this.element=e.element?e.element:null;this.target_=null;this.map_=null;this.listenerKeys=[];this.render=e.render?e.render:ol.nullFunction;e.target&&this.setTarget(e.target)};ol.inherits(ol.control.Control,ol.Object);ol.control.Control.prototype.disposeInternal=function(){ol.dom.removeNode(this.element);ol.Object.prototype.disposeInternal.call(this)};ol.control.Control.prototype.getMap=function(){return this.map_};ol.control.Control.prototype.setMap=function(e){this.map_&&ol.dom.removeNode(this.element);for(var t=0,o=this.listenerKeys.length;t<o;++t)ol.events.unlistenByKey(this.listenerKeys[t]);this.listenerKeys.length=0;this.map_=e;if(this.map_){(this.target_?this.target_:e.getOverlayContainerStopEvent()).appendChild(this.element);this.render!==ol.nullFunction&&this.listenerKeys.push(ol.events.listen(e,ol.MapEventType.POSTRENDER,this.render,this));e.render()}};ol.control.Control.prototype.setTarget=function(e){this.target_="string"==typeof e?document.getElementById(e):e};goog.provide("ol.css");ol.css.CLASS_HIDDEN="ol-hidden";ol.css.CLASS_SELECTABLE="ol-selectable";ol.css.CLASS_UNSELECTABLE="ol-unselectable";ol.css.CLASS_UNSUPPORTED="ol-unsupported";ol.css.CLASS_CONTROL="ol-control";ol.css.getFontFamilies=(cache={},function(e){style||(style=document.createElement("div").style);if(!(e in cache)){style.font=e;var t=style.fontFamily;style.font="";if(!t)return null;cache[e]=t.split(/,\s?/)}return cache[e]});goog.provide("ol.render.EventType");ol.render.EventType={POSTCOMPOSE:"postcompose",PRECOMPOSE:"precompose",RENDER:"render"};goog.provide("ol.layer.Layer");goog.require("ol.events");goog.require("ol.events.EventType");goog.require("ol");goog.require("ol.Object");goog.require("ol.layer.Base");goog.require("ol.layer.Property");goog.require("ol.obj");goog.require("ol.render.EventType");goog.require("ol.source.State");ol.layer.Layer=function(e){var t=ol.obj.assign({},e);delete t.source;ol.layer.Base.call(this,t);this.mapPrecomposeKey_=null;this.mapRenderKey_=null;this.sourceChangeKey_=null;e.map&&this.setMap(e.map);ol.events.listen(this,ol.Object.getChangeEventType(ol.layer.Property.SOURCE),this.handleSourcePropertyChange_,this);var o=e.source?e.source:null;this.setSource(o)};ol.inherits(ol.layer.Layer,ol.layer.Base);ol.layer.Layer.visibleAtResolution=function(e,t){return e.visible&&t>=e.minResolution&&t<e.maxResolution};ol.layer.Layer.prototype.getLayersArray=function(e){var t=e||[];t.push(this);return t};ol.layer.Layer.prototype.getLayerStatesArray=function(e){var t=e||[];t.push(this.getLayerState());return t};ol.layer.Layer.prototype.getSource=function(){return this.get(ol.layer.Property.SOURCE)||null};ol.layer.Layer.prototype.getSourceState=function(){var e=this.getSource();return e?e.getState():ol.source.State.UNDEFINED};ol.layer.Layer.prototype.handleSourceChange_=function(){this.changed()};ol.layer.Layer.prototype.handleSourcePropertyChange_=function(){if(this.sourceChangeKey_){ol.events.unlistenByKey(this.sourceChangeKey_);this.sourceChangeKey_=null}var e=this.getSource();e&&(this.sourceChangeKey_=ol.events.listen(e,ol.events.EventType.CHANGE,this.handleSourceChange_,this));this.changed()};ol.layer.Layer.prototype.setMap=function(e){if(this.mapPrecomposeKey_){ol.events.unlistenByKey(this.mapPrecomposeKey_);this.mapPrecomposeKey_=null}e||this.changed();if(this.mapRenderKey_){ol.events.unlistenByKey(this.mapRenderKey_);this.mapRenderKey_=null}if(e){this.mapPrecomposeKey_=ol.events.listen(e,ol.render.EventType.PRECOMPOSE,function(e){var t=this.getLayerState();t.managed=!1;t.zIndex=1/0;e.frameState.layerStatesArray.push(t);e.frameState.layerStates[ol.getUid(this)]=t},this);this.mapRenderKey_=ol.events.listen(this,ol.events.EventType.CHANGE,e.render,e);this.changed()}};ol.layer.Layer.prototype.setSource=function(e){this.set(ol.layer.Property.SOURCE,e)};goog.provide("ol.control.Attribution");goog.require("ol");goog.require("ol.array");goog.require("ol.control.Control");goog.require("ol.css");goog.require("ol.dom");goog.require("ol.events");goog.require("ol.events.EventType");goog.require("ol.layer.Layer");goog.require("ol.obj");ol.control.Attribution=function(e){var t=e||{};this.ulElement_=document.createElement("UL");this.logoLi_=document.createElement("LI");this.ulElement_.appendChild(this.logoLi_);this.logoLi_.style.display="none";this.collapsed_=void 0===t.collapsed||t.collapsed;this.collapsible_=void 0===t.collapsible||t.collapsible;this.collapsible_||(this.collapsed_=!1);var o=void 0!==t.className?t.className:"ol-attribution",r=void 0!==t.tipLabel?t.tipLabel:"Attributions",i=void 0!==t.collapseLabel?t.collapseLabel:"\xbb";if("string"==typeof i){this.collapseLabel_=document.createElement("span");this.collapseLabel_.textContent=i}else this.collapseLabel_=i;var n=void 0!==t.label?t.label:"i";if("string"==typeof n){this.label_=document.createElement("span");this.label_.textContent=n}else this.label_=n;var a=this.collapsible_&&!this.collapsed_?this.collapseLabel_:this.label_,l=document.createElement("button");l.setAttribute("type","button");l.title=r;l.appendChild(a);ol.events.listen(l,ol.events.EventType.CLICK,this.handleClick_,this);var s=o+" "+ol.css.CLASS_UNSELECTABLE+" "+ol.css.CLASS_CONTROL+(this.collapsed_&&this.collapsible_?" ol-collapsed":"")+(this.collapsible_?"":" ol-uncollapsible"),p=document.createElement("div");p.className=s;p.appendChild(this.ulElement_);p.appendChild(l);var c=t.render?t.render:ol.control.Attribution.render;ol.control.Control.call(this,{element:p,render:c,target:t.target});this.renderedAttributions_=[];this.renderedVisible_=!0;this.logoElements_={}};ol.inherits(ol.control.Attribution,ol.control.Control);ol.control.Attribution.prototype.getSourceAttributions_=function(e){for(var t={},o=[],r=e.layerStatesArray,i=e.viewState.resolution,n=0,a=r.length;n<a;++n){var l=r[n];if(ol.layer.Layer.visibleAtResolution(l,i)){var s=l.layer.getSource();if(s){var p=s.getAttributions2();if(p){var c=p(e);if(c)if(Array.isArray(c)){for(var u=0,g=c.length;u<g;++u)if(!(c[u]in t)){o.push(c[u]);t[c[u]]=!0}}else if(!(c in t)){o.push(c);t[c]=!0}}}}}return o};ol.control.Attribution.render=function(e){this.updateElement_(e.frameState)};ol.control.Attribution.prototype.updateElement_=function(e){if(e){var t=this.getSourceAttributions_(e);if(!ol.array.equals(t,this.renderedAttributions_)){for(;this.ulElement_.lastChild!==this.logoLi_;)this.ulElement_.removeChild(this.ulElement_.lastChild);for(var o=0,r=t.length;o<r;++o){var i=document.createElement("LI");i.innerHTML=t[o];this.ulElement_.appendChild(i)}0===t.length&&this.renderedAttributions_.length>0?this.element.classList.add("ol-logo-only"):0===this.renderedAttributions_.length&&t.length>0&&this.element.classList.remove("ol-logo-only");var n=t.length>0||!ol.obj.isEmpty(e.logos);if(this.renderedVisible_!=n){this.element.style.display=n?"":"none";this.renderedVisible_=n}this.renderedAttributions_=t;this.insertLogos_(e)}}else if(this.renderedVisible_){this.element.style.display="none";this.renderedVisible_=!1}};ol.control.Attribution.prototype.insertLogos_=function(e){var t,o,r,i,n=e.logos,a=this.logoElements_;for(t in a)if(!(t in n)){ol.dom.removeNode(a[t]);delete a[t]}for(i in n){var l=n[i];if(l instanceof HTMLElement){this.logoLi_.appendChild(l);a[i]=l}if(!(i in a)){(o=new Image).src=i;if(""===l)r=o;else{(r=document.createElement("a")).href=l;r.appendChild(o)}this.logoLi_.appendChild(r);a[i]=r}}this.logoLi_.style.display=ol.obj.isEmpty(n)?"none":""};ol.control.Attribution.prototype.handleClick_=function(e){e.preventDefault();this.handleToggle_()};ol.control.Attribution.prototype.handleToggle_=function(){this.element.classList.toggle("ol-collapsed");this.collapsed_?ol.dom.replaceNode(this.collapseLabel_,this.label_):ol.dom.replaceNode(this.label_,this.collapseLabel_);this.collapsed_=!this.collapsed_};ol.control.Attribution.prototype.getCollapsible=function(){return this.collapsible_};ol.control.Attribution.prototype.setCollapsible=function(e){if(this.collapsible_!==e){this.collapsible_=e;this.element.classList.toggle("ol-uncollapsible");!e&&this.collapsed_&&this.handleToggle_()}};ol.control.Attribution.prototype.setCollapsed=function(e){this.collapsible_&&this.collapsed_!==e&&this.handleToggle_()};ol.control.Attribution.prototype.getCollapsed=function(){return this.collapsed_};goog.provide("ol.control.Rotate");goog.require("ol.events");goog.require("ol.events.EventType");goog.require("ol");goog.require("ol.control.Control");goog.require("ol.css");goog.require("ol.easing");ol.control.Rotate=function(e){var t=e||{},o=void 0!==t.className?t.className:"ol-rotate",r=void 0!==t.label?t.label:"\u21e7";this.label_=null;if("string"==typeof r){this.label_=document.createElement("span");this.label_.className="ol-compass";this.label_.textContent=r}else{this.label_=r;this.label_.classList.add("ol-compass")}var i=t.tipLabel?t.tipLabel:"Reset rotation",n=document.createElement("button");n.className=o+"-reset";n.setAttribute("type","button");n.title=i;n.appendChild(this.label_);ol.events.listen(n,ol.events.EventType.CLICK,ol.control.Rotate.prototype.handleClick_,this);var a=o+" "+ol.css.CLASS_UNSELECTABLE+" "+ol.css.CLASS_CONTROL,l=document.createElement("div");l.className=a;l.appendChild(n);var s=t.render?t.render:ol.control.Rotate.render;this.callResetNorth_=t.resetNorth?t.resetNorth:void 0;ol.control.Control.call(this,{element:l,render:s,target:t.target});this.duration_=void 0!==t.duration?t.duration:250;this.autoHide_=void 0===t.autoHide||t.autoHide;this.rotation_=void 0;this.autoHide_&&this.element.classList.add(ol.css.CLASS_HIDDEN)};ol.inherits(ol.control.Rotate,ol.control.Control);ol.control.Rotate.prototype.handleClick_=function(e){e.preventDefault();void 0!==this.callResetNorth_?this.callResetNorth_():this.resetNorth_()};ol.control.Rotate.prototype.resetNorth_=function(){var e=this.getMap().getView();e&&void 0!==e.getRotation()&&(this.duration_>0?e.animate({rotation:0,duration:this.duration_,easing:ol.easing.easeOut}):e.setRotation(0))};ol.control.Rotate.render=function(e){var t=e.frameState;if(t){var o=t.viewState.rotation;if(o!=this.rotation_){var r="rotate("+o+"rad)";if(this.autoHide_){var i=this.element.classList.contains(ol.css.CLASS_HIDDEN);i||0!==o?i&&0!==o&&this.element.classList.remove(ol.css.CLASS_HIDDEN):this.element.classList.add(ol.css.CLASS_HIDDEN)}this.label_.style.msTransform=r;this.label_.style.webkitTransform=r;this.label_.style.transform=r}this.rotation_=o}};goog.provide("ol.control.Zoom");goog.require("ol");goog.require("ol.events");goog.require("ol.events.EventType");goog.require("ol.control.Control");goog.require("ol.css");goog.require("ol.easing");ol.control.Zoom=function(e){var t=e||{},o=void 0!==t.className?t.className:"ol-zoom",r=void 0!==t.delta?t.delta:1,i=void 0!==t.zoomInLabel?t.zoomInLabel:"+",n=void 0!==t.zoomOutLabel?t.zoomOutLabel:"\u2212",a=void 0!==t.zoomInTipLabel?t.zoomInTipLabel:"Zoom in",l=void 0!==t.zoomOutTipLabel?t.zoomOutTipLabel:"Zoom out",s=document.createElement("button");s.className=o+"-in";s.setAttribute("type","button");s.title=a;s.appendChild("string"==typeof i?document.createTextNode(i):i);ol.events.listen(s,ol.events.EventType.CLICK,ol.control.Zoom.prototype.handleClick_.bind(this,r));var p=document.createElement("button");p.className=o+"-out";p.setAttribute("type","button");p.title=l;p.appendChild("string"==typeof n?document.createTextNode(n):n);ol.events.listen(p,ol.events.EventType.CLICK,ol.control.Zoom.prototype.handleClick_.bind(this,-r));var c=o+" "+ol.css.CLASS_UNSELECTABLE+" "+ol.css.CLASS_CONTROL,u=document.createElement("div");u.className=c;u.appendChild(s);u.appendChild(p);ol.control.Control.call(this,{element:u,target:t.target});this.duration_=void 0!==t.duration?t.duration:250};ol.inherits(ol.control.Zoom,ol.control.Control);ol.control.Zoom.prototype.handleClick_=function(e,t){t.preventDefault();this.zoomByDelta_(e)};ol.control.Zoom.prototype.zoomByDelta_=function(e){var t=this.getMap().getView();if(t){var o=t.getResolution();if(o){var r=t.constrainResolution(o,e);if(this.duration_>0){t.getAnimating()&&t.cancelAnimations();t.animate({resolution:r,duration:this.duration_,easing:ol.easing.easeOut})}else t.setResolution(r)}}};goog.provide("ol.control");goog.require("ol.Collection");goog.require("ol.control.Attribution");goog.require("ol.control.Rotate");goog.require("ol.control.Zoom");ol.control.defaults=function(e){var t=e||{},o=new ol.Collection;(void 0===t.zoom||t.zoom)&&o.push(new ol.control.Zoom(t.zoomOptions));(void 0===t.rotate||t.rotate)&&o.push(new ol.control.Rotate(t.rotateOptions));(void 0===t.attribution||t.attribution)&&o.push(new ol.control.Attribution(t.attributionOptions));return o};goog.provide("ol.Kinetic");ol.Kinetic=function(e,t,o){this.decay_=e;this.minVelocity_=t;this.delay_=o;this.points_=[];this.angle_=0;this.initialVelocity_=0};ol.Kinetic.prototype.begin=function(){this.points_.length=0;this.angle_=0;this.initialVelocity_=0};ol.Kinetic.prototype.update=function(e,t){this.points_.push(e,t,Date.now())};ol.Kinetic.prototype.end=function(){if(this.points_.length<6)return!1;var e=Date.now()-this.delay_,t=this.points_.length-3;if(this.points_[t+2]<e)return!1;for(var o=t-3;o>0&&this.points_[o+2]>e;)o-=3;var r=this.points_[t+2]-this.points_[o+2];if(r<1e3/60)return!1;var i=this.points_[t]-this.points_[o],n=this.points_[t+1]-this.points_[o+1];this.angle_=Math.atan2(n,i);this.initialVelocity_=Math.sqrt(i*i+n*n)/r;return this.initialVelocity_>this.minVelocity_};ol.Kinetic.prototype.getDistance=function(){return(this.minVelocity_-this.initialVelocity_)/this.decay_};ol.Kinetic.prototype.getAngle=function(){return this.angle_};goog.provide("ol.interaction.Property");ol.interaction.Property={ACTIVE:"active"};goog.provide("ol.interaction.Interaction");goog.require("ol");goog.require("ol.Object");goog.require("ol.easing");goog.require("ol.interaction.Property");goog.require("ol.math");ol.interaction.Interaction=function(e){ol.Object.call(this);this.map_=null;this.setActive(!0);this.handleEvent=e.handleEvent};ol.inherits(ol.interaction.Interaction,ol.Object);ol.interaction.Interaction.prototype.getActive=function(){return this.get(ol.interaction.Property.ACTIVE)};ol.interaction.Interaction.prototype.getMap=function(){return this.map_};ol.interaction.Interaction.prototype.setActive=function(e){this.set(ol.interaction.Property.ACTIVE,e)};ol.interaction.Interaction.prototype.setMap=function(e){this.map_=e};ol.interaction.Interaction.pan=function(e,t,o){var r=e.getCenter();if(r){var i=e.constrainCenter([r[0]+t[0],r[1]+t[1]]);o?e.animate({duration:o,easing:ol.easing.linear,center:i}):e.setCenter(i)}};ol.interaction.Interaction.rotate=function(e,t,o,r){t=e.constrainRotation(t,0);ol.interaction.Interaction.rotateWithoutConstraints(e,t,o,r)};ol.interaction.Interaction.rotateWithoutConstraints=function(e,t,o,r){if(void 0!==t){var i=e.getRotation(),n=e.getCenter();void 0!==i&&n&&r>0?e.animate({rotation:t,anchor:o,duration:r,easing:ol.easing.easeOut}):e.rotate(t,o)}};ol.interaction.Interaction.zoom=function(e,t,o,r,i){t=e.constrainResolution(t,0,i);ol.interaction.Interaction.zoomWithoutConstraints(e,t,o,r)};ol.interaction.Interaction.zoomByDelta=function(e,t,o,r){var i=e.getResolution(),n=e.constrainResolution(i,t,0);if(void 0!==n){var a=e.getResolutions();n=ol.math.clamp(n,e.getMinResolution()||a[a.length-1],e.getMaxResolution()||a[0])}if(o&&void 0!==n&&n!==i){var l=e.getCenter(),s=e.calculateCenterZoom(n,o);s=e.constrainCenter(s);o=[(n*l[0]-i*s[0])/(n-i),(n*l[1]-i*s[1])/(n-i)]}ol.interaction.Interaction.zoomWithoutConstraints(e,n,o,r)};ol.interaction.Interaction.zoomWithoutConstraints=function(e,t,o,r){if(t){var i=e.getResolution(),n=e.getCenter();if(void 0!==i&&n&&t!==i&&r)e.animate({resolution:t,anchor:o,duration:r,easing:ol.easing.easeOut});else{if(o){var a=e.calculateCenterZoom(t,o);e.setCenter(a)}e.setResolution(t)}}};goog.provide("ol.interaction.DoubleClickZoom");goog.require("ol");goog.require("ol.MapBrowserEventType");goog.require("ol.interaction.Interaction");ol.interaction.DoubleClickZoom=function(e){var t=e||{};this.delta_=t.delta?t.delta:1;ol.interaction.Interaction.call(this,{handleEvent:ol.interaction.DoubleClickZoom.handleEvent});this.duration_=void 0!==t.duration?t.duration:250};ol.inherits(ol.interaction.DoubleClickZoom,ol.interaction.Interaction);ol.interaction.DoubleClickZoom.handleEvent=function(e){var t=!1,o=e.originalEvent;if(e.type==ol.MapBrowserEventType.DBLCLICK){var r=e.map,i=e.coordinate,n=o.shiftKey?-this.delta_:this.delta_,a=r.getView();ol.interaction.Interaction.zoomByDelta(a,n,i,this.duration_);e.preventDefault();t=!0}return!t};goog.provide("ol.events.condition");goog.require("ol.MapBrowserEventType");goog.require("ol.asserts");goog.require("ol.functions");goog.require("ol.has");ol.events.condition.altKeyOnly=function(e){var t=e.originalEvent;return t.altKey&&!(t.metaKey||t.ctrlKey)&&!t.shiftKey};ol.events.condition.altShiftKeysOnly=function(e){var t=e.originalEvent;return t.altKey&&!(t.metaKey||t.ctrlKey)&&t.shiftKey};ol.events.condition.always=ol.functions.TRUE;ol.events.condition.click=function(e){return e.type==ol.MapBrowserEventType.CLICK};ol.events.condition.mouseActionButton=function(e){var t=e.originalEvent;return 0==t.button&&!(ol.has.WEBKIT&&ol.has.MAC&&t.ctrlKey)};ol.events.condition.never=ol.functions.FALSE;ol.events.condition.pointerMove=function(e){return"pointermove"==e.type};ol.events.condition.singleClick=function(e){return e.type==ol.MapBrowserEventType.SINGLECLICK};ol.events.condition.doubleClick=function(e){return e.type==ol.MapBrowserEventType.DBLCLICK};ol.events.condition.noModifierKeys=function(e){var t=e.originalEvent;return!t.altKey&&!(t.metaKey||t.ctrlKey)&&!t.shiftKey};ol.events.condition.platformModifierKeyOnly=function(e){var t=e.originalEvent;return!t.altKey&&(ol.has.MAC?t.metaKey:t.ctrlKey)&&!t.shiftKey};ol.events.condition.shiftKeyOnly=function(e){var t=e.originalEvent;return!t.altKey&&!(t.metaKey||t.ctrlKey)&&t.shiftKey};ol.events.condition.targetNotEditable=function(e){var t=e.originalEvent.target.tagName;return"INPUT"!==t&&"SELECT"!==t&&"TEXTAREA"!==t};ol.events.condition.mouseOnly=function(e){ol.asserts.assert(e.pointerEvent,56);return"mouse"==e.pointerEvent.pointerType};ol.events.condition.primaryAction=function(e){var t=e.pointerEvent;return t.isPrimary&&0===t.button};goog.provide("ol.interaction.Pointer");goog.require("ol");goog.require("ol.functions");goog.require("ol.MapBrowserEventType");goog.require("ol.MapBrowserPointerEvent");goog.require("ol.interaction.Interaction");goog.require("ol.obj");ol.interaction.Pointer=function(e){var t=e||{},o=t.handleEvent?t.handleEvent:ol.interaction.Pointer.handleEvent;ol.interaction.Interaction.call(this,{handleEvent:o});this.handleDownEvent_=t.handleDownEvent?t.handleDownEvent:ol.interaction.Pointer.handleDownEvent;this.handleDragEvent_=t.handleDragEvent?t.handleDragEvent:ol.interaction.Pointer.handleDragEvent;this.handleMoveEvent_=t.handleMoveEvent?t.handleMoveEvent:ol.interaction.Pointer.handleMoveEvent;this.handleUpEvent_=t.handleUpEvent?t.handleUpEvent:ol.interaction.Pointer.handleUpEvent;this.handlingDownUpSequence=!1;this.trackedPointers_={};this.targetPointers=[]};ol.inherits(ol.interaction.Pointer,ol.interaction.Interaction);ol.interaction.Pointer.centroid=function(e){for(var t=e.length,o=0,r=0,i=0;i<t;i++){o+=e[i].clientX;r+=e[i].clientY}return[o/t,r/t]};ol.interaction.Pointer.prototype.isPointerDraggingEvent_=function(e){var t=e.type;return t===ol.MapBrowserEventType.POINTERDOWN||t===ol.MapBrowserEventType.POINTERDRAG||t===ol.MapBrowserEventType.POINTERUP};ol.interaction.Pointer.prototype.updateTrackedPointers_=function(e){if(this.isPointerDraggingEvent_(e)){var t=e.pointerEvent,o=t.pointerId.toString();e.type==ol.MapBrowserEventType.POINTERUP?delete this.trackedPointers_[o]:e.type==ol.MapBrowserEventType.POINTERDOWN?this.trackedPointers_[o]=t:o in this.trackedPointers_&&(this.trackedPointers_[o]=t);this.targetPointers=ol.obj.getValues(this.trackedPointers_)}};ol.interaction.Pointer.handleDragEvent=ol.nullFunction;ol.interaction.Pointer.handleUpEvent=ol.functions.FALSE;ol.interaction.Pointer.handleDownEvent=ol.functions.FALSE;ol.interaction.Pointer.handleMoveEvent=ol.nullFunction;ol.interaction.Pointer.handleEvent=function(e){if(!(e instanceof ol.MapBrowserPointerEvent))return!0;var t=!1;this.updateTrackedPointers_(e);if(this.handlingDownUpSequence){if(e.type==ol.MapBrowserEventType.POINTERDRAG)this.handleDragEvent_(e);else if(e.type==ol.MapBrowserEventType.POINTERUP){var o=this.handleUpEvent_(e);this.handlingDownUpSequence=o&&this.targetPointers.length>0}}else if(e.type==ol.MapBrowserEventType.POINTERDOWN){var r=this.handleDownEvent_(e);this.handlingDownUpSequence=r;t=this.shouldStopEvent(r)}else e.type==ol.MapBrowserEventType.POINTERMOVE&&this.handleMoveEvent_(e);return!t};ol.interaction.Pointer.prototype.shouldStopEvent=function(e){return e};goog.provide("ol.interaction.DragPan");goog.require("ol");goog.require("ol.ViewHint");goog.require("ol.coordinate");goog.require("ol.easing");goog.require("ol.events.condition");goog.require("ol.functions");goog.require("ol.interaction.Pointer");ol.interaction.DragPan=function(e){ol.interaction.Pointer.call(this,{handleDownEvent:ol.interaction.DragPan.handleDownEvent_,handleDragEvent:ol.interaction.DragPan.handleDragEvent_,handleUpEvent:ol.interaction.DragPan.handleUpEvent_});var t=e||{};this.kinetic_=t.kinetic;this.lastCentroid=null;this.lastPointersCount_;this.condition_=t.condition?t.condition:ol.events.condition.noModifierKeys;this.noKinetic_=!1};ol.inherits(ol.interaction.DragPan,ol.interaction.Pointer);ol.interaction.DragPan.handleDragEvent_=function(e){var t=this.targetPointers,o=ol.interaction.Pointer.centroid(t);if(t.length==this.lastPointersCount_){this.kinetic_&&this.kinetic_.update(o[0],o[1]);if(this.lastCentroid){var r=this.lastCentroid[0]-o[0],i=o[1]-this.lastCentroid[1],n=e.map.getView(),a=n.getState(),l=[r,i];ol.coordinate.scale(l,a.resolution);ol.coordinate.rotate(l,a.rotation);ol.coordinate.add(l,a.center);l=n.constrainCenter(l);n.setCenter(l)}}else this.kinetic_&&this.kinetic_.begin();this.lastCentroid=o;this.lastPointersCount_=t.length};ol.interaction.DragPan.handleUpEvent_=function(e){var t=e.map,o=t.getView();if(0===this.targetPointers.length){if(!this.noKinetic_&&this.kinetic_&&this.kinetic_.end()){var r=this.kinetic_.getDistance(),i=this.kinetic_.getAngle(),n=o.getCenter(),a=t.getPixelFromCoordinate(n),l=t.getCoordinateFromPixel([a[0]-r*Math.cos(i),a[1]-r*Math.sin(i)]);o.animate({center:o.constrainCenter(l),duration:500,easing:ol.easing.easeOut})}o.setHint(ol.ViewHint.INTERACTING,-1);return!1}this.kinetic_&&this.kinetic_.begin();this.lastCentroid=null;return!0};ol.interaction.DragPan.handleDownEvent_=function(e){if(this.targetPointers.length>0&&this.condition_(e)){var t=e.map.getView();this.lastCentroid=null;this.handlingDownUpSequence||t.setHint(ol.ViewHint.INTERACTING,1);t.getAnimating()&&t.setCenter(e.frameState.viewState.center);this.kinetic_&&this.kinetic_.begin();this.noKinetic_=this.targetPointers.length>1;return!0}return!1};ol.interaction.DragPan.prototype.shouldStopEvent=ol.functions.FALSE;goog.provide("ol.interaction.DragRotate");goog.require("ol");goog.require("ol.RotationConstraint");goog.require("ol.ViewHint");goog.require("ol.events.condition");goog.require("ol.functions");goog.require("ol.interaction.Interaction");goog.require("ol.interaction.Pointer");ol.interaction.DragRotate=function(e){var t=e||{};ol.interaction.Pointer.call(this,{handleDownEvent:ol.interaction.DragRotate.handleDownEvent_,handleDragEvent:ol.interaction.DragRotate.handleDragEvent_,handleUpEvent:ol.interaction.DragRotate.handleUpEvent_});this.condition_=t.condition?t.condition:ol.events.condition.altShiftKeysOnly;this.lastAngle_=void 0;this.duration_=void 0!==t.duration?t.duration:250};ol.inherits(ol.interaction.DragRotate,ol.interaction.Pointer);ol.interaction.DragRotate.handleDragEvent_=function(e){if(ol.events.condition.mouseOnly(e)){var t=e.map,o=t.getView();if(o.getConstraints().rotation!==ol.RotationConstraint.disable){var r=t.getSize(),i=e.pixel,n=Math.atan2(r[1]/2-i[1],i[0]-r[0]/2);if(void 0!==this.lastAngle_){var a=n-this.lastAngle_,l=o.getRotation();ol.interaction.Interaction.rotateWithoutConstraints(o,l-a)}this.lastAngle_=n}}};ol.interaction.DragRotate.handleUpEvent_=function(e){if(!ol.events.condition.mouseOnly(e))return!0;var t=e.map.getView();t.setHint(ol.ViewHint.INTERACTING,-1);var o=t.getRotation();ol.interaction.Interaction.rotate(t,o,void 0,this.duration_);return!1};ol.interaction.DragRotate.handleDownEvent_=function(e){if(!ol.events.condition.mouseOnly(e))return!1;if(ol.events.condition.mouseActionButton(e)&&this.condition_(e)){e.map.getView().setHint(ol.ViewHint.INTERACTING,1);this.lastAngle_=void 0;return!0}return!1};ol.interaction.DragRotate.prototype.shouldStopEvent=ol.functions.FALSE;goog.provide("ol.render.Box");goog.require("ol");goog.require("ol.Disposable");goog.require("ol.geom.Polygon");ol.render.Box=function(e){this.geometry_=null;this.element_=document.createElement("div");this.element_.style.position="absolute";this.element_.className="ol-box "+e;this.map_=null;this.startPixel_=null;this.endPixel_=null};ol.inherits(ol.render.Box,ol.Disposable);ol.render.Box.prototype.disposeInternal=function(){this.setMap(null)};ol.render.Box.prototype.render_=function(){var e=this.startPixel_,t=this.endPixel_,o=this.element_.style;o.left=Math.min(e[0],t[0])+"px";o.top=Math.min(e[1],t[1])+"px";o.width=Math.abs(t[0]-e[0])+"px";o.height=Math.abs(t[1]-e[1])+"px"};ol.render.Box.prototype.setMap=function(e){if(this.map_){this.map_.getOverlayContainer().removeChild(this.element_);var t=this.element_.style;t.left=t.top=t.width=t.height="inherit"}this.map_=e;this.map_&&this.map_.getOverlayContainer().appendChild(this.element_)};ol.render.Box.prototype.setPixels=function(e,t){this.startPixel_=e;this.endPixel_=t;this.createOrUpdateGeometry();this.render_()};ol.render.Box.prototype.createOrUpdateGeometry=function(){var e=this.startPixel_,t=this.endPixel_,o=[e,[e[0],t[1]],t,[t[0],e[1]]].map(this.map_.getCoordinateFromPixel,this.map_);o[4]=o[0].slice();this.geometry_?this.geometry_.setCoordinates([o]):this.geometry_=new ol.geom.Polygon([o])};ol.render.Box.prototype.getGeometry=function(){return this.geometry_};goog.provide("ol.interaction.DragBox");goog.require("ol.events.Event");goog.require("ol");goog.require("ol.events.condition");goog.require("ol.interaction.Pointer");goog.require("ol.render.Box");ol.interaction.DragBox=function(e){ol.interaction.Pointer.call(this,{handleDownEvent:ol.interaction.DragBox.handleDownEvent_,handleDragEvent:ol.interaction.DragBox.handleDragEvent_,handleUpEvent:ol.interaction.DragBox.handleUpEvent_});var t=e||{};this.box_=new ol.render.Box(t.className||"ol-dragbox");this.minArea_=void 0!==t.minArea?t.minArea:64;this.startPixel_=null;this.condition_=t.condition?t.condition:ol.events.condition.always;this.boxEndCondition_=t.boxEndCondition?t.boxEndCondition:ol.interaction.DragBox.defaultBoxEndCondition};ol.inherits(ol.interaction.DragBox,ol.interaction.Pointer);ol.interaction.DragBox.defaultBoxEndCondition=function(e,t,o){var r=o[0]-t[0],i=o[1]-t[1];return r*r+i*i>=this.minArea_};ol.interaction.DragBox.handleDragEvent_=function(e){if(ol.events.condition.mouseOnly(e)){this.box_.setPixels(this.startPixel_,e.pixel);this.dispatchEvent(new ol.interaction.DragBox.Event(ol.interaction.DragBox.EventType_.BOXDRAG,e.coordinate,e))}};ol.interaction.DragBox.prototype.getGeometry=function(){return this.box_.getGeometry()};ol.interaction.DragBox.prototype.onBoxEnd=ol.nullFunction;ol.interaction.DragBox.handleUpEvent_=function(e){if(!ol.events.condition.mouseOnly(e))return!0;this.box_.setMap(null);if(this.boxEndCondition_(e,this.startPixel_,e.pixel)){this.onBoxEnd(e);this.dispatchEvent(new ol.interaction.DragBox.Event(ol.interaction.DragBox.EventType_.BOXEND,e.coordinate,e))}return!1};ol.interaction.DragBox.handleDownEvent_=function(e){if(!ol.events.condition.mouseOnly(e))return!1;if(ol.events.condition.mouseActionButton(e)&&this.condition_(e)){this.startPixel_=e.pixel;this.box_.setMap(e.map);this.box_.setPixels(this.startPixel_,this.startPixel_);this.dispatchEvent(new ol.interaction.DragBox.Event(ol.interaction.DragBox.EventType_.BOXSTART,e.coordinate,e));return!0}return!1};ol.interaction.DragBox.EventType_={BOXSTART:"boxstart",BOXDRAG:"boxdrag",BOXEND:"boxend"};ol.interaction.DragBox.Event=function(e,t,o){ol.events.Event.call(this,e);this.coordinate=t;this.mapBrowserEvent=o};ol.inherits(ol.interaction.DragBox.Event,ol.events.Event);goog.provide("ol.interaction.DragZoom");goog.require("ol");goog.require("ol.easing");goog.require("ol.events.condition");goog.require("ol.extent");goog.require("ol.interaction.DragBox");ol.interaction.DragZoom=function(e){var t=e||{},o=t.condition?t.condition:ol.events.condition.shiftKeyOnly;this.duration_=void 0!==t.duration?t.duration:200;this.out_=void 0!==t.out&&t.out;ol.interaction.DragBox.call(this,{condition:o,className:t.className||"ol-dragzoom"})};ol.inherits(ol.interaction.DragZoom,ol.interaction.DragBox);ol.interaction.DragZoom.prototype.onBoxEnd=function(){var e=this.getMap(),t=e.getView(),o=e.getSize(),r=this.getGeometry().getExtent();if(this.out_){var i=t.calculateExtent(o),n=ol.extent.createOrUpdateFromCoordinates([e.getPixelFromCoordinate(ol.extent.getBottomLeft(r)),e.getPixelFromCoordinate(ol.extent.getTopRight(r))]),a=t.getResolutionForExtent(n,o);ol.extent.scaleFromCenter(i,1/a);r=i}var l=t.constrainResolution(t.getResolutionForExtent(r,o)),s=ol.extent.getCenter(r);s=t.constrainCenter(s);t.animate({resolution:l,center:s,duration:this.duration_,easing:ol.easing.easeOut})};goog.provide("ol.events.KeyCode");ol.events.KeyCode={LEFT:37,UP:38,RIGHT:39,DOWN:40};goog.provide("ol.interaction.KeyboardPan");goog.require("ol");goog.require("ol.coordinate");goog.require("ol.events.EventType");goog.require("ol.events.KeyCode");goog.require("ol.events.condition");goog.require("ol.interaction.Interaction");ol.interaction.KeyboardPan=function(e){ol.interaction.Interaction.call(this,{handleEvent:ol.interaction.KeyboardPan.handleEvent});var t=e||{};this.defaultCondition_=function(e){return ol.events.condition.noModifierKeys(e)&&ol.events.condition.targetNotEditable(e)};this.condition_=void 0!==t.condition?t.condition:this.defaultCondition_;this.duration_=void 0!==t.duration?t.duration:100;this.pixelDelta_=void 0!==t.pixelDelta?t.pixelDelta:128};ol.inherits(ol.interaction.KeyboardPan,ol.interaction.Interaction);ol.interaction.KeyboardPan.handleEvent=function(e){var t=!1;if(e.type==ol.events.EventType.KEYDOWN){var o=e.originalEvent.keyCode;if(this.condition_(e)&&(o==ol.events.KeyCode.DOWN||o==ol.events.KeyCode.LEFT||o==ol.events.KeyCode.RIGHT||o==ol.events.KeyCode.UP)){var r=e.map.getView(),i=r.getResolution()*this.pixelDelta_,n=0,a=0;o==ol.events.KeyCode.DOWN?a=-i:o==ol.events.KeyCode.LEFT?n=-i:o==ol.events.KeyCode.RIGHT?n=i:a=i;var l=[n,a];ol.coordinate.rotate(l,r.getRotation());ol.interaction.Interaction.pan(r,l,this.duration_);e.preventDefault();t=!0}}return!t};goog.provide("ol.interaction.KeyboardZoom");goog.require("ol");goog.require("ol.events.EventType");goog.require("ol.events.condition");goog.require("ol.interaction.Interaction");ol.interaction.KeyboardZoom=function(e){ol.interaction.Interaction.call(this,{handleEvent:ol.interaction.KeyboardZoom.handleEvent});var t=e||{};this.condition_=t.condition?t.condition:ol.events.condition.targetNotEditable;this.delta_=t.delta?t.delta:1;this.duration_=void 0!==t.duration?t.duration:100};ol.inherits(ol.interaction.KeyboardZoom,ol.interaction.Interaction);ol.interaction.KeyboardZoom.handleEvent=function(e){var t=!1;if(e.type==ol.events.EventType.KEYDOWN||e.type==ol.events.EventType.KEYPRESS){var o=e.originalEvent.charCode;if(this.condition_(e)&&(o=="+".charCodeAt(0)||o=="-".charCodeAt(0))){var r=e.map,i=o=="+".charCodeAt(0)?this.delta_:-this.delta_,n=r.getView();ol.interaction.Interaction.zoomByDelta(n,i,void 0,this.duration_);e.preventDefault();t=!0}}return!t};goog.provide("ol.interaction.MouseWheelZoom");goog.require("ol");goog.require("ol.ViewHint");goog.require("ol.easing");goog.require("ol.events.EventType");goog.require("ol.has");goog.require("ol.interaction.Interaction");goog.require("ol.math");ol.interaction.MouseWheelZoom=function(e){ol.interaction.Interaction.call(this,{handleEvent:ol.interaction.MouseWheelZoom.handleEvent});var t=e||{};this.delta_=0;this.duration_=void 0!==t.duration?t.duration:250;this.timeout_=void 0!==t.timeout?t.timeout:80;this.useAnchor_=void 0===t.useAnchor||t.useAnchor;this.constrainResolution_=t.constrainResolution||!1;this.lastAnchor_=null;this.startTime_=void 0;this.timeoutId_=void 0;this.mode_=void 0;this.trackpadEventGap_=400;this.trackpadTimeoutId_=void 0;this.trackpadDeltaPerZoom_=300;this.trackpadZoomBuffer_=1.5};ol.inherits(ol.interaction.MouseWheelZoom,ol.interaction.Interaction);ol.interaction.MouseWheelZoom.handleEvent=function(e){var t=e.type;if(t!==ol.events.EventType.WHEEL&&t!==ol.events.EventType.MOUSEWHEEL)return!0;e.preventDefault();var o,r=e.map,i=e.originalEvent;this.useAnchor_&&(this.lastAnchor_=e.coordinate);if(e.type==ol.events.EventType.WHEEL){o=i.deltaY;ol.has.FIREFOX&&i.deltaMode===WheelEvent.DOM_DELTA_PIXEL&&(o/=ol.has.DEVICE_PIXEL_RATIO);i.deltaMode===WheelEvent.DOM_DELTA_LINE&&(o*=40)}else if(e.type==ol.events.EventType.MOUSEWHEEL){o=-i.wheelDeltaY;ol.has.SAFARI&&(o/=3)}if(0===o)return!1;var n=Date.now();void 0===this.startTime_&&(this.startTime_=n);(!this.mode_||n-this.startTime_>this.trackpadEventGap_)&&(this.mode_=Math.abs(o)<4?ol.interaction.MouseWheelZoom.Mode_.TRACKPAD:ol.interaction.MouseWheelZoom.Mode_.WHEEL);if(this.mode_===ol.interaction.MouseWheelZoom.Mode_.TRACKPAD){var a=r.getView();this.trackpadTimeoutId_?clearTimeout(this.trackpadTimeoutId_):a.setHint(ol.ViewHint.INTERACTING,1);this.trackpadTimeoutId_=setTimeout(this.decrementInteractingHint_.bind(this),this.trackpadEventGap_);var l=a.getResolution()*Math.pow(2,o/this.trackpadDeltaPerZoom_),s=a.getMinResolution(),p=a.getMaxResolution(),c=0;if(l<s){l=Math.max(l,s/this.trackpadZoomBuffer_);c=1}else if(l>p){l=Math.min(l,p*this.trackpadZoomBuffer_);c=-1}if(this.lastAnchor_){var u=a.calculateCenterZoom(l,this.lastAnchor_);a.setCenter(a.constrainCenter(u))}a.setResolution(l);0===c&&this.constrainResolution_&&a.animate({resolution:a.constrainResolution(l,o>0?-1:1),easing:ol.easing.easeOut,anchor:this.lastAnchor_,duration:this.duration_});c>0?a.animate({resolution:s,easing:ol.easing.easeOut,anchor:this.lastAnchor_,duration:500}):c<0&&a.animate({resolution:p,easing:ol.easing.easeOut,anchor:this.lastAnchor_,duration:500});this.startTime_=n;return!1}this.delta_+=o;var g=Math.max(this.timeout_-(n-this.startTime_),0);clearTimeout(this.timeoutId_);this.timeoutId_=setTimeout(this.handleWheelZoom_.bind(this,r),g);return!1};ol.interaction.MouseWheelZoom.prototype.decrementInteractingHint_=function(){this.trackpadTimeoutId_=void 0;this.getMap().getView().setHint(ol.ViewHint.INTERACTING,-1)};ol.interaction.MouseWheelZoom.prototype.handleWheelZoom_=function(e){var t=e.getView();t.getAnimating()&&t.cancelAnimations();var o=ol.MOUSEWHEELZOOM_MAXDELTA,r=ol.math.clamp(this.delta_,-o,o);ol.interaction.Interaction.zoomByDelta(t,-r,this.lastAnchor_,this.duration_);this.mode_=void 0;this.delta_=0;this.lastAnchor_=null;this.startTime_=void 0;this.timeoutId_=void 0};ol.interaction.MouseWheelZoom.prototype.setMouseAnchor=function(e){this.useAnchor_=e;e||(this.lastAnchor_=null)};ol.interaction.MouseWheelZoom.Mode_={TRACKPAD:"trackpad",WHEEL:"wheel"};goog.provide("ol.interaction.PinchRotate");goog.require("ol");goog.require("ol.ViewHint");goog.require("ol.functions");goog.require("ol.interaction.Interaction");goog.require("ol.interaction.Pointer");goog.require("ol.RotationConstraint");ol.interaction.PinchRotate=function(e){ol.interaction.Pointer.call(this,{handleDownEvent:ol.interaction.PinchRotate.handleDownEvent_,handleDragEvent:ol.interaction.PinchRotate.handleDragEvent_,handleUpEvent:ol.interaction.PinchRotate.handleUpEvent_});var t=e||{};this.anchor_=null;this.lastAngle_=void 0;this.rotating_=!1;this.rotationDelta_=0;this.threshold_=void 0!==t.threshold?t.threshold:.3;this.duration_=void 0!==t.duration?t.duration:250};ol.inherits(ol.interaction.PinchRotate,ol.interaction.Pointer);ol.interaction.PinchRotate.handleDragEvent_=function(e){var t=0,o=this.targetPointers[0],r=this.targetPointers[1],i=Math.atan2(r.clientY-o.clientY,r.clientX-o.clientX);if(void 0!==this.lastAngle_){var n=i-this.lastAngle_;this.rotationDelta_+=n;!this.rotating_&&Math.abs(this.rotationDelta_)>this.threshold_&&(this.rotating_=!0);t=n}this.lastAngle_=i;var a=e.map,l=a.getView();if(l.getConstraints().rotation!==ol.RotationConstraint.disable){var s=a.getViewport().getBoundingClientRect(),p=ol.interaction.Pointer.centroid(this.targetPointers);p[0]-=s.left;p[1]-=s.top;this.anchor_=a.getCoordinateFromPixel(p);if(this.rotating_){var c=l.getRotation();a.render();ol.interaction.Interaction.rotateWithoutConstraints(l,c+t,this.anchor_)}}};ol.interaction.PinchRotate.handleUpEvent_=function(e){if(this.targetPointers.length<2){var t=e.map.getView();t.setHint(ol.ViewHint.INTERACTING,-1);if(this.rotating_){var o=t.getRotation();ol.interaction.Interaction.rotate(t,o,this.anchor_,this.duration_)}return!1}return!0};ol.interaction.PinchRotate.handleDownEvent_=function(e){if(this.targetPointers.length>=2){var t=e.map;this.anchor_=null;this.lastAngle_=void 0;this.rotating_=!1;this.rotationDelta_=0;this.handlingDownUpSequence||t.getView().setHint(ol.ViewHint.INTERACTING,1);return!0}return!1};ol.interaction.PinchRotate.prototype.shouldStopEvent=ol.functions.FALSE;goog.provide("ol.interaction.PinchZoom");goog.require("ol");goog.require("ol.ViewHint");goog.require("ol.functions");goog.require("ol.interaction.Interaction");goog.require("ol.interaction.Pointer");ol.interaction.PinchZoom=function(e){ol.interaction.Pointer.call(this,{handleDownEvent:ol.interaction.PinchZoom.handleDownEvent_,handleDragEvent:ol.interaction.PinchZoom.handleDragEvent_,handleUpEvent:ol.interaction.PinchZoom.handleUpEvent_});var t=e||{};this.constrainResolution_=t.constrainResolution||!1;this.anchor_=null;this.duration_=void 0!==t.duration?t.duration:400;this.lastDistance_=void 0;this.lastScaleDelta_=1};ol.inherits(ol.interaction.PinchZoom,ol.interaction.Pointer);ol.interaction.PinchZoom.handleDragEvent_=function(e){var t=1,o=this.targetPointers[0],r=this.targetPointers[1],i=o.clientX-r.clientX,n=o.clientY-r.clientY,a=Math.sqrt(i*i+n*n);void 0!==this.lastDistance_&&(t=this.lastDistance_/a);this.lastDistance_=a;var l=e.map,s=l.getView(),p=s.getResolution(),c=s.getMaxResolution(),u=s.getMinResolution(),g=p*t;if(g>c){t=c/p;g=c}else if(g<u){t=u/p;g=u}1!=t&&(this.lastScaleDelta_=t);var d=l.getViewport().getBoundingClientRect(),h=ol.interaction.Pointer.centroid(this.targetPointers);h[0]-=d.left;h[1]-=d.top;this.anchor_=l.getCoordinateFromPixel(h);l.render();ol.interaction.Interaction.zoomWithoutConstraints(s,g,this.anchor_)};ol.interaction.PinchZoom.handleUpEvent_=function(e){if(this.targetPointers.length<2){var t=e.map.getView();t.setHint(ol.ViewHint.INTERACTING,-1);var o=t.getResolution();if(this.constrainResolution_||o<t.getMinResolution()||o>t.getMaxResolution()){var r=this.lastScaleDelta_-1;ol.interaction.Interaction.zoom(t,o,this.anchor_,this.duration_,r)}return!1}return!0};ol.interaction.PinchZoom.handleDownEvent_=function(e){if(this.targetPointers.length>=2){var t=e.map;this.anchor_=null;this.lastDistance_=void 0;this.lastScaleDelta_=1;this.handlingDownUpSequence||t.getView().setHint(ol.ViewHint.INTERACTING,1);return!0}return!1};ol.interaction.PinchZoom.prototype.shouldStopEvent=ol.functions.FALSE;goog.provide("ol.interaction");goog.require("ol.Collection");goog.require("ol.Kinetic");goog.require("ol.interaction.DoubleClickZoom");goog.require("ol.interaction.DragPan");goog.require("ol.interaction.DragRotate");goog.require("ol.interaction.DragZoom");goog.require("ol.interaction.KeyboardPan");goog.require("ol.interaction.KeyboardZoom");goog.require("ol.interaction.MouseWheelZoom");goog.require("ol.interaction.PinchRotate");goog.require("ol.interaction.PinchZoom");ol.interaction.defaults=function(e){var t=e||{},o=new ol.Collection,r=new ol.Kinetic(-.005,.05,100);(void 0===t.altShiftDragRotate||t.altShiftDragRotate)&&o.push(new ol.interaction.DragRotate);(void 0===t.doubleClickZoom||t.doubleClickZoom)&&o.push(new ol.interaction.DoubleClickZoom({delta:t.zoomDelta,duration:t.zoomDuration}));(void 0===t.dragPan||t.dragPan)&&o.push(new ol.interaction.DragPan({kinetic:r}));(void 0===t.pinchRotate||t.pinchRotate)&&o.push(new ol.interaction.PinchRotate);(void 0===t.pinchZoom||t.pinchZoom)&&o.push(new ol.interaction.PinchZoom({constrainResolution:t.constrainResolution,duration:t.zoomDuration}));if(void 0===t.keyboard||t.keyboard){o.push(new ol.interaction.KeyboardPan);o.push(new ol.interaction.KeyboardZoom({delta:t.zoomDelta,duration:t.zoomDuration}))}(void 0===t.mouseWheelZoom||t.mouseWheelZoom)&&o.push(new ol.interaction.MouseWheelZoom({constrainResolution:t.constrainResolution,duration:t.zoomDuration}));(void 0===t.shiftDragZoom||t.shiftDragZoom)&&o.push(new ol.interaction.DragZoom({duration:t.zoomDuration}));return o};goog.provide("ol.ImageBase");goog.require("ol");goog.require("ol.events.EventTarget");goog.require("ol.events.EventType");ol.ImageBase=function(e,t,o,r){ol.events.EventTarget.call(this);this.extent=e;this.pixelRatio_=o;this.resolution=t;this.state=r};ol.inherits(ol.ImageBase,ol.events.EventTarget);ol.ImageBase.prototype.changed=function(){this.dispatchEvent(ol.events.EventType.CHANGE)};ol.ImageBase.prototype.getExtent=function(){return this.extent};ol.ImageBase.prototype.getImage=function(){};ol.ImageBase.prototype.getPixelRatio=function(){return this.pixelRatio_};ol.ImageBase.prototype.getResolution=function(){return this.resolution};ol.ImageBase.prototype.getState=function(){return this.state};ol.ImageBase.prototype.load=function(){};goog.provide("ol.ImageState");ol.ImageState={IDLE:0,LOADING:1,LOADED:2,ERROR:3};goog.provide("ol.ImageCanvas");goog.require("ol");goog.require("ol.ImageBase");goog.require("ol.ImageState");ol.ImageCanvas=function(e,t,o,r,i){this.loader_=void 0!==i?i:null;var n=void 0!==i?ol.ImageState.IDLE:ol.ImageState.LOADED;ol.ImageBase.call(this,e,t,o,n);this.canvas_=r;this.error_=null};ol.inherits(ol.ImageCanvas,ol.ImageBase);ol.ImageCanvas.prototype.getError=function(){return this.error_};ol.ImageCanvas.prototype.handleLoad_=function(e){if(e){this.error_=e;this.state=ol.ImageState.ERROR}else this.state=ol.ImageState.LOADED;this.changed()};ol.ImageCanvas.prototype.load=function(){if(this.state==ol.ImageState.IDLE){this.state=ol.ImageState.LOADING;this.changed();this.loader_(this.handleLoad_.bind(this))}};ol.ImageCanvas.prototype.getImage=function(){return this.canvas_};goog.provide("ol.LayerType");ol.LayerType={IMAGE:"IMAGE",TILE:"TILE",VECTOR_TILE:"VECTOR_TILE",VECTOR:"VECTOR"};goog.provide("ol.layer.VectorRenderType");ol.layer.VectorRenderType={IMAGE:"image",VECTOR:"vector"};goog.provide("ol.render.Event");goog.require("ol");goog.require("ol.events.Event");ol.render.Event=function(e,t,o,r,i){ol.events.Event.call(this,e);this.vectorContext=t;this.frameState=o;this.context=r;this.glContext=i};ol.inherits(ol.render.Event,ol.events.Event);goog.provide("ol.structs.LRUCache");goog.require("ol");goog.require("ol.asserts");goog.require("ol.events.EventTarget");goog.require("ol.events.EventType");ol.structs.LRUCache=function(e){ol.events.EventTarget.call(this);this.highWaterMark=void 0!==e?e:2048;this.count_=0;this.entries_={};this.oldest_=null;this.newest_=null};ol.inherits(ol.structs.LRUCache,ol.events.EventTarget);ol.structs.LRUCache.prototype.canExpireCache=function(){return this.getCount()>this.highWaterMark};ol.structs.LRUCache.prototype.clear=function(){this.count_=0;this.entries_={};this.oldest_=null;this.newest_=null;this.dispatchEvent(ol.events.EventType.CLEAR)};ol.structs.LRUCache.prototype.containsKey=function(e){return this.entries_.hasOwnProperty(e)};ol.structs.LRUCache.prototype.forEach=function(e,t){for(var o=this.oldest_;o;){e.call(t,o.value_,o.key_,this);o=o.newer}};ol.structs.LRUCache.prototype.get=function(e){var t=this.entries_[e];ol.asserts.assert(void 0!==t,15);if(t===this.newest_)return t.value_;if(t===this.oldest_){this.oldest_=this.oldest_.newer;this.oldest_.older=null}else{t.newer.older=t.older;t.older.newer=t.newer}t.newer=null;t.older=this.newest_;this.newest_.newer=t;this.newest_=t;return t.value_};ol.structs.LRUCache.prototype.remove=function(e){var t=this.entries_[e];ol.asserts.assert(void 0!==t,15);if(t===this.newest_){this.newest_=t.older;this.newest_&&(this.newest_.newer=null)}else if(t===this.oldest_){this.oldest_=t.newer;this.oldest_&&(this.oldest_.older=null)}else{t.newer.older=t.older;t.older.newer=t.newer}delete this.entries_[e];--this.count_;return t.value_};ol.structs.LRUCache.prototype.getCount=function(){return this.count_};ol.structs.LRUCache.prototype.getKeys=function(){var e,t=new Array(this.count_),o=0;for(e=this.newest_;e;e=e.older)t[o++]=e.key_;return t};ol.structs.LRUCache.prototype.getValues=function(){var e,t=new Array(this.count_),o=0;for(e=this.newest_;e;e=e.older)t[o++]=e.value_;return t};ol.structs.LRUCache.prototype.peekLast=function(){return this.oldest_.value_};ol.structs.LRUCache.prototype.peekLastKey=function(){return this.oldest_.key_};ol.structs.LRUCache.prototype.peekFirstKey=function(){return this.newest_.key_};ol.structs.LRUCache.prototype.pop=function(){var e=this.oldest_;delete this.entries_[e.key_];e.newer&&(e.newer.older=null);this.oldest_=e.newer;this.oldest_||(this.newest_=null);--this.count_;return e.value_};ol.structs.LRUCache.prototype.replace=function(e,t){this.get(e);this.entries_[e].value_=t};ol.structs.LRUCache.prototype.set=function(e,t){ol.asserts.assert(!(e in this.entries_),16);var o={key_:e,newer:null,older:this.newest_,value_:t};this.newest_?this.newest_.newer=o:this.oldest_=o;this.newest_=o;this.entries_[e]=o;++this.count_};ol.structs.LRUCache.prototype.prune=function(){for(;this.canExpireCache();)this.pop()};goog.provide("ol.render.canvas");goog.require("ol.css");goog.require("ol.dom");goog.require("ol.obj");goog.require("ol.structs.LRUCache");goog.require("ol.transform");ol.render.canvas.defaultFont="10px sans-serif";ol.render.canvas.defaultFillStyle=[0,0,0,1];ol.render.canvas.defaultLineCap="round";ol.render.canvas.defaultLineDash=[];ol.render.canvas.defaultLineDashOffset=0;ol.render.canvas.defaultLineJoin="round";ol.render.canvas.defaultMiterLimit=10;ol.render.canvas.defaultStrokeStyle=[0,0,0,1];ol.render.canvas.defaultTextAlign="center";ol.render.canvas.defaultTextBaseline="middle";ol.render.canvas.defaultPadding=[0,0,0,0];ol.render.canvas.defaultLineWidth=1;ol.render.canvas.labelCache=new ol.structs.LRUCache;ol.render.canvas.checkedFonts_={};ol.render.canvas.measureContext_=null;ol.render.canvas.textHeights_={};ol.render.canvas.checkFont=function(){var e,t,o=60,r=ol.render.canvas.checkedFonts_,i=ol.render.canvas.labelCache,n="32px monospace",a="wmytzilWMYTZIL@#/&?$%10";function l(e){var o=ol.render.canvas.getMeasureContext();o.font=n;t=o.measureText(a).width;var r=!0;if("monospace"!=e){o.font="32px "+e+",monospace";r=o.measureText(a).width!=t}return r}function s(){var t=!0;for(var n in r)if(r[n]<o)if(l(n)){r[n]=o;ol.obj.clear(ol.render.canvas.textHeights_);ol.render.canvas.measureContext_=null;i.clear()}else{++r[n];t=!1}if(t){window.clearInterval(e);e=void 0}}return function(t){var i=ol.css.getFontFamilies(t);if(i)for(var n=0,a=i.length;n<a;++n){var p=i[n];if(!(p in r)){r[p]=o;if(!l(p)){r[p]=0;void 0===e&&(e=window.setInterval(s,32))}}}}}();ol.render.canvas.getMeasureContext=function(){var e=ol.render.canvas.measureContext_;e||(e=ol.render.canvas.measureContext_=ol.dom.createCanvasContext2D(1,1));return e};ol.render.canvas.measureTextHeight=(heights=ol.render.canvas.textHeights_,function(e){var t=heights[e];if(void 0==t){if(!span){(span=document.createElement("span")).textContent="M";span.style.margin=span.style.padding="0 !important";span.style.position="absolute !important";span.style.left="-99999px !important"}span.style.font=e;document.body.appendChild(span);t=heights[e]=span.offsetHeight;document.body.removeChild(span)}return t});ol.render.canvas.measureTextWidth=function(e,t){var o=ol.render.canvas.getMeasureContext();e!=o.font&&(o.font=e);return o.measureText(t).width};ol.render.canvas.rotateAtOffset=function(e,t,o,r){if(0!==t){e.translate(o,r);e.rotate(t);e.translate(-o,-r)}};ol.render.canvas.resetTransform_=ol.transform.create();ol.render.canvas.drawImage=function(e,t,o,r,i,n,a,l,s,p,c){var u;if(1!=o){u=e.globalAlpha;e.globalAlpha=u*o}t&&e.setTransform.apply(e,t);e.drawImage(r,i,n,a,l,s,p,a*c,l*c);u&&(e.globalAlpha=u);t&&e.setTransform.apply(e,ol.render.canvas.resetTransform_)};goog.provide("ol.color");goog.require("ol.asserts");goog.require("ol.math");ol.color.HEX_COLOR_RE_=/^#(?:[0-9a-f]{3,4}){1,2}$/i;ol.color.NAMED_COLOR_RE_=/^([a-z]*)$/i;ol.color.asArray=function(e){return Array.isArray(e)?e:ol.color.fromString(e)};ol.color.asString=function(e){return"string"==typeof e?e:ol.color.toString(e)};ol.color.fromNamed=function(e){var t=document.createElement("div");t.style.color=e;document.body.appendChild(t);var o=getComputedStyle(t).color;document.body.removeChild(t);return o};ol.color.fromString=function(){var e={},t=0;return function(o){var r;if(e.hasOwnProperty(o))r=e[o];else{if(t>=1024){var i,n=0;for(i in e)if(0==(3&n++)){delete e[i];--t}}r=ol.color.fromStringInternal_(o);e[o]=r;++t}return r}}();ol.color.fromStringInternal_=function(e){var t,o,r,i,n,a;ol.color.NAMED_COLOR_RE_.exec(e)&&(e=ol.color.fromNamed(e));if(ol.color.HEX_COLOR_RE_.exec(e)){var l,s=e.length-1;l=s<=4?1:2;var p=4===s||8===s;t=parseInt(e.substr(1+0*l,l),16);o=parseInt(e.substr(1+1*l,l),16);r=parseInt(e.substr(1+2*l,l),16);i=p?parseInt(e.substr(1+3*l,l),16):255;if(1==l){t=(t<<4)+t;o=(o<<4)+o;r=(r<<4)+r;p&&(i=(i<<4)+i)}n=[t,o,r,i/255]}else if(0==e.indexOf("rgba(")){a=e.slice(5,-1).split(",").map(Number);n=ol.color.normalize(a)}else if(0==e.indexOf("rgb(")){(a=e.slice(4,-1).split(",").map(Number)).push(1);n=ol.color.normalize(a)}else ol.asserts.assert(!1,14);return n};ol.color.normalize=function(e,t){var o=t||[];o[0]=ol.math.clamp(e[0]+.5|0,0,255);o[1]=ol.math.clamp(e[1]+.5|0,0,255);o[2]=ol.math.clamp(e[2]+.5|0,0,255);o[3]=ol.math.clamp(e[3],0,1);return o};ol.color.toString=function(e){var t=e[0];t!=(0|t)&&(t=t+.5|0);var o=e[1];o!=(0|o)&&(o=o+.5|0);var r=e[2];r!=(0|r)&&(r=r+.5|0);return"rgba("+t+","+o+","+r+","+(void 0===e[3]?1:e[3])+")"};goog.provide("ol.colorlike");goog.require("ol.color");ol.colorlike.asColorLike=function(e){return ol.colorlike.isColorLike(e)?e:ol.color.asString(e)};ol.colorlike.isColorLike=function(e){return"string"==typeof e||e instanceof CanvasPattern||e instanceof CanvasGradient};goog.provide("ol.render.VectorContext");ol.render.VectorContext=function(){};ol.render.VectorContext.prototype.drawCustom=function(e,t,o){};ol.render.VectorContext.prototype.drawGeometry=function(e){};ol.render.VectorContext.prototype.setStyle=function(e){};ol.render.VectorContext.prototype.drawCircle=function(e,t){};ol.render.VectorContext.prototype.drawFeature=function(e,t){};ol.render.VectorContext.prototype.drawGeometryCollection=function(e,t){};ol.render.VectorContext.prototype.drawLineString=function(e,t){};ol.render.VectorContext.prototype.drawMultiLineString=function(e,t){};ol.render.VectorContext.prototype.drawMultiPoint=function(e,t){};ol.render.VectorContext.prototype.drawMultiPolygon=function(e,t){};ol.render.VectorContext.prototype.drawPoint=function(e,t){};ol.render.VectorContext.prototype.drawPolygon=function(e,t){};ol.render.VectorContext.prototype.drawText=function(e,t){};ol.render.VectorContext.prototype.setFillStrokeStyle=function(e,t){};ol.render.VectorContext.prototype.setImageStyle=function(e,t){};ol.render.VectorContext.prototype.setTextStyle=function(e,t){};goog.provide("ol.render.canvas.Immediate");goog.require("ol");goog.require("ol.array");goog.require("ol.colorlike");goog.require("ol.extent");goog.require("ol.geom.GeometryType");goog.require("ol.geom.SimpleGeometry");goog.require("ol.geom.flat.transform");goog.require("ol.has");goog.require("ol.render.VectorContext");goog.require("ol.render.canvas");goog.require("ol.transform");ol.render.canvas.Immediate=function(e,t,o,r,i){ol.render.VectorContext.call(this);this.context_=e;this.pixelRatio_=t;this.extent_=o;this.transform_=r;this.viewRotation_=i;this.contextFillState_=null;this.contextStrokeState_=null;this.contextTextState_=null;this.fillState_=null;this.strokeState_=null;this.image_=null;this.imageAnchorX_=0;this.imageAnchorY_=0;this.imageHeight_=0;this.imageOpacity_=0;this.imageOriginX_=0;this.imageOriginY_=0;this.imageRotateWithView_=!1;this.imageRotation_=0;this.imageScale_=0;this.imageSnapToPixel_=!1;this.imageWidth_=0;this.text_="";this.textOffsetX_=0;this.textOffsetY_=0;this.textRotateWithView_=!1;this.textRotation_=0;this.textScale_=0;this.textFillState_=null;this.textStrokeState_=null;this.textState_=null;this.pixelCoordinates_=[];this.tmpLocalTransform_=ol.transform.create()};ol.inherits(ol.render.canvas.Immediate,ol.render.VectorContext);ol.render.canvas.Immediate.prototype.drawImages_=function(e,t,o,r){if(this.image_){var i=ol.geom.flat.transform.transform2D(e,t,o,2,this.transform_,this.pixelCoordinates_),n=this.context_,a=this.tmpLocalTransform_,l=n.globalAlpha;1!=this.imageOpacity_&&(n.globalAlpha=l*this.imageOpacity_);var s,p,c=this.imageRotation_;this.imageRotateWithView_&&(c+=this.viewRotation_);for(s=0,p=i.length;s<p;s+=2){var u=i[s]-this.imageAnchorX_,g=i[s+1]-this.imageAnchorY_;if(this.imageSnapToPixel_){u=Math.round(u);g=Math.round(g)}if(0!==c||1!=this.imageScale_){var d=u+this.imageAnchorX_,h=g+this.imageAnchorY_;ol.transform.compose(a,d,h,this.imageScale_,this.imageScale_,c,-d,-h);n.setTransform.apply(n,a)}n.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,u,g,this.imageWidth_,this.imageHeight_)}0===c&&1==this.imageScale_||n.setTransform(1,0,0,1,0,0);1!=this.imageOpacity_&&(n.globalAlpha=l)}};ol.render.canvas.Immediate.prototype.drawText_=function(e,t,o,r){if(this.textState_&&""!==this.text_){this.textFillState_&&this.setContextFillState_(this.textFillState_);this.textStrokeState_&&this.setContextStrokeState_(this.textStrokeState_);this.setContextTextState_(this.textState_);var i=ol.geom.flat.transform.transform2D(e,t,o,r,this.transform_,this.pixelCoordinates_),n=this.context_,a=this.textRotation_;this.textRotateWithView_&&(a+=this.viewRotation_);for(;t<o;t+=r){var l=i[t]+this.textOffsetX_,s=i[t+1]+this.textOffsetY_;if(0!==a||1!=this.textScale_){var p=ol.transform.compose(this.tmpLocalTransform_,l,s,this.textScale_,this.textScale_,a,-l,-s);n.setTransform.apply(n,p)}this.textStrokeState_&&n.strokeText(this.text_,l,s);this.textFillState_&&n.fillText(this.text_,l,s)}0===a&&1==this.textScale_||n.setTransform(1,0,0,1,0,0)}};ol.render.canvas.Immediate.prototype.moveToLineTo_=function(e,t,o,r,i){var n=this.context_,a=ol.geom.flat.transform.transform2D(e,t,o,r,this.transform_,this.pixelCoordinates_);n.moveTo(a[0],a[1]);var l=a.length;i&&(l-=2);for(var s=2;s<l;s+=2)n.lineTo(a[s],a[s+1]);i&&n.closePath();return o};ol.render.canvas.Immediate.prototype.drawRings_=function(e,t,o,r){var i,n;for(i=0,n=o.length;i<n;++i)t=this.moveToLineTo_(e,t,o[i],r,!0);return t};ol.render.canvas.Immediate.prototype.drawCircle=function(e){if(ol.extent.intersects(this.extent_,e.getExtent())){if(this.fillState_||this.strokeState_){this.fillState_&&this.setContextFillState_(this.fillState_);this.strokeState_&&this.setContextStrokeState_(this.strokeState_);var t=ol.geom.SimpleGeometry.transform2D(e,this.transform_,this.pixelCoordinates_),o=t[2]-t[0],r=t[3]-t[1],i=Math.sqrt(o*o+r*r),n=this.context_;n.beginPath();n.arc(t[0],t[1],i,0,2*Math.PI);this.fillState_&&n.fill();this.strokeState_&&n.stroke()}""!==this.text_&&this.drawText_(e.getCenter(),0,2,2)}};ol.render.canvas.Immediate.prototype.setStyle=function(e){this.setFillStrokeStyle(e.getFill(),e.getStroke());this.setImageStyle(e.getImage());this.setTextStyle(e.getText())};ol.render.canvas.Immediate.prototype.drawGeometry=function(e){switch(e.getType()){case ol.geom.GeometryType.POINT:this.drawPoint(e);break;case ol.geom.GeometryType.LINE_STRING:this.drawLineString(e);break;case ol.geom.GeometryType.POLYGON:this.drawPolygon(e);break;case ol.geom.GeometryType.MULTI_POINT:this.drawMultiPoint(e);break;case ol.geom.GeometryType.MULTI_LINE_STRING:this.drawMultiLineString(e);break;case ol.geom.GeometryType.MULTI_POLYGON:this.drawMultiPolygon(e);break;case ol.geom.GeometryType.GEOMETRY_COLLECTION:this.drawGeometryCollection(e);break;case ol.geom.GeometryType.CIRCLE:this.drawCircle(e)}};ol.render.canvas.Immediate.prototype.drawFeature=function(e,t){var o=t.getGeometryFunction()(e);if(o&&ol.extent.intersects(this.extent_,o.getExtent())){this.setStyle(t);this.drawGeometry(o)}};ol.render.canvas.Immediate.prototype.drawGeometryCollection=function(e){var t,o,r=e.getGeometriesArray();for(t=0,o=r.length;t<o;++t)this.drawGeometry(r[t])};ol.render.canvas.Immediate.prototype.drawPoint=function(e){var t=e.getFlatCoordinates(),o=e.getStride();this.image_&&this.drawImages_(t,0,t.length,o);""!==this.text_&&this.drawText_(t,0,t.length,o)};ol.render.canvas.Immediate.prototype.drawMultiPoint=function(e){var t=e.getFlatCoordinates(),o=e.getStride();this.image_&&this.drawImages_(t,0,t.length,o);""!==this.text_&&this.drawText_(t,0,t.length,o)};ol.render.canvas.Immediate.prototype.drawLineString=function(e){if(ol.extent.intersects(this.extent_,e.getExtent())){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);var t=this.context_,o=e.getFlatCoordinates();t.beginPath();this.moveToLineTo_(o,0,o.length,e.getStride(),!1);t.stroke()}if(""!==this.text_){var r=e.getFlatMidpoint();this.drawText_(r,0,2,2)}}};ol.render.canvas.Immediate.prototype.drawMultiLineString=function(e){var t=e.getExtent();if(ol.extent.intersects(this.extent_,t)){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);var o,r,i=this.context_,n=e.getFlatCoordinates(),a=0,l=e.getEnds(),s=e.getStride();i.beginPath();for(o=0,r=l.length;o<r;++o)a=this.moveToLineTo_(n,a,l[o],s,!1);i.stroke()}if(""!==this.text_){var p=e.getFlatMidpoints();this.drawText_(p,0,p.length,2)}}};ol.render.canvas.Immediate.prototype.drawPolygon=function(e){if(ol.extent.intersects(this.extent_,e.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_);this.strokeState_&&this.setContextStrokeState_(this.strokeState_);var t=this.context_;t.beginPath();this.drawRings_(e.getOrientedFlatCoordinates(),0,e.getEnds(),e.getStride());this.fillState_&&t.fill();this.strokeState_&&t.stroke()}if(""!==this.text_){var o=e.getFlatInteriorPoint();this.drawText_(o,0,2,2)}}};ol.render.canvas.Immediate.prototype.drawMultiPolygon=function(e){if(ol.extent.intersects(this.extent_,e.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_);this.strokeState_&&this.setContextStrokeState_(this.strokeState_);var t,o,r=this.context_,i=e.getOrientedFlatCoordinates(),n=0,a=e.getEndss(),l=e.getStride();r.beginPath();for(t=0,o=a.length;t<o;++t){var s=a[t];n=this.drawRings_(i,n,s,l)}this.fillState_&&r.fill();this.strokeState_&&r.stroke()}if(""!==this.text_){var p=e.getFlatInteriorPoints();this.drawText_(p,0,p.length,2)}}};ol.render.canvas.Immediate.prototype.setContextFillState_=function(e){var t=this.context_,o=this.contextFillState_;if(o)o.fillStyle!=e.fillStyle&&(o.fillStyle=t.fillStyle=e.fillStyle);else{t.fillStyle=e.fillStyle;this.contextFillState_={fillStyle:e.fillStyle}}};ol.render.canvas.Immediate.prototype.setContextStrokeState_=function(e){var t=this.context_,o=this.contextStrokeState_;if(o){o.lineCap!=e.lineCap&&(o.lineCap=t.lineCap=e.lineCap);if(ol.has.CANVAS_LINE_DASH){ol.array.equals(o.lineDash,e.lineDash)||t.setLineDash(o.lineDash=e.lineDash);o.lineDashOffset!=e.lineDashOffset&&(o.lineDashOffset=t.lineDashOffset=e.lineDashOffset)}o.lineJoin!=e.lineJoin&&(o.lineJoin=t.lineJoin=e.lineJoin);o.lineWidth!=e.lineWidth&&(o.lineWidth=t.lineWidth=e.lineWidth);o.miterLimit!=e.miterLimit&&(o.miterLimit=t.miterLimit=e.miterLimit);o.strokeStyle!=e.strokeStyle&&(o.strokeStyle=t.strokeStyle=e.strokeStyle)}else{t.lineCap=e.lineCap;if(ol.has.CANVAS_LINE_DASH){t.setLineDash(e.lineDash);t.lineDashOffset=e.lineDashOffset}t.lineJoin=e.lineJoin;t.lineWidth=e.lineWidth;t.miterLimit=e.miterLimit;t.strokeStyle=e.strokeStyle;this.contextStrokeState_={lineCap:e.lineCap,lineDash:e.lineDash,lineDashOffset:e.lineDashOffset,lineJoin:e.lineJoin,lineWidth:e.lineWidth,miterLimit:e.miterLimit,strokeStyle:e.strokeStyle}}};ol.render.canvas.Immediate.prototype.setContextTextState_=function(e){var t=this.context_,o=this.contextTextState_,r=e.textAlign?e.textAlign:ol.render.canvas.defaultTextAlign;if(o){o.font!=e.font&&(o.font=t.font=e.font);o.textAlign!=r&&(o.textAlign=r);o.textBaseline!=e.textBaseline&&(o.textBaseline=t.textBaseline=e.textBaseline)}else{t.font=e.font;t.textAlign=r;t.textBaseline=e.textBaseline;this.contextTextState_={font:e.font,textAlign:r,textBaseline:e.textBaseline}}};ol.render.canvas.Immediate.prototype.setFillStrokeStyle=function(e,t){if(e){var o=e.getColor();this.fillState_={fillStyle:ol.colorlike.asColorLike(o||ol.render.canvas.defaultFillStyle)}}else this.fillState_=null;if(t){var r=t.getColor(),i=t.getLineCap(),n=t.getLineDash(),a=t.getLineDashOffset(),l=t.getLineJoin(),s=t.getWidth(),p=t.getMiterLimit();this.strokeState_={lineCap:void 0!==i?i:ol.render.canvas.defaultLineCap,lineDash:n||ol.render.canvas.defaultLineDash,lineDashOffset:a||ol.render.canvas.defaultLineDashOffset,lineJoin:void 0!==l?l:ol.render.canvas.defaultLineJoin,lineWidth:this.pixelRatio_*(void 0!==s?s:ol.render.canvas.defaultLineWidth),miterLimit:void 0!==p?p:ol.render.canvas.defaultMiterLimit,strokeStyle:ol.colorlike.asColorLike(r||ol.render.canvas.defaultStrokeStyle)}}else this.strokeState_=null};ol.render.canvas.Immediate.prototype.setImageStyle=function(e){if(e){var t=e.getAnchor(),o=e.getImage(1),r=e.getOrigin(),i=e.getSize();this.imageAnchorX_=t[0];this.imageAnchorY_=t[1];this.imageHeight_=i[1];this.image_=o;this.imageOpacity_=e.getOpacity();this.imageOriginX_=r[0];this.imageOriginY_=r[1];this.imageRotateWithView_=e.getRotateWithView();this.imageRotation_=e.getRotation();this.imageScale_=e.getScale()*this.pixelRatio_;this.imageSnapToPixel_=e.getSnapToPixel();this.imageWidth_=i[0]}else this.image_=null};ol.render.canvas.Immediate.prototype.setTextStyle=function(e){if(e){var t=e.getFill();if(t){var o=t.getColor();this.textFillState_={fillStyle:ol.colorlike.asColorLike(o||ol.render.canvas.defaultFillStyle)}}else this.textFillState_=null;var r=e.getStroke();if(r){var i=r.getColor(),n=r.getLineCap(),a=r.getLineDash(),l=r.getLineDashOffset(),s=r.getLineJoin(),p=r.getWidth(),c=r.getMiterLimit();this.textStrokeState_={lineCap:void 0!==n?n:ol.render.canvas.defaultLineCap,lineDash:a||ol.render.canvas.defaultLineDash,lineDashOffset:l||ol.render.canvas.defaultLineDashOffset,lineJoin:void 0!==s?s:ol.render.canvas.defaultLineJoin,lineWidth:void 0!==p?p:ol.render.canvas.defaultLineWidth,miterLimit:void 0!==c?c:ol.render.canvas.defaultMiterLimit,strokeStyle:ol.colorlike.asColorLike(i||ol.render.canvas.defaultStrokeStyle)}}else this.textStrokeState_=null;var u=e.getFont(),g=e.getOffsetX(),d=e.getOffsetY(),h=e.getRotateWithView(),f=e.getRotation(),y=e.getScale(),m=e.getText(),v=e.getTextAlign(),C=e.getTextBaseline();this.textState_={font:void 0!==u?u:ol.render.canvas.defaultFont,textAlign:void 0!==v?v:ol.render.canvas.defaultTextAlign,textBaseline:void 0!==C?C:ol.render.canvas.defaultTextBaseline};this.text_=void 0!==m?m:"";this.textOffsetX_=void 0!==g?this.pixelRatio_*g:0;this.textOffsetY_=void 0!==d?this.pixelRatio_*d:0;this.textRotateWithView_=void 0!==h&&h;this.textRotation_=void 0!==f?f:0;this.textScale_=this.pixelRatio_*(void 0!==y?y:1)}else this.text_=""};goog.provide("ol.renderer.Layer");goog.require("ol");goog.require("ol.ImageState");goog.require("ol.Observable");goog.require("ol.TileState");goog.require("ol.asserts");goog.require("ol.events");goog.require("ol.events.EventType");goog.require("ol.functions");goog.require("ol.source.State");ol.renderer.Layer=function(e){ol.Observable.call(this);this.layer_=e};ol.inherits(ol.renderer.Layer,ol.Observable);ol.renderer.Layer.prototype.forEachFeatureAtCoordinate=ol.nullFunction;ol.renderer.Layer.prototype.hasFeatureAtCoordinate=ol.functions.FALSE;ol.renderer.Layer.prototype.createLoadedTileFinder=function(e,t,o){return function(r,i){return e.forEachLoadedTile(t,r,i,function(e){o[r]||(o[r]={});o[r][e.tileCoord.toString()]=e})}};ol.renderer.Layer.prototype.getLayer=function(){return this.layer_};ol.renderer.Layer.prototype.handleImageChange_=function(e){e.target.getState()===ol.ImageState.LOADED&&this.renderIfReadyAndVisible()};ol.renderer.Layer.prototype.loadImage=function(e){var t=e.getState();t!=ol.ImageState.LOADED&&t!=ol.ImageState.ERROR&&ol.events.listen(e,ol.events.EventType.CHANGE,this.handleImageChange_,this);if(t==ol.ImageState.IDLE){e.load();t=e.getState()}return t==ol.ImageState.LOADED};ol.renderer.Layer.prototype.renderIfReadyAndVisible=function(){var e=this.getLayer();e.getVisible()&&e.getSourceState()==ol.source.State.READY&&this.changed()};ol.renderer.Layer.prototype.scheduleExpireCache=function(e,t){if(t.canExpireCache()){var o=function(e,t,o){var r=ol.getUid(e).toString();r in o.usedTiles&&e.expireCache(o.viewState.projection,o.usedTiles[r])}.bind(null,t);e.postRenderFunctions.push(o)}};ol.renderer.Layer.prototype.updateLogos=function(e,t){var o=t.getLogo();if(void 0!==o)if("string"==typeof o)e.logos[o]="";else if(o){ol.asserts.assert("string"==typeof o.href,44);ol.asserts.assert("string"==typeof o.src,45);e.logos[o.src]=o.href}};ol.renderer.Layer.prototype.updateUsedTiles=function(e,t,o,r){var i=ol.getUid(t).toString(),n=o.toString();if(i in e)n in e[i]?e[i][n].extend(r):e[i][n]=r;else{e[i]={};e[i][n]=r}};ol.renderer.Layer.prototype.manageTilePyramid=function(e,t,o,r,i,n,a,l,s,p){var c=ol.getUid(t).toString();c in e.wantedTiles||(e.wantedTiles[c]={});var u,g,d,h,f,y,m=e.wantedTiles[c],v=e.tileQueue;for(y=o.getMinZoom();y<=a;++y){g=o.getTileRangeForExtentAndZ(n,y,g);d=o.getResolution(y);for(h=g.minX;h<=g.maxX;++h)for(f=g.minY;f<=g.maxY;++f)if(a-y<=l){if((u=t.getTile(y,h,f,r,i)).getState()==ol.TileState.IDLE){m[u.getKey()]=!0;v.isKeyQueued(u.getKey())||v.enqueue([u,c,o.getTileCoordCenter(u.tileCoord),d])}void 0!==s&&s.call(p,u)}else t.useTile(y,h,f,i)}};goog.provide("ol.renderer.canvas.Layer");goog.require("ol");goog.require("ol.extent");goog.require("ol.functions");goog.require("ol.render.Event");goog.require("ol.render.EventType");goog.require("ol.render.canvas");goog.require("ol.render.canvas.Immediate");goog.require("ol.renderer.Layer");goog.require("ol.transform");ol.renderer.canvas.Layer=function(e){ol.renderer.Layer.call(this,e);this.renderedResolution;this.transform_=ol.transform.create()};ol.inherits(ol.renderer.canvas.Layer,ol.renderer.Layer);ol.renderer.canvas.Layer.prototype.clip=function(e,t,o){var r=t.pixelRatio,i=t.size[0]*r,n=t.size[1]*r,a=t.viewState.rotation,l=ol.extent.getTopLeft(o),s=ol.extent.getTopRight(o),p=ol.extent.getBottomRight(o),c=ol.extent.getBottomLeft(o);ol.transform.apply(t.coordinateToPixelTransform,l);ol.transform.apply(t.coordinateToPixelTransform,s);ol.transform.apply(t.coordinateToPixelTransform,p);ol.transform.apply(t.coordinateToPixelTransform,c);e.save();ol.render.canvas.rotateAtOffset(e,-a,i/2,n/2);e.beginPath();e.moveTo(l[0]*r,l[1]*r);e.lineTo(s[0]*r,s[1]*r);e.lineTo(p[0]*r,p[1]*r);e.lineTo(c[0]*r,c[1]*r);e.clip();ol.render.canvas.rotateAtOffset(e,a,i/2,n/2)};ol.renderer.canvas.Layer.prototype.dispatchComposeEvent_=function(e,t,o,r){var i=this.getLayer();if(i.hasListener(e)){var n=o.size[0]*o.pixelRatio,a=o.size[1]*o.pixelRatio,l=o.viewState.rotation;ol.render.canvas.rotateAtOffset(t,-l,n/2,a/2);var s=void 0!==r?r:this.getTransform(o,0),p=new ol.render.canvas.Immediate(t,o.pixelRatio,o.extent,s,o.viewState.rotation),c=new ol.render.Event(e,p,o,t,null);i.dispatchEvent(c);ol.render.canvas.rotateAtOffset(t,l,n/2,a/2)}};ol.renderer.canvas.Layer.prototype.forEachLayerAtCoordinate=function(e,t,o,r){return this.forEachFeatureAtCoordinate(e,t,0,ol.functions.TRUE,this)?o.call(r,this.getLayer(),null):void 0};ol.renderer.canvas.Layer.prototype.postCompose=function(e,t,o,r){this.dispatchComposeEvent_(ol.render.EventType.POSTCOMPOSE,e,t,r)};ol.renderer.canvas.Layer.prototype.preCompose=function(e,t,o){this.dispatchComposeEvent_(ol.render.EventType.PRECOMPOSE,e,t,o)};ol.renderer.canvas.Layer.prototype.dispatchRenderEvent=function(e,t,o){this.dispatchComposeEvent_(ol.render.EventType.RENDER,e,t,o)};ol.renderer.canvas.Layer.prototype.getTransform=function(e,t){var o=e.viewState,r=e.pixelRatio,i=r*e.size[0]/2,n=r*e.size[1]/2,a=r/o.resolution,l=-a,s=-o.rotation,p=-o.center[0]+t,c=-o.center[1];return ol.transform.compose(this.transform_,i,n,a,l,s,p,c)};ol.renderer.canvas.Layer.prototype.composeFrame=function(e,t,o){};ol.renderer.canvas.Layer.prototype.prepareFrame=function(e,t){};goog.provide("ol.renderer.canvas.IntermediateCanvas");goog.require("ol");goog.require("ol.coordinate");goog.require("ol.dom");goog.require("ol.extent");goog.require("ol.renderer.canvas.Layer");goog.require("ol.transform");ol.renderer.canvas.IntermediateCanvas=function(e){ol.renderer.canvas.Layer.call(this,e);this.coordinateToCanvasPixelTransform=ol.transform.create();this.hitCanvasContext_=null};ol.inherits(ol.renderer.canvas.IntermediateCanvas,ol.renderer.canvas.Layer);ol.renderer.canvas.IntermediateCanvas.prototype.composeFrame=function(e,t,o){this.preCompose(o,e);var r=this.getImage();if(r){var i=t.extent,n=void 0!==i&&!ol.extent.containsExtent(i,e.extent)&&ol.extent.intersects(i,e.extent);n&&this.clip(o,e,i);var a=this.getImageTransform(),l=o.globalAlpha;o.globalAlpha=t.opacity;var s=a[4],p=a[5],c=r.width*a[0],u=r.height*a[3];o.drawImage(r,0,0,+r.width,+r.height,Math.round(s),Math.round(p),Math.round(c),Math.round(u));o.globalAlpha=l;n&&o.restore()}this.postCompose(o,e,t)};ol.renderer.canvas.IntermediateCanvas.prototype.getImage=function(){};ol.renderer.canvas.IntermediateCanvas.prototype.getImageTransform=function(){};ol.renderer.canvas.IntermediateCanvas.prototype.forEachFeatureAtCoordinate=function(e,t,o,r,i){var n=this.getLayer(),a=n.getSource(),l=t.viewState.resolution,s=t.viewState.rotation,p=t.skippedFeatureUids;return a.forEachFeatureAtCoordinate(e,l,s,o,p,function(e){return r.call(i,e,n)})};ol.renderer.canvas.IntermediateCanvas.prototype.forEachLayerAtCoordinate=function(e,t,o,r){if(this.getImage()){if(this.getLayer().getSource().forEachFeatureAtCoordinate!==ol.nullFunction)return ol.renderer.canvas.Layer.prototype.forEachLayerAtCoordinate.apply(this,arguments);var i=ol.transform.apply(this.coordinateToCanvasPixelTransform,e.slice());ol.coordinate.scale(i,t.viewState.resolution/this.renderedResolution);this.hitCanvasContext_||(this.hitCanvasContext_=ol.dom.createCanvasContext2D(1,1));this.hitCanvasContext_.clearRect(0,0,1,1);this.hitCanvasContext_.drawImage(this.getImage(),i[0],i[1],1,1,0,0,1,1);var n=this.hitCanvasContext_.getImageData(0,0,1,1).data;return n[3]>0?o.call(r,this.getLayer(),n):void 0}};goog.provide("ol.renderer.canvas.ImageLayer");goog.require("ol");goog.require("ol.ImageCanvas");goog.require("ol.LayerType");goog.require("ol.ViewHint");goog.require("ol.array");goog.require("ol.extent");goog.require("ol.layer.VectorRenderType");goog.require("ol.obj");goog.require("ol.plugins");goog.require("ol.renderer.Type");goog.require("ol.renderer.canvas.IntermediateCanvas");goog.require("ol.transform");ol.renderer.canvas.ImageLayer=function(e){ol.renderer.canvas.IntermediateCanvas.call(this,e);this.image_=null;this.imageTransform_=ol.transform.create();this.skippedFeatures_=[];this.vectorRenderer_=null};ol.inherits(ol.renderer.canvas.ImageLayer,ol.renderer.canvas.IntermediateCanvas);ol.renderer.canvas.ImageLayer.handles=function(e,t){return e===ol.renderer.Type.CANVAS&&(t.getType()===ol.LayerType.IMAGE||t.getType()===ol.LayerType.VECTOR&&t.getRenderMode()===ol.layer.VectorRenderType.IMAGE)};ol.renderer.canvas.ImageLayer.create=function(e,t){var o=new ol.renderer.canvas.ImageLayer(t);if(t.getType()===ol.LayerType.VECTOR)for(var r=ol.plugins.getLayerRendererPlugins(),i=0,n=r.length;i<n;++i){var a=r[i];a!==ol.renderer.canvas.ImageLayer&&a.handles(ol.renderer.Type.CANVAS,t)&&o.setVectorRenderer(a.create(e,t))}return o};ol.renderer.canvas.ImageLayer.prototype.getImage=function(){return this.image_?this.image_.getImage():null};ol.renderer.canvas.ImageLayer.prototype.getImageTransform=function(){return this.imageTransform_};ol.renderer.canvas.ImageLayer.prototype.prepareFrame=function(e,t){var o,r=e.pixelRatio,i=e.size,n=e.viewState,a=n.center,l=n.resolution,s=this.getLayer().getSource(),p=e.viewHints,c=e.extent;void 0!==t.extent&&(c=ol.extent.getIntersection(c,t.extent));if(!p[ol.ViewHint.ANIMATING]&&!p[ol.ViewHint.INTERACTING]&&!ol.extent.isEmpty(c)){var u=n.projection;if(!ol.ENABLE_RASTER_REPROJECTION){var g=s.getProjection();g&&(u=g)}var d=this.vectorRenderer_;if(d){var h=d.context,f=ol.obj.assign({},e,{size:[ol.extent.getWidth(c)/l,ol.extent.getHeight(c)/l],viewState:ol.obj.assign({},e.viewState,{rotation:0})}),y=Object.keys(f.skippedFeatureUids).sort();if(d.prepareFrame(f,t)&&(d.replayGroupChanged||!ol.array.equals(y,this.skippedFeatures_))){h.canvas.width=f.size[0]*r;h.canvas.height=f.size[1]*r;d.composeFrame(f,t,h);this.image_=new ol.ImageCanvas(c,l,r,h.canvas);this.skippedFeatures_=y}}else if(o=s.getImage(c,l,r,u)){this.loadImage(o)&&(this.image_=o)}}if(this.image_){var m=(o=this.image_).getExtent(),v=o.getResolution(),C=o.getPixelRatio(),T=r*v/(l*C),S=ol.transform.compose(this.imageTransform_,r*i[0]/2,r*i[1]/2,T,T,0,C*(m[0]-a[0])/v,C*(a[1]-m[3])/v);ol.transform.compose(this.coordinateToCanvasPixelTransform,r*i[0]/2-S[4],r*i[1]/2-S[5],r/l,-r/l,0,-a[0],-a[1]);this.updateLogos(e,s);this.renderedResolution=v*r/C}return!!this.image_};ol.renderer.canvas.ImageLayer.prototype.forEachFeatureAtCoordinate=function(e,t,o,r,i){return this.vectorRenderer_?this.vectorRenderer_.forEachFeatureAtCoordinate(e,t,o,r,i):ol.renderer.canvas.IntermediateCanvas.prototype.forEachFeatureAtCoordinate.call(this,e,t,o,r,i)};ol.renderer.canvas.ImageLayer.prototype.setVectorRenderer=function(e){this.vectorRenderer_=e};goog.provide("ol.style.IconImageCache");goog.require("ol.color");ol.style.IconImageCache=function(){this.cache_={};this.cacheSize_=0;this.maxCacheSize_=32};ol.style.IconImageCache.getKey=function(e,t,o){return t+":"+e+":"+(o?ol.color.asString(o):"null")};ol.style.IconImageCache.prototype.clear=function(){this.cache_={};this.cacheSize_=0};ol.style.IconImageCache.prototype.expire=function(){if(this.cacheSize_>this.maxCacheSize_){var e,t,o=0;for(e in this.cache_){t=this.cache_[e];if(0==(3&o++)&&!t.hasListener()){delete this.cache_[e];--this.cacheSize_}}}};ol.style.IconImageCache.prototype.get=function(e,t,o){var r=ol.style.IconImageCache.getKey(e,t,o);return r in this.cache_?this.cache_[r]:null};ol.style.IconImageCache.prototype.set=function(e,t,o,r){var i=ol.style.IconImageCache.getKey(e,t,o);this.cache_[i]=r;++this.cacheSize_};ol.style.IconImageCache.prototype.setSize=function(e){this.maxCacheSize_=e;this.expire()};goog.provide("ol.style");goog.require("ol.style.IconImageCache");ol.style.iconImageCache=new ol.style.IconImageCache;goog.provide("ol.renderer.Map");goog.require("ol");goog.require("ol.Disposable");goog.require("ol.events");goog.require("ol.events.EventType");goog.require("ol.extent");goog.require("ol.functions");goog.require("ol.layer.Layer");goog.require("ol.plugins");goog.require("ol.style");goog.require("ol.transform");ol.renderer.Map=function(e,t){ol.Disposable.call(this);this.map_=t;this.layerRenderers_={};this.layerRendererListeners_={}};ol.inherits(ol.renderer.Map,ol.Disposable);ol.renderer.Map.prototype.calculateMatrices2D=function(e){var t=e.viewState,o=e.coordinateToPixelTransform,r=e.pixelToCoordinateTransform;ol.transform.compose(o,e.size[0]/2,e.size[1]/2,1/t.resolution,-1/t.resolution,-t.rotation,-t.center[0],-t.center[1]);ol.transform.invert(ol.transform.setFromArray(r,o))};ol.renderer.Map.prototype.removeLayerRenderers=function(){for(var e in this.layerRenderers_)this.removeLayerRendererByKey_(e).dispose()};ol.renderer.Map.expireIconCache_=function(e,t){ol.style.iconImageCache.expire()};ol.renderer.Map.prototype.forEachFeatureAtCoordinate=function(e,t,o,r,i,n,a){var l,s=t.viewState,p=s.resolution;function c(e,o){var n=ol.getUid(e).toString(),a=t.layerStates[ol.getUid(o)].managed;if(!(n in t.skippedFeatureUids)||a)return r.call(i,e,a?o:null)}var u=s.projection,g=e;if(u.canWrapX()){var d=u.getExtent(),h=ol.extent.getWidth(d),f=e[0];if(f<d[0]||f>d[2]){g=[f+h*Math.ceil((d[0]-f)/h),e[1]]}}var y,m=t.layerStatesArray;for(y=m.length-1;y>=0;--y){var v=m[y],C=v.layer;if(ol.layer.Layer.visibleAtResolution(v,p)&&n.call(a,C)){var T=this.getLayerRenderer(C);C.getSource()&&(l=T.forEachFeatureAtCoordinate(C.getSource().getWrapX()?g:e,t,o,c,i));if(l)return l}}};ol.renderer.Map.prototype.forEachLayerAtPixel=function(e,t,o,r,i,n){};ol.renderer.Map.prototype.hasFeatureAtCoordinate=function(e,t,o,r,i){return void 0!==this.forEachFeatureAtCoordinate(e,t,o,ol.functions.TRUE,this,r,i)};ol.renderer.Map.prototype.getLayerRenderer=function(e){var t=ol.getUid(e).toString();if(t in this.layerRenderers_)return this.layerRenderers_[t];for(var o,r=ol.plugins.getLayerRendererPlugins(),i=this.getType(),n=0,a=r.length;n<a;++n){var l=r[n];if(l.handles(i,e)){o=l.create(this,e);break}}if(!o)throw new Error("Unable to create renderer for layer: "+e.getType());this.layerRenderers_[t]=o;this.layerRendererListeners_[t]=ol.events.listen(o,ol.events.EventType.CHANGE,this.handleLayerRendererChange_,this);return o};ol.renderer.Map.prototype.getLayerRendererByKey=function(e){return this.layerRenderers_[e]};ol.renderer.Map.prototype.getLayerRenderers=function(){return this.layerRenderers_};ol.renderer.Map.prototype.getMap=function(){return this.map_};ol.renderer.Map.prototype.getType=function(){};ol.renderer.Map.prototype.handleLayerRendererChange_=function(){this.map_.render()};ol.renderer.Map.prototype.removeLayerRendererByKey_=function(e){var t=this.layerRenderers_[e];delete this.layerRenderers_[e];ol.events.unlistenByKey(this.layerRendererListeners_[e]);delete this.layerRendererListeners_[e];return t};ol.renderer.Map.prototype.renderFrame=ol.nullFunction;ol.renderer.Map.prototype.removeUnusedLayerRenderers_=function(e,t){var o;for(o in this.layerRenderers_)t&&o in t.layerStates||this.removeLayerRendererByKey_(o).dispose()};ol.renderer.Map.prototype.scheduleExpireIconCache=function(e){e.postRenderFunctions.push(ol.renderer.Map.expireIconCache_)};ol.renderer.Map.prototype.scheduleRemoveUnusedLayerRenderers=function(e){var t;for(t in this.layerRenderers_)if(!(t in e.layerStates)){e.postRenderFunctions.push(this.removeUnusedLayerRenderers_.bind(this));return}};ol.renderer.Map.sortByZIndex=function(e,t){return e.zIndex-t.zIndex};goog.provide("ol.renderer.canvas.Map");goog.require("ol.transform");goog.require("ol");goog.require("ol.array");goog.require("ol.css");goog.require("ol.dom");goog.require("ol.layer.Layer");goog.require("ol.render.Event");goog.require("ol.render.EventType");goog.require("ol.render.canvas");goog.require("ol.render.canvas.Immediate");goog.require("ol.renderer.Map");goog.require("ol.renderer.Type");goog.require("ol.source.State");ol.renderer.canvas.Map=function(e,t){ol.renderer.Map.call(this,e,t);this.context_=ol.dom.createCanvasContext2D();this.canvas_=this.context_.canvas;this.canvas_.style.width="100%";this.canvas_.style.height="100%";this.canvas_.style.display="block";this.canvas_.className=ol.css.CLASS_UNSELECTABLE;e.insertBefore(this.canvas_,e.childNodes[0]||null);this.renderedVisible_=!0;this.transform_=ol.transform.create()};ol.inherits(ol.renderer.canvas.Map,ol.renderer.Map);ol.renderer.canvas.Map.handles=function(e){return e===ol.renderer.Type.CANVAS};ol.renderer.canvas.Map.create=function(e,t){return new ol.renderer.canvas.Map(e,t)};ol.renderer.canvas.Map.prototype.dispatchComposeEvent_=function(e,t){var o=this.getMap(),r=this.context_;if(o.hasListener(e)){var i=t.extent,n=t.pixelRatio,a=t.viewState.rotation,l=this.getTransform(t),s=new ol.render.canvas.Immediate(r,n,i,l,a),p=new ol.render.Event(e,s,t,r,null);o.dispatchEvent(p)}};ol.renderer.canvas.Map.prototype.getTransform=function(e){var t=e.viewState,o=this.canvas_.width/2,r=this.canvas_.height/2,i=e.pixelRatio/t.resolution,n=-i,a=-t.rotation,l=-t.center[0],s=-t.center[1];return ol.transform.compose(this.transform_,o,r,i,n,a,l,s)};ol.renderer.canvas.Map.prototype.getType=function(){return ol.renderer.Type.CANVAS};ol.renderer.canvas.Map.prototype.renderFrame=function(e){if(e){var t=this.context_,o=e.pixelRatio,r=Math.round(e.size[0]*o),i=Math.round(e.size[1]*o);if(this.canvas_.width!=r||this.canvas_.height!=i){this.canvas_.width=r;this.canvas_.height=i}else t.clearRect(0,0,r,i);var n=e.viewState.rotation;this.calculateMatrices2D(e);this.dispatchComposeEvent_(ol.render.EventType.PRECOMPOSE,e);var a=e.layerStatesArray;ol.array.stableSort(a,ol.renderer.Map.sortByZIndex);if(n){t.save();ol.render.canvas.rotateAtOffset(t,n,r/2,i/2)}var l,s,p,c,u,g=e.viewState.resolution;for(l=0,s=a.length;l<s;++l){p=(u=a[l]).layer;c=this.getLayerRenderer(p);ol.layer.Layer.visibleAtResolution(u,g)&&u.sourceState==ol.source.State.READY&&(c.prepareFrame(e,u)&&c.composeFrame(e,u,t))}n&&t.restore();this.dispatchComposeEvent_(ol.render.EventType.POSTCOMPOSE,e);if(!this.renderedVisible_){this.canvas_.style.display="";this.renderedVisible_=!0}this.scheduleRemoveUnusedLayerRenderers(e);this.scheduleExpireIconCache(e)}else if(this.renderedVisible_){this.canvas_.style.display="none";this.renderedVisible_=!1}};ol.renderer.canvas.Map.prototype.forEachLayerAtPixel=function(e,t,o,r,i,n){var a,l,s=t.viewState.resolution,p=t.layerStatesArray,c=p.length,u=ol.transform.apply(t.pixelToCoordinateTransform,e.slice());for(l=c-1;l>=0;--l){var g=p[l],d=g.layer;if(ol.layer.Layer.visibleAtResolution(g,s)&&i.call(n,d)){if(a=this.getLayerRenderer(d).forEachLayerAtCoordinate(u,t,o,r))return a}}};goog.provide("ol.renderer.canvas.TileLayer");goog.require("ol");goog.require("ol.LayerType");goog.require("ol.TileRange");goog.require("ol.TileState");goog.require("ol.ViewHint");goog.require("ol.dom");goog.require("ol.extent");goog.require("ol.renderer.Type");goog.require("ol.renderer.canvas.IntermediateCanvas");goog.require("ol.transform");ol.renderer.canvas.TileLayer=function(e){ol.renderer.canvas.IntermediateCanvas.call(this,e);this.context=null===this.context?null:ol.dom.createCanvasContext2D();this.oversampling_;this.renderedExtent_=null;this.renderedRevision;this.renderedTiles=[];this.tmpExtent=ol.extent.createEmpty();this.tmpTileRange_=new ol.TileRange(0,0,0,0);this.imageTransform_=ol.transform.create();this.zDirection=0};ol.inherits(ol.renderer.canvas.TileLayer,ol.renderer.canvas.IntermediateCanvas);ol.renderer.canvas.TileLayer.handles=function(e,t){return e===ol.renderer.Type.CANVAS&&t.getType()===ol.LayerType.TILE};ol.renderer.canvas.TileLayer.create=function(e,t){return new ol.renderer.canvas.TileLayer(t)};ol.renderer.canvas.TileLayer.prototype.isDrawableTile_=function(e){var t=e.getState(),o=this.getLayer().getUseInterimTilesOnError();return t==ol.TileState.LOADED||t==ol.TileState.EMPTY||t==ol.TileState.ERROR&&!o};ol.renderer.canvas.TileLayer.prototype.prepareFrame=function(e,t){var o=e.pixelRatio,r=e.size,i=e.viewState,n=i.projection,a=i.resolution,l=i.center,s=this.getLayer(),p=s.getSource(),c=p.getRevision(),u=p.getTileGridForProjection(n),g=u.getZForResolution(a,this.zDirection),d=u.getResolution(g),h=Math.round(a/d)||1,f=e.extent;void 0!==t.extent&&(f=ol.extent.getIntersection(f,t.extent));if(ol.extent.isEmpty(f))return!1;var y=u.getTileRangeForExtentAndZ(f,g),m=u.getTileRangeExtent(g,y),v=p.getTilePixelRatio(o),C={};C[g]={};var T,S,_,E=this.createLoadedTileFinder(p,n,C),x=this.tmpExtent,P=this.tmpTileRange_,L=!1;for(S=y.minX;S<=y.maxX;++S)for(_=y.minY;_<=y.maxY;++_){(T=p.getTile(g,S,_,o,n)).getState()==ol.TileState.ERROR&&(s.getUseInterimTilesOnError()?s.getPreload()>0&&(L=!0):T.setState(ol.TileState.LOADED));this.isDrawableTile_(T)||(T=T.getInterimTile());if(this.isDrawableTile_(T)){var w=ol.getUid(this);if(T.getState()==ol.TileState.LOADED){C[g][T.tileCoord.toString()]=T;var b=T.inTransition(w);L||!b&&-1!==this.renderedTiles.indexOf(T)||(L=!0)}if(1===T.getAlpha(w,e.time))continue}var R=u.getTileCoordChildTileRange(T.tileCoord,P,x),A=!1;R&&(A=E(g+1,R));A||u.forEachTileCoordParentTileRange(T.tileCoord,E,null,P,x)}var M=d*o/v*h,I=e.viewHints,O=I[ol.ViewHint.ANIMATING]||I[ol.ViewHint.INTERACTING];if(!(this.renderedResolution&&Date.now()-e.time>16&&O)&&(L||!this.renderedExtent_||!ol.extent.containsExtent(this.renderedExtent_,f)||this.renderedRevision!=c||h!=this.oversampling_||!O&&M!=this.renderedResolution)){var N=this.context;if(N){var D=p.getTilePixelSize(g,o,n),F=Math.round(y.getWidth()*D[0]/h),k=Math.round(y.getHeight()*D[1]/h),G=N.canvas;if(G.width!=F||G.height!=k){this.oversampling_=h;G.width=F;G.height=k}else{this.renderedExtent_&&!ol.extent.equals(m,this.renderedExtent_)&&N.clearRect(0,0,F,k);h=this.oversampling_}}this.renderedTiles.length=0;var U,B,$,q,j,W,V,Y,K,X,H=Object.keys(C).map(Number);H.sort(function(e,t){return e===g?1:t===g?-1:e>t?1:e<t?-1:0});for(q=0,j=H.length;q<j;++q){$=H[q];B=p.getTilePixelSize($,o,n);U=u.getResolution($)/d;V=v*p.getGutter(n);Y=C[$];for(var z in Y){T=Y[z];S=((W=u.getTileCoordExtent(T.getTileCoord(),x))[0]-m[0])/d*v/h;_=(m[3]-W[3])/d*v/h;K=B[0]*U/h;X=B[1]*U/h;this.drawTileImage(T,e,t,S,_,K,X,V,g===$);this.renderedTiles.push(T)}}this.renderedRevision=c;this.renderedResolution=d*o/v*h;this.renderedExtent_=m}var Z=this.renderedResolution/a,J=ol.transform.compose(this.imageTransform_,o*r[0]/2,o*r[1]/2,Z,Z,0,(this.renderedExtent_[0]-l[0])/this.renderedResolution*o,(l[1]-this.renderedExtent_[3])/this.renderedResolution*o);ol.transform.compose(this.coordinateToCanvasPixelTransform,o*r[0]/2-J[4],o*r[1]/2-J[5],o/a,-o/a,0,-l[0],-l[1]);this.updateUsedTiles(e.usedTiles,p,g,y);this.manageTilePyramid(e,p,u,o,n,f,g,s.getPreload());this.scheduleExpireCache(e,p);this.updateLogos(e,p);return this.renderedTiles.length>0};ol.renderer.canvas.TileLayer.prototype.drawTileImage=function(e,t,o,r,i,n,a,l,s){var p=e.getImage(this.getLayer());if(p){var c=ol.getUid(this),u=s?e.getAlpha(c,t.time):1;1!==u||this.getLayer().getSource().getOpaque(t.viewState.projection)||this.context.clearRect(r,i,n,a);var g=u!==this.context.globalAlpha;if(g){this.context.save();this.context.globalAlpha=u}this.context.drawImage(p,l,l,p.width-2*l,p.height-2*l,r,i,n,a);g&&this.context.restore();1!==u?t.animate=!0:s&&e.endTransition(c)}};ol.renderer.canvas.TileLayer.prototype.getImage=function(){var e=this.context;return e?e.canvas:null};ol.renderer.canvas.TileLayer.prototype.getLayer;ol.renderer.canvas.TileLayer.prototype.getImageTransform=function(){return this.imageTransform_};goog.provide("ol.ext.rbush");ol.ext.rbush=function(){};(function(){!function(e){"use strict";var t=r,o=r;function r(e,t,o,r,a){!function e(t,o,r,n,a){for(;n>r;){if(n-r>600){var l=n-r+1,s=o-r+1,p=Math.log(l),c=.5*Math.exp(2*p/3),u=.5*Math.sqrt(p*c*(l-c)/l)*(s-l/2<0?-1:1),g=Math.max(r,Math.floor(o-s*c/l+u)),d=Math.min(n,Math.floor(o+(l-s)*c/l+u));e(t,o,g,d,a)}var h=t[o],f=r,y=n;i(t,r,o);a(t[n],h)>0&&i(t,r,n);for(;f<y;){i(t,f,y);f++;y--;for(;a(t[f],h)<0;)f++;for(;a(t[y],h)>0;)y--}0===a(t[r],h)?i(t,r,y):i(t,++y,n);y<=o&&(r=y+1);o<=y&&(n=y-1)}}(e,t,o||0,r||e.length-1,a||n)}function i(e,t,o){var r=e[t];e[t]=e[o];e[o]=r}function n(e,t){return e<t?-1:e>t?1:0}t.default=o;var a=l;function l(e,t){if(!(this instanceof l))return new l(e,t);this._maxEntries=Math.max(4,e||9);this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries));t&&this._initFormat(t);this.clear()}l.prototype={all:function(){return this._all(this.data,[])},search:function(e){var t=this.data,o=[],r=this.toBBox;if(!m(e,t))return o;for(var i,n,a,l,s=[];t;){for(i=0,n=t.children.length;i<n;i++){a=t.children[i];m(e,l=t.leaf?r(a):a)&&(t.leaf?o.push(a):y(e,l)?this._all(a,o):s.push(a))}t=s.pop()}return o},collides:function(e){var t=this.data,o=this.toBBox;if(!m(e,t))return!1;for(var r,i,n,a,l=[];t;){for(r=0,i=t.children.length;r<i;r++){n=t.children[r];if(m(e,a=t.leaf?o(n):n)){if(t.leaf||y(e,a))return!0;l.push(n)}}t=l.pop()}return!1},load:function(e){if(!e||!e.length)return this;if(e.length<this._minEntries){for(var t=0,o=e.length;t<o;t++)this.insert(e[t]);return this}var r=this._build(e.slice(),0,e.length-1,0);if(this.data.children.length)if(this.data.height===r.height)this._splitRoot(this.data,r);else{if(this.data.height<r.height){var i=this.data;this.data=r;r=i}this._insert(r,this.data.height-r.height-1,!0)}else this.data=r;return this},insert:function(e){e&&this._insert(e,this.data.height-1);return this},clear:function(){this.data=v([]);return this},remove:function(e,t){if(!e)return this;for(var o,r,i,n,a=this.data,l=this.toBBox(e),p=[],c=[];a||p.length;){if(!a){a=p.pop();r=p[p.length-1];o=c.pop();n=!0}if(a.leaf&&-1!==(i=s(e,a.children,t))){a.children.splice(i,1);p.push(a);this._condense(p);return this}if(n||a.leaf||!y(a,l))if(r){o++;a=r.children[o];n=!1}else a=null;else{p.push(a);c.push(o);o=0;r=a;a=a.children[0]}}return this},toBBox:function(e){return e},compareMinX:g,compareMinY:d,toJSON:function(){return this.data},fromJSON:function(e){this.data=e;return this},_all:function(e,t){for(var o=[];e;){e.leaf?t.push.apply(t,e.children):o.push.apply(o,e.children);e=o.pop()}return t},_build:function(e,t,o,r){var i,n=o-t+1,a=this._maxEntries;if(n<=a){p(i=v(e.slice(t,o+1)),this.toBBox);return i}if(!r){r=Math.ceil(Math.log(n)/Math.log(a));a=Math.ceil(n/Math.pow(a,r-1))}(i=v([])).leaf=!1;i.height=r;var l,s,c,u,g=Math.ceil(n/a),d=g*Math.ceil(Math.sqrt(a));C(e,t,o,d,this.compareMinX);for(l=t;l<=o;l+=d){C(e,l,c=Math.min(l+d-1,o),g,this.compareMinY);for(s=l;s<=c;s+=g){u=Math.min(s+g-1,c);i.children.push(this._build(e,s,u,r-1))}}p(i,this.toBBox);return i},_chooseSubtree:function(e,t,o,r){for(var i,n,a,l,s,p,c,u,g,d;;){r.push(t);if(t.leaf||r.length-1===o)break;c=u=1/0;for(i=0,n=t.children.length;i<n;i++){s=h(a=t.children[i]);if((p=(g=e,d=a,(Math.max(d.maxX,g.maxX)-Math.min(d.minX,g.minX))*(Math.max(d.maxY,g.maxY)-Math.min(d.minY,g.minY)))-s)<u){u=p;c=s<c?s:c;l=a}else if(p===u&&s<c){c=s;l=a}}t=l||t.children[0]}return t},_insert:function(e,t,o){var r=this.toBBox,i=o?e:r(e),n=[],a=this._chooseSubtree(i,this.data,t,n);a.children.push(e);u(a,i);for(;t>=0&&n[t].children.length>this._maxEntries;){this._split(n,t);t--}this._adjustParentBBoxes(i,n,t)},_split:function(e,t){var o=e[t],r=o.children.length,i=this._minEntries;this._chooseSplitAxis(o,i,r);var n=this._chooseSplitIndex(o,i,r),a=v(o.children.splice(n,o.children.length-n));a.height=o.height;a.leaf=o.leaf;p(o,this.toBBox);p(a,this.toBBox);t?e[t-1].children.push(a):this._splitRoot(o,a)},_splitRoot:function(e,t){this.data=v([e,t]);this.data.height=e.height+1;this.data.leaf=!1;p(this.data,this.toBBox)},_chooseSplitIndex:function(e,t,o){var r,i,n,a,l,s,p,u,g,d,f,y,m,v;s=p=1/0;for(r=t;r<=o-t;r++){i=c(e,0,r,this.toBBox);n=c(e,r,o,this.toBBox);a=(g=i,d=n,void 0,void 0,void 0,void 0,f=Math.max(g.minX,d.minX),y=Math.max(g.minY,d.minY),m=Math.min(g.maxX,d.maxX),v=Math.min(g.maxY,d.maxY),Math.max(0,m-f)*Math.max(0,v-y));l=h(i)+h(n);if(a<s){s=a;u=r;p=l<p?l:p}else if(a===s&&l<p){p=l;u=r}}return u},_chooseSplitAxis:function(e,t,o){var r=e.leaf?this.compareMinX:g,i=e.leaf?this.compareMinY:d;this._allDistMargin(e,t,o,r)<this._allDistMargin(e,t,o,i)&&e.children.sort(r)},_allDistMargin:function(e,t,o,r){e.children.sort(r);var i,n,a=this.toBBox,l=c(e,0,t,a),s=c(e,o-t,o,a),p=f(l)+f(s);for(i=t;i<o-t;i++){n=e.children[i];u(l,e.leaf?a(n):n);p+=f(l)}for(i=o-t-1;i>=t;i--){n=e.children[i];u(s,e.leaf?a(n):n);p+=f(s)}return p},_adjustParentBBoxes:function(e,t,o){for(var r=o;r>=0;r--)u(t[r],e)},_condense:function(e){for(var t,o=e.length-1;o>=0;o--)0===e[o].children.length?o>0?(t=e[o-1].children).splice(t.indexOf(e[o]),1):this.clear():p(e[o],this.toBBox)},_initFormat:function(e){var t=["return a"," - b",";"];this.compareMinX=new Function("a","b",t.join(e[0]));this.compareMinY=new Function("a","b",t.join(e[1]));this.toBBox=new Function("a","return {minX: a"+e[0]+", minY: a"+e[1]+", maxX: a"+e[2]+", maxY: a"+e[3]+"};")}};function s(e,t,o){if(!o)return t.indexOf(e);for(var r=0;r<t.length;r++)if(o(e,t[r]))return r;return-1}function p(e,t){c(e,0,e.children.length,t,e)}function c(e,t,o,r,i){i||(i=v(null));i.minX=1/0;i.minY=1/0;i.maxX=-1/0;i.maxY=-1/0;for(var n,a=t;a<o;a++){n=e.children[a];u(i,e.leaf?r(n):n)}return i}function u(e,t){e.minX=Math.min(e.minX,t.minX);e.minY=Math.min(e.minY,t.minY);e.maxX=Math.max(e.maxX,t.maxX);e.maxY=Math.max(e.maxY,t.maxY);return e}function g(e,t){return e.minX-t.minX}function d(e,t){return e.minY-t.minY}function h(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function f(e){return e.maxX-e.minX+(e.maxY-e.minY)}function y(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function m(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function v(e){return{children:e,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function C(e,o,r,i,n){for(var a,l=[o,r];l.length;)if(!((r=l.pop())-(o=l.pop())<=i)){a=o+Math.ceil((r-o)/i/2)*i;t(e,a,o,r,n);l.push(o,a,a,r)}}e.default=a}(this.rbush=this.rbush||{})}).call(ol.ext);ol.ext.rbush=ol.ext.rbush.default;goog.provide("ol.render.ReplayGroup");ol.render.ReplayGroup=function(){};ol.render.ReplayGroup.prototype.getReplay=function(e,t){};ol.render.ReplayGroup.prototype.isEmpty=function(){};goog.provide("ol.render.ReplayType");ol.render.ReplayType={CIRCLE:"Circle",DEFAULT:"Default",IMAGE:"Image",LINE_STRING:"LineString",POLYGON:"Polygon",TEXT:"Text"};goog.provide("ol.geom.flat.length");ol.geom.flat.length.lineString=function(e,t,o,r){var i,n=e[t],a=e[t+1],l=0;for(i=t+r;i<o;i+=r){var s=e[i],p=e[i+1];l+=Math.sqrt((s-n)*(s-n)+(p-a)*(p-a));n=s;a=p}return l};ol.geom.flat.length.linearRing=function(e,t,o,r){var i=ol.geom.flat.length.lineString(e,t,o,r),n=e[o-r]-e[t],a=e[o-r+1]-e[t+1];return i+=Math.sqrt(n*n+a*a)};goog.provide("ol.geom.flat.textpath");goog.require("ol.math");ol.geom.flat.textpath.lineString=function(e,t,o,r,i,n,a,l){for(var s,p,c,u=[],g=e[t]>e[o-r],d=i.length,h=e[t],f=e[t+1],y=e[t+=r],m=e[t+1],v=0,C=Math.sqrt(Math.pow(y-h,2)+Math.pow(m-f,2)),T="",S=0,_=0;_<d;++_){p=g?d-_-1:_;var E=i.charAt(p),x=n(T=g?E+T:T+E)-S;S+=x;for(var P=a+x/2;t<o-r&&v+C<P;){h=y;f=m;y=e[t+=r];m=e[t+1];v+=C;C=Math.sqrt(Math.pow(y-h,2)+Math.pow(m-f,2))}var L=P-v,w=Math.atan2(m-f,y-h);g&&(w+=w>0?-Math.PI:Math.PI);if(void 0!==c){var b=w-c;b+=b>Math.PI?-2*Math.PI:b<-Math.PI?2*Math.PI:0;if(Math.abs(b)>l)return null}var R=L/C,A=ol.math.lerp(h,y,R),M=ol.math.lerp(f,m,R);if(c==w){if(g){s[0]=A;s[1]=M;s[2]=x/2}s[4]=T}else{S=x;s=[A,M,x/2,w,T=E];g?u.unshift(s):u.push(s);c=w}a+=x}return u};goog.provide("ol.render.canvas.Instruction");ol.render.canvas.Instruction={BEGIN_GEOMETRY:0,BEGIN_PATH:1,CIRCLE:2,CLOSE_PATH:3,CUSTOM:4,DRAW_CHARS:5,DRAW_IMAGE:6,END_GEOMETRY:7,FILL:8,MOVE_TO_LINE_TO:9,SET_FILL_STYLE:10,SET_STROKE_STYLE:11,STROKE:12};goog.provide("ol.render.replay");goog.require("ol.render.ReplayType");ol.render.replay.ORDER=[ol.render.ReplayType.POLYGON,ol.render.ReplayType.CIRCLE,ol.render.ReplayType.LINE_STRING,ol.render.ReplayType.IMAGE,ol.render.ReplayType.TEXT,ol.render.ReplayType.DEFAULT];ol.render.replay.TEXT_ALIGN={};ol.render.replay.TEXT_ALIGN.left=0;ol.render.replay.TEXT_ALIGN.end=0;ol.render.replay.TEXT_ALIGN.center=.5;ol.render.replay.TEXT_ALIGN.right=1;ol.render.replay.TEXT_ALIGN.start=1;ol.render.replay.TEXT_ALIGN.top=0;ol.render.replay.TEXT_ALIGN.middle=.5;ol.render.replay.TEXT_ALIGN.hanging=.2;ol.render.replay.TEXT_ALIGN.alphabetic=.8;ol.render.replay.TEXT_ALIGN.ideographic=.8;ol.render.replay.TEXT_ALIGN.bottom=1;goog.provide("ol.render.canvas.Replay");goog.require("ol");goog.require("ol.array");goog.require("ol.colorlike");goog.require("ol.extent");goog.require("ol.extent.Relationship");goog.require("ol.geom.GeometryType");goog.require("ol.geom.flat.inflate");goog.require("ol.geom.flat.length");goog.require("ol.geom.flat.textpath");goog.require("ol.geom.flat.transform");goog.require("ol.has");goog.require("ol.obj");goog.require("ol.render.VectorContext");goog.require("ol.render.canvas");goog.require("ol.render.canvas.Instruction");goog.require("ol.render.replay");goog.require("ol.transform");ol.render.canvas.Replay=function(e,t,o,r,i,n){ol.render.VectorContext.call(this);this.declutterTree=n;this.tmpExtent_=ol.extent.createEmpty();this.tolerance=e;this.maxExtent=t;this.overlaps=i;this.pixelRatio=r;this.maxLineWidth=0;this.resolution=o;this.fillOrigin_;this.beginGeometryInstruction1_=null;this.beginGeometryInstruction2_=null;this.bufferedMaxExtent_=null;this.instructions=[];this.coordinates=[];this.coordinateCache_={};this.renderedTransform_=ol.transform.create();this.hitDetectionInstructions=[];this.pixelCoordinates_=null;this.state={};this.viewRotation_=0;this.tmpLocalTransform_=ol.transform.create();this.resetTransform_=ol.transform.create()};ol.inherits(ol.render.canvas.Replay,ol.render.VectorContext);ol.render.canvas.Replay.prototype.replayTextBackground_=function(e,t,o,r,i,n,a){e.beginPath();e.moveTo.apply(e,t);e.lineTo.apply(e,o);e.lineTo.apply(e,r);e.lineTo.apply(e,i);e.lineTo.apply(e,t);if(n){this.fillOrigin_=n[2];this.fill_(e)}if(a){this.setStrokeStyle_(e,a);e.stroke()}};ol.render.canvas.Replay.prototype.replayImage_=function(e,t,o,r,i,n,a,l,s,p,c,u,g,d,h,f,y,m){var v=y||m,C=this.tmpLocalTransform_;t-=i*=g;o-=n*=g;if(d){t=Math.round(t);o=Math.round(o)}var T,S,_,E,x=h+p>r.width?r.width-p:h,P=l+c>r.height?r.height-c:l,L=this.tmpExtent_,w=f[3]+x*g+f[1],b=f[0]+P*g+f[2],R=t-f[3],A=o-f[0];if(v||0!==u){T=[R,A];S=[R+w,A];_=[R+w,A+b];E=[R,A+b]}var M=null;if(0!==u){var I=t+i,O=o+n;M=ol.transform.compose(C,I,O,1,1,u,-I,-O);ol.extent.createOrUpdateEmpty(L);ol.extent.extendCoordinate(L,ol.transform.apply(C,T));ol.extent.extendCoordinate(L,ol.transform.apply(C,S));ol.extent.extendCoordinate(L,ol.transform.apply(C,_));ol.extent.extendCoordinate(L,ol.transform.apply(C,E))}else ol.extent.createOrUpdate(R,A,R+w,A+b,L);var N=e.canvas,D=L[0]<=N.width&&L[2]>=0&&L[1]<=N.height&&L[3]>=0;if(a){if(!D&&1==a[4])return;ol.extent.extend(a,L);var F=D?[e,M?M.slice(0):null,s,r,p,c,x,P,t,o,g]:null;F&&v&&F.push(y,m,T,S,_,E);a.push(F)}else if(D){v&&this.replayTextBackground_(e,T,S,_,E,y,m);ol.render.canvas.drawImage(e,M,s,r,p,c,x,P,t,o,g)}};ol.render.canvas.Replay.prototype.applyPixelRatio=function(e){var t=this.pixelRatio;return 1==t?e:e.map(function(e){return e*t})};ol.render.canvas.Replay.prototype.appendFlatCoordinates=function(e,t,o,r,i,n){var a=this.coordinates.length,l=this.getBufferedMaxExtent();n&&(t+=r);var s,p,c,u=[e[t],e[t+1]],g=[NaN,NaN],d=!0;for(s=t+r;s<o;s+=r){g[0]=e[s];g[1]=e[s+1];if((c=ol.extent.coordinateRelationship(l,g))!==p){if(d){this.coordinates[a++]=u[0];this.coordinates[a++]=u[1]}this.coordinates[a++]=g[0];this.coordinates[a++]=g[1];d=!1}else if(c===ol.extent.Relationship.INTERSECTING){this.coordinates[a++]=g[0];this.coordinates[a++]=g[1];d=!1}else d=!0;u[0]=g[0];u[1]=g[1];p=c}if(i&&d||s===t+r){this.coordinates[a++]=u[0];this.coordinates[a++]=u[1]}return a};ol.render.canvas.Replay.prototype.drawCustomCoordinates_=function(e,t,o,r,i){for(var n=0,a=o.length;n<a;++n){var l=o[n],s=this.appendFlatCoordinates(e,t,l,r,!1,!1);i.push(s);t=l}return t};ol.render.canvas.Replay.prototype.drawCustom=function(e,t,o){this.beginGeometry(e,t);var r,i,n,a,l,s=e.getType(),p=e.getStride(),c=this.coordinates.length;if(s==ol.geom.GeometryType.MULTI_POLYGON){r=(e=e).getOrientedFlatCoordinates();a=[];var u=e.getEndss();l=0;for(var g=0,d=u.length;g<d;++g){var h=[];l=this.drawCustomCoordinates_(r,l,u[g],p,h);a.push(h)}this.instructions.push([ol.render.canvas.Instruction.CUSTOM,c,a,e,o,ol.geom.flat.inflate.coordinatesss])}else if(s==ol.geom.GeometryType.POLYGON||s==ol.geom.GeometryType.MULTI_LINE_STRING){n=[];r=s==ol.geom.GeometryType.POLYGON?e.getOrientedFlatCoordinates():e.getFlatCoordinates();l=this.drawCustomCoordinates_(r,0,e.getEnds(),p,n);this.instructions.push([ol.render.canvas.Instruction.CUSTOM,c,n,e,o,ol.geom.flat.inflate.coordinatess])}else if(s==ol.geom.GeometryType.LINE_STRING||s==ol.geom.GeometryType.MULTI_POINT){r=e.getFlatCoordinates();i=this.appendFlatCoordinates(r,0,r.length,p,!1,!1);this.instructions.push([ol.render.canvas.Instruction.CUSTOM,c,i,e,o,ol.geom.flat.inflate.coordinates])}else if(s==ol.geom.GeometryType.POINT){r=e.getFlatCoordinates();this.coordinates.push(r[0],r[1]);i=this.coordinates.length;this.instructions.push([ol.render.canvas.Instruction.CUSTOM,c,i,e,o])}this.endGeometry(e,t)};ol.render.canvas.Replay.prototype.beginGeometry=function(e,t){this.beginGeometryInstruction1_=[ol.render.canvas.Instruction.BEGIN_GEOMETRY,t,0];this.instructions.push(this.beginGeometryInstruction1_);this.beginGeometryInstruction2_=[ol.render.canvas.Instruction.BEGIN_GEOMETRY,t,0];this.hitDetectionInstructions.push(this.beginGeometryInstruction2_)};ol.render.canvas.Replay.prototype.fill_=function(e){if(this.fillOrigin_){var t=ol.transform.apply(this.renderedTransform_,this.fillOrigin_.slice());e.translate(t[0],t[1]);e.rotate(this.viewRotation_)}e.fill();this.fillOrigin_&&e.setTransform.apply(e,ol.render.canvas.resetTransform_)};ol.render.canvas.Replay.prototype.setStrokeStyle_=function(e,t){e.strokeStyle=t[1];e.lineWidth=t[2];e.lineCap=t[3];e.lineJoin=t[4];e.miterLimit=t[5];if(ol.has.CANVAS_LINE_DASH){e.lineDashOffset=t[7];e.setLineDash(t[6])}};ol.render.canvas.Replay.prototype.renderDeclutter_=function(e,t){if(e&&e.length>5){var o=e[4];if(1==o||o==e.length-5){var r={minX:e[0],minY:e[1],maxX:e[2],maxY:e[3],value:t};if(!this.declutterTree.collides(r)){this.declutterTree.insert(r);for(var i=ol.render.canvas.drawImage,n=5,a=e.length;n<a;++n){var l=e[n];if(l){l.length>11&&this.replayTextBackground_(l[0],l[13],l[14],l[15],l[16],l[11],l[12]);i.apply(void 0,l)}}}e.length=5;ol.extent.createOrUpdateEmpty(e)}}};ol.render.canvas.Replay.prototype.replay_=function(e,t,o,r,i,n){var a;if(this.pixelCoordinates_&&ol.array.equals(t,this.renderedTransform_))a=this.pixelCoordinates_;else{this.pixelCoordinates_||(this.pixelCoordinates_=[]);a=ol.geom.flat.transform.transform2D(this.coordinates,0,this.coordinates.length,2,t,this.pixelCoordinates_);ol.transform.setFromArray(this.renderedTransform_,t)}for(var l,s,p,c,u,g,d,h,f,y=!ol.obj.isEmpty(o),m=0,v=r.length,C=0,T=0,S=0,_=null,E=null,x=this.coordinateCache_,P=this.viewRotation_,L={context:e,pixelRatio:this.pixelRatio,resolution:this.resolution,rotation:P},w=this.instructions!=r||this.overlaps?0:200;m<v;){var b,R,A,M=r[m];switch(M[0]){case ol.render.canvas.Instruction.BEGIN_GEOMETRY:b=M[1];y&&o[ol.getUid(b).toString()]||!b.getGeometry()?m=M[2]:void 0===n||ol.extent.intersects(n,b.getGeometry().getExtent())?++m:m=M[2]+1;break;case ol.render.canvas.Instruction.BEGIN_PATH:if(T>w){this.fill_(e);T=0}if(S>w){e.stroke();S=0}if(!T&&!S){e.beginPath();c=u=NaN}++m;break;case ol.render.canvas.Instruction.CIRCLE:var I=a[C=M[1]],O=a[C+1],N=a[C+2]-I,D=a[C+3]-O,F=Math.sqrt(N*N+D*D);e.moveTo(I+F,O);e.arc(I,O,F,0,2*Math.PI,!0);++m;break;case ol.render.canvas.Instruction.CLOSE_PATH:e.closePath();++m;break;case ol.render.canvas.Instruction.CUSTOM:C=M[1];l=M[2];var k=M[3],G=M[4],U=6==M.length?M[5]:void 0;L.geometry=k;L.feature=b;m in x||(x[m]=[]);var B=x[m];if(U)U(a,C,l,2,B);else{B[0]=a[C];B[1]=a[C+1];B.length=2}G(B,L);++m;break;case ol.render.canvas.Instruction.DRAW_IMAGE:C=M[1];l=M[2];f=M[3];s=M[4];p=M[5];h=i?null:M[6];var $,q,j,W=M[7],V=M[8],Y=M[9],K=M[10],X=M[11],H=M[12],z=M[13],Z=M[14],J=M[15];if(M.length>16){$=M[16];q=M[17];j=M[18]}else{$=ol.render.canvas.defaultPadding;q=j=!1}X&&(H+=P);for(;C<l;C+=2)this.replayImage_(e,a[C],a[C+1],f,s,p,h,W,V,Y,K,H,z,Z,J,$,q?_:null,j?E:null);this.renderDeclutter_(h,b);++m;break;case ol.render.canvas.Instruction.DRAW_CHARS:var Q=M[1],ee=M[2],te=M[3];h=i?null:M[4];var oe=M[5],re=M[6],ie=M[7],ne=M[8],ae=M[9],le=M[10],se=M[11],pe=M[12],ce=M[13],ue=M[14],ge=ol.geom.flat.length.lineString(a,Q,ee,2),de=ne(pe);if(oe||de<=ge){var he=this.textStates[ce].textAlign,fe=(ge-de)*ol.render.replay.TEXT_ALIGN[he],ye=ol.geom.flat.textpath.lineString(a,Q,ee,2,pe,ne,fe,ie);if(ye){var me,ve,Ce,Te,Se;if(le)for(me=0,ve=ye.length;me<ve;++me){Ce=(Se=ye[me])[4];Te=this.getImage(Ce,ce,"",le);s=Se[2]+se;p=te*Te.height+2*(.5-te)*se-ae;this.replayImage_(e,Se[0],Se[1],Te,s,p,h,Te.height,1,0,0,Se[3],ue,!1,Te.width,ol.render.canvas.defaultPadding,null,null)}if(re)for(me=0,ve=ye.length;me<ve;++me){Ce=(Se=ye[me])[4];Te=this.getImage(Ce,ce,re,"");s=Se[2];p=te*Te.height-ae;this.replayImage_(e,Se[0],Se[1],Te,s,p,h,Te.height,1,0,0,Se[3],ue,!1,Te.width,ol.render.canvas.defaultPadding,null,null)}}}this.renderDeclutter_(h,b);++m;break;case ol.render.canvas.Instruction.END_GEOMETRY:if(void 0!==i){var _e=i(b=M[1]);if(_e)return _e}++m;break;case ol.render.canvas.Instruction.FILL:w?T++:this.fill_(e);++m;break;case ol.render.canvas.Instruction.MOVE_TO_LINE_TO:C=M[1];l=M[2];R=a[C];d=(A=a[C+1])+.5|0;if((g=R+.5|0)!==c||d!==u){e.moveTo(R,A);c=g;u=d}for(C+=2;C<l;C+=2){R=a[C];A=a[C+1];g=R+.5|0;d=A+.5|0;if(C==l-2||g!==c||d!==u){e.lineTo(R,A);c=g;u=d}}++m;break;case ol.render.canvas.Instruction.SET_FILL_STYLE:_=M;this.fillOrigin_=M[2];if(T){this.fill_(e);T=0;if(S){e.stroke();S=0}}e.fillStyle=M[1];++m;break;case ol.render.canvas.Instruction.SET_STROKE_STYLE:E=M;if(S){e.stroke();S=0}this.setStrokeStyle_(e,M);++m;break;case ol.render.canvas.Instruction.STROKE:w?S++:e.stroke();++m;break;default:++m}}T&&this.fill_(e);S&&e.stroke()};ol.render.canvas.Replay.prototype.replay=function(e,t,o,r){this.viewRotation_=o;this.replay_(e,t,r,this.instructions,void 0,void 0)};ol.render.canvas.Replay.prototype.replayHitDetection=function(e,t,o,r,i,n){this.viewRotation_=o;return this.replay_(e,t,r,this.hitDetectionInstructions,i,n)};ol.render.canvas.Replay.prototype.reverseHitDetectionInstructions=function(){var e,t=this.hitDetectionInstructions;t.reverse();var o,r,i=t.length,n=-1;for(e=0;e<i;++e)if((r=(o=t[e])[0])==ol.render.canvas.Instruction.END_GEOMETRY)n=e;else if(r==ol.render.canvas.Instruction.BEGIN_GEOMETRY){o[2]=e;ol.array.reverseSubArray(this.hitDetectionInstructions,n,e);n=-1}};ol.render.canvas.Replay.prototype.setFillStrokeStyle=function(e,t){var o=this.state;if(e){var r=e.getColor();o.fillStyle=ol.colorlike.asColorLike(r||ol.render.canvas.defaultFillStyle)}else o.fillStyle=void 0;if(t){var i=t.getColor();o.strokeStyle=ol.colorlike.asColorLike(i||ol.render.canvas.defaultStrokeStyle);var n=t.getLineCap();o.lineCap=void 0!==n?n:ol.render.canvas.defaultLineCap;var a=t.getLineDash();o.lineDash=a?a.slice():ol.render.canvas.defaultLineDash;var l=t.getLineDashOffset();o.lineDashOffset=l||ol.render.canvas.defaultLineDashOffset;var s=t.getLineJoin();o.lineJoin=void 0!==s?s:ol.render.canvas.defaultLineJoin;var p=t.getWidth();o.lineWidth=void 0!==p?p:ol.render.canvas.defaultLineWidth;var c=t.getMiterLimit();o.miterLimit=void 0!==c?c:ol.render.canvas.defaultMiterLimit;if(o.lineWidth>this.maxLineWidth){this.maxLineWidth=o.lineWidth;this.bufferedMaxExtent_=null}}else{o.strokeStyle=void 0;o.lineCap=void 0;o.lineDash=null;o.lineDashOffset=void 0;o.lineJoin=void 0;o.lineWidth=void 0;o.miterLimit=void 0}};ol.render.canvas.Replay.prototype.applyFill=function(e,t){var o=e.fillStyle,r=[ol.render.canvas.Instruction.SET_FILL_STYLE,o];if("string"!=typeof o){var i=t.getExtent();r.push([i[0],i[3]])}this.instructions.push(r)};ol.render.canvas.Replay.prototype.applyStroke=function(e){this.instructions.push([ol.render.canvas.Instruction.SET_STROKE_STYLE,e.strokeStyle,e.lineWidth*this.pixelRatio,e.lineCap,e.lineJoin,e.miterLimit,this.applyPixelRatio(e.lineDash),e.lineDashOffset*this.pixelRatio])};ol.render.canvas.Replay.prototype.updateFillStyle=function(e,t,o){var r=e.fillStyle;if("string"!=typeof r||e.currentFillStyle!=r){t.call(this,e,o);e.currentFillStyle=r}};ol.render.canvas.Replay.prototype.updateStrokeStyle=function(e,t){var o=e.strokeStyle,r=e.lineCap,i=e.lineDash,n=e.lineDashOffset,a=e.lineJoin,l=e.lineWidth,s=e.miterLimit;if(e.currentStrokeStyle!=o||e.currentLineCap!=r||i!=e.currentLineDash&&!ol.array.equals(e.currentLineDash,i)||e.currentLineDashOffset!=n||e.currentLineJoin!=a||e.currentLineWidth!=l||e.currentMiterLimit!=s){t.call(this,e);e.currentStrokeStyle=o;e.currentLineCap=r;e.currentLineDash=i;e.currentLineDashOffset=n;e.currentLineJoin=a;e.currentLineWidth=l;e.currentMiterLimit=s}};ol.render.canvas.Replay.prototype.endGeometry=function(e,t){this.beginGeometryInstruction1_[2]=this.instructions.length;this.beginGeometryInstruction1_=null;this.beginGeometryInstruction2_[2]=this.hitDetectionInstructions.length;this.beginGeometryInstruction2_=null;var o=[ol.render.canvas.Instruction.END_GEOMETRY,t];this.instructions.push(o);this.hitDetectionInstructions.push(o)};ol.render.canvas.Replay.prototype.finish=ol.nullFunction;ol.render.canvas.Replay.prototype.getBufferedMaxExtent=function(){if(!this.bufferedMaxExtent_){this.bufferedMaxExtent_=ol.extent.clone(this.maxExtent);if(this.maxLineWidth>0){var e=this.resolution*(this.maxLineWidth+1)/2;ol.extent.buffer(this.bufferedMaxExtent_,e,this.bufferedMaxExtent_)}}return this.bufferedMaxExtent_};goog.provide("ol.render.canvas.ImageReplay");goog.require("ol");goog.require("ol.render.canvas.Instruction");goog.require("ol.render.canvas.Replay");ol.render.canvas.ImageReplay=function(e,t,o,r,i,n){ol.render.canvas.Replay.call(this,e,t,o,r,i,n);this.declutterGroup_=null;this.hitDetectionImage_=null;this.image_=null;this.anchorX_=void 0;this.anchorY_=void 0;this.height_=void 0;this.opacity_=void 0;this.originX_=void 0;this.originY_=void 0;this.rotateWithView_=void 0;this.rotation_=void 0;this.scale_=void 0;this.snapToPixel_=void 0;this.width_=void 0};ol.inherits(ol.render.canvas.ImageReplay,ol.render.canvas.Replay);ol.render.canvas.ImageReplay.prototype.drawCoordinates_=function(e,t,o,r){return this.appendFlatCoordinates(e,t,o,r,!1,!1)};ol.render.canvas.ImageReplay.prototype.drawPoint=function(e,t){if(this.image_){this.beginGeometry(e,t);var o=e.getFlatCoordinates(),r=e.getStride(),i=this.coordinates.length,n=this.drawCoordinates_(o,0,o.length,r);this.instructions.push([ol.render.canvas.Instruction.DRAW_IMAGE,i,n,this.image_,this.anchorX_,this.anchorY_,this.declutterGroup_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_*this.pixelRatio,this.snapToPixel_,this.width_]);this.hitDetectionInstructions.push([ol.render.canvas.Instruction.DRAW_IMAGE,i,n,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.declutterGroup_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.snapToPixel_,this.width_]);this.endGeometry(e,t)}};ol.render.canvas.ImageReplay.prototype.drawMultiPoint=function(e,t){if(this.image_){this.beginGeometry(e,t);var o=e.getFlatCoordinates(),r=e.getStride(),i=this.coordinates.length,n=this.drawCoordinates_(o,0,o.length,r);this.instructions.push([ol.render.canvas.Instruction.DRAW_IMAGE,i,n,this.image_,this.anchorX_,this.anchorY_,this.declutterGroup_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_*this.pixelRatio,this.snapToPixel_,this.width_]);this.hitDetectionInstructions.push([ol.render.canvas.Instruction.DRAW_IMAGE,i,n,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.declutterGroup_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.snapToPixel_,this.width_]);this.endGeometry(e,t)}};ol.render.canvas.ImageReplay.prototype.finish=function(){this.reverseHitDetectionInstructions();this.anchorX_=void 0;this.anchorY_=void 0;this.hitDetectionImage_=null;this.image_=null;this.height_=void 0;this.scale_=void 0;this.opacity_=void 0;this.originX_=void 0;this.originY_=void 0;this.rotateWithView_=void 0;this.rotation_=void 0;this.snapToPixel_=void 0;this.width_=void 0};ol.render.canvas.ImageReplay.prototype.setImageStyle=function(e,t){var o=e.getAnchor(),r=e.getSize(),i=e.getHitDetectionImage(1),n=e.getImage(1),a=e.getOrigin();this.anchorX_=o[0];this.anchorY_=o[1];this.declutterGroup_=t;this.hitDetectionImage_=i;this.image_=n;this.height_=r[1];this.opacity_=e.getOpacity();this.originX_=a[0];this.originY_=a[1];this.rotateWithView_=e.getRotateWithView();this.rotation_=e.getRotation();this.scale_=e.getScale();this.snapToPixel_=e.getSnapToPixel();this.width_=r[0]};goog.provide("ol.render.canvas.LineStringReplay");goog.require("ol");goog.require("ol.render.canvas.Instruction");goog.require("ol.render.canvas.Replay");ol.render.canvas.LineStringReplay=function(e,t,o,r,i,n){ol.render.canvas.Replay.call(this,e,t,o,r,i,n)};ol.inherits(ol.render.canvas.LineStringReplay,ol.render.canvas.Replay);ol.render.canvas.LineStringReplay.prototype.drawFlatCoordinates_=function(e,t,o,r){var i=this.coordinates.length,n=this.appendFlatCoordinates(e,t,o,r,!1,!1),a=[ol.render.canvas.Instruction.MOVE_TO_LINE_TO,i,n];this.instructions.push(a);this.hitDetectionInstructions.push(a);return o};ol.render.canvas.LineStringReplay.prototype.drawLineString=function(e,t){var o=this.state,r=o.strokeStyle,i=o.lineWidth;if(void 0!==r&&void 0!==i){this.updateStrokeStyle(o,this.applyStroke);this.beginGeometry(e,t);this.hitDetectionInstructions.push([ol.render.canvas.Instruction.SET_STROKE_STYLE,o.strokeStyle,o.lineWidth,o.lineCap,o.lineJoin,o.miterLimit,o.lineDash,o.lineDashOffset],[ol.render.canvas.Instruction.BEGIN_PATH]);var n=e.getFlatCoordinates(),a=e.getStride();this.drawFlatCoordinates_(n,0,n.length,a);this.hitDetectionInstructions.push([ol.render.canvas.Instruction.STROKE]);this.endGeometry(e,t)}};ol.render.canvas.LineStringReplay.prototype.drawMultiLineString=function(e,t){var o=this.state,r=o.strokeStyle,i=o.lineWidth;if(void 0!==r&&void 0!==i){this.updateStrokeStyle(o,this.applyStroke);this.beginGeometry(e,t);this.hitDetectionInstructions.push([ol.render.canvas.Instruction.SET_STROKE_STYLE,o.strokeStyle,o.lineWidth,o.lineCap,o.lineJoin,o.miterLimit,o.lineDash,o.lineDashOffset],[ol.render.canvas.Instruction.BEGIN_PATH]);var n,a,l=e.getEnds(),s=e.getFlatCoordinates(),p=e.getStride(),c=0;for(n=0,a=l.length;n<a;++n)c=this.drawFlatCoordinates_(s,c,l[n],p);this.hitDetectionInstructions.push([ol.render.canvas.Instruction.STROKE]);this.endGeometry(e,t)}};ol.render.canvas.LineStringReplay.prototype.finish=function(){var e=this.state;void 0!=e.lastStroke&&e.lastStroke!=this.coordinates.length&&this.instructions.push([ol.render.canvas.Instruction.STROKE]);this.reverseHitDetectionInstructions();this.state=null};ol.render.canvas.LineStringReplay.prototype.applyStroke=function(e){if(void 0!=e.lastStroke&&e.lastStroke!=this.coordinates.length){this.instructions.push([ol.render.canvas.Instruction.STROKE]);e.lastStroke=this.coordinates.length}e.lastStroke=0;ol.render.canvas.Replay.prototype.applyStroke.call(this,e);this.instructions.push([ol.render.canvas.Instruction.BEGIN_PATH])};goog.provide("ol.render.canvas.PolygonReplay");goog.require("ol");goog.require("ol.color");goog.require("ol.geom.flat.simplify");goog.require("ol.render.canvas");goog.require("ol.render.canvas.Instruction");goog.require("ol.render.canvas.Replay");ol.render.canvas.PolygonReplay=function(e,t,o,r,i,n){ol.render.canvas.Replay.call(this,e,t,o,r,i,n)};ol.inherits(ol.render.canvas.PolygonReplay,ol.render.canvas.Replay);ol.render.canvas.PolygonReplay.prototype.drawFlatCoordinatess_=function(e,t,o,r){var i=this.state,n=void 0!==i.fillStyle,a=void 0!=i.strokeStyle,l=o.length,s=[ol.render.canvas.Instruction.BEGIN_PATH];this.instructions.push(s);this.hitDetectionInstructions.push(s);for(var p=0;p<l;++p){var c=o[p],u=this.coordinates.length,g=this.appendFlatCoordinates(e,t,c,r,!0,!a),d=[ol.render.canvas.Instruction.MOVE_TO_LINE_TO,u,g];this.instructions.push(d);this.hitDetectionInstructions.push(d);if(a){var h=[ol.render.canvas.Instruction.CLOSE_PATH];this.instructions.push(h);this.hitDetectionInstructions.push(h)}t=c}var f=[ol.render.canvas.Instruction.FILL];this.hitDetectionInstructions.push(f);n&&this.instructions.push(f);if(a){var y=[ol.render.canvas.Instruction.STROKE];this.instructions.push(y);this.hitDetectionInstructions.push(y)}return t};ol.render.canvas.PolygonReplay.prototype.drawCircle=function(e,t){var o=this.state,r=o.fillStyle,i=o.strokeStyle;if(void 0!==r||void 0!==i){this.setFillStrokeStyles_(e);this.beginGeometry(e,t);this.hitDetectionInstructions.push([ol.render.canvas.Instruction.SET_FILL_STYLE,ol.color.asString(ol.render.canvas.defaultFillStyle)]);void 0!==o.strokeStyle&&this.hitDetectionInstructions.push([ol.render.canvas.Instruction.SET_STROKE_STYLE,o.strokeStyle,o.lineWidth,o.lineCap,o.lineJoin,o.miterLimit,o.lineDash,o.lineDashOffset]);var n=e.getFlatCoordinates(),a=e.getStride(),l=this.coordinates.length;this.appendFlatCoordinates(n,0,n.length,a,!1,!1);var s=[ol.render.canvas.Instruction.BEGIN_PATH],p=[ol.render.canvas.Instruction.CIRCLE,l];this.instructions.push(s,p);this.hitDetectionInstructions.push(s,p);var c=[ol.render.canvas.Instruction.FILL];this.hitDetectionInstructions.push(c);void 0!==o.fillStyle&&this.instructions.push(c);if(void 0!==o.strokeStyle){var u=[ol.render.canvas.Instruction.STROKE];this.instructions.push(u);this.hitDetectionInstructions.push(u)}this.endGeometry(e,t)}};ol.render.canvas.PolygonReplay.prototype.drawPolygon=function(e,t){var o=this.state;this.setFillStrokeStyles_(e);this.beginGeometry(e,t);this.hitDetectionInstructions.push([ol.render.canvas.Instruction.SET_FILL_STYLE,ol.color.asString(ol.render.canvas.defaultFillStyle)]);void 0!==o.strokeStyle&&this.hitDetectionInstructions.push([ol.render.canvas.Instruction.SET_STROKE_STYLE,o.strokeStyle,o.lineWidth,o.lineCap,o.lineJoin,o.miterLimit,o.lineDash,o.lineDashOffset]);var r=e.getEnds(),i=e.getOrientedFlatCoordinates(),n=e.getStride();this.drawFlatCoordinatess_(i,0,r,n);this.endGeometry(e,t)};ol.render.canvas.PolygonReplay.prototype.drawMultiPolygon=function(e,t){var o=this.state,r=o.fillStyle,i=o.strokeStyle;if(void 0!==r||void 0!==i){this.setFillStrokeStyles_(e);this.beginGeometry(e,t);this.hitDetectionInstructions.push([ol.render.canvas.Instruction.SET_FILL_STYLE,ol.color.asString(ol.render.canvas.defaultFillStyle)]);void 0!==o.strokeStyle&&this.hitDetectionInstructions.push([ol.render.canvas.Instruction.SET_STROKE_STYLE,o.strokeStyle,o.lineWidth,o.lineCap,o.lineJoin,o.miterLimit,o.lineDash,o.lineDashOffset]);var n,a,l=e.getEndss(),s=e.getOrientedFlatCoordinates(),p=e.getStride(),c=0;for(n=0,a=l.length;n<a;++n)c=this.drawFlatCoordinatess_(s,c,l[n],p);this.endGeometry(e,t)}};ol.render.canvas.PolygonReplay.prototype.finish=function(){this.reverseHitDetectionInstructions();this.state=null;var e=this.tolerance;if(0!==e){var t,o,r=this.coordinates;for(t=0,o=r.length;t<o;++t)r[t]=ol.geom.flat.simplify.snap(r[t],e)}};ol.render.canvas.PolygonReplay.prototype.setFillStrokeStyles_=function(e){var t=this.state;void 0!==t.fillStyle&&this.updateFillStyle(t,this.applyFill,e);void 0!==t.strokeStyle&&this.updateStrokeStyle(t,this.applyStroke)};goog.provide("ol.geom.flat.straightchunk");ol.geom.flat.straightchunk.lineString=function(e,t,o,r,i){var n,a,l,s,p,c,u,g,d,h=o,f=o,y=0,m=0,v=o;for(n=o;n<r;n+=i){var C=t[n],T=t[n+1];if(void 0!==s){g=C-s;d=T-p;l=Math.sqrt(g*g+d*d);if(void 0!==c){m+=a;if(Math.acos((c*g+u*d)/(a*l))>e){if(m>y){y=m;h=v;f=n}m=0;v=n-i}}a=l;c=g;u=d}s=C;p=T}return(m+=l)>y?[v,n]:[h,f]};goog.provide("ol.style.TextPlacement");ol.style.TextPlacement={POINT:"point",LINE:"line"};goog.provide("ol.render.canvas.TextReplay");goog.require("ol");goog.require("ol.colorlike");goog.require("ol.dom");goog.require("ol.extent");goog.require("ol.geom.flat.straightchunk");goog.require("ol.geom.GeometryType");goog.require("ol.has");goog.require("ol.render.canvas");goog.require("ol.render.canvas.Instruction");goog.require("ol.render.canvas.Replay");goog.require("ol.render.replay");goog.require("ol.style.TextPlacement");ol.render.canvas.TextReplay=function(e,t,o,r,i,n){ol.render.canvas.Replay.call(this,e,t,o,r,i,n);this.declutterGroup_;this.labels_=null;this.text_="";this.textOffsetX_=0;this.textOffsetY_=0;this.textRotateWithView_=void 0;this.textRotation_=0;this.textFillState_=null;this.fillStates={};this.textStrokeState_=null;this.strokeStates={};this.textState_={};this.textStates={};this.textKey_="";this.fillKey_="";this.strokeKey_="";this.widths_={};ol.render.canvas.labelCache.prune()};ol.inherits(ol.render.canvas.TextReplay,ol.render.canvas.Replay);ol.render.canvas.TextReplay.measureTextWidths=function(e,t,o){var r,i,n=t.length,a=0;for(i=0;i<n;++i){r=ol.render.canvas.measureTextWidth(e,t[i]);a=Math.max(a,r);o.push(r)}return a};ol.render.canvas.TextReplay.prototype.drawText=function(e,t){var o=this.textFillState_,r=this.textStrokeState_,i=this.textState_;if(""!==this.text_&&i&&(o||r)){var n,a,l=this.coordinates.length,s=e.getType(),p=null,c=2,u=2;if(i.placement===ol.style.TextPlacement.LINE){if(!ol.extent.intersects(this.getBufferedMaxExtent(),e.getExtent()))return;var g;p=e.getFlatCoordinates();u=e.getStride();if(s==ol.geom.GeometryType.LINE_STRING)g=[p.length];else if(s==ol.geom.GeometryType.MULTI_LINE_STRING)g=e.getEnds();else if(s==ol.geom.GeometryType.POLYGON)g=e.getEnds().slice(0,1);else if(s==ol.geom.GeometryType.MULTI_POLYGON){var d=e.getEndss();g=[];for(n=0,a=d.length;n<a;++n)g.push(d[n][0])}this.beginGeometry(e,t);for(var h,f=i.textAlign,y=0,m=0,v=g.length;m<v;++m){if(void 0==f){var C=ol.geom.flat.straightchunk.lineString(i.maxAngle,p,y,g[m],u);y=C[0];h=C[1]}else h=g[m];for(n=y;n<h;n+=u)this.coordinates.push(p[n],p[n+1]);c=this.coordinates.length;y=g[m];this.drawChars_(l,c,this.declutterGroup_);l=c}this.endGeometry(e,t)}else{var T=this.getImage(this.text_,this.textKey_,this.fillKey_,this.strokeKey_),S=T.width/this.pixelRatio;switch(s){case ol.geom.GeometryType.POINT:case ol.geom.GeometryType.MULTI_POINT:c=(p=e.getFlatCoordinates()).length;break;case ol.geom.GeometryType.LINE_STRING:p=e.getFlatMidpoint();break;case ol.geom.GeometryType.CIRCLE:p=e.getCenter();break;case ol.geom.GeometryType.MULTI_LINE_STRING:c=(p=e.getFlatMidpoints()).length;break;case ol.geom.GeometryType.POLYGON:p=e.getFlatInteriorPoint();if(!i.overflow&&p[2]/this.resolution<S)return;u=3;break;case ol.geom.GeometryType.MULTI_POLYGON:var _=e.getFlatInteriorPoints();p=[];for(n=0,a=_.length;n<a;n+=3)(i.overflow||_[n+2]/this.resolution>=S)&&p.push(_[n],_[n+1]);if(0==(c=p.length))return}c=this.appendFlatCoordinates(p,0,c,u,!1,!1);this.beginGeometry(e,t);if(i.backgroundFill||i.backgroundStroke){this.setFillStrokeStyle(i.backgroundFill,i.backgroundStroke);this.updateFillStyle(this.state,this.applyFill,e);this.updateStrokeStyle(this.state,this.applyStroke)}this.drawTextImage_(T,l,c);this.endGeometry(e,t)}}};ol.render.canvas.TextReplay.prototype.getImage=function(e,t,o,r){var i,n=r+t+e+o+this.pixelRatio,a=ol.render.canvas.labelCache;if(!a.containsKey(n)){var l=r?this.strokeStates[r]||this.textStrokeState_:null,s=o?this.fillStates[o]||this.textFillState_:null,p=this.textStates[t]||this.textState_,c=this.pixelRatio,u=p.scale*c,g=ol.render.replay.TEXT_ALIGN[p.textAlign||ol.render.canvas.defaultTextAlign],d=r&&l.lineWidth?l.lineWidth:0,h=e.split("\n"),f=h.length,y=[],m=ol.render.canvas.TextReplay.measureTextWidths(p.font,h,y),v=ol.render.canvas.measureTextHeight(p.font),C=v*f,T=m+d,S=ol.dom.createCanvasContext2D(Math.ceil(T*u),Math.ceil((C+d)*u));i=S.canvas;a.set(n,i);1!=u&&S.scale(u,u);S.font=p.font;if(r){S.strokeStyle=l.strokeStyle;S.lineWidth=d*(ol.has.SAFARI?u:1);S.lineCap=l.lineCap;S.lineJoin=l.lineJoin;S.miterLimit=l.miterLimit;if(ol.has.CANVAS_LINE_DASH&&l.lineDash.length){S.setLineDash(l.lineDash);S.lineDashOffset=l.lineDashOffset}}o&&(S.fillStyle=s.fillStyle);S.textBaseline="middle";S.textAlign="center";var _,E=.5-g,x=g*i.width/u+E*d;if(r)for(_=0;_<f;++_)S.strokeText(h[_],x+E*y[_],.5*(d+v)+_*v);if(o)for(_=0;_<f;++_)S.fillText(h[_],x+E*y[_],.5*(d+v)+_*v)}return a.get(n)};ol.render.canvas.TextReplay.prototype.drawTextImage_=function(e,t,o){var r=this.textState_,i=this.textStrokeState_,n=this.pixelRatio,a=ol.render.replay.TEXT_ALIGN[r.textAlign||ol.render.canvas.defaultTextAlign],l=ol.render.replay.TEXT_ALIGN[r.textBaseline],s=i&&i.lineWidth?i.lineWidth:0,p=a*e.width/n+2*(.5-a)*s,c=l*e.height/n+2*(.5-l)*s;this.instructions.push([ol.render.canvas.Instruction.DRAW_IMAGE,t,o,e,(p-this.textOffsetX_)*n,(c-this.textOffsetY_)*n,this.declutterGroup_,e.height,1,0,0,this.textRotateWithView_,this.textRotation_,1,!0,e.width,r.padding==ol.render.canvas.defaultPadding?ol.render.canvas.defaultPadding:r.padding.map(function(e){return e*n}),!!r.backgroundFill,!!r.backgroundStroke]);this.hitDetectionInstructions.push([ol.render.canvas.Instruction.DRAW_IMAGE,t,o,e,(p-this.textOffsetX_)*n,(c-this.textOffsetY_)*n,this.declutterGroup_,e.height,1,0,0,this.textRotateWithView_,this.textRotation_,1/n,!0,e.width,r.padding,!!r.backgroundFill,!!r.backgroundStroke])};ol.render.canvas.TextReplay.prototype.drawChars_=function(e,t,o){var r=this.textStrokeState_,i=this.textState_,n=this.textFillState_,a=this.strokeKey_;r&&(a in this.strokeStates||(this.strokeStates[a]={strokeStyle:r.strokeStyle,lineCap:r.lineCap,lineDashOffset:r.lineDashOffset,lineWidth:r.lineWidth,lineJoin:r.lineJoin,miterLimit:r.miterLimit,lineDash:r.lineDash}));var l=this.textKey_;this.textKey_ in this.textStates||(this.textStates[this.textKey_]={font:i.font,textAlign:i.textAlign||ol.render.canvas.defaultTextAlign,scale:i.scale});var s=this.fillKey_;n&&(s in this.fillStates||(this.fillStates[s]={fillStyle:n.fillStyle}));var p=this.pixelRatio,c=ol.render.replay.TEXT_ALIGN[i.textBaseline],u=this.textOffsetY_*p,g=this.text_,d=i.font,h=i.scale,f=r?r.lineWidth*h/2:0,y=this.widths_[d];y||(this.widths_[d]=y={});this.instructions.push([ol.render.canvas.Instruction.DRAW_CHARS,e,t,c,o,i.overflow,s,i.maxAngle,function(e){var t=y[e];t||(t=y[e]=ol.render.canvas.measureTextWidth(d,e));return t*h*p},u,a,f*p,g,l,1]);this.hitDetectionInstructions.push([ol.render.canvas.Instruction.DRAW_CHARS,e,t,c,o,i.overflow,s,i.maxAngle,function(e){var t=y[e];t||(t=y[e]=ol.render.canvas.measureTextWidth(d,e));return t*h},u,a,f,g,l,1/p])};ol.render.canvas.TextReplay.prototype.setTextStyle=function(e,t){var o,r,i;if(e){this.declutterGroup_=t;var n=e.getFill();if(n){(r=this.textFillState_)||(r=this.textFillState_={});r.fillStyle=ol.colorlike.asColorLike(n.getColor()||ol.render.canvas.defaultFillStyle)}else r=this.textFillState_=null;var a=e.getStroke();if(a){(i=this.textStrokeState_)||(i=this.textStrokeState_={});var l=a.getLineDash(),s=a.getLineDashOffset(),p=a.getWidth(),c=a.getMiterLimit();i.lineCap=a.getLineCap()||ol.render.canvas.defaultLineCap;i.lineDash=l?l.slice():ol.render.canvas.defaultLineDash;i.lineDashOffset=void 0===s?ol.render.canvas.defaultLineDashOffset:s;i.lineJoin=a.getLineJoin()||ol.render.canvas.defaultLineJoin;i.lineWidth=void 0===p?ol.render.canvas.defaultLineWidth:p;i.miterLimit=void 0===c?ol.render.canvas.defaultMiterLimit:c;i.strokeStyle=ol.colorlike.asColorLike(a.getColor()||ol.render.canvas.defaultStrokeStyle)}else i=this.textStrokeState_=null;o=this.textState_;var u=e.getFont()||ol.render.canvas.defaultFont;ol.render.canvas.checkFont(u);var g=e.getScale();o.overflow=e.getOverflow();o.font=u;o.maxAngle=e.getMaxAngle();o.placement=e.getPlacement();o.textAlign=e.getTextAlign();o.textBaseline=e.getTextBaseline()||ol.render.canvas.defaultTextBaseline;o.backgroundFill=e.getBackgroundFill();o.backgroundStroke=e.getBackgroundStroke();o.padding=e.getPadding()||ol.render.canvas.defaultPadding;o.scale=void 0===g?1:g;var d=e.getOffsetX(),h=e.getOffsetY(),f=e.getRotateWithView(),y=e.getRotation();this.text_=e.getText()||"";this.textOffsetX_=void 0===d?0:d;this.textOffsetY_=void 0===h?0:h;this.textRotateWithView_=void 0!==f&&f;this.textRotation_=void 0===y?0:y;this.strokeKey_=i?("string"==typeof i.strokeStyle?i.strokeStyle:ol.getUid(i.strokeStyle))+i.lineCap+i.lineDashOffset+"|"+i.lineWidth+i.lineJoin+i.miterLimit+"["+i.lineDash.join()+"]":"";this.textKey_=o.font+o.scale+(o.textAlign||"?");this.fillKey_=r?"string"==typeof r.fillStyle?r.fillStyle:"|"+ol.getUid(r.fillStyle):""}else this.text_=""};goog.provide("ol.render.canvas.ReplayGroup");goog.require("ol");goog.require("ol.array");goog.require("ol.dom");goog.require("ol.extent");goog.require("ol.geom.flat.transform");goog.require("ol.obj");goog.require("ol.render.ReplayGroup");goog.require("ol.render.ReplayType");goog.require("ol.render.canvas.Replay");goog.require("ol.render.canvas.ImageReplay");goog.require("ol.render.canvas.LineStringReplay");goog.require("ol.render.canvas.PolygonReplay");goog.require("ol.render.canvas.TextReplay");goog.require("ol.render.replay");goog.require("ol.transform");ol.render.canvas.ReplayGroup=function(e,t,o,r,i,n,a){ol.render.ReplayGroup.call(this);this.declutterTree_=n;this.declutterGroup_=null;this.tolerance_=e;this.maxExtent_=t;this.overlaps_=i;this.pixelRatio_=r;this.resolution_=o;this.renderBuffer_=a;this.replaysByZIndex_={};this.hitDetectionContext_=ol.dom.createCanvasContext2D(1,1);this.hitDetectionTransform_=ol.transform.create()};ol.inherits(ol.render.canvas.ReplayGroup,ol.render.ReplayGroup);ol.render.canvas.ReplayGroup.circleArrayCache_={0:[[!0]]};ol.render.canvas.ReplayGroup.fillCircleArrayRowToMiddle_=function(e,t,o){var r,i=Math.floor(e.length/2);if(t>=i)for(r=i;r<t;r++)e[r][o]=!0;else if(t<i)for(r=t+1;r<i;r++)e[r][o]=!0};ol.render.canvas.ReplayGroup.getCircleArray_=function(e){if(void 0!==ol.render.canvas.ReplayGroup.circleArrayCache_[e])return ol.render.canvas.ReplayGroup.circleArrayCache_[e];for(var t=2*e+1,o=new Array(t),r=0;r<t;r++)o[r]=new Array(t);for(var i=e,n=0,a=0;i>=n;){ol.render.canvas.ReplayGroup.fillCircleArrayRowToMiddle_(o,e+i,e+n);ol.render.canvas.ReplayGroup.fillCircleArrayRowToMiddle_(o,e+n,e+i);ol.render.canvas.ReplayGroup.fillCircleArrayRowToMiddle_(o,e-n,e+i);ol.render.canvas.ReplayGroup.fillCircleArrayRowToMiddle_(o,e-i,e+n);ol.render.canvas.ReplayGroup.fillCircleArrayRowToMiddle_(o,e-i,e-n);ol.render.canvas.ReplayGroup.fillCircleArrayRowToMiddle_(o,e-n,e-i);ol.render.canvas.ReplayGroup.fillCircleArrayRowToMiddle_(o,e+n,e-i);ol.render.canvas.ReplayGroup.fillCircleArrayRowToMiddle_(o,e+i,e-n);2*((a+=1+2*++n)-i)+1>0&&(a+=1-2*(i-=1))}ol.render.canvas.ReplayGroup.circleArrayCache_[e]=o;return o};ol.render.canvas.ReplayGroup.replayDeclutter=function(e,t,o){for(var r=Object.keys(e).map(Number).sort(ol.array.numberSafeCompareFunction),i={},n=0,a=r.length;n<a;++n)for(var l=e[r[n].toString()],s=0,p=l.length;s<p;){var c=l[s++],u=l[s++];c.replay(t,u,o,i)}};ol.render.canvas.ReplayGroup.prototype.addDeclutter=function(e){var t=null;this.declutterTree_&&(e?(t=this.declutterGroup_)[4]++:(t=this.declutterGroup_=ol.extent.createEmpty()).push(1));return t};ol.render.canvas.ReplayGroup.prototype.clip=function(e,t){var o=this.getClipCoords(t);e.beginPath();e.moveTo(o[0],o[1]);e.lineTo(o[2],o[3]);e.lineTo(o[4],o[5]);e.lineTo(o[6],o[7]);e.clip()};ol.render.canvas.ReplayGroup.prototype.hasReplays=function(e){for(var t in this.replaysByZIndex_)for(var o=this.replaysByZIndex_[t],r=0,i=e.length;r<i;++r)if(e[r]in o)return!0;return!1};ol.render.canvas.ReplayGroup.prototype.finish=function(){var e;for(e in this.replaysByZIndex_){var t,o=this.replaysByZIndex_[e];for(t in o)o[t].finish()}};ol.render.canvas.ReplayGroup.prototype.forEachFeatureAtCoordinate=function(e,t,o,r,i,n,a){var l,s=2*(r=Math.round(r))+1,p=ol.transform.compose(this.hitDetectionTransform_,r+.5,r+.5,1/t,-1/t,-o,-e[0],-e[1]),c=this.hitDetectionContext_;if(c.canvas.width!==s||c.canvas.height!==s){c.canvas.width=s;c.canvas.height=s}else c.clearRect(0,0,s,s);if(void 0!==this.renderBuffer_){l=ol.extent.createEmpty();ol.extent.extendCoordinate(l,e);ol.extent.buffer(l,t*(this.renderBuffer_+r),l)}var u,g,d=ol.render.canvas.ReplayGroup.getCircleArray_(r);this.declutterTree_&&(u=this.declutterTree_.all().map(function(e){return e.value}));function h(e){for(var t=c.getImageData(0,0,s,s).data,o=0;o<s;o++)for(var r=0;r<s;r++)if(d[o][r]&&t[4*(r*s+o)+3]>0){var i;(!u||g!=ol.render.ReplayType.IMAGE&&g!=ol.render.ReplayType.TEXT||-1!==u.indexOf(e))&&(i=n(e));if(i)return i;c.clearRect(0,0,s,s);return}}var f,y,m,v,C,T=Object.keys(this.replaysByZIndex_).map(Number);T.sort(ol.array.numberSafeCompareFunction);for(f=T.length-1;f>=0;--f){var S=T[f].toString();m=this.replaysByZIndex_[S];for(y=ol.render.replay.ORDER.length-1;y>=0;--y)if(void 0!==(v=m[g=ol.render.replay.ORDER[y]]))if(!a||g!=ol.render.ReplayType.IMAGE&&g!=ol.render.ReplayType.TEXT){if(C=v.replayHitDetection(c,p,o,i,h,l))return C}else{var _=a[S];_?_.push(v,p.slice(0)):a[S]=[v,p.slice(0)]}}};ol.render.canvas.ReplayGroup.prototype.getClipCoords=function(e){var t=this.maxExtent_,o=t[0],r=t[1],i=t[2],n=t[3],a=[o,r,o,n,i,n,i,r];ol.geom.flat.transform.transform2D(a,0,8,2,e,a);return a};ol.render.canvas.ReplayGroup.prototype.getReplay=function(e,t){var o=void 0!==e?e.toString():"0",r=this.replaysByZIndex_[o];if(void 0===r){r={};this.replaysByZIndex_[o]=r}var i=r[t];if(void 0===i){i=new(0,ol.render.canvas.ReplayGroup.BATCH_CONSTRUCTORS_[t])(this.tolerance_,this.maxExtent_,this.resolution_,this.pixelRatio_,this.overlaps_,this.declutterTree_);r[t]=i}return i};ol.render.canvas.ReplayGroup.prototype.getReplays=function(){return this.replaysByZIndex_};ol.render.canvas.ReplayGroup.prototype.isEmpty=function(){return ol.obj.isEmpty(this.replaysByZIndex_)};ol.render.canvas.ReplayGroup.prototype.replay=function(e,t,o,r,i,n){var a=Object.keys(this.replaysByZIndex_).map(Number);a.sort(ol.array.numberSafeCompareFunction);e.save();this.clip(e,t);var l,s,p,c,u,g,d=i||ol.render.replay.ORDER;for(l=0,s=a.length;l<s;++l){var h=a[l].toString();u=this.replaysByZIndex_[h];for(p=0,c=d.length;p<c;++p){var f=d[p];if(void 0!==(g=u[f]))if(!n||f!=ol.render.ReplayType.IMAGE&&f!=ol.render.ReplayType.TEXT)g.replay(e,t,o,r);else{var y=n[h];y?y.push(g,t.slice(0)):n[h]=[g,t.slice(0)]}}}e.restore()};ol.render.canvas.ReplayGroup.BATCH_CONSTRUCTORS_={Circle:ol.render.canvas.PolygonReplay,Default:ol.render.canvas.Replay,Image:ol.render.canvas.ImageReplay,LineString:ol.render.canvas.LineStringReplay,Polygon:ol.render.canvas.PolygonReplay,Text:ol.render.canvas.TextReplay};goog.provide("ol.renderer.vector");goog.require("ol");goog.require("ol.ImageState");goog.require("ol.geom.GeometryType");goog.require("ol.render.ReplayType");ol.renderer.vector.defaultOrder=function(e,t){return ol.getUid(e)-ol.getUid(t)};ol.renderer.vector.getSquaredTolerance=function(e,t){var o=ol.renderer.vector.getTolerance(e,t);return o*o};ol.renderer.vector.getTolerance=function(e,t){return ol.SIMPLIFY_TOLERANCE*e/t};ol.renderer.vector.renderCircleGeometry_=function(e,t,o,r){var i=o.getFill(),n=o.getStroke();if(i||n){var a=e.getReplay(o.getZIndex(),ol.render.ReplayType.CIRCLE);a.setFillStrokeStyle(i,n);a.drawCircle(t,r)}var l=o.getText();if(l){var s=e.getReplay(o.getZIndex(),ol.render.ReplayType.TEXT);s.setTextStyle(l,e.addDeclutter(!1));s.drawText(t,r)}};ol.renderer.vector.renderFeature=function(e,t,o,r,i,n){var a,l,s=!1;if(a=o.getImage())if((l=a.getImageState())==ol.ImageState.LOADED||l==ol.ImageState.ERROR)a.unlistenImageChange(i,n);else{l==ol.ImageState.IDLE&&a.load();l=a.getImageState();a.listenImageChange(i,n);s=!0}ol.renderer.vector.renderFeature_(e,t,o,r);return s};ol.renderer.vector.renderFeature_=function(e,t,o,r){var i=o.getGeometryFunction()(t);if(i){var n=i.getSimplifiedGeometry(r);if(o.getRenderer())ol.renderer.vector.renderGeometry_(e,n,o,t);else{(0,ol.renderer.vector.GEOMETRY_RENDERERS_[n.getType()])(e,n,o,t)}}};ol.renderer.vector.renderGeometry_=function(e,t,o,r){if(t.getType()!=ol.geom.GeometryType.GEOMETRY_COLLECTION){e.getReplay(o.getZIndex(),ol.render.ReplayType.DEFAULT).drawCustom(t,r,o.getRenderer())}else for(var i=t.getGeometries(),n=0,a=i.length;n<a;++n)ol.renderer.vector.renderGeometry_(e,i[n],o,r)};ol.renderer.vector.renderGeometryCollectionGeometry_=function(e,t,o,r){var i,n,a=t.getGeometriesArray();for(i=0,n=a.length;i<n;++i){(0,ol.renderer.vector.GEOMETRY_RENDERERS_[a[i].getType()])(e,a[i],o,r)}};ol.renderer.vector.renderLineStringGeometry_=function(e,t,o,r){var i=o.getStroke();if(i){var n=e.getReplay(o.getZIndex(),ol.render.ReplayType.LINE_STRING);n.setFillStrokeStyle(null,i);n.drawLineString(t,r)}var a=o.getText();if(a){var l=e.getReplay(o.getZIndex(),ol.render.ReplayType.TEXT);l.setTextStyle(a,e.addDeclutter(!1));l.drawText(t,r)}};ol.renderer.vector.renderMultiLineStringGeometry_=function(e,t,o,r){var i=o.getStroke();if(i){var n=e.getReplay(o.getZIndex(),ol.render.ReplayType.LINE_STRING);n.setFillStrokeStyle(null,i);n.drawMultiLineString(t,r)}var a=o.getText();if(a){var l=e.getReplay(o.getZIndex(),ol.render.ReplayType.TEXT);l.setTextStyle(a,e.addDeclutter(!1));l.drawText(t,r)}};ol.renderer.vector.renderMultiPolygonGeometry_=function(e,t,o,r){var i=o.getFill(),n=o.getStroke();if(n||i){var a=e.getReplay(o.getZIndex(),ol.render.ReplayType.POLYGON);a.setFillStrokeStyle(i,n);a.drawMultiPolygon(t,r)}var l=o.getText();if(l){var s=e.getReplay(o.getZIndex(),ol.render.ReplayType.TEXT);s.setTextStyle(l,e.addDeclutter(!1));s.drawText(t,r)}};ol.renderer.vector.renderPointGeometry_=function(e,t,o,r){var i=o.getImage();if(i){if(i.getImageState()!=ol.ImageState.LOADED)return;var n=e.getReplay(o.getZIndex(),ol.render.ReplayType.IMAGE);n.setImageStyle(i,e.addDeclutter(!1));n.drawPoint(t,r)}var a=o.getText();if(a){var l=e.getReplay(o.getZIndex(),ol.render.ReplayType.TEXT);l.setTextStyle(a,e.addDeclutter(!!i));l.drawText(t,r)}};ol.renderer.vector.renderMultiPointGeometry_=function(e,t,o,r){var i=o.getImage();if(i){if(i.getImageState()!=ol.ImageState.LOADED)return;var n=e.getReplay(o.getZIndex(),ol.render.ReplayType.IMAGE);n.setImageStyle(i,e.addDeclutter(!1));n.drawMultiPoint(t,r)}var a=o.getText();if(a){var l=e.getReplay(o.getZIndex(),ol.render.ReplayType.TEXT);l.setTextStyle(a,e.addDeclutter(!!i));l.drawText(t,r)}};ol.renderer.vector.renderPolygonGeometry_=function(e,t,o,r){var i=o.getFill(),n=o.getStroke();if(i||n){var a=e.getReplay(o.getZIndex(),ol.render.ReplayType.POLYGON);a.setFillStrokeStyle(i,n);a.drawPolygon(t,r)}var l=o.getText();if(l){var s=e.getReplay(o.getZIndex(),ol.render.ReplayType.TEXT);s.setTextStyle(l,e.addDeclutter(!1));s.drawText(t,r)}};ol.renderer.vector.GEOMETRY_RENDERERS_={Point:ol.renderer.vector.renderPointGeometry_,LineString:ol.renderer.vector.renderLineStringGeometry_,Polygon:ol.renderer.vector.renderPolygonGeometry_,MultiPoint:ol.renderer.vector.renderMultiPointGeometry_,MultiLineString:ol.renderer.vector.renderMultiLineStringGeometry_,MultiPolygon:ol.renderer.vector.renderMultiPolygonGeometry_,GeometryCollection:ol.renderer.vector.renderGeometryCollectionGeometry_,Circle:ol.renderer.vector.renderCircleGeometry_};goog.provide("ol.renderer.canvas.VectorLayer");goog.require("ol");goog.require("ol.LayerType");goog.require("ol.ViewHint");goog.require("ol.dom");goog.require("ol.events");goog.require("ol.events.EventType");goog.require("ol.ext.rbush");goog.require("ol.extent");goog.require("ol.render.EventType");goog.require("ol.render.canvas");goog.require("ol.render.canvas.ReplayGroup");goog.require("ol.renderer.Type");goog.require("ol.renderer.canvas.Layer");goog.require("ol.renderer.vector");ol.renderer.canvas.VectorLayer=function(e){ol.renderer.canvas.Layer.call(this,e);this.declutterTree_=e.getDeclutter()?ol.ext.rbush(9):null;this.dirty_=!1;this.renderedRevision_=-1;this.renderedResolution_=NaN;this.renderedExtent_=ol.extent.createEmpty();this.renderedRenderOrder_=null;this.replayGroup_=null;this.replayGroupChanged=!0;this.context=ol.dom.createCanvasContext2D();ol.events.listen(ol.render.canvas.labelCache,ol.events.EventType.CLEAR,this.handleFontsChanged_,this)};ol.inherits(ol.renderer.canvas.VectorLayer,ol.renderer.canvas.Layer);ol.renderer.canvas.VectorLayer.handles=function(e,t){return e===ol.renderer.Type.CANVAS&&t.getType()===ol.LayerType.VECTOR};ol.renderer.canvas.VectorLayer.create=function(e,t){return new ol.renderer.canvas.VectorLayer(t)};ol.renderer.canvas.VectorLayer.prototype.disposeInternal=function(){ol.events.unlisten(ol.render.canvas.labelCache,ol.events.EventType.CLEAR,this.handleFontsChanged_,this);ol.renderer.canvas.Layer.prototype.disposeInternal.call(this)};ol.renderer.canvas.VectorLayer.prototype.composeFrame=function(e,t,o){var r=e.extent,i=e.pixelRatio,n=t.managed?e.skippedFeatureUids:{},a=e.viewState,l=a.projection,s=a.rotation,p=l.getExtent(),c=this.getLayer().getSource(),u=this.getTransform(e,0);this.preCompose(o,e,u);var g=t.extent,d=void 0!==g;d&&this.clip(o,e,g);var h=this.replayGroup_;if(h&&!h.isEmpty()){this.declutterTree_&&this.declutterTree_.clear();var f,y=this.getLayer(),m=0,v=0,C=1!==t.opacity,T=y.hasListener(ol.render.EventType.RENDER);if(C||T){var S=o.canvas.width,_=o.canvas.height;if(s){var E=Math.round(Math.sqrt(S*S+_*_));m=(E-S)/2;v=(E-_)/2;S=_=E}this.context.canvas.width=S;this.context.canvas.height=_;f=this.context}else f=o;var x=f.globalAlpha;C||(f.globalAlpha=t.opacity);f!=o&&f.translate(m,v);var P=e.size[0]*i,L=e.size[1]*i;ol.render.canvas.rotateAtOffset(f,-s,P/2,L/2);h.replay(f,u,s,n);if(c.getWrapX()&&l.canWrapX()&&!ol.extent.containsExtent(p,r)){for(var w,b=r[0],R=ol.extent.getWidth(p),A=0;b<p[0];){w=R*--A;u=this.getTransform(e,w);h.replay(f,u,s,n);b+=R}A=0;b=r[2];for(;b>p[2];){w=R*++A;u=this.getTransform(e,w);h.replay(f,u,s,n);b-=R}u=this.getTransform(e,0)}ol.render.canvas.rotateAtOffset(f,s,P/2,L/2);if(f!=o){T&&this.dispatchRenderEvent(f,e,u);if(C){var M=o.globalAlpha;o.globalAlpha=t.opacity;o.drawImage(f.canvas,-m,-v);o.globalAlpha=M}else o.drawImage(f.canvas,-m,-v);f.translate(-m,-v)}C||(f.globalAlpha=x)}d&&o.restore();this.postCompose(o,e,t,u)};ol.renderer.canvas.VectorLayer.prototype.forEachFeatureAtCoordinate=function(e,t,o,r,i){if(this.replayGroup_){var n=t.viewState.resolution,a=t.viewState.rotation,l=this.getLayer(),s={};return this.replayGroup_.forEachFeatureAtCoordinate(e,n,a,o,{},function(e){var t=ol.getUid(e).toString();if(!(t in s)){s[t]=!0;return r.call(i,e,l)}},null)}};ol.renderer.canvas.VectorLayer.prototype.handleFontsChanged_=function(e){var t=this.getLayer();t.getVisible()&&this.replayGroup_&&t.changed()};ol.renderer.canvas.VectorLayer.prototype.handleStyleImageChange_=function(e){this.renderIfReadyAndVisible()};ol.renderer.canvas.VectorLayer.prototype.prepareFrame=function(e,t){var o=this.getLayer(),r=o.getSource();this.updateLogos(e,r);var i=e.viewHints[ol.ViewHint.ANIMATING],n=e.viewHints[ol.ViewHint.INTERACTING],a=o.getUpdateWhileAnimating(),l=o.getUpdateWhileInteracting();if(!this.dirty_&&!a&&i||!l&&n)return!0;var s=e.extent,p=e.viewState,c=p.projection,u=p.resolution,g=e.pixelRatio,d=o.getRevision(),h=o.getRenderBuffer(),f=o.getRenderOrder();void 0===f&&(f=ol.renderer.vector.defaultOrder);var y=ol.extent.buffer(s,h*u),m=p.projection.getExtent();if(r.getWrapX()&&p.projection.canWrapX()&&!ol.extent.containsExtent(m,e.extent)){var v=ol.extent.getWidth(m),C=Math.max(ol.extent.getWidth(y)/2,v);y[0]=m[0]-C;y[2]=m[2]+C}if(!this.dirty_&&this.renderedResolution_==u&&this.renderedRevision_==d&&this.renderedRenderOrder_==f&&ol.extent.containsExtent(this.renderedExtent_,y)){this.replayGroupChanged=!1;return!0}this.replayGroup_=null;this.dirty_=!1;var T=new ol.render.canvas.ReplayGroup(ol.renderer.vector.getTolerance(u,g),y,u,g,r.getOverlaps(),this.declutterTree_,o.getRenderBuffer());r.loadFeatures(y,u,c);var S=function(e){var t,r=e.getStyleFunction();r?t=r.call(e,u):(r=o.getStyleFunction())&&(t=r(e,u));if(t){var i=this.renderFeature(e,u,g,t,T);this.dirty_=this.dirty_||i}}.bind(this);if(f){var _=[];r.forEachFeatureInExtent(y,function(e){_.push(e)},this);_.sort(f);for(var E=0,x=_.length;E<x;++E)S(_[E])}else r.forEachFeatureInExtent(y,S,this);T.finish();this.renderedResolution_=u;this.renderedRevision_=d;this.renderedRenderOrder_=f;this.renderedExtent_=y;this.replayGroup_=T;this.replayGroupChanged=!0;return!0};ol.renderer.canvas.VectorLayer.prototype.renderFeature=function(e,t,o,r,i){if(!r)return!1;var n=!1;if(Array.isArray(r))for(var a=0,l=r.length;a<l;++a)n=ol.renderer.vector.renderFeature(i,e,r[a],ol.renderer.vector.getSquaredTolerance(t,o),this.handleStyleImageChange_,this)||n;else n=ol.renderer.vector.renderFeature(i,e,r,ol.renderer.vector.getSquaredTolerance(t,o),this.handleStyleImageChange_,this);return n};goog.provide("ol.layer.VectorTileRenderType");ol.layer.VectorTileRenderType={IMAGE:"image",HYBRID:"hybrid",VECTOR:"vector"};goog.provide("ol.renderer.canvas.VectorTileLayer");goog.require("ol");goog.require("ol.LayerType");goog.require("ol.TileState");goog.require("ol.dom");goog.require("ol.events");goog.require("ol.events.EventType");goog.require("ol.ext.rbush");goog.require("ol.extent");goog.require("ol.layer.VectorTileRenderType");goog.require("ol.proj");goog.require("ol.proj.Units");goog.require("ol.render.ReplayType");goog.require("ol.render.canvas");goog.require("ol.render.canvas.ReplayGroup");goog.require("ol.render.replay");goog.require("ol.renderer.Type");goog.require("ol.renderer.canvas.TileLayer");goog.require("ol.renderer.vector");goog.require("ol.transform");ol.renderer.canvas.VectorTileLayer=function(e){this.context=null;ol.renderer.canvas.TileLayer.call(this,e);this.declutterTree_=e.getDeclutter()?ol.ext.rbush(9):null;this.dirty_=!1;this.renderedLayerRevision_;this.tmpTransform_=ol.transform.create();this.zDirection=e.getRenderMode()==ol.layer.VectorTileRenderType.VECTOR?1:0;ol.events.listen(ol.render.canvas.labelCache,ol.events.EventType.CLEAR,this.handleFontsChanged_,this)};ol.inherits(ol.renderer.canvas.VectorTileLayer,ol.renderer.canvas.TileLayer);ol.renderer.canvas.VectorTileLayer.handles=function(e,t){return e===ol.renderer.Type.CANVAS&&t.getType()===ol.LayerType.VECTOR_TILE};ol.renderer.canvas.VectorTileLayer.create=function(e,t){return new ol.renderer.canvas.VectorTileLayer(t)};ol.renderer.canvas.VectorTileLayer.IMAGE_REPLAYS={image:[ol.render.ReplayType.POLYGON,ol.render.ReplayType.CIRCLE,ol.render.ReplayType.LINE_STRING,ol.render.ReplayType.IMAGE,ol.render.ReplayType.TEXT],hybrid:[ol.render.ReplayType.POLYGON,ol.render.ReplayType.LINE_STRING]};ol.renderer.canvas.VectorTileLayer.VECTOR_REPLAYS={image:[ol.render.ReplayType.DEFAULT],hybrid:[ol.render.ReplayType.IMAGE,ol.render.ReplayType.TEXT,ol.render.ReplayType.DEFAULT],vector:ol.render.replay.ORDER};ol.renderer.canvas.VectorTileLayer.prototype.disposeInternal=function(){ol.events.unlisten(ol.render.canvas.labelCache,ol.events.EventType.CLEAR,this.handleFontsChanged_,this);ol.renderer.canvas.TileLayer.prototype.disposeInternal.call(this)};ol.renderer.canvas.VectorTileLayer.prototype.prepareFrame=function(e,t){var o=this.getLayer(),r=o.getRevision();if(this.renderedLayerRevision_!=r){this.renderedTiles.length=0;var i=o.getRenderMode();this.context||i==ol.layer.VectorTileRenderType.VECTOR||(this.context=ol.dom.createCanvasContext2D());this.context&&i==ol.layer.VectorTileRenderType.VECTOR&&(this.context=null)}this.renderedLayerRevision_=r;return ol.renderer.canvas.TileLayer.prototype.prepareFrame.apply(this,arguments)};ol.renderer.canvas.VectorTileLayer.prototype.createReplayGroup_=function(e,t){var o=this.getLayer(),r=t.pixelRatio,i=t.viewState.projection,n=o.getRevision(),a=o.getRenderOrder()||null,l=e.getReplayState(o);if(l.dirty||l.renderedRevision!=n||l.renderedRenderOrder!=a){for(var s=o.getSource(),p=s.getTileGrid(),c=s.getTileGridForProjection(i),u=c.getResolution(e.tileCoord[0]),g=c.getTileCoordExtent(e.wrappedTileCoord),d={},h=0,f=e.tileKeys.length;h<f;++h){var y=e.getTile(e.tileKeys[h]);if(y.getState()!=ol.TileState.ERROR){var m=y.tileCoord,v=p.getTileCoordExtent(m),C=ol.extent.getIntersection(g,v),T=ol.extent.equals(v,C)?null:ol.extent.buffer(C,o.getRenderBuffer()*u),S=y.getProjection(),_=!1;if(!ol.proj.equivalent(i,S)){_=!0;y.setProjection(i)}l.dirty=!1;var E,x=new ol.render.canvas.ReplayGroup(0,C,u,r,s.getOverlaps(),this.declutterTree_,o.getRenderBuffer()),P=ol.renderer.vector.getSquaredTolerance(u,r),L=function(e){var t,r=e.getStyleFunction();r?t=r.call(e,u):(r=o.getStyleFunction())&&(t=r(e,u));if(t){var i=this.renderFeature(e,P,t,x);this.dirty_=this.dirty_||i;l.dirty=l.dirty||i}},w=y.getFeatures();a&&a!==l.renderedRenderOrder&&w.sort(a);for(var b=0,R=w.length;b<R;++b){E=w[b];if(_){if(S.getUnits()==ol.proj.Units.TILE_PIXELS){S.setWorldExtent(v);S.setExtent(y.getExtent())}E.getGeometry().transform(S,i)}T&&!ol.extent.intersects(T,E.getGeometry().getExtent())||L.call(this,E)}x.finish();for(var A in x.getReplays())d[A]=!0;y.setReplayGroup(o,e.tileCoord.toString(),x)}}l.renderedRevision=n;l.renderedRenderOrder=a}};ol.renderer.canvas.VectorTileLayer.prototype.drawTileImage=function(e,t,o,r,i,n,a,l,s){var p=e;this.createReplayGroup_(p,t);if(this.context){this.renderTileImage_(p,t,o);ol.renderer.canvas.TileLayer.prototype.drawTileImage.apply(this,arguments)}};ol.renderer.canvas.VectorTileLayer.prototype.forEachFeatureAtCoordinate=function(e,t,o,r,i){var n=t.viewState.resolution,a=t.viewState.rotation;o=void 0==o?0:o;var l,s,p,c,u,g,d,h,f=this.getLayer(),y={},m=this.renderedTiles,v=f.getSource().getTileGridForProjection(t.viewState.projection);for(p=0,c=m.length;p<c;++p){d=(g=m[p]).wrappedTileCoord;h=v.getTileCoordExtent(d,this.tmpExtent);l=ol.extent.buffer(h,o*n,l);if(ol.extent.containsCoordinate(l,e))for(var C=0,T=g.tileKeys.length;C<T;++C){var S=g.getTile(g.tileKeys[C]);if(S.getState()!=ol.TileState.ERROR){u=S.getReplayGroup(f,g.tileCoord.toString());s=s||u.forEachFeatureAtCoordinate(e,n,a,o,{},function(e){var t=ol.getUid(e).toString();if(!(t in y)){y[t]=!0;return r.call(i,e,f)}},null)}}}return s};ol.renderer.canvas.VectorTileLayer.prototype.getReplayTransform_=function(e,t){var o=this.getLayer().getSource().getTileGrid(),r=e.tileCoord,i=o.getResolution(r[0]),n=t.viewState,a=t.pixelRatio,l=n.resolution/a,s=o.getTileCoordExtent(r,this.tmpExtent),p=n.center,c=ol.extent.getTopLeft(s),u=t.size,g=Math.round(a*u[0]/2),d=Math.round(a*u[1]/2);return ol.transform.compose(this.tmpTransform_,g,d,i/l,i/l,n.rotation,(c[0]-p[0])/i,(p[1]-c[1])/i)};ol.renderer.canvas.VectorTileLayer.prototype.handleFontsChanged_=function(e){var t=this.getLayer();t.getVisible()&&void 0!==this.renderedLayerRevision_&&t.changed()};ol.renderer.canvas.VectorTileLayer.prototype.handleStyleImageChange_=function(e){this.renderIfReadyAndVisible()};ol.renderer.canvas.VectorTileLayer.prototype.postCompose=function(e,t,o){var r,i,n=this.getLayer(),a=n.getDeclutter()?{}:null,l=n.getSource(),s=n.getRenderMode(),p=ol.renderer.canvas.VectorTileLayer.VECTOR_REPLAYS[s],c=t.pixelRatio,u=t.viewState.rotation,g=t.size;if(u){r=Math.round(c*g[0]/2);i=Math.round(c*g[1]/2);ol.render.canvas.rotateAtOffset(e,-u,r,i)}a&&this.declutterTree_.clear();for(var d=this.renderedTiles,h=l.getTileGridForProjection(t.viewState.projection),f=[],y=[],m=d.length-1;m>=0;--m){var v=d[m];if(v.getState()!=ol.TileState.ABORT)for(var C=v.tileCoord,T=h.getTileCoordExtent(C)[0]-h.getTileCoordExtent(v.wrappedTileCoord)[0],S=void 0,_=0,E=v.tileKeys.length;_<E;++_){var x=v.getTile(v.tileKeys[_]);if(x.getState()!=ol.TileState.ERROR){var P=x.getReplayGroup(n,C.toString());if(s==ol.layer.VectorTileRenderType.VECTOR||P.hasReplays(p)){S||(S=this.getTransform(t,T));var L=x.tileCoord[0],w=P.getClipCoords(S);e.save();e.globalAlpha=o.opacity;for(var b=0,R=f.length;b<R;++b){var A=f[b];if(L<y[b]){e.beginPath();e.moveTo(w[0],w[1]);e.lineTo(w[2],w[3]);e.lineTo(w[4],w[5]);e.lineTo(w[6],w[7]);e.moveTo(A[6],A[7]);e.lineTo(A[4],A[5]);e.lineTo(A[2],A[3]);e.lineTo(A[0],A[1]);e.clip()}}P.replay(e,S,u,{},p,a);e.restore();f.push(w);y.push(L)}}}}a&&ol.render.canvas.ReplayGroup.replayDeclutter(a,e,u);u&&ol.render.canvas.rotateAtOffset(e,u,r,i);ol.renderer.canvas.TileLayer.prototype.postCompose.apply(this,arguments)};ol.renderer.canvas.VectorTileLayer.prototype.renderFeature=function(e,t,o,r){if(!o)return!1;var i=!1;if(Array.isArray(o))for(var n=0,a=o.length;n<a;++n)i=ol.renderer.vector.renderFeature(r,e,o[n],t,this.handleStyleImageChange_,this)||i;else i=ol.renderer.vector.renderFeature(r,e,o,t,this.handleStyleImageChange_,this);return i};ol.renderer.canvas.VectorTileLayer.prototype.renderTileImage_=function(e,t,o){var r=this.getLayer(),i=e.getReplayState(r),n=r.getRevision(),a=ol.renderer.canvas.VectorTileLayer.IMAGE_REPLAYS[r.getRenderMode()];if(a&&i.renderedTileRevision!==n){i.renderedTileRevision=n;var l=e.wrappedTileCoord,s=l[0],p=t.pixelRatio,c=r.getSource(),u=c.getTileGridForProjection(t.viewState.projection),g=u.getResolution(s),d=e.getContext(r),h=c.getTilePixelSize(s,p,t.viewState.projection);d.canvas.width=h[0];d.canvas.height=h[1];for(var f=u.getTileCoordExtent(l),y=0,m=e.tileKeys.length;y<m;++y){var v=e.getTile(e.tileKeys[y]);if(v.getState()!=ol.TileState.ERROR){var C=p/g,T=ol.transform.reset(this.tmpTransform_);ol.transform.scale(T,C,-C);ol.transform.translate(T,-f[0],-f[3]);v.getReplayGroup(r,e.tileCoord.toString()).replay(d,T,0,{},a)}}}};goog.provide("ol.CanvasMap");goog.require("ol");goog.require("ol.PluggableMap");goog.require("ol.PluginType");goog.require("ol.control");goog.require("ol.interaction");goog.require("ol.obj");goog.require("ol.plugins");goog.require("ol.renderer.canvas.ImageLayer");goog.require("ol.renderer.canvas.Map");goog.require("ol.renderer.canvas.TileLayer");goog.require("ol.renderer.canvas.VectorLayer");goog.require("ol.renderer.canvas.VectorTileLayer");ol.plugins.register(ol.PluginType.MAP_RENDERER,ol.renderer.canvas.Map);ol.plugins.registerMultiple(ol.PluginType.LAYER_RENDERER,[ol.renderer.canvas.ImageLayer,ol.renderer.canvas.TileLayer,ol.renderer.canvas.VectorLayer,ol.renderer.canvas.VectorTileLayer]);ol.CanvasMap=function(e){delete(e=ol.obj.assign({},e)).renderer;e.controls||(e.controls=ol.control.defaults());e.interactions||(e.interactions=ol.interaction.defaults());ol.PluggableMap.call(this,e)};ol.inherits(ol.CanvasMap,ol.PluggableMap);goog.provide("ol.control.FullScreen");goog.require("ol");goog.require("ol.control.Control");goog.require("ol.css");goog.require("ol.dom");goog.require("ol.events");goog.require("ol.events.EventType");ol.control.FullScreen=function(e){var t=e||{};this.cssClassName_=void 0!==t.className?t.className:"ol-full-screen";var o=void 0!==t.label?t.label:"\u2922";this.labelNode_="string"==typeof o?document.createTextNode(o):o;var r=void 0!==t.labelActive?t.labelActive:"\xd7";this.labelActiveNode_="string"==typeof r?document.createTextNode(r):r;var i=t.tipLabel?t.tipLabel:"Toggle full-screen",n=document.createElement("button");n.className=this.cssClassName_+"-"+ol.control.FullScreen.isFullScreen();n.setAttribute("type","button");n.title=i;n.appendChild(this.labelNode_);ol.events.listen(n,ol.events.EventType.CLICK,this.handleClick_,this);var a=this.cssClassName_+" "+ol.css.CLASS_UNSELECTABLE+" "+ol.css.CLASS_CONTROL+" "+(ol.control.FullScreen.isFullScreenSupported()?"":ol.css.CLASS_UNSUPPORTED),l=document.createElement("div");l.className=a;l.appendChild(n);ol.control.Control.call(this,{element:l,target:t.target});this.keys_=void 0!==t.keys&&t.keys;this.source_=t.source};ol.inherits(ol.control.FullScreen,ol.control.Control);ol.control.FullScreen.prototype.handleClick_=function(e){e.preventDefault();this.handleFullScreen_()};ol.control.FullScreen.prototype.handleFullScreen_=function(){if(ol.control.FullScreen.isFullScreenSupported()){var e=this.getMap();if(e)if(ol.control.FullScreen.isFullScreen())ol.control.FullScreen.exitFullScreen();else{var t;t=this.source_?"string"==typeof this.source_?document.getElementById(this.source_):this.source_:e.getTargetElement();this.keys_?ol.control.FullScreen.requestFullScreenWithKeys(t):ol.control.FullScreen.requestFullScreen(t)}}};ol.control.FullScreen.prototype.handleFullScreenChange_=function(){var e=this.element.firstElementChild,t=this.getMap();if(ol.control.FullScreen.isFullScreen()){e.className=this.cssClassName_+"-true";ol.dom.replaceNode(this.labelActiveNode_,this.labelNode_)}else{e.className=this.cssClassName_+"-false";ol.dom.replaceNode(this.labelNode_,this.labelActiveNode_)}t&&t.updateSize()};ol.control.FullScreen.prototype.setMap=function(e){ol.control.Control.prototype.setMap.call(this,e);e&&this.listenerKeys.push(ol.events.listen(document,ol.control.FullScreen.getChangeType_(),this.handleFullScreenChange_,this))};ol.control.FullScreen.isFullScreenSupported=function(){var e=document.body;return!!(e.webkitRequestFullscreen||e.mozRequestFullScreen&&document.mozFullScreenEnabled||e.msRequestFullscreen&&document.msFullscreenEnabled||e.requestFullscreen&&document.fullscreenEnabled)};ol.control.FullScreen.isFullScreen=function(){return!!(document.webkitIsFullScreen||document.mozFullScreen||document.msFullscreenElement||document.fullscreenElement)};ol.control.FullScreen.requestFullScreen=function(e){e.requestFullscreen?e.requestFullscreen():e.msRequestFullscreen?e.msRequestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen&&e.webkitRequestFullscreen()};ol.control.FullScreen.requestFullScreenWithKeys=function(e){e.mozRequestFullScreenWithKeys?e.mozRequestFullScreenWithKeys():e.webkitRequestFullscreen?e.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT):ol.control.FullScreen.requestFullScreen(e)};ol.control.FullScreen.exitFullScreen=function(){document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen()};ol.control.FullScreen.getChangeType_=function(){if(!changeType){var e=document.body;e.webkitRequestFullscreen?changeType="webkitfullscreenchange":e.mozRequestFullScreen?changeType="mozfullscreenchange":e.msRequestFullscreen?changeType="MSFullscreenChange":e.requestFullscreen&&(changeType="fullscreenchange")}return changeType};goog.provide("ol.control.MousePosition");goog.require("ol");goog.require("ol.events");goog.require("ol.events.EventType");goog.require("ol.Object");goog.require("ol.control.Control");goog.require("ol.proj");ol.control.MousePosition=function(e){var t=e||{},o=document.createElement("DIV");o.className=void 0!==t.className?t.className:"ol-mouse-position";var r=t.render?t.render:ol.control.MousePosition.render;ol.control.Control.call(this,{element:o,render:r,target:t.target});ol.events.listen(this,ol.Object.getChangeEventType(ol.control.MousePosition.Property_.PROJECTION),this.handleProjectionChanged_,this);t.coordinateFormat&&this.setCoordinateFormat(t.coordinateFormat);t.projection&&this.setProjection(t.projection);this.undefinedHTML_=void 0!==t.undefinedHTML?t.undefinedHTML:"";this.renderedHTML_=o.innerHTML;this.mapProjection_=null;this.transform_=null;this.lastMouseMovePixel_=null};ol.inherits(ol.control.MousePosition,ol.control.Control);ol.control.MousePosition.render=function(e){var t=e.frameState;if(t){if(this.mapProjection_!=t.viewState.projection){this.mapProjection_=t.viewState.projection;this.transform_=null}}else this.mapProjection_=null;this.updateHTML_(this.lastMouseMovePixel_)};ol.control.MousePosition.prototype.handleProjectionChanged_=function(){this.transform_=null};ol.control.MousePosition.prototype.getCoordinateFormat=function(){return this.get(ol.control.MousePosition.Property_.COORDINATE_FORMAT)};ol.control.MousePosition.prototype.getProjection=function(){return this.get(ol.control.MousePosition.Property_.PROJECTION)};ol.control.MousePosition.prototype.handleMouseMove=function(e){var t=this.getMap();this.lastMouseMovePixel_=t.getEventPixel(e);this.updateHTML_(this.lastMouseMovePixel_)};ol.control.MousePosition.prototype.handleMouseOut=function(e){this.updateHTML_(null);this.lastMouseMovePixel_=null};ol.control.MousePosition.prototype.setMap=function(e){ol.control.Control.prototype.setMap.call(this,e);if(e){var t=e.getViewport();this.listenerKeys.push(ol.events.listen(t,ol.events.EventType.MOUSEMOVE,this.handleMouseMove,this),ol.events.listen(t,ol.events.EventType.MOUSEOUT,this.handleMouseOut,this))}};ol.control.MousePosition.prototype.setCoordinateFormat=function(e){this.set(ol.control.MousePosition.Property_.COORDINATE_FORMAT,e)};ol.control.MousePosition.prototype.setProjection=function(e){this.set(ol.control.MousePosition.Property_.PROJECTION,ol.proj.get(e))};ol.control.MousePosition.prototype.updateHTML_=function(e){var t=this.undefinedHTML_;if(e&&this.mapProjection_){if(!this.transform_){var o=this.getProjection();this.transform_=o?ol.proj.getTransformFromProjections(this.mapProjection_,o):ol.proj.identityTransform}var r=this.getMap().getCoordinateFromPixel(e);if(r){this.transform_(r,r);var i=this.getCoordinateFormat();t=i?i(r):r.toString()}}if(!this.renderedHTML_||t!=this.renderedHTML_){this.element.innerHTML=t;this.renderedHTML_=t}};ol.control.MousePosition.Property_={PROJECTION:"projection",COORDINATE_FORMAT:"coordinateFormat"};goog.provide("ol.OverlayPositioning");ol.OverlayPositioning={BOTTOM_LEFT:"bottom-left",BOTTOM_CENTER:"bottom-center",BOTTOM_RIGHT:"bottom-right",CENTER_LEFT:"center-left",CENTER_CENTER:"center-center",CENTER_RIGHT:"center-right",TOP_LEFT:"top-left",TOP_CENTER:"top-center",TOP_RIGHT:"top-right"};goog.provide("ol.Overlay");goog.require("ol");goog.require("ol.MapEventType");goog.require("ol.Object");goog.require("ol.OverlayPositioning");goog.require("ol.css");goog.require("ol.dom");goog.require("ol.events");goog.require("ol.extent");ol.Overlay=function(e){ol.Object.call(this);this.options=e;this.id=e.id;this.insertFirst=void 0===e.insertFirst||e.insertFirst;this.stopEvent=void 0===e.stopEvent||e.stopEvent;this.element=document.createElement("DIV");this.element.className=void 0!==e.className?e.className:"ol-overlay-container "+ol.css.CLASS_SELECTABLE;this.element.style.position="absolute";this.autoPan=void 0!==e.autoPan&&e.autoPan;this.autoPanAnimation=e.autoPanAnimation||{};this.autoPanMargin=void 0!==e.autoPanMargin?e.autoPanMargin:20;this.rendered={bottom_:"",left_:"",right_:"",top_:"",visible:!0};this.mapPostrenderListenerKey=null;ol.events.listen(this,ol.Object.getChangeEventType(ol.Overlay.Property.ELEMENT),this.handleElementChanged,this);ol.events.listen(this,ol.Object.getChangeEventType(ol.Overlay.Property.MAP),this.handleMapChanged,this);ol.events.listen(this,ol.Object.getChangeEventType(ol.Overlay.Property.OFFSET),this.handleOffsetChanged,this);ol.events.listen(this,ol.Object.getChangeEventType(ol.Overlay.Property.POSITION),this.handlePositionChanged,this);ol.events.listen(this,ol.Object.getChangeEventType(ol.Overlay.Property.POSITIONING),this.handlePositioningChanged,this);void 0!==e.element&&this.setElement(e.element);this.setOffset(void 0!==e.offset?e.offset:[0,0]);this.setPositioning(void 0!==e.positioning?e.positioning:ol.OverlayPositioning.TOP_LEFT);void 0!==e.position&&this.setPosition(e.position)};ol.inherits(ol.Overlay,ol.Object);ol.Overlay.prototype.getElement=function(){return this.get(ol.Overlay.Property.ELEMENT)};ol.Overlay.prototype.getId=function(){return this.id};ol.Overlay.prototype.getMap=function(){return this.get(ol.Overlay.Property.MAP)};ol.Overlay.prototype.getOffset=function(){return this.get(ol.Overlay.Property.OFFSET)};ol.Overlay.prototype.getPosition=function(){return this.get(ol.Overlay.Property.POSITION)};ol.Overlay.prototype.getPositioning=function(){return this.get(ol.Overlay.Property.POSITIONING)};ol.Overlay.prototype.handleElementChanged=function(){ol.dom.removeChildren(this.element);var e=this.getElement();e&&this.element.appendChild(e)};ol.Overlay.prototype.handleMapChanged=function(){if(this.mapPostrenderListenerKey){ol.dom.removeNode(this.element);ol.events.unlistenByKey(this.mapPostrenderListenerKey);this.mapPostrenderListenerKey=null}var e=this.getMap();if(e){this.mapPostrenderListenerKey=ol.events.listen(e,ol.MapEventType.POSTRENDER,this.render,this);this.updatePixelPosition();var t=this.stopEvent?e.getOverlayContainerStopEvent():e.getOverlayContainer();this.insertFirst?t.insertBefore(this.element,t.childNodes[0]||null):t.appendChild(this.element)}};ol.Overlay.prototype.render=function(){this.updatePixelPosition()};ol.Overlay.prototype.handleOffsetChanged=function(){this.updatePixelPosition()};ol.Overlay.prototype.handlePositionChanged=function(){this.updatePixelPosition();this.get(ol.Overlay.Property.POSITION)&&this.autoPan&&this.panIntoView()};ol.Overlay.prototype.handlePositioningChanged=function(){this.updatePixelPosition()};ol.Overlay.prototype.setElement=function(e){this.set(ol.Overlay.Property.ELEMENT,e)};ol.Overlay.prototype.setMap=function(e){this.set(ol.Overlay.Property.MAP,e)};ol.Overlay.prototype.setOffset=function(e){this.set(ol.Overlay.Property.OFFSET,e)};ol.Overlay.prototype.setPosition=function(e){this.set(ol.Overlay.Property.POSITION,e)};ol.Overlay.prototype.panIntoView=function(){var e=this.getMap();if(e&&e.getTargetElement()){var t=this.getRect(e.getTargetElement(),e.getSize()),o=this.getElement(),r=this.getRect(o,[ol.dom.outerWidth(o),ol.dom.outerHeight(o)]),i=this.autoPanMargin;if(!ol.extent.containsExtent(t,r)){var n=r[0]-t[0],a=t[2]-r[2],l=r[1]-t[1],s=t[3]-r[3],p=[0,0];n<0?p[0]=n-i:a<0&&(p[0]=Math.abs(a)+i);l<0?p[1]=l-i:s<0&&(p[1]=Math.abs(s)+i);if(0!==p[0]||0!==p[1]){var c=e.getView().getCenter(),u=e.getPixelFromCoordinate(c),g=[u[0]+p[0],u[1]+p[1]];e.getView().animate({center:e.getCoordinateFromPixel(g),duration:this.autoPanAnimation.duration,easing:this.autoPanAnimation.easing})}}}};ol.Overlay.prototype.getRect=function(e,t){var o=e.getBoundingClientRect(),r=o.left+window.pageXOffset,i=o.top+window.pageYOffset;return[r,i,r+t[0],i+t[1]]};ol.Overlay.prototype.setPositioning=function(e){this.set(ol.Overlay.Property.POSITIONING,e)};ol.Overlay.prototype.setVisible=function(e){if(this.rendered.visible!==e){this.element.style.display=e?"":"none";this.rendered.visible=e}};ol.Overlay.prototype.updatePixelPosition=function(){var e=this.getMap(),t=this.getPosition();if(e&&e.isRendered()&&t){var o=e.getPixelFromCoordinate(t),r=e.getSize();this.updateRenderedPosition(o,r)}else this.setVisible(!1)};ol.Overlay.prototype.updateRenderedPosition=function(e,t){var o=this.element.style,r=this.getOffset(),i=this.getPositioning();this.setVisible(!0);var n=r[0],a=r[1];if(i==ol.OverlayPositioning.BOTTOM_RIGHT||i==ol.OverlayPositioning.CENTER_RIGHT||i==ol.OverlayPositioning.TOP_RIGHT){""!==this.rendered.left_&&(this.rendered.left_=o.left="");var l=Math.round(t[0]-e[0]-n)+"px";this.rendered.right_!=l&&(this.rendered.right_=o.right=l)}else{""!==this.rendered.right_&&(this.rendered.right_=o.right="");i!=ol.OverlayPositioning.BOTTOM_CENTER&&i!=ol.OverlayPositioning.CENTER_CENTER&&i!=ol.OverlayPositioning.TOP_CENTER||(n-=this.element.offsetWidth/2);var s=Math.round(e[0]+n)+"px";this.rendered.left_!=s&&(this.rendered.left_=o.left=s)}if(i==ol.OverlayPositioning.BOTTOM_LEFT||i==ol.OverlayPositioning.BOTTOM_CENTER||i==ol.OverlayPositioning.BOTTOM_RIGHT){""!==this.rendered.top_&&(this.rendered.top_=o.top="");var p=Math.round(t[1]-e[1]-a)+"px";this.rendered.bottom_!=p&&(this.rendered.bottom_=o.bottom=p)}else{""!==this.rendered.bottom_&&(this.rendered.bottom_=o.bottom="");i!=ol.OverlayPositioning.CENTER_LEFT&&i!=ol.OverlayPositioning.CENTER_CENTER&&i!=ol.OverlayPositioning.CENTER_RIGHT||(a-=this.element.offsetHeight/2);var c=Math.round(e[1]+a)+"px";this.rendered.top_!=c&&(this.rendered.top_=o.top=c)}};ol.Overlay.prototype.getOptions=function(){return this.options};ol.Overlay.Property={ELEMENT:"element",MAP:"map",OFFSET:"offset",POSITION:"position",POSITIONING:"positioning"};goog.provide("ol.control.OverviewMap");goog.require("ol");goog.require("ol.Collection");goog.require("ol.PluggableMap");goog.require("ol.MapEventType");goog.require("ol.MapProperty");goog.require("ol.Object");goog.require("ol.ObjectEventType");goog.require("ol.Overlay");goog.require("ol.OverlayPositioning");goog.require("ol.ViewProperty");goog.require("ol.control.Control");goog.require("ol.coordinate");goog.require("ol.css");goog.require("ol.dom");goog.require("ol.events");goog.require("ol.events.EventType");goog.require("ol.extent");ol.control.OverviewMap=function(e){var t=e||{};this.collapsed_=void 0===t.collapsed||t.collapsed;this.collapsible_=void 0===t.collapsible||t.collapsible;this.collapsible_||(this.collapsed_=!1);var o=void 0!==t.className?t.className:"ol-overviewmap",r=void 0!==t.tipLabel?t.tipLabel:"Overview map",i=void 0!==t.collapseLabel?t.collapseLabel:"\xab";if("string"==typeof i){this.collapseLabel_=document.createElement("span");this.collapseLabel_.textContent=i}else this.collapseLabel_=i;var n=void 0!==t.label?t.label:"\xbb";if("string"==typeof n){this.label_=document.createElement("span");this.label_.textContent=n}else this.label_=n;var a=this.collapsible_&&!this.collapsed_?this.collapseLabel_:this.label_,l=document.createElement("button");l.setAttribute("type","button");l.title=r;l.appendChild(a);ol.events.listen(l,ol.events.EventType.CLICK,this.handleClick_,this);this.ovmapDiv_=document.createElement("DIV");this.ovmapDiv_.className="ol-overviewmap-map";this.ovmap_=new ol.PluggableMap({controls:new ol.Collection,interactions:new ol.Collection,view:t.view});var s=this.ovmap_;t.layers&&t.layers.forEach(function(e){s.addLayer(e)},this);var p=document.createElement("DIV");p.className="ol-overviewmap-box";p.style.boxSizing="border-box";this.boxOverlay_=new ol.Overlay({position:[0,0],positioning:ol.OverlayPositioning.BOTTOM_LEFT,element:p});this.ovmap_.addOverlay(this.boxOverlay_);var c=o+" "+ol.css.CLASS_UNSELECTABLE+" "+ol.css.CLASS_CONTROL+(this.collapsed_&&this.collapsible_?" ol-collapsed":"")+(this.collapsible_?"":" ol-uncollapsible"),u=document.createElement("div");u.className=c;u.appendChild(this.ovmapDiv_);u.appendChild(l);var g=t.render?t.render:ol.control.OverviewMap.render;ol.control.Control.call(this,{element:u,render:g,target:t.target});var d=this,h=this.boxOverlay_,f=this.boxOverlay_.getElement(),y=function(e){var t,o=s.getEventCoordinate({clientX:(t=e).clientX-f.offsetWidth/2,clientY:t.clientY+f.offsetHeight/2});h.setPosition(o)},m=function(e){var t=s.getEventCoordinate(e);d.getMap().getView().setCenter(t);window.removeEventListener("mousemove",y);window.removeEventListener("mouseup",m)};f.addEventListener("mousedown",function(){window.addEventListener("mousemove",y);window.addEventListener("mouseup",m)})};ol.inherits(ol.control.OverviewMap,ol.control.Control);ol.control.OverviewMap.prototype.setMap=function(e){var t=this.getMap();if(e!==t){if(t){var o=t.getView();o&&this.unbindView_(o);this.ovmap_.setTarget(null)}ol.control.Control.prototype.setMap.call(this,e);if(e){this.ovmap_.setTarget(this.ovmapDiv_);this.listenerKeys.push(ol.events.listen(e,ol.ObjectEventType.PROPERTYCHANGE,this.handleMapPropertyChange_,this));0===this.ovmap_.getLayers().getLength()&&this.ovmap_.setLayerGroup(e.getLayerGroup());var r=e.getView();if(r){this.bindView_(r);if(r.isDef()){this.ovmap_.updateSize();this.resetExtent_()}}}}};ol.control.OverviewMap.prototype.handleMapPropertyChange_=function(e){if(e.key===ol.MapProperty.VIEW){var t=e.oldValue;t&&this.unbindView_(t);var o=this.getMap().getView();this.bindView_(o)}};ol.control.OverviewMap.prototype.bindView_=function(e){ol.events.listen(e,ol.Object.getChangeEventType(ol.ViewProperty.ROTATION),this.handleRotationChanged_,this)};ol.control.OverviewMap.prototype.unbindView_=function(e){ol.events.unlisten(e,ol.Object.getChangeEventType(ol.ViewProperty.ROTATION),this.handleRotationChanged_,this)};ol.control.OverviewMap.prototype.handleRotationChanged_=function(){this.ovmap_.getView().setRotation(this.getMap().getView().getRotation())};ol.control.OverviewMap.render=function(e){this.validateExtent_();this.updateBox_()};ol.control.OverviewMap.prototype.validateExtent_=function(){var e=this.getMap(),t=this.ovmap_;if(e.isRendered()&&t.isRendered()){var o=e.getSize(),r=e.getView().calculateExtent(o),i=t.getSize(),n=t.getView().calculateExtent(i),a=t.getPixelFromCoordinate(ol.extent.getTopLeft(r)),l=t.getPixelFromCoordinate(ol.extent.getBottomRight(r)),s=Math.abs(a[0]-l[0]),p=Math.abs(a[1]-l[1]),c=i[0],u=i[1];s<c*ol.OVERVIEWMAP_MIN_RATIO||p<u*ol.OVERVIEWMAP_MIN_RATIO||s>c*ol.OVERVIEWMAP_MAX_RATIO||p>u*ol.OVERVIEWMAP_MAX_RATIO?this.resetExtent_():ol.extent.containsExtent(n,r)||this.recenter_()}};ol.control.OverviewMap.prototype.resetExtent_=function(){if(0!==ol.OVERVIEWMAP_MAX_RATIO&&0!==ol.OVERVIEWMAP_MIN_RATIO){var e=this.getMap(),t=this.ovmap_,o=e.getSize(),r=e.getView().calculateExtent(o),i=t.getView(),n=Math.log(ol.OVERVIEWMAP_MAX_RATIO/ol.OVERVIEWMAP_MIN_RATIO)/Math.LN2,a=1/(Math.pow(2,n/2)*ol.OVERVIEWMAP_MIN_RATIO);ol.extent.scaleFromCenter(r,a);i.fit(r)}};ol.control.OverviewMap.prototype.recenter_=function(){var e=this.getMap(),t=this.ovmap_,o=e.getView();t.getView().setCenter(o.getCenter())};ol.control.OverviewMap.prototype.updateBox_=function(){var e=this.getMap(),t=this.ovmap_;if(e.isRendered()&&t.isRendered()){var o=e.getSize(),r=e.getView(),i=t.getView(),n=r.getRotation(),a=this.boxOverlay_,l=this.boxOverlay_.getElement(),s=r.calculateExtent(o),p=i.getResolution(),c=ol.extent.getBottomLeft(s),u=ol.extent.getTopRight(s),g=this.calculateCoordinateRotate_(n,c);a.setPosition(g);if(l){l.style.width=Math.abs((c[0]-u[0])/p)+"px";l.style.height=Math.abs((u[1]-c[1])/p)+"px"}}};ol.control.OverviewMap.prototype.calculateCoordinateRotate_=function(e,t){var o,r=this.getMap().getView().getCenter();if(r){o=[t[0]-r[0],t[1]-r[1]];ol.coordinate.rotate(o,e);ol.coordinate.add(o,r)}return o};ol.control.OverviewMap.prototype.handleClick_=function(e){e.preventDefault();this.handleToggle_()};ol.control.OverviewMap.prototype.handleToggle_=function(){this.element.classList.toggle("ol-collapsed");this.collapsed_?ol.dom.replaceNode(this.collapseLabel_,this.label_):ol.dom.replaceNode(this.label_,this.collapseLabel_);this.collapsed_=!this.collapsed_;var e=this.ovmap_;if(!this.collapsed_&&!e.isRendered()){e.updateSize();this.resetExtent_();ol.events.listenOnce(e,ol.MapEventType.POSTRENDER,function(e){this.updateBox_()},this)}};ol.control.OverviewMap.prototype.getCollapsible=function(){return this.collapsible_};ol.control.OverviewMap.prototype.setCollapsible=function(e){if(this.collapsible_!==e){this.collapsible_=e;this.element.classList.toggle("ol-uncollapsible");!e&&this.collapsed_&&this.handleToggle_()}};ol.control.OverviewMap.prototype.setCollapsed=function(e){this.collapsible_&&this.collapsed_!==e&&this.handleToggle_()};ol.control.OverviewMap.prototype.getCollapsed=function(){return this.collapsed_};ol.control.OverviewMap.prototype.getOverviewMap=function(){return this.ovmap_};goog.provide("ol.control.ScaleLineUnits");ol.control.ScaleLineUnits={DEGREES:"degrees",IMPERIAL:"imperial",NAUTICAL:"nautical",METRIC:"metric",US:"us"};goog.provide("ol.control.ScaleLine");goog.require("ol");goog.require("ol.Object");goog.require("ol.asserts");goog.require("ol.control.Control");goog.require("ol.control.ScaleLineUnits");goog.require("ol.css");goog.require("ol.events");goog.require("ol.proj");goog.require("ol.proj.Units");ol.control.ScaleLine=function(e){var t=e||{},o=void 0!==t.className?t.className:"ol-scale-line";this.innerElement_=document.createElement("DIV");this.innerElement_.className=o+"-inner";this.element_=document.createElement("DIV");this.element_.className=o+" "+ol.css.CLASS_UNSELECTABLE;this.element_.appendChild(this.innerElement_);this.viewState_=null;this.minWidth_=void 0!==t.minWidth?t.minWidth:64;this.renderedVisible_=!1;this.renderedWidth_=void 0;this.renderedHTML_="";var r=t.render?t.render:ol.control.ScaleLine.render;ol.control.Control.call(this,{element:this.element_,render:r,target:t.target});ol.events.listen(this,ol.Object.getChangeEventType(ol.control.ScaleLine.Property_.UNITS),this.handleUnitsChanged_,this);this.setUnits(t.units||ol.control.ScaleLineUnits.METRIC)};ol.inherits(ol.control.ScaleLine,ol.control.Control);ol.control.ScaleLine.LEADING_DIGITS=[1,2,5];ol.control.ScaleLine.prototype.getUnits=function(){return this.get(ol.control.ScaleLine.Property_.UNITS)};ol.control.ScaleLine.render=function(e){var t=e.frameState;this.viewState_=t?t.viewState:null;this.updateElement_()};ol.control.ScaleLine.prototype.handleUnitsChanged_=function(){this.updateElement_()};ol.control.ScaleLine.prototype.setUnits=function(e){this.set(ol.control.ScaleLine.Property_.UNITS,e)};ol.control.ScaleLine.prototype.updateElement_=function(){var e=this.viewState_;if(e){var t=e.center,o=e.projection,r=this.getUnits(),i=r==ol.control.ScaleLineUnits.DEGREES?ol.proj.Units.DEGREES:ol.proj.Units.METERS,n=ol.proj.getPointResolution(o,e.resolution,t,i);r!=ol.control.ScaleLineUnits.METRIC&&(n*=o.getMetersPerUnit());var a=this.minWidth_*n,l="";if(r==ol.control.ScaleLineUnits.DEGREES){var s=ol.proj.METERS_PER_UNIT[ol.proj.Units.DEGREES];o.getUnits()==ol.proj.Units.DEGREES?a*=s:n/=s;if(a<s/60){l="\u2033";n*=3600}else if(a<s){l="\u2032";n*=60}else l="\xb0"}else if(r==ol.control.ScaleLineUnits.IMPERIAL)if(a<.9144){l="in";n/=.0254}else if(a<1609.344){l="ft";n/=.3048}else{l="mi";n/=1609.344}else if(r==ol.control.ScaleLineUnits.NAUTICAL){n/=1852;l="nm"}else if(r==ol.control.ScaleLineUnits.METRIC)if(a<.001){l="\u03bcm";n*=1e6}else if(a<1){l="mm";n*=1e3}else if(a<1e3)l="m";else{l="km";n/=1e3}else if(r==ol.control.ScaleLineUnits.US)if(a<.9144){l="in";n*=39.37}else if(a<1609.344){l="ft";n/=.30480061}else{l="mi";n/=1609.3472}else ol.asserts.assert(!1,33);for(var p,c,u=3*Math.floor(Math.log(this.minWidth_*n)/Math.log(10));;){p=ol.control.ScaleLine.LEADING_DIGITS[(u%3+3)%3]*Math.pow(10,Math.floor(u/3));c=Math.round(p/n);if(isNaN(c)){this.element_.style.display="none";this.renderedVisible_=!1;return}if(c>=this.minWidth_)break;++u}var g=p+" "+l;if(this.renderedHTML_!=g){this.innerElement_.innerHTML=g;this.renderedHTML_=g}if(this.renderedWidth_!=c){this.innerElement_.style.width=c+"px";this.renderedWidth_=c}if(!this.renderedVisible_){this.element_.style.display="";this.renderedVisible_=!0}}else if(this.renderedVisible_){this.element_.style.display="none";this.renderedVisible_=!1}};ol.control.ScaleLine.Property_={UNITS:"units"};goog.provide("ol.control.ZoomSlider");goog.require("ol");goog.require("ol.ViewHint");goog.require("ol.control.Control");goog.require("ol.css");goog.require("ol.easing");goog.require("ol.events");goog.require("ol.events.Event");goog.require("ol.events.EventType");goog.require("ol.math");goog.require("ol.pointer.EventType");goog.require("ol.pointer.PointerEventHandler");ol.control.ZoomSlider=function(e){var t=e||{};this.currentResolution_=void 0;this.direction_=ol.control.ZoomSlider.Direction_.VERTICAL;this.dragging_;this.heightLimit_=0;this.widthLimit_=0;this.previousX_;this.previousY_;this.thumbSize_=null;this.sliderInitialized_=!1;this.duration_=void 0!==t.duration?t.duration:200;var o=void 0!==t.className?t.className:"ol-zoomslider",r=document.createElement("button");r.setAttribute("type","button");r.className=o+"-thumb "+ol.css.CLASS_UNSELECTABLE;var i=document.createElement("div");i.className=o+" "+ol.css.CLASS_UNSELECTABLE+" "+ol.css.CLASS_CONTROL;i.appendChild(r);this.dragger_=new ol.pointer.PointerEventHandler(i);ol.events.listen(this.dragger_,ol.pointer.EventType.POINTERDOWN,this.handleDraggerStart_,this);ol.events.listen(this.dragger_,ol.pointer.EventType.POINTERMOVE,this.handleDraggerDrag_,this);ol.events.listen(this.dragger_,ol.pointer.EventType.POINTERUP,this.handleDraggerEnd_,this);ol.events.listen(i,ol.events.EventType.CLICK,this.handleContainerClick_,this);ol.events.listen(r,ol.events.EventType.CLICK,ol.events.Event.stopPropagation);var n=t.render?t.render:ol.control.ZoomSlider.render;ol.control.Control.call(this,{element:i,render:n})};ol.inherits(ol.control.ZoomSlider,ol.control.Control);ol.control.ZoomSlider.prototype.disposeInternal=function(){this.dragger_.dispose();ol.control.Control.prototype.disposeInternal.call(this)};ol.control.ZoomSlider.Direction_={VERTICAL:0,HORIZONTAL:1};ol.control.ZoomSlider.prototype.setMap=function(e){ol.control.Control.prototype.setMap.call(this,e);e&&e.render()};ol.control.ZoomSlider.prototype.initSlider_=function(){var e=this.element,t=e.offsetWidth,o=e.offsetHeight,r=e.firstElementChild,i=getComputedStyle(r),n=r.offsetWidth+parseFloat(i.marginRight)+parseFloat(i.marginLeft),a=r.offsetHeight+parseFloat(i.marginTop)+parseFloat(i.marginBottom);this.thumbSize_=[n,a];if(t>o){this.direction_=ol.control.ZoomSlider.Direction_.HORIZONTAL;this.widthLimit_=t-n}else{this.direction_=ol.control.ZoomSlider.Direction_.VERTICAL;this.heightLimit_=o-a}this.sliderInitialized_=!0};ol.control.ZoomSlider.render=function(e){if(e.frameState){this.sliderInitialized_||this.initSlider_();var t=e.frameState.viewState.resolution;if(t!==this.currentResolution_){this.currentResolution_=t;this.setThumbPosition_(t)}}};ol.control.ZoomSlider.prototype.handleContainerClick_=function(e){var t=this.getMap().getView(),o=this.getRelativePosition_(e.offsetX-this.thumbSize_[0]/2,e.offsetY-this.thumbSize_[1]/2),r=this.getResolutionForPosition_(o);t.animate({resolution:t.constrainResolution(r),duration:this.duration_,easing:ol.easing.easeOut})};ol.control.ZoomSlider.prototype.handleDraggerStart_=function(e){if(!this.dragging_&&e.originalEvent.target===this.element.firstElementChild){this.getMap().getView().setHint(ol.ViewHint.INTERACTING,1);this.previousX_=e.clientX;this.previousY_=e.clientY;this.dragging_=!0}};ol.control.ZoomSlider.prototype.handleDraggerDrag_=function(e){if(this.dragging_){var t=this.element.firstElementChild,o=e.clientX-this.previousX_+parseInt(t.style.left,10),r=e.clientY-this.previousY_+parseInt(t.style.top,10),i=this.getRelativePosition_(o,r);this.currentResolution_=this.getResolutionForPosition_(i);this.getMap().getView().setResolution(this.currentResolution_);this.setThumbPosition_(this.currentResolution_);this.previousX_=e.clientX;this.previousY_=e.clientY}};ol.control.ZoomSlider.prototype.handleDraggerEnd_=function(e){if(this.dragging_){var t=this.getMap().getView();t.setHint(ol.ViewHint.INTERACTING,-1);t.animate({resolution:t.constrainResolution(this.currentResolution_),duration:this.duration_,easing:ol.easing.easeOut});this.dragging_=!1;this.previousX_=void 0;this.previousY_=void 0}};ol.control.ZoomSlider.prototype.setThumbPosition_=function(e){var t=this.getPositionForResolution_(e),o=this.element.firstElementChild;this.direction_==ol.control.ZoomSlider.Direction_.HORIZONTAL?o.style.left=this.widthLimit_*t+"px":o.style.top=this.heightLimit_*t+"px"};ol.control.ZoomSlider.prototype.getRelativePosition_=function(e,t){var o;o=this.direction_===ol.control.ZoomSlider.Direction_.HORIZONTAL?e/this.widthLimit_:t/this.heightLimit_;return ol.math.clamp(o,0,1)};ol.control.ZoomSlider.prototype.getResolutionForPosition_=function(e){return this.getMap().getView().getResolutionForValueFunction()(1-e)};ol.control.ZoomSlider.prototype.getPositionForResolution_=function(e){return 1-this.getMap().getView().getValueForResolutionFunction()(e)};goog.provide("ol.control.ZoomToExtent");goog.require("ol");goog.require("ol.events");goog.require("ol.events.EventType");goog.require("ol.control.Control");goog.require("ol.css");ol.control.ZoomToExtent=function(e){var t=e||{};this.extent=t.extent?t.extent:null;var o=void 0!==t.className?t.className:"ol-zoom-extent",r=void 0!==t.label?t.label:"E",i=void 0!==t.tipLabel?t.tipLabel:"Fit to extent",n=document.createElement("button");n.setAttribute("type","button");n.title=i;n.appendChild("string"==typeof r?document.createTextNode(r):r);ol.events.listen(n,ol.events.EventType.CLICK,this.handleClick_,this);var a=o+" "+ol.css.CLASS_UNSELECTABLE+" "+ol.css.CLASS_CONTROL,l=document.createElement("div");l.className=a;l.appendChild(n);ol.control.Control.call(this,{element:l,target:t.target})};ol.inherits(ol.control.ZoomToExtent,ol.control.Control);ol.control.ZoomToExtent.prototype.handleClick_=function(e){e.preventDefault();this.handleZoomToExtent()};ol.control.ZoomToExtent.prototype.handleZoomToExtent=function(){var e=this.getMap().getView(),t=this.extent?this.extent:e.getProjection().getExtent();e.fit(t)};goog.provide("ol.DeviceOrientation");goog.require("ol.events");goog.require("ol");goog.require("ol.Object");goog.require("ol.has");goog.require("ol.math");ol.DeviceOrientation=function(e){ol.Object.call(this);var t=e||{};this.listenerKey_=null;ol.events.listen(this,ol.Object.getChangeEventType(ol.DeviceOrientation.Property_.TRACKING),this.handleTrackingChanged_,this);this.setTracking(void 0!==t.tracking&&t.tracking)};ol.inherits(ol.DeviceOrientation,ol.Object);ol.DeviceOrientation.prototype.disposeInternal=function(){this.setTracking(!1);ol.Object.prototype.disposeInternal.call(this)};ol.DeviceOrientation.prototype.orientationChange_=function(e){var t=e;if(null!==t.alpha){var o=ol.math.toRadians(t.alpha);this.set(ol.DeviceOrientation.Property_.ALPHA,o);if("boolean"==typeof t.absolute&&t.absolute)this.set(ol.DeviceOrientation.Property_.HEADING,o);else if("number"==typeof t.webkitCompassHeading&&-1!=t.webkitCompassAccuracy){var r=ol.math.toRadians(t.webkitCompassHeading);this.set(ol.DeviceOrientation.Property_.HEADING,r)}}null!==t.beta&&this.set(ol.DeviceOrientation.Property_.BETA,ol.math.toRadians(t.beta));null!==t.gamma&&this.set(ol.DeviceOrientation.Property_.GAMMA,ol.math.toRadians(t.gamma));this.changed()};ol.DeviceOrientation.prototype.getAlpha=function(){return this.get(ol.DeviceOrientation.Property_.ALPHA)};ol.DeviceOrientation.prototype.getBeta=function(){return this.get(ol.DeviceOrientation.Property_.BETA)};ol.DeviceOrientation.prototype.getGamma=function(){return this.get(ol.DeviceOrientation.Property_.GAMMA)};ol.DeviceOrientation.prototype.getHeading=function(){return this.get(ol.DeviceOrientation.Property_.HEADING)};ol.DeviceOrientation.prototype.getTracking=function(){return this.get(ol.DeviceOrientation.Property_.TRACKING)};ol.DeviceOrientation.prototype.handleTrackingChanged_=function(){if(ol.has.DEVICE_ORIENTATION){var e=this.getTracking();if(e&&!this.listenerKey_)this.listenerKey_=ol.events.listen(window,"deviceorientation",this.orientationChange_,this);else if(!e&&null!==this.listenerKey_){ol.events.unlistenByKey(this.listenerKey_);this.listenerKey_=null}}};ol.DeviceOrientation.prototype.setTracking=function(e){this.set(ol.DeviceOrientation.Property_.TRACKING,e)};ol.DeviceOrientation.Property_={ALPHA:"alpha",BETA:"beta",GAMMA:"gamma",HEADING:"heading",TRACKING:"tracking"};goog.provide("ol.style.Image");ol.style.Image=function(e){this.opacity_=e.opacity;this.rotateWithView_=e.rotateWithView;this.rotation_=e.rotation;this.scale_=e.scale;this.snapToPixel_=e.snapToPixel};ol.style.Image.prototype.getOpacity=function(){return this.opacity_};ol.style.Image.prototype.getRotateWithView=function(){return this.rotateWithView_};ol.style.Image.prototype.getRotation=function(){return this.rotation_};ol.style.Image.prototype.getScale=function(){return this.scale_};ol.style.Image.prototype.getSnapToPixel=function(){return this.snapToPixel_};ol.style.Image.prototype.getAnchor=function(){};ol.style.Image.prototype.getImage=function(e){};ol.style.Image.prototype.getHitDetectionImage=function(e){};ol.style.Image.prototype.getImageState=function(){};ol.style.Image.prototype.getImageSize=function(){};ol.style.Image.prototype.getHitDetectionImageSize=function(){};ol.style.Image.prototype.getOrigin=function(){};ol.style.Image.prototype.getSize=function(){};ol.style.Image.prototype.setOpacity=function(e){this.opacity_=e};ol.style.Image.prototype.setRotateWithView=function(e){this.rotateWithView_=e};ol.style.Image.prototype.setRotation=function(e){this.rotation_=e};ol.style.Image.prototype.setScale=function(e){this.scale_=e};ol.style.Image.prototype.setSnapToPixel=function(e){this.snapToPixel_=e};ol.style.Image.prototype.listenImageChange=function(e,t){};ol.style.Image.prototype.load=function(){};ol.style.Image.prototype.unlistenImageChange=function(e,t){};goog.provide("ol.style.RegularShape");goog.require("ol");goog.require("ol.colorlike");goog.require("ol.dom");goog.require("ol.has");goog.require("ol.ImageState");goog.require("ol.render.canvas");goog.require("ol.style.Image");ol.style.RegularShape=function(e){this.checksums_=null;this.canvas_=null;this.hitDetectionCanvas_=null;this.fill_=void 0!==e.fill?e.fill:null;this.origin_=[0,0];this.points_=e.points;this.radius_=void 0!==e.radius?e.radius:e.radius1;this.radius2_=e.radius2;this.angle_=void 0!==e.angle?e.angle:0;this.stroke_=void 0!==e.stroke?e.stroke:null;this.anchor_=null;this.size_=null;this.imageSize_=null;this.hitDetectionImageSize_=null;this.atlasManager_=e.atlasManager;this.render_(this.atlasManager_);var t=void 0===e.snapToPixel||e.snapToPixel,o=void 0!==e.rotateWithView&&e.rotateWithView;ol.style.Image.call(this,{opacity:1,rotateWithView:o,rotation:void 0!==e.rotation?e.rotation:0,scale:1,snapToPixel:t})};ol.inherits(ol.style.RegularShape,ol.style.Image);ol.style.RegularShape.prototype.clone=function(){var e=new ol.style.RegularShape({fill:this.getFill()?this.getFill().clone():void 0,points:this.getPoints(),radius:this.getRadius(),radius2:this.getRadius2(),angle:this.getAngle(),snapToPixel:this.getSnapToPixel(),stroke:this.getStroke()?this.getStroke().clone():void 0,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),atlasManager:this.atlasManager_});e.setOpacity(this.getOpacity());e.setScale(this.getScale());return e};ol.style.RegularShape.prototype.getAnchor=function(){return this.anchor_};ol.style.RegularShape.prototype.getAngle=function(){return this.angle_};ol.style.RegularShape.prototype.getFill=function(){return this.fill_};ol.style.RegularShape.prototype.getHitDetectionImage=function(e){return this.hitDetectionCanvas_};ol.style.RegularShape.prototype.getImage=function(e){return this.canvas_};ol.style.RegularShape.prototype.getImageSize=function(){return this.imageSize_};ol.style.RegularShape.prototype.getHitDetectionImageSize=function(){return this.hitDetectionImageSize_};ol.style.RegularShape.prototype.getImageState=function(){return ol.ImageState.LOADED};ol.style.RegularShape.prototype.getOrigin=function(){return this.origin_};ol.style.RegularShape.prototype.getPoints=function(){return this.points_};ol.style.RegularShape.prototype.getRadius=function(){return this.radius_};ol.style.RegularShape.prototype.getRadius2=function(){return this.radius2_};ol.style.RegularShape.prototype.getSize=function(){return this.size_};ol.style.RegularShape.prototype.getStroke=function(){return this.stroke_};ol.style.RegularShape.prototype.listenImageChange=function(e,t){};ol.style.RegularShape.prototype.load=function(){};ol.style.RegularShape.prototype.unlistenImageChange=function(e,t){};ol.style.RegularShape.prototype.render_=function(e){var t,o,r="",i="",n=0,a=null,l=0,s=0;if(this.stroke_){null===(o=this.stroke_.getColor())&&(o=ol.render.canvas.defaultStrokeStyle);o=ol.colorlike.asColorLike(o);void 0===(s=this.stroke_.getWidth())&&(s=ol.render.canvas.defaultLineWidth);a=this.stroke_.getLineDash();l=this.stroke_.getLineDashOffset();if(!ol.has.CANVAS_LINE_DASH){a=null;l=0}void 0===(i=this.stroke_.getLineJoin())&&(i=ol.render.canvas.defaultLineJoin);void 0===(r=this.stroke_.getLineCap())&&(r=ol.render.canvas.defaultLineCap);void 0===(n=this.stroke_.getMiterLimit())&&(n=ol.render.canvas.defaultMiterLimit)}var p=2*(this.radius_+s)+1,c={strokeStyle:o,strokeWidth:s,size:p,lineCap:r,lineDash:a,lineDashOffset:l,lineJoin:i,miterLimit:n};if(void 0===e){var u=ol.dom.createCanvasContext2D(p,p);this.canvas_=u.canvas;t=p=this.canvas_.width;this.draw_(c,u,0,0);this.createHitDetectionCanvas_(c)}else{p=Math.round(p);var g,d=!this.fill_;d&&(g=this.drawHitDetectionCanvas_.bind(this,c));var h=this.getChecksum(),f=e.add(h,p,p,this.draw_.bind(this,c),g);this.canvas_=f.image;this.origin_=[f.offsetX,f.offsetY];t=f.image.width;if(d){this.hitDetectionCanvas_=f.hitImage;this.hitDetectionImageSize_=[f.hitImage.width,f.hitImage.height]}else{this.hitDetectionCanvas_=this.canvas_;this.hitDetectionImageSize_=[t,t]}}this.anchor_=[p/2,p/2];this.size_=[p,p];this.imageSize_=[t,t]};ol.style.RegularShape.prototype.draw_=function(e,t,o,r){var i,n,a;t.setTransform(1,0,0,1,0,0);t.translate(o,r);t.beginPath();var l=this.points_;if(l===1/0)t.arc(e.size/2,e.size/2,this.radius_,0,2*Math.PI,!0);else{var s=void 0!==this.radius2_?this.radius2_:this.radius_;s!==this.radius_&&(l*=2);for(i=0;i<=l;i++){n=2*i*Math.PI/l-Math.PI/2+this.angle_;a=i%2==0?this.radius_:s;t.lineTo(e.size/2+a*Math.cos(n),e.size/2+a*Math.sin(n))}}if(this.fill_){var p=this.fill_.getColor();null===p&&(p=ol.render.canvas.defaultFillStyle);t.fillStyle=ol.colorlike.asColorLike(p);t.fill()}if(this.stroke_){t.strokeStyle=e.strokeStyle;t.lineWidth=e.strokeWidth;if(e.lineDash){t.setLineDash(e.lineDash);t.lineDashOffset=e.lineDashOffset}t.lineCap=e.lineCap;t.lineJoin=e.lineJoin;t.miterLimit=e.miterLimit;t.stroke()}t.closePath()};ol.style.RegularShape.prototype.createHitDetectionCanvas_=function(e){this.hitDetectionImageSize_=[e.size,e.size];if(this.fill_)this.hitDetectionCanvas_=this.canvas_;else{var t=ol.dom.createCanvasContext2D(e.size,e.size);this.hitDetectionCanvas_=t.canvas;this.drawHitDetectionCanvas_(e,t,0,0)}};ol.style.RegularShape.prototype.drawHitDetectionCanvas_=function(e,t,o,r){t.setTransform(1,0,0,1,0,0);t.translate(o,r);t.beginPath();var i=this.points_;if(i===1/0)t.arc(e.size/2,e.size/2,this.radius_,0,2*Math.PI,!0);else{var n,a,l,s=void 0!==this.radius2_?this.radius2_:this.radius_;s!==this.radius_&&(i*=2);for(n=0;n<=i;n++){l=2*n*Math.PI/i-Math.PI/2+this.angle_;a=n%2==0?this.radius_:s;t.lineTo(e.size/2+a*Math.cos(l),e.size/2+a*Math.sin(l))}}t.fillStyle=ol.render.canvas.defaultFillStyle;t.fill();if(this.stroke_){t.strokeStyle=e.strokeStyle;t.lineWidth=e.strokeWidth;if(e.lineDash){t.setLineDash(e.lineDash);t.lineDashOffset=e.lineDashOffset}t.stroke()}t.closePath()};ol.style.RegularShape.prototype.getChecksum=function(){var e=this.stroke_?this.stroke_.getChecksum():"-",t=this.fill_?this.fill_.getChecksum():"-";if(!this.checksums_||e!=this.checksums_[1]||t!=this.checksums_[2]||this.radius_!=this.checksums_[3]||this.radius2_!=this.checksums_[4]||this.angle_!=this.checksums_[5]||this.points_!=this.checksums_[6]){var o="r"+e+t+(void 0!==this.radius_?this.radius_.toString():"-")+(void 0!==this.radius2_?this.radius2_.toString():"-")+(void 0!==this.angle_?this.angle_.toString():"-")+(void 0!==this.points_?this.points_.toString():"-");this.checksums_=[o,e,t,this.radius_,this.radius2_,this.angle_,this.points_]}return this.checksums_[0]};goog.provide("ol.style.Circle");goog.require("ol");goog.require("ol.style.RegularShape");ol.style.Circle=function(e){var t=e||{};ol.style.RegularShape.call(this,{points:1/0,fill:t.fill,radius:t.radius,snapToPixel:t.snapToPixel,stroke:t.stroke,atlasManager:t.atlasManager})};ol.inherits(ol.style.Circle,ol.style.RegularShape);ol.style.Circle.prototype.clone=function(){var e=new ol.style.Circle({fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,radius:this.getRadius(),snapToPixel:this.getSnapToPixel(),atlasManager:this.atlasManager_});e.setOpacity(this.getOpacity());e.setScale(this.getScale());return e};ol.style.Circle.prototype.setRadius=function(e){this.radius_=e;this.render_(this.atlasManager_)};goog.provide("ol.style.Fill");goog.require("ol");goog.require("ol.color");ol.style.Fill=function(e){var t=e||{};this.color_=void 0!==t.color?t.color:null;this.checksum_=void 0};ol.style.Fill.prototype.clone=function(){var e=this.getColor();return new ol.style.Fill({color:e&&e.slice?e.slice():e||void 0})};ol.style.Fill.prototype.getColor=function(){return this.color_};ol.style.Fill.prototype.setColor=function(e){this.color_=e;this.checksum_=void 0};ol.style.Fill.prototype.getChecksum=function(){void 0===this.checksum_&&(this.color_ instanceof CanvasPattern||this.color_ instanceof CanvasGradient?this.checksum_=ol.getUid(this.color_).toString():this.checksum_="f"+(this.color_?ol.color.asString(this.color_):"-"));return this.checksum_};goog.provide("ol.style.Stroke");goog.require("ol");ol.style.Stroke=function(e){var t=e||{};this.color_=void 0!==t.color?t.color:null;this.lineCap_=t.lineCap;this.lineDash_=void 0!==t.lineDash?t.lineDash:null;this.lineDashOffset_=t.lineDashOffset;this.lineJoin_=t.lineJoin;this.miterLimit_=t.miterLimit;this.width_=t.width;this.checksum_=void 0};ol.style.Stroke.prototype.clone=function(){var e=this.getColor();return new ol.style.Stroke({color:e&&e.slice?e.slice():e||void 0,lineCap:this.getLineCap(),lineDash:this.getLineDash()?this.getLineDash().slice():void 0,lineDashOffset:this.getLineDashOffset(),lineJoin:this.getLineJoin(),miterLimit:this.getMiterLimit(),width:this.getWidth()})};ol.style.Stroke.prototype.getColor=function(){return this.color_};ol.style.Stroke.prototype.getLineCap=function(){return this.lineCap_};ol.style.Stroke.prototype.getLineDash=function(){return this.lineDash_};ol.style.Stroke.prototype.getLineDashOffset=function(){return this.lineDashOffset_};ol.style.Stroke.prototype.getLineJoin=function(){return this.lineJoin_};ol.style.Stroke.prototype.getMiterLimit=function(){return this.miterLimit_};ol.style.Stroke.prototype.getWidth=function(){return this.width_};ol.style.Stroke.prototype.setColor=function(e){this.color_=e;this.checksum_=void 0};ol.style.Stroke.prototype.setLineCap=function(e){this.lineCap_=e;this.checksum_=void 0};ol.style.Stroke.prototype.setLineDash=function(e){this.lineDash_=e;this.checksum_=void 0};ol.style.Stroke.prototype.setLineDashOffset=function(e){this.lineDashOffset_=e;this.checksum_=void 0};ol.style.Stroke.prototype.setLineJoin=function(e){this.lineJoin_=e;this.checksum_=void 0};ol.style.Stroke.prototype.setMiterLimit=function(e){this.miterLimit_=e;this.checksum_=void 0};ol.style.Stroke.prototype.setWidth=function(e){this.width_=e;this.checksum_=void 0};ol.style.Stroke.prototype.getChecksum=function(){if(void 0===this.checksum_){this.checksum_="s";this.color_?"string"==typeof this.color_?this.checksum_+=this.color_:this.checksum_+=ol.getUid(this.color_).toString():this.checksum_+="-";this.checksum_+=","+(void 0!==this.lineCap_?this.lineCap_.toString():"-")+","+(this.lineDash_?this.lineDash_.toString():"-")+","+(void 0!==this.lineDashOffset_?this.lineDashOffset_:"-")+","+(void 0!==this.lineJoin_?this.lineJoin_:"-")+","+(void 0!==this.miterLimit_?this.miterLimit_.toString():"-")+","+(void 0!==this.width_?this.width_.toString():"-")}return this.checksum_};goog.provide("ol.style.Style");goog.require("ol.asserts");goog.require("ol.geom.GeometryType");goog.require("ol.style.Circle");goog.require("ol.style.Fill");goog.require("ol.style.Stroke");ol.style.Style=function(e){var t=e||{};this.geometry_=null;this.geometryFunction_=ol.style.Style.defaultGeometryFunction;void 0!==t.geometry&&this.setGeometry(t.geometry);this.fill_=void 0!==t.fill?t.fill:null;this.image_=void 0!==t.image?t.image:null;this.renderer_=void 0!==t.renderer?t.renderer:null;this.stroke_=void 0!==t.stroke?t.stroke:null;this.text_=void 0!==t.text?t.text:null;this.zIndex_=t.zIndex};ol.style.Style.prototype.clone=function(){var e=this.getGeometry();e&&e.clone&&(e=e.clone());return new ol.style.Style({geometry:e,fill:this.getFill()?this.getFill().clone():void 0,image:this.getImage()?this.getImage().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,text:this.getText()?this.getText().clone():void 0,zIndex:this.getZIndex()})};ol.style.Style.prototype.getRenderer=function(){return this.renderer_};ol.style.Style.prototype.setRenderer=function(e){this.renderer_=e};ol.style.Style.prototype.getGeometry=function(){return this.geometry_};ol.style.Style.prototype.getGeometryFunction=function(){return this.geometryFunction_};ol.style.Style.prototype.getFill=function(){return this.fill_};ol.style.Style.prototype.setFill=function(e){this.fill_=e};ol.style.Style.prototype.getImage=function(){return this.image_};ol.style.Style.prototype.setImage=function(e){this.image_=e};ol.style.Style.prototype.getStroke=function(){return this.stroke_};ol.style.Style.prototype.setStroke=function(e){this.stroke_=e};ol.style.Style.prototype.getText=function(){return this.text_};ol.style.Style.prototype.setText=function(e){this.text_=e};ol.style.Style.prototype.getZIndex=function(){return this.zIndex_};ol.style.Style.prototype.setGeometry=function(e){"function"==typeof e?this.geometryFunction_=e:"string"==typeof e?this.geometryFunction_=function(t){return t.get(e)}:e?void 0!==e&&(this.geometryFunction_=function(){return e}):this.geometryFunction_=ol.style.Style.defaultGeometryFunction;this.geometry_=e};ol.style.Style.prototype.setZIndex=function(e){this.zIndex_=e};ol.style.Style.createFunction=function(e){var t;if("function"==typeof e)t=e;else{var o;if(Array.isArray(e))o=e;else{ol.asserts.assert(e instanceof ol.style.Style,41);o=[e]}t=function(){return o}}return t};ol.style.Style.default_=null;ol.style.Style.defaultFunction=function(e,t){if(!ol.style.Style.default_){var o=new ol.style.Fill({color:"rgba(255,255,255,0.4)"}),r=new ol.style.Stroke({color:"#3399CC",width:1.25});ol.style.Style.default_=[new ol.style.Style({image:new ol.style.Circle({fill:o,stroke:r,radius:5}),fill:o,stroke:r})]}return ol.style.Style.default_};ol.style.Style.createDefaultEditing=function(){var e={},t=[255,255,255,1],o=[0,153,255,1];e[ol.geom.GeometryType.POLYGON]=[new ol.style.Style({fill:new ol.style.Fill({color:[255,255,255,.5]})})];e[ol.geom.GeometryType.MULTI_POLYGON]=e[ol.geom.GeometryType.POLYGON];e[ol.geom.GeometryType.LINE_STRING]=[new ol.style.Style({stroke:new ol.style.Stroke({color:t,width:5})}),new ol.style.Style({stroke:new ol.style.Stroke({color:o,width:3})})];e[ol.geom.GeometryType.MULTI_LINE_STRING]=e[ol.geom.GeometryType.LINE_STRING];e[ol.geom.GeometryType.CIRCLE]=e[ol.geom.GeometryType.POLYGON].concat(e[ol.geom.GeometryType.LINE_STRING]);e[ol.geom.GeometryType.POINT]=[new ol.style.Style({image:new ol.style.Circle({radius:6,fill:new ol.style.Fill({color:o}),stroke:new ol.style.Stroke({color:t,width:1.5})}),zIndex:1/0})];e[ol.geom.GeometryType.MULTI_POINT]=e[ol.geom.GeometryType.POINT];e[ol.geom.GeometryType.GEOMETRY_COLLECTION]=e[ol.geom.GeometryType.POLYGON].concat(e[ol.geom.GeometryType.LINE_STRING],e[ol.geom.GeometryType.POINT]);return e};ol.style.Style.defaultGeometryFunction=function(e){return e.getGeometry()};goog.provide("ol.Feature");goog.require("ol.asserts");goog.require("ol.events");goog.require("ol.events.EventType");goog.require("ol");goog.require("ol.Object");goog.require("ol.geom.Geometry");goog.require("ol.style.Style");ol.Feature=function(e){ol.Object.call(this);this.id_=void 0;this.geometryName_="geometry";this.style_=null;this.styleFunction_=void 0;this.geometryChangeKey_=null;ol.events.listen(this,ol.Object.getChangeEventType(this.geometryName_),this.handleGeometryChanged_,this);if(void 0!==e)if(e instanceof ol.geom.Geometry||!e){var t=e;this.setGeometry(t)}else{var o=e;this.setProperties(o)}};ol.inherits(ol.Feature,ol.Object);ol.Feature.prototype.clone=function(){var e=new ol.Feature(this.getProperties());e.setGeometryName(this.getGeometryName());var t=this.getGeometry();t&&e.setGeometry(t.clone());var o=this.getStyle();o&&e.setStyle(o);return e};ol.Feature.prototype.getGeometry=function(){return this.get(this.geometryName_)};ol.Feature.prototype.getId=function(){return this.id_};ol.Feature.prototype.getGeometryName=function(){return this.geometryName_};ol.Feature.prototype.getStyle=function(){return this.style_};ol.Feature.prototype.getStyleFunction=function(){return this.styleFunction_};ol.Feature.prototype.handleGeometryChange_=function(){this.changed()};ol.Feature.prototype.handleGeometryChanged_=function(){if(this.geometryChangeKey_){ol.events.unlistenByKey(this.geometryChangeKey_);this.geometryChangeKey_=null}var e=this.getGeometry();e&&(this.geometryChangeKey_=ol.events.listen(e,ol.events.EventType.CHANGE,this.handleGeometryChange_,this));this.changed()};ol.Feature.prototype.setGeometry=function(e){this.set(this.geometryName_,e)};ol.Feature.prototype.setStyle=function(e){this.style_=e;this.styleFunction_=e?ol.Feature.createStyleFunction(e):void 0;this.changed()};ol.Feature.prototype.setId=function(e){this.id_=e;this.changed()};ol.Feature.prototype.setGeometryName=function(e){ol.events.unlisten(this,ol.Object.getChangeEventType(this.geometryName_),this.handleGeometryChanged_,this);this.geometryName_=e;ol.events.listen(this,ol.Object.getChangeEventType(this.geometryName_),this.handleGeometryChanged_,this);this.handleGeometryChanged_()};ol.Feature.createStyleFunction=function(e){var t;if("function"==typeof e)t=2==e.length?function(t){return e(this,t)}:e;else{var o;if(Array.isArray(e))o=e;else{ol.asserts.assert(e instanceof ol.style.Style,41);o=[e]}t=function(){return o}}return t};goog.provide("ol.format.FormatType");ol.format.FormatType={ARRAY_BUFFER:"arraybuffer",JSON:"json",TEXT:"text",XML:"xml"};goog.provide("ol.xml");goog.require("ol.array");ol.xml.DOCUMENT=document.implementation.createDocument("","",null);ol.xml.createElementNS=function(e,t){return ol.xml.DOCUMENT.createElementNS(e,t)};ol.xml.getAllTextContent=function(e,t){return ol.xml.getAllTextContent_(e,t,[]).join("")};ol.xml.getAllTextContent_=function(e,t,o){if(e.nodeType==Node.CDATA_SECTION_NODE||e.nodeType==Node.TEXT_NODE)t?o.push(String(e.nodeValue).replace(/(\r\n|\r|\n)/g,"")):o.push(e.nodeValue);else{var r;for(r=e.firstChild;r;r=r.nextSibling)ol.xml.getAllTextContent_(r,t,o)}return o};ol.xml.isDocument=function(e){return e instanceof Document};ol.xml.isNode=function(e){return e instanceof Node};ol.xml.getAttributeNS=function(e,t,o){return e.getAttributeNS(t,o)||""};ol.xml.setAttributeNS=function(e,t,o,r){e.setAttributeNS(t,o,r)};ol.xml.parse=function(e){return(new DOMParser).parseFromString(e,"application/xml")};ol.xml.makeArrayExtender=function(e,t){return function(o,r){var i=e.call(t,o,r);if(void 0!==i){var n=r[r.length-1];ol.array.extend(n,i)}}};ol.xml.makeArrayPusher=function(e,t){return function(o,r){var i=e.call(void 0!==t?t:this,o,r);if(void 0!==i){r[r.length-1].push(i)}}};ol.xml.makeReplacer=function(e,t){return function(o,r){var i=e.call(void 0!==t?t:this,o,r);void 0!==i&&(r[r.length-1]=i)}};ol.xml.makeObjectPropertyPusher=function(e,t,o){return function(r,i){var n=e.call(void 0!==o?o:this,r,i);if(void 0!==n){var a=i[i.length-1],l=void 0!==t?t:r.localName;(l in a?a[l]:a[l]=[]).push(n)}}};ol.xml.makeObjectPropertySetter=function(e,t,o){return function(r,i){var n=e.call(void 0!==o?o:this,r,i);if(void 0!==n){i[i.length-1][void 0!==t?t:r.localName]=n}}};ol.xml.makeChildAppender=function(e,t){return function(o,r,i){e.call(void 0!==t?t:this,o,r,i);i[i.length-1].node.appendChild(o)}};ol.xml.makeArraySerializer=function(e,t){var o,r;return function(t,i,n){if(void 0===o){o={};var a={};a[t.localName]=e;o[t.namespaceURI]=a;r=ol.xml.makeSimpleNodeFactory(t.localName)}ol.xml.serialize(o,r,i,n)}};ol.xml.makeSimpleNodeFactory=function(e,t){var o=e;return function(e,r,i){var n=r[r.length-1].node,a=o;void 0===a&&(a=i);var l=t;void 0===t&&(l=n.namespaceURI);return ol.xml.createElementNS(l,a)}};ol.xml.OBJECT_PROPERTY_NODE_FACTORY=ol.xml.makeSimpleNodeFactory();ol.xml.makeSequence=function(e,t){for(var o=t.length,r=new Array(o),i=0;i<o;++i)r[i]=e[t[i]];return r};ol.xml.makeStructureNS=function(e,t,o){var r,i,n=void 0!==o?o:{};for(r=0,i=e.length;r<i;++r)n[e[r]]=t;return n};ol.xml.parseNode=function(e,t,o,r){var i;for(i=t.firstElementChild;i;i=i.nextElementSibling){var n=e[i.namespaceURI];if(void 0!==n){var a=n[i.localName];void 0!==a&&a.call(r,i,o)}}};ol.xml.pushParseAndPop=function(e,t,o,r,i){r.push(e);ol.xml.parseNode(t,o,r,i);return r.pop()};ol.xml.serialize=function(e,t,o,r,i,n){for(var a,l,s=(void 0!==i?i:o).length,p=0;p<s;++p)void 0!==(a=o[p])&&void 0!==(l=t.call(n,a,r,void 0!==i?i[p]:void 0))&&e[l.namespaceURI][l.localName].call(n,l,a,r)};ol.xml.pushSerializeAndPop=function(e,t,o,r,i,n,a){i.push(e);ol.xml.serialize(t,o,r,i,n,a);return i.pop()};goog.provide("ol.featureloader");goog.require("ol");goog.require("ol.format.FormatType");goog.require("ol.xml");ol.featureloader.loadFeaturesXhr=function(e,t,o,r){return function(i,n,a){var l=new XMLHttpRequest;l.open("GET","function"==typeof e?e(i,n,a):e,!0);t.getType()==ol.format.FormatType.ARRAY_BUFFER&&(l.responseType="arraybuffer");l.onload=function(e){if(!l.status||l.status>=200&&l.status<300){var i,n=t.getType();n==ol.format.FormatType.JSON||n==ol.format.FormatType.TEXT?i=l.responseText:n==ol.format.FormatType.XML?(i=l.responseXML)||(i=ol.xml.parse(l.responseText)):n==ol.format.FormatType.ARRAY_BUFFER&&(i=l.response);i?o.call(this,t.readFeatures(i,{featureProjection:a}),t.readProjection(i),t.getLastExtent()):r.call(this)}else r.call(this)}.bind(this);l.onerror=function(){r.call(this)}.bind(this);l.send()}};ol.featureloader.xhr=function(e,t){return ol.featureloader.loadFeaturesXhr(e,t,function(e,t){this.addFeatures(e)},ol.nullFunction)};goog.provide("ol.format.Feature");goog.require("ol.geom.Geometry");goog.require("ol.obj");goog.require("ol.proj");ol.format.Feature=function(){this.defaultDataProjection=null;this.defaultFeatureProjection=null};ol.format.Feature.prototype.getReadOptions=function(e,t){var o;t&&(o={dataProjection:t.dataProjection?t.dataProjection:this.readProjection(e),featureProjection:t.featureProjection});return this.adaptOptions(o)};ol.format.Feature.prototype.adaptOptions=function(e){return ol.obj.assign({dataProjection:this.defaultDataProjection,featureProjection:this.defaultFeatureProjection},e)};ol.format.Feature.prototype.getLastExtent=function(){return null};ol.format.Feature.prototype.getType=function(){};ol.format.Feature.prototype.readFeature=function(e,t){};ol.format.Feature.prototype.readFeatures=function(e,t){};ol.format.Feature.prototype.readGeometry=function(e,t){};ol.format.Feature.prototype.readProjection=function(e){};ol.format.Feature.prototype.writeFeature=function(e,t){};ol.format.Feature.prototype.writeFeatures=function(e,t){};ol.format.Feature.prototype.writeGeometry=function(e,t){};ol.format.Feature.transformWithOptions=function(e,t,o){var r,i=o?ol.proj.get(o.featureProjection):null,n=o?ol.proj.get(o.dataProjection):null;r=i&&n&&!ol.proj.equivalent(i,n)?e instanceof ol.geom.Geometry?(t?e.clone():e).transform(t?i:n,t?n:i):ol.proj.transformExtent(e,n,i):e;if(t&&o&&void 0!==o.decimals){var a=Math.pow(10,o.decimals);r===e&&(r=r.clone());r.applyTransform(function(e){for(var t=0,o=e.length;t<o;++t)e[t]=Math.round(e[t]*a)/a;return e})}return r};goog.provide("ol.format.JSONFeature");goog.require("ol");goog.require("ol.format.Feature");goog.require("ol.format.FormatType");ol.format.JSONFeature=function(){ol.format.Feature.call(this)};ol.inherits(ol.format.JSONFeature,ol.format.Feature);ol.format.JSONFeature.prototype.getObject_=function(e){if("string"==typeof e){var t=JSON.parse(e);return t||null}return null!==e?e:null};ol.format.JSONFeature.prototype.getType=function(){return ol.format.FormatType.JSON};ol.format.JSONFeature.prototype.readFeature=function(e,t){return this.readFeatureFromObject(this.getObject_(e),this.getReadOptions(e,t))};ol.format.JSONFeature.prototype.readFeatures=function(e,t){return this.readFeaturesFromObject(this.getObject_(e),this.getReadOptions(e,t))};ol.format.JSONFeature.prototype.readFeatureFromObject=function(e,t){};ol.format.JSONFeature.prototype.readFeaturesFromObject=function(e,t){};ol.format.JSONFeature.prototype.readGeometry=function(e,t){return this.readGeometryFromObject(this.getObject_(e),this.getReadOptions(e,t))};ol.format.JSONFeature.prototype.readGeometryFromObject=function(e,t){};ol.format.JSONFeature.prototype.readProjection=function(e){return this.readProjectionFromObject(this.getObject_(e))};ol.format.JSONFeature.prototype.readProjectionFromObject=function(e){};ol.format.JSONFeature.prototype.writeFeature=function(e,t){return JSON.stringify(this.writeFeatureObject(e,t))};ol.format.JSONFeature.prototype.writeFeatureObject=function(e,t){};ol.format.JSONFeature.prototype.writeFeatures=function(e,t){return JSON.stringify(this.writeFeaturesObject(e,t))};ol.format.JSONFeature.prototype.writeFeaturesObject=function(e,t){};ol.format.JSONFeature.prototype.writeGeometry=function(e,t){return JSON.stringify(this.writeGeometryObject(e,t))};ol.format.JSONFeature.prototype.writeGeometryObject=function(e,t){};goog.provide("ol.geom.flat.interpolate");goog.require("ol.array");goog.require("ol.math");ol.geom.flat.interpolate.lineString=function(e,t,o,r,i,n){var a=NaN,l=NaN,s=(o-t)/r;if(1===s){a=e[t];l=e[t+1]}else if(2==s){a=(1-i)*e[t]+i*e[t+r];l=(1-i)*e[t+1]+i*e[t+r+1]}else if(0!==s){var p,c=e[t],u=e[t+1],g=0,d=[0];for(p=t+r;p<o;p+=r){var h=e[p],f=e[p+1];g+=Math.sqrt((h-c)*(h-c)+(f-u)*(f-u));d.push(g);c=h;u=f}var y=i*g,m=ol.array.binarySearch(d,y);if(m<0){var v=(y-d[-m-2])/(d[-m-1]-d[-m-2]),C=t+(-m-2)*r;a=ol.math.lerp(e[C],e[C+r],v);l=ol.math.lerp(e[C+1],e[C+r+1],v)}else{a=e[t+m*r];l=e[t+m*r+1]}}if(n){n[0]=a;n[1]=l;return n}return[a,l]};ol.geom.flat.interpolate.lineStringCoordinateAtM=function(e,t,o,r,i,n){if(o==t)return null;var a;if(i<e[t+r-1]){if(n){(a=e.slice(t,t+r))[r-1]=i;return a}return null}if(e[o-1]<i){if(n){(a=e.slice(o-r,o))[r-1]=i;return a}return null}if(i==e[t+r-1])return e.slice(t,t+r);for(var l=t/r,s=o/r;l<s;){var p=l+s>>1;i<e[(p+1)*r-1]?s=p:l=p+1}var c=e[l*r-1];if(i==c)return e.slice((l-1)*r,(l-1)*r+r);var u,g=(i-c)/(e[(l+1)*r-1]-c);a=[];for(u=0;u<r-1;++u)a.push(ol.math.lerp(e[(l-1)*r+u],e[l*r+u],g));a.push(i);return a};ol.geom.flat.interpolate.lineStringsCoordinateAtM=function(e,t,o,r,i,n,a){if(a)return ol.geom.flat.interpolate.lineStringCoordinateAtM(e,t,o[o.length-1],r,i,n);var l,s,p;if(i<e[r-1]){if(n){(l=e.slice(0,r))[r-1]=i;return l}return null}if(e[e.length-1]<i){if(n){(l=e.slice(e.length-r))[r-1]=i;return l}return null}for(s=0,p=o.length;s<p;++s){var c=o[s];if(t!=c){if(i<e[t+r-1])return null;if(i<=e[c-1])return ol.geom.flat.interpolate.lineStringCoordinateAtM(e,t,c,r,i,!1);t=c}}return null};goog.provide("ol.geom.LineString");goog.require("ol");goog.require("ol.array");goog.require("ol.extent");goog.require("ol.geom.GeometryLayout");goog.require("ol.geom.GeometryType");goog.require("ol.geom.SimpleGeometry");goog.require("ol.geom.flat.closest");goog.require("ol.geom.flat.deflate");goog.require("ol.geom.flat.inflate");goog.require("ol.geom.flat.interpolate");goog.require("ol.geom.flat.intersectsextent");goog.require("ol.geom.flat.length");goog.require("ol.geom.flat.segments");goog.require("ol.geom.flat.simplify");ol.geom.LineString=function(e,t){ol.geom.SimpleGeometry.call(this);this.flatMidpoint_=null;this.flatMidpointRevision_=-1;this.maxDelta_=-1;this.maxDeltaRevision_=-1;this.setCoordinates(e,t)};ol.inherits(ol.geom.LineString,ol.geom.SimpleGeometry);ol.geom.LineString.prototype.appendCoordinate=function(e){this.flatCoordinates?ol.array.extend(this.flatCoordinates,e):this.flatCoordinates=e.slice();this.changed()};ol.geom.LineString.prototype.clone=function(){var e=new ol.geom.LineString(null);e.setFlatCoordinates(this.layout,this.flatCoordinates.slice());return e};ol.geom.LineString.prototype.closestPointXY=function(e,t,o,r){if(r<ol.extent.closestSquaredDistanceXY(this.getExtent(),e,t))return r;if(this.maxDeltaRevision_!=this.getRevision()){this.maxDelta_=Math.sqrt(ol.geom.flat.closest.getMaxSquaredDelta(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0));this.maxDeltaRevision_=this.getRevision()}return ol.geom.flat.closest.getClosestPoint(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!1,e,t,o,r)};ol.geom.LineString.prototype.forEachSegment=function(e,t){return ol.geom.flat.segments.forEach(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,t)};ol.geom.LineString.prototype.getCoordinateAtM=function(e,t){if(this.layout!=ol.geom.GeometryLayout.XYM&&this.layout!=ol.geom.GeometryLayout.XYZM)return null;var o=void 0!==t&&t;return ol.geom.flat.interpolate.lineStringCoordinateAtM(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,o)};ol.geom.LineString.prototype.getCoordinates=function(){return ol.geom.flat.inflate.coordinates(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)};ol.geom.LineString.prototype.getCoordinateAt=function(e,t){return ol.geom.flat.interpolate.lineString(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,t)};ol.geom.LineString.prototype.getLength=function(){return ol.geom.flat.length.lineString(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)};ol.geom.LineString.prototype.getFlatMidpoint=function(){if(this.flatMidpointRevision_!=this.getRevision()){this.flatMidpoint_=this.getCoordinateAt(.5,this.flatMidpoint_);this.flatMidpointRevision_=this.getRevision()}return this.flatMidpoint_};ol.geom.LineString.prototype.getSimplifiedGeometryInternal=function(e){var t=[];t.length=ol.geom.flat.simplify.douglasPeucker(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,t,0);var o=new ol.geom.LineString(null);o.setFlatCoordinates(ol.geom.GeometryLayout.XY,t);return o};ol.geom.LineString.prototype.getType=function(){return ol.geom.GeometryType.LINE_STRING};ol.geom.LineString.prototype.intersectsExtent=function(e){return ol.geom.flat.intersectsextent.lineString(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e)};ol.geom.LineString.prototype.setCoordinates=function(e,t){if(e){this.setLayout(t,e,1);this.flatCoordinates||(this.flatCoordinates=[]);this.flatCoordinates.length=ol.geom.flat.deflate.coordinates(this.flatCoordinates,0,e,this.stride);this.changed()}else this.setFlatCoordinates(ol.geom.GeometryLayout.XY,null)};ol.geom.LineString.prototype.setFlatCoordinates=function(e,t){this.setFlatCoordinatesInternal(e,t);this.changed()};goog.provide("ol.geom.MultiLineString");goog.require("ol");goog.require("ol.array");goog.require("ol.extent");goog.require("ol.geom.GeometryLayout");goog.require("ol.geom.GeometryType");goog.require("ol.geom.LineString");goog.require("ol.geom.SimpleGeometry");goog.require("ol.geom.flat.closest");goog.require("ol.geom.flat.deflate");goog.require("ol.geom.flat.inflate");goog.require("ol.geom.flat.interpolate");goog.require("ol.geom.flat.intersectsextent");goog.require("ol.geom.flat.simplify");ol.geom.MultiLineString=function(e,t){ol.geom.SimpleGeometry.call(this);this.ends_=[];this.maxDelta_=-1;this.maxDeltaRevision_=-1;this.setCoordinates(e,t)};ol.inherits(ol.geom.MultiLineString,ol.geom.SimpleGeometry);ol.geom.MultiLineString.prototype.appendLineString=function(e){this.flatCoordinates?ol.array.extend(this.flatCoordinates,e.getFlatCoordinates().slice()):this.flatCoordinates=e.getFlatCoordinates().slice();this.ends_.push(this.flatCoordinates.length);this.changed()};ol.geom.MultiLineString.prototype.clone=function(){var e=new ol.geom.MultiLineString(null);e.setFlatCoordinates(this.layout,this.flatCoordinates.slice(),this.ends_.slice());return e};ol.geom.MultiLineString.prototype.closestPointXY=function(e,t,o,r){if(r<ol.extent.closestSquaredDistanceXY(this.getExtent(),e,t))return r;if(this.maxDeltaRevision_!=this.getRevision()){this.maxDelta_=Math.sqrt(ol.geom.flat.closest.getsMaxSquaredDelta(this.flatCoordinates,0,this.ends_,this.stride,0));this.maxDeltaRevision_=this.getRevision()}return ol.geom.flat.closest.getsClosestPoint(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!1,e,t,o,r)};ol.geom.MultiLineString.prototype.getCoordinateAtM=function(e,t,o){if(this.layout!=ol.geom.GeometryLayout.XYM&&this.layout!=ol.geom.GeometryLayout.XYZM||0===this.flatCoordinates.length)return null;var r=void 0!==t&&t,i=void 0!==o&&o;return ol.geom.flat.interpolate.lineStringsCoordinateAtM(this.flatCoordinates,0,this.ends_,this.stride,e,r,i)};ol.geom.MultiLineString.prototype.getCoordinates=function(){return ol.geom.flat.inflate.coordinatess(this.flatCoordinates,0,this.ends_,this.stride)};ol.geom.MultiLineString.prototype.getEnds=function(){return this.ends_};ol.geom.MultiLineString.prototype.getLineString=function(e){if(e<0||this.ends_.length<=e)return null;var t=new ol.geom.LineString(null);t.setFlatCoordinates(this.layout,this.flatCoordinates.slice(0===e?0:this.ends_[e-1],this.ends_[e]));return t};ol.geom.MultiLineString.prototype.getLineStrings=function(){var e,t,o=this.flatCoordinates,r=this.ends_,i=this.layout,n=[],a=0;for(e=0,t=r.length;e<t;++e){var l=r[e],s=new ol.geom.LineString(null);s.setFlatCoordinates(i,o.slice(a,l));n.push(s);a=l}return n};ol.geom.MultiLineString.prototype.getFlatMidpoints=function(){var e,t,o=[],r=this.flatCoordinates,i=0,n=this.ends_,a=this.stride;for(e=0,t=n.length;e<t;++e){var l=n[e],s=ol.geom.flat.interpolate.lineString(r,i,l,a,.5);ol.array.extend(o,s);i=l}return o};ol.geom.MultiLineString.prototype.getSimplifiedGeometryInternal=function(e){var t=[],o=[];t.length=ol.geom.flat.simplify.douglasPeuckers(this.flatCoordinates,0,this.ends_,this.stride,e,t,0,o);var r=new ol.geom.MultiLineString(null);r.setFlatCoordinates(ol.geom.GeometryLayout.XY,t,o);return r};ol.geom.MultiLineString.prototype.getType=function(){return ol.geom.GeometryType.MULTI_LINE_STRING};ol.geom.MultiLineString.prototype.intersectsExtent=function(e){return ol.geom.flat.intersectsextent.lineStrings(this.flatCoordinates,0,this.ends_,this.stride,e)};ol.geom.MultiLineString.prototype.setCoordinates=function(e,t){if(e){this.setLayout(t,e,2);this.flatCoordinates||(this.flatCoordinates=[]);var o=ol.geom.flat.deflate.coordinatess(this.flatCoordinates,0,e,this.stride,this.ends_);this.flatCoordinates.length=0===o.length?0:o[o.length-1];this.changed()}else this.setFlatCoordinates(ol.geom.GeometryLayout.XY,null,this.ends_)};ol.geom.MultiLineString.prototype.setFlatCoordinates=function(e,t,o){this.setFlatCoordinatesInternal(e,t);this.ends_=o;this.changed()};ol.geom.MultiLineString.prototype.setLineStrings=function(e){var t,o,r=this.getLayout(),i=[],n=[];for(t=0,o=e.length;t<o;++t){var a=e[t];0===t&&(r=a.getLayout());ol.array.extend(i,a.getFlatCoordinates());n.push(i.length)}this.setFlatCoordinates(r,i,n)};goog.provide("ol.geom.MultiPoint");goog.require("ol");goog.require("ol.array");goog.require("ol.extent");goog.require("ol.geom.GeometryLayout");goog.require("ol.geom.GeometryType");goog.require("ol.geom.Point");goog.require("ol.geom.SimpleGeometry");goog.require("ol.geom.flat.deflate");goog.require("ol.geom.flat.inflate");goog.require("ol.math");ol.geom.MultiPoint=function(e,t){ol.geom.SimpleGeometry.call(this);this.setCoordinates(e,t)};ol.inherits(ol.geom.MultiPoint,ol.geom.SimpleGeometry);ol.geom.MultiPoint.prototype.appendPoint=function(e){this.flatCoordinates?ol.array.extend(this.flatCoordinates,e.getFlatCoordinates()):this.flatCoordinates=e.getFlatCoordinates().slice();this.changed()};ol.geom.MultiPoint.prototype.clone=function(){var e=new ol.geom.MultiPoint(null);e.setFlatCoordinates(this.layout,this.flatCoordinates.slice());return e};ol.geom.MultiPoint.prototype.closestPointXY=function(e,t,o,r){if(r<ol.extent.closestSquaredDistanceXY(this.getExtent(),e,t))return r;var i,n,a,l=this.flatCoordinates,s=this.stride;for(i=0,n=l.length;i<n;i+=s){var p=ol.math.squaredDistance(e,t,l[i],l[i+1]);if(p<r){r=p;for(a=0;a<s;++a)o[a]=l[i+a];o.length=s}}return r};ol.geom.MultiPoint.prototype.getCoordinates=function(){return ol.geom.flat.inflate.coordinates(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)};ol.geom.MultiPoint.prototype.getPoint=function(e){var t=this.flatCoordinates?this.flatCoordinates.length/this.stride:0;if(e<0||t<=e)return null;var o=new ol.geom.Point(null);o.setFlatCoordinates(this.layout,this.flatCoordinates.slice(e*this.stride,(e+1)*this.stride));return o};ol.geom.MultiPoint.prototype.getPoints=function(){var e,t,o=this.flatCoordinates,r=this.layout,i=this.stride,n=[];for(e=0,t=o.length;e<t;e+=i){var a=new ol.geom.Point(null);a.setFlatCoordinates(r,o.slice(e,e+i));n.push(a)}return n};ol.geom.MultiPoint.prototype.getType=function(){return ol.geom.GeometryType.MULTI_POINT};ol.geom.MultiPoint.prototype.intersectsExtent=function(e){var t,o,r,i,n=this.flatCoordinates,a=this.stride;for(t=0,o=n.length;t<o;t+=a){r=n[t];i=n[t+1];if(ol.extent.containsXY(e,r,i))return!0}return!1};ol.geom.MultiPoint.prototype.setCoordinates=function(e,t){if(e){this.setLayout(t,e,1);this.flatCoordinates||(this.flatCoordinates=[]);this.flatCoordinates.length=ol.geom.flat.deflate.coordinates(this.flatCoordinates,0,e,this.stride);this.changed()}else this.setFlatCoordinates(ol.geom.GeometryLayout.XY,null)};ol.geom.MultiPoint.prototype.setFlatCoordinates=function(e,t){this.setFlatCoordinatesInternal(e,t);this.changed()};goog.provide("ol.geom.flat.center");goog.require("ol.extent");ol.geom.flat.center.linearRingss=function(e,t,o,r){var i,n,a=[],l=ol.extent.createEmpty();for(i=0,n=o.length;i<n;++i){var s=o[i];l=ol.extent.createOrUpdateFromFlatCoordinates(e,t,s[0],r);a.push((l[0]+l[2])/2,(l[1]+l[3])/2);t=s[s.length-1]}return a};goog.provide("ol.geom.MultiPolygon");goog.require("ol");goog.require("ol.array");goog.require("ol.extent");goog.require("ol.geom.GeometryLayout");goog.require("ol.geom.GeometryType");goog.require("ol.geom.MultiPoint");goog.require("ol.geom.Polygon");goog.require("ol.geom.SimpleGeometry");goog.require("ol.geom.flat.area");goog.require("ol.geom.flat.center");goog.require("ol.geom.flat.closest");goog.require("ol.geom.flat.contains");goog.require("ol.geom.flat.deflate");goog.require("ol.geom.flat.inflate");goog.require("ol.geom.flat.interiorpoint");goog.require("ol.geom.flat.intersectsextent");goog.require("ol.geom.flat.orient");goog.require("ol.geom.flat.simplify");ol.geom.MultiPolygon=function(e,t){ol.geom.SimpleGeometry.call(this);this.endss_=[];this.flatInteriorPointsRevision_=-1;this.flatInteriorPoints_=null;this.maxDelta_=-1;this.maxDeltaRevision_=-1;this.orientedRevision_=-1;this.orientedFlatCoordinates_=null;this.setCoordinates(e,t)};ol.inherits(ol.geom.MultiPolygon,ol.geom.SimpleGeometry);ol.geom.MultiPolygon.prototype.appendPolygon=function(e){var t;if(this.flatCoordinates){var o,r,i=this.flatCoordinates.length;ol.array.extend(this.flatCoordinates,e.getFlatCoordinates());for(o=0,r=(t=e.getEnds().slice()).length;o<r;++o)t[o]+=i}else{this.flatCoordinates=e.getFlatCoordinates().slice();t=e.getEnds().slice();this.endss_.push()}this.endss_.push(t);this.changed()};ol.geom.MultiPolygon.prototype.clone=function(){for(var e=new ol.geom.MultiPolygon(null),t=this.endss_.length,o=new Array(t),r=0;r<t;++r)o[r]=this.endss_[r].slice();e.setFlatCoordinates(this.layout,this.flatCoordinates.slice(),o);return e};ol.geom.MultiPolygon.prototype.closestPointXY=function(e,t,o,r){if(r<ol.extent.closestSquaredDistanceXY(this.getExtent(),e,t))return r;if(this.maxDeltaRevision_!=this.getRevision()){this.maxDelta_=Math.sqrt(ol.geom.flat.closest.getssMaxSquaredDelta(this.flatCoordinates,0,this.endss_,this.stride,0));this.maxDeltaRevision_=this.getRevision()}return ol.geom.flat.closest.getssClosestPoint(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,this.maxDelta_,!0,e,t,o,r)};ol.geom.MultiPolygon.prototype.containsXY=function(e,t){return ol.geom.flat.contains.linearRingssContainsXY(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,e,t)};ol.geom.MultiPolygon.prototype.getArea=function(){return ol.geom.flat.area.linearRingss(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride)};ol.geom.MultiPolygon.prototype.getCoordinates=function(e){var t;if(void 0!==e){t=this.getOrientedFlatCoordinates().slice();ol.geom.flat.orient.orientLinearRingss(t,0,this.endss_,this.stride,e)}else t=this.flatCoordinates;return ol.geom.flat.inflate.coordinatesss(t,0,this.endss_,this.stride)};ol.geom.MultiPolygon.prototype.getEndss=function(){return this.endss_};ol.geom.MultiPolygon.prototype.getFlatInteriorPoints=function(){if(this.flatInteriorPointsRevision_!=this.getRevision()){var e=ol.geom.flat.center.linearRingss(this.flatCoordinates,0,this.endss_,this.stride);this.flatInteriorPoints_=ol.geom.flat.interiorpoint.linearRingss(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,e);this.flatInteriorPointsRevision_=this.getRevision()}return this.flatInteriorPoints_};ol.geom.MultiPolygon.prototype.getInteriorPoints=function(){var e=new ol.geom.MultiPoint(null);e.setFlatCoordinates(ol.geom.GeometryLayout.XYM,this.getFlatInteriorPoints().slice());return e};ol.geom.MultiPolygon.prototype.getOrientedFlatCoordinates=function(){if(this.orientedRevision_!=this.getRevision()){var e=this.flatCoordinates;if(ol.geom.flat.orient.linearRingssAreOriented(e,0,this.endss_,this.stride))this.orientedFlatCoordinates_=e;else{this.orientedFlatCoordinates_=e.slice();this.orientedFlatCoordinates_.length=ol.geom.flat.orient.orientLinearRingss(this.orientedFlatCoordinates_,0,this.endss_,this.stride)}this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_};ol.geom.MultiPolygon.prototype.getSimplifiedGeometryInternal=function(e){var t=[],o=[];t.length=ol.geom.flat.simplify.quantizess(this.flatCoordinates,0,this.endss_,this.stride,Math.sqrt(e),t,0,o);var r=new ol.geom.MultiPolygon(null);r.setFlatCoordinates(ol.geom.GeometryLayout.XY,t,o);return r};ol.geom.MultiPolygon.prototype.getPolygon=function(e){if(e<0||this.endss_.length<=e)return null;var t;if(0===e)t=0;else{var o=this.endss_[e-1];t=o[o.length-1]}var r=this.endss_[e].slice(),i=r[r.length-1];if(0!==t){var n,a;for(n=0,a=r.length;n<a;++n)r[n]-=t}var l=new ol.geom.Polygon(null);l.setFlatCoordinates(this.layout,this.flatCoordinates.slice(t,i),r);return l};ol.geom.MultiPolygon.prototype.getPolygons=function(){var e,t,o,r,i=this.layout,n=this.flatCoordinates,a=this.endss_,l=[],s=0;for(e=0,t=a.length;e<t;++e){var p=a[e].slice(),c=p[p.length-1];if(0!==s)for(o=0,r=p.length;o<r;++o)p[o]-=s;var u=new ol.geom.Polygon(null);u.setFlatCoordinates(i,n.slice(s,c),p);l.push(u);s=c}return l};ol.geom.MultiPolygon.prototype.getType=function(){return ol.geom.GeometryType.MULTI_POLYGON};ol.geom.MultiPolygon.prototype.intersectsExtent=function(e){return ol.geom.flat.intersectsextent.linearRingss(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,e)};ol.geom.MultiPolygon.prototype.setCoordinates=function(e,t){if(e){this.setLayout(t,e,3);this.flatCoordinates||(this.flatCoordinates=[]);var o=ol.geom.flat.deflate.coordinatesss(this.flatCoordinates,0,e,this.stride,this.endss_);if(0===o.length)this.flatCoordinates.length=0;else{var r=o[o.length-1];this.flatCoordinates.length=0===r.length?0:r[r.length-1]}this.changed()}else this.setFlatCoordinates(ol.geom.GeometryLayout.XY,null,this.endss_)};ol.geom.MultiPolygon.prototype.setFlatCoordinates=function(e,t,o){this.setFlatCoordinatesInternal(e,t);this.endss_=o;this.changed()};ol.geom.MultiPolygon.prototype.setPolygons=function(e){var t,o,r,i=this.getLayout(),n=[],a=[];for(t=0,o=e.length;t<o;++t){var l=e[t];0===t&&(i=l.getLayout());var s,p,c=n.length;for(s=0,p=(r=l.getEnds()).length;s<p;++s)r[s]+=c;ol.array.extend(n,l.getFlatCoordinates());a.push(r)}this.setFlatCoordinates(i,n,a)};goog.provide("ol.format.EsriJSON");goog.require("ol");goog.require("ol.Feature");goog.require("ol.asserts");goog.require("ol.extent");goog.require("ol.format.Feature");goog.require("ol.format.JSONFeature");goog.require("ol.geom.GeometryLayout");goog.require("ol.geom.GeometryType");goog.require("ol.geom.LineString");goog.require("ol.geom.LinearRing");goog.require("ol.geom.MultiLineString");goog.require("ol.geom.MultiPoint");goog.require("ol.geom.MultiPolygon");goog.require("ol.geom.Point");goog.require("ol.geom.Polygon");goog.require("ol.geom.flat.deflate");goog.require("ol.geom.flat.orient");goog.require("ol.obj");goog.require("ol.proj");ol.format.EsriJSON=function(e){var t=e||{};ol.format.JSONFeature.call(this);this.geometryName_=t.geometryName};ol.inherits(ol.format.EsriJSON,ol.format.JSONFeature);ol.format.EsriJSON.readGeometry_=function(e,t){if(!e)return null;var o;if("number"==typeof e.x&&"number"==typeof e.y)o=ol.geom.GeometryType.POINT;else if(e.points)o=ol.geom.GeometryType.MULTI_POINT;else if(e.paths)o=1===e.paths.length?ol.geom.GeometryType.LINE_STRING:ol.geom.GeometryType.MULTI_LINE_STRING;else if(e.rings){var r=ol.format.EsriJSON.getGeometryLayout_(e),i=ol.format.EsriJSON.convertRings_(e.rings,r);e=ol.obj.assign({},e);if(1===i.length){o=ol.geom.GeometryType.POLYGON;e.rings=i[0]}else{o=ol.geom.GeometryType.MULTI_POLYGON;e.rings=i}}var n=ol.format.EsriJSON.GEOMETRY_READERS_[o];return ol.format.Feature.transformWithOptions(n(e),!1,t)};ol.format.EsriJSON.convertRings_=function(e,t){var o,r,i=[],n=[],a=[];for(o=0,r=e.length;o<r;++o){i.length=0;ol.geom.flat.deflate.coordinates(i,0,e[o],t.length);ol.geom.flat.orient.linearRingIsClockwise(i,0,i.length,t.length)?n.push([e[o]]):a.push(e[o])}for(;a.length;){var l=a.shift(),s=!1;for(o=n.length-1;o>=0;o--){var p=n[o][0];if(ol.extent.containsExtent(new ol.geom.LinearRing(p).getExtent(),new ol.geom.LinearRing(l).getExtent())){n[o].push(l);s=!0;break}}s||n.push([l.reverse()])}return n};ol.format.EsriJSON.readPointGeometry_=function(e){return void 0!==e.m&&void 0!==e.z?new ol.geom.Point([e.x,e.y,e.z,e.m],ol.geom.GeometryLayout.XYZM):void 0!==e.z?new ol.geom.Point([e.x,e.y,e.z],ol.geom.GeometryLayout.XYZ):void 0!==e.m?new ol.geom.Point([e.x,e.y,e.m],ol.geom.GeometryLayout.XYM):new ol.geom.Point([e.x,e.y])};ol.format.EsriJSON.readLineStringGeometry_=function(e){var t=ol.format.EsriJSON.getGeometryLayout_(e);return new ol.geom.LineString(e.paths[0],t)};ol.format.EsriJSON.readMultiLineStringGeometry_=function(e){var t=ol.format.EsriJSON.getGeometryLayout_(e);return new ol.geom.MultiLineString(e.paths,t)};ol.format.EsriJSON.getGeometryLayout_=function(e){var t=ol.geom.GeometryLayout.XY;!0===e.hasZ&&!0===e.hasM?t=ol.geom.GeometryLayout.XYZM:!0===e.hasZ?t=ol.geom.GeometryLayout.XYZ:!0===e.hasM&&(t=ol.geom.GeometryLayout.XYM);return t};ol.format.EsriJSON.readMultiPointGeometry_=function(e){var t=ol.format.EsriJSON.getGeometryLayout_(e);return new ol.geom.MultiPoint(e.points,t)};ol.format.EsriJSON.readMultiPolygonGeometry_=function(e){var t=ol.format.EsriJSON.getGeometryLayout_(e);return new ol.geom.MultiPolygon(e.rings,t)};ol.format.EsriJSON.readPolygonGeometry_=function(e){var t=ol.format.EsriJSON.getGeometryLayout_(e);return new ol.geom.Polygon(e.rings,t)};ol.format.EsriJSON.writePointGeometry_=function(e,t){var o,r=e.getCoordinates(),i=e.getLayout();i===ol.geom.GeometryLayout.XYZ?o={x:r[0],y:r[1],z:r[2]}:i===ol.geom.GeometryLayout.XYM?o={x:r[0],y:r[1],m:r[2]}:i===ol.geom.GeometryLayout.XYZM?o={x:r[0],y:r[1],z:r[2],m:r[3]}:i===ol.geom.GeometryLayout.XY?o={x:r[0],y:r[1]}:ol.asserts.assert(!1,34);return o};ol.format.EsriJSON.getHasZM_=function(e){var t=e.getLayout();return{hasZ:t===ol.geom.GeometryLayout.XYZ||t===ol.geom.GeometryLayout.XYZM,hasM:t===ol.geom.GeometryLayout.XYM||t===ol.geom.GeometryLayout.XYZM}};ol.format.EsriJSON.writeLineStringGeometry_=function(e,t){var o=ol.format.EsriJSON.getHasZM_(e);return{hasZ:o.hasZ,hasM:o.hasM,paths:[e.getCoordinates()]}};ol.format.EsriJSON.writePolygonGeometry_=function(e,t){var o=ol.format.EsriJSON.getHasZM_(e);return{hasZ:o.hasZ,hasM:o.hasM,rings:e.getCoordinates(!1)}};ol.format.EsriJSON.writeMultiLineStringGeometry_=function(e,t){var o=ol.format.EsriJSON.getHasZM_(e);return{hasZ:o.hasZ,hasM:o.hasM,paths:e.getCoordinates()}};ol.format.EsriJSON.writeMultiPointGeometry_=function(e,t){var o=ol.format.EsriJSON.getHasZM_(e);return{hasZ:o.hasZ,hasM:o.hasM,points:e.getCoordinates()}};ol.format.EsriJSON.writeMultiPolygonGeometry_=function(e,t){for(var o=ol.format.EsriJSON.getHasZM_(e),r=e.getCoordinates(!1),i=[],n=0;n<r.length;n++)for(var a=r[n].length-1;a>=0;a--)i.push(r[n][a]);return{hasZ:o.hasZ,hasM:o.hasM,rings:i}};ol.format.EsriJSON.GEOMETRY_READERS_={};ol.format.EsriJSON.GEOMETRY_READERS_[ol.geom.GeometryType.POINT]=ol.format.EsriJSON.readPointGeometry_;ol.format.EsriJSON.GEOMETRY_READERS_[ol.geom.GeometryType.LINE_STRING]=ol.format.EsriJSON.readLineStringGeometry_;ol.format.EsriJSON.GEOMETRY_READERS_[ol.geom.GeometryType.POLYGON]=ol.format.EsriJSON.readPolygonGeometry_;ol.format.EsriJSON.GEOMETRY_READERS_[ol.geom.GeometryType.MULTI_POINT]=ol.format.EsriJSON.readMultiPointGeometry_;ol.format.EsriJSON.GEOMETRY_READERS_[ol.geom.GeometryType.MULTI_LINE_STRING]=ol.format.EsriJSON.readMultiLineStringGeometry_;ol.format.EsriJSON.GEOMETRY_READERS_[ol.geom.GeometryType.MULTI_POLYGON]=ol.format.EsriJSON.readMultiPolygonGeometry_;ol.format.EsriJSON.GEOMETRY_WRITERS_={};ol.format.EsriJSON.GEOMETRY_WRITERS_[ol.geom.GeometryType.POINT]=ol.format.EsriJSON.writePointGeometry_;ol.format.EsriJSON.GEOMETRY_WRITERS_[ol.geom.GeometryType.LINE_STRING]=ol.format.EsriJSON.writeLineStringGeometry_;ol.format.EsriJSON.GEOMETRY_WRITERS_[ol.geom.GeometryType.POLYGON]=ol.format.EsriJSON.writePolygonGeometry_;ol.format.EsriJSON.GEOMETRY_WRITERS_[ol.geom.GeometryType.MULTI_POINT]=ol.format.EsriJSON.writeMultiPointGeometry_;ol.format.EsriJSON.GEOMETRY_WRITERS_[ol.geom.GeometryType.MULTI_LINE_STRING]=ol.format.EsriJSON.writeMultiLineStringGeometry_;ol.format.EsriJSON.GEOMETRY_WRITERS_[ol.geom.GeometryType.MULTI_POLYGON]=ol.format.EsriJSON.writeMultiPolygonGeometry_;ol.format.EsriJSON.prototype.readFeature;ol.format.EsriJSON.prototype.readFeatures;ol.format.EsriJSON.prototype.readFeatureFromObject=function(e,t){var o=e,r=ol.format.EsriJSON.readGeometry_(o.geometry,t),i=new ol.Feature;this.geometryName_&&i.setGeometryName(this.geometryName_);i.setGeometry(r);t&&t.idField&&o.attributes[t.idField]&&i.setId(o.attributes[t.idField]);o.attributes&&i.setProperties(o.attributes);return i};ol.format.EsriJSON.prototype.readFeaturesFromObject=function(e,t){var o=t||{};if(e.features){var r,i,n=[],a=e.features;o.idField=e.objectIdFieldName;for(r=0,i=a.length;r<i;++r)n.push(this.readFeatureFromObject(a[r],o));return n}return[this.readFeatureFromObject(e,o)]};ol.format.EsriJSON.prototype.readGeometry;ol.format.EsriJSON.prototype.readGeometryFromObject=function(e,t){return ol.format.EsriJSON.readGeometry_(e,t)};ol.format.EsriJSON.prototype.readProjection;ol.format.EsriJSON.prototype.readProjectionFromObject=function(e){var t=e;if(t.spatialReference&&t.spatialReference.wkid){var o=t.spatialReference.wkid;return ol.proj.get("EPSG:"+o)}return null};ol.format.EsriJSON.writeGeometry_=function(e,t){return(0,ol.format.EsriJSON.GEOMETRY_WRITERS_[e.getType()])(ol.format.Feature.transformWithOptions(e,!0,t),t)};ol.format.EsriJSON.prototype.writeGeometry;ol.format.EsriJSON.prototype.writeGeometryObject=function(e,t){return ol.format.EsriJSON.writeGeometry_(e,this.adaptOptions(t))};ol.format.EsriJSON.prototype.writeFeature;ol.format.EsriJSON.prototype.writeFeatureObject=function(e,t){t=this.adaptOptions(t);var o={},r=e.getGeometry();if(r){o.geometry=ol.format.EsriJSON.writeGeometry_(r,t);t&&t.featureProjection&&(o.geometry.spatialReference={wkid:ol.proj.get(t.featureProjection).getCode().split(":").pop()})}var i=e.getProperties();delete i[e.getGeometryName()];ol.obj.isEmpty(i)?o.attributes={}:o.attributes=i;return o};ol.format.EsriJSON.prototype.writeFeatures;ol.format.EsriJSON.prototype.writeFeaturesObject=function(e,t){t=this.adaptOptions(t);var o,r,i=[];for(o=0,r=e.length;o<r;++o)i.push(this.writeFeatureObject(e[o],t));return{features:i}};goog.provide("ol.format.filter.Filter");ol.format.filter.Filter=function(e){this.tagName_=e};ol.format.filter.Filter.prototype.getTagName=function(){return this.tagName_};goog.provide("ol.format.filter.LogicalNary");goog.require("ol");goog.require("ol.asserts");goog.require("ol.format.filter.Filter");ol.format.filter.LogicalNary=function(e,t){ol.format.filter.Filter.call(this,e);this.conditions=Array.prototype.slice.call(arguments,1);ol.asserts.assert(this.conditions.length>=2,57)};ol.inherits(ol.format.filter.LogicalNary,ol.format.filter.Filter);goog.provide("ol.format.filter.And");goog.require("ol");goog.require("ol.format.filter.LogicalNary");ol.format.filter.And=function(e){var t=["And"].concat(Array.prototype.slice.call(arguments));ol.format.filter.LogicalNary.apply(this,t)};ol.inherits(ol.format.filter.And,ol.format.filter.LogicalNary);goog.provide("ol.format.filter.Bbox");goog.require("ol");goog.require("ol.format.filter.Filter");ol.format.filter.Bbox=function(e,t,o){ol.format.filter.Filter.call(this,"BBOX");this.geometryName=e;this.extent=t;this.srsName=o};ol.inherits(ol.format.filter.Bbox,ol.format.filter.Filter);goog.provide("ol.format.filter.Spatial");goog.require("ol");goog.require("ol.format.filter.Filter");ol.format.filter.Spatial=function(e,t,o,r){ol.format.filter.Filter.call(this,e);this.geometryName=t||"the_geom";this.geometry=o;this.srsName=r};ol.inherits(ol.format.filter.Spatial,ol.format.filter.Filter);goog.provide("ol.format.filter.Contains");goog.require("ol");goog.require("ol.format.filter.Spatial");ol.format.filter.Contains=function(e,t,o){ol.format.filter.Spatial.call(this,"Contains",e,t,o)};ol.inherits(ol.format.filter.Contains,ol.format.filter.Spatial);goog.provide("ol.format.filter.Comparison");goog.require("ol");goog.require("ol.format.filter.Filter");ol.format.filter.Comparison=function(e,t){ol.format.filter.Filter.call(this,e);this.propertyName=t};ol.inherits(ol.format.filter.Comparison,ol.format.filter.Filter);goog.provide("ol.format.filter.During");goog.require("ol");goog.require("ol.format.filter.Comparison");ol.format.filter.During=function(e,t,o){ol.format.filter.Comparison.call(this,"During",e);this.begin=t;this.end=o};ol.inherits(ol.format.filter.During,ol.format.filter.Comparison);goog.provide("ol.format.filter.ComparisonBinary");goog.require("ol");goog.require("ol.format.filter.Comparison");ol.format.filter.ComparisonBinary=function(e,t,o,r){ol.format.filter.Comparison.call(this,e,t);this.expression=o;this.matchCase=r};ol.inherits(ol.format.filter.ComparisonBinary,ol.format.filter.Comparison);goog.provide("ol.format.filter.EqualTo");goog.require("ol");goog.require("ol.format.filter.ComparisonBinary");ol.format.filter.EqualTo=function(e,t,o){ol.format.filter.ComparisonBinary.call(this,"PropertyIsEqualTo",e,t,o)};ol.inherits(ol.format.filter.EqualTo,ol.format.filter.ComparisonBinary);goog.provide("ol.format.filter.GreaterThan");goog.require("ol");goog.require("ol.format.filter.ComparisonBinary");ol.format.filter.GreaterThan=function(e,t){ol.format.filter.ComparisonBinary.call(this,"PropertyIsGreaterThan",e,t)};ol.inherits(ol.format.filter.GreaterThan,ol.format.filter.ComparisonBinary);goog.provide("ol.format.filter.GreaterThanOrEqualTo");goog.require("ol");goog.require("ol.format.filter.ComparisonBinary");ol.format.filter.GreaterThanOrEqualTo=function(e,t){ol.format.filter.ComparisonBinary.call(this,"PropertyIsGreaterThanOrEqualTo",e,t)};ol.inherits(ol.format.filter.GreaterThanOrEqualTo,ol.format.filter.ComparisonBinary);goog.provide("ol.format.filter.Intersects");goog.require("ol");goog.require("ol.format.filter.Spatial");ol.format.filter.Intersects=function(e,t,o){ol.format.filter.Spatial.call(this,"Intersects",e,t,o)};ol.inherits(ol.format.filter.Intersects,ol.format.filter.Spatial);goog.provide("ol.format.filter.IsBetween");goog.require("ol");goog.require("ol.format.filter.Comparison");ol.format.filter.IsBetween=function(e,t,o){ol.format.filter.Comparison.call(this,"PropertyIsBetween",e);this.lowerBoundary=t;this.upperBoundary=o};ol.inherits(ol.format.filter.IsBetween,ol.format.filter.Comparison);goog.provide("ol.format.filter.IsLike");goog.require("ol");goog.require("ol.format.filter.Comparison");ol.format.filter.IsLike=function(e,t,o,r,i,n){ol.format.filter.Comparison.call(this,"PropertyIsLike",e);this.pattern=t;this.wildCard=void 0!==o?o:"*";this.singleChar=void 0!==r?r:".";this.escapeChar=void 0!==i?i:"!";this.matchCase=n};ol.inherits(ol.format.filter.IsLike,ol.format.filter.Comparison);goog.provide("ol.format.filter.IsNull");goog.require("ol");goog.require("ol.format.filter.Comparison");ol.format.filter.IsNull=function(e){ol.format.filter.Comparison.call(this,"PropertyIsNull",e)};ol.inherits(ol.format.filter.IsNull,ol.format.filter.Comparison);goog.provide("ol.format.filter.LessThan");goog.require("ol");goog.require("ol.format.filter.ComparisonBinary");ol.format.filter.LessThan=function(e,t){ol.format.filter.ComparisonBinary.call(this,"PropertyIsLessThan",e,t)};ol.inherits(ol.format.filter.LessThan,ol.format.filter.ComparisonBinary);goog.provide("ol.format.filter.LessThanOrEqualTo");goog.require("ol");goog.require("ol.format.filter.ComparisonBinary");ol.format.filter.LessThanOrEqualTo=function(e,t){ol.format.filter.ComparisonBinary.call(this,"PropertyIsLessThanOrEqualTo",e,t)};ol.inherits(ol.format.filter.LessThanOrEqualTo,ol.format.filter.ComparisonBinary);goog.provide("ol.format.filter.Not");goog.require("ol");goog.require("ol.format.filter.Filter");ol.format.filter.Not=function(e){ol.format.filter.Filter.call(this,"Not");this.condition=e};ol.inherits(ol.format.filter.Not,ol.format.filter.Filter);goog.provide("ol.format.filter.NotEqualTo");goog.require("ol");goog.require("ol.format.filter.ComparisonBinary");ol.format.filter.NotEqualTo=function(e,t,o){ol.format.filter.ComparisonBinary.call(this,"PropertyIsNotEqualTo",e,t,o)};ol.inherits(ol.format.filter.NotEqualTo,ol.format.filter.ComparisonBinary);goog.provide("ol.format.filter.Or");goog.require("ol");goog.require("ol.format.filter.LogicalNary");ol.format.filter.Or=function(e){var t=["Or"].concat(Array.prototype.slice.call(arguments));ol.format.filter.LogicalNary.apply(this,t)};ol.inherits(ol.format.filter.Or,ol.format.filter.LogicalNary);goog.provide("ol.format.filter.Within");goog.require("ol");goog.require("ol.format.filter.Spatial");ol.format.filter.Within=function(e,t,o){ol.format.filter.Spatial.call(this,"Within",e,t,o)};ol.inherits(ol.format.filter.Within,ol.format.filter.Spatial);goog.provide("ol.format.filter");goog.require("ol.format.filter.And");goog.require("ol.format.filter.Bbox");goog.require("ol.format.filter.Contains");goog.require("ol.format.filter.During");goog.require("ol.format.filter.EqualTo");goog.require("ol.format.filter.GreaterThan");goog.require("ol.format.filter.GreaterThanOrEqualTo");goog.require("ol.format.filter.Intersects");goog.require("ol.format.filter.IsBetween");goog.require("ol.format.filter.IsLike");goog.require("ol.format.filter.IsNull");goog.require("ol.format.filter.LessThan");goog.require("ol.format.filter.LessThanOrEqualTo");goog.require("ol.format.filter.Not");goog.require("ol.format.filter.NotEqualTo");goog.require("ol.format.filter.Or");goog.require("ol.format.filter.Within");ol.format.filter.and=function(e){var t=[null].concat(Array.prototype.slice.call(arguments));return new(Function.prototype.bind.apply(ol.format.filter.And,t))};ol.format.filter.or=function(e){var t=[null].concat(Array.prototype.slice.call(arguments));return new(Function.prototype.bind.apply(ol.format.filter.Or,t))};ol.format.filter.not=function(e){return new ol.format.filter.Not(e)};ol.format.filter.bbox=function(e,t,o){return new ol.format.filter.Bbox(e,t,o)};ol.format.filter.contains=function(e,t,o){return new ol.format.filter.Contains(e,t,o)};ol.format.filter.intersects=function(e,t,o){return new ol.format.filter.Intersects(e,t,o)};ol.format.filter.within=function(e,t,o){return new ol.format.filter.Within(e,t,o)};ol.format.filter.equalTo=function(e,t,o){return new ol.format.filter.EqualTo(e,t,o)};ol.format.filter.notEqualTo=function(e,t,o){return new ol.format.filter.NotEqualTo(e,t,o)};ol.format.filter.lessThan=function(e,t){return new ol.format.filter.LessThan(e,t)};ol.format.filter.lessThanOrEqualTo=function(e,t){return new ol.format.filter.LessThanOrEqualTo(e,t)};ol.format.filter.greaterThan=function(e,t){return new ol.format.filter.GreaterThan(e,t)};ol.format.filter.greaterThanOrEqualTo=function(e,t){return new ol.format.filter.GreaterThanOrEqualTo(e,t)};ol.format.filter.isNull=function(e){return new ol.format.filter.IsNull(e)};ol.format.filter.between=function(e,t,o){return new ol.format.filter.IsBetween(e,t,o)};ol.format.filter.like=function(e,t,o,r,i,n){return new ol.format.filter.IsLike(e,t,o,r,i,n)};ol.format.filter.during=function(e,t,o){return new ol.format.filter.During(e,t,o)};goog.provide("ol.geom.GeometryCollection");goog.require("ol");goog.require("ol.events");goog.require("ol.events.EventType");goog.require("ol.extent");goog.require("ol.geom.Geometry");goog.require("ol.geom.GeometryType");goog.require("ol.obj");ol.geom.GeometryCollection=function(e){ol.geom.Geometry.call(this);this.geometries_=e||null;this.listenGeometriesChange_()};ol.inherits(ol.geom.GeometryCollection,ol.geom.Geometry);ol.geom.GeometryCollection.cloneGeometries_=function(e){var t,o,r=[];for(t=0,o=e.length;t<o;++t)r.push(e[t].clone());return r};ol.geom.GeometryCollection.prototype.unlistenGeometriesChange_=function(){var e,t;if(this.geometries_)for(e=0,t=this.geometries_.length;e<t;++e)ol.events.unlisten(this.geometries_[e],ol.events.EventType.CHANGE,this.changed,this)};ol.geom.GeometryCollection.prototype.listenGeometriesChange_=function(){var e,t;if(this.geometries_)for(e=0,t=this.geometries_.length;e<t;++e)ol.events.listen(this.geometries_[e],ol.events.EventType.CHANGE,this.changed,this)};ol.geom.GeometryCollection.prototype.clone=function(){var e=new ol.geom.GeometryCollection(null);e.setGeometries(this.geometries_);return e};ol.geom.GeometryCollection.prototype.closestPointXY=function(e,t,o,r){if(r<ol.extent.closestSquaredDistanceXY(this.getExtent(),e,t))return r;var i,n,a=this.geometries_;for(i=0,n=a.length;i<n;++i)r=a[i].closestPointXY(e,t,o,r);return r};ol.geom.GeometryCollection.prototype.containsXY=function(e,t){var o,r,i=this.geometries_;for(o=0,r=i.length;o<r;++o)if(i[o].containsXY(e,t))return!0;return!1};ol.geom.GeometryCollection.prototype.computeExtent=function(e){ol.extent.createOrUpdateEmpty(e);for(var t=this.geometries_,o=0,r=t.length;o<r;++o)ol.extent.extend(e,t[o].getExtent());return e};ol.geom.GeometryCollection.prototype.getGeometries=function(){return ol.geom.GeometryCollection.cloneGeometries_(this.geometries_)};ol.geom.GeometryCollection.prototype.getGeometriesArray=function(){return this.geometries_};ol.geom.GeometryCollection.prototype.getSimplifiedGeometry=function(e){if(this.simplifiedGeometryRevision!=this.getRevision()){ol.obj.clear(this.simplifiedGeometryCache);this.simplifiedGeometryMaxMinSquaredTolerance=0;this.simplifiedGeometryRevision=this.getRevision()}if(e<0||0!==this.simplifiedGeometryMaxMinSquaredTolerance&&e<this.simplifiedGeometryMaxMinSquaredTolerance)return this;var t=e.toString();if(this.simplifiedGeometryCache.hasOwnProperty(t))return this.simplifiedGeometryCache[t];var o,r,i=[],n=this.geometries_,a=!1;for(o=0,r=n.length;o<r;++o){var l=n[o],s=l.getSimplifiedGeometry(e);i.push(s);s!==l&&(a=!0)}if(a){var p=new ol.geom.GeometryCollection(null);p.setGeometriesArray(i);this.simplifiedGeometryCache[t]=p;return p}this.simplifiedGeometryMaxMinSquaredTolerance=e;return this};ol.geom.GeometryCollection.prototype.getType=function(){return ol.geom.GeometryType.GEOMETRY_COLLECTION};ol.geom.GeometryCollection.prototype.intersectsExtent=function(e){var t,o,r=this.geometries_;for(t=0,o=r.length;t<o;++t)if(r[t].intersectsExtent(e))return!0;return!1};ol.geom.GeometryCollection.prototype.isEmpty=function(){return 0===this.geometries_.length};ol.geom.GeometryCollection.prototype.rotate=function(e,t){for(var o=this.geometries_,r=0,i=o.length;r<i;++r)o[r].rotate(e,t);this.changed()};ol.geom.GeometryCollection.prototype.scale=function(e,t,o){var r=o;r||(r=ol.extent.getCenter(this.getExtent()));for(var i=this.geometries_,n=0,a=i.length;n<a;++n)i[n].scale(e,t,r);this.changed()};ol.geom.GeometryCollection.prototype.setGeometries=function(e){this.setGeometriesArray(ol.geom.GeometryCollection.cloneGeometries_(e))};ol.geom.GeometryCollection.prototype.setGeometriesArray=function(e){this.unlistenGeometriesChange_();this.geometries_=e;this.listenGeometriesChange_();this.changed()};ol.geom.GeometryCollection.prototype.applyTransform=function(e){var t,o,r=this.geometries_;for(t=0,o=r.length;t<o;++t)r[t].applyTransform(e);this.changed()};ol.geom.GeometryCollection.prototype.translate=function(e,t){var o,r,i=this.geometries_;for(o=0,r=i.length;o<r;++o)i[o].translate(e,t);this.changed()};ol.geom.GeometryCollection.prototype.disposeInternal=function(){this.unlistenGeometriesChange_();ol.geom.Geometry.prototype.disposeInternal.call(this)};goog.provide("ol.format.GeoJSON");goog.require("ol");goog.require("ol.asserts");goog.require("ol.Feature");goog.require("ol.format.Feature");goog.require("ol.format.JSONFeature");goog.require("ol.geom.GeometryCollection");goog.require("ol.geom.LineString");goog.require("ol.geom.MultiLineString");goog.require("ol.geom.MultiPoint");goog.require("ol.geom.MultiPolygon");goog.require("ol.geom.Point");goog.require("ol.geom.Polygon");goog.require("ol.obj");goog.require("ol.proj");ol.format.GeoJSON=function(e){var t=e||{};ol.format.JSONFeature.call(this);this.defaultDataProjection=ol.proj.get(t.defaultDataProjection?t.defaultDataProjection:"EPSG:4326");t.featureProjection&&(this.defaultFeatureProjection=ol.proj.get(t.featureProjection));this.geometryName_=t.geometryName;this.extractGeometryName_=t.extractGeometryName};ol.inherits(ol.format.GeoJSON,ol.format.JSONFeature);ol.format.GeoJSON.readGeometry_=function(e,t){if(!e)return null;var o=ol.format.GeoJSON.GEOMETRY_READERS_[e.type];return ol.format.Feature.transformWithOptions(o(e),!1,t)};ol.format.GeoJSON.readGeometryCollectionGeometry_=function(e,t){var o=e.geometries.map(function(e){return ol.format.GeoJSON.readGeometry_(e,t)});return new ol.geom.GeometryCollection(o)};ol.format.GeoJSON.readPointGeometry_=function(e){return new ol.geom.Point(e.coordinates)};ol.format.GeoJSON.readLineStringGeometry_=function(e){return new ol.geom.LineString(e.coordinates)};ol.format.GeoJSON.readMultiLineStringGeometry_=function(e){return new ol.geom.MultiLineString(e.coordinates)};ol.format.GeoJSON.readMultiPointGeometry_=function(e){return new ol.geom.MultiPoint(e.coordinates)};ol.format.GeoJSON.readMultiPolygonGeometry_=function(e){return new ol.geom.MultiPolygon(e.coordinates)};ol.format.GeoJSON.readPolygonGeometry_=function(e){return new ol.geom.Polygon(e.coordinates)};ol.format.GeoJSON.writeGeometry_=function(e,t){return(0,ol.format.GeoJSON.GEOMETRY_WRITERS_[e.getType()])(ol.format.Feature.transformWithOptions(e,!0,t),t)};ol.format.GeoJSON.writeEmptyGeometryCollectionGeometry_=function(e){return{type:"GeometryCollection",geometries:[]}};ol.format.GeoJSON.writeGeometryCollectionGeometry_=function(e,t){return{type:"GeometryCollection",geometries:e.getGeometriesArray().map(function(e){var o=ol.obj.assign({},t);delete o.featureProjection;return ol.format.GeoJSON.writeGeometry_(e,o)})}};ol.format.GeoJSON.writeLineStringGeometry_=function(e,t){return{type:"LineString",coordinates:e.getCoordinates()}};ol.format.GeoJSON.writeMultiLineStringGeometry_=function(e,t){return{type:"MultiLineString",coordinates:e.getCoordinates()}};ol.format.GeoJSON.writeMultiPointGeometry_=function(e,t){return{type:"MultiPoint",coordinates:e.getCoordinates()}};ol.format.GeoJSON.writeMultiPolygonGeometry_=function(e,t){var o;t&&(o=t.rightHanded);return{type:"MultiPolygon",coordinates:e.getCoordinates(o)}};ol.format.GeoJSON.writePointGeometry_=function(e,t){return{type:"Point",coordinates:e.getCoordinates()}};ol.format.GeoJSON.writePolygonGeometry_=function(e,t){var o;t&&(o=t.rightHanded);return{type:"Polygon",coordinates:e.getCoordinates(o)}};ol.format.GeoJSON.GEOMETRY_READERS_={Point:ol.format.GeoJSON.readPointGeometry_,LineString:ol.format.GeoJSON.readLineStringGeometry_,Polygon:ol.format.GeoJSON.readPolygonGeometry_,MultiPoint:ol.format.GeoJSON.readMultiPointGeometry_,MultiLineString:ol.format.GeoJSON.readMultiLineStringGeometry_,MultiPolygon:ol.format.GeoJSON.readMultiPolygonGeometry_,GeometryCollection:ol.format.GeoJSON.readGeometryCollectionGeometry_};ol.format.GeoJSON.GEOMETRY_WRITERS_={Point:ol.format.GeoJSON.writePointGeometry_,LineString:ol.format.GeoJSON.writeLineStringGeometry_,Polygon:ol.format.GeoJSON.writePolygonGeometry_,MultiPoint:ol.format.GeoJSON.writeMultiPointGeometry_,MultiLineString:ol.format.GeoJSON.writeMultiLineStringGeometry_,MultiPolygon:ol.format.GeoJSON.writeMultiPolygonGeometry_,GeometryCollection:ol.format.GeoJSON.writeGeometryCollectionGeometry_,Circle:ol.format.GeoJSON.writeEmptyGeometryCollectionGeometry_};ol.format.GeoJSON.prototype.readFeature;ol.format.GeoJSON.prototype.readFeatures;ol.format.GeoJSON.prototype.readFeatureFromObject=function(e,t){var o=null;o="Feature"===e.type?e:{type:"Feature",geometry:e};var r=ol.format.GeoJSON.readGeometry_(o.geometry,t),i=new ol.Feature;this.geometryName_?i.setGeometryName(this.geometryName_):this.extractGeometryName_&&void 0!==o.geometry_name&&i.setGeometryName(o.geometry_name);i.setGeometry(r);void 0!==o.id&&i.setId(o.id);o.properties&&i.setProperties(o.properties);return i};ol.format.GeoJSON.prototype.readFeaturesFromObject=function(e,t){var o=null;if("FeatureCollection"===e.type){o=[];var r,i,n=e.features;for(r=0,i=n.length;r<i;++r)o.push(this.readFeatureFromObject(n[r],t))}else o=[this.readFeatureFromObject(e,t)];return o};ol.format.GeoJSON.prototype.readGeometry;ol.format.GeoJSON.prototype.readGeometryFromObject=function(e,t){return ol.format.GeoJSON.readGeometry_(e,t)};ol.format.GeoJSON.prototype.readProjection;ol.format.GeoJSON.prototype.readProjectionFromObject=function(e){var t,o=e.crs;o?"name"==o.type?t=ol.proj.get(o.properties.name):ol.asserts.assert(!1,36):t=this.defaultDataProjection;return t};ol.format.GeoJSON.prototype.writeFeature;ol.format.GeoJSON.prototype.writeFeatureObject=function(e,t){t=this.adaptOptions(t);var o={type:"Feature"},r=e.getId();void 0!==r&&(o.id=r);var i=e.getGeometry();o.geometry=i?ol.format.GeoJSON.writeGeometry_(i,t):null;var n=e.getProperties();delete n[e.getGeometryName()];ol.obj.isEmpty(n)?o.properties=null:o.properties=n;return o};ol.format.GeoJSON.prototype.writeFeatures;ol.format.GeoJSON.prototype.writeFeaturesObject=function(e,t){t=this.adaptOptions(t);var o,r,i=[];for(o=0,r=e.length;o<r;++o)i.push(this.writeFeatureObject(e[o],t));return{type:"FeatureCollection",features:i}};ol.format.GeoJSON.prototype.writeGeometry;ol.format.GeoJSON.prototype.writeGeometryObject=function(e,t){return ol.format.GeoJSON.writeGeometry_(e,this.adaptOptions(t))};goog.provide("ol.format.XMLFeature");goog.require("ol");goog.require("ol.array");goog.require("ol.format.Feature");goog.require("ol.format.FormatType");goog.require("ol.xml");ol.format.XMLFeature=function(){this.xmlSerializer_=new XMLSerializer;ol.format.Feature.call(this)};ol.inherits(ol.format.XMLFeature,ol.format.Feature);ol.format.XMLFeature.prototype.getType=function(){return ol.format.FormatType.XML};ol.format.XMLFeature.prototype.readFeature=function(e,t){if(ol.xml.isDocument(e))return this.readFeatureFromDocument(e,t);if(ol.xml.isNode(e))return this.readFeatureFromNode(e,t);if("string"==typeof e){var o=ol.xml.parse(e);return this.readFeatureFromDocument(o,t)}return null};ol.format.XMLFeature.prototype.readFeatureFromDocument=function(e,t){var o=this.readFeaturesFromDocument(e,t);return o.length>0?o[0]:null};ol.format.XMLFeature.prototype.readFeatureFromNode=function(e,t){return null};ol.format.XMLFeature.prototype.readFeatures=function(e,t){if(ol.xml.isDocument(e))return this.readFeaturesFromDocument(e,t);if(ol.xml.isNode(e))return this.readFeaturesFromNode(e,t);if("string"==typeof e){var o=ol.xml.parse(e);return this.readFeaturesFromDocument(o,t)}return[]};ol.format.XMLFeature.prototype.readFeaturesFromDocument=function(e,t){var o,r=[];for(o=e.firstChild;o;o=o.nextSibling)o.nodeType==Node.ELEMENT_NODE&&ol.array.extend(r,this.readFeaturesFromNode(o,t));return r};ol.format.XMLFeature.prototype.readFeaturesFromNode=function(e,t){};ol.format.XMLFeature.prototype.readGeometry=function(e,t){if(ol.xml.isDocument(e))return this.readGeometryFromDocument(e,t);if(ol.xml.isNode(e))return this.readGeometryFromNode(e,t);if("string"==typeof e){var o=ol.xml.parse(e);return this.readGeometryFromDocument(o,t)}return null};ol.format.XMLFeature.prototype.readGeometryFromDocument=function(e,t){return null};ol.format.XMLFeature.prototype.readGeometryFromNode=function(e,t){return null};ol.format.XMLFeature.prototype.readProjection=function(e){if(ol.xml.isDocument(e))return this.readProjectionFromDocument(e);if(ol.xml.isNode(e))return this.readProjectionFromNode(e);if("string"==typeof e){var t=ol.xml.parse(e);return this.readProjectionFromDocument(t)}return null};ol.format.XMLFeature.prototype.readProjectionFromDocument=function(e){return this.defaultDataProjection};ol.format.XMLFeature.prototype.readProjectionFromNode=function(e){return this.defaultDataProjection};ol.format.XMLFeature.prototype.writeFeature=function(e,t){var o=this.writeFeatureNode(e,t);return this.xmlSerializer_.serializeToString(o)};ol.format.XMLFeature.prototype.writeFeatureNode=function(e,t){return null};ol.format.XMLFeature.prototype.writeFeatures=function(e,t){var o=this.writeFeaturesNode(e,t);return this.xmlSerializer_.serializeToString(o)};ol.format.XMLFeature.prototype.writeFeaturesNode=function(e,t){return null};ol.format.XMLFeature.prototype.writeGeometry=function(e,t){var o=this.writeGeometryNode(e,t);return this.xmlSerializer_.serializeToString(o)};ol.format.XMLFeature.prototype.writeGeometryNode=function(e,t){return null};goog.provide("ol.format.GMLBase");goog.require("ol");goog.require("ol.array");goog.require("ol.Feature");goog.require("ol.format.Feature");goog.require("ol.format.XMLFeature");goog.require("ol.geom.GeometryLayout");goog.require("ol.geom.LineString");goog.require("ol.geom.LinearRing");goog.require("ol.geom.MultiLineString");goog.require("ol.geom.MultiPoint");goog.require("ol.geom.MultiPolygon");goog.require("ol.geom.Point");goog.require("ol.geom.Polygon");goog.require("ol.obj");goog.require("ol.proj");goog.require("ol.xml");ol.format.GMLBase=function(e){var t=e||{};this.featureType=t.featureType;this.featureNS=t.featureNS;this.srsName=t.srsName;this.schemaLocation="";this.FEATURE_COLLECTION_PARSERS={};this.FEATURE_COLLECTION_PARSERS[ol.format.GMLBase.GMLNS]={featureMember:ol.xml.makeReplacer(ol.format.GMLBase.prototype.readFeaturesInternal),featureMembers:ol.xml.makeReplacer(ol.format.GMLBase.prototype.readFeaturesInternal)};ol.format.XMLFeature.call(this)};ol.inherits(ol.format.GMLBase,ol.format.XMLFeature);ol.format.GMLBase.GMLNS="http://www.opengis.net/gml";ol.format.GMLBase.ONLY_WHITESPACE_RE_=/^[\s\xa0]*$/;ol.format.GMLBase.prototype.readFeaturesInternal=function(e,t){var o=e.localName,r=null;if("FeatureCollection"==o)r="http://www.opengis.net/wfs"===e.namespaceURI?ol.xml.pushParseAndPop([],this.FEATURE_COLLECTION_PARSERS,e,t,this):ol.xml.pushParseAndPop(null,this.FEATURE_COLLECTION_PARSERS,e,t,this);else if("featureMembers"==o||"featureMember"==o){var i,n,a=t[0],l=a.featureType,s=a.featureNS;if(!l&&e.childNodes){l=[],s={};for(i=0,n=e.childNodes.length;i<n;++i){var p=e.childNodes[i];if(1===p.nodeType){var c=p.nodeName.split(":").pop();if(-1===l.indexOf(c)){var u="",g=0,d=p.namespaceURI;for(var h in s){if(s[h]===d){u=h;break}++g}u||(s[u="p"+g]=d);l.push(u+":"+c)}}}if("featureMember"!=o){a.featureType=l;a.featureNS=s}}if("string"==typeof s){var f=s;(s={}).p0=f}var y={},m=Array.isArray(l)?l:[l];for(var v in s){var C={};for(i=0,n=m.length;i<n;++i){(-1===m[i].indexOf(":")?"p0":m[i].split(":")[0])===v&&(C[m[i].split(":").pop()]="featureMembers"==o?ol.xml.makeArrayPusher(this.readFeatureElement,this):ol.xml.makeReplacer(this.readFeatureElement,this))}y[s[v]]=C}r="featureMember"==o?ol.xml.pushParseAndPop(void 0,y,e,t):ol.xml.pushParseAndPop([],y,e,t)}null===r&&(r=[]);return r};ol.format.GMLBase.prototype.readGeometryElement=function(e,t){var o=t[0];o.srsName=e.firstElementChild.getAttribute("srsName");o.srsDimension=e.firstElementChild.getAttribute("srsDimension");var r=ol.xml.pushParseAndPop(null,this.GEOMETRY_PARSERS_,e,t,this);return r?ol.format.Feature.transformWithOptions(r,!1,o):void 0};ol.format.GMLBase.prototype.readFeatureElement=function(e,t){var o,r,i=e.getAttribute("fid")||ol.xml.getAttributeNS(e,ol.format.GMLBase.GMLNS,"id"),n={};for(o=e.firstElementChild;o;o=o.nextElementSibling){var a=o.localName;if(0===o.childNodes.length||1===o.childNodes.length&&(3===o.firstChild.nodeType||4===o.firstChild.nodeType)){var l=ol.xml.getAllTextContent(o,!1);ol.format.GMLBase.ONLY_WHITESPACE_RE_.test(l)&&(l=void 0);n[a]=l}else{"boundedBy"!==a&&(r=a);n[a]=this.readGeometryElement(o,t)}}var s=new ol.Feature(n);r&&s.setGeometryName(r);i&&s.setId(i);return s};ol.format.GMLBase.prototype.readPoint=function(e,t){var o=this.readFlatCoordinatesFromNode_(e,t);if(o){var r=new ol.geom.Point(null);r.setFlatCoordinates(ol.geom.GeometryLayout.XYZ,o);return r}};ol.format.GMLBase.prototype.readMultiPoint=function(e,t){var o=ol.xml.pushParseAndPop([],this.MULTIPOINT_PARSERS_,e,t,this);return o?new ol.geom.MultiPoint(o):void 0};ol.format.GMLBase.prototype.readMultiLineString=function(e,t){var o=ol.xml.pushParseAndPop([],this.MULTILINESTRING_PARSERS_,e,t,this);if(o){var r=new ol.geom.MultiLineString(null);r.setLineStrings(o);return r}};ol.format.GMLBase.prototype.readMultiPolygon=function(e,t){var o=ol.xml.pushParseAndPop([],this.MULTIPOLYGON_PARSERS_,e,t,this);if(o){var r=new ol.geom.MultiPolygon(null);r.setPolygons(o);return r}};ol.format.GMLBase.prototype.pointMemberParser_=function(e,t){ol.xml.parseNode(this.POINTMEMBER_PARSERS_,e,t,this)};ol.format.GMLBase.prototype.lineStringMemberParser_=function(e,t){ol.xml.parseNode(this.LINESTRINGMEMBER_PARSERS_,e,t,this)};ol.format.GMLBase.prototype.polygonMemberParser_=function(e,t){ol.xml.parseNode(this.POLYGONMEMBER_PARSERS_,e,t,this)};ol.format.GMLBase.prototype.readLineString=function(e,t){var o=this.readFlatCoordinatesFromNode_(e,t);if(o){var r=new ol.geom.LineString(null);r.setFlatCoordinates(ol.geom.GeometryLayout.XYZ,o);return r}};ol.format.GMLBase.prototype.readFlatLinearRing_=function(e,t){var o=ol.xml.pushParseAndPop(null,this.GEOMETRY_FLAT_COORDINATES_PARSERS_,e,t,this);return o||void 0};ol.format.GMLBase.prototype.readLinearRing=function(e,t){var o=this.readFlatCoordinatesFromNode_(e,t);if(o){var r=new ol.geom.LinearRing(null);r.setFlatCoordinates(ol.geom.GeometryLayout.XYZ,o);return r}};ol.format.GMLBase.prototype.readPolygon=function(e,t){var o=ol.xml.pushParseAndPop([null],this.FLAT_LINEAR_RINGS_PARSERS_,e,t,this);if(o&&o[0]){var r,i,n=new ol.geom.Polygon(null),a=o[0],l=[a.length];for(r=1,i=o.length;r<i;++r){ol.array.extend(a,o[r]);l.push(a.length)}n.setFlatCoordinates(ol.geom.GeometryLayout.XYZ,a,l);return n}};ol.format.GMLBase.prototype.readFlatCoordinatesFromNode_=function(e,t){return ol.xml.pushParseAndPop(null,this.GEOMETRY_FLAT_COORDINATES_PARSERS_,e,t,this)};ol.format.GMLBase.prototype.MULTIPOINT_PARSERS_={"http://www.opengis.net/gml":{pointMember:ol.xml.makeArrayPusher(ol.format.GMLBase.prototype.pointMemberParser_),pointMembers:ol.xml.makeArrayPusher(ol.format.GMLBase.prototype.pointMemberParser_)}};ol.format.GMLBase.prototype.MULTILINESTRING_PARSERS_={"http://www.opengis.net/gml":{lineStringMember:ol.xml.makeArrayPusher(ol.format.GMLBase.prototype.lineStringMemberParser_),lineStringMembers:ol.xml.makeArrayPusher(ol.format.GMLBase.prototype.lineStringMemberParser_)}};ol.format.GMLBase.prototype.MULTIPOLYGON_PARSERS_={"http://www.opengis.net/gml":{polygonMember:ol.xml.makeArrayPusher(ol.format.GMLBase.prototype.polygonMemberParser_),polygonMembers:ol.xml.makeArrayPusher(ol.format.GMLBase.prototype.polygonMemberParser_)}};ol.format.GMLBase.prototype.POINTMEMBER_PARSERS_={"http://www.opengis.net/gml":{Point:ol.xml.makeArrayPusher(ol.format.GMLBase.prototype.readFlatCoordinatesFromNode_)}};ol.format.GMLBase.prototype.LINESTRINGMEMBER_PARSERS_={"http://www.opengis.net/gml":{LineString:ol.xml.makeArrayPusher(ol.format.GMLBase.prototype.readLineString)}};ol.format.GMLBase.prototype.POLYGONMEMBER_PARSERS_={"http://www.opengis.net/gml":{Polygon:ol.xml.makeArrayPusher(ol.format.GMLBase.prototype.readPolygon)}};ol.format.GMLBase.prototype.RING_PARSERS={"http://www.opengis.net/gml":{LinearRing:ol.xml.makeReplacer(ol.format.GMLBase.prototype.readFlatLinearRing_)}};ol.format.GMLBase.prototype.readGeometryFromNode=function(e,t){var o=this.readGeometryElement(e,[this.getReadOptions(e,t||{})]);return o||null};ol.format.GMLBase.prototype.readFeatures;ol.format.GMLBase.prototype.readFeaturesFromNode=function(e,t){var o={featureType:this.featureType,featureNS:this.featureNS};t&&ol.obj.assign(o,this.getReadOptions(e,t));return this.readFeaturesInternal(e,[o])||[]};ol.format.GMLBase.prototype.readProjectionFromNode=function(e){return ol.proj.get(this.srsName?this.srsName:e.firstElementChild.getAttribute("srsName"))};goog.provide("ol.format.XSD");goog.require("ol.xml");goog.require("ol.string");ol.format.XSD.NAMESPACE_URI="http://www.w3.org/2001/XMLSchema";ol.format.XSD.readBoolean=function(e){var t=ol.xml.getAllTextContent(e,!1);return ol.format.XSD.readBooleanString(t)};ol.format.XSD.readBooleanString=function(e){var t=/^\s*(true|1)|(false|0)\s*$/.exec(e);return t?void 0!==t[1]||!1:void 0};ol.format.XSD.readDateTime=function(e){var t=ol.xml.getAllTextContent(e,!1),o=Date.parse(t);return isNaN(o)?void 0:o/1e3};ol.format.XSD.readDecimal=function(e){var t=ol.xml.getAllTextContent(e,!1);return ol.format.XSD.readDecimalString(t)};ol.format.XSD.readDecimalString=function(e){var t=/^\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)\s*$/i.exec(e);return t?parseFloat(t[1]):void 0};ol.format.XSD.readNonNegativeInteger=function(e){var t=ol.xml.getAllTextContent(e,!1);return ol.format.XSD.readNonNegativeIntegerString(t)};ol.format.XSD.readNonNegativeIntegerString=function(e){var t=/^\s*(\d+)\s*$/.exec(e);return t?parseInt(t[1],10):void 0};ol.format.XSD.readString=function(e){return ol.xml.getAllTextContent(e,!1).trim()};ol.format.XSD.writeBooleanTextNode=function(e,t){ol.format.XSD.writeStringTextNode(e,t?"1":"0")};ol.format.XSD.writeCDATASection=function(e,t){e.appendChild(ol.xml.DOCUMENT.createCDATASection(t))};ol.format.XSD.writeDateTimeTextNode=function(e,t){var o=new Date(1e3*t),r=o.getUTCFullYear()+"-"+ol.string.padNumber(o.getUTCMonth()+1,2)+"-"+ol.string.padNumber(o.getUTCDate(),2)+"T"+ol.string.padNumber(o.getUTCHours(),2)+":"+ol.string.padNumber(o.getUTCMinutes(),2)+":"+ol.string.padNumber(o.getUTCSeconds(),2)+"Z";e.appendChild(ol.xml.DOCUMENT.createTextNode(r))};ol.format.XSD.writeDecimalTextNode=function(e,t){var o=t.toPrecision();e.appendChild(ol.xml.DOCUMENT.createTextNode(o))};ol.format.XSD.writeNonNegativeIntegerTextNode=function(e,t){var o=t.toString();e.appendChild(ol.xml.DOCUMENT.createTextNode(o))};ol.format.XSD.writeStringTextNode=function(e,t){e.appendChild(ol.xml.DOCUMENT.createTextNode(t))};goog.provide("ol.format.GML3");goog.require("ol");goog.require("ol.array");goog.require("ol.extent");goog.require("ol.format.Feature");goog.require("ol.format.GMLBase");goog.require("ol.format.XSD");goog.require("ol.geom.Geometry");goog.require("ol.geom.GeometryLayout");goog.require("ol.geom.LineString");goog.require("ol.geom.MultiLineString");goog.require("ol.geom.MultiPolygon");goog.require("ol.geom.Polygon");goog.require("ol.obj");goog.require("ol.proj");goog.require("ol.xml");ol.format.GML3=function(e){var t=e||{};ol.format.GMLBase.call(this,t);this.surface_=void 0!==t.surface&&t.surface;this.curve_=void 0!==t.curve&&t.curve;this.multiCurve_=void 0===t.multiCurve||t.multiCurve;this.multiSurface_=void 0===t.multiSurface||t.multiSurface;this.schemaLocation=t.schemaLocation?t.schemaLocation:ol.format.GML3.schemaLocation_;this.hasZ=void 0!==t.hasZ&&t.hasZ};ol.inherits(ol.format.GML3,ol.format.GMLBase);ol.format.GML3.schemaLocation_=ol.format.GMLBase.GMLNS+" http://schemas.opengis.net/gml/3.1.1/profiles/gmlsfProfile/1.0.0/gmlsf.xsd";ol.format.GML3.prototype.readMultiCurve_=function(e,t){var o=ol.xml.pushParseAndPop([],this.MULTICURVE_PARSERS_,e,t,this);if(o){var r=new ol.geom.MultiLineString(null);r.setLineStrings(o);return r}};ol.format.GML3.prototype.readMultiSurface_=function(e,t){var o=ol.xml.pushParseAndPop([],this.MULTISURFACE_PARSERS_,e,t,this);if(o){var r=new ol.geom.MultiPolygon(null);r.setPolygons(o);return r}};ol.format.GML3.prototype.curveMemberParser_=function(e,t){ol.xml.parseNode(this.CURVEMEMBER_PARSERS_,e,t,this)};ol.format.GML3.prototype.surfaceMemberParser_=function(e,t){ol.xml.parseNode(this.SURFACEMEMBER_PARSERS_,e,t,this)};ol.format.GML3.prototype.readPatch_=function(e,t){return ol.xml.pushParseAndPop([null],this.PATCHES_PARSERS_,e,t,this)};ol.format.GML3.prototype.readSegment_=function(e,t){return ol.xml.pushParseAndPop([null],this.SEGMENTS_PARSERS_,e,t,this)};ol.format.GML3.prototype.readPolygonPatch_=function(e,t){return ol.xml.pushParseAndPop([null],this.FLAT_LINEAR_RINGS_PARSERS_,e,t,this)};ol.format.GML3.prototype.readLineStringSegment_=function(e,t){return ol.xml.pushParseAndPop([null],this.GEOMETRY_FLAT_COORDINATES_PARSERS_,e,t,this)};ol.format.GML3.prototype.interiorParser_=function(e,t){var o=ol.xml.pushParseAndPop(void 0,this.RING_PARSERS,e,t,this);if(o){t[t.length-1].push(o)}};ol.format.GML3.prototype.exteriorParser_=function(e,t){var o=ol.xml.pushParseAndPop(void 0,this.RING_PARSERS,e,t,this);if(o){t[t.length-1][0]=o}};ol.format.GML3.prototype.readSurface_=function(e,t){var o=ol.xml.pushParseAndPop([null],this.SURFACE_PARSERS_,e,t,this);if(o&&o[0]){var r,i,n=new ol.geom.Polygon(null),a=o[0],l=[a.length];for(r=1,i=o.length;r<i;++r){ol.array.extend(a,o[r]);l.push(a.length)}n.setFlatCoordinates(ol.geom.GeometryLayout.XYZ,a,l);return n}};ol.format.GML3.prototype.readCurve_=function(e,t){var o=ol.xml.pushParseAndPop([null],this.CURVE_PARSERS_,e,t,this);if(o){var r=new ol.geom.LineString(null);r.setFlatCoordinates(ol.geom.GeometryLayout.XYZ,o);return r}};ol.format.GML3.prototype.readEnvelope_=function(e,t){var o=ol.xml.pushParseAndPop([null],this.ENVELOPE_PARSERS_,e,t,this);return ol.extent.createOrUpdate(o[1][0],o[1][1],o[2][0],o[2][1])};ol.format.GML3.prototype.readFlatPos_=function(e,t){for(var o,r=ol.xml.getAllTextContent(e,!1),i=/^\s*([+\-]?\d*\.?\d+(?:[eE][+\-]?\d+)?)\s*/,n=[];o=i.exec(r);){n.push(parseFloat(o[1]));r=r.substr(o[0].length)}if(""===r){var a=t[0].srsName,l="enu";if(a){l=ol.proj.get(a).getAxisOrientation()}if("neu"===l){var s,p;for(s=0,p=n.length;s<p;s+=3){var c=n[s],u=n[s+1];n[s]=u;n[s+1]=c}}var g=n.length;2==g&&n.push(0);if(0!==g)return n}};ol.format.GML3.prototype.readFlatPosList_=function(e,t){var o=ol.xml.getAllTextContent(e,!1).replace(/^\s*|\s*$/g,""),r=t[0],i=r.srsName,n=r.srsDimension,a="enu";if(i){a=ol.proj.get(i).getAxisOrientation()}var l,s,p,c=o.split(/\s+/),u=2;e.getAttribute("srsDimension")?u=ol.format.XSD.readNonNegativeIntegerString(e.getAttribute("srsDimension")):e.getAttribute("dimension")?u=ol.format.XSD.readNonNegativeIntegerString(e.getAttribute("dimension")):e.parentNode.getAttribute("srsDimension")?u=ol.format.XSD.readNonNegativeIntegerString(e.parentNode.getAttribute("srsDimension")):n&&(u=ol.format.XSD.readNonNegativeIntegerString(n));for(var g=[],d=0,h=c.length;d<h;d+=u){l=parseFloat(c[d]);s=parseFloat(c[d+1]);p=3===u?parseFloat(c[d+2]):0;"en"===a.substr(0,2)?g.push(l,s,p):g.push(s,l,p)}return g};ol.format.GML3.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS_={"http://www.opengis.net/gml":{pos:ol.xml.makeReplacer(ol.format.GML3.prototype.readFlatPos_),posList:ol.xml.makeReplacer(ol.format.GML3.prototype.readFlatPosList_)}};ol.format.GML3.prototype.FLAT_LINEAR_RINGS_PARSERS_={"http://www.opengis.net/gml":{interior:ol.format.GML3.prototype.interiorParser_,exterior:ol.format.GML3.prototype.exteriorParser_}};ol.format.GML3.prototype.GEOMETRY_PARSERS_={"http://www.opengis.net/gml":{Point:ol.xml.makeReplacer(ol.format.GMLBase.prototype.readPoint),MultiPoint:ol.xml.makeReplacer(ol.format.GMLBase.prototype.readMultiPoint),LineString:ol.xml.makeReplacer(ol.format.GMLBase.prototype.readLineString),MultiLineString:ol.xml.makeReplacer(ol.format.GMLBase.prototype.readMultiLineString),LinearRing:ol.xml.makeReplacer(ol.format.GMLBase.prototype.readLinearRing),Polygon:ol.xml.makeReplacer(ol.format.GMLBase.prototype.readPolygon),MultiPolygon:ol.xml.makeReplacer(ol.format.GMLBase.prototype.readMultiPolygon),Surface:ol.xml.makeReplacer(ol.format.GML3.prototype.readSurface_),MultiSurface:ol.xml.makeReplacer(ol.format.GML3.prototype.readMultiSurface_),Curve:ol.xml.makeReplacer(ol.format.GML3.prototype.readCurve_),MultiCurve:ol.xml.makeReplacer(ol.format.GML3.prototype.readMultiCurve_),Envelope:ol.xml.makeReplacer(ol.format.GML3.prototype.readEnvelope_)}};ol.format.GML3.prototype.MULTICURVE_PARSERS_={"http://www.opengis.net/gml":{curveMember:ol.xml.makeArrayPusher(ol.format.GML3.prototype.curveMemberParser_),curveMembers:ol.xml.makeArrayPusher(ol.format.GML3.prototype.curveMemberParser_)}};ol.format.GML3.prototype.MULTISURFACE_PARSERS_={"http://www.opengis.net/gml":{surfaceMember:ol.xml.makeArrayPusher(ol.format.GML3.prototype.surfaceMemberParser_),surfaceMembers:ol.xml.makeArrayPusher(ol.format.GML3.prototype.surfaceMemberParser_)}};ol.format.GML3.prototype.CURVEMEMBER_PARSERS_={"http://www.opengis.net/gml":{LineString:ol.xml.makeArrayPusher(ol.format.GMLBase.prototype.readLineString),Curve:ol.xml.makeArrayPusher(ol.format.GML3.prototype.readCurve_)}};ol.format.GML3.prototype.SURFACEMEMBER_PARSERS_={"http://www.opengis.net/gml":{Polygon:ol.xml.makeArrayPusher(ol.format.GMLBase.prototype.readPolygon),Surface:ol.xml.makeArrayPusher(ol.format.GML3.prototype.readSurface_)}};ol.format.GML3.prototype.SURFACE_PARSERS_={"http://www.opengis.net/gml":{patches:ol.xml.makeReplacer(ol.format.GML3.prototype.readPatch_)}};ol.format.GML3.prototype.CURVE_PARSERS_={"http://www.opengis.net/gml":{segments:ol.xml.makeReplacer(ol.format.GML3.prototype.readSegment_)}};ol.format.GML3.prototype.ENVELOPE_PARSERS_={"http://www.opengis.net/gml":{lowerCorner:ol.xml.makeArrayPusher(ol.format.GML3.prototype.readFlatPosList_),upperCorner:ol.xml.makeArrayPusher(ol.format.GML3.prototype.readFlatPosList_)}};ol.format.GML3.prototype.PATCHES_PARSERS_={"http://www.opengis.net/gml":{PolygonPatch:ol.xml.makeReplacer(ol.format.GML3.prototype.readPolygonPatch_)}};ol.format.GML3.prototype.SEGMENTS_PARSERS_={"http://www.opengis.net/gml":{LineStringSegment:ol.xml.makeReplacer(ol.format.GML3.prototype.readLineStringSegment_)}};ol.format.GML3.prototype.writePos_=function(e,t,o){var r=o[o.length-1],i=r.hasZ,n=i?3:2;e.setAttribute("srsDimension",n);var a=r.srsName,l="enu";a&&(l=ol.proj.get(a).getAxisOrientation());var s,p=t.getCoordinates();s="en"===l.substr(0,2)?p[0]+" "+p[1]:p[1]+" "+p[0];if(i){s+=" "+(p[2]||0)}ol.format.XSD.writeStringTextNode(e,s)};ol.format.GML3.prototype.getCoords_=function(e,t,o){var r="enu";t&&(r=ol.proj.get(t).getAxisOrientation());var i="en"===r.substr(0,2)?e[0]+" "+e[1]:e[1]+" "+e[0];if(o){i+=" "+(e[2]||0)}return i};ol.format.GML3.prototype.writePosList_=function(e,t,o){var r=o[o.length-1],i=r.hasZ,n=i?3:2;e.setAttribute("srsDimension",n);for(var a,l=r.srsName,s=t.getCoordinates(),p=s.length,c=new Array(p),u=0;u<p;++u){a=s[u];c[u]=this.getCoords_(a,l,i)}ol.format.XSD.writeStringTextNode(e,c.join(" "))};ol.format.GML3.prototype.writePoint_=function(e,t,o){var r=o[o.length-1].srsName;r&&e.setAttribute("srsName",r);var i=ol.xml.createElementNS(e.namespaceURI,"pos");e.appendChild(i);this.writePos_(i,t,o)};ol.format.GML3.ENVELOPE_SERIALIZERS_={"http://www.opengis.net/gml":{lowerCorner:ol.xml.makeChildAppender(ol.format.XSD.writeStringTextNode),upperCorner:ol.xml.makeChildAppender(ol.format.XSD.writeStringTextNode)}};ol.format.GML3.prototype.writeEnvelope=function(e,t,o){var r=o[o.length-1].srsName;r&&e.setAttribute("srsName",r);var i=[t[0]+" "+t[1],t[2]+" "+t[3]];ol.xml.pushSerializeAndPop({node:e},ol.format.GML3.ENVELOPE_SERIALIZERS_,ol.xml.OBJECT_PROPERTY_NODE_FACTORY,i,o,["lowerCorner","upperCorner"],this)};ol.format.GML3.prototype.writeLinearRing_=function(e,t,o){var r=o[o.length-1].srsName;r&&e.setAttribute("srsName",r);var i=ol.xml.createElementNS(e.namespaceURI,"posList");e.appendChild(i);this.writePosList_(i,t,o)};ol.format.GML3.prototype.RING_NODE_FACTORY_=function(e,t,o){var r=t[t.length-1],i=r.node,n=r.exteriorWritten;void 0===n&&(r.exteriorWritten=!0);return ol.xml.createElementNS(i.namespaceURI,void 0!==n?"interior":"exterior")};ol.format.GML3.prototype.writeSurfaceOrPolygon_=function(e,t,o){var r=o[o.length-1],i=r.hasZ,n=r.srsName;"PolygonPatch"!==e.nodeName&&n&&e.setAttribute("srsName",n);if("Polygon"===e.nodeName||"PolygonPatch"===e.nodeName){var a=t.getLinearRings();ol.xml.pushSerializeAndPop({node:e,hasZ:i,srsName:n},ol.format.GML3.RING_SERIALIZERS_,this.RING_NODE_FACTORY_,a,o,void 0,this)}else if("Surface"===e.nodeName){var l=ol.xml.createElementNS(e.namespaceURI,"patches");e.appendChild(l);this.writeSurfacePatches_(l,t,o)}};ol.format.GML3.prototype.writeCurveOrLineString_=function(e,t,o){var r=o[o.length-1].srsName;"LineStringSegment"!==e.nodeName&&r&&e.setAttribute("srsName",r);if("LineString"===e.nodeName||"LineStringSegment"===e.nodeName){var i=ol.xml.createElementNS(e.namespaceURI,"posList");e.appendChild(i);this.writePosList_(i,t,o)}else if("Curve"===e.nodeName){var n=ol.xml.createElementNS(e.namespaceURI,"segments");e.appendChild(n);this.writeCurveSegments_(n,t,o)}};ol.format.GML3.prototype.writeMultiSurfaceOrPolygon_=function(e,t,o){var r=o[o.length-1],i=r.hasZ,n=r.srsName,a=r.surface;n&&e.setAttribute("srsName",n);var l=t.getPolygons();ol.xml.pushSerializeAndPop({node:e,hasZ:i,srsName:n,surface:a},ol.format.GML3.SURFACEORPOLYGONMEMBER_SERIALIZERS_,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,l,o,void 0,this)};ol.format.GML3.prototype.writeMultiPoint_=function(e,t,o){var r=o[o.length-1],i=r.srsName,n=r.hasZ;i&&e.setAttribute("srsName",i);var a=t.getPoints();ol.xml.pushSerializeAndPop({node:e,hasZ:n,srsName:i},ol.format.GML3.POINTMEMBER_SERIALIZERS_,ol.xml.makeSimpleNodeFactory("pointMember"),a,o,void 0,this)};ol.format.GML3.prototype.writeMultiCurveOrLineString_=function(e,t,o){var r=o[o.length-1],i=r.hasZ,n=r.srsName,a=r.curve;n&&e.setAttribute("srsName",n);var l=t.getLineStrings();ol.xml.pushSerializeAndPop({node:e,hasZ:i,srsName:n,curve:a},ol.format.GML3.LINESTRINGORCURVEMEMBER_SERIALIZERS_,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,l,o,void 0,this)};ol.format.GML3.prototype.writeRing_=function(e,t,o){var r=ol.xml.createElementNS(e.namespaceURI,"LinearRing");e.appendChild(r);this.writeLinearRing_(r,t,o)};ol.format.GML3.prototype.writeSurfaceOrPolygonMember_=function(e,t,o){var r=this.GEOMETRY_NODE_FACTORY_(t,o);if(r){e.appendChild(r);this.writeSurfaceOrPolygon_(r,t,o)}};ol.format.GML3.prototype.writePointMember_=function(e,t,o){var r=ol.xml.createElementNS(e.namespaceURI,"Point");e.appendChild(r);this.writePoint_(r,t,o)};ol.format.GML3.prototype.writeLineStringOrCurveMember_=function(e,t,o){var r=this.GEOMETRY_NODE_FACTORY_(t,o);if(r){e.appendChild(r);this.writeCurveOrLineString_(r,t,o)}};ol.format.GML3.prototype.writeSurfacePatches_=function(e,t,o){var r=ol.xml.createElementNS(e.namespaceURI,"PolygonPatch");e.appendChild(r);this.writeSurfaceOrPolygon_(r,t,o)};ol.format.GML3.prototype.writeCurveSegments_=function(e,t,o){var r=ol.xml.createElementNS(e.namespaceURI,"LineStringSegment");e.appendChild(r);this.writeCurveOrLineString_(r,t,o)};ol.format.GML3.prototype.writeGeometryElement=function(e,t,o){var r,i=o[o.length-1],n=ol.obj.assign({},i);n.node=e;r=Array.isArray(t)?i.dataProjection?ol.proj.transformExtent(t,i.featureProjection,i.dataProjection):t:ol.format.Feature.transformWithOptions(t,!0,i);ol.xml.pushSerializeAndPop(n,ol.format.GML3.GEOMETRY_SERIALIZERS_,this.GEOMETRY_NODE_FACTORY_,[r],o,void 0,this)};ol.format.GML3.prototype.writeFeatureElement=function(e,t,o){var r=t.getId();r&&e.setAttribute("fid",r);var i=o[o.length-1],n=i.featureNS,a=t.getGeometryName();if(!i.serializers){i.serializers={};i.serializers[n]={}}var l=t.getProperties(),s=[],p=[];for(var c in l){var u=l[c];if(null!==u){s.push(c);p.push(u);c==a||u instanceof ol.geom.Geometry?c in i.serializers[n]||(i.serializers[n][c]=ol.xml.makeChildAppender(this.writeGeometryElement,this)):c in i.serializers[n]||(i.serializers[n][c]=ol.xml.makeChildAppender(ol.format.XSD.writeStringTextNode))}}var g=ol.obj.assign({},i);g.node=e;ol.xml.pushSerializeAndPop(g,i.serializers,ol.xml.makeSimpleNodeFactory(void 0,n),p,o,s)};ol.format.GML3.prototype.writeFeatureMembers_=function(e,t,o){var r=o[o.length-1],i=r.featureType,n=r.featureNS,a={};a[n]={};a[n][i]=ol.xml.makeChildAppender(this.writeFeatureElement,this);var l=ol.obj.assign({},r);l.node=e;ol.xml.pushSerializeAndPop(l,a,ol.xml.makeSimpleNodeFactory(i,n),t,o)};ol.format.GML3.SURFACEORPOLYGONMEMBER_SERIALIZERS_={"http://www.opengis.net/gml":{surfaceMember:ol.xml.makeChildAppender(ol.format.GML3.prototype.writeSurfaceOrPolygonMember_),polygonMember:ol.xml.makeChildAppender(ol.format.GML3.prototype.writeSurfaceOrPolygonMember_)}};ol.format.GML3.POINTMEMBER_SERIALIZERS_={"http://www.opengis.net/gml":{pointMember:ol.xml.makeChildAppender(ol.format.GML3.prototype.writePointMember_)}};ol.format.GML3.LINESTRINGORCURVEMEMBER_SERIALIZERS_={"http://www.opengis.net/gml":{lineStringMember:ol.xml.makeChildAppender(ol.format.GML3.prototype.writeLineStringOrCurveMember_),curveMember:ol.xml.makeChildAppender(ol.format.GML3.prototype.writeLineStringOrCurveMember_)}};ol.format.GML3.RING_SERIALIZERS_={"http://www.opengis.net/gml":{exterior:ol.xml.makeChildAppender(ol.format.GML3.prototype.writeRing_),interior:ol.xml.makeChildAppender(ol.format.GML3.prototype.writeRing_)}};ol.format.GML3.GEOMETRY_SERIALIZERS_={"http://www.opengis.net/gml":{Curve:ol.xml.makeChildAppender(ol.format.GML3.prototype.writeCurveOrLineString_),MultiCurve:ol.xml.makeChildAppender(ol.format.GML3.prototype.writeMultiCurveOrLineString_),Point:ol.xml.makeChildAppender(ol.format.GML3.prototype.writePoint_),MultiPoint:ol.xml.makeChildAppender(ol.format.GML3.prototype.writeMultiPoint_),LineString:ol.xml.makeChildAppender(ol.format.GML3.prototype.writeCurveOrLineString_),MultiLineString:ol.xml.makeChildAppender(ol.format.GML3.prototype.writeMultiCurveOrLineString_),LinearRing:ol.xml.makeChildAppender(ol.format.GML3.prototype.writeLinearRing_),Polygon:ol.xml.makeChildAppender(ol.format.GML3.prototype.writeSurfaceOrPolygon_),MultiPolygon:ol.xml.makeChildAppender(ol.format.GML3.prototype.writeMultiSurfaceOrPolygon_),Surface:ol.xml.makeChildAppender(ol.format.GML3.prototype.writeSurfaceOrPolygon_),MultiSurface:ol.xml.makeChildAppender(ol.format.GML3.prototype.writeMultiSurfaceOrPolygon_),Envelope:ol.xml.makeChildAppender(ol.format.GML3.prototype.writeEnvelope)}};ol.format.GML3.MULTIGEOMETRY_TO_MEMBER_NODENAME_={MultiLineString:"lineStringMember",MultiCurve:"curveMember",MultiPolygon:"polygonMember",MultiSurface:"surfaceMember"};ol.format.GML3.prototype.MULTIGEOMETRY_MEMBER_NODE_FACTORY_=function(e,t,o){var r=t[t.length-1].node;return ol.xml.createElementNS("http://www.opengis.net/gml",ol.format.GML3.MULTIGEOMETRY_TO_MEMBER_NODENAME_[r.nodeName])};ol.format.GML3.prototype.GEOMETRY_NODE_FACTORY_=function(e,t,o){var r,i=t[t.length-1],n=i.multiSurface,a=i.surface,l=i.curve,s=i.multiCurve;Array.isArray(e)?r="Envelope":"MultiPolygon"===(r=e.getType())&&!0===n?r="MultiSurface":"Polygon"===r&&!0===a?r="Surface":"LineString"===r&&!0===l?r="Curve":"MultiLineString"===r&&!0===s&&(r="MultiCurve");return ol.xml.createElementNS("http://www.opengis.net/gml",r)};ol.format.GML3.prototype.writeGeometryNode=function(e,t){t=this.adaptOptions(t);var o=ol.xml.createElementNS("http://www.opengis.net/gml","geom"),r={node:o,hasZ:this.hasZ,srsName:this.srsName,curve:this.curve_,surface:this.surface_,multiSurface:this.multiSurface_,multiCurve:this.multiCurve_};t&&ol.obj.assign(r,t);this.writeGeometryElement(o,e,[r]);return o};ol.format.GML3.prototype.writeFeatures;ol.format.GML3.prototype.writeFeaturesNode=function(e,t){t=this.adaptOptions(t);var o=ol.xml.createElementNS("http://www.opengis.net/gml","featureMembers");ol.xml.setAttributeNS(o,"http://www.w3.org/2001/XMLSchema-instance","xsi:schemaLocation",this.schemaLocation);var r={srsName:this.srsName,hasZ:this.hasZ,curve:this.curve_,surface:this.surface_,multiSurface:this.multiSurface_,multiCurve:this.multiCurve_,featureNS:this.featureNS,featureType:this.featureType};t&&ol.obj.assign(r,t);this.writeFeatureMembers_(o,e,[r]);return o};goog.provide("ol.format.GML");goog.require("ol.format.GML3");ol.format.GML=ol.format.GML3;ol.format.GML.prototype.writeFeatures;ol.format.GML.prototype.writeFeaturesNode;goog.provide("ol.format.GML2");goog.require("ol");goog.require("ol.extent");goog.require("ol.format.Feature");goog.require("ol.format.GMLBase");goog.require("ol.format.XSD");goog.require("ol.geom.Geometry");goog.require("ol.obj");goog.require("ol.proj");goog.require("ol.xml");ol.format.GML2=function(e){var t=e||{};ol.format.GMLBase.call(this,t);this.FEATURE_COLLECTION_PARSERS[ol.format.GMLBase.GMLNS].featureMember=ol.xml.makeArrayPusher(ol.format.GMLBase.prototype.readFeaturesInternal);this.schemaLocation=t.schemaLocation?t.schemaLocation:ol.format.GML2.schemaLocation_};ol.inherits(ol.format.GML2,ol.format.GMLBase);ol.format.GML2.schemaLocation_=ol.format.GMLBase.GMLNS+" http://schemas.opengis.net/gml/2.1.2/feature.xsd";ol.format.GML2.prototype.readFlatCoordinates_=function(e,t){var o=ol.xml.getAllTextContent(e,!1).replace(/^\s*|\s*$/g,""),r=t[0].srsName,i="enu";if(r){var n=ol.proj.get(r);n&&(i=n.getAxisOrientation())}for(var a,l,s,p=o.trim().split(/\s+/),c=[],u=0,g=p.length;u<g;u++){var d=p[u].split(/,+/);a=parseFloat(d[0]);l=parseFloat(d[1]);s=3===d.length?parseFloat(d[2]):0;"en"===i.substr(0,2)?c.push(a,l,s):c.push(l,a,s)}return c};ol.format.GML2.prototype.readBox_=function(e,t){var o=ol.xml.pushParseAndPop([null],this.BOX_PARSERS_,e,t,this);return ol.extent.createOrUpdate(o[1][0],o[1][1],o[1][3],o[1][4])};ol.format.GML2.prototype.innerBoundaryIsParser_=function(e,t){var o=ol.xml.pushParseAndPop(void 0,this.RING_PARSERS,e,t,this);if(o){t[t.length-1].push(o)}};ol.format.GML2.prototype.outerBoundaryIsParser_=function(e,t){var o=ol.xml.pushParseAndPop(void 0,this.RING_PARSERS,e,t,this);if(o){t[t.length-1][0]=o}};ol.format.GML2.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS_={"http://www.opengis.net/gml":{coordinates:ol.xml.makeReplacer(ol.format.GML2.prototype.readFlatCoordinates_)}};ol.format.GML2.prototype.FLAT_LINEAR_RINGS_PARSERS_={"http://www.opengis.net/gml":{innerBoundaryIs:ol.format.GML2.prototype.innerBoundaryIsParser_,outerBoundaryIs:ol.format.GML2.prototype.outerBoundaryIsParser_}};ol.format.GML2.prototype.BOX_PARSERS_={"http://www.opengis.net/gml":{coordinates:ol.xml.makeArrayPusher(ol.format.GML2.prototype.readFlatCoordinates_)}};ol.format.GML2.prototype.GEOMETRY_PARSERS_={"http://www.opengis.net/gml":{Point:ol.xml.makeReplacer(ol.format.GMLBase.prototype.readPoint),MultiPoint:ol.xml.makeReplacer(ol.format.GMLBase.prototype.readMultiPoint),LineString:ol.xml.makeReplacer(ol.format.GMLBase.prototype.readLineString),MultiLineString:ol.xml.makeReplacer(ol.format.GMLBase.prototype.readMultiLineString),LinearRing:ol.xml.makeReplacer(ol.format.GMLBase.prototype.readLinearRing),Polygon:ol.xml.makeReplacer(ol.format.GMLBase.prototype.readPolygon),MultiPolygon:ol.xml.makeReplacer(ol.format.GMLBase.prototype.readMultiPolygon),Box:ol.xml.makeReplacer(ol.format.GML2.prototype.readBox_)}};ol.format.GML2.prototype.GEOMETRY_NODE_FACTORY_=function(e,t,o){var r,i=t[t.length-1],n=i.multiSurface,a=i.surface,l=i.multiCurve;Array.isArray(e)?r="Envelope":"MultiPolygon"===(r=e.getType())&&!0===n?r="MultiSurface":"Polygon"===r&&!0===a?r="Surface":"MultiLineString"===r&&!0===l&&(r="MultiCurve");return ol.xml.createElementNS("http://www.opengis.net/gml",r)};ol.format.GML2.prototype.writeFeatureElement=function(e,t,o){var r=t.getId();r&&e.setAttribute("fid",r);var i=o[o.length-1],n=i.featureNS,a=t.getGeometryName();if(!i.serializers){i.serializers={};i.serializers[n]={}}var l=t.getProperties(),s=[],p=[];for(var c in l){var u=l[c];if(null!==u){s.push(c);p.push(u);c==a||u instanceof ol.geom.Geometry?c in i.serializers[n]||(i.serializers[n][c]=ol.xml.makeChildAppender(this.writeGeometryElement,this)):c in i.serializers[n]||(i.serializers[n][c]=ol.xml.makeChildAppender(ol.format.XSD.writeStringTextNode))}}var g=ol.obj.assign({},i);g.node=e;ol.xml.pushSerializeAndPop(g,i.serializers,ol.xml.makeSimpleNodeFactory(void 0,n),p,o,s)};ol.format.GML2.prototype.writeGeometryElement=function(e,t,o){var r,i=o[o.length-1],n=ol.obj.assign({},i);n.node=e;r=Array.isArray(t)?i.dataProjection?ol.proj.transformExtent(t,i.featureProjection,i.dataProjection):t:ol.format.Feature.transformWithOptions(t,!0,i);ol.xml.pushSerializeAndPop(n,ol.format.GML2.GEOMETRY_SERIALIZERS_,this.GEOMETRY_NODE_FACTORY_,[r],o,void 0,this)};ol.format.GML2.prototype.writeCurveOrLineString_=function(e,t,o){var r=o[o.length-1].srsName;"LineStringSegment"!==e.nodeName&&r&&e.setAttribute("srsName",r);if("LineString"===e.nodeName||"LineStringSegment"===e.nodeName){var i=this.createCoordinatesNode_(e.namespaceURI);e.appendChild(i);this.writeCoordinates_(i,t,o)}else if("Curve"===e.nodeName){var n=ol.xml.createElementNS(e.namespaceURI,"segments");e.appendChild(n);this.writeCurveSegments_(n,t,o)}};ol.format.GML2.prototype.createCoordinatesNode_=function(e){var t=ol.xml.createElementNS(e,"coordinates");t.setAttribute("decimal",".");t.setAttribute("cs",",");t.setAttribute("ts"," ");return t};ol.format.GML2.prototype.writeCoordinates_=function(e,t,o){for(var r,i=o[o.length-1],n=i.hasZ,a=i.srsName,l=t.getCoordinates(),s=l.length,p=new Array(s),c=0;c<s;++c){r=l[c];p[c]=this.getCoords_(r,a,n)}ol.format.XSD.writeStringTextNode(e,p.join(" "))};ol.format.GML2.prototype.writeCurveSegments_=function(e,t,o){var r=ol.xml.createElementNS(e.namespaceURI,"LineStringSegment");e.appendChild(r);this.writeCurveOrLineString_(r,t,o)};ol.format.GML2.prototype.writeSurfaceOrPolygon_=function(e,t,o){var r=o[o.length-1],i=r.hasZ,n=r.srsName;"PolygonPatch"!==e.nodeName&&n&&e.setAttribute("srsName",n);if("Polygon"===e.nodeName||"PolygonPatch"===e.nodeName){var a=t.getLinearRings();ol.xml.pushSerializeAndPop({node:e,hasZ:i,srsName:n},ol.format.GML2.RING_SERIALIZERS_,this.RING_NODE_FACTORY_,a,o,void 0,this)}else if("Surface"===e.nodeName){var l=ol.xml.createElementNS(e.namespaceURI,"patches");e.appendChild(l);this.writeSurfacePatches_(l,t,o)}};ol.format.GML2.prototype.RING_NODE_FACTORY_=function(e,t,o){var r=t[t.length-1],i=r.node,n=r.exteriorWritten;void 0===n&&(r.exteriorWritten=!0);return ol.xml.createElementNS(i.namespaceURI,void 0!==n?"innerBoundaryIs":"outerBoundaryIs")};ol.format.GML2.prototype.writeSurfacePatches_=function(e,t,o){var r=ol.xml.createElementNS(e.namespaceURI,"PolygonPatch");e.appendChild(r);this.writeSurfaceOrPolygon_(r,t,o)};ol.format.GML2.prototype.writeRing_=function(e,t,o){var r=ol.xml.createElementNS(e.namespaceURI,"LinearRing");e.appendChild(r);this.writeLinearRing_(r,t,o)};ol.format.GML2.prototype.getCoords_=function(e,t,o){var r="enu";t&&(r=ol.proj.get(t).getAxisOrientation());var i="en"===r.substr(0,2)?e[0]+","+e[1]:e[1]+","+e[0];if(o){i+=","+(e[2]||0)}return i};ol.format.GML2.prototype.writeMultiCurveOrLineString_=function(e,t,o){var r=o[o.length-1],i=r.hasZ,n=r.srsName,a=r.curve;n&&e.setAttribute("srsName",n);var l=t.getLineStrings();ol.xml.pushSerializeAndPop({node:e,hasZ:i,srsName:n,curve:a},ol.format.GML2.LINESTRINGORCURVEMEMBER_SERIALIZERS_,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,l,o,void 0,this)};ol.format.GML2.prototype.writePoint_=function(e,t,o){var r=o[o.length-1],i=r.hasZ,n=r.srsName;n&&e.setAttribute("srsName",n);var a=this.createCoordinatesNode_(e.namespaceURI);e.appendChild(a);var l=t.getCoordinates(),s=this.getCoords_(l,n,i);ol.format.XSD.writeStringTextNode(a,s)};ol.format.GML2.prototype.writeMultiPoint_=function(e,t,o){var r=o[o.length-1],i=r.hasZ,n=r.srsName;n&&e.setAttribute("srsName",n);var a=t.getPoints();ol.xml.pushSerializeAndPop({node:e,hasZ:i,srsName:n},ol.format.GML2.POINTMEMBER_SERIALIZERS_,ol.xml.makeSimpleNodeFactory("pointMember"),a,o,void 0,this)};ol.format.GML2.prototype.writePointMember_=function(e,t,o){var r=ol.xml.createElementNS(e.namespaceURI,"Point");e.appendChild(r);this.writePoint_(r,t,o)};ol.format.GML2.prototype.writeLineStringOrCurveMember_=function(e,t,o){var r=this.GEOMETRY_NODE_FACTORY_(t,o);if(r){e.appendChild(r);this.writeCurveOrLineString_(r,t,o)}};ol.format.GML2.prototype.writeLinearRing_=function(e,t,o){var r=o[o.length-1].srsName;r&&e.setAttribute("srsName",r);var i=this.createCoordinatesNode_(e.namespaceURI);e.appendChild(i);this.writeCoordinates_(i,t,o)};ol.format.GML2.prototype.writeMultiSurfaceOrPolygon_=function(e,t,o){var r=o[o.length-1],i=r.hasZ,n=r.srsName,a=r.surface;n&&e.setAttribute("srsName",n);var l=t.getPolygons();ol.xml.pushSerializeAndPop({node:e,hasZ:i,srsName:n,surface:a},ol.format.GML2.SURFACEORPOLYGONMEMBER_SERIALIZERS_,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,l,o,void 0,this)};ol.format.GML2.prototype.writeSurfaceOrPolygonMember_=function(e,t,o){var r=this.GEOMETRY_NODE_FACTORY_(t,o);if(r){e.appendChild(r);this.writeSurfaceOrPolygon_(r,t,o)}};ol.format.GML2.prototype.writeEnvelope=function(e,t,o){var r=o[o.length-1].srsName;r&&e.setAttribute("srsName",r);var i=[t[0]+" "+t[1],t[2]+" "+t[3]];ol.xml.pushSerializeAndPop({node:e},ol.format.GML2.ENVELOPE_SERIALIZERS_,ol.xml.OBJECT_PROPERTY_NODE_FACTORY,i,o,["lowerCorner","upperCorner"],this)};ol.format.GML2.GEOMETRY_SERIALIZERS_={"http://www.opengis.net/gml":{Curve:ol.xml.makeChildAppender(ol.format.GML2.prototype.writeCurveOrLineString_),MultiCurve:ol.xml.makeChildAppender(ol.format.GML2.prototype.writeMultiCurveOrLineString_),Point:ol.xml.makeChildAppender(ol.format.GML2.prototype.writePoint_),MultiPoint:ol.xml.makeChildAppender(ol.format.GML2.prototype.writeMultiPoint_),LineString:ol.xml.makeChildAppender(ol.format.GML2.prototype.writeCurveOrLineString_),MultiLineString:ol.xml.makeChildAppender(ol.format.GML2.prototype.writeMultiCurveOrLineString_),LinearRing:ol.xml.makeChildAppender(ol.format.GML2.prototype.writeLinearRing_),Polygon:ol.xml.makeChildAppender(ol.format.GML2.prototype.writeSurfaceOrPolygon_),MultiPolygon:ol.xml.makeChildAppender(ol.format.GML2.prototype.writeMultiSurfaceOrPolygon_),Surface:ol.xml.makeChildAppender(ol.format.GML2.prototype.writeSurfaceOrPolygon_),MultiSurface:ol.xml.makeChildAppender(ol.format.GML2.prototype.writeMultiSurfaceOrPolygon_),Envelope:ol.xml.makeChildAppender(ol.format.GML2.prototype.writeEnvelope)}};ol.format.GML2.RING_SERIALIZERS_={"http://www.opengis.net/gml":{outerBoundaryIs:ol.xml.makeChildAppender(ol.format.GML2.prototype.writeRing_),innerBoundaryIs:ol.xml.makeChildAppender(ol.format.GML2.prototype.writeRing_)}};ol.format.GML2.POINTMEMBER_SERIALIZERS_={"http://www.opengis.net/gml":{pointMember:ol.xml.makeChildAppender(ol.format.GML2.prototype.writePointMember_)}};ol.format.GML2.LINESTRINGORCURVEMEMBER_SERIALIZERS_={"http://www.opengis.net/gml":{lineStringMember:ol.xml.makeChildAppender(ol.format.GML2.prototype.writeLineStringOrCurveMember_),curveMember:ol.xml.makeChildAppender(ol.format.GML2.prototype.writeLineStringOrCurveMember_)}};ol.format.GML2.prototype.MULTIGEOMETRY_MEMBER_NODE_FACTORY_=function(e,t,o){var r=t[t.length-1].node;return ol.xml.createElementNS("http://www.opengis.net/gml",ol.format.GML2.MULTIGEOMETRY_TO_MEMBER_NODENAME_[r.nodeName])};ol.format.GML2.MULTIGEOMETRY_TO_MEMBER_NODENAME_={MultiLineString:"lineStringMember",MultiCurve:"curveMember",MultiPolygon:"polygonMember",MultiSurface:"surfaceMember"};ol.format.GML2.SURFACEORPOLYGONMEMBER_SERIALIZERS_={"http://www.opengis.net/gml":{surfaceMember:ol.xml.makeChildAppender(ol.format.GML2.prototype.writeSurfaceOrPolygonMember_),polygonMember:ol.xml.makeChildAppender(ol.format.GML2.prototype.writeSurfaceOrPolygonMember_)}};ol.format.GML2.ENVELOPE_SERIALIZERS_={"http://www.opengis.net/gml":{lowerCorner:ol.xml.makeChildAppender(ol.format.XSD.writeStringTextNode),upperCorner:ol.xml.makeChildAppender(ol.format.XSD.writeStringTextNode)}};goog.provide("ol.format.GPX");goog.require("ol");goog.require("ol.Feature");goog.require("ol.array");goog.require("ol.format.Feature");goog.require("ol.format.XMLFeature");goog.require("ol.format.XSD");goog.require("ol.geom.GeometryLayout");goog.require("ol.geom.LineString");goog.require("ol.geom.MultiLineString");goog.require("ol.geom.Point");goog.require("ol.proj");goog.require("ol.xml");ol.format.GPX=function(e){var t=e||{};ol.format.XMLFeature.call(this);this.defaultDataProjection=ol.proj.get("EPSG:4326");this.readExtensions_=t.readExtensions};ol.inherits(ol.format.GPX,ol.format.XMLFeature);ol.format.GPX.NAMESPACE_URIS_=[null,"http://www.topografix.com/GPX/1/0","http://www.topografix.com/GPX/1/1"];ol.format.GPX.SCHEMA_LOCATION_="http://www.topografix.com/GPX/1/1 http://www.topografix.com/GPX/1/1/gpx.xsd";ol.format.GPX.appendCoordinate_=function(e,t,o,r){e.push(parseFloat(o.getAttribute("lon")),parseFloat(o.getAttribute("lat")));if("ele"in r){e.push(r.ele);delete r.ele;t.hasZ=!0}else e.push(0);if("time"in r){e.push(r.time);delete r.time;t.hasM=!0}else e.push(0);return e};ol.format.GPX.applyLayoutOptions_=function(e,t,o){var r=ol.geom.GeometryLayout.XY,i=2;if(e.hasZ&&e.hasM){r=ol.geom.GeometryLayout.XYZM;i=4}else if(e.hasZ){r=ol.geom.GeometryLayout.XYZ;i=3}else if(e.hasM){r=ol.geom.GeometryLayout.XYM;i=3}if(4!==i){var n,a;for(n=0,a=t.length/4;n<a;n++){t[n*i]=t[4*n];t[n*i+1]=t[4*n+1];e.hasZ&&(t[n*i+2]=t[4*n+2]);e.hasM&&(t[n*i+2]=t[4*n+3])}t.length=t.length/4*i;if(o)for(n=0,a=o.length;n<a;n++)o[n]=o[n]/4*i}return r};ol.format.GPX.parseLink_=function(e,t){var o=t[t.length-1],r=e.getAttribute("href");null!==r&&(o.link=r);ol.xml.parseNode(ol.format.GPX.LINK_PARSERS_,e,t)};ol.format.GPX.parseExtensions_=function(e,t){t[t.length-1].extensionsNode_=e};ol.format.GPX.parseRtePt_=function(e,t){var o=ol.xml.pushParseAndPop({},ol.format.GPX.RTEPT_PARSERS_,e,t);if(o){var r=t[t.length-1],i=r.flatCoordinates,n=r.layoutOptions;ol.format.GPX.appendCoordinate_(i,n,e,o)}};ol.format.GPX.parseTrkPt_=function(e,t){var o=ol.xml.pushParseAndPop({},ol.format.GPX.TRKPT_PARSERS_,e,t);if(o){var r=t[t.length-1],i=r.flatCoordinates,n=r.layoutOptions;ol.format.GPX.appendCoordinate_(i,n,e,o)}};ol.format.GPX.parseTrkSeg_=function(e,t){var o=t[t.length-1];ol.xml.parseNode(ol.format.GPX.TRKSEG_PARSERS_,e,t);var r=o.flatCoordinates;o.ends.push(r.length)};ol.format.GPX.readRte_=function(e,t){var o=t[0],r=ol.xml.pushParseAndPop({flatCoordinates:[],layoutOptions:{}},ol.format.GPX.RTE_PARSERS_,e,t);if(r){var i=r.flatCoordinates;delete r.flatCoordinates;var n=r.layoutOptions;delete r.layoutOptions;var a=ol.format.GPX.applyLayoutOptions_(n,i),l=new ol.geom.LineString(null);l.setFlatCoordinates(a,i);ol.format.Feature.transformWithOptions(l,!1,o);var s=new ol.Feature(l);s.setProperties(r);return s}};ol.format.GPX.readTrk_=function(e,t){var o=t[0],r=ol.xml.pushParseAndPop({flatCoordinates:[],ends:[],layoutOptions:{}},ol.format.GPX.TRK_PARSERS_,e,t);if(r){var i=r.flatCoordinates;delete r.flatCoordinates;var n=r.ends;delete r.ends;var a=r.layoutOptions;delete r.layoutOptions;var l=ol.format.GPX.applyLayoutOptions_(a,i,n),s=new ol.geom.MultiLineString(null);s.setFlatCoordinates(l,i,n);ol.format.Feature.transformWithOptions(s,!1,o);var p=new ol.Feature(s);p.setProperties(r);return p}};ol.format.GPX.readWpt_=function(e,t){var o=t[0],r=ol.xml.pushParseAndPop({},ol.format.GPX.WPT_PARSERS_,e,t);if(r){var i={},n=ol.format.GPX.appendCoordinate_([],i,e,r),a=ol.format.GPX.applyLayoutOptions_(i,n),l=new ol.geom.Point(n,a);ol.format.Feature.transformWithOptions(l,!1,o);var s=new ol.Feature(l);s.setProperties(r);return s}};ol.format.GPX.FEATURE_READER_={rte:ol.format.GPX.readRte_,trk:ol.format.GPX.readTrk_,wpt:ol.format.GPX.readWpt_};ol.format.GPX.GPX_PARSERS_=ol.xml.makeStructureNS(ol.format.GPX.NAMESPACE_URIS_,{rte:ol.xml.makeArrayPusher(ol.format.GPX.readRte_),trk:ol.xml.makeArrayPusher(ol.format.GPX.readTrk_),wpt:ol.xml.makeArrayPusher(ol.format.GPX.readWpt_)});ol.format.GPX.LINK_PARSERS_=ol.xml.makeStructureNS(ol.format.GPX.NAMESPACE_URIS_,{text:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString,"linkText"),type:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString,"linkType")});ol.format.GPX.RTE_PARSERS_=ol.xml.makeStructureNS(ol.format.GPX.NAMESPACE_URIS_,{name:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),cmt:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),desc:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),src:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),link:ol.format.GPX.parseLink_,number:ol.xml.makeObjectPropertySetter(ol.format.XSD.readNonNegativeInteger),extensions:ol.format.GPX.parseExtensions_,type:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),rtept:ol.format.GPX.parseRtePt_});ol.format.GPX.RTEPT_PARSERS_=ol.xml.makeStructureNS(ol.format.GPX.NAMESPACE_URIS_,{ele:ol.xml.makeObjectPropertySetter(ol.format.XSD.readDecimal),time:ol.xml.makeObjectPropertySetter(ol.format.XSD.readDateTime)});ol.format.GPX.TRK_PARSERS_=ol.xml.makeStructureNS(ol.format.GPX.NAMESPACE_URIS_,{name:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),cmt:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),desc:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),src:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),link:ol.format.GPX.parseLink_,number:ol.xml.makeObjectPropertySetter(ol.format.XSD.readNonNegativeInteger),type:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),extensions:ol.format.GPX.parseExtensions_,trkseg:ol.format.GPX.parseTrkSeg_});ol.format.GPX.TRKSEG_PARSERS_=ol.xml.makeStructureNS(ol.format.GPX.NAMESPACE_URIS_,{trkpt:ol.format.GPX.parseTrkPt_});ol.format.GPX.TRKPT_PARSERS_=ol.xml.makeStructureNS(ol.format.GPX.NAMESPACE_URIS_,{ele:ol.xml.makeObjectPropertySetter(ol.format.XSD.readDecimal),time:ol.xml.makeObjectPropertySetter(ol.format.XSD.readDateTime)});ol.format.GPX.WPT_PARSERS_=ol.xml.makeStructureNS(ol.format.GPX.NAMESPACE_URIS_,{ele:ol.xml.makeObjectPropertySetter(ol.format.XSD.readDecimal),time:ol.xml.makeObjectPropertySetter(ol.format.XSD.readDateTime),magvar:ol.xml.makeObjectPropertySetter(ol.format.XSD.readDecimal),geoidheight:ol.xml.makeObjectPropertySetter(ol.format.XSD.readDecimal),name:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),cmt:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),desc:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),src:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),link:ol.format.GPX.parseLink_,sym:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),type:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),fix:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),sat:ol.xml.makeObjectPropertySetter(ol.format.XSD.readNonNegativeInteger),hdop:ol.xml.makeObjectPropertySetter(ol.format.XSD.readDecimal),vdop:ol.xml.makeObjectPropertySetter(ol.format.XSD.readDecimal),pdop:ol.xml.makeObjectPropertySetter(ol.format.XSD.readDecimal),ageofdgpsdata:ol.xml.makeObjectPropertySetter(ol.format.XSD.readDecimal),dgpsid:ol.xml.makeObjectPropertySetter(ol.format.XSD.readNonNegativeInteger),extensions:ol.format.GPX.parseExtensions_});ol.format.GPX.prototype.handleReadExtensions_=function(e){e||(e=[]);for(var t=0,o=e.length;t<o;++t){var r=e[t];if(this.readExtensions_){var i=r.get("extensionsNode_")||null;this.readExtensions_(r,i)}r.set("extensionsNode_",void 0)}};ol.format.GPX.prototype.readFeature;ol.format.GPX.prototype.readFeatureFromNode=function(e,t){if(!ol.array.includes(ol.format.GPX.NAMESPACE_URIS_,e.namespaceURI))return null;var o=ol.format.GPX.FEATURE_READER_[e.localName];if(!o)return null;var r=o(e,[this.getReadOptions(e,t)]);if(!r)return null;this.handleReadExtensions_([r]);return r};ol.format.GPX.prototype.readFeatures;ol.format.GPX.prototype.readFeaturesFromNode=function(e,t){if(!ol.array.includes(ol.format.GPX.NAMESPACE_URIS_,e.namespaceURI))return[];if("gpx"==e.localName){var o=ol.xml.pushParseAndPop([],ol.format.GPX.GPX_PARSERS_,e,[this.getReadOptions(e,t)]);if(o){this.handleReadExtensions_(o);return o}return[]}return[]};ol.format.GPX.prototype.readProjection;ol.format.GPX.writeLink_=function(e,t,o){e.setAttribute("href",t);var r=o[o.length-1].properties,i=[r.linkText,r.linkType];ol.xml.pushSerializeAndPop({node:e},ol.format.GPX.LINK_SERIALIZERS_,ol.xml.OBJECT_PROPERTY_NODE_FACTORY,i,o,ol.format.GPX.LINK_SEQUENCE_)};ol.format.GPX.writeWptType_=function(e,t,o){var r=o[o.length-1],i=r.node.namespaceURI,n=r.properties;ol.xml.setAttributeNS(e,null,"lat",t[1]);ol.xml.setAttributeNS(e,null,"lon",t[0]);switch(r.geometryLayout){case ol.geom.GeometryLayout.XYZM:0!==t[3]&&(n.time=t[3]);case ol.geom.GeometryLayout.XYZ:0!==t[2]&&(n.ele=t[2]);break;case ol.geom.GeometryLayout.XYM:0!==t[2]&&(n.time=t[2])}var a="rtept"==e.nodeName?ol.format.GPX.RTEPT_TYPE_SEQUENCE_[i]:ol.format.GPX.WPT_TYPE_SEQUENCE_[i],l=ol.xml.makeSequence(n,a);ol.xml.pushSerializeAndPop({node:e,properties:n},ol.format.GPX.WPT_TYPE_SERIALIZERS_,ol.xml.OBJECT_PROPERTY_NODE_FACTORY,l,o,a)};ol.format.GPX.writeRte_=function(e,t,o){var r=o[0],i=t.getProperties(),n={node:e,properties:i},a=t.getGeometry();if(a){a=ol.format.Feature.transformWithOptions(a,!0,r);n.geometryLayout=a.getLayout();i.rtept=a.getCoordinates()}var l=o[o.length-1].node,s=ol.format.GPX.RTE_SEQUENCE_[l.namespaceURI],p=ol.xml.makeSequence(i,s);ol.xml.pushSerializeAndPop(n,ol.format.GPX.RTE_SERIALIZERS_,ol.xml.OBJECT_PROPERTY_NODE_FACTORY,p,o,s)};ol.format.GPX.writeTrk_=function(e,t,o){var r=o[0],i=t.getProperties(),n={node:e,properties:i},a=t.getGeometry();if(a){a=ol.format.Feature.transformWithOptions(a,!0,r);i.trkseg=a.getLineStrings()}var l=o[o.length-1].node,s=ol.format.GPX.TRK_SEQUENCE_[l.namespaceURI],p=ol.xml.makeSequence(i,s);ol.xml.pushSerializeAndPop(n,ol.format.GPX.TRK_SERIALIZERS_,ol.xml.OBJECT_PROPERTY_NODE_FACTORY,p,o,s)};ol.format.GPX.writeTrkSeg_=function(e,t,o){var r={node:e,geometryLayout:t.getLayout(),properties:{}};ol.xml.pushSerializeAndPop(r,ol.format.GPX.TRKSEG_SERIALIZERS_,ol.format.GPX.TRKSEG_NODE_FACTORY_,t.getCoordinates(),o)};ol.format.GPX.writeWpt_=function(e,t,o){var r=o[0],i=o[o.length-1];i.properties=t.getProperties();var n=t.getGeometry();if(n){n=ol.format.Feature.transformWithOptions(n,!0,r);i.geometryLayout=n.getLayout();ol.format.GPX.writeWptType_(e,n.getCoordinates(),o)}};ol.format.GPX.LINK_SEQUENCE_=["text","type"];ol.format.GPX.LINK_SERIALIZERS_=ol.xml.makeStructureNS(ol.format.GPX.NAMESPACE_URIS_,{text:ol.xml.makeChildAppender(ol.format.XSD.writeStringTextNode),type:ol.xml.makeChildAppender(ol.format.XSD.writeStringTextNode)});ol.format.GPX.RTE_SEQUENCE_=ol.xml.makeStructureNS(ol.format.GPX.NAMESPACE_URIS_,["name","cmt","desc","src","link","number","type","rtept"]);ol.format.GPX.RTE_SERIALIZERS_=ol.xml.makeStructureNS(ol.format.GPX.NAMESPACE_URIS_,{name:ol.xml.makeChildAppender(ol.format.XSD.writeStringTextNode),cmt:ol.xml.makeChildAppender(ol.format.XSD.writeStringTextNode),desc:ol.xml.makeChildAppender(ol.format.XSD.writeStringTextNode),src:ol.xml.makeChildAppender(ol.format.XSD.writeStringTextNode),link:ol.xml.makeChildAppender(ol.format.GPX.writeLink_),number:ol.xml.makeChildAppender(ol.format.XSD.writeNonNegativeIntegerTextNode),type:ol.xml.makeChildAppender(ol.format.XSD.writeStringTextNode),rtept:ol.xml.makeArraySerializer(ol.xml.makeChildAppender(ol.format.GPX.writeWptType_))});ol.format.GPX.RTEPT_TYPE_SEQUENCE_=ol.xml.makeStructureNS(ol.format.GPX.NAMESPACE_URIS_,["ele","time"]);ol.format.GPX.TRK_SEQUENCE_=ol.xml.makeStructureNS(ol.format.GPX.NAMESPACE_URIS_,["name","cmt","desc","src","link","number","type","trkseg"]);ol.format.GPX.TRK_SERIALIZERS_=ol.xml.makeStructureNS(ol.format.GPX.NAMESPACE_URIS_,{name:ol.xml.makeChildAppender(ol.format.XSD.writeStringTextNode),cmt:ol.xml.makeChildAppender(ol.format.XSD.writeStringTextNode),desc:ol.xml.makeChildAppender(ol.format.XSD.writeStringTextNode),src:ol.xml.makeChildAppender(ol.format.XSD.writeStringTextNode),link:ol.xml.makeChildAppender(ol.format.GPX.writeLink_),number:ol.xml.makeChildAppender(ol.format.XSD.writeNonNegativeIntegerTextNode),type:ol.xml.makeChildAppender(ol.format.XSD.writeStringTextNode),trkseg:ol.xml.makeArraySerializer(ol.xml.makeChildAppender(ol.format.GPX.writeTrkSeg_))});ol.format.GPX.TRKSEG_NODE_FACTORY_=ol.xml.makeSimpleNodeFactory("trkpt");ol.format.GPX.TRKSEG_SERIALIZERS_=ol.xml.makeStructureNS(ol.format.GPX.NAMESPACE_URIS_,{trkpt:ol.xml.makeChildAppender(ol.format.GPX.writeWptType_)});ol.format.GPX.WPT_TYPE_SEQUENCE_=ol.xml.makeStructureNS(ol.format.GPX.NAMESPACE_URIS_,["ele","time","magvar","geoidheight","name","cmt","desc","src","link","sym","type","fix","sat","hdop","vdop","pdop","ageofdgpsdata","dgpsid"]);ol.format.GPX.WPT_TYPE_SERIALIZERS_=ol.xml.makeStructureNS(ol.format.GPX.NAMESPACE_URIS_,{ele:ol.xml.makeChildAppender(ol.format.XSD.writeDecimalTextNode),time:ol.xml.makeChildAppender(ol.format.XSD.writeDateTimeTextNode),magvar:ol.xml.makeChildAppender(ol.format.XSD.writeDecimalTextNode),geoidheight:ol.xml.makeChildAppender(ol.format.XSD.writeDecimalTextNode),name:ol.xml.makeChildAppender(ol.format.XSD.writeStringTextNode),cmt:ol.xml.makeChildAppender(ol.format.XSD.writeStringTextNode),desc:ol.xml.makeChildAppender(ol.format.XSD.writeStringTextNode),src:ol.xml.makeChildAppender(ol.format.XSD.writeStringTextNode),link:ol.xml.makeChildAppender(ol.format.GPX.writeLink_),sym:ol.xml.makeChildAppender(ol.format.XSD.writeStringTextNode),type:ol.xml.makeChildAppender(ol.format.XSD.writeStringTextNode),fix:ol.xml.makeChildAppender(ol.format.XSD.writeStringTextNode),sat:ol.xml.makeChildAppender(ol.format.XSD.writeNonNegativeIntegerTextNode),hdop:ol.xml.makeChildAppender(ol.format.XSD.writeDecimalTextNode),vdop:ol.xml.makeChildAppender(ol.format.XSD.writeDecimalTextNode),pdop:ol.xml.makeChildAppender(ol.format.XSD.writeDecimalTextNode),ageofdgpsdata:ol.xml.makeChildAppender(ol.format.XSD.writeDecimalTextNode),dgpsid:ol.xml.makeChildAppender(ol.format.XSD.writeNonNegativeIntegerTextNode)});ol.format.GPX.GEOMETRY_TYPE_TO_NODENAME_={Point:"wpt",LineString:"rte",MultiLineString:"trk"};ol.format.GPX.GPX_NODE_FACTORY_=function(e,t,o){var r=e.getGeometry();if(r){var i=ol.format.GPX.GEOMETRY_TYPE_TO_NODENAME_[r.getType()];if(i){var n=t[t.length-1].node;return ol.xml.createElementNS(n.namespaceURI,i)}}};ol.format.GPX.GPX_SERIALIZERS_=ol.xml.makeStructureNS(ol.format.GPX.NAMESPACE_URIS_,{rte:ol.xml.makeChildAppender(ol.format.GPX.writeRte_),trk:ol.xml.makeChildAppender(ol.format.GPX.writeTrk_),wpt:ol.xml.makeChildAppender(ol.format.GPX.writeWpt_)});ol.format.GPX.prototype.writeFeatures;ol.format.GPX.prototype.writeFeaturesNode=function(e,t){t=this.adaptOptions(t);var o=ol.xml.createElementNS("http://www.topografix.com/GPX/1/1","gpx");ol.xml.setAttributeNS(o,"http://www.w3.org/2000/xmlns/","xmlns:xsi","http://www.w3.org/2001/XMLSchema-instance");ol.xml.setAttributeNS(o,"http://www.w3.org/2001/XMLSchema-instance","xsi:schemaLocation",ol.format.GPX.SCHEMA_LOCATION_);o.setAttribute("version","1.1");o.setAttribute("creator","OpenLayers");ol.xml.pushSerializeAndPop({node:o},ol.format.GPX.GPX_SERIALIZERS_,ol.format.GPX.GPX_NODE_FACTORY_,e,[t]);return o};goog.provide("ol.format.IGCZ");ol.format.IGCZ={BAROMETRIC:"barometric",GPS:"gps",NONE:"none"};goog.provide("ol.format.TextFeature");goog.require("ol");goog.require("ol.format.Feature");goog.require("ol.format.FormatType");ol.format.TextFeature=function(){ol.format.Feature.call(this)};ol.inherits(ol.format.TextFeature,ol.format.Feature);ol.format.TextFeature.prototype.getText_=function(e){return"string"==typeof e?e:""};ol.format.TextFeature.prototype.getType=function(){return ol.format.FormatType.TEXT};ol.format.TextFeature.prototype.readFeature=function(e,t){return this.readFeatureFromText(this.getText_(e),this.adaptOptions(t))};ol.format.TextFeature.prototype.readFeatureFromText=function(e,t){};ol.format.TextFeature.prototype.readFeatures=function(e,t){return this.readFeaturesFromText(this.getText_(e),this.adaptOptions(t))};ol.format.TextFeature.prototype.readFeaturesFromText=function(e,t){};ol.format.TextFeature.prototype.readGeometry=function(e,t){return this.readGeometryFromText(this.getText_(e),this.adaptOptions(t))};ol.format.TextFeature.prototype.readGeometryFromText=function(e,t){};ol.format.TextFeature.prototype.readProjection=function(e){return this.readProjectionFromText(this.getText_(e))};ol.format.TextFeature.prototype.readProjectionFromText=function(e){return this.defaultDataProjection};ol.format.TextFeature.prototype.writeFeature=function(e,t){return this.writeFeatureText(e,this.adaptOptions(t))};ol.format.TextFeature.prototype.writeFeatureText=function(e,t){};ol.format.TextFeature.prototype.writeFeatures=function(e,t){return this.writeFeaturesText(e,this.adaptOptions(t))};ol.format.TextFeature.prototype.writeFeaturesText=function(e,t){};ol.format.TextFeature.prototype.writeGeometry=function(e,t){return this.writeGeometryText(e,this.adaptOptions(t))};ol.format.TextFeature.prototype.writeGeometryText=function(e,t){};goog.provide("ol.format.IGC");goog.require("ol");goog.require("ol.Feature");goog.require("ol.format.Feature");goog.require("ol.format.IGCZ");goog.require("ol.format.TextFeature");goog.require("ol.geom.GeometryLayout");goog.require("ol.geom.LineString");goog.require("ol.proj");ol.format.IGC=function(e){var t=e||{};ol.format.TextFeature.call(this);this.defaultDataProjection=ol.proj.get("EPSG:4326");this.altitudeMode_=t.altitudeMode?t.altitudeMode:ol.format.IGCZ.NONE};ol.inherits(ol.format.IGC,ol.format.TextFeature);ol.format.IGC.B_RECORD_RE_=/^B(\d{2})(\d{2})(\d{2})(\d{2})(\d{5})([NS])(\d{3})(\d{5})([EW])([AV])(\d{5})(\d{5})/;ol.format.IGC.H_RECORD_RE_=/^H.([A-Z]{3}).*?:(.*)/;ol.format.IGC.HFDTE_RECORD_RE_=/^HFDTE(\d{2})(\d{2})(\d{2})/;ol.format.IGC.NEWLINE_RE_=/\r\n|\r|\n/;ol.format.IGC.prototype.readFeature;ol.format.IGC.prototype.readFeatureFromText=function(e,t){var o,r,i=this.altitudeMode_,n=e.split(ol.format.IGC.NEWLINE_RE_),a={},l=[],s=2e3,p=0,c=1,u=-1;for(o=0,r=n.length;o<r;++o){var g,d=n[o];if("B"==d.charAt(0)){if(g=ol.format.IGC.B_RECORD_RE_.exec(d)){var h=parseInt(g[1],10),f=parseInt(g[2],10),y=parseInt(g[3],10),m=parseInt(g[4],10)+parseInt(g[5],10)/6e4;"S"==g[6]&&(m=-m);var v=parseInt(g[7],10)+parseInt(g[8],10)/6e4;"W"==g[9]&&(v=-v);l.push(v,m);if(i!=ol.format.IGCZ.NONE){var C;C=i==ol.format.IGCZ.GPS?parseInt(g[11],10):i==ol.format.IGCZ.BAROMETRIC?parseInt(g[12],10):0;l.push(C)}var T=Date.UTC(s,p,c,h,f,y);T<u&&(T=Date.UTC(s,p,c+1,h,f,y));l.push(T/1e3);u=T}}else if("H"==d.charAt(0))if(g=ol.format.IGC.HFDTE_RECORD_RE_.exec(d)){c=parseInt(g[1],10);p=parseInt(g[2],10)-1;s=2e3+parseInt(g[3],10)}else(g=ol.format.IGC.H_RECORD_RE_.exec(d))&&(a[g[1]]=g[2].trim())}if(0===l.length)return null;var S=new ol.geom.LineString(null),_=i==ol.format.IGCZ.NONE?ol.geom.GeometryLayout.XYM:ol.geom.GeometryLayout.XYZM;S.setFlatCoordinates(_,l);var E=new ol.Feature(ol.format.Feature.transformWithOptions(S,!1,t));E.setProperties(a);return E};ol.format.IGC.prototype.readFeatures;ol.format.IGC.prototype.readFeaturesFromText=function(e,t){var o=this.readFeatureFromText(e,t);return o?[o]:[]};ol.format.IGC.prototype.readProjection;ol.format.IGC.prototype.writeFeatureText=function(e,t){};ol.format.IGC.prototype.writeFeaturesText=function(e,t){};ol.format.IGC.prototype.writeGeometryText=function(e,t){};ol.format.IGC.prototype.readGeometryFromText=function(e,t){};goog.provide("ol.style.IconAnchorUnits");ol.style.IconAnchorUnits={FRACTION:"fraction",PIXELS:"pixels"};goog.provide("ol.style.IconImage");goog.require("ol");goog.require("ol.dom");goog.require("ol.events");goog.require("ol.events.EventTarget");goog.require("ol.events.EventType");goog.require("ol.ImageState");goog.require("ol.style");ol.style.IconImage=function(e,t,o,r,i,n){ol.events.EventTarget.call(this);this.hitDetectionImage_=null;this.image_=e||new Image;null!==r&&(this.image_.crossOrigin=r);this.canvas_=n?document.createElement("CANVAS"):null;this.color_=n;this.imageListenerKeys_=null;this.imageState_=i;this.size_=o;this.src_=t;this.tainting_=!1;this.imageState_==ol.ImageState.LOADED&&this.determineTainting_()};ol.inherits(ol.style.IconImage,ol.events.EventTarget);ol.style.IconImage.get=function(e,t,o,r,i,n){var a=ol.style.iconImageCache,l=a.get(t,r,n);if(!l){l=new ol.style.IconImage(e,t,o,r,i,n);a.set(t,r,n,l)}return l};ol.style.IconImage.prototype.determineTainting_=function(){var e=ol.dom.createCanvasContext2D(1,1);try{e.drawImage(this.image_,0,0);e.getImageData(0,0,1,1)}catch(e){this.tainting_=!0}};ol.style.IconImage.prototype.dispatchChangeEvent_=function(){this.dispatchEvent(ol.events.EventType.CHANGE)};ol.style.IconImage.prototype.handleImageError_=function(){this.imageState_=ol.ImageState.ERROR;this.unlistenImage_();this.dispatchChangeEvent_()};ol.style.IconImage.prototype.handleImageLoad_=function(){this.imageState_=ol.ImageState.LOADED;if(this.size_){this.image_.width=this.size_[0];this.image_.height=this.size_[1]}this.size_=[this.image_.width,this.image_.height];this.unlistenImage_();this.determineTainting_();this.replaceColor_();this.dispatchChangeEvent_()};ol.style.IconImage.prototype.getImage=function(e){return this.canvas_?this.canvas_:this.image_};ol.style.IconImage.prototype.getImageState=function(){return this.imageState_};ol.style.IconImage.prototype.getHitDetectionImage=function(e){if(!this.hitDetectionImage_)if(this.tainting_){var t=this.size_[0],o=this.size_[1],r=ol.dom.createCanvasContext2D(t,o);r.fillRect(0,0,t,o);this.hitDetectionImage_=r.canvas}else this.hitDetectionImage_=this.image_;return this.hitDetectionImage_};ol.style.IconImage.prototype.getSize=function(){return this.size_};ol.style.IconImage.prototype.getSrc=function(){return this.src_};ol.style.IconImage.prototype.load=function(){if(this.imageState_==ol.ImageState.IDLE){this.imageState_=ol.ImageState.LOADING;this.imageListenerKeys_=[ol.events.listenOnce(this.image_,ol.events.EventType.ERROR,this.handleImageError_,this),ol.events.listenOnce(this.image_,ol.events.EventType.LOAD,this.handleImageLoad_,this)];try{this.image_.src=this.src_}catch(e){this.handleImageError_()}}};ol.style.IconImage.prototype.replaceColor_=function(){if(!this.tainting_&&null!==this.color_){this.canvas_.width=this.image_.width;this.canvas_.height=this.image_.height;var e=this.canvas_.getContext("2d");e.drawImage(this.image_,0,0);for(var t=e.getImageData(0,0,this.image_.width,this.image_.height),o=t.data,r=this.color_[0]/255,i=this.color_[1]/255,n=this.color_[2]/255,a=0,l=o.length;a<l;a+=4){o[a]*=r;o[a+1]*=i;o[a+2]*=n}e.putImageData(t,0,0)}};ol.style.IconImage.prototype.unlistenImage_=function(){this.imageListenerKeys_.forEach(ol.events.unlistenByKey);this.imageListenerKeys_=null};goog.provide("ol.style.IconOrigin");ol.style.IconOrigin={BOTTOM_LEFT:"bottom-left",BOTTOM_RIGHT:"bottom-right",TOP_LEFT:"top-left",TOP_RIGHT:"top-right"};goog.provide("ol.style.Icon");goog.require("ol");goog.require("ol.ImageState");goog.require("ol.asserts");goog.require("ol.color");goog.require("ol.events");goog.require("ol.events.EventType");goog.require("ol.style.IconAnchorUnits");goog.require("ol.style.IconImage");goog.require("ol.style.IconOrigin");goog.require("ol.style.Image");ol.style.Icon=function(e){var t=e||{};this.anchor_=void 0!==t.anchor?t.anchor:[.5,.5];this.normalizedAnchor_=null;this.anchorOrigin_=void 0!==t.anchorOrigin?t.anchorOrigin:ol.style.IconOrigin.TOP_LEFT;this.anchorXUnits_=void 0!==t.anchorXUnits?t.anchorXUnits:ol.style.IconAnchorUnits.FRACTION;this.anchorYUnits_=void 0!==t.anchorYUnits?t.anchorYUnits:ol.style.IconAnchorUnits.FRACTION;this.crossOrigin_=void 0!==t.crossOrigin?t.crossOrigin:null;var o=void 0!==t.img?t.img:null,r=void 0!==t.imgSize?t.imgSize:null,i=t.src;ol.asserts.assert(!(void 0!==i&&o),4);ol.asserts.assert(!o||o&&r,5);void 0!==i&&0!==i.length||!o||(i=o.src||ol.getUid(o).toString());ol.asserts.assert(void 0!==i&&i.length>0,6);var n=void 0!==t.src?ol.ImageState.IDLE:ol.ImageState.LOADED;this.color_=void 0!==t.color?ol.color.asArray(t.color):null;this.iconImage_=ol.style.IconImage.get(o,i,r,this.crossOrigin_,n,this.color_);this.offset_=void 0!==t.offset?t.offset:[0,0];this.offsetOrigin_=void 0!==t.offsetOrigin?t.offsetOrigin:ol.style.IconOrigin.TOP_LEFT;this.origin_=null;this.size_=void 0!==t.size?t.size:null;var a=void 0!==t.opacity?t.opacity:1,l=void 0!==t.rotateWithView&&t.rotateWithView,s=void 0!==t.rotation?t.rotation:0,p=void 0!==t.scale?t.scale:1,c=void 0===t.snapToPixel||t.snapToPixel;ol.style.Image.call(this,{opacity:a,rotation:s,scale:p,snapToPixel:c,rotateWithView:l})};ol.inherits(ol.style.Icon,ol.style.Image);ol.style.Icon.prototype.clone=function(){return new ol.style.Icon({anchor:this.anchor_.slice(),anchorOrigin:this.anchorOrigin_,anchorXUnits:this.anchorXUnits_,anchorYUnits:this.anchorYUnits_,crossOrigin:this.crossOrigin_,color:this.color_&&this.color_.slice?this.color_.slice():this.color_||void 0,src:this.getSrc(),offset:this.offset_.slice(),offsetOrigin:this.offsetOrigin_,size:null!==this.size_?this.size_.slice():void 0,opacity:this.getOpacity(),scale:this.getScale(),snapToPixel:this.getSnapToPixel(),rotation:this.getRotation(),rotateWithView:this.getRotateWithView()})};ol.style.Icon.prototype.getAnchor=function(){if(this.normalizedAnchor_)return this.normalizedAnchor_;var e=this.anchor_,t=this.getSize();if(this.anchorXUnits_==ol.style.IconAnchorUnits.FRACTION||this.anchorYUnits_==ol.style.IconAnchorUnits.FRACTION){if(!t)return null;e=this.anchor_.slice();this.anchorXUnits_==ol.style.IconAnchorUnits.FRACTION&&(e[0]*=t[0]);this.anchorYUnits_==ol.style.IconAnchorUnits.FRACTION&&(e[1]*=t[1])}if(this.anchorOrigin_!=ol.style.IconOrigin.TOP_LEFT){if(!t)return null;e===this.anchor_&&(e=this.anchor_.slice());this.anchorOrigin_!=ol.style.IconOrigin.TOP_RIGHT&&this.anchorOrigin_!=ol.style.IconOrigin.BOTTOM_RIGHT||(e[0]=-e[0]+t[0]);this.anchorOrigin_!=ol.style.IconOrigin.BOTTOM_LEFT&&this.anchorOrigin_!=ol.style.IconOrigin.BOTTOM_RIGHT||(e[1]=-e[1]+t[1])}this.normalizedAnchor_=e;return this.normalizedAnchor_};ol.style.Icon.prototype.getColor=function(){return this.color_};ol.style.Icon.prototype.getImage=function(e){return this.iconImage_.getImage(e)};ol.style.Icon.prototype.getImageSize=function(){return this.iconImage_.getSize()};ol.style.Icon.prototype.getHitDetectionImageSize=function(){return this.getImageSize()};ol.style.Icon.prototype.getImageState=function(){return this.iconImage_.getImageState()};ol.style.Icon.prototype.getHitDetectionImage=function(e){return this.iconImage_.getHitDetectionImage(e)};ol.style.Icon.prototype.getOrigin=function(){if(this.origin_)return this.origin_;var e=this.offset_;if(this.offsetOrigin_!=ol.style.IconOrigin.TOP_LEFT){var t=this.getSize(),o=this.iconImage_.getSize();if(!t||!o)return null;e=e.slice();this.offsetOrigin_!=ol.style.IconOrigin.TOP_RIGHT&&this.offsetOrigin_!=ol.style.IconOrigin.BOTTOM_RIGHT||(e[0]=o[0]-t[0]-e[0]);this.offsetOrigin_!=ol.style.IconOrigin.BOTTOM_LEFT&&this.offsetOrigin_!=ol.style.IconOrigin.BOTTOM_RIGHT||(e[1]=o[1]-t[1]-e[1])}this.origin_=e;return this.origin_};ol.style.Icon.prototype.getSrc=function(){return this.iconImage_.getSrc()};ol.style.Icon.prototype.getSize=function(){return this.size_?this.size_:this.iconImage_.getSize()};ol.style.Icon.prototype.listenImageChange=function(e,t){return ol.events.listen(this.iconImage_,ol.events.EventType.CHANGE,e,t)};ol.style.Icon.prototype.load=function(){this.iconImage_.load()};ol.style.Icon.prototype.unlistenImageChange=function(e,t){ol.events.unlisten(this.iconImage_,ol.events.EventType.CHANGE,e,t)};goog.provide("ol.style.Text");goog.require("ol.style.Fill");goog.require("ol.style.TextPlacement");ol.style.Text=function(e){var t=e||{};this.font_=t.font;this.rotation_=t.rotation;this.rotateWithView_=t.rotateWithView;this.scale_=t.scale;this.text_=t.text;this.textAlign_=t.textAlign;this.textBaseline_=t.textBaseline;this.fill_=void 0!==t.fill?t.fill:new ol.style.Fill({color:ol.style.Text.DEFAULT_FILL_COLOR_});this.maxAngle_=void 0!==t.maxAngle?t.maxAngle:Math.PI/4;this.placement_=void 0!==t.placement?t.placement:ol.style.TextPlacement.POINT;var o=void 0===t.overflow?t.exceedLength:t.overflow;this.overflow_=void 0!==o&&o;this.stroke_=void 0!==t.stroke?t.stroke:null;this.offsetX_=void 0!==t.offsetX?t.offsetX:0;this.offsetY_=void 0!==t.offsetY?t.offsetY:0;this.backgroundFill_=t.backgroundFill?t.backgroundFill:null;this.backgroundStroke_=t.backgroundStroke?t.backgroundStroke:null;this.padding_=void 0===t.padding?null:t.padding};ol.style.Text.DEFAULT_FILL_COLOR_="#333";ol.style.Text.prototype.clone=function(){return new ol.style.Text({font:this.getFont(),placement:this.getPlacement(),maxAngle:this.getMaxAngle(),overflow:this.getOverflow(),rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:this.getScale(),text:this.getText(),textAlign:this.getTextAlign(),textBaseline:this.getTextBaseline(),fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,offsetX:this.getOffsetX(),offsetY:this.getOffsetY()})};ol.style.Text.prototype.getOverflow=function(){return this.overflow_};ol.style.Text.prototype.getFont=function(){return this.font_};ol.style.Text.prototype.getMaxAngle=function(){return this.maxAngle_};ol.style.Text.prototype.getPlacement=function(){return this.placement_};ol.style.Text.prototype.getOffsetX=function(){return this.offsetX_};ol.style.Text.prototype.getOffsetY=function(){return this.offsetY_};ol.style.Text.prototype.getFill=function(){return this.fill_};ol.style.Text.prototype.getRotateWithView=function(){return this.rotateWithView_};ol.style.Text.prototype.getRotation=function(){return this.rotation_};ol.style.Text.prototype.getScale=function(){return this.scale_};ol.style.Text.prototype.getStroke=function(){return this.stroke_};ol.style.Text.prototype.getText=function(){return this.text_};ol.style.Text.prototype.getTextAlign=function(){return this.textAlign_};ol.style.Text.prototype.getTextBaseline=function(){return this.textBaseline_};ol.style.Text.prototype.getBackgroundFill=function(){return this.backgroundFill_};ol.style.Text.prototype.getBackgroundStroke=function(){return this.backgroundStroke_};ol.style.Text.prototype.getPadding=function(){return this.padding_};ol.style.Text.prototype.setOverflow=function(e){this.overflow_=e};ol.style.Text.prototype.setFont=function(e){this.font_=e};ol.style.Text.prototype.setMaxAngle=function(e){this.maxAngle_=e};ol.style.Text.prototype.setOffsetX=function(e){this.offsetX_=e};ol.style.Text.prototype.setOffsetY=function(e){this.offsetY_=e};ol.style.Text.prototype.setPlacement=function(e){this.placement_=e};ol.style.Text.prototype.setFill=function(e){this.fill_=e};ol.style.Text.prototype.setRotation=function(e){this.rotation_=e};ol.style.Text.prototype.setScale=function(e){this.scale_=e};ol.style.Text.prototype.setStroke=function(e){this.stroke_=e};ol.style.Text.prototype.setText=function(e){this.text_=e};ol.style.Text.prototype.setTextAlign=function(e){this.textAlign_=e};ol.style.Text.prototype.setTextBaseline=function(e){this.textBaseline_=e};ol.style.Text.prototype.setBackgroundFill=function(e){this.backgroundFill_=e};ol.style.Text.prototype.setBackgroundStroke=function(e){this.backgroundStroke_=e};ol.style.Text.prototype.setPadding=function(e){this.padding_=e};goog.provide("ol.format.KML");goog.require("ol");goog.require("ol.Feature");goog.require("ol.array");goog.require("ol.asserts");goog.require("ol.color");goog.require("ol.format.Feature");goog.require("ol.format.XMLFeature");goog.require("ol.format.XSD");goog.require("ol.geom.GeometryCollection");goog.require("ol.geom.GeometryLayout");goog.require("ol.geom.GeometryType");goog.require("ol.geom.LineString");goog.require("ol.geom.MultiLineString");goog.require("ol.geom.MultiPoint");goog.require("ol.geom.MultiPolygon");goog.require("ol.geom.Point");goog.require("ol.geom.Polygon");goog.require("ol.math");goog.require("ol.proj");goog.require("ol.style.Fill");goog.require("ol.style.Icon");goog.require("ol.style.IconAnchorUnits");goog.require("ol.style.IconOrigin");goog.require("ol.style.Stroke");goog.require("ol.style.Style");goog.require("ol.style.Text");goog.require("ol.xml");ol.format.KML=function(e){var t=e||{};ol.format.XMLFeature.call(this);ol.format.KML.DEFAULT_STYLE_ARRAY_||ol.format.KML.createStyleDefaults_();this.defaultDataProjection=ol.proj.get("EPSG:4326");this.defaultStyle_=t.defaultStyle?t.defaultStyle:ol.format.KML.DEFAULT_STYLE_ARRAY_;this.extractStyles_=void 0===t.extractStyles||t.extractStyles;this.writeStyles_=void 0===t.writeStyles||t.writeStyles;this.sharedStyles_={};this.showPointNames_=void 0===t.showPointNames||t.showPointNames};ol.inherits(ol.format.KML,ol.format.XMLFeature);ol.format.KML.GX_NAMESPACE_URIS_=["http://www.google.com/kml/ext/2.2"];ol.format.KML.NAMESPACE_URIS_=[null,"http://earth.google.com/kml/2.0","http://earth.google.com/kml/2.1","http://earth.google.com/kml/2.2","http://www.opengis.net/kml/2.2"];ol.format.KML.SCHEMA_LOCATION_="http://www.opengis.net/kml/2.2 https://developers.google.com/kml/schema/kml22gx.xsd";ol.format.KML.createStyleDefaults_=function(){ol.format.KML.DEFAULT_COLOR_=[255,255,255,1];ol.format.KML.DEFAULT_FILL_STYLE_=new ol.style.Fill({color:ol.format.KML.DEFAULT_COLOR_});ol.format.KML.DEFAULT_IMAGE_STYLE_ANCHOR_=[20,2];ol.format.KML.DEFAULT_IMAGE_STYLE_ANCHOR_X_UNITS_=ol.style.IconAnchorUnits.PIXELS;ol.format.KML.DEFAULT_IMAGE_STYLE_ANCHOR_Y_UNITS_=ol.style.IconAnchorUnits.PIXELS;ol.format.KML.DEFAULT_IMAGE_STYLE_SIZE_=[64,64];ol.format.KML.DEFAULT_IMAGE_STYLE_SRC_="https://maps.google.com/mapfiles/kml/pushpin/ylw-pushpin.png";ol.format.KML.DEFAULT_IMAGE_SCALE_MULTIPLIER_=.5;ol.format.KML.DEFAULT_IMAGE_STYLE_=new ol.style.Icon({anchor:ol.format.KML.DEFAULT_IMAGE_STYLE_ANCHOR_,anchorOrigin:ol.style.IconOrigin.BOTTOM_LEFT,anchorXUnits:ol.format.KML.DEFAULT_IMAGE_STYLE_ANCHOR_X_UNITS_,anchorYUnits:ol.format.KML.DEFAULT_IMAGE_STYLE_ANCHOR_Y_UNITS_,crossOrigin:"anonymous",rotation:0,scale:ol.format.KML.DEFAULT_IMAGE_SCALE_MULTIPLIER_,size:ol.format.KML.DEFAULT_IMAGE_STYLE_SIZE_,src:ol.format.KML.DEFAULT_IMAGE_STYLE_SRC_});ol.format.KML.DEFAULT_NO_IMAGE_STYLE_="NO_IMAGE";ol.format.KML.DEFAULT_STROKE_STYLE_=new ol.style.Stroke({color:ol.format.KML.DEFAULT_COLOR_,width:1});ol.format.KML.DEFAULT_TEXT_STROKE_STYLE_=new ol.style.Stroke({color:[51,51,51,1],width:2});ol.format.KML.DEFAULT_TEXT_STYLE_=new ol.style.Text({font:"bold 16px Helvetica",fill:ol.format.KML.DEFAULT_FILL_STYLE_,stroke:ol.format.KML.DEFAULT_TEXT_STROKE_STYLE_,scale:.8});ol.format.KML.DEFAULT_STYLE_=new ol.style.Style({fill:ol.format.KML.DEFAULT_FILL_STYLE_,image:ol.format.KML.DEFAULT_IMAGE_STYLE_,text:ol.format.KML.DEFAULT_TEXT_STYLE_,stroke:ol.format.KML.DEFAULT_STROKE_STYLE_,zIndex:0});ol.format.KML.DEFAULT_STYLE_ARRAY_=[ol.format.KML.DEFAULT_STYLE_];return ol.format.KML.DEFAULT_STYLE_ARRAY_};ol.format.KML.ICON_ANCHOR_UNITS_MAP_={fraction:ol.style.IconAnchorUnits.FRACTION,pixels:ol.style.IconAnchorUnits.PIXELS,insetPixels:ol.style.IconAnchorUnits.PIXELS};ol.format.KML.createNameStyleFunction_=function(e,t){var o=null,r=[0,0],i="start";if(e.getImage()){var n=e.getImage().getImageSize();null===n&&(n=ol.format.KML.DEFAULT_IMAGE_STYLE_SIZE_);if(2==n.length){var a=e.getImage().getScale();r[0]=a*n[0]/2;r[1]=-a*n[1]/2;i="left"}}if(null!==e.getText()){var l=e.getText();(o=l.clone()).setFont(l.getFont()||ol.format.KML.DEFAULT_TEXT_STYLE_.getFont());o.setScale(l.getScale()||ol.format.KML.DEFAULT_TEXT_STYLE_.getScale());o.setFill(l.getFill()||ol.format.KML.DEFAULT_TEXT_STYLE_.getFill());o.setStroke(l.getStroke()||ol.format.KML.DEFAULT_TEXT_STROKE_STYLE_)}else o=ol.format.KML.DEFAULT_TEXT_STYLE_.clone();o.setText(t);o.setOffsetX(r[0]);o.setOffsetY(r[1]);o.setTextAlign(i);return new ol.style.Style({text:o})};ol.format.KML.createFeatureStyleFunction_=function(e,t,o,r,i){return function(n){var a,l=i,s="";l&&this.getGeometry()&&(l=this.getGeometry().getType()===ol.geom.GeometryType.POINT);if(l){s=this.get("name");l=l&&s}if(e){if(l){a=ol.format.KML.createNameStyleFunction_(e[0],s);return e.concat(a)}return e}if(t){var p=ol.format.KML.findStyle_(t,o,r);if(l){a=ol.format.KML.createNameStyleFunction_(p[0],s);return p.concat(a)}return p}if(l){a=ol.format.KML.createNameStyleFunction_(o[0],s);return o.concat(a)}return o}};ol.format.KML.findStyle_=function(e,t,o){if(Array.isArray(e))return e;if("string"==typeof e){!(e in o)&&"#"+e in o&&(e="#"+e);return ol.format.KML.findStyle_(o[e],t,o)}return t};ol.format.KML.readColor_=function(e){var t=ol.xml.getAllTextContent(e,!1),o=/^\s*#?\s*([0-9A-Fa-f]{8})\s*$/.exec(t);if(o){var r=o[1];return[parseInt(r.substr(6,2),16),parseInt(r.substr(4,2),16),parseInt(r.substr(2,2),16),parseInt(r.substr(0,2),16)/255]}};ol.format.KML.readFlatCoordinates_=function(e){for(var t,o=ol.xml.getAllTextContent(e,!1),r=[],i=/^\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)\s*,\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)(?:\s*,\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?))?\s*/i;t=i.exec(o);){var n=parseFloat(t[1]),a=parseFloat(t[2]),l=t[3]?parseFloat(t[3]):0;r.push(n,a,l);o=o.substr(t[0].length)}if(""===o)return r};ol.format.KML.readURI_=function(e){var t=ol.xml.getAllTextContent(e,!1).trim(),o=e.baseURI;o&&"about:blank"!=o||(o=window.location.href);if(o){return new URL(t,o).href}return t};ol.format.KML.readVec2_=function(e){var t,o=e.getAttribute("xunits"),r=e.getAttribute("yunits");t="insetPixels"!==o?"insetPixels"!==r?ol.style.IconOrigin.BOTTOM_LEFT:ol.style.IconOrigin.TOP_LEFT:"insetPixels"!==r?ol.style.IconOrigin.BOTTOM_RIGHT:ol.style.IconOrigin.TOP_RIGHT;return{x:parseFloat(e.getAttribute("x")),xunits:ol.format.KML.ICON_ANCHOR_UNITS_MAP_[o],y:parseFloat(e.getAttribute("y")),yunits:ol.format.KML.ICON_ANCHOR_UNITS_MAP_[r],origin:t}};ol.format.KML.readScale_=function(e){return ol.format.XSD.readDecimal(e)};ol.format.KML.readStyleMapValue_=function(e,t){return ol.xml.pushParseAndPop(void 0,ol.format.KML.STYLE_MAP_PARSERS_,e,t)};ol.format.KML.IconStyleParser_=function(e,t){var o=ol.xml.pushParseAndPop({},ol.format.KML.ICON_STYLE_PARSERS_,e,t);if(o){var r,i,n,a,l=t[t.length-1],s="Icon"in o?o.Icon:{},p=!("Icon"in o)||Object.keys(s).length>0,c=s.href;c?r=c:p&&(r=ol.format.KML.DEFAULT_IMAGE_STYLE_SRC_);var u,g=ol.style.IconOrigin.BOTTOM_LEFT,d=o.hotSpot;if(d){i=[d.x,d.y];n=d.xunits;a=d.yunits;g=d.origin}else if(r===ol.format.KML.DEFAULT_IMAGE_STYLE_SRC_){i=ol.format.KML.DEFAULT_IMAGE_STYLE_ANCHOR_;n=ol.format.KML.DEFAULT_IMAGE_STYLE_ANCHOR_X_UNITS_;a=ol.format.KML.DEFAULT_IMAGE_STYLE_ANCHOR_Y_UNITS_}else if(/^http:\/\/maps\.(?:google|gstatic)\.com\//.test(r)){i=[.5,0];n=ol.style.IconAnchorUnits.FRACTION;a=ol.style.IconAnchorUnits.FRACTION}var h,f=s.x,y=s.y;void 0!==f&&void 0!==y&&(u=[f,y]);var m,v=s.w,C=s.h;void 0!==v&&void 0!==C&&(h=[v,C]);var T=o.heading;void 0!==T&&(m=ol.math.toRadians(T));var S=o.scale;if(p){if(r==ol.format.KML.DEFAULT_IMAGE_STYLE_SRC_){h=ol.format.KML.DEFAULT_IMAGE_STYLE_SIZE_;void 0===S&&(S=ol.format.KML.DEFAULT_IMAGE_SCALE_MULTIPLIER_)}var _=new ol.style.Icon({anchor:i,anchorOrigin:g,anchorXUnits:n,anchorYUnits:a,crossOrigin:"anonymous",offset:u,offsetOrigin:ol.style.IconOrigin.BOTTOM_LEFT,rotation:m,scale:S,size:h,src:r});l.imageStyle=_}else l.imageStyle=ol.format.KML.DEFAULT_NO_IMAGE_STYLE_}};ol.format.KML.LabelStyleParser_=function(e,t){var o=ol.xml.pushParseAndPop({},ol.format.KML.LABEL_STYLE_PARSERS_,e,t);if(o){var r=t[t.length-1],i=new ol.style.Text({fill:new ol.style.Fill({color:"color"in o?o.color:ol.format.KML.DEFAULT_COLOR_}),scale:o.scale});r.textStyle=i}};ol.format.KML.LineStyleParser_=function(e,t){var o=ol.xml.pushParseAndPop({},ol.format.KML.LINE_STYLE_PARSERS_,e,t);if(o){var r=t[t.length-1],i=new ol.style.Stroke({color:"color"in o?o.color:ol.format.KML.DEFAULT_COLOR_,width:"width"in o?o.width:1});r.strokeStyle=i}};ol.format.KML.PolyStyleParser_=function(e,t){var o=ol.xml.pushParseAndPop({},ol.format.KML.POLY_STYLE_PARSERS_,e,t);if(o){var r=t[t.length-1],i=new ol.style.Fill({color:"color"in o?o.color:ol.format.KML.DEFAULT_COLOR_});r.fillStyle=i;var n=o.fill;void 0!==n&&(r.fill=n);var a=o.outline;void 0!==a&&(r.outline=a)}};ol.format.KML.readFlatLinearRing_=function(e,t){return ol.xml.pushParseAndPop(null,ol.format.KML.FLAT_LINEAR_RING_PARSERS_,e,t)};ol.format.KML.gxCoordParser_=function(e,t){var o=t[t.length-1].flatCoordinates,r=ol.xml.getAllTextContent(e,!1),i=/^\s*([+\-]?\d+(?:\.\d*)?(?:e[+\-]?\d*)?)\s+([+\-]?\d+(?:\.\d*)?(?:e[+\-]?\d*)?)\s+([+\-]?\d+(?:\.\d*)?(?:e[+\-]?\d*)?)\s*$/i.exec(r);if(i){var n=parseFloat(i[1]),a=parseFloat(i[2]),l=parseFloat(i[3]);o.push(n,a,l,0)}else o.push(0,0,0,0)};ol.format.KML.readGxMultiTrack_=function(e,t){var o=ol.xml.pushParseAndPop([],ol.format.KML.GX_MULTITRACK_GEOMETRY_PARSERS_,e,t);if(o){var r=new ol.geom.MultiLineString(null);r.setLineStrings(o);return r}};ol.format.KML.readGxTrack_=function(e,t){var o=ol.xml.pushParseAndPop({flatCoordinates:[],whens:[]},ol.format.KML.GX_TRACK_PARSERS_,e,t);if(o){var r,i,n=o.flatCoordinates,a=o.whens;for(r=0,i=Math.min(n.length,a.length);r<i;++r)n[4*r+3]=a[r];var l=new ol.geom.LineString(null);l.setFlatCoordinates(ol.geom.GeometryLayout.XYZM,n);return l}};ol.format.KML.readIcon_=function(e,t){var o=ol.xml.pushParseAndPop({},ol.format.KML.ICON_PARSERS_,e,t);return o||null};ol.format.KML.readFlatCoordinatesFromNode_=function(e,t){return ol.xml.pushParseAndPop(null,ol.format.KML.GEOMETRY_FLAT_COORDINATES_PARSERS_,e,t)};ol.format.KML.readLineString_=function(e,t){var o=ol.xml.pushParseAndPop({},ol.format.KML.EXTRUDE_AND_ALTITUDE_MODE_PARSERS_,e,t),r=ol.format.KML.readFlatCoordinatesFromNode_(e,t);if(r){var i=new ol.geom.LineString(null);i.setFlatCoordinates(ol.geom.GeometryLayout.XYZ,r);i.setProperties(o);return i}};ol.format.KML.readLinearRing_=function(e,t){var o=ol.xml.pushParseAndPop({},ol.format.KML.EXTRUDE_AND_ALTITUDE_MODE_PARSERS_,e,t),r=ol.format.KML.readFlatCoordinatesFromNode_(e,t);if(r){var i=new ol.geom.Polygon(null);i.setFlatCoordinates(ol.geom.GeometryLayout.XYZ,r,[r.length]);i.setProperties(o);return i}};ol.format.KML.readMultiGeometry_=function(e,t){var o,r=ol.xml.pushParseAndPop([],ol.format.KML.MULTI_GEOMETRY_PARSERS_,e,t);if(!r)return null;if(0===r.length)return new ol.geom.GeometryCollection(r);var i,n,a,l=!0,s=r[0].getType();for(n=1,a=r.length;n<a;++n)if((i=r[n]).getType()!=s){l=!1;break}if(l){var p,c;if(s==ol.geom.GeometryType.POINT){var u=r[0];p=u.getLayout();c=u.getFlatCoordinates();for(n=1,a=r.length;n<a;++n){i=r[n];ol.array.extend(c,i.getFlatCoordinates())}(o=new ol.geom.MultiPoint(null)).setFlatCoordinates(p,c);ol.format.KML.setCommonGeometryProperties_(o,r)}else if(s==ol.geom.GeometryType.LINE_STRING){(o=new ol.geom.MultiLineString(null)).setLineStrings(r);ol.format.KML.setCommonGeometryProperties_(o,r)}else if(s==ol.geom.GeometryType.POLYGON){(o=new ol.geom.MultiPolygon(null)).setPolygons(r);ol.format.KML.setCommonGeometryProperties_(o,r)}else s==ol.geom.GeometryType.GEOMETRY_COLLECTION?o=new ol.geom.GeometryCollection(r):ol.asserts.assert(!1,37)}else o=new ol.geom.GeometryCollection(r);return o};ol.format.KML.readPoint_=function(e,t){var o=ol.xml.pushParseAndPop({},ol.format.KML.EXTRUDE_AND_ALTITUDE_MODE_PARSERS_,e,t),r=ol.format.KML.readFlatCoordinatesFromNode_(e,t);if(r){var i=new ol.geom.Point(null);i.setFlatCoordinates(ol.geom.GeometryLayout.XYZ,r);i.setProperties(o);return i}};ol.format.KML.readPolygon_=function(e,t){var o=ol.xml.pushParseAndPop({},ol.format.KML.EXTRUDE_AND_ALTITUDE_MODE_PARSERS_,e,t),r=ol.xml.pushParseAndPop([null],ol.format.KML.FLAT_LINEAR_RINGS_PARSERS_,e,t);if(r&&r[0]){var i,n,a=new ol.geom.Polygon(null),l=r[0],s=[l.length];for(i=1,n=r.length;i<n;++i){ol.array.extend(l,r[i]);s.push(l.length)}a.setFlatCoordinates(ol.geom.GeometryLayout.XYZ,l,s);a.setProperties(o);return a}};ol.format.KML.readStyle_=function(e,t){var o=ol.xml.pushParseAndPop({},ol.format.KML.STYLE_PARSERS_,e,t);if(!o)return null;var r="fillStyle"in o?o.fillStyle:ol.format.KML.DEFAULT_FILL_STYLE_,i=o.fill;void 0===i||i||(r=null);var n="imageStyle"in o?o.imageStyle:ol.format.KML.DEFAULT_IMAGE_STYLE_;n==ol.format.KML.DEFAULT_NO_IMAGE_STYLE_&&(n=void 0);var a="textStyle"in o?o.textStyle:ol.format.KML.DEFAULT_TEXT_STYLE_,l="strokeStyle"in o?o.strokeStyle:ol.format.KML.DEFAULT_STROKE_STYLE_,s=o.outline;void 0===s||s||(l=null);return[new ol.style.Style({fill:r,image:n,stroke:l,text:a,zIndex:void 0})]};ol.format.KML.setCommonGeometryProperties_=function(e,t){var o,r,i,n,a,l=t.length,s=new Array(t.length),p=new Array(t.length),c=new Array(t.length);i=n=a=!1;for(r=0;r<l;++r){o=t[r];s[r]=o.get("extrude");p[r]=o.get("tessellate");c[r]=o.get("altitudeMode");i=i||void 0!==s[r];n=n||void 0!==p[r];a=a||c[r]}i&&e.set("extrude",s);n&&e.set("tessellate",p);a&&e.set("altitudeMode",c)};ol.format.KML.DataParser_=function(e,t){var o=e.getAttribute("name");ol.xml.parseNode(ol.format.KML.DATA_PARSERS_,e,t);var r=t[t.length-1];null!==o?r[o]=r.value:null!==r.displayName&&(r[r.displayName]=r.value);delete r.value};ol.format.KML.ExtendedDataParser_=function(e,t){ol.xml.parseNode(ol.format.KML.EXTENDED_DATA_PARSERS_,e,t)};ol.format.KML.RegionParser_=function(e,t){ol.xml.parseNode(ol.format.KML.REGION_PARSERS_,e,t)};ol.format.KML.PairDataParser_=function(e,t){var o=ol.xml.pushParseAndPop({},ol.format.KML.PAIR_PARSERS_,e,t);if(o){var r=o.key;if(r&&"normal"==r){var i=o.styleUrl;i&&(t[t.length-1]=i);var n=o.Style;n&&(t[t.length-1]=n)}}};ol.format.KML.PlacemarkStyleMapParser_=function(e,t){var o=ol.format.KML.readStyleMapValue_(e,t);if(o){var r=t[t.length-1];Array.isArray(o)?r.Style=o:"string"==typeof o?r.styleUrl=o:ol.asserts.assert(!1,38)}};ol.format.KML.SchemaDataParser_=function(e,t){ol.xml.parseNode(ol.format.KML.SCHEMA_DATA_PARSERS_,e,t)};ol.format.KML.SimpleDataParser_=function(e,t){var o=e.getAttribute("name");if(null!==o){var r=ol.format.XSD.readString(e);t[t.length-1][o]=r}};ol.format.KML.LatLonAltBoxParser_=function(e,t){var o=ol.xml.pushParseAndPop({},ol.format.KML.LAT_LON_ALT_BOX_PARSERS_,e,t);if(o){var r=t[t.length-1],i=[parseFloat(o.west),parseFloat(o.south),parseFloat(o.east),parseFloat(o.north)];r.extent=i;r.altitudeMode=o.altitudeMode;r.minAltitude=parseFloat(o.minAltitude);r.maxAltitude=parseFloat(o.maxAltitude)}};ol.format.KML.LodParser_=function(e,t){var o=ol.xml.pushParseAndPop({},ol.format.KML.LOD_PARSERS_,e,t);if(o){var r=t[t.length-1];r.minLodPixels=parseFloat(o.minLodPixels);r.maxLodPixels=parseFloat(o.maxLodPixels);r.minFadeExtent=parseFloat(o.minFadeExtent);r.maxFadeExtent=parseFloat(o.maxFadeExtent)}};ol.format.KML.innerBoundaryIsParser_=function(e,t){var o=ol.xml.pushParseAndPop(void 0,ol.format.KML.INNER_BOUNDARY_IS_PARSERS_,e,t);if(o){t[t.length-1].push(o)}};ol.format.KML.outerBoundaryIsParser_=function(e,t){var o=ol.xml.pushParseAndPop(void 0,ol.format.KML.OUTER_BOUNDARY_IS_PARSERS_,e,t);if(o){t[t.length-1][0]=o}};ol.format.KML.LinkParser_=function(e,t){ol.xml.parseNode(ol.format.KML.LINK_PARSERS_,e,t)};ol.format.KML.whenParser_=function(e,t){var o=t[t.length-1].whens,r=ol.xml.getAllTextContent(e,!1),i=Date.parse(r);o.push(isNaN(i)?0:i)};ol.format.KML.DATA_PARSERS_=ol.xml.makeStructureNS(ol.format.KML.NAMESPACE_URIS_,{displayName:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),value:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString)});ol.format.KML.EXTENDED_DATA_PARSERS_=ol.xml.makeStructureNS(ol.format.KML.NAMESPACE_URIS_,{Data:ol.format.KML.DataParser_,SchemaData:ol.format.KML.SchemaDataParser_});ol.format.KML.REGION_PARSERS_=ol.xml.makeStructureNS(ol.format.KML.NAMESPACE_URIS_,{LatLonAltBox:ol.format.KML.LatLonAltBoxParser_,Lod:ol.format.KML.LodParser_});ol.format.KML.LAT_LON_ALT_BOX_PARSERS_=ol.xml.makeStructureNS(ol.format.KML.NAMESPACE_URIS_,{altitudeMode:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),minAltitude:ol.xml.makeObjectPropertySetter(ol.format.XSD.readDecimal),maxAltitude:ol.xml.makeObjectPropertySetter(ol.format.XSD.readDecimal),north:ol.xml.makeObjectPropertySetter(ol.format.XSD.readDecimal),south:ol.xml.makeObjectPropertySetter(ol.format.XSD.readDecimal),east:ol.xml.makeObjectPropertySetter(ol.format.XSD.readDecimal),west:ol.xml.makeObjectPropertySetter(ol.format.XSD.readDecimal)});ol.format.KML.LOD_PARSERS_=ol.xml.makeStructureNS(ol.format.KML.NAMESPACE_URIS_,{minLodPixels:ol.xml.makeObjectPropertySetter(ol.format.XSD.readDecimal),maxLodPixels:ol.xml.makeObjectPropertySetter(ol.format.XSD.readDecimal),minFadeExtent:ol.xml.makeObjectPropertySetter(ol.format.XSD.readDecimal),maxFadeExtent:ol.xml.makeObjectPropertySetter(ol.format.XSD.readDecimal)});ol.format.KML.EXTRUDE_AND_ALTITUDE_MODE_PARSERS_=ol.xml.makeStructureNS(ol.format.KML.NAMESPACE_URIS_,{extrude:ol.xml.makeObjectPropertySetter(ol.format.XSD.readBoolean),tessellate:ol.xml.makeObjectPropertySetter(ol.format.XSD.readBoolean),altitudeMode:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString)});ol.format.KML.FLAT_LINEAR_RING_PARSERS_=ol.xml.makeStructureNS(ol.format.KML.NAMESPACE_URIS_,{coordinates:ol.xml.makeReplacer(ol.format.KML.readFlatCoordinates_)});ol.format.KML.FLAT_LINEAR_RINGS_PARSERS_=ol.xml.makeStructureNS(ol.format.KML.NAMESPACE_URIS_,{innerBoundaryIs:ol.format.KML.innerBoundaryIsParser_,outerBoundaryIs:ol.format.KML.outerBoundaryIsParser_});ol.format.KML.GX_TRACK_PARSERS_=ol.xml.makeStructureNS(ol.format.KML.NAMESPACE_URIS_,{when:ol.format.KML.whenParser_},ol.xml.makeStructureNS(ol.format.KML.GX_NAMESPACE_URIS_,{coord:ol.format.KML.gxCoordParser_}));ol.format.KML.GEOMETRY_FLAT_COORDINATES_PARSERS_=ol.xml.makeStructureNS(ol.format.KML.NAMESPACE_URIS_,{coordinates:ol.xml.makeReplacer(ol.format.KML.readFlatCoordinates_)});ol.format.KML.ICON_PARSERS_=ol.xml.makeStructureNS(ol.format.KML.NAMESPACE_URIS_,{href:ol.xml.makeObjectPropertySetter(ol.format.KML.readURI_)},ol.xml.makeStructureNS(ol.format.KML.GX_NAMESPACE_URIS_,{x:ol.xml.makeObjectPropertySetter(ol.format.XSD.readDecimal),y:ol.xml.makeObjectPropertySetter(ol.format.XSD.readDecimal),w:ol.xml.makeObjectPropertySetter(ol.format.XSD.readDecimal),h:ol.xml.makeObjectPropertySetter(ol.format.XSD.readDecimal)}));ol.format.KML.ICON_STYLE_PARSERS_=ol.xml.makeStructureNS(ol.format.KML.NAMESPACE_URIS_,{Icon:ol.xml.makeObjectPropertySetter(ol.format.KML.readIcon_),heading:ol.xml.makeObjectPropertySetter(ol.format.XSD.readDecimal),hotSpot:ol.xml.makeObjectPropertySetter(ol.format.KML.readVec2_),scale:ol.xml.makeObjectPropertySetter(ol.format.KML.readScale_)});ol.format.KML.INNER_BOUNDARY_IS_PARSERS_=ol.xml.makeStructureNS(ol.format.KML.NAMESPACE_URIS_,{LinearRing:ol.xml.makeReplacer(ol.format.KML.readFlatLinearRing_)});ol.format.KML.LABEL_STYLE_PARSERS_=ol.xml.makeStructureNS(ol.format.KML.NAMESPACE_URIS_,{color:ol.xml.makeObjectPropertySetter(ol.format.KML.readColor_),scale:ol.xml.makeObjectPropertySetter(ol.format.KML.readScale_)});ol.format.KML.LINE_STYLE_PARSERS_=ol.xml.makeStructureNS(ol.format.KML.NAMESPACE_URIS_,{color:ol.xml.makeObjectPropertySetter(ol.format.KML.readColor_),width:ol.xml.makeObjectPropertySetter(ol.format.XSD.readDecimal)});ol.format.KML.MULTI_GEOMETRY_PARSERS_=ol.xml.makeStructureNS(ol.format.KML.NAMESPACE_URIS_,{LineString:ol.xml.makeArrayPusher(ol.format.KML.readLineString_),LinearRing:ol.xml.makeArrayPusher(ol.format.KML.readLinearRing_),MultiGeometry:ol.xml.makeArrayPusher(ol.format.KML.readMultiGeometry_),Point:ol.xml.makeArrayPusher(ol.format.KML.readPoint_),Polygon:ol.xml.makeArrayPusher(ol.format.KML.readPolygon_)});ol.format.KML.GX_MULTITRACK_GEOMETRY_PARSERS_=ol.xml.makeStructureNS(ol.format.KML.GX_NAMESPACE_URIS_,{Track:ol.xml.makeArrayPusher(ol.format.KML.readGxTrack_)});ol.format.KML.NETWORK_LINK_PARSERS_=ol.xml.makeStructureNS(ol.format.KML.NAMESPACE_URIS_,{ExtendedData:ol.format.KML.ExtendedDataParser_,Region:ol.format.KML.RegionParser_,Link:ol.format.KML.LinkParser_,address:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),description:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),name:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),open:ol.xml.makeObjectPropertySetter(ol.format.XSD.readBoolean),phoneNumber:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),visibility:ol.xml.makeObjectPropertySetter(ol.format.XSD.readBoolean)});ol.format.KML.LINK_PARSERS_=ol.xml.makeStructureNS(ol.format.KML.NAMESPACE_URIS_,{href:ol.xml.makeObjectPropertySetter(ol.format.KML.readURI_)});ol.format.KML.OUTER_BOUNDARY_IS_PARSERS_=ol.xml.makeStructureNS(ol.format.KML.NAMESPACE_URIS_,{LinearRing:ol.xml.makeReplacer(ol.format.KML.readFlatLinearRing_)});ol.format.KML.PAIR_PARSERS_=ol.xml.makeStructureNS(ol.format.KML.NAMESPACE_URIS_,{Style:ol.xml.makeObjectPropertySetter(ol.format.KML.readStyle_),key:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),styleUrl:ol.xml.makeObjectPropertySetter(ol.format.KML.readURI_)});ol.format.KML.PLACEMARK_PARSERS_=ol.xml.makeStructureNS(ol.format.KML.NAMESPACE_URIS_,{ExtendedData:ol.format.KML.ExtendedDataParser_,Region:ol.format.KML.RegionParser_,MultiGeometry:ol.xml.makeObjectPropertySetter(ol.format.KML.readMultiGeometry_,"geometry"),LineString:ol.xml.makeObjectPropertySetter(ol.format.KML.readLineString_,"geometry"),LinearRing:ol.xml.makeObjectPropertySetter(ol.format.KML.readLinearRing_,"geometry"),Point:ol.xml.makeObjectPropertySetter(ol.format.KML.readPoint_,"geometry"),Polygon:ol.xml.makeObjectPropertySetter(ol.format.KML.readPolygon_,"geometry"),Style:ol.xml.makeObjectPropertySetter(ol.format.KML.readStyle_),StyleMap:ol.format.KML.PlacemarkStyleMapParser_,address:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),description:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),name:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),open:ol.xml.makeObjectPropertySetter(ol.format.XSD.readBoolean),phoneNumber:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),styleUrl:ol.xml.makeObjectPropertySetter(ol.format.KML.readURI_),visibility:ol.xml.makeObjectPropertySetter(ol.format.XSD.readBoolean)},ol.xml.makeStructureNS(ol.format.KML.GX_NAMESPACE_URIS_,{MultiTrack:ol.xml.makeObjectPropertySetter(ol.format.KML.readGxMultiTrack_,"geometry"),Track:ol.xml.makeObjectPropertySetter(ol.format.KML.readGxTrack_,"geometry")}));ol.format.KML.POLY_STYLE_PARSERS_=ol.xml.makeStructureNS(ol.format.KML.NAMESPACE_URIS_,{color:ol.xml.makeObjectPropertySetter(ol.format.KML.readColor_),fill:ol.xml.makeObjectPropertySetter(ol.format.XSD.readBoolean),outline:ol.xml.makeObjectPropertySetter(ol.format.XSD.readBoolean)});ol.format.KML.SCHEMA_DATA_PARSERS_=ol.xml.makeStructureNS(ol.format.KML.NAMESPACE_URIS_,{SimpleData:ol.format.KML.SimpleDataParser_});ol.format.KML.STYLE_PARSERS_=ol.xml.makeStructureNS(ol.format.KML.NAMESPACE_URIS_,{IconStyle:ol.format.KML.IconStyleParser_,LabelStyle:ol.format.KML.LabelStyleParser_,LineStyle:ol.format.KML.LineStyleParser_,PolyStyle:ol.format.KML.PolyStyleParser_});ol.format.KML.STYLE_MAP_PARSERS_=ol.xml.makeStructureNS(ol.format.KML.NAMESPACE_URIS_,{Pair:ol.format.KML.PairDataParser_});ol.format.KML.prototype.readDocumentOrFolder_=function(e,t){var o=ol.xml.makeStructureNS(ol.format.KML.NAMESPACE_URIS_,{Document:ol.xml.makeArrayExtender(this.readDocumentOrFolder_,this),Folder:ol.xml.makeArrayExtender(this.readDocumentOrFolder_,this),Placemark:ol.xml.makeArrayPusher(this.readPlacemark_,this),Style:this.readSharedStyle_.bind(this),StyleMap:this.readSharedStyleMap_.bind(this)}),r=ol.xml.pushParseAndPop([],o,e,t,this);return r||void 0};ol.format.KML.prototype.readPlacemark_=function(e,t){var o=ol.xml.pushParseAndPop({geometry:null},ol.format.KML.PLACEMARK_PARSERS_,e,t);if(o){var r=new ol.Feature,i=e.getAttribute("id");null!==i&&r.setId(i);var n=t[0],a=o.geometry;a&&ol.format.Feature.transformWithOptions(a,!1,n);r.setGeometry(a);delete o.geometry;if(this.extractStyles_){var l=o.Style,s=o.styleUrl,p=ol.format.KML.createFeatureStyleFunction_(l,s,this.defaultStyle_,this.sharedStyles_,this.showPointNames_);r.setStyle(p)}delete o.Style;r.setProperties(o);return r}};ol.format.KML.prototype.readSharedStyle_=function(e,t){var o=e.getAttribute("id");if(null!==o){var r=ol.format.KML.readStyle_(e,t);if(r){var i,n=e.baseURI;n&&"about:blank"!=n||(n=window.location.href);if(n){i=new URL("#"+o,n).href}else i="#"+o;this.sharedStyles_[i]=r}}};ol.format.KML.prototype.readSharedStyleMap_=function(e,t){var o=e.getAttribute("id");if(null!==o){var r=ol.format.KML.readStyleMapValue_(e,t);if(r){var i,n=e.baseURI;n&&"about:blank"!=n||(n=window.location.href);if(n){i=new URL("#"+o,n).href}else i="#"+o;this.sharedStyles_[i]=r}}};ol.format.KML.prototype.readFeature;ol.format.KML.prototype.readFeatureFromNode=function(e,t){if(!ol.array.includes(ol.format.KML.NAMESPACE_URIS_,e.namespaceURI))return null;var o=this.readPlacemark_(e,[this.getReadOptions(e,t)]);return o||null};ol.format.KML.prototype.readFeatures;ol.format.KML.prototype.readFeaturesFromNode=function(e,t){if(!ol.array.includes(ol.format.KML.NAMESPACE_URIS_,e.namespaceURI))return[];var o,r=e.localName;if("Document"==r||"Folder"==r)return(o=this.readDocumentOrFolder_(e,[this.getReadOptions(e,t)]))||[];if("Placemark"==r){var i=this.readPlacemark_(e,[this.getReadOptions(e,t)]);return i?[i]:[]}if("kml"==r){o=[];var n;for(n=e.firstElementChild;n;n=n.nextElementSibling){var a=this.readFeaturesFromNode(n,t);a&&ol.array.extend(o,a)}return o}return[]};ol.format.KML.prototype.readName=function(e){if(ol.xml.isDocument(e))return this.readNameFromDocument(e);if(ol.xml.isNode(e))return this.readNameFromNode(e);if("string"==typeof e){var t=ol.xml.parse(e);return this.readNameFromDocument(t)}};ol.format.KML.prototype.readNameFromDocument=function(e){var t;for(t=e.firstChild;t;t=t.nextSibling)if(t.nodeType==Node.ELEMENT_NODE){var o=this.readNameFromNode(t);if(o)return o}};ol.format.KML.prototype.readNameFromNode=function(e){var t;for(t=e.firstElementChild;t;t=t.nextElementSibling)if(ol.array.includes(ol.format.KML.NAMESPACE_URIS_,t.namespaceURI)&&"name"==t.localName)return ol.format.XSD.readString(t);for(t=e.firstElementChild;t;t=t.nextElementSibling){var o=t.localName;if(ol.array.includes(ol.format.KML.NAMESPACE_URIS_,t.namespaceURI)&&("Document"==o||"Folder"==o||"Placemark"==o||"kml"==o)){var r=this.readNameFromNode(t);if(r)return r}}};ol.format.KML.prototype.readNetworkLinks=function(e){var t=[];if(ol.xml.isDocument(e))ol.array.extend(t,this.readNetworkLinksFromDocument(e));else if(ol.xml.isNode(e))ol.array.extend(t,this.readNetworkLinksFromNode(e));else if("string"==typeof e){var o=ol.xml.parse(e);ol.array.extend(t,this.readNetworkLinksFromDocument(o))}return t};ol.format.KML.prototype.readNetworkLinksFromDocument=function(e){var t,o=[];for(t=e.firstChild;t;t=t.nextSibling)t.nodeType==Node.ELEMENT_NODE&&ol.array.extend(o,this.readNetworkLinksFromNode(t));return o};ol.format.KML.prototype.readNetworkLinksFromNode=function(e){var t,o=[];for(t=e.firstElementChild;t;t=t.nextElementSibling)if(ol.array.includes(ol.format.KML.NAMESPACE_URIS_,t.namespaceURI)&&"NetworkLink"==t.localName){var r=ol.xml.pushParseAndPop({},ol.format.KML.NETWORK_LINK_PARSERS_,t,[]);o.push(r)}for(t=e.firstElementChild;t;t=t.nextElementSibling){var i=t.localName;!ol.array.includes(ol.format.KML.NAMESPACE_URIS_,t.namespaceURI)||"Document"!=i&&"Folder"!=i&&"kml"!=i||ol.array.extend(o,this.readNetworkLinksFromNode(t))}return o};ol.format.KML.prototype.readRegion=function(e){var t=[];if(ol.xml.isDocument(e))ol.array.extend(t,this.readRegionFromDocument(e));else if(ol.xml.isNode(e))ol.array.extend(t,this.readRegionFromNode(e));else if("string"==typeof e){var o=ol.xml.parse(e);ol.array.extend(t,this.readRegionFromDocument(o))}return t};ol.format.KML.prototype.readRegionFromDocument=function(e){var t,o=[];for(t=e.firstChild;t;t=t.nextSibling)t.nodeType==Node.ELEMENT_NODE&&ol.array.extend(o,this.readRegionFromNode(t));return o};ol.format.KML.prototype.readRegionFromNode=function(e){var t,o=[];for(t=e.firstElementChild;t;t=t.nextElementSibling)if(ol.array.includes(ol.format.KML.NAMESPACE_URIS_,t.namespaceURI)&&"Region"==t.localName){var r=ol.xml.pushParseAndPop({},ol.format.KML.REGION_PARSERS_,t,[]);o.push(r)}for(t=e.firstElementChild;t;t=t.nextElementSibling){var i=t.localName;!ol.array.includes(ol.format.KML.NAMESPACE_URIS_,t.namespaceURI)||"Document"!=i&&"Folder"!=i&&"kml"!=i||ol.array.extend(o,this.readRegionFromNode(t))}return o};ol.format.KML.prototype.readProjection;ol.format.KML.writeColorTextNode_=function(e,t){var o,r=ol.color.asArray(t),i=[255*(4==r.length?r[3]:1),r[2],r[1],r[0]];for(o=0;o<4;++o){var n=parseInt(i[o],10).toString(16);i[o]=1==n.length?"0"+n:n}ol.format.XSD.writeStringTextNode(e,i.join(""))};ol.format.KML.writeCoordinatesTextNode_=function(e,t,o){var r,i,n,a=o[o.length-1],l=a.layout,s=a.stride;l==ol.geom.GeometryLayout.XY||l==ol.geom.GeometryLayout.XYM?r=2:l==ol.geom.GeometryLayout.XYZ||l==ol.geom.GeometryLayout.XYZM?r=3:ol.asserts.assert(!1,34);var p=t.length,c="";if(p>0){c+=t[0];for(i=1;i<r;++i)c+=","+t[i];for(n=s;n<p;n+=s){c+=" "+t[n];for(i=1;i<r;++i)c+=","+t[n+i]}}ol.format.XSD.writeStringTextNode(e,c)};ol.format.KML.writeDataNode_=function(e,t,o){e.setAttribute("name",t.name);var r={node:e},i=t.value;if("object"==typeof i){null!==i&&i.displayName&&ol.xml.pushSerializeAndPop(r,ol.format.KML.EXTENDEDDATA_NODE_SERIALIZERS_,ol.xml.OBJECT_PROPERTY_NODE_FACTORY,[i.displayName],o,["displayName"]);null!==i&&i.value&&ol.xml.pushSerializeAndPop(r,ol.format.KML.EXTENDEDDATA_NODE_SERIALIZERS_,ol.xml.OBJECT_PROPERTY_NODE_FACTORY,[i.value],o,["value"])}else ol.xml.pushSerializeAndPop(r,ol.format.KML.EXTENDEDDATA_NODE_SERIALIZERS_,ol.xml.OBJECT_PROPERTY_NODE_FACTORY,[i],o,["value"])};ol.format.KML.writeDataNodeName_=function(e,t){ol.format.XSD.writeCDATASection(e,t)};ol.format.KML.writeDataNodeValue_=function(e,t){ol.format.XSD.writeStringTextNode(e,t)};ol.format.KML.writeDocument_=function(e,t,o){var r={node:e};ol.xml.pushSerializeAndPop(r,ol.format.KML.DOCUMENT_SERIALIZERS_,ol.format.KML.DOCUMENT_NODE_FACTORY_,t,o,void 0,this)};ol.format.KML.writeExtendedData_=function(e,t,o){for(var r={node:e},i=t.names,n=t.values,a=i.length,l=0;l<a;l++)ol.xml.pushSerializeAndPop(r,ol.format.KML.EXTENDEDDATA_NODE_SERIALIZERS_,ol.format.KML.DATA_NODE_FACTORY_,[{name:i[l],value:n[l]}],o)};ol.format.KML.writeIcon_=function(e,t,o){var r={node:e},i=o[o.length-1].node,n=ol.format.KML.ICON_SEQUENCE_[i.namespaceURI],a=ol.xml.makeSequence(t,n);ol.xml.pushSerializeAndPop(r,ol.format.KML.ICON_SERIALIZERS_,ol.xml.OBJECT_PROPERTY_NODE_FACTORY,a,o,n);n=ol.format.KML.ICON_SEQUENCE_[ol.format.KML.GX_NAMESPACE_URIS_[0]];a=ol.xml.makeSequence(t,n);ol.xml.pushSerializeAndPop(r,ol.format.KML.ICON_SERIALIZERS_,ol.format.KML.GX_NODE_FACTORY_,a,o,n)};ol.format.KML.writeIconStyle_=function(e,t,o){var r={node:e},i={},n=t.getSrc(),a=t.getSize(),l=t.getImageSize(),s={href:n};if(a){s.w=a[0];s.h=a[1];var p=t.getAnchor(),c=t.getOrigin();if(c&&l&&0!==c[0]&&c[1]!==a[1]){s.x=c[0];s.y=l[1]-(c[1]+a[1])}if(p&&(p[0]!==a[0]/2||p[1]!==a[1]/2)){var u={x:p[0],xunits:ol.style.IconAnchorUnits.PIXELS,y:a[1]-p[1],yunits:ol.style.IconAnchorUnits.PIXELS};i.hotSpot=u}}i.Icon=s;var g=t.getScale();1!==g&&(i.scale=g);var d=t.getRotation();0!==d&&(i.heading=d);var h=o[o.length-1].node,f=ol.format.KML.ICON_STYLE_SEQUENCE_[h.namespaceURI],y=ol.xml.makeSequence(i,f);ol.xml.pushSerializeAndPop(r,ol.format.KML.ICON_STYLE_SERIALIZERS_,ol.xml.OBJECT_PROPERTY_NODE_FACTORY,y,o,f)};ol.format.KML.writeLabelStyle_=function(e,t,o){var r={node:e},i={},n=t.getFill();n&&(i.color=n.getColor());var a=t.getScale();a&&1!==a&&(i.scale=a);var l=o[o.length-1].node,s=ol.format.KML.LABEL_STYLE_SEQUENCE_[l.namespaceURI],p=ol.xml.makeSequence(i,s);ol.xml.pushSerializeAndPop(r,ol.format.KML.LABEL_STYLE_SERIALIZERS_,ol.xml.OBJECT_PROPERTY_NODE_FACTORY,p,o,s)};ol.format.KML.writeLineStyle_=function(e,t,o){var r={node:e},i={color:t.getColor(),width:t.getWidth()},n=o[o.length-1].node,a=ol.format.KML.LINE_STYLE_SEQUENCE_[n.namespaceURI],l=ol.xml.makeSequence(i,a);ol.xml.pushSerializeAndPop(r,ol.format.KML.LINE_STYLE_SERIALIZERS_,ol.xml.OBJECT_PROPERTY_NODE_FACTORY,l,o,a)};ol.format.KML.writeMultiGeometry_=function(e,t,o){var r,i,n={node:e},a=t.getType();if(a==ol.geom.GeometryType.GEOMETRY_COLLECTION){r=t.getGeometries();i=ol.format.KML.GEOMETRY_NODE_FACTORY_}else if(a==ol.geom.GeometryType.MULTI_POINT){r=t.getPoints();i=ol.format.KML.POINT_NODE_FACTORY_}else if(a==ol.geom.GeometryType.MULTI_LINE_STRING){r=t.getLineStrings();i=ol.format.KML.LINE_STRING_NODE_FACTORY_}else if(a==ol.geom.GeometryType.MULTI_POLYGON){r=t.getPolygons();i=ol.format.KML.POLYGON_NODE_FACTORY_}else ol.asserts.assert(!1,39);ol.xml.pushSerializeAndPop(n,ol.format.KML.MULTI_GEOMETRY_SERIALIZERS_,i,r,o)};ol.format.KML.writeBoundaryIs_=function(e,t,o){var r={node:e};ol.xml.pushSerializeAndPop(r,ol.format.KML.BOUNDARY_IS_SERIALIZERS_,ol.format.KML.LINEAR_RING_NODE_FACTORY_,[t],o)};ol.format.KML.writePlacemark_=function(e,t,o){var r={node:e};t.getId()&&e.setAttribute("id",t.getId());var i=t.getProperties(),n={address:1,description:1,name:1,open:1,phoneNumber:1,styleUrl:1,visibility:1};n[t.getGeometryName()]=1;var a=Object.keys(i||{}).sort().filter(function(e){return!n[e]});if(a.length>0){var l={names:a,values:ol.xml.makeSequence(i,a)};ol.xml.pushSerializeAndPop(r,ol.format.KML.PLACEMARK_SERIALIZERS_,ol.format.KML.EXTENDEDDATA_NODE_FACTORY_,[l],o)}var s=t.getStyleFunction();if(s){var p=s.call(t,0);if(p){var c=Array.isArray(p)?p[0]:p;this.writeStyles_&&(i.Style=c);var u=c.getText();u&&(i.name=u.getText())}}var g=o[o.length-1].node,d=ol.format.KML.PLACEMARK_SEQUENCE_[g.namespaceURI],h=ol.xml.makeSequence(i,d);ol.xml.pushSerializeAndPop(r,ol.format.KML.PLACEMARK_SERIALIZERS_,ol.xml.OBJECT_PROPERTY_NODE_FACTORY,h,o,d);var f=o[0],y=t.getGeometry();y&&(y=ol.format.Feature.transformWithOptions(y,!0,f));ol.xml.pushSerializeAndPop(r,ol.format.KML.PLACEMARK_SERIALIZERS_,ol.format.KML.GEOMETRY_NODE_FACTORY_,[y],o)};ol.format.KML.writePrimitiveGeometry_=function(e,t,o){var r=t.getFlatCoordinates(),i={node:e};i.layout=t.getLayout();i.stride=t.getStride();var n=t.getProperties();n.coordinates=r;var a=o[o.length-1].node,l=ol.format.KML.PRIMITIVE_GEOMETRY_SEQUENCE_[a.namespaceURI],s=ol.xml.makeSequence(n,l);ol.xml.pushSerializeAndPop(i,ol.format.KML.PRIMITIVE_GEOMETRY_SERIALIZERS_,ol.xml.OBJECT_PROPERTY_NODE_FACTORY,s,o,l)};ol.format.KML.writePolygon_=function(e,t,o){var r=t.getLinearRings(),i=r.shift(),n={node:e};ol.xml.pushSerializeAndPop(n,ol.format.KML.POLYGON_SERIALIZERS_,ol.format.KML.INNER_BOUNDARY_NODE_FACTORY_,r,o);ol.xml.pushSerializeAndPop(n,ol.format.KML.POLYGON_SERIALIZERS_,ol.format.KML.OUTER_BOUNDARY_NODE_FACTORY_,[i],o)};ol.format.KML.writePolyStyle_=function(e,t,o){var r={node:e};ol.xml.pushSerializeAndPop(r,ol.format.KML.POLY_STYLE_SERIALIZERS_,ol.format.KML.COLOR_NODE_FACTORY_,[t.getColor()],o)};ol.format.KML.writeScaleTextNode_=function(e,t){ol.format.XSD.writeDecimalTextNode(e,Math.round(1e6*t)/1e6)};ol.format.KML.writeStyle_=function(e,t,o){var r={node:e},i={},n=t.getFill(),a=t.getStroke(),l=t.getImage(),s=t.getText();l instanceof ol.style.Icon&&(i.IconStyle=l);s&&(i.LabelStyle=s);a&&(i.LineStyle=a);n&&(i.PolyStyle=n);var p=o[o.length-1].node,c=ol.format.KML.STYLE_SEQUENCE_[p.namespaceURI],u=ol.xml.makeSequence(i,c);ol.xml.pushSerializeAndPop(r,ol.format.KML.STYLE_SERIALIZERS_,ol.xml.OBJECT_PROPERTY_NODE_FACTORY,u,o,c)};ol.format.KML.writeVec2_=function(e,t){e.setAttribute("x",t.x);e.setAttribute("y",t.y);e.setAttribute("xunits",t.xunits);e.setAttribute("yunits",t.yunits)};ol.format.KML.KML_SEQUENCE_=ol.xml.makeStructureNS(ol.format.KML.NAMESPACE_URIS_,["Document","Placemark"]);ol.format.KML.KML_SERIALIZERS_=ol.xml.makeStructureNS(ol.format.KML.NAMESPACE_URIS_,{Document:ol.xml.makeChildAppender(ol.format.KML.writeDocument_),Placemark:ol.xml.makeChildAppender(ol.format.KML.writePlacemark_)});ol.format.KML.DOCUMENT_SERIALIZERS_=ol.xml.makeStructureNS(ol.format.KML.NAMESPACE_URIS_,{Placemark:ol.xml.makeChildAppender(ol.format.KML.writePlacemark_)});ol.format.KML.EXTENDEDDATA_NODE_SERIALIZERS_=ol.xml.makeStructureNS(ol.format.KML.NAMESPACE_URIS_,{Data:ol.xml.makeChildAppender(ol.format.KML.writeDataNode_),value:ol.xml.makeChildAppender(ol.format.KML.writeDataNodeValue_),displayName:ol.xml.makeChildAppender(ol.format.KML.writeDataNodeName_)});ol.format.KML.GEOMETRY_TYPE_TO_NODENAME_={Point:"Point",LineString:"LineString",LinearRing:"LinearRing",Polygon:"Polygon",MultiPoint:"MultiGeometry",MultiLineString:"MultiGeometry",MultiPolygon:"MultiGeometry",GeometryCollection:"MultiGeometry"};ol.format.KML.ICON_SEQUENCE_=ol.xml.makeStructureNS(ol.format.KML.NAMESPACE_URIS_,["href"],ol.xml.makeStructureNS(ol.format.KML.GX_NAMESPACE_URIS_,["x","y","w","h"]));ol.format.KML.ICON_SERIALIZERS_=ol.xml.makeStructureNS(ol.format.KML.NAMESPACE_URIS_,{href:ol.xml.makeChildAppender(ol.format.XSD.writeStringTextNode)},ol.xml.makeStructureNS(ol.format.KML.GX_NAMESPACE_URIS_,{x:ol.xml.makeChildAppender(ol.format.XSD.writeDecimalTextNode),y:ol.xml.makeChildAppender(ol.format.XSD.writeDecimalTextNode),w:ol.xml.makeChildAppender(ol.format.XSD.writeDecimalTextNode),h:ol.xml.makeChildAppender(ol.format.XSD.writeDecimalTextNode)}));ol.format.KML.ICON_STYLE_SEQUENCE_=ol.xml.makeStructureNS(ol.format.KML.NAMESPACE_URIS_,["scale","heading","Icon","hotSpot"]);ol.format.KML.ICON_STYLE_SERIALIZERS_=ol.xml.makeStructureNS(ol.format.KML.NAMESPACE_URIS_,{Icon:ol.xml.makeChildAppender(ol.format.KML.writeIcon_),heading:ol.xml.makeChildAppender(ol.format.XSD.writeDecimalTextNode),hotSpot:ol.xml.makeChildAppender(ol.format.KML.writeVec2_),scale:ol.xml.makeChildAppender(ol.format.KML.writeScaleTextNode_)});ol.format.KML.LABEL_STYLE_SEQUENCE_=ol.xml.makeStructureNS(ol.format.KML.NAMESPACE_URIS_,["color","scale"]);ol.format.KML.LABEL_STYLE_SERIALIZERS_=ol.xml.makeStructureNS(ol.format.KML.NAMESPACE_URIS_,{color:ol.xml.makeChildAppender(ol.format.KML.writeColorTextNode_),scale:ol.xml.makeChildAppender(ol.format.KML.writeScaleTextNode_)});ol.format.KML.LINE_STYLE_SEQUENCE_=ol.xml.makeStructureNS(ol.format.KML.NAMESPACE_URIS_,["color","width"]);ol.format.KML.LINE_STYLE_SERIALIZERS_=ol.xml.makeStructureNS(ol.format.KML.NAMESPACE_URIS_,{color:ol.xml.makeChildAppender(ol.format.KML.writeColorTextNode_),width:ol.xml.makeChildAppender(ol.format.XSD.writeDecimalTextNode)});ol.format.KML.BOUNDARY_IS_SERIALIZERS_=ol.xml.makeStructureNS(ol.format.KML.NAMESPACE_URIS_,{LinearRing:ol.xml.makeChildAppender(ol.format.KML.writePrimitiveGeometry_)});ol.format.KML.MULTI_GEOMETRY_SERIALIZERS_=ol.xml.makeStructureNS(ol.format.KML.NAMESPACE_URIS_,{LineString:ol.xml.makeChildAppender(ol.format.KML.writePrimitiveGeometry_),Point:ol.xml.makeChildAppender(ol.format.KML.writePrimitiveGeometry_),Polygon:ol.xml.makeChildAppender(ol.format.KML.writePolygon_),GeometryCollection:ol.xml.makeChildAppender(ol.format.KML.writeMultiGeometry_)});ol.format.KML.PLACEMARK_SEQUENCE_=ol.xml.makeStructureNS(ol.format.KML.NAMESPACE_URIS_,["name","open","visibility","address","phoneNumber","description","styleUrl","Style"]);ol.format.KML.PLACEMARK_SERIALIZERS_=ol.xml.makeStructureNS(ol.format.KML.NAMESPACE_URIS_,{ExtendedData:ol.xml.makeChildAppender(ol.format.KML.writeExtendedData_),MultiGeometry:ol.xml.makeChildAppender(ol.format.KML.writeMultiGeometry_),LineString:ol.xml.makeChildAppender(ol.format.KML.writePrimitiveGeometry_),LinearRing:ol.xml.makeChildAppender(ol.format.KML.writePrimitiveGeometry_),Point:ol.xml.makeChildAppender(ol.format.KML.writePrimitiveGeometry_),Polygon:ol.xml.makeChildAppender(ol.format.KML.writePolygon_),Style:ol.xml.makeChildAppender(ol.format.KML.writeStyle_),address:ol.xml.makeChildAppender(ol.format.XSD.writeStringTextNode),description:ol.xml.makeChildAppender(ol.format.XSD.writeStringTextNode),name:ol.xml.makeChildAppender(ol.format.XSD.writeStringTextNode),open:ol.xml.makeChildAppender(ol.format.XSD.writeBooleanTextNode),phoneNumber:ol.xml.makeChildAppender(ol.format.XSD.writeStringTextNode),styleUrl:ol.xml.makeChildAppender(ol.format.XSD.writeStringTextNode),visibility:ol.xml.makeChildAppender(ol.format.XSD.writeBooleanTextNode)});ol.format.KML.PRIMITIVE_GEOMETRY_SEQUENCE_=ol.xml.makeStructureNS(ol.format.KML.NAMESPACE_URIS_,["extrude","tessellate","altitudeMode","coordinates"]);ol.format.KML.PRIMITIVE_GEOMETRY_SERIALIZERS_=ol.xml.makeStructureNS(ol.format.KML.NAMESPACE_URIS_,{extrude:ol.xml.makeChildAppender(ol.format.XSD.writeBooleanTextNode),tessellate:ol.xml.makeChildAppender(ol.format.XSD.writeBooleanTextNode),altitudeMode:ol.xml.makeChildAppender(ol.format.XSD.writeStringTextNode),coordinates:ol.xml.makeChildAppender(ol.format.KML.writeCoordinatesTextNode_)});ol.format.KML.POLYGON_SERIALIZERS_=ol.xml.makeStructureNS(ol.format.KML.NAMESPACE_URIS_,{outerBoundaryIs:ol.xml.makeChildAppender(ol.format.KML.writeBoundaryIs_),innerBoundaryIs:ol.xml.makeChildAppender(ol.format.KML.writeBoundaryIs_)});ol.format.KML.POLY_STYLE_SERIALIZERS_=ol.xml.makeStructureNS(ol.format.KML.NAMESPACE_URIS_,{color:ol.xml.makeChildAppender(ol.format.KML.writeColorTextNode_)});ol.format.KML.STYLE_SEQUENCE_=ol.xml.makeStructureNS(ol.format.KML.NAMESPACE_URIS_,["IconStyle","LabelStyle","LineStyle","PolyStyle"]);ol.format.KML.STYLE_SERIALIZERS_=ol.xml.makeStructureNS(ol.format.KML.NAMESPACE_URIS_,{IconStyle:ol.xml.makeChildAppender(ol.format.KML.writeIconStyle_),LabelStyle:ol.xml.makeChildAppender(ol.format.KML.writeLabelStyle_),LineStyle:ol.xml.makeChildAppender(ol.format.KML.writeLineStyle_),PolyStyle:ol.xml.makeChildAppender(ol.format.KML.writePolyStyle_)});ol.format.KML.GX_NODE_FACTORY_=function(e,t,o){return ol.xml.createElementNS(ol.format.KML.GX_NAMESPACE_URIS_[0],"gx:"+o)};ol.format.KML.DOCUMENT_NODE_FACTORY_=function(e,t,o){var r=t[t.length-1].node;return ol.xml.createElementNS(r.namespaceURI,"Placemark")};ol.format.KML.GEOMETRY_NODE_FACTORY_=function(e,t,o){if(e){var r=t[t.length-1].node;return ol.xml.createElementNS(r.namespaceURI,ol.format.KML.GEOMETRY_TYPE_TO_NODENAME_[e.getType()])}};ol.format.KML.COLOR_NODE_FACTORY_=ol.xml.makeSimpleNodeFactory("color");ol.format.KML.DATA_NODE_FACTORY_=ol.xml.makeSimpleNodeFactory("Data");ol.format.KML.EXTENDEDDATA_NODE_FACTORY_=ol.xml.makeSimpleNodeFactory("ExtendedData");ol.format.KML.INNER_BOUNDARY_NODE_FACTORY_=ol.xml.makeSimpleNodeFactory("innerBoundaryIs");ol.format.KML.POINT_NODE_FACTORY_=ol.xml.makeSimpleNodeFactory("Point");ol.format.KML.LINE_STRING_NODE_FACTORY_=ol.xml.makeSimpleNodeFactory("LineString");ol.format.KML.LINEAR_RING_NODE_FACTORY_=ol.xml.makeSimpleNodeFactory("LinearRing");ol.format.KML.POLYGON_NODE_FACTORY_=ol.xml.makeSimpleNodeFactory("Polygon");ol.format.KML.OUTER_BOUNDARY_NODE_FACTORY_=ol.xml.makeSimpleNodeFactory("outerBoundaryIs");ol.format.KML.prototype.writeFeatures;ol.format.KML.prototype.writeFeaturesNode=function(e,t){t=this.adaptOptions(t);var o=ol.xml.createElementNS(ol.format.KML.NAMESPACE_URIS_[4],"kml"),r="http://www.w3.org/2000/xmlns/";ol.xml.setAttributeNS(o,r,"xmlns:gx",ol.format.KML.GX_NAMESPACE_URIS_[0]);ol.xml.setAttributeNS(o,r,"xmlns:xsi","http://www.w3.org/2001/XMLSchema-instance");ol.xml.setAttributeNS(o,"http://www.w3.org/2001/XMLSchema-instance","xsi:schemaLocation",ol.format.KML.SCHEMA_LOCATION_);var i={node:o},n={};e.length>1?n.Document=e:1==e.length&&(n.Placemark=e[0]);var a=ol.format.KML.KML_SEQUENCE_[o.namespaceURI],l=ol.xml.makeSequence(n,a);ol.xml.pushSerializeAndPop(i,ol.format.KML.KML_SERIALIZERS_,ol.xml.OBJECT_PROPERTY_NODE_FACTORY,l,[t],a,this);return o};goog.provide("ol.ext.PBF");ol.ext.PBF=function(){};(function(){!function(e){"use strict";var t=function(e,t,o,r,i){var n,a,l=8*i-r-1,s=(1<<l)-1,p=s>>1,c=-7,u=o?i-1:0,g=o?-1:1,d=e[t+u];u+=g;n=d&(1<<-c)-1;d>>=-c;c+=l;for(;c>0;n=256*n+e[t+u],u+=g,c-=8);a=n&(1<<-c)-1;n>>=-c;c+=r;for(;c>0;a=256*a+e[t+u],u+=g,c-=8);if(0===n)n=1-p;else{if(n===s)return a?NaN:1/0*(d?-1:1);a+=Math.pow(2,r);n-=p}return(d?-1:1)*a*Math.pow(2,n-r)},o=function(e,t,o,r,i,n){var a,l,s,p=8*n-i-1,c=(1<<p)-1,u=c>>1,g=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,d=r?0:n-1,h=r?1:-1,f=t<0||0===t&&1/t<0?1:0;t=Math.abs(t);if(isNaN(t)||t===1/0){l=isNaN(t)?1:0;a=c}else{a=Math.floor(Math.log(t)/Math.LN2);if(t*(s=Math.pow(2,-a))<1){a--;s*=2}if((t+=a+u>=1?g/s:g*Math.pow(2,1-u))*s>=2){a++;s/=2}if(a+u>=c){l=0;a=c}else if(a+u>=1){l=(t*s-1)*Math.pow(2,i);a+=u}else{l=t*Math.pow(2,u-1)*Math.pow(2,i);a=0}}for(;i>=8;e[o+d]=255&l,d+=h,l/=256,i-=8);a=a<<i|l;p+=i;for(;p>0;e[o+d]=255&a,d+=h,a/=256,p-=8);e[o+d-h]|=128*f},r=i;function i(e){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(e)?e:new Uint8Array(e||0);this.pos=0;this.type=0;this.length=this.buf.length}i.Varint=0;i.Fixed64=1;i.Bytes=2;i.Fixed32=5;i.prototype={destroy:function(){this.buf=null},readFields:function(e,t,o){o=o||this.length;for(;this.pos<o;){var r=this.readVarint(),i=r>>3,n=this.pos;this.type=7&r;e(i,t,this);this.pos===n&&this.skip(r)}return t},readMessage:function(e,t){return this.readFields(e,t,this.readVarint()+this.pos)},readFixed32:function(){var e=m(this.buf,this.pos);this.pos+=4;return e},readSFixed32:function(){var e=C(this.buf,this.pos);this.pos+=4;return e},readFixed64:function(){var e=m(this.buf,this.pos)+4294967296*m(this.buf,this.pos+4);this.pos+=8;return e},readSFixed64:function(){var e=m(this.buf,this.pos)+4294967296*C(this.buf,this.pos+4);this.pos+=8;return e},readFloat:function(){var e=t(this.buf,this.pos,!0,23,4);this.pos+=4;return e},readDouble:function(){var e=t(this.buf,this.pos,!0,52,8);this.pos+=8;return e},readVarint:function(e){var t,o,r=this.buf;t=127&(o=r[this.pos++]);if(o<128)return t;t|=(127&(o=r[this.pos++]))<<7;if(o<128)return t;t|=(127&(o=r[this.pos++]))<<14;if(o<128)return t;t|=(127&(o=r[this.pos++]))<<21;return o<128?t:function(e,t,o){var r,i,n=o.buf;i=n[o.pos++];r=(112&i)>>4;if(i<128)return a(e,r,t);i=n[o.pos++];r|=(127&i)<<3;if(i<128)return a(e,r,t);i=n[o.pos++];r|=(127&i)<<10;if(i<128)return a(e,r,t);i=n[o.pos++];r|=(127&i)<<17;if(i<128)return a(e,r,t);i=n[o.pos++];r|=(127&i)<<24;if(i<128)return a(e,r,t);i=n[o.pos++];r|=(1&i)<<31;if(i<128)return a(e,r,t);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(o=r[this.pos]))<<28,e,this)},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var e=this.readVarint();return e%2==1?(e+1)/-2:e/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var e=this.readVarint()+this.pos,t=function(e,t,o){var r="",i=t;for(;i<o;){var n,a,l,s=e[i],p=null,c=s>239?4:s>223?3:s>191?2:1;if(i+c>o)break;if(1===c)s<128&&(p=s);else if(2===c)128==(192&(n=e[i+1]))&&(p=(31&s)<<6|63&n)<=127&&(p=null);else if(3===c){n=e[i+1];a=e[i+2];128==(192&n)&&128==(192&a)&&((p=(15&s)<<12|(63&n)<<6|63&a)<=2047||p>=55296&&p<=57343)&&(p=null)}else if(4===c){n=e[i+1];a=e[i+2];l=e[i+3];128==(192&n)&&128==(192&a)&&128==(192&l)&&((p=(15&s)<<18|(63&n)<<12|(63&a)<<6|63&l)<=65535||p>=1114112)&&(p=null)}if(null===p){p=65533;c=1}else if(p>65535){p-=65536;r+=String.fromCharCode(p>>>10&1023|55296);p=56320|1023&p}r+=String.fromCharCode(p);i+=c}return r}(this.buf,this.pos,e);this.pos=e;return t},readBytes:function(){var e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);this.pos=e;return t},readPackedVarint:function(e,t){var o=n(this);e=e||[];for(;this.pos<o;)e.push(this.readVarint(t));return e},readPackedSVarint:function(e){var t=n(this);e=e||[];for(;this.pos<t;)e.push(this.readSVarint());return e},readPackedBoolean:function(e){var t=n(this);e=e||[];for(;this.pos<t;)e.push(this.readBoolean());return e},readPackedFloat:function(e){var t=n(this);e=e||[];for(;this.pos<t;)e.push(this.readFloat());return e},readPackedDouble:function(e){var t=n(this);e=e||[];for(;this.pos<t;)e.push(this.readDouble());return e},readPackedFixed32:function(e){var t=n(this);e=e||[];for(;this.pos<t;)e.push(this.readFixed32());return e},readPackedSFixed32:function(e){var t=n(this);e=e||[];for(;this.pos<t;)e.push(this.readSFixed32());return e},readPackedFixed64:function(e){var t=n(this);e=e||[];for(;this.pos<t;)e.push(this.readFixed64());return e},readPackedSFixed64:function(e){var t=n(this);e=e||[];for(;this.pos<t;)e.push(this.readSFixed64());return e},skip:function(e){var t=7&e;if(t===i.Varint)for(;this.buf[this.pos++]>127;);else if(t===i.Bytes)this.pos=this.readVarint()+this.pos;else if(t===i.Fixed32)this.pos+=4;else{if(t!==i.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(e,t){this.writeVarint(e<<3|t)},realloc:function(e){for(var t=this.length||16;t<this.pos+e;)t*=2;if(t!==this.length){var o=new Uint8Array(t);o.set(this.buf);this.buf=o;this.length=t}},finish:function(){this.length=this.pos;this.pos=0;return this.buf.subarray(0,this.length)},writeFixed32:function(e){this.realloc(4);v(this.buf,e,this.pos);this.pos+=4},writeSFixed32:function(e){this.realloc(4);v(this.buf,e,this.pos);this.pos+=4},writeFixed64:function(e){this.realloc(8);v(this.buf,-1&e,this.pos);v(this.buf,Math.floor(e*(1/4294967296)),this.pos+4);this.pos+=8},writeSFixed64:function(e){this.realloc(8);v(this.buf,-1&e,this.pos);v(this.buf,Math.floor(e*(1/4294967296)),this.pos+4);this.pos+=8},writeVarint:function(e){if((e=+e||0)>268435455||e<0)!function(e,t){var o,r;if(e>=0){o=e%4294967296|0;r=e/4294967296|0}else{r=~(-e/4294967296);if(4294967295^(o=~(-e%4294967296)))o=o+1|0;else{o=0;r=r+1|0}}if(e>=0x10000000000000000||e<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");t.realloc(10);!function(e,t,o){o.buf[o.pos++]=127&e|128;e>>>=7;o.buf[o.pos++]=127&e|128;e>>>=7;o.buf[o.pos++]=127&e|128;e>>>=7;o.buf[o.pos++]=127&e|128;e>>>=7;o.buf[o.pos]=127&e}(o,0,t);!function(e,t){var o=(7&e)<<4;t.buf[t.pos++]|=o|((e>>>=3)?128:0);if(!e)return;t.buf[t.pos++]=127&e|((e>>>=7)?128:0);if(!e)return;t.buf[t.pos++]=127&e|((e>>>=7)?128:0);if(!e)return;t.buf[t.pos++]=127&e|((e>>>=7)?128:0);if(!e)return;t.buf[t.pos++]=127&e|((e>>>=7)?128:0);if(!e)return;t.buf[t.pos++]=127&e}(r,t)}(e,this);else{this.realloc(4);this.buf[this.pos++]=127&e|(e>127?128:0);if(!(e<=127)){this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0);if(!(e<=127)){this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0);e<=127||(this.buf[this.pos++]=e>>>7&127)}}}},writeSVarint:function(e){this.writeVarint(e<0?2*-e-1:2*e)},writeBoolean:function(e){this.writeVarint(Boolean(e))},writeString:function(e){e=String(e);this.realloc(4*e.length);this.pos++;var t=this.pos;this.pos=function(e,t,o){for(var r,i,n=0;n<t.length;n++){if((r=t.charCodeAt(n))>55295&&r<57344){if(!i){if(r>56319||n+1===t.length){e[o++]=239;e[o++]=191;e[o++]=189}else i=r;continue}if(r<56320){e[o++]=239;e[o++]=191;e[o++]=189;i=r;continue}r=i-55296<<10|r-56320|65536;i=null}else if(i){e[o++]=239;e[o++]=191;e[o++]=189;i=null}if(r<128)e[o++]=r;else{if(r<2048)e[o++]=r>>6|192;else{if(r<65536)e[o++]=r>>12|224;else{e[o++]=r>>18|240;e[o++]=r>>12&63|128}e[o++]=r>>6&63|128}e[o++]=63&r|128}}return o}(this.buf,e,this.pos);var o=this.pos-t;o>=128&&l(t,o,this);this.pos=t-1;this.writeVarint(o);this.pos+=o},writeFloat:function(e){this.realloc(4);o(this.buf,e,this.pos,!0,23,4);this.pos+=4},writeDouble:function(e){this.realloc(8);o(this.buf,e,this.pos,!0,52,8);this.pos+=8},writeBytes:function(e){var t=e.length;this.writeVarint(t);this.realloc(t);for(var o=0;o<t;o++)this.buf[this.pos++]=e[o]},writeRawMessage:function(e,t){this.pos++;var o=this.pos;e(t,this);var r=this.pos-o;r>=128&&l(o,r,this);this.pos=o-1;this.writeVarint(r);this.pos+=r},writeMessage:function(e,t,o){this.writeTag(e,i.Bytes);this.writeRawMessage(t,o)},writePackedVarint:function(e,t){this.writeMessage(e,s,t)},writePackedSVarint:function(e,t){this.writeMessage(e,p,t)},writePackedBoolean:function(e,t){this.writeMessage(e,g,t)},writePackedFloat:function(e,t){this.writeMessage(e,c,t)},writePackedDouble:function(e,t){this.writeMessage(e,u,t)},writePackedFixed32:function(e,t){this.writeMessage(e,d,t)},writePackedSFixed32:function(e,t){this.writeMessage(e,h,t)},writePackedFixed64:function(e,t){this.writeMessage(e,f,t)},writePackedSFixed64:function(e,t){this.writeMessage(e,y,t)},writeBytesField:function(e,t){this.writeTag(e,i.Bytes);this.writeBytes(t)},writeFixed32Field:function(e,t){this.writeTag(e,i.Fixed32);this.writeFixed32(t)},writeSFixed32Field:function(e,t){this.writeTag(e,i.Fixed32);this.writeSFixed32(t)},writeFixed64Field:function(e,t){this.writeTag(e,i.Fixed64);this.writeFixed64(t)},writeSFixed64Field:function(e,t){this.writeTag(e,i.Fixed64);this.writeSFixed64(t)},writeVarintField:function(e,t){this.writeTag(e,i.Varint);this.writeVarint(t)},writeSVarintField:function(e,t){this.writeTag(e,i.Varint);this.writeSVarint(t)},writeStringField:function(e,t){this.writeTag(e,i.Bytes);this.writeString(t)},writeFloatField:function(e,t){this.writeTag(e,i.Fixed32);this.writeFloat(t)},writeDoubleField:function(e,t){this.writeTag(e,i.Fixed64);this.writeDouble(t)},writeBooleanField:function(e,t){this.writeVarintField(e,Boolean(t))}};function n(e){return e.type===i.Bytes?e.readVarint()+e.pos:e.pos+1}function a(e,t,o){return o?4294967296*t+(e>>>0):4294967296*(t>>>0)+(e>>>0)}function l(e,t,o){var r=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.ceil(Math.log(t)/(7*Math.LN2));o.realloc(r);for(var i=o.pos-1;i>=e;i--)o.buf[i+r]=o.buf[i]}function s(e,t){for(var o=0;o<e.length;o++)t.writeVarint(e[o])}function p(e,t){for(var o=0;o<e.length;o++)t.writeSVarint(e[o])}function c(e,t){for(var o=0;o<e.length;o++)t.writeFloat(e[o])}function u(e,t){for(var o=0;o<e.length;o++)t.writeDouble(e[o])}function g(e,t){for(var o=0;o<e.length;o++)t.writeBoolean(e[o])}function d(e,t){for(var o=0;o<e.length;o++)t.writeFixed32(e[o])}function h(e,t){for(var o=0;o<e.length;o++)t.writeSFixed32(e[o])}function f(e,t){for(var o=0;o<e.length;o++)t.writeFixed64(e[o])}function y(e,t){for(var o=0;o<e.length;o++)t.writeSFixed64(e[o])}function m(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+16777216*e[t+3]}function v(e,t,o){e[o]=t;e[o+1]=t>>>8;e[o+2]=t>>>16;e[o+3]=t>>>24}function C(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+(e[t+3]<<24)}e.default=r}(this.PBF=this.PBF||{})}).call(ol.ext);ol.ext.PBF=ol.ext.PBF.default;goog.provide("ol.render.Feature");goog.require("ol");goog.require("ol.array");goog.require("ol.extent");goog.require("ol.geom.GeometryType");goog.require("ol.geom.flat.center");goog.require("ol.geom.flat.interiorpoint");goog.require("ol.geom.flat.interpolate");goog.require("ol.geom.flat.transform");goog.require("ol.transform");ol.render.Feature=function(e,t,o,r,i){this.extent_;this.id_=i;this.type_=e;this.flatCoordinates_=t;this.flatInteriorPoints_=null;this.flatMidpoints_=null;this.ends_=o;this.properties_=r;this.tmpTransform_=ol.transform.create()};ol.render.Feature.prototype.get=function(e){return this.properties_[e]};ol.render.Feature.prototype.getEnds=ol.render.Feature.prototype.getEndss=function(){return this.ends_};ol.render.Feature.prototype.getExtent=function(){this.extent_||(this.extent_=this.type_===ol.geom.GeometryType.POINT?ol.extent.createOrUpdateFromCoordinate(this.flatCoordinates_):ol.extent.createOrUpdateFromFlatCoordinates(this.flatCoordinates_,0,this.flatCoordinates_.length,2));return this.extent_};ol.render.Feature.prototype.getFlatInteriorPoint=function(){if(!this.flatInteriorPoints_){var e=ol.extent.getCenter(this.getExtent());this.flatInteriorPoints_=ol.geom.flat.interiorpoint.linearRings(this.flatCoordinates_,0,this.ends_,2,e,0)}return this.flatInteriorPoints_};ol.render.Feature.prototype.getFlatInteriorPoints=function(){if(!this.flatInteriorPoints_){var e=ol.geom.flat.center.linearRingss(this.flatCoordinates_,0,this.ends_,2);this.flatInteriorPoints_=ol.geom.flat.interiorpoint.linearRingss(this.flatCoordinates_,0,this.ends_,2,e)}return this.flatInteriorPoints_};ol.render.Feature.prototype.getFlatMidpoint=function(){this.flatMidpoints_||(this.flatMidpoints_=ol.geom.flat.interpolate.lineString(this.flatCoordinates_,0,this.flatCoordinates_.length,2,.5));return this.flatMidpoints_};ol.render.Feature.prototype.getFlatMidpoints=function(){if(!this.flatMidpoints_){this.flatMidpoints_=[];for(var e=this.flatCoordinates_,t=0,o=this.ends_,r=0,i=o.length;r<i;++r){var n=o[r],a=ol.geom.flat.interpolate.lineString(e,t,n,2,.5);ol.array.extend(this.flatMidpoints_,a);t=n}}return this.flatMidpoints_};ol.render.Feature.prototype.getId=function(){return this.id_};ol.render.Feature.prototype.getOrientedFlatCoordinates=function(){return this.flatCoordinates_};ol.render.Feature.prototype.getFlatCoordinates=ol.render.Feature.prototype.getOrientedFlatCoordinates;ol.render.Feature.prototype.getGeometry=function(){return this};ol.render.Feature.prototype.getProperties=function(){return this.properties_};ol.render.Feature.prototype.getSimplifiedGeometry=ol.render.Feature.prototype.getGeometry;ol.render.Feature.prototype.getStride=function(){return 2};ol.render.Feature.prototype.getStyleFunction=ol.nullFunction;ol.render.Feature.prototype.getType=function(){return this.type_};ol.render.Feature.prototype.transform=function(e,t){var o=e.getExtent(),r=e.getWorldExtent(),i=ol.extent.getHeight(r)/ol.extent.getHeight(o),n=this.tmpTransform_;ol.transform.compose(n,r[0],r[3],i,-i,0,0,0);ol.geom.flat.transform.transform2D(this.flatCoordinates_,0,this.flatCoordinates_.length,2,n,this.flatCoordinates_)};goog.provide("ol.format.MVT");goog.require("ol");goog.require("ol.asserts");goog.require("ol.ext.PBF");goog.require("ol.format.Feature");goog.require("ol.format.FormatType");goog.require("ol.geom.GeometryLayout");goog.require("ol.geom.GeometryType");goog.require("ol.geom.LineString");goog.require("ol.geom.MultiLineString");goog.require("ol.geom.MultiPoint");goog.require("ol.geom.MultiPolygon");goog.require("ol.geom.Point");goog.require("ol.geom.Polygon");goog.require("ol.geom.flat.orient");goog.require("ol.proj.Projection");goog.require("ol.proj.Units");goog.require("ol.render.Feature");ol.format.MVT=function(e){ol.format.Feature.call(this);var t=e||{};this.defaultDataProjection=new ol.proj.Projection({code:"EPSG:3857",units:ol.proj.Units.TILE_PIXELS});this.featureClass_=t.featureClass?t.featureClass:ol.render.Feature;this.geometryName_=t.geometryName;this.layerName_=t.layerName?t.layerName:"layer";this.layers_=t.layers?t.layers:null;this.extent_=null};ol.inherits(ol.format.MVT,ol.format.Feature);ol.format.MVT.pbfReaders_={layers:function(e,t,o){if(3===e){var r={keys:[],values:[],features:[]},i=o.readVarint()+o.pos;o.readFields(ol.format.MVT.pbfReaders_.layer,r,i);r.length=r.features.length;r.length&&(t[r.name]=r)}},layer:function(e,t,o){if(15===e)t.version=o.readVarint();else if(1===e)t.name=o.readString();else if(5===e)t.extent=o.readVarint();else if(2===e)t.features.push(o.pos);else if(3===e)t.keys.push(o.readString());else if(4===e){for(var r=null,i=o.readVarint()+o.pos;o.pos<i;)r=1===(e=o.readVarint()>>3)?o.readString():2===e?o.readFloat():3===e?o.readDouble():4===e?o.readVarint64():5===e?o.readVarint():6===e?o.readSVarint():7===e?o.readBoolean():null;t.values.push(r)}},feature:function(e,t,o){if(1==e)t.id=o.readVarint();else if(2==e)for(var r=o.readVarint()+o.pos;o.pos<r;){var i=t.layer.keys[o.readVarint()],n=t.layer.values[o.readVarint()];t.properties[i]=n}else 3==e?t.type=o.readVarint():4==e&&(t.geometry=o.pos)}};ol.format.MVT.readRawFeature_=function(e,t,o){e.pos=t.features[o];var r=e.readVarint()+e.pos,i={layer:t,type:0,properties:{}};e.readFields(ol.format.MVT.pbfReaders_.feature,i,r);return i};ol.format.MVT.readRawGeometry_=function(e,t,o,r){e.pos=t.geometry;for(var i=e.readVarint()+e.pos,n=1,a=0,l=0,s=0,p=0,c=0;e.pos<i;){if(!a){var u=e.readVarint();n=7&u;a=u>>3}a--;if(1===n||2===n){l+=e.readSVarint();s+=e.readSVarint();if(1===n&&p>c){r.push(p);c=p}o.push(l,s);p+=2}else if(7===n){if(p>c){o.push(o[c],o[c+1]);p+=2}}else ol.asserts.assert(!1,59)}if(p>c){r.push(p);c=p}};ol.format.MVT.getGeometryType_=function(e,t){var o;1===e?o=1===t?ol.geom.GeometryType.POINT:ol.geom.GeometryType.MULTI_POINT:2===e?o=1===t?ol.geom.GeometryType.LINE_STRING:ol.geom.GeometryType.MULTI_LINE_STRING:3===e&&(o=ol.geom.GeometryType.POLYGON);return o};ol.format.MVT.prototype.createFeature_=function(e,t,o){var r,i=t.type;if(0===i)return null;var n=t.id,a=t.properties;a[this.layerName_]=t.layer.name;var l=[],s=[];ol.format.MVT.readRawGeometry_(e,t,l,s);var p=ol.format.MVT.getGeometryType_(i,s.length);if(this.featureClass_===ol.render.Feature)r=new this.featureClass_(p,l,s,a,n);else{var c;if(p==ol.geom.GeometryType.POLYGON){for(var u=[],g=0,d=0,h=0,f=s.length;h<f;++h){var y=s[h];if(!ol.geom.flat.orient.linearRingIsClockwise(l,g,y,2)){u.push(s.slice(d,h));d=h}g=y}if(u.length>1){s=u;c=new ol.geom.MultiPolygon(null)}else c=new ol.geom.Polygon(null)}else c=p===ol.geom.GeometryType.POINT?new ol.geom.Point(null):p===ol.geom.GeometryType.LINE_STRING?new ol.geom.LineString(null):p===ol.geom.GeometryType.POLYGON?new ol.geom.Polygon(null):p===ol.geom.GeometryType.MULTI_POINT?new ol.geom.MultiPoint(null):p===ol.geom.GeometryType.MULTI_LINE_STRING?new ol.geom.MultiLineString(null):null;c.setFlatCoordinates(ol.geom.GeometryLayout.XY,l,s);r=new this.featureClass_;this.geometryName_&&r.setGeometryName(this.geometryName_);var m=ol.format.Feature.transformWithOptions(c,!1,this.adaptOptions(o));r.setGeometry(m);r.setId(n);r.setProperties(a)}return r};ol.format.MVT.prototype.getLastExtent=function(){return this.extent_};ol.format.MVT.prototype.getType=function(){return ol.format.FormatType.ARRAY_BUFFER};ol.format.MVT.prototype.readFeatures=function(e,t){var o,r=this.layers_,i=new ol.ext.PBF(e),n=i.readFields(ol.format.MVT.pbfReaders_.layers,{}),a=[];for(var l in n)if(!r||-1!=r.indexOf(l)){for(var s,p=0,c=(o=n[l]).length;p<c;++p){s=ol.format.MVT.readRawFeature_(i,o,p);a.push(this.createFeature_(i,s))}this.extent_=o?[0,0,o.extent,o.extent]:null}return a};ol.format.MVT.prototype.readProjection=function(e){return this.defaultDataProjection};ol.format.MVT.prototype.setLayers=function(e){this.layers_=e};ol.format.MVT.prototype.readFeature=function(){};ol.format.MVT.prototype.readGeometry=function(){};ol.format.MVT.prototype.writeFeature=function(){};ol.format.MVT.prototype.writeGeometry=function(){};ol.format.MVT.prototype.writeFeatures=function(){};goog.provide("ol.format.OSMXML");goog.require("ol");goog.require("ol.array");goog.require("ol.Feature");goog.require("ol.format.Feature");goog.require("ol.format.XMLFeature");goog.require("ol.geom.GeometryLayout");goog.require("ol.geom.LineString");goog.require("ol.geom.Point");goog.require("ol.geom.Polygon");goog.require("ol.obj");goog.require("ol.proj");goog.require("ol.xml");ol.format.OSMXML=function(){ol.format.XMLFeature.call(this);this.defaultDataProjection=ol.proj.get("EPSG:4326")};ol.inherits(ol.format.OSMXML,ol.format.XMLFeature);ol.format.OSMXML.readNode_=function(e,t){var o=t[0],r=t[t.length-1],i=e.getAttribute("id"),n=[parseFloat(e.getAttribute("lon")),parseFloat(e.getAttribute("lat"))];r.nodes[i]=n;var a=ol.xml.pushParseAndPop({tags:{}},ol.format.OSMXML.NODE_PARSERS_,e,t);if(!ol.obj.isEmpty(a.tags)){var l=new ol.geom.Point(n);ol.format.Feature.transformWithOptions(l,!1,o);var s=new ol.Feature(l);s.setId(i);s.setProperties(a.tags);r.features.push(s)}};ol.format.OSMXML.readWay_=function(e,t){var o=e.getAttribute("id"),r=ol.xml.pushParseAndPop({id:o,ndrefs:[],tags:{}},ol.format.OSMXML.WAY_PARSERS_,e,t);t[t.length-1].ways.push(r)};ol.format.OSMXML.readNd_=function(e,t){t[t.length-1].ndrefs.push(e.getAttribute("ref"))};ol.format.OSMXML.readTag_=function(e,t){t[t.length-1].tags[e.getAttribute("k")]=e.getAttribute("v")};ol.format.OSMXML.NAMESPACE_URIS_=[null];ol.format.OSMXML.WAY_PARSERS_=ol.xml.makeStructureNS(ol.format.OSMXML.NAMESPACE_URIS_,{nd:ol.format.OSMXML.readNd_,tag:ol.format.OSMXML.readTag_});ol.format.OSMXML.PARSERS_=ol.xml.makeStructureNS(ol.format.OSMXML.NAMESPACE_URIS_,{node:ol.format.OSMXML.readNode_,way:ol.format.OSMXML.readWay_});ol.format.OSMXML.NODE_PARSERS_=ol.xml.makeStructureNS(ol.format.OSMXML.NAMESPACE_URIS_,{tag:ol.format.OSMXML.readTag_});ol.format.OSMXML.prototype.readFeatures;ol.format.OSMXML.prototype.readFeaturesFromNode=function(e,t){var o=this.getReadOptions(e,t);if("osm"==e.localName){for(var r=ol.xml.pushParseAndPop({nodes:{},ways:[],features:[]},ol.format.OSMXML.PARSERS_,e,[o]),i=0;i<r.ways.length;i++){for(var n,a=r.ways[i],l=[],s=0,p=a.ndrefs.length;s<p;s++){var c=r.nodes[a.ndrefs[s]];ol.array.extend(l,c)}a.ndrefs[0]==a.ndrefs[a.ndrefs.length-1]?(n=new ol.geom.Polygon(null)).setFlatCoordinates(ol.geom.GeometryLayout.XY,l,[l.length]):(n=new ol.geom.LineString(null)).setFlatCoordinates(ol.geom.GeometryLayout.XY,l);ol.format.Feature.transformWithOptions(n,!1,o);var u=new ol.Feature(n);u.setId(a.id);u.setProperties(a.tags);r.features.push(u)}if(r.features)return r.features}return[]};ol.format.OSMXML.prototype.readProjection;ol.format.OSMXML.prototype.writeFeatureNode=function(e,t){};ol.format.OSMXML.prototype.writeFeaturesNode=function(e,t){};ol.format.OSMXML.prototype.writeGeometryNode=function(e,t){};goog.provide("ol.format.XLink");ol.format.XLink.NAMESPACE_URI="http://www.w3.org/1999/xlink";ol.format.XLink.readHref=function(e){return e.getAttributeNS(ol.format.XLink.NAMESPACE_URI,"href")};goog.provide("ol.format.XML");goog.require("ol.xml");ol.format.XML=function(){};ol.format.XML.prototype.read=function(e){if(ol.xml.isDocument(e))return this.readFromDocument(e);if(ol.xml.isNode(e))return this.readFromNode(e);if("string"==typeof e){var t=ol.xml.parse(e);return this.readFromDocument(t)}return null};ol.format.XML.prototype.readFromDocument=function(e){};ol.format.XML.prototype.readFromNode=function(e){};goog.provide("ol.format.OWS");goog.require("ol");goog.require("ol.format.XLink");goog.require("ol.format.XML");goog.require("ol.format.XSD");goog.require("ol.xml");ol.format.OWS=function(){ol.format.XML.call(this)};ol.inherits(ol.format.OWS,ol.format.XML);ol.format.OWS.prototype.readFromDocument=function(e){for(var t=e.firstChild;t;t=t.nextSibling)if(t.nodeType==Node.ELEMENT_NODE)return this.readFromNode(t);return null};ol.format.OWS.prototype.readFromNode=function(e){var t=ol.xml.pushParseAndPop({},ol.format.OWS.PARSERS_,e,[]);return t||null};ol.format.OWS.readAddress_=function(e,t){return ol.xml.pushParseAndPop({},ol.format.OWS.ADDRESS_PARSERS_,e,t)};ol.format.OWS.readAllowedValues_=function(e,t){return ol.xml.pushParseAndPop({},ol.format.OWS.ALLOWED_VALUES_PARSERS_,e,t)};ol.format.OWS.readConstraint_=function(e,t){var o=e.getAttribute("name");if(o)return ol.xml.pushParseAndPop({name:o},ol.format.OWS.CONSTRAINT_PARSERS_,e,t)};ol.format.OWS.readContactInfo_=function(e,t){return ol.xml.pushParseAndPop({},ol.format.OWS.CONTACT_INFO_PARSERS_,e,t)};ol.format.OWS.readDcp_=function(e,t){return ol.xml.pushParseAndPop({},ol.format.OWS.DCP_PARSERS_,e,t)};ol.format.OWS.readGet_=function(e,t){var o=ol.format.XLink.readHref(e);if(o)return ol.xml.pushParseAndPop({href:o},ol.format.OWS.REQUEST_METHOD_PARSERS_,e,t)};ol.format.OWS.readHttp_=function(e,t){return ol.xml.pushParseAndPop({},ol.format.OWS.HTTP_PARSERS_,e,t)};ol.format.OWS.readOperation_=function(e,t){var o=e.getAttribute("name"),r=ol.xml.pushParseAndPop({},ol.format.OWS.OPERATION_PARSERS_,e,t);if(r){t[t.length-1][o]=r}};ol.format.OWS.readOperationsMetadata_=function(e,t){return ol.xml.pushParseAndPop({},ol.format.OWS.OPERATIONS_METADATA_PARSERS_,e,t)};ol.format.OWS.readPhone_=function(e,t){return ol.xml.pushParseAndPop({},ol.format.OWS.PHONE_PARSERS_,e,t)};ol.format.OWS.readServiceIdentification_=function(e,t){return ol.xml.pushParseAndPop({},ol.format.OWS.SERVICE_IDENTIFICATION_PARSERS_,e,t)};ol.format.OWS.readServiceContact_=function(e,t){return ol.xml.pushParseAndPop({},ol.format.OWS.SERVICE_CONTACT_PARSERS_,e,t)};ol.format.OWS.readServiceProvider_=function(e,t){return ol.xml.pushParseAndPop({},ol.format.OWS.SERVICE_PROVIDER_PARSERS_,e,t)};ol.format.OWS.readValue_=function(e,t){return ol.format.XSD.readString(e)};ol.format.OWS.NAMESPACE_URIS_=[null,"http://www.opengis.net/ows/1.1"];ol.format.OWS.PARSERS_=ol.xml.makeStructureNS(ol.format.OWS.NAMESPACE_URIS_,{ServiceIdentification:ol.xml.makeObjectPropertySetter(ol.format.OWS.readServiceIdentification_),ServiceProvider:ol.xml.makeObjectPropertySetter(ol.format.OWS.readServiceProvider_),OperationsMetadata:ol.xml.makeObjectPropertySetter(ol.format.OWS.readOperationsMetadata_)});ol.format.OWS.ADDRESS_PARSERS_=ol.xml.makeStructureNS(ol.format.OWS.NAMESPACE_URIS_,{DeliveryPoint:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),City:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),AdministrativeArea:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),PostalCode:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),Country:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),ElectronicMailAddress:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString)});ol.format.OWS.ALLOWED_VALUES_PARSERS_=ol.xml.makeStructureNS(ol.format.OWS.NAMESPACE_URIS_,{Value:ol.xml.makeObjectPropertyPusher(ol.format.OWS.readValue_)});ol.format.OWS.CONSTRAINT_PARSERS_=ol.xml.makeStructureNS(ol.format.OWS.NAMESPACE_URIS_,{AllowedValues:ol.xml.makeObjectPropertySetter(ol.format.OWS.readAllowedValues_)});ol.format.OWS.CONTACT_INFO_PARSERS_=ol.xml.makeStructureNS(ol.format.OWS.NAMESPACE_URIS_,{Phone:ol.xml.makeObjectPropertySetter(ol.format.OWS.readPhone_),Address:ol.xml.makeObjectPropertySetter(ol.format.OWS.readAddress_)});ol.format.OWS.DCP_PARSERS_=ol.xml.makeStructureNS(ol.format.OWS.NAMESPACE_URIS_,{HTTP:ol.xml.makeObjectPropertySetter(ol.format.OWS.readHttp_)});ol.format.OWS.HTTP_PARSERS_=ol.xml.makeStructureNS(ol.format.OWS.NAMESPACE_URIS_,{Get:ol.xml.makeObjectPropertyPusher(ol.format.OWS.readGet_),Post:void 0});ol.format.OWS.OPERATION_PARSERS_=ol.xml.makeStructureNS(ol.format.OWS.NAMESPACE_URIS_,{DCP:ol.xml.makeObjectPropertySetter(ol.format.OWS.readDcp_)});ol.format.OWS.OPERATIONS_METADATA_PARSERS_=ol.xml.makeStructureNS(ol.format.OWS.NAMESPACE_URIS_,{Operation:ol.format.OWS.readOperation_});ol.format.OWS.PHONE_PARSERS_=ol.xml.makeStructureNS(ol.format.OWS.NAMESPACE_URIS_,{Voice:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),Facsimile:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString)});ol.format.OWS.REQUEST_METHOD_PARSERS_=ol.xml.makeStructureNS(ol.format.OWS.NAMESPACE_URIS_,{Constraint:ol.xml.makeObjectPropertyPusher(ol.format.OWS.readConstraint_)});ol.format.OWS.SERVICE_CONTACT_PARSERS_=ol.xml.makeStructureNS(ol.format.OWS.NAMESPACE_URIS_,{IndividualName:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),PositionName:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),ContactInfo:ol.xml.makeObjectPropertySetter(ol.format.OWS.readContactInfo_)});ol.format.OWS.SERVICE_IDENTIFICATION_PARSERS_=ol.xml.makeStructureNS(ol.format.OWS.NAMESPACE_URIS_,{Abstract:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),AccessConstraints:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),Fees:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),Title:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),ServiceTypeVersion:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),ServiceType:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString)});ol.format.OWS.SERVICE_PROVIDER_PARSERS_=ol.xml.makeStructureNS(ol.format.OWS.NAMESPACE_URIS_,{ProviderName:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),ProviderSite:ol.xml.makeObjectPropertySetter(ol.format.XLink.readHref),ServiceContact:ol.xml.makeObjectPropertySetter(ol.format.OWS.readServiceContact_)});goog.provide("ol.geom.flat.flip");ol.geom.flat.flip.flipXY=function(e,t,o,r,i,n){var a,l;if(void 0!==i){a=i;l=void 0!==n?n:0}else{a=[];l=0}for(var s=t;s<o;){var p=e[s++];a[l++]=e[s++];a[l++]=p;for(var c=2;c<r;++c)a[l++]=e[s++]}a.length=l;return a};goog.provide("ol.format.Polyline");goog.require("ol");goog.require("ol.asserts");goog.require("ol.Feature");goog.require("ol.format.Feature");goog.require("ol.format.TextFeature");goog.require("ol.geom.GeometryLayout");goog.require("ol.geom.LineString");goog.require("ol.geom.SimpleGeometry");goog.require("ol.geom.flat.flip");goog.require("ol.geom.flat.inflate");goog.require("ol.proj");ol.format.Polyline=function(e){var t=e||{};ol.format.TextFeature.call(this);this.defaultDataProjection=ol.proj.get("EPSG:4326");this.factor_=t.factor?t.factor:1e5;this.geometryLayout_=t.geometryLayout?t.geometryLayout:ol.geom.GeometryLayout.XY};ol.inherits(ol.format.Polyline,ol.format.TextFeature);ol.format.Polyline.encodeDeltas=function(e,t,o){var r,i,n,a=o||1e5,l=new Array(t);for(r=0;r<t;++r)l[r]=0;for(i=0,n=e.length;i<n;)for(r=0;r<t;++r,++i){var s=e[i],p=s-l[r];l[r]=s;e[i]=p}return ol.format.Polyline.encodeFloats(e,a)};ol.format.Polyline.decodeDeltas=function(e,t,o){var r,i=o||1e5,n=new Array(t);for(r=0;r<t;++r)n[r]=0;var a,l,s=ol.format.Polyline.decodeFloats(e,i);for(a=0,l=s.length;a<l;)for(r=0;r<t;++r,++a){n[r]+=s[a];s[a]=n[r]}return s};ol.format.Polyline.encodeFloats=function(e,t){var o,r,i=t||1e5;for(o=0,r=e.length;o<r;++o)e[o]=Math.round(e[o]*i);return ol.format.Polyline.encodeSignedIntegers(e)};ol.format.Polyline.decodeFloats=function(e,t){var o,r,i=t||1e5,n=ol.format.Polyline.decodeSignedIntegers(e);for(o=0,r=n.length;o<r;++o)n[o]/=i;return n};ol.format.Polyline.encodeSignedIntegers=function(e){var t,o;for(t=0,o=e.length;t<o;++t){var r=e[t];e[t]=r<0?~(r<<1):r<<1}return ol.format.Polyline.encodeUnsignedIntegers(e)};ol.format.Polyline.decodeSignedIntegers=function(e){var t,o,r=ol.format.Polyline.decodeUnsignedIntegers(e);for(t=0,o=r.length;t<o;++t){var i=r[t];r[t]=1&i?~(i>>1):i>>1}return r};ol.format.Polyline.encodeUnsignedIntegers=function(e){var t,o,r="";for(t=0,o=e.length;t<o;++t)r+=ol.format.Polyline.encodeUnsignedInteger(e[t]);return r};ol.format.Polyline.decodeUnsignedIntegers=function(e){var t,o,r=[],i=0,n=0;for(t=0,o=e.length;t<o;++t){var a=e.charCodeAt(t)-63;i|=(31&a)<<n;if(a<32){r.push(i);i=0;n=0}else n+=5}return r};ol.format.Polyline.encodeUnsignedInteger=function(e){for(var t,o="";e>=32;){t=63+(32|31&e);o+=String.fromCharCode(t);e>>=5}t=e+63;return o+=String.fromCharCode(t)};ol.format.Polyline.prototype.readFeature;ol.format.Polyline.prototype.readFeatureFromText=function(e,t){var o=this.readGeometryFromText(e,t);return new ol.Feature(o)};ol.format.Polyline.prototype.readFeatures;ol.format.Polyline.prototype.readFeaturesFromText=function(e,t){return[this.readFeatureFromText(e,t)]};ol.format.Polyline.prototype.readGeometry;ol.format.Polyline.prototype.readGeometryFromText=function(e,t){var o=ol.geom.SimpleGeometry.getStrideForLayout(this.geometryLayout_),r=ol.format.Polyline.decodeDeltas(e,o,this.factor_);ol.geom.flat.flip.flipXY(r,0,r.length,o,r);var i=ol.geom.flat.inflate.coordinates(r,0,r.length,o);return ol.format.Feature.transformWithOptions(new ol.geom.LineString(i,this.geometryLayout_),!1,this.adaptOptions(t))};ol.format.Polyline.prototype.readProjection;ol.format.Polyline.prototype.writeFeatureText=function(e,t){var o=e.getGeometry();if(o)return this.writeGeometryText(o,t);ol.asserts.assert(!1,40);return""};ol.format.Polyline.prototype.writeFeaturesText=function(e,t){return this.writeFeatureText(e[0],t)};ol.format.Polyline.prototype.writeGeometry;ol.format.Polyline.prototype.writeGeometryText=function(e,t){var o=(e=ol.format.Feature.transformWithOptions(e,!0,this.adaptOptions(t))).getFlatCoordinates(),r=e.getStride();ol.geom.flat.flip.flipXY(o,0,o.length,r,o);return ol.format.Polyline.encodeDeltas(o,r,this.factor_)};goog.provide("ol.format.TopoJSON");goog.require("ol");goog.require("ol.Feature");goog.require("ol.format.Feature");goog.require("ol.format.JSONFeature");goog.require("ol.geom.LineString");goog.require("ol.geom.MultiLineString");goog.require("ol.geom.MultiPoint");goog.require("ol.geom.MultiPolygon");goog.require("ol.geom.Point");goog.require("ol.geom.Polygon");goog.require("ol.proj");ol.format.TopoJSON=function(e){var t=e||{};ol.format.JSONFeature.call(this);this.layerName_=t.layerName;this.layers_=t.layers?t.layers:null;this.defaultDataProjection=ol.proj.get(t.defaultDataProjection?t.defaultDataProjection:"EPSG:4326")};ol.inherits(ol.format.TopoJSON,ol.format.JSONFeature);ol.format.TopoJSON.concatenateArcs_=function(e,t){var o,r,i,n,a,l,s=[];for(i=0,n=e.length;i<n;++i){o=e[i];i>0&&s.pop();r=o>=0?t[o]:t[~o].slice().reverse();s.push.apply(s,r)}for(a=0,l=s.length;a<l;++a)s[a]=s[a].slice();return s};ol.format.TopoJSON.readPointGeometry_=function(e,t,o){var r=e.coordinates;t&&o&&ol.format.TopoJSON.transformVertex_(r,t,o);return new ol.geom.Point(r)};ol.format.TopoJSON.readMultiPointGeometry_=function(e,t,o){var r,i,n=e.coordinates;if(t&&o)for(r=0,i=n.length;r<i;++r)ol.format.TopoJSON.transformVertex_(n[r],t,o);return new ol.geom.MultiPoint(n)};ol.format.TopoJSON.readLineStringGeometry_=function(e,t){var o=ol.format.TopoJSON.concatenateArcs_(e.arcs,t);return new ol.geom.LineString(o)};ol.format.TopoJSON.readMultiLineStringGeometry_=function(e,t){var o,r,i=[];for(o=0,r=e.arcs.length;o<r;++o)i[o]=ol.format.TopoJSON.concatenateArcs_(e.arcs[o],t);return new ol.geom.MultiLineString(i)};ol.format.TopoJSON.readPolygonGeometry_=function(e,t){var o,r,i=[];for(o=0,r=e.arcs.length;o<r;++o)i[o]=ol.format.TopoJSON.concatenateArcs_(e.arcs[o],t);return new ol.geom.Polygon(i)};ol.format.TopoJSON.readMultiPolygonGeometry_=function(e,t){var o,r,i,n,a,l,s=[];for(a=0,l=e.arcs.length;a<l;++a){o=e.arcs[a];r=[];for(i=0,n=o.length;i<n;++i)r[i]=ol.format.TopoJSON.concatenateArcs_(o[i],t);s[a]=r}return new ol.geom.MultiPolygon(s)};ol.format.TopoJSON.readFeaturesFromGeometryCollection_=function(e,t,o,r,i,n,a){var l,s,p=e.geometries,c=[];for(l=0,s=p.length;l<s;++l)c[l]=ol.format.TopoJSON.readFeatureFromGeometry_(p[l],t,o,r,i,n,a);return c};ol.format.TopoJSON.readFeatureFromGeometry_=function(e,t,o,r,i,n,a){var l,s=e.type,p=ol.format.TopoJSON.GEOMETRY_READERS_[s];l="Point"===s||"MultiPoint"===s?p(e,o,r):p(e,t);var c=new ol.Feature;c.setGeometry(ol.format.Feature.transformWithOptions(l,!1,a));void 0!==e.id&&c.setId(e.id);var u=e.properties;if(i){u||(u={});u[i]=n}u&&c.setProperties(u);return c};ol.format.TopoJSON.prototype.readFeatures;ol.format.TopoJSON.prototype.readFeaturesFromObject=function(e,t){if("Topology"==e.type){var o,r=e,i=null,n=null;if(r.transform){i=(o=r.transform).scale;n=o.translate}var a=r.arcs;o&&ol.format.TopoJSON.transformArcs_(a,i,n);var l,s,p=[],c=r.objects,u=this.layerName_;for(l in c)if(!this.layers_||-1!=this.layers_.indexOf(l))if("GeometryCollection"===c[l].type){s=c[l];p.push.apply(p,ol.format.TopoJSON.readFeaturesFromGeometryCollection_(s,a,i,n,u,l,t))}else{s=c[l];p.push(ol.format.TopoJSON.readFeatureFromGeometry_(s,a,i,n,u,l,t))}return p}return[]};ol.format.TopoJSON.transformArcs_=function(e,t,o){var r,i;for(r=0,i=e.length;r<i;++r)ol.format.TopoJSON.transformArc_(e[r],t,o)};ol.format.TopoJSON.transformArc_=function(e,t,o){var r,i,n,a=0,l=0;for(i=0,n=e.length;i<n;++i){a+=(r=e[i])[0];l+=r[1];r[0]=a;r[1]=l;ol.format.TopoJSON.transformVertex_(r,t,o)}};ol.format.TopoJSON.transformVertex_=function(e,t,o){e[0]=e[0]*t[0]+o[0];e[1]=e[1]*t[1]+o[1]};ol.format.TopoJSON.prototype.readProjection;ol.format.TopoJSON.prototype.readProjectionFromObject=function(e){return this.defaultDataProjection};ol.format.TopoJSON.GEOMETRY_READERS_={Point:ol.format.TopoJSON.readPointGeometry_,LineString:ol.format.TopoJSON.readLineStringGeometry_,Polygon:ol.format.TopoJSON.readPolygonGeometry_,MultiPoint:ol.format.TopoJSON.readMultiPointGeometry_,MultiLineString:ol.format.TopoJSON.readMultiLineStringGeometry_,MultiPolygon:ol.format.TopoJSON.readMultiPolygonGeometry_};ol.format.TopoJSON.prototype.writeFeatureObject=function(e,t){};ol.format.TopoJSON.prototype.writeFeaturesObject=function(e,t){};ol.format.TopoJSON.prototype.writeGeometryObject=function(e,t){};ol.format.TopoJSON.prototype.readGeometryFromObject=function(){};ol.format.TopoJSON.prototype.readFeatureFromObject=function(){};goog.provide("ol.format.WFS");goog.require("ol");goog.require("ol.asserts");goog.require("ol.format.GML2");goog.require("ol.format.GML3");goog.require("ol.format.GMLBase");goog.require("ol.format.filter");goog.require("ol.format.XMLFeature");goog.require("ol.format.XSD");goog.require("ol.geom.Geometry");goog.require("ol.obj");goog.require("ol.proj");goog.require("ol.xml");ol.format.WFS=function(e){var t=e||{};this.featureType_=t.featureType;this.featureNS_=t.featureNS;this.gmlFormat_=t.gmlFormat?t.gmlFormat:new ol.format.GML3;this.schemaLocation_=t.schemaLocation?t.schemaLocation:ol.format.WFS.SCHEMA_LOCATIONS[ol.format.WFS.DEFAULT_VERSION];ol.format.XMLFeature.call(this)};ol.inherits(ol.format.WFS,ol.format.XMLFeature);ol.format.WFS.FEATURE_PREFIX="feature";ol.format.WFS.XMLNS="http://www.w3.org/2000/xmlns/";ol.format.WFS.OGCNS="http://www.opengis.net/ogc";ol.format.WFS.WFSNS="http://www.opengis.net/wfs";ol.format.WFS.FESNS="http://www.opengis.net/fes";ol.format.WFS.SCHEMA_LOCATIONS={"1.1.0":"http://www.opengis.net/wfs http://schemas.opengis.net/wfs/1.1.0/wfs.xsd","1.0.0":"http://www.opengis.net/wfs http://schemas.opengis.net/wfs/1.0.0/wfs.xsd"};ol.format.WFS.DEFAULT_VERSION="1.1.0";ol.format.WFS.prototype.getFeatureType=function(){return this.featureType_};ol.format.WFS.prototype.setFeatureType=function(e){this.featureType_=e};ol.format.WFS.prototype.readFeatures;ol.format.WFS.prototype.readFeaturesFromNode=function(e,t){var o={featureType:this.featureType_,featureNS:this.featureNS_};ol.obj.assign(o,this.getReadOptions(e,t||{}));var r=[o];this.gmlFormat_.FEATURE_COLLECTION_PARSERS[ol.format.GMLBase.GMLNS].featureMember=ol.xml.makeArrayPusher(ol.format.GMLBase.prototype.readFeaturesInternal);var i=ol.xml.pushParseAndPop([],this.gmlFormat_.FEATURE_COLLECTION_PARSERS,e,r,this.gmlFormat_);i||(i=[]);return i};ol.format.WFS.prototype.readTransactionResponse=function(e){if(ol.xml.isDocument(e))return this.readTransactionResponseFromDocument(e);if(ol.xml.isNode(e))return this.readTransactionResponseFromNode(e);if("string"==typeof e){var t=ol.xml.parse(e);return this.readTransactionResponseFromDocument(t)}};ol.format.WFS.prototype.readFeatureCollectionMetadata=function(e){if(ol.xml.isDocument(e))return this.readFeatureCollectionMetadataFromDocument(e);if(ol.xml.isNode(e))return this.readFeatureCollectionMetadataFromNode(e);if("string"==typeof e){var t=ol.xml.parse(e);return this.readFeatureCollectionMetadataFromDocument(t)}};ol.format.WFS.prototype.readFeatureCollectionMetadataFromDocument=function(e){for(var t=e.firstChild;t;t=t.nextSibling)if(t.nodeType==Node.ELEMENT_NODE)return this.readFeatureCollectionMetadataFromNode(t)};ol.format.WFS.FEATURE_COLLECTION_PARSERS_={"http://www.opengis.net/gml":{boundedBy:ol.xml.makeObjectPropertySetter(ol.format.GMLBase.prototype.readGeometryElement,"bounds")}};ol.format.WFS.prototype.readFeatureCollectionMetadataFromNode=function(e){var t={},o=ol.format.XSD.readNonNegativeIntegerString(e.getAttribute("numberOfFeatures"));t.numberOfFeatures=o;return ol.xml.pushParseAndPop(t,ol.format.WFS.FEATURE_COLLECTION_PARSERS_,e,[],this.gmlFormat_)};ol.format.WFS.TRANSACTION_SUMMARY_PARSERS_={"http://www.opengis.net/wfs":{totalInserted:ol.xml.makeObjectPropertySetter(ol.format.XSD.readNonNegativeInteger),totalUpdated:ol.xml.makeObjectPropertySetter(ol.format.XSD.readNonNegativeInteger),totalDeleted:ol.xml.makeObjectPropertySetter(ol.format.XSD.readNonNegativeInteger)}};ol.format.WFS.readTransactionSummary_=function(e,t){return ol.xml.pushParseAndPop({},ol.format.WFS.TRANSACTION_SUMMARY_PARSERS_,e,t)};ol.format.WFS.OGC_FID_PARSERS_={"http://www.opengis.net/ogc":{FeatureId:ol.xml.makeArrayPusher(function(e,t){return e.getAttribute("fid")})}};ol.format.WFS.fidParser_=function(e,t){ol.xml.parseNode(ol.format.WFS.OGC_FID_PARSERS_,e,t)};ol.format.WFS.INSERT_RESULTS_PARSERS_={"http://www.opengis.net/wfs":{Feature:ol.format.WFS.fidParser_}};ol.format.WFS.readInsertResults_=function(e,t){return ol.xml.pushParseAndPop([],ol.format.WFS.INSERT_RESULTS_PARSERS_,e,t)};ol.format.WFS.TRANSACTION_RESPONSE_PARSERS_={"http://www.opengis.net/wfs":{TransactionSummary:ol.xml.makeObjectPropertySetter(ol.format.WFS.readTransactionSummary_,"transactionSummary"),InsertResults:ol.xml.makeObjectPropertySetter(ol.format.WFS.readInsertResults_,"insertIds")}};ol.format.WFS.prototype.readTransactionResponseFromDocument=function(e){for(var t=e.firstChild;t;t=t.nextSibling)if(t.nodeType==Node.ELEMENT_NODE)return this.readTransactionResponseFromNode(t)};ol.format.WFS.prototype.readTransactionResponseFromNode=function(e){return ol.xml.pushParseAndPop({},ol.format.WFS.TRANSACTION_RESPONSE_PARSERS_,e,[])};ol.format.WFS.QUERY_SERIALIZERS_={"http://www.opengis.net/wfs":{PropertyName:ol.xml.makeChildAppender(ol.format.XSD.writeStringTextNode)}};ol.format.WFS.writeFeature_=function(e,t,o){var r=o[o.length-1],i=r.featureType,n=r.featureNS,a=r.gmlVersion,l=ol.xml.createElementNS(n,i);e.appendChild(l);2===a?ol.format.GML2.prototype.writeFeatureElement(l,t,o):ol.format.GML3.prototype.writeFeatureElement(l,t,o)};ol.format.WFS.writeOgcFidFilter_=function(e,t,o){var r=ol.xml.createElementNS(ol.format.WFS.OGCNS,"Filter"),i=ol.xml.createElementNS(ol.format.WFS.OGCNS,"FeatureId");r.appendChild(i);i.setAttribute("fid",t);e.appendChild(r)};ol.format.WFS.getTypeName_=function(e,t){var o=(e=e||ol.format.WFS.FEATURE_PREFIX)+":";return 0===t.indexOf(o)?t:o+t};ol.format.WFS.writeDelete_=function(e,t,o){var r=o[o.length-1];ol.asserts.assert(void 0!==t.getId(),26);var i=r.featureType,n=r.featurePrefix,a=r.featureNS,l=ol.format.WFS.getTypeName_(n,i);e.setAttribute("typeName",l);ol.xml.setAttributeNS(e,ol.format.WFS.XMLNS,"xmlns:"+n,a);var s=t.getId();void 0!==s&&ol.format.WFS.writeOgcFidFilter_(e,s,o)};ol.format.WFS.writeUpdate_=function(e,t,o){var r=o[o.length-1];ol.asserts.assert(void 0!==t.getId(),27);var i=r.featureType,n=r.featurePrefix,a=r.featureNS,l=ol.format.WFS.getTypeName_(n,i),s=t.getGeometryName();e.setAttribute("typeName",l);ol.xml.setAttributeNS(e,ol.format.WFS.XMLNS,"xmlns:"+n,a);var p=t.getId();if(void 0!==p){for(var c=t.getKeys(),u=[],g=0,d=c.length;g<d;g++){var h=t.get(c[g]);if(void 0!==h){var f=c[g];h instanceof ol.geom.Geometry&&(f=s);u.push({name:f,value:h})}}ol.xml.pushSerializeAndPop({gmlVersion:r.gmlVersion,node:e,hasZ:r.hasZ,srsName:r.srsName},ol.format.WFS.TRANSACTION_SERIALIZERS_,ol.xml.makeSimpleNodeFactory("Property"),u,o);ol.format.WFS.writeOgcFidFilter_(e,p,o)}};ol.format.WFS.writeProperty_=function(e,t,o){var r=ol.xml.createElementNS(ol.format.WFS.WFSNS,"Name"),i=o[o.length-1].gmlVersion;e.appendChild(r);ol.format.XSD.writeStringTextNode(r,t.name);if(void 0!==t.value&&null!==t.value){var n=ol.xml.createElementNS(ol.format.WFS.WFSNS,"Value");e.appendChild(n);t.value instanceof ol.geom.Geometry?2===i?ol.format.GML2.prototype.writeGeometryElement(n,t.value,o):ol.format.GML3.prototype.writeGeometryElement(n,t.value,o):ol.format.XSD.writeStringTextNode(n,t.value)}};ol.format.WFS.writeNative_=function(e,t,o){t.vendorId&&e.setAttribute("vendorId",t.vendorId);void 0!==t.safeToIgnore&&e.setAttribute("safeToIgnore",t.safeToIgnore);void 0!==t.value&&ol.format.XSD.writeStringTextNode(e,t.value)};ol.format.WFS.TRANSACTION_SERIALIZERS_={"http://www.opengis.net/wfs":{Insert:ol.xml.makeChildAppender(ol.format.WFS.writeFeature_),Update:ol.xml.makeChildAppender(ol.format.WFS.writeUpdate_),Delete:ol.xml.makeChildAppender(ol.format.WFS.writeDelete_),Property:ol.xml.makeChildAppender(ol.format.WFS.writeProperty_),Native:ol.xml.makeChildAppender(ol.format.WFS.writeNative_)}};ol.format.WFS.writeQuery_=function(e,t,o){var r,i=o[o.length-1],n=i.featurePrefix,a=i.featureNS,l=i.propertyNames,s=i.srsName;r=n?ol.format.WFS.getTypeName_(n,t):t;e.setAttribute("typeName",r);s&&e.setAttribute("srsName",s);a&&ol.xml.setAttributeNS(e,ol.format.WFS.XMLNS,"xmlns:"+n,a);var p=ol.obj.assign({},i);p.node=e;ol.xml.pushSerializeAndPop(p,ol.format.WFS.QUERY_SERIALIZERS_,ol.xml.makeSimpleNodeFactory("PropertyName"),l,o);var c=i.filter;if(c){var u=ol.xml.createElementNS(ol.format.WFS.OGCNS,"Filter");e.appendChild(u);ol.format.WFS.writeFilterCondition_(u,c,o)}};ol.format.WFS.writeFilterCondition_=function(e,t,o){var r={node:e};ol.xml.pushSerializeAndPop(r,ol.format.WFS.GETFEATURE_SERIALIZERS_,ol.xml.makeSimpleNodeFactory(t.getTagName()),[t],o)};ol.format.WFS.writeBboxFilter_=function(e,t,o){o[o.length-1].srsName=t.srsName;ol.format.WFS.writeOgcPropertyName_(e,t.geometryName);ol.format.GML3.prototype.writeGeometryElement(e,t.extent,o)};ol.format.WFS.writeContainsFilter_=function(e,t,o){o[o.length-1].srsName=t.srsName;ol.format.WFS.writeOgcPropertyName_(e,t.geometryName);ol.format.GML3.prototype.writeGeometryElement(e,t.geometry,o)};ol.format.WFS.writeIntersectsFilter_=function(e,t,o){o[o.length-1].srsName=t.srsName;ol.format.WFS.writeOgcPropertyName_(e,t.geometryName);ol.format.GML3.prototype.writeGeometryElement(e,t.geometry,o)};ol.format.WFS.writeWithinFilter_=function(e,t,o){o[o.length-1].srsName=t.srsName;ol.format.WFS.writeOgcPropertyName_(e,t.geometryName);ol.format.GML3.prototype.writeGeometryElement(e,t.geometry,o)};ol.format.WFS.writeDuringFilter_=function(e,t,o){var r=ol.xml.createElementNS(ol.format.WFS.FESNS,"ValueReference");ol.format.XSD.writeStringTextNode(r,t.propertyName);e.appendChild(r);var i=ol.xml.createElementNS(ol.format.GMLBase.GMLNS,"TimePeriod");e.appendChild(i);var n=ol.xml.createElementNS(ol.format.GMLBase.GMLNS,"begin");i.appendChild(n);ol.format.WFS.writeTimeInstant_(n,t.begin);var a=ol.xml.createElementNS(ol.format.GMLBase.GMLNS,"end");i.appendChild(a);ol.format.WFS.writeTimeInstant_(a,t.end)};ol.format.WFS.writeLogicalFilter_=function(e,t,o){for(var r={node:e},i=t.conditions,n=0,a=i.length;n<a;++n){var l=i[n];ol.xml.pushSerializeAndPop(r,ol.format.WFS.GETFEATURE_SERIALIZERS_,ol.xml.makeSimpleNodeFactory(l.getTagName()),[l],o)}};ol.format.WFS.writeNotFilter_=function(e,t,o){var r={node:e},i=t.condition;ol.xml.pushSerializeAndPop(r,ol.format.WFS.GETFEATURE_SERIALIZERS_,ol.xml.makeSimpleNodeFactory(i.getTagName()),[i],o)};ol.format.WFS.writeComparisonFilter_=function(e,t,o){void 0!==t.matchCase&&e.setAttribute("matchCase",t.matchCase.toString());ol.format.WFS.writeOgcPropertyName_(e,t.propertyName);ol.format.WFS.writeOgcLiteral_(e,""+t.expression)};ol.format.WFS.writeIsNullFilter_=function(e,t,o){ol.format.WFS.writeOgcPropertyName_(e,t.propertyName)};ol.format.WFS.writeIsBetweenFilter_=function(e,t,o){ol.format.WFS.writeOgcPropertyName_(e,t.propertyName);var r=ol.xml.createElementNS(ol.format.WFS.OGCNS,"LowerBoundary");e.appendChild(r);ol.format.WFS.writeOgcLiteral_(r,""+t.lowerBoundary);var i=ol.xml.createElementNS(ol.format.WFS.OGCNS,"UpperBoundary");e.appendChild(i);ol.format.WFS.writeOgcLiteral_(i,""+t.upperBoundary)};ol.format.WFS.writeIsLikeFilter_=function(e,t,o){e.setAttribute("wildCard",t.wildCard);e.setAttribute("singleChar",t.singleChar);e.setAttribute("escapeChar",t.escapeChar);void 0!==t.matchCase&&e.setAttribute("matchCase",t.matchCase.toString());ol.format.WFS.writeOgcPropertyName_(e,t.propertyName);ol.format.WFS.writeOgcLiteral_(e,""+t.pattern)};ol.format.WFS.writeOgcExpression_=function(e,t,o){var r=ol.xml.createElementNS(ol.format.WFS.OGCNS,e);ol.format.XSD.writeStringTextNode(r,o);t.appendChild(r)};ol.format.WFS.writeOgcPropertyName_=function(e,t){ol.format.WFS.writeOgcExpression_("PropertyName",e,t)};ol.format.WFS.writeOgcLiteral_=function(e,t){ol.format.WFS.writeOgcExpression_("Literal",e,t)};ol.format.WFS.writeTimeInstant_=function(e,t){var o=ol.xml.createElementNS(ol.format.GMLBase.GMLNS,"TimeInstant");e.appendChild(o);var r=ol.xml.createElementNS(ol.format.GMLBase.GMLNS,"timePosition");o.appendChild(r);ol.format.XSD.writeStringTextNode(r,t)};ol.format.WFS.GETFEATURE_SERIALIZERS_={"http://www.opengis.net/wfs":{Query:ol.xml.makeChildAppender(ol.format.WFS.writeQuery_)},"http://www.opengis.net/ogc":{During:ol.xml.makeChildAppender(ol.format.WFS.writeDuringFilter_),And:ol.xml.makeChildAppender(ol.format.WFS.writeLogicalFilter_),Or:ol.xml.makeChildAppender(ol.format.WFS.writeLogicalFilter_),Not:ol.xml.makeChildAppender(ol.format.WFS.writeNotFilter_),BBOX:ol.xml.makeChildAppender(ol.format.WFS.writeBboxFilter_),Contains:ol.xml.makeChildAppender(ol.format.WFS.writeContainsFilter_),Intersects:ol.xml.makeChildAppender(ol.format.WFS.writeIntersectsFilter_),Within:ol.xml.makeChildAppender(ol.format.WFS.writeWithinFilter_),PropertyIsEqualTo:ol.xml.makeChildAppender(ol.format.WFS.writeComparisonFilter_),PropertyIsNotEqualTo:ol.xml.makeChildAppender(ol.format.WFS.writeComparisonFilter_),PropertyIsLessThan:ol.xml.makeChildAppender(ol.format.WFS.writeComparisonFilter_),PropertyIsLessThanOrEqualTo:ol.xml.makeChildAppender(ol.format.WFS.writeComparisonFilter_),PropertyIsGreaterThan:ol.xml.makeChildAppender(ol.format.WFS.writeComparisonFilter_),PropertyIsGreaterThanOrEqualTo:ol.xml.makeChildAppender(ol.format.WFS.writeComparisonFilter_),PropertyIsNull:ol.xml.makeChildAppender(ol.format.WFS.writeIsNullFilter_),PropertyIsBetween:ol.xml.makeChildAppender(ol.format.WFS.writeIsBetweenFilter_),PropertyIsLike:ol.xml.makeChildAppender(ol.format.WFS.writeIsLikeFilter_)}};ol.format.WFS.writeFilter=function(e){var t=ol.xml.createElementNS(ol.format.WFS.OGCNS,"Filter");ol.format.WFS.writeFilterCondition_(t,e,[]);return t};ol.format.WFS.writeGetFeature_=function(e,t,o){var r=o[o.length-1],i=ol.obj.assign({},r);i.node=e;ol.xml.pushSerializeAndPop(i,ol.format.WFS.GETFEATURE_SERIALIZERS_,ol.xml.makeSimpleNodeFactory("Query"),t,o)};ol.format.WFS.prototype.writeGetFeature=function(e){var t,o=ol.xml.createElementNS(ol.format.WFS.WFSNS,"GetFeature");o.setAttribute("service","WFS");o.setAttribute("version","1.1.0");if(e){e.handle&&o.setAttribute("handle",e.handle);e.outputFormat&&o.setAttribute("outputFormat",e.outputFormat);void 0!==e.maxFeatures&&o.setAttribute("maxFeatures",e.maxFeatures);e.resultType&&o.setAttribute("resultType",e.resultType);void 0!==e.startIndex&&o.setAttribute("startIndex",e.startIndex);void 0!==e.count&&o.setAttribute("count",e.count);t=e.filter;if(e.bbox){ol.asserts.assert(e.geometryName,12);var r=ol.format.filter.bbox(e.geometryName,e.bbox,e.srsName);t=t?ol.format.filter.and(t,r):r}}ol.xml.setAttributeNS(o,"http://www.w3.org/2001/XMLSchema-instance","xsi:schemaLocation",this.schemaLocation_);var i={node:o,srsName:e.srsName,featureNS:e.featureNS?e.featureNS:this.featureNS_,featurePrefix:e.featurePrefix,geometryName:e.geometryName,filter:t,propertyNames:e.propertyNames?e.propertyNames:[]};ol.asserts.assert(Array.isArray(e.featureTypes),11);ol.format.WFS.writeGetFeature_(o,e.featureTypes,[i]);return o};ol.format.WFS.prototype.writeTransaction=function(e,t,o,r){var i,n,a=[],l=ol.xml.createElementNS(ol.format.WFS.WFSNS,"Transaction"),s=r.version?r.version:ol.format.WFS.DEFAULT_VERSION,p="1.0.0"===s?2:3;l.setAttribute("service","WFS");l.setAttribute("version",s);if(r){i=r.gmlOptions?r.gmlOptions:{};r.handle&&l.setAttribute("handle",r.handle)}var c=ol.format.WFS.SCHEMA_LOCATIONS[s];ol.xml.setAttributeNS(l,"http://www.w3.org/2001/XMLSchema-instance","xsi:schemaLocation",c);var u=r.featurePrefix?r.featurePrefix:ol.format.WFS.FEATURE_PREFIX;if(e){n={node:l,featureNS:r.featureNS,featureType:r.featureType,featurePrefix:u,gmlVersion:p,hasZ:r.hasZ,srsName:r.srsName};ol.obj.assign(n,i);ol.xml.pushSerializeAndPop(n,ol.format.WFS.TRANSACTION_SERIALIZERS_,ol.xml.makeSimpleNodeFactory("Insert"),e,a)}if(t){n={node:l,featureNS:r.featureNS,featureType:r.featureType,featurePrefix:u,gmlVersion:p,hasZ:r.hasZ,srsName:r.srsName};ol.obj.assign(n,i);ol.xml.pushSerializeAndPop(n,ol.format.WFS.TRANSACTION_SERIALIZERS_,ol.xml.makeSimpleNodeFactory("Update"),t,a)}o&&ol.xml.pushSerializeAndPop({node:l,featureNS:r.featureNS,featureType:r.featureType,featurePrefix:u,gmlVersion:p,srsName:r.srsName},ol.format.WFS.TRANSACTION_SERIALIZERS_,ol.xml.makeSimpleNodeFactory("Delete"),o,a);r.nativeElements&&ol.xml.pushSerializeAndPop({node:l,featureNS:r.featureNS,featureType:r.featureType,featurePrefix:u,gmlVersion:p,srsName:r.srsName},ol.format.WFS.TRANSACTION_SERIALIZERS_,ol.xml.makeSimpleNodeFactory("Native"),r.nativeElements,a);return l};ol.format.WFS.prototype.readProjection;ol.format.WFS.prototype.readProjectionFromDocument=function(e){for(var t=e.firstChild;t;t=t.nextSibling)if(t.nodeType==Node.ELEMENT_NODE)return this.readProjectionFromNode(t);return null};ol.format.WFS.prototype.readProjectionFromNode=function(e){if(e.firstElementChild&&e.firstElementChild.firstElementChild)for(var t=(e=e.firstElementChild.firstElementChild).firstElementChild;t;t=t.nextElementSibling)if(0!==t.childNodes.length&&(1!==t.childNodes.length||3!==t.firstChild.nodeType)){var o=[{}];this.gmlFormat_.readGeometryElement(t,o);return ol.proj.get(o.pop().srsName)}return null};goog.provide("ol.format.WKT");goog.require("ol");goog.require("ol.Feature");goog.require("ol.format.Feature");goog.require("ol.format.TextFeature");goog.require("ol.geom.GeometryCollection");goog.require("ol.geom.GeometryType");goog.require("ol.geom.GeometryLayout");goog.require("ol.geom.LineString");goog.require("ol.geom.MultiLineString");goog.require("ol.geom.MultiPoint");goog.require("ol.geom.MultiPolygon");goog.require("ol.geom.Point");goog.require("ol.geom.Polygon");goog.require("ol.geom.SimpleGeometry");ol.format.WKT=function(e){var t=e||{};ol.format.TextFeature.call(this);this.splitCollection_=void 0!==t.splitCollection&&t.splitCollection};ol.inherits(ol.format.WKT,ol.format.TextFeature);ol.format.WKT.EMPTY="EMPTY";ol.format.WKT.Z="Z";ol.format.WKT.M="M";ol.format.WKT.ZM="ZM";ol.format.WKT.encodePointGeometry_=function(e){var t=e.getCoordinates();return 0===t.length?"":t.join(" ")};ol.format.WKT.encodeMultiPointGeometry_=function(e){for(var t=[],o=e.getPoints(),r=0,i=o.length;r<i;++r)t.push("("+ol.format.WKT.encodePointGeometry_(o[r])+")");return t.join(",")};ol.format.WKT.encodeGeometryCollectionGeometry_=function(e){for(var t=[],o=e.getGeometries(),r=0,i=o.length;r<i;++r)t.push(ol.format.WKT.encode_(o[r]));return t.join(",")};ol.format.WKT.encodeLineStringGeometry_=function(e){for(var t=e.getCoordinates(),o=[],r=0,i=t.length;r<i;++r)o.push(t[r].join(" "));return o.join(",")};ol.format.WKT.encodeMultiLineStringGeometry_=function(e){for(var t=[],o=e.getLineStrings(),r=0,i=o.length;r<i;++r)t.push("("+ol.format.WKT.encodeLineStringGeometry_(o[r])+")");return t.join(",")};ol.format.WKT.encodePolygonGeometry_=function(e){for(var t=[],o=e.getLinearRings(),r=0,i=o.length;r<i;++r)t.push("("+ol.format.WKT.encodeLineStringGeometry_(o[r])+")");return t.join(",")};ol.format.WKT.encodeMultiPolygonGeometry_=function(e){for(var t=[],o=e.getPolygons(),r=0,i=o.length;r<i;++r)t.push("("+ol.format.WKT.encodePolygonGeometry_(o[r])+")");return t.join(",")};ol.format.WKT.encodeGeometryLayout_=function(e){var t=e.getLayout(),o="";t!==ol.geom.GeometryLayout.XYZ&&t!==ol.geom.GeometryLayout.XYZM||(o+=ol.format.WKT.Z);t!==ol.geom.GeometryLayout.XYM&&t!==ol.geom.GeometryLayout.XYZM||(o+=ol.format.WKT.M);return o};ol.format.WKT.encode_=function(e){var t=e.getType(),o=(0,ol.format.WKT.GeometryEncoder_[t])(e);t=t.toUpperCase();if(e instanceof ol.geom.SimpleGeometry){var r=ol.format.WKT.encodeGeometryLayout_(e);r.length>0&&(t+=" "+r)}return 0===o.length?t+" "+ol.format.WKT.EMPTY:t+"("+o+")"};ol.format.WKT.GeometryEncoder_={Point:ol.format.WKT.encodePointGeometry_,LineString:ol.format.WKT.encodeLineStringGeometry_,Polygon:ol.format.WKT.encodePolygonGeometry_,MultiPoint:ol.format.WKT.encodeMultiPointGeometry_,MultiLineString:ol.format.WKT.encodeMultiLineStringGeometry_,MultiPolygon:ol.format.WKT.encodeMultiPolygonGeometry_,GeometryCollection:ol.format.WKT.encodeGeometryCollectionGeometry_};ol.format.WKT.prototype.parse_=function(e){var t=new ol.format.WKT.Lexer(e);return new ol.format.WKT.Parser(t).parse()};ol.format.WKT.prototype.readFeature;ol.format.WKT.prototype.readFeatureFromText=function(e,t){var o=this.readGeometryFromText(e,t);if(o){var r=new ol.Feature;r.setGeometry(o);return r}return null};ol.format.WKT.prototype.readFeatures;ol.format.WKT.prototype.readFeaturesFromText=function(e,t){for(var o,r=[],i=this.readGeometryFromText(e,t),n=[],a=0,l=(r=this.splitCollection_&&i.getType()==ol.geom.GeometryType.GEOMETRY_COLLECTION?i.getGeometriesArray():[i]).length;a<l;++a){(o=new ol.Feature).setGeometry(r[a]);n.push(o)}return n};ol.format.WKT.prototype.readGeometry;ol.format.WKT.prototype.readGeometryFromText=function(e,t){var o=this.parse_(e);return o?ol.format.Feature.transformWithOptions(o,!1,t):null};ol.format.WKT.prototype.writeFeature;ol.format.WKT.prototype.writeFeatureText=function(e,t){var o=e.getGeometry();return o?this.writeGeometryText(o,t):""};ol.format.WKT.prototype.writeFeatures;ol.format.WKT.prototype.writeFeaturesText=function(e,t){if(1==e.length)return this.writeFeatureText(e[0],t);for(var o=[],r=0,i=e.length;r<i;++r)o.push(e[r].getGeometry());var n=new ol.geom.GeometryCollection(o);return this.writeGeometryText(n,t)};ol.format.WKT.prototype.writeGeometry;ol.format.WKT.prototype.writeGeometryText=function(e,t){return ol.format.WKT.encode_(ol.format.Feature.transformWithOptions(e,!0,t))};ol.format.WKT.TokenType_={TEXT:1,LEFT_PAREN:2,RIGHT_PAREN:3,NUMBER:4,COMMA:5,EOF:6};ol.format.WKT.Lexer=function(e){this.wkt=e;this.index_=-1};ol.format.WKT.Lexer.prototype.isAlpha_=function(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"};ol.format.WKT.Lexer.prototype.isNumeric_=function(e,t){return e>="0"&&e<="9"||"."==e&&!(void 0!==t&&t)};ol.format.WKT.Lexer.prototype.isWhiteSpace_=function(e){return" "==e||"\t"==e||"\r"==e||"\n"==e};ol.format.WKT.Lexer.prototype.nextChar_=function(){return this.wkt.charAt(++this.index_)};ol.format.WKT.Lexer.prototype.nextToken=function(){var e=this.nextChar_(),t={position:this.index_,value:e};if("("==e)t.type=ol.format.WKT.TokenType_.LEFT_PAREN;else if(","==e)t.type=ol.format.WKT.TokenType_.COMMA;else if(")"==e)t.type=ol.format.WKT.TokenType_.RIGHT_PAREN;else if(this.isNumeric_(e)||"-"==e){t.type=ol.format.WKT.TokenType_.NUMBER;t.value=this.readNumber_()}else if(this.isAlpha_(e)){t.type=ol.format.WKT.TokenType_.TEXT;t.value=this.readText_()}else{if(this.isWhiteSpace_(e))return this.nextToken();if(""!==e)throw new Error("Unexpected character: "+e);t.type=ol.format.WKT.TokenType_.EOF}return t};ol.format.WKT.Lexer.prototype.readNumber_=function(){var e,t=this.index_,o=!1,r=!1;do{"."==e?o=!0:"e"!=e&&"E"!=e||(r=!0);e=this.nextChar_()}while(this.isNumeric_(e,o)||!r&&("e"==e||"E"==e)||r&&("-"==e||"+"==e));return parseFloat(this.wkt.substring(t,this.index_--))};ol.format.WKT.Lexer.prototype.readText_=function(){var e,t=this.index_;do{e=this.nextChar_()}while(this.isAlpha_(e));return this.wkt.substring(t,this.index_--).toUpperCase()};ol.format.WKT.Parser=function(e){this.lexer_=e;this.token_;this.layout_=ol.geom.GeometryLayout.XY};ol.format.WKT.Parser.prototype.consume_=function(){this.token_=this.lexer_.nextToken()};ol.format.WKT.Parser.prototype.isTokenType=function(e){return this.token_.type==e};ol.format.WKT.Parser.prototype.match=function(e){var t=this.isTokenType(e);t&&this.consume_();return t};ol.format.WKT.Parser.prototype.parse=function(){this.consume_();return this.parseGeometry_()};ol.format.WKT.Parser.prototype.parseGeometryLayout_=function(){var e=ol.geom.GeometryLayout.XY,t=this.token_;if(this.isTokenType(ol.format.WKT.TokenType_.TEXT)){var o=t.value;o===ol.format.WKT.Z?e=ol.geom.GeometryLayout.XYZ:o===ol.format.WKT.M?e=ol.geom.GeometryLayout.XYM:o===ol.format.WKT.ZM&&(e=ol.geom.GeometryLayout.XYZM);e!==ol.geom.GeometryLayout.XY&&this.consume_()}return e};ol.format.WKT.Parser.prototype.parseGeometry_=function(){var e=this.token_;if(this.match(ol.format.WKT.TokenType_.TEXT)){var t=e.value;this.layout_=this.parseGeometryLayout_();if(t==ol.geom.GeometryType.GEOMETRY_COLLECTION.toUpperCase()){var o=this.parseGeometryCollectionText_();return new ol.geom.GeometryCollection(o)}var r=ol.format.WKT.Parser.GeometryParser_[t],i=ol.format.WKT.Parser.GeometryConstructor_[t];if(!r||!i)throw new Error("Invalid geometry type: "+t);return new i(r.call(this),this.layout_)}throw new Error(this.formatErrorMessage_())};ol.format.WKT.Parser.prototype.parseGeometryCollectionText_=function(){if(this.match(ol.format.WKT.TokenType_.LEFT_PAREN)){var e=[];do{e.push(this.parseGeometry_())}while(this.match(ol.format.WKT.TokenType_.COMMA));if(this.match(ol.format.WKT.TokenType_.RIGHT_PAREN))return e}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())};ol.format.WKT.Parser.prototype.parsePointText_=function(){if(this.match(ol.format.WKT.TokenType_.LEFT_PAREN)){var e=this.parsePoint_();if(this.match(ol.format.WKT.TokenType_.RIGHT_PAREN))return e}else if(this.isEmptyGeometry_())return null;throw new Error(this.formatErrorMessage_())};ol.format.WKT.Parser.prototype.parseLineStringText_=function(){if(this.match(ol.format.WKT.TokenType_.LEFT_PAREN)){var e=this.parsePointList_();if(this.match(ol.format.WKT.TokenType_.RIGHT_PAREN))return e}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())};ol.format.WKT.Parser.prototype.parsePolygonText_=function(){if(this.match(ol.format.WKT.TokenType_.LEFT_PAREN)){var e=this.parseLineStringTextList_();if(this.match(ol.format.WKT.TokenType_.RIGHT_PAREN))return e}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())};ol.format.WKT.Parser.prototype.parseMultiPointText_=function(){if(this.match(ol.format.WKT.TokenType_.LEFT_PAREN)){var e;e=this.token_.type==ol.format.WKT.TokenType_.LEFT_PAREN?this.parsePointTextList_():this.parsePointList_();if(this.match(ol.format.WKT.TokenType_.RIGHT_PAREN))return e}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())};ol.format.WKT.Parser.prototype.parseMultiLineStringText_=function(){if(this.match(ol.format.WKT.TokenType_.LEFT_PAREN)){var e=this.parseLineStringTextList_();if(this.match(ol.format.WKT.TokenType_.RIGHT_PAREN))return e}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())};ol.format.WKT.Parser.prototype.parseMultiPolygonText_=function(){if(this.match(ol.format.WKT.TokenType_.LEFT_PAREN)){var e=this.parsePolygonTextList_();if(this.match(ol.format.WKT.TokenType_.RIGHT_PAREN))return e}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())};ol.format.WKT.Parser.prototype.parsePoint_=function(){for(var e=[],t=this.layout_.length,o=0;o<t;++o){var r=this.token_;if(!this.match(ol.format.WKT.TokenType_.NUMBER))break;e.push(r.value)}if(e.length==t)return e;throw new Error(this.formatErrorMessage_())};ol.format.WKT.Parser.prototype.parsePointList_=function(){for(var e=[this.parsePoint_()];this.match(ol.format.WKT.TokenType_.COMMA);)e.push(this.parsePoint_());return e};ol.format.WKT.Parser.prototype.parsePointTextList_=function(){for(var e=[this.parsePointText_()];this.match(ol.format.WKT.TokenType_.COMMA);)e.push(this.parsePointText_());return e};ol.format.WKT.Parser.prototype.parseLineStringTextList_=function(){for(var e=[this.parseLineStringText_()];this.match(ol.format.WKT.TokenType_.COMMA);)e.push(this.parseLineStringText_());return e};ol.format.WKT.Parser.prototype.parsePolygonTextList_=function(){for(var e=[this.parsePolygonText_()];this.match(ol.format.WKT.TokenType_.COMMA);)e.push(this.parsePolygonText_());return e};ol.format.WKT.Parser.prototype.isEmptyGeometry_=function(){var e=this.isTokenType(ol.format.WKT.TokenType_.TEXT)&&this.token_.value==ol.format.WKT.EMPTY;e&&this.consume_();return e};ol.format.WKT.Parser.prototype.formatErrorMessage_=function(){return"Unexpected `"+this.token_.value+"` at position "+this.token_.position+" in `"+this.lexer_.wkt+"`"};ol.format.WKT.Parser.GeometryConstructor_={POINT:ol.geom.Point,LINESTRING:ol.geom.LineString,POLYGON:ol.geom.Polygon,MULTIPOINT:ol.geom.MultiPoint,MULTILINESTRING:ol.geom.MultiLineString,MULTIPOLYGON:ol.geom.MultiPolygon};ol.format.WKT.Parser.GeometryParser_={POINT:ol.format.WKT.Parser.prototype.parsePointText_,LINESTRING:ol.format.WKT.Parser.prototype.parseLineStringText_,POLYGON:ol.format.WKT.Parser.prototype.parsePolygonText_,MULTIPOINT:ol.format.WKT.Parser.prototype.parseMultiPointText_,MULTILINESTRING:ol.format.WKT.Parser.prototype.parseMultiLineStringText_,MULTIPOLYGON:ol.format.WKT.Parser.prototype.parseMultiPolygonText_};goog.provide("ol.format.WMSCapabilities");goog.require("ol");goog.require("ol.format.XLink");goog.require("ol.format.XML");goog.require("ol.format.XSD");goog.require("ol.xml");ol.format.WMSCapabilities=function(){ol.format.XML.call(this);this.version=void 0};ol.inherits(ol.format.WMSCapabilities,ol.format.XML);ol.format.WMSCapabilities.prototype.read;ol.format.WMSCapabilities.prototype.readFromDocument=function(e){for(var t=e.firstChild;t;t=t.nextSibling)if(t.nodeType==Node.ELEMENT_NODE)return this.readFromNode(t);return null};ol.format.WMSCapabilities.prototype.readFromNode=function(e){this.version=e.getAttribute("version").trim();var t=ol.xml.pushParseAndPop({version:this.version},ol.format.WMSCapabilities.PARSERS_,e,[]);return t||null};ol.format.WMSCapabilities.readAttribution_=function(e,t){return ol.xml.pushParseAndPop({},ol.format.WMSCapabilities.ATTRIBUTION_PARSERS_,e,t)};ol.format.WMSCapabilities.readBoundingBox_=function(e,t){var o=[ol.format.XSD.readDecimalString(e.getAttribute("minx")),ol.format.XSD.readDecimalString(e.getAttribute("miny")),ol.format.XSD.readDecimalString(e.getAttribute("maxx")),ol.format.XSD.readDecimalString(e.getAttribute("maxy"))],r=[ol.format.XSD.readDecimalString(e.getAttribute("resx")),ol.format.XSD.readDecimalString(e.getAttribute("resy"))];return{crs:e.getAttribute("CRS"),extent:o,res:r}};ol.format.WMSCapabilities.readEXGeographicBoundingBox_=function(e,t){var o=ol.xml.pushParseAndPop({},ol.format.WMSCapabilities.EX_GEOGRAPHIC_BOUNDING_BOX_PARSERS_,e,t);if(o){var r=o.westBoundLongitude,i=o.southBoundLatitude,n=o.eastBoundLongitude,a=o.northBoundLatitude;if(void 0!==r&&void 0!==i&&void 0!==n&&void 0!==a)return[r,i,n,a]}};ol.format.WMSCapabilities.readCapability_=function(e,t){return ol.xml.pushParseAndPop({},ol.format.WMSCapabilities.CAPABILITY_PARSERS_,e,t)};ol.format.WMSCapabilities.readService_=function(e,t){return ol.xml.pushParseAndPop({},ol.format.WMSCapabilities.SERVICE_PARSERS_,e,t)};ol.format.WMSCapabilities.readContactInformation_=function(e,t){return ol.xml.pushParseAndPop({},ol.format.WMSCapabilities.CONTACT_INFORMATION_PARSERS_,e,t)};ol.format.WMSCapabilities.readContactPersonPrimary_=function(e,t){return ol.xml.pushParseAndPop({},ol.format.WMSCapabilities.CONTACT_PERSON_PARSERS_,e,t)};ol.format.WMSCapabilities.readContactAddress_=function(e,t){return ol.xml.pushParseAndPop({},ol.format.WMSCapabilities.CONTACT_ADDRESS_PARSERS_,e,t)};ol.format.WMSCapabilities.readException_=function(e,t){return ol.xml.pushParseAndPop([],ol.format.WMSCapabilities.EXCEPTION_PARSERS_,e,t)};ol.format.WMSCapabilities.readCapabilityLayer_=function(e,t){return ol.xml.pushParseAndPop({},ol.format.WMSCapabilities.LAYER_PARSERS_,e,t)};ol.format.WMSCapabilities.readLayer_=function(e,t){var o=t[t.length-1],r=ol.xml.pushParseAndPop({},ol.format.WMSCapabilities.LAYER_PARSERS_,e,t);if(r){var i=ol.format.XSD.readBooleanString(e.getAttribute("queryable"));void 0===i&&(i=o.queryable);r.queryable=void 0!==i&&i;var n=ol.format.XSD.readNonNegativeIntegerString(e.getAttribute("cascaded"));void 0===n&&(n=o.cascaded);r.cascaded=n;var a=ol.format.XSD.readBooleanString(e.getAttribute("opaque"));void 0===a&&(a=o.opaque);r.opaque=void 0!==a&&a;var l=ol.format.XSD.readBooleanString(e.getAttribute("noSubsets"));void 0===l&&(l=o.noSubsets);r.noSubsets=void 0!==l&&l;var s=ol.format.XSD.readDecimalString(e.getAttribute("fixedWidth"));s||(s=o.fixedWidth);r.fixedWidth=s;var p=ol.format.XSD.readDecimalString(e.getAttribute("fixedHeight"));p||(p=o.fixedHeight);r.fixedHeight=p;["Style","CRS","AuthorityURL"].forEach(function(e){if(e in o){var t=r[e]||[];r[e]=t.concat(o[e])}});["EX_GeographicBoundingBox","BoundingBox","Dimension","Attribution","MinScaleDenominator","MaxScaleDenominator"].forEach(function(e){if(!(e in r)){var t=o[e];r[e]=t}});return r}};ol.format.WMSCapabilities.readDimension_=function(e,t){return{name:e.getAttribute("name"),units:e.getAttribute("units"),unitSymbol:e.getAttribute("unitSymbol"),default:e.getAttribute("default"),multipleValues:ol.format.XSD.readBooleanString(e.getAttribute("multipleValues")),nearestValue:ol.format.XSD.readBooleanString(e.getAttribute("nearestValue")),current:ol.format.XSD.readBooleanString(e.getAttribute("current")),values:ol.format.XSD.readString(e)}};ol.format.WMSCapabilities.readFormatOnlineresource_=function(e,t){return ol.xml.pushParseAndPop({},ol.format.WMSCapabilities.FORMAT_ONLINERESOURCE_PARSERS_,e,t)};ol.format.WMSCapabilities.readRequest_=function(e,t){return ol.xml.pushParseAndPop({},ol.format.WMSCapabilities.REQUEST_PARSERS_,e,t)};ol.format.WMSCapabilities.readDCPType_=function(e,t){return ol.xml.pushParseAndPop({},ol.format.WMSCapabilities.DCPTYPE_PARSERS_,e,t)};ol.format.WMSCapabilities.readHTTP_=function(e,t){return ol.xml.pushParseAndPop({},ol.format.WMSCapabilities.HTTP_PARSERS_,e,t)};ol.format.WMSCapabilities.readOperationType_=function(e,t){return ol.xml.pushParseAndPop({},ol.format.WMSCapabilities.OPERATIONTYPE_PARSERS_,e,t)};ol.format.WMSCapabilities.readSizedFormatOnlineresource_=function(e,t){var o=ol.format.WMSCapabilities.readFormatOnlineresource_(e,t);if(o){var r=[ol.format.XSD.readNonNegativeIntegerString(e.getAttribute("width")),ol.format.XSD.readNonNegativeIntegerString(e.getAttribute("height"))];o.size=r;return o}};ol.format.WMSCapabilities.readAuthorityURL_=function(e,t){var o=ol.format.WMSCapabilities.readFormatOnlineresource_(e,t);if(o){o.name=e.getAttribute("name");return o}};ol.format.WMSCapabilities.readMetadataURL_=function(e,t){var o=ol.format.WMSCapabilities.readFormatOnlineresource_(e,t);if(o){o.type=e.getAttribute("type");return o}};ol.format.WMSCapabilities.readStyle_=function(e,t){return ol.xml.pushParseAndPop({},ol.format.WMSCapabilities.STYLE_PARSERS_,e,t)};ol.format.WMSCapabilities.readKeywordList_=function(e,t){return ol.xml.pushParseAndPop([],ol.format.WMSCapabilities.KEYWORDLIST_PARSERS_,e,t)};ol.format.WMSCapabilities.NAMESPACE_URIS_=[null,"http://www.opengis.net/wms"];ol.format.WMSCapabilities.PARSERS_=ol.xml.makeStructureNS(ol.format.WMSCapabilities.NAMESPACE_URIS_,{Service:ol.xml.makeObjectPropertySetter(ol.format.WMSCapabilities.readService_),Capability:ol.xml.makeObjectPropertySetter(ol.format.WMSCapabilities.readCapability_)});ol.format.WMSCapabilities.CAPABILITY_PARSERS_=ol.xml.makeStructureNS(ol.format.WMSCapabilities.NAMESPACE_URIS_,{Request:ol.xml.makeObjectPropertySetter(ol.format.WMSCapabilities.readRequest_),Exception:ol.xml.makeObjectPropertySetter(ol.format.WMSCapabilities.readException_),Layer:ol.xml.makeObjectPropertySetter(ol.format.WMSCapabilities.readCapabilityLayer_)});ol.format.WMSCapabilities.SERVICE_PARSERS_=ol.xml.makeStructureNS(ol.format.WMSCapabilities.NAMESPACE_URIS_,{Name:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),Title:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),Abstract:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),KeywordList:ol.xml.makeObjectPropertySetter(ol.format.WMSCapabilities.readKeywordList_),OnlineResource:ol.xml.makeObjectPropertySetter(ol.format.XLink.readHref),ContactInformation:ol.xml.makeObjectPropertySetter(ol.format.WMSCapabilities.readContactInformation_),Fees:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),AccessConstraints:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),LayerLimit:ol.xml.makeObjectPropertySetter(ol.format.XSD.readNonNegativeInteger),MaxWidth:ol.xml.makeObjectPropertySetter(ol.format.XSD.readNonNegativeInteger),MaxHeight:ol.xml.makeObjectPropertySetter(ol.format.XSD.readNonNegativeInteger)});ol.format.WMSCapabilities.CONTACT_INFORMATION_PARSERS_=ol.xml.makeStructureNS(ol.format.WMSCapabilities.NAMESPACE_URIS_,{ContactPersonPrimary:ol.xml.makeObjectPropertySetter(ol.format.WMSCapabilities.readContactPersonPrimary_),ContactPosition:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),ContactAddress:ol.xml.makeObjectPropertySetter(ol.format.WMSCapabilities.readContactAddress_),ContactVoiceTelephone:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),ContactFacsimileTelephone:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),ContactElectronicMailAddress:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString)});ol.format.WMSCapabilities.CONTACT_PERSON_PARSERS_=ol.xml.makeStructureNS(ol.format.WMSCapabilities.NAMESPACE_URIS_,{ContactPerson:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),ContactOrganization:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString)});ol.format.WMSCapabilities.CONTACT_ADDRESS_PARSERS_=ol.xml.makeStructureNS(ol.format.WMSCapabilities.NAMESPACE_URIS_,{AddressType:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),Address:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),City:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),StateOrProvince:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),PostCode:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),Country:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString)});ol.format.WMSCapabilities.EXCEPTION_PARSERS_=ol.xml.makeStructureNS(ol.format.WMSCapabilities.NAMESPACE_URIS_,{Format:ol.xml.makeArrayPusher(ol.format.XSD.readString)});ol.format.WMSCapabilities.LAYER_PARSERS_=ol.xml.makeStructureNS(ol.format.WMSCapabilities.NAMESPACE_URIS_,{Name:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),Title:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),Abstract:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),KeywordList:ol.xml.makeObjectPropertySetter(ol.format.WMSCapabilities.readKeywordList_),CRS:ol.xml.makeObjectPropertyPusher(ol.format.XSD.readString),EX_GeographicBoundingBox:ol.xml.makeObjectPropertySetter(ol.format.WMSCapabilities.readEXGeographicBoundingBox_),BoundingBox:ol.xml.makeObjectPropertyPusher(ol.format.WMSCapabilities.readBoundingBox_),Dimension:ol.xml.makeObjectPropertyPusher(ol.format.WMSCapabilities.readDimension_),Attribution:ol.xml.makeObjectPropertySetter(ol.format.WMSCapabilities.readAttribution_),AuthorityURL:ol.xml.makeObjectPropertyPusher(ol.format.WMSCapabilities.readAuthorityURL_),Identifier:ol.xml.makeObjectPropertyPusher(ol.format.XSD.readString),MetadataURL:ol.xml.makeObjectPropertyPusher(ol.format.WMSCapabilities.readMetadataURL_),DataURL:ol.xml.makeObjectPropertyPusher(ol.format.WMSCapabilities.readFormatOnlineresource_),FeatureListURL:ol.xml.makeObjectPropertyPusher(ol.format.WMSCapabilities.readFormatOnlineresource_),Style:ol.xml.makeObjectPropertyPusher(ol.format.WMSCapabilities.readStyle_),MinScaleDenominator:ol.xml.makeObjectPropertySetter(ol.format.XSD.readDecimal),MaxScaleDenominator:ol.xml.makeObjectPropertySetter(ol.format.XSD.readDecimal),Layer:ol.xml.makeObjectPropertyPusher(ol.format.WMSCapabilities.readLayer_)});ol.format.WMSCapabilities.ATTRIBUTION_PARSERS_=ol.xml.makeStructureNS(ol.format.WMSCapabilities.NAMESPACE_URIS_,{Title:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),OnlineResource:ol.xml.makeObjectPropertySetter(ol.format.XLink.readHref),LogoURL:ol.xml.makeObjectPropertySetter(ol.format.WMSCapabilities.readSizedFormatOnlineresource_)});ol.format.WMSCapabilities.EX_GEOGRAPHIC_BOUNDING_BOX_PARSERS_=ol.xml.makeStructureNS(ol.format.WMSCapabilities.NAMESPACE_URIS_,{westBoundLongitude:ol.xml.makeObjectPropertySetter(ol.format.XSD.readDecimal),eastBoundLongitude:ol.xml.makeObjectPropertySetter(ol.format.XSD.readDecimal),southBoundLatitude:ol.xml.makeObjectPropertySetter(ol.format.XSD.readDecimal),northBoundLatitude:ol.xml.makeObjectPropertySetter(ol.format.XSD.readDecimal)});ol.format.WMSCapabilities.REQUEST_PARSERS_=ol.xml.makeStructureNS(ol.format.WMSCapabilities.NAMESPACE_URIS_,{GetCapabilities:ol.xml.makeObjectPropertySetter(ol.format.WMSCapabilities.readOperationType_),GetMap:ol.xml.makeObjectPropertySetter(ol.format.WMSCapabilities.readOperationType_),GetFeatureInfo:ol.xml.makeObjectPropertySetter(ol.format.WMSCapabilities.readOperationType_)});ol.format.WMSCapabilities.OPERATIONTYPE_PARSERS_=ol.xml.makeStructureNS(ol.format.WMSCapabilities.NAMESPACE_URIS_,{Format:ol.xml.makeObjectPropertyPusher(ol.format.XSD.readString),DCPType:ol.xml.makeObjectPropertyPusher(ol.format.WMSCapabilities.readDCPType_)});ol.format.WMSCapabilities.DCPTYPE_PARSERS_=ol.xml.makeStructureNS(ol.format.WMSCapabilities.NAMESPACE_URIS_,{HTTP:ol.xml.makeObjectPropertySetter(ol.format.WMSCapabilities.readHTTP_)});ol.format.WMSCapabilities.HTTP_PARSERS_=ol.xml.makeStructureNS(ol.format.WMSCapabilities.NAMESPACE_URIS_,{Get:ol.xml.makeObjectPropertySetter(ol.format.WMSCapabilities.readFormatOnlineresource_),Post:ol.xml.makeObjectPropertySetter(ol.format.WMSCapabilities.readFormatOnlineresource_)});ol.format.WMSCapabilities.STYLE_PARSERS_=ol.xml.makeStructureNS(ol.format.WMSCapabilities.NAMESPACE_URIS_,{Name:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),Title:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),Abstract:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),LegendURL:ol.xml.makeObjectPropertyPusher(ol.format.WMSCapabilities.readSizedFormatOnlineresource_),StyleSheetURL:ol.xml.makeObjectPropertySetter(ol.format.WMSCapabilities.readFormatOnlineresource_),StyleURL:ol.xml.makeObjectPropertySetter(ol.format.WMSCapabilities.readFormatOnlineresource_)});ol.format.WMSCapabilities.FORMAT_ONLINERESOURCE_PARSERS_=ol.xml.makeStructureNS(ol.format.WMSCapabilities.NAMESPACE_URIS_,{Format:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),OnlineResource:ol.xml.makeObjectPropertySetter(ol.format.XLink.readHref)});ol.format.WMSCapabilities.KEYWORDLIST_PARSERS_=ol.xml.makeStructureNS(ol.format.WMSCapabilities.NAMESPACE_URIS_,{Keyword:ol.xml.makeArrayPusher(ol.format.XSD.readString)});goog.provide("ol.format.WMSGetFeatureInfo");goog.require("ol");goog.require("ol.array");goog.require("ol.format.GML2");goog.require("ol.format.XMLFeature");goog.require("ol.obj");goog.require("ol.xml");ol.format.WMSGetFeatureInfo=function(e){var t=e||{};this.featureNS_="http://mapserver.gis.umn.edu/mapserver";this.gmlFormat_=new ol.format.GML2;this.layers_=t.layers?t.layers:null;ol.format.XMLFeature.call(this)};ol.inherits(ol.format.WMSGetFeatureInfo,ol.format.XMLFeature);ol.format.WMSGetFeatureInfo.featureIdentifier_="_feature";ol.format.WMSGetFeatureInfo.layerIdentifier_="_layer";ol.format.WMSGetFeatureInfo.prototype.getLayers=function(){return this.layers_};ol.format.WMSGetFeatureInfo.prototype.setLayers=function(e){this.layers_=e};ol.format.WMSGetFeatureInfo.prototype.readFeatures_=function(e,t){e.setAttribute("namespaceURI",this.featureNS_);var o=e.localName,r=[];if(0===e.childNodes.length)return r;if("msGMLOutput"==o)for(var i=0,n=e.childNodes.length;i<n;i++){var a=e.childNodes[i];if(a.nodeType===Node.ELEMENT_NODE){var l=t[0],s=ol.format.WMSGetFeatureInfo.layerIdentifier_,p=a.localName.replace(s,"");if(!this.layers_||ol.array.includes(this.layers_,p)){var c=p+ol.format.WMSGetFeatureInfo.featureIdentifier_;l.featureType=c;l.featureNS=this.featureNS_;var u={};u[c]=ol.xml.makeArrayPusher(this.gmlFormat_.readFeatureElement,this.gmlFormat_);var g=ol.xml.makeStructureNS([l.featureNS,null],u);a.setAttribute("namespaceURI",this.featureNS_);var d=ol.xml.pushParseAndPop([],g,a,t,this.gmlFormat_);d&&ol.array.extend(r,d)}}}if("FeatureCollection"==o){var h=ol.xml.pushParseAndPop([],this.gmlFormat_.FEATURE_COLLECTION_PARSERS,e,[{}],this.gmlFormat_);h&&(r=h)}return r};ol.format.WMSGetFeatureInfo.prototype.readFeatures;ol.format.WMSGetFeatureInfo.prototype.readFeaturesFromNode=function(e,t){var o={};t&&ol.obj.assign(o,this.getReadOptions(e,t));return this.readFeatures_(e,[o])};ol.format.WMSGetFeatureInfo.prototype.writeFeatureNode=function(e,t){};ol.format.WMSGetFeatureInfo.prototype.writeFeaturesNode=function(e,t){};ol.format.WMSGetFeatureInfo.prototype.writeGeometryNode=function(e,t){};goog.provide("ol.format.WMTSCapabilities");goog.require("ol");goog.require("ol.extent");goog.require("ol.format.OWS");goog.require("ol.format.XLink");goog.require("ol.format.XML");goog.require("ol.format.XSD");goog.require("ol.xml");ol.format.WMTSCapabilities=function(){ol.format.XML.call(this);this.owsParser_=new ol.format.OWS};ol.inherits(ol.format.WMTSCapabilities,ol.format.XML);ol.format.WMTSCapabilities.prototype.read;ol.format.WMTSCapabilities.prototype.readFromDocument=function(e){for(var t=e.firstChild;t;t=t.nextSibling)if(t.nodeType==Node.ELEMENT_NODE)return this.readFromNode(t);return null};ol.format.WMTSCapabilities.prototype.readFromNode=function(e){var t=e.getAttribute("version").trim(),o=this.owsParser_.readFromNode(e);if(!o)return null;o.version=t;return(o=ol.xml.pushParseAndPop(o,ol.format.WMTSCapabilities.PARSERS_,e,[]))||null};ol.format.WMTSCapabilities.readContents_=function(e,t){return ol.xml.pushParseAndPop({},ol.format.WMTSCapabilities.CONTENTS_PARSERS_,e,t)};ol.format.WMTSCapabilities.readLayer_=function(e,t){return ol.xml.pushParseAndPop({},ol.format.WMTSCapabilities.LAYER_PARSERS_,e,t)};ol.format.WMTSCapabilities.readTileMatrixSet_=function(e,t){return ol.xml.pushParseAndPop({},ol.format.WMTSCapabilities.TMS_PARSERS_,e,t)};ol.format.WMTSCapabilities.readStyle_=function(e,t){var o=ol.xml.pushParseAndPop({},ol.format.WMTSCapabilities.STYLE_PARSERS_,e,t);if(o){var r="true"===e.getAttribute("isDefault");o.isDefault=r;return o}};ol.format.WMTSCapabilities.readTileMatrixSetLink_=function(e,t){return ol.xml.pushParseAndPop({},ol.format.WMTSCapabilities.TMS_LINKS_PARSERS_,e,t)};ol.format.WMTSCapabilities.readDimensions_=function(e,t){return ol.xml.pushParseAndPop({},ol.format.WMTSCapabilities.DIMENSION_PARSERS_,e,t)};ol.format.WMTSCapabilities.readResourceUrl_=function(e,t){var o=e.getAttribute("format"),r=e.getAttribute("template"),i=e.getAttribute("resourceType"),n={};o&&(n.format=o);r&&(n.template=r);i&&(n.resourceType=i);return n};ol.format.WMTSCapabilities.readWgs84BoundingBox_=function(e,t){var o=ol.xml.pushParseAndPop([],ol.format.WMTSCapabilities.WGS84_BBOX_READERS_,e,t);if(2==o.length)return ol.extent.boundingExtent(o)};ol.format.WMTSCapabilities.readLegendUrl_=function(e,t){var o={};o.format=e.getAttribute("format");o.href=ol.format.XLink.readHref(e);return o};ol.format.WMTSCapabilities.readCoordinates_=function(e,t){var o=ol.format.XSD.readString(e).split(" ");if(o&&2==o.length){var r=+o[0],i=+o[1];if(!isNaN(r)&&!isNaN(i))return[r,i]}};ol.format.WMTSCapabilities.readTileMatrix_=function(e,t){return ol.xml.pushParseAndPop({},ol.format.WMTSCapabilities.TM_PARSERS_,e,t)};ol.format.WMTSCapabilities.readTileMatrixLimitsList_=function(e,t){return ol.xml.pushParseAndPop([],ol.format.WMTSCapabilities.TMS_LIMITS_LIST_PARSERS_,e,t)};ol.format.WMTSCapabilities.readTileMatrixLimits_=function(e,t){return ol.xml.pushParseAndPop({},ol.format.WMTSCapabilities.TMS_LIMITS_PARSERS_,e,t)};ol.format.WMTSCapabilities.NAMESPACE_URIS_=[null,"http://www.opengis.net/wmts/1.0"];ol.format.WMTSCapabilities.OWS_NAMESPACE_URIS_=[null,"http://www.opengis.net/ows/1.1"];ol.format.WMTSCapabilities.PARSERS_=ol.xml.makeStructureNS(ol.format.WMTSCapabilities.NAMESPACE_URIS_,{Contents:ol.xml.makeObjectPropertySetter(ol.format.WMTSCapabilities.readContents_)});ol.format.WMTSCapabilities.CONTENTS_PARSERS_=ol.xml.makeStructureNS(ol.format.WMTSCapabilities.NAMESPACE_URIS_,{Layer:ol.xml.makeObjectPropertyPusher(ol.format.WMTSCapabilities.readLayer_),TileMatrixSet:ol.xml.makeObjectPropertyPusher(ol.format.WMTSCapabilities.readTileMatrixSet_)});ol.format.WMTSCapabilities.LAYER_PARSERS_=ol.xml.makeStructureNS(ol.format.WMTSCapabilities.NAMESPACE_URIS_,{Style:ol.xml.makeObjectPropertyPusher(ol.format.WMTSCapabilities.readStyle_),Format:ol.xml.makeObjectPropertyPusher(ol.format.XSD.readString),TileMatrixSetLink:ol.xml.makeObjectPropertyPusher(ol.format.WMTSCapabilities.readTileMatrixSetLink_),Dimension:ol.xml.makeObjectPropertyPusher(ol.format.WMTSCapabilities.readDimensions_),ResourceURL:ol.xml.makeObjectPropertyPusher(ol.format.WMTSCapabilities.readResourceUrl_)},ol.xml.makeStructureNS(ol.format.WMTSCapabilities.OWS_NAMESPACE_URIS_,{Title:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),Abstract:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),WGS84BoundingBox:ol.xml.makeObjectPropertySetter(ol.format.WMTSCapabilities.readWgs84BoundingBox_),Identifier:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString)}));ol.format.WMTSCapabilities.STYLE_PARSERS_=ol.xml.makeStructureNS(ol.format.WMTSCapabilities.NAMESPACE_URIS_,{LegendURL:ol.xml.makeObjectPropertyPusher(ol.format.WMTSCapabilities.readLegendUrl_)},ol.xml.makeStructureNS(ol.format.WMTSCapabilities.OWS_NAMESPACE_URIS_,{Title:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),Identifier:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString)}));ol.format.WMTSCapabilities.TMS_LINKS_PARSERS_=ol.xml.makeStructureNS(ol.format.WMTSCapabilities.NAMESPACE_URIS_,{TileMatrixSet:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),TileMatrixSetLimits:ol.xml.makeObjectPropertySetter(ol.format.WMTSCapabilities.readTileMatrixLimitsList_)});ol.format.WMTSCapabilities.TMS_LIMITS_LIST_PARSERS_=ol.xml.makeStructureNS(ol.format.WMTSCapabilities.NAMESPACE_URIS_,{TileMatrixLimits:ol.xml.makeArrayPusher(ol.format.WMTSCapabilities.readTileMatrixLimits_)});ol.format.WMTSCapabilities.TMS_LIMITS_PARSERS_=ol.xml.makeStructureNS(ol.format.WMTSCapabilities.NAMESPACE_URIS_,{TileMatrix:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),MinTileRow:ol.xml.makeObjectPropertySetter(ol.format.XSD.readNonNegativeInteger),MaxTileRow:ol.xml.makeObjectPropertySetter(ol.format.XSD.readNonNegativeInteger),MinTileCol:ol.xml.makeObjectPropertySetter(ol.format.XSD.readNonNegativeInteger),MaxTileCol:ol.xml.makeObjectPropertySetter(ol.format.XSD.readNonNegativeInteger)});ol.format.WMTSCapabilities.DIMENSION_PARSERS_=ol.xml.makeStructureNS(ol.format.WMTSCapabilities.NAMESPACE_URIS_,{Default:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),Value:ol.xml.makeObjectPropertyPusher(ol.format.XSD.readString)},ol.xml.makeStructureNS(ol.format.WMTSCapabilities.OWS_NAMESPACE_URIS_,{Identifier:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString)}));ol.format.WMTSCapabilities.WGS84_BBOX_READERS_=ol.xml.makeStructureNS(ol.format.WMTSCapabilities.OWS_NAMESPACE_URIS_,{LowerCorner:ol.xml.makeArrayPusher(ol.format.WMTSCapabilities.readCoordinates_),UpperCorner:ol.xml.makeArrayPusher(ol.format.WMTSCapabilities.readCoordinates_)});ol.format.WMTSCapabilities.TMS_PARSERS_=ol.xml.makeStructureNS(ol.format.WMTSCapabilities.NAMESPACE_URIS_,{WellKnownScaleSet:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),TileMatrix:ol.xml.makeObjectPropertyPusher(ol.format.WMTSCapabilities.readTileMatrix_)},ol.xml.makeStructureNS(ol.format.WMTSCapabilities.OWS_NAMESPACE_URIS_,{SupportedCRS:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString),Identifier:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString)}));ol.format.WMTSCapabilities.TM_PARSERS_=ol.xml.makeStructureNS(ol.format.WMTSCapabilities.NAMESPACE_URIS_,{TopLeftCorner:ol.xml.makeObjectPropertySetter(ol.format.WMTSCapabilities.readCoordinates_),ScaleDenominator:ol.xml.makeObjectPropertySetter(ol.format.XSD.readDecimal),TileWidth:ol.xml.makeObjectPropertySetter(ol.format.XSD.readNonNegativeInteger),TileHeight:ol.xml.makeObjectPropertySetter(ol.format.XSD.readNonNegativeInteger),MatrixWidth:ol.xml.makeObjectPropertySetter(ol.format.XSD.readNonNegativeInteger),MatrixHeight:ol.xml.makeObjectPropertySetter(ol.format.XSD.readNonNegativeInteger)},ol.xml.makeStructureNS(ol.format.WMTSCapabilities.OWS_NAMESPACE_URIS_,{Identifier:ol.xml.makeObjectPropertySetter(ol.format.XSD.readString)}));goog.provide("ol.GeolocationProperty");ol.GeolocationProperty={ACCURACY:"accuracy",ACCURACY_GEOMETRY:"accuracyGeometry",ALTITUDE:"altitude",ALTITUDE_ACCURACY:"altitudeAccuracy",HEADING:"heading",POSITION:"position",PROJECTION:"projection",SPEED:"speed",TRACKING:"tracking",TRACKING_OPTIONS:"trackingOptions"};goog.provide("ol.Geolocation");goog.require("ol");goog.require("ol.GeolocationProperty");goog.require("ol.Object");goog.require("ol.Sphere");goog.require("ol.events");goog.require("ol.events.EventType");goog.require("ol.geom.Polygon");goog.require("ol.has");goog.require("ol.math");goog.require("ol.proj");goog.require("ol.proj.EPSG4326");ol.Geolocation=function(e){ol.Object.call(this);var t=e||{};this.position_=null;this.transform_=ol.proj.identityTransform;this.sphere_=new ol.Sphere(ol.proj.EPSG4326.RADIUS);this.watchId_=void 0;ol.events.listen(this,ol.Object.getChangeEventType(ol.GeolocationProperty.PROJECTION),this.handleProjectionChanged_,this);ol.events.listen(this,ol.Object.getChangeEventType(ol.GeolocationProperty.TRACKING),this.handleTrackingChanged_,this);void 0!==t.projection&&this.setProjection(t.projection);void 0!==t.trackingOptions&&this.setTrackingOptions(t.trackingOptions);this.setTracking(void 0!==t.tracking&&t.tracking)};ol.inherits(ol.Geolocation,ol.Object);ol.Geolocation.prototype.disposeInternal=function(){this.setTracking(!1);ol.Object.prototype.disposeInternal.call(this)};ol.Geolocation.prototype.handleProjectionChanged_=function(){var e=this.getProjection();if(e){this.transform_=ol.proj.getTransformFromProjections(ol.proj.get("EPSG:4326"),e);this.position_&&this.set(ol.GeolocationProperty.POSITION,this.transform_(this.position_))}};ol.Geolocation.prototype.handleTrackingChanged_=function(){if(ol.has.GEOLOCATION){var e=this.getTracking();if(e&&void 0===this.watchId_)this.watchId_=navigator.geolocation.watchPosition(this.positionChange_.bind(this),this.positionError_.bind(this),this.getTrackingOptions());else if(!e&&void 0!==this.watchId_){navigator.geolocation.clearWatch(this.watchId_);this.watchId_=void 0}}};ol.Geolocation.prototype.positionChange_=function(e){var t=e.coords;this.set(ol.GeolocationProperty.ACCURACY,t.accuracy);this.set(ol.GeolocationProperty.ALTITUDE,null===t.altitude?void 0:t.altitude);this.set(ol.GeolocationProperty.ALTITUDE_ACCURACY,null===t.altitudeAccuracy?void 0:t.altitudeAccuracy);this.set(ol.GeolocationProperty.HEADING,null===t.heading?void 0:ol.math.toRadians(t.heading));if(this.position_){this.position_[0]=t.longitude;this.position_[1]=t.latitude}else this.position_=[t.longitude,t.latitude];var o=this.transform_(this.position_);this.set(ol.GeolocationProperty.POSITION,o);this.set(ol.GeolocationProperty.SPEED,null===t.speed?void 0:t.speed);var r=ol.geom.Polygon.circular(this.sphere_,this.position_,t.accuracy);r.applyTransform(this.transform_);this.set(ol.GeolocationProperty.ACCURACY_GEOMETRY,r);this.changed()};ol.Geolocation.prototype.positionError_=function(e){e.type=ol.events.EventType.ERROR;this.setTracking(!1);this.dispatchEvent(e)};ol.Geolocation.prototype.getAccuracy=function(){return this.get(ol.GeolocationProperty.ACCURACY)};ol.Geolocation.prototype.getAccuracyGeometry=function(){return this.get(ol.GeolocationProperty.ACCURACY_GEOMETRY)||null};ol.Geolocation.prototype.getAltitude=function(){return this.get(ol.GeolocationProperty.ALTITUDE)};ol.Geolocation.prototype.getAltitudeAccuracy=function(){return this.get(ol.GeolocationProperty.ALTITUDE_ACCURACY)};ol.Geolocation.prototype.getHeading=function(){return this.get(ol.GeolocationProperty.HEADING)};ol.Geolocation.prototype.getPosition=function(){return this.get(ol.GeolocationProperty.POSITION)};ol.Geolocation.prototype.getProjection=function(){return this.get(ol.GeolocationProperty.PROJECTION)};ol.Geolocation.prototype.getSpeed=function(){return this.get(ol.GeolocationProperty.SPEED)};ol.Geolocation.prototype.getTracking=function(){return this.get(ol.GeolocationProperty.TRACKING)};ol.Geolocation.prototype.getTrackingOptions=function(){return this.get(ol.GeolocationProperty.TRACKING_OPTIONS)};ol.Geolocation.prototype.setProjection=function(e){this.set(ol.GeolocationProperty.PROJECTION,ol.proj.get(e))};ol.Geolocation.prototype.setTracking=function(e){this.set(ol.GeolocationProperty.TRACKING,e)};ol.Geolocation.prototype.setTrackingOptions=function(e){this.set(ol.GeolocationProperty.TRACKING_OPTIONS,e)};goog.provide("ol.geom.Circle");goog.require("ol");goog.require("ol.extent");goog.require("ol.geom.GeometryLayout");goog.require("ol.geom.GeometryType");goog.require("ol.geom.SimpleGeometry");goog.require("ol.geom.flat.deflate");ol.geom.Circle=function(e,t,o){ol.geom.SimpleGeometry.call(this);var r=t||0;this.setCenterAndRadius(e,r,o)};ol.inherits(ol.geom.Circle,ol.geom.SimpleGeometry);ol.geom.Circle.prototype.clone=function(){var e=new ol.geom.Circle(null);e.setFlatCoordinates(this.layout,this.flatCoordinates.slice());return e};ol.geom.Circle.prototype.closestPointXY=function(e,t,o,r){var i=this.flatCoordinates,n=e-i[0],a=t-i[1],l=n*n+a*a;if(l<r){var s;if(0===l)for(s=0;s<this.stride;++s)o[s]=i[s];else{var p=this.getRadius()/Math.sqrt(l);o[0]=i[0]+p*n;o[1]=i[1]+p*a;for(s=2;s<this.stride;++s)o[s]=i[s]}o.length=this.stride;return l}return r};ol.geom.Circle.prototype.containsXY=function(e,t){var o=this.flatCoordinates,r=e-o[0],i=t-o[1];return r*r+i*i<=this.getRadiusSquared_()};ol.geom.Circle.prototype.getCenter=function(){return this.flatCoordinates.slice(0,this.stride)};ol.geom.Circle.prototype.computeExtent=function(e){var t=this.flatCoordinates,o=t[this.stride]-t[0];return ol.extent.createOrUpdate(t[0]-o,t[1]-o,t[0]+o,t[1]+o,e)};ol.geom.Circle.prototype.getRadius=function(){return Math.sqrt(this.getRadiusSquared_())};ol.geom.Circle.prototype.getRadiusSquared_=function(){var e=this.flatCoordinates[this.stride]-this.flatCoordinates[0],t=this.flatCoordinates[this.stride+1]-this.flatCoordinates[1];return e*e+t*t};ol.geom.Circle.prototype.getType=function(){return ol.geom.GeometryType.CIRCLE};ol.geom.Circle.prototype.intersectsExtent=function(e){var t=this.getExtent();if(ol.extent.intersects(e,t)){var o=this.getCenter();return e[0]<=o[0]&&e[2]>=o[0]||(e[1]<=o[1]&&e[3]>=o[1]||ol.extent.forEachCorner(e,this.intersectsCoordinate,this))}return!1};ol.geom.Circle.prototype.setCenter=function(e){var t,o=this.stride,r=this.flatCoordinates[o]-this.flatCoordinates[0],i=e.slice();i[o]=i[0]+r;for(t=1;t<o;++t)i[o+t]=e[t];this.setFlatCoordinates(this.layout,i)};ol.geom.Circle.prototype.setCenterAndRadius=function(e,t,o){if(e){this.setLayout(o,e,0);this.flatCoordinates||(this.flatCoordinates=[]);var r,i,n=this.flatCoordinates,a=ol.geom.flat.deflate.coordinate(n,0,e,this.stride);n[a++]=n[0]+t;for(r=1,i=this.stride;r<i;++r)n[a++]=n[r];n.length=a;this.changed()}else this.setFlatCoordinates(ol.geom.GeometryLayout.XY,null)};ol.geom.Circle.prototype.getCoordinates=function(){};ol.geom.Circle.prototype.setCoordinates=function(e,t){};ol.geom.Circle.prototype.setFlatCoordinates=function(e,t){this.setFlatCoordinatesInternal(e,t);this.changed()};ol.geom.Circle.prototype.setRadius=function(e){this.flatCoordinates[this.stride]=this.flatCoordinates[0]+e;this.changed()};ol.geom.Circle.prototype.transform;goog.provide("ol.geom.flat.geodesic");goog.require("ol.math");goog.require("ol.proj");ol.geom.flat.geodesic.line_=function(e,t,o){for(var r,i,n,a,l,s,p=[],c=e(0),u=e(1),g=t(c),d=t(u),h=[u,c],f=[d,g],y=[1,0],m={},v=1e5;--v>0&&y.length>0;){n=y.pop();c=h.pop();g=f.pop();if(!((s=n.toString())in m)){p.push(g[0],g[1]);m[s]=!0}a=y.pop();u=h.pop();d=f.pop();i=t(r=e(l=(n+a)/2));if(ol.math.squaredSegmentDistance(i[0],i[1],g[0],g[1],d[0],d[1])<o){p.push(d[0],d[1]);m[s=a.toString()]=!0}else{y.push(a,l,l,n);f.push(d,i,i,g);h.push(u,r,r,c)}}return p};ol.geom.flat.geodesic.greatCircleArc=function(e,t,o,r,i,n){var a=ol.proj.get("EPSG:4326"),l=Math.cos(ol.math.toRadians(t)),s=Math.sin(ol.math.toRadians(t)),p=Math.cos(ol.math.toRadians(r)),c=Math.sin(ol.math.toRadians(r)),u=Math.cos(ol.math.toRadians(o-e)),g=Math.sin(ol.math.toRadians(o-e)),d=s*c+l*p*u;return ol.geom.flat.geodesic.line_(function(t){if(1<=d)return[o,r];var i=t*Math.acos(d),n=Math.cos(i),a=Math.sin(i),h=g*p,f=l*c-s*p*u,y=Math.atan2(h,f),m=Math.asin(s*n+l*a*Math.cos(y)),v=ol.math.toRadians(e)+Math.atan2(Math.sin(y)*a*l,n-s*Math.sin(m));return[ol.math.toDegrees(v),ol.math.toDegrees(m)]},ol.proj.getTransform(a,i),n)};ol.geom.flat.geodesic.meridian=function(e,t,o,r,i){var n=ol.proj.get("EPSG:4326");return ol.geom.flat.geodesic.line_(function(r){return[e,t+(o-t)*r]},ol.proj.getTransform(n,r),i)};ol.geom.flat.geodesic.parallel=function(e,t,o,r,i){var n=ol.proj.get("EPSG:4326");return ol.geom.flat.geodesic.line_(function(r){return[t+(o-t)*r,e]},ol.proj.getTransform(n,r),i)};goog.provide("ol.geom.flat.topology");goog.require("ol.geom.flat.area");ol.geom.flat.topology.lineStringIsClosed=function(e,t,o,r){var i=o-r;return e[t]===e[i]&&e[t+1]===e[i+1]&&(o-t)/r>3&&!!ol.geom.flat.area.linearRing(e,t,o,r)};goog.provide("ol.Graticule");goog.require("ol.coordinate");goog.require("ol.extent");goog.require("ol.geom.GeometryLayout");goog.require("ol.geom.LineString");goog.require("ol.geom.Point");goog.require("ol.geom.flat.geodesic");goog.require("ol.math");goog.require("ol.proj");goog.require("ol.render.EventType");goog.require("ol.style.Fill");goog.require("ol.style.Stroke");goog.require("ol.style.Text");ol.Graticule=function(e){var t=e||{};this.map_=null;this.projection_=null;this.maxLat_=1/0;this.maxLon_=1/0;this.minLat_=-1/0;this.minLon_=-1/0;this.maxLatP_=1/0;this.maxLonP_=1/0;this.minLatP_=-1/0;this.minLonP_=-1/0;this.targetSize_=void 0!==t.targetSize?t.targetSize:100;this.maxLines_=void 0!==t.maxLines?t.maxLines:100;this.meridians_=[];this.parallels_=[];this.strokeStyle_=void 0!==t.strokeStyle?t.strokeStyle:ol.Graticule.DEFAULT_STROKE_STYLE_;this.fromLonLatTransform_=void 0;this.toLonLatTransform_=void 0;this.projectionCenterLonLat_=null;this.meridiansLabels_=null;this.parallelsLabels_=null;if(1==t.showLabels){var o=ol.coordinate.degreesToStringHDMS;this.lonLabelFormatter_=void 0==t.lonLabelFormatter?o.bind(this,"EW"):t.lonLabelFormatter;this.latLabelFormatter_=void 0==t.latLabelFormatter?o.bind(this,"NS"):t.latLabelFormatter;this.lonLabelPosition_=void 0==t.lonLabelPosition?0:t.lonLabelPosition;this.latLabelPosition_=void 0==t.latLabelPosition?1:t.latLabelPosition;this.lonLabelStyle_=void 0!==t.lonLabelStyle?t.lonLabelStyle:new ol.style.Text({font:"12px Calibri,sans-serif",textBaseline:"bottom",fill:new ol.style.Fill({color:"rgba(0,0,0,1)"}),stroke:new ol.style.Stroke({color:"rgba(255,255,255,1)",width:3})});this.latLabelStyle_=void 0!==t.latLabelStyle?t.latLabelStyle:new ol.style.Text({font:"12px Calibri,sans-serif",textAlign:"end",fill:new ol.style.Fill({color:"rgba(0,0,0,1)"}),stroke:new ol.style.Stroke({color:"rgba(255,255,255,1)",width:3})});this.meridiansLabels_=[];this.parallelsLabels_=[]}this.setMap(void 0!==t.map?t.map:null)};ol.Graticule.DEFAULT_STROKE_STYLE_=new ol.style.Stroke({color:"rgba(0,0,0,0.2)"});ol.Graticule.intervals_=[90,45,30,20,10,5,2,1,.5,.2,.1,.05,.01,.005,.002,.001];ol.Graticule.prototype.addMeridian_=function(e,t,o,r,i,n){var a=this.getMeridian_(e,t,o,r,n);if(ol.extent.intersects(a.getExtent(),i)){if(this.meridiansLabels_){var l=this.getMeridianPoint_(a,i,n);this.meridiansLabels_[n]={geom:l,text:this.lonLabelFormatter_(e)}}this.meridians_[n++]=a}return n};ol.Graticule.prototype.getMeridianPoint_=function(e,t,o){var r=e.getFlatCoordinates(),i=Math.max(t[1],r[1]),n=Math.min(t[3],r[r.length-1]),a=ol.math.clamp(t[1]+Math.abs(t[1]-t[3])*this.lonLabelPosition_,i,n),l=[r[0],a],s=void 0!==this.meridiansLabels_[o]?this.meridiansLabels_[o].geom:new ol.geom.Point(null);s.setCoordinates(l);return s};ol.Graticule.prototype.addParallel_=function(e,t,o,r,i,n){var a=this.getParallel_(e,t,o,r,n);if(ol.extent.intersects(a.getExtent(),i)){if(this.parallelsLabels_){var l=this.getParallelPoint_(a,i,n);this.parallelsLabels_[n]={geom:l,text:this.latLabelFormatter_(e)}}this.parallels_[n++]=a}return n};ol.Graticule.prototype.getParallelPoint_=function(e,t,o){var r=e.getFlatCoordinates(),i=Math.max(t[0],r[0]),n=Math.min(t[2],r[r.length-2]),a=[ol.math.clamp(t[0]+Math.abs(t[0]-t[2])*this.latLabelPosition_,i,n),r[1]],l=void 0!==this.parallelsLabels_[o]?this.parallelsLabels_[o].geom:new ol.geom.Point(null);l.setCoordinates(a);return l};ol.Graticule.prototype.createGraticule_=function(e,t,o,r){var i=this.getInterval_(o);if(-1!=i){var n,a,l,s,p=this.toLonLatTransform_(t),c=p[0],u=p[1],g=this.maxLines_,d=[Math.max(e[0],this.minLonP_),Math.max(e[1],this.minLatP_),Math.min(e[2],this.maxLonP_),Math.min(e[3],this.maxLatP_)],h=(d=ol.proj.transformExtent(d,this.projection_,"EPSG:4326"))[3],f=d[2],y=d[1],m=d[0];c=Math.floor(c/i)*i;s=ol.math.clamp(c,this.minLon_,this.maxLon_);a=this.addMeridian_(s,y,h,r,e,0);n=0;for(;s!=this.minLon_&&n++<g;){s=Math.max(s-i,this.minLon_);a=this.addMeridian_(s,y,h,r,e,a)}s=ol.math.clamp(c,this.minLon_,this.maxLon_);n=0;for(;s!=this.maxLon_&&n++<g;){s=Math.min(s+i,this.maxLon_);a=this.addMeridian_(s,y,h,r,e,a)}this.meridians_.length=a;this.meridiansLabels_&&(this.meridiansLabels_.length=a);u=Math.floor(u/i)*i;l=ol.math.clamp(u,this.minLat_,this.maxLat_);a=this.addParallel_(l,m,f,r,e,0);n=0;for(;l!=this.minLat_&&n++<g;){l=Math.max(l-i,this.minLat_);a=this.addParallel_(l,m,f,r,e,a)}l=ol.math.clamp(u,this.minLat_,this.maxLat_);n=0;for(;l!=this.maxLat_&&n++<g;){l=Math.min(l+i,this.maxLat_);a=this.addParallel_(l,m,f,r,e,a)}this.parallels_.length=a;this.parallelsLabels_&&(this.parallelsLabels_.length=a)}else{this.meridians_.length=this.parallels_.length=0;this.meridiansLabels_&&(this.meridiansLabels_.length=0);this.parallelsLabels_&&(this.parallelsLabels_.length=0)}};ol.Graticule.prototype.getInterval_=function(e){var t,o,r,i=this.projectionCenterLonLat_[0],n=this.projectionCenterLonLat_[1],a=-1,l=Math.pow(this.targetSize_*e,2),s=[],p=[];for(t=0,o=ol.Graticule.intervals_.length;t<o;++t){r=ol.Graticule.intervals_[t]/2;s[0]=i-r;s[1]=n-r;p[0]=i+r;p[1]=n+r;this.fromLonLatTransform_(s,s);this.fromLonLatTransform_(p,p);if(Math.pow(p[0]-s[0],2)+Math.pow(p[1]-s[1],2)<=l)break;a=ol.Graticule.intervals_[t]}return a};ol.Graticule.prototype.getMap=function(){return this.map_};ol.Graticule.prototype.getMeridian_=function(e,t,o,r,i){var n=ol.geom.flat.geodesic.meridian(e,t,o,this.projection_,r),a=void 0!==this.meridians_[i]?this.meridians_[i]:new ol.geom.LineString(null);a.setFlatCoordinates(ol.geom.GeometryLayout.XY,n);return a};ol.Graticule.prototype.getMeridians=function(){return this.meridians_};ol.Graticule.prototype.getParallel_=function(e,t,o,r,i){var n=ol.geom.flat.geodesic.parallel(e,t,o,this.projection_,r),a=void 0!==this.parallels_[i]?this.parallels_[i]:new ol.geom.LineString(null);a.setFlatCoordinates(ol.geom.GeometryLayout.XY,n);return a};ol.Graticule.prototype.getParallels=function(){return this.parallels_};ol.Graticule.prototype.handlePostCompose_=function(e){var t,o,r,i,n=e.vectorContext,a=e.frameState,l=a.extent,s=a.viewState,p=s.center,c=s.projection,u=s.resolution,g=a.pixelRatio,d=u*u/(4*g*g);(!this.projection_||!ol.proj.equivalent(this.projection_,c))&&this.updateProjectionInfo_(c);this.createGraticule_(l,p,u,d);n.setFillStrokeStyle(null,this.strokeStyle_);for(t=0,o=this.meridians_.length;t<o;++t){r=this.meridians_[t];n.drawGeometry(r)}for(t=0,o=this.parallels_.length;t<o;++t){r=this.parallels_[t];n.drawGeometry(r)}if(this.meridiansLabels_)for(t=0,o=this.meridiansLabels_.length;t<o;++t){i=this.meridiansLabels_[t];this.lonLabelStyle_.setText(i.text);n.setTextStyle(this.lonLabelStyle_);n.drawGeometry(i.geom)}if(this.parallelsLabels_)for(t=0,o=this.parallelsLabels_.length;t<o;++t){i=this.parallelsLabels_[t];this.latLabelStyle_.setText(i.text);n.setTextStyle(this.latLabelStyle_);n.drawGeometry(i.geom)}};ol.Graticule.prototype.updateProjectionInfo_=function(e){var t=ol.proj.get("EPSG:4326"),o=e.getExtent(),r=e.getWorldExtent(),i=ol.proj.transformExtent(r,t,e),n=r[3],a=r[2],l=r[1],s=r[0],p=i[3],c=i[2],u=i[1],g=i[0];this.maxLat_=n;this.maxLon_=a;this.minLat_=l;this.minLon_=s;this.maxLatP_=p;this.maxLonP_=c;this.minLatP_=u;this.minLonP_=g;this.fromLonLatTransform_=ol.proj.getTransform(t,e);this.toLonLatTransform_=ol.proj.getTransform(e,t);this.projectionCenterLonLat_=this.toLonLatTransform_(ol.extent.getCenter(o));this.projection_=e};ol.Graticule.prototype.setMap=function(e){if(this.map_){this.map_.un(ol.render.EventType.POSTCOMPOSE,this.handlePostCompose_,this);this.map_.render()}if(e){e.on(ol.render.EventType.POSTCOMPOSE,this.handlePostCompose_,this);e.render()}this.map_=e};goog.provide("ol.Image");goog.require("ol");goog.require("ol.ImageBase");goog.require("ol.ImageState");goog.require("ol.events");goog.require("ol.events.EventType");goog.require("ol.extent");ol.Image=function(e,t,o,r,i,n){ol.ImageBase.call(this,e,t,o,ol.ImageState.IDLE);this.src_=r;this.image_=new Image;null!==i&&(this.image_.crossOrigin=i);this.imageListenerKeys_=null;this.state=ol.ImageState.IDLE;this.imageLoadFunction_=n};ol.inherits(ol.Image,ol.ImageBase);ol.Image.prototype.getImage=function(){return this.image_};ol.Image.prototype.handleImageError_=function(){this.state=ol.ImageState.ERROR;this.unlistenImage_();this.changed()};ol.Image.prototype.handleImageLoad_=function(){void 0===this.resolution&&(this.resolution=ol.extent.getHeight(this.extent)/this.image_.height);this.state=ol.ImageState.LOADED;this.unlistenImage_();this.changed()};ol.Image.prototype.load=function(){if(this.state==ol.ImageState.IDLE||this.state==ol.ImageState.ERROR){this.state=ol.ImageState.LOADING;this.changed();this.imageListenerKeys_=[ol.events.listenOnce(this.image_,ol.events.EventType.ERROR,this.handleImageError_,this),ol.events.listenOnce(this.image_,ol.events.EventType.LOAD,this.handleImageLoad_,this)];this.imageLoadFunction_(this,this.src_)}};ol.Image.prototype.setImage=function(e){this.image_=e};ol.Image.prototype.unlistenImage_=function(){this.imageListenerKeys_.forEach(ol.events.unlistenByKey);this.imageListenerKeys_=null};goog.provide("ol.Tile");goog.require("ol");goog.require("ol.TileState");goog.require("ol.easing");goog.require("ol.events.EventTarget");goog.require("ol.events.EventType");ol.Tile=function(e,t,o){ol.events.EventTarget.call(this);var r=o||{};this.tileCoord=e;this.state=t;this.interimTile=null;this.key="";this.transition_=void 0===r.transition?250:r.transition;this.transitionStarts_={}};ol.inherits(ol.Tile,ol.events.EventTarget);ol.Tile.prototype.changed=function(){this.dispatchEvent(ol.events.EventType.CHANGE)};ol.Tile.prototype.getKey=function(){return this.key+"/"+this.tileCoord};ol.Tile.prototype.getInterimTile=function(){if(!this.interimTile)return this;var e=this.interimTile;do{if(e.getState()==ol.TileState.LOADED)return e;e=e.interimTile}while(e);return this};ol.Tile.prototype.refreshInterimChain=function(){if(this.interimTile){var e=this.interimTile,t=this;do{if(e.getState()==ol.TileState.LOADED){e.interimTile=null;break}e.getState()==ol.TileState.LOADING?t=e:e.getState()==ol.TileState.IDLE?t.interimTile=e.interimTile:t=e;e=t.interimTile}while(e)}};ol.Tile.prototype.getTileCoord=function(){return this.tileCoord};ol.Tile.prototype.getState=function(){return this.state};ol.Tile.prototype.setState=function(e){this.state=e;this.changed()};ol.Tile.prototype.load=function(){};ol.Tile.prototype.getAlpha=function(e,t){if(!this.transition_)return 1;var o=this.transitionStarts_[e];if(o){if(-1===o)return 1}else{o=t;this.transitionStarts_[e]=o}var r=t-o+1e3/60;return r>=this.transition_?1:ol.easing.easeIn(r/this.transition_)};ol.Tile.prototype.inTransition=function(e){return!!this.transition_&&-1!==this.transitionStarts_[e]};ol.Tile.prototype.endTransition=function(e){this.transition_&&(this.transitionStarts_[e]=-1)};goog.provide("ol.ImageTile");goog.require("ol");goog.require("ol.Tile");goog.require("ol.TileState");goog.require("ol.dom");goog.require("ol.events");goog.require("ol.events.EventType");ol.ImageTile=function(e,t,o,r,i,n){ol.Tile.call(this,e,t,n);this.crossOrigin_=r;this.src_=o;this.image_=new Image;null!==r&&(this.image_.crossOrigin=r);this.imageListenerKeys_=null;this.tileLoadFunction_=i};ol.inherits(ol.ImageTile,ol.Tile);ol.ImageTile.prototype.disposeInternal=function(){if(this.state==ol.TileState.LOADING){this.unlistenImage_();this.image_=ol.ImageTile.getBlankImage()}this.interimTile&&this.interimTile.dispose();this.state=ol.TileState.ABORT;this.changed();ol.Tile.prototype.disposeInternal.call(this)};ol.ImageTile.prototype.getImage=function(){return this.image_};ol.ImageTile.prototype.getKey=function(){return this.src_};ol.ImageTile.prototype.handleImageError_=function(){this.state=ol.TileState.ERROR;this.unlistenImage_();this.image_=ol.ImageTile.getBlankImage();this.changed()};ol.ImageTile.prototype.handleImageLoad_=function(){this.image_.naturalWidth&&this.image_.naturalHeight?this.state=ol.TileState.LOADED:this.state=ol.TileState.EMPTY;this.unlistenImage_();this.changed()};ol.ImageTile.prototype.load=function(){if(this.state==ol.TileState.ERROR){this.state=ol.TileState.IDLE;this.image_=new Image;null!==this.crossOrigin_&&(this.image_.crossOrigin=this.crossOrigin_)}if(this.state==ol.TileState.IDLE){this.state=ol.TileState.LOADING;this.changed();this.imageListenerKeys_=[ol.events.listenOnce(this.image_,ol.events.EventType.ERROR,this.handleImageError_,this),ol.events.listenOnce(this.image_,ol.events.EventType.LOAD,this.handleImageLoad_,this)];this.tileLoadFunction_(this,this.src_)}};ol.ImageTile.prototype.unlistenImage_=function(){this.imageListenerKeys_.forEach(ol.events.unlistenByKey);this.imageListenerKeys_=null};ol.ImageTile.getBlankImage=function(){var e=ol.dom.createCanvasContext2D(1,1);e.fillStyle="rgba(0,0,0,0)";e.fillRect(0,0,1,1);return e.canvas};goog.provide("ol.interaction.DragAndDrop");goog.require("ol");goog.require("ol.functions");goog.require("ol.events");goog.require("ol.events.Event");goog.require("ol.events.EventType");goog.require("ol.interaction.Interaction");goog.require("ol.proj");ol.interaction.DragAndDrop=function(e){var t=e||{};ol.interaction.Interaction.call(this,{handleEvent:ol.interaction.DragAndDrop.handleEvent});this.formatConstructors_=t.formatConstructors?t.formatConstructors:[];this.projection_=t.projection?ol.proj.get(t.projection):null;this.dropListenKeys_=null;this.source_=t.source||null;this.target=t.target?t.target:null};ol.inherits(ol.interaction.DragAndDrop,ol.interaction.Interaction);ol.interaction.DragAndDrop.handleDrop_=function(e){var t,o,r,i=e.dataTransfer.files;for(t=0,o=i.length;t<o;++t){r=i.item(t);var n=new FileReader;n.addEventListener(ol.events.EventType.LOAD,this.handleResult_.bind(this,r));n.readAsText(r)}};ol.interaction.DragAndDrop.handleStop_=function(e){e.stopPropagation();e.preventDefault();e.dataTransfer.dropEffect="copy"};ol.interaction.DragAndDrop.prototype.handleResult_=function(e,t){var o=t.target.result,r=this.getMap(),i=this.projection_;if(!i){i=r.getView().getProjection()}var n,a,l=this.formatConstructors_,s=[];for(n=0,a=l.length;n<a;++n){var p=new(0,l[n]);if((s=this.tryReadFeatures_(p,o,{featureProjection:i}))&&s.length>0)break}if(this.source_){this.source_.clear();this.source_.addFeatures(s)}this.dispatchEvent(new ol.interaction.DragAndDrop.Event(ol.interaction.DragAndDrop.EventType_.ADD_FEATURES,e,s,i))};ol.interaction.DragAndDrop.handleEvent=ol.functions.TRUE;ol.interaction.DragAndDrop.prototype.registerListeners_=function(){var e=this.getMap();if(e){var t=this.target?this.target:e.getViewport();this.dropListenKeys_=[ol.events.listen(t,ol.events.EventType.DROP,ol.interaction.DragAndDrop.handleDrop_,this),ol.events.listen(t,ol.events.EventType.DRAGENTER,ol.interaction.DragAndDrop.handleStop_,this),ol.events.listen(t,ol.events.EventType.DRAGOVER,ol.interaction.DragAndDrop.handleStop_,this),ol.events.listen(t,ol.events.EventType.DROP,ol.interaction.DragAndDrop.handleStop_,this)]}};ol.interaction.DragAndDrop.prototype.setActive=function(e){ol.interaction.Interaction.prototype.setActive.call(this,e);e?this.registerListeners_():this.unregisterListeners_()};ol.interaction.DragAndDrop.prototype.setMap=function(e){this.unregisterListeners_();ol.interaction.Interaction.prototype.setMap.call(this,e);this.getActive()&&this.registerListeners_()};ol.interaction.DragAndDrop.prototype.tryReadFeatures_=function(e,t,o){try{return e.readFeatures(t,o)}catch(e){return null}};ol.interaction.DragAndDrop.prototype.unregisterListeners_=function(){if(this.dropListenKeys_){this.dropListenKeys_.forEach(ol.events.unlistenByKey);this.dropListenKeys_=null}};ol.interaction.DragAndDrop.EventType_={ADD_FEATURES:"addfeatures"};ol.interaction.DragAndDrop.Event=function(e,t,o,r){ol.events.Event.call(this,e);this.features=o;this.file=t;this.projection=r};ol.inherits(ol.interaction.DragAndDrop.Event,ol.events.Event);goog.provide("ol.interaction.DragRotateAndZoom");goog.require("ol");goog.require("ol.RotationConstraint");goog.require("ol.ViewHint");goog.require("ol.events.condition");goog.require("ol.interaction.Interaction");goog.require("ol.interaction.Pointer");ol.interaction.DragRotateAndZoom=function(e){var t=e||{};ol.interaction.Pointer.call(this,{handleDownEvent:ol.interaction.DragRotateAndZoom.handleDownEvent_,handleDragEvent:ol.interaction.DragRotateAndZoom.handleDragEvent_,handleUpEvent:ol.interaction.DragRotateAndZoom.handleUpEvent_});this.condition_=t.condition?t.condition:ol.events.condition.shiftKeyOnly;this.lastAngle_=void 0;this.lastMagnitude_=void 0;this.lastScaleDelta_=0;this.duration_=void 0!==t.duration?t.duration:400};ol.inherits(ol.interaction.DragRotateAndZoom,ol.interaction.Pointer);ol.interaction.DragRotateAndZoom.handleDragEvent_=function(e){if(ol.events.condition.mouseOnly(e)){var t=e.map,o=t.getSize(),r=e.pixel,i=r[0]-o[0]/2,n=o[1]/2-r[1],a=Math.atan2(n,i),l=Math.sqrt(i*i+n*n),s=t.getView();if(s.getConstraints().rotation!==ol.RotationConstraint.disable&&void 0!==this.lastAngle_){var p=a-this.lastAngle_;ol.interaction.Interaction.rotateWithoutConstraints(s,s.getRotation()-p)}this.lastAngle_=a;if(void 0!==this.lastMagnitude_){var c=this.lastMagnitude_*(s.getResolution()/l);ol.interaction.Interaction.zoomWithoutConstraints(s,c)}void 0!==this.lastMagnitude_&&(this.lastScaleDelta_=this.lastMagnitude_/l);this.lastMagnitude_=l}};ol.interaction.DragRotateAndZoom.handleUpEvent_=function(e){if(!ol.events.condition.mouseOnly(e))return!0;var t=e.map.getView();t.setHint(ol.ViewHint.INTERACTING,-1);var o=this.lastScaleDelta_-1;ol.interaction.Interaction.rotate(t,t.getRotation());ol.interaction.Interaction.zoom(t,t.getResolution(),void 0,this.duration_,o);this.lastScaleDelta_=0;return!1};ol.interaction.DragRotateAndZoom.handleDownEvent_=function(e){if(!ol.events.condition.mouseOnly(e))return!1;if(this.condition_(e)){e.map.getView().setHint(ol.ViewHint.INTERACTING,1);this.lastAngle_=void 0;this.lastMagnitude_=void 0;return!0}return!1};goog.provide("ol.interaction.DrawEventType");ol.interaction.DrawEventType={DRAWSTART:"drawstart",DRAWEND:"drawend"};goog.provide("ol.layer.Vector");goog.require("ol");goog.require("ol.LayerType");goog.require("ol.layer.Layer");goog.require("ol.layer.VectorRenderType");goog.require("ol.obj");goog.require("ol.style.Style");ol.layer.Vector=function(e){var t=e||{},o=ol.obj.assign({},t);delete o.style;delete o.renderBuffer;delete o.updateWhileAnimating;delete o.updateWhileInteracting;ol.layer.Layer.call(this,o);this.declutter_=void 0!==t.declutter&&t.declutter;this.renderBuffer_=void 0!==t.renderBuffer?t.renderBuffer:100;this.style_=null;this.styleFunction_=void 0;this.setStyle(t.style);this.updateWhileAnimating_=void 0!==t.updateWhileAnimating&&t.updateWhileAnimating;this.updateWhileInteracting_=void 0!==t.updateWhileInteracting&&t.updateWhileInteracting;this.renderMode_=t.renderMode||ol.layer.VectorRenderType.VECTOR;this.type=ol.LayerType.VECTOR};ol.inherits(ol.layer.Vector,ol.layer.Layer);ol.layer.Vector.prototype.getDeclutter=function(){return this.declutter_};ol.layer.Vector.prototype.setDeclutter=function(e){this.declutter_=e};ol.layer.Vector.prototype.getRenderBuffer=function(){return this.renderBuffer_};ol.layer.Vector.prototype.getRenderOrder=function(){return this.get(ol.layer.Vector.Property_.RENDER_ORDER)};ol.layer.Vector.prototype.getSource;ol.layer.Vector.prototype.getStyle=function(){return this.style_};ol.layer.Vector.prototype.getStyleFunction=function(){return this.styleFunction_};ol.layer.Vector.prototype.getUpdateWhileAnimating=function(){return this.updateWhileAnimating_};ol.layer.Vector.prototype.getUpdateWhileInteracting=function(){return this.updateWhileInteracting_};ol.layer.Vector.prototype.setRenderOrder=function(e){this.set(ol.layer.Vector.Property_.RENDER_ORDER,e)};ol.layer.Vector.prototype.setStyle=function(e){this.style_=void 0!==e?e:ol.style.Style.defaultFunction;this.styleFunction_=null===e?void 0:ol.style.Style.createFunction(this.style_);this.changed()};ol.layer.Vector.prototype.getRenderMode=function(){return this.renderMode_};ol.layer.Vector.Property_={RENDER_ORDER:"renderOrder"};goog.provide("ol.loadingstrategy");ol.loadingstrategy.all=function(e,t){return[[-1/0,-1/0,1/0,1/0]]};ol.loadingstrategy.bbox=function(e,t){return[e]};ol.loadingstrategy.tile=function(e){return function(t,o){var r=e.getZForResolution(o),i=e.getTileRangeForExtentAndZ(t,r),n=[],a=[r,0,0];for(a[1]=i.minX;a[1]<=i.maxX;++a[1])for(a[2]=i.minY;a[2]<=i.maxY;++a[2])n.push(e.getTileCoordExtent(a));return n}};goog.provide("ol.source.Source");goog.require("ol");goog.require("ol.Attribution");goog.require("ol.Object");goog.require("ol.proj");goog.require("ol.source.State");ol.source.Source=function(e){ol.Object.call(this);this.projection_=ol.proj.get(e.projection);this.attributions_=null;this.attributions2_=this.adaptAttributions_(e.attributions);this.logo_=e.logo;this.state_=void 0!==e.state?e.state:ol.source.State.READY;this.wrapX_=void 0!==e.wrapX&&e.wrapX};ol.inherits(ol.source.Source,ol.Object);ol.source.Source.prototype.adaptAttributions_=function(e){if(!e)return null;if(e instanceof ol.Attribution){this.attributions_=[e];return function(t){return[e.getHTML()]}}if(Array.isArray(e)){if(e[0]instanceof ol.Attribution){this.attributions_=e;var t=e.map(function(e){return e.getHTML()});return function(e){return t}}this.attributions_=e.map(function(e){return new ol.Attribution({html:e})});return function(t){return e}}if("function"==typeof e)return e;this.attributions_=[new ol.Attribution({html:e})];return function(t){return[e]}};ol.source.Source.prototype.forEachFeatureAtCoordinate=ol.nullFunction;ol.source.Source.prototype.getAttributions=function(){return this.attributions_};ol.source.Source.prototype.getAttributions2=function(){return this.attributions2_};ol.source.Source.prototype.getLogo=function(){return this.logo_};ol.source.Source.prototype.getProjection=function(){return this.projection_};ol.source.Source.prototype.getResolutions=function(){};ol.source.Source.prototype.getState=function(){return this.state_};ol.source.Source.prototype.getWrapX=function(){return this.wrapX_};ol.source.Source.prototype.refresh=function(){this.changed()};ol.source.Source.prototype.setAttributions=function(e){this.attributions2_=this.adaptAttributions_(e);this.changed()};ol.source.Source.prototype.setLogo=function(e){this.logo_=e};ol.source.Source.prototype.setState=function(e){this.state_=e;this.changed()};goog.provide("ol.source.VectorEventType");ol.source.VectorEventType={ADDFEATURE:"addfeature",CHANGEFEATURE:"changefeature",CLEAR:"clear",REMOVEFEATURE:"removefeature"};goog.provide("ol.structs.RBush");goog.require("ol");goog.require("ol.ext.rbush");goog.require("ol.extent");goog.require("ol.obj");ol.structs.RBush=function(e){this.rbush_=ol.ext.rbush(e);this.items_={}};ol.structs.RBush.prototype.insert=function(e,t){var o={minX:e[0],minY:e[1],maxX:e[2],maxY:e[3],value:t};this.rbush_.insert(o);this.items_[ol.getUid(t)]=o};ol.structs.RBush.prototype.load=function(e,t){for(var o=new Array(t.length),r=0,i=t.length;r<i;r++){var n=e[r],a=t[r],l={minX:n[0],minY:n[1],maxX:n[2],maxY:n[3],value:a};o[r]=l;this.items_[ol.getUid(a)]=l}this.rbush_.load(o)};ol.structs.RBush.prototype.remove=function(e){var t=ol.getUid(e),o=this.items_[t];delete this.items_[t];return null!==this.rbush_.remove(o)};ol.structs.RBush.prototype.update=function(e,t){var o=this.items_[ol.getUid(t)],r=[o.minX,o.minY,o.maxX,o.maxY];if(!ol.extent.equals(r,e)){this.remove(t);this.insert(e,t)}};ol.structs.RBush.prototype.getAll=function(){return this.rbush_.all().map(function(e){return e.value})};ol.structs.RBush.prototype.getInExtent=function(e){var t={minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]};return this.rbush_.search(t).map(function(e){return e.value})};ol.structs.RBush.prototype.forEach=function(e,t){return this.forEach_(this.getAll(),e,t)};ol.structs.RBush.prototype.forEachInExtent=function(e,t,o){return this.forEach_(this.getInExtent(e),t,o)};ol.structs.RBush.prototype.forEach_=function(e,t,o){for(var r,i=0,n=e.length;i<n;i++)if(r=t.call(o,e[i]))return r;return r};ol.structs.RBush.prototype.isEmpty=function(){return ol.obj.isEmpty(this.items_)};ol.structs.RBush.prototype.clear=function(){this.rbush_.clear();this.items_={}};ol.structs.RBush.prototype.getExtent=function(e){var t=this.rbush_.data;return ol.extent.createOrUpdate(t.minX,t.minY,t.maxX,t.maxY,e)};ol.structs.RBush.prototype.concat=function(e){this.rbush_.load(e.rbush_.all());for(var t in e.items_)this.items_[0|t]=e.items_[0|t]};goog.provide("ol.source.Vector");goog.require("ol");goog.require("ol.Collection");goog.require("ol.CollectionEventType");goog.require("ol.ObjectEventType");goog.require("ol.array");goog.require("ol.asserts");goog.require("ol.events");goog.require("ol.events.Event");goog.require("ol.events.EventType");goog.require("ol.extent");goog.require("ol.featureloader");goog.require("ol.functions");goog.require("ol.loadingstrategy");goog.require("ol.obj");goog.require("ol.source.Source");goog.require("ol.source.State");goog.require("ol.source.VectorEventType");goog.require("ol.structs.RBush");ol.source.Vector=function(e){var t=e||{};ol.source.Source.call(this,{attributions:t.attributions,logo:t.logo,projection:void 0,state:ol.source.State.READY,wrapX:void 0===t.wrapX||t.wrapX});this.loader_=ol.nullFunction;this.format_=t.format;this.overlaps_=void 0==t.overlaps||t.overlaps;this.url_=t.url;if(void 0!==t.loader)this.loader_=t.loader;else if(void 0!==this.url_){ol.asserts.assert(this.format_,7);this.loader_=ol.featureloader.xhr(this.url_,this.format_)}this.strategy_=void 0!==t.strategy?t.strategy:ol.loadingstrategy.all;var o,r,i=void 0===t.useSpatialIndex||t.useSpatialIndex;this.featuresRtree_=i?new ol.structs.RBush:null;this.loadedExtentsRtree_=new ol.structs.RBush;this.nullGeometryFeatures_={};this.idIndex_={};this.undefIdIndex_={};this.featureChangeKeys_={};this.featuresCollection_=null;t.features instanceof ol.Collection?r=(o=t.features).getArray():Array.isArray(t.features)&&(r=t.features);i||void 0!==o||(o=new ol.Collection(r));void 0!==r&&this.addFeaturesInternal(r);void 0!==o&&this.bindFeaturesCollection_(o)};ol.inherits(ol.source.Vector,ol.source.Source);ol.source.Vector.prototype.addFeature=function(e){this.addFeatureInternal(e);this.changed()};ol.source.Vector.prototype.addFeatureInternal=function(e){var t=ol.getUid(e).toString();if(this.addToIndex_(t,e)){this.setupChangeEvents_(t,e);var o=e.getGeometry();if(o){var r=o.getExtent();this.featuresRtree_&&this.featuresRtree_.insert(r,e)}else this.nullGeometryFeatures_[t]=e;this.dispatchEvent(new ol.source.Vector.Event(ol.source.VectorEventType.ADDFEATURE,e))}};ol.source.Vector.prototype.setupChangeEvents_=function(e,t){this.featureChangeKeys_[e]=[ol.events.listen(t,ol.events.EventType.CHANGE,this.handleFeatureChange_,this),ol.events.listen(t,ol.ObjectEventType.PROPERTYCHANGE,this.handleFeatureChange_,this)]};ol.source.Vector.prototype.addToIndex_=function(e,t){var o=!0,r=t.getId();if(void 0!==r)r.toString()in this.idIndex_?o=!1:this.idIndex_[r.toString()]=t;else{ol.asserts.assert(!(e in this.undefIdIndex_),30);this.undefIdIndex_[e]=t}return o};ol.source.Vector.prototype.addFeatures=function(e){this.addFeaturesInternal(e);this.changed()};ol.source.Vector.prototype.addFeaturesInternal=function(e){var t,o,r,i,n=[],a=[],l=[];for(o=0,r=e.length;o<r;o++){i=e[o];t=ol.getUid(i).toString();this.addToIndex_(t,i)&&a.push(i)}for(o=0,r=a.length;o<r;o++){i=a[o];t=ol.getUid(i).toString();this.setupChangeEvents_(t,i);var s=i.getGeometry();if(s){var p=s.getExtent();n.push(p);l.push(i)}else this.nullGeometryFeatures_[t]=i}this.featuresRtree_&&this.featuresRtree_.load(n,l);for(o=0,r=a.length;o<r;o++)this.dispatchEvent(new ol.source.Vector.Event(ol.source.VectorEventType.ADDFEATURE,a[o]))};ol.source.Vector.prototype.bindFeaturesCollection_=function(e){var t=!1;ol.events.listen(this,ol.source.VectorEventType.ADDFEATURE,function(o){if(!t){t=!0;e.push(o.feature);t=!1}});ol.events.listen(this,ol.source.VectorEventType.REMOVEFEATURE,function(o){if(!t){t=!0;e.remove(o.feature);t=!1}});ol.events.listen(e,ol.CollectionEventType.ADD,function(e){if(!t){t=!0;this.addFeature(e.element);t=!1}},this);ol.events.listen(e,ol.CollectionEventType.REMOVE,function(e){if(!t){t=!0;this.removeFeature(e.element);t=!1}},this);this.featuresCollection_=e};ol.source.Vector.prototype.clear=function(e){if(e){for(var t in this.featureChangeKeys_){this.featureChangeKeys_[t].forEach(ol.events.unlistenByKey)}if(!this.featuresCollection_){this.featureChangeKeys_={};this.idIndex_={};this.undefIdIndex_={}}}else if(this.featuresRtree_){this.featuresRtree_.forEach(this.removeFeatureInternal,this);for(var o in this.nullGeometryFeatures_)this.removeFeatureInternal(this.nullGeometryFeatures_[o])}this.featuresCollection_&&this.featuresCollection_.clear();this.featuresRtree_&&this.featuresRtree_.clear();this.loadedExtentsRtree_.clear();this.nullGeometryFeatures_={};var r=new ol.source.Vector.Event(ol.source.VectorEventType.CLEAR);this.dispatchEvent(r);this.changed()};ol.source.Vector.prototype.forEachFeature=function(e,t){return this.featuresRtree_?this.featuresRtree_.forEach(e,t):this.featuresCollection_?this.featuresCollection_.forEach(e,t):void 0};ol.source.Vector.prototype.forEachFeatureAtCoordinateDirect=function(e,t,o){var r=[e[0],e[1],e[0],e[1]];return this.forEachFeatureInExtent(r,function(r){return r.getGeometry().intersectsCoordinate(e)?t.call(o,r):void 0})};ol.source.Vector.prototype.forEachFeatureInExtent=function(e,t,o){return this.featuresRtree_?this.featuresRtree_.forEachInExtent(e,t,o):this.featuresCollection_?this.featuresCollection_.forEach(t,o):void 0};ol.source.Vector.prototype.forEachFeatureIntersectingExtent=function(e,t,o){return this.forEachFeatureInExtent(e,function(r){if(r.getGeometry().intersectsExtent(e)){var i=t.call(o,r);if(i)return i}})};ol.source.Vector.prototype.getFeaturesCollection=function(){return this.featuresCollection_};ol.source.Vector.prototype.getFeatures=function(){var e;if(this.featuresCollection_)e=this.featuresCollection_.getArray();else if(this.featuresRtree_){e=this.featuresRtree_.getAll();ol.obj.isEmpty(this.nullGeometryFeatures_)||ol.array.extend(e,ol.obj.getValues(this.nullGeometryFeatures_))}return e};ol.source.Vector.prototype.getFeaturesAtCoordinate=function(e){var t=[];this.forEachFeatureAtCoordinateDirect(e,function(e){t.push(e)});return t};ol.source.Vector.prototype.getFeaturesInExtent=function(e){return this.featuresRtree_.getInExtent(e)};ol.source.Vector.prototype.getClosestFeatureToCoordinate=function(e,t){var o=e[0],r=e[1],i=null,n=[NaN,NaN],a=1/0,l=[-1/0,-1/0,1/0,1/0],s=t||ol.functions.TRUE;this.featuresRtree_.forEachInExtent(l,function(e){if(s(e)){var t=e.getGeometry(),p=a;if((a=t.closestPointXY(o,r,n,a))<p){i=e;var c=Math.sqrt(a);l[0]=o-c;l[1]=r-c;l[2]=o+c;l[3]=r+c}}});return i};ol.source.Vector.prototype.getExtent=function(e){return this.featuresRtree_.getExtent(e)};ol.source.Vector.prototype.getFeatureById=function(e){var t=this.idIndex_[e.toString()];return void 0!==t?t:null};ol.source.Vector.prototype.getFormat=function(){return this.format_};ol.source.Vector.prototype.getOverlaps=function(){return this.overlaps_};ol.source.Vector.prototype.getResolutions=function(){};ol.source.Vector.prototype.getUrl=function(){return this.url_};ol.source.Vector.prototype.handleFeatureChange_=function(e){var t=e.target,o=ol.getUid(t).toString(),r=t.getGeometry();if(r){var i=r.getExtent();if(o in this.nullGeometryFeatures_){delete this.nullGeometryFeatures_[o];this.featuresRtree_&&this.featuresRtree_.insert(i,t)}else this.featuresRtree_&&this.featuresRtree_.update(i,t)}else if(!(o in this.nullGeometryFeatures_)){this.featuresRtree_&&this.featuresRtree_.remove(t);this.nullGeometryFeatures_[o]=t}var n=t.getId();if(void 0!==n){var a=n.toString();if(o in this.undefIdIndex_){delete this.undefIdIndex_[o];this.idIndex_[a]=t}else if(this.idIndex_[a]!==t){this.removeFromIdIndex_(t);this.idIndex_[a]=t}}else if(!(o in this.undefIdIndex_)){this.removeFromIdIndex_(t);this.undefIdIndex_[o]=t}this.changed();this.dispatchEvent(new ol.source.Vector.Event(ol.source.VectorEventType.CHANGEFEATURE,t))};ol.source.Vector.prototype.isEmpty=function(){return this.featuresRtree_.isEmpty()&&ol.obj.isEmpty(this.nullGeometryFeatures_)};ol.source.Vector.prototype.loadFeatures=function(e,t,o){var r,i,n=this.loadedExtentsRtree_,a=this.strategy_(e,t);for(r=0,i=a.length;r<i;++r){var l=a[r];if(!n.forEachInExtent(l,function(e){return ol.extent.containsExtent(e.extent,l)})){this.loader_.call(this,l,t,o);n.insert(l,{extent:l.slice()})}}};ol.source.Vector.prototype.removeLoadedExtent=function(e){var t,o=this.loadedExtentsRtree_;o.forEachInExtent(e,function(o){if(ol.extent.equals(o.extent,e)){t=o;return!0}});t&&o.remove(t)};ol.source.Vector.prototype.removeFeature=function(e){var t=ol.getUid(e).toString();t in this.nullGeometryFeatures_?delete this.nullGeometryFeatures_[t]:this.featuresRtree_&&this.featuresRtree_.remove(e);this.removeFeatureInternal(e);this.changed()};ol.source.Vector.prototype.removeFeatureInternal=function(e){var t=ol.getUid(e).toString();this.featureChangeKeys_[t].forEach(ol.events.unlistenByKey);delete this.featureChangeKeys_[t];var o=e.getId();void 0!==o?delete this.idIndex_[o.toString()]:delete this.undefIdIndex_[t];this.dispatchEvent(new ol.source.Vector.Event(ol.source.VectorEventType.REMOVEFEATURE,e))};ol.source.Vector.prototype.removeFromIdIndex_=function(e){var t=!1;for(var o in this.idIndex_)if(this.idIndex_[o]===e){delete this.idIndex_[o];t=!0;break}return t};ol.source.Vector.prototype.setLoader=function(e){this.loader_=e};ol.source.Vector.Event=function(e,t){ol.events.Event.call(this,e);this.feature=t};ol.inherits(ol.source.Vector.Event,ol.events.Event);goog.provide("ol.interaction.Draw");goog.require("ol");goog.require("ol.Feature");goog.require("ol.MapBrowserEventType");goog.require("ol.Object");goog.require("ol.coordinate");goog.require("ol.events");goog.require("ol.events.Event");goog.require("ol.events.condition");goog.require("ol.extent");goog.require("ol.functions");goog.require("ol.geom.Circle");goog.require("ol.geom.GeometryType");goog.require("ol.geom.LineString");goog.require("ol.geom.MultiLineString");goog.require("ol.geom.MultiPoint");goog.require("ol.geom.MultiPolygon");goog.require("ol.geom.Point");goog.require("ol.geom.Polygon");goog.require("ol.interaction.DrawEventType");goog.require("ol.interaction.Pointer");goog.require("ol.interaction.Property");goog.require("ol.layer.Vector");goog.require("ol.source.Vector");goog.require("ol.style.Style");ol.interaction.Draw=function(e){ol.interaction.Pointer.call(this,{handleDownEvent:ol.interaction.Draw.handleDownEvent_,handleEvent:ol.interaction.Draw.handleEvent,handleUpEvent:ol.interaction.Draw.handleUpEvent_});this.shouldHandle_=!1;this.downPx_=null;this.freehand_=!1;this.source_=e.source?e.source:null;this.features_=e.features?e.features:null;this.snapTolerance_=e.snapTolerance?e.snapTolerance:12;this.type_=e.type;this.mode_=ol.interaction.Draw.getMode_(this.type_);this.stopClick_=!!e.stopClick;this.minPoints_=e.minPoints?e.minPoints:this.mode_===ol.interaction.Draw.Mode_.POLYGON?3:2;this.maxPoints_=e.maxPoints?e.maxPoints:1/0;this.finishCondition_=e.finishCondition?e.finishCondition:ol.functions.TRUE;var t=e.geometryFunction;if(!t)if(this.type_===ol.geom.GeometryType.CIRCLE)t=function(e,t){var o=t||new ol.geom.Circle([NaN,NaN]),r=ol.coordinate.squaredDistance(e[0],e[1]);o.setCenterAndRadius(e[0],Math.sqrt(r));return o};else{var o,r=this.mode_;r===ol.interaction.Draw.Mode_.POINT?o=ol.geom.Point:r===ol.interaction.Draw.Mode_.LINE_STRING?o=ol.geom.LineString:r===ol.interaction.Draw.Mode_.POLYGON&&(o=ol.geom.Polygon);t=function(e,t){var i=t;i?r===ol.interaction.Draw.Mode_.POLYGON?e[0].length?i.setCoordinates([e[0].concat([e[0][0]])]):i.setCoordinates([]):i.setCoordinates(e):i=new o(e);return i}}this.geometryFunction_=t;this.finishCoordinate_=null;this.sketchFeature_=null;this.sketchPoint_=null;this.sketchCoords_=null;this.sketchLine_=null;this.sketchLineCoords_=null;this.squaredClickTolerance_=e.clickTolerance?e.clickTolerance*e.clickTolerance:36;this.overlay_=new ol.layer.Vector({source:new ol.source.Vector({useSpatialIndex:!1,wrapX:!!e.wrapX&&e.wrapX}),style:e.style?e.style:ol.interaction.Draw.getDefaultStyleFunction()});this.geometryName_=e.geometryName;this.condition_=e.condition?e.condition:ol.events.condition.noModifierKeys;this.freehandCondition_;e.freehand?this.freehandCondition_=ol.events.condition.always:this.freehandCondition_=e.freehandCondition?e.freehandCondition:ol.events.condition.shiftKeyOnly;ol.events.listen(this,ol.Object.getChangeEventType(ol.interaction.Property.ACTIVE),this.updateState_,this)};ol.inherits(ol.interaction.Draw,ol.interaction.Pointer);ol.interaction.Draw.getDefaultStyleFunction=function(){var e=ol.style.Style.createDefaultEditing();return function(t,o){return e[t.getGeometry().getType()]}};ol.interaction.Draw.prototype.setMap=function(e){ol.interaction.Pointer.prototype.setMap.call(this,e);this.updateState_()};ol.interaction.Draw.handleEvent=function(e){this.freehand_=this.mode_!==ol.interaction.Draw.Mode_.POINT&&this.freehandCondition_(e);var t=!0;if(this.freehand_&&e.type===ol.MapBrowserEventType.POINTERDRAG&&null!==this.sketchFeature_){this.addToDrawing_(e);t=!1}else this.freehand_&&e.type===ol.MapBrowserEventType.POINTERDOWN?t=!1:e.type===ol.MapBrowserEventType.POINTERMOVE?t=this.handlePointerMove_(e):e.type===ol.MapBrowserEventType.DBLCLICK&&(t=!1);return ol.interaction.Pointer.handleEvent.call(this,e)&&t};ol.interaction.Draw.handleDownEvent_=function(e){this.shouldHandle_=!this.freehand_;if(this.freehand_){this.downPx_=e.pixel;this.finishCoordinate_||this.startDrawing_(e);return!0}if(this.condition_(e)){this.downPx_=e.pixel;return!0}return!1};ol.interaction.Draw.handleUpEvent_=function(e){var t=!0;this.handlePointerMove_(e);var o=this.mode_===ol.interaction.Draw.Mode_.CIRCLE;if(this.shouldHandle_){if(this.finishCoordinate_)this.freehand_||o?this.finishDrawing():this.atFinish_(e)?this.finishCondition_(e)&&this.finishDrawing():this.addToDrawing_(e);else{this.startDrawing_(e);this.mode_===ol.interaction.Draw.Mode_.POINT&&this.finishDrawing()}t=!1}else if(this.freehand_){this.finishCoordinate_=null;this.abortDrawing_()}!t&&this.stopClick_&&e.stopPropagation();return t};ol.interaction.Draw.prototype.handlePointerMove_=function(e){if(this.downPx_&&(!this.freehand_&&this.shouldHandle_||this.freehand_&&!this.shouldHandle_)){var t=this.downPx_,o=e.pixel,r=t[0]-o[0],i=t[1]-o[1],n=r*r+i*i;this.shouldHandle_=this.freehand_?n>this.squaredClickTolerance_:n<=this.squaredClickTolerance_}this.finishCoordinate_?this.modifyDrawing_(e):this.createOrUpdateSketchPoint_(e);return!0};ol.interaction.Draw.prototype.atFinish_=function(e){var t=!1;if(this.sketchFeature_){var o=!1,r=[this.finishCoordinate_];if(this.mode_===ol.interaction.Draw.Mode_.LINE_STRING)o=this.sketchCoords_.length>this.minPoints_;else if(this.mode_===ol.interaction.Draw.Mode_.POLYGON){o=this.sketchCoords_[0].length>this.minPoints_;r=[this.sketchCoords_[0][0],this.sketchCoords_[0][this.sketchCoords_[0].length-2]]}if(o)for(var i=e.map,n=0,a=r.length;n<a;n++){var l=r[n],s=i.getPixelFromCoordinate(l),p=e.pixel,c=p[0]-s[0],u=p[1]-s[1],g=this.freehand_?1:this.snapTolerance_;if(t=Math.sqrt(c*c+u*u)<=g){this.finishCoordinate_=l;break}}}return t};ol.interaction.Draw.prototype.createOrUpdateSketchPoint_=function(e){var t=e.coordinate.slice();if(this.sketchPoint_){this.sketchPoint_.getGeometry().setCoordinates(t)}else{this.sketchPoint_=new ol.Feature(new ol.geom.Point(t));this.updateSketchFeatures_()}};ol.interaction.Draw.prototype.startDrawing_=function(e){var t=e.coordinate;this.finishCoordinate_=t;if(this.mode_===ol.interaction.Draw.Mode_.POINT)this.sketchCoords_=t.slice();else if(this.mode_===ol.interaction.Draw.Mode_.POLYGON){this.sketchCoords_=[[t.slice(),t.slice()]];this.sketchLineCoords_=this.sketchCoords_[0]}else{this.sketchCoords_=[t.slice(),t.slice()];this.mode_===ol.interaction.Draw.Mode_.CIRCLE&&(this.sketchLineCoords_=this.sketchCoords_)}this.sketchLineCoords_&&(this.sketchLine_=new ol.Feature(new ol.geom.LineString(this.sketchLineCoords_)));var o=this.geometryFunction_(this.sketchCoords_);this.sketchFeature_=new ol.Feature;this.geometryName_&&this.sketchFeature_.setGeometryName(this.geometryName_);this.sketchFeature_.setGeometry(o);this.updateSketchFeatures_();this.dispatchEvent(new ol.interaction.Draw.Event(ol.interaction.DrawEventType.DRAWSTART,this.sketchFeature_))};ol.interaction.Draw.prototype.modifyDrawing_=function(e){var t,o,r=e.coordinate,i=this.sketchFeature_.getGeometry();if(this.mode_===ol.interaction.Draw.Mode_.POINT)o=this.sketchCoords_;else if(this.mode_===ol.interaction.Draw.Mode_.POLYGON){o=(t=this.sketchCoords_[0])[t.length-1];this.atFinish_(e)&&(r=this.finishCoordinate_.slice())}else o=(t=this.sketchCoords_)[t.length-1];o[0]=r[0];o[1]=r[1];this.geometryFunction_(this.sketchCoords_,i);if(this.sketchPoint_){this.sketchPoint_.getGeometry().setCoordinates(r)}if(i instanceof ol.geom.Polygon&&this.mode_!==ol.interaction.Draw.Mode_.POLYGON){this.sketchLine_||(this.sketchLine_=new ol.Feature(new ol.geom.LineString(null)));var n=i.getLinearRing(0);this.sketchLine_.getGeometry().setFlatCoordinates(n.getLayout(),n.getFlatCoordinates())}else this.sketchLineCoords_&&this.sketchLine_.getGeometry().setCoordinates(this.sketchLineCoords_);this.updateSketchFeatures_()};ol.interaction.Draw.prototype.addToDrawing_=function(e){var t,o,r=e.coordinate,i=this.sketchFeature_.getGeometry();if(this.mode_===ol.interaction.Draw.Mode_.LINE_STRING){this.finishCoordinate_=r.slice();(o=this.sketchCoords_).length>=this.maxPoints_&&(this.freehand_?o.pop():t=!0);o.push(r.slice());this.geometryFunction_(o,i)}else if(this.mode_===ol.interaction.Draw.Mode_.POLYGON){(o=this.sketchCoords_[0]).length>=this.maxPoints_&&(this.freehand_?o.pop():t=!0);o.push(r.slice());t&&(this.finishCoordinate_=o[0]);this.geometryFunction_(this.sketchCoords_,i)}this.updateSketchFeatures_();t&&this.finishDrawing()};ol.interaction.Draw.prototype.removeLastPoint=function(){if(this.sketchFeature_){var e,t=this.sketchFeature_.getGeometry();if(this.mode_===ol.interaction.Draw.Mode_.LINE_STRING){(e=this.sketchCoords_).splice(-2,1);this.geometryFunction_(e,t);e.length>=2&&(this.finishCoordinate_=e[e.length-2].slice())}else if(this.mode_===ol.interaction.Draw.Mode_.POLYGON){(e=this.sketchCoords_[0]).splice(-2,1);this.sketchLine_.getGeometry().setCoordinates(e);this.geometryFunction_(this.sketchCoords_,t)}0===e.length&&(this.finishCoordinate_=null);this.updateSketchFeatures_()}};ol.interaction.Draw.prototype.finishDrawing=function(){var e=this.abortDrawing_(),t=this.sketchCoords_,o=e.getGeometry();if(this.mode_===ol.interaction.Draw.Mode_.LINE_STRING){t.pop();this.geometryFunction_(t,o)}else if(this.mode_===ol.interaction.Draw.Mode_.POLYGON){t[0].pop();this.geometryFunction_(t,o);t=o.getCoordinates()}this.type_===ol.geom.GeometryType.MULTI_POINT?e.setGeometry(new ol.geom.MultiPoint([t])):this.type_===ol.geom.GeometryType.MULTI_LINE_STRING?e.setGeometry(new ol.geom.MultiLineString([t])):this.type_===ol.geom.GeometryType.MULTI_POLYGON&&e.setGeometry(new ol.geom.MultiPolygon([t]));this.dispatchEvent(new ol.interaction.Draw.Event(ol.interaction.DrawEventType.DRAWEND,e));this.features_&&this.features_.push(e);this.source_&&this.source_.addFeature(e)};ol.interaction.Draw.prototype.abortDrawing_=function(){this.finishCoordinate_=null;var e=this.sketchFeature_;if(e){this.sketchFeature_=null;this.sketchPoint_=null;this.sketchLine_=null;this.overlay_.getSource().clear(!0)}return e};ol.interaction.Draw.prototype.extend=function(e){var t=e.getGeometry();this.sketchFeature_=e;this.sketchCoords_=t.getCoordinates();var o=this.sketchCoords_[this.sketchCoords_.length-1];this.finishCoordinate_=o.slice();this.sketchCoords_.push(o.slice());this.updateSketchFeatures_();this.dispatchEvent(new ol.interaction.Draw.Event(ol.interaction.DrawEventType.DRAWSTART,this.sketchFeature_))};ol.interaction.Draw.prototype.shouldStopEvent=ol.functions.FALSE;ol.interaction.Draw.prototype.updateSketchFeatures_=function(){var e=[];this.sketchFeature_&&e.push(this.sketchFeature_);this.sketchLine_&&e.push(this.sketchLine_);this.sketchPoint_&&e.push(this.sketchPoint_);var t=this.overlay_.getSource();t.clear(!0);t.addFeatures(e)};ol.interaction.Draw.prototype.updateState_=function(){var e=this.getMap(),t=this.getActive();e&&t||this.abortDrawing_();this.overlay_.setMap(t?e:null)};ol.interaction.Draw.createRegularPolygon=function(e,t){return function(o,r){var i=o[0],n=o[1],a=Math.sqrt(ol.coordinate.squaredDistance(i,n)),l=r||ol.geom.Polygon.fromCircle(new ol.geom.Circle(i),e),s=t||Math.atan((n[1]-i[1])/(n[0]-i[0]));ol.geom.Polygon.makeRegular(l,i,a,s);return l}};ol.interaction.Draw.createBox=function(){return function(e,t){var o=ol.extent.boundingExtent(e),r=t||new ol.geom.Polygon(null);r.setCoordinates([[ol.extent.getBottomLeft(o),ol.extent.getBottomRight(o),ol.extent.getTopRight(o),ol.extent.getTopLeft(o),ol.extent.getBottomLeft(o)]]);return r}};ol.interaction.Draw.getMode_=function(e){var t;e===ol.geom.GeometryType.POINT||e===ol.geom.GeometryType.MULTI_POINT?t=ol.interaction.Draw.Mode_.POINT:e===ol.geom.GeometryType.LINE_STRING||e===ol.geom.GeometryType.MULTI_LINE_STRING?t=ol.interaction.Draw.Mode_.LINE_STRING:e===ol.geom.GeometryType.POLYGON||e===ol.geom.GeometryType.MULTI_POLYGON?t=ol.interaction.Draw.Mode_.POLYGON:e===ol.geom.GeometryType.CIRCLE&&(t=ol.interaction.Draw.Mode_.CIRCLE);return t};ol.interaction.Draw.Mode_={POINT:"Point",LINE_STRING:"LineString",POLYGON:"Polygon",CIRCLE:"Circle"};ol.interaction.Draw.Event=function(e,t){ol.events.Event.call(this,e);this.feature=t};ol.inherits(ol.interaction.Draw.Event,ol.events.Event);goog.provide("ol.interaction.ExtentEventType");ol.interaction.ExtentEventType={EXTENTCHANGED:"extentchanged"};goog.provide("ol.interaction.Extent");goog.require("ol");goog.require("ol.Feature");goog.require("ol.MapBrowserEventType");goog.require("ol.MapBrowserPointerEvent");goog.require("ol.coordinate");goog.require("ol.events.Event");goog.require("ol.extent");goog.require("ol.geom.GeometryType");goog.require("ol.geom.Point");goog.require("ol.geom.Polygon");goog.require("ol.interaction.ExtentEventType");goog.require("ol.interaction.Pointer");goog.require("ol.layer.Vector");goog.require("ol.source.Vector");goog.require("ol.style.Style");ol.interaction.Extent=function(e){var t=e||{};this.extent_=null;this.pointerHandler_=null;this.pixelTolerance_=void 0!==t.pixelTolerance?t.pixelTolerance:10;this.snappedToVertex_=!1;this.extentFeature_=null;this.vertexFeature_=null;e||(e={});ol.interaction.Pointer.call(this,{handleDownEvent:ol.interaction.Extent.handleDownEvent_,handleDragEvent:ol.interaction.Extent.handleDragEvent_,handleEvent:ol.interaction.Extent.handleEvent_,handleUpEvent:ol.interaction.Extent.handleUpEvent_});this.extentOverlay_=new ol.layer.Vector({source:new ol.source.Vector({useSpatialIndex:!1,wrapX:!!e.wrapX}),style:e.boxStyle?e.boxStyle:ol.interaction.Extent.getDefaultExtentStyleFunction_(),updateWhileAnimating:!0,updateWhileInteracting:!0});this.vertexOverlay_=new ol.layer.Vector({source:new ol.source.Vector({useSpatialIndex:!1,wrapX:!!e.wrapX}),style:e.pointerStyle?e.pointerStyle:ol.interaction.Extent.getDefaultPointerStyleFunction_(),updateWhileAnimating:!0,updateWhileInteracting:!0});e.extent&&this.setExtent(e.extent)};ol.inherits(ol.interaction.Extent,ol.interaction.Pointer);ol.interaction.Extent.handleEvent_=function(e){if(!(e instanceof ol.MapBrowserPointerEvent))return!0;e.type!=ol.MapBrowserEventType.POINTERMOVE||this.handlingDownUpSequence||this.handlePointerMove_(e);ol.interaction.Pointer.handleEvent.call(this,e);return!1};ol.interaction.Extent.handleDownEvent_=function(e){var t=e.pixel,o=e.map,r=this.getExtent(),i=this.snapToVertex_(t,o),n=function(e){var t=null,o=null;e[0]==r[0]?t=r[2]:e[0]==r[2]&&(t=r[0]);e[1]==r[1]?o=r[3]:e[1]==r[3]&&(o=r[1]);return null!==t&&null!==o?[t,o]:null};if(i&&r){var a=i[0]==r[0]||i[0]==r[2]?i[0]:null,l=i[1]==r[1]||i[1]==r[3]?i[1]:null;null!==a&&null!==l?this.pointerHandler_=ol.interaction.Extent.getPointHandler_(n(i)):null!==a?this.pointerHandler_=ol.interaction.Extent.getEdgeHandler_(n([a,r[1]]),n([a,r[3]])):null!==l&&(this.pointerHandler_=ol.interaction.Extent.getEdgeHandler_(n([r[0],l]),n([r[2],l])))}else{i=o.getCoordinateFromPixel(t);this.setExtent([i[0],i[1],i[0],i[1]]);this.pointerHandler_=ol.interaction.Extent.getPointHandler_(i)}return!0};ol.interaction.Extent.handleDragEvent_=function(e){if(this.pointerHandler_){var t=e.coordinate;this.setExtent(this.pointerHandler_(t));this.createOrUpdatePointerFeature_(t)}return!0};ol.interaction.Extent.handleUpEvent_=function(e){this.pointerHandler_=null;var t=this.getExtent();t&&0!==ol.extent.getArea(t)||this.setExtent(null);return!1};ol.interaction.Extent.getDefaultExtentStyleFunction_=function(){var e=ol.style.Style.createDefaultEditing();return function(t,o){return e[ol.geom.GeometryType.POLYGON]}};ol.interaction.Extent.getDefaultPointerStyleFunction_=function(){var e=ol.style.Style.createDefaultEditing();return function(t,o){return e[ol.geom.GeometryType.POINT]}};ol.interaction.Extent.getPointHandler_=function(e){return function(t){return ol.extent.boundingExtent([e,t])}};ol.interaction.Extent.getEdgeHandler_=function(e,t){return e[0]==t[0]?function(o){return ol.extent.boundingExtent([e,[o[0],t[1]]])}:e[1]==t[1]?function(o){return ol.extent.boundingExtent([e,[t[0],o[1]]])}:null};ol.interaction.Extent.getSegments_=function(e){return[[[e[0],e[1]],[e[0],e[3]]],[[e[0],e[3]],[e[2],e[3]]],[[e[2],e[3]],[e[2],e[1]]],[[e[2],e[1]],[e[0],e[1]]]]};ol.interaction.Extent.prototype.snapToVertex_=function(e,t){var o=t.getCoordinateFromPixel(e),r=this.getExtent();if(r){var i=ol.interaction.Extent.getSegments_(r);i.sort(function(e,t){return ol.coordinate.squaredDistanceToSegment(o,e)-ol.coordinate.squaredDistanceToSegment(o,t)});var n=i[0],a=ol.coordinate.closestOnSegment(o,n),l=t.getPixelFromCoordinate(a);if(ol.coordinate.distance(e,l)<=this.pixelTolerance_){var s=t.getPixelFromCoordinate(n[0]),p=t.getPixelFromCoordinate(n[1]),c=ol.coordinate.squaredDistance(l,s),u=ol.coordinate.squaredDistance(l,p),g=Math.sqrt(Math.min(c,u));this.snappedToVertex_=g<=this.pixelTolerance_;this.snappedToVertex_&&(a=c>u?n[1]:n[0]);return a}}return null};ol.interaction.Extent.prototype.handlePointerMove_=function(e){var t=e.pixel,o=e.map,r=this.snapToVertex_(t,o);r||(r=o.getCoordinateFromPixel(t));this.createOrUpdatePointerFeature_(r)};ol.interaction.Extent.prototype.createOrUpdateExtentFeature_=function(e){var t=this.extentFeature_;if(t)e?t.setGeometry(ol.geom.Polygon.fromExtent(e)):t.setGeometry(void 0);else{t=e?new ol.Feature(ol.geom.Polygon.fromExtent(e)):new ol.Feature({});this.extentFeature_=t;this.extentOverlay_.getSource().addFeature(t)}return t};ol.interaction.Extent.prototype.createOrUpdatePointerFeature_=function(e){var t=this.vertexFeature_;if(t){t.getGeometry().setCoordinates(e)}else{t=new ol.Feature(new ol.geom.Point(e));this.vertexFeature_=t;this.vertexOverlay_.getSource().addFeature(t)}return t};ol.interaction.Extent.prototype.setMap=function(e){this.extentOverlay_.setMap(e);this.vertexOverlay_.setMap(e);ol.interaction.Pointer.prototype.setMap.call(this,e)};ol.interaction.Extent.prototype.getExtent=function(){return this.extent_};ol.interaction.Extent.prototype.setExtent=function(e){this.extent_=e||null;this.createOrUpdateExtentFeature_(e);this.dispatchEvent(new ol.interaction.Extent.Event(this.extent_))};ol.interaction.Extent.Event=function(e){ol.events.Event.call(this,ol.interaction.ExtentEventType.EXTENTCHANGED);this.extent=e};ol.inherits(ol.interaction.Extent.Event,ol.events.Event);goog.provide("ol.interaction.ModifyEventType");ol.interaction.ModifyEventType={MODIFYSTART:"modifystart",MODIFYEND:"modifyend"};goog.provide("ol.interaction.Modify");goog.require("ol");goog.require("ol.Collection");goog.require("ol.CollectionEventType");goog.require("ol.Feature");goog.require("ol.MapBrowserEventType");goog.require("ol.MapBrowserPointerEvent");goog.require("ol.array");goog.require("ol.coordinate");goog.require("ol.events");goog.require("ol.events.Event");goog.require("ol.events.EventType");goog.require("ol.events.condition");goog.require("ol.extent");goog.require("ol.geom.GeometryType");goog.require("ol.geom.Point");goog.require("ol.interaction.ModifyEventType");goog.require("ol.interaction.Pointer");goog.require("ol.layer.Vector");goog.require("ol.source.Vector");goog.require("ol.source.VectorEventType");goog.require("ol.structs.RBush");goog.require("ol.style.Style");ol.interaction.Modify=function(e){ol.interaction.Pointer.call(this,{handleDownEvent:ol.interaction.Modify.handleDownEvent_,handleDragEvent:ol.interaction.Modify.handleDragEvent_,handleEvent:ol.interaction.Modify.handleEvent,handleUpEvent:ol.interaction.Modify.handleUpEvent_});this.condition_=e.condition?e.condition:ol.events.condition.primaryAction;this.defaultDeleteCondition_=function(e){return ol.events.condition.altKeyOnly(e)&&ol.events.condition.singleClick(e)};this.deleteCondition_=e.deleteCondition?e.deleteCondition:this.defaultDeleteCondition_;this.insertVertexCondition_=e.insertVertexCondition?e.insertVertexCondition:ol.events.condition.always;this.vertexFeature_=null;this.vertexSegments_=null;this.lastPixel_=[0,0];this.ignoreNextSingleClick_=!1;this.modified_=!1;this.rBush_=new ol.structs.RBush;this.pixelTolerance_=void 0!==e.pixelTolerance?e.pixelTolerance:10;this.snappedToVertex_=!1;this.changingFeature_=!1;this.dragSegments_=[];this.overlay_=new ol.layer.Vector({source:new ol.source.Vector({useSpatialIndex:!1,wrapX:!!e.wrapX}),style:e.style?e.style:ol.interaction.Modify.getDefaultStyleFunction(),updateWhileAnimating:!0,updateWhileInteracting:!0});this.SEGMENT_WRITERS_={Point:this.writePointGeometry_,LineString:this.writeLineStringGeometry_,LinearRing:this.writeLineStringGeometry_,Polygon:this.writePolygonGeometry_,MultiPoint:this.writeMultiPointGeometry_,MultiLineString:this.writeMultiLineStringGeometry_,MultiPolygon:this.writeMultiPolygonGeometry_,Circle:this.writeCircleGeometry_,GeometryCollection:this.writeGeometryCollectionGeometry_};this.source_=null;var t;if(e.source){this.source_=e.source;t=new ol.Collection(this.source_.getFeatures());ol.events.listen(this.source_,ol.source.VectorEventType.ADDFEATURE,this.handleSourceAdd_,this);ol.events.listen(this.source_,ol.source.VectorEventType.REMOVEFEATURE,this.handleSourceRemove_,this)}else t=e.features;if(!t)throw new Error("The modify interaction requires features or a source");this.features_=t;this.features_.forEach(this.addFeature_,this);ol.events.listen(this.features_,ol.CollectionEventType.ADD,this.handleFeatureAdd_,this);ol.events.listen(this.features_,ol.CollectionEventType.REMOVE,this.handleFeatureRemove_,this);this.lastPointerEvent_=null};ol.inherits(ol.interaction.Modify,ol.interaction.Pointer);ol.interaction.Modify.MODIFY_SEGMENT_CIRCLE_CENTER_INDEX=0;ol.interaction.Modify.MODIFY_SEGMENT_CIRCLE_CIRCUMFERENCE_INDEX=1;ol.interaction.Modify.prototype.addFeature_=function(e){var t=e.getGeometry();t&&t.getType()in this.SEGMENT_WRITERS_&&this.SEGMENT_WRITERS_[t.getType()].call(this,e,t);var o=this.getMap();o&&o.isRendered()&&this.getActive()&&this.handlePointerAtPixel_(this.lastPixel_,o);ol.events.listen(e,ol.events.EventType.CHANGE,this.handleFeatureChange_,this)};ol.interaction.Modify.prototype.willModifyFeatures_=function(e){if(!this.modified_){this.modified_=!0;this.dispatchEvent(new ol.interaction.Modify.Event(ol.interaction.ModifyEventType.MODIFYSTART,this.features_,e))}};ol.interaction.Modify.prototype.removeFeature_=function(e){this.removeFeatureSegmentData_(e);if(this.vertexFeature_&&0===this.features_.getLength()){this.overlay_.getSource().removeFeature(this.vertexFeature_);this.vertexFeature_=null}ol.events.unlisten(e,ol.events.EventType.CHANGE,this.handleFeatureChange_,this)};ol.interaction.Modify.prototype.removeFeatureSegmentData_=function(e){var t=this.rBush_,o=[];t.forEach(function(t){e===t.feature&&o.push(t)});for(var r=o.length-1;r>=0;--r)t.remove(o[r])};ol.interaction.Modify.prototype.setActive=function(e){if(this.vertexFeature_&&!e){this.overlay_.getSource().removeFeature(this.vertexFeature_);this.vertexFeature_=null}ol.interaction.Pointer.prototype.setActive.call(this,e)};ol.interaction.Modify.prototype.setMap=function(e){this.overlay_.setMap(e);ol.interaction.Pointer.prototype.setMap.call(this,e)};ol.interaction.Modify.prototype.handleSourceAdd_=function(e){e.feature&&this.features_.push(e.feature)};ol.interaction.Modify.prototype.handleSourceRemove_=function(e){e.feature&&this.features_.remove(e.feature)};ol.interaction.Modify.prototype.handleFeatureAdd_=function(e){this.addFeature_(e.element)};ol.interaction.Modify.prototype.handleFeatureChange_=function(e){if(!this.changingFeature_){var t=e.target;this.removeFeature_(t);this.addFeature_(t)}};ol.interaction.Modify.prototype.handleFeatureRemove_=function(e){var t=e.element;this.removeFeature_(t)};ol.interaction.Modify.prototype.writePointGeometry_=function(e,t){var o=t.getCoordinates(),r={feature:e,geometry:t,segment:[o,o]};this.rBush_.insert(t.getExtent(),r)};ol.interaction.Modify.prototype.writeMultiPointGeometry_=function(e,t){var o,r,i,n,a=t.getCoordinates();for(r=0,i=a.length;r<i;++r){n={feature:e,geometry:t,depth:[r],index:r,segment:[o=a[r],o]};this.rBush_.insert(t.getExtent(),n)}};ol.interaction.Modify.prototype.writeLineStringGeometry_=function(e,t){var o,r,i,n,a=t.getCoordinates();for(o=0,r=a.length-1;o<r;++o){n={feature:e,geometry:t,index:o,segment:i=a.slice(o,o+2)};this.rBush_.insert(ol.extent.boundingExtent(i),n)}};ol.interaction.Modify.prototype.writeMultiLineStringGeometry_=function(e,t){var o,r,i,n,a,l,s,p=t.getCoordinates();for(n=0,a=p.length;n<a;++n)for(r=0,i=(o=p[n]).length-1;r<i;++r){s={feature:e,geometry:t,depth:[n],index:r,segment:l=o.slice(r,r+2)};this.rBush_.insert(ol.extent.boundingExtent(l),s)}};ol.interaction.Modify.prototype.writePolygonGeometry_=function(e,t){var o,r,i,n,a,l,s,p=t.getCoordinates();for(n=0,a=p.length;n<a;++n)for(r=0,i=(o=p[n]).length-1;r<i;++r){s={feature:e,geometry:t,depth:[n],index:r,segment:l=o.slice(r,r+2)};this.rBush_.insert(ol.extent.boundingExtent(l),s)}};ol.interaction.Modify.prototype.writeMultiPolygonGeometry_=function(e,t){var o,r,i,n,a,l,s,p,c,u,g=t.getCoordinates();for(l=0,s=g.length;l<s;++l)for(n=0,a=(p=g[l]).length;n<a;++n)for(r=0,i=(o=p[n]).length-1;r<i;++r){u={feature:e,geometry:t,depth:[n,l],index:r,segment:c=o.slice(r,r+2)};this.rBush_.insert(ol.extent.boundingExtent(c),u)}};ol.interaction.Modify.prototype.writeCircleGeometry_=function(e,t){var o=t.getCenter(),r={feature:e,geometry:t,index:ol.interaction.Modify.MODIFY_SEGMENT_CIRCLE_CENTER_INDEX,segment:[o,o]},i={feature:e,geometry:t,index:ol.interaction.Modify.MODIFY_SEGMENT_CIRCLE_CIRCUMFERENCE_INDEX,segment:[o,o]},n=[r,i];r.featureSegments=i.featureSegments=n;this.rBush_.insert(ol.extent.createOrUpdateFromCoordinate(o),r);this.rBush_.insert(t.getExtent(),i)};ol.interaction.Modify.prototype.writeGeometryCollectionGeometry_=function(e,t){var o,r=t.getGeometriesArray();for(o=0;o<r.length;++o)this.SEGMENT_WRITERS_[r[o].getType()].call(this,e,r[o])};ol.interaction.Modify.prototype.createOrUpdateVertexFeature_=function(e){var t=this.vertexFeature_;if(t){t.getGeometry().setCoordinates(e)}else{t=new ol.Feature(new ol.geom.Point(e));this.vertexFeature_=t;this.overlay_.getSource().addFeature(t)}return t};ol.interaction.Modify.compareIndexes_=function(e,t){return e.index-t.index};ol.interaction.Modify.handleDownEvent_=function(e){if(!this.condition_(e))return!1;this.handlePointerAtPixel_(e.pixel,e.map);var t=e.map.getCoordinateFromPixel(e.pixel);this.dragSegments_.length=0;this.modified_=!1;var o=this.vertexFeature_;if(o){var r=[],i=o.getGeometry().getCoordinates(),n=ol.extent.boundingExtent([i]),a=this.rBush_.getInExtent(n),l={};a.sort(ol.interaction.Modify.compareIndexes_);for(var s=0,p=a.length;s<p;++s){var c=a[s],u=c.segment,g=ol.getUid(c.feature),d=c.depth;d&&(g+="-"+d.join("-"));l[g]||(l[g]=new Array(2));if(c.geometry.getType()===ol.geom.GeometryType.CIRCLE&&c.index===ol.interaction.Modify.MODIFY_SEGMENT_CIRCLE_CIRCUMFERENCE_INDEX){var h=ol.interaction.Modify.closestOnSegmentData_(t,c);if(ol.coordinate.equals(h,i)&&!l[g][0]){this.dragSegments_.push([c,0]);l[g][0]=c}}else if(ol.coordinate.equals(u[0],i)&&!l[g][0]){this.dragSegments_.push([c,0]);l[g][0]=c}else if(ol.coordinate.equals(u[1],i)&&!l[g][1]){if((c.geometry.getType()===ol.geom.GeometryType.LINE_STRING||c.geometry.getType()===ol.geom.GeometryType.MULTI_LINE_STRING)&&l[g][0]&&0===l[g][0].index)continue;this.dragSegments_.push([c,1]);l[g][1]=c}else this.insertVertexCondition_(e)&&ol.getUid(u)in this.vertexSegments_&&!l[g][0]&&!l[g][1]&&r.push([c,i])}r.length&&this.willModifyFeatures_(e);for(var f=r.length-1;f>=0;--f)this.insertVertex_.apply(this,r[f])}return!!this.vertexFeature_};ol.interaction.Modify.handleDragEvent_=function(e){this.ignoreNextSingleClick_=!1;this.willModifyFeatures_(e);for(var t=e.coordinate,o=0,r=this.dragSegments_.length;o<r;++o){for(var i,n=this.dragSegments_[o],a=n[0],l=a.depth,s=a.geometry,p=a.segment,c=n[1];t.length<s.getStride();)t.push(p[c][t.length]);switch(s.getType()){case ol.geom.GeometryType.POINT:i=t;p[0]=p[1]=t;break;case ol.geom.GeometryType.MULTI_POINT:(i=s.getCoordinates())[a.index]=t;p[0]=p[1]=t;break;case ol.geom.GeometryType.LINE_STRING:(i=s.getCoordinates())[a.index+c]=t;p[c]=t;break;case ol.geom.GeometryType.MULTI_LINE_STRING:case ol.geom.GeometryType.POLYGON:(i=s.getCoordinates())[l[0]][a.index+c]=t;p[c]=t;break;case ol.geom.GeometryType.MULTI_POLYGON:(i=s.getCoordinates())[l[1]][l[0]][a.index+c]=t;p[c]=t;break;case ol.geom.GeometryType.CIRCLE:p[0]=p[1]=t;if(a.index===ol.interaction.Modify.MODIFY_SEGMENT_CIRCLE_CENTER_INDEX){this.changingFeature_=!0;s.setCenter(t);this.changingFeature_=!1}else{this.changingFeature_=!0;s.setRadius(ol.coordinate.distance(s.getCenter(),t));this.changingFeature_=!1}}i&&this.setGeometryCoordinates_(s,i)}this.createOrUpdateVertexFeature_(t)};ol.interaction.Modify.handleUpEvent_=function(e){for(var t,o,r=this.dragSegments_.length-1;r>=0;--r)if((o=(t=this.dragSegments_[r][0]).geometry).getType()===ol.geom.GeometryType.CIRCLE){var i=o.getCenter(),n=t.featureSegments[0],a=t.featureSegments[1];n.segment[0]=n.segment[1]=i;a.segment[0]=a.segment[1]=i;this.rBush_.update(ol.extent.createOrUpdateFromCoordinate(i),n);this.rBush_.update(o.getExtent(),a)}else this.rBush_.update(ol.extent.boundingExtent(t.segment),t);if(this.modified_){this.dispatchEvent(new ol.interaction.Modify.Event(ol.interaction.ModifyEventType.MODIFYEND,this.features_,e));this.modified_=!1}return!1};ol.interaction.Modify.handleEvent=function(e){if(!(e instanceof ol.MapBrowserPointerEvent))return!0;this.lastPointerEvent_=e;var t;e.map.getView().getInteracting()||e.type!=ol.MapBrowserEventType.POINTERMOVE||this.handlingDownUpSequence||this.handlePointerMove_(e);this.vertexFeature_&&this.deleteCondition_(e)&&(t=!(e.type!=ol.MapBrowserEventType.SINGLECLICK||!this.ignoreNextSingleClick_)||this.removePoint());e.type==ol.MapBrowserEventType.SINGLECLICK&&(this.ignoreNextSingleClick_=!1);return ol.interaction.Pointer.handleEvent.call(this,e)&&!t};ol.interaction.Modify.prototype.handlePointerMove_=function(e){this.lastPixel_=e.pixel;this.handlePointerAtPixel_(e.pixel,e.map)};ol.interaction.Modify.prototype.handlePointerAtPixel_=function(e,t){var o=t.getCoordinateFromPixel(e),r=ol.extent.buffer(ol.extent.createOrUpdateFromCoordinate(o),t.getView().getResolution()*this.pixelTolerance_),i=this.rBush_.getInExtent(r);if(i.length>0){i.sort(function(e,t){return ol.interaction.Modify.pointDistanceToSegmentDataSquared_(o,e)-ol.interaction.Modify.pointDistanceToSegmentDataSquared_(o,t)});var n=i[0],a=n.segment,l=ol.interaction.Modify.closestOnSegmentData_(o,n),s=t.getPixelFromCoordinate(l),p=ol.coordinate.distance(e,s);if(p<=this.pixelTolerance_){var c={};if(n.geometry.getType()===ol.geom.GeometryType.CIRCLE&&n.index===ol.interaction.Modify.MODIFY_SEGMENT_CIRCLE_CIRCUMFERENCE_INDEX){this.snappedToVertex_=!0;this.createOrUpdateVertexFeature_(l)}else{var u,g=t.getPixelFromCoordinate(a[0]),d=t.getPixelFromCoordinate(a[1]),h=ol.coordinate.squaredDistance(s,g),f=ol.coordinate.squaredDistance(s,d);p=Math.sqrt(Math.min(h,f));this.snappedToVertex_=p<=this.pixelTolerance_;this.snappedToVertex_&&(l=h>f?a[1]:a[0]);this.createOrUpdateVertexFeature_(l);for(var y=1,m=i.length;y<m;++y){u=i[y].segment;if(!(ol.coordinate.equals(a[0],u[0])&&ol.coordinate.equals(a[1],u[1])||ol.coordinate.equals(a[0],u[1])&&ol.coordinate.equals(a[1],u[0])))break;c[ol.getUid(u)]=!0}}c[ol.getUid(a)]=!0;this.vertexSegments_=c;return}}if(this.vertexFeature_){this.overlay_.getSource().removeFeature(this.vertexFeature_);this.vertexFeature_=null}};ol.interaction.Modify.pointDistanceToSegmentDataSquared_=function(e,t){var o=t.geometry;if(o.getType()===ol.geom.GeometryType.CIRCLE){var r=o;if(t.index===ol.interaction.Modify.MODIFY_SEGMENT_CIRCLE_CIRCUMFERENCE_INDEX){var i=ol.coordinate.squaredDistance(r.getCenter(),e),n=Math.sqrt(i)-r.getRadius();return n*n}}return ol.coordinate.squaredDistanceToSegment(e,t.segment)};ol.interaction.Modify.closestOnSegmentData_=function(e,t){var o=t.geometry;return o.getType()===ol.geom.GeometryType.CIRCLE&&t.index===ol.interaction.Modify.MODIFY_SEGMENT_CIRCLE_CIRCUMFERENCE_INDEX?o.getClosestPoint(e):ol.coordinate.closestOnSegment(e,t.segment)};ol.interaction.Modify.prototype.insertVertex_=function(e,t){for(var o,r=e.segment,i=e.feature,n=e.geometry,a=e.depth,l=e.index;t.length<n.getStride();)t.push(0);switch(n.getType()){case ol.geom.GeometryType.MULTI_LINE_STRING:case ol.geom.GeometryType.POLYGON:(o=n.getCoordinates())[a[0]].splice(l+1,0,t);break;case ol.geom.GeometryType.MULTI_POLYGON:(o=n.getCoordinates())[a[1]][a[0]].splice(l+1,0,t);break;case ol.geom.GeometryType.LINE_STRING:(o=n.getCoordinates()).splice(l+1,0,t);break;default:return}this.setGeometryCoordinates_(n,o);var s=this.rBush_;s.remove(e);this.updateSegmentIndices_(n,l,a,1);var p={segment:[r[0],t],feature:i,geometry:n,depth:a,index:l};s.insert(ol.extent.boundingExtent(p.segment),p);this.dragSegments_.push([p,1]);var c={segment:[t,r[1]],feature:i,geometry:n,depth:a,index:l+1};s.insert(ol.extent.boundingExtent(c.segment),c);this.dragSegments_.push([c,0]);this.ignoreNextSingleClick_=!0};ol.interaction.Modify.prototype.removePoint=function(){if(this.lastPointerEvent_&&this.lastPointerEvent_.type!=ol.MapBrowserEventType.POINTERDRAG){var e=this.lastPointerEvent_;this.willModifyFeatures_(e);this.removeVertex_();this.dispatchEvent(new ol.interaction.Modify.Event(ol.interaction.ModifyEventType.MODIFYEND,this.features_,e));this.modified_=!1;return!0}return!1};ol.interaction.Modify.prototype.removeVertex_=function(){var e,t,o,r,i,n,a,l,s,p,c,u=this.dragSegments_,g={},d=!1;for(i=u.length-1;i>=0;--i){p=(o=u[i])[0];c=ol.getUid(p.feature);p.depth&&(c+="-"+p.depth.join("-"));c in g||(g[c]={});if(0===o[1]){g[c].right=p;g[c].index=p.index}else if(1==o[1]){g[c].left=p;g[c].index=p.index+1}}for(c in g){s=g[c].right;a=g[c].left;l=(n=g[c].index)-1;p=void 0!==a?a:s;l<0&&(l=0);e=t=(r=p.geometry).getCoordinates();d=!1;switch(r.getType()){case ol.geom.GeometryType.MULTI_LINE_STRING:if(t[p.depth[0]].length>2){t[p.depth[0]].splice(n,1);d=!0}break;case ol.geom.GeometryType.LINE_STRING:if(t.length>2){t.splice(n,1);d=!0}break;case ol.geom.GeometryType.MULTI_POLYGON:e=e[p.depth[1]];case ol.geom.GeometryType.POLYGON:if((e=e[p.depth[0]]).length>4){n==e.length-1&&(n=0);e.splice(n,1);d=!0;if(0===n){e.pop();e.push(e[0]);l=e.length-1}}}if(d){this.setGeometryCoordinates_(r,t);var h=[];if(void 0!==a){this.rBush_.remove(a);h.push(a.segment[0])}if(void 0!==s){this.rBush_.remove(s);h.push(s.segment[1])}if(void 0!==a&&void 0!==s){var f={depth:p.depth,feature:p.feature,geometry:p.geometry,index:l,segment:h};this.rBush_.insert(ol.extent.boundingExtent(f.segment),f)}this.updateSegmentIndices_(r,n,p.depth,-1);if(this.vertexFeature_){this.overlay_.getSource().removeFeature(this.vertexFeature_);this.vertexFeature_=null}u.length=0}}return d};ol.interaction.Modify.prototype.setGeometryCoordinates_=function(e,t){this.changingFeature_=!0;e.setCoordinates(t);this.changingFeature_=!1};ol.interaction.Modify.prototype.updateSegmentIndices_=function(e,t,o,r){this.rBush_.forEachInExtent(e.getExtent(),function(i){i.geometry===e&&(void 0===o||void 0===i.depth||ol.array.equals(i.depth,o))&&i.index>t&&(i.index+=r)})};ol.interaction.Modify.getDefaultStyleFunction=function(){var e=ol.style.Style.createDefaultEditing();return function(t,o){return e[ol.geom.GeometryType.POINT]}};ol.interaction.Modify.Event=function(e,t,o){ol.events.Event.call(this,e);this.features=t;this.mapBrowserEvent=o};ol.inherits(ol.interaction.Modify.Event,ol.events.Event);goog.provide("ol.interaction.Select");goog.require("ol");goog.require("ol.CollectionEventType");goog.require("ol.array");goog.require("ol.events");goog.require("ol.events.Event");goog.require("ol.events.condition");goog.require("ol.functions");goog.require("ol.geom.GeometryType");goog.require("ol.interaction.Interaction");goog.require("ol.layer.Vector");goog.require("ol.obj");goog.require("ol.source.Vector");goog.require("ol.style.Style");ol.interaction.Select=function(e){ol.interaction.Interaction.call(this,{handleEvent:ol.interaction.Select.handleEvent});var t=e||{};this.condition_=t.condition?t.condition:ol.events.condition.singleClick;this.addCondition_=t.addCondition?t.addCondition:ol.events.condition.never;this.removeCondition_=t.removeCondition?t.removeCondition:ol.events.condition.never;this.toggleCondition_=t.toggleCondition?t.toggleCondition:ol.events.condition.shiftKeyOnly;this.multi_=!!t.multi&&t.multi;this.filter_=t.filter?t.filter:ol.functions.TRUE;this.hitTolerance_=t.hitTolerance?t.hitTolerance:0;var o,r=new ol.layer.Vector({source:new ol.source.Vector({useSpatialIndex:!1,features:t.features,wrapX:t.wrapX}),style:t.style?t.style:ol.interaction.Select.getDefaultStyleFunction(),updateWhileAnimating:!0,updateWhileInteracting:!0});this.featureOverlay_=r;if(t.layers)if("function"==typeof t.layers)o=t.layers;else{var i=t.layers;o=function(e){return ol.array.includes(i,e)}}else o=ol.functions.TRUE;this.layerFilter_=o;this.featureLayerAssociation_={};var n=this.featureOverlay_.getSource().getFeaturesCollection();ol.events.listen(n,ol.CollectionEventType.ADD,this.addFeature_,this);ol.events.listen(n,ol.CollectionEventType.REMOVE,this.removeFeature_,this)};ol.inherits(ol.interaction.Select,ol.interaction.Interaction);ol.interaction.Select.prototype.addFeatureLayerAssociation_=function(e,t){var o=ol.getUid(e);this.featureLayerAssociation_[o]=t};ol.interaction.Select.prototype.getFeatures=function(){return this.featureOverlay_.getSource().getFeaturesCollection()};ol.interaction.Select.prototype.getHitTolerance=function(){return this.hitTolerance_};ol.interaction.Select.prototype.getLayer=function(e){var t=ol.getUid(e);return this.featureLayerAssociation_[t]};ol.interaction.Select.handleEvent=function(e){if(!this.condition_(e))return!0;var t=this.addCondition_(e),o=this.removeCondition_(e),r=this.toggleCondition_(e),i=!t&&!o&&!r,n=e.map,a=this.featureOverlay_.getSource().getFeaturesCollection(),l=[],s=[];if(i){ol.obj.clear(this.featureLayerAssociation_);n.forEachFeatureAtPixel(e.pixel,function(e,t){if(this.filter_(e,t)){s.push(e);this.addFeatureLayerAssociation_(e,t);return!this.multi_}}.bind(this),{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_});var p;for(p=a.getLength()-1;p>=0;--p){var c=a.item(p),u=s.indexOf(c);if(u>-1)s.splice(u,1);else{a.remove(c);l.push(c)}}0!==s.length&&a.extend(s)}else{n.forEachFeatureAtPixel(e.pixel,function(e,i){if(this.filter_(e,i)){if(!t&&!r||ol.array.includes(a.getArray(),e)){if((o||r)&&ol.array.includes(a.getArray(),e)){l.push(e);this.removeFeatureLayerAssociation_(e)}}else{s.push(e);this.addFeatureLayerAssociation_(e,i)}return!this.multi_}}.bind(this),{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_});var g;for(g=l.length-1;g>=0;--g)a.remove(l[g]);a.extend(s)}(s.length>0||l.length>0)&&this.dispatchEvent(new ol.interaction.Select.Event(ol.interaction.Select.EventType_.SELECT,s,l,e));return ol.events.condition.pointerMove(e)};ol.interaction.Select.prototype.setHitTolerance=function(e){this.hitTolerance_=e};ol.interaction.Select.prototype.setMap=function(e){var t=this.getMap(),o=this.featureOverlay_.getSource().getFeaturesCollection();t&&o.forEach(t.unskipFeature,t);ol.interaction.Interaction.prototype.setMap.call(this,e);this.featureOverlay_.setMap(e);e&&o.forEach(e.skipFeature,e)};ol.interaction.Select.getDefaultStyleFunction=function(){var e=ol.style.Style.createDefaultEditing();ol.array.extend(e[ol.geom.GeometryType.POLYGON],e[ol.geom.GeometryType.LINE_STRING]);ol.array.extend(e[ol.geom.GeometryType.GEOMETRY_COLLECTION],e[ol.geom.GeometryType.LINE_STRING]);return function(t,o){return t.getGeometry()?e[t.getGeometry().getType()]:null}};ol.interaction.Select.prototype.addFeature_=function(e){var t=this.getMap();t&&t.skipFeature(e.element)};ol.interaction.Select.prototype.removeFeature_=function(e){var t=this.getMap();t&&t.unskipFeature(e.element)};ol.interaction.Select.prototype.removeFeatureLayerAssociation_=function(e){var t=ol.getUid(e);delete this.featureLayerAssociation_[t]};ol.interaction.Select.Event=function(e,t,o,r){ol.events.Event.call(this,e);this.selected=t;this.deselected=o;this.mapBrowserEvent=r};ol.inherits(ol.interaction.Select.Event,ol.events.Event);ol.interaction.Select.EventType_={SELECT:"select"};goog.provide("ol.interaction.Snap");goog.require("ol");goog.require("ol.Collection");goog.require("ol.CollectionEventType");goog.require("ol.coordinate");goog.require("ol.events");goog.require("ol.events.EventType");goog.require("ol.extent");goog.require("ol.functions");goog.require("ol.geom.GeometryType");goog.require("ol.geom.Polygon");goog.require("ol.interaction.Pointer");goog.require("ol.obj");goog.require("ol.source.Vector");goog.require("ol.source.VectorEventType");goog.require("ol.structs.RBush");ol.interaction.Snap=function(e){ol.interaction.Pointer.call(this,{handleEvent:ol.interaction.Snap.handleEvent_,handleDownEvent:ol.functions.TRUE,handleUpEvent:ol.interaction.Snap.handleUpEvent_});var t=e||{};this.source_=t.source?t.source:null;this.vertex_=void 0===t.vertex||t.vertex;this.edge_=void 0===t.edge||t.edge;this.features_=t.features?t.features:null;this.featuresListenerKeys_=[];this.featureChangeListenerKeys_={};this.indexedFeaturesExtents_={};this.pendingFeatures_={};this.pixelCoordinate_=null;this.pixelTolerance_=void 0!==t.pixelTolerance?t.pixelTolerance:10;this.sortByDistance_=ol.interaction.Snap.sortByDistance.bind(this);this.rBush_=new ol.structs.RBush;this.SEGMENT_WRITERS_={Point:this.writePointGeometry_,LineString:this.writeLineStringGeometry_,LinearRing:this.writeLineStringGeometry_,Polygon:this.writePolygonGeometry_,MultiPoint:this.writeMultiPointGeometry_,MultiLineString:this.writeMultiLineStringGeometry_,MultiPolygon:this.writeMultiPolygonGeometry_,GeometryCollection:this.writeGeometryCollectionGeometry_,Circle:this.writeCircleGeometry_}};ol.inherits(ol.interaction.Snap,ol.interaction.Pointer);ol.interaction.Snap.prototype.addFeature=function(e,t){var o=void 0===t||t,r=ol.getUid(e),i=e.getGeometry();if(i){var n=this.SEGMENT_WRITERS_[i.getType()];if(n){this.indexedFeaturesExtents_[r]=i.getExtent(ol.extent.createEmpty());n.call(this,e,i)}}o&&(this.featureChangeListenerKeys_[r]=ol.events.listen(e,ol.events.EventType.CHANGE,this.handleFeatureChange_,this))};ol.interaction.Snap.prototype.forEachFeatureAdd_=function(e){this.addFeature(e)};ol.interaction.Snap.prototype.forEachFeatureRemove_=function(e){this.removeFeature(e)};ol.interaction.Snap.prototype.getFeatures_=function(){var e;this.features_?e=this.features_:this.source_&&(e=this.source_.getFeatures());return e};ol.interaction.Snap.prototype.handleFeatureAdd_=function(e){var t;e instanceof ol.source.Vector.Event?t=e.feature:e instanceof ol.Collection.Event&&(t=e.element);this.addFeature(t)};ol.interaction.Snap.prototype.handleFeatureRemove_=function(e){var t;e instanceof ol.source.Vector.Event?t=e.feature:e instanceof ol.Collection.Event&&(t=e.element);this.removeFeature(t)};ol.interaction.Snap.prototype.handleFeatureChange_=function(e){var t=e.target;if(this.handlingDownUpSequence){var o=ol.getUid(t);o in this.pendingFeatures_||(this.pendingFeatures_[o]=t)}else this.updateFeature_(t)};ol.interaction.Snap.prototype.removeFeature=function(e,t){var o=void 0===t||t,r=ol.getUid(e),i=this.indexedFeaturesExtents_[r];if(i){var n,a=this.rBush_,l=[];a.forEachInExtent(i,function(t){e===t.feature&&l.push(t)});for(n=l.length-1;n>=0;--n)a.remove(l[n])}if(o){ol.events.unlistenByKey(this.featureChangeListenerKeys_[r]);delete this.featureChangeListenerKeys_[r]}};ol.interaction.Snap.prototype.setMap=function(e){var t=this.getMap(),o=this.featuresListenerKeys_,r=this.getFeatures_();if(t){o.forEach(ol.events.unlistenByKey);o.length=0;r.forEach(this.forEachFeatureRemove_,this)}ol.interaction.Pointer.prototype.setMap.call(this,e);if(e){this.features_?o.push(ol.events.listen(this.features_,ol.CollectionEventType.ADD,this.handleFeatureAdd_,this),ol.events.listen(this.features_,ol.CollectionEventType.REMOVE,this.handleFeatureRemove_,this)):this.source_&&o.push(ol.events.listen(this.source_,ol.source.VectorEventType.ADDFEATURE,this.handleFeatureAdd_,this),ol.events.listen(this.source_,ol.source.VectorEventType.REMOVEFEATURE,this.handleFeatureRemove_,this));r.forEach(this.forEachFeatureAdd_,this)}};ol.interaction.Snap.prototype.shouldStopEvent=ol.functions.FALSE;ol.interaction.Snap.prototype.snapTo=function(e,t,o){var r=o.getCoordinateFromPixel([e[0]-this.pixelTolerance_,e[1]+this.pixelTolerance_]),i=o.getCoordinateFromPixel([e[0]+this.pixelTolerance_,e[1]-this.pixelTolerance_]),n=ol.extent.boundingExtent([r,i]),a=this.rBush_.getInExtent(n);this.vertex_&&!this.edge_&&(a=a.filter(function(e){return e.feature.getGeometry().getType()!==ol.geom.GeometryType.CIRCLE}));var l,s,p,c,u=!1,g=null,d=null;if(a.length>0){this.pixelCoordinate_=t;a.sort(this.sortByDistance_);var h=a[0].segment,f=a[0].feature.getGeometry().getType()===ol.geom.GeometryType.CIRCLE;if(this.vertex_&&!this.edge_){l=o.getPixelFromCoordinate(h[0]);s=o.getPixelFromCoordinate(h[1]);p=ol.coordinate.squaredDistance(e,l);c=ol.coordinate.squaredDistance(e,s);if(Math.sqrt(Math.min(p,c))<=this.pixelTolerance_){u=!0;g=p>c?h[1]:h[0];d=o.getPixelFromCoordinate(g)}}else if(this.edge_){g=f?ol.coordinate.closestOnCircle(t,a[0].feature.getGeometry()):ol.coordinate.closestOnSegment(t,h);d=o.getPixelFromCoordinate(g);if(ol.coordinate.distance(e,d)<=this.pixelTolerance_){u=!0;if(this.vertex_&&!f){l=o.getPixelFromCoordinate(h[0]);s=o.getPixelFromCoordinate(h[1]);p=ol.coordinate.squaredDistance(d,l);c=ol.coordinate.squaredDistance(d,s);if(Math.sqrt(Math.min(p,c))<=this.pixelTolerance_){g=p>c?h[1]:h[0];d=o.getPixelFromCoordinate(g)}}}}u&&(d=[Math.round(d[0]),Math.round(d[1])])}return{snapped:u,vertex:g,vertexPixel:d}};ol.interaction.Snap.prototype.updateFeature_=function(e){this.removeFeature(e,!1);this.addFeature(e,!1)};ol.interaction.Snap.prototype.writeCircleGeometry_=function(e,t){var o,r,i,n,a=ol.geom.Polygon.fromCircle(t).getCoordinates()[0];for(o=0,r=a.length-1;o<r;++o){n={feature:e,segment:i=a.slice(o,o+2)};this.rBush_.insert(ol.extent.boundingExtent(i),n)}};ol.interaction.Snap.prototype.writeGeometryCollectionGeometry_=function(e,t){var o,r=t.getGeometriesArray();for(o=0;o<r.length;++o){var i=this.SEGMENT_WRITERS_[r[o].getType()];i&&i.call(this,e,r[o])}};ol.interaction.Snap.prototype.writeLineStringGeometry_=function(e,t){var o,r,i,n,a=t.getCoordinates();for(o=0,r=a.length-1;o<r;++o){n={feature:e,segment:i=a.slice(o,o+2)};this.rBush_.insert(ol.extent.boundingExtent(i),n)}};ol.interaction.Snap.prototype.writeMultiLineStringGeometry_=function(e,t){var o,r,i,n,a,l,s,p=t.getCoordinates();for(n=0,a=p.length;n<a;++n)for(r=0,i=(o=p[n]).length-1;r<i;++r){s={feature:e,segment:l=o.slice(r,r+2)};this.rBush_.insert(ol.extent.boundingExtent(l),s)}};ol.interaction.Snap.prototype.writeMultiPointGeometry_=function(e,t){var o,r,i,n,a=t.getCoordinates();for(r=0,i=a.length;r<i;++r){n={feature:e,segment:[o=a[r],o]};this.rBush_.insert(t.getExtent(),n)}};ol.interaction.Snap.prototype.writeMultiPolygonGeometry_=function(e,t){var o,r,i,n,a,l,s,p,c,u,g=t.getCoordinates();for(l=0,s=g.length;l<s;++l)for(n=0,a=(p=g[l]).length;n<a;++n)for(r=0,i=(o=p[n]).length-1;r<i;++r){u={feature:e,segment:c=o.slice(r,r+2)};this.rBush_.insert(ol.extent.boundingExtent(c),u)}};ol.interaction.Snap.prototype.writePointGeometry_=function(e,t){var o=t.getCoordinates(),r={feature:e,segment:[o,o]};this.rBush_.insert(t.getExtent(),r)};ol.interaction.Snap.prototype.writePolygonGeometry_=function(e,t){var o,r,i,n,a,l,s,p=t.getCoordinates();for(n=0,a=p.length;n<a;++n)for(r=0,i=(o=p[n]).length-1;r<i;++r){s={feature:e,segment:l=o.slice(r,r+2)};this.rBush_.insert(ol.extent.boundingExtent(l),s)}};ol.interaction.Snap.handleEvent_=function(e){var t=this.snapTo(e.pixel,e.coordinate,e.map);if(t.snapped){e.coordinate=t.vertex.slice(0,2);e.pixel=t.vertexPixel}return ol.interaction.Pointer.handleEvent.call(this,e)};ol.interaction.Snap.handleUpEvent_=function(e){var t=ol.obj.getValues(this.pendingFeatures_);if(t.length){t.forEach(this.updateFeature_,this);this.pendingFeatures_={}}return!1};ol.interaction.Snap.sortByDistance=function(e,t){return ol.coordinate.squaredDistanceToSegment(this.pixelCoordinate_,e.segment)-ol.coordinate.squaredDistanceToSegment(this.pixelCoordinate_,t.segment)};goog.provide("ol.interaction.TranslateEventType");ol.interaction.TranslateEventType={TRANSLATESTART:"translatestart",TRANSLATING:"translating",TRANSLATEEND:"translateend"};goog.provide("ol.interaction.Translate");goog.require("ol");goog.require("ol.Collection");goog.require("ol.Object");goog.require("ol.events");goog.require("ol.events.Event");goog.require("ol.functions");goog.require("ol.array");goog.require("ol.interaction.Pointer");goog.require("ol.interaction.Property");goog.require("ol.interaction.TranslateEventType");ol.interaction.Translate=function(e){ol.interaction.Pointer.call(this,{handleDownEvent:ol.interaction.Translate.handleDownEvent_,handleDragEvent:ol.interaction.Translate.handleDragEvent_,handleMoveEvent:ol.interaction.Translate.handleMoveEvent_,handleUpEvent:ol.interaction.Translate.handleUpEvent_});var t,o=e||{};this.lastCoordinate_=null;this.features_=void 0!==o.features?o.features:null;if(o.layers)if("function"==typeof o.layers)t=o.layers;else{var r=o.layers;t=function(e){return ol.array.includes(r,e)}}else t=ol.functions.TRUE;this.layerFilter_=t;this.hitTolerance_=o.hitTolerance?o.hitTolerance:0;this.lastFeature_=null;ol.events.listen(this,ol.Object.getChangeEventType(ol.interaction.Property.ACTIVE),this.handleActiveChanged_,this)};ol.inherits(ol.interaction.Translate,ol.interaction.Pointer);ol.interaction.Translate.handleDownEvent_=function(e){this.lastFeature_=this.featuresAtPixel_(e.pixel,e.map);if(!this.lastCoordinate_&&this.lastFeature_){this.lastCoordinate_=e.coordinate;ol.interaction.Translate.handleMoveEvent_.call(this,e);var t=this.features_||new ol.Collection([this.lastFeature_]);this.dispatchEvent(new ol.interaction.Translate.Event(ol.interaction.TranslateEventType.TRANSLATESTART,t,e.coordinate));return!0}return!1};ol.interaction.Translate.handleUpEvent_=function(e){if(this.lastCoordinate_){this.lastCoordinate_=null;ol.interaction.Translate.handleMoveEvent_.call(this,e);var t=this.features_||new ol.Collection([this.lastFeature_]);this.dispatchEvent(new ol.interaction.Translate.Event(ol.interaction.TranslateEventType.TRANSLATEEND,t,e.coordinate));return!0}return!1};ol.interaction.Translate.handleDragEvent_=function(e){if(this.lastCoordinate_){var t=e.coordinate,o=t[0]-this.lastCoordinate_[0],r=t[1]-this.lastCoordinate_[1],i=this.features_||new ol.Collection([this.lastFeature_]);i.forEach(function(e){var t=e.getGeometry();t.translate(o,r);e.setGeometry(t)});this.lastCoordinate_=t;this.dispatchEvent(new ol.interaction.Translate.Event(ol.interaction.TranslateEventType.TRANSLATING,i,t))}};ol.interaction.Translate.handleMoveEvent_=function(e){var t=e.map.getViewport();if(this.featuresAtPixel_(e.pixel,e.map)){t.classList.remove(this.lastCoordinate_?"ol-grab":"ol-grabbing");t.classList.add(this.lastCoordinate_?"ol-grabbing":"ol-grab")}else t.classList.remove("ol-grab","ol-grabbing")};ol.interaction.Translate.prototype.featuresAtPixel_=function(e,t){return t.forEachFeatureAtPixel(e,function(e){if(!this.features_||ol.array.includes(this.features_.getArray(),e))return e}.bind(this),{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_})};ol.interaction.Translate.prototype.getHitTolerance=function(){return this.hitTolerance_};ol.interaction.Translate.prototype.setHitTolerance=function(e){this.hitTolerance_=e};ol.interaction.Translate.prototype.setMap=function(e){var t=this.getMap();ol.interaction.Pointer.prototype.setMap.call(this,e);this.updateState_(t)};ol.interaction.Translate.prototype.handleActiveChanged_=function(){this.updateState_(null)};ol.interaction.Translate.prototype.updateState_=function(e){var t=this.getMap(),o=this.getActive();if((!t||!o)&&(t=t||e)){t.getViewport().classList.remove("ol-grab","ol-grabbing")}};ol.interaction.Translate.Event=function(e,t,o){ol.events.Event.call(this,e);this.features=t;this.coordinate=o};ol.inherits(ol.interaction.Translate.Event,ol.events.Event);goog.provide("ol.layer.Heatmap");goog.require("ol.events");goog.require("ol");goog.require("ol.Object");goog.require("ol.dom");goog.require("ol.layer.Vector");goog.require("ol.math");goog.require("ol.obj");goog.require("ol.render.EventType");goog.require("ol.style.Icon");goog.require("ol.style.Style");ol.layer.Heatmap=function(e){var t=e||{},o=ol.obj.assign({},t);delete o.gradient;delete o.radius;delete o.blur;delete o.shadow;delete o.weight;ol.layer.Vector.call(this,o);this.gradient_=null;this.shadow_=void 0!==t.shadow?t.shadow:250;this.circleImage_=void 0;this.styleCache_=null;ol.events.listen(this,ol.Object.getChangeEventType(ol.layer.Heatmap.Property_.GRADIENT),this.handleGradientChanged_,this);this.setGradient(t.gradient?t.gradient:ol.layer.Heatmap.DEFAULT_GRADIENT);this.setBlur(void 0!==t.blur?t.blur:15);this.setRadius(void 0!==t.radius?t.radius:8);ol.events.listen(this,ol.Object.getChangeEventType(ol.layer.Heatmap.Property_.BLUR),this.handleStyleChanged_,this);ol.events.listen(this,ol.Object.getChangeEventType(ol.layer.Heatmap.Property_.RADIUS),this.handleStyleChanged_,this);this.handleStyleChanged_();var r,i=t.weight?t.weight:"weight";r="string"==typeof i?function(e){return e.get(i)}:i;this.setStyle(function(e,t){var o=r(e),i=void 0!==o?ol.math.clamp(o,0,1):1,n=255*i|0,a=this.styleCache_[n];if(!a){a=[new ol.style.Style({image:new ol.style.Icon({opacity:i,src:this.circleImage_})})];this.styleCache_[n]=a}return a}.bind(this));this.setRenderOrder(null);ol.events.listen(this,ol.render.EventType.RENDER,this.handleRender_,this)};ol.inherits(ol.layer.Heatmap,ol.layer.Vector);ol.layer.Heatmap.DEFAULT_GRADIENT=["#00f","#0ff","#0f0","#ff0","#f00"];ol.layer.Heatmap.createGradient_=function(e){for(var t=ol.dom.createCanvasContext2D(1,256),o=t.createLinearGradient(0,0,1,256),r=1/(e.length-1),i=0,n=e.length;i<n;++i)o.addColorStop(i*r,e[i]);t.fillStyle=o;t.fillRect(0,0,1,256);return t.getImageData(0,0,1,256).data};ol.layer.Heatmap.prototype.createCircle_=function(){var e=this.getRadius(),t=this.getBlur(),o=e+t+1,r=2*o,i=ol.dom.createCanvasContext2D(r,r);i.shadowOffsetX=i.shadowOffsetY=this.shadow_;i.shadowBlur=t;i.shadowColor="#000";i.beginPath();var n=o-this.shadow_;i.arc(n,n,e,0,2*Math.PI,!0);i.fill();return i.canvas.toDataURL()};ol.layer.Heatmap.prototype.getBlur=function(){return this.get(ol.layer.Heatmap.Property_.BLUR)};ol.layer.Heatmap.prototype.getGradient=function(){return this.get(ol.layer.Heatmap.Property_.GRADIENT)};ol.layer.Heatmap.prototype.getRadius=function(){return this.get(ol.layer.Heatmap.Property_.RADIUS)};ol.layer.Heatmap.prototype.handleGradientChanged_=function(){this.gradient_=ol.layer.Heatmap.createGradient_(this.getGradient())};ol.layer.Heatmap.prototype.handleStyleChanged_=function(){this.circleImage_=this.createCircle_();this.styleCache_=new Array(256);this.changed()};ol.layer.Heatmap.prototype.handleRender_=function(e){var t,o,r,i=e.context,n=i.canvas,a=i.getImageData(0,0,n.width,n.height),l=a.data;for(t=0,o=l.length;t<o;t+=4)if(r=4*l[t+3]){l[t]=this.gradient_[r];l[t+1]=this.gradient_[r+1];l[t+2]=this.gradient_[r+2]}i.putImageData(a,0,0)};ol.layer.Heatmap.prototype.setBlur=function(e){this.set(ol.layer.Heatmap.Property_.BLUR,e)};ol.layer.Heatmap.prototype.setGradient=function(e){this.set(ol.layer.Heatmap.Property_.GRADIENT,e)};ol.layer.Heatmap.prototype.setRadius=function(e){this.set(ol.layer.Heatmap.Property_.RADIUS,e)};ol.layer.Heatmap.Property_={BLUR:"blur",GRADIENT:"gradient",RADIUS:"radius"};goog.provide("ol.layer.Image");goog.require("ol");goog.require("ol.LayerType");goog.require("ol.layer.Layer");ol.layer.Image=function(e){var t=e||{};ol.layer.Layer.call(this,t);this.type=ol.LayerType.IMAGE};ol.inherits(ol.layer.Image,ol.layer.Layer);ol.layer.Image.prototype.getSource;goog.provide("ol.layer.TileProperty");ol.layer.TileProperty={PRELOAD:"preload",USE_INTERIM_TILES_ON_ERROR:"useInterimTilesOnError"};goog.provide("ol.layer.Tile");goog.require("ol");goog.require("ol.LayerType");goog.require("ol.layer.Layer");goog.require("ol.layer.TileProperty");goog.require("ol.obj");ol.layer.Tile=function(e){var t=e||{},o=ol.obj.assign({},t);delete o.preload;delete o.useInterimTilesOnError;ol.layer.Layer.call(this,o);this.setPreload(void 0!==t.preload?t.preload:0);this.setUseInterimTilesOnError(void 0===t.useInterimTilesOnError||t.useInterimTilesOnError);this.type=ol.LayerType.TILE};ol.inherits(ol.layer.Tile,ol.layer.Layer);ol.layer.Tile.prototype.getPreload=function(){return this.get(ol.layer.TileProperty.PRELOAD)};ol.layer.Tile.prototype.getSource;ol.layer.Tile.prototype.setPreload=function(e){this.set(ol.layer.TileProperty.PRELOAD,e)};ol.layer.Tile.prototype.getUseInterimTilesOnError=function(){return this.get(ol.layer.TileProperty.USE_INTERIM_TILES_ON_ERROR)};ol.layer.Tile.prototype.setUseInterimTilesOnError=function(e){this.set(ol.layer.TileProperty.USE_INTERIM_TILES_ON_ERROR,e)};goog.provide("ol.layer.VectorTile");goog.require("ol");goog.require("ol.LayerType");goog.require("ol.asserts");goog.require("ol.layer.TileProperty");goog.require("ol.layer.Vector");goog.require("ol.layer.VectorTileRenderType");goog.require("ol.obj");ol.layer.VectorTile=function(e){var t=e||{},o=t.renderMode||ol.layer.VectorTileRenderType.HYBRID;ol.asserts.assert(void 0==o||o==ol.layer.VectorTileRenderType.IMAGE||o==ol.layer.VectorTileRenderType.HYBRID||o==ol.layer.VectorTileRenderType.VECTOR,28);t.declutter&&o==ol.layer.VectorTileRenderType.IMAGE&&(o=ol.layer.VectorTileRenderType.HYBRID);t.renderMode=o;var r=ol.obj.assign({},t);delete r.preload;delete r.useInterimTilesOnError;ol.layer.Vector.call(this,r);this.setPreload(t.preload?t.preload:0);this.setUseInterimTilesOnError(!t.useInterimTilesOnError||t.useInterimTilesOnError);this.type=ol.LayerType.VECTOR_TILE};ol.inherits(ol.layer.VectorTile,ol.layer.Vector);ol.layer.VectorTile.prototype.getPreload=function(){return this.get(ol.layer.TileProperty.PRELOAD)};ol.layer.VectorTile.prototype.getUseInterimTilesOnError=function(){return this.get(ol.layer.TileProperty.USE_INTERIM_TILES_ON_ERROR)};ol.layer.VectorTile.prototype.setPreload=function(e){this.set(ol.layer.TileProperty.PRELOAD,e)};ol.layer.VectorTile.prototype.setUseInterimTilesOnError=function(e){this.set(ol.layer.TileProperty.USE_INTERIM_TILES_ON_ERROR,e)};ol.layer.VectorTile.prototype.getSource;goog.provide("ol.webgl.Shader");goog.require("ol.functions");ol.webgl.Shader=function(e){this.source_=e};ol.webgl.Shader.prototype.getType=function(){};ol.webgl.Shader.prototype.getSource=function(){return this.source_};ol.webgl.Shader.prototype.isAnimated=ol.functions.FALSE;goog.provide("ol.webgl.Fragment");goog.require("ol");goog.require("ol.webgl");goog.require("ol.webgl.Shader");ol.webgl.Fragment=function(e){ol.webgl.Shader.call(this,e)};ol.inherits(ol.webgl.Fragment,ol.webgl.Shader);ol.webgl.Fragment.prototype.getType=function(){return ol.webgl.FRAGMENT_SHADER};goog.provide("ol.webgl.Vertex");goog.require("ol");goog.require("ol.webgl");goog.require("ol.webgl.Shader");ol.webgl.Vertex=function(e){ol.webgl.Shader.call(this,e)};ol.inherits(ol.webgl.Vertex,ol.webgl.Shader);ol.webgl.Vertex.prototype.getType=function(){return ol.webgl.VERTEX_SHADER};goog.provide("ol.render.webgl.circlereplay.defaultshader");goog.require("ol");goog.require("ol.webgl.Fragment");goog.require("ol.webgl.Vertex");ol.render.webgl.circlereplay.defaultshader.fragment=new ol.webgl.Fragment(ol.DEBUG_WEBGL?"precision mediump float;\nvarying vec2 v_center;\nvarying vec2 v_offset;\nvarying float v_halfWidth;\nvarying float v_pixelRatio;\n\n\n\nuniform float u_opacity;\nuniform vec4 u_fillColor;\nuniform vec4 u_strokeColor;\nuniform vec2 u_size;\n\nvoid main(void) {\n  vec2 windowCenter = vec2((v_center.x + 1.0) / 2.0 * u_size.x * v_pixelRatio,\n      (v_center.y + 1.0) / 2.0 * u_size.y * v_pixelRatio);\n  vec2 windowOffset = vec2((v_offset.x + 1.0) / 2.0 * u_size.x * v_pixelRatio,\n      (v_offset.y + 1.0) / 2.0 * u_size.y * v_pixelRatio);\n  float radius = length(windowCenter - windowOffset);\n  float dist = length(windowCenter - gl_FragCoord.xy);\n  if (dist > radius + v_halfWidth) {\n    if (u_strokeColor.a == 0.0) {\n      gl_FragColor = u_fillColor;\n    } else {\n      gl_FragColor = u_strokeColor;\n    }\n    gl_FragColor.a = gl_FragColor.a - (dist - (radius + v_halfWidth));\n  } else if (u_fillColor.a == 0.0) {\n    // Hooray, no fill, just stroke. We can use real antialiasing.\n    gl_FragColor = u_strokeColor;\n    if (dist < radius - v_halfWidth) {\n      gl_FragColor.a = gl_FragColor.a - (radius - v_halfWidth - dist);\n    }\n  } else {\n    gl_FragColor = u_fillColor;\n    float strokeDist = radius - v_halfWidth;\n    float antialias = 2.0 * v_pixelRatio;\n    if (dist > strokeDist) {\n      gl_FragColor = u_strokeColor;\n    } else if (dist >= strokeDist - antialias) {\n      float step = smoothstep(strokeDist - antialias, strokeDist, dist);\n      gl_FragColor = mix(u_fillColor, u_strokeColor, step);\n    }\n  }\n  gl_FragColor.a = gl_FragColor.a * u_opacity;\n  if (gl_FragColor.a <= 0.0) {\n    discard;\n  }\n}\n":"precision mediump float;varying vec2 a;varying vec2 b;varying float c;varying float d;uniform float m;uniform vec4 n;uniform vec4 o;uniform vec2 p;void main(void){vec2 windowCenter=vec2((a.x+1.0)/2.0*p.x*d,(a.y+1.0)/2.0*p.y*d);vec2 windowOffset=vec2((b.x+1.0)/2.0*p.x*d,(b.y+1.0)/2.0*p.y*d);float radius=length(windowCenter-windowOffset);float dist=length(windowCenter-gl_FragCoord.xy);if(dist>radius+c){if(o.a==0.0){gl_FragColor=n;}else{gl_FragColor=o;}gl_FragColor.a=gl_FragColor.a-(dist-(radius+c));}else if(n.a==0.0){gl_FragColor=o;if(dist<radius-c){gl_FragColor.a=gl_FragColor.a-(radius-c-dist);}} else{gl_FragColor=n;float strokeDist=radius-c;float antialias=2.0*d;if(dist>strokeDist){gl_FragColor=o;}else if(dist>=strokeDist-antialias){float step=smoothstep(strokeDist-antialias,strokeDist,dist);gl_FragColor=mix(n,o,step);}} gl_FragColor.a=gl_FragColor.a*m;if(gl_FragColor.a<=0.0){discard;}}");ol.render.webgl.circlereplay.defaultshader.vertex=new ol.webgl.Vertex(ol.DEBUG_WEBGL?"varying vec2 v_center;\nvarying vec2 v_offset;\nvarying float v_halfWidth;\nvarying float v_pixelRatio;\n\n\nattribute vec2 a_position;\nattribute float a_instruction;\nattribute float a_radius;\n\nuniform mat4 u_projectionMatrix;\nuniform mat4 u_offsetScaleMatrix;\nuniform mat4 u_offsetRotateMatrix;\nuniform float u_lineWidth;\nuniform float u_pixelRatio;\n\nvoid main(void) {\n  mat4 offsetMatrix = u_offsetScaleMatrix * u_offsetRotateMatrix;\n  v_center = vec4(u_projectionMatrix * vec4(a_position, 0.0, 1.0)).xy;\n  v_pixelRatio = u_pixelRatio;\n  float lineWidth = u_lineWidth * u_pixelRatio;\n  v_halfWidth = lineWidth / 2.0;\n  if (lineWidth == 0.0) {\n    lineWidth = 2.0 * u_pixelRatio;\n  }\n  vec2 offset;\n  // Radius with anitaliasing (roughly).\n  float radius = a_radius + 3.0 * u_pixelRatio;\n  // Until we get gl_VertexID in WebGL, we store an instruction.\n  if (a_instruction == 0.0) {\n    // Offsetting the edges of the triangle by lineWidth / 2 is necessary, however\n    // we should also leave some space for the antialiasing, thus we offset by lineWidth.\n    offset = vec2(-1.0, 1.0);\n  } else if (a_instruction == 1.0) {\n    offset = vec2(-1.0, -1.0);\n  } else if (a_instruction == 2.0) {\n    offset = vec2(1.0, -1.0);\n  } else {\n    offset = vec2(1.0, 1.0);\n  }\n\n  gl_Position = u_projectionMatrix * vec4(a_position + offset * radius, 0.0, 1.0) +\n      offsetMatrix * vec4(offset * lineWidth, 0.0, 0.0);\n  v_offset = vec4(u_projectionMatrix * vec4(a_position.x + a_radius, a_position.y,\n      0.0, 1.0)).xy;\n\n  if (distance(v_center, v_offset) > 20000.0) {\n    gl_Position = vec4(v_center, 0.0, 1.0);\n  }\n}\n\n\n":"varying vec2 a;varying vec2 b;varying float c;varying float d;attribute vec2 e;attribute float f;attribute float g;uniform mat4 h;uniform mat4 i;uniform mat4 j;uniform float k;uniform float l;void main(void){mat4 offsetMatrix=i*j;a=vec4(h*vec4(e,0.0,1.0)).xy;d=l;float lineWidth=k*l;c=lineWidth/2.0;if(lineWidth==0.0){lineWidth=2.0*l;}vec2 offset;float radius=g+3.0*l;//Until we get gl_VertexID in WebGL,we store an instruction.if(f==0.0){//Offsetting the edges of the triangle by lineWidth/2 is necessary,however//we should also leave some space for the antialiasing,thus we offset by lineWidth.offset=vec2(-1.0,1.0);}else if(f==1.0){offset=vec2(-1.0,-1.0);}else if(f==2.0){offset=vec2(1.0,-1.0);}else{offset=vec2(1.0,1.0);}gl_Position=h*vec4(e+offset*radius,0.0,1.0)+offsetMatrix*vec4(offset*lineWidth,0.0,0.0);b=vec4(h*vec4(e.x+g,e.y,0.0,1.0)).xy;if(distance(a,b)>20000.0){gl_Position=vec4(a,0.0,1.0);}}");goog.provide("ol.render.webgl.circlereplay.defaultshader.Locations");goog.require("ol");ol.render.webgl.circlereplay.defaultshader.Locations=function(e,t){this.u_projectionMatrix=e.getUniformLocation(t,ol.DEBUG_WEBGL?"u_projectionMatrix":"h");this.u_offsetScaleMatrix=e.getUniformLocation(t,ol.DEBUG_WEBGL?"u_offsetScaleMatrix":"i");this.u_offsetRotateMatrix=e.getUniformLocation(t,ol.DEBUG_WEBGL?"u_offsetRotateMatrix":"j");this.u_lineWidth=e.getUniformLocation(t,ol.DEBUG_WEBGL?"u_lineWidth":"k");this.u_pixelRatio=e.getUniformLocation(t,ol.DEBUG_WEBGL?"u_pixelRatio":"l");this.u_opacity=e.getUniformLocation(t,ol.DEBUG_WEBGL?"u_opacity":"m");this.u_fillColor=e.getUniformLocation(t,ol.DEBUG_WEBGL?"u_fillColor":"n");this.u_strokeColor=e.getUniformLocation(t,ol.DEBUG_WEBGL?"u_strokeColor":"o");this.u_size=e.getUniformLocation(t,ol.DEBUG_WEBGL?"u_size":"p");this.a_position=e.getAttribLocation(t,ol.DEBUG_WEBGL?"a_position":"e");this.a_instruction=e.getAttribLocation(t,ol.DEBUG_WEBGL?"a_instruction":"f");this.a_radius=e.getAttribLocation(t,ol.DEBUG_WEBGL?"a_radius":"g")};goog.provide("ol.vec.Mat4");ol.vec.Mat4.create=function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]};ol.vec.Mat4.fromTransform=function(e,t){e[0]=t[0];e[1]=t[1];e[4]=t[2];e[5]=t[3];e[12]=t[4];e[13]=t[5];return e};goog.provide("ol.render.webgl.Replay");goog.require("ol");goog.require("ol.extent");goog.require("ol.render.VectorContext");goog.require("ol.transform");goog.require("ol.vec.Mat4");goog.require("ol.webgl");ol.render.webgl.Replay=function(e,t){ol.render.VectorContext.call(this);this.tolerance=e;this.maxExtent=t;this.origin=ol.extent.getCenter(t);this.projectionMatrix_=ol.transform.create();this.offsetRotateMatrix_=ol.transform.create();this.offsetScaleMatrix_=ol.transform.create();this.tmpMat4_=ol.vec.Mat4.create();this.indices=[];this.indicesBuffer=null;this.startIndices=[];this.startIndicesFeature=[];this.vertices=[];this.verticesBuffer=null;this.lineStringReplay=void 0};ol.inherits(ol.render.webgl.Replay,ol.render.VectorContext);ol.render.webgl.Replay.prototype.getDeleteResourcesFunction=function(e){};ol.render.webgl.Replay.prototype.finish=function(e){};ol.render.webgl.Replay.prototype.setUpProgram=function(e,t,o,r){};ol.render.webgl.Replay.prototype.shutDownProgram=function(e,t){};ol.render.webgl.Replay.prototype.drawReplay=function(e,t,o,r){};ol.render.webgl.Replay.prototype.drawHitDetectionReplayOneByOne=function(e,t,o,r,i){};ol.render.webgl.Replay.prototype.drawHitDetectionReplay=function(e,t,o,r,i,n){return i?this.drawHitDetectionReplayOneByOne(e,t,o,r,n):this.drawHitDetectionReplayAll(e,t,o,r)};ol.render.webgl.Replay.prototype.drawHitDetectionReplayAll=function(e,t,o,r){e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT);this.drawReplay(e,t,o,!0);var i=r(null);return i||void 0};ol.render.webgl.Replay.prototype.replay=function(e,t,o,r,i,n,a,l,s,p,c){var u,g,d,h,f,y,m,v,C=e.getGL();if(this.lineStringReplay){u=C.isEnabled(C.STENCIL_TEST);g=C.getParameter(C.STENCIL_FUNC);d=C.getParameter(C.STENCIL_VALUE_MASK);h=C.getParameter(C.STENCIL_REF);f=C.getParameter(C.STENCIL_WRITEMASK);y=C.getParameter(C.STENCIL_FAIL);m=C.getParameter(C.STENCIL_PASS_DEPTH_PASS);v=C.getParameter(C.STENCIL_PASS_DEPTH_FAIL);C.enable(C.STENCIL_TEST);C.clear(C.STENCIL_BUFFER_BIT);C.stencilMask(255);C.stencilFunc(C.ALWAYS,1,255);C.stencilOp(C.KEEP,C.KEEP,C.REPLACE);this.lineStringReplay.replay(e,t,o,r,i,n,a,l,s,p,c);C.stencilMask(0);C.stencilFunc(C.NOTEQUAL,1,255)}e.bindBuffer(ol.webgl.ARRAY_BUFFER,this.verticesBuffer);e.bindBuffer(ol.webgl.ELEMENT_ARRAY_BUFFER,this.indicesBuffer);var T=this.setUpProgram(C,e,i,n),S=ol.transform.reset(this.projectionMatrix_);ol.transform.scale(S,2/(o*i[0]),2/(o*i[1]));ol.transform.rotate(S,-r);ol.transform.translate(S,-(t[0]-this.origin[0]),-(t[1]-this.origin[1]));var _=ol.transform.reset(this.offsetScaleMatrix_);ol.transform.scale(_,2/i[0],2/i[1]);var E,x=ol.transform.reset(this.offsetRotateMatrix_);0!==r&&ol.transform.rotate(x,-r);C.uniformMatrix4fv(T.u_projectionMatrix,!1,ol.vec.Mat4.fromTransform(this.tmpMat4_,S));C.uniformMatrix4fv(T.u_offsetScaleMatrix,!1,ol.vec.Mat4.fromTransform(this.tmpMat4_,_));C.uniformMatrix4fv(T.u_offsetRotateMatrix,!1,ol.vec.Mat4.fromTransform(this.tmpMat4_,x));C.uniform1f(T.u_opacity,a);void 0===s?this.drawReplay(C,e,l,!1):E=this.drawHitDetectionReplay(C,e,l,s,p,c);this.shutDownProgram(C,T);if(this.lineStringReplay){u||C.disable(C.STENCIL_TEST);C.clear(C.STENCIL_BUFFER_BIT);C.stencilFunc(g,h,d);C.stencilMask(f);C.stencilOp(y,v,m)}return E};ol.render.webgl.Replay.prototype.drawElements=function(e,t,o,r){var i=t.hasOESElementIndexUint?ol.webgl.UNSIGNED_INT:ol.webgl.UNSIGNED_SHORT,n=r-o,a=o*(t.hasOESElementIndexUint?4:2);e.drawElements(ol.webgl.TRIANGLES,n,i,a)};goog.provide("ol.render.webgl");ol.render.webgl.defaultFont="10px sans-serif";ol.render.webgl.defaultFillStyle=[0,0,0,1];ol.render.webgl.defaultLineCap="round";ol.render.webgl.defaultLineDash=[];ol.render.webgl.defaultLineDashOffset=0;ol.render.webgl.defaultLineJoin="round";ol.render.webgl.defaultMiterLimit=10;ol.render.webgl.defaultStrokeStyle=[0,0,0,1];ol.render.webgl.defaultTextAlign=.5;ol.render.webgl.defaultTextBaseline=.5;ol.render.webgl.defaultLineWidth=1;ol.render.webgl.triangleIsCounterClockwise=function(e,t,o,r,i,n){var a=(o-e)*(n-t)-(i-e)*(r-t);return a<=ol.render.webgl.EPSILON&&a>=-ol.render.webgl.EPSILON?void 0:a>0};ol.render.webgl.EPSILON=Number.EPSILON||2.220446049250313e-16;goog.provide("ol.webgl.Buffer");goog.require("ol.webgl");ol.webgl.Buffer=function(e,t){this.arr_=void 0!==e?e:[];this.usage_=void 0!==t?t:ol.webgl.Buffer.Usage_.STATIC_DRAW};ol.webgl.Buffer.prototype.getArray=function(){return this.arr_};ol.webgl.Buffer.prototype.getUsage=function(){return this.usage_};ol.webgl.Buffer.Usage_={STATIC_DRAW:ol.webgl.STATIC_DRAW,STREAM_DRAW:ol.webgl.STREAM_DRAW,DYNAMIC_DRAW:ol.webgl.DYNAMIC_DRAW};goog.provide("ol.render.webgl.CircleReplay");goog.require("ol");goog.require("ol.array");goog.require("ol.color");goog.require("ol.extent");goog.require("ol.obj");goog.require("ol.geom.flat.transform");goog.require("ol.render.webgl.circlereplay.defaultshader");goog.require("ol.render.webgl.circlereplay.defaultshader.Locations");goog.require("ol.render.webgl.Replay");goog.require("ol.render.webgl");goog.require("ol.webgl");goog.require("ol.webgl.Buffer");ol.render.webgl.CircleReplay=function(e,t){ol.render.webgl.Replay.call(this,e,t);this.defaultLocations_=null;this.styles_=[];this.styleIndices_=[];this.radius_=0;this.state_={fillColor:null,strokeColor:null,lineDash:null,lineDashOffset:void 0,lineWidth:void 0,changed:!1}};ol.inherits(ol.render.webgl.CircleReplay,ol.render.webgl.Replay);ol.render.webgl.CircleReplay.prototype.drawCoordinates_=function(e,t,o,r){var i,n,a=this.vertices.length,l=this.indices.length,s=a/4;for(i=t,n=o;i<n;i+=r){this.vertices[a++]=e[i];this.vertices[a++]=e[i+1];this.vertices[a++]=0;this.vertices[a++]=this.radius_;this.vertices[a++]=e[i];this.vertices[a++]=e[i+1];this.vertices[a++]=1;this.vertices[a++]=this.radius_;this.vertices[a++]=e[i];this.vertices[a++]=e[i+1];this.vertices[a++]=2;this.vertices[a++]=this.radius_;this.vertices[a++]=e[i];this.vertices[a++]=e[i+1];this.vertices[a++]=3;this.vertices[a++]=this.radius_;this.indices[l++]=s;this.indices[l++]=s+1;this.indices[l++]=s+2;this.indices[l++]=s+2;this.indices[l++]=s+3;this.indices[l++]=s;s+=4}};ol.render.webgl.CircleReplay.prototype.drawCircle=function(e,t){var o=e.getRadius(),r=e.getStride();if(o){this.startIndices.push(this.indices.length);this.startIndicesFeature.push(t);if(this.state_.changed){this.styleIndices_.push(this.indices.length);this.state_.changed=!1}this.radius_=o;var i=e.getFlatCoordinates();i=ol.geom.flat.transform.translate(i,0,2,r,-this.origin[0],-this.origin[1]);this.drawCoordinates_(i,0,2,r)}else if(this.state_.changed){this.styles_.pop();if(this.styles_.length){var n=this.styles_[this.styles_.length-1];this.state_.fillColor=n[0];this.state_.strokeColor=n[1];this.state_.lineWidth=n[2];this.state_.changed=!1}}};ol.render.webgl.CircleReplay.prototype.finish=function(e){this.verticesBuffer=new ol.webgl.Buffer(this.vertices);this.indicesBuffer=new ol.webgl.Buffer(this.indices);this.startIndices.push(this.indices.length);0===this.styleIndices_.length&&this.styles_.length>0&&(this.styles_=[]);this.vertices=null;this.indices=null};ol.render.webgl.CircleReplay.prototype.getDeleteResourcesFunction=function(e){var t=this.verticesBuffer,o=this.indicesBuffer;return function(){e.deleteBuffer(t);e.deleteBuffer(o)}};ol.render.webgl.CircleReplay.prototype.setUpProgram=function(e,t,o,r){var i,n;i=ol.render.webgl.circlereplay.defaultshader.fragment;n=ol.render.webgl.circlereplay.defaultshader.vertex;var a,l=t.getProgram(i,n);if(this.defaultLocations_)a=this.defaultLocations_;else{a=new ol.render.webgl.circlereplay.defaultshader.Locations(e,l);this.defaultLocations_=a}t.useProgram(l);e.enableVertexAttribArray(a.a_position);e.vertexAttribPointer(a.a_position,2,ol.webgl.FLOAT,!1,16,0);e.enableVertexAttribArray(a.a_instruction);e.vertexAttribPointer(a.a_instruction,1,ol.webgl.FLOAT,!1,16,8);e.enableVertexAttribArray(a.a_radius);e.vertexAttribPointer(a.a_radius,1,ol.webgl.FLOAT,!1,16,12);e.uniform2fv(a.u_size,o);e.uniform1f(a.u_pixelRatio,r);return a};ol.render.webgl.CircleReplay.prototype.shutDownProgram=function(e,t){e.disableVertexAttribArray(t.a_position);e.disableVertexAttribArray(t.a_instruction);e.disableVertexAttribArray(t.a_radius)};ol.render.webgl.CircleReplay.prototype.drawReplay=function(e,t,o,r){if(ol.obj.isEmpty(o)){var i,n,a,l;a=this.startIndices[this.startIndices.length-1];for(i=this.styleIndices_.length-1;i>=0;--i){n=this.styleIndices_[i];l=this.styles_[i];this.setFillStyle_(e,l[0]);this.setStrokeStyle_(e,l[1],l[2]);this.drawElements(e,t,n,a);a=n}}else this.drawReplaySkipping_(e,t,o)};ol.render.webgl.CircleReplay.prototype.drawHitDetectionReplayOneByOne=function(e,t,o,r,i){var n,a,l,s,p,c,u;u=this.startIndices.length-2;l=this.startIndices[u+1];for(n=this.styleIndices_.length-1;n>=0;--n){s=this.styles_[n];this.setFillStyle_(e,s[0]);this.setStrokeStyle_(e,s[1],s[2]);p=this.styleIndices_[n];for(;u>=0&&this.startIndices[u]>=p;){a=this.startIndices[u];c=this.startIndicesFeature[u];if(void 0===o[ol.getUid(c).toString()]&&c.getGeometry()&&(void 0===i||ol.extent.intersects(i,c.getGeometry().getExtent()))){e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT);this.drawElements(e,t,a,l);var g=r(c);if(g)return g}u--;l=a}}};ol.render.webgl.CircleReplay.prototype.drawReplaySkipping_=function(e,t,o){var r,i,n,a,l,s,p,c;p=this.startIndices.length-2;n=i=this.startIndices[p+1];for(r=this.styleIndices_.length-1;r>=0;--r){a=this.styles_[r];this.setFillStyle_(e,a[0]);this.setStrokeStyle_(e,a[1],a[2]);l=this.styleIndices_[r];for(;p>=0&&this.startIndices[p]>=l;){c=this.startIndices[p];s=this.startIndicesFeature[p];if(o[ol.getUid(s).toString()]){i!==n&&this.drawElements(e,t,i,n);n=c}p--;i=c}i!==n&&this.drawElements(e,t,i,n);i=n=l}};ol.render.webgl.CircleReplay.prototype.setFillStyle_=function(e,t){e.uniform4fv(this.defaultLocations_.u_fillColor,t)};ol.render.webgl.CircleReplay.prototype.setStrokeStyle_=function(e,t,o){e.uniform4fv(this.defaultLocations_.u_strokeColor,t);e.uniform1f(this.defaultLocations_.u_lineWidth,o)};ol.render.webgl.CircleReplay.prototype.setFillStrokeStyle=function(e,t){var o,r;if(t){var i=t.getLineDash();this.state_.lineDash=i||ol.render.webgl.defaultLineDash;var n=t.getLineDashOffset();this.state_.lineDashOffset=n||ol.render.webgl.defaultLineDashOffset;o=(o=t.getColor())instanceof CanvasGradient||o instanceof CanvasPattern?ol.render.webgl.defaultStrokeStyle:ol.color.asArray(o).map(function(e,t){return 3!=t?e/255:e})||ol.render.webgl.defaultStrokeStyle;r=void 0!==(r=t.getWidth())?r:ol.render.webgl.defaultLineWidth}else{o=[0,0,0,0];r=0}var a=e?e.getColor():[0,0,0,0];a=a instanceof CanvasGradient||a instanceof CanvasPattern?ol.render.webgl.defaultFillStyle:ol.color.asArray(a).map(function(e,t){return 3!=t?e/255:e})||ol.render.webgl.defaultFillStyle;if(!(this.state_.strokeColor&&ol.array.equals(this.state_.strokeColor,o)&&this.state_.fillColor&&ol.array.equals(this.state_.fillColor,a)&&this.state_.lineWidth===r)){this.state_.changed=!0;this.state_.fillColor=a;this.state_.strokeColor=o;this.state_.lineWidth=r;this.styles_.push([a,o,r])}};goog.provide("ol.render.webgl.texturereplay.defaultshader");goog.require("ol");goog.require("ol.webgl.Fragment");goog.require("ol.webgl.Vertex");ol.render.webgl.texturereplay.defaultshader.fragment=new ol.webgl.Fragment(ol.DEBUG_WEBGL?"precision mediump float;\nvarying vec2 v_texCoord;\nvarying float v_opacity;\n\nuniform float u_opacity;\nuniform sampler2D u_image;\n\nvoid main(void) {\n  vec4 texColor = texture2D(u_image, v_texCoord);\n  gl_FragColor.rgb = texColor.rgb;\n  float alpha = texColor.a * v_opacity * u_opacity;\n  if (alpha == 0.0) {\n    discard;\n  }\n  gl_FragColor.a = alpha;\n}\n":"precision mediump float;varying vec2 a;varying float b;uniform float k;uniform sampler2D l;void main(void){vec4 texColor=texture2D(l,a);gl_FragColor.rgb=texColor.rgb;float alpha=texColor.a*b*k;if(alpha==0.0){discard;}gl_FragColor.a=alpha;}");ol.render.webgl.texturereplay.defaultshader.vertex=new ol.webgl.Vertex(ol.DEBUG_WEBGL?"varying vec2 v_texCoord;\nvarying float v_opacity;\n\nattribute vec2 a_position;\nattribute vec2 a_texCoord;\nattribute vec2 a_offsets;\nattribute float a_opacity;\nattribute float a_rotateWithView;\n\nuniform mat4 u_projectionMatrix;\nuniform mat4 u_offsetScaleMatrix;\nuniform mat4 u_offsetRotateMatrix;\n\nvoid main(void) {\n  mat4 offsetMatrix = u_offsetScaleMatrix;\n  if (a_rotateWithView == 1.0) {\n    offsetMatrix = u_offsetScaleMatrix * u_offsetRotateMatrix;\n  }\n  vec4 offsets = offsetMatrix * vec4(a_offsets, 0.0, 0.0);\n  gl_Position = u_projectionMatrix * vec4(a_position, 0.0, 1.0) + offsets;\n  v_texCoord = a_texCoord;\n  v_opacity = a_opacity;\n}\n\n\n":"varying vec2 a;varying float b;attribute vec2 c;attribute vec2 d;attribute vec2 e;attribute float f;attribute float g;uniform mat4 h;uniform mat4 i;uniform mat4 j;void main(void){mat4 offsetMatrix=i;if(g==1.0){offsetMatrix=i*j;}vec4 offsets=offsetMatrix*vec4(e,0.0,0.0);gl_Position=h*vec4(c,0.0,1.0)+offsets;a=d;b=f;}");goog.provide("ol.render.webgl.texturereplay.defaultshader.Locations");goog.require("ol");ol.render.webgl.texturereplay.defaultshader.Locations=function(e,t){this.u_projectionMatrix=e.getUniformLocation(t,ol.DEBUG_WEBGL?"u_projectionMatrix":"h");this.u_offsetScaleMatrix=e.getUniformLocation(t,ol.DEBUG_WEBGL?"u_offsetScaleMatrix":"i");this.u_offsetRotateMatrix=e.getUniformLocation(t,ol.DEBUG_WEBGL?"u_offsetRotateMatrix":"j");this.u_opacity=e.getUniformLocation(t,ol.DEBUG_WEBGL?"u_opacity":"k");this.u_image=e.getUniformLocation(t,ol.DEBUG_WEBGL?"u_image":"l");this.a_position=e.getAttribLocation(t,ol.DEBUG_WEBGL?"a_position":"c");this.a_texCoord=e.getAttribLocation(t,ol.DEBUG_WEBGL?"a_texCoord":"d");this.a_offsets=e.getAttribLocation(t,ol.DEBUG_WEBGL?"a_offsets":"e");this.a_opacity=e.getAttribLocation(t,ol.DEBUG_WEBGL?"a_opacity":"f");this.a_rotateWithView=e.getAttribLocation(t,ol.DEBUG_WEBGL?"a_rotateWithView":"g")};goog.provide("ol.webgl.ContextEventType");ol.webgl.ContextEventType={LOST:"webglcontextlost",RESTORED:"webglcontextrestored"};goog.provide("ol.webgl.Context");goog.require("ol");goog.require("ol.Disposable");goog.require("ol.array");goog.require("ol.events");goog.require("ol.obj");goog.require("ol.webgl");goog.require("ol.webgl.ContextEventType");ol.webgl.Context=function(e,t){this.canvas_=e;this.gl_=t;this.bufferCache_={};this.shaderCache_={};this.programCache_={};this.currentProgram_=null;this.hitDetectionFramebuffer_=null;this.hitDetectionTexture_=null;this.hitDetectionRenderbuffer_=null;this.hasOESElementIndexUint=ol.array.includes(ol.WEBGL_EXTENSIONS,"OES_element_index_uint");this.hasOESElementIndexUint&&t.getExtension("OES_element_index_uint");ol.events.listen(this.canvas_,ol.webgl.ContextEventType.LOST,this.handleWebGLContextLost,this);ol.events.listen(this.canvas_,ol.webgl.ContextEventType.RESTORED,this.handleWebGLContextRestored,this)};ol.inherits(ol.webgl.Context,ol.Disposable);ol.webgl.Context.prototype.bindBuffer=function(e,t){var o=this.getGL(),r=t.getArray(),i=String(ol.getUid(t));if(i in this.bufferCache_){var n=this.bufferCache_[i];o.bindBuffer(e,n.buffer)}else{var a,l=o.createBuffer();o.bindBuffer(e,l);e==ol.webgl.ARRAY_BUFFER?a=new Float32Array(r):e==ol.webgl.ELEMENT_ARRAY_BUFFER&&(a=this.hasOESElementIndexUint?new Uint32Array(r):new Uint16Array(r));o.bufferData(e,a,t.getUsage());this.bufferCache_[i]={buf:t,buffer:l}}};ol.webgl.Context.prototype.deleteBuffer=function(e){var t=this.getGL(),o=String(ol.getUid(e)),r=this.bufferCache_[o];t.isContextLost()||t.deleteBuffer(r.buffer);delete this.bufferCache_[o]};ol.webgl.Context.prototype.disposeInternal=function(){ol.events.unlistenAll(this.canvas_);var e=this.getGL();if(!e.isContextLost()){var t;for(t in this.bufferCache_)e.deleteBuffer(this.bufferCache_[t].buffer);for(t in this.programCache_)e.deleteProgram(this.programCache_[t]);for(t in this.shaderCache_)e.deleteShader(this.shaderCache_[t]);e.deleteFramebuffer(this.hitDetectionFramebuffer_);e.deleteRenderbuffer(this.hitDetectionRenderbuffer_);e.deleteTexture(this.hitDetectionTexture_)}};ol.webgl.Context.prototype.getCanvas=function(){return this.canvas_};ol.webgl.Context.prototype.getGL=function(){return this.gl_};ol.webgl.Context.prototype.getHitDetectionFramebuffer=function(){this.hitDetectionFramebuffer_||this.initHitDetectionFramebuffer_();return this.hitDetectionFramebuffer_};ol.webgl.Context.prototype.getShader=function(e){var t=String(ol.getUid(e));if(t in this.shaderCache_)return this.shaderCache_[t];var o=this.getGL(),r=o.createShader(e.getType());o.shaderSource(r,e.getSource());o.compileShader(r);this.shaderCache_[t]=r;return r};ol.webgl.Context.prototype.getProgram=function(e,t){var o=ol.getUid(e)+"/"+ol.getUid(t);if(o in this.programCache_)return this.programCache_[o];var r=this.getGL(),i=r.createProgram();r.attachShader(i,this.getShader(e));r.attachShader(i,this.getShader(t));r.linkProgram(i);this.programCache_[o]=i;return i};ol.webgl.Context.prototype.handleWebGLContextLost=function(){ol.obj.clear(this.bufferCache_);ol.obj.clear(this.shaderCache_);ol.obj.clear(this.programCache_);this.currentProgram_=null;this.hitDetectionFramebuffer_=null;this.hitDetectionTexture_=null;this.hitDetectionRenderbuffer_=null};ol.webgl.Context.prototype.handleWebGLContextRestored=function(){};ol.webgl.Context.prototype.initHitDetectionFramebuffer_=function(){var e=this.gl_,t=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,t);var o=ol.webgl.Context.createEmptyTexture(e,1,1),r=e.createRenderbuffer();e.bindRenderbuffer(e.RENDERBUFFER,r);e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,1,1);e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,o,0);e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,r);e.bindTexture(e.TEXTURE_2D,null);e.bindRenderbuffer(e.RENDERBUFFER,null);e.bindFramebuffer(e.FRAMEBUFFER,null);this.hitDetectionFramebuffer_=t;this.hitDetectionTexture_=o;this.hitDetectionRenderbuffer_=r};ol.webgl.Context.prototype.useProgram=function(e){if(e==this.currentProgram_)return!1;this.getGL().useProgram(e);this.currentProgram_=e;return!0};ol.webgl.Context.createTexture_=function(e,t,o){var r=e.createTexture();e.bindTexture(e.TEXTURE_2D,r);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR);void 0!==t&&e.texParameteri(ol.webgl.TEXTURE_2D,ol.webgl.TEXTURE_WRAP_S,t);void 0!==o&&e.texParameteri(ol.webgl.TEXTURE_2D,ol.webgl.TEXTURE_WRAP_T,o);return r};ol.webgl.Context.createEmptyTexture=function(e,t,o,r,i){var n=ol.webgl.Context.createTexture_(e,r,i);e.texImage2D(e.TEXTURE_2D,0,e.RGBA,t,o,0,e.RGBA,e.UNSIGNED_BYTE,null);return n};ol.webgl.Context.createTexture=function(e,t,o,r){var i=ol.webgl.Context.createTexture_(e,o,r);e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t);return i};goog.provide("ol.render.webgl.TextureReplay");goog.require("ol");goog.require("ol.extent");goog.require("ol.obj");goog.require("ol.render.webgl.texturereplay.defaultshader");goog.require("ol.render.webgl.texturereplay.defaultshader.Locations");goog.require("ol.render.webgl.Replay");goog.require("ol.webgl");goog.require("ol.webgl.Context");ol.render.webgl.TextureReplay=function(e,t){ol.render.webgl.Replay.call(this,e,t);this.anchorX=void 0;this.anchorY=void 0;this.groupIndices=[];this.hitDetectionGroupIndices=[];this.height=void 0;this.imageHeight=void 0;this.imageWidth=void 0;this.defaultLocations=null;this.opacity=void 0;this.originX=void 0;this.originY=void 0;this.rotateWithView=void 0;this.rotation=void 0;this.scale=void 0;this.width=void 0};ol.inherits(ol.render.webgl.TextureReplay,ol.render.webgl.Replay);ol.render.webgl.TextureReplay.prototype.getDeleteResourcesFunction=function(e){var t=this.verticesBuffer,o=this.indicesBuffer,r=this.getTextures(!0),i=e.getGL();return function(){if(!i.isContextLost()){var n,a;for(n=0,a=r.length;n<a;++n)i.deleteTexture(r[n])}e.deleteBuffer(t);e.deleteBuffer(o)}};ol.render.webgl.TextureReplay.prototype.drawCoordinates=function(e,t,o,r){var i,n,a,l,s,p,c=this.anchorX,u=this.anchorY,g=this.height,d=this.imageHeight,h=this.imageWidth,f=this.opacity,y=this.originX,m=this.originY,v=this.rotateWithView?1:0,C=-this.rotation,T=this.scale,S=this.width,_=Math.cos(C),E=Math.sin(C),x=this.indices.length,P=this.vertices.length;for(i=t;i<o;i+=r){s=e[i]-this.origin[0];p=e[i+1]-this.origin[1];n=P/8;a=-T*c;l=-T*(g-u);this.vertices[P++]=s;this.vertices[P++]=p;this.vertices[P++]=a*_-l*E;this.vertices[P++]=a*E+l*_;this.vertices[P++]=y/h;this.vertices[P++]=(m+g)/d;this.vertices[P++]=f;this.vertices[P++]=v;a=T*(S-c);l=-T*(g-u);this.vertices[P++]=s;this.vertices[P++]=p;this.vertices[P++]=a*_-l*E;this.vertices[P++]=a*E+l*_;this.vertices[P++]=(y+S)/h;this.vertices[P++]=(m+g)/d;this.vertices[P++]=f;this.vertices[P++]=v;a=T*(S-c);l=T*u;this.vertices[P++]=s;this.vertices[P++]=p;this.vertices[P++]=a*_-l*E;this.vertices[P++]=a*E+l*_;this.vertices[P++]=(y+S)/h;this.vertices[P++]=m/d;this.vertices[P++]=f;this.vertices[P++]=v;a=-T*c;l=T*u;this.vertices[P++]=s;this.vertices[P++]=p;this.vertices[P++]=a*_-l*E;this.vertices[P++]=a*E+l*_;this.vertices[P++]=y/h;this.vertices[P++]=m/d;this.vertices[P++]=f;this.vertices[P++]=v;this.indices[x++]=n;this.indices[x++]=n+1;this.indices[x++]=n+2;this.indices[x++]=n;this.indices[x++]=n+2;this.indices[x++]=n+3}return P};ol.render.webgl.TextureReplay.prototype.createTextures=function(e,t,o,r){var i,n,a,l,s=t.length;for(l=0;l<s;++l){n=t[l];if((a=ol.getUid(n).toString())in o)i=o[a];else{i=ol.webgl.Context.createTexture(r,n,ol.webgl.CLAMP_TO_EDGE,ol.webgl.CLAMP_TO_EDGE);o[a]=i}e[l]=i}};ol.render.webgl.TextureReplay.prototype.setUpProgram=function(e,t,o,r){var i,n=ol.render.webgl.texturereplay.defaultshader.fragment,a=ol.render.webgl.texturereplay.defaultshader.vertex,l=t.getProgram(n,a);if(this.defaultLocations)i=this.defaultLocations;else{i=new ol.render.webgl.texturereplay.defaultshader.Locations(e,l);this.defaultLocations=i}t.useProgram(l);e.enableVertexAttribArray(i.a_position);e.vertexAttribPointer(i.a_position,2,ol.webgl.FLOAT,!1,32,0);e.enableVertexAttribArray(i.a_offsets);e.vertexAttribPointer(i.a_offsets,2,ol.webgl.FLOAT,!1,32,8);e.enableVertexAttribArray(i.a_texCoord);e.vertexAttribPointer(i.a_texCoord,2,ol.webgl.FLOAT,!1,32,16);e.enableVertexAttribArray(i.a_opacity);e.vertexAttribPointer(i.a_opacity,1,ol.webgl.FLOAT,!1,32,24);e.enableVertexAttribArray(i.a_rotateWithView);e.vertexAttribPointer(i.a_rotateWithView,1,ol.webgl.FLOAT,!1,32,28);return i};ol.render.webgl.TextureReplay.prototype.shutDownProgram=function(e,t){e.disableVertexAttribArray(t.a_position);e.disableVertexAttribArray(t.a_offsets);e.disableVertexAttribArray(t.a_texCoord);e.disableVertexAttribArray(t.a_opacity);e.disableVertexAttribArray(t.a_rotateWithView)};ol.render.webgl.TextureReplay.prototype.drawReplay=function(e,t,o,r){var i=r?this.getHitDetectionTextures():this.getTextures(),n=r?this.hitDetectionGroupIndices:this.groupIndices;if(ol.obj.isEmpty(o)){var a,l,s;for(a=0,l=i.length,s=0;a<l;++a){e.bindTexture(ol.webgl.TEXTURE_2D,i[a]);var p=n[a];this.drawElements(e,t,s,p);s=p}}else this.drawReplaySkipping(e,t,o,i,n)};ol.render.webgl.TextureReplay.prototype.drawReplaySkipping=function(e,t,o,r,i){var n,a,l=0;for(n=0,a=r.length;n<a;++n){e.bindTexture(ol.webgl.TEXTURE_2D,r[n]);for(var s=n>0?i[n-1]:0,p=i[n],c=s,u=s;l<this.startIndices.length&&this.startIndices[l]<=p;){var g=this.startIndicesFeature[l];if(void 0!==o[ol.getUid(g).toString()]){c!==u&&this.drawElements(e,t,c,u);u=c=l===this.startIndices.length-1?p:this.startIndices[l+1]}else u=l===this.startIndices.length-1?p:this.startIndices[l+1];l++}c!==u&&this.drawElements(e,t,c,u)}};ol.render.webgl.TextureReplay.prototype.drawHitDetectionReplayOneByOne=function(e,t,o,r,i){var n,a,l,s,p,c=this.startIndices.length-1,u=this.getHitDetectionTextures();for(n=u.length-1;n>=0;--n){e.bindTexture(ol.webgl.TEXTURE_2D,u[n]);a=n>0?this.hitDetectionGroupIndices[n-1]:0;s=this.hitDetectionGroupIndices[n];for(;c>=0&&this.startIndices[c]>=a;){l=this.startIndices[c];p=this.startIndicesFeature[c];if(void 0===o[ol.getUid(p).toString()]&&p.getGeometry()&&(void 0===i||ol.extent.intersects(i,p.getGeometry().getExtent()))){e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT);this.drawElements(e,t,l,s);var g=r(p);if(g)return g}s=l;c--}}};ol.render.webgl.TextureReplay.prototype.finish=function(e){this.anchorX=void 0;this.anchorY=void 0;this.height=void 0;this.imageHeight=void 0;this.imageWidth=void 0;this.indices=null;this.opacity=void 0;this.originX=void 0;this.originY=void 0;this.rotateWithView=void 0;this.rotation=void 0;this.scale=void 0;this.vertices=null;this.width=void 0};ol.render.webgl.TextureReplay.prototype.getTextures=function(e){};ol.render.webgl.TextureReplay.prototype.getHitDetectionTextures=function(){};goog.provide("ol.render.webgl.ImageReplay");goog.require("ol");goog.require("ol.render.webgl.TextureReplay");goog.require("ol.webgl.Buffer");ol.render.webgl.ImageReplay=function(e,t){ol.render.webgl.TextureReplay.call(this,e,t);this.images_=[];this.hitDetectionImages_=[];this.textures_=[];this.hitDetectionTextures_=[]};ol.inherits(ol.render.webgl.ImageReplay,ol.render.webgl.TextureReplay);ol.render.webgl.ImageReplay.prototype.drawMultiPoint=function(e,t){this.startIndices.push(this.indices.length);this.startIndicesFeature.push(t);var o=e.getFlatCoordinates(),r=e.getStride();this.drawCoordinates(o,0,o.length,r)};ol.render.webgl.ImageReplay.prototype.drawPoint=function(e,t){this.startIndices.push(this.indices.length);this.startIndicesFeature.push(t);var o=e.getFlatCoordinates(),r=e.getStride();this.drawCoordinates(o,0,o.length,r)};ol.render.webgl.ImageReplay.prototype.finish=function(e){var t=e.getGL();this.groupIndices.push(this.indices.length);this.hitDetectionGroupIndices.push(this.indices.length);this.verticesBuffer=new ol.webgl.Buffer(this.vertices);var o=this.indices;this.indicesBuffer=new ol.webgl.Buffer(o);var r={};this.createTextures(this.textures_,this.images_,r,t);this.createTextures(this.hitDetectionTextures_,this.hitDetectionImages_,r,t);this.images_=null;this.hitDetectionImages_=null;ol.render.webgl.TextureReplay.prototype.finish.call(this,e)};ol.render.webgl.ImageReplay.prototype.setImageStyle=function(e){var t,o=e.getAnchor(),r=e.getImage(1),i=e.getImageSize(),n=e.getHitDetectionImage(1),a=e.getOpacity(),l=e.getOrigin(),s=e.getRotateWithView(),p=e.getRotation(),c=e.getSize(),u=e.getScale();if(0===this.images_.length)this.images_.push(r);else{t=this.images_[this.images_.length-1];if(ol.getUid(t)!=ol.getUid(r)){this.groupIndices.push(this.indices.length);this.images_.push(r)}}if(0===this.hitDetectionImages_.length)this.hitDetectionImages_.push(n);else{t=this.hitDetectionImages_[this.hitDetectionImages_.length-1];if(ol.getUid(t)!=ol.getUid(n)){this.hitDetectionGroupIndices.push(this.indices.length);this.hitDetectionImages_.push(n)}}this.anchorX=o[0];this.anchorY=o[1];this.height=c[1];this.imageHeight=i[1];this.imageWidth=i[0];this.opacity=a;this.originX=l[0];this.originY=l[1];this.rotation=p;this.rotateWithView=s;this.scale=u;this.width=c[0]};ol.render.webgl.ImageReplay.prototype.getTextures=function(e){return e?this.textures_.concat(this.hitDetectionTextures_):this.textures_};ol.render.webgl.ImageReplay.prototype.getHitDetectionTextures=function(){return this.hitDetectionTextures_};goog.provide("ol.render.webgl.linestringreplay.defaultshader");goog.require("ol");goog.require("ol.webgl.Fragment");goog.require("ol.webgl.Vertex");ol.render.webgl.linestringreplay.defaultshader.fragment=new ol.webgl.Fragment(ol.DEBUG_WEBGL?"precision mediump float;\nvarying float v_round;\nvarying vec2 v_roundVertex;\nvarying float v_halfWidth;\n\n\n\nuniform float u_opacity;\nuniform vec4 u_color;\nuniform vec2 u_size;\nuniform float u_pixelRatio;\n\nvoid main(void) {\n  if (v_round > 0.0) {\n    vec2 windowCoords = vec2((v_roundVertex.x + 1.0) / 2.0 * u_size.x * u_pixelRatio,\n        (v_roundVertex.y + 1.0) / 2.0 * u_size.y * u_pixelRatio);\n    if (length(windowCoords - gl_FragCoord.xy) > v_halfWidth * u_pixelRatio) {\n      discard;\n    }\n  }\n  gl_FragColor = u_color;\n  float alpha = u_color.a * u_opacity;\n  if (alpha == 0.0) {\n    discard;\n  }\n  gl_FragColor.a = alpha;\n}\n":"precision mediump float;varying float a;varying vec2 aVertex;varying float c;uniform float m;uniform vec4 n;uniform vec2 o;uniform float p;void main(void){if(a>0.0){vec2 windowCoords=vec2((aVertex.x+1.0)/2.0*o.x*p,(aVertex.y+1.0)/2.0*o.y*p);if(length(windowCoords-gl_FragCoord.xy)>c*p){discard;}} gl_FragColor=n;float alpha=n.a*m;if(alpha==0.0){discard;}gl_FragColor.a=alpha;}");ol.render.webgl.linestringreplay.defaultshader.vertex=new ol.webgl.Vertex(ol.DEBUG_WEBGL?"varying float v_round;\nvarying vec2 v_roundVertex;\nvarying float v_halfWidth;\n\n\nattribute vec2 a_lastPos;\nattribute vec2 a_position;\nattribute vec2 a_nextPos;\nattribute float a_direction;\n\nuniform mat4 u_projectionMatrix;\nuniform mat4 u_offsetScaleMatrix;\nuniform mat4 u_offsetRotateMatrix;\nuniform float u_lineWidth;\nuniform float u_miterLimit;\n\nbool nearlyEquals(in float value, in float ref) {\n  float epsilon = 0.000000000001;\n  return value >= ref - epsilon && value <= ref + epsilon;\n}\n\nvoid alongNormal(out vec2 offset, in vec2 nextP, in float turnDir, in float direction) {\n  vec2 dirVect = nextP - a_position;\n  vec2 normal = normalize(vec2(-turnDir * dirVect.y, turnDir * dirVect.x));\n  offset = u_lineWidth / 2.0 * normal * direction;\n}\n\nvoid miterUp(out vec2 offset, out float round, in bool isRound, in float direction) {\n  float halfWidth = u_lineWidth / 2.0;\n  vec2 tangent = normalize(normalize(a_nextPos - a_position) + normalize(a_position - a_lastPos));\n  vec2 normal = vec2(-tangent.y, tangent.x);\n  vec2 dirVect = a_nextPos - a_position;\n  vec2 tmpNormal = normalize(vec2(-dirVect.y, dirVect.x));\n  float miterLength = abs(halfWidth / dot(normal, tmpNormal));\n  offset = normal * direction * miterLength;\n  round = 0.0;\n  if (isRound) {\n    round = 1.0;\n  } else if (miterLength > u_miterLimit + u_lineWidth) {\n    offset = halfWidth * tmpNormal * direction;\n  }\n}\n\nbool miterDown(out vec2 offset, in vec4 projPos, in mat4 offsetMatrix, in float direction) {\n  bool degenerate = false;\n  vec2 tangent = normalize(normalize(a_nextPos - a_position) + normalize(a_position - a_lastPos));\n  vec2 normal = vec2(-tangent.y, tangent.x);\n  vec2 dirVect = a_lastPos - a_position;\n  vec2 tmpNormal = normalize(vec2(-dirVect.y, dirVect.x));\n  vec2 longOffset, shortOffset, longVertex;\n  vec4 shortProjVertex;\n  float halfWidth = u_lineWidth / 2.0;\n  if (length(a_nextPos - a_position) > length(a_lastPos - a_position)) {\n    longOffset = tmpNormal * direction * halfWidth;\n    shortOffset = normalize(vec2(dirVect.y, -dirVect.x)) * direction * halfWidth;\n    longVertex = a_nextPos;\n    shortProjVertex = u_projectionMatrix * vec4(a_lastPos, 0.0, 1.0);\n  } else {\n    shortOffset = tmpNormal * direction * halfWidth;\n    longOffset = normalize(vec2(dirVect.y, -dirVect.x)) * direction * halfWidth;\n    longVertex = a_lastPos;\n    shortProjVertex = u_projectionMatrix * vec4(a_nextPos, 0.0, 1.0);\n  }\n  //Intersection algorithm based on theory by Paul Bourke (http://paulbourke.net/geometry/pointlineplane/).\n  vec4 p1 = u_projectionMatrix * vec4(longVertex, 0.0, 1.0) + offsetMatrix * vec4(longOffset, 0.0, 0.0);\n  vec4 p2 = projPos + offsetMatrix * vec4(longOffset, 0.0, 0.0);\n  vec4 p3 = shortProjVertex + offsetMatrix * vec4(-shortOffset, 0.0, 0.0);\n  vec4 p4 = shortProjVertex + offsetMatrix * vec4(shortOffset, 0.0, 0.0);\n  float denom = (p4.y - p3.y) * (p2.x - p1.x) - (p4.x - p3.x) * (p2.y - p1.y);\n  float firstU = ((p4.x - p3.x) * (p1.y - p3.y) - (p4.y - p3.y) * (p1.x - p3.x)) / denom;\n  float secondU = ((p2.x - p1.x) * (p1.y - p3.y) - (p2.y - p1.y) * (p1.x - p3.x)) / denom;\n  float epsilon = 0.000000000001;\n  if (firstU > epsilon && firstU < 1.0 - epsilon && secondU > epsilon && secondU < 1.0 - epsilon) {\n    shortProjVertex.x = p1.x + firstU * (p2.x - p1.x);\n    shortProjVertex.y = p1.y + firstU * (p2.y - p1.y);\n    offset = shortProjVertex.xy;\n    degenerate = true;\n  } else {\n    float miterLength = abs(halfWidth / dot(normal, tmpNormal));\n    offset = normal * direction * miterLength;\n  }\n  return degenerate;\n}\n\nvoid squareCap(out vec2 offset, out float round, in bool isRound, in vec2 nextP,\n    in float turnDir, in float direction) {\n  round = 0.0;\n  vec2 dirVect = a_position - nextP;\n  vec2 firstNormal = normalize(dirVect);\n  vec2 secondNormal = vec2(turnDir * firstNormal.y * direction, -turnDir * firstNormal.x * direction);\n  vec2 hypotenuse = normalize(firstNormal - secondNormal);\n  vec2 normal = vec2(turnDir * hypotenuse.y * direction, -turnDir * hypotenuse.x * direction);\n  float length = sqrt(v_halfWidth * v_halfWidth * 2.0);\n  offset = normal * length;\n  if (isRound) {\n    round = 1.0;\n  }\n}\n\nvoid main(void) {\n  bool degenerate = false;\n  float direction = float(sign(a_direction));\n  mat4 offsetMatrix = u_offsetScaleMatrix * u_offsetRotateMatrix;\n  vec2 offset;\n  vec4 projPos = u_projectionMatrix * vec4(a_position, 0.0, 1.0);\n  bool round = nearlyEquals(mod(a_direction, 2.0), 0.0);\n\n  v_round = 0.0;\n  v_halfWidth = u_lineWidth / 2.0;\n  v_roundVertex = projPos.xy;\n\n  if (nearlyEquals(mod(a_direction, 3.0), 0.0) || nearlyEquals(mod(a_direction, 17.0), 0.0)) {\n    alongNormal(offset, a_nextPos, 1.0, direction);\n  } else if (nearlyEquals(mod(a_direction, 5.0), 0.0) || nearlyEquals(mod(a_direction, 13.0), 0.0)) {\n    alongNormal(offset, a_lastPos, -1.0, direction);\n  } else if (nearlyEquals(mod(a_direction, 23.0), 0.0)) {\n    miterUp(offset, v_round, round, direction);\n  } else if (nearlyEquals(mod(a_direction, 19.0), 0.0)) {\n    degenerate = miterDown(offset, projPos, offsetMatrix, direction);\n  } else if (nearlyEquals(mod(a_direction, 7.0), 0.0)) {\n    squareCap(offset, v_round, round, a_nextPos, 1.0, direction);\n  } else if (nearlyEquals(mod(a_direction, 11.0), 0.0)) {\n    squareCap(offset, v_round, round, a_lastPos, -1.0, direction);\n  }\n  if (!degenerate) {\n    vec4 offsets = offsetMatrix * vec4(offset, 0.0, 0.0);\n    gl_Position = projPos + offsets;\n  } else {\n    gl_Position = vec4(offset, 0.0, 1.0);\n  }\n}\n\n\n":"varying float a;varying vec2 aVertex;varying float c;attribute vec2 d;attribute vec2 e;attribute vec2 f;attribute float g;uniform mat4 h;uniform mat4 i;uniform mat4 j;uniform float k;uniform float l;bool nearlyEquals(in float value,in float ref){float epsilon=0.000000000001;return value>=ref-epsilon&&value<=ref+epsilon;}void alongNormal(out vec2 offset,in vec2 nextP,in float turnDir,in float direction){vec2 dirVect=nextP-e;vec2 normal=normalize(vec2(-turnDir*dirVect.y,turnDir*dirVect.x));offset=k/2.0*normal*direction;}void miterUp(out vec2 offset,out float round,in bool isRound,in float direction){float halfWidth=k/2.0;vec2 tangent=normalize(normalize(f-e)+normalize(e-d));vec2 normal=vec2(-tangent.y,tangent.x);vec2 dirVect=f-e;vec2 tmpNormal=normalize(vec2(-dirVect.y,dirVect.x));float miterLength=abs(halfWidth/dot(normal,tmpNormal));offset=normal*direction*miterLength;round=0.0;if(isRound){round=1.0;}else if(miterLength>l+k){offset=halfWidth*tmpNormal*direction;}} bool miterDown(out vec2 offset,in vec4 projPos,in mat4 offsetMatrix,in float direction){bool degenerate=false;vec2 tangent=normalize(normalize(f-e)+normalize(e-d));vec2 normal=vec2(-tangent.y,tangent.x);vec2 dirVect=d-e;vec2 tmpNormal=normalize(vec2(-dirVect.y,dirVect.x));vec2 longOffset,shortOffset,longVertex;vec4 shortProjVertex;float halfWidth=k/2.0;if(length(f-e)>length(d-e)){longOffset=tmpNormal*direction*halfWidth;shortOffset=normalize(vec2(dirVect.y,-dirVect.x))*direction*halfWidth;longVertex=f;shortProjVertex=h*vec4(d,0.0,1.0);}else{shortOffset=tmpNormal*direction*halfWidth;longOffset=normalize(vec2(dirVect.y,-dirVect.x))*direction*halfWidth;longVertex=d;shortProjVertex=h*vec4(f,0.0,1.0);}vec4 p1=h*vec4(longVertex,0.0,1.0)+offsetMatrix*vec4(longOffset,0.0,0.0);vec4 p2=projPos+offsetMatrix*vec4(longOffset,0.0,0.0);vec4 p3=shortProjVertex+offsetMatrix*vec4(-shortOffset,0.0,0.0);vec4 p4=shortProjVertex+offsetMatrix*vec4(shortOffset,0.0,0.0);float denom=(p4.y-p3.y)*(p2.x-p1.x)-(p4.x-p3.x)*(p2.y-p1.y);float firstU=((p4.x-p3.x)*(p1.y-p3.y)-(p4.y-p3.y)*(p1.x-p3.x))/denom;float secondU=((p2.x-p1.x)*(p1.y-p3.y)-(p2.y-p1.y)*(p1.x-p3.x))/denom;float epsilon=0.000000000001;if(firstU>epsilon&&firstU<1.0-epsilon&&secondU>epsilon&&secondU<1.0-epsilon){shortProjVertex.x=p1.x+firstU*(p2.x-p1.x);shortProjVertex.y=p1.y+firstU*(p2.y-p1.y);offset=shortProjVertex.xy;degenerate=true;}else{float miterLength=abs(halfWidth/dot(normal,tmpNormal));offset=normal*direction*miterLength;}return degenerate;}void squareCap(out vec2 offset,out float round,in bool isRound,in vec2 nextP,in float turnDir,in float direction){round=0.0;vec2 dirVect=e-nextP;vec2 firstNormal=normalize(dirVect);vec2 secondNormal=vec2(turnDir*firstNormal.y*direction,-turnDir*firstNormal.x*direction);vec2 hypotenuse=normalize(firstNormal-secondNormal);vec2 normal=vec2(turnDir*hypotenuse.y*direction,-turnDir*hypotenuse.x*direction);float length=sqrt(c*c*2.0);offset=normal*length;if(isRound){round=1.0;}} void main(void){bool degenerate=false;float direction=float(sign(g));mat4 offsetMatrix=i*j;vec2 offset;vec4 projPos=h*vec4(e,0.0,1.0);bool round=nearlyEquals(mod(g,2.0),0.0);a=0.0;c=k/2.0;aVertex=projPos.xy;if(nearlyEquals(mod(g,3.0),0.0)||nearlyEquals(mod(g,17.0),0.0)){alongNormal(offset,f,1.0,direction);}else if(nearlyEquals(mod(g,5.0),0.0)||nearlyEquals(mod(g,13.0),0.0)){alongNormal(offset,d,-1.0,direction);}else if(nearlyEquals(mod(g,23.0),0.0)){miterUp(offset,a,round,direction);}else if(nearlyEquals(mod(g,19.0),0.0)){degenerate=miterDown(offset,projPos,offsetMatrix,direction);}else if(nearlyEquals(mod(g,7.0),0.0)){squareCap(offset,a,round,f,1.0,direction);}else if(nearlyEquals(mod(g,11.0),0.0)){squareCap(offset,a,round,d,-1.0,direction);}if(!degenerate){vec4 offsets=offsetMatrix*vec4(offset,0.0,0.0);gl_Position=projPos+offsets;}else{gl_Position=vec4(offset,0.0,1.0);}}");goog.provide("ol.render.webgl.linestringreplay.defaultshader.Locations");goog.require("ol");ol.render.webgl.linestringreplay.defaultshader.Locations=function(e,t){this.u_projectionMatrix=e.getUniformLocation(t,ol.DEBUG_WEBGL?"u_projectionMatrix":"h");this.u_offsetScaleMatrix=e.getUniformLocation(t,ol.DEBUG_WEBGL?"u_offsetScaleMatrix":"i");this.u_offsetRotateMatrix=e.getUniformLocation(t,ol.DEBUG_WEBGL?"u_offsetRotateMatrix":"j");this.u_lineWidth=e.getUniformLocation(t,ol.DEBUG_WEBGL?"u_lineWidth":"k");this.u_miterLimit=e.getUniformLocation(t,ol.DEBUG_WEBGL?"u_miterLimit":"l");this.u_opacity=e.getUniformLocation(t,ol.DEBUG_WEBGL?"u_opacity":"m");this.u_color=e.getUniformLocation(t,ol.DEBUG_WEBGL?"u_color":"n");this.u_size=e.getUniformLocation(t,ol.DEBUG_WEBGL?"u_size":"o");this.u_pixelRatio=e.getUniformLocation(t,ol.DEBUG_WEBGL?"u_pixelRatio":"p");this.a_lastPos=e.getAttribLocation(t,ol.DEBUG_WEBGL?"a_lastPos":"d");this.a_position=e.getAttribLocation(t,ol.DEBUG_WEBGL?"a_position":"e");this.a_nextPos=e.getAttribLocation(t,ol.DEBUG_WEBGL?"a_nextPos":"f");this.a_direction=e.getAttribLocation(t,ol.DEBUG_WEBGL?"a_direction":"g")};goog.provide("ol.render.webgl.LineStringReplay");goog.require("ol");goog.require("ol.array");goog.require("ol.color");goog.require("ol.extent");goog.require("ol.geom.flat.orient");goog.require("ol.geom.flat.transform");goog.require("ol.geom.flat.topology");goog.require("ol.obj");goog.require("ol.render.webgl");goog.require("ol.render.webgl.Replay");goog.require("ol.render.webgl.linestringreplay.defaultshader");goog.require("ol.render.webgl.linestringreplay.defaultshader.Locations");goog.require("ol.webgl");goog.require("ol.webgl.Buffer");ol.render.webgl.LineStringReplay=function(e,t){ol.render.webgl.Replay.call(this,e,t);this.defaultLocations_=null;this.styles_=[];this.styleIndices_=[];this.state_={strokeColor:null,lineCap:void 0,lineDash:null,lineDashOffset:void 0,lineJoin:void 0,lineWidth:void 0,miterLimit:void 0,changed:!1}};ol.inherits(ol.render.webgl.LineStringReplay,ol.render.webgl.Replay);ol.render.webgl.LineStringReplay.prototype.drawCoordinates_=function(e,t,o,r){var i,n,a,l,s,p,c,u,g=this.vertices.length,d=this.indices.length,h="bevel"===this.state_.lineJoin?0:"miter"===this.state_.lineJoin?1:2,f="butt"===this.state_.lineCap?0:"square"===this.state_.lineCap?1:2,y=ol.geom.flat.topology.lineStringIsClosed(e,t,o,r),m=d,v=1;for(i=t,n=o;i<n;i+=r){s=g/7;p=c;c=u||[e[i],e[i+1]];if(i===t){u=[e[i+r],e[i+r+1]];if(o-t==2*r&&ol.array.equals(c,u))break;if(!y){if(f){g=this.addVertices_([0,0],c,u,v*ol.render.webgl.LineStringReplay.Instruction_.BEGIN_LINE_CAP*f,g);g=this.addVertices_([0,0],c,u,-v*ol.render.webgl.LineStringReplay.Instruction_.BEGIN_LINE_CAP*f,g);this.indices[d++]=s+2;this.indices[d++]=s;this.indices[d++]=s+1;this.indices[d++]=s+1;this.indices[d++]=s+3;this.indices[d++]=s+2}g=this.addVertices_([0,0],c,u,v*ol.render.webgl.LineStringReplay.Instruction_.BEGIN_LINE*(f||1),g);m=(g=this.addVertices_([0,0],c,u,-v*ol.render.webgl.LineStringReplay.Instruction_.BEGIN_LINE*(f||1),g))/7-1;continue}p=[e[o-2*r],e[o-2*r+1]];a=u}else{if(i===o-r){if(y){u=a;break}p=p||[0,0];g=this.addVertices_(p,c,[0,0],v*ol.render.webgl.LineStringReplay.Instruction_.END_LINE*(f||1),g);g=this.addVertices_(p,c,[0,0],-v*ol.render.webgl.LineStringReplay.Instruction_.END_LINE*(f||1),g);this.indices[d++]=s;this.indices[d++]=m-1;this.indices[d++]=m;this.indices[d++]=m;this.indices[d++]=s+1;this.indices[d++]=s;if(f){g=this.addVertices_(p,c,[0,0],v*ol.render.webgl.LineStringReplay.Instruction_.END_LINE_CAP*f,g);g=this.addVertices_(p,c,[0,0],-v*ol.render.webgl.LineStringReplay.Instruction_.END_LINE_CAP*f,g);this.indices[d++]=s+2;this.indices[d++]=s;this.indices[d++]=s+1;this.indices[d++]=s+1;this.indices[d++]=s+3;this.indices[d++]=s+2}break}u=[e[i+r],e[i+r+1]]}l=ol.render.webgl.triangleIsCounterClockwise(p[0],p[1],c[0],c[1],u[0],u[1])?-1:1;g=this.addVertices_(p,c,u,l*ol.render.webgl.LineStringReplay.Instruction_.BEVEL_FIRST*(h||1),g);g=this.addVertices_(p,c,u,l*ol.render.webgl.LineStringReplay.Instruction_.BEVEL_SECOND*(h||1),g);g=this.addVertices_(p,c,u,-l*ol.render.webgl.LineStringReplay.Instruction_.MITER_BOTTOM*(h||1),g);if(i>t){this.indices[d++]=s;this.indices[d++]=m-1;this.indices[d++]=m;this.indices[d++]=s+2;this.indices[d++]=s;this.indices[d++]=v*l>0?m:m-1}this.indices[d++]=s;this.indices[d++]=s+2;this.indices[d++]=s+1;m=s+2;v=l;if(h){g=this.addVertices_(p,c,u,l*ol.render.webgl.LineStringReplay.Instruction_.MITER_TOP*h,g);this.indices[d++]=s+1;this.indices[d++]=s+3;this.indices[d++]=s}}if(y){s=s||g/7;l=ol.geom.flat.orient.linearRingIsClockwise([p[0],p[1],c[0],c[1],u[0],u[1]],0,6,2)?1:-1;g=this.addVertices_(p,c,u,l*ol.render.webgl.LineStringReplay.Instruction_.BEVEL_FIRST*(h||1),g);g=this.addVertices_(p,c,u,-l*ol.render.webgl.LineStringReplay.Instruction_.MITER_BOTTOM*(h||1),g);this.indices[d++]=s;this.indices[d++]=m-1;this.indices[d++]=m;this.indices[d++]=s+1;this.indices[d++]=s;this.indices[d++]=v*l>0?m:m-1}};ol.render.webgl.LineStringReplay.prototype.addVertices_=function(e,t,o,r,i){this.vertices[i++]=e[0];this.vertices[i++]=e[1];this.vertices[i++]=t[0];this.vertices[i++]=t[1];this.vertices[i++]=o[0];this.vertices[i++]=o[1];this.vertices[i++]=r;return i};ol.render.webgl.LineStringReplay.prototype.isValid_=function(e,t,o,r){var i=o-t;if(i<2*r)return!1;if(i===2*r){var n=[e[t],e[t+1]],a=[e[t+r],e[t+r+1]];return!ol.array.equals(n,a)}return!0};ol.render.webgl.LineStringReplay.prototype.drawLineString=function(e,t){var o=e.getFlatCoordinates(),r=e.getStride();if(this.isValid_(o,0,o.length,r)){o=ol.geom.flat.transform.translate(o,0,o.length,r,-this.origin[0],-this.origin[1]);if(this.state_.changed){this.styleIndices_.push(this.indices.length);this.state_.changed=!1}this.startIndices.push(this.indices.length);this.startIndicesFeature.push(t);this.drawCoordinates_(o,0,o.length,r)}};ol.render.webgl.LineStringReplay.prototype.drawMultiLineString=function(e,t){var o=this.indices.length,r=e.getEnds();r.unshift(0);var i,n,a=e.getFlatCoordinates(),l=e.getStride();if(r.length>1)for(i=1,n=r.length;i<n;++i)if(this.isValid_(a,r[i-1],r[i],l)){var s=ol.geom.flat.transform.translate(a,r[i-1],r[i],l,-this.origin[0],-this.origin[1]);this.drawCoordinates_(s,0,s.length,l)}if(this.indices.length>o){this.startIndices.push(o);this.startIndicesFeature.push(t);if(this.state_.changed){this.styleIndices_.push(o);this.state_.changed=!1}}};ol.render.webgl.LineStringReplay.prototype.drawPolygonCoordinates=function(e,t,o){if(!ol.geom.flat.topology.lineStringIsClosed(e,0,e.length,o)){e.push(e[0]);e.push(e[1])}this.drawCoordinates_(e,0,e.length,o);if(t.length){var r,i;for(r=0,i=t.length;r<i;++r){if(!ol.geom.flat.topology.lineStringIsClosed(t[r],0,t[r].length,o)){t[r].push(t[r][0]);t[r].push(t[r][1])}this.drawCoordinates_(t[r],0,t[r].length,o)}}};ol.render.webgl.LineStringReplay.prototype.setPolygonStyle=function(e,t){var o=void 0===t?this.indices.length:t;this.startIndices.push(o);this.startIndicesFeature.push(e);if(this.state_.changed){this.styleIndices_.push(o);this.state_.changed=!1}};ol.render.webgl.LineStringReplay.prototype.getCurrentIndex=function(){return this.indices.length};ol.render.webgl.LineStringReplay.prototype.finish=function(e){this.verticesBuffer=new ol.webgl.Buffer(this.vertices);this.indicesBuffer=new ol.webgl.Buffer(this.indices);this.startIndices.push(this.indices.length);0===this.styleIndices_.length&&this.styles_.length>0&&(this.styles_=[]);this.vertices=null;this.indices=null};ol.render.webgl.LineStringReplay.prototype.getDeleteResourcesFunction=function(e){var t=this.verticesBuffer,o=this.indicesBuffer;return function(){e.deleteBuffer(t);e.deleteBuffer(o)}};ol.render.webgl.LineStringReplay.prototype.setUpProgram=function(e,t,o,r){var i,n;i=ol.render.webgl.linestringreplay.defaultshader.fragment;n=ol.render.webgl.linestringreplay.defaultshader.vertex;var a,l=t.getProgram(i,n);if(this.defaultLocations_)a=this.defaultLocations_;else{a=new ol.render.webgl.linestringreplay.defaultshader.Locations(e,l);this.defaultLocations_=a}t.useProgram(l);e.enableVertexAttribArray(a.a_lastPos);e.vertexAttribPointer(a.a_lastPos,2,ol.webgl.FLOAT,!1,28,0);e.enableVertexAttribArray(a.a_position);e.vertexAttribPointer(a.a_position,2,ol.webgl.FLOAT,!1,28,8);e.enableVertexAttribArray(a.a_nextPos);e.vertexAttribPointer(a.a_nextPos,2,ol.webgl.FLOAT,!1,28,16);e.enableVertexAttribArray(a.a_direction);e.vertexAttribPointer(a.a_direction,1,ol.webgl.FLOAT,!1,28,24);e.uniform2fv(a.u_size,o);e.uniform1f(a.u_pixelRatio,r);return a};ol.render.webgl.LineStringReplay.prototype.shutDownProgram=function(e,t){e.disableVertexAttribArray(t.a_lastPos);e.disableVertexAttribArray(t.a_position);e.disableVertexAttribArray(t.a_nextPos);e.disableVertexAttribArray(t.a_direction)};ol.render.webgl.LineStringReplay.prototype.drawReplay=function(e,t,o,r){var i=e.getParameter(e.DEPTH_FUNC),n=e.getParameter(e.DEPTH_WRITEMASK);if(!r){e.enable(e.DEPTH_TEST);e.depthMask(!0);e.depthFunc(e.NOTEQUAL)}if(ol.obj.isEmpty(o)){var a,l,s,p;s=this.startIndices[this.startIndices.length-1];for(a=this.styleIndices_.length-1;a>=0;--a){l=this.styleIndices_[a];p=this.styles_[a];this.setStrokeStyle_(e,p[0],p[1],p[2]);this.drawElements(e,t,l,s);e.clear(e.DEPTH_BUFFER_BIT);s=l}}else this.drawReplaySkipping_(e,t,o);if(!r){e.disable(e.DEPTH_TEST);e.clear(e.DEPTH_BUFFER_BIT);e.depthMask(n);e.depthFunc(i)}};ol.render.webgl.LineStringReplay.prototype.drawReplaySkipping_=function(e,t,o){var r,i,n,a,l,s,p,c;p=this.startIndices.length-2;n=i=this.startIndices[p+1];for(r=this.styleIndices_.length-1;r>=0;--r){a=this.styles_[r];this.setStrokeStyle_(e,a[0],a[1],a[2]);l=this.styleIndices_[r];for(;p>=0&&this.startIndices[p]>=l;){c=this.startIndices[p];s=this.startIndicesFeature[p];if(o[ol.getUid(s).toString()]){if(i!==n){this.drawElements(e,t,i,n);e.clear(e.DEPTH_BUFFER_BIT)}n=c}p--;i=c}if(i!==n){this.drawElements(e,t,i,n);e.clear(e.DEPTH_BUFFER_BIT)}i=n=l}};ol.render.webgl.LineStringReplay.prototype.drawHitDetectionReplayOneByOne=function(e,t,o,r,i){var n,a,l,s,p,c,u;u=this.startIndices.length-2;l=this.startIndices[u+1];for(n=this.styleIndices_.length-1;n>=0;--n){s=this.styles_[n];this.setStrokeStyle_(e,s[0],s[1],s[2]);p=this.styleIndices_[n];for(;u>=0&&this.startIndices[u]>=p;){a=this.startIndices[u];c=this.startIndicesFeature[u];if(void 0===o[ol.getUid(c).toString()]&&c.getGeometry()&&(void 0===i||ol.extent.intersects(i,c.getGeometry().getExtent()))){e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT);this.drawElements(e,t,a,l);var g=r(c);if(g)return g}u--;l=a}}};ol.render.webgl.LineStringReplay.prototype.setStrokeStyle_=function(e,t,o,r){e.uniform4fv(this.defaultLocations_.u_color,t);e.uniform1f(this.defaultLocations_.u_lineWidth,o);e.uniform1f(this.defaultLocations_.u_miterLimit,r)};ol.render.webgl.LineStringReplay.prototype.setFillStrokeStyle=function(e,t){var o=t.getLineCap();this.state_.lineCap=void 0!==o?o:ol.render.webgl.defaultLineCap;var r=t.getLineDash();this.state_.lineDash=r||ol.render.webgl.defaultLineDash;var i=t.getLineDashOffset();this.state_.lineDashOffset=i||ol.render.webgl.defaultLineDashOffset;var n=t.getLineJoin();this.state_.lineJoin=void 0!==n?n:ol.render.webgl.defaultLineJoin;var a=t.getColor();a=a instanceof CanvasGradient||a instanceof CanvasPattern?ol.render.webgl.defaultStrokeStyle:ol.color.asArray(a).map(function(e,t){return 3!=t?e/255:e})||ol.render.webgl.defaultStrokeStyle;var l=t.getWidth();l=void 0!==l?l:ol.render.webgl.defaultLineWidth;var s=t.getMiterLimit();s=void 0!==s?s:ol.render.webgl.defaultMiterLimit;if(!this.state_.strokeColor||!ol.array.equals(this.state_.strokeColor,a)||this.state_.lineWidth!==l||this.state_.miterLimit!==s){this.state_.changed=!0;this.state_.strokeColor=a;this.state_.lineWidth=l;this.state_.miterLimit=s;this.styles_.push([a,l,s])}};ol.render.webgl.LineStringReplay.Instruction_={ROUND:2,BEGIN_LINE:3,END_LINE:5,BEGIN_LINE_CAP:7,END_LINE_CAP:11,BEVEL_FIRST:13,BEVEL_SECOND:17,MITER_BOTTOM:19,MITER_TOP:23};goog.provide("ol.render.webgl.polygonreplay.defaultshader");goog.require("ol");goog.require("ol.webgl.Fragment");goog.require("ol.webgl.Vertex");ol.render.webgl.polygonreplay.defaultshader.fragment=new ol.webgl.Fragment(ol.DEBUG_WEBGL?"precision mediump float;\n\n\n\nuniform vec4 u_color;\nuniform float u_opacity;\n\nvoid main(void) {\n  gl_FragColor = u_color;\n  float alpha = u_color.a * u_opacity;\n  if (alpha == 0.0) {\n    discard;\n  }\n  gl_FragColor.a = alpha;\n}\n":"precision mediump float;uniform vec4 e;uniform float f;void main(void){gl_FragColor=e;float alpha=e.a*f;if(alpha==0.0){discard;}gl_FragColor.a=alpha;}");ol.render.webgl.polygonreplay.defaultshader.vertex=new ol.webgl.Vertex(ol.DEBUG_WEBGL?"\n\nattribute vec2 a_position;\n\nuniform mat4 u_projectionMatrix;\nuniform mat4 u_offsetScaleMatrix;\nuniform mat4 u_offsetRotateMatrix;\n\nvoid main(void) {\n  gl_Position = u_projectionMatrix * vec4(a_position, 0.0, 1.0);\n}\n\n\n":"attribute vec2 a;uniform mat4 b;uniform mat4 c;uniform mat4 d;void main(void){gl_Position=b*vec4(a,0.0,1.0);}");goog.provide("ol.render.webgl.polygonreplay.defaultshader.Locations");goog.require("ol");ol.render.webgl.polygonreplay.defaultshader.Locations=function(e,t){this.u_projectionMatrix=e.getUniformLocation(t,ol.DEBUG_WEBGL?"u_projectionMatrix":"b");this.u_offsetScaleMatrix=e.getUniformLocation(t,ol.DEBUG_WEBGL?"u_offsetScaleMatrix":"c");this.u_offsetRotateMatrix=e.getUniformLocation(t,ol.DEBUG_WEBGL?"u_offsetRotateMatrix":"d");this.u_color=e.getUniformLocation(t,ol.DEBUG_WEBGL?"u_color":"e");this.u_opacity=e.getUniformLocation(t,ol.DEBUG_WEBGL?"u_opacity":"f");this.a_position=e.getAttribLocation(t,ol.DEBUG_WEBGL?"a_position":"a")};goog.provide("ol.structs.LinkedList");ol.structs.LinkedList=function(e){this.first_=void 0;this.last_=void 0;this.head_=void 0;this.circular_=void 0===e||e;this.length_=0};ol.structs.LinkedList.prototype.insertItem=function(e){var t={prev:void 0,next:void 0,data:e},o=this.head_;if(o){var r=o.next;t.prev=o;t.next=r;o.next=t;r&&(r.prev=t);o===this.last_&&(this.last_=t)}else{this.first_=t;this.last_=t;if(this.circular_){t.next=t;t.prev=t}}this.head_=t;this.length_++};ol.structs.LinkedList.prototype.removeItem=function(){var e=this.head_;if(e){var t=e.next,o=e.prev;t&&(t.prev=o);o&&(o.next=t);this.head_=t||o;if(this.first_===this.last_){this.head_=void 0;this.first_=void 0;this.last_=void 0}else this.first_===e?this.first_=this.head_:this.last_===e&&(this.last_=o?this.head_.prev:this.head_);this.length_--}};ol.structs.LinkedList.prototype.firstItem=function(){this.head_=this.first_;if(this.head_)return this.head_.data};ol.structs.LinkedList.prototype.lastItem=function(){this.head_=this.last_;if(this.head_)return this.head_.data};ol.structs.LinkedList.prototype.nextItem=function(){if(this.head_&&this.head_.next){this.head_=this.head_.next;return this.head_.data}};ol.structs.LinkedList.prototype.getNextItem=function(){if(this.head_&&this.head_.next)return this.head_.next.data};ol.structs.LinkedList.prototype.prevItem=function(){if(this.head_&&this.head_.prev){this.head_=this.head_.prev;return this.head_.data}};ol.structs.LinkedList.prototype.getPrevItem=function(){if(this.head_&&this.head_.prev)return this.head_.prev.data};ol.structs.LinkedList.prototype.getCurrItem=function(){if(this.head_)return this.head_.data};ol.structs.LinkedList.prototype.setFirstItem=function(){if(this.circular_&&this.head_){this.first_=this.head_;this.last_=this.head_.prev}};ol.structs.LinkedList.prototype.concat=function(e){if(e.head_){if(this.head_){var t=this.head_.next;this.head_.next=e.first_;e.first_.prev=this.head_;t.prev=e.last_;e.last_.next=t;this.length_+=e.length_}else{this.head_=e.head_;this.first_=e.first_;this.last_=e.last_;this.length_=e.length_}e.head_=void 0;e.first_=void 0;e.last_=void 0;e.length_=0}};ol.structs.LinkedList.prototype.getLength=function(){return this.length_};goog.provide("ol.render.webgl.PolygonReplay");goog.require("ol");goog.require("ol.array");goog.require("ol.color");goog.require("ol.extent");goog.require("ol.obj");goog.require("ol.geom.flat.contains");goog.require("ol.geom.flat.orient");goog.require("ol.geom.flat.transform");goog.require("ol.render.webgl.polygonreplay.defaultshader");goog.require("ol.render.webgl.polygonreplay.defaultshader.Locations");goog.require("ol.render.webgl.LineStringReplay");goog.require("ol.render.webgl.Replay");goog.require("ol.render.webgl");goog.require("ol.style.Stroke");goog.require("ol.structs.LinkedList");goog.require("ol.structs.RBush");goog.require("ol.webgl");goog.require("ol.webgl.Buffer");ol.render.webgl.PolygonReplay=function(e,t){ol.render.webgl.Replay.call(this,e,t);this.lineStringReplay=new ol.render.webgl.LineStringReplay(e,t);this.defaultLocations_=null;this.styles_=[];this.styleIndices_=[];this.state_={fillColor:null,changed:!1}};ol.inherits(ol.render.webgl.PolygonReplay,ol.render.webgl.Replay);ol.render.webgl.PolygonReplay.prototype.drawCoordinates_=function(e,t,o){var r=new ol.structs.LinkedList,i=new ol.structs.RBush;this.processFlatCoordinates_(e,o,r,i,!0);var n=this.getMaxCoords_(r);if(t.length){var a,l,s=[];for(a=0,l=t.length;a<l;++a){var p={list:new ol.structs.LinkedList,maxCoords:void 0,rtree:new ol.structs.RBush};s.push(p);this.processFlatCoordinates_(t[a],o,p.list,p.rtree,!1);this.classifyPoints_(p.list,p.rtree,!0);p.maxCoords=this.getMaxCoords_(p.list)}s.sort(function(e,t){return t.maxCoords[0]===e.maxCoords[0]?e.maxCoords[1]-t.maxCoords[1]:t.maxCoords[0]-e.maxCoords[0]});for(a=0;a<s.length;++a){var c,u=s[a].list,g=u.firstItem(),d=g;do{if(this.getIntersections_(d,i).length){c=!0;break}d=u.nextItem()}while(g!==d);if(!c&&this.bridgeHole_(u,s[a].maxCoords[0],r,n[0],i)){i.concat(s[a].rtree);this.classifyPoints_(r,i,!1)}}}else this.classifyPoints_(r,i,!1);this.triangulate_(r,i)};ol.render.webgl.PolygonReplay.prototype.processFlatCoordinates_=function(e,t,o,r,i){var n,a,l,s,p,c=ol.geom.flat.orient.linearRingIsClockwise(e,0,e.length,t),u=this.vertices.length/2,g=[],d=[];if(i===c){s=l=this.createPoint_(e[0],e[1],u++);for(n=t,a=e.length;n<a;n+=t){p=this.createPoint_(e[n],e[n+1],u++);d.push(this.insertItem_(s,p,o));g.push([Math.min(s.x,p.x),Math.min(s.y,p.y),Math.max(s.x,p.x),Math.max(s.y,p.y)]);s=p}d.push(this.insertItem_(p,l,o));g.push([Math.min(s.x,p.x),Math.min(s.y,p.y),Math.max(s.x,p.x),Math.max(s.y,p.y)])}else{var h=e.length-t;s=l=this.createPoint_(e[h],e[h+1],u++);for(n=h-t,a=0;n>=a;n-=t){p=this.createPoint_(e[n],e[n+1],u++);d.push(this.insertItem_(s,p,o));g.push([Math.min(s.x,p.x),Math.min(s.y,p.y),Math.max(s.x,p.x),Math.max(s.y,p.y)]);s=p}d.push(this.insertItem_(p,l,o));g.push([Math.min(s.x,p.x),Math.min(s.y,p.y),Math.max(s.x,p.x),Math.max(s.y,p.y)])}r.load(g,d)};ol.render.webgl.PolygonReplay.prototype.getMaxCoords_=function(e){var t=e.firstItem(),o=t,r=[o.p0.x,o.p0.y];do{(o=e.nextItem()).p0.x>r[0]&&(r=[o.p0.x,o.p0.y])}while(o!==t);return r};ol.render.webgl.PolygonReplay.prototype.classifyPoints_=function(e,t,o){var r=e.firstItem(),i=r,n=e.nextItem(),a=!1;do{var l=o?ol.render.webgl.triangleIsCounterClockwise(n.p1.x,n.p1.y,i.p1.x,i.p1.y,i.p0.x,i.p0.y):ol.render.webgl.triangleIsCounterClockwise(i.p0.x,i.p0.y,i.p1.x,i.p1.y,n.p1.x,n.p1.y);if(void 0===l){this.removeItem_(i,n,e,t);a=!0;n===r&&(r=e.getNextItem());n=i;e.prevItem()}else if(i.p1.reflex!==l){i.p1.reflex=l;a=!0}i=n;n=e.nextItem()}while(i!==r);return a};ol.render.webgl.PolygonReplay.prototype.bridgeHole_=function(e,t,o,r,i){for(var n=e.firstItem();n.p1.x!==t;)n=e.nextItem();var a,l,s,p,c=n.p1,u={x:r,y:c.y,i:-1},g=1/0,d=this.getIntersections_({p0:c,p1:u},i,!0);for(a=0,l=d.length;a<l;++a){var h=d[a],f=this.calculateIntersection_(c,u,h.p0,h.p1,!0),y=Math.abs(c.x-f[0]);if(y<g&&void 0!==ol.render.webgl.triangleIsCounterClockwise(c.x,c.y,h.p0.x,h.p0.y,h.p1.x,h.p1.y)){g=y;p={x:f[0],y:f[1],i:-1};n=h}}if(g===1/0)return!1;s=n.p1;if(g>0){var m=this.getPointsInTriangle_(c,p,n.p1,i);if(m.length){var v=1/0;for(a=0,l=m.length;a<l;++a){var C=m[a],T=Math.atan2(c.y-C.y,u.x-C.x);if(T<v||T===v&&C.x<s.x){v=T;s=C}}}}n=o.firstItem();for(;n.p1.x!==s.x||n.p1.y!==s.y;)n=o.nextItem();var S={x:c.x,y:c.y,i:c.i,reflex:void 0},_={x:n.p1.x,y:n.p1.y,i:n.p1.i,reflex:void 0};e.getNextItem().p0=S;this.insertItem_(c,n.p1,e,i);this.insertItem_(_,S,e,i);n.p1=_;e.setFirstItem();o.concat(e);return!0};ol.render.webgl.PolygonReplay.prototype.triangulate_=function(e,t){for(var o=!1,r=this.isSimple_(e,t);e.getLength()>3;)if(r){if(!this.clipEars_(e,t,r,o)&&!this.classifyPoints_(e,t,o)&&!this.resolveSelfIntersections_(e,t,!0))break}else if(!this.clipEars_(e,t,r,o)&&!this.classifyPoints_(e,t,o)&&!this.resolveSelfIntersections_(e,t)){if(!(r=this.isSimple_(e,t))){this.splitPolygon_(e,t);break}o=!this.isClockwise_(e);this.classifyPoints_(e,t,o)}if(3===e.getLength()){var i=this.indices.length;this.indices[i++]=e.getPrevItem().p0.i;this.indices[i++]=e.getCurrItem().p0.i;this.indices[i++]=e.getNextItem().p0.i}};ol.render.webgl.PolygonReplay.prototype.clipEars_=function(e,t,o,r){var i,n,a,l=this.indices.length,s=e.firstItem(),p=e.getPrevItem(),c=s,u=e.nextItem(),g=e.getNextItem(),d=!1;do{i=c.p0;n=c.p1;a=u.p1;if(!1===n.reflex){var h;h=o?0===this.getPointsInTriangle_(i,n,a,t,!0).length:r?this.diagonalIsInside_(g.p1,a,n,i,p.p0):this.diagonalIsInside_(p.p0,i,n,a,g.p1);if((o||0===this.getIntersections_({p0:i,p1:a},t).length)&&h&&(o||!1===i.reflex||!1===a.reflex||ol.geom.flat.orient.linearRingIsClockwise([p.p0.x,p.p0.y,i.x,i.y,n.x,n.y,a.x,a.y,g.p1.x,g.p1.y],0,10,2)===!r)){this.indices[l++]=i.i;this.indices[l++]=n.i;this.indices[l++]=a.i;this.removeItem_(c,u,e,t);u===s&&(s=g);d=!0}}p=e.getPrevItem();c=e.getCurrItem();u=e.nextItem();g=e.getNextItem()}while(c!==s&&e.getLength()>3);return d};ol.render.webgl.PolygonReplay.prototype.resolveSelfIntersections_=function(e,t,o){var r=e.firstItem();e.nextItem();var i=r,n=e.nextItem(),a=!1;do{var l=this.calculateIntersection_(i.p0,i.p1,n.p0,n.p1,o);if(l){var s,p=!1,c=this.vertices.length,u=this.indices.length,g=c/2,d=e.prevItem();e.removeItem();t.remove(d);p=d===r;if(o){if(l[0]===i.p0.x&&l[1]===i.p0.y){e.prevItem();s=i.p0;n.p0=s;t.remove(i);p=p||i===r}else{s=n.p1;i.p1=s;t.remove(n);p=p||n===r}e.removeItem()}else{s=this.createPoint_(l[0],l[1],g);i.p1=s;n.p0=s;t.update([Math.min(i.p0.x,i.p1.x),Math.min(i.p0.y,i.p1.y),Math.max(i.p0.x,i.p1.x),Math.max(i.p0.y,i.p1.y)],i);t.update([Math.min(n.p0.x,n.p1.x),Math.min(n.p0.y,n.p1.y),Math.max(n.p0.x,n.p1.x),Math.max(n.p0.y,n.p1.y)],n)}this.indices[u++]=d.p0.i;this.indices[u++]=d.p1.i;this.indices[u++]=s.i;a=!0;if(p)break}i=e.getPrevItem();n=e.nextItem()}while(i!==r);return a};ol.render.webgl.PolygonReplay.prototype.isSimple_=function(e,t){var o=e.firstItem(),r=o;do{if(this.getIntersections_(r,t).length)return!1;r=e.nextItem()}while(r!==o);return!0};ol.render.webgl.PolygonReplay.prototype.isClockwise_=function(e){var t=2*e.getLength(),o=new Array(t),r=e.firstItem(),i=r,n=0;do{o[n++]=i.p0.x;o[n++]=i.p0.y;i=e.nextItem()}while(i!==r);return ol.geom.flat.orient.linearRingIsClockwise(o,0,t,2)};ol.render.webgl.PolygonReplay.prototype.splitPolygon_=function(e,t){var o=e.firstItem(),r=o;do{var i=this.getIntersections_(r,t);if(i.length){var n=i[0],a=this.vertices.length/2,l=this.calculateIntersection_(r.p0,r.p1,n.p0,n.p1),s=this.createPoint_(l[0],l[1],a),p=new ol.structs.LinkedList,c=new ol.structs.RBush;this.insertItem_(s,r.p1,p,c);r.p1=s;t.update([Math.min(r.p0.x,s.x),Math.min(r.p0.y,s.y),Math.max(r.p0.x,s.x),Math.max(r.p0.y,s.y)],r);for(var u=e.nextItem();u!==n;){this.insertItem_(u.p0,u.p1,p,c);t.remove(u);e.removeItem();u=e.getCurrItem()}this.insertItem_(n.p0,s,p,c);n.p0=s;t.update([Math.min(n.p1.x,s.x),Math.min(n.p1.y,s.y),Math.max(n.p1.x,s.x),Math.max(n.p1.y,s.y)],n);this.classifyPoints_(e,t,!1);this.triangulate_(e,t);this.classifyPoints_(p,c,!1);this.triangulate_(p,c);break}r=e.nextItem()}while(r!==o)};ol.render.webgl.PolygonReplay.prototype.createPoint_=function(e,t,o){var r=this.vertices.length;this.vertices[r++]=e;this.vertices[r++]=t;return{x:e,y:t,i:o,reflex:void 0}};ol.render.webgl.PolygonReplay.prototype.insertItem_=function(e,t,o,r){var i={p0:e,p1:t};o.insertItem(i);r&&r.insert([Math.min(e.x,t.x),Math.min(e.y,t.y),Math.max(e.x,t.x),Math.max(e.y,t.y)],i);return i};ol.render.webgl.PolygonReplay.prototype.removeItem_=function(e,t,o,r){if(o.getCurrItem()===t){o.removeItem();e.p1=t.p1;r.remove(t);r.update([Math.min(e.p0.x,e.p1.x),Math.min(e.p0.y,e.p1.y),Math.max(e.p0.x,e.p1.x),Math.max(e.p0.y,e.p1.y)],e)}};ol.render.webgl.PolygonReplay.prototype.getPointsInTriangle_=function(e,t,o,r,i){var n,a,l,s,p=[],c=r.getInExtent([Math.min(e.x,t.x,o.x),Math.min(e.y,t.y,o.y),Math.max(e.x,t.x,o.x),Math.max(e.y,t.y,o.y)]);for(n=0,a=c.length;n<a;++n)for(l in c[n])"object"!=typeof(s=c[n][l])||i&&!s.reflex||s.x===e.x&&s.y===e.y||s.x===t.x&&s.y===t.y||s.x===o.x&&s.y===o.y||-1!==p.indexOf(s)||!ol.geom.flat.contains.linearRingContainsXY([e.x,e.y,t.x,t.y,o.x,o.y],0,6,2,s.x,s.y)||p.push(s);return p};ol.render.webgl.PolygonReplay.prototype.getIntersections_=function(e,t,o){var r,i,n=e.p0,a=e.p1,l=t.getInExtent([Math.min(n.x,a.x),Math.min(n.y,a.y),Math.max(n.x,a.x),Math.max(n.y,a.y)]),s=[];for(r=0,i=l.length;r<i;++r){var p=l[r];e!==p&&(o||p.p0!==a||p.p1!==n)&&this.calculateIntersection_(n,a,p.p0,p.p1,o)&&s.push(p)}return s};ol.render.webgl.PolygonReplay.prototype.calculateIntersection_=function(e,t,o,r,i){var n=(r.y-o.y)*(t.x-e.x)-(r.x-o.x)*(t.y-e.y);if(0!==n){var a=((r.x-o.x)*(e.y-o.y)-(r.y-o.y)*(e.x-o.x))/n,l=((t.x-e.x)*(e.y-o.y)-(t.y-e.y)*(e.x-o.x))/n;if(!i&&a>ol.render.webgl.EPSILON&&a<1-ol.render.webgl.EPSILON&&l>ol.render.webgl.EPSILON&&l<1-ol.render.webgl.EPSILON||i&&a>=0&&a<=1&&l>=0&&l<=1)return[e.x+a*(t.x-e.x),e.y+a*(t.y-e.y)]}};ol.render.webgl.PolygonReplay.prototype.diagonalIsInside_=function(e,t,o,r,i){if(void 0===t.reflex||void 0===r.reflex)return!1;var n=(o.x-r.x)*(t.y-r.y)>(o.y-r.y)*(t.x-r.x),a=(i.x-r.x)*(t.y-r.y)<(i.y-r.y)*(t.x-r.x),l=(e.x-t.x)*(r.y-t.y)>(e.y-t.y)*(r.x-t.x),s=(o.x-t.x)*(r.y-t.y)<(o.y-t.y)*(r.x-t.x),p=r.reflex?a||n:a&&n,c=t.reflex?s||l:s&&l;return p&&c};ol.render.webgl.PolygonReplay.prototype.drawMultiPolygon=function(e,t){var o,r,i,n,a=e.getEndss(),l=e.getStride(),s=this.indices.length,p=this.lineStringReplay.getCurrentIndex(),c=e.getFlatCoordinates(),u=0;for(o=0,r=a.length;o<r;++o){var g=a[o];if(g.length>0){var d=ol.geom.flat.transform.translate(c,u,g[0],l,-this.origin[0],-this.origin[1]);if(d.length){var h,f=[];for(i=1,n=g.length;i<n;++i)if(g[i]!==g[i-1]){h=ol.geom.flat.transform.translate(c,g[i-1],g[i],l,-this.origin[0],-this.origin[1]);f.push(h)}this.lineStringReplay.drawPolygonCoordinates(d,f,l);this.drawCoordinates_(d,f,l)}}u=g[g.length-1]}if(this.indices.length>s){this.startIndices.push(s);this.startIndicesFeature.push(t);if(this.state_.changed){this.styleIndices_.push(s);this.state_.changed=!1}}this.lineStringReplay.getCurrentIndex()>p&&this.lineStringReplay.setPolygonStyle(t,p)};ol.render.webgl.PolygonReplay.prototype.drawPolygon=function(e,t){var o=e.getEnds(),r=e.getStride();if(o.length>0){var i=e.getFlatCoordinates().map(Number),n=ol.geom.flat.transform.translate(i,0,o[0],r,-this.origin[0],-this.origin[1]);if(n.length){var a,l,s,p=[];for(a=1,l=o.length;a<l;++a)if(o[a]!==o[a-1]){s=ol.geom.flat.transform.translate(i,o[a-1],o[a],r,-this.origin[0],-this.origin[1]);p.push(s)}this.startIndices.push(this.indices.length);this.startIndicesFeature.push(t);if(this.state_.changed){this.styleIndices_.push(this.indices.length);this.state_.changed=!1}this.lineStringReplay.setPolygonStyle(t);this.lineStringReplay.drawPolygonCoordinates(n,p,r);this.drawCoordinates_(n,p,r)}}};ol.render.webgl.PolygonReplay.prototype.finish=function(e){this.verticesBuffer=new ol.webgl.Buffer(this.vertices);this.indicesBuffer=new ol.webgl.Buffer(this.indices);this.startIndices.push(this.indices.length);this.lineStringReplay.finish(e);0===this.styleIndices_.length&&this.styles_.length>0&&(this.styles_=[]);this.vertices=null;this.indices=null};ol.render.webgl.PolygonReplay.prototype.getDeleteResourcesFunction=function(e){var t=this.verticesBuffer,o=this.indicesBuffer,r=this.lineStringReplay.getDeleteResourcesFunction(e);return function(){e.deleteBuffer(t);e.deleteBuffer(o);r()}};ol.render.webgl.PolygonReplay.prototype.setUpProgram=function(e,t,o,r){var i,n;i=ol.render.webgl.polygonreplay.defaultshader.fragment;n=ol.render.webgl.polygonreplay.defaultshader.vertex;var a,l=t.getProgram(i,n);if(this.defaultLocations_)a=this.defaultLocations_;else{a=new ol.render.webgl.polygonreplay.defaultshader.Locations(e,l);this.defaultLocations_=a}t.useProgram(l);e.enableVertexAttribArray(a.a_position);e.vertexAttribPointer(a.a_position,2,ol.webgl.FLOAT,!1,8,0);return a};ol.render.webgl.PolygonReplay.prototype.shutDownProgram=function(e,t){e.disableVertexAttribArray(t.a_position)};ol.render.webgl.PolygonReplay.prototype.drawReplay=function(e,t,o,r){var i=e.getParameter(e.DEPTH_FUNC),n=e.getParameter(e.DEPTH_WRITEMASK);if(!r){e.enable(e.DEPTH_TEST);e.depthMask(!0);e.depthFunc(e.NOTEQUAL)}if(ol.obj.isEmpty(o)){var a,l,s,p;s=this.startIndices[this.startIndices.length-1];for(a=this.styleIndices_.length-1;a>=0;--a){l=this.styleIndices_[a];p=this.styles_[a];this.setFillStyle_(e,p);this.drawElements(e,t,l,s);s=l}}else this.drawReplaySkipping_(e,t,o);if(!r){e.disable(e.DEPTH_TEST);e.clear(e.DEPTH_BUFFER_BIT);e.depthMask(n);e.depthFunc(i)}};ol.render.webgl.PolygonReplay.prototype.drawHitDetectionReplayOneByOne=function(e,t,o,r,i){var n,a,l,s,p,c,u;u=this.startIndices.length-2;l=this.startIndices[u+1];for(n=this.styleIndices_.length-1;n>=0;--n){s=this.styles_[n];this.setFillStyle_(e,s);p=this.styleIndices_[n];for(;u>=0&&this.startIndices[u]>=p;){a=this.startIndices[u];c=this.startIndicesFeature[u];if(void 0===o[ol.getUid(c).toString()]&&c.getGeometry()&&(void 0===i||ol.extent.intersects(i,c.getGeometry().getExtent()))){e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT);this.drawElements(e,t,a,l);var g=r(c);if(g)return g}u--;l=a}}};ol.render.webgl.PolygonReplay.prototype.drawReplaySkipping_=function(e,t,o){var r,i,n,a,l,s,p,c;p=this.startIndices.length-2;n=i=this.startIndices[p+1];for(r=this.styleIndices_.length-1;r>=0;--r){a=this.styles_[r];this.setFillStyle_(e,a);l=this.styleIndices_[r];for(;p>=0&&this.startIndices[p]>=l;){c=this.startIndices[p];s=this.startIndicesFeature[p];if(o[ol.getUid(s).toString()]){if(i!==n){this.drawElements(e,t,i,n);e.clear(e.DEPTH_BUFFER_BIT)}n=c}p--;i=c}if(i!==n){this.drawElements(e,t,i,n);e.clear(e.DEPTH_BUFFER_BIT)}i=n=l}};ol.render.webgl.PolygonReplay.prototype.setFillStyle_=function(e,t){e.uniform4fv(this.defaultLocations_.u_color,t)};ol.render.webgl.PolygonReplay.prototype.setFillStrokeStyle=function(e,t){var o=e?e.getColor():[0,0,0,0];o=o instanceof CanvasGradient||o instanceof CanvasPattern?ol.render.webgl.defaultFillStyle:ol.color.asArray(o).map(function(e,t){return 3!=t?e/255:e})||ol.render.webgl.defaultFillStyle;if(!this.state_.fillColor||!ol.array.equals(o,this.state_.fillColor)){this.state_.fillColor=o;this.state_.changed=!0;this.styles_.push(o)}if(t)this.lineStringReplay.setFillStrokeStyle(null,t);else{var r=new ol.style.Stroke({color:[0,0,0,0],lineWidth:0});this.lineStringReplay.setFillStrokeStyle(null,r)}};goog.provide("ol.style.Atlas");goog.require("ol.dom");ol.style.Atlas=function(e,t){this.space_=t;this.emptyBlocks_=[{x:0,y:0,width:e,height:e}];this.entries_={};this.context_=ol.dom.createCanvasContext2D(e,e);this.canvas_=this.context_.canvas};ol.style.Atlas.prototype.get=function(e){return this.entries_[e]||null};ol.style.Atlas.prototype.add=function(e,t,o,r,i){var n,a,l;for(a=0,l=this.emptyBlocks_.length;a<l;++a)if((n=this.emptyBlocks_[a]).width>=t+this.space_&&n.height>=o+this.space_){var s={offsetX:n.x+this.space_,offsetY:n.y+this.space_,image:this.canvas_};this.entries_[e]=s;r.call(i,this.context_,n.x+this.space_,n.y+this.space_);this.split_(a,n,t+this.space_,o+this.space_);return s}return null};ol.style.Atlas.prototype.split_=function(e,t,o,r){var i,n;if(t.width-o>t.height-r){i={x:t.x+o,y:t.y,width:t.width-o,height:t.height};n={x:t.x,y:t.y+r,width:o,height:t.height-r};this.updateBlocks_(e,i,n)}else{i={x:t.x+o,y:t.y,width:t.width-o,height:r};n={x:t.x,y:t.y+r,width:t.width,height:t.height-r};this.updateBlocks_(e,i,n)}};ol.style.Atlas.prototype.updateBlocks_=function(e,t,o){var r=[e,1];t.width>0&&t.height>0&&r.push(t);o.width>0&&o.height>0&&r.push(o);this.emptyBlocks_.splice.apply(this.emptyBlocks_,r)};goog.provide("ol.style.AtlasManager");goog.require("ol");goog.require("ol.style.Atlas");ol.style.AtlasManager=function(e){var t=e||{};this.currentSize_=void 0!==t.initialSize?t.initialSize:ol.INITIAL_ATLAS_SIZE;this.maxSize_=void 0!==t.maxSize?t.maxSize:-1!=ol.MAX_ATLAS_SIZE?ol.MAX_ATLAS_SIZE:void 0!==ol.WEBGL_MAX_TEXTURE_SIZE?ol.WEBGL_MAX_TEXTURE_SIZE:2048;this.space_=void 0!==t.space?t.space:1;this.atlases_=[new ol.style.Atlas(this.currentSize_,this.space_)];this.currentHitSize_=this.currentSize_;this.hitAtlases_=[new ol.style.Atlas(this.currentHitSize_,this.space_)]};ol.style.AtlasManager.prototype.getInfo=function(e){var t=this.getInfo_(this.atlases_,e);if(!t)return null;var o=this.getInfo_(this.hitAtlases_,e);return this.mergeInfos_(t,o)};ol.style.AtlasManager.prototype.getInfo_=function(e,t){var o,r,i;for(r=0,i=e.length;r<i;++r)if(o=e[r].get(t))return o;return null};ol.style.AtlasManager.prototype.mergeInfos_=function(e,t){return{offsetX:e.offsetX,offsetY:e.offsetY,image:e.image,hitImage:t.image}};ol.style.AtlasManager.prototype.add=function(e,t,o,r,i,n){if(t+this.space_>this.maxSize_||o+this.space_>this.maxSize_)return null;var a=this.add_(!1,e,t,o,r,n);if(!a)return null;var l=void 0!==i?i:ol.nullFunction,s=this.add_(!0,e,t,o,l,n);return this.mergeInfos_(a,s)};ol.style.AtlasManager.prototype.add_=function(e,t,o,r,i,n){var a,l,s,p,c=e?this.hitAtlases_:this.atlases_;for(s=0,p=c.length;s<p;++s){if(l=(a=c[s]).add(t,o,r,i,n))return l;if(!l&&s===p-1){var u;if(e){u=Math.min(2*this.currentHitSize_,this.maxSize_);this.currentHitSize_=u}else{u=Math.min(2*this.currentSize_,this.maxSize_);this.currentSize_=u}a=new ol.style.Atlas(u,this.space_);c.push(a);++p}}return null};goog.provide("ol.render.webgl.TextReplay");goog.require("ol");goog.require("ol.colorlike");goog.require("ol.dom");goog.require("ol.geom.GeometryType");goog.require("ol.has");goog.require("ol.render.replay");goog.require("ol.render.webgl");goog.require("ol.render.webgl.TextureReplay");goog.require("ol.style.AtlasManager");goog.require("ol.webgl.Buffer");ol.render.webgl.TextReplay=function(e,t){ol.render.webgl.TextureReplay.call(this,e,t);this.images_=[];this.textures_=[];this.measureCanvas_=ol.dom.createCanvasContext2D(0,0).canvas;this.state_={strokeColor:null,lineCap:void 0,lineDash:null,lineDashOffset:void 0,lineJoin:void 0,lineWidth:0,miterLimit:void 0,fillColor:null,font:void 0,scale:void 0};this.text_="";this.textAlign_=void 0;this.textBaseline_=void 0;this.offsetX_=void 0;this.offsetY_=void 0;this.atlases_={};this.currAtlas_=void 0;this.scale=1;this.opacity=1};ol.inherits(ol.render.webgl.TextReplay,ol.render.webgl.TextureReplay);ol.render.webgl.TextReplay.prototype.drawText=function(e,t){if(this.text_){var o=null,r=2,i=2;switch(e.getType()){case ol.geom.GeometryType.POINT:case ol.geom.GeometryType.MULTI_POINT:r=(o=e.getFlatCoordinates()).length;i=e.getStride();break;case ol.geom.GeometryType.CIRCLE:o=e.getCenter();break;case ol.geom.GeometryType.LINE_STRING:o=e.getFlatMidpoint();break;case ol.geom.GeometryType.MULTI_LINE_STRING:r=(o=e.getFlatMidpoints()).length;break;case ol.geom.GeometryType.POLYGON:o=e.getFlatInteriorPoint();break;case ol.geom.GeometryType.MULTI_POLYGON:r=(o=e.getFlatInteriorPoints()).length}this.startIndices.push(this.indices.length);this.startIndicesFeature.push(t);var n,a,l,s,p,c,u,g,d=this.currAtlas_,h=this.text_.split("\n"),f=this.getTextSize_(h),y=Math.round(f[0]*this.textAlign_-this.offsetX_),m=Math.round(f[1]*this.textBaseline_-this.offsetY_),v=this.state_.lineWidth/2*this.state_.scale;for(n=0,a=h.length;n<a;++n){p=0;c=d.height*n;for(l=0,s=(u=h[n].split("")).length;l<s;++l){if(g=d.atlas.getInfo(u[l])){var C,T=g.image;this.anchorX=y-p;this.anchorY=m-c;this.originX=0===l?g.offsetX-v:g.offsetX;this.originY=g.offsetY;this.height=d.height;this.width=0===l||l===u.length-1?d.width[u[l]]+v:d.width[u[l]];this.imageHeight=T.height;this.imageWidth=T.width;if(0===this.images_.length)this.images_.push(T);else{C=this.images_[this.images_.length-1];if(ol.getUid(C)!=ol.getUid(T)){this.groupIndices.push(this.indices.length);this.images_.push(T)}}this.drawText_(o,0,r,i)}p+=this.width}}}};ol.render.webgl.TextReplay.prototype.getTextSize_=function(e){var t=this,o=this.currAtlas_,r=e.length*o.height;return[e.map(function(e){var r,i,n=0;for(r=0,i=e.length;r<i;++r){var a=e[r];o.width[a]||t.addCharToAtlas_(a);n+=o.width[a]?o.width[a]:0}return n}).reduce(function(e,t){return Math.max(e,t)}),r]};ol.render.webgl.TextReplay.prototype.drawText_=function(e,t,o,r){var i,n;for(i=t,n=o;i<n;i+=r)this.drawCoordinates(e,t,o,r)};ol.render.webgl.TextReplay.prototype.addCharToAtlas_=function(e){if(1===e.length){var t=this.currAtlas_,o=this.state_,r=this.measureCanvas_.getContext("2d");r.font=o.font;var i=Math.ceil(r.measureText(e).width*o.scale);t.atlas.add(e,i,t.height,function(t,r,i){t.font=o.font;t.fillStyle=o.fillColor;t.strokeStyle=o.strokeColor;t.lineWidth=o.lineWidth;t.lineCap=o.lineCap;t.lineJoin=o.lineJoin;t.miterLimit=o.miterLimit;t.textAlign="left";t.textBaseline="top";if(ol.has.CANVAS_LINE_DASH&&o.lineDash){t.setLineDash(o.lineDash);t.lineDashOffset=o.lineDashOffset}1!==o.scale&&t.setTransform(o.scale,0,0,o.scale,0,0);o.strokeColor&&t.strokeText(e,r,i);o.fillColor&&t.fillText(e,r,i)})&&(t.width[e]=i)}};ol.render.webgl.TextReplay.prototype.finish=function(e){var t=e.getGL();this.groupIndices.push(this.indices.length);this.hitDetectionGroupIndices=this.groupIndices;this.verticesBuffer=new ol.webgl.Buffer(this.vertices);this.indicesBuffer=new ol.webgl.Buffer(this.indices);this.createTextures(this.textures_,this.images_,{},t);this.state_={strokeColor:null,lineCap:void 0,lineDash:null,lineDashOffset:void 0,lineJoin:void 0,lineWidth:0,miterLimit:void 0,fillColor:null,font:void 0,scale:void 0};this.text_="";this.textAlign_=void 0;this.textBaseline_=void 0;this.offsetX_=void 0;this.offsetY_=void 0;this.images_=null;this.atlases_={};this.currAtlas_=void 0;ol.render.webgl.TextureReplay.prototype.finish.call(this,e)};ol.render.webgl.TextReplay.prototype.setTextStyle=function(e){var t=this.state_,o=e.getFill(),r=e.getStroke();if(e&&e.getText()&&(o||r)){if(o){var i=o.getColor();t.fillColor=ol.colorlike.asColorLike(i||ol.render.webgl.defaultFillStyle)}else t.fillColor=null;if(r){var n=r.getColor();t.strokeColor=ol.colorlike.asColorLike(n||ol.render.webgl.defaultStrokeStyle);t.lineWidth=r.getWidth()||ol.render.webgl.defaultLineWidth;t.lineCap=r.getLineCap()||ol.render.webgl.defaultLineCap;t.lineDashOffset=r.getLineDashOffset()||ol.render.webgl.defaultLineDashOffset;t.lineJoin=r.getLineJoin()||ol.render.webgl.defaultLineJoin;t.miterLimit=r.getMiterLimit()||ol.render.webgl.defaultMiterLimit;var a=r.getLineDash();t.lineDash=a?a.slice():ol.render.webgl.defaultLineDash}else{t.strokeColor=null;t.lineWidth=0}t.font=e.getFont()||ol.render.webgl.defaultFont;t.scale=e.getScale()||1;this.text_=e.getText();var l=ol.render.replay.TEXT_ALIGN[e.getTextAlign()],s=ol.render.replay.TEXT_ALIGN[e.getTextBaseline()];this.textAlign_=void 0===l?ol.render.webgl.defaultTextAlign:l;this.textBaseline_=void 0===s?ol.render.webgl.defaultTextBaseline:s;this.offsetX_=e.getOffsetX()||0;this.offsetY_=e.getOffsetY()||0;this.rotateWithView=!!e.getRotateWithView();this.rotation=e.getRotation()||0;this.currAtlas_=this.getAtlas_(t)}else this.text_=""};ol.render.webgl.TextReplay.prototype.getAtlas_=function(e){var t,o=[];for(t in e)(e[t]||0===e[t])&&(Array.isArray(e[t])?o=o.concat(e[t]):o.push(e[t]));var r=this.calculateHash_(o);if(!this.atlases_[r]){var i=this.measureCanvas_.getContext("2d");i.font=e.font;var n=Math.ceil((1.5*i.measureText("M").width+e.lineWidth/2)*e.scale);this.atlases_[r]={atlas:new ol.style.AtlasManager({space:e.lineWidth+1}),width:{},height:n}}return this.atlases_[r]};ol.render.webgl.TextReplay.prototype.calculateHash_=function(e){var t,o,r="";for(t=0,o=e.length;t<o;++t)r+=e[t];return r};ol.render.webgl.TextReplay.prototype.getTextures=function(e){return this.textures_};ol.render.webgl.TextReplay.prototype.getHitDetectionTextures=function(){return this.textures_};goog.provide("ol.render.webgl.ReplayGroup");goog.require("ol");goog.require("ol.array");goog.require("ol.extent");goog.require("ol.obj");goog.require("ol.render.replay");goog.require("ol.render.ReplayGroup");goog.require("ol.render.webgl.CircleReplay");goog.require("ol.render.webgl.ImageReplay");goog.require("ol.render.webgl.LineStringReplay");goog.require("ol.render.webgl.PolygonReplay");goog.require("ol.render.webgl.TextReplay");ol.render.webgl.ReplayGroup=function(e,t,o){ol.render.ReplayGroup.call(this);this.maxExtent_=t;this.tolerance_=e;this.renderBuffer_=o;this.replaysByZIndex_={}};ol.inherits(ol.render.webgl.ReplayGroup,ol.render.ReplayGroup);ol.render.webgl.ReplayGroup.prototype.addDeclutter=function(e,t){};ol.render.webgl.ReplayGroup.prototype.getDeleteResourcesFunction=function(e){var t,o=[];for(t in this.replaysByZIndex_){var r,i=this.replaysByZIndex_[t];for(r in i)o.push(i[r].getDeleteResourcesFunction(e))}return function(){for(var e,t=o.length,r=0;r<t;r++)e=o[r].apply(this,arguments);return e}};ol.render.webgl.ReplayGroup.prototype.finish=function(e){var t;for(t in this.replaysByZIndex_){var o,r=this.replaysByZIndex_[t];for(o in r)r[o].finish(e)}};ol.render.webgl.ReplayGroup.prototype.getReplay=function(e,t){var o=void 0!==e?e.toString():"0",r=this.replaysByZIndex_[o];if(void 0===r){r={};this.replaysByZIndex_[o]=r}var i=r[t];if(void 0===i){i=new(0,ol.render.webgl.ReplayGroup.BATCH_CONSTRUCTORS_[t])(this.tolerance_,this.maxExtent_);r[t]=i}return i};ol.render.webgl.ReplayGroup.prototype.isEmpty=function(){return ol.obj.isEmpty(this.replaysByZIndex_)};ol.render.webgl.ReplayGroup.prototype.replay=function(e,t,o,r,i,n,a,l){var s,p,c,u,g,d,h=Object.keys(this.replaysByZIndex_).map(Number);h.sort(ol.array.numberSafeCompareFunction);for(s=0,p=h.length;s<p;++s){g=this.replaysByZIndex_[h[s].toString()];for(c=0,u=ol.render.replay.ORDER.length;c<u;++c)void 0!==(d=g[ol.render.replay.ORDER[c]])&&d.replay(e,t,o,r,i,n,a,l,void 0,!1)}};ol.render.webgl.ReplayGroup.prototype.replayHitDetection_=function(e,t,o,r,i,n,a,l,s,p,c){var u,g,d,h,f,y,m=Object.keys(this.replaysByZIndex_).map(Number);m.sort(function(e,t){return t-e});for(u=0,g=m.length;u<g;++u){h=this.replaysByZIndex_[m[u].toString()];for(d=ol.render.replay.ORDER.length-1;d>=0;--d)if(void 0!==(f=h[ol.render.replay.ORDER[d]])&&(y=f.replay(e,t,o,r,i,n,a,l,s,p,c)))return y}};ol.render.webgl.ReplayGroup.prototype.forEachFeatureAtCoordinate=function(e,t,o,r,i,n,a,l,s,p){var c,u=t.getGL();u.bindFramebuffer(u.FRAMEBUFFER,t.getHitDetectionFramebuffer());void 0!==this.renderBuffer_&&(c=ol.extent.buffer(ol.extent.createOrUpdateFromCoordinate(e),r*this.renderBuffer_));return this.replayHitDetection_(t,e,r,i,ol.render.webgl.ReplayGroup.HIT_DETECTION_SIZE_,a,l,s,function(e){var t=new Uint8Array(4);u.readPixels(0,0,1,1,u.RGBA,u.UNSIGNED_BYTE,t);if(t[3]>0){var o=p(e);if(o)return o}},!0,c)};ol.render.webgl.ReplayGroup.prototype.hasFeatureAtCoordinate=function(e,t,o,r,i,n,a,l,s){var p=t.getGL();p.bindFramebuffer(p.FRAMEBUFFER,t.getHitDetectionFramebuffer());return void 0!==this.replayHitDetection_(t,e,r,i,ol.render.webgl.ReplayGroup.HIT_DETECTION_SIZE_,a,l,s,function(e){var t=new Uint8Array(4);p.readPixels(0,0,1,1,p.RGBA,p.UNSIGNED_BYTE,t);return t[3]>0},!1)};ol.render.webgl.ReplayGroup.HIT_DETECTION_SIZE_=[1,1];ol.render.webgl.ReplayGroup.BATCH_CONSTRUCTORS_={Circle:ol.render.webgl.CircleReplay,Image:ol.render.webgl.ImageReplay,LineString:ol.render.webgl.LineStringReplay,Polygon:ol.render.webgl.PolygonReplay,Text:ol.render.webgl.TextReplay};goog.provide("ol.render.webgl.Immediate");goog.require("ol");goog.require("ol.extent");goog.require("ol.geom.GeometryType");goog.require("ol.render.ReplayType");goog.require("ol.render.VectorContext");goog.require("ol.render.webgl.ReplayGroup");ol.render.webgl.Immediate=function(e,t,o,r,i,n,a){ol.render.VectorContext.call(this);this.context_=e;this.center_=t;this.extent_=n;this.pixelRatio_=a;this.size_=i;this.rotation_=r;this.resolution_=o;this.imageStyle_=null;this.fillStyle_=null;this.strokeStyle_=null;this.textStyle_=null};ol.inherits(ol.render.webgl.Immediate,ol.render.VectorContext);ol.render.webgl.Immediate.prototype.drawText_=function(e,t){var o=this.context_,r=e.getReplay(0,ol.render.ReplayType.TEXT);r.setTextStyle(this.textStyle_);r.drawText(t,null);r.finish(o);r.replay(this.context_,this.center_,this.resolution_,this.rotation_,this.size_,this.pixelRatio_,1,{},void 0,!1);r.getDeleteResourcesFunction(o)()};ol.render.webgl.Immediate.prototype.setStyle=function(e){this.setFillStrokeStyle(e.getFill(),e.getStroke());this.setImageStyle(e.getImage());this.setTextStyle(e.getText())};ol.render.webgl.Immediate.prototype.drawGeometry=function(e){switch(e.getType()){case ol.geom.GeometryType.POINT:this.drawPoint(e,null);break;case ol.geom.GeometryType.LINE_STRING:this.drawLineString(e,null);break;case ol.geom.GeometryType.POLYGON:this.drawPolygon(e,null);break;case ol.geom.GeometryType.MULTI_POINT:this.drawMultiPoint(e,null);break;case ol.geom.GeometryType.MULTI_LINE_STRING:this.drawMultiLineString(e,null);break;case ol.geom.GeometryType.MULTI_POLYGON:this.drawMultiPolygon(e,null);break;case ol.geom.GeometryType.GEOMETRY_COLLECTION:this.drawGeometryCollection(e,null);break;case ol.geom.GeometryType.CIRCLE:this.drawCircle(e,null)}};ol.render.webgl.Immediate.prototype.drawFeature=function(e,t){var o=t.getGeometryFunction()(e);if(o&&ol.extent.intersects(this.extent_,o.getExtent())){this.setStyle(t);this.drawGeometry(o)}};ol.render.webgl.Immediate.prototype.drawGeometryCollection=function(e,t){var o,r,i=e.getGeometriesArray();for(o=0,r=i.length;o<r;++o)this.drawGeometry(i[o])};ol.render.webgl.Immediate.prototype.drawPoint=function(e,t){var o=this.context_,r=new ol.render.webgl.ReplayGroup(1,this.extent_),i=r.getReplay(0,ol.render.ReplayType.IMAGE);i.setImageStyle(this.imageStyle_);i.drawPoint(e,t);i.finish(o);i.replay(this.context_,this.center_,this.resolution_,this.rotation_,this.size_,this.pixelRatio_,1,{},void 0,!1);i.getDeleteResourcesFunction(o)();this.textStyle_&&this.drawText_(r,e)};ol.render.webgl.Immediate.prototype.drawMultiPoint=function(e,t){var o=this.context_,r=new ol.render.webgl.ReplayGroup(1,this.extent_),i=r.getReplay(0,ol.render.ReplayType.IMAGE);i.setImageStyle(this.imageStyle_);i.drawMultiPoint(e,t);i.finish(o);i.replay(this.context_,this.center_,this.resolution_,this.rotation_,this.size_,this.pixelRatio_,1,{},void 0,!1);i.getDeleteResourcesFunction(o)();this.textStyle_&&this.drawText_(r,e)};ol.render.webgl.Immediate.prototype.drawLineString=function(e,t){var o=this.context_,r=new ol.render.webgl.ReplayGroup(1,this.extent_),i=r.getReplay(0,ol.render.ReplayType.LINE_STRING);i.setFillStrokeStyle(null,this.strokeStyle_);i.drawLineString(e,t);i.finish(o);i.replay(this.context_,this.center_,this.resolution_,this.rotation_,this.size_,this.pixelRatio_,1,{},void 0,!1);i.getDeleteResourcesFunction(o)();this.textStyle_&&this.drawText_(r,e)};ol.render.webgl.Immediate.prototype.drawMultiLineString=function(e,t){var o=this.context_,r=new ol.render.webgl.ReplayGroup(1,this.extent_),i=r.getReplay(0,ol.render.ReplayType.LINE_STRING);i.setFillStrokeStyle(null,this.strokeStyle_);i.drawMultiLineString(e,t);i.finish(o);i.replay(this.context_,this.center_,this.resolution_,this.rotation_,this.size_,this.pixelRatio_,1,{},void 0,!1);i.getDeleteResourcesFunction(o)();this.textStyle_&&this.drawText_(r,e)};ol.render.webgl.Immediate.prototype.drawPolygon=function(e,t){var o=this.context_,r=new ol.render.webgl.ReplayGroup(1,this.extent_),i=r.getReplay(0,ol.render.ReplayType.POLYGON);i.setFillStrokeStyle(this.fillStyle_,this.strokeStyle_);i.drawPolygon(e,t);i.finish(o);i.replay(this.context_,this.center_,this.resolution_,this.rotation_,this.size_,this.pixelRatio_,1,{},void 0,!1);i.getDeleteResourcesFunction(o)();this.textStyle_&&this.drawText_(r,e)};ol.render.webgl.Immediate.prototype.drawMultiPolygon=function(e,t){var o=this.context_,r=new ol.render.webgl.ReplayGroup(1,this.extent_),i=r.getReplay(0,ol.render.ReplayType.POLYGON);i.setFillStrokeStyle(this.fillStyle_,this.strokeStyle_);i.drawMultiPolygon(e,t);i.finish(o);i.replay(this.context_,this.center_,this.resolution_,this.rotation_,this.size_,this.pixelRatio_,1,{},void 0,!1);i.getDeleteResourcesFunction(o)();this.textStyle_&&this.drawText_(r,e)};ol.render.webgl.Immediate.prototype.drawCircle=function(e,t){var o=this.context_,r=new ol.render.webgl.ReplayGroup(1,this.extent_),i=r.getReplay(0,ol.render.ReplayType.CIRCLE);i.setFillStrokeStyle(this.fillStyle_,this.strokeStyle_);i.drawCircle(e,t);i.finish(o);i.replay(this.context_,this.center_,this.resolution_,this.rotation_,this.size_,this.pixelRatio_,1,{},void 0,!1);i.getDeleteResourcesFunction(o)();this.textStyle_&&this.drawText_(r,e)};ol.render.webgl.Immediate.prototype.setImageStyle=function(e){this.imageStyle_=e};ol.render.webgl.Immediate.prototype.setFillStrokeStyle=function(e,t){this.fillStyle_=e;this.strokeStyle_=t};ol.render.webgl.Immediate.prototype.setTextStyle=function(e){this.textStyle_=e};goog.provide("ol.renderer.webgl.defaultmapshader");goog.require("ol");goog.require("ol.webgl.Fragment");goog.require("ol.webgl.Vertex");ol.renderer.webgl.defaultmapshader.fragment=new ol.webgl.Fragment(ol.DEBUG_WEBGL?"precision mediump float;\nvarying vec2 v_texCoord;\n\n\nuniform float u_opacity;\nuniform sampler2D u_texture;\n\nvoid main(void) {\n  vec4 texColor = texture2D(u_texture, v_texCoord);\n  gl_FragColor.rgb = texColor.rgb;\n  gl_FragColor.a = texColor.a * u_opacity;\n}\n":"precision mediump float;varying vec2 a;uniform float f;uniform sampler2D g;void main(void){vec4 texColor=texture2D(g,a);gl_FragColor.rgb=texColor.rgb;gl_FragColor.a=texColor.a*f;}");ol.renderer.webgl.defaultmapshader.vertex=new ol.webgl.Vertex(ol.DEBUG_WEBGL?"varying vec2 v_texCoord;\n\n\nattribute vec2 a_position;\nattribute vec2 a_texCoord;\n\nuniform mat4 u_texCoordMatrix;\nuniform mat4 u_projectionMatrix;\n\nvoid main(void) {\n  gl_Position = u_projectionMatrix * vec4(a_position, 0., 1.);\n  v_texCoord = (u_texCoordMatrix * vec4(a_texCoord, 0., 1.)).st;\n}\n\n\n":"varying vec2 a;attribute vec2 b;attribute vec2 c;uniform mat4 d;uniform mat4 e;void main(void){gl_Position=e*vec4(b,0.,1.);a=(d*vec4(c,0.,1.)).st;}");goog.provide("ol.renderer.webgl.defaultmapshader.Locations");goog.require("ol");ol.renderer.webgl.defaultmapshader.Locations=function(e,t){this.u_texCoordMatrix=e.getUniformLocation(t,ol.DEBUG_WEBGL?"u_texCoordMatrix":"d");this.u_projectionMatrix=e.getUniformLocation(t,ol.DEBUG_WEBGL?"u_projectionMatrix":"e");this.u_opacity=e.getUniformLocation(t,ol.DEBUG_WEBGL?"u_opacity":"f");this.u_texture=e.getUniformLocation(t,ol.DEBUG_WEBGL?"u_texture":"g");this.a_position=e.getAttribLocation(t,ol.DEBUG_WEBGL?"a_position":"b");this.a_texCoord=e.getAttribLocation(t,ol.DEBUG_WEBGL?"a_texCoord":"c")};goog.provide("ol.renderer.webgl.Layer");goog.require("ol");goog.require("ol.render.Event");goog.require("ol.render.EventType");goog.require("ol.render.webgl.Immediate");goog.require("ol.renderer.Layer");goog.require("ol.renderer.webgl.defaultmapshader");goog.require("ol.renderer.webgl.defaultmapshader.Locations");goog.require("ol.transform");goog.require("ol.vec.Mat4");goog.require("ol.webgl");goog.require("ol.webgl.Buffer");goog.require("ol.webgl.Context");ol.renderer.webgl.Layer=function(e,t){ol.renderer.Layer.call(this,t);this.mapRenderer=e;this.arrayBuffer_=new ol.webgl.Buffer([-1,-1,0,0,1,-1,1,0,-1,1,0,1,1,1,1,1]);this.texture=null;this.framebuffer=null;this.framebufferDimension=void 0;this.texCoordMatrix=ol.transform.create();this.projectionMatrix=ol.transform.create();this.tmpMat4_=ol.vec.Mat4.create();this.defaultLocations_=null};ol.inherits(ol.renderer.webgl.Layer,ol.renderer.Layer);ol.renderer.webgl.Layer.prototype.bindFramebuffer=function(e,t){var o=this.mapRenderer.getGL();if(void 0===this.framebufferDimension||this.framebufferDimension!=t){var r=function(e,t,o){if(!e.isContextLost()){e.deleteFramebuffer(t);e.deleteTexture(o)}}.bind(null,o,this.framebuffer,this.texture);e.postRenderFunctions.push(r);var i=ol.webgl.Context.createEmptyTexture(o,t,t),n=o.createFramebuffer();o.bindFramebuffer(ol.webgl.FRAMEBUFFER,n);o.framebufferTexture2D(ol.webgl.FRAMEBUFFER,ol.webgl.COLOR_ATTACHMENT0,ol.webgl.TEXTURE_2D,i,0);this.texture=i;this.framebuffer=n;this.framebufferDimension=t}else o.bindFramebuffer(ol.webgl.FRAMEBUFFER,this.framebuffer)};ol.renderer.webgl.Layer.prototype.composeFrame=function(e,t,o){this.dispatchComposeEvent_(ol.render.EventType.PRECOMPOSE,o,e);o.bindBuffer(ol.webgl.ARRAY_BUFFER,this.arrayBuffer_);var r,i=o.getGL(),n=ol.renderer.webgl.defaultmapshader.fragment,a=ol.renderer.webgl.defaultmapshader.vertex,l=o.getProgram(n,a);if(this.defaultLocations_)r=this.defaultLocations_;else{r=new ol.renderer.webgl.defaultmapshader.Locations(i,l);this.defaultLocations_=r}if(o.useProgram(l)){i.enableVertexAttribArray(r.a_position);i.vertexAttribPointer(r.a_position,2,ol.webgl.FLOAT,!1,16,0);i.enableVertexAttribArray(r.a_texCoord);i.vertexAttribPointer(r.a_texCoord,2,ol.webgl.FLOAT,!1,16,8);i.uniform1i(r.u_texture,0)}i.uniformMatrix4fv(r.u_texCoordMatrix,!1,ol.vec.Mat4.fromTransform(this.tmpMat4_,this.getTexCoordMatrix()));i.uniformMatrix4fv(r.u_projectionMatrix,!1,ol.vec.Mat4.fromTransform(this.tmpMat4_,this.getProjectionMatrix()));i.uniform1f(r.u_opacity,t.opacity);i.bindTexture(ol.webgl.TEXTURE_2D,this.getTexture());i.drawArrays(ol.webgl.TRIANGLE_STRIP,0,4);this.dispatchComposeEvent_(ol.render.EventType.POSTCOMPOSE,o,e)};ol.renderer.webgl.Layer.prototype.dispatchComposeEvent_=function(e,t,o){var r=this.getLayer();if(r.hasListener(e)){var i=o.viewState,n=i.resolution,a=o.pixelRatio,l=o.extent,s=i.center,p=i.rotation,c=o.size,u=new ol.render.webgl.Immediate(t,s,n,p,c,l,a),g=new ol.render.Event(e,u,o,null,t);r.dispatchEvent(g)}};ol.renderer.webgl.Layer.prototype.getTexCoordMatrix=function(){return this.texCoordMatrix};ol.renderer.webgl.Layer.prototype.getTexture=function(){return this.texture};ol.renderer.webgl.Layer.prototype.getProjectionMatrix=function(){return this.projectionMatrix};ol.renderer.webgl.Layer.prototype.handleWebGLContextLost=function(){this.texture=null;this.framebuffer=null;this.framebufferDimension=void 0};ol.renderer.webgl.Layer.prototype.prepareFrame=function(e,t,o){};ol.renderer.webgl.Layer.prototype.forEachLayerAtPixel=function(e,t,o,r){};goog.provide("ol.renderer.webgl.ImageLayer");goog.require("ol");goog.require("ol.LayerType");goog.require("ol.ViewHint");goog.require("ol.dom");goog.require("ol.extent");goog.require("ol.functions");goog.require("ol.renderer.Type");goog.require("ol.renderer.webgl.Layer");goog.require("ol.transform");goog.require("ol.webgl");goog.require("ol.webgl.Context");ol.renderer.webgl.ImageLayer=function(e,t){ol.renderer.webgl.Layer.call(this,e,t);this.image_=null;this.hitCanvasContext_=null;this.hitTransformationMatrix_=null};ol.inherits(ol.renderer.webgl.ImageLayer,ol.renderer.webgl.Layer);ol.renderer.webgl.ImageLayer.handles=function(e,t){return e===ol.renderer.Type.WEBGL&&t.getType()===ol.LayerType.IMAGE};ol.renderer.webgl.ImageLayer.create=function(e,t){return new ol.renderer.webgl.ImageLayer(e,t)};ol.renderer.webgl.ImageLayer.prototype.createTexture_=function(e){var t=e.getImage(),o=this.mapRenderer.getGL();return ol.webgl.Context.createTexture(o,t,ol.webgl.CLAMP_TO_EDGE,ol.webgl.CLAMP_TO_EDGE)};ol.renderer.webgl.ImageLayer.prototype.forEachFeatureAtCoordinate=function(e,t,o,r,i){var n=this.getLayer(),a=n.getSource(),l=t.viewState.resolution,s=t.viewState.rotation,p=t.skippedFeatureUids;return a.forEachFeatureAtCoordinate(e,l,s,o,p,function(e){return r.call(i,e,n)})};ol.renderer.webgl.ImageLayer.prototype.prepareFrame=function(e,t,o){var r=this.mapRenderer.getGL(),i=e.pixelRatio,n=e.viewState,a=n.center,l=n.resolution,s=n.rotation,p=this.image_,c=this.texture,u=this.getLayer().getSource(),g=e.viewHints,d=e.extent;void 0!==t.extent&&(d=ol.extent.getIntersection(d,t.extent));if(!g[ol.ViewHint.ANIMATING]&&!g[ol.ViewHint.INTERACTING]&&!ol.extent.isEmpty(d)){var h=n.projection;if(!ol.ENABLE_RASTER_REPROJECTION){var f=u.getProjection();f&&(h=f)}var y=u.getImage(d,l,i,h);if(y){if(this.loadImage(y)){p=y;c=this.createTexture_(y);if(this.texture){var m=function(e,t){e.isContextLost()||e.deleteTexture(t)}.bind(null,r,this.texture);e.postRenderFunctions.push(m)}}}}if(p){var v=this.mapRenderer.getContext().getCanvas();this.updateProjectionMatrix_(v.width,v.height,i,a,l,s,p.getExtent());this.hitTransformationMatrix_=null;var C=this.texCoordMatrix;ol.transform.reset(C);ol.transform.scale(C,1,-1);ol.transform.translate(C,0,-1);this.image_=p;this.texture=c;this.updateLogos(e,u)}return!!p};ol.renderer.webgl.ImageLayer.prototype.updateProjectionMatrix_=function(e,t,o,r,i,n,a){var l=e*i,s=t*i,p=this.projectionMatrix;ol.transform.reset(p);ol.transform.scale(p,2*o/l,2*o/s);ol.transform.rotate(p,-n);ol.transform.translate(p,a[0]-r[0],a[1]-r[1]);ol.transform.scale(p,(a[2]-a[0])/2,(a[3]-a[1])/2);ol.transform.translate(p,1,1)};ol.renderer.webgl.ImageLayer.prototype.hasFeatureAtCoordinate=function(e,t){return void 0!==this.forEachFeatureAtCoordinate(e,t,0,ol.functions.TRUE,this)};ol.renderer.webgl.ImageLayer.prototype.forEachLayerAtPixel=function(e,t,o,r){if(this.image_&&this.image_.getImage()){if(this.getLayer().getSource().forEachFeatureAtCoordinate!==ol.nullFunction){var i=ol.transform.apply(t.pixelToCoordinateTransform,e.slice());return this.forEachFeatureAtCoordinate(i,t,0,ol.functions.TRUE,this)?o.call(r,this.getLayer(),null):void 0}var n=[this.image_.getImage().width,this.image_.getImage().height];this.hitTransformationMatrix_||(this.hitTransformationMatrix_=this.getHitTransformationMatrix_(t.size,n));var a=ol.transform.apply(this.hitTransformationMatrix_,e.slice());if(!(a[0]<0||a[0]>n[0]||a[1]<0||a[1]>n[1])){this.hitCanvasContext_||(this.hitCanvasContext_=ol.dom.createCanvasContext2D(1,1));this.hitCanvasContext_.clearRect(0,0,1,1);this.hitCanvasContext_.drawImage(this.image_.getImage(),a[0],a[1],1,1,0,0,1,1);var l=this.hitCanvasContext_.getImageData(0,0,1,1).data;return l[3]>0?o.call(r,this.getLayer(),l):void 0}}};ol.renderer.webgl.ImageLayer.prototype.getHitTransformationMatrix_=function(e,t){var o=ol.transform.create();ol.transform.translate(o,-1,-1);ol.transform.scale(o,2/e[0],2/e[1]);ol.transform.translate(o,0,e[1]);ol.transform.scale(o,1,-1);var r=ol.transform.invert(this.projectionMatrix.slice()),i=ol.transform.create();ol.transform.translate(i,0,t[1]);ol.transform.scale(i,1,-1);ol.transform.scale(i,t[0]/2,t[1]/2);ol.transform.translate(i,1,1);ol.transform.multiply(i,r);ol.transform.multiply(i,o);return i};goog.provide("ol.renderer.webgl.Map");goog.require("ol");goog.require("ol.array");goog.require("ol.css");goog.require("ol.dom");goog.require("ol.events");goog.require("ol.has");goog.require("ol.layer.Layer");goog.require("ol.render.Event");goog.require("ol.render.EventType");goog.require("ol.render.webgl.Immediate");goog.require("ol.renderer.Map");goog.require("ol.renderer.Type");goog.require("ol.source.State");goog.require("ol.structs.LRUCache");goog.require("ol.structs.PriorityQueue");goog.require("ol.webgl");goog.require("ol.webgl.Context");goog.require("ol.webgl.ContextEventType");ol.renderer.webgl.Map=function(e,t){ol.renderer.Map.call(this,e,t);this.canvas_=document.createElement("CANVAS");this.canvas_.style.width="100%";this.canvas_.style.height="100%";this.canvas_.style.display="block";this.canvas_.className=ol.css.CLASS_UNSELECTABLE;e.insertBefore(this.canvas_,e.childNodes[0]||null);this.clipTileCanvasWidth_=0;this.clipTileCanvasHeight_=0;this.clipTileContext_=ol.dom.createCanvasContext2D();this.renderedVisible_=!0;this.gl_=ol.webgl.getContext(this.canvas_,{antialias:!0,depth:!0,failIfMajorPerformanceCaveat:!0,preserveDrawingBuffer:!1,stencil:!0});this.context_=new ol.webgl.Context(this.canvas_,this.gl_);ol.events.listen(this.canvas_,ol.webgl.ContextEventType.LOST,this.handleWebGLContextLost,this);ol.events.listen(this.canvas_,ol.webgl.ContextEventType.RESTORED,this.handleWebGLContextRestored,this);this.textureCache_=new ol.structs.LRUCache;this.focus_=null;this.tileTextureQueue_=new ol.structs.PriorityQueue(function(e){var t=e[1],o=e[2],r=t[0]-this.focus_[0],i=t[1]-this.focus_[1];return 65536*Math.log(o)+Math.sqrt(r*r+i*i)/o}.bind(this),function(e){return e[0].getKey()});this.loadNextTileTexture_=function(e,t){if(!this.tileTextureQueue_.isEmpty()){this.tileTextureQueue_.reprioritize();var o=this.tileTextureQueue_.dequeue(),r=o[0],i=o[3],n=o[4];this.bindTileTexture(r,i,n,ol.webgl.LINEAR,ol.webgl.LINEAR)}return!1}.bind(this);this.textureCacheFrameMarkerCount_=0;this.initializeGL_()};ol.inherits(ol.renderer.webgl.Map,ol.renderer.Map);ol.renderer.webgl.Map.handles=function(e){return ol.has.WEBGL&&e===ol.renderer.Type.WEBGL};ol.renderer.webgl.Map.create=function(e,t){return new ol.renderer.webgl.Map(e,t)};ol.renderer.webgl.Map.prototype.bindTileTexture=function(e,t,o,r,i){var n=this.getGL(),a=e.getKey();if(this.textureCache_.containsKey(a)){var l=this.textureCache_.get(a);n.bindTexture(ol.webgl.TEXTURE_2D,l.texture);if(l.magFilter!=r){n.texParameteri(ol.webgl.TEXTURE_2D,ol.webgl.TEXTURE_MAG_FILTER,r);l.magFilter=r}if(l.minFilter!=i){n.texParameteri(ol.webgl.TEXTURE_2D,ol.webgl.TEXTURE_MIN_FILTER,i);l.minFilter=i}}else{var s=n.createTexture();n.bindTexture(ol.webgl.TEXTURE_2D,s);if(o>0){var p=this.clipTileContext_.canvas,c=this.clipTileContext_;if(this.clipTileCanvasWidth_!==t[0]||this.clipTileCanvasHeight_!==t[1]){p.width=t[0];p.height=t[1];this.clipTileCanvasWidth_=t[0];this.clipTileCanvasHeight_=t[1]}else c.clearRect(0,0,t[0],t[1]);c.drawImage(e.getImage(),o,o,t[0],t[1],0,0,t[0],t[1]);n.texImage2D(ol.webgl.TEXTURE_2D,0,ol.webgl.RGBA,ol.webgl.RGBA,ol.webgl.UNSIGNED_BYTE,p)}else n.texImage2D(ol.webgl.TEXTURE_2D,0,ol.webgl.RGBA,ol.webgl.RGBA,ol.webgl.UNSIGNED_BYTE,e.getImage());n.texParameteri(ol.webgl.TEXTURE_2D,ol.webgl.TEXTURE_MAG_FILTER,r);n.texParameteri(ol.webgl.TEXTURE_2D,ol.webgl.TEXTURE_MIN_FILTER,i);n.texParameteri(ol.webgl.TEXTURE_2D,ol.webgl.TEXTURE_WRAP_S,ol.webgl.CLAMP_TO_EDGE);n.texParameteri(ol.webgl.TEXTURE_2D,ol.webgl.TEXTURE_WRAP_T,ol.webgl.CLAMP_TO_EDGE);this.textureCache_.set(a,{texture:s,magFilter:r,minFilter:i})}};ol.renderer.webgl.Map.prototype.dispatchComposeEvent_=function(e,t){var o=this.getMap();if(o.hasListener(e)){var r=this.context_,i=t.extent,n=t.size,a=t.viewState,l=t.pixelRatio,s=a.resolution,p=a.center,c=a.rotation,u=new ol.render.webgl.Immediate(r,p,s,c,n,i,l),g=new ol.render.Event(e,u,t,null,r);o.dispatchEvent(g)}};ol.renderer.webgl.Map.prototype.disposeInternal=function(){var e=this.getGL();e.isContextLost()||this.textureCache_.forEach(function(t){t&&e.deleteTexture(t.texture)});this.context_.dispose();ol.renderer.Map.prototype.disposeInternal.call(this)};ol.renderer.webgl.Map.prototype.expireCache_=function(e,t){for(var o,r=this.getGL();this.textureCache_.getCount()-this.textureCacheFrameMarkerCount_>ol.WEBGL_TEXTURE_CACHE_HIGH_WATER_MARK;){if(o=this.textureCache_.peekLast())r.deleteTexture(o.texture);else{if(+this.textureCache_.peekLastKey()==t.index)break;--this.textureCacheFrameMarkerCount_}this.textureCache_.pop()}};ol.renderer.webgl.Map.prototype.getContext=function(){return this.context_};ol.renderer.webgl.Map.prototype.getGL=function(){return this.gl_};ol.renderer.webgl.Map.prototype.getTileTextureQueue=function(){return this.tileTextureQueue_};ol.renderer.webgl.Map.prototype.getType=function(){return ol.renderer.Type.WEBGL};ol.renderer.webgl.Map.prototype.handleWebGLContextLost=function(e){e.preventDefault();this.textureCache_.clear();this.textureCacheFrameMarkerCount_=0;var t=this.getLayerRenderers();for(var o in t){t[o].handleWebGLContextLost()}};ol.renderer.webgl.Map.prototype.handleWebGLContextRestored=function(){this.initializeGL_();this.getMap().render()};ol.renderer.webgl.Map.prototype.initializeGL_=function(){var e=this.gl_;e.activeTexture(ol.webgl.TEXTURE0);e.blendFuncSeparate(ol.webgl.SRC_ALPHA,ol.webgl.ONE_MINUS_SRC_ALPHA,ol.webgl.ONE,ol.webgl.ONE_MINUS_SRC_ALPHA);e.disable(ol.webgl.CULL_FACE);e.disable(ol.webgl.DEPTH_TEST);e.disable(ol.webgl.SCISSOR_TEST);e.disable(ol.webgl.STENCIL_TEST)};ol.renderer.webgl.Map.prototype.isTileTextureLoaded=function(e){return this.textureCache_.containsKey(e.getKey())};ol.renderer.webgl.Map.prototype.renderFrame=function(e){var t=this.getContext(),o=this.getGL();if(o.isContextLost())return!1;if(!e){if(this.renderedVisible_){this.canvas_.style.display="none";this.renderedVisible_=!1}return!1}this.focus_=e.focus;this.textureCache_.set((-e.index).toString(),null);++this.textureCacheFrameMarkerCount_;this.dispatchComposeEvent_(ol.render.EventType.PRECOMPOSE,e);var r=[],i=e.layerStatesArray;ol.array.stableSort(i,ol.renderer.Map.sortByZIndex);var n,a,l,s=e.viewState.resolution;for(n=0,a=i.length;n<a;++n){l=i[n];ol.layer.Layer.visibleAtResolution(l,s)&&l.sourceState==ol.source.State.READY&&this.getLayerRenderer(l.layer).prepareFrame(e,l,t)&&r.push(l)}var p=e.size[0]*e.pixelRatio,c=e.size[1]*e.pixelRatio;if(this.canvas_.width!=p||this.canvas_.height!=c){this.canvas_.width=p;this.canvas_.height=c}o.bindFramebuffer(ol.webgl.FRAMEBUFFER,null);o.clearColor(0,0,0,0);o.clear(ol.webgl.COLOR_BUFFER_BIT);o.enable(ol.webgl.BLEND);o.viewport(0,0,this.canvas_.width,this.canvas_.height);for(n=0,a=r.length;n<a;++n){l=r[n];this.getLayerRenderer(l.layer).composeFrame(e,l,t)}if(!this.renderedVisible_){this.canvas_.style.display="";this.renderedVisible_=!0}this.calculateMatrices2D(e);this.textureCache_.getCount()-this.textureCacheFrameMarkerCount_>ol.WEBGL_TEXTURE_CACHE_HIGH_WATER_MARK&&e.postRenderFunctions.push(this.expireCache_.bind(this));if(!this.tileTextureQueue_.isEmpty()){e.postRenderFunctions.push(this.loadNextTileTexture_);e.animate=!0}this.dispatchComposeEvent_(ol.render.EventType.POSTCOMPOSE,e);this.scheduleRemoveUnusedLayerRenderers(e);this.scheduleExpireIconCache(e)};ol.renderer.webgl.Map.prototype.forEachFeatureAtCoordinate=function(e,t,o,r,i,n,a){var l;if(this.getGL().isContextLost())return!1;var s,p=t.viewState,c=t.layerStatesArray;for(s=c.length-1;s>=0;--s){var u=c[s],g=u.layer;if(ol.layer.Layer.visibleAtResolution(u,p.resolution)&&n.call(a,g)){if(l=this.getLayerRenderer(g).forEachFeatureAtCoordinate(e,t,o,r,i))return l}}};ol.renderer.webgl.Map.prototype.hasFeatureAtCoordinate=function(e,t,o,r,i){var n=!1;if(this.getGL().isContextLost())return!1;var a,l=t.viewState,s=t.layerStatesArray;for(a=s.length-1;a>=0;--a){var p=s[a],c=p.layer;if(ol.layer.Layer.visibleAtResolution(p,l.resolution)&&r.call(i,c)){if(n=this.getLayerRenderer(c).hasFeatureAtCoordinate(e,t))return!0}}return n};ol.renderer.webgl.Map.prototype.forEachLayerAtPixel=function(e,t,o,r,i,n){if(this.getGL().isContextLost())return!1;var a,l,s=t.viewState,p=t.layerStatesArray;for(l=p.length-1;l>=0;--l){var c=p[l],u=c.layer;if(ol.layer.Layer.visibleAtResolution(c,s.resolution)&&i.call(r,u)){if(a=this.getLayerRenderer(u).forEachLayerAtPixel(e,t,o,r))return a}}};goog.provide("ol.renderer.webgl.tilelayershader");goog.require("ol");goog.require("ol.webgl.Fragment");goog.require("ol.webgl.Vertex");ol.renderer.webgl.tilelayershader.fragment=new ol.webgl.Fragment(ol.DEBUG_WEBGL?"precision mediump float;\nvarying vec2 v_texCoord;\n\n\nuniform sampler2D u_texture;\n\nvoid main(void) {\n  gl_FragColor = texture2D(u_texture, v_texCoord);\n}\n":"precision mediump float;varying vec2 a;uniform sampler2D e;void main(void){gl_FragColor=texture2D(e,a);}");ol.renderer.webgl.tilelayershader.vertex=new ol.webgl.Vertex(ol.DEBUG_WEBGL?"varying vec2 v_texCoord;\n\n\nattribute vec2 a_position;\nattribute vec2 a_texCoord;\nuniform vec4 u_tileOffset;\n\nvoid main(void) {\n  gl_Position = vec4(a_position * u_tileOffset.xy + u_tileOffset.zw, 0., 1.);\n  v_texCoord = a_texCoord;\n}\n\n\n":"varying vec2 a;attribute vec2 b;attribute vec2 c;uniform vec4 d;void main(void){gl_Position=vec4(b*d.xy+d.zw,0.,1.);a=c;}");goog.provide("ol.renderer.webgl.tilelayershader.Locations");goog.require("ol");ol.renderer.webgl.tilelayershader.Locations=function(e,t){this.u_tileOffset=e.getUniformLocation(t,ol.DEBUG_WEBGL?"u_tileOffset":"d");this.u_texture=e.getUniformLocation(t,ol.DEBUG_WEBGL?"u_texture":"e");this.a_position=e.getAttribLocation(t,ol.DEBUG_WEBGL?"a_position":"b");this.a_texCoord=e.getAttribLocation(t,ol.DEBUG_WEBGL?"a_texCoord":"c")};goog.provide("ol.renderer.webgl.TileLayer");goog.require("ol");goog.require("ol.LayerType");goog.require("ol.TileRange");goog.require("ol.TileState");goog.require("ol.array");goog.require("ol.extent");goog.require("ol.math");goog.require("ol.renderer.Type");goog.require("ol.renderer.webgl.Layer");goog.require("ol.renderer.webgl.tilelayershader");goog.require("ol.renderer.webgl.tilelayershader.Locations");goog.require("ol.size");goog.require("ol.transform");goog.require("ol.webgl");goog.require("ol.webgl.Buffer");ol.renderer.webgl.TileLayer=function(e,t){ol.renderer.webgl.Layer.call(this,e,t);this.fragmentShader_=ol.renderer.webgl.tilelayershader.fragment;this.vertexShader_=ol.renderer.webgl.tilelayershader.vertex;this.locations_=null;this.renderArrayBuffer_=new ol.webgl.Buffer([0,0,0,1,1,0,1,1,0,1,0,0,1,1,1,0]);this.renderedTileRange_=null;this.renderedFramebufferExtent_=null;this.renderedRevision_=-1;this.tmpSize_=[0,0]};ol.inherits(ol.renderer.webgl.TileLayer,ol.renderer.webgl.Layer);ol.renderer.webgl.TileLayer.handles=function(e,t){return e===ol.renderer.Type.WEBGL&&t.getType()===ol.LayerType.TILE};ol.renderer.webgl.TileLayer.create=function(e,t){return new ol.renderer.webgl.TileLayer(e,t)};ol.renderer.webgl.TileLayer.prototype.disposeInternal=function(){this.mapRenderer.getContext().deleteBuffer(this.renderArrayBuffer_);ol.renderer.webgl.Layer.prototype.disposeInternal.call(this)};ol.renderer.webgl.TileLayer.prototype.createLoadedTileFinder=function(e,t,o){var r=this.mapRenderer;return function(i,n){return e.forEachLoadedTile(t,i,n,function(e){var t=r.isTileTextureLoaded(e);if(t){o[i]||(o[i]={});o[i][e.tileCoord.toString()]=e}return t})}};ol.renderer.webgl.TileLayer.prototype.handleWebGLContextLost=function(){ol.renderer.webgl.Layer.prototype.handleWebGLContextLost.call(this);this.locations_=null};ol.renderer.webgl.TileLayer.prototype.prepareFrame=function(e,t,o){var r,i=this.mapRenderer,n=o.getGL(),a=e.viewState,l=a.projection,s=this.getLayer(),p=s.getSource(),c=p.getTileGridForProjection(l),u=c.getZForResolution(a.resolution),g=c.getResolution(u),d=p.getTilePixelSize(u,e.pixelRatio,l),h=d[0]/ol.size.toSize(c.getTileSize(u),this.tmpSize_)[0],f=g/h,y=p.getTilePixelRatio(h)*p.getGutter(l),m=a.center,v=e.extent,C=c.getTileRangeForExtentAndZ(v,u);if(this.renderedTileRange_&&this.renderedTileRange_.equals(C)&&this.renderedRevision_==p.getRevision())r=this.renderedFramebufferExtent_;else{var T=C.getSize(),S=Math.max(T[0]*d[0],T[1]*d[1]),_=ol.math.roundUpToPowerOfTwo(S),E=f*_,x=c.getOrigin(u),P=x[0]+C.minX*d[0]*f,L=x[1]+C.minY*d[1]*f;r=[P,L,P+E,L+E];this.bindFramebuffer(e,_);n.viewport(0,0,_,_);n.clearColor(0,0,0,0);n.clear(ol.webgl.COLOR_BUFFER_BIT);n.disable(ol.webgl.BLEND);var w=o.getProgram(this.fragmentShader_,this.vertexShader_);o.useProgram(w);this.locations_||(this.locations_=new ol.renderer.webgl.tilelayershader.Locations(n,w));o.bindBuffer(ol.webgl.ARRAY_BUFFER,this.renderArrayBuffer_);n.enableVertexAttribArray(this.locations_.a_position);n.vertexAttribPointer(this.locations_.a_position,2,ol.webgl.FLOAT,!1,16,0);n.enableVertexAttribArray(this.locations_.a_texCoord);n.vertexAttribPointer(this.locations_.a_texCoord,2,ol.webgl.FLOAT,!1,16,8);n.uniform1i(this.locations_.u_texture,0);var b={};b[u]={};var R,A,M,I,O,N,D=this.createLoadedTileFinder(p,l,b),F=s.getUseInterimTilesOnError(),k=!0,G=ol.extent.createEmpty(),U=new ol.TileRange(0,0,0,0);for(I=C.minX;I<=C.maxX;++I)for(O=C.minY;O<=C.maxY;++O){A=p.getTile(u,I,O,h,l);if(void 0!==t.extent){N=c.getTileCoordExtent(A.tileCoord,G);if(!ol.extent.intersects(N,t.extent))continue}(M=A.getState())==ol.TileState.LOADED||M==ol.TileState.EMPTY||M==ol.TileState.ERROR&&!F||(A=A.getInterimTile());if((M=A.getState())==ol.TileState.LOADED){if(i.isTileTextureLoaded(A)){b[u][A.tileCoord.toString()]=A;continue}}else if(M==ol.TileState.EMPTY||M==ol.TileState.ERROR&&!F)continue;k=!1;c.forEachTileCoordParentTileRange(A.tileCoord,D,null,U,G)||(R=c.getTileCoordChildTileRange(A.tileCoord,U,G))&&D(u+1,R)}var B=Object.keys(b).map(Number);B.sort(ol.array.numberSafeCompareFunction);var $,q,j,W,V=new Float32Array(4);for($=0,q=B.length;$<q;++$){W=b[B[$]];for(j in W){A=W[j];N=c.getTileCoordExtent(A.tileCoord,G);V[0]=2*(N[2]-N[0])/E;V[1]=2*(N[3]-N[1])/E;V[2]=2*(N[0]-r[0])/E-1;V[3]=2*(N[1]-r[1])/E-1;n.uniform4fv(this.locations_.u_tileOffset,V);i.bindTileTexture(A,d,y*h,ol.webgl.LINEAR,ol.webgl.LINEAR);n.drawArrays(ol.webgl.TRIANGLE_STRIP,0,4)}}if(k){this.renderedTileRange_=C;this.renderedFramebufferExtent_=r;this.renderedRevision_=p.getRevision()}else{this.renderedTileRange_=null;this.renderedFramebufferExtent_=null;this.renderedRevision_=-1;e.animate=!0}}this.updateUsedTiles(e.usedTiles,p,u,C);var Y=i.getTileTextureQueue();this.manageTilePyramid(e,p,c,h,l,v,u,s.getPreload(),function(e){e.getState()!=ol.TileState.LOADED||i.isTileTextureLoaded(e)||Y.isKeyQueued(e.getKey())||Y.enqueue([e,c.getTileCoordCenter(e.tileCoord),c.getResolution(e.tileCoord[0]),d,y*h])},this);this.scheduleExpireCache(e,p);this.updateLogos(e,p);var K=this.texCoordMatrix;ol.transform.reset(K);ol.transform.translate(K,(Math.round(m[0]/g)*g-r[0])/(r[2]-r[0]),(Math.round(m[1]/g)*g-r[1])/(r[3]-r[1]));0!==a.rotation&&ol.transform.rotate(K,a.rotation);ol.transform.scale(K,e.size[0]*a.resolution/(r[2]-r[0]),e.size[1]*a.resolution/(r[3]-r[1]));ol.transform.translate(K,-.5,-.5);return!0};ol.renderer.webgl.TileLayer.prototype.forEachLayerAtPixel=function(e,t,o,r){if(this.framebuffer){var i=[e[0]/t.size[0],(t.size[1]-e[1])/t.size[1]],n=ol.transform.apply(this.texCoordMatrix,i.slice()),a=[n[0]*this.framebufferDimension,n[1]*this.framebufferDimension],l=this.mapRenderer.getContext().getGL();l.bindFramebuffer(l.FRAMEBUFFER,this.framebuffer);var s=new Uint8Array(4);l.readPixels(a[0],a[1],1,1,l.RGBA,l.UNSIGNED_BYTE,s);return s[3]>0?o.call(r,this.getLayer(),s):void 0}};goog.provide("ol.renderer.webgl.VectorLayer");goog.require("ol");goog.require("ol.LayerType");goog.require("ol.ViewHint");goog.require("ol.extent");goog.require("ol.render.webgl.ReplayGroup");goog.require("ol.renderer.Type");goog.require("ol.renderer.vector");goog.require("ol.renderer.webgl.Layer");goog.require("ol.transform");ol.renderer.webgl.VectorLayer=function(e,t){ol.renderer.webgl.Layer.call(this,e,t);this.dirty_=!1;this.renderedRevision_=-1;this.renderedResolution_=NaN;this.renderedExtent_=ol.extent.createEmpty();this.renderedRenderOrder_=null;this.replayGroup_=null;this.layerState_=null};ol.inherits(ol.renderer.webgl.VectorLayer,ol.renderer.webgl.Layer);ol.renderer.webgl.VectorLayer.handles=function(e,t){return e===ol.renderer.Type.WEBGL&&t.getType()===ol.LayerType.VECTOR};ol.renderer.webgl.VectorLayer.create=function(e,t){return new ol.renderer.webgl.VectorLayer(e,t)};ol.renderer.webgl.VectorLayer.prototype.composeFrame=function(e,t,o){this.layerState_=t;var r=e.viewState,i=this.replayGroup_,n=e.size,a=e.pixelRatio,l=this.mapRenderer.getGL();if(i&&!i.isEmpty()){l.enable(l.SCISSOR_TEST);l.scissor(0,0,n[0]*a,n[1]*a);i.replay(o,r.center,r.resolution,r.rotation,n,a,t.opacity,t.managed?e.skippedFeatureUids:{});l.disable(l.SCISSOR_TEST)}};ol.renderer.webgl.VectorLayer.prototype.disposeInternal=function(){var e=this.replayGroup_;if(e){var t=this.mapRenderer.getContext();e.getDeleteResourcesFunction(t)();this.replayGroup_=null}ol.renderer.webgl.Layer.prototype.disposeInternal.call(this)};ol.renderer.webgl.VectorLayer.prototype.forEachFeatureAtCoordinate=function(e,t,o,r,i){if(this.replayGroup_&&this.layerState_){var n=this.mapRenderer.getContext(),a=t.viewState,l=this.getLayer(),s=this.layerState_,p={};return this.replayGroup_.forEachFeatureAtCoordinate(e,n,a.center,a.resolution,a.rotation,t.size,t.pixelRatio,s.opacity,{},function(e){var t=ol.getUid(e).toString();if(!(t in p)){p[t]=!0;return r.call(i,e,l)}})}};ol.renderer.webgl.VectorLayer.prototype.hasFeatureAtCoordinate=function(e,t){if(this.replayGroup_&&this.layerState_){var o=this.mapRenderer.getContext(),r=t.viewState,i=this.layerState_;return this.replayGroup_.hasFeatureAtCoordinate(e,o,r.center,r.resolution,r.rotation,t.size,t.pixelRatio,i.opacity,t.skippedFeatureUids)}return!1};ol.renderer.webgl.VectorLayer.prototype.forEachLayerAtPixel=function(e,t,o,r){var i=ol.transform.apply(t.pixelToCoordinateTransform,e.slice());return this.hasFeatureAtCoordinate(i,t)?o.call(r,this.getLayer(),null):void 0};ol.renderer.webgl.VectorLayer.prototype.handleStyleImageChange_=function(e){this.renderIfReadyAndVisible()};ol.renderer.webgl.VectorLayer.prototype.prepareFrame=function(e,t,o){var r=this.getLayer(),i=r.getSource();this.updateLogos(e,i);var n=e.viewHints[ol.ViewHint.ANIMATING],a=e.viewHints[ol.ViewHint.INTERACTING],l=r.getUpdateWhileAnimating(),s=r.getUpdateWhileInteracting();if(!this.dirty_&&!l&&n||!s&&a)return!0;var p=e.extent,c=e.viewState,u=c.projection,g=c.resolution,d=e.pixelRatio,h=r.getRevision(),f=r.getRenderBuffer(),y=r.getRenderOrder();void 0===y&&(y=ol.renderer.vector.defaultOrder);var m=ol.extent.buffer(p,f*g);if(!this.dirty_&&this.renderedResolution_==g&&this.renderedRevision_==h&&this.renderedRenderOrder_==y&&ol.extent.containsExtent(this.renderedExtent_,m))return!0;this.replayGroup_&&e.postRenderFunctions.push(this.replayGroup_.getDeleteResourcesFunction(o));this.dirty_=!1;var v=new ol.render.webgl.ReplayGroup(ol.renderer.vector.getTolerance(g,d),m,r.getRenderBuffer());i.loadFeatures(m,g,u);var C=function(e){var t,o=e.getStyleFunction();o?t=o.call(e,g):(o=r.getStyleFunction())&&(t=o(e,g));if(t){var i=this.renderFeature(e,g,d,t,v);this.dirty_=this.dirty_||i}};if(y){var T=[];i.forEachFeatureInExtent(m,function(e){T.push(e)},this);T.sort(y);T.forEach(C,this)}else i.forEachFeatureInExtent(m,C,this);v.finish(o);this.renderedResolution_=g;this.renderedRevision_=h;this.renderedRenderOrder_=y;this.renderedExtent_=m;this.replayGroup_=v;return!0};ol.renderer.webgl.VectorLayer.prototype.renderFeature=function(e,t,o,r,i){if(!r)return!1;var n=!1;if(Array.isArray(r))for(var a=r.length-1;a>=0;--a)n=ol.renderer.vector.renderFeature(i,e,r[a],ol.renderer.vector.getSquaredTolerance(t,o),this.handleStyleImageChange_,this)||n;else n=ol.renderer.vector.renderFeature(i,e,r,ol.renderer.vector.getSquaredTolerance(t,o),this.handleStyleImageChange_,this)||n;return n};goog.provide("ol.Map");goog.require("ol");goog.require("ol.PluggableMap");goog.require("ol.PluginType");goog.require("ol.control");goog.require("ol.interaction");goog.require("ol.obj");goog.require("ol.plugins");goog.require("ol.renderer.canvas.ImageLayer");goog.require("ol.renderer.canvas.Map");goog.require("ol.renderer.canvas.TileLayer");goog.require("ol.renderer.canvas.VectorLayer");goog.require("ol.renderer.canvas.VectorTileLayer");goog.require("ol.renderer.webgl.ImageLayer");goog.require("ol.renderer.webgl.Map");goog.require("ol.renderer.webgl.TileLayer");goog.require("ol.renderer.webgl.VectorLayer");if(ol.ENABLE_CANVAS){ol.plugins.register(ol.PluginType.MAP_RENDERER,ol.renderer.canvas.Map);ol.plugins.registerMultiple(ol.PluginType.LAYER_RENDERER,[ol.renderer.canvas.ImageLayer,ol.renderer.canvas.TileLayer,ol.renderer.canvas.VectorLayer,ol.renderer.canvas.VectorTileLayer])}if(ol.ENABLE_WEBGL){ol.plugins.register(ol.PluginType.MAP_RENDERER,ol.renderer.webgl.Map);ol.plugins.registerMultiple(ol.PluginType.LAYER_RENDERER,[ol.renderer.webgl.ImageLayer,ol.renderer.webgl.TileLayer,ol.renderer.webgl.VectorLayer])}ol.Map=function(e){(e=ol.obj.assign({},e)).controls||(e.controls=ol.control.defaults());e.interactions||(e.interactions=ol.interaction.defaults());ol.PluggableMap.call(this,e)};ol.inherits(ol.Map,ol.PluggableMap);goog.provide("ol.net");goog.require("ol");ol.net.jsonp=function(e,t,o,r){var i=document.createElement("script"),n="olc_"+ol.getUid(t);function a(){delete window[n];i.parentNode.removeChild(i)}i.async=!0;i.src=e+(-1==e.indexOf("?")?"?":"&")+(r||"callback")+"="+n;var l=setTimeout(function(){a();o&&o()},1e4);window[n]=function(e){clearTimeout(l);a();t(e)};document.getElementsByTagName("head")[0].appendChild(i)};goog.provide("ol.proj.common");goog.require("ol.proj");ol.proj.common.add=ol.proj.addCommon;goog.provide("ol.render");goog.require("ol.has");goog.require("ol.transform");goog.require("ol.render.canvas.Immediate");ol.render.toContext=function(e,t){var o=e.canvas,r=t||{},i=r.pixelRatio||ol.has.DEVICE_PIXEL_RATIO,n=r.size;if(n){o.width=n[0]*i;o.height=n[1]*i;o.style.width=n[0]+"px";o.style.height=n[1]+"px"}var a=[0,0,o.width,o.height],l=ol.transform.scale(ol.transform.create(),i,i);return new ol.render.canvas.Immediate(e,i,a,l,0)};goog.provide("ol.reproj");goog.require("ol.dom");goog.require("ol.extent");goog.require("ol.math");goog.require("ol.proj");ol.reproj.calculateSourceResolution=function(e,t,o,r){var i=ol.proj.transform(o,t,e),n=ol.proj.getPointResolution(t,r,o),a=t.getMetersPerUnit();void 0!==a&&(n*=a);var l=e.getMetersPerUnit();void 0!==l&&(n/=l);var s=e.getExtent();if(!s||ol.extent.containsCoordinate(s,i)){var p=ol.proj.getPointResolution(e,n,i)/n;isFinite(p)&&p>0&&(n/=p)}return n};ol.reproj.enlargeClipPoint_=function(e,t,o,r){var i=o-e,n=r-t,a=Math.sqrt(i*i+n*n);return[Math.round(o+i/a),Math.round(r+n/a)]};ol.reproj.render=function(e,t,o,r,i,n,a,l,s,p,c){var u=ol.dom.createCanvasContext2D(Math.round(o*e),Math.round(o*t));if(0===s.length)return u.canvas;u.scale(o,o);var g=ol.extent.createEmpty();s.forEach(function(e,t,o){ol.extent.extend(g,e.extent)});var d=ol.extent.getWidth(g),h=ol.extent.getHeight(g),f=ol.dom.createCanvasContext2D(Math.round(o*d/r),Math.round(o*h/r)),y=o/r;s.forEach(function(e,t,o){var r=e.extent[0]-g[0],i=-(e.extent[3]-g[3]),n=ol.extent.getWidth(e.extent),a=ol.extent.getHeight(e.extent);f.drawImage(e.image,p,p,e.image.width-2*p,e.image.height-2*p,r*y,i*y,n*y,a*y)});var m=ol.extent.getTopLeft(a);l.getTriangles().forEach(function(e,t,i){var a=e.source,l=e.target,s=a[0][0],p=a[0][1],c=a[1][0],d=a[1][1],h=a[2][0],y=a[2][1],v=(l[0][0]-m[0])/n,C=-(l[0][1]-m[1])/n,T=(l[1][0]-m[0])/n,S=-(l[1][1]-m[1])/n,_=(l[2][0]-m[0])/n,E=-(l[2][1]-m[1])/n,x=s,P=p;s=0;p=0;var L=[[c-=x,d-=P,0,0,T-v],[h-=x,y-=P,0,0,_-v],[0,0,c,d,S-C],[0,0,h,y,E-C]],w=ol.math.solveLinearSystem(L);if(w){u.save();u.beginPath();var b=(v+T+_)/3,R=(C+S+E)/3,A=ol.reproj.enlargeClipPoint_(b,R,v,C),M=ol.reproj.enlargeClipPoint_(b,R,T,S),I=ol.reproj.enlargeClipPoint_(b,R,_,E);u.moveTo(M[0],M[1]);u.lineTo(A[0],A[1]);u.lineTo(I[0],I[1]);u.clip();u.transform(w[0],w[2],w[1],w[3],v,C);u.translate(g[0]-x,g[3]-P);u.scale(r/o,-r/o);u.drawImage(f.canvas,0,0);u.restore()}});if(c){u.save();u.strokeStyle="black";u.lineWidth=1;l.getTriangles().forEach(function(e,t,o){var r=e.target,i=(r[0][0]-m[0])/n,a=-(r[0][1]-m[1])/n,l=(r[1][0]-m[0])/n,s=-(r[1][1]-m[1])/n,p=(r[2][0]-m[0])/n,c=-(r[2][1]-m[1])/n;u.beginPath();u.moveTo(l,s);u.lineTo(i,a);u.lineTo(p,c);u.closePath();u.stroke()});u.restore()}return u.canvas};goog.provide("ol.reproj.Triangulation");goog.require("ol");goog.require("ol.extent");goog.require("ol.math");goog.require("ol.proj");ol.reproj.Triangulation=function(e,t,o,r,i){this.sourceProj_=e;this.targetProj_=t;var n={},a=ol.proj.getTransform(this.targetProj_,this.sourceProj_);this.transformInv_=function(e){var t=e[0]+"/"+e[1];n[t]||(n[t]=a(e));return n[t]};this.maxSourceExtent_=r;this.errorThresholdSquared_=i*i;this.triangles_=[];this.wrapsXInSource_=!1;this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!r&&!!this.sourceProj_.getExtent()&&ol.extent.getWidth(r)==ol.extent.getWidth(this.sourceProj_.getExtent());this.sourceWorldWidth_=this.sourceProj_.getExtent()?ol.extent.getWidth(this.sourceProj_.getExtent()):null;this.targetWorldWidth_=this.targetProj_.getExtent()?ol.extent.getWidth(this.targetProj_.getExtent()):null;var l=ol.extent.getTopLeft(o),s=ol.extent.getTopRight(o),p=ol.extent.getBottomRight(o),c=ol.extent.getBottomLeft(o),u=this.transformInv_(l),g=this.transformInv_(s),d=this.transformInv_(p),h=this.transformInv_(c);this.addQuad_(l,s,p,c,u,g,d,h,ol.RASTER_REPROJECTION_MAX_SUBDIVISION);if(this.wrapsXInSource_){var f=1/0;this.triangles_.forEach(function(e,t,o){f=Math.min(f,e.source[0][0],e.source[1][0],e.source[2][0])});this.triangles_.forEach(function(e){if(Math.max(e.source[0][0],e.source[1][0],e.source[2][0])-f>this.sourceWorldWidth_/2){var t=[[e.source[0][0],e.source[0][1]],[e.source[1][0],e.source[1][1]],[e.source[2][0],e.source[2][1]]];t[0][0]-f>this.sourceWorldWidth_/2&&(t[0][0]-=this.sourceWorldWidth_);t[1][0]-f>this.sourceWorldWidth_/2&&(t[1][0]-=this.sourceWorldWidth_);t[2][0]-f>this.sourceWorldWidth_/2&&(t[2][0]-=this.sourceWorldWidth_);var o=Math.min(t[0][0],t[1][0],t[2][0]);Math.max(t[0][0],t[1][0],t[2][0])-o<this.sourceWorldWidth_/2&&(e.source=t)}},this)}n={}};ol.reproj.Triangulation.prototype.addTriangle_=function(e,t,o,r,i,n){this.triangles_.push({source:[r,i,n],target:[e,t,o]})};ol.reproj.Triangulation.prototype.addQuad_=function(e,t,o,r,i,n,a,l,s){var p=ol.extent.boundingExtent([i,n,a,l]),c=this.sourceWorldWidth_?ol.extent.getWidth(p)/this.sourceWorldWidth_:null,u=this.sourceWorldWidth_,g=this.sourceProj_.canWrapX()&&c>.5&&c<1,d=!1;if(s>0){if(this.targetProj_.isGlobal()&&this.targetWorldWidth_){var h=ol.extent.boundingExtent([e,t,o,r]);d|=ol.extent.getWidth(h)/this.targetWorldWidth_>ol.RASTER_REPROJECTION_MAX_TRIANGLE_WIDTH}!g&&this.sourceProj_.isGlobal()&&c&&(d|=c>ol.RASTER_REPROJECTION_MAX_TRIANGLE_WIDTH)}if(d||!this.maxSourceExtent_||ol.extent.intersects(p,this.maxSourceExtent_)){if(!(d||isFinite(i[0])&&isFinite(i[1])&&isFinite(n[0])&&isFinite(n[1])&&isFinite(a[0])&&isFinite(a[1])&&isFinite(l[0])&&isFinite(l[1]))){if(!(s>0))return;d=!0}if(s>0){if(!d){var f,y=[(e[0]+o[0])/2,(e[1]+o[1])/2],m=this.transformInv_(y);if(g){f=(ol.math.modulo(i[0],u)+ol.math.modulo(a[0],u))/2-ol.math.modulo(m[0],u)}else f=(i[0]+a[0])/2-m[0];var v=(i[1]+a[1])/2-m[1];d=f*f+v*v>this.errorThresholdSquared_}if(d){if(Math.abs(e[0]-o[0])<=Math.abs(e[1]-o[1])){var C=[(t[0]+o[0])/2,(t[1]+o[1])/2],T=this.transformInv_(C),S=[(r[0]+e[0])/2,(r[1]+e[1])/2],_=this.transformInv_(S);this.addQuad_(e,t,C,S,i,n,T,_,s-1);this.addQuad_(S,C,o,r,_,T,a,l,s-1)}else{var E=[(e[0]+t[0])/2,(e[1]+t[1])/2],x=this.transformInv_(E),P=[(o[0]+r[0])/2,(o[1]+r[1])/2],L=this.transformInv_(P);this.addQuad_(e,E,P,r,i,x,L,l,s-1);this.addQuad_(E,t,o,P,x,n,a,L,s-1)}return}}if(g){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}this.addTriangle_(e,o,r,i,a,l);this.addTriangle_(e,t,o,i,n,a)}};ol.reproj.Triangulation.prototype.calculateSourceExtent=function(){var e=ol.extent.createEmpty();this.triangles_.forEach(function(t,o,r){var i=t.source;ol.extent.extendCoordinate(e,i[0]);ol.extent.extendCoordinate(e,i[1]);ol.extent.extendCoordinate(e,i[2])});return e};ol.reproj.Triangulation.prototype.getTriangles=function(){return this.triangles_};goog.provide("ol.reproj.Image");goog.require("ol");goog.require("ol.ImageBase");goog.require("ol.ImageState");goog.require("ol.events");goog.require("ol.events.EventType");goog.require("ol.extent");goog.require("ol.reproj");goog.require("ol.reproj.Triangulation");ol.reproj.Image=function(e,t,o,r,i,n){this.targetProj_=t;this.maxSourceExtent_=e.getExtent();var a=t.getExtent(),l=a?ol.extent.getIntersection(o,a):o,s=ol.extent.getCenter(l),p=ol.reproj.calculateSourceResolution(e,t,s,r),c=ol.DEFAULT_RASTER_REPROJECTION_ERROR_THRESHOLD;this.triangulation_=new ol.reproj.Triangulation(e,t,l,this.maxSourceExtent_,p*c);this.targetResolution_=r;this.targetExtent_=o;var u=this.triangulation_.calculateSourceExtent();this.sourceImage_=n(u,p,i);this.sourcePixelRatio_=this.sourceImage_?this.sourceImage_.getPixelRatio():1;this.canvas_=null;this.sourceListenerKey_=null;var g=ol.ImageState.LOADED;this.sourceImage_&&(g=ol.ImageState.IDLE);ol.ImageBase.call(this,o,r,this.sourcePixelRatio_,g)};ol.inherits(ol.reproj.Image,ol.ImageBase);ol.reproj.Image.prototype.disposeInternal=function(){this.state==ol.ImageState.LOADING&&this.unlistenSource_();ol.ImageBase.prototype.disposeInternal.call(this)};ol.reproj.Image.prototype.getImage=function(){return this.canvas_};ol.reproj.Image.prototype.getProjection=function(){return this.targetProj_};ol.reproj.Image.prototype.reproject_=function(){var e=this.sourceImage_.getState();if(e==ol.ImageState.LOADED){var t=ol.extent.getWidth(this.targetExtent_)/this.targetResolution_,o=ol.extent.getHeight(this.targetExtent_)/this.targetResolution_;this.canvas_=ol.reproj.render(t,o,this.sourcePixelRatio_,this.sourceImage_.getResolution(),this.maxSourceExtent_,this.targetResolution_,this.targetExtent_,this.triangulation_,[{extent:this.sourceImage_.getExtent(),image:this.sourceImage_.getImage()}],0)}this.state=e;this.changed()};ol.reproj.Image.prototype.load=function(){if(this.state==ol.ImageState.IDLE){this.state=ol.ImageState.LOADING;this.changed();var e=this.sourceImage_.getState();if(e==ol.ImageState.LOADED||e==ol.ImageState.ERROR)this.reproject_();else{this.sourceListenerKey_=ol.events.listen(this.sourceImage_,ol.events.EventType.CHANGE,function(e){var t=this.sourceImage_.getState();if(t==ol.ImageState.LOADED||t==ol.ImageState.ERROR){this.unlistenSource_();this.reproject_()}},this);this.sourceImage_.load()}}};ol.reproj.Image.prototype.unlistenSource_=function(){ol.events.unlistenByKey(this.sourceListenerKey_);this.sourceListenerKey_=null};goog.provide("ol.reproj.Tile");goog.require("ol");goog.require("ol.Tile");goog.require("ol.TileState");goog.require("ol.events");goog.require("ol.events.EventType");goog.require("ol.extent");goog.require("ol.math");goog.require("ol.reproj");goog.require("ol.reproj.Triangulation");ol.reproj.Tile=function(e,t,o,r,i,n,a,l,s,p,c){ol.Tile.call(this,i,ol.TileState.IDLE);this.renderEdges_=void 0!==c&&c;this.pixelRatio_=a;this.gutter_=l;this.canvas_=null;this.sourceTileGrid_=t;this.targetTileGrid_=r;this.wrappedTileCoord_=n||i;this.sourceTiles_=[];this.sourcesListenerKeys_=null;this.sourceZ_=0;var u=r.getTileCoordExtent(this.wrappedTileCoord_),g=this.targetTileGrid_.getExtent(),d=this.sourceTileGrid_.getExtent(),h=g?ol.extent.getIntersection(u,g):u;if(0!==ol.extent.getArea(h)){var f=e.getExtent();f&&(d=d?ol.extent.getIntersection(d,f):f);var y=r.getResolution(this.wrappedTileCoord_[0]),m=ol.extent.getCenter(h),v=ol.reproj.calculateSourceResolution(e,o,m,y);if(!isFinite(v)||v<=0)this.state=ol.TileState.EMPTY;else{var C=void 0!==p?p:ol.DEFAULT_RASTER_REPROJECTION_ERROR_THRESHOLD;this.triangulation_=new ol.reproj.Triangulation(e,o,h,d,v*C);if(0!==this.triangulation_.getTriangles().length){this.sourceZ_=t.getZForResolution(v);var T=this.triangulation_.calculateSourceExtent();if(d)if(e.canWrapX()){T[1]=ol.math.clamp(T[1],d[1],d[3]);T[3]=ol.math.clamp(T[3],d[1],d[3])}else T=ol.extent.getIntersection(T,d);if(ol.extent.getArea(T)){for(var S=t.getTileRangeForExtentAndZ(T,this.sourceZ_),_=S.minX;_<=S.maxX;_++)for(var E=S.minY;E<=S.maxY;E++){var x=s(this.sourceZ_,_,E,a);x&&this.sourceTiles_.push(x)}0===this.sourceTiles_.length&&(this.state=ol.TileState.EMPTY)}else this.state=ol.TileState.EMPTY}else this.state=ol.TileState.EMPTY}}else this.state=ol.TileState.EMPTY};ol.inherits(ol.reproj.Tile,ol.Tile);ol.reproj.Tile.prototype.disposeInternal=function(){this.state==ol.TileState.LOADING&&this.unlistenSources_();ol.Tile.prototype.disposeInternal.call(this)};ol.reproj.Tile.prototype.getImage=function(){return this.canvas_};ol.reproj.Tile.prototype.reproject_=function(){var e=[];this.sourceTiles_.forEach(function(t,o,r){t&&t.getState()==ol.TileState.LOADED&&e.push({extent:this.sourceTileGrid_.getTileCoordExtent(t.tileCoord),image:t.getImage()})},this);this.sourceTiles_.length=0;if(0===e.length)this.state=ol.TileState.ERROR;else{var t=this.wrappedTileCoord_[0],o=this.targetTileGrid_.getTileSize(t),r="number"==typeof o?o:o[0],i="number"==typeof o?o:o[1],n=this.targetTileGrid_.getResolution(t),a=this.sourceTileGrid_.getResolution(this.sourceZ_),l=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);this.canvas_=ol.reproj.render(r,i,this.pixelRatio_,a,this.sourceTileGrid_.getExtent(),n,l,this.triangulation_,e,this.gutter_,this.renderEdges_);this.state=ol.TileState.LOADED}this.changed()};ol.reproj.Tile.prototype.load=function(){if(this.state==ol.TileState.IDLE){this.state=ol.TileState.LOADING;this.changed();var e=0;this.sourcesListenerKeys_=[];this.sourceTiles_.forEach(function(t,o,r){var i=t.getState();if(i==ol.TileState.IDLE||i==ol.TileState.LOADING){e++;var n;n=ol.events.listen(t,ol.events.EventType.CHANGE,function(o){var r=t.getState();if(r==ol.TileState.LOADED||r==ol.TileState.ERROR||r==ol.TileState.EMPTY){ol.events.unlistenByKey(n);if(0===--e){this.unlistenSources_();this.reproject_()}}},this);this.sourcesListenerKeys_.push(n)}},this);this.sourceTiles_.forEach(function(e,t,o){e.getState()==ol.TileState.IDLE&&e.load()});0===e&&setTimeout(this.reproject_.bind(this),0)}};ol.reproj.Tile.prototype.unlistenSources_=function(){this.sourcesListenerKeys_.forEach(ol.events.unlistenByKey);this.sourcesListenerKeys_=null};goog.provide("ol.TileUrlFunction");goog.require("ol.asserts");goog.require("ol.math");goog.require("ol.tilecoord");ol.TileUrlFunction.createFromTemplate=function(e,t){var o=/\{z\}/g,r=/\{x\}/g,i=/\{y\}/g,n=/\{-y\}/g;return function(a,l,s){return a?e.replace(o,a[0].toString()).replace(r,a[1].toString()).replace(i,function(){return(-a[2]-1).toString()}).replace(n,function(){var e=a[0],o=t.getFullTileRange(e);ol.asserts.assert(o,55);return(o.getHeight()+a[2]).toString()}):void 0}};ol.TileUrlFunction.createFromTemplates=function(e,t){for(var o=e.length,r=new Array(o),i=0;i<o;++i)r[i]=ol.TileUrlFunction.createFromTemplate(e[i],t);return ol.TileUrlFunction.createFromTileUrlFunctions(r)};ol.TileUrlFunction.createFromTileUrlFunctions=function(e){return 1===e.length?e[0]:function(t,o,r){if(t){var i=ol.tilecoord.hash(t),n=ol.math.modulo(i,e.length);return e[n](t,o,r)}}};ol.TileUrlFunction.nullTileUrlFunction=function(e,t,o){};ol.TileUrlFunction.expandUrl=function(e){var t=[],o=/\{([a-z])-([a-z])\}/.exec(e);if(o){var r,i=o[1].charCodeAt(0),n=o[2].charCodeAt(0);for(r=i;r<=n;++r)t.push(e.replace(o[0],String.fromCharCode(r)));return t}if(o=o=/\{(\d+)-(\d+)\}/.exec(e)){for(var a=parseInt(o[2],10),l=parseInt(o[1],10);l<=a;l++)t.push(e.replace(o[0],l.toString()));return t}t.push(e);return t};goog.provide("ol.TileCache");goog.require("ol");goog.require("ol.structs.LRUCache");goog.require("ol.tilecoord");ol.TileCache=function(e){ol.structs.LRUCache.call(this,e)};ol.inherits(ol.TileCache,ol.structs.LRUCache);ol.TileCache.prototype.expireCache=function(e){for(var t,o;this.canExpireCache()&&!((o=(t=this.peekLast()).tileCoord[0].toString())in e&&e[o].contains(t.tileCoord));)this.pop().dispose()};ol.TileCache.prototype.pruneExceptNewestZ=function(){if(0!==this.getCount()){var e=this.peekFirstKey(),t=ol.tilecoord.fromKey(e)[0];this.forEach(function(e){if(e.tileCoord[0]!==t){this.remove(ol.tilecoord.getKey(e.tileCoord));e.dispose()}},this)}};goog.provide("ol.source.Tile");goog.require("ol");goog.require("ol.TileCache");goog.require("ol.TileState");goog.require("ol.events.Event");goog.require("ol.proj");goog.require("ol.size");goog.require("ol.source.Source");goog.require("ol.tilecoord");goog.require("ol.tilegrid");ol.source.Tile=function(e){ol.source.Source.call(this,{attributions:e.attributions,extent:e.extent,logo:e.logo,projection:e.projection,state:e.state,wrapX:e.wrapX});this.opaque_=void 0!==e.opaque&&e.opaque;this.tilePixelRatio_=void 0!==e.tilePixelRatio?e.tilePixelRatio:1;this.tileGrid=void 0!==e.tileGrid?e.tileGrid:null;this.tileCache=new ol.TileCache(e.cacheSize);this.tmpSize=[0,0];this.key_="";this.tileOptions={transition:e.transition}};ol.inherits(ol.source.Tile,ol.source.Source);ol.source.Tile.prototype.canExpireCache=function(){return this.tileCache.canExpireCache()};ol.source.Tile.prototype.expireCache=function(e,t){var o=this.getTileCacheForProjection(e);o&&o.expireCache(t)};ol.source.Tile.prototype.forEachLoadedTile=function(e,t,o,r){var i=this.getTileCacheForProjection(e);if(!i)return!1;for(var n,a,l,s=!0,p=o.minX;p<=o.maxX;++p)for(var c=o.minY;c<=o.maxY;++c){a=ol.tilecoord.getKeyZXY(t,p,c);l=!1;i.containsKey(a)&&(l=(n=i.get(a)).getState()===ol.TileState.LOADED)&&(l=!1!==r(n));l||(s=!1)}return s};ol.source.Tile.prototype.getGutter=function(e){return 0};ol.source.Tile.prototype.getKey=function(){return this.key_};ol.source.Tile.prototype.setKey=function(e){if(this.key_!==e){this.key_=e;this.changed()}};ol.source.Tile.prototype.getOpaque=function(e){return this.opaque_};ol.source.Tile.prototype.getResolutions=function(){return this.tileGrid.getResolutions()};ol.source.Tile.prototype.getTile=function(e,t,o,r,i){};ol.source.Tile.prototype.getTileGrid=function(){return this.tileGrid};ol.source.Tile.prototype.getTileGridForProjection=function(e){return this.tileGrid?this.tileGrid:ol.tilegrid.getForProjection(e)};ol.source.Tile.prototype.getTileCacheForProjection=function(e){var t=this.getProjection();return t&&!ol.proj.equivalent(t,e)?null:this.tileCache};ol.source.Tile.prototype.getTilePixelRatio=function(e){return this.tilePixelRatio_};ol.source.Tile.prototype.getTilePixelSize=function(e,t,o){var r=this.getTileGridForProjection(o),i=this.getTilePixelRatio(t),n=ol.size.toSize(r.getTileSize(e),this.tmpSize);return 1==i?n:ol.size.scale(n,i,this.tmpSize)};ol.source.Tile.prototype.getTileCoordForTileUrlFunction=function(e,t){var o=void 0!==t?t:this.getProjection(),r=this.getTileGridForProjection(o);this.getWrapX()&&o.isGlobal()&&(e=ol.tilegrid.wrapX(r,e,o));return ol.tilecoord.withinExtentAndZ(e,r)?e:null};ol.source.Tile.prototype.refresh=function(){this.tileCache.clear();this.changed()};ol.source.Tile.prototype.useTile=ol.nullFunction;ol.source.Tile.Event=function(e,t){ol.events.Event.call(this,e);this.tile=t};ol.inherits(ol.source.Tile.Event,ol.events.Event);goog.provide("ol.source.TileEventType");ol.source.TileEventType={TILELOADSTART:"tileloadstart",TILELOADEND:"tileloadend",TILELOADERROR:"tileloaderror"};goog.provide("ol.source.UrlTile");goog.require("ol");goog.require("ol.TileState");goog.require("ol.TileUrlFunction");goog.require("ol.source.Tile");goog.require("ol.source.TileEventType");goog.require("ol.tilecoord");ol.source.UrlTile=function(e){ol.source.Tile.call(this,{attributions:e.attributions,cacheSize:e.cacheSize,extent:e.extent,logo:e.logo,opaque:e.opaque,projection:e.projection,state:e.state,tileGrid:e.tileGrid,tilePixelRatio:e.tilePixelRatio,wrapX:e.wrapX,transition:e.transition});this.tileLoadFunction=e.tileLoadFunction;this.tileUrlFunction=this.fixedTileUrlFunction?this.fixedTileUrlFunction.bind(this):ol.TileUrlFunction.nullTileUrlFunction;this.urls=null;e.urls?this.setUrls(e.urls):e.url&&this.setUrl(e.url);e.tileUrlFunction&&this.setTileUrlFunction(e.tileUrlFunction);this.tileLoadingKeys_={}};ol.inherits(ol.source.UrlTile,ol.source.Tile);ol.source.UrlTile.prototype.fixedTileUrlFunction;ol.source.UrlTile.prototype.getTileLoadFunction=function(){return this.tileLoadFunction};ol.source.UrlTile.prototype.getTileUrlFunction=function(){return this.tileUrlFunction};ol.source.UrlTile.prototype.getUrls=function(){return this.urls};ol.source.UrlTile.prototype.handleTileChange=function(e){var t,o=e.target,r=ol.getUid(o),i=o.getState();if(i==ol.TileState.LOADING){this.tileLoadingKeys_[r]=!0;t=ol.source.TileEventType.TILELOADSTART}else if(r in this.tileLoadingKeys_){delete this.tileLoadingKeys_[r];t=i==ol.TileState.ERROR?ol.source.TileEventType.TILELOADERROR:i==ol.TileState.LOADED||i==ol.TileState.ABORT?ol.source.TileEventType.TILELOADEND:void 0}void 0!=t&&this.dispatchEvent(new ol.source.Tile.Event(t,o))};ol.source.UrlTile.prototype.setTileLoadFunction=function(e){this.tileCache.clear();this.tileLoadFunction=e;this.changed()};ol.source.UrlTile.prototype.setTileUrlFunction=function(e,t){this.tileUrlFunction=e;this.tileCache.pruneExceptNewestZ();void 0!==t?this.setKey(t):this.changed()};ol.source.UrlTile.prototype.setUrl=function(e){var t=this.urls=ol.TileUrlFunction.expandUrl(e);this.setTileUrlFunction(this.fixedTileUrlFunction?this.fixedTileUrlFunction.bind(this):ol.TileUrlFunction.createFromTemplates(t,this.tileGrid),e)};ol.source.UrlTile.prototype.setUrls=function(e){this.urls=e;var t=e.join("\n");this.setTileUrlFunction(this.fixedTileUrlFunction?this.fixedTileUrlFunction.bind(this):ol.TileUrlFunction.createFromTemplates(e,this.tileGrid),t)};ol.source.UrlTile.prototype.useTile=function(e,t,o){var r=ol.tilecoord.getKeyZXY(e,t,o);this.tileCache.containsKey(r)&&this.tileCache.get(r)};goog.provide("ol.source.TileImage");goog.require("ol");goog.require("ol.ImageTile");goog.require("ol.TileCache");goog.require("ol.TileState");goog.require("ol.events");goog.require("ol.events.EventType");goog.require("ol.proj");goog.require("ol.reproj.Tile");goog.require("ol.source.UrlTile");goog.require("ol.tilecoord");goog.require("ol.tilegrid");ol.source.TileImage=function(e){ol.source.UrlTile.call(this,{attributions:e.attributions,cacheSize:e.cacheSize,extent:e.extent,logo:e.logo,opaque:e.opaque,projection:e.projection,state:e.state,tileGrid:e.tileGrid,tileLoadFunction:e.tileLoadFunction?e.tileLoadFunction:ol.source.TileImage.defaultTileLoadFunction,tilePixelRatio:e.tilePixelRatio,tileUrlFunction:e.tileUrlFunction,url:e.url,urls:e.urls,wrapX:e.wrapX,transition:e.transition});this.crossOrigin=void 0!==e.crossOrigin?e.crossOrigin:null;this.tileClass=void 0!==e.tileClass?e.tileClass:ol.ImageTile;this.tileCacheForProjection={};this.tileGridForProjection={};this.reprojectionErrorThreshold_=e.reprojectionErrorThreshold;this.renderReprojectionEdges_=!1};ol.inherits(ol.source.TileImage,ol.source.UrlTile);ol.source.TileImage.prototype.canExpireCache=function(){if(!ol.ENABLE_RASTER_REPROJECTION)return ol.source.UrlTile.prototype.canExpireCache.call(this);if(this.tileCache.canExpireCache())return!0;for(var e in this.tileCacheForProjection)if(this.tileCacheForProjection[e].canExpireCache())return!0;return!1};ol.source.TileImage.prototype.expireCache=function(e,t){if(ol.ENABLE_RASTER_REPROJECTION){var o=this.getTileCacheForProjection(e);this.tileCache.expireCache(this.tileCache==o?t:{});for(var r in this.tileCacheForProjection){var i=this.tileCacheForProjection[r];i.expireCache(i==o?t:{})}}else ol.source.UrlTile.prototype.expireCache.call(this,e,t)};ol.source.TileImage.prototype.getGutter=function(e){return ol.ENABLE_RASTER_REPROJECTION&&this.getProjection()&&e&&!ol.proj.equivalent(this.getProjection(),e)?0:this.getGutterInternal()};ol.source.TileImage.prototype.getGutterInternal=function(){return 0};ol.source.TileImage.prototype.getOpaque=function(e){return!(ol.ENABLE_RASTER_REPROJECTION&&this.getProjection()&&e&&!ol.proj.equivalent(this.getProjection(),e))&&ol.source.UrlTile.prototype.getOpaque.call(this,e)};ol.source.TileImage.prototype.getTileGridForProjection=function(e){if(!ol.ENABLE_RASTER_REPROJECTION)return ol.source.UrlTile.prototype.getTileGridForProjection.call(this,e);var t=this.getProjection();if(!this.tileGrid||t&&!ol.proj.equivalent(t,e)){var o=ol.getUid(e).toString();o in this.tileGridForProjection||(this.tileGridForProjection[o]=ol.tilegrid.getForProjection(e));return this.tileGridForProjection[o]}return this.tileGrid};ol.source.TileImage.prototype.getTileCacheForProjection=function(e){if(!ol.ENABLE_RASTER_REPROJECTION)return ol.source.UrlTile.prototype.getTileCacheForProjection.call(this,e);var t=this.getProjection();if(!t||ol.proj.equivalent(t,e))return this.tileCache;var o=ol.getUid(e).toString();o in this.tileCacheForProjection||(this.tileCacheForProjection[o]=new ol.TileCache(this.tileCache.highWaterMark));return this.tileCacheForProjection[o]};ol.source.TileImage.prototype.createTile_=function(e,t,o,r,i,n){var a=[e,t,o],l=this.getTileCoordForTileUrlFunction(a,i),s=l?this.tileUrlFunction(l,r,i):void 0,p=new this.tileClass(a,void 0!==s?ol.TileState.IDLE:ol.TileState.EMPTY,void 0!==s?s:"",this.crossOrigin,this.tileLoadFunction,this.tileOptions);p.key=n;ol.events.listen(p,ol.events.EventType.CHANGE,this.handleTileChange,this);return p};ol.source.TileImage.prototype.getTile=function(e,t,o,r,i){var n=this.getProjection();if(ol.ENABLE_RASTER_REPROJECTION&&n&&i&&!ol.proj.equivalent(n,i)){var a,l=this.getTileCacheForProjection(i),s=[e,t,o],p=ol.tilecoord.getKey(s);l.containsKey(p)&&(a=l.get(p));var c=this.getKey();if(a&&a.key==c)return a;var u=this.getTileGridForProjection(n),g=this.getTileGridForProjection(i),d=this.getTileCoordForTileUrlFunction(s,i),h=new ol.reproj.Tile(n,u,i,g,s,d,this.getTilePixelRatio(r),this.getGutterInternal(),function(e,t,o,r){return this.getTileInternal(e,t,o,r,n)}.bind(this),this.reprojectionErrorThreshold_,this.renderReprojectionEdges_);h.key=c;if(a){h.interimTile=a;h.refreshInterimChain();l.replace(p,h)}else l.set(p,h);return h}return this.getTileInternal(e,t,o,r,n||i)};ol.source.TileImage.prototype.getTileInternal=function(e,t,o,r,i){var n=null,a=ol.tilecoord.getKeyZXY(e,t,o),l=this.getKey();if(this.tileCache.containsKey(a)){if((n=this.tileCache.get(a)).key!=l){var s=n;n=this.createTile_(e,t,o,r,i,l);s.getState()==ol.TileState.IDLE?n.interimTile=s.interimTile:n.interimTile=s;n.refreshInterimChain();this.tileCache.replace(a,n)}}else{n=this.createTile_(e,t,o,r,i,l);this.tileCache.set(a,n)}return n};ol.source.TileImage.prototype.setRenderReprojectionEdges=function(e){if(ol.ENABLE_RASTER_REPROJECTION&&this.renderReprojectionEdges_!=e){this.renderReprojectionEdges_=e;for(var t in this.tileCacheForProjection)this.tileCacheForProjection[t].clear();this.changed()}};ol.source.TileImage.prototype.setTileGridForProjection=function(e,t){if(ol.ENABLE_RASTER_REPROJECTION){var o=ol.proj.get(e);if(o){var r=ol.getUid(o).toString();r in this.tileGridForProjection||(this.tileGridForProjection[r]=t)}}};ol.source.TileImage.defaultTileLoadFunction=function(e,t){e.getImage().src=t};goog.provide("ol.source.BingMaps");goog.require("ol");goog.require("ol.TileUrlFunction");goog.require("ol.extent");goog.require("ol.net");goog.require("ol.proj");goog.require("ol.source.State");goog.require("ol.source.TileImage");goog.require("ol.tilecoord");goog.require("ol.tilegrid");ol.source.BingMaps=function(e){this.hidpi_=void 0!==e.hidpi&&e.hidpi;ol.source.TileImage.call(this,{cacheSize:e.cacheSize,crossOrigin:"anonymous",opaque:!0,projection:ol.proj.get("EPSG:3857"),reprojectionErrorThreshold:e.reprojectionErrorThreshold,state:ol.source.State.LOADING,tileLoadFunction:e.tileLoadFunction,tilePixelRatio:this.hidpi_?2:1,wrapX:void 0===e.wrapX||e.wrapX,transition:e.transition});this.culture_=void 0!==e.culture?e.culture:"en-us";this.maxZoom_=void 0!==e.maxZoom?e.maxZoom:-1;this.apiKey_=e.key;this.imagerySet_=e.imagerySet;var t="https://dev.virtualearth.net/REST/v1/Imagery/Metadata/"+this.imagerySet_+"?uriScheme=https&include=ImageryProviders&key="+this.apiKey_+"&c="+this.culture_;ol.net.jsonp(t,this.handleImageryMetadataResponse.bind(this),void 0,"jsonp")};ol.inherits(ol.source.BingMaps,ol.source.TileImage);ol.source.BingMaps.TOS_ATTRIBUTION='<a class="ol-attribution-bing-tos" href="https://www.microsoft.com/maps/product/terms.html">Terms of Use</a>';ol.source.BingMaps.prototype.getApiKey=function(){return this.apiKey_};ol.source.BingMaps.prototype.getImagerySet=function(){return this.imagerySet_};ol.source.BingMaps.prototype.handleImageryMetadataResponse=function(e){if(200==e.statusCode&&"OK"==e.statusDescription&&"ValidCredentials"==e.authenticationResultCode&&1==e.resourceSets.length&&1==e.resourceSets[0].resources.length){var t=e.brandLogoUri;-1==t.indexOf("https")&&(t=t.replace("http","https"));var o=e.resourceSets[0].resources[0],r=-1==this.maxZoom_?o.zoomMax:this.maxZoom_,i=this.getProjection(),n=ol.tilegrid.extentFromProjection(i),a=o.imageWidth==o.imageHeight?o.imageWidth:[o.imageWidth,o.imageHeight],l=ol.tilegrid.createXYZ({extent:n,minZoom:o.zoomMin,maxZoom:r,tileSize:a/(this.hidpi_?2:1)});this.tileGrid=l;var s=this.culture_,p=this.hidpi_;this.tileUrlFunction=ol.TileUrlFunction.createFromTileUrlFunctions(o.imageUrlSubdomains.map(function(e){var t=[0,0,0],r=o.imageUrl.replace("{subdomain}",e).replace("{culture}",s);return function(e,o,i){if(e){ol.tilecoord.createOrUpdate(e[0],e[1],-e[2]-1,t);var n=r;p&&(n+="&dpi=d1&device=mobile");return n.replace("{quadkey}",ol.tilecoord.quadKey(t))}}}));if(o.imageryProviders){var c=ol.proj.getTransformFromProjections(ol.proj.get("EPSG:4326"),this.getProjection());this.setAttributions(function(e){var t=[],r=e.viewState.zoom;o.imageryProviders.map(function(o){for(var i=!1,n=o.coverageAreas,a=0,l=n.length;a<l;++a){var s=n[a];if(r>=s.zoomMin&&r<=s.zoomMax){var p=s.bbox,u=[p[1],p[0],p[3],p[2]],g=ol.extent.applyTransform(u,c);if(ol.extent.intersects(g,e.extent)){i=!0;break}}}i&&t.push(o.attribution)});t.push(ol.source.BingMaps.TOS_ATTRIBUTION);return t})}this.setLogo(t);this.setState(ol.source.State.READY)}else this.setState(ol.source.State.ERROR)};goog.provide("ol.source.XYZ");goog.require("ol");goog.require("ol.source.TileImage");goog.require("ol.tilegrid");ol.source.XYZ=function(e){var t=e||{},o=void 0!==t.projection?t.projection:"EPSG:3857",r=void 0!==t.tileGrid?t.tileGrid:ol.tilegrid.createXYZ({extent:ol.tilegrid.extentFromProjection(o),maxZoom:t.maxZoom,minZoom:t.minZoom,tileSize:t.tileSize});ol.source.TileImage.call(this,{attributions:t.attributions,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,logo:t.logo,opaque:t.opaque,projection:o,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileGrid:r,tileLoadFunction:t.tileLoadFunction,tilePixelRatio:t.tilePixelRatio,tileUrlFunction:t.tileUrlFunction,url:t.url,urls:t.urls,wrapX:void 0===t.wrapX||t.wrapX,transition:t.transition})};ol.inherits(ol.source.XYZ,ol.source.TileImage);goog.provide("ol.source.CartoDB");goog.require("ol");goog.require("ol.obj");goog.require("ol.source.State");goog.require("ol.source.XYZ");ol.source.CartoDB=function(e){this.account_=e.account;this.mapId_=e.map||"";this.config_=e.config||{};this.templateCache_={};ol.source.XYZ.call(this,{attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,logo:e.logo,maxZoom:void 0!==e.maxZoom?e.maxZoom:18,minZoom:e.minZoom,projection:e.projection,state:ol.source.State.LOADING,wrapX:e.wrapX});this.initializeMap_()};ol.inherits(ol.source.CartoDB,ol.source.XYZ);ol.source.CartoDB.prototype.getConfig=function(){return this.config_};ol.source.CartoDB.prototype.updateConfig=function(e){ol.obj.assign(this.config_,e);this.initializeMap_()};ol.source.CartoDB.prototype.setConfig=function(e){this.config_=e||{};this.initializeMap_()};ol.source.CartoDB.prototype.initializeMap_=function(){var e=JSON.stringify(this.config_);if(this.templateCache_[e])this.applyTemplate_(this.templateCache_[e]);else{var t="https://"+this.account_+".carto.com/api/v1/map";this.mapId_&&(t+="/named/"+this.mapId_);var o=new XMLHttpRequest;o.addEventListener("load",this.handleInitResponse_.bind(this,e));o.addEventListener("error",this.handleInitError_.bind(this));o.open("POST",t);o.setRequestHeader("Content-type","application/json");o.send(JSON.stringify(this.config_))}};ol.source.CartoDB.prototype.handleInitResponse_=function(e,t){var o=t.target;if(!o.status||o.status>=200&&o.status<300){var r;try{r=JSON.parse(o.responseText)}catch(e){this.setState(ol.source.State.ERROR);return}this.applyTemplate_(r);this.templateCache_[e]=r;this.setState(ol.source.State.READY)}else this.setState(ol.source.State.ERROR)};ol.source.CartoDB.prototype.handleInitError_=function(e){this.setState(ol.source.State.ERROR)};ol.source.CartoDB.prototype.applyTemplate_=function(e){var t="https://"+e.cdn_url.https+"/"+this.account_+"/api/v1/map/"+e.layergroupid+"/{z}/{x}/{y}.png";this.setUrl(t)};goog.provide("ol.source.Cluster");goog.require("ol");goog.require("ol.asserts");goog.require("ol.Feature");goog.require("ol.coordinate");goog.require("ol.events.EventType");goog.require("ol.extent");goog.require("ol.geom.Point");goog.require("ol.source.Vector");ol.source.Cluster=function(e){ol.source.Vector.call(this,{attributions:e.attributions,extent:e.extent,logo:e.logo,projection:e.projection,wrapX:e.wrapX});this.resolution=void 0;this.distance=void 0!==e.distance?e.distance:20;this.features=[];this.geometryFunction=e.geometryFunction||function(e){var t=e.getGeometry();ol.asserts.assert(t instanceof ol.geom.Point,10);return t};this.source=e.source;this.source.on(ol.events.EventType.CHANGE,ol.source.Cluster.prototype.refresh,this)};ol.inherits(ol.source.Cluster,ol.source.Vector);ol.source.Cluster.prototype.getDistance=function(){return this.distance};ol.source.Cluster.prototype.getSource=function(){return this.source};ol.source.Cluster.prototype.loadFeatures=function(e,t,o){this.source.loadFeatures(e,t,o);if(t!==this.resolution){this.clear();this.resolution=t;this.cluster();this.addFeatures(this.features)}};ol.source.Cluster.prototype.setDistance=function(e){this.distance=e;this.refresh()};ol.source.Cluster.prototype.refresh=function(){this.clear();this.cluster();this.addFeatures(this.features);ol.source.Vector.prototype.refresh.call(this)};ol.source.Cluster.prototype.cluster=function(){if(void 0!==this.resolution){this.features.length=0;for(var e=ol.extent.createEmpty(),t=this.distance*this.resolution,o=this.source.getFeatures(),r={},i=0,n=o.length;i<n;i++){var a=o[i];if(!(ol.getUid(a).toString()in r)){var l=this.geometryFunction(a);if(l){var s=l.getCoordinates();ol.extent.createOrUpdateFromCoordinate(s,e);ol.extent.buffer(e,t,e);var p=this.source.getFeaturesInExtent(e);p=p.filter(function(e){var t=ol.getUid(e).toString();if(t in r)return!1;r[t]=!0;return!0});this.features.push(this.createCluster(p))}}}}};ol.source.Cluster.prototype.createCluster=function(e){for(var t=[0,0],o=e.length-1;o>=0;--o){var r=this.geometryFunction(e[o]);r?ol.coordinate.add(t,r.getCoordinates()):e.splice(o,1)}ol.coordinate.scale(t,1/e.length);var i=new ol.Feature(new ol.geom.Point(t));i.set("features",e);return i};goog.provide("ol.source.Image");goog.require("ol");goog.require("ol.ImageState");goog.require("ol.array");goog.require("ol.events.Event");goog.require("ol.extent");goog.require("ol.proj");goog.require("ol.reproj.Image");goog.require("ol.source.Source");ol.source.Image=function(e){ol.source.Source.call(this,{attributions:e.attributions,extent:e.extent,logo:e.logo,projection:e.projection,state:e.state});this.resolutions_=void 0!==e.resolutions?e.resolutions:null;this.reprojectedImage_=null;this.reprojectedRevision_=0};ol.inherits(ol.source.Image,ol.source.Source);ol.source.Image.prototype.getResolutions=function(){return this.resolutions_};ol.source.Image.prototype.findNearestResolution=function(e){if(this.resolutions_){var t=ol.array.linearFindNearest(this.resolutions_,e,0);e=this.resolutions_[t]}return e};ol.source.Image.prototype.getImage=function(e,t,o,r){var i=this.getProjection();if(ol.ENABLE_RASTER_REPROJECTION&&i&&r&&!ol.proj.equivalent(i,r)){if(this.reprojectedImage_){if(this.reprojectedRevision_==this.getRevision()&&ol.proj.equivalent(this.reprojectedImage_.getProjection(),r)&&this.reprojectedImage_.getResolution()==t&&ol.extent.equals(this.reprojectedImage_.getExtent(),e))return this.reprojectedImage_;this.reprojectedImage_.dispose();this.reprojectedImage_=null}this.reprojectedImage_=new ol.reproj.Image(i,r,e,t,o,function(e,t,o){return this.getImageInternal(e,t,o,i)}.bind(this));this.reprojectedRevision_=this.getRevision();return this.reprojectedImage_}i&&(r=i);return this.getImageInternal(e,t,o,r)};ol.source.Image.prototype.getImageInternal=function(e,t,o,r){};ol.source.Image.prototype.handleImageChange=function(e){var t=e.target;switch(t.getState()){case ol.ImageState.LOADING:this.dispatchEvent(new ol.source.Image.Event(ol.source.Image.EventType_.IMAGELOADSTART,t));break;case ol.ImageState.LOADED:this.dispatchEvent(new ol.source.Image.Event(ol.source.Image.EventType_.IMAGELOADEND,t));break;case ol.ImageState.ERROR:this.dispatchEvent(new ol.source.Image.Event(ol.source.Image.EventType_.IMAGELOADERROR,t))}};ol.source.Image.defaultImageLoadFunction=function(e,t){e.getImage().src=t};ol.source.Image.Event=function(e,t){ol.events.Event.call(this,e);this.image=t};ol.inherits(ol.source.Image.Event,ol.events.Event);ol.source.Image.EventType_={IMAGELOADSTART:"imageloadstart",IMAGELOADEND:"imageloadend",IMAGELOADERROR:"imageloaderror"};goog.provide("ol.uri");ol.uri.appendParams=function(e,t){var o=[];Object.keys(t).forEach(function(e){null!==t[e]&&void 0!==t[e]&&o.push(e+"="+encodeURIComponent(t[e]))});var r=o.join("&");return(e=-1===(e=e.replace(/[?&]$/,"")).indexOf("?")?e+"?":e+"&")+r};goog.provide("ol.source.ImageArcGISRest");goog.require("ol");goog.require("ol.Image");goog.require("ol.asserts");goog.require("ol.events");goog.require("ol.events.EventType");goog.require("ol.extent");goog.require("ol.obj");goog.require("ol.source.Image");goog.require("ol.uri");ol.source.ImageArcGISRest=function(e){var t=e||{};ol.source.Image.call(this,{attributions:t.attributions,logo:t.logo,projection:t.projection,resolutions:t.resolutions});this.crossOrigin_=void 0!==t.crossOrigin?t.crossOrigin:null;this.hidpi_=void 0===t.hidpi||t.hidpi;this.url_=t.url;this.imageLoadFunction_=void 0!==t.imageLoadFunction?t.imageLoadFunction:ol.source.Image.defaultImageLoadFunction;this.params_=t.params||{};this.image_=null;this.imageSize_=[0,0];this.renderedRevision_=0;this.ratio_=void 0!==t.ratio?t.ratio:1.5};ol.inherits(ol.source.ImageArcGISRest,ol.source.Image);ol.source.ImageArcGISRest.prototype.getParams=function(){return this.params_};ol.source.ImageArcGISRest.prototype.getImageInternal=function(e,t,o,r){if(void 0===this.url_)return null;t=this.findNearestResolution(t);o=this.hidpi_?o:1;var i=this.image_;if(i&&this.renderedRevision_==this.getRevision()&&i.getResolution()==t&&i.getPixelRatio()==o&&ol.extent.containsExtent(i.getExtent(),e))return i;var n={F:"image",FORMAT:"PNG32",TRANSPARENT:!0};ol.obj.assign(n,this.params_);var a=((e=e.slice())[0]+e[2])/2,l=(e[1]+e[3])/2;if(1!=this.ratio_){var s=this.ratio_*ol.extent.getWidth(e)/2,p=this.ratio_*ol.extent.getHeight(e)/2;e[0]=a-s;e[1]=l-p;e[2]=a+s;e[3]=l+p}var c=t/o,u=Math.ceil(ol.extent.getWidth(e)/c),g=Math.ceil(ol.extent.getHeight(e)/c);e[0]=a-c*u/2;e[2]=a+c*u/2;e[1]=l-c*g/2;e[3]=l+c*g/2;this.imageSize_[0]=u;this.imageSize_[1]=g;var d=this.getRequestUrl_(e,this.imageSize_,o,r,n);this.image_=new ol.Image(e,t,o,d,this.crossOrigin_,this.imageLoadFunction_);this.renderedRevision_=this.getRevision();ol.events.listen(this.image_,ol.events.EventType.CHANGE,this.handleImageChange,this);return this.image_};ol.source.ImageArcGISRest.prototype.getImageLoadFunction=function(){return this.imageLoadFunction_};ol.source.ImageArcGISRest.prototype.getRequestUrl_=function(e,t,o,r,i){var n=r.getCode().split(":").pop();i.SIZE=t[0]+","+t[1];i.BBOX=e.join(",");i.BBOXSR=n;i.IMAGESR=n;i.DPI=Math.round(90*o);var a=this.url_,l=a.replace(/MapServer\/?$/,"MapServer/export").replace(/ImageServer\/?$/,"ImageServer/exportImage");l==a&&ol.asserts.assert(!1,50);return ol.uri.appendParams(l,i)};ol.source.ImageArcGISRest.prototype.getUrl=function(){return this.url_};ol.source.ImageArcGISRest.prototype.setImageLoadFunction=function(e){this.image_=null;this.imageLoadFunction_=e;this.changed()};ol.source.ImageArcGISRest.prototype.setUrl=function(e){if(e!=this.url_){this.url_=e;this.image_=null;this.changed()}};ol.source.ImageArcGISRest.prototype.updateParams=function(e){ol.obj.assign(this.params_,e);this.image_=null;this.changed()};goog.provide("ol.source.ImageCanvas");goog.require("ol");goog.require("ol.ImageCanvas");goog.require("ol.extent");goog.require("ol.source.Image");ol.source.ImageCanvas=function(e){ol.source.Image.call(this,{attributions:e.attributions,logo:e.logo,projection:e.projection,resolutions:e.resolutions,state:e.state});this.canvasFunction_=e.canvasFunction;this.canvas_=null;this.renderedRevision_=0;this.ratio_=void 0!==e.ratio?e.ratio:1.5};ol.inherits(ol.source.ImageCanvas,ol.source.Image);ol.source.ImageCanvas.prototype.getImageInternal=function(e,t,o,r){t=this.findNearestResolution(t);var i=this.canvas_;if(i&&this.renderedRevision_==this.getRevision()&&i.getResolution()==t&&i.getPixelRatio()==o&&ol.extent.containsExtent(i.getExtent(),e))return i;e=e.slice();ol.extent.scaleFromCenter(e,this.ratio_);var n=[ol.extent.getWidth(e)/t*o,ol.extent.getHeight(e)/t*o],a=this.canvasFunction_(e,t,o,n,r);a&&(i=new ol.ImageCanvas(e,t,o,a));this.canvas_=i;this.renderedRevision_=this.getRevision();return i};goog.provide("ol.source.ImageMapGuide");goog.require("ol");goog.require("ol.Image");goog.require("ol.events");goog.require("ol.events.EventType");goog.require("ol.extent");goog.require("ol.obj");goog.require("ol.source.Image");goog.require("ol.uri");ol.source.ImageMapGuide=function(e){ol.source.Image.call(this,{projection:e.projection,resolutions:e.resolutions});this.crossOrigin_=void 0!==e.crossOrigin?e.crossOrigin:null;this.displayDpi_=void 0!==e.displayDpi?e.displayDpi:96;this.params_=e.params||{};this.url_=e.url;this.imageLoadFunction_=void 0!==e.imageLoadFunction?e.imageLoadFunction:ol.source.Image.defaultImageLoadFunction;this.hidpi_=void 0===e.hidpi||e.hidpi;this.metersPerUnit_=void 0!==e.metersPerUnit?e.metersPerUnit:1;this.ratio_=void 0!==e.ratio?e.ratio:1;this.useOverlay_=void 0!==e.useOverlay&&e.useOverlay;this.image_=null;this.renderedRevision_=0};ol.inherits(ol.source.ImageMapGuide,ol.source.Image);ol.source.ImageMapGuide.prototype.getParams=function(){return this.params_};ol.source.ImageMapGuide.prototype.getImageInternal=function(e,t,o,r){t=this.findNearestResolution(t);o=this.hidpi_?o:1;var i=this.image_;if(i&&this.renderedRevision_==this.getRevision()&&i.getResolution()==t&&i.getPixelRatio()==o&&ol.extent.containsExtent(i.getExtent(),e))return i;if(1!=this.ratio_){e=e.slice();ol.extent.scaleFromCenter(e,this.ratio_)}var n=[ol.extent.getWidth(e)/t*o,ol.extent.getHeight(e)/t*o];if(void 0!==this.url_){var a=this.getUrl(this.url_,this.params_,e,n,r);i=new ol.Image(e,t,o,a,this.crossOrigin_,this.imageLoadFunction_);ol.events.listen(i,ol.events.EventType.CHANGE,this.handleImageChange,this)}else i=null;this.image_=i;this.renderedRevision_=this.getRevision();return i};ol.source.ImageMapGuide.prototype.getImageLoadFunction=function(){return this.imageLoadFunction_};ol.source.ImageMapGuide.getScale=function(e,t,o,r){var i=ol.extent.getWidth(e),n=ol.extent.getHeight(e),a=t[0],l=t[1],s=.0254/r;return l*i>a*n?i*o/(a*s):n*o/(l*s)};ol.source.ImageMapGuide.prototype.updateParams=function(e){ol.obj.assign(this.params_,e);this.changed()};ol.source.ImageMapGuide.prototype.getUrl=function(e,t,o,r,i){var n=ol.source.ImageMapGuide.getScale(o,r,this.metersPerUnit_,this.displayDpi_),a=ol.extent.getCenter(o),l={OPERATION:this.useOverlay_?"GETDYNAMICMAPOVERLAYIMAGE":"GETMAPIMAGE",VERSION:"2.0.0",LOCALE:"en",CLIENTAGENT:"ol.source.ImageMapGuide source",CLIP:"1",SETDISPLAYDPI:this.displayDpi_,SETDISPLAYWIDTH:Math.round(r[0]),SETDISPLAYHEIGHT:Math.round(r[1]),SETVIEWSCALE:n,SETVIEWCENTERX:a[0],SETVIEWCENTERY:a[1]};ol.obj.assign(l,t);return ol.uri.appendParams(e,l)};ol.source.ImageMapGuide.prototype.setImageLoadFunction=function(e){this.image_=null;this.imageLoadFunction_=e;this.changed()};goog.provide("ol.source.ImageStatic");goog.require("ol");goog.require("ol.Image");goog.require("ol.ImageState");goog.require("ol.dom");goog.require("ol.events");goog.require("ol.events.EventType");goog.require("ol.extent");goog.require("ol.proj");goog.require("ol.source.Image");ol.source.ImageStatic=function(e){var t=e.imageExtent,o=void 0!==e.crossOrigin?e.crossOrigin:null,r=void 0!==e.imageLoadFunction?e.imageLoadFunction:ol.source.Image.defaultImageLoadFunction;ol.source.Image.call(this,{attributions:e.attributions,logo:e.logo,projection:ol.proj.get(e.projection)});this.image_=new ol.Image(t,void 0,1,e.url,o,r);this.imageSize_=e.imageSize?e.imageSize:null;ol.events.listen(this.image_,ol.events.EventType.CHANGE,this.handleImageChange,this)};ol.inherits(ol.source.ImageStatic,ol.source.Image);ol.source.ImageStatic.prototype.getImageInternal=function(e,t,o,r){return ol.extent.intersects(e,this.image_.getExtent())?this.image_:null};ol.source.ImageStatic.prototype.handleImageChange=function(e){if(this.image_.getState()==ol.ImageState.LOADED){var t,o,r=this.image_.getExtent(),i=this.image_.getImage();if(this.imageSize_){t=this.imageSize_[0];o=this.imageSize_[1]}else{t=i.width;o=i.height}var n=ol.extent.getHeight(r)/o,a=Math.ceil(ol.extent.getWidth(r)/n);if(a!=t){var l=ol.dom.createCanvasContext2D(a,o),s=l.canvas;l.drawImage(i,0,0,t,o,0,0,s.width,s.height);this.image_.setImage(s)}}ol.source.Image.prototype.handleImageChange.call(this,e)};goog.provide("ol.source.ImageVector");goog.require("ol");goog.require("ol.dom");goog.require("ol.events");goog.require("ol.events.EventType");goog.require("ol.ext.rbush");goog.require("ol.extent");goog.require("ol.render.canvas.ReplayGroup");goog.require("ol.renderer.vector");goog.require("ol.source.ImageCanvas");goog.require("ol.style.Style");goog.require("ol.transform");ol.source.ImageVector=function(e){this.source_=e.source;this.transform_=ol.transform.create();this.canvasContext_=ol.dom.createCanvasContext2D();this.canvasSize_=[0,0];this.declutterTree_=ol.ext.rbush(9);this.renderBuffer_=void 0==e.renderBuffer?100:e.renderBuffer;this.replayGroup_=null;ol.source.ImageCanvas.call(this,{attributions:e.attributions,canvasFunction:this.canvasFunctionInternal_.bind(this),logo:e.logo,projection:e.projection,ratio:e.ratio,resolutions:e.resolutions,state:this.source_.getState()});this.style_=null;this.styleFunction_=void 0;this.setStyle(e.style);ol.events.listen(this.source_,ol.events.EventType.CHANGE,this.handleSourceChange_,this)};ol.inherits(ol.source.ImageVector,ol.source.ImageCanvas);ol.source.ImageVector.prototype.canvasFunctionInternal_=function(e,t,o,r,i){var n=new ol.render.canvas.ReplayGroup(ol.renderer.vector.getTolerance(t,o),e,t,o,this.source_.getOverlaps(),this.declutterTree_,this.renderBuffer_);this.source_.loadFeatures(e,t,i);var a=!1;this.source_.forEachFeatureInExtent(e,function(e){a=a||this.renderFeature_(e,t,o,n)},this);n.finish();if(a)return null;if(this.canvasSize_[0]!=r[0]||this.canvasSize_[1]!=r[1]){this.canvasContext_.canvas.width=r[0];this.canvasContext_.canvas.height=r[1];this.canvasSize_[0]=r[0];this.canvasSize_[1]=r[1]}else this.canvasContext_.clearRect(0,0,r[0],r[1]);this.declutterTree_.clear();var l=this.getTransform_(ol.extent.getCenter(e),t,o,r);n.replay(this.canvasContext_,l,0,{});this.replayGroup_=n;return this.canvasContext_.canvas};ol.source.ImageVector.prototype.forEachFeatureAtCoordinate=function(e,t,o,r,i,n){if(this.replayGroup_){var a={};return this.replayGroup_.forEachFeatureAtCoordinate(e,t,0,r,i,function(e){var t=ol.getUid(e).toString();if(!(t in a)){a[t]=!0;return n(e)}},null)}};ol.source.ImageVector.prototype.getSource=function(){return this.source_};ol.source.ImageVector.prototype.getStyle=function(){return this.style_};ol.source.ImageVector.prototype.getStyleFunction=function(){return this.styleFunction_};ol.source.ImageVector.prototype.getTransform_=function(e,t,o,r){var i=r[0]/2,n=r[1]/2,a=o/t,l=-a,s=-e[0],p=-e[1];return ol.transform.compose(this.transform_,i,n,a,l,0,s,p)};ol.source.ImageVector.prototype.handleImageChange_=function(e){this.changed()};ol.source.ImageVector.prototype.handleSourceChange_=function(){this.setState(this.source_.getState())};ol.source.ImageVector.prototype.renderFeature_=function(e,t,o,r){var i,n=e.getStyleFunction();n?i=n.call(e,t):this.styleFunction_&&(i=this.styleFunction_(e,t));if(!i)return!1;var a,l,s=!1;Array.isArray(i)||(i=[i]);for(a=0,l=i.length;a<l;++a)s=ol.renderer.vector.renderFeature(r,e,i[a],ol.renderer.vector.getSquaredTolerance(t,o),this.handleImageChange_,this)||s;return s};ol.source.ImageVector.prototype.setStyle=function(e){this.style_=void 0!==e?e:ol.style.Style.defaultFunction;this.styleFunction_=e?ol.style.Style.createFunction(this.style_):void 0;this.changed()};goog.provide("ol.source.WMSServerType");ol.source.WMSServerType={CARMENTA_SERVER:"carmentaserver",GEOSERVER:"geoserver",MAPSERVER:"mapserver",QGIS:"qgis"};goog.provide("ol.source.ImageWMS");goog.require("ol");goog.require("ol.Image");goog.require("ol.asserts");goog.require("ol.events");goog.require("ol.events.EventType");goog.require("ol.extent");goog.require("ol.obj");goog.require("ol.proj");goog.require("ol.reproj");goog.require("ol.source.Image");goog.require("ol.source.WMSServerType");goog.require("ol.string");goog.require("ol.uri");ol.source.ImageWMS=function(e){var t=e||{};ol.source.Image.call(this,{attributions:t.attributions,logo:t.logo,projection:t.projection,resolutions:t.resolutions});this.crossOrigin_=void 0!==t.crossOrigin?t.crossOrigin:null;this.url_=t.url;this.imageLoadFunction_=void 0!==t.imageLoadFunction?t.imageLoadFunction:ol.source.Image.defaultImageLoadFunction;this.params_=t.params||{};this.v13_=!0;this.updateV13_();this.serverType_=t.serverType;this.hidpi_=void 0===t.hidpi||t.hidpi;this.image_=null;this.imageSize_=[0,0];this.renderedRevision_=0;this.ratio_=void 0!==t.ratio?t.ratio:1.5};ol.inherits(ol.source.ImageWMS,ol.source.Image);ol.source.ImageWMS.GETFEATUREINFO_IMAGE_SIZE_=[101,101];ol.source.ImageWMS.prototype.getGetFeatureInfoUrl=function(e,t,o,r){if(void 0!==this.url_){var i=ol.proj.get(o),n=this.getProjection();if(n&&n!==i){t=ol.reproj.calculateSourceResolution(n,i,e,t);e=ol.proj.transform(e,i,n)}var a=ol.extent.getForViewAndSize(e,t,0,ol.source.ImageWMS.GETFEATUREINFO_IMAGE_SIZE_),l={SERVICE:"WMS",VERSION:ol.DEFAULT_WMS_VERSION,REQUEST:"GetFeatureInfo",FORMAT:"image/png",TRANSPARENT:!0,QUERY_LAYERS:this.params_.LAYERS};ol.obj.assign(l,this.params_,r);var s=Math.floor((e[0]-a[0])/t),p=Math.floor((a[3]-e[1])/t);l[this.v13_?"I":"X"]=s;l[this.v13_?"J":"Y"]=p;return this.getRequestUrl_(a,ol.source.ImageWMS.GETFEATUREINFO_IMAGE_SIZE_,1,n||i,l)}};ol.source.ImageWMS.prototype.getParams=function(){return this.params_};ol.source.ImageWMS.prototype.getImageInternal=function(e,t,o,r){if(void 0===this.url_)return null;t=this.findNearestResolution(t);1==o||this.hidpi_&&void 0!==this.serverType_||(o=1);var i=t/o,n=ol.extent.getCenter(e),a=Math.ceil(ol.extent.getWidth(e)/i),l=Math.ceil(ol.extent.getHeight(e)/i),s=ol.extent.getForViewAndSize(n,i,0,[a,l]),p=Math.ceil(this.ratio_*ol.extent.getWidth(e)/i),c=Math.ceil(this.ratio_*ol.extent.getHeight(e)/i),u=ol.extent.getForViewAndSize(n,i,0,[p,c]),g=this.image_;if(g&&this.renderedRevision_==this.getRevision()&&g.getResolution()==t&&g.getPixelRatio()==o&&ol.extent.containsExtent(g.getExtent(),s))return g;var d={SERVICE:"WMS",VERSION:ol.DEFAULT_WMS_VERSION,REQUEST:"GetMap",FORMAT:"image/png",TRANSPARENT:!0};ol.obj.assign(d,this.params_);this.imageSize_[0]=Math.round(ol.extent.getWidth(u)/i);this.imageSize_[1]=Math.round(ol.extent.getHeight(u)/i);var h=this.getRequestUrl_(u,this.imageSize_,o,r,d);this.image_=new ol.Image(u,t,o,h,this.crossOrigin_,this.imageLoadFunction_);this.renderedRevision_=this.getRevision();ol.events.listen(this.image_,ol.events.EventType.CHANGE,this.handleImageChange,this);return this.image_};ol.source.ImageWMS.prototype.getImageLoadFunction=function(){return this.imageLoadFunction_};ol.source.ImageWMS.prototype.getRequestUrl_=function(e,t,o,r,i){ol.asserts.assert(void 0!==this.url_,9);i[this.v13_?"CRS":"SRS"]=r.getCode();"STYLES"in this.params_||(i.STYLES="");if(1!=o)switch(this.serverType_){case ol.source.WMSServerType.GEOSERVER:var n=90*o+.5|0;"FORMAT_OPTIONS"in i?i.FORMAT_OPTIONS+=";dpi:"+n:i.FORMAT_OPTIONS="dpi:"+n;break;case ol.source.WMSServerType.MAPSERVER:i.MAP_RESOLUTION=90*o;break;case ol.source.WMSServerType.CARMENTA_SERVER:case ol.source.WMSServerType.QGIS:i.DPI=90*o;break;default:ol.asserts.assert(!1,8)}i.WIDTH=t[0];i.HEIGHT=t[1];var a,l=r.getAxisOrientation();a=this.v13_&&"ne"==l.substr(0,2)?[e[1],e[0],e[3],e[2]]:e;i.BBOX=a.join(",");return ol.uri.appendParams(this.url_,i)};ol.source.ImageWMS.prototype.getUrl=function(){return this.url_};ol.source.ImageWMS.prototype.setImageLoadFunction=function(e){this.image_=null;this.imageLoadFunction_=e;this.changed()};ol.source.ImageWMS.prototype.setUrl=function(e){if(e!=this.url_){this.url_=e;this.image_=null;this.changed()}};ol.source.ImageWMS.prototype.updateParams=function(e){ol.obj.assign(this.params_,e);this.updateV13_();this.image_=null;this.changed()};ol.source.ImageWMS.prototype.updateV13_=function(){var e=this.params_.VERSION||ol.DEFAULT_WMS_VERSION;this.v13_=ol.string.compareVersions(e,"1.3")>=0};goog.provide("ol.source.OSM");goog.require("ol");goog.require("ol.source.XYZ");ol.source.OSM=function(e){var t,o=e||{};t=void 0!==o.attributions?o.attributions:[ol.source.OSM.ATTRIBUTION];var r=void 0!==o.crossOrigin?o.crossOrigin:"anonymous",i=void 0!==o.url?o.url:"https://{a-c}.tile.openstreetmap.org/{z}/{x}/{y}.png";ol.source.XYZ.call(this,{attributions:t,cacheSize:o.cacheSize,crossOrigin:r,opaque:void 0===o.opaque||o.opaque,maxZoom:void 0!==o.maxZoom?o.maxZoom:19,reprojectionErrorThreshold:o.reprojectionErrorThreshold,tileLoadFunction:o.tileLoadFunction,url:i,wrapX:o.wrapX})};ol.inherits(ol.source.OSM,ol.source.XYZ);ol.source.OSM.ATTRIBUTION='&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors.';goog.provide("ol.ext.pixelworks.Processor");ol.ext.pixelworks.Processor=function(){};(function(){!function(e){"use strict";var t=!0;try{new ImageData(10,10)}catch(e){t=!1}var o=document.createElement("canvas").getContext("2d");var r={newImageData:function(e,r,i){if(t)return new ImageData(e,r,i);var n=o.createImageData(r,i);n.data.set(e);return n}}.newImageData;function i(e){var t=!0;try{new ImageData(10,10)}catch(e){t=!1}function o(e,o,r){return t?new ImageData(e,o,r):{data:e,width:o,height:r}}return function(t){var r,i,n=t.buffers,a=t.meta,l=t.imageOps,s=t.width,p=t.height,c=n.length,u=n[0].byteLength;if(l){var g=new Array(c);for(i=0;i<c;++i)g[i]=o(new Uint8ClampedArray(n[i]),s,p);r=e(g,a).data}else{r=new Uint8ClampedArray(u);var d=new Array(c),h=new Array(c);for(i=0;i<c;++i){d[i]=new Uint8ClampedArray(n[i]);h[i]=[0,0,0,0]}for(var f=0;f<u;f+=4){for(var y=0;y<c;++y){var m=d[y];h[y][0]=m[f];h[y][1]=m[f+1];h[y][2]=m[f+2];h[y][3]=m[f+3]}var v=e(h,a);r[f]=v[0];r[f+1]=v[1];r[f+2]=v[2];r[f+3]=v[3]}}return r.buffer}}function n(e,t){var o=Object.keys(e.lib||{}).map(function(t){return"var "+t+" = "+e.lib[t].toString()+";"}).concat(["var __minion__ = ("+i.toString()+")(",e.operation.toString(),");",'self.addEventListener("message", function(event) {',"  var buffer = __minion__(event.data);","  self.postMessage({buffer: buffer, meta: event.data.meta}, [buffer]);","});"]),r=new Blob(o,{type:"text/javascript"}),n=URL.createObjectURL(r),a=new Worker(n);a.addEventListener("message",t);return a}function a(e){this._imageOps=!!e.imageOps;var t,o=[];if(t=0===e.threads?0:this._imageOps?1:e.threads||1)for(var r=0;r<t;++r)o[r]=n(e,this._onWorkerMessage.bind(this,r));else o[0]=function(e,t){var o=i(e.operation);return{postMessage:function(e){setTimeout(function(){t({data:{buffer:o(e),meta:e.meta}})},0)}}}(e,this._onWorkerMessage.bind(this,0));this._workers=o;this._queue=[];this._maxQueueLength=e.queue||1/0;this._running=0;this._dataLookup={};this._job=null}a.prototype.process=function(e,t,o){this._enqueue({inputs:e,meta:t,callback:o});this._dispatch()};a.prototype.destroy=function(){for(var e in this)this[e]=null;this._destroyed=!0};a.prototype._enqueue=function(e){this._queue.push(e);for(;this._queue.length>this._maxQueueLength;)this._queue.shift().callback(null,null)};a.prototype._dispatch=function(){if(0===this._running&&this._queue.length>0){var e=this._job=this._queue.shift(),t=e.inputs[0].width,o=e.inputs[0].height,r=e.inputs.map(function(e){return e.data.buffer}),i=this._workers.length;this._running=i;if(1===i)this._workers[0].postMessage({buffers:r,meta:e.meta,imageOps:this._imageOps,width:t,height:o},r);else for(var n=e.inputs[0].data.length,a=4*Math.ceil(n/4/i),l=0;l<i;++l){for(var s=l*a,p=[],c=0,u=r.length;c<u;++c)p.push(r[l].slice(s,s+a));this._workers[l].postMessage({buffers:p,meta:e.meta,imageOps:this._imageOps,width:t,height:o},p)}}};a.prototype._onWorkerMessage=function(e,t){if(!this._destroyed){this._dataLookup[e]=t.data;--this._running;0===this._running&&this._resolveJob()}};a.prototype._resolveJob=function(){var e,t,o=this._job,i=this._workers.length;if(1===i){e=new Uint8ClampedArray(this._dataLookup[0].buffer);t=this._dataLookup[0].meta}else{var n=o.inputs[0].data.length;e=new Uint8ClampedArray(n);t=new Array(n);for(var a=4*Math.ceil(n/4/i),l=0;l<i;++l){var s=this._dataLookup[l].buffer,p=l*a;e.set(new Uint8ClampedArray(s),p);t[l]=this._dataLookup[l].meta}}this._job=null;this._dataLookup={};o.callback(null,r(e,o.inputs[0].width,o.inputs[0].height),t);this._dispatch()};var l=a,s={Processor:l};e.default=s;e.Processor=l}(this.pixelworks=this.pixelworks||{})}).call(ol.ext);goog.provide("ol.source.RasterOperationType");ol.source.RasterOperationType={PIXEL:"pixel",IMAGE:"image"};goog.provide("ol.source.Raster");goog.require("ol");goog.require("ol.ImageCanvas");goog.require("ol.TileQueue");goog.require("ol.dom");goog.require("ol.events");goog.require("ol.events.Event");goog.require("ol.events.EventType");goog.require("ol.ext.pixelworks.Processor");goog.require("ol.extent");goog.require("ol.layer.Image");goog.require("ol.layer.Tile");goog.require("ol.obj");goog.require("ol.renderer.canvas.ImageLayer");goog.require("ol.renderer.canvas.TileLayer");goog.require("ol.source.Image");goog.require("ol.source.RasterOperationType");goog.require("ol.source.State");goog.require("ol.source.Tile");goog.require("ol.transform");ol.source.Raster=function(e){this.worker_=null;this.operationType_=void 0!==e.operationType?e.operationType:ol.source.RasterOperationType.PIXEL;this.threads_=void 0!==e.threads?e.threads:1;this.renderers_=ol.source.Raster.createRenderers_(e.sources);for(var t=0,o=this.renderers_.length;t<o;++t)ol.events.listen(this.renderers_[t],ol.events.EventType.CHANGE,this.changed,this);this.tileQueue_=new ol.TileQueue(function(){return 1},this.changed.bind(this));for(var r=ol.source.Raster.getLayerStatesArray_(this.renderers_),i={},n=0,a=r.length;n<a;++n)i[ol.getUid(r[n].layer)]=r[n];this.requestedFrameState_;this.renderedImageCanvas_=null;this.renderedRevision_;this.frameState_={animate:!1,coordinateToPixelTransform:ol.transform.create(),extent:null,focus:null,index:0,layerStates:i,layerStatesArray:r,logos:{},pixelRatio:1,pixelToCoordinateTransform:ol.transform.create(),postRenderFunctions:[],size:[0,0],skippedFeatureUids:{},tileQueue:this.tileQueue_,time:Date.now(),usedTiles:{},viewState:{rotation:0},viewHints:[],wantedTiles:{}};ol.source.Image.call(this,{});void 0!==e.operation&&this.setOperation(e.operation,e.lib)};ol.inherits(ol.source.Raster,ol.source.Image);ol.source.Raster.prototype.setOperation=function(e,t){this.worker_=new ol.ext.pixelworks.Processor({operation:e,imageOps:this.operationType_===ol.source.RasterOperationType.IMAGE,queue:1,lib:t,threads:this.threads_});this.changed()};ol.source.Raster.prototype.updateFrameState_=function(e,t,o){var r=ol.obj.assign({},this.frameState_);r.viewState=ol.obj.assign({},r.viewState);var i=ol.extent.getCenter(e);r.extent=e.slice();r.focus=i;r.size[0]=Math.round(ol.extent.getWidth(e)/t);r.size[1]=Math.round(ol.extent.getHeight(e)/t);r.time=Date.now();r.animate=!1;var n=r.viewState;n.center=i;n.projection=o;n.resolution=t;return r};ol.source.Raster.prototype.allSourcesReady_=function(){for(var e=!0,t=0,o=this.renderers_.length;t<o;++t)if(this.renderers_[t].getLayer().getSource().getState()!==ol.source.State.READY){e=!1;break}return e};ol.source.Raster.prototype.getImage=function(e,t,o,r){if(!this.allSourcesReady_())return null;var i=this.updateFrameState_(e,t,r);this.requestedFrameState_=i;if(this.renderedImageCanvas_){var n=this.renderedImageCanvas_.getResolution(),a=this.renderedImageCanvas_.getExtent();t===n&&ol.extent.equals(e,a)||(this.renderedImageCanvas_=null)}this.renderedImageCanvas_&&this.getRevision()===this.renderedRevision_||this.processSources_();i.tileQueue.loadMoreTiles(16,16);i.animate&&requestAnimationFrame(this.changed.bind(this));return this.renderedImageCanvas_};ol.source.Raster.prototype.processSources_=function(){for(var e=this.requestedFrameState_,t=this.renderers_.length,o=new Array(t),r=0;r<t;++r){var i=ol.source.Raster.getImageData_(this.renderers_[r],e,e.layerStatesArray[r]);if(!i)return;o[r]=i}var n={};this.dispatchEvent(new ol.source.Raster.Event(ol.source.Raster.EventType_.BEFOREOPERATIONS,e,n));this.worker_.process(o,n,this.onWorkerComplete_.bind(this,e))};ol.source.Raster.prototype.onWorkerComplete_=function(e,t,o,r){if(!t&&o){var i=e.extent,n=e.viewState.resolution;if(n===this.requestedFrameState_.viewState.resolution&&ol.extent.equals(i,this.requestedFrameState_.extent)){var a;if(this.renderedImageCanvas_)a=this.renderedImageCanvas_.getImage().getContext("2d");else{var l=Math.round(ol.extent.getWidth(i)/n),s=Math.round(ol.extent.getHeight(i)/n);a=ol.dom.createCanvasContext2D(l,s);this.renderedImageCanvas_=new ol.ImageCanvas(i,n,1,a.canvas)}a.putImageData(o,0,0);this.changed();this.renderedRevision_=this.getRevision();this.dispatchEvent(new ol.source.Raster.Event(ol.source.Raster.EventType_.AFTEROPERATIONS,e,r))}}};ol.source.Raster.getImageData_=function(e,t,o){if(!e.prepareFrame(t,o))return null;var r=t.size[0],i=t.size[1];if(ol.source.Raster.context_){var n=ol.source.Raster.context_.canvas;n.width!==r||n.height!==i?ol.source.Raster.context_=ol.dom.createCanvasContext2D(r,i):ol.source.Raster.context_.clearRect(0,0,r,i)}else ol.source.Raster.context_=ol.dom.createCanvasContext2D(r,i);e.composeFrame(t,o,ol.source.Raster.context_);return ol.source.Raster.context_.getImageData(0,0,r,i)};ol.source.Raster.context_=null;ol.source.Raster.getLayerStatesArray_=function(e){return e.map(function(e){return e.getLayer().getLayerState()})};ol.source.Raster.createRenderers_=function(e){for(var t=e.length,o=new Array(t),r=0;r<t;++r)o[r]=ol.source.Raster.createRenderer_(e[r]);return o};ol.source.Raster.createRenderer_=function(e){var t=null;e instanceof ol.source.Tile?t=ol.source.Raster.createTileRenderer_(e):e instanceof ol.source.Image&&(t=ol.source.Raster.createImageRenderer_(e));return t};ol.source.Raster.createImageRenderer_=function(e){var t=new ol.layer.Image({source:e});return new ol.renderer.canvas.ImageLayer(t)};ol.source.Raster.createTileRenderer_=function(e){var t=new ol.layer.Tile({source:e});return new ol.renderer.canvas.TileLayer(t)};ol.source.Raster.Event=function(e,t,o){ol.events.Event.call(this,e);this.extent=t.extent;this.resolution=t.viewState.resolution/t.pixelRatio;this.data=o};ol.inherits(ol.source.Raster.Event,ol.events.Event);ol.source.Raster.prototype.getImageInternal=function(){return null};ol.source.Raster.EventType_={BEFOREOPERATIONS:"beforeoperations",AFTEROPERATIONS:"afteroperations"};goog.provide("ol.source.Stamen");goog.require("ol");goog.require("ol.source.OSM");goog.require("ol.source.XYZ");ol.source.Stamen=function(e){var t=e.layer.indexOf("-"),o=-1==t?e.layer:e.layer.slice(0,t),r=ol.source.Stamen.ProviderConfig[o],i=ol.source.Stamen.LayerConfig[e.layer],n=void 0!==e.url?e.url:"https://stamen-tiles-{a-d}.a.ssl.fastly.net/"+e.layer+"/{z}/{x}/{y}."+i.extension;ol.source.XYZ.call(this,{attributions:ol.source.Stamen.ATTRIBUTIONS,cacheSize:e.cacheSize,crossOrigin:"anonymous",maxZoom:void 0!=e.maxZoom?e.maxZoom:r.maxZoom,minZoom:void 0!=e.minZoom?e.minZoom:r.minZoom,opaque:i.opaque,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileLoadFunction:e.tileLoadFunction,url:n,wrapX:e.wrapX})};ol.inherits(ol.source.Stamen,ol.source.XYZ);ol.source.Stamen.ATTRIBUTIONS=['Map tiles by <a href="https://stamen.com/">Stamen Design</a>, under <a href="https://creativecommons.org/licenses/by/3.0/">CC BY 3.0</a>.',ol.source.OSM.ATTRIBUTION];ol.source.Stamen.LayerConfig={terrain:{extension:"jpg",opaque:!0},"terrain-background":{extension:"jpg",opaque:!0},"terrain-labels":{extension:"png",opaque:!1},"terrain-lines":{extension:"png",opaque:!1},"toner-background":{extension:"png",opaque:!0},toner:{extension:"png",opaque:!0},"toner-hybrid":{extension:"png",opaque:!1},"toner-labels":{extension:"png",opaque:!1},"toner-lines":{extension:"png",opaque:!1},"toner-lite":{extension:"png",opaque:!0},watercolor:{extension:"jpg",opaque:!0}};ol.source.Stamen.ProviderConfig={terrain:{minZoom:4,maxZoom:18},toner:{minZoom:0,maxZoom:20},watercolor:{minZoom:1,maxZoom:16}};goog.provide("ol.source.TileArcGISRest");goog.require("ol");goog.require("ol.extent");goog.require("ol.math");goog.require("ol.obj");goog.require("ol.size");goog.require("ol.source.TileImage");goog.require("ol.tilecoord");goog.require("ol.uri");ol.source.TileArcGISRest=function(e){var t=e||{};ol.source.TileImage.call(this,{attributions:t.attributions,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,logo:t.logo,projection:t.projection,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileGrid:t.tileGrid,tileLoadFunction:t.tileLoadFunction,url:t.url,urls:t.urls,wrapX:void 0===t.wrapX||t.wrapX,transition:t.transition});this.params_=t.params||{};this.tmpExtent_=ol.extent.createEmpty();this.setKey(this.getKeyForParams_())};ol.inherits(ol.source.TileArcGISRest,ol.source.TileImage);ol.source.TileArcGISRest.prototype.getKeyForParams_=function(){var e=0,t=[];for(var o in this.params_)t[e++]=o+"-"+this.params_[o];return t.join("/")};ol.source.TileArcGISRest.prototype.getParams=function(){return this.params_};ol.source.TileArcGISRest.prototype.getRequestUrl_=function(e,t,o,r,i,n){var a=this.urls;if(a){var l,s=i.getCode().split(":").pop();n.SIZE=t[0]+","+t[1];n.BBOX=o.join(",");n.BBOXSR=s;n.IMAGESR=s;n.DPI=Math.round(n.DPI?n.DPI*r:90*r);if(1==a.length)l=a[0];else{l=a[ol.math.modulo(ol.tilecoord.hash(e),a.length)]}var p=l.replace(/MapServer\/?$/,"MapServer/export").replace(/ImageServer\/?$/,"ImageServer/exportImage");return ol.uri.appendParams(p,n)}};ol.source.TileArcGISRest.prototype.getTilePixelRatio=function(e){return e};ol.source.TileArcGISRest.prototype.fixedTileUrlFunction=function(e,t,o){var r=this.getTileGrid();r||(r=this.getTileGridForProjection(o));if(!(r.getResolutions().length<=e[0])){var i=r.getTileCoordExtent(e,this.tmpExtent_),n=ol.size.toSize(r.getTileSize(e[0]),this.tmpSize);1!=t&&(n=ol.size.scale(n,t,this.tmpSize));var a={F:"image",FORMAT:"PNG32",TRANSPARENT:!0};ol.obj.assign(a,this.params_);return this.getRequestUrl_(e,n,i,t,o,a)}};ol.source.TileArcGISRest.prototype.updateParams=function(e){ol.obj.assign(this.params_,e);this.setKey(this.getKeyForParams_())};goog.provide("ol.source.TileDebug");goog.require("ol");goog.require("ol.Tile");goog.require("ol.TileState");goog.require("ol.dom");goog.require("ol.size");goog.require("ol.source.Tile");goog.require("ol.tilecoord");ol.source.TileDebug=function(e){ol.source.Tile.call(this,{opaque:!1,projection:e.projection,tileGrid:e.tileGrid,wrapX:void 0===e.wrapX||e.wrapX})};ol.inherits(ol.source.TileDebug,ol.source.Tile);ol.source.TileDebug.prototype.getTile=function(e,t,o){var r=ol.tilecoord.getKeyZXY(e,t,o);if(this.tileCache.containsKey(r))return this.tileCache.get(r);var i=ol.size.toSize(this.tileGrid.getTileSize(e)),n=[e,t,o],a=this.getTileCoordForTileUrlFunction(n),l=a?this.getTileCoordForTileUrlFunction(a).toString():"",s=new ol.source.TileDebug.Tile_(n,i,l);this.tileCache.set(r,s);return s};ol.source.TileDebug.Tile_=function(e,t,o){ol.Tile.call(this,e,ol.TileState.LOADED);this.tileSize_=t;this.text_=o;this.canvas_=null};ol.inherits(ol.source.TileDebug.Tile_,ol.Tile);ol.source.TileDebug.Tile_.prototype.getImage=function(){if(this.canvas_)return this.canvas_;var e=this.tileSize_,t=ol.dom.createCanvasContext2D(e[0],e[1]);t.strokeStyle="black";t.strokeRect(.5,.5,e[0]+.5,e[1]+.5);t.fillStyle="black";t.textAlign="center";t.textBaseline="middle";t.font="24px sans-serif";t.fillText(this.text_,e[0]/2,e[1]/2);this.canvas_=t.canvas;return t.canvas};ol.source.TileDebug.Tile_.prototype.load=function(){};goog.provide("ol.source.TileJSON");goog.require("ol");goog.require("ol.TileUrlFunction");goog.require("ol.asserts");goog.require("ol.extent");goog.require("ol.net");goog.require("ol.proj");goog.require("ol.source.State");goog.require("ol.source.TileImage");goog.require("ol.tilegrid");ol.source.TileJSON=function(e){this.tileJSON_=null;ol.source.TileImage.call(this,{attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,projection:ol.proj.get("EPSG:3857"),reprojectionErrorThreshold:e.reprojectionErrorThreshold,state:ol.source.State.LOADING,tileLoadFunction:e.tileLoadFunction,wrapX:void 0===e.wrapX||e.wrapX,transition:e.transition});if(e.url)if(e.jsonp)ol.net.jsonp(e.url,this.handleTileJSONResponse.bind(this),this.handleTileJSONError.bind(this));else{var t=new XMLHttpRequest;t.addEventListener("load",this.onXHRLoad_.bind(this));t.addEventListener("error",this.onXHRError_.bind(this));t.open("GET",e.url);t.send()}else e.tileJSON?this.handleTileJSONResponse(e.tileJSON):ol.asserts.assert(!1,51)};ol.inherits(ol.source.TileJSON,ol.source.TileImage);ol.source.TileJSON.prototype.onXHRLoad_=function(e){var t=e.target;if(!t.status||t.status>=200&&t.status<300){var o;try{o=JSON.parse(t.responseText)}catch(e){this.handleTileJSONError();return}this.handleTileJSONResponse(o)}else this.handleTileJSONError()};ol.source.TileJSON.prototype.onXHRError_=function(e){this.handleTileJSONError()};ol.source.TileJSON.prototype.getTileJSON=function(){return this.tileJSON_};ol.source.TileJSON.prototype.handleTileJSONResponse=function(e){var t,o=ol.proj.get("EPSG:4326"),r=this.getProjection();if(void 0!==e.bounds){var i=ol.proj.getTransformFromProjections(o,r);t=ol.extent.applyTransform(e.bounds,i)}var n=e.minzoom||0,a=e.maxzoom||22,l=ol.tilegrid.createXYZ({extent:ol.tilegrid.extentFromProjection(r),maxZoom:a,minZoom:n});this.tileGrid=l;this.tileUrlFunction=ol.TileUrlFunction.createFromTemplates(e.tiles,l);if(void 0!==e.attribution&&!this.getAttributions2()){var s=void 0!==t?t:o.getExtent();this.setAttributions(function(t){return ol.extent.intersects(s,t.extent)?[e.attribution]:null})}this.tileJSON_=e;this.setState(ol.source.State.READY)};ol.source.TileJSON.prototype.handleTileJSONError=function(){this.setState(ol.source.State.ERROR)};goog.provide("ol.source.TileUTFGrid");goog.require("ol");goog.require("ol.Tile");goog.require("ol.TileState");goog.require("ol.TileUrlFunction");goog.require("ol.asserts");goog.require("ol.events");goog.require("ol.events.EventType");goog.require("ol.extent");goog.require("ol.net");goog.require("ol.proj");goog.require("ol.source.State");goog.require("ol.source.Tile");goog.require("ol.tilecoord");goog.require("ol.tilegrid");ol.source.TileUTFGrid=function(e){ol.source.Tile.call(this,{projection:ol.proj.get("EPSG:3857"),state:ol.source.State.LOADING});this.preemptive_=void 0===e.preemptive||e.preemptive;this.tileUrlFunction_=ol.TileUrlFunction.nullTileUrlFunction;this.template_=void 0;this.jsonp_=e.jsonp||!1;if(e.url)if(this.jsonp_)ol.net.jsonp(e.url,this.handleTileJSONResponse.bind(this),this.handleTileJSONError.bind(this));else{var t=new XMLHttpRequest;t.addEventListener("load",this.onXHRLoad_.bind(this));t.addEventListener("error",this.onXHRError_.bind(this));t.open("GET",e.url);t.send()}else e.tileJSON?this.handleTileJSONResponse(e.tileJSON):ol.asserts.assert(!1,51)};ol.inherits(ol.source.TileUTFGrid,ol.source.Tile);ol.source.TileUTFGrid.prototype.onXHRLoad_=function(e){var t=e.target;if(!t.status||t.status>=200&&t.status<300){var o;try{o=JSON.parse(t.responseText)}catch(e){this.handleTileJSONError();return}this.handleTileJSONResponse(o)}else this.handleTileJSONError()};ol.source.TileUTFGrid.prototype.onXHRError_=function(e){this.handleTileJSONError()};ol.source.TileUTFGrid.prototype.getTemplate=function(){return this.template_};ol.source.TileUTFGrid.prototype.forDataAtCoordinateAndResolution=function(e,t,o,r,i){if(this.tileGrid){var n=this.tileGrid.getTileCoordForCoordAndResolution(e,t);this.getTile(n[0],n[1],n[2],1,this.getProjection()).forDataAtCoordinate(e,o,r,i)}else!0===i?setTimeout(function(){o.call(r,null)},0):o.call(r,null)};ol.source.TileUTFGrid.prototype.handleTileJSONError=function(){this.setState(ol.source.State.ERROR)};ol.source.TileUTFGrid.prototype.handleTileJSONResponse=function(e){var t,o=ol.proj.get("EPSG:4326"),r=this.getProjection();if(void 0!==e.bounds){var i=ol.proj.getTransformFromProjections(o,r);t=ol.extent.applyTransform(e.bounds,i)}var n=e.minzoom||0,a=e.maxzoom||22,l=ol.tilegrid.createXYZ({extent:ol.tilegrid.extentFromProjection(r),maxZoom:a,minZoom:n});this.tileGrid=l;this.template_=e.template;var s=e.grids;if(s){this.tileUrlFunction_=ol.TileUrlFunction.createFromTemplates(s,l);if(void 0!==e.attribution){var p=void 0!==t?t:o.getExtent();this.setAttributions(function(t){return ol.extent.intersects(p,t.extent)?[e.attribution]:null})}this.setState(ol.source.State.READY)}else this.setState(ol.source.State.ERROR)};ol.source.TileUTFGrid.prototype.getTile=function(e,t,o,r,i){var n=ol.tilecoord.getKeyZXY(e,t,o);if(this.tileCache.containsKey(n))return this.tileCache.get(n);var a=[e,t,o],l=this.getTileCoordForTileUrlFunction(a,i),s=this.tileUrlFunction_(l,r,i),p=new ol.source.TileUTFGrid.Tile_(a,void 0!==s?ol.TileState.IDLE:ol.TileState.EMPTY,void 0!==s?s:"",this.tileGrid.getTileCoordExtent(a),this.preemptive_,this.jsonp_);this.tileCache.set(n,p);return p};ol.source.TileUTFGrid.prototype.useTile=function(e,t,o){var r=ol.tilecoord.getKeyZXY(e,t,o);this.tileCache.containsKey(r)&&this.tileCache.get(r)};ol.source.TileUTFGrid.Tile_=function(e,t,o,r,i,n){ol.Tile.call(this,e,t);this.src_=o;this.extent_=r;this.preemptive_=i;this.grid_=null;this.keys_=null;this.data_=null;this.jsonp_=n};ol.inherits(ol.source.TileUTFGrid.Tile_,ol.Tile);ol.source.TileUTFGrid.Tile_.prototype.getImage=function(){return null};ol.source.TileUTFGrid.Tile_.prototype.getData=function(e){if(!this.grid_||!this.keys_)return null;var t=(e[0]-this.extent_[0])/(this.extent_[2]-this.extent_[0]),o=(e[1]-this.extent_[1])/(this.extent_[3]-this.extent_[1]),r=this.grid_[Math.floor((1-o)*this.grid_.length)];if("string"!=typeof r)return null;var i=r.charCodeAt(Math.floor(t*r.length));i>=93&&i--;i>=35&&i--;var n=null;if((i-=32)in this.keys_){var a=this.keys_[i];n=this.data_&&a in this.data_?this.data_[a]:a}return n};ol.source.TileUTFGrid.Tile_.prototype.forDataAtCoordinate=function(e,t,o,r){if(this.state==ol.TileState.IDLE&&!0===r){ol.events.listenOnce(this,ol.events.EventType.CHANGE,function(r){t.call(o,this.getData(e))},this);this.loadInternal_()}else!0===r?setTimeout(function(){t.call(o,this.getData(e))}.bind(this),0):t.call(o,this.getData(e))};ol.source.TileUTFGrid.Tile_.prototype.getKey=function(){return this.src_};ol.source.TileUTFGrid.Tile_.prototype.handleError_=function(){this.state=ol.TileState.ERROR;this.changed()};ol.source.TileUTFGrid.Tile_.prototype.handleLoad_=function(e){this.grid_=e.grid;this.keys_=e.keys;this.data_=e.data;this.state=ol.TileState.EMPTY;this.changed()};ol.source.TileUTFGrid.Tile_.prototype.loadInternal_=function(){if(this.state==ol.TileState.IDLE){this.state=ol.TileState.LOADING;if(this.jsonp_)ol.net.jsonp(this.src_,this.handleLoad_.bind(this),this.handleError_.bind(this));else{var e=new XMLHttpRequest;e.addEventListener("load",this.onXHRLoad_.bind(this));e.addEventListener("error",this.onXHRError_.bind(this));e.open("GET",this.src_);e.send()}}};ol.source.TileUTFGrid.Tile_.prototype.onXHRLoad_=function(e){var t=e.target;if(!t.status||t.status>=200&&t.status<300){var o;try{o=JSON.parse(t.responseText)}catch(e){this.handleError_();return}this.handleLoad_(o)}else this.handleError_()};ol.source.TileUTFGrid.Tile_.prototype.onXHRError_=function(e){this.handleError_()};ol.source.TileUTFGrid.Tile_.prototype.load=function(){this.preemptive_&&this.loadInternal_()};goog.provide("ol.source.TileWMS");goog.require("ol");goog.require("ol.asserts");goog.require("ol.extent");goog.require("ol.obj");goog.require("ol.math");goog.require("ol.proj");goog.require("ol.reproj");goog.require("ol.size");goog.require("ol.source.TileImage");goog.require("ol.source.WMSServerType");goog.require("ol.tilecoord");goog.require("ol.string");goog.require("ol.uri");ol.source.TileWMS=function(e){var t=e||{},o=t.params||{},r=!("TRANSPARENT"in o)||o.TRANSPARENT;ol.source.TileImage.call(this,{attributions:t.attributions,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,logo:t.logo,opaque:!r,projection:t.projection,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileClass:t.tileClass,tileGrid:t.tileGrid,tileLoadFunction:t.tileLoadFunction,url:t.url,urls:t.urls,wrapX:void 0===t.wrapX||t.wrapX,transition:t.transition});this.gutter_=void 0!==t.gutter?t.gutter:0;this.params_=o;this.v13_=!0;this.serverType_=t.serverType;this.hidpi_=void 0===t.hidpi||t.hidpi;this.tmpExtent_=ol.extent.createEmpty();this.updateV13_();this.setKey(this.getKeyForParams_())};ol.inherits(ol.source.TileWMS,ol.source.TileImage);ol.source.TileWMS.prototype.getGetFeatureInfoUrl=function(e,t,o,r){var i=ol.proj.get(o),n=this.getProjection(),a=this.getTileGrid();a||(a=this.getTileGridForProjection(i));var l=a.getTileCoordForCoordAndResolution(e,t);if(!(a.getResolutions().length<=l[0])){var s=a.getResolution(l[0]),p=a.getTileCoordExtent(l,this.tmpExtent_),c=ol.size.toSize(a.getTileSize(l[0]),this.tmpSize),u=this.gutter_;if(0!==u){c=ol.size.buffer(c,u,this.tmpSize);p=ol.extent.buffer(p,s*u,p)}if(n&&n!==i){s=ol.reproj.calculateSourceResolution(n,i,e,s);p=ol.proj.transformExtent(p,i,n);e=ol.proj.transform(e,i,n)}var g={SERVICE:"WMS",VERSION:ol.DEFAULT_WMS_VERSION,REQUEST:"GetFeatureInfo",FORMAT:"image/png",TRANSPARENT:!0,QUERY_LAYERS:this.params_.LAYERS};ol.obj.assign(g,this.params_,r);var d=Math.floor((e[0]-p[0])/s),h=Math.floor((p[3]-e[1])/s);g[this.v13_?"I":"X"]=d;g[this.v13_?"J":"Y"]=h;return this.getRequestUrl_(l,c,p,1,n||i,g)}};ol.source.TileWMS.prototype.getGutterInternal=function(){return this.gutter_};ol.source.TileWMS.prototype.getParams=function(){return this.params_};ol.source.TileWMS.prototype.getRequestUrl_=function(e,t,o,r,i,n){var a=this.urls;if(a){n.WIDTH=t[0];n.HEIGHT=t[1];n[this.v13_?"CRS":"SRS"]=i.getCode();"STYLES"in this.params_||(n.STYLES="");if(1!=r)switch(this.serverType_){case ol.source.WMSServerType.GEOSERVER:var l=90*r+.5|0;"FORMAT_OPTIONS"in n?n.FORMAT_OPTIONS+=";dpi:"+l:n.FORMAT_OPTIONS="dpi:"+l;break;case ol.source.WMSServerType.MAPSERVER:n.MAP_RESOLUTION=90*r;break;case ol.source.WMSServerType.CARMENTA_SERVER:case ol.source.WMSServerType.QGIS:n.DPI=90*r;break;default:ol.asserts.assert(!1,52)}var s,p=i.getAxisOrientation(),c=o;if(this.v13_&&"ne"==p.substr(0,2)){var u;u=o[0];c[0]=o[1];c[1]=u;u=o[2];c[2]=o[3];c[3]=u}n.BBOX=c.join(",");if(1==a.length)s=a[0];else{s=a[ol.math.modulo(ol.tilecoord.hash(e),a.length)]}return ol.uri.appendParams(s,n)}};ol.source.TileWMS.prototype.getTilePixelRatio=function(e){return this.hidpi_&&void 0!==this.serverType_?e:1};ol.source.TileWMS.prototype.getKeyForParams_=function(){var e=0,t=[];for(var o in this.params_)t[e++]=o+"-"+this.params_[o];return t.join("/")};ol.source.TileWMS.prototype.fixedTileUrlFunction=function(e,t,o){var r=this.getTileGrid();r||(r=this.getTileGridForProjection(o));if(!(r.getResolutions().length<=e[0])){1==t||this.hidpi_&&void 0!==this.serverType_||(t=1);var i=r.getResolution(e[0]),n=r.getTileCoordExtent(e,this.tmpExtent_),a=ol.size.toSize(r.getTileSize(e[0]),this.tmpSize),l=this.gutter_;if(0!==l){a=ol.size.buffer(a,l,this.tmpSize);n=ol.extent.buffer(n,i*l,n)}1!=t&&(a=ol.size.scale(a,t,this.tmpSize));var s={SERVICE:"WMS",VERSION:ol.DEFAULT_WMS_VERSION,REQUEST:"GetMap",FORMAT:"image/png",TRANSPARENT:!0};ol.obj.assign(s,this.params_);return this.getRequestUrl_(e,a,n,t,o,s)}};ol.source.TileWMS.prototype.updateParams=function(e){ol.obj.assign(this.params_,e);this.updateV13_();this.setKey(this.getKeyForParams_())};ol.source.TileWMS.prototype.updateV13_=function(){var e=this.params_.VERSION||ol.DEFAULT_WMS_VERSION;this.v13_=ol.string.compareVersions(e,"1.3")>=0};goog.provide("ol.VectorImageTile");goog.require("ol");goog.require("ol.Tile");goog.require("ol.TileState");goog.require("ol.dom");goog.require("ol.events");goog.require("ol.extent");goog.require("ol.events.EventType");goog.require("ol.featureloader");ol.VectorImageTile=function(e,t,o,r,i,n,a,l,s,p,c,u,g,d,h){ol.Tile.call(this,e,t,h);this.context_={};this.loader_;this.replayState_={};this.sourceTiles_=p;this.tileKeys=[];this.sourceRevision_=o;this.wrappedTileCoord=n;this.loadListenerKeys_=[];this.sourceTileListenerKeys_=[];if(n){var f=s.getTileCoordExtent(n),y=s.getResolution(e[0]),m=l.getZForResolution(y);l.forEachTileCoord(f,m,function(e){var t=ol.extent.getIntersection(f,l.getTileCoordExtent(e)),o=l.getExtent();o&&(t=ol.extent.getIntersection(t,o));if(ol.extent.getWidth(t)/y>=.5&&ol.extent.getHeight(t)/y>=.5){var n=e.toString(),s=p[n];if(!s){var h=a(e,c,u);s=p[n]=new g(e,void 0==h?ol.TileState.EMPTY:ol.TileState.IDLE,void 0==h?"":h,r,i);this.sourceTileListenerKeys_.push(ol.events.listen(s,ol.events.EventType.CHANGE,d))}s.consumers++;this.tileKeys.push(n)}}.bind(this))}};ol.inherits(ol.VectorImageTile,ol.Tile);ol.VectorImageTile.prototype.disposeInternal=function(){for(var e=0,t=this.tileKeys.length;e<t;++e){var o=this.tileKeys[e],r=this.getTile(o);r.consumers--;if(0==r.consumers){delete this.sourceTiles_[o];r.dispose()}}this.tileKeys.length=0;this.sourceTiles_=null;this.loadListenerKeys_.forEach(ol.events.unlistenByKey);this.loadListenerKeys_.length=0;this.interimTile&&this.interimTile.dispose();this.state=ol.TileState.ABORT;this.changed();this.sourceTileListenerKeys_.forEach(ol.events.unlistenByKey);this.sourceTileListenerKeys_.length=0;ol.Tile.prototype.disposeInternal.call(this)};ol.VectorImageTile.prototype.getContext=function(e){var t=ol.getUid(e).toString();t in this.context_||(this.context_[t]=ol.dom.createCanvasContext2D());return this.context_[t]};ol.VectorImageTile.prototype.getImage=function(e){return-1==this.getReplayState(e).renderedTileRevision?null:this.getContext(e).canvas};ol.VectorImageTile.prototype.getReplayState=function(e){var t=ol.getUid(e).toString();t in this.replayState_||(this.replayState_[t]={dirty:!1,renderedRenderOrder:null,renderedRevision:-1,renderedTileRevision:-1});return this.replayState_[t]};ol.VectorImageTile.prototype.getKey=function(){return this.tileKeys.join("/")+"-"+this.sourceRevision_};ol.VectorImageTile.prototype.getTile=function(e){return this.sourceTiles_[e]};ol.VectorImageTile.prototype.load=function(){var e=0,t={};this.state==ol.TileState.IDLE&&this.setState(ol.TileState.LOADING);this.state==ol.TileState.LOADING&&this.tileKeys.forEach(function(o){var r=this.getTile(o);if(r.state==ol.TileState.IDLE){r.setLoader(this.loader_);r.load()}if(r.state==ol.TileState.LOADING){var i=ol.events.listen(r,ol.events.EventType.CHANGE,function(o){var i=r.getState();if(i==ol.TileState.LOADED||i==ol.TileState.ERROR){var n=ol.getUid(r);if(i==ol.TileState.ERROR)t[n]=!0;else{--e;delete t[n]}e-Object.keys(t).length==0&&this.finishLoading_()}}.bind(this));this.loadListenerKeys_.push(i);++e}}.bind(this));e-Object.keys(t).length==0&&setTimeout(this.finishLoading_.bind(this),0)};ol.VectorImageTile.prototype.finishLoading_=function(){for(var e=this.tileKeys.length,t=0,o=e-1;o>=0;--o){var r=this.getTile(this.tileKeys[o]).getState();r!=ol.TileState.LOADED&&--e;r==ol.TileState.EMPTY&&++t}if(e==this.tileKeys.length){this.loadListenerKeys_.forEach(ol.events.unlistenByKey);this.loadListenerKeys_.length=0;this.setState(ol.TileState.LOADED)}else this.setState(t==this.tileKeys.length?ol.TileState.EMPTY:ol.TileState.ERROR)};ol.VectorImageTile.defaultLoadFunction=function(e,t){var o=ol.featureloader.loadFeaturesXhr(t,e.getFormat(),e.onLoad.bind(e),e.onError.bind(e));e.setLoader(o)};goog.provide("ol.VectorTile");goog.require("ol");goog.require("ol.Tile");goog.require("ol.TileState");ol.VectorTile=function(e,t,o,r,i,n){ol.Tile.call(this,e,t,n);this.consumers=0;this.extent_=null;this.format_=r;this.features_=null;this.loader_;this.projection_;this.replayGroups_={};this.tileLoadFunction_=i;this.url_=o};ol.inherits(ol.VectorTile,ol.Tile);ol.VectorTile.prototype.disposeInternal=function(){this.features_=null;this.replayGroups_={};this.state=ol.TileState.ABORT;this.changed();ol.Tile.prototype.disposeInternal.call(this)};ol.VectorTile.prototype.getExtent=function(){return this.extent_||ol.VectorTile.DEFAULT_EXTENT};ol.VectorTile.prototype.getFormat=function(){return this.format_};ol.VectorTile.prototype.getFeatures=function(){return this.features_};ol.VectorTile.prototype.getKey=function(){return this.url_};ol.VectorTile.prototype.getProjection=function(){return this.projection_};ol.VectorTile.prototype.getReplayGroup=function(e,t){return this.replayGroups_[ol.getUid(e)+","+t]};ol.VectorTile.prototype.load=function(){if(this.state==ol.TileState.IDLE){this.setState(ol.TileState.LOADING);this.tileLoadFunction_(this,this.url_);this.loader_(null,NaN,null)}};ol.VectorTile.prototype.onLoad=function(e,t,o){this.setProjection(t);this.setFeatures(e);this.setExtent(o)};ol.VectorTile.prototype.onError=function(){this.setState(ol.TileState.ERROR)};ol.VectorTile.prototype.setExtent=function(e){this.extent_=e};ol.VectorTile.prototype.setFeatures=function(e){this.features_=e;this.setState(ol.TileState.LOADED)};ol.VectorTile.prototype.setProjection=function(e){this.projection_=e};ol.VectorTile.prototype.setReplayGroup=function(e,t,o){this.replayGroups_[ol.getUid(e)+","+t]=o};ol.VectorTile.prototype.setLoader=function(e){this.loader_=e};ol.VectorTile.DEFAULT_EXTENT=[0,0,4096,4096];goog.provide("ol.source.VectorTile");goog.require("ol");goog.require("ol.TileState");goog.require("ol.VectorImageTile");goog.require("ol.VectorTile");goog.require("ol.size");goog.require("ol.source.UrlTile");goog.require("ol.tilecoord");goog.require("ol.tilegrid");ol.source.VectorTile=function(e){var t=e.projection||"EPSG:3857",o=e.extent||ol.tilegrid.extentFromProjection(t),r=e.tileGrid||ol.tilegrid.createXYZ({extent:o,maxZoom:e.maxZoom||22,minZoom:e.minZoom,tileSize:e.tileSize||512});ol.source.UrlTile.call(this,{attributions:e.attributions,cacheSize:void 0!==e.cacheSize?e.cacheSize:128,extent:o,logo:e.logo,opaque:!1,projection:t,state:e.state,tileGrid:r,tileLoadFunction:e.tileLoadFunction?e.tileLoadFunction:ol.VectorImageTile.defaultLoadFunction,tileUrlFunction:e.tileUrlFunction,url:e.url,urls:e.urls,wrapX:void 0===e.wrapX||e.wrapX,transition:e.transition});this.format_=e.format?e.format:null;this.sourceTiles_={};this.overlaps_=void 0==e.overlaps||e.overlaps;this.tileClass=e.tileClass?e.tileClass:ol.VectorTile;this.tileGrids_={}};ol.inherits(ol.source.VectorTile,ol.source.UrlTile);ol.source.VectorTile.prototype.getOverlaps=function(){return this.overlaps_};ol.source.VectorTile.prototype.clear=function(){this.tileCache.clear();this.sourceTiles_={}};ol.source.VectorTile.prototype.getTile=function(e,t,o,r,i){var n=ol.tilecoord.getKeyZXY(e,t,o);if(this.tileCache.containsKey(n))return this.tileCache.get(n);var a=[e,t,o],l=this.getTileCoordForTileUrlFunction(a,i),s=new ol.VectorImageTile(a,null!==l?ol.TileState.IDLE:ol.TileState.EMPTY,this.getRevision(),this.format_,this.tileLoadFunction,l,this.tileUrlFunction,this.tileGrid,this.getTileGridForProjection(i),this.sourceTiles_,r,i,this.tileClass,this.handleTileChange.bind(this),this.tileOptions);this.tileCache.set(n,s);return s};ol.source.VectorTile.prototype.getTileGridForProjection=function(e){var t=e.getCode(),o=this.tileGrids_[t];if(!o){var r=this.tileGrid;o=this.tileGrids_[t]=ol.tilegrid.createForProjection(e,void 0,r?r.getTileSize(r.getMinZoom()):void 0)}return o};ol.source.VectorTile.prototype.getTilePixelRatio=function(e){return e};ol.source.VectorTile.prototype.getTilePixelSize=function(e,t,o){var r=ol.size.toSize(this.getTileGridForProjection(o).getTileSize(e));return[Math.round(r[0]*t),Math.round(r[1]*t)]};goog.provide("ol.source.WMTSRequestEncoding");ol.source.WMTSRequestEncoding={KVP:"KVP",REST:"REST"};goog.provide("ol.tilegrid.WMTS");goog.require("ol");goog.require("ol.array");goog.require("ol.proj");goog.require("ol.tilegrid.TileGrid");ol.tilegrid.WMTS=function(e){this.matrixIds_=e.matrixIds;ol.tilegrid.TileGrid.call(this,{extent:e.extent,origin:e.origin,origins:e.origins,resolutions:e.resolutions,tileSize:e.tileSize,tileSizes:e.tileSizes,sizes:e.sizes})};ol.inherits(ol.tilegrid.WMTS,ol.tilegrid.TileGrid);ol.tilegrid.WMTS.prototype.getMatrixId=function(e){return this.matrixIds_[e]};ol.tilegrid.WMTS.prototype.getMatrixIds=function(){return this.matrixIds_};ol.tilegrid.WMTS.createFromCapabilitiesMatrixSet=function(e,t,o){var r=[],i=[],n=[],a=[],l=[],s=void 0!==o?o:[],p=e.SupportedCRS,c=ol.proj.get(p.replace(/urn:ogc:def:crs:(\w+):(.*:)?(\w+)$/,"$1:$3"))||ol.proj.get(p),u=c.getMetersPerUnit(),g="ne"==c.getAxisOrientation().substr(0,2);e.TileMatrix.sort(function(e,t){return t.ScaleDenominator-e.ScaleDenominator});e.TileMatrix.forEach(function(e,t,o){if(!(s.length>0)||ol.array.find(s,function(t,o,r){return e.Identifier==t.TileMatrix})){i.push(e.Identifier);var p=28e-5*e.ScaleDenominator/u,c=e.TileWidth,d=e.TileHeight;g?n.push([e.TopLeftCorner[1],e.TopLeftCorner[0]]):n.push(e.TopLeftCorner);r.push(p);a.push(c==d?c:[c,d]);l.push([e.MatrixWidth,-e.MatrixHeight])}});return new ol.tilegrid.WMTS({extent:t,origins:n,resolutions:r,matrixIds:i,tileSizes:a,sizes:l})};goog.provide("ol.source.WMTS");goog.require("ol");goog.require("ol.TileUrlFunction");goog.require("ol.array");goog.require("ol.extent");goog.require("ol.obj");goog.require("ol.proj");goog.require("ol.source.TileImage");goog.require("ol.source.WMTSRequestEncoding");goog.require("ol.tilegrid.WMTS");goog.require("ol.uri");ol.source.WMTS=function(e){this.version_=void 0!==e.version?e.version:"1.0.0";this.format_=void 0!==e.format?e.format:"image/jpeg";this.dimensions_=void 0!==e.dimensions?e.dimensions:{};this.layer_=e.layer;this.matrixSet_=e.matrixSet;this.style_=e.style;var t=e.urls;void 0===t&&void 0!==e.url&&(t=ol.TileUrlFunction.expandUrl(e.url));this.requestEncoding_=void 0!==e.requestEncoding?e.requestEncoding:ol.source.WMTSRequestEncoding.KVP;var o=this.requestEncoding_,r=e.tileGrid,i={layer:this.layer_,style:this.style_,tilematrixset:this.matrixSet_};o==ol.source.WMTSRequestEncoding.KVP&&ol.obj.assign(i,{Service:"WMTS",Request:"GetTile",Version:this.version_,Format:this.format_});var n=this.dimensions_;this.createFromWMTSTemplate_=function(e){e=o==ol.source.WMTSRequestEncoding.KVP?ol.uri.appendParams(e,i):e.replace(/\{(\w+?)\}/g,function(e,t){return t.toLowerCase()in i?i[t.toLowerCase()]:e});return function(t,i,a){if(t){var l={TileMatrix:r.getMatrixId(t[0]),TileCol:t[1],TileRow:-t[2]-1};ol.obj.assign(l,n);var s=e;return s=o==ol.source.WMTSRequestEncoding.KVP?ol.uri.appendParams(s,l):s.replace(/\{(\w+?)\}/g,function(e,t){return l[t]})}}};var a=t&&t.length>0?ol.TileUrlFunction.createFromTileUrlFunctions(t.map(this.createFromWMTSTemplate_)):ol.TileUrlFunction.nullTileUrlFunction;ol.source.TileImage.call(this,{attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,logo:e.logo,projection:e.projection,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileClass:e.tileClass,tileGrid:r,tileLoadFunction:e.tileLoadFunction,tilePixelRatio:e.tilePixelRatio,tileUrlFunction:a,urls:t,wrapX:void 0!==e.wrapX&&e.wrapX,transition:e.transition});this.setKey(this.getKeyForDimensions_())};ol.inherits(ol.source.WMTS,ol.source.TileImage);ol.source.WMTS.prototype.setUrls=function(e){this.urls=e;var t=e.join("\n");this.setTileUrlFunction(this.fixedTileUrlFunction?this.fixedTileUrlFunction.bind(this):ol.TileUrlFunction.createFromTileUrlFunctions(e.map(this.createFromWMTSTemplate_.bind(this))),t)};ol.source.WMTS.prototype.getDimensions=function(){return this.dimensions_};ol.source.WMTS.prototype.getFormat=function(){return this.format_};ol.source.WMTS.prototype.getLayer=function(){return this.layer_};ol.source.WMTS.prototype.getMatrixSet=function(){return this.matrixSet_};ol.source.WMTS.prototype.getRequestEncoding=function(){return this.requestEncoding_};ol.source.WMTS.prototype.getStyle=function(){return this.style_};ol.source.WMTS.prototype.getVersion=function(){return this.version_};ol.source.WMTS.prototype.getKeyForDimensions_=function(){var e=0,t=[];for(var o in this.dimensions_)t[e++]=o+"-"+this.dimensions_[o];return t.join("/")};ol.source.WMTS.prototype.updateDimensions=function(e){ol.obj.assign(this.dimensions_,e);this.setKey(this.getKeyForDimensions_())};ol.source.WMTS.optionsFromCapabilities=function(e,t){var o=e.Contents.Layer,r=ol.array.find(o,function(e,o,r){return e.Identifier==t.layer});if(null===r)return null;var i,n,a,l=e.Contents.TileMatrixSet;(i=r.TileMatrixSetLink.length>1?"projection"in t?ol.array.findIndex(r.TileMatrixSetLink,function(e,o,r){var i=ol.array.find(l,function(t){return t.Identifier==e.TileMatrixSet}).SupportedCRS,n=ol.proj.get(i.replace(/urn:ogc:def:crs:(\w+):(.*:)?(\w+)$/,"$1:$3"))||ol.proj.get(i),a=ol.proj.get(t.projection);return n&&a?ol.proj.equivalent(n,a):i==t.projection}):ol.array.findIndex(r.TileMatrixSetLink,function(e,o,r){return e.TileMatrixSet==t.matrixSet}):0)<0&&(i=0);n=r.TileMatrixSetLink[i].TileMatrixSet;a=r.TileMatrixSetLink[i].TileMatrixSetLimits;var s=r.Format[0];"format"in t&&(s=t.format);(i=ol.array.findIndex(r.Style,function(e,o,r){return"style"in t?e.Title==t.style:e.isDefault}))<0&&(i=0);var p=r.Style[i].Identifier,c={};"Dimension"in r&&r.Dimension.forEach(function(e,t,o){var r=e.Identifier,i=e.Default;void 0===i&&(i=e.Value[0]);c[r]=i});var u,g=e.Contents.TileMatrixSet,d=ol.array.find(g,function(e,t,o){return e.Identifier==n}),h=d.SupportedCRS;h&&(u=ol.proj.get(h.replace(/urn:ogc:def:crs:(\w+):(.*:)?(\w+)$/,"$1:$3"))||ol.proj.get(h));if("projection"in t){var f=ol.proj.get(t.projection);f&&(u&&!ol.proj.equivalent(f,u)||(u=f))}var y,m,v=r.WGS84BoundingBox;if(void 0!==v){var C=ol.proj.get("EPSG:4326").getExtent();m=v[0]==C[0]&&v[2]==C[2];y=ol.proj.transformExtent(v,"EPSG:4326",u);var T=u.getExtent();T&&(ol.extent.containsExtent(T,y)||(y=void 0))}var S=ol.tilegrid.WMTS.createFromCapabilitiesMatrixSet(d,y,a),_=[],E=t.requestEncoding;E=void 0!==E?E:"";if("OperationsMetadata"in e&&"GetTile"in e.OperationsMetadata)for(var x=e.OperationsMetadata.GetTile.DCP.HTTP.Get,P=0,L=x.length;P<L;++P)if(x[P].Constraint){var w=ol.array.find(x[P].Constraint,function(e){return"GetEncoding"==e.name}).AllowedValues.Value;""===E&&(E=w[0]);if(E!==ol.source.WMTSRequestEncoding.KVP)break;ol.array.includes(w,ol.source.WMTSRequestEncoding.KVP)&&_.push(x[P].href)}else if(x[P].href){E=ol.source.WMTSRequestEncoding.KVP;_.push(x[P].href)}if(0===_.length){E=ol.source.WMTSRequestEncoding.REST;r.ResourceURL.forEach(function(e){if("tile"===e.resourceType){s=e.format;_.push(e.template)}})}return{urls:_,layer:t.layer,matrixSet:n,format:s,projection:u,requestEncoding:E,tileGrid:S,style:p,dimensions:c,wrapX:m,crossOrigin:t.crossOrigin}};goog.provide("ol.source.Zoomify");goog.require("ol");goog.require("ol.ImageTile");goog.require("ol.TileState");goog.require("ol.TileUrlFunction");goog.require("ol.asserts");goog.require("ol.dom");goog.require("ol.extent");goog.require("ol.size");goog.require("ol.source.TileImage");goog.require("ol.tilegrid.TileGrid");ol.source.Zoomify=function(e){var t=e||{},o=t.size,r=void 0!==t.tierSizeCalculation?t.tierSizeCalculation:ol.source.Zoomify.TierSizeCalculation_.DEFAULT,i=o[0],n=o[1],a=t.extent||[0,-o[1],o[0],0],l=[],s=t.tileSize||ol.DEFAULT_TILE_SIZE,p=s;switch(r){case ol.source.Zoomify.TierSizeCalculation_.DEFAULT:for(;i>p||n>p;){l.push([Math.ceil(i/p),Math.ceil(n/p)]);p+=p}break;case ol.source.Zoomify.TierSizeCalculation_.TRUNCATED:for(var c=i,u=n;c>p||u>p;){l.push([Math.ceil(c/p),Math.ceil(u/p)]);c>>=1;u>>=1}break;default:ol.asserts.assert(!1,53)}l.push([1,1]);l.reverse();var g,d,h=[1],f=[0];for(g=1,d=l.length;g<d;g++){h.push(1<<g);f.push(l[g-1][0]*l[g-1][1]+f[g-1])}h.reverse();var y=new ol.tilegrid.TileGrid({tileSize:s,extent:a,origin:ol.extent.getTopLeft(a),resolutions:h}),m=t.url;m&&-1==m.indexOf("{TileGroup}")&&-1==m.indexOf("{tileIndex}")&&(m+="{TileGroup}/{z}-{x}-{y}.jpg");var v=ol.TileUrlFunction.expandUrl(m);var C=ol.TileUrlFunction.createFromTileUrlFunctions(v.map(function(e){return function(t,o,r){if(t){var i=t[0],n=t[1],a=-t[2]-1,s=n+a*l[i][0],p=y.getTileSize(i),c={z:i,x:n,y:a,tileIndex:s,TileGroup:"TileGroup"+((s+f[i])/p|0)};return e.replace(/\{(\w+?)\}/g,function(e,t){return c[t]})}}})),T=ol.source.Zoomify.Tile_.bind(null,y);ol.source.TileImage.call(this,{attributions:t.attributions,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,logo:t.logo,projection:t.projection,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileClass:T,tileGrid:y,tileUrlFunction:C,transition:t.transition})};ol.inherits(ol.source.Zoomify,ol.source.TileImage);ol.source.Zoomify.Tile_=function(e,t,o,r,i,n,a){ol.ImageTile.call(this,t,o,r,i,n,a);this.zoomifyImage_=null;this.tileSize_=ol.size.toSize(e.getTileSize(t[0]))};ol.inherits(ol.source.Zoomify.Tile_,ol.ImageTile);ol.source.Zoomify.Tile_.prototype.getImage=function(){if(this.zoomifyImage_)return this.zoomifyImage_;var e=ol.ImageTile.prototype.getImage.call(this);if(this.state==ol.TileState.LOADED){var t=this.tileSize_;if(e.width==t[0]&&e.height==t[1]){this.zoomifyImage_=e;return e}var o=ol.dom.createCanvasContext2D(t[0],t[1]);o.drawImage(e,0,0);this.zoomifyImage_=o.canvas;return o.canvas}return e};ol.source.Zoomify.TierSizeCalculation_={DEFAULT:"default",TRUNCATED:"truncated"};goog.addDependency("demos/editor/equationeditor.js",["goog.demos.editor.EquationEditor"],["goog.ui.equation.EquationEditorDialog"]);goog.addDependency("demos/editor/helloworld.js",["goog.demos.editor.HelloWorld"],["goog.dom","goog.dom.TagName","goog.editor.Plugin"]);goog.addDependency("demos/editor/helloworlddialog.js",["goog.demos.editor.HelloWorldDialog","goog.demos.editor.HelloWorldDialog.OkEvent"],["goog.dom.TagName","goog.events.Event","goog.string","goog.ui.editor.AbstractDialog","goog.ui.editor.AbstractDialog.Builder","goog.ui.editor.AbstractDialog.EventType"]);goog.addDependency("demos/editor/helloworlddialogplugin.js",["goog.demos.editor.HelloWorldDialogPlugin","goog.demos.editor.HelloWorldDialogPlugin.Command"],["goog.demos.editor.HelloWorldDialog","goog.dom.TagName","goog.editor.plugins.AbstractDialogPlugin","goog.editor.range","goog.functions","goog.ui.editor.AbstractDialog.EventType"]);goog.require("ol");goog.require("ol.AssertionError");goog.require("ol.Attribution");goog.require("ol.CanvasMap");goog.require("ol.Collection");goog.require("ol.DeviceOrientation");goog.require("ol.Feature");goog.require("ol.Geolocation");goog.require("ol.Graticule");goog.require("ol.Image");goog.require("ol.ImageTile");goog.require("ol.Kinetic");goog.require("ol.Map");goog.require("ol.MapBrowserEvent");goog.require("ol.MapEvent");goog.require("ol.Object");goog.require("ol.Observable");goog.require("ol.Overlay");goog.require("ol.PluggableMap");goog.require("ol.Sphere");goog.require("ol.Tile");goog.require("ol.VectorTile");goog.require("ol.View");goog.require("ol.color");goog.require("ol.colorlike");goog.require("ol.control");goog.require("ol.control.Attribution");goog.require("ol.control.Control");goog.require("ol.control.FullScreen");goog.require("ol.control.MousePosition");goog.require("ol.control.OverviewMap");goog.require("ol.control.Rotate");goog.require("ol.control.ScaleLine");goog.require("ol.control.Zoom");goog.require("ol.control.ZoomSlider");goog.require("ol.control.ZoomToExtent");goog.require("ol.coordinate");goog.require("ol.easing");goog.require("ol.events.Event");goog.require("ol.events.condition");goog.require("ol.extent");goog.require("ol.featureloader");goog.require("ol.format.EsriJSON");goog.require("ol.format.Feature");goog.require("ol.format.GML");goog.require("ol.format.GML2");goog.require("ol.format.GML3");goog.require("ol.format.GMLBase");goog.require("ol.format.GPX");goog.require("ol.format.GeoJSON");goog.require("ol.format.IGC");goog.require("ol.format.KML");goog.require("ol.format.MVT");goog.require("ol.format.OSMXML");goog.require("ol.format.Polyline");goog.require("ol.format.TopoJSON");goog.require("ol.format.WFS");goog.require("ol.format.WKT");goog.require("ol.format.WMSCapabilities");goog.require("ol.format.WMSGetFeatureInfo");goog.require("ol.format.WMTSCapabilities");goog.require("ol.format.filter");goog.require("ol.format.filter.And");goog.require("ol.format.filter.Bbox");goog.require("ol.format.filter.Comparison");goog.require("ol.format.filter.ComparisonBinary");goog.require("ol.format.filter.Contains");goog.require("ol.format.filter.During");goog.require("ol.format.filter.EqualTo");goog.require("ol.format.filter.Filter");goog.require("ol.format.filter.GreaterThan");goog.require("ol.format.filter.GreaterThanOrEqualTo");goog.require("ol.format.filter.Intersects");goog.require("ol.format.filter.IsBetween");goog.require("ol.format.filter.IsLike");goog.require("ol.format.filter.IsNull");goog.require("ol.format.filter.LessThan");goog.require("ol.format.filter.LessThanOrEqualTo");goog.require("ol.format.filter.Not");goog.require("ol.format.filter.NotEqualTo");goog.require("ol.format.filter.Or");goog.require("ol.format.filter.Spatial");goog.require("ol.format.filter.Within");goog.require("ol.geom.Circle");goog.require("ol.geom.Geometry");goog.require("ol.geom.GeometryCollection");goog.require("ol.geom.LineString");goog.require("ol.geom.LinearRing");goog.require("ol.geom.MultiLineString");goog.require("ol.geom.MultiPoint");goog.require("ol.geom.MultiPolygon");goog.require("ol.geom.Point");goog.require("ol.geom.Polygon");goog.require("ol.geom.SimpleGeometry");goog.require("ol.has");goog.require("ol.interaction");goog.require("ol.interaction.DoubleClickZoom");goog.require("ol.interaction.DragAndDrop");goog.require("ol.interaction.DragBox");goog.require("ol.interaction.DragPan");goog.require("ol.interaction.DragRotate");goog.require("ol.interaction.DragRotateAndZoom");goog.require("ol.interaction.DragZoom");goog.require("ol.interaction.Draw");goog.require("ol.interaction.Extent");goog.require("ol.interaction.Interaction");goog.require("ol.interaction.KeyboardPan");goog.require("ol.interaction.KeyboardZoom");goog.require("ol.interaction.Modify");goog.require("ol.interaction.MouseWheelZoom");goog.require("ol.interaction.PinchRotate");goog.require("ol.interaction.PinchZoom");goog.require("ol.interaction.Pointer");goog.require("ol.interaction.Select");goog.require("ol.interaction.Snap");goog.require("ol.interaction.Translate");goog.require("ol.layer.Base");goog.require("ol.layer.Group");goog.require("ol.layer.Heatmap");goog.require("ol.layer.Image");goog.require("ol.layer.Layer");goog.require("ol.layer.Tile");goog.require("ol.layer.Vector");goog.require("ol.layer.VectorTile");goog.require("ol.loadingstrategy");goog.require("ol.proj");goog.require("ol.proj.Projection");goog.require("ol.proj.Units");goog.require("ol.proj.common");goog.require("ol.render");goog.require("ol.render.Event");goog.require("ol.render.Feature");goog.require("ol.render.VectorContext");goog.require("ol.render.canvas.Immediate");goog.require("ol.render.webgl.Immediate");goog.require("ol.renderer.canvas.ImageLayer");goog.require("ol.renderer.canvas.Map");goog.require("ol.renderer.canvas.TileLayer");goog.require("ol.renderer.canvas.VectorLayer");goog.require("ol.renderer.canvas.VectorTileLayer");goog.require("ol.renderer.webgl.ImageLayer");goog.require("ol.renderer.webgl.Map");goog.require("ol.renderer.webgl.TileLayer");goog.require("ol.renderer.webgl.VectorLayer");goog.require("ol.size");goog.require("ol.source.BingMaps");goog.require("ol.source.CartoDB");goog.require("ol.source.Cluster");goog.require("ol.source.Image");goog.require("ol.source.ImageArcGISRest");goog.require("ol.source.ImageCanvas");goog.require("ol.source.ImageMapGuide");goog.require("ol.source.ImageStatic");goog.require("ol.source.ImageVector");goog.require("ol.source.ImageWMS");goog.require("ol.source.OSM");goog.require("ol.source.Raster");goog.require("ol.source.Source");goog.require("ol.source.Stamen");goog.require("ol.source.Tile");goog.require("ol.source.TileArcGISRest");goog.require("ol.source.TileDebug");goog.require("ol.source.TileImage");goog.require("ol.source.TileJSON");goog.require("ol.source.TileUTFGrid");goog.require("ol.source.TileWMS");goog.require("ol.source.UrlTile");goog.require("ol.source.Vector");goog.require("ol.source.VectorTile");goog.require("ol.source.WMTS");goog.require("ol.source.XYZ");goog.require("ol.source.Zoomify");goog.require("ol.style");goog.require("ol.style.AtlasManager");goog.require("ol.style.Circle");goog.require("ol.style.Fill");goog.require("ol.style.Icon");goog.require("ol.style.IconImageCache");goog.require("ol.style.Image");goog.require("ol.style.RegularShape");goog.require("ol.style.Stroke");goog.require("ol.style.Style");goog.require("ol.style.Text");goog.require("ol.tilegrid");goog.require("ol.tilegrid.TileGrid");goog.require("ol.tilegrid.WMTS");goog.require("ol.webgl.Context");goog.require("ol.xml");goog.exportProperty(ol.AssertionError.prototype,"code",ol.AssertionError.prototype.code);goog.exportSymbol("ol.Attribution",ol.Attribution,OPENLAYERS);goog.exportProperty(ol.Attribution.prototype,"getHTML",ol.Attribution.prototype.getHTML);goog.exportSymbol("ol.CanvasMap",ol.CanvasMap,OPENLAYERS);goog.exportSymbol("ol.Collection",ol.Collection,OPENLAYERS);goog.exportProperty(ol.Collection.prototype,"clear",ol.Collection.prototype.clear);goog.exportProperty(ol.Collection.prototype,"extend",ol.Collection.prototype.extend);goog.exportProperty(ol.Collection.prototype,"forEach",ol.Collection.prototype.forEach);goog.exportProperty(ol.Collection.prototype,"getArray",ol.Collection.prototype.getArray);goog.exportProperty(ol.Collection.prototype,"item",ol.Collection.prototype.item);goog.exportProperty(ol.Collection.prototype,"getLength",ol.Collection.prototype.getLength);goog.exportProperty(ol.Collection.prototype,"insertAt",ol.Collection.prototype.insertAt);goog.exportProperty(ol.Collection.prototype,"pop",ol.Collection.prototype.pop);goog.exportProperty(ol.Collection.prototype,"push",ol.Collection.prototype.push);goog.exportProperty(ol.Collection.prototype,"remove",ol.Collection.prototype.remove);goog.exportProperty(ol.Collection.prototype,"removeAt",ol.Collection.prototype.removeAt);goog.exportProperty(ol.Collection.prototype,"setAt",ol.Collection.prototype.setAt);goog.exportProperty(ol.Collection.Event.prototype,"element",ol.Collection.Event.prototype.element);goog.exportSymbol("ol.color.asArray",ol.color.asArray,OPENLAYERS);goog.exportSymbol("ol.color.asString",ol.color.asString,OPENLAYERS);goog.exportSymbol("ol.colorlike.asColorLike",ol.colorlike.asColorLike,OPENLAYERS);goog.exportSymbol("ol.control.defaults",ol.control.defaults,OPENLAYERS);goog.exportSymbol("ol.coordinate.add",ol.coordinate.add,OPENLAYERS);goog.exportSymbol("ol.coordinate.createStringXY",ol.coordinate.createStringXY,OPENLAYERS);goog.exportSymbol("ol.coordinate.format",ol.coordinate.format,OPENLAYERS);goog.exportSymbol("ol.coordinate.rotate",ol.coordinate.rotate,OPENLAYERS);goog.exportSymbol("ol.coordinate.toStringHDMS",ol.coordinate.toStringHDMS,OPENLAYERS);goog.exportSymbol("ol.coordinate.toStringXY",ol.coordinate.toStringXY,OPENLAYERS);goog.exportSymbol("ol.DeviceOrientation",ol.DeviceOrientation,OPENLAYERS);goog.exportProperty(ol.DeviceOrientation.prototype,"getAlpha",ol.DeviceOrientation.prototype.getAlpha);goog.exportProperty(ol.DeviceOrientation.prototype,"getBeta",ol.DeviceOrientation.prototype.getBeta);goog.exportProperty(ol.DeviceOrientation.prototype,"getGamma",ol.DeviceOrientation.prototype.getGamma);goog.exportProperty(ol.DeviceOrientation.prototype,"getHeading",ol.DeviceOrientation.prototype.getHeading);goog.exportProperty(ol.DeviceOrientation.prototype,"getTracking",ol.DeviceOrientation.prototype.getTracking);goog.exportProperty(ol.DeviceOrientation.prototype,"setTracking",ol.DeviceOrientation.prototype.setTracking);goog.exportSymbol("ol.easing.easeIn",ol.easing.easeIn,OPENLAYERS);goog.exportSymbol("ol.easing.easeOut",ol.easing.easeOut,OPENLAYERS);goog.exportSymbol("ol.easing.inAndOut",ol.easing.inAndOut,OPENLAYERS);goog.exportSymbol("ol.easing.linear",ol.easing.linear,OPENLAYERS);goog.exportSymbol("ol.easing.upAndDown",ol.easing.upAndDown,OPENLAYERS);goog.exportSymbol("ol.extent.boundingExtent",ol.extent.boundingExtent,OPENLAYERS);goog.exportSymbol("ol.extent.buffer",ol.extent.buffer,OPENLAYERS);goog.exportSymbol("ol.extent.containsCoordinate",ol.extent.containsCoordinate,OPENLAYERS);goog.exportSymbol("ol.extent.containsExtent",ol.extent.containsExtent,OPENLAYERS);goog.exportSymbol("ol.extent.containsXY",ol.extent.containsXY,OPENLAYERS);goog.exportSymbol("ol.extent.createEmpty",ol.extent.createEmpty,OPENLAYERS);goog.exportSymbol("ol.extent.equals",ol.extent.equals,OPENLAYERS);goog.exportSymbol("ol.extent.extend",ol.extent.extend,OPENLAYERS);goog.exportSymbol("ol.extent.getArea",ol.extent.getArea,OPENLAYERS);goog.exportSymbol("ol.extent.getBottomLeft",ol.extent.getBottomLeft,OPENLAYERS);goog.exportSymbol("ol.extent.getBottomRight",ol.extent.getBottomRight,OPENLAYERS);goog.exportSymbol("ol.extent.getCenter",ol.extent.getCenter,OPENLAYERS);goog.exportSymbol("ol.extent.getHeight",ol.extent.getHeight,OPENLAYERS);goog.exportSymbol("ol.extent.getIntersection",ol.extent.getIntersection,OPENLAYERS);goog.exportSymbol("ol.extent.getSize",ol.extent.getSize,OPENLAYERS);goog.exportSymbol("ol.extent.getTopLeft",ol.extent.getTopLeft,OPENLAYERS);goog.exportSymbol("ol.extent.getTopRight",ol.extent.getTopRight,OPENLAYERS);goog.exportSymbol("ol.extent.getWidth",ol.extent.getWidth,OPENLAYERS);goog.exportSymbol("ol.extent.intersects",ol.extent.intersects,OPENLAYERS);goog.exportSymbol("ol.extent.isEmpty",ol.extent.isEmpty,OPENLAYERS);goog.exportSymbol("ol.extent.applyTransform",ol.extent.applyTransform,OPENLAYERS);goog.exportSymbol("ol.Feature",ol.Feature,OPENLAYERS);goog.exportProperty(ol.Feature.prototype,"clone",ol.Feature.prototype.clone);goog.exportProperty(ol.Feature.prototype,"getGeometry",ol.Feature.prototype.getGeometry);goog.exportProperty(ol.Feature.prototype,"getId",ol.Feature.prototype.getId);goog.exportProperty(ol.Feature.prototype,"getGeometryName",ol.Feature.prototype.getGeometryName);goog.exportProperty(ol.Feature.prototype,"getStyle",ol.Feature.prototype.getStyle);goog.exportProperty(ol.Feature.prototype,"getStyleFunction",ol.Feature.prototype.getStyleFunction);goog.exportProperty(ol.Feature.prototype,"setGeometry",ol.Feature.prototype.setGeometry);goog.exportProperty(ol.Feature.prototype,"setStyle",ol.Feature.prototype.setStyle);goog.exportProperty(ol.Feature.prototype,"setId",ol.Feature.prototype.setId);goog.exportProperty(ol.Feature.prototype,"setGeometryName",ol.Feature.prototype.setGeometryName);goog.exportSymbol("ol.featureloader.xhr",ol.featureloader.xhr,OPENLAYERS);goog.exportSymbol("ol.Geolocation",ol.Geolocation,OPENLAYERS);goog.exportProperty(ol.Geolocation.prototype,"getAccuracy",ol.Geolocation.prototype.getAccuracy);goog.exportProperty(ol.Geolocation.prototype,"getAccuracyGeometry",ol.Geolocation.prototype.getAccuracyGeometry);goog.exportProperty(ol.Geolocation.prototype,"getAltitude",ol.Geolocation.prototype.getAltitude);goog.exportProperty(ol.Geolocation.prototype,"getAltitudeAccuracy",ol.Geolocation.prototype.getAltitudeAccuracy);goog.exportProperty(ol.Geolocation.prototype,"getHeading",ol.Geolocation.prototype.getHeading);goog.exportProperty(ol.Geolocation.prototype,"getPosition",ol.Geolocation.prototype.getPosition);goog.exportProperty(ol.Geolocation.prototype,"getProjection",ol.Geolocation.prototype.getProjection);goog.exportProperty(ol.Geolocation.prototype,"getSpeed",ol.Geolocation.prototype.getSpeed);goog.exportProperty(ol.Geolocation.prototype,"getTracking",ol.Geolocation.prototype.getTracking);goog.exportProperty(ol.Geolocation.prototype,"getTrackingOptions",ol.Geolocation.prototype.getTrackingOptions);goog.exportProperty(ol.Geolocation.prototype,"setProjection",ol.Geolocation.prototype.setProjection);goog.exportProperty(ol.Geolocation.prototype,"setTracking",ol.Geolocation.prototype.setTracking);goog.exportProperty(ol.Geolocation.prototype,"setTrackingOptions",ol.Geolocation.prototype.setTrackingOptions);goog.exportSymbol("ol.Graticule",ol.Graticule,OPENLAYERS);goog.exportProperty(ol.Graticule.prototype,"getMap",ol.Graticule.prototype.getMap);goog.exportProperty(ol.Graticule.prototype,"getMeridians",ol.Graticule.prototype.getMeridians);goog.exportProperty(ol.Graticule.prototype,"getParallels",ol.Graticule.prototype.getParallels);goog.exportProperty(ol.Graticule.prototype,"setMap",ol.Graticule.prototype.setMap);goog.exportSymbol("ol.has.DEVICE_PIXEL_RATIO",ol.has.DEVICE_PIXEL_RATIO,OPENLAYERS);goog.exportSymbol("ol.has.CANVAS",ol.has.CANVAS,OPENLAYERS);goog.exportSymbol("ol.has.DEVICE_ORIENTATION",ol.has.DEVICE_ORIENTATION,OPENLAYERS);goog.exportSymbol("ol.has.GEOLOCATION",ol.has.GEOLOCATION,OPENLAYERS);goog.exportSymbol("ol.has.TOUCH",ol.has.TOUCH,OPENLAYERS);goog.exportSymbol("ol.has.WEBGL",ol.has.WEBGL,OPENLAYERS);goog.exportProperty(ol.Image.prototype,"getImage",ol.Image.prototype.getImage);goog.exportProperty(ol.Image.prototype,"load",ol.Image.prototype.load);goog.exportProperty(ol.ImageTile.prototype,"getImage",ol.ImageTile.prototype.getImage);goog.exportSymbol("ol.inherits",ol.inherits,OPENLAYERS);goog.exportSymbol("ol.interaction.defaults",ol.interaction.defaults,OPENLAYERS);goog.exportSymbol("ol.Kinetic",ol.Kinetic,OPENLAYERS);goog.exportSymbol("ol.loadingstrategy.all",ol.loadingstrategy.all,OPENLAYERS);goog.exportSymbol("ol.loadingstrategy.bbox",ol.loadingstrategy.bbox,OPENLAYERS);goog.exportSymbol("ol.loadingstrategy.tile",ol.loadingstrategy.tile,OPENLAYERS);goog.exportSymbol("ol.Map",ol.Map,OPENLAYERS);goog.exportProperty(ol.MapBrowserEvent.prototype,"originalEvent",ol.MapBrowserEvent.prototype.originalEvent);goog.exportProperty(ol.MapBrowserEvent.prototype,"pixel",ol.MapBrowserEvent.prototype.pixel);goog.exportProperty(ol.MapBrowserEvent.prototype,"coordinate",ol.MapBrowserEvent.prototype.coordinate);goog.exportProperty(ol.MapBrowserEvent.prototype,"dragging",ol.MapBrowserEvent.prototype.dragging);goog.exportProperty(ol.MapEvent.prototype,"map",ol.MapEvent.prototype.map);goog.exportProperty(ol.MapEvent.prototype,"frameState",ol.MapEvent.prototype.frameState);goog.exportSymbol("ol.Object",ol.Object,OPENLAYERS);goog.exportProperty(ol.Object.prototype,"get",ol.Object.prototype.get);goog.exportProperty(ol.Object.prototype,"getKeys",ol.Object.prototype.getKeys);goog.exportProperty(ol.Object.prototype,"getProperties",ol.Object.prototype.getProperties);goog.exportProperty(ol.Object.prototype,"set",ol.Object.prototype.set);goog.exportProperty(ol.Object.prototype,"setProperties",ol.Object.prototype.setProperties);goog.exportProperty(ol.Object.prototype,"unset",ol.Object.prototype.unset);goog.exportProperty(ol.Object.Event.prototype,"key",ol.Object.Event.prototype.key);goog.exportProperty(ol.Object.Event.prototype,"oldValue",ol.Object.Event.prototype.oldValue);goog.exportSymbol("ol.Observable",ol.Observable,OPENLAYERS);goog.exportSymbol("ol.Observable.unByKey",ol.Observable.unByKey,OPENLAYERS);goog.exportProperty(ol.Observable.prototype,"changed",ol.Observable.prototype.changed);goog.exportProperty(ol.Observable.prototype,"dispatchEvent",ol.Observable.prototype.dispatchEvent);goog.exportProperty(ol.Observable.prototype,"getRevision",ol.Observable.prototype.getRevision);goog.exportProperty(ol.Observable.prototype,"on",ol.Observable.prototype.on);goog.exportProperty(ol.Observable.prototype,"once",ol.Observable.prototype.once);goog.exportProperty(ol.Observable.prototype,"un",ol.Observable.prototype.un);goog.exportSymbol("ol.Overlay",ol.Overlay,OPENLAYERS);goog.exportProperty(ol.Overlay.prototype,"getElement",ol.Overlay.prototype.getElement);goog.exportProperty(ol.Overlay.prototype,"getId",ol.Overlay.prototype.getId);goog.exportProperty(ol.Overlay.prototype,"getMap",ol.Overlay.prototype.getMap);goog.exportProperty(ol.Overlay.prototype,"getOffset",ol.Overlay.prototype.getOffset);goog.exportProperty(ol.Overlay.prototype,"getPosition",ol.Overlay.prototype.getPosition);goog.exportProperty(ol.Overlay.prototype,"getPositioning",ol.Overlay.prototype.getPositioning);goog.exportProperty(ol.Overlay.prototype,"setElement",ol.Overlay.prototype.setElement);goog.exportProperty(ol.Overlay.prototype,"setMap",ol.Overlay.prototype.setMap);goog.exportProperty(ol.Overlay.prototype,"setOffset",ol.Overlay.prototype.setOffset);goog.exportProperty(ol.Overlay.prototype,"setPosition",ol.Overlay.prototype.setPosition);goog.exportProperty(ol.Overlay.prototype,"setPositioning",ol.Overlay.prototype.setPositioning);goog.exportSymbol("ol.PluggableMap",ol.PluggableMap,OPENLAYERS);goog.exportProperty(ol.PluggableMap.prototype,"addControl",ol.PluggableMap.prototype.addControl);goog.exportProperty(ol.PluggableMap.prototype,"addInteraction",ol.PluggableMap.prototype.addInteraction);goog.exportProperty(ol.PluggableMap.prototype,"addLayer",ol.PluggableMap.prototype.addLayer);goog.exportProperty(ol.PluggableMap.prototype,"addOverlay",ol.PluggableMap.prototype.addOverlay);goog.exportProperty(ol.PluggableMap.prototype,"forEachFeatureAtPixel",ol.PluggableMap.prototype.forEachFeatureAtPixel);goog.exportProperty(ol.PluggableMap.prototype,"getFeaturesAtPixel",ol.PluggableMap.prototype.getFeaturesAtPixel);goog.exportProperty(ol.PluggableMap.prototype,"forEachLayerAtPixel",ol.PluggableMap.prototype.forEachLayerAtPixel);goog.exportProperty(ol.PluggableMap.prototype,"hasFeatureAtPixel",ol.PluggableMap.prototype.hasFeatureAtPixel);goog.exportProperty(ol.PluggableMap.prototype,"getEventCoordinate",ol.PluggableMap.prototype.getEventCoordinate);goog.exportProperty(ol.PluggableMap.prototype,"getEventPixel",ol.PluggableMap.prototype.getEventPixel);goog.exportProperty(ol.PluggableMap.prototype,"getTarget",ol.PluggableMap.prototype.getTarget);goog.exportProperty(ol.PluggableMap.prototype,"getTargetElement",ol.PluggableMap.prototype.getTargetElement);goog.exportProperty(ol.PluggableMap.prototype,"getCoordinateFromPixel",ol.PluggableMap.prototype.getCoordinateFromPixel);goog.exportProperty(ol.PluggableMap.prototype,"getControls",ol.PluggableMap.prototype.getControls);goog.exportProperty(ol.PluggableMap.prototype,"getOverlays",ol.PluggableMap.prototype.getOverlays);goog.exportProperty(ol.PluggableMap.prototype,"getOverlayById",ol.PluggableMap.prototype.getOverlayById);goog.exportProperty(ol.PluggableMap.prototype,"getInteractions",ol.PluggableMap.prototype.getInteractions);goog.exportProperty(ol.PluggableMap.prototype,"getLayerGroup",ol.PluggableMap.prototype.getLayerGroup);goog.exportProperty(ol.PluggableMap.prototype,"getLayers",ol.PluggableMap.prototype.getLayers);goog.exportProperty(ol.PluggableMap.prototype,"getPixelFromCoordinate",ol.PluggableMap.prototype.getPixelFromCoordinate);goog.exportProperty(ol.PluggableMap.prototype,"getSize",ol.PluggableMap.prototype.getSize);goog.exportProperty(ol.PluggableMap.prototype,"getView",ol.PluggableMap.prototype.getView);goog.exportProperty(ol.PluggableMap.prototype,"getViewport",ol.PluggableMap.prototype.getViewport);goog.exportProperty(ol.PluggableMap.prototype,"renderSync",ol.PluggableMap.prototype.renderSync);goog.exportProperty(ol.PluggableMap.prototype,"render",ol.PluggableMap.prototype.render);goog.exportProperty(ol.PluggableMap.prototype,"removeControl",ol.PluggableMap.prototype.removeControl);goog.exportProperty(ol.PluggableMap.prototype,"removeInteraction",ol.PluggableMap.prototype.removeInteraction);goog.exportProperty(ol.PluggableMap.prototype,"removeLayer",ol.PluggableMap.prototype.removeLayer);goog.exportProperty(ol.PluggableMap.prototype,"removeOverlay",ol.PluggableMap.prototype.removeOverlay);goog.exportProperty(ol.PluggableMap.prototype,"setLayerGroup",ol.PluggableMap.prototype.setLayerGroup);goog.exportProperty(ol.PluggableMap.prototype,"setSize",ol.PluggableMap.prototype.setSize);goog.exportProperty(ol.PluggableMap.prototype,"setTarget",ol.PluggableMap.prototype.setTarget);goog.exportProperty(ol.PluggableMap.prototype,"setView",ol.PluggableMap.prototype.setView);goog.exportProperty(ol.PluggableMap.prototype,"updateSize",ol.PluggableMap.prototype.updateSize);goog.exportSymbol("ol.proj.METERS_PER_UNIT",ol.proj.METERS_PER_UNIT,OPENLAYERS);goog.exportSymbol("ol.proj.setProj4",ol.proj.setProj4,OPENLAYERS);goog.exportSymbol("ol.proj.getPointResolution",ol.proj.getPointResolution,OPENLAYERS);goog.exportSymbol("ol.proj.addEquivalentProjections",ol.proj.addEquivalentProjections,OPENLAYERS);goog.exportSymbol("ol.proj.addProjection",ol.proj.addProjection,OPENLAYERS);goog.exportSymbol("ol.proj.addCoordinateTransforms",ol.proj.addCoordinateTransforms,OPENLAYERS);goog.exportSymbol("ol.proj.fromLonLat",ol.proj.fromLonLat,OPENLAYERS);goog.exportSymbol("ol.proj.toLonLat",ol.proj.toLonLat,OPENLAYERS);goog.exportSymbol("ol.proj.get",ol.proj.get,OPENLAYERS);goog.exportSymbol("ol.proj.equivalent",ol.proj.equivalent,OPENLAYERS);goog.exportSymbol("ol.proj.getTransform",ol.proj.getTransform,OPENLAYERS);goog.exportSymbol("ol.proj.transform",ol.proj.transform,OPENLAYERS);goog.exportSymbol("ol.proj.transformExtent",ol.proj.transformExtent,OPENLAYERS);goog.exportSymbol("ol.render.toContext",ol.render.toContext,OPENLAYERS);goog.exportSymbol("ol.size.toSize",ol.size.toSize,OPENLAYERS);goog.exportSymbol("ol.Sphere",ol.Sphere,OPENLAYERS);goog.exportProperty(ol.Sphere.prototype,"geodesicArea",ol.Sphere.prototype.geodesicArea);goog.exportProperty(ol.Sphere.prototype,"haversineDistance",ol.Sphere.prototype.haversineDistance);goog.exportSymbol("ol.Sphere.getLength",ol.Sphere.getLength,OPENLAYERS);goog.exportSymbol("ol.Sphere.getArea",ol.Sphere.getArea,OPENLAYERS);goog.exportSymbol("ol.style.iconImageCache",ol.style.iconImageCache,OPENLAYERS);goog.exportProperty(ol.Tile.prototype,"getTileCoord",ol.Tile.prototype.getTileCoord);goog.exportProperty(ol.Tile.prototype,"load",ol.Tile.prototype.load);goog.exportSymbol("ol.tilegrid.createXYZ",ol.tilegrid.createXYZ,OPENLAYERS);goog.exportProperty(ol.VectorTile.prototype,"getExtent",ol.VectorTile.prototype.getExtent);goog.exportProperty(ol.VectorTile.prototype,"getFormat",ol.VectorTile.prototype.getFormat);goog.exportProperty(ol.VectorTile.prototype,"getFeatures",ol.VectorTile.prototype.getFeatures);goog.exportProperty(ol.VectorTile.prototype,"getProjection",ol.VectorTile.prototype.getProjection);goog.exportProperty(ol.VectorTile.prototype,"setExtent",ol.VectorTile.prototype.setExtent);goog.exportProperty(ol.VectorTile.prototype,"setFeatures",ol.VectorTile.prototype.setFeatures);goog.exportProperty(ol.VectorTile.prototype,"setProjection",ol.VectorTile.prototype.setProjection);goog.exportProperty(ol.VectorTile.prototype,"setLoader",ol.VectorTile.prototype.setLoader);goog.exportSymbol("ol.View",ol.View,OPENLAYERS);goog.exportProperty(ol.View.prototype,"animate",ol.View.prototype.animate);goog.exportProperty(ol.View.prototype,"getAnimating",ol.View.prototype.getAnimating);goog.exportProperty(ol.View.prototype,"getInteracting",ol.View.prototype.getInteracting);goog.exportProperty(ol.View.prototype,"cancelAnimations",ol.View.prototype.cancelAnimations);goog.exportProperty(ol.View.prototype,"constrainCenter",ol.View.prototype.constrainCenter);goog.exportProperty(ol.View.prototype,"constrainResolution",ol.View.prototype.constrainResolution);goog.exportProperty(ol.View.prototype,"constrainRotation",ol.View.prototype.constrainRotation);goog.exportProperty(ol.View.prototype,"getCenter",ol.View.prototype.getCenter);goog.exportProperty(ol.View.prototype,"calculateExtent",ol.View.prototype.calculateExtent);goog.exportProperty(ol.View.prototype,"getMaxResolution",ol.View.prototype.getMaxResolution);goog.exportProperty(ol.View.prototype,"getMinResolution",ol.View.prototype.getMinResolution);goog.exportProperty(ol.View.prototype,"getMaxZoom",ol.View.prototype.getMaxZoom);goog.exportProperty(ol.View.prototype,"setMaxZoom",ol.View.prototype.setMaxZoom);goog.exportProperty(ol.View.prototype,"getMinZoom",ol.View.prototype.getMinZoom);goog.exportProperty(ol.View.prototype,"setMinZoom",ol.View.prototype.setMinZoom);goog.exportProperty(ol.View.prototype,"getProjection",ol.View.prototype.getProjection);goog.exportProperty(ol.View.prototype,"getResolution",ol.View.prototype.getResolution);goog.exportProperty(ol.View.prototype,"getResolutions",ol.View.prototype.getResolutions);goog.exportProperty(ol.View.prototype,"getResolutionForExtent",ol.View.prototype.getResolutionForExtent);goog.exportProperty(ol.View.prototype,"getRotation",ol.View.prototype.getRotation);goog.exportProperty(ol.View.prototype,"getZoom",ol.View.prototype.getZoom);goog.exportProperty(ol.View.prototype,"getZoomForResolution",ol.View.prototype.getZoomForResolution);goog.exportProperty(ol.View.prototype,"getResolutionForZoom",ol.View.prototype.getResolutionForZoom);goog.exportProperty(ol.View.prototype,"fit",ol.View.prototype.fit);goog.exportProperty(ol.View.prototype,"centerOn",ol.View.prototype.centerOn);goog.exportProperty(ol.View.prototype,"rotate",ol.View.prototype.rotate);goog.exportProperty(ol.View.prototype,"setCenter",ol.View.prototype.setCenter);goog.exportProperty(ol.View.prototype,"setResolution",ol.View.prototype.setResolution);goog.exportProperty(ol.View.prototype,"setRotation",ol.View.prototype.setRotation);goog.exportProperty(ol.View.prototype,"setZoom",ol.View.prototype.setZoom);goog.exportSymbol("ol.xml.getAllTextContent",ol.xml.getAllTextContent,OPENLAYERS);goog.exportSymbol("ol.xml.parse",ol.xml.parse,OPENLAYERS);goog.exportProperty(ol.webgl.Context.prototype,"getGL",ol.webgl.Context.prototype.getGL);goog.exportProperty(ol.webgl.Context.prototype,"useProgram",ol.webgl.Context.prototype.useProgram);goog.exportSymbol("ol.tilegrid.TileGrid",ol.tilegrid.TileGrid,OPENLAYERS);goog.exportProperty(ol.tilegrid.TileGrid.prototype,"forEachTileCoord",ol.tilegrid.TileGrid.prototype.forEachTileCoord);goog.exportProperty(ol.tilegrid.TileGrid.prototype,"getMaxZoom",ol.tilegrid.TileGrid.prototype.getMaxZoom);goog.exportProperty(ol.tilegrid.TileGrid.prototype,"getMinZoom",ol.tilegrid.TileGrid.prototype.getMinZoom);goog.exportProperty(ol.tilegrid.TileGrid.prototype,"getOrigin",ol.tilegrid.TileGrid.prototype.getOrigin);goog.exportProperty(ol.tilegrid.TileGrid.prototype,"getResolution",ol.tilegrid.TileGrid.prototype.getResolution);goog.exportProperty(ol.tilegrid.TileGrid.prototype,"getResolutions",ol.tilegrid.TileGrid.prototype.getResolutions);goog.exportProperty(ol.tilegrid.TileGrid.prototype,"getTileCoordExtent",ol.tilegrid.TileGrid.prototype.getTileCoordExtent);goog.exportProperty(ol.tilegrid.TileGrid.prototype,"getTileCoordForCoordAndResolution",ol.tilegrid.TileGrid.prototype.getTileCoordForCoordAndResolution);goog.exportProperty(ol.tilegrid.TileGrid.prototype,"getTileCoordForCoordAndZ",ol.tilegrid.TileGrid.prototype.getTileCoordForCoordAndZ);goog.exportProperty(ol.tilegrid.TileGrid.prototype,"getTileSize",ol.tilegrid.TileGrid.prototype.getTileSize);goog.exportProperty(ol.tilegrid.TileGrid.prototype,"getZForResolution",ol.tilegrid.TileGrid.prototype.getZForResolution);goog.exportSymbol("ol.tilegrid.WMTS",ol.tilegrid.WMTS,OPENLAYERS);goog.exportProperty(ol.tilegrid.WMTS.prototype,"getMatrixIds",ol.tilegrid.WMTS.prototype.getMatrixIds);goog.exportSymbol("ol.tilegrid.WMTS.createFromCapabilitiesMatrixSet",ol.tilegrid.WMTS.createFromCapabilitiesMatrixSet,OPENLAYERS);goog.exportSymbol("ol.style.AtlasManager",ol.style.AtlasManager,OPENLAYERS);goog.exportSymbol("ol.style.Circle",ol.style.Circle,OPENLAYERS);goog.exportProperty(ol.style.Circle.prototype,"setRadius",ol.style.Circle.prototype.setRadius);goog.exportSymbol("ol.style.Fill",ol.style.Fill,OPENLAYERS);goog.exportProperty(ol.style.Fill.prototype,"clone",ol.style.Fill.prototype.clone);goog.exportProperty(ol.style.Fill.prototype,"getColor",ol.style.Fill.prototype.getColor);goog.exportProperty(ol.style.Fill.prototype,"setColor",ol.style.Fill.prototype.setColor);goog.exportSymbol("ol.style.Icon",ol.style.Icon,OPENLAYERS);goog.exportProperty(ol.style.Icon.prototype,"clone",ol.style.Icon.prototype.clone);goog.exportProperty(ol.style.Icon.prototype,"getAnchor",ol.style.Icon.prototype.getAnchor);goog.exportProperty(ol.style.Icon.prototype,"getColor",ol.style.Icon.prototype.getColor);goog.exportProperty(ol.style.Icon.prototype,"getImage",ol.style.Icon.prototype.getImage);goog.exportProperty(ol.style.Icon.prototype,"getOrigin",ol.style.Icon.prototype.getOrigin);goog.exportProperty(ol.style.Icon.prototype,"getSrc",ol.style.Icon.prototype.getSrc);goog.exportProperty(ol.style.Icon.prototype,"getSize",ol.style.Icon.prototype.getSize);goog.exportProperty(ol.style.Icon.prototype,"load",ol.style.Icon.prototype.load);goog.exportProperty(ol.style.IconImageCache.prototype,"setSize",ol.style.IconImageCache.prototype.setSize);goog.exportSymbol("ol.style.Image",ol.style.Image,OPENLAYERS);goog.exportProperty(ol.style.Image.prototype,"getOpacity",ol.style.Image.prototype.getOpacity);goog.exportProperty(ol.style.Image.prototype,"getRotateWithView",ol.style.Image.prototype.getRotateWithView);goog.exportProperty(ol.style.Image.prototype,"getRotation",ol.style.Image.prototype.getRotation);goog.exportProperty(ol.style.Image.prototype,"getScale",ol.style.Image.prototype.getScale);goog.exportProperty(ol.style.Image.prototype,"getSnapToPixel",ol.style.Image.prototype.getSnapToPixel);goog.exportProperty(ol.style.Image.prototype,"setOpacity",ol.style.Image.prototype.setOpacity);goog.exportProperty(ol.style.Image.prototype,"setRotation",ol.style.Image.prototype.setRotation);goog.exportProperty(ol.style.Image.prototype,"setScale",ol.style.Image.prototype.setScale);goog.exportSymbol("ol.style.RegularShape",ol.style.RegularShape,OPENLAYERS);goog.exportProperty(ol.style.RegularShape.prototype,"clone",ol.style.RegularShape.prototype.clone);goog.exportProperty(ol.style.RegularShape.prototype,"getAnchor",ol.style.RegularShape.prototype.getAnchor);goog.exportProperty(ol.style.RegularShape.prototype,"getAngle",ol.style.RegularShape.prototype.getAngle);goog.exportProperty(ol.style.RegularShape.prototype,"getFill",ol.style.RegularShape.prototype.getFill);goog.exportProperty(ol.style.RegularShape.prototype,"getImage",ol.style.RegularShape.prototype.getImage);goog.exportProperty(ol.style.RegularShape.prototype,"getOrigin",ol.style.RegularShape.prototype.getOrigin);goog.exportProperty(ol.style.RegularShape.prototype,"getPoints",ol.style.RegularShape.prototype.getPoints);goog.exportProperty(ol.style.RegularShape.prototype,"getRadius",ol.style.RegularShape.prototype.getRadius);goog.exportProperty(ol.style.RegularShape.prototype,"getRadius2",ol.style.RegularShape.prototype.getRadius2);goog.exportProperty(ol.style.RegularShape.prototype,"getSize",ol.style.RegularShape.prototype.getSize);goog.exportProperty(ol.style.RegularShape.prototype,"getStroke",ol.style.RegularShape.prototype.getStroke);goog.exportSymbol("ol.style.Stroke",ol.style.Stroke,OPENLAYERS);goog.exportProperty(ol.style.Stroke.prototype,"clone",ol.style.Stroke.prototype.clone);goog.exportProperty(ol.style.Stroke.prototype,"getColor",ol.style.Stroke.prototype.getColor);goog.exportProperty(ol.style.Stroke.prototype,"getLineCap",ol.style.Stroke.prototype.getLineCap);goog.exportProperty(ol.style.Stroke.prototype,"getLineDash",ol.style.Stroke.prototype.getLineDash);goog.exportProperty(ol.style.Stroke.prototype,"getLineDashOffset",ol.style.Stroke.prototype.getLineDashOffset);goog.exportProperty(ol.style.Stroke.prototype,"getLineJoin",ol.style.Stroke.prototype.getLineJoin);goog.exportProperty(ol.style.Stroke.prototype,"getMiterLimit",ol.style.Stroke.prototype.getMiterLimit);goog.exportProperty(ol.style.Stroke.prototype,"getWidth",ol.style.Stroke.prototype.getWidth);goog.exportProperty(ol.style.Stroke.prototype,"setColor",ol.style.Stroke.prototype.setColor);goog.exportProperty(ol.style.Stroke.prototype,"setLineCap",ol.style.Stroke.prototype.setLineCap);goog.exportProperty(ol.style.Stroke.prototype,"setLineDash",ol.style.Stroke.prototype.setLineDash);goog.exportProperty(ol.style.Stroke.prototype,"setLineDashOffset",ol.style.Stroke.prototype.setLineDashOffset);goog.exportProperty(ol.style.Stroke.prototype,"setLineJoin",ol.style.Stroke.prototype.setLineJoin);goog.exportProperty(ol.style.Stroke.prototype,"setMiterLimit",ol.style.Stroke.prototype.setMiterLimit);goog.exportProperty(ol.style.Stroke.prototype,"setWidth",ol.style.Stroke.prototype.setWidth);goog.exportSymbol("ol.style.Style",ol.style.Style,OPENLAYERS);goog.exportProperty(ol.style.Style.prototype,"clone",ol.style.Style.prototype.clone);goog.exportProperty(ol.style.Style.prototype,"getRenderer",ol.style.Style.prototype.getRenderer);goog.exportProperty(ol.style.Style.prototype,"setRenderer",ol.style.Style.prototype.setRenderer);goog.exportProperty(ol.style.Style.prototype,"getGeometry",ol.style.Style.prototype.getGeometry);goog.exportProperty(ol.style.Style.prototype,"getGeometryFunction",ol.style.Style.prototype.getGeometryFunction);goog.exportProperty(ol.style.Style.prototype,"getFill",ol.style.Style.prototype.getFill);goog.exportProperty(ol.style.Style.prototype,"setFill",ol.style.Style.prototype.setFill);goog.exportProperty(ol.style.Style.prototype,"getImage",ol.style.Style.prototype.getImage);goog.exportProperty(ol.style.Style.prototype,"setImage",ol.style.Style.prototype.setImage);goog.exportProperty(ol.style.Style.prototype,"getStroke",ol.style.Style.prototype.getStroke);goog.exportProperty(ol.style.Style.prototype,"setStroke",ol.style.Style.prototype.setStroke);goog.exportProperty(ol.style.Style.prototype,"getText",ol.style.Style.prototype.getText);goog.exportProperty(ol.style.Style.prototype,"setText",ol.style.Style.prototype.setText);goog.exportProperty(ol.style.Style.prototype,"getZIndex",ol.style.Style.prototype.getZIndex);goog.exportProperty(ol.style.Style.prototype,"setGeometry",ol.style.Style.prototype.setGeometry);goog.exportProperty(ol.style.Style.prototype,"setZIndex",ol.style.Style.prototype.setZIndex);goog.exportSymbol("ol.style.Text",ol.style.Text,OPENLAYERS);goog.exportProperty(ol.style.Text.prototype,"clone",ol.style.Text.prototype.clone);goog.exportProperty(ol.style.Text.prototype,"getOverflow",ol.style.Text.prototype.getOverflow);goog.exportProperty(ol.style.Text.prototype,"getFont",ol.style.Text.prototype.getFont);goog.exportProperty(ol.style.Text.prototype,"getMaxAngle",ol.style.Text.prototype.getMaxAngle);goog.exportProperty(ol.style.Text.prototype,"getPlacement",ol.style.Text.prototype.getPlacement);goog.exportProperty(ol.style.Text.prototype,"getOffsetX",ol.style.Text.prototype.getOffsetX);goog.exportProperty(ol.style.Text.prototype,"getOffsetY",ol.style.Text.prototype.getOffsetY);goog.exportProperty(ol.style.Text.prototype,"getFill",ol.style.Text.prototype.getFill);goog.exportProperty(ol.style.Text.prototype,"getRotateWithView",ol.style.Text.prototype.getRotateWithView);goog.exportProperty(ol.style.Text.prototype,"getRotation",ol.style.Text.prototype.getRotation);goog.exportProperty(ol.style.Text.prototype,"getScale",ol.style.Text.prototype.getScale);goog.exportProperty(ol.style.Text.prototype,"getStroke",ol.style.Text.prototype.getStroke);goog.exportProperty(ol.style.Text.prototype,"getText",ol.style.Text.prototype.getText);goog.exportProperty(ol.style.Text.prototype,"getTextAlign",ol.style.Text.prototype.getTextAlign);goog.exportProperty(ol.style.Text.prototype,"getTextBaseline",ol.style.Text.prototype.getTextBaseline);goog.exportProperty(ol.style.Text.prototype,"getBackgroundFill",ol.style.Text.prototype.getBackgroundFill);goog.exportProperty(ol.style.Text.prototype,"getBackgroundStroke",ol.style.Text.prototype.getBackgroundStroke);goog.exportProperty(ol.style.Text.prototype,"getPadding",ol.style.Text.prototype.getPadding);goog.exportProperty(ol.style.Text.prototype,"setOverflow",ol.style.Text.prototype.setOverflow);goog.exportProperty(ol.style.Text.prototype,"setFont",ol.style.Text.prototype.setFont);goog.exportProperty(ol.style.Text.prototype,"setMaxAngle",ol.style.Text.prototype.setMaxAngle);goog.exportProperty(ol.style.Text.prototype,"setOffsetX",ol.style.Text.prototype.setOffsetX);goog.exportProperty(ol.style.Text.prototype,"setOffsetY",ol.style.Text.prototype.setOffsetY);goog.exportProperty(ol.style.Text.prototype,"setPlacement",ol.style.Text.prototype.setPlacement);goog.exportProperty(ol.style.Text.prototype,"setFill",ol.style.Text.prototype.setFill);goog.exportProperty(ol.style.Text.prototype,"setRotation",ol.style.Text.prototype.setRotation);goog.exportProperty(ol.style.Text.prototype,"setScale",ol.style.Text.prototype.setScale);goog.exportProperty(ol.style.Text.prototype,"setStroke",ol.style.Text.prototype.setStroke);goog.exportProperty(ol.style.Text.prototype,"setText",ol.style.Text.prototype.setText);goog.exportProperty(ol.style.Text.prototype,"setTextAlign",ol.style.Text.prototype.setTextAlign);goog.exportProperty(ol.style.Text.prototype,"setTextBaseline",ol.style.Text.prototype.setTextBaseline);goog.exportProperty(ol.style.Text.prototype,"setBackgroundFill",ol.style.Text.prototype.setBackgroundFill);goog.exportProperty(ol.style.Text.prototype,"setBackgroundStroke",ol.style.Text.prototype.setBackgroundStroke);goog.exportProperty(ol.style.Text.prototype,"setPadding",ol.style.Text.prototype.setPadding);goog.exportSymbol("ol.source.BingMaps",ol.source.BingMaps,OPENLAYERS);goog.exportSymbol("ol.source.BingMaps.TOS_ATTRIBUTION",ol.source.BingMaps.TOS_ATTRIBUTION,OPENLAYERS);goog.exportProperty(ol.source.BingMaps.prototype,"getApiKey",ol.source.BingMaps.prototype.getApiKey);goog.exportProperty(ol.source.BingMaps.prototype,"getImagerySet",ol.source.BingMaps.prototype.getImagerySet);goog.exportSymbol("ol.source.CartoDB",ol.source.CartoDB,OPENLAYERS);goog.exportProperty(ol.source.CartoDB.prototype,"getConfig",ol.source.CartoDB.prototype.getConfig);goog.exportProperty(ol.source.CartoDB.prototype,"updateConfig",ol.source.CartoDB.prototype.updateConfig);goog.exportProperty(ol.source.CartoDB.prototype,"setConfig",ol.source.CartoDB.prototype.setConfig);goog.exportSymbol("ol.source.Cluster",ol.source.Cluster,OPENLAYERS);goog.exportProperty(ol.source.Cluster.prototype,"getDistance",ol.source.Cluster.prototype.getDistance);goog.exportProperty(ol.source.Cluster.prototype,"getSource",ol.source.Cluster.prototype.getSource);goog.exportProperty(ol.source.Cluster.prototype,"setDistance",ol.source.Cluster.prototype.setDistance);goog.exportSymbol("ol.source.Image",ol.source.Image,OPENLAYERS);goog.exportProperty(ol.source.Image.Event.prototype,"image",ol.source.Image.Event.prototype.image);goog.exportSymbol("ol.source.ImageArcGISRest",ol.source.ImageArcGISRest,OPENLAYERS);goog.exportProperty(ol.source.ImageArcGISRest.prototype,"getParams",ol.source.ImageArcGISRest.prototype.getParams);goog.exportProperty(ol.source.ImageArcGISRest.prototype,"getImageLoadFunction",ol.source.ImageArcGISRest.prototype.getImageLoadFunction);goog.exportProperty(ol.source.ImageArcGISRest.prototype,"getUrl",ol.source.ImageArcGISRest.prototype.getUrl);goog.exportProperty(ol.source.ImageArcGISRest.prototype,"setImageLoadFunction",ol.source.ImageArcGISRest.prototype.setImageLoadFunction);goog.exportProperty(ol.source.ImageArcGISRest.prototype,"setUrl",ol.source.ImageArcGISRest.prototype.setUrl);goog.exportProperty(ol.source.ImageArcGISRest.prototype,"updateParams",ol.source.ImageArcGISRest.prototype.updateParams);goog.exportSymbol("ol.source.ImageCanvas",ol.source.ImageCanvas,OPENLAYERS);goog.exportSymbol("ol.source.ImageMapGuide",ol.source.ImageMapGuide,OPENLAYERS);goog.exportProperty(ol.source.ImageMapGuide.prototype,"getParams",ol.source.ImageMapGuide.prototype.getParams);goog.exportProperty(ol.source.ImageMapGuide.prototype,"getImageLoadFunction",ol.source.ImageMapGuide.prototype.getImageLoadFunction);goog.exportProperty(ol.source.ImageMapGuide.prototype,"updateParams",ol.source.ImageMapGuide.prototype.updateParams);goog.exportProperty(ol.source.ImageMapGuide.prototype,"setImageLoadFunction",ol.source.ImageMapGuide.prototype.setImageLoadFunction);goog.exportSymbol("ol.source.ImageStatic",ol.source.ImageStatic,OPENLAYERS);goog.exportSymbol("ol.source.ImageVector",ol.source.ImageVector,OPENLAYERS);goog.exportProperty(ol.source.ImageVector.prototype,"getSource",ol.source.ImageVector.prototype.getSource);goog.exportProperty(ol.source.ImageVector.prototype,"getStyle",ol.source.ImageVector.prototype.getStyle);goog.exportProperty(ol.source.ImageVector.prototype,"getStyleFunction",ol.source.ImageVector.prototype.getStyleFunction);goog.exportProperty(ol.source.ImageVector.prototype,"setStyle",ol.source.ImageVector.prototype.setStyle);goog.exportSymbol("ol.source.ImageWMS",ol.source.ImageWMS,OPENLAYERS);goog.exportProperty(ol.source.ImageWMS.prototype,"getGetFeatureInfoUrl",ol.source.ImageWMS.prototype.getGetFeatureInfoUrl);goog.exportProperty(ol.source.ImageWMS.prototype,"getParams",ol.source.ImageWMS.prototype.getParams);goog.exportProperty(ol.source.ImageWMS.prototype,"getImageLoadFunction",ol.source.ImageWMS.prototype.getImageLoadFunction);goog.exportProperty(ol.source.ImageWMS.prototype,"getUrl",ol.source.ImageWMS.prototype.getUrl);goog.exportProperty(ol.source.ImageWMS.prototype,"setImageLoadFunction",ol.source.ImageWMS.prototype.setImageLoadFunction);goog.exportProperty(ol.source.ImageWMS.prototype,"setUrl",ol.source.ImageWMS.prototype.setUrl);goog.exportProperty(ol.source.ImageWMS.prototype,"updateParams",ol.source.ImageWMS.prototype.updateParams);goog.exportSymbol("ol.source.OSM",ol.source.OSM,OPENLAYERS);goog.exportSymbol("ol.source.OSM.ATTRIBUTION",ol.source.OSM.ATTRIBUTION,OPENLAYERS);goog.exportSymbol("ol.source.Raster",ol.source.Raster,OPENLAYERS);goog.exportProperty(ol.source.Raster.prototype,"setOperation",ol.source.Raster.prototype.setOperation);goog.exportProperty(ol.source.Raster.Event.prototype,"extent",ol.source.Raster.Event.prototype.extent);goog.exportProperty(ol.source.Raster.Event.prototype,"resolution",ol.source.Raster.Event.prototype.resolution);goog.exportProperty(ol.source.Raster.Event.prototype,"data",ol.source.Raster.Event.prototype.data);goog.exportSymbol("ol.source.Source",ol.source.Source,OPENLAYERS);goog.exportProperty(ol.source.Source.prototype,"getAttributions",ol.source.Source.prototype.getAttributions);goog.exportProperty(ol.source.Source.prototype,"getLogo",ol.source.Source.prototype.getLogo);goog.exportProperty(ol.source.Source.prototype,"getProjection",ol.source.Source.prototype.getProjection);goog.exportProperty(ol.source.Source.prototype,"getState",ol.source.Source.prototype.getState);goog.exportProperty(ol.source.Source.prototype,"refresh",ol.source.Source.prototype.refresh);goog.exportProperty(ol.source.Source.prototype,"setAttributions",ol.source.Source.prototype.setAttributions);goog.exportSymbol("ol.source.Stamen",ol.source.Stamen,OPENLAYERS);goog.exportSymbol("ol.source.Tile",ol.source.Tile,OPENLAYERS);goog.exportProperty(ol.source.Tile.prototype,"getTileGrid",ol.source.Tile.prototype.getTileGrid);goog.exportProperty(ol.source.Tile.Event.prototype,"tile",ol.source.Tile.Event.prototype.tile);goog.exportSymbol("ol.source.TileArcGISRest",ol.source.TileArcGISRest,OPENLAYERS);goog.exportProperty(ol.source.TileArcGISRest.prototype,"getParams",ol.source.TileArcGISRest.prototype.getParams);goog.exportProperty(ol.source.TileArcGISRest.prototype,"updateParams",ol.source.TileArcGISRest.prototype.updateParams);goog.exportSymbol("ol.source.TileDebug",ol.source.TileDebug,OPENLAYERS);goog.exportSymbol("ol.source.TileImage",ol.source.TileImage,OPENLAYERS);goog.exportProperty(ol.source.TileImage.prototype,"setRenderReprojectionEdges",ol.source.TileImage.prototype.setRenderReprojectionEdges);goog.exportProperty(ol.source.TileImage.prototype,"setTileGridForProjection",ol.source.TileImage.prototype.setTileGridForProjection);goog.exportSymbol("ol.source.TileJSON",ol.source.TileJSON,OPENLAYERS);goog.exportProperty(ol.source.TileJSON.prototype,"getTileJSON",ol.source.TileJSON.prototype.getTileJSON);goog.exportSymbol("ol.source.TileUTFGrid",ol.source.TileUTFGrid,OPENLAYERS);goog.exportProperty(ol.source.TileUTFGrid.prototype,"getTemplate",ol.source.TileUTFGrid.prototype.getTemplate);goog.exportProperty(ol.source.TileUTFGrid.prototype,"forDataAtCoordinateAndResolution",ol.source.TileUTFGrid.prototype.forDataAtCoordinateAndResolution);goog.exportSymbol("ol.source.TileWMS",ol.source.TileWMS,OPENLAYERS);goog.exportProperty(ol.source.TileWMS.prototype,"getGetFeatureInfoUrl",ol.source.TileWMS.prototype.getGetFeatureInfoUrl);goog.exportProperty(ol.source.TileWMS.prototype,"getParams",ol.source.TileWMS.prototype.getParams);goog.exportProperty(ol.source.TileWMS.prototype,"updateParams",ol.source.TileWMS.prototype.updateParams);goog.exportProperty(ol.source.UrlTile.prototype,"getTileLoadFunction",ol.source.UrlTile.prototype.getTileLoadFunction);goog.exportProperty(ol.source.UrlTile.prototype,"getTileUrlFunction",ol.source.UrlTile.prototype.getTileUrlFunction);goog.exportProperty(ol.source.UrlTile.prototype,"getUrls",ol.source.UrlTile.prototype.getUrls);goog.exportProperty(ol.source.UrlTile.prototype,"setTileLoadFunction",ol.source.UrlTile.prototype.setTileLoadFunction);goog.exportProperty(ol.source.UrlTile.prototype,"setTileUrlFunction",ol.source.UrlTile.prototype.setTileUrlFunction);goog.exportProperty(ol.source.UrlTile.prototype,"setUrl",ol.source.UrlTile.prototype.setUrl);goog.exportProperty(ol.source.UrlTile.prototype,"setUrls",ol.source.UrlTile.prototype.setUrls);goog.exportSymbol("ol.source.Vector",ol.source.Vector,OPENLAYERS);goog.exportProperty(ol.source.Vector.prototype,"addFeature",ol.source.Vector.prototype.addFeature);goog.exportProperty(ol.source.Vector.prototype,"addFeatures",ol.source.Vector.prototype.addFeatures);goog.exportProperty(ol.source.Vector.prototype,"clear",ol.source.Vector.prototype.clear);goog.exportProperty(ol.source.Vector.prototype,"forEachFeature",ol.source.Vector.prototype.forEachFeature);goog.exportProperty(ol.source.Vector.prototype,"forEachFeatureInExtent",ol.source.Vector.prototype.forEachFeatureInExtent);goog.exportProperty(ol.source.Vector.prototype,"forEachFeatureIntersectingExtent",ol.source.Vector.prototype.forEachFeatureIntersectingExtent);goog.exportProperty(ol.source.Vector.prototype,"getFeaturesCollection",ol.source.Vector.prototype.getFeaturesCollection);goog.exportProperty(ol.source.Vector.prototype,"getFeatures",ol.source.Vector.prototype.getFeatures);goog.exportProperty(ol.source.Vector.prototype,"getFeaturesAtCoordinate",ol.source.Vector.prototype.getFeaturesAtCoordinate);goog.exportProperty(ol.source.Vector.prototype,"getFeaturesInExtent",ol.source.Vector.prototype.getFeaturesInExtent);goog.exportProperty(ol.source.Vector.prototype,"getClosestFeatureToCoordinate",ol.source.Vector.prototype.getClosestFeatureToCoordinate);goog.exportProperty(ol.source.Vector.prototype,"getExtent",ol.source.Vector.prototype.getExtent);goog.exportProperty(ol.source.Vector.prototype,"getFeatureById",ol.source.Vector.prototype.getFeatureById);goog.exportProperty(ol.source.Vector.prototype,"getFormat",ol.source.Vector.prototype.getFormat);goog.exportProperty(ol.source.Vector.prototype,"getUrl",ol.source.Vector.prototype.getUrl);goog.exportProperty(ol.source.Vector.prototype,"removeLoadedExtent",ol.source.Vector.prototype.removeLoadedExtent);goog.exportProperty(ol.source.Vector.prototype,"removeFeature",ol.source.Vector.prototype.removeFeature);goog.exportProperty(ol.source.Vector.prototype,"setLoader",ol.source.Vector.prototype.setLoader);goog.exportProperty(ol.source.Vector.Event.prototype,"feature",ol.source.Vector.Event.prototype.feature);goog.exportSymbol("ol.source.VectorTile",ol.source.VectorTile,OPENLAYERS);goog.exportProperty(ol.source.VectorTile.prototype,"clear",ol.source.VectorTile.prototype.clear);goog.exportSymbol("ol.source.WMTS",ol.source.WMTS,OPENLAYERS);goog.exportProperty(ol.source.WMTS.prototype,"getDimensions",ol.source.WMTS.prototype.getDimensions);goog.exportProperty(ol.source.WMTS.prototype,"getFormat",ol.source.WMTS.prototype.getFormat);goog.exportProperty(ol.source.WMTS.prototype,"getLayer",ol.source.WMTS.prototype.getLayer);goog.exportProperty(ol.source.WMTS.prototype,"getMatrixSet",ol.source.WMTS.prototype.getMatrixSet);goog.exportProperty(ol.source.WMTS.prototype,"getRequestEncoding",ol.source.WMTS.prototype.getRequestEncoding);goog.exportProperty(ol.source.WMTS.prototype,"getStyle",ol.source.WMTS.prototype.getStyle);goog.exportProperty(ol.source.WMTS.prototype,"getVersion",ol.source.WMTS.prototype.getVersion);goog.exportProperty(ol.source.WMTS.prototype,"updateDimensions",ol.source.WMTS.prototype.updateDimensions);goog.exportSymbol("ol.source.WMTS.optionsFromCapabilities",ol.source.WMTS.optionsFromCapabilities,OPENLAYERS);goog.exportSymbol("ol.source.XYZ",ol.source.XYZ,OPENLAYERS);goog.exportSymbol("ol.source.Zoomify",ol.source.Zoomify,OPENLAYERS);goog.exportSymbol("ol.renderer.webgl.ImageLayer",ol.renderer.webgl.ImageLayer,OPENLAYERS);goog.exportSymbol("ol.renderer.webgl.Map",ol.renderer.webgl.Map,OPENLAYERS);goog.exportSymbol("ol.renderer.webgl.TileLayer",ol.renderer.webgl.TileLayer,OPENLAYERS);goog.exportSymbol("ol.renderer.webgl.VectorLayer",ol.renderer.webgl.VectorLayer,OPENLAYERS);goog.exportSymbol("ol.renderer.canvas.ImageLayer",ol.renderer.canvas.ImageLayer,OPENLAYERS);goog.exportSymbol("ol.renderer.canvas.Map",ol.renderer.canvas.Map,OPENLAYERS);goog.exportSymbol("ol.renderer.canvas.TileLayer",ol.renderer.canvas.TileLayer,OPENLAYERS);goog.exportSymbol("ol.renderer.canvas.VectorLayer",ol.renderer.canvas.VectorLayer,OPENLAYERS);goog.exportSymbol("ol.renderer.canvas.VectorTileLayer",ol.renderer.canvas.VectorTileLayer,OPENLAYERS);goog.exportProperty(ol.render.Event.prototype,"vectorContext",ol.render.Event.prototype.vectorContext);goog.exportProperty(ol.render.Event.prototype,"frameState",ol.render.Event.prototype.frameState);goog.exportProperty(ol.render.Event.prototype,"context",ol.render.Event.prototype.context);goog.exportProperty(ol.render.Event.prototype,"glContext",ol.render.Event.prototype.glContext);goog.exportProperty(ol.render.Feature.prototype,"get",ol.render.Feature.prototype.get);goog.exportProperty(ol.render.Feature.prototype,"getExtent",ol.render.Feature.prototype.getExtent);goog.exportProperty(ol.render.Feature.prototype,"getId",ol.render.Feature.prototype.getId);goog.exportProperty(ol.render.Feature.prototype,"getGeometry",ol.render.Feature.prototype.getGeometry);goog.exportProperty(ol.render.Feature.prototype,"getProperties",ol.render.Feature.prototype.getProperties);goog.exportProperty(ol.render.Feature.prototype,"getType",ol.render.Feature.prototype.getType);goog.exportSymbol("ol.render.VectorContext",ol.render.VectorContext,OPENLAYERS);goog.exportProperty(ol.render.webgl.Immediate.prototype,"setStyle",ol.render.webgl.Immediate.prototype.setStyle);goog.exportProperty(ol.render.webgl.Immediate.prototype,"drawGeometry",ol.render.webgl.Immediate.prototype.drawGeometry);goog.exportProperty(ol.render.webgl.Immediate.prototype,"drawFeature",ol.render.webgl.Immediate.prototype.drawFeature);goog.exportProperty(ol.render.canvas.Immediate.prototype,"drawCircle",ol.render.canvas.Immediate.prototype.drawCircle);goog.exportProperty(ol.render.canvas.Immediate.prototype,"setStyle",ol.render.canvas.Immediate.prototype.setStyle);goog.exportProperty(ol.render.canvas.Immediate.prototype,"drawGeometry",ol.render.canvas.Immediate.prototype.drawGeometry);goog.exportProperty(ol.render.canvas.Immediate.prototype,"drawFeature",ol.render.canvas.Immediate.prototype.drawFeature);goog.exportSymbol("ol.proj.common.add",ol.proj.common.add,OPENLAYERS);goog.exportSymbol("ol.proj.Projection",ol.proj.Projection,OPENLAYERS);goog.exportProperty(ol.proj.Projection.prototype,"getCode",ol.proj.Projection.prototype.getCode);goog.exportProperty(ol.proj.Projection.prototype,"getExtent",ol.proj.Projection.prototype.getExtent);goog.exportProperty(ol.proj.Projection.prototype,"getUnits",ol.proj.Projection.prototype.getUnits);goog.exportProperty(ol.proj.Projection.prototype,"getMetersPerUnit",ol.proj.Projection.prototype.getMetersPerUnit);goog.exportProperty(ol.proj.Projection.prototype,"getWorldExtent",ol.proj.Projection.prototype.getWorldExtent);goog.exportProperty(ol.proj.Projection.prototype,"getAxisOrientation",ol.proj.Projection.prototype.getAxisOrientation);goog.exportProperty(ol.proj.Projection.prototype,"isGlobal",ol.proj.Projection.prototype.isGlobal);goog.exportProperty(ol.proj.Projection.prototype,"setGlobal",ol.proj.Projection.prototype.setGlobal);goog.exportProperty(ol.proj.Projection.prototype,"setExtent",ol.proj.Projection.prototype.setExtent);goog.exportProperty(ol.proj.Projection.prototype,"setWorldExtent",ol.proj.Projection.prototype.setWorldExtent);goog.exportProperty(ol.proj.Projection.prototype,"setGetPointResolution",ol.proj.Projection.prototype.setGetPointResolution);goog.exportSymbol("ol.proj.Units.METERS_PER_UNIT",ol.proj.Units.METERS_PER_UNIT,OPENLAYERS);goog.exportSymbol("ol.layer.Base",ol.layer.Base,OPENLAYERS);goog.exportProperty(ol.layer.Base.prototype,"getExtent",ol.layer.Base.prototype.getExtent);goog.exportProperty(ol.layer.Base.prototype,"getMaxResolution",ol.layer.Base.prototype.getMaxResolution);goog.exportProperty(ol.layer.Base.prototype,"getMinResolution",ol.layer.Base.prototype.getMinResolution);goog.exportProperty(ol.layer.Base.prototype,"getOpacity",ol.layer.Base.prototype.getOpacity);goog.exportProperty(ol.layer.Base.prototype,"getVisible",ol.layer.Base.prototype.getVisible);goog.exportProperty(ol.layer.Base.prototype,"getZIndex",ol.layer.Base.prototype.getZIndex);goog.exportProperty(ol.layer.Base.prototype,"setExtent",ol.layer.Base.prototype.setExtent);goog.exportProperty(ol.layer.Base.prototype,"setMaxResolution",ol.layer.Base.prototype.setMaxResolution);goog.exportProperty(ol.layer.Base.prototype,"setMinResolution",ol.layer.Base.prototype.setMinResolution);goog.exportProperty(ol.layer.Base.prototype,"setOpacity",ol.layer.Base.prototype.setOpacity);goog.exportProperty(ol.layer.Base.prototype,"setVisible",ol.layer.Base.prototype.setVisible);goog.exportProperty(ol.layer.Base.prototype,"setZIndex",ol.layer.Base.prototype.setZIndex);goog.exportSymbol("ol.layer.Group",ol.layer.Group,OPENLAYERS);goog.exportProperty(ol.layer.Group.prototype,"getLayers",ol.layer.Group.prototype.getLayers);goog.exportProperty(ol.layer.Group.prototype,"setLayers",ol.layer.Group.prototype.setLayers);goog.exportSymbol("ol.layer.Heatmap",ol.layer.Heatmap,OPENLAYERS);goog.exportProperty(ol.layer.Heatmap.prototype,"getBlur",ol.layer.Heatmap.prototype.getBlur);goog.exportProperty(ol.layer.Heatmap.prototype,"getGradient",ol.layer.Heatmap.prototype.getGradient);goog.exportProperty(ol.layer.Heatmap.prototype,"getRadius",ol.layer.Heatmap.prototype.getRadius);goog.exportProperty(ol.layer.Heatmap.prototype,"setBlur",ol.layer.Heatmap.prototype.setBlur);goog.exportProperty(ol.layer.Heatmap.prototype,"setGradient",ol.layer.Heatmap.prototype.setGradient);goog.exportProperty(ol.layer.Heatmap.prototype,"setRadius",ol.layer.Heatmap.prototype.setRadius);goog.exportSymbol("ol.layer.Image",ol.layer.Image,OPENLAYERS);goog.exportProperty(ol.layer.Image.prototype,"getSource",ol.layer.Image.prototype.getSource);goog.exportSymbol("ol.layer.Layer",ol.layer.Layer,OPENLAYERS);goog.exportProperty(ol.layer.Layer.prototype,"getSource",ol.layer.Layer.prototype.getSource);goog.exportProperty(ol.layer.Layer.prototype,"setMap",ol.layer.Layer.prototype.setMap);goog.exportProperty(ol.layer.Layer.prototype,"setSource",ol.layer.Layer.prototype.setSource);goog.exportSymbol("ol.layer.Tile",ol.layer.Tile,OPENLAYERS);goog.exportProperty(ol.layer.Tile.prototype,"getPreload",ol.layer.Tile.prototype.getPreload);goog.exportProperty(ol.layer.Tile.prototype,"getSource",ol.layer.Tile.prototype.getSource);goog.exportProperty(ol.layer.Tile.prototype,"setPreload",ol.layer.Tile.prototype.setPreload);goog.exportProperty(ol.layer.Tile.prototype,"getUseInterimTilesOnError",ol.layer.Tile.prototype.getUseInterimTilesOnError);goog.exportProperty(ol.layer.Tile.prototype,"setUseInterimTilesOnError",ol.layer.Tile.prototype.setUseInterimTilesOnError);goog.exportSymbol("ol.layer.Vector",ol.layer.Vector,OPENLAYERS);goog.exportProperty(ol.layer.Vector.prototype,"getSource",ol.layer.Vector.prototype.getSource);goog.exportProperty(ol.layer.Vector.prototype,"getStyle",ol.layer.Vector.prototype.getStyle);goog.exportProperty(ol.layer.Vector.prototype,"getStyleFunction",ol.layer.Vector.prototype.getStyleFunction);goog.exportProperty(ol.layer.Vector.prototype,"setStyle",ol.layer.Vector.prototype.setStyle);goog.exportSymbol("ol.layer.VectorTile",ol.layer.VectorTile,OPENLAYERS);goog.exportProperty(ol.layer.VectorTile.prototype,"getPreload",ol.layer.VectorTile.prototype.getPreload);goog.exportProperty(ol.layer.VectorTile.prototype,"getUseInterimTilesOnError",ol.layer.VectorTile.prototype.getUseInterimTilesOnError);goog.exportProperty(ol.layer.VectorTile.prototype,"setPreload",ol.layer.VectorTile.prototype.setPreload);goog.exportProperty(ol.layer.VectorTile.prototype,"setUseInterimTilesOnError",ol.layer.VectorTile.prototype.setUseInterimTilesOnError);goog.exportProperty(ol.layer.VectorTile.prototype,"getSource",ol.layer.VectorTile.prototype.getSource);goog.exportSymbol("ol.interaction.DoubleClickZoom",ol.interaction.DoubleClickZoom,OPENLAYERS);goog.exportSymbol("ol.interaction.DoubleClickZoom.handleEvent",ol.interaction.DoubleClickZoom.handleEvent,OPENLAYERS);goog.exportSymbol("ol.interaction.DragAndDrop",ol.interaction.DragAndDrop,OPENLAYERS);goog.exportSymbol("ol.interaction.DragAndDrop.handleEvent",ol.interaction.DragAndDrop.handleEvent,OPENLAYERS);goog.exportProperty(ol.interaction.DragAndDrop.Event.prototype,"features",ol.interaction.DragAndDrop.Event.prototype.features);goog.exportProperty(ol.interaction.DragAndDrop.Event.prototype,"file",ol.interaction.DragAndDrop.Event.prototype.file);goog.exportProperty(ol.interaction.DragAndDrop.Event.prototype,"projection",ol.interaction.DragAndDrop.Event.prototype.projection);goog.exportSymbol("ol.interaction.DragBox",ol.interaction.DragBox,OPENLAYERS);goog.exportProperty(ol.interaction.DragBox.prototype,"getGeometry",ol.interaction.DragBox.prototype.getGeometry);goog.exportProperty(ol.interaction.DragBox.Event.prototype,"coordinate",ol.interaction.DragBox.Event.prototype.coordinate);goog.exportProperty(ol.interaction.DragBox.Event.prototype,"mapBrowserEvent",ol.interaction.DragBox.Event.prototype.mapBrowserEvent);goog.exportSymbol("ol.interaction.DragPan",ol.interaction.DragPan,OPENLAYERS);goog.exportSymbol("ol.interaction.DragRotate",ol.interaction.DragRotate,OPENLAYERS);goog.exportSymbol("ol.interaction.DragRotateAndZoom",ol.interaction.DragRotateAndZoom,OPENLAYERS);goog.exportSymbol("ol.interaction.DragZoom",ol.interaction.DragZoom,OPENLAYERS);goog.exportSymbol("ol.interaction.Draw",ol.interaction.Draw,OPENLAYERS);goog.exportSymbol("ol.interaction.Draw.handleEvent",ol.interaction.Draw.handleEvent,OPENLAYERS);goog.exportProperty(ol.interaction.Draw.prototype,"removeLastPoint",ol.interaction.Draw.prototype.removeLastPoint);goog.exportProperty(ol.interaction.Draw.prototype,"finishDrawing",ol.interaction.Draw.prototype.finishDrawing);goog.exportProperty(ol.interaction.Draw.prototype,"extend",ol.interaction.Draw.prototype.extend);goog.exportSymbol("ol.interaction.Draw.createRegularPolygon",ol.interaction.Draw.createRegularPolygon,OPENLAYERS);goog.exportSymbol("ol.interaction.Draw.createBox",ol.interaction.Draw.createBox,OPENLAYERS);goog.exportProperty(ol.interaction.Draw.Event.prototype,"feature",ol.interaction.Draw.Event.prototype.feature);goog.exportSymbol("ol.interaction.Extent",ol.interaction.Extent,OPENLAYERS);goog.exportProperty(ol.interaction.Extent.prototype,"getExtent",ol.interaction.Extent.prototype.getExtent);goog.exportProperty(ol.interaction.Extent.prototype,"setExtent",ol.interaction.Extent.prototype.setExtent);goog.exportProperty(ol.interaction.Extent.Event.prototype,"extent",ol.interaction.Extent.Event.prototype.extent);goog.exportSymbol("ol.interaction.Interaction",ol.interaction.Interaction,OPENLAYERS);goog.exportProperty(ol.interaction.Interaction.prototype,"getActive",ol.interaction.Interaction.prototype.getActive);goog.exportProperty(ol.interaction.Interaction.prototype,"getMap",ol.interaction.Interaction.prototype.getMap);goog.exportProperty(ol.interaction.Interaction.prototype,"setActive",ol.interaction.Interaction.prototype.setActive);goog.exportSymbol("ol.interaction.KeyboardPan",ol.interaction.KeyboardPan,OPENLAYERS);goog.exportSymbol("ol.interaction.KeyboardPan.handleEvent",ol.interaction.KeyboardPan.handleEvent,OPENLAYERS);goog.exportSymbol("ol.interaction.KeyboardZoom",ol.interaction.KeyboardZoom,OPENLAYERS);goog.exportSymbol("ol.interaction.KeyboardZoom.handleEvent",ol.interaction.KeyboardZoom.handleEvent,OPENLAYERS);goog.exportSymbol("ol.interaction.Modify",ol.interaction.Modify,OPENLAYERS);goog.exportSymbol("ol.interaction.Modify.handleEvent",ol.interaction.Modify.handleEvent,OPENLAYERS);goog.exportProperty(ol.interaction.Modify.prototype,"removePoint",ol.interaction.Modify.prototype.removePoint);goog.exportProperty(ol.interaction.Modify.Event.prototype,"features",ol.interaction.Modify.Event.prototype.features);goog.exportProperty(ol.interaction.Modify.Event.prototype,"mapBrowserEvent",ol.interaction.Modify.Event.prototype.mapBrowserEvent);goog.exportSymbol("ol.interaction.MouseWheelZoom",ol.interaction.MouseWheelZoom,OPENLAYERS);goog.exportSymbol("ol.interaction.MouseWheelZoom.handleEvent",ol.interaction.MouseWheelZoom.handleEvent,OPENLAYERS);goog.exportProperty(ol.interaction.MouseWheelZoom.prototype,"setMouseAnchor",ol.interaction.MouseWheelZoom.prototype.setMouseAnchor);goog.exportSymbol("ol.interaction.PinchRotate",ol.interaction.PinchRotate,OPENLAYERS);goog.exportSymbol("ol.interaction.PinchZoom",ol.interaction.PinchZoom,OPENLAYERS);goog.exportSymbol("ol.interaction.Pointer",ol.interaction.Pointer,OPENLAYERS);goog.exportSymbol("ol.interaction.Pointer.handleEvent",ol.interaction.Pointer.handleEvent,OPENLAYERS);goog.exportSymbol("ol.interaction.Select",ol.interaction.Select,OPENLAYERS);goog.exportProperty(ol.interaction.Select.prototype,"getFeatures",ol.interaction.Select.prototype.getFeatures);goog.exportProperty(ol.interaction.Select.prototype,"getHitTolerance",ol.interaction.Select.prototype.getHitTolerance);goog.exportProperty(ol.interaction.Select.prototype,"getLayer",ol.interaction.Select.prototype.getLayer);goog.exportSymbol("ol.interaction.Select.handleEvent",ol.interaction.Select.handleEvent,OPENLAYERS);goog.exportProperty(ol.interaction.Select.prototype,"setHitTolerance",ol.interaction.Select.prototype.setHitTolerance);goog.exportProperty(ol.interaction.Select.prototype,"setMap",ol.interaction.Select.prototype.setMap);goog.exportProperty(ol.interaction.Select.Event.prototype,"selected",ol.interaction.Select.Event.prototype.selected);goog.exportProperty(ol.interaction.Select.Event.prototype,"deselected",ol.interaction.Select.Event.prototype.deselected);goog.exportProperty(ol.interaction.Select.Event.prototype,"mapBrowserEvent",ol.interaction.Select.Event.prototype.mapBrowserEvent);goog.exportSymbol("ol.interaction.Snap",ol.interaction.Snap,OPENLAYERS);goog.exportProperty(ol.interaction.Snap.prototype,"addFeature",ol.interaction.Snap.prototype.addFeature);goog.exportProperty(ol.interaction.Snap.prototype,"removeFeature",ol.interaction.Snap.prototype.removeFeature);goog.exportSymbol("ol.interaction.Translate",ol.interaction.Translate,OPENLAYERS);goog.exportProperty(ol.interaction.Translate.prototype,"getHitTolerance",ol.interaction.Translate.prototype.getHitTolerance);goog.exportProperty(ol.interaction.Translate.prototype,"setHitTolerance",ol.interaction.Translate.prototype.setHitTolerance);goog.exportProperty(ol.interaction.Translate.Event.prototype,"features",ol.interaction.Translate.Event.prototype.features);goog.exportProperty(ol.interaction.Translate.Event.prototype,"coordinate",ol.interaction.Translate.Event.prototype.coordinate);goog.exportSymbol("ol.geom.Circle",ol.geom.Circle,OPENLAYERS);goog.exportProperty(ol.geom.Circle.prototype,"clone",ol.geom.Circle.prototype.clone);goog.exportProperty(ol.geom.Circle.prototype,"getCenter",ol.geom.Circle.prototype.getCenter);goog.exportProperty(ol.geom.Circle.prototype,"getRadius",ol.geom.Circle.prototype.getRadius);goog.exportProperty(ol.geom.Circle.prototype,"getType",ol.geom.Circle.prototype.getType);goog.exportProperty(ol.geom.Circle.prototype,"intersectsExtent",ol.geom.Circle.prototype.intersectsExtent);goog.exportProperty(ol.geom.Circle.prototype,"setCenter",ol.geom.Circle.prototype.setCenter);goog.exportProperty(ol.geom.Circle.prototype,"setCenterAndRadius",ol.geom.Circle.prototype.setCenterAndRadius);goog.exportProperty(ol.geom.Circle.prototype,"setRadius",ol.geom.Circle.prototype.setRadius);goog.exportProperty(ol.geom.Circle.prototype,"transform",ol.geom.Circle.prototype.transform);goog.exportSymbol("ol.geom.Geometry",ol.geom.Geometry,OPENLAYERS);goog.exportProperty(ol.geom.Geometry.prototype,"getClosestPoint",ol.geom.Geometry.prototype.getClosestPoint);goog.exportProperty(ol.geom.Geometry.prototype,"intersectsCoordinate",ol.geom.Geometry.prototype.intersectsCoordinate);goog.exportProperty(ol.geom.Geometry.prototype,"getExtent",ol.geom.Geometry.prototype.getExtent);goog.exportProperty(ol.geom.Geometry.prototype,"rotate",ol.geom.Geometry.prototype.rotate);goog.exportProperty(ol.geom.Geometry.prototype,"scale",ol.geom.Geometry.prototype.scale);goog.exportProperty(ol.geom.Geometry.prototype,"simplify",ol.geom.Geometry.prototype.simplify);goog.exportProperty(ol.geom.Geometry.prototype,"transform",ol.geom.Geometry.prototype.transform);goog.exportSymbol("ol.geom.GeometryCollection",ol.geom.GeometryCollection,OPENLAYERS);goog.exportProperty(ol.geom.GeometryCollection.prototype,"clone",ol.geom.GeometryCollection.prototype.clone);goog.exportProperty(ol.geom.GeometryCollection.prototype,"getGeometries",ol.geom.GeometryCollection.prototype.getGeometries);goog.exportProperty(ol.geom.GeometryCollection.prototype,"getType",ol.geom.GeometryCollection.prototype.getType);goog.exportProperty(ol.geom.GeometryCollection.prototype,"intersectsExtent",ol.geom.GeometryCollection.prototype.intersectsExtent);goog.exportProperty(ol.geom.GeometryCollection.prototype,"setGeometries",ol.geom.GeometryCollection.prototype.setGeometries);goog.exportProperty(ol.geom.GeometryCollection.prototype,"applyTransform",ol.geom.GeometryCollection.prototype.applyTransform);goog.exportProperty(ol.geom.GeometryCollection.prototype,"translate",ol.geom.GeometryCollection.prototype.translate);goog.exportSymbol("ol.geom.LinearRing",ol.geom.LinearRing,OPENLAYERS);goog.exportProperty(ol.geom.LinearRing.prototype,"clone",ol.geom.LinearRing.prototype.clone);goog.exportProperty(ol.geom.LinearRing.prototype,"getArea",ol.geom.LinearRing.prototype.getArea);goog.exportProperty(ol.geom.LinearRing.prototype,"getCoordinates",ol.geom.LinearRing.prototype.getCoordinates);goog.exportProperty(ol.geom.LinearRing.prototype,"getType",ol.geom.LinearRing.prototype.getType);goog.exportProperty(ol.geom.LinearRing.prototype,"setCoordinates",ol.geom.LinearRing.prototype.setCoordinates);goog.exportSymbol("ol.geom.LineString",ol.geom.LineString,OPENLAYERS);goog.exportProperty(ol.geom.LineString.prototype,"appendCoordinate",ol.geom.LineString.prototype.appendCoordinate);goog.exportProperty(ol.geom.LineString.prototype,"clone",ol.geom.LineString.prototype.clone);goog.exportProperty(ol.geom.LineString.prototype,"forEachSegment",ol.geom.LineString.prototype.forEachSegment);goog.exportProperty(ol.geom.LineString.prototype,"getCoordinateAtM",ol.geom.LineString.prototype.getCoordinateAtM);goog.exportProperty(ol.geom.LineString.prototype,"getCoordinates",ol.geom.LineString.prototype.getCoordinates);goog.exportProperty(ol.geom.LineString.prototype,"getCoordinateAt",ol.geom.LineString.prototype.getCoordinateAt);goog.exportProperty(ol.geom.LineString.prototype,"getLength",ol.geom.LineString.prototype.getLength);goog.exportProperty(ol.geom.LineString.prototype,"getType",ol.geom.LineString.prototype.getType);goog.exportProperty(ol.geom.LineString.prototype,"intersectsExtent",ol.geom.LineString.prototype.intersectsExtent);goog.exportProperty(ol.geom.LineString.prototype,"setCoordinates",ol.geom.LineString.prototype.setCoordinates);goog.exportSymbol("ol.geom.MultiLineString",ol.geom.MultiLineString,OPENLAYERS);goog.exportProperty(ol.geom.MultiLineString.prototype,"appendLineString",ol.geom.MultiLineString.prototype.appendLineString);goog.exportProperty(ol.geom.MultiLineString.prototype,"clone",ol.geom.MultiLineString.prototype.clone);goog.exportProperty(ol.geom.MultiLineString.prototype,"getCoordinateAtM",ol.geom.MultiLineString.prototype.getCoordinateAtM);goog.exportProperty(ol.geom.MultiLineString.prototype,"getCoordinates",ol.geom.MultiLineString.prototype.getCoordinates);goog.exportProperty(ol.geom.MultiLineString.prototype,"getLineString",ol.geom.MultiLineString.prototype.getLineString);goog.exportProperty(ol.geom.MultiLineString.prototype,"getLineStrings",ol.geom.MultiLineString.prototype.getLineStrings);goog.exportProperty(ol.geom.MultiLineString.prototype,"getType",ol.geom.MultiLineString.prototype.getType);goog.exportProperty(ol.geom.MultiLineString.prototype,"intersectsExtent",ol.geom.MultiLineString.prototype.intersectsExtent);goog.exportProperty(ol.geom.MultiLineString.prototype,"setCoordinates",ol.geom.MultiLineString.prototype.setCoordinates);goog.exportSymbol("ol.geom.MultiPoint",ol.geom.MultiPoint,OPENLAYERS);goog.exportProperty(ol.geom.MultiPoint.prototype,"appendPoint",ol.geom.MultiPoint.prototype.appendPoint);goog.exportProperty(ol.geom.MultiPoint.prototype,"clone",ol.geom.MultiPoint.prototype.clone);goog.exportProperty(ol.geom.MultiPoint.prototype,"getCoordinates",ol.geom.MultiPoint.prototype.getCoordinates);goog.exportProperty(ol.geom.MultiPoint.prototype,"getPoint",ol.geom.MultiPoint.prototype.getPoint);goog.exportProperty(ol.geom.MultiPoint.prototype,"getPoints",ol.geom.MultiPoint.prototype.getPoints);goog.exportProperty(ol.geom.MultiPoint.prototype,"getType",ol.geom.MultiPoint.prototype.getType);goog.exportProperty(ol.geom.MultiPoint.prototype,"intersectsExtent",ol.geom.MultiPoint.prototype.intersectsExtent);goog.exportProperty(ol.geom.MultiPoint.prototype,"setCoordinates",ol.geom.MultiPoint.prototype.setCoordinates);goog.exportSymbol("ol.geom.MultiPolygon",ol.geom.MultiPolygon,OPENLAYERS);goog.exportProperty(ol.geom.MultiPolygon.prototype,"appendPolygon",ol.geom.MultiPolygon.prototype.appendPolygon);goog.exportProperty(ol.geom.MultiPolygon.prototype,"clone",ol.geom.MultiPolygon.prototype.clone);goog.exportProperty(ol.geom.MultiPolygon.prototype,"getArea",ol.geom.MultiPolygon.prototype.getArea);goog.exportProperty(ol.geom.MultiPolygon.prototype,"getCoordinates",ol.geom.MultiPolygon.prototype.getCoordinates);goog.exportProperty(ol.geom.MultiPolygon.prototype,"getInteriorPoints",ol.geom.MultiPolygon.prototype.getInteriorPoints);goog.exportProperty(ol.geom.MultiPolygon.prototype,"getPolygon",ol.geom.MultiPolygon.prototype.getPolygon);goog.exportProperty(ol.geom.MultiPolygon.prototype,"getPolygons",ol.geom.MultiPolygon.prototype.getPolygons);goog.exportProperty(ol.geom.MultiPolygon.prototype,"getType",ol.geom.MultiPolygon.prototype.getType);goog.exportProperty(ol.geom.MultiPolygon.prototype,"intersectsExtent",ol.geom.MultiPolygon.prototype.intersectsExtent);goog.exportProperty(ol.geom.MultiPolygon.prototype,"setCoordinates",ol.geom.MultiPolygon.prototype.setCoordinates);goog.exportSymbol("ol.geom.Point",ol.geom.Point,OPENLAYERS);goog.exportProperty(ol.geom.Point.prototype,"clone",ol.geom.Point.prototype.clone);goog.exportProperty(ol.geom.Point.prototype,"getCoordinates",ol.geom.Point.prototype.getCoordinates);goog.exportProperty(ol.geom.Point.prototype,"getType",ol.geom.Point.prototype.getType);goog.exportProperty(ol.geom.Point.prototype,"intersectsExtent",ol.geom.Point.prototype.intersectsExtent);goog.exportProperty(ol.geom.Point.prototype,"setCoordinates",ol.geom.Point.prototype.setCoordinates);goog.exportSymbol("ol.geom.Polygon",ol.geom.Polygon,OPENLAYERS);goog.exportProperty(ol.geom.Polygon.prototype,"appendLinearRing",ol.geom.Polygon.prototype.appendLinearRing);goog.exportProperty(ol.geom.Polygon.prototype,"clone",ol.geom.Polygon.prototype.clone);goog.exportProperty(ol.geom.Polygon.prototype,"getArea",ol.geom.Polygon.prototype.getArea);goog.exportProperty(ol.geom.Polygon.prototype,"getCoordinates",ol.geom.Polygon.prototype.getCoordinates);goog.exportProperty(ol.geom.Polygon.prototype,"getInteriorPoint",ol.geom.Polygon.prototype.getInteriorPoint);goog.exportProperty(ol.geom.Polygon.prototype,"getLinearRingCount",ol.geom.Polygon.prototype.getLinearRingCount);goog.exportProperty(ol.geom.Polygon.prototype,"getLinearRing",ol.geom.Polygon.prototype.getLinearRing);goog.exportProperty(ol.geom.Polygon.prototype,"getLinearRings",ol.geom.Polygon.prototype.getLinearRings);goog.exportProperty(ol.geom.Polygon.prototype,"getType",ol.geom.Polygon.prototype.getType);goog.exportProperty(ol.geom.Polygon.prototype,"intersectsExtent",ol.geom.Polygon.prototype.intersectsExtent);goog.exportProperty(ol.geom.Polygon.prototype,"setCoordinates",ol.geom.Polygon.prototype.setCoordinates);goog.exportSymbol("ol.geom.Polygon.circular",ol.geom.Polygon.circular,OPENLAYERS);goog.exportSymbol("ol.geom.Polygon.fromExtent",ol.geom.Polygon.fromExtent,OPENLAYERS);goog.exportSymbol("ol.geom.Polygon.fromCircle",ol.geom.Polygon.fromCircle,OPENLAYERS);goog.exportSymbol("ol.geom.SimpleGeometry",ol.geom.SimpleGeometry,OPENLAYERS);goog.exportProperty(ol.geom.SimpleGeometry.prototype,"getFirstCoordinate",ol.geom.SimpleGeometry.prototype.getFirstCoordinate);goog.exportProperty(ol.geom.SimpleGeometry.prototype,"getLastCoordinate",ol.geom.SimpleGeometry.prototype.getLastCoordinate);goog.exportProperty(ol.geom.SimpleGeometry.prototype,"getLayout",ol.geom.SimpleGeometry.prototype.getLayout);goog.exportProperty(ol.geom.SimpleGeometry.prototype,"applyTransform",ol.geom.SimpleGeometry.prototype.applyTransform);goog.exportProperty(ol.geom.SimpleGeometry.prototype,"translate",ol.geom.SimpleGeometry.prototype.translate);goog.exportSymbol("ol.format.EsriJSON",ol.format.EsriJSON,OPENLAYERS);goog.exportProperty(ol.format.EsriJSON.prototype,"readFeature",ol.format.EsriJSON.prototype.readFeature);goog.exportProperty(ol.format.EsriJSON.prototype,"readFeatures",ol.format.EsriJSON.prototype.readFeatures);goog.exportProperty(ol.format.EsriJSON.prototype,"readGeometry",ol.format.EsriJSON.prototype.readGeometry);goog.exportProperty(ol.format.EsriJSON.prototype,"readProjection",ol.format.EsriJSON.prototype.readProjection);goog.exportProperty(ol.format.EsriJSON.prototype,"writeGeometry",ol.format.EsriJSON.prototype.writeGeometry);goog.exportProperty(ol.format.EsriJSON.prototype,"writeGeometryObject",ol.format.EsriJSON.prototype.writeGeometryObject);goog.exportProperty(ol.format.EsriJSON.prototype,"writeFeature",ol.format.EsriJSON.prototype.writeFeature);goog.exportProperty(ol.format.EsriJSON.prototype,"writeFeatureObject",ol.format.EsriJSON.prototype.writeFeatureObject);goog.exportProperty(ol.format.EsriJSON.prototype,"writeFeatures",ol.format.EsriJSON.prototype.writeFeatures);goog.exportProperty(ol.format.EsriJSON.prototype,"writeFeaturesObject",ol.format.EsriJSON.prototype.writeFeaturesObject);goog.exportSymbol("ol.format.Feature",ol.format.Feature,OPENLAYERS);goog.exportSymbol("ol.format.filter.and",ol.format.filter.and,OPENLAYERS);goog.exportSymbol("ol.format.filter.or",ol.format.filter.or,OPENLAYERS);goog.exportSymbol("ol.format.filter.not",ol.format.filter.not,OPENLAYERS);goog.exportSymbol("ol.format.filter.bbox",ol.format.filter.bbox,OPENLAYERS);goog.exportSymbol("ol.format.filter.contains",ol.format.filter.contains,OPENLAYERS);goog.exportSymbol("ol.format.filter.intersects",ol.format.filter.intersects,OPENLAYERS);goog.exportSymbol("ol.format.filter.within",ol.format.filter.within,OPENLAYERS);goog.exportSymbol("ol.format.filter.equalTo",ol.format.filter.equalTo,OPENLAYERS);goog.exportSymbol("ol.format.filter.notEqualTo",ol.format.filter.notEqualTo,OPENLAYERS);goog.exportSymbol("ol.format.filter.lessThan",ol.format.filter.lessThan,OPENLAYERS);goog.exportSymbol("ol.format.filter.lessThanOrEqualTo",ol.format.filter.lessThanOrEqualTo,OPENLAYERS);goog.exportSymbol("ol.format.filter.greaterThan",ol.format.filter.greaterThan,OPENLAYERS);goog.exportSymbol("ol.format.filter.greaterThanOrEqualTo",ol.format.filter.greaterThanOrEqualTo,OPENLAYERS);goog.exportSymbol("ol.format.filter.isNull",ol.format.filter.isNull,OPENLAYERS);goog.exportSymbol("ol.format.filter.between",ol.format.filter.between,OPENLAYERS);goog.exportSymbol("ol.format.filter.like",ol.format.filter.like,OPENLAYERS);goog.exportSymbol("ol.format.filter.during",ol.format.filter.during,OPENLAYERS);goog.exportSymbol("ol.format.GeoJSON",ol.format.GeoJSON,OPENLAYERS);goog.exportProperty(ol.format.GeoJSON.prototype,"readFeature",ol.format.GeoJSON.prototype.readFeature);goog.exportProperty(ol.format.GeoJSON.prototype,"readFeatures",ol.format.GeoJSON.prototype.readFeatures);goog.exportProperty(ol.format.GeoJSON.prototype,"readGeometry",ol.format.GeoJSON.prototype.readGeometry);goog.exportProperty(ol.format.GeoJSON.prototype,"readProjection",ol.format.GeoJSON.prototype.readProjection);goog.exportProperty(ol.format.GeoJSON.prototype,"writeFeature",ol.format.GeoJSON.prototype.writeFeature);goog.exportProperty(ol.format.GeoJSON.prototype,"writeFeatureObject",ol.format.GeoJSON.prototype.writeFeatureObject);goog.exportProperty(ol.format.GeoJSON.prototype,"writeFeatures",ol.format.GeoJSON.prototype.writeFeatures);goog.exportProperty(ol.format.GeoJSON.prototype,"writeFeaturesObject",ol.format.GeoJSON.prototype.writeFeaturesObject);goog.exportProperty(ol.format.GeoJSON.prototype,"writeGeometry",ol.format.GeoJSON.prototype.writeGeometry);goog.exportProperty(ol.format.GeoJSON.prototype,"writeGeometryObject",ol.format.GeoJSON.prototype.writeGeometryObject);goog.exportSymbol("ol.format.GML",ol.format.GML,OPENLAYERS);goog.exportProperty(ol.format.GML.prototype,"writeFeatures",ol.format.GML.prototype.writeFeatures);goog.exportProperty(ol.format.GML.prototype,"writeFeaturesNode",ol.format.GML.prototype.writeFeaturesNode);goog.exportSymbol("ol.format.GML2",ol.format.GML2,OPENLAYERS);goog.exportSymbol("ol.format.GML3",ol.format.GML3,OPENLAYERS);goog.exportProperty(ol.format.GML3.prototype,"writeGeometryNode",ol.format.GML3.prototype.writeGeometryNode);goog.exportProperty(ol.format.GML3.prototype,"writeFeatures",ol.format.GML3.prototype.writeFeatures);goog.exportProperty(ol.format.GML3.prototype,"writeFeaturesNode",ol.format.GML3.prototype.writeFeaturesNode);goog.exportProperty(ol.format.GMLBase.prototype,"readFeatures",ol.format.GMLBase.prototype.readFeatures);goog.exportSymbol("ol.format.GPX",ol.format.GPX,OPENLAYERS);goog.exportProperty(ol.format.GPX.prototype,"readFeature",ol.format.GPX.prototype.readFeature);goog.exportProperty(ol.format.GPX.prototype,"readFeatures",ol.format.GPX.prototype.readFeatures);goog.exportProperty(ol.format.GPX.prototype,"readProjection",ol.format.GPX.prototype.readProjection);goog.exportProperty(ol.format.GPX.prototype,"writeFeatures",ol.format.GPX.prototype.writeFeatures);goog.exportProperty(ol.format.GPX.prototype,"writeFeaturesNode",ol.format.GPX.prototype.writeFeaturesNode);goog.exportSymbol("ol.format.IGC",ol.format.IGC,OPENLAYERS);goog.exportProperty(ol.format.IGC.prototype,"readFeature",ol.format.IGC.prototype.readFeature);goog.exportProperty(ol.format.IGC.prototype,"readFeatures",ol.format.IGC.prototype.readFeatures);goog.exportProperty(ol.format.IGC.prototype,"readProjection",ol.format.IGC.prototype.readProjection);goog.exportSymbol("ol.format.KML",ol.format.KML,OPENLAYERS);goog.exportProperty(ol.format.KML.prototype,"readFeature",ol.format.KML.prototype.readFeature);goog.exportProperty(ol.format.KML.prototype,"readFeatures",ol.format.KML.prototype.readFeatures);goog.exportProperty(ol.format.KML.prototype,"readName",ol.format.KML.prototype.readName);goog.exportProperty(ol.format.KML.prototype,"readNetworkLinks",ol.format.KML.prototype.readNetworkLinks);goog.exportProperty(ol.format.KML.prototype,"readRegion",ol.format.KML.prototype.readRegion);goog.exportProperty(ol.format.KML.prototype,"readRegionFromNode",ol.format.KML.prototype.readRegionFromNode);goog.exportProperty(ol.format.KML.prototype,"readProjection",ol.format.KML.prototype.readProjection);goog.exportProperty(ol.format.KML.prototype,"writeFeatures",ol.format.KML.prototype.writeFeatures);goog.exportProperty(ol.format.KML.prototype,"writeFeaturesNode",ol.format.KML.prototype.writeFeaturesNode);goog.exportSymbol("ol.format.MVT",ol.format.MVT,OPENLAYERS);goog.exportProperty(ol.format.MVT.prototype,"getLastExtent",ol.format.MVT.prototype.getLastExtent);goog.exportProperty(ol.format.MVT.prototype,"readFeatures",ol.format.MVT.prototype.readFeatures);goog.exportProperty(ol.format.MVT.prototype,"readProjection",ol.format.MVT.prototype.readProjection);goog.exportProperty(ol.format.MVT.prototype,"setLayers",ol.format.MVT.prototype.setLayers);goog.exportSymbol("ol.format.OSMXML",ol.format.OSMXML,OPENLAYERS);goog.exportProperty(ol.format.OSMXML.prototype,"readFeatures",ol.format.OSMXML.prototype.readFeatures);goog.exportProperty(ol.format.OSMXML.prototype,"readProjection",ol.format.OSMXML.prototype.readProjection);goog.exportSymbol("ol.format.Polyline",ol.format.Polyline,OPENLAYERS);goog.exportSymbol("ol.format.Polyline.encodeDeltas",ol.format.Polyline.encodeDeltas,OPENLAYERS);goog.exportSymbol("ol.format.Polyline.decodeDeltas",ol.format.Polyline.decodeDeltas,OPENLAYERS);goog.exportSymbol("ol.format.Polyline.encodeFloats",ol.format.Polyline.encodeFloats,OPENLAYERS);goog.exportSymbol("ol.format.Polyline.decodeFloats",ol.format.Polyline.decodeFloats,OPENLAYERS);goog.exportProperty(ol.format.Polyline.prototype,"readFeature",ol.format.Polyline.prototype.readFeature);goog.exportProperty(ol.format.Polyline.prototype,"readFeatures",ol.format.Polyline.prototype.readFeatures);goog.exportProperty(ol.format.Polyline.prototype,"readGeometry",ol.format.Polyline.prototype.readGeometry);goog.exportProperty(ol.format.Polyline.prototype,"readProjection",ol.format.Polyline.prototype.readProjection);goog.exportProperty(ol.format.Polyline.prototype,"writeGeometry",ol.format.Polyline.prototype.writeGeometry);goog.exportSymbol("ol.format.TopoJSON",ol.format.TopoJSON,OPENLAYERS);goog.exportProperty(ol.format.TopoJSON.prototype,"readFeatures",ol.format.TopoJSON.prototype.readFeatures);goog.exportProperty(ol.format.TopoJSON.prototype,"readProjection",ol.format.TopoJSON.prototype.readProjection);goog.exportSymbol("ol.format.WFS",ol.format.WFS,OPENLAYERS);goog.exportProperty(ol.format.WFS.prototype,"readFeatures",ol.format.WFS.prototype.readFeatures);goog.exportProperty(ol.format.WFS.prototype,"readTransactionResponse",ol.format.WFS.prototype.readTransactionResponse);goog.exportProperty(ol.format.WFS.prototype,"readFeatureCollectionMetadata",ol.format.WFS.prototype.readFeatureCollectionMetadata);goog.exportSymbol("ol.format.WFS.writeFilter",ol.format.WFS.writeFilter,OPENLAYERS);goog.exportProperty(ol.format.WFS.prototype,"writeGetFeature",ol.format.WFS.prototype.writeGetFeature);goog.exportProperty(ol.format.WFS.prototype,"writeTransaction",ol.format.WFS.prototype.writeTransaction);goog.exportProperty(ol.format.WFS.prototype,"readProjection",ol.format.WFS.prototype.readProjection);goog.exportSymbol("ol.format.WKT",ol.format.WKT,OPENLAYERS);goog.exportProperty(ol.format.WKT.prototype,"readFeature",ol.format.WKT.prototype.readFeature);goog.exportProperty(ol.format.WKT.prototype,"readFeatures",ol.format.WKT.prototype.readFeatures);goog.exportProperty(ol.format.WKT.prototype,"readGeometry",ol.format.WKT.prototype.readGeometry);goog.exportProperty(ol.format.WKT.prototype,"writeFeature",ol.format.WKT.prototype.writeFeature);goog.exportProperty(ol.format.WKT.prototype,"writeFeatures",ol.format.WKT.prototype.writeFeatures);goog.exportProperty(ol.format.WKT.prototype,"writeGeometry",ol.format.WKT.prototype.writeGeometry);goog.exportSymbol("ol.format.WMSCapabilities",ol.format.WMSCapabilities,OPENLAYERS);goog.exportProperty(ol.format.WMSCapabilities.prototype,"read",ol.format.WMSCapabilities.prototype.read);goog.exportSymbol("ol.format.WMSGetFeatureInfo",ol.format.WMSGetFeatureInfo,OPENLAYERS);goog.exportProperty(ol.format.WMSGetFeatureInfo.prototype,"readFeatures",ol.format.WMSGetFeatureInfo.prototype.readFeatures);goog.exportSymbol("ol.format.WMTSCapabilities",ol.format.WMTSCapabilities,OPENLAYERS);goog.exportProperty(ol.format.WMTSCapabilities.prototype,"read",ol.format.WMTSCapabilities.prototype.read);goog.exportSymbol("ol.format.filter.And",ol.format.filter.And,OPENLAYERS);goog.exportSymbol("ol.format.filter.Bbox",ol.format.filter.Bbox,OPENLAYERS);goog.exportSymbol("ol.format.filter.Comparison",ol.format.filter.Comparison,OPENLAYERS);goog.exportSymbol("ol.format.filter.ComparisonBinary",ol.format.filter.ComparisonBinary,OPENLAYERS);goog.exportSymbol("ol.format.filter.Contains",ol.format.filter.Contains,OPENLAYERS);goog.exportSymbol("ol.format.filter.During",ol.format.filter.During,OPENLAYERS);goog.exportSymbol("ol.format.filter.EqualTo",ol.format.filter.EqualTo,OPENLAYERS);goog.exportSymbol("ol.format.filter.Filter",ol.format.filter.Filter,OPENLAYERS);goog.exportSymbol("ol.format.filter.GreaterThan",ol.format.filter.GreaterThan,OPENLAYERS);goog.exportSymbol("ol.format.filter.GreaterThanOrEqualTo",ol.format.filter.GreaterThanOrEqualTo,OPENLAYERS);goog.exportSymbol("ol.format.filter.Intersects",ol.format.filter.Intersects,OPENLAYERS);goog.exportSymbol("ol.format.filter.IsBetween",ol.format.filter.IsBetween,OPENLAYERS);goog.exportSymbol("ol.format.filter.IsLike",ol.format.filter.IsLike,OPENLAYERS);goog.exportSymbol("ol.format.filter.IsNull",ol.format.filter.IsNull,OPENLAYERS);goog.exportSymbol("ol.format.filter.LessThan",ol.format.filter.LessThan,OPENLAYERS);goog.exportSymbol("ol.format.filter.LessThanOrEqualTo",ol.format.filter.LessThanOrEqualTo,OPENLAYERS);goog.exportSymbol("ol.format.filter.Not",ol.format.filter.Not,OPENLAYERS);goog.exportSymbol("ol.format.filter.NotEqualTo",ol.format.filter.NotEqualTo,OPENLAYERS);goog.exportSymbol("ol.format.filter.Or",ol.format.filter.Or,OPENLAYERS);goog.exportSymbol("ol.format.filter.Spatial",ol.format.filter.Spatial,OPENLAYERS);goog.exportSymbol("ol.format.filter.Within",ol.format.filter.Within,OPENLAYERS);goog.exportSymbol("ol.events.condition.altKeyOnly",ol.events.condition.altKeyOnly,OPENLAYERS);goog.exportSymbol("ol.events.condition.altShiftKeysOnly",ol.events.condition.altShiftKeysOnly,OPENLAYERS);goog.exportSymbol("ol.events.condition.always",ol.events.condition.always,OPENLAYERS);goog.exportSymbol("ol.events.condition.click",ol.events.condition.click,OPENLAYERS);goog.exportSymbol("ol.events.condition.never",ol.events.condition.never,OPENLAYERS);goog.exportSymbol("ol.events.condition.pointerMove",ol.events.condition.pointerMove,OPENLAYERS);goog.exportSymbol("ol.events.condition.singleClick",ol.events.condition.singleClick,OPENLAYERS);goog.exportSymbol("ol.events.condition.doubleClick",ol.events.condition.doubleClick,OPENLAYERS);goog.exportSymbol("ol.events.condition.noModifierKeys",ol.events.condition.noModifierKeys,OPENLAYERS);goog.exportSymbol("ol.events.condition.platformModifierKeyOnly",ol.events.condition.platformModifierKeyOnly,OPENLAYERS);goog.exportSymbol("ol.events.condition.shiftKeyOnly",ol.events.condition.shiftKeyOnly,OPENLAYERS);goog.exportSymbol("ol.events.condition.targetNotEditable",ol.events.condition.targetNotEditable,OPENLAYERS);goog.exportSymbol("ol.events.condition.mouseOnly",ol.events.condition.mouseOnly,OPENLAYERS);goog.exportSymbol("ol.events.condition.primaryAction",ol.events.condition.primaryAction,OPENLAYERS);goog.exportProperty(ol.events.Event.prototype,"type",ol.events.Event.prototype.type);goog.exportProperty(ol.events.Event.prototype,"target",ol.events.Event.prototype.target);goog.exportProperty(ol.events.Event.prototype,"preventDefault",ol.events.Event.prototype.preventDefault);goog.exportProperty(ol.events.Event.prototype,"stopPropagation",ol.events.Event.prototype.stopPropagation);goog.exportSymbol("ol.control.Attribution",ol.control.Attribution,OPENLAYERS);goog.exportSymbol("ol.control.Attribution.render",ol.control.Attribution.render,OPENLAYERS);goog.exportProperty(ol.control.Attribution.prototype,"getCollapsible",ol.control.Attribution.prototype.getCollapsible);goog.exportProperty(ol.control.Attribution.prototype,"setCollapsible",ol.control.Attribution.prototype.setCollapsible);goog.exportProperty(ol.control.Attribution.prototype,"setCollapsed",ol.control.Attribution.prototype.setCollapsed);goog.exportProperty(ol.control.Attribution.prototype,"getCollapsed",ol.control.Attribution.prototype.getCollapsed);goog.exportSymbol("ol.control.Control",ol.control.Control,OPENLAYERS);goog.exportProperty(ol.control.Control.prototype,"getMap",ol.control.Control.prototype.getMap);goog.exportProperty(ol.control.Control.prototype,"setMap",ol.control.Control.prototype.setMap);goog.exportProperty(ol.control.Control.prototype,"setTarget",ol.control.Control.prototype.setTarget);goog.exportSymbol("ol.control.FullScreen",ol.control.FullScreen,OPENLAYERS);goog.exportSymbol("ol.control.MousePosition",ol.control.MousePosition,OPENLAYERS);goog.exportSymbol("ol.control.MousePosition.render",ol.control.MousePosition.render,OPENLAYERS);goog.exportProperty(ol.control.MousePosition.prototype,"getCoordinateFormat",ol.control.MousePosition.prototype.getCoordinateFormat);goog.exportProperty(ol.control.MousePosition.prototype,"getProjection",ol.control.MousePosition.prototype.getProjection);goog.exportProperty(ol.control.MousePosition.prototype,"setCoordinateFormat",ol.control.MousePosition.prototype.setCoordinateFormat);goog.exportProperty(ol.control.MousePosition.prototype,"setProjection",ol.control.MousePosition.prototype.setProjection);goog.exportSymbol("ol.control.OverviewMap",ol.control.OverviewMap,OPENLAYERS);goog.exportSymbol("ol.control.OverviewMap.render",ol.control.OverviewMap.render,OPENLAYERS);goog.exportProperty(ol.control.OverviewMap.prototype,"getCollapsible",ol.control.OverviewMap.prototype.getCollapsible);goog.exportProperty(ol.control.OverviewMap.prototype,"setCollapsible",ol.control.OverviewMap.prototype.setCollapsible);goog.exportProperty(ol.control.OverviewMap.prototype,"setCollapsed",ol.control.OverviewMap.prototype.setCollapsed);goog.exportProperty(ol.control.OverviewMap.prototype,"getCollapsed",ol.control.OverviewMap.prototype.getCollapsed);goog.exportProperty(ol.control.OverviewMap.prototype,"getOverviewMap",ol.control.OverviewMap.prototype.getOverviewMap);goog.exportSymbol("ol.control.Rotate",ol.control.Rotate,OPENLAYERS);goog.exportSymbol("ol.control.Rotate.render",ol.control.Rotate.render,OPENLAYERS);goog.exportSymbol("ol.control.ScaleLine",ol.control.ScaleLine,OPENLAYERS);goog.exportProperty(ol.control.ScaleLine.prototype,"getUnits",ol.control.ScaleLine.prototype.getUnits);goog.exportSymbol("ol.control.ScaleLine.render",ol.control.ScaleLine.render,OPENLAYERS);goog.exportProperty(ol.control.ScaleLine.prototype,"setUnits",ol.control.ScaleLine.prototype.setUnits);goog.exportSymbol("ol.control.Zoom",ol.control.Zoom,OPENLAYERS);goog.exportSymbol("ol.control.ZoomSlider",ol.control.ZoomSlider,OPENLAYERS);goog.exportSymbol("ol.control.ZoomSlider.render",ol.control.ZoomSlider.render,OPENLAYERS);goog.exportSymbol("ol.control.ZoomToExtent",ol.control.ZoomToExtent,OPENLAYERS);goog.exportProperty(ol.Object.prototype,"changed",ol.Object.prototype.changed);goog.exportProperty(ol.Object.prototype,"dispatchEvent",ol.Object.prototype.dispatchEvent);goog.exportProperty(ol.Object.prototype,"getRevision",ol.Object.prototype.getRevision);goog.exportProperty(ol.Object.prototype,"on",ol.Object.prototype.on);goog.exportProperty(ol.Object.prototype,"once",ol.Object.prototype.once);goog.exportProperty(ol.Object.prototype,"un",ol.Object.prototype.un);goog.exportProperty(ol.PluggableMap.prototype,"get",ol.PluggableMap.prototype.get);goog.exportProperty(ol.PluggableMap.prototype,"getKeys",ol.PluggableMap.prototype.getKeys);goog.exportProperty(ol.PluggableMap.prototype,"getProperties",ol.PluggableMap.prototype.getProperties);goog.exportProperty(ol.PluggableMap.prototype,"set",ol.PluggableMap.prototype.set);goog.exportProperty(ol.PluggableMap.prototype,"setProperties",ol.PluggableMap.prototype.setProperties);goog.exportProperty(ol.PluggableMap.prototype,"unset",ol.PluggableMap.prototype.unset);goog.exportProperty(ol.PluggableMap.prototype,"changed",ol.PluggableMap.prototype.changed);goog.exportProperty(ol.PluggableMap.prototype,"dispatchEvent",ol.PluggableMap.prototype.dispatchEvent);goog.exportProperty(ol.PluggableMap.prototype,"getRevision",ol.PluggableMap.prototype.getRevision);goog.exportProperty(ol.PluggableMap.prototype,"on",ol.PluggableMap.prototype.on);goog.exportProperty(ol.PluggableMap.prototype,"once",ol.PluggableMap.prototype.once);goog.exportProperty(ol.PluggableMap.prototype,"un",ol.PluggableMap.prototype.un);goog.exportProperty(ol.CanvasMap.prototype,"addControl",ol.CanvasMap.prototype.addControl);goog.exportProperty(ol.CanvasMap.prototype,"addInteraction",ol.CanvasMap.prototype.addInteraction);goog.exportProperty(ol.CanvasMap.prototype,"addLayer",ol.CanvasMap.prototype.addLayer);goog.exportProperty(ol.CanvasMap.prototype,"addOverlay",ol.CanvasMap.prototype.addOverlay);goog.exportProperty(ol.CanvasMap.prototype,"forEachFeatureAtPixel",ol.CanvasMap.prototype.forEachFeatureAtPixel);goog.exportProperty(ol.CanvasMap.prototype,"getFeaturesAtPixel",ol.CanvasMap.prototype.getFeaturesAtPixel);goog.exportProperty(ol.CanvasMap.prototype,"forEachLayerAtPixel",ol.CanvasMap.prototype.forEachLayerAtPixel);goog.exportProperty(ol.CanvasMap.prototype,"hasFeatureAtPixel",ol.CanvasMap.prototype.hasFeatureAtPixel);goog.exportProperty(ol.CanvasMap.prototype,"getEventCoordinate",ol.CanvasMap.prototype.getEventCoordinate);goog.exportProperty(ol.CanvasMap.prototype,"getEventPixel",ol.CanvasMap.prototype.getEventPixel);goog.exportProperty(ol.CanvasMap.prototype,"getTarget",ol.CanvasMap.prototype.getTarget);goog.exportProperty(ol.CanvasMap.prototype,"getTargetElement",ol.CanvasMap.prototype.getTargetElement);goog.exportProperty(ol.CanvasMap.prototype,"getCoordinateFromPixel",ol.CanvasMap.prototype.getCoordinateFromPixel);goog.exportProperty(ol.CanvasMap.prototype,"getControls",ol.CanvasMap.prototype.getControls);goog.exportProperty(ol.CanvasMap.prototype,"getOverlays",ol.CanvasMap.prototype.getOverlays);goog.exportProperty(ol.CanvasMap.prototype,"getOverlayById",ol.CanvasMap.prototype.getOverlayById);goog.exportProperty(ol.CanvasMap.prototype,"getInteractions",ol.CanvasMap.prototype.getInteractions);goog.exportProperty(ol.CanvasMap.prototype,"getLayerGroup",ol.CanvasMap.prototype.getLayerGroup);goog.exportProperty(ol.CanvasMap.prototype,"getLayers",ol.CanvasMap.prototype.getLayers);goog.exportProperty(ol.CanvasMap.prototype,"getPixelFromCoordinate",ol.CanvasMap.prototype.getPixelFromCoordinate);goog.exportProperty(ol.CanvasMap.prototype,"getSize",ol.CanvasMap.prototype.getSize);goog.exportProperty(ol.CanvasMap.prototype,"getView",ol.CanvasMap.prototype.getView);goog.exportProperty(ol.CanvasMap.prototype,"getViewport",ol.CanvasMap.prototype.getViewport);goog.exportProperty(ol.CanvasMap.prototype,"renderSync",ol.CanvasMap.prototype.renderSync);goog.exportProperty(ol.CanvasMap.prototype,"render",ol.CanvasMap.prototype.render);goog.exportProperty(ol.CanvasMap.prototype,"removeControl",ol.CanvasMap.prototype.removeControl);goog.exportProperty(ol.CanvasMap.prototype,"removeInteraction",ol.CanvasMap.prototype.removeInteraction);goog.exportProperty(ol.CanvasMap.prototype,"removeLayer",ol.CanvasMap.prototype.removeLayer);goog.exportProperty(ol.CanvasMap.prototype,"removeOverlay",ol.CanvasMap.prototype.removeOverlay);goog.exportProperty(ol.CanvasMap.prototype,"setLayerGroup",ol.CanvasMap.prototype.setLayerGroup);goog.exportProperty(ol.CanvasMap.prototype,"setSize",ol.CanvasMap.prototype.setSize);goog.exportProperty(ol.CanvasMap.prototype,"setTarget",ol.CanvasMap.prototype.setTarget);goog.exportProperty(ol.CanvasMap.prototype,"setView",ol.CanvasMap.prototype.setView);goog.exportProperty(ol.CanvasMap.prototype,"updateSize",ol.CanvasMap.prototype.updateSize);goog.exportProperty(ol.CanvasMap.prototype,"get",ol.CanvasMap.prototype.get);goog.exportProperty(ol.CanvasMap.prototype,"getKeys",ol.CanvasMap.prototype.getKeys);goog.exportProperty(ol.CanvasMap.prototype,"getProperties",ol.CanvasMap.prototype.getProperties);goog.exportProperty(ol.CanvasMap.prototype,"set",ol.CanvasMap.prototype.set);goog.exportProperty(ol.CanvasMap.prototype,"setProperties",ol.CanvasMap.prototype.setProperties);goog.exportProperty(ol.CanvasMap.prototype,"unset",ol.CanvasMap.prototype.unset);goog.exportProperty(ol.CanvasMap.prototype,"changed",ol.CanvasMap.prototype.changed);goog.exportProperty(ol.CanvasMap.prototype,"dispatchEvent",ol.CanvasMap.prototype.dispatchEvent);goog.exportProperty(ol.CanvasMap.prototype,"getRevision",ol.CanvasMap.prototype.getRevision);goog.exportProperty(ol.CanvasMap.prototype,"on",ol.CanvasMap.prototype.on);goog.exportProperty(ol.CanvasMap.prototype,"once",ol.CanvasMap.prototype.once);goog.exportProperty(ol.CanvasMap.prototype,"un",ol.CanvasMap.prototype.un);goog.exportProperty(ol.Collection.prototype,"get",ol.Collection.prototype.get);goog.exportProperty(ol.Collection.prototype,"getKeys",ol.Collection.prototype.getKeys);goog.exportProperty(ol.Collection.prototype,"getProperties",ol.Collection.prototype.getProperties);goog.exportProperty(ol.Collection.prototype,"set",ol.Collection.prototype.set);goog.exportProperty(ol.Collection.prototype,"setProperties",ol.Collection.prototype.setProperties);goog.exportProperty(ol.Collection.prototype,"unset",ol.Collection.prototype.unset);goog.exportProperty(ol.Collection.prototype,"changed",ol.Collection.prototype.changed);goog.exportProperty(ol.Collection.prototype,"dispatchEvent",ol.Collection.prototype.dispatchEvent);goog.exportProperty(ol.Collection.prototype,"getRevision",ol.Collection.prototype.getRevision);goog.exportProperty(ol.Collection.prototype,"on",ol.Collection.prototype.on);goog.exportProperty(ol.Collection.prototype,"once",ol.Collection.prototype.once);goog.exportProperty(ol.Collection.prototype,"un",ol.Collection.prototype.un);goog.exportProperty(ol.Collection.Event.prototype,"type",ol.Collection.Event.prototype.type);goog.exportProperty(ol.Collection.Event.prototype,"target",ol.Collection.Event.prototype.target);goog.exportProperty(ol.Collection.Event.prototype,"preventDefault",ol.Collection.Event.prototype.preventDefault);goog.exportProperty(ol.Collection.Event.prototype,"stopPropagation",ol.Collection.Event.prototype.stopPropagation);goog.exportProperty(ol.DeviceOrientation.prototype,"get",ol.DeviceOrientation.prototype.get);goog.exportProperty(ol.DeviceOrientation.prototype,"getKeys",ol.DeviceOrientation.prototype.getKeys);goog.exportProperty(ol.DeviceOrientation.prototype,"getProperties",ol.DeviceOrientation.prototype.getProperties);goog.exportProperty(ol.DeviceOrientation.prototype,"set",ol.DeviceOrientation.prototype.set);goog.exportProperty(ol.DeviceOrientation.prototype,"setProperties",ol.DeviceOrientation.prototype.setProperties);goog.exportProperty(ol.DeviceOrientation.prototype,"unset",ol.DeviceOrientation.prototype.unset);goog.exportProperty(ol.DeviceOrientation.prototype,"changed",ol.DeviceOrientation.prototype.changed);goog.exportProperty(ol.DeviceOrientation.prototype,"dispatchEvent",ol.DeviceOrientation.prototype.dispatchEvent);goog.exportProperty(ol.DeviceOrientation.prototype,"getRevision",ol.DeviceOrientation.prototype.getRevision);goog.exportProperty(ol.DeviceOrientation.prototype,"on",ol.DeviceOrientation.prototype.on);goog.exportProperty(ol.DeviceOrientation.prototype,"once",ol.DeviceOrientation.prototype.once);goog.exportProperty(ol.DeviceOrientation.prototype,"un",ol.DeviceOrientation.prototype.un);goog.exportProperty(ol.Feature.prototype,"get",ol.Feature.prototype.get);goog.exportProperty(ol.Feature.prototype,"getKeys",ol.Feature.prototype.getKeys);goog.exportProperty(ol.Feature.prototype,"getProperties",ol.Feature.prototype.getProperties);goog.exportProperty(ol.Feature.prototype,"set",ol.Feature.prototype.set);goog.exportProperty(ol.Feature.prototype,"setProperties",ol.Feature.prototype.setProperties);goog.exportProperty(ol.Feature.prototype,"unset",ol.Feature.prototype.unset);goog.exportProperty(ol.Feature.prototype,"changed",ol.Feature.prototype.changed);goog.exportProperty(ol.Feature.prototype,"dispatchEvent",ol.Feature.prototype.dispatchEvent);goog.exportProperty(ol.Feature.prototype,"getRevision",ol.Feature.prototype.getRevision);goog.exportProperty(ol.Feature.prototype,"on",ol.Feature.prototype.on);goog.exportProperty(ol.Feature.prototype,"once",ol.Feature.prototype.once);goog.exportProperty(ol.Feature.prototype,"un",ol.Feature.prototype.un);goog.exportProperty(ol.Geolocation.prototype,"get",ol.Geolocation.prototype.get);goog.exportProperty(ol.Geolocation.prototype,"getKeys",ol.Geolocation.prototype.getKeys);goog.exportProperty(ol.Geolocation.prototype,"getProperties",ol.Geolocation.prototype.getProperties);goog.exportProperty(ol.Geolocation.prototype,"set",ol.Geolocation.prototype.set);goog.exportProperty(ol.Geolocation.prototype,"setProperties",ol.Geolocation.prototype.setProperties);goog.exportProperty(ol.Geolocation.prototype,"unset",ol.Geolocation.prototype.unset);goog.exportProperty(ol.Geolocation.prototype,"changed",ol.Geolocation.prototype.changed);goog.exportProperty(ol.Geolocation.prototype,"dispatchEvent",ol.Geolocation.prototype.dispatchEvent);goog.exportProperty(ol.Geolocation.prototype,"getRevision",ol.Geolocation.prototype.getRevision);goog.exportProperty(ol.Geolocation.prototype,"on",ol.Geolocation.prototype.on);goog.exportProperty(ol.Geolocation.prototype,"once",ol.Geolocation.prototype.once);goog.exportProperty(ol.Geolocation.prototype,"un",ol.Geolocation.prototype.un);goog.exportProperty(ol.ImageTile.prototype,"getTileCoord",ol.ImageTile.prototype.getTileCoord);goog.exportProperty(ol.ImageTile.prototype,"load",ol.ImageTile.prototype.load);goog.exportProperty(ol.Map.prototype,"addControl",ol.Map.prototype.addControl);goog.exportProperty(ol.Map.prototype,"addInteraction",ol.Map.prototype.addInteraction);goog.exportProperty(ol.Map.prototype,"addLayer",ol.Map.prototype.addLayer);goog.exportProperty(ol.Map.prototype,"addOverlay",ol.Map.prototype.addOverlay);goog.exportProperty(ol.Map.prototype,"forEachFeatureAtPixel",ol.Map.prototype.forEachFeatureAtPixel);goog.exportProperty(ol.Map.prototype,"getFeaturesAtPixel",ol.Map.prototype.getFeaturesAtPixel);goog.exportProperty(ol.Map.prototype,"forEachLayerAtPixel",ol.Map.prototype.forEachLayerAtPixel);goog.exportProperty(ol.Map.prototype,"hasFeatureAtPixel",ol.Map.prototype.hasFeatureAtPixel);goog.exportProperty(ol.Map.prototype,"getEventCoordinate",ol.Map.prototype.getEventCoordinate);goog.exportProperty(ol.Map.prototype,"getEventPixel",ol.Map.prototype.getEventPixel);goog.exportProperty(ol.Map.prototype,"getTarget",ol.Map.prototype.getTarget);goog.exportProperty(ol.Map.prototype,"getTargetElement",ol.Map.prototype.getTargetElement);goog.exportProperty(ol.Map.prototype,"getCoordinateFromPixel",ol.Map.prototype.getCoordinateFromPixel);goog.exportProperty(ol.Map.prototype,"getControls",ol.Map.prototype.getControls);goog.exportProperty(ol.Map.prototype,"getOverlays",ol.Map.prototype.getOverlays);goog.exportProperty(ol.Map.prototype,"getOverlayById",ol.Map.prototype.getOverlayById);goog.exportProperty(ol.Map.prototype,"getInteractions",ol.Map.prototype.getInteractions);goog.exportProperty(ol.Map.prototype,"getLayerGroup",ol.Map.prototype.getLayerGroup);goog.exportProperty(ol.Map.prototype,"getLayers",ol.Map.prototype.getLayers);goog.exportProperty(ol.Map.prototype,"getPixelFromCoordinate",ol.Map.prototype.getPixelFromCoordinate);goog.exportProperty(ol.Map.prototype,"getSize",ol.Map.prototype.getSize);goog.exportProperty(ol.Map.prototype,"getView",ol.Map.prototype.getView);goog.exportProperty(ol.Map.prototype,"getViewport",ol.Map.prototype.getViewport);goog.exportProperty(ol.Map.prototype,"renderSync",ol.Map.prototype.renderSync);goog.exportProperty(ol.Map.prototype,"render",ol.Map.prototype.render);goog.exportProperty(ol.Map.prototype,"removeControl",ol.Map.prototype.removeControl);goog.exportProperty(ol.Map.prototype,"removeInteraction",ol.Map.prototype.removeInteraction);goog.exportProperty(ol.Map.prototype,"removeLayer",ol.Map.prototype.removeLayer);goog.exportProperty(ol.Map.prototype,"removeOverlay",ol.Map.prototype.removeOverlay);goog.exportProperty(ol.Map.prototype,"setLayerGroup",ol.Map.prototype.setLayerGroup);goog.exportProperty(ol.Map.prototype,"setSize",ol.Map.prototype.setSize);goog.exportProperty(ol.Map.prototype,"setTarget",ol.Map.prototype.setTarget);goog.exportProperty(ol.Map.prototype,"setView",ol.Map.prototype.setView);goog.exportProperty(ol.Map.prototype,"updateSize",ol.Map.prototype.updateSize);goog.exportProperty(ol.Map.prototype,"get",ol.Map.prototype.get);goog.exportProperty(ol.Map.prototype,"getKeys",ol.Map.prototype.getKeys);goog.exportProperty(ol.Map.prototype,"getProperties",ol.Map.prototype.getProperties);goog.exportProperty(ol.Map.prototype,"set",ol.Map.prototype.set);goog.exportProperty(ol.Map.prototype,"setProperties",ol.Map.prototype.setProperties);goog.exportProperty(ol.Map.prototype,"unset",ol.Map.prototype.unset);goog.exportProperty(ol.Map.prototype,"changed",ol.Map.prototype.changed);goog.exportProperty(ol.Map.prototype,"dispatchEvent",ol.Map.prototype.dispatchEvent);goog.exportProperty(ol.Map.prototype,"getRevision",ol.Map.prototype.getRevision);goog.exportProperty(ol.Map.prototype,"on",ol.Map.prototype.on);goog.exportProperty(ol.Map.prototype,"once",ol.Map.prototype.once);goog.exportProperty(ol.Map.prototype,"un",ol.Map.prototype.un);goog.exportProperty(ol.MapEvent.prototype,"type",ol.MapEvent.prototype.type);goog.exportProperty(ol.MapEvent.prototype,"target",ol.MapEvent.prototype.target);goog.exportProperty(ol.MapEvent.prototype,"preventDefault",ol.MapEvent.prototype.preventDefault);goog.exportProperty(ol.MapEvent.prototype,"stopPropagation",ol.MapEvent.prototype.stopPropagation);goog.exportProperty(ol.MapBrowserEvent.prototype,"map",ol.MapBrowserEvent.prototype.map);goog.exportProperty(ol.MapBrowserEvent.prototype,"frameState",ol.MapBrowserEvent.prototype.frameState);goog.exportProperty(ol.MapBrowserEvent.prototype,"type",ol.MapBrowserEvent.prototype.type);goog.exportProperty(ol.MapBrowserEvent.prototype,"target",ol.MapBrowserEvent.prototype.target);goog.exportProperty(ol.MapBrowserEvent.prototype,"preventDefault",ol.MapBrowserEvent.prototype.preventDefault);goog.exportProperty(ol.MapBrowserEvent.prototype,"stopPropagation",ol.MapBrowserEvent.prototype.stopPropagation);goog.exportProperty(ol.MapBrowserPointerEvent.prototype,"originalEvent",ol.MapBrowserPointerEvent.prototype.originalEvent);goog.exportProperty(ol.MapBrowserPointerEvent.prototype,"pixel",ol.MapBrowserPointerEvent.prototype.pixel);goog.exportProperty(ol.MapBrowserPointerEvent.prototype,"coordinate",ol.MapBrowserPointerEvent.prototype.coordinate);goog.exportProperty(ol.MapBrowserPointerEvent.prototype,"dragging",ol.MapBrowserPointerEvent.prototype.dragging);goog.exportProperty(ol.MapBrowserPointerEvent.prototype,"preventDefault",ol.MapBrowserPointerEvent.prototype.preventDefault);goog.exportProperty(ol.MapBrowserPointerEvent.prototype,"stopPropagation",ol.MapBrowserPointerEvent.prototype.stopPropagation);goog.exportProperty(ol.MapBrowserPointerEvent.prototype,"map",ol.MapBrowserPointerEvent.prototype.map);goog.exportProperty(ol.MapBrowserPointerEvent.prototype,"frameState",ol.MapBrowserPointerEvent.prototype.frameState);goog.exportProperty(ol.MapBrowserPointerEvent.prototype,"type",ol.MapBrowserPointerEvent.prototype.type);goog.exportProperty(ol.MapBrowserPointerEvent.prototype,"target",ol.MapBrowserPointerEvent.prototype.target);goog.exportProperty(ol.Object.Event.prototype,"type",ol.Object.Event.prototype.type);goog.exportProperty(ol.Object.Event.prototype,"target",ol.Object.Event.prototype.target);goog.exportProperty(ol.Object.Event.prototype,"preventDefault",ol.Object.Event.prototype.preventDefault);goog.exportProperty(ol.Object.Event.prototype,"stopPropagation",ol.Object.Event.prototype.stopPropagation);goog.exportProperty(ol.Overlay.prototype,"get",ol.Overlay.prototype.get);goog.exportProperty(ol.Overlay.prototype,"getKeys",ol.Overlay.prototype.getKeys);goog.exportProperty(ol.Overlay.prototype,"getProperties",ol.Overlay.prototype.getProperties);goog.exportProperty(ol.Overlay.prototype,"set",ol.Overlay.prototype.set);goog.exportProperty(ol.Overlay.prototype,"setProperties",ol.Overlay.prototype.setProperties);goog.exportProperty(ol.Overlay.prototype,"unset",ol.Overlay.prototype.unset);goog.exportProperty(ol.Overlay.prototype,"changed",ol.Overlay.prototype.changed);goog.exportProperty(ol.Overlay.prototype,"dispatchEvent",ol.Overlay.prototype.dispatchEvent);goog.exportProperty(ol.Overlay.prototype,"getRevision",ol.Overlay.prototype.getRevision);goog.exportProperty(ol.Overlay.prototype,"on",ol.Overlay.prototype.on);goog.exportProperty(ol.Overlay.prototype,"once",ol.Overlay.prototype.once);goog.exportProperty(ol.Overlay.prototype,"un",ol.Overlay.prototype.un);goog.exportProperty(ol.VectorImageTile.prototype,"getTileCoord",ol.VectorImageTile.prototype.getTileCoord);goog.exportProperty(ol.VectorImageTile.prototype,"load",ol.VectorImageTile.prototype.load);goog.exportProperty(ol.VectorTile.prototype,"getTileCoord",ol.VectorTile.prototype.getTileCoord);goog.exportProperty(ol.VectorTile.prototype,"load",ol.VectorTile.prototype.load);goog.exportProperty(ol.View.prototype,"get",ol.View.prototype.get);goog.exportProperty(ol.View.prototype,"getKeys",ol.View.prototype.getKeys);goog.exportProperty(ol.View.prototype,"getProperties",ol.View.prototype.getProperties);goog.exportProperty(ol.View.prototype,"set",ol.View.prototype.set);goog.exportProperty(ol.View.prototype,"setProperties",ol.View.prototype.setProperties);goog.exportProperty(ol.View.prototype,"unset",ol.View.prototype.unset);goog.exportProperty(ol.View.prototype,"changed",ol.View.prototype.changed);goog.exportProperty(ol.View.prototype,"dispatchEvent",ol.View.prototype.dispatchEvent);goog.exportProperty(ol.View.prototype,"getRevision",ol.View.prototype.getRevision);goog.exportProperty(ol.View.prototype,"on",ol.View.prototype.on);goog.exportProperty(ol.View.prototype,"once",ol.View.prototype.once);goog.exportProperty(ol.View.prototype,"un",ol.View.prototype.un);goog.exportProperty(ol.tilegrid.WMTS.prototype,"forEachTileCoord",ol.tilegrid.WMTS.prototype.forEachTileCoord);goog.exportProperty(ol.tilegrid.WMTS.prototype,"getMaxZoom",ol.tilegrid.WMTS.prototype.getMaxZoom);goog.exportProperty(ol.tilegrid.WMTS.prototype,"getMinZoom",ol.tilegrid.WMTS.prototype.getMinZoom);goog.exportProperty(ol.tilegrid.WMTS.prototype,"getOrigin",ol.tilegrid.WMTS.prototype.getOrigin);goog.exportProperty(ol.tilegrid.WMTS.prototype,"getResolution",ol.tilegrid.WMTS.prototype.getResolution);goog.exportProperty(ol.tilegrid.WMTS.prototype,"getResolutions",ol.tilegrid.WMTS.prototype.getResolutions);goog.exportProperty(ol.tilegrid.WMTS.prototype,"getTileCoordExtent",ol.tilegrid.WMTS.prototype.getTileCoordExtent);goog.exportProperty(ol.tilegrid.WMTS.prototype,"getTileCoordForCoordAndResolution",ol.tilegrid.WMTS.prototype.getTileCoordForCoordAndResolution);goog.exportProperty(ol.tilegrid.WMTS.prototype,"getTileCoordForCoordAndZ",ol.tilegrid.WMTS.prototype.getTileCoordForCoordAndZ);goog.exportProperty(ol.tilegrid.WMTS.prototype,"getTileSize",ol.tilegrid.WMTS.prototype.getTileSize);goog.exportProperty(ol.tilegrid.WMTS.prototype,"getZForResolution",ol.tilegrid.WMTS.prototype.getZForResolution);goog.exportProperty(ol.style.RegularShape.prototype,"getOpacity",ol.style.RegularShape.prototype.getOpacity);goog.exportProperty(ol.style.RegularShape.prototype,"getRotateWithView",ol.style.RegularShape.prototype.getRotateWithView);goog.exportProperty(ol.style.RegularShape.prototype,"getRotation",ol.style.RegularShape.prototype.getRotation);goog.exportProperty(ol.style.RegularShape.prototype,"getScale",ol.style.RegularShape.prototype.getScale);goog.exportProperty(ol.style.RegularShape.prototype,"getSnapToPixel",ol.style.RegularShape.prototype.getSnapToPixel);goog.exportProperty(ol.style.RegularShape.prototype,"setOpacity",ol.style.RegularShape.prototype.setOpacity);goog.exportProperty(ol.style.RegularShape.prototype,"setRotation",ol.style.RegularShape.prototype.setRotation);goog.exportProperty(ol.style.RegularShape.prototype,"setScale",ol.style.RegularShape.prototype.setScale);goog.exportProperty(ol.style.Circle.prototype,"clone",ol.style.Circle.prototype.clone);goog.exportProperty(ol.style.Circle.prototype,"getAngle",ol.style.Circle.prototype.getAngle);goog.exportProperty(ol.style.Circle.prototype,"getFill",ol.style.Circle.prototype.getFill);goog.exportProperty(ol.style.Circle.prototype,"getPoints",ol.style.Circle.prototype.getPoints);goog.exportProperty(ol.style.Circle.prototype,"getRadius",ol.style.Circle.prototype.getRadius);goog.exportProperty(ol.style.Circle.prototype,"getRadius2",ol.style.Circle.prototype.getRadius2);goog.exportProperty(ol.style.Circle.prototype,"getStroke",ol.style.Circle.prototype.getStroke);goog.exportProperty(ol.style.Circle.prototype,"getOpacity",ol.style.Circle.prototype.getOpacity);goog.exportProperty(ol.style.Circle.prototype,"getRotateWithView",ol.style.Circle.prototype.getRotateWithView);goog.exportProperty(ol.style.Circle.prototype,"getRotation",ol.style.Circle.prototype.getRotation);goog.exportProperty(ol.style.Circle.prototype,"getScale",ol.style.Circle.prototype.getScale);goog.exportProperty(ol.style.Circle.prototype,"getSnapToPixel",ol.style.Circle.prototype.getSnapToPixel);goog.exportProperty(ol.style.Circle.prototype,"setOpacity",ol.style.Circle.prototype.setOpacity);goog.exportProperty(ol.style.Circle.prototype,"setRotation",ol.style.Circle.prototype.setRotation);goog.exportProperty(ol.style.Circle.prototype,"setScale",ol.style.Circle.prototype.setScale);goog.exportProperty(ol.style.Icon.prototype,"getOpacity",ol.style.Icon.prototype.getOpacity);goog.exportProperty(ol.style.Icon.prototype,"getRotateWithView",ol.style.Icon.prototype.getRotateWithView);goog.exportProperty(ol.style.Icon.prototype,"getRotation",ol.style.Icon.prototype.getRotation);goog.exportProperty(ol.style.Icon.prototype,"getScale",ol.style.Icon.prototype.getScale);goog.exportProperty(ol.style.Icon.prototype,"getSnapToPixel",ol.style.Icon.prototype.getSnapToPixel);goog.exportProperty(ol.style.Icon.prototype,"setOpacity",ol.style.Icon.prototype.setOpacity);goog.exportProperty(ol.style.Icon.prototype,"setRotation",ol.style.Icon.prototype.setRotation);goog.exportProperty(ol.style.Icon.prototype,"setScale",ol.style.Icon.prototype.setScale);goog.exportProperty(ol.source.Source.prototype,"get",ol.source.Source.prototype.get);goog.exportProperty(ol.source.Source.prototype,"getKeys",ol.source.Source.prototype.getKeys);goog.exportProperty(ol.source.Source.prototype,"getProperties",ol.source.Source.prototype.getProperties);goog.exportProperty(ol.source.Source.prototype,"set",ol.source.Source.prototype.set);goog.exportProperty(ol.source.Source.prototype,"setProperties",ol.source.Source.prototype.setProperties);goog.exportProperty(ol.source.Source.prototype,"unset",ol.source.Source.prototype.unset);goog.exportProperty(ol.source.Source.prototype,"changed",ol.source.Source.prototype.changed);goog.exportProperty(ol.source.Source.prototype,"dispatchEvent",ol.source.Source.prototype.dispatchEvent);goog.exportProperty(ol.source.Source.prototype,"getRevision",ol.source.Source.prototype.getRevision);goog.exportProperty(ol.source.Source.prototype,"on",ol.source.Source.prototype.on);goog.exportProperty(ol.source.Source.prototype,"once",ol.source.Source.prototype.once);goog.exportProperty(ol.source.Source.prototype,"un",ol.source.Source.prototype.un);goog.exportProperty(ol.source.Tile.prototype,"getAttributions",ol.source.Tile.prototype.getAttributions);goog.exportProperty(ol.source.Tile.prototype,"getLogo",ol.source.Tile.prototype.getLogo);goog.exportProperty(ol.source.Tile.prototype,"getProjection",ol.source.Tile.prototype.getProjection);goog.exportProperty(ol.source.Tile.prototype,"getState",ol.source.Tile.prototype.getState);goog.exportProperty(ol.source.Tile.prototype,"refresh",ol.source.Tile.prototype.refresh);goog.exportProperty(ol.source.Tile.prototype,"setAttributions",ol.source.Tile.prototype.setAttributions);goog.exportProperty(ol.source.Tile.prototype,"get",ol.source.Tile.prototype.get);goog.exportProperty(ol.source.Tile.prototype,"getKeys",ol.source.Tile.prototype.getKeys);goog.exportProperty(ol.source.Tile.prototype,"getProperties",ol.source.Tile.prototype.getProperties);goog.exportProperty(ol.source.Tile.prototype,"set",ol.source.Tile.prototype.set);goog.exportProperty(ol.source.Tile.prototype,"setProperties",ol.source.Tile.prototype.setProperties);goog.exportProperty(ol.source.Tile.prototype,"unset",ol.source.Tile.prototype.unset);goog.exportProperty(ol.source.Tile.prototype,"changed",ol.source.Tile.prototype.changed);goog.exportProperty(ol.source.Tile.prototype,"dispatchEvent",ol.source.Tile.prototype.dispatchEvent);goog.exportProperty(ol.source.Tile.prototype,"getRevision",ol.source.Tile.prototype.getRevision);goog.exportProperty(ol.source.Tile.prototype,"on",ol.source.Tile.prototype.on);goog.exportProperty(ol.source.Tile.prototype,"once",ol.source.Tile.prototype.once);goog.exportProperty(ol.source.Tile.prototype,"un",ol.source.Tile.prototype.un);goog.exportProperty(ol.source.UrlTile.prototype,"getTileGrid",ol.source.UrlTile.prototype.getTileGrid);goog.exportProperty(ol.source.UrlTile.prototype,"refresh",ol.source.UrlTile.prototype.refresh);goog.exportProperty(ol.source.UrlTile.prototype,"getAttributions",ol.source.UrlTile.prototype.getAttributions);goog.exportProperty(ol.source.UrlTile.prototype,"getLogo",ol.source.UrlTile.prototype.getLogo);goog.exportProperty(ol.source.UrlTile.prototype,"getProjection",ol.source.UrlTile.prototype.getProjection);goog.exportProperty(ol.source.UrlTile.prototype,"getState",ol.source.UrlTile.prototype.getState);goog.exportProperty(ol.source.UrlTile.prototype,"setAttributions",ol.source.UrlTile.prototype.setAttributions);goog.exportProperty(ol.source.UrlTile.prototype,"get",ol.source.UrlTile.prototype.get);goog.exportProperty(ol.source.UrlTile.prototype,"getKeys",ol.source.UrlTile.prototype.getKeys);goog.exportProperty(ol.source.UrlTile.prototype,"getProperties",ol.source.UrlTile.prototype.getProperties);goog.exportProperty(ol.source.UrlTile.prototype,"set",ol.source.UrlTile.prototype.set);goog.exportProperty(ol.source.UrlTile.prototype,"setProperties",ol.source.UrlTile.prototype.setProperties);goog.exportProperty(ol.source.UrlTile.prototype,"unset",ol.source.UrlTile.prototype.unset);goog.exportProperty(ol.source.UrlTile.prototype,"changed",ol.source.UrlTile.prototype.changed);goog.exportProperty(ol.source.UrlTile.prototype,"dispatchEvent",ol.source.UrlTile.prototype.dispatchEvent);goog.exportProperty(ol.source.UrlTile.prototype,"getRevision",ol.source.UrlTile.prototype.getRevision);goog.exportProperty(ol.source.UrlTile.prototype,"on",ol.source.UrlTile.prototype.on);goog.exportProperty(ol.source.UrlTile.prototype,"once",ol.source.UrlTile.prototype.once);goog.exportProperty(ol.source.UrlTile.prototype,"un",ol.source.UrlTile.prototype.un);goog.exportProperty(ol.source.TileImage.prototype,"getTileLoadFunction",ol.source.TileImage.prototype.getTileLoadFunction);goog.exportProperty(ol.source.TileImage.prototype,"getTileUrlFunction",ol.source.TileImage.prototype.getTileUrlFunction);goog.exportProperty(ol.source.TileImage.prototype,"getUrls",ol.source.TileImage.prototype.getUrls);goog.exportProperty(ol.source.TileImage.prototype,"setTileLoadFunction",ol.source.TileImage.prototype.setTileLoadFunction);goog.exportProperty(ol.source.TileImage.prototype,"setTileUrlFunction",ol.source.TileImage.prototype.setTileUrlFunction);goog.exportProperty(ol.source.TileImage.prototype,"setUrl",ol.source.TileImage.prototype.setUrl);goog.exportProperty(ol.source.TileImage.prototype,"setUrls",ol.source.TileImage.prototype.setUrls);goog.exportProperty(ol.source.TileImage.prototype,"getTileGrid",ol.source.TileImage.prototype.getTileGrid);goog.exportProperty(ol.source.TileImage.prototype,"refresh",ol.source.TileImage.prototype.refresh);goog.exportProperty(ol.source.TileImage.prototype,"getAttributions",ol.source.TileImage.prototype.getAttributions);goog.exportProperty(ol.source.TileImage.prototype,"getLogo",ol.source.TileImage.prototype.getLogo);goog.exportProperty(ol.source.TileImage.prototype,"getProjection",ol.source.TileImage.prototype.getProjection);goog.exportProperty(ol.source.TileImage.prototype,"getState",ol.source.TileImage.prototype.getState);goog.exportProperty(ol.source.TileImage.prototype,"setAttributions",ol.source.TileImage.prototype.setAttributions);goog.exportProperty(ol.source.TileImage.prototype,"get",ol.source.TileImage.prototype.get);goog.exportProperty(ol.source.TileImage.prototype,"getKeys",ol.source.TileImage.prototype.getKeys);goog.exportProperty(ol.source.TileImage.prototype,"getProperties",ol.source.TileImage.prototype.getProperties);goog.exportProperty(ol.source.TileImage.prototype,"set",ol.source.TileImage.prototype.set);goog.exportProperty(ol.source.TileImage.prototype,"setProperties",ol.source.TileImage.prototype.setProperties);goog.exportProperty(ol.source.TileImage.prototype,"unset",ol.source.TileImage.prototype.unset);goog.exportProperty(ol.source.TileImage.prototype,"changed",ol.source.TileImage.prototype.changed);goog.exportProperty(ol.source.TileImage.prototype,"dispatchEvent",ol.source.TileImage.prototype.dispatchEvent);goog.exportProperty(ol.source.TileImage.prototype,"getRevision",ol.source.TileImage.prototype.getRevision);goog.exportProperty(ol.source.TileImage.prototype,"on",ol.source.TileImage.prototype.on);goog.exportProperty(ol.source.TileImage.prototype,"once",ol.source.TileImage.prototype.once);goog.exportProperty(ol.source.TileImage.prototype,"un",ol.source.TileImage.prototype.un);goog.exportProperty(ol.source.BingMaps.prototype,"setRenderReprojectionEdges",ol.source.BingMaps.prototype.setRenderReprojectionEdges);goog.exportProperty(ol.source.BingMaps.prototype,"setTileGridForProjection",ol.source.BingMaps.prototype.setTileGridForProjection);goog.exportProperty(ol.source.BingMaps.prototype,"getTileLoadFunction",ol.source.BingMaps.prototype.getTileLoadFunction);goog.exportProperty(ol.source.BingMaps.prototype,"getTileUrlFunction",ol.source.BingMaps.prototype.getTileUrlFunction);goog.exportProperty(ol.source.BingMaps.prototype,"getUrls",ol.source.BingMaps.prototype.getUrls);goog.exportProperty(ol.source.BingMaps.prototype,"setTileLoadFunction",ol.source.BingMaps.prototype.setTileLoadFunction);goog.exportProperty(ol.source.BingMaps.prototype,"setTileUrlFunction",ol.source.BingMaps.prototype.setTileUrlFunction);goog.exportProperty(ol.source.BingMaps.prototype,"setUrl",ol.source.BingMaps.prototype.setUrl);goog.exportProperty(ol.source.BingMaps.prototype,"setUrls",ol.source.BingMaps.prototype.setUrls);goog.exportProperty(ol.source.BingMaps.prototype,"getTileGrid",ol.source.BingMaps.prototype.getTileGrid);goog.exportProperty(ol.source.BingMaps.prototype,"refresh",ol.source.BingMaps.prototype.refresh);goog.exportProperty(ol.source.BingMaps.prototype,"getAttributions",ol.source.BingMaps.prototype.getAttributions);goog.exportProperty(ol.source.BingMaps.prototype,"getLogo",ol.source.BingMaps.prototype.getLogo);goog.exportProperty(ol.source.BingMaps.prototype,"getProjection",ol.source.BingMaps.prototype.getProjection);goog.exportProperty(ol.source.BingMaps.prototype,"getState",ol.source.BingMaps.prototype.getState);goog.exportProperty(ol.source.BingMaps.prototype,"setAttributions",ol.source.BingMaps.prototype.setAttributions);goog.exportProperty(ol.source.BingMaps.prototype,"get",ol.source.BingMaps.prototype.get);goog.exportProperty(ol.source.BingMaps.prototype,"getKeys",ol.source.BingMaps.prototype.getKeys);goog.exportProperty(ol.source.BingMaps.prototype,"getProperties",ol.source.BingMaps.prototype.getProperties);goog.exportProperty(ol.source.BingMaps.prototype,"set",ol.source.BingMaps.prototype.set);goog.exportProperty(ol.source.BingMaps.prototype,"setProperties",ol.source.BingMaps.prototype.setProperties);goog.exportProperty(ol.source.BingMaps.prototype,"unset",ol.source.BingMaps.prototype.unset);goog.exportProperty(ol.source.BingMaps.prototype,"changed",ol.source.BingMaps.prototype.changed);goog.exportProperty(ol.source.BingMaps.prototype,"dispatchEvent",ol.source.BingMaps.prototype.dispatchEvent);goog.exportProperty(ol.source.BingMaps.prototype,"getRevision",ol.source.BingMaps.prototype.getRevision);goog.exportProperty(ol.source.BingMaps.prototype,"on",ol.source.BingMaps.prototype.on);goog.exportProperty(ol.source.BingMaps.prototype,"once",ol.source.BingMaps.prototype.once);goog.exportProperty(ol.source.BingMaps.prototype,"un",ol.source.BingMaps.prototype.un);goog.exportProperty(ol.source.XYZ.prototype,"setRenderReprojectionEdges",ol.source.XYZ.prototype.setRenderReprojectionEdges);goog.exportProperty(ol.source.XYZ.prototype,"setTileGridForProjection",ol.source.XYZ.prototype.setTileGridForProjection);goog.exportProperty(ol.source.XYZ.prototype,"getTileLoadFunction",ol.source.XYZ.prototype.getTileLoadFunction);goog.exportProperty(ol.source.XYZ.prototype,"getTileUrlFunction",ol.source.XYZ.prototype.getTileUrlFunction);goog.exportProperty(ol.source.XYZ.prototype,"getUrls",ol.source.XYZ.prototype.getUrls);goog.exportProperty(ol.source.XYZ.prototype,"setTileLoadFunction",ol.source.XYZ.prototype.setTileLoadFunction);goog.exportProperty(ol.source.XYZ.prototype,"setTileUrlFunction",ol.source.XYZ.prototype.setTileUrlFunction);goog.exportProperty(ol.source.XYZ.prototype,"setUrl",ol.source.XYZ.prototype.setUrl);goog.exportProperty(ol.source.XYZ.prototype,"setUrls",ol.source.XYZ.prototype.setUrls);goog.exportProperty(ol.source.XYZ.prototype,"getTileGrid",ol.source.XYZ.prototype.getTileGrid);goog.exportProperty(ol.source.XYZ.prototype,"refresh",ol.source.XYZ.prototype.refresh);goog.exportProperty(ol.source.XYZ.prototype,"getAttributions",ol.source.XYZ.prototype.getAttributions);goog.exportProperty(ol.source.XYZ.prototype,"getLogo",ol.source.XYZ.prototype.getLogo);goog.exportProperty(ol.source.XYZ.prototype,"getProjection",ol.source.XYZ.prototype.getProjection);goog.exportProperty(ol.source.XYZ.prototype,"getState",ol.source.XYZ.prototype.getState);goog.exportProperty(ol.source.XYZ.prototype,"setAttributions",ol.source.XYZ.prototype.setAttributions);goog.exportProperty(ol.source.XYZ.prototype,"get",ol.source.XYZ.prototype.get);goog.exportProperty(ol.source.XYZ.prototype,"getKeys",ol.source.XYZ.prototype.getKeys);goog.exportProperty(ol.source.XYZ.prototype,"getProperties",ol.source.XYZ.prototype.getProperties);goog.exportProperty(ol.source.XYZ.prototype,"set",ol.source.XYZ.prototype.set);goog.exportProperty(ol.source.XYZ.prototype,"setProperties",ol.source.XYZ.prototype.setProperties);goog.exportProperty(ol.source.XYZ.prototype,"unset",ol.source.XYZ.prototype.unset);goog.exportProperty(ol.source.XYZ.prototype,"changed",ol.source.XYZ.prototype.changed);goog.exportProperty(ol.source.XYZ.prototype,"dispatchEvent",ol.source.XYZ.prototype.dispatchEvent);goog.exportProperty(ol.source.XYZ.prototype,"getRevision",ol.source.XYZ.prototype.getRevision);goog.exportProperty(ol.source.XYZ.prototype,"on",ol.source.XYZ.prototype.on);goog.exportProperty(ol.source.XYZ.prototype,"once",ol.source.XYZ.prototype.once);goog.exportProperty(ol.source.XYZ.prototype,"un",ol.source.XYZ.prototype.un);goog.exportProperty(ol.source.CartoDB.prototype,"setRenderReprojectionEdges",ol.source.CartoDB.prototype.setRenderReprojectionEdges);goog.exportProperty(ol.source.CartoDB.prototype,"setTileGridForProjection",ol.source.CartoDB.prototype.setTileGridForProjection);goog.exportProperty(ol.source.CartoDB.prototype,"getTileLoadFunction",ol.source.CartoDB.prototype.getTileLoadFunction);goog.exportProperty(ol.source.CartoDB.prototype,"getTileUrlFunction",ol.source.CartoDB.prototype.getTileUrlFunction);goog.exportProperty(ol.source.CartoDB.prototype,"getUrls",ol.source.CartoDB.prototype.getUrls);goog.exportProperty(ol.source.CartoDB.prototype,"setTileLoadFunction",ol.source.CartoDB.prototype.setTileLoadFunction);goog.exportProperty(ol.source.CartoDB.prototype,"setTileUrlFunction",ol.source.CartoDB.prototype.setTileUrlFunction);goog.exportProperty(ol.source.CartoDB.prototype,"setUrl",ol.source.CartoDB.prototype.setUrl);goog.exportProperty(ol.source.CartoDB.prototype,"setUrls",ol.source.CartoDB.prototype.setUrls);goog.exportProperty(ol.source.CartoDB.prototype,"getTileGrid",ol.source.CartoDB.prototype.getTileGrid);goog.exportProperty(ol.source.CartoDB.prototype,"refresh",ol.source.CartoDB.prototype.refresh);goog.exportProperty(ol.source.CartoDB.prototype,"getAttributions",ol.source.CartoDB.prototype.getAttributions);goog.exportProperty(ol.source.CartoDB.prototype,"getLogo",ol.source.CartoDB.prototype.getLogo);goog.exportProperty(ol.source.CartoDB.prototype,"getProjection",ol.source.CartoDB.prototype.getProjection);goog.exportProperty(ol.source.CartoDB.prototype,"getState",ol.source.CartoDB.prototype.getState);goog.exportProperty(ol.source.CartoDB.prototype,"setAttributions",ol.source.CartoDB.prototype.setAttributions);goog.exportProperty(ol.source.CartoDB.prototype,"get",ol.source.CartoDB.prototype.get);goog.exportProperty(ol.source.CartoDB.prototype,"getKeys",ol.source.CartoDB.prototype.getKeys);goog.exportProperty(ol.source.CartoDB.prototype,"getProperties",ol.source.CartoDB.prototype.getProperties);goog.exportProperty(ol.source.CartoDB.prototype,"set",ol.source.CartoDB.prototype.set);goog.exportProperty(ol.source.CartoDB.prototype,"setProperties",ol.source.CartoDB.prototype.setProperties);goog.exportProperty(ol.source.CartoDB.prototype,"unset",ol.source.CartoDB.prototype.unset);goog.exportProperty(ol.source.CartoDB.prototype,"changed",ol.source.CartoDB.prototype.changed);goog.exportProperty(ol.source.CartoDB.prototype,"dispatchEvent",ol.source.CartoDB.prototype.dispatchEvent);goog.exportProperty(ol.source.CartoDB.prototype,"getRevision",ol.source.CartoDB.prototype.getRevision);goog.exportProperty(ol.source.CartoDB.prototype,"on",ol.source.CartoDB.prototype.on);goog.exportProperty(ol.source.CartoDB.prototype,"once",ol.source.CartoDB.prototype.once);goog.exportProperty(ol.source.CartoDB.prototype,"un",ol.source.CartoDB.prototype.un);goog.exportProperty(ol.source.Vector.prototype,"getAttributions",ol.source.Vector.prototype.getAttributions);goog.exportProperty(ol.source.Vector.prototype,"getLogo",ol.source.Vector.prototype.getLogo);goog.exportProperty(ol.source.Vector.prototype,"getProjection",ol.source.Vector.prototype.getProjection);goog.exportProperty(ol.source.Vector.prototype,"getState",ol.source.Vector.prototype.getState);goog.exportProperty(ol.source.Vector.prototype,"refresh",ol.source.Vector.prototype.refresh);goog.exportProperty(ol.source.Vector.prototype,"setAttributions",ol.source.Vector.prototype.setAttributions);goog.exportProperty(ol.source.Vector.prototype,"get",ol.source.Vector.prototype.get);goog.exportProperty(ol.source.Vector.prototype,"getKeys",ol.source.Vector.prototype.getKeys);goog.exportProperty(ol.source.Vector.prototype,"getProperties",ol.source.Vector.prototype.getProperties);goog.exportProperty(ol.source.Vector.prototype,"set",ol.source.Vector.prototype.set);goog.exportProperty(ol.source.Vector.prototype,"setProperties",ol.source.Vector.prototype.setProperties);goog.exportProperty(ol.source.Vector.prototype,"unset",ol.source.Vector.prototype.unset);goog.exportProperty(ol.source.Vector.prototype,"changed",ol.source.Vector.prototype.changed);goog.exportProperty(ol.source.Vector.prototype,"dispatchEvent",ol.source.Vector.prototype.dispatchEvent);goog.exportProperty(ol.source.Vector.prototype,"getRevision",ol.source.Vector.prototype.getRevision);goog.exportProperty(ol.source.Vector.prototype,"on",ol.source.Vector.prototype.on);goog.exportProperty(ol.source.Vector.prototype,"once",ol.source.Vector.prototype.once);goog.exportProperty(ol.source.Vector.prototype,"un",ol.source.Vector.prototype.un);goog.exportProperty(ol.source.Cluster.prototype,"addFeature",ol.source.Cluster.prototype.addFeature);goog.exportProperty(ol.source.Cluster.prototype,"addFeatures",ol.source.Cluster.prototype.addFeatures);goog.exportProperty(ol.source.Cluster.prototype,"clear",ol.source.Cluster.prototype.clear);goog.exportProperty(ol.source.Cluster.prototype,"forEachFeature",ol.source.Cluster.prototype.forEachFeature);goog.exportProperty(ol.source.Cluster.prototype,"forEachFeatureInExtent",ol.source.Cluster.prototype.forEachFeatureInExtent);goog.exportProperty(ol.source.Cluster.prototype,"forEachFeatureIntersectingExtent",ol.source.Cluster.prototype.forEachFeatureIntersectingExtent);goog.exportProperty(ol.source.Cluster.prototype,"getFeaturesCollection",ol.source.Cluster.prototype.getFeaturesCollection);goog.exportProperty(ol.source.Cluster.prototype,"getFeatures",ol.source.Cluster.prototype.getFeatures);goog.exportProperty(ol.source.Cluster.prototype,"getFeaturesAtCoordinate",ol.source.Cluster.prototype.getFeaturesAtCoordinate);goog.exportProperty(ol.source.Cluster.prototype,"getFeaturesInExtent",ol.source.Cluster.prototype.getFeaturesInExtent);goog.exportProperty(ol.source.Cluster.prototype,"getClosestFeatureToCoordinate",ol.source.Cluster.prototype.getClosestFeatureToCoordinate);goog.exportProperty(ol.source.Cluster.prototype,"getExtent",ol.source.Cluster.prototype.getExtent);goog.exportProperty(ol.source.Cluster.prototype,"getFeatureById",ol.source.Cluster.prototype.getFeatureById);goog.exportProperty(ol.source.Cluster.prototype,"getFormat",ol.source.Cluster.prototype.getFormat);goog.exportProperty(ol.source.Cluster.prototype,"getUrl",ol.source.Cluster.prototype.getUrl);goog.exportProperty(ol.source.Cluster.prototype,"removeLoadedExtent",ol.source.Cluster.prototype.removeLoadedExtent);goog.exportProperty(ol.source.Cluster.prototype,"removeFeature",ol.source.Cluster.prototype.removeFeature);goog.exportProperty(ol.source.Cluster.prototype,"setLoader",ol.source.Cluster.prototype.setLoader);goog.exportProperty(ol.source.Cluster.prototype,"getAttributions",ol.source.Cluster.prototype.getAttributions);goog.exportProperty(ol.source.Cluster.prototype,"getLogo",ol.source.Cluster.prototype.getLogo);goog.exportProperty(ol.source.Cluster.prototype,"getProjection",ol.source.Cluster.prototype.getProjection);goog.exportProperty(ol.source.Cluster.prototype,"getState",ol.source.Cluster.prototype.getState);goog.exportProperty(ol.source.Cluster.prototype,"refresh",ol.source.Cluster.prototype.refresh);goog.exportProperty(ol.source.Cluster.prototype,"setAttributions",ol.source.Cluster.prototype.setAttributions);goog.exportProperty(ol.source.Cluster.prototype,"get",ol.source.Cluster.prototype.get);goog.exportProperty(ol.source.Cluster.prototype,"getKeys",ol.source.Cluster.prototype.getKeys);goog.exportProperty(ol.source.Cluster.prototype,"getProperties",ol.source.Cluster.prototype.getProperties);goog.exportProperty(ol.source.Cluster.prototype,"set",ol.source.Cluster.prototype.set);goog.exportProperty(ol.source.Cluster.prototype,"setProperties",ol.source.Cluster.prototype.setProperties);goog.exportProperty(ol.source.Cluster.prototype,"unset",ol.source.Cluster.prototype.unset);goog.exportProperty(ol.source.Cluster.prototype,"changed",ol.source.Cluster.prototype.changed);goog.exportProperty(ol.source.Cluster.prototype,"dispatchEvent",ol.source.Cluster.prototype.dispatchEvent);goog.exportProperty(ol.source.Cluster.prototype,"getRevision",ol.source.Cluster.prototype.getRevision);goog.exportProperty(ol.source.Cluster.prototype,"on",ol.source.Cluster.prototype.on);goog.exportProperty(ol.source.Cluster.prototype,"once",ol.source.Cluster.prototype.once);goog.exportProperty(ol.source.Cluster.prototype,"un",ol.source.Cluster.prototype.un);goog.exportProperty(ol.source.Image.prototype,"getAttributions",ol.source.Image.prototype.getAttributions);goog.exportProperty(ol.source.Image.prototype,"getLogo",ol.source.Image.prototype.getLogo);goog.exportProperty(ol.source.Image.prototype,"getProjection",ol.source.Image.prototype.getProjection);goog.exportProperty(ol.source.Image.prototype,"getState",ol.source.Image.prototype.getState);goog.exportProperty(ol.source.Image.prototype,"refresh",ol.source.Image.prototype.refresh);goog.exportProperty(ol.source.Image.prototype,"setAttributions",ol.source.Image.prototype.setAttributions);goog.exportProperty(ol.source.Image.prototype,"get",ol.source.Image.prototype.get);goog.exportProperty(ol.source.Image.prototype,"getKeys",ol.source.Image.prototype.getKeys);goog.exportProperty(ol.source.Image.prototype,"getProperties",ol.source.Image.prototype.getProperties);goog.exportProperty(ol.source.Image.prototype,"set",ol.source.Image.prototype.set);goog.exportProperty(ol.source.Image.prototype,"setProperties",ol.source.Image.prototype.setProperties);goog.exportProperty(ol.source.Image.prototype,"unset",ol.source.Image.prototype.unset);goog.exportProperty(ol.source.Image.prototype,"changed",ol.source.Image.prototype.changed);goog.exportProperty(ol.source.Image.prototype,"dispatchEvent",ol.source.Image.prototype.dispatchEvent);goog.exportProperty(ol.source.Image.prototype,"getRevision",ol.source.Image.prototype.getRevision);goog.exportProperty(ol.source.Image.prototype,"on",ol.source.Image.prototype.on);goog.exportProperty(ol.source.Image.prototype,"once",ol.source.Image.prototype.once);goog.exportProperty(ol.source.Image.prototype,"un",ol.source.Image.prototype.un);goog.exportProperty(ol.source.Image.Event.prototype,"type",ol.source.Image.Event.prototype.type);goog.exportProperty(ol.source.Image.Event.prototype,"target",ol.source.Image.Event.prototype.target);goog.exportProperty(ol.source.Image.Event.prototype,"preventDefault",ol.source.Image.Event.prototype.preventDefault);goog.exportProperty(ol.source.Image.Event.prototype,"stopPropagation",ol.source.Image.Event.prototype.stopPropagation);goog.exportProperty(ol.source.ImageArcGISRest.prototype,"getAttributions",ol.source.ImageArcGISRest.prototype.getAttributions);goog.exportProperty(ol.source.ImageArcGISRest.prototype,"getLogo",ol.source.ImageArcGISRest.prototype.getLogo);goog.exportProperty(ol.source.ImageArcGISRest.prototype,"getProjection",ol.source.ImageArcGISRest.prototype.getProjection);goog.exportProperty(ol.source.ImageArcGISRest.prototype,"getState",ol.source.ImageArcGISRest.prototype.getState);goog.exportProperty(ol.source.ImageArcGISRest.prototype,"refresh",ol.source.ImageArcGISRest.prototype.refresh);goog.exportProperty(ol.source.ImageArcGISRest.prototype,"setAttributions",ol.source.ImageArcGISRest.prototype.setAttributions);goog.exportProperty(ol.source.ImageArcGISRest.prototype,"get",ol.source.ImageArcGISRest.prototype.get);goog.exportProperty(ol.source.ImageArcGISRest.prototype,"getKeys",ol.source.ImageArcGISRest.prototype.getKeys);goog.exportProperty(ol.source.ImageArcGISRest.prototype,"getProperties",ol.source.ImageArcGISRest.prototype.getProperties);goog.exportProperty(ol.source.ImageArcGISRest.prototype,"set",ol.source.ImageArcGISRest.prototype.set);goog.exportProperty(ol.source.ImageArcGISRest.prototype,"setProperties",ol.source.ImageArcGISRest.prototype.setProperties);goog.exportProperty(ol.source.ImageArcGISRest.prototype,"unset",ol.source.ImageArcGISRest.prototype.unset);goog.exportProperty(ol.source.ImageArcGISRest.prototype,"changed",ol.source.ImageArcGISRest.prototype.changed);goog.exportProperty(ol.source.ImageArcGISRest.prototype,"dispatchEvent",ol.source.ImageArcGISRest.prototype.dispatchEvent);goog.exportProperty(ol.source.ImageArcGISRest.prototype,"getRevision",ol.source.ImageArcGISRest.prototype.getRevision);goog.exportProperty(ol.source.ImageArcGISRest.prototype,"on",ol.source.ImageArcGISRest.prototype.on);goog.exportProperty(ol.source.ImageArcGISRest.prototype,"once",ol.source.ImageArcGISRest.prototype.once);goog.exportProperty(ol.source.ImageArcGISRest.prototype,"un",ol.source.ImageArcGISRest.prototype.un);goog.exportProperty(ol.source.ImageCanvas.prototype,"getAttributions",ol.source.ImageCanvas.prototype.getAttributions);goog.exportProperty(ol.source.ImageCanvas.prototype,"getLogo",ol.source.ImageCanvas.prototype.getLogo);goog.exportProperty(ol.source.ImageCanvas.prototype,"getProjection",ol.source.ImageCanvas.prototype.getProjection);goog.exportProperty(ol.source.ImageCanvas.prototype,"getState",ol.source.ImageCanvas.prototype.getState);goog.exportProperty(ol.source.ImageCanvas.prototype,"refresh",ol.source.ImageCanvas.prototype.refresh);goog.exportProperty(ol.source.ImageCanvas.prototype,"setAttributions",ol.source.ImageCanvas.prototype.setAttributions);goog.exportProperty(ol.source.ImageCanvas.prototype,"get",ol.source.ImageCanvas.prototype.get);goog.exportProperty(ol.source.ImageCanvas.prototype,"getKeys",ol.source.ImageCanvas.prototype.getKeys);goog.exportProperty(ol.source.ImageCanvas.prototype,"getProperties",ol.source.ImageCanvas.prototype.getProperties);goog.exportProperty(ol.source.ImageCanvas.prototype,"set",ol.source.ImageCanvas.prototype.set);goog.exportProperty(ol.source.ImageCanvas.prototype,"setProperties",ol.source.ImageCanvas.prototype.setProperties);goog.exportProperty(ol.source.ImageCanvas.prototype,"unset",ol.source.ImageCanvas.prototype.unset);goog.exportProperty(ol.source.ImageCanvas.prototype,"changed",ol.source.ImageCanvas.prototype.changed);goog.exportProperty(ol.source.ImageCanvas.prototype,"dispatchEvent",ol.source.ImageCanvas.prototype.dispatchEvent);goog.exportProperty(ol.source.ImageCanvas.prototype,"getRevision",ol.source.ImageCanvas.prototype.getRevision);goog.exportProperty(ol.source.ImageCanvas.prototype,"on",ol.source.ImageCanvas.prototype.on);goog.exportProperty(ol.source.ImageCanvas.prototype,"once",ol.source.ImageCanvas.prototype.once);goog.exportProperty(ol.source.ImageCanvas.prototype,"un",ol.source.ImageCanvas.prototype.un);goog.exportProperty(ol.source.ImageMapGuide.prototype,"getAttributions",ol.source.ImageMapGuide.prototype.getAttributions);goog.exportProperty(ol.source.ImageMapGuide.prototype,"getLogo",ol.source.ImageMapGuide.prototype.getLogo);goog.exportProperty(ol.source.ImageMapGuide.prototype,"getProjection",ol.source.ImageMapGuide.prototype.getProjection);goog.exportProperty(ol.source.ImageMapGuide.prototype,"getState",ol.source.ImageMapGuide.prototype.getState);goog.exportProperty(ol.source.ImageMapGuide.prototype,"refresh",ol.source.ImageMapGuide.prototype.refresh);goog.exportProperty(ol.source.ImageMapGuide.prototype,"setAttributions",ol.source.ImageMapGuide.prototype.setAttributions);goog.exportProperty(ol.source.ImageMapGuide.prototype,"get",ol.source.ImageMapGuide.prototype.get);goog.exportProperty(ol.source.ImageMapGuide.prototype,"getKeys",ol.source.ImageMapGuide.prototype.getKeys);goog.exportProperty(ol.source.ImageMapGuide.prototype,"getProperties",ol.source.ImageMapGuide.prototype.getProperties);goog.exportProperty(ol.source.ImageMapGuide.prototype,"set",ol.source.ImageMapGuide.prototype.set);goog.exportProperty(ol.source.ImageMapGuide.prototype,"setProperties",ol.source.ImageMapGuide.prototype.setProperties);goog.exportProperty(ol.source.ImageMapGuide.prototype,"unset",ol.source.ImageMapGuide.prototype.unset);goog.exportProperty(ol.source.ImageMapGuide.prototype,"changed",ol.source.ImageMapGuide.prototype.changed);goog.exportProperty(ol.source.ImageMapGuide.prototype,"dispatchEvent",ol.source.ImageMapGuide.prototype.dispatchEvent);goog.exportProperty(ol.source.ImageMapGuide.prototype,"getRevision",ol.source.ImageMapGuide.prototype.getRevision);goog.exportProperty(ol.source.ImageMapGuide.prototype,"on",ol.source.ImageMapGuide.prototype.on);goog.exportProperty(ol.source.ImageMapGuide.prototype,"once",ol.source.ImageMapGuide.prototype.once);goog.exportProperty(ol.source.ImageMapGuide.prototype,"un",ol.source.ImageMapGuide.prototype.un);goog.exportProperty(ol.source.ImageStatic.prototype,"getAttributions",ol.source.ImageStatic.prototype.getAttributions);goog.exportProperty(ol.source.ImageStatic.prototype,"getLogo",ol.source.ImageStatic.prototype.getLogo);goog.exportProperty(ol.source.ImageStatic.prototype,"getProjection",ol.source.ImageStatic.prototype.getProjection);goog.exportProperty(ol.source.ImageStatic.prototype,"getState",ol.source.ImageStatic.prototype.getState);goog.exportProperty(ol.source.ImageStatic.prototype,"refresh",ol.source.ImageStatic.prototype.refresh);goog.exportProperty(ol.source.ImageStatic.prototype,"setAttributions",ol.source.ImageStatic.prototype.setAttributions);goog.exportProperty(ol.source.ImageStatic.prototype,"get",ol.source.ImageStatic.prototype.get);goog.exportProperty(ol.source.ImageStatic.prototype,"getKeys",ol.source.ImageStatic.prototype.getKeys);goog.exportProperty(ol.source.ImageStatic.prototype,"getProperties",ol.source.ImageStatic.prototype.getProperties);goog.exportProperty(ol.source.ImageStatic.prototype,"set",ol.source.ImageStatic.prototype.set);goog.exportProperty(ol.source.ImageStatic.prototype,"setProperties",ol.source.ImageStatic.prototype.setProperties);goog.exportProperty(ol.source.ImageStatic.prototype,"unset",ol.source.ImageStatic.prototype.unset);goog.exportProperty(ol.source.ImageStatic.prototype,"changed",ol.source.ImageStatic.prototype.changed);goog.exportProperty(ol.source.ImageStatic.prototype,"dispatchEvent",ol.source.ImageStatic.prototype.dispatchEvent);goog.exportProperty(ol.source.ImageStatic.prototype,"getRevision",ol.source.ImageStatic.prototype.getRevision);goog.exportProperty(ol.source.ImageStatic.prototype,"on",ol.source.ImageStatic.prototype.on);goog.exportProperty(ol.source.ImageStatic.prototype,"once",ol.source.ImageStatic.prototype.once);goog.exportProperty(ol.source.ImageStatic.prototype,"un",ol.source.ImageStatic.prototype.un);goog.exportProperty(ol.source.ImageVector.prototype,"getAttributions",ol.source.ImageVector.prototype.getAttributions);goog.exportProperty(ol.source.ImageVector.prototype,"getLogo",ol.source.ImageVector.prototype.getLogo);goog.exportProperty(ol.source.ImageVector.prototype,"getProjection",ol.source.ImageVector.prototype.getProjection);goog.exportProperty(ol.source.ImageVector.prototype,"getState",ol.source.ImageVector.prototype.getState);goog.exportProperty(ol.source.ImageVector.prototype,"refresh",ol.source.ImageVector.prototype.refresh);goog.exportProperty(ol.source.ImageVector.prototype,"setAttributions",ol.source.ImageVector.prototype.setAttributions);goog.exportProperty(ol.source.ImageVector.prototype,"get",ol.source.ImageVector.prototype.get);goog.exportProperty(ol.source.ImageVector.prototype,"getKeys",ol.source.ImageVector.prototype.getKeys);goog.exportProperty(ol.source.ImageVector.prototype,"getProperties",ol.source.ImageVector.prototype.getProperties);goog.exportProperty(ol.source.ImageVector.prototype,"set",ol.source.ImageVector.prototype.set);goog.exportProperty(ol.source.ImageVector.prototype,"setProperties",ol.source.ImageVector.prototype.setProperties);goog.exportProperty(ol.source.ImageVector.prototype,"unset",ol.source.ImageVector.prototype.unset);goog.exportProperty(ol.source.ImageVector.prototype,"changed",ol.source.ImageVector.prototype.changed);goog.exportProperty(ol.source.ImageVector.prototype,"dispatchEvent",ol.source.ImageVector.prototype.dispatchEvent);goog.exportProperty(ol.source.ImageVector.prototype,"getRevision",ol.source.ImageVector.prototype.getRevision);goog.exportProperty(ol.source.ImageVector.prototype,"on",ol.source.ImageVector.prototype.on);goog.exportProperty(ol.source.ImageVector.prototype,"once",ol.source.ImageVector.prototype.once);goog.exportProperty(ol.source.ImageVector.prototype,"un",ol.source.ImageVector.prototype.un);goog.exportProperty(ol.source.ImageWMS.prototype,"getAttributions",ol.source.ImageWMS.prototype.getAttributions);goog.exportProperty(ol.source.ImageWMS.prototype,"getLogo",ol.source.ImageWMS.prototype.getLogo);goog.exportProperty(ol.source.ImageWMS.prototype,"getProjection",ol.source.ImageWMS.prototype.getProjection);goog.exportProperty(ol.source.ImageWMS.prototype,"getState",ol.source.ImageWMS.prototype.getState);goog.exportProperty(ol.source.ImageWMS.prototype,"refresh",ol.source.ImageWMS.prototype.refresh);goog.exportProperty(ol.source.ImageWMS.prototype,"setAttributions",ol.source.ImageWMS.prototype.setAttributions);goog.exportProperty(ol.source.ImageWMS.prototype,"get",ol.source.ImageWMS.prototype.get);goog.exportProperty(ol.source.ImageWMS.prototype,"getKeys",ol.source.ImageWMS.prototype.getKeys);goog.exportProperty(ol.source.ImageWMS.prototype,"getProperties",ol.source.ImageWMS.prototype.getProperties);goog.exportProperty(ol.source.ImageWMS.prototype,"set",ol.source.ImageWMS.prototype.set);goog.exportProperty(ol.source.ImageWMS.prototype,"setProperties",ol.source.ImageWMS.prototype.setProperties);goog.exportProperty(ol.source.ImageWMS.prototype,"unset",ol.source.ImageWMS.prototype.unset);goog.exportProperty(ol.source.ImageWMS.prototype,"changed",ol.source.ImageWMS.prototype.changed);goog.exportProperty(ol.source.ImageWMS.prototype,"dispatchEvent",ol.source.ImageWMS.prototype.dispatchEvent);goog.exportProperty(ol.source.ImageWMS.prototype,"getRevision",ol.source.ImageWMS.prototype.getRevision);goog.exportProperty(ol.source.ImageWMS.prototype,"on",ol.source.ImageWMS.prototype.on);goog.exportProperty(ol.source.ImageWMS.prototype,"once",ol.source.ImageWMS.prototype.once);goog.exportProperty(ol.source.ImageWMS.prototype,"un",ol.source.ImageWMS.prototype.un);goog.exportProperty(ol.source.OSM.prototype,"setRenderReprojectionEdges",ol.source.OSM.prototype.setRenderReprojectionEdges);goog.exportProperty(ol.source.OSM.prototype,"setTileGridForProjection",ol.source.OSM.prototype.setTileGridForProjection);goog.exportProperty(ol.source.OSM.prototype,"getTileLoadFunction",ol.source.OSM.prototype.getTileLoadFunction);goog.exportProperty(ol.source.OSM.prototype,"getTileUrlFunction",ol.source.OSM.prototype.getTileUrlFunction);goog.exportProperty(ol.source.OSM.prototype,"getUrls",ol.source.OSM.prototype.getUrls);goog.exportProperty(ol.source.OSM.prototype,"setTileLoadFunction",ol.source.OSM.prototype.setTileLoadFunction);goog.exportProperty(ol.source.OSM.prototype,"setTileUrlFunction",ol.source.OSM.prototype.setTileUrlFunction);goog.exportProperty(ol.source.OSM.prototype,"setUrl",ol.source.OSM.prototype.setUrl);goog.exportProperty(ol.source.OSM.prototype,"setUrls",ol.source.OSM.prototype.setUrls);goog.exportProperty(ol.source.OSM.prototype,"getTileGrid",ol.source.OSM.prototype.getTileGrid);goog.exportProperty(ol.source.OSM.prototype,"refresh",ol.source.OSM.prototype.refresh);goog.exportProperty(ol.source.OSM.prototype,"getAttributions",ol.source.OSM.prototype.getAttributions);goog.exportProperty(ol.source.OSM.prototype,"getLogo",ol.source.OSM.prototype.getLogo);goog.exportProperty(ol.source.OSM.prototype,"getProjection",ol.source.OSM.prototype.getProjection);goog.exportProperty(ol.source.OSM.prototype,"getState",ol.source.OSM.prototype.getState);goog.exportProperty(ol.source.OSM.prototype,"setAttributions",ol.source.OSM.prototype.setAttributions);goog.exportProperty(ol.source.OSM.prototype,"get",ol.source.OSM.prototype.get);goog.exportProperty(ol.source.OSM.prototype,"getKeys",ol.source.OSM.prototype.getKeys);goog.exportProperty(ol.source.OSM.prototype,"getProperties",ol.source.OSM.prototype.getProperties);goog.exportProperty(ol.source.OSM.prototype,"set",ol.source.OSM.prototype.set);goog.exportProperty(ol.source.OSM.prototype,"setProperties",ol.source.OSM.prototype.setProperties);goog.exportProperty(ol.source.OSM.prototype,"unset",ol.source.OSM.prototype.unset);goog.exportProperty(ol.source.OSM.prototype,"changed",ol.source.OSM.prototype.changed);goog.exportProperty(ol.source.OSM.prototype,"dispatchEvent",ol.source.OSM.prototype.dispatchEvent);goog.exportProperty(ol.source.OSM.prototype,"getRevision",ol.source.OSM.prototype.getRevision);goog.exportProperty(ol.source.OSM.prototype,"on",ol.source.OSM.prototype.on);goog.exportProperty(ol.source.OSM.prototype,"once",ol.source.OSM.prototype.once);goog.exportProperty(ol.source.OSM.prototype,"un",ol.source.OSM.prototype.un);goog.exportProperty(ol.source.Raster.prototype,"getAttributions",ol.source.Raster.prototype.getAttributions);goog.exportProperty(ol.source.Raster.prototype,"getLogo",ol.source.Raster.prototype.getLogo);goog.exportProperty(ol.source.Raster.prototype,"getProjection",ol.source.Raster.prototype.getProjection);goog.exportProperty(ol.source.Raster.prototype,"getState",ol.source.Raster.prototype.getState);goog.exportProperty(ol.source.Raster.prototype,"refresh",ol.source.Raster.prototype.refresh);goog.exportProperty(ol.source.Raster.prototype,"setAttributions",ol.source.Raster.prototype.setAttributions);goog.exportProperty(ol.source.Raster.prototype,"get",ol.source.Raster.prototype.get);goog.exportProperty(ol.source.Raster.prototype,"getKeys",ol.source.Raster.prototype.getKeys);goog.exportProperty(ol.source.Raster.prototype,"getProperties",ol.source.Raster.prototype.getProperties);goog.exportProperty(ol.source.Raster.prototype,"set",ol.source.Raster.prototype.set);goog.exportProperty(ol.source.Raster.prototype,"setProperties",ol.source.Raster.prototype.setProperties);goog.exportProperty(ol.source.Raster.prototype,"unset",ol.source.Raster.prototype.unset);goog.exportProperty(ol.source.Raster.prototype,"changed",ol.source.Raster.prototype.changed);goog.exportProperty(ol.source.Raster.prototype,"dispatchEvent",ol.source.Raster.prototype.dispatchEvent);goog.exportProperty(ol.source.Raster.prototype,"getRevision",ol.source.Raster.prototype.getRevision);goog.exportProperty(ol.source.Raster.prototype,"on",ol.source.Raster.prototype.on);goog.exportProperty(ol.source.Raster.prototype,"once",ol.source.Raster.prototype.once);goog.exportProperty(ol.source.Raster.prototype,"un",ol.source.Raster.prototype.un);goog.exportProperty(ol.source.Raster.Event.prototype,"type",ol.source.Raster.Event.prototype.type);goog.exportProperty(ol.source.Raster.Event.prototype,"target",ol.source.Raster.Event.prototype.target);goog.exportProperty(ol.source.Raster.Event.prototype,"preventDefault",ol.source.Raster.Event.prototype.preventDefault);goog.exportProperty(ol.source.Raster.Event.prototype,"stopPropagation",ol.source.Raster.Event.prototype.stopPropagation);goog.exportProperty(ol.source.Stamen.prototype,"setRenderReprojectionEdges",ol.source.Stamen.prototype.setRenderReprojectionEdges);goog.exportProperty(ol.source.Stamen.prototype,"setTileGridForProjection",ol.source.Stamen.prototype.setTileGridForProjection);goog.exportProperty(ol.source.Stamen.prototype,"getTileLoadFunction",ol.source.Stamen.prototype.getTileLoadFunction);goog.exportProperty(ol.source.Stamen.prototype,"getTileUrlFunction",ol.source.Stamen.prototype.getTileUrlFunction);goog.exportProperty(ol.source.Stamen.prototype,"getUrls",ol.source.Stamen.prototype.getUrls);goog.exportProperty(ol.source.Stamen.prototype,"setTileLoadFunction",ol.source.Stamen.prototype.setTileLoadFunction);goog.exportProperty(ol.source.Stamen.prototype,"setTileUrlFunction",ol.source.Stamen.prototype.setTileUrlFunction);goog.exportProperty(ol.source.Stamen.prototype,"setUrl",ol.source.Stamen.prototype.setUrl);goog.exportProperty(ol.source.Stamen.prototype,"setUrls",ol.source.Stamen.prototype.setUrls);goog.exportProperty(ol.source.Stamen.prototype,"getTileGrid",ol.source.Stamen.prototype.getTileGrid);goog.exportProperty(ol.source.Stamen.prototype,"refresh",ol.source.Stamen.prototype.refresh);goog.exportProperty(ol.source.Stamen.prototype,"getAttributions",ol.source.Stamen.prototype.getAttributions);goog.exportProperty(ol.source.Stamen.prototype,"getLogo",ol.source.Stamen.prototype.getLogo);goog.exportProperty(ol.source.Stamen.prototype,"getProjection",ol.source.Stamen.prototype.getProjection);goog.exportProperty(ol.source.Stamen.prototype,"getState",ol.source.Stamen.prototype.getState);goog.exportProperty(ol.source.Stamen.prototype,"setAttributions",ol.source.Stamen.prototype.setAttributions);goog.exportProperty(ol.source.Stamen.prototype,"get",ol.source.Stamen.prototype.get);goog.exportProperty(ol.source.Stamen.prototype,"getKeys",ol.source.Stamen.prototype.getKeys);goog.exportProperty(ol.source.Stamen.prototype,"getProperties",ol.source.Stamen.prototype.getProperties);goog.exportProperty(ol.source.Stamen.prototype,"set",ol.source.Stamen.prototype.set);goog.exportProperty(ol.source.Stamen.prototype,"setProperties",ol.source.Stamen.prototype.setProperties);goog.exportProperty(ol.source.Stamen.prototype,"unset",ol.source.Stamen.prototype.unset);goog.exportProperty(ol.source.Stamen.prototype,"changed",ol.source.Stamen.prototype.changed);goog.exportProperty(ol.source.Stamen.prototype,"dispatchEvent",ol.source.Stamen.prototype.dispatchEvent);goog.exportProperty(ol.source.Stamen.prototype,"getRevision",ol.source.Stamen.prototype.getRevision);goog.exportProperty(ol.source.Stamen.prototype,"on",ol.source.Stamen.prototype.on);goog.exportProperty(ol.source.Stamen.prototype,"once",ol.source.Stamen.prototype.once);goog.exportProperty(ol.source.Stamen.prototype,"un",ol.source.Stamen.prototype.un);goog.exportProperty(ol.source.Tile.Event.prototype,"type",ol.source.Tile.Event.prototype.type);goog.exportProperty(ol.source.Tile.Event.prototype,"target",ol.source.Tile.Event.prototype.target);goog.exportProperty(ol.source.Tile.Event.prototype,"preventDefault",ol.source.Tile.Event.prototype.preventDefault);goog.exportProperty(ol.source.Tile.Event.prototype,"stopPropagation",ol.source.Tile.Event.prototype.stopPropagation);goog.exportProperty(ol.source.TileArcGISRest.prototype,"setRenderReprojectionEdges",ol.source.TileArcGISRest.prototype.setRenderReprojectionEdges);goog.exportProperty(ol.source.TileArcGISRest.prototype,"setTileGridForProjection",ol.source.TileArcGISRest.prototype.setTileGridForProjection);goog.exportProperty(ol.source.TileArcGISRest.prototype,"getTileLoadFunction",ol.source.TileArcGISRest.prototype.getTileLoadFunction);goog.exportProperty(ol.source.TileArcGISRest.prototype,"getTileUrlFunction",ol.source.TileArcGISRest.prototype.getTileUrlFunction);goog.exportProperty(ol.source.TileArcGISRest.prototype,"getUrls",ol.source.TileArcGISRest.prototype.getUrls);goog.exportProperty(ol.source.TileArcGISRest.prototype,"setTileLoadFunction",ol.source.TileArcGISRest.prototype.setTileLoadFunction);goog.exportProperty(ol.source.TileArcGISRest.prototype,"setTileUrlFunction",ol.source.TileArcGISRest.prototype.setTileUrlFunction);goog.exportProperty(ol.source.TileArcGISRest.prototype,"setUrl",ol.source.TileArcGISRest.prototype.setUrl);goog.exportProperty(ol.source.TileArcGISRest.prototype,"setUrls",ol.source.TileArcGISRest.prototype.setUrls);goog.exportProperty(ol.source.TileArcGISRest.prototype,"getTileGrid",ol.source.TileArcGISRest.prototype.getTileGrid);goog.exportProperty(ol.source.TileArcGISRest.prototype,"refresh",ol.source.TileArcGISRest.prototype.refresh);goog.exportProperty(ol.source.TileArcGISRest.prototype,"getAttributions",ol.source.TileArcGISRest.prototype.getAttributions);goog.exportProperty(ol.source.TileArcGISRest.prototype,"getLogo",ol.source.TileArcGISRest.prototype.getLogo);goog.exportProperty(ol.source.TileArcGISRest.prototype,"getProjection",ol.source.TileArcGISRest.prototype.getProjection);goog.exportProperty(ol.source.TileArcGISRest.prototype,"getState",ol.source.TileArcGISRest.prototype.getState);goog.exportProperty(ol.source.TileArcGISRest.prototype,"setAttributions",ol.source.TileArcGISRest.prototype.setAttributions);goog.exportProperty(ol.source.TileArcGISRest.prototype,"get",ol.source.TileArcGISRest.prototype.get);goog.exportProperty(ol.source.TileArcGISRest.prototype,"getKeys",ol.source.TileArcGISRest.prototype.getKeys);goog.exportProperty(ol.source.TileArcGISRest.prototype,"getProperties",ol.source.TileArcGISRest.prototype.getProperties);goog.exportProperty(ol.source.TileArcGISRest.prototype,"set",ol.source.TileArcGISRest.prototype.set);goog.exportProperty(ol.source.TileArcGISRest.prototype,"setProperties",ol.source.TileArcGISRest.prototype.setProperties);goog.exportProperty(ol.source.TileArcGISRest.prototype,"unset",ol.source.TileArcGISRest.prototype.unset);goog.exportProperty(ol.source.TileArcGISRest.prototype,"changed",ol.source.TileArcGISRest.prototype.changed);goog.exportProperty(ol.source.TileArcGISRest.prototype,"dispatchEvent",ol.source.TileArcGISRest.prototype.dispatchEvent);goog.exportProperty(ol.source.TileArcGISRest.prototype,"getRevision",ol.source.TileArcGISRest.prototype.getRevision);goog.exportProperty(ol.source.TileArcGISRest.prototype,"on",ol.source.TileArcGISRest.prototype.on);goog.exportProperty(ol.source.TileArcGISRest.prototype,"once",ol.source.TileArcGISRest.prototype.once);goog.exportProperty(ol.source.TileArcGISRest.prototype,"un",ol.source.TileArcGISRest.prototype.un);goog.exportProperty(ol.source.TileDebug.prototype,"getTileGrid",ol.source.TileDebug.prototype.getTileGrid);goog.exportProperty(ol.source.TileDebug.prototype,"refresh",ol.source.TileDebug.prototype.refresh);goog.exportProperty(ol.source.TileDebug.prototype,"getAttributions",ol.source.TileDebug.prototype.getAttributions);goog.exportProperty(ol.source.TileDebug.prototype,"getLogo",ol.source.TileDebug.prototype.getLogo);goog.exportProperty(ol.source.TileDebug.prototype,"getProjection",ol.source.TileDebug.prototype.getProjection);goog.exportProperty(ol.source.TileDebug.prototype,"getState",ol.source.TileDebug.prototype.getState);goog.exportProperty(ol.source.TileDebug.prototype,"setAttributions",ol.source.TileDebug.prototype.setAttributions);goog.exportProperty(ol.source.TileDebug.prototype,"get",ol.source.TileDebug.prototype.get);goog.exportProperty(ol.source.TileDebug.prototype,"getKeys",ol.source.TileDebug.prototype.getKeys);goog.exportProperty(ol.source.TileDebug.prototype,"getProperties",ol.source.TileDebug.prototype.getProperties);goog.exportProperty(ol.source.TileDebug.prototype,"set",ol.source.TileDebug.prototype.set);goog.exportProperty(ol.source.TileDebug.prototype,"setProperties",ol.source.TileDebug.prototype.setProperties);goog.exportProperty(ol.source.TileDebug.prototype,"unset",ol.source.TileDebug.prototype.unset);goog.exportProperty(ol.source.TileDebug.prototype,"changed",ol.source.TileDebug.prototype.changed);goog.exportProperty(ol.source.TileDebug.prototype,"dispatchEvent",ol.source.TileDebug.prototype.dispatchEvent);goog.exportProperty(ol.source.TileDebug.prototype,"getRevision",ol.source.TileDebug.prototype.getRevision);goog.exportProperty(ol.source.TileDebug.prototype,"on",ol.source.TileDebug.prototype.on);goog.exportProperty(ol.source.TileDebug.prototype,"once",ol.source.TileDebug.prototype.once);goog.exportProperty(ol.source.TileDebug.prototype,"un",ol.source.TileDebug.prototype.un);goog.exportProperty(ol.source.TileJSON.prototype,"setRenderReprojectionEdges",ol.source.TileJSON.prototype.setRenderReprojectionEdges);goog.exportProperty(ol.source.TileJSON.prototype,"setTileGridForProjection",ol.source.TileJSON.prototype.setTileGridForProjection);goog.exportProperty(ol.source.TileJSON.prototype,"getTileLoadFunction",ol.source.TileJSON.prototype.getTileLoadFunction);goog.exportProperty(ol.source.TileJSON.prototype,"getTileUrlFunction",ol.source.TileJSON.prototype.getTileUrlFunction);goog.exportProperty(ol.source.TileJSON.prototype,"getUrls",ol.source.TileJSON.prototype.getUrls);goog.exportProperty(ol.source.TileJSON.prototype,"setTileLoadFunction",ol.source.TileJSON.prototype.setTileLoadFunction);goog.exportProperty(ol.source.TileJSON.prototype,"setTileUrlFunction",ol.source.TileJSON.prototype.setTileUrlFunction);goog.exportProperty(ol.source.TileJSON.prototype,"setUrl",ol.source.TileJSON.prototype.setUrl);goog.exportProperty(ol.source.TileJSON.prototype,"setUrls",ol.source.TileJSON.prototype.setUrls);goog.exportProperty(ol.source.TileJSON.prototype,"getTileGrid",ol.source.TileJSON.prototype.getTileGrid);goog.exportProperty(ol.source.TileJSON.prototype,"refresh",ol.source.TileJSON.prototype.refresh);goog.exportProperty(ol.source.TileJSON.prototype,"getAttributions",ol.source.TileJSON.prototype.getAttributions);goog.exportProperty(ol.source.TileJSON.prototype,"getLogo",ol.source.TileJSON.prototype.getLogo);goog.exportProperty(ol.source.TileJSON.prototype,"getProjection",ol.source.TileJSON.prototype.getProjection);goog.exportProperty(ol.source.TileJSON.prototype,"getState",ol.source.TileJSON.prototype.getState);goog.exportProperty(ol.source.TileJSON.prototype,"setAttributions",ol.source.TileJSON.prototype.setAttributions);goog.exportProperty(ol.source.TileJSON.prototype,"get",ol.source.TileJSON.prototype.get);goog.exportProperty(ol.source.TileJSON.prototype,"getKeys",ol.source.TileJSON.prototype.getKeys);goog.exportProperty(ol.source.TileJSON.prototype,"getProperties",ol.source.TileJSON.prototype.getProperties);goog.exportProperty(ol.source.TileJSON.prototype,"set",ol.source.TileJSON.prototype.set);goog.exportProperty(ol.source.TileJSON.prototype,"setProperties",ol.source.TileJSON.prototype.setProperties);goog.exportProperty(ol.source.TileJSON.prototype,"unset",ol.source.TileJSON.prototype.unset);goog.exportProperty(ol.source.TileJSON.prototype,"changed",ol.source.TileJSON.prototype.changed);goog.exportProperty(ol.source.TileJSON.prototype,"dispatchEvent",ol.source.TileJSON.prototype.dispatchEvent);goog.exportProperty(ol.source.TileJSON.prototype,"getRevision",ol.source.TileJSON.prototype.getRevision);goog.exportProperty(ol.source.TileJSON.prototype,"on",ol.source.TileJSON.prototype.on);goog.exportProperty(ol.source.TileJSON.prototype,"once",ol.source.TileJSON.prototype.once);goog.exportProperty(ol.source.TileJSON.prototype,"un",ol.source.TileJSON.prototype.un);goog.exportProperty(ol.source.TileUTFGrid.prototype,"getTileGrid",ol.source.TileUTFGrid.prototype.getTileGrid);goog.exportProperty(ol.source.TileUTFGrid.prototype,"refresh",ol.source.TileUTFGrid.prototype.refresh);goog.exportProperty(ol.source.TileUTFGrid.prototype,"getAttributions",ol.source.TileUTFGrid.prototype.getAttributions);goog.exportProperty(ol.source.TileUTFGrid.prototype,"getLogo",ol.source.TileUTFGrid.prototype.getLogo);goog.exportProperty(ol.source.TileUTFGrid.prototype,"getProjection",ol.source.TileUTFGrid.prototype.getProjection);goog.exportProperty(ol.source.TileUTFGrid.prototype,"getState",ol.source.TileUTFGrid.prototype.getState);goog.exportProperty(ol.source.TileUTFGrid.prototype,"setAttributions",ol.source.TileUTFGrid.prototype.setAttributions);goog.exportProperty(ol.source.TileUTFGrid.prototype,"get",ol.source.TileUTFGrid.prototype.get);goog.exportProperty(ol.source.TileUTFGrid.prototype,"getKeys",ol.source.TileUTFGrid.prototype.getKeys);goog.exportProperty(ol.source.TileUTFGrid.prototype,"getProperties",ol.source.TileUTFGrid.prototype.getProperties);goog.exportProperty(ol.source.TileUTFGrid.prototype,"set",ol.source.TileUTFGrid.prototype.set);goog.exportProperty(ol.source.TileUTFGrid.prototype,"setProperties",ol.source.TileUTFGrid.prototype.setProperties);goog.exportProperty(ol.source.TileUTFGrid.prototype,"unset",ol.source.TileUTFGrid.prototype.unset);goog.exportProperty(ol.source.TileUTFGrid.prototype,"changed",ol.source.TileUTFGrid.prototype.changed);goog.exportProperty(ol.source.TileUTFGrid.prototype,"dispatchEvent",ol.source.TileUTFGrid.prototype.dispatchEvent);goog.exportProperty(ol.source.TileUTFGrid.prototype,"getRevision",ol.source.TileUTFGrid.prototype.getRevision);goog.exportProperty(ol.source.TileUTFGrid.prototype,"on",ol.source.TileUTFGrid.prototype.on);goog.exportProperty(ol.source.TileUTFGrid.prototype,"once",ol.source.TileUTFGrid.prototype.once);goog.exportProperty(ol.source.TileUTFGrid.prototype,"un",ol.source.TileUTFGrid.prototype.un);goog.exportProperty(ol.source.TileWMS.prototype,"setRenderReprojectionEdges",ol.source.TileWMS.prototype.setRenderReprojectionEdges);goog.exportProperty(ol.source.TileWMS.prototype,"setTileGridForProjection",ol.source.TileWMS.prototype.setTileGridForProjection);goog.exportProperty(ol.source.TileWMS.prototype,"getTileLoadFunction",ol.source.TileWMS.prototype.getTileLoadFunction);goog.exportProperty(ol.source.TileWMS.prototype,"getTileUrlFunction",ol.source.TileWMS.prototype.getTileUrlFunction);goog.exportProperty(ol.source.TileWMS.prototype,"getUrls",ol.source.TileWMS.prototype.getUrls);goog.exportProperty(ol.source.TileWMS.prototype,"setTileLoadFunction",ol.source.TileWMS.prototype.setTileLoadFunction);goog.exportProperty(ol.source.TileWMS.prototype,"setTileUrlFunction",ol.source.TileWMS.prototype.setTileUrlFunction);goog.exportProperty(ol.source.TileWMS.prototype,"setUrl",ol.source.TileWMS.prototype.setUrl);goog.exportProperty(ol.source.TileWMS.prototype,"setUrls",ol.source.TileWMS.prototype.setUrls);goog.exportProperty(ol.source.TileWMS.prototype,"getTileGrid",ol.source.TileWMS.prototype.getTileGrid);goog.exportProperty(ol.source.TileWMS.prototype,"refresh",ol.source.TileWMS.prototype.refresh);goog.exportProperty(ol.source.TileWMS.prototype,"getAttributions",ol.source.TileWMS.prototype.getAttributions);goog.exportProperty(ol.source.TileWMS.prototype,"getLogo",ol.source.TileWMS.prototype.getLogo);goog.exportProperty(ol.source.TileWMS.prototype,"getProjection",ol.source.TileWMS.prototype.getProjection);goog.exportProperty(ol.source.TileWMS.prototype,"getState",ol.source.TileWMS.prototype.getState);goog.exportProperty(ol.source.TileWMS.prototype,"setAttributions",ol.source.TileWMS.prototype.setAttributions);goog.exportProperty(ol.source.TileWMS.prototype,"get",ol.source.TileWMS.prototype.get);goog.exportProperty(ol.source.TileWMS.prototype,"getKeys",ol.source.TileWMS.prototype.getKeys);goog.exportProperty(ol.source.TileWMS.prototype,"getProperties",ol.source.TileWMS.prototype.getProperties);goog.exportProperty(ol.source.TileWMS.prototype,"set",ol.source.TileWMS.prototype.set);goog.exportProperty(ol.source.TileWMS.prototype,"setProperties",ol.source.TileWMS.prototype.setProperties);goog.exportProperty(ol.source.TileWMS.prototype,"unset",ol.source.TileWMS.prototype.unset);goog.exportProperty(ol.source.TileWMS.prototype,"changed",ol.source.TileWMS.prototype.changed);goog.exportProperty(ol.source.TileWMS.prototype,"dispatchEvent",ol.source.TileWMS.prototype.dispatchEvent);goog.exportProperty(ol.source.TileWMS.prototype,"getRevision",ol.source.TileWMS.prototype.getRevision);goog.exportProperty(ol.source.TileWMS.prototype,"on",ol.source.TileWMS.prototype.on);goog.exportProperty(ol.source.TileWMS.prototype,"once",ol.source.TileWMS.prototype.once);goog.exportProperty(ol.source.TileWMS.prototype,"un",ol.source.TileWMS.prototype.un);goog.exportProperty(ol.source.Vector.Event.prototype,"type",ol.source.Vector.Event.prototype.type);goog.exportProperty(ol.source.Vector.Event.prototype,"target",ol.source.Vector.Event.prototype.target);goog.exportProperty(ol.source.Vector.Event.prototype,"preventDefault",ol.source.Vector.Event.prototype.preventDefault);goog.exportProperty(ol.source.Vector.Event.prototype,"stopPropagation",ol.source.Vector.Event.prototype.stopPropagation);goog.exportProperty(ol.source.VectorTile.prototype,"getTileLoadFunction",ol.source.VectorTile.prototype.getTileLoadFunction);goog.exportProperty(ol.source.VectorTile.prototype,"getTileUrlFunction",ol.source.VectorTile.prototype.getTileUrlFunction);goog.exportProperty(ol.source.VectorTile.prototype,"getUrls",ol.source.VectorTile.prototype.getUrls);goog.exportProperty(ol.source.VectorTile.prototype,"setTileLoadFunction",ol.source.VectorTile.prototype.setTileLoadFunction);goog.exportProperty(ol.source.VectorTile.prototype,"setTileUrlFunction",ol.source.VectorTile.prototype.setTileUrlFunction);goog.exportProperty(ol.source.VectorTile.prototype,"setUrl",ol.source.VectorTile.prototype.setUrl);goog.exportProperty(ol.source.VectorTile.prototype,"setUrls",ol.source.VectorTile.prototype.setUrls);goog.exportProperty(ol.source.VectorTile.prototype,"getTileGrid",ol.source.VectorTile.prototype.getTileGrid);goog.exportProperty(ol.source.VectorTile.prototype,"refresh",ol.source.VectorTile.prototype.refresh);goog.exportProperty(ol.source.VectorTile.prototype,"getAttributions",ol.source.VectorTile.prototype.getAttributions);goog.exportProperty(ol.source.VectorTile.prototype,"getLogo",ol.source.VectorTile.prototype.getLogo);goog.exportProperty(ol.source.VectorTile.prototype,"getProjection",ol.source.VectorTile.prototype.getProjection);goog.exportProperty(ol.source.VectorTile.prototype,"getState",ol.source.VectorTile.prototype.getState);goog.exportProperty(ol.source.VectorTile.prototype,"setAttributions",ol.source.VectorTile.prototype.setAttributions);goog.exportProperty(ol.source.VectorTile.prototype,"get",ol.source.VectorTile.prototype.get);goog.exportProperty(ol.source.VectorTile.prototype,"getKeys",ol.source.VectorTile.prototype.getKeys);goog.exportProperty(ol.source.VectorTile.prototype,"getProperties",ol.source.VectorTile.prototype.getProperties);goog.exportProperty(ol.source.VectorTile.prototype,"set",ol.source.VectorTile.prototype.set);goog.exportProperty(ol.source.VectorTile.prototype,"setProperties",ol.source.VectorTile.prototype.setProperties);goog.exportProperty(ol.source.VectorTile.prototype,"unset",ol.source.VectorTile.prototype.unset);goog.exportProperty(ol.source.VectorTile.prototype,"changed",ol.source.VectorTile.prototype.changed);goog.exportProperty(ol.source.VectorTile.prototype,"dispatchEvent",ol.source.VectorTile.prototype.dispatchEvent);goog.exportProperty(ol.source.VectorTile.prototype,"getRevision",ol.source.VectorTile.prototype.getRevision);goog.exportProperty(ol.source.VectorTile.prototype,"on",ol.source.VectorTile.prototype.on);goog.exportProperty(ol.source.VectorTile.prototype,"once",ol.source.VectorTile.prototype.once);goog.exportProperty(ol.source.VectorTile.prototype,"un",ol.source.VectorTile.prototype.un);goog.exportProperty(ol.source.WMTS.prototype,"setRenderReprojectionEdges",ol.source.WMTS.prototype.setRenderReprojectionEdges);goog.exportProperty(ol.source.WMTS.prototype,"setTileGridForProjection",ol.source.WMTS.prototype.setTileGridForProjection);goog.exportProperty(ol.source.WMTS.prototype,"getTileLoadFunction",ol.source.WMTS.prototype.getTileLoadFunction);goog.exportProperty(ol.source.WMTS.prototype,"getTileUrlFunction",ol.source.WMTS.prototype.getTileUrlFunction);goog.exportProperty(ol.source.WMTS.prototype,"getUrls",ol.source.WMTS.prototype.getUrls);goog.exportProperty(ol.source.WMTS.prototype,"setTileLoadFunction",ol.source.WMTS.prototype.setTileLoadFunction);goog.exportProperty(ol.source.WMTS.prototype,"setTileUrlFunction",ol.source.WMTS.prototype.setTileUrlFunction);goog.exportProperty(ol.source.WMTS.prototype,"setUrl",ol.source.WMTS.prototype.setUrl);goog.exportProperty(ol.source.WMTS.prototype,"setUrls",ol.source.WMTS.prototype.setUrls);goog.exportProperty(ol.source.WMTS.prototype,"getTileGrid",ol.source.WMTS.prototype.getTileGrid);goog.exportProperty(ol.source.WMTS.prototype,"refresh",ol.source.WMTS.prototype.refresh);goog.exportProperty(ol.source.WMTS.prototype,"getAttributions",ol.source.WMTS.prototype.getAttributions);goog.exportProperty(ol.source.WMTS.prototype,"getLogo",ol.source.WMTS.prototype.getLogo);goog.exportProperty(ol.source.WMTS.prototype,"getProjection",ol.source.WMTS.prototype.getProjection);goog.exportProperty(ol.source.WMTS.prototype,"getState",ol.source.WMTS.prototype.getState);goog.exportProperty(ol.source.WMTS.prototype,"setAttributions",ol.source.WMTS.prototype.setAttributions);goog.exportProperty(ol.source.WMTS.prototype,"get",ol.source.WMTS.prototype.get);goog.exportProperty(ol.source.WMTS.prototype,"getKeys",ol.source.WMTS.prototype.getKeys);goog.exportProperty(ol.source.WMTS.prototype,"getProperties",ol.source.WMTS.prototype.getProperties);goog.exportProperty(ol.source.WMTS.prototype,"set",ol.source.WMTS.prototype.set);goog.exportProperty(ol.source.WMTS.prototype,"setProperties",ol.source.WMTS.prototype.setProperties);goog.exportProperty(ol.source.WMTS.prototype,"unset",ol.source.WMTS.prototype.unset);goog.exportProperty(ol.source.WMTS.prototype,"changed",ol.source.WMTS.prototype.changed);goog.exportProperty(ol.source.WMTS.prototype,"dispatchEvent",ol.source.WMTS.prototype.dispatchEvent);goog.exportProperty(ol.source.WMTS.prototype,"getRevision",ol.source.WMTS.prototype.getRevision);goog.exportProperty(ol.source.WMTS.prototype,"on",ol.source.WMTS.prototype.on);goog.exportProperty(ol.source.WMTS.prototype,"once",ol.source.WMTS.prototype.once);goog.exportProperty(ol.source.WMTS.prototype,"un",ol.source.WMTS.prototype.un);goog.exportProperty(ol.source.Zoomify.prototype,"setRenderReprojectionEdges",ol.source.Zoomify.prototype.setRenderReprojectionEdges);goog.exportProperty(ol.source.Zoomify.prototype,"setTileGridForProjection",ol.source.Zoomify.prototype.setTileGridForProjection);goog.exportProperty(ol.source.Zoomify.prototype,"getTileLoadFunction",ol.source.Zoomify.prototype.getTileLoadFunction);goog.exportProperty(ol.source.Zoomify.prototype,"getTileUrlFunction",ol.source.Zoomify.prototype.getTileUrlFunction);goog.exportProperty(ol.source.Zoomify.prototype,"getUrls",ol.source.Zoomify.prototype.getUrls);goog.exportProperty(ol.source.Zoomify.prototype,"setTileLoadFunction",ol.source.Zoomify.prototype.setTileLoadFunction);goog.exportProperty(ol.source.Zoomify.prototype,"setTileUrlFunction",ol.source.Zoomify.prototype.setTileUrlFunction);goog.exportProperty(ol.source.Zoomify.prototype,"setUrl",ol.source.Zoomify.prototype.setUrl);goog.exportProperty(ol.source.Zoomify.prototype,"setUrls",ol.source.Zoomify.prototype.setUrls);goog.exportProperty(ol.source.Zoomify.prototype,"getTileGrid",ol.source.Zoomify.prototype.getTileGrid);goog.exportProperty(ol.source.Zoomify.prototype,"refresh",ol.source.Zoomify.prototype.refresh);goog.exportProperty(ol.source.Zoomify.prototype,"getAttributions",ol.source.Zoomify.prototype.getAttributions);goog.exportProperty(ol.source.Zoomify.prototype,"getLogo",ol.source.Zoomify.prototype.getLogo);goog.exportProperty(ol.source.Zoomify.prototype,"getProjection",ol.source.Zoomify.prototype.getProjection);goog.exportProperty(ol.source.Zoomify.prototype,"getState",ol.source.Zoomify.prototype.getState);goog.exportProperty(ol.source.Zoomify.prototype,"setAttributions",ol.source.Zoomify.prototype.setAttributions);goog.exportProperty(ol.source.Zoomify.prototype,"get",ol.source.Zoomify.prototype.get);goog.exportProperty(ol.source.Zoomify.prototype,"getKeys",ol.source.Zoomify.prototype.getKeys);goog.exportProperty(ol.source.Zoomify.prototype,"getProperties",ol.source.Zoomify.prototype.getProperties);goog.exportProperty(ol.source.Zoomify.prototype,"set",ol.source.Zoomify.prototype.set);goog.exportProperty(ol.source.Zoomify.prototype,"setProperties",ol.source.Zoomify.prototype.setProperties);goog.exportProperty(ol.source.Zoomify.prototype,"unset",ol.source.Zoomify.prototype.unset);goog.exportProperty(ol.source.Zoomify.prototype,"changed",ol.source.Zoomify.prototype.changed);goog.exportProperty(ol.source.Zoomify.prototype,"dispatchEvent",ol.source.Zoomify.prototype.dispatchEvent);goog.exportProperty(ol.source.Zoomify.prototype,"getRevision",ol.source.Zoomify.prototype.getRevision);goog.exportProperty(ol.source.Zoomify.prototype,"on",ol.source.Zoomify.prototype.on);goog.exportProperty(ol.source.Zoomify.prototype,"once",ol.source.Zoomify.prototype.once);goog.exportProperty(ol.source.Zoomify.prototype,"un",ol.source.Zoomify.prototype.un);goog.exportProperty(ol.reproj.Tile.prototype,"getTileCoord",ol.reproj.Tile.prototype.getTileCoord);goog.exportProperty(ol.reproj.Tile.prototype,"load",ol.reproj.Tile.prototype.load);goog.exportProperty(ol.renderer.Layer.prototype,"changed",ol.renderer.Layer.prototype.changed);goog.exportProperty(ol.renderer.Layer.prototype,"dispatchEvent",ol.renderer.Layer.prototype.dispatchEvent);goog.exportProperty(ol.renderer.Layer.prototype,"getRevision",ol.renderer.Layer.prototype.getRevision);goog.exportProperty(ol.renderer.Layer.prototype,"on",ol.renderer.Layer.prototype.on);goog.exportProperty(ol.renderer.Layer.prototype,"once",ol.renderer.Layer.prototype.once);goog.exportProperty(ol.renderer.Layer.prototype,"un",ol.renderer.Layer.prototype.un);goog.exportProperty(ol.renderer.webgl.Layer.prototype,"changed",ol.renderer.webgl.Layer.prototype.changed);goog.exportProperty(ol.renderer.webgl.Layer.prototype,"dispatchEvent",ol.renderer.webgl.Layer.prototype.dispatchEvent);goog.exportProperty(ol.renderer.webgl.Layer.prototype,"getRevision",ol.renderer.webgl.Layer.prototype.getRevision);goog.exportProperty(ol.renderer.webgl.Layer.prototype,"on",ol.renderer.webgl.Layer.prototype.on);goog.exportProperty(ol.renderer.webgl.Layer.prototype,"once",ol.renderer.webgl.Layer.prototype.once);goog.exportProperty(ol.renderer.webgl.Layer.prototype,"un",ol.renderer.webgl.Layer.prototype.un);goog.exportProperty(ol.renderer.webgl.ImageLayer.prototype,"changed",ol.renderer.webgl.ImageLayer.prototype.changed);goog.exportProperty(ol.renderer.webgl.ImageLayer.prototype,"dispatchEvent",ol.renderer.webgl.ImageLayer.prototype.dispatchEvent);goog.exportProperty(ol.renderer.webgl.ImageLayer.prototype,"getRevision",ol.renderer.webgl.ImageLayer.prototype.getRevision);goog.exportProperty(ol.renderer.webgl.ImageLayer.prototype,"on",ol.renderer.webgl.ImageLayer.prototype.on);goog.exportProperty(ol.renderer.webgl.ImageLayer.prototype,"once",ol.renderer.webgl.ImageLayer.prototype.once);goog.exportProperty(ol.renderer.webgl.ImageLayer.prototype,"un",ol.renderer.webgl.ImageLayer.prototype.un);goog.exportProperty(ol.renderer.webgl.TileLayer.prototype,"changed",ol.renderer.webgl.TileLayer.prototype.changed);goog.exportProperty(ol.renderer.webgl.TileLayer.prototype,"dispatchEvent",ol.renderer.webgl.TileLayer.prototype.dispatchEvent);goog.exportProperty(ol.renderer.webgl.TileLayer.prototype,"getRevision",ol.renderer.webgl.TileLayer.prototype.getRevision);goog.exportProperty(ol.renderer.webgl.TileLayer.prototype,"on",ol.renderer.webgl.TileLayer.prototype.on);goog.exportProperty(ol.renderer.webgl.TileLayer.prototype,"once",ol.renderer.webgl.TileLayer.prototype.once);goog.exportProperty(ol.renderer.webgl.TileLayer.prototype,"un",ol.renderer.webgl.TileLayer.prototype.un);goog.exportProperty(ol.renderer.webgl.VectorLayer.prototype,"changed",ol.renderer.webgl.VectorLayer.prototype.changed);goog.exportProperty(ol.renderer.webgl.VectorLayer.prototype,"dispatchEvent",ol.renderer.webgl.VectorLayer.prototype.dispatchEvent);goog.exportProperty(ol.renderer.webgl.VectorLayer.prototype,"getRevision",ol.renderer.webgl.VectorLayer.prototype.getRevision);goog.exportProperty(ol.renderer.webgl.VectorLayer.prototype,"on",ol.renderer.webgl.VectorLayer.prototype.on);goog.exportProperty(ol.renderer.webgl.VectorLayer.prototype,"once",ol.renderer.webgl.VectorLayer.prototype.once);goog.exportProperty(ol.renderer.webgl.VectorLayer.prototype,"un",ol.renderer.webgl.VectorLayer.prototype.un);goog.exportProperty(ol.renderer.canvas.Layer.prototype,"changed",ol.renderer.canvas.Layer.prototype.changed);goog.exportProperty(ol.renderer.canvas.Layer.prototype,"dispatchEvent",ol.renderer.canvas.Layer.prototype.dispatchEvent);goog.exportProperty(ol.renderer.canvas.Layer.prototype,"getRevision",ol.renderer.canvas.Layer.prototype.getRevision);goog.exportProperty(ol.renderer.canvas.Layer.prototype,"on",ol.renderer.canvas.Layer.prototype.on);goog.exportProperty(ol.renderer.canvas.Layer.prototype,"once",ol.renderer.canvas.Layer.prototype.once);goog.exportProperty(ol.renderer.canvas.Layer.prototype,"un",ol.renderer.canvas.Layer.prototype.un);goog.exportProperty(ol.renderer.canvas.IntermediateCanvas.prototype,"changed",ol.renderer.canvas.IntermediateCanvas.prototype.changed);goog.exportProperty(ol.renderer.canvas.IntermediateCanvas.prototype,"dispatchEvent",ol.renderer.canvas.IntermediateCanvas.prototype.dispatchEvent);goog.exportProperty(ol.renderer.canvas.IntermediateCanvas.prototype,"getRevision",ol.renderer.canvas.IntermediateCanvas.prototype.getRevision);goog.exportProperty(ol.renderer.canvas.IntermediateCanvas.prototype,"on",ol.renderer.canvas.IntermediateCanvas.prototype.on);goog.exportProperty(ol.renderer.canvas.IntermediateCanvas.prototype,"once",ol.renderer.canvas.IntermediateCanvas.prototype.once);goog.exportProperty(ol.renderer.canvas.IntermediateCanvas.prototype,"un",ol.renderer.canvas.IntermediateCanvas.prototype.un);goog.exportProperty(ol.renderer.canvas.ImageLayer.prototype,"changed",ol.renderer.canvas.ImageLayer.prototype.changed);goog.exportProperty(ol.renderer.canvas.ImageLayer.prototype,"dispatchEvent",ol.renderer.canvas.ImageLayer.prototype.dispatchEvent);goog.exportProperty(ol.renderer.canvas.ImageLayer.prototype,"getRevision",ol.renderer.canvas.ImageLayer.prototype.getRevision);goog.exportProperty(ol.renderer.canvas.ImageLayer.prototype,"on",ol.renderer.canvas.ImageLayer.prototype.on);goog.exportProperty(ol.renderer.canvas.ImageLayer.prototype,"once",ol.renderer.canvas.ImageLayer.prototype.once);goog.exportProperty(ol.renderer.canvas.ImageLayer.prototype,"un",ol.renderer.canvas.ImageLayer.prototype.un);goog.exportProperty(ol.renderer.canvas.TileLayer.prototype,"changed",ol.renderer.canvas.TileLayer.prototype.changed);goog.exportProperty(ol.renderer.canvas.TileLayer.prototype,"dispatchEvent",ol.renderer.canvas.TileLayer.prototype.dispatchEvent);goog.exportProperty(ol.renderer.canvas.TileLayer.prototype,"getRevision",ol.renderer.canvas.TileLayer.prototype.getRevision);goog.exportProperty(ol.renderer.canvas.TileLayer.prototype,"on",ol.renderer.canvas.TileLayer.prototype.on);goog.exportProperty(ol.renderer.canvas.TileLayer.prototype,"once",ol.renderer.canvas.TileLayer.prototype.once);goog.exportProperty(ol.renderer.canvas.TileLayer.prototype,"un",ol.renderer.canvas.TileLayer.prototype.un);goog.exportProperty(ol.renderer.canvas.VectorLayer.prototype,"changed",ol.renderer.canvas.VectorLayer.prototype.changed);goog.exportProperty(ol.renderer.canvas.VectorLayer.prototype,"dispatchEvent",ol.renderer.canvas.VectorLayer.prototype.dispatchEvent);goog.exportProperty(ol.renderer.canvas.VectorLayer.prototype,"getRevision",ol.renderer.canvas.VectorLayer.prototype.getRevision);goog.exportProperty(ol.renderer.canvas.VectorLayer.prototype,"on",ol.renderer.canvas.VectorLayer.prototype.on);goog.exportProperty(ol.renderer.canvas.VectorLayer.prototype,"once",ol.renderer.canvas.VectorLayer.prototype.once);goog.exportProperty(ol.renderer.canvas.VectorLayer.prototype,"un",ol.renderer.canvas.VectorLayer.prototype.un);goog.exportProperty(ol.renderer.canvas.VectorTileLayer.prototype,"changed",ol.renderer.canvas.VectorTileLayer.prototype.changed);goog.exportProperty(ol.renderer.canvas.VectorTileLayer.prototype,"dispatchEvent",ol.renderer.canvas.VectorTileLayer.prototype.dispatchEvent);goog.exportProperty(ol.renderer.canvas.VectorTileLayer.prototype,"getRevision",ol.renderer.canvas.VectorTileLayer.prototype.getRevision);goog.exportProperty(ol.renderer.canvas.VectorTileLayer.prototype,"on",ol.renderer.canvas.VectorTileLayer.prototype.on);goog.exportProperty(ol.renderer.canvas.VectorTileLayer.prototype,"once",ol.renderer.canvas.VectorTileLayer.prototype.once);goog.exportProperty(ol.renderer.canvas.VectorTileLayer.prototype,"un",ol.renderer.canvas.VectorTileLayer.prototype.un);goog.exportProperty(ol.render.Event.prototype,"type",ol.render.Event.prototype.type);goog.exportProperty(ol.render.Event.prototype,"target",ol.render.Event.prototype.target);goog.exportProperty(ol.render.Event.prototype,"preventDefault",ol.render.Event.prototype.preventDefault);goog.exportProperty(ol.render.Event.prototype,"stopPropagation",ol.render.Event.prototype.stopPropagation);goog.exportProperty(ol.pointer.PointerEvent.prototype,"type",ol.pointer.PointerEvent.prototype.type);goog.exportProperty(ol.pointer.PointerEvent.prototype,"target",ol.pointer.PointerEvent.prototype.target);goog.exportProperty(ol.pointer.PointerEvent.prototype,"preventDefault",ol.pointer.PointerEvent.prototype.preventDefault);goog.exportProperty(ol.pointer.PointerEvent.prototype,"stopPropagation",ol.pointer.PointerEvent.prototype.stopPropagation);goog.exportProperty(ol.layer.Base.prototype,"get",ol.layer.Base.prototype.get);goog.exportProperty(ol.layer.Base.prototype,"getKeys",ol.layer.Base.prototype.getKeys);goog.exportProperty(ol.layer.Base.prototype,"getProperties",ol.layer.Base.prototype.getProperties);goog.exportProperty(ol.layer.Base.prototype,"set",ol.layer.Base.prototype.set);goog.exportProperty(ol.layer.Base.prototype,"setProperties",ol.layer.Base.prototype.setProperties);goog.exportProperty(ol.layer.Base.prototype,"unset",ol.layer.Base.prototype.unset);goog.exportProperty(ol.layer.Base.prototype,"changed",ol.layer.Base.prototype.changed);goog.exportProperty(ol.layer.Base.prototype,"dispatchEvent",ol.layer.Base.prototype.dispatchEvent);goog.exportProperty(ol.layer.Base.prototype,"getRevision",ol.layer.Base.prototype.getRevision);goog.exportProperty(ol.layer.Base.prototype,"on",ol.layer.Base.prototype.on);goog.exportProperty(ol.layer.Base.prototype,"once",ol.layer.Base.prototype.once);goog.exportProperty(ol.layer.Base.prototype,"un",ol.layer.Base.prototype.un);goog.exportProperty(ol.layer.Group.prototype,"getExtent",ol.layer.Group.prototype.getExtent);goog.exportProperty(ol.layer.Group.prototype,"getMaxResolution",ol.layer.Group.prototype.getMaxResolution);goog.exportProperty(ol.layer.Group.prototype,"getMinResolution",ol.layer.Group.prototype.getMinResolution);goog.exportProperty(ol.layer.Group.prototype,"getOpacity",ol.layer.Group.prototype.getOpacity);goog.exportProperty(ol.layer.Group.prototype,"getVisible",ol.layer.Group.prototype.getVisible);goog.exportProperty(ol.layer.Group.prototype,"getZIndex",ol.layer.Group.prototype.getZIndex);goog.exportProperty(ol.layer.Group.prototype,"setExtent",ol.layer.Group.prototype.setExtent);goog.exportProperty(ol.layer.Group.prototype,"setMaxResolution",ol.layer.Group.prototype.setMaxResolution);goog.exportProperty(ol.layer.Group.prototype,"setMinResolution",ol.layer.Group.prototype.setMinResolution);goog.exportProperty(ol.layer.Group.prototype,"setOpacity",ol.layer.Group.prototype.setOpacity);goog.exportProperty(ol.layer.Group.prototype,"setVisible",ol.layer.Group.prototype.setVisible);goog.exportProperty(ol.layer.Group.prototype,"setZIndex",ol.layer.Group.prototype.setZIndex);goog.exportProperty(ol.layer.Group.prototype,"get",ol.layer.Group.prototype.get);goog.exportProperty(ol.layer.Group.prototype,"getKeys",ol.layer.Group.prototype.getKeys);goog.exportProperty(ol.layer.Group.prototype,"getProperties",ol.layer.Group.prototype.getProperties);goog.exportProperty(ol.layer.Group.prototype,"set",ol.layer.Group.prototype.set);goog.exportProperty(ol.layer.Group.prototype,"setProperties",ol.layer.Group.prototype.setProperties);goog.exportProperty(ol.layer.Group.prototype,"unset",ol.layer.Group.prototype.unset);goog.exportProperty(ol.layer.Group.prototype,"changed",ol.layer.Group.prototype.changed);goog.exportProperty(ol.layer.Group.prototype,"dispatchEvent",ol.layer.Group.prototype.dispatchEvent);goog.exportProperty(ol.layer.Group.prototype,"getRevision",ol.layer.Group.prototype.getRevision);goog.exportProperty(ol.layer.Group.prototype,"on",ol.layer.Group.prototype.on);goog.exportProperty(ol.layer.Group.prototype,"once",ol.layer.Group.prototype.once);goog.exportProperty(ol.layer.Group.prototype,"un",ol.layer.Group.prototype.un);goog.exportProperty(ol.layer.Layer.prototype,"getExtent",ol.layer.Layer.prototype.getExtent);goog.exportProperty(ol.layer.Layer.prototype,"getMaxResolution",ol.layer.Layer.prototype.getMaxResolution);goog.exportProperty(ol.layer.Layer.prototype,"getMinResolution",ol.layer.Layer.prototype.getMinResolution);goog.exportProperty(ol.layer.Layer.prototype,"getOpacity",ol.layer.Layer.prototype.getOpacity);goog.exportProperty(ol.layer.Layer.prototype,"getVisible",ol.layer.Layer.prototype.getVisible);goog.exportProperty(ol.layer.Layer.prototype,"getZIndex",ol.layer.Layer.prototype.getZIndex);goog.exportProperty(ol.layer.Layer.prototype,"setExtent",ol.layer.Layer.prototype.setExtent);goog.exportProperty(ol.layer.Layer.prototype,"setMaxResolution",ol.layer.Layer.prototype.setMaxResolution);goog.exportProperty(ol.layer.Layer.prototype,"setMinResolution",ol.layer.Layer.prototype.setMinResolution);goog.exportProperty(ol.layer.Layer.prototype,"setOpacity",ol.layer.Layer.prototype.setOpacity);goog.exportProperty(ol.layer.Layer.prototype,"setVisible",ol.layer.Layer.prototype.setVisible);goog.exportProperty(ol.layer.Layer.prototype,"setZIndex",ol.layer.Layer.prototype.setZIndex);goog.exportProperty(ol.layer.Layer.prototype,"get",ol.layer.Layer.prototype.get);goog.exportProperty(ol.layer.Layer.prototype,"getKeys",ol.layer.Layer.prototype.getKeys);goog.exportProperty(ol.layer.Layer.prototype,"getProperties",ol.layer.Layer.prototype.getProperties);goog.exportProperty(ol.layer.Layer.prototype,"set",ol.layer.Layer.prototype.set);goog.exportProperty(ol.layer.Layer.prototype,"setProperties",ol.layer.Layer.prototype.setProperties);goog.exportProperty(ol.layer.Layer.prototype,"unset",ol.layer.Layer.prototype.unset);goog.exportProperty(ol.layer.Layer.prototype,"changed",ol.layer.Layer.prototype.changed);goog.exportProperty(ol.layer.Layer.prototype,"dispatchEvent",ol.layer.Layer.prototype.dispatchEvent);goog.exportProperty(ol.layer.Layer.prototype,"getRevision",ol.layer.Layer.prototype.getRevision);goog.exportProperty(ol.layer.Layer.prototype,"on",ol.layer.Layer.prototype.on);goog.exportProperty(ol.layer.Layer.prototype,"once",ol.layer.Layer.prototype.once);goog.exportProperty(ol.layer.Layer.prototype,"un",ol.layer.Layer.prototype.un);goog.exportProperty(ol.layer.Vector.prototype,"setMap",ol.layer.Vector.prototype.setMap);goog.exportProperty(ol.layer.Vector.prototype,"setSource",ol.layer.Vector.prototype.setSource);goog.exportProperty(ol.layer.Vector.prototype,"getExtent",ol.layer.Vector.prototype.getExtent);goog.exportProperty(ol.layer.Vector.prototype,"getMaxResolution",ol.layer.Vector.prototype.getMaxResolution);goog.exportProperty(ol.layer.Vector.prototype,"getMinResolution",ol.layer.Vector.prototype.getMinResolution);goog.exportProperty(ol.layer.Vector.prototype,"getOpacity",ol.layer.Vector.prototype.getOpacity);goog.exportProperty(ol.layer.Vector.prototype,"getVisible",ol.layer.Vector.prototype.getVisible);goog.exportProperty(ol.layer.Vector.prototype,"getZIndex",ol.layer.Vector.prototype.getZIndex);goog.exportProperty(ol.layer.Vector.prototype,"setExtent",ol.layer.Vector.prototype.setExtent);goog.exportProperty(ol.layer.Vector.prototype,"setMaxResolution",ol.layer.Vector.prototype.setMaxResolution);goog.exportProperty(ol.layer.Vector.prototype,"setMinResolution",ol.layer.Vector.prototype.setMinResolution);goog.exportProperty(ol.layer.Vector.prototype,"setOpacity",ol.layer.Vector.prototype.setOpacity);goog.exportProperty(ol.layer.Vector.prototype,"setVisible",ol.layer.Vector.prototype.setVisible);goog.exportProperty(ol.layer.Vector.prototype,"setZIndex",ol.layer.Vector.prototype.setZIndex);goog.exportProperty(ol.layer.Vector.prototype,"get",ol.layer.Vector.prototype.get);goog.exportProperty(ol.layer.Vector.prototype,"getKeys",ol.layer.Vector.prototype.getKeys);goog.exportProperty(ol.layer.Vector.prototype,"getProperties",ol.layer.Vector.prototype.getProperties);goog.exportProperty(ol.layer.Vector.prototype,"set",ol.layer.Vector.prototype.set);goog.exportProperty(ol.layer.Vector.prototype,"setProperties",ol.layer.Vector.prototype.setProperties);goog.exportProperty(ol.layer.Vector.prototype,"unset",ol.layer.Vector.prototype.unset);goog.exportProperty(ol.layer.Vector.prototype,"changed",ol.layer.Vector.prototype.changed);goog.exportProperty(ol.layer.Vector.prototype,"dispatchEvent",ol.layer.Vector.prototype.dispatchEvent);goog.exportProperty(ol.layer.Vector.prototype,"getRevision",ol.layer.Vector.prototype.getRevision);goog.exportProperty(ol.layer.Vector.prototype,"on",ol.layer.Vector.prototype.on);goog.exportProperty(ol.layer.Vector.prototype,"once",ol.layer.Vector.prototype.once);goog.exportProperty(ol.layer.Vector.prototype,"un",ol.layer.Vector.prototype.un);goog.exportProperty(ol.layer.Heatmap.prototype,"getSource",ol.layer.Heatmap.prototype.getSource);goog.exportProperty(ol.layer.Heatmap.prototype,"getStyle",ol.layer.Heatmap.prototype.getStyle);goog.exportProperty(ol.layer.Heatmap.prototype,"getStyleFunction",ol.layer.Heatmap.prototype.getStyleFunction);goog.exportProperty(ol.layer.Heatmap.prototype,"setStyle",ol.layer.Heatmap.prototype.setStyle);goog.exportProperty(ol.layer.Heatmap.prototype,"setMap",ol.layer.Heatmap.prototype.setMap);goog.exportProperty(ol.layer.Heatmap.prototype,"setSource",ol.layer.Heatmap.prototype.setSource);goog.exportProperty(ol.layer.Heatmap.prototype,"getExtent",ol.layer.Heatmap.prototype.getExtent);goog.exportProperty(ol.layer.Heatmap.prototype,"getMaxResolution",ol.layer.Heatmap.prototype.getMaxResolution);goog.exportProperty(ol.layer.Heatmap.prototype,"getMinResolution",ol.layer.Heatmap.prototype.getMinResolution);goog.exportProperty(ol.layer.Heatmap.prototype,"getOpacity",ol.layer.Heatmap.prototype.getOpacity);goog.exportProperty(ol.layer.Heatmap.prototype,"getVisible",ol.layer.Heatmap.prototype.getVisible);goog.exportProperty(ol.layer.Heatmap.prototype,"getZIndex",ol.layer.Heatmap.prototype.getZIndex);goog.exportProperty(ol.layer.Heatmap.prototype,"setExtent",ol.layer.Heatmap.prototype.setExtent);goog.exportProperty(ol.layer.Heatmap.prototype,"setMaxResolution",ol.layer.Heatmap.prototype.setMaxResolution);goog.exportProperty(ol.layer.Heatmap.prototype,"setMinResolution",ol.layer.Heatmap.prototype.setMinResolution);goog.exportProperty(ol.layer.Heatmap.prototype,"setOpacity",ol.layer.Heatmap.prototype.setOpacity);goog.exportProperty(ol.layer.Heatmap.prototype,"setVisible",ol.layer.Heatmap.prototype.setVisible);goog.exportProperty(ol.layer.Heatmap.prototype,"setZIndex",ol.layer.Heatmap.prototype.setZIndex);goog.exportProperty(ol.layer.Heatmap.prototype,"get",ol.layer.Heatmap.prototype.get);goog.exportProperty(ol.layer.Heatmap.prototype,"getKeys",ol.layer.Heatmap.prototype.getKeys);goog.exportProperty(ol.layer.Heatmap.prototype,"getProperties",ol.layer.Heatmap.prototype.getProperties);goog.exportProperty(ol.layer.Heatmap.prototype,"set",ol.layer.Heatmap.prototype.set);goog.exportProperty(ol.layer.Heatmap.prototype,"setProperties",ol.layer.Heatmap.prototype.setProperties);goog.exportProperty(ol.layer.Heatmap.prototype,"unset",ol.layer.Heatmap.prototype.unset);goog.exportProperty(ol.layer.Heatmap.prototype,"changed",ol.layer.Heatmap.prototype.changed);goog.exportProperty(ol.layer.Heatmap.prototype,"dispatchEvent",ol.layer.Heatmap.prototype.dispatchEvent);goog.exportProperty(ol.layer.Heatmap.prototype,"getRevision",ol.layer.Heatmap.prototype.getRevision);goog.exportProperty(ol.layer.Heatmap.prototype,"on",ol.layer.Heatmap.prototype.on);goog.exportProperty(ol.layer.Heatmap.prototype,"once",ol.layer.Heatmap.prototype.once);goog.exportProperty(ol.layer.Heatmap.prototype,"un",ol.layer.Heatmap.prototype.un);goog.exportProperty(ol.layer.Image.prototype,"setMap",ol.layer.Image.prototype.setMap);goog.exportProperty(ol.layer.Image.prototype,"setSource",ol.layer.Image.prototype.setSource);goog.exportProperty(ol.layer.Image.prototype,"getExtent",ol.layer.Image.prototype.getExtent);goog.exportProperty(ol.layer.Image.prototype,"getMaxResolution",ol.layer.Image.prototype.getMaxResolution);goog.exportProperty(ol.layer.Image.prototype,"getMinResolution",ol.layer.Image.prototype.getMinResolution);goog.exportProperty(ol.layer.Image.prototype,"getOpacity",ol.layer.Image.prototype.getOpacity);goog.exportProperty(ol.layer.Image.prototype,"getVisible",ol.layer.Image.prototype.getVisible);goog.exportProperty(ol.layer.Image.prototype,"getZIndex",ol.layer.Image.prototype.getZIndex);goog.exportProperty(ol.layer.Image.prototype,"setExtent",ol.layer.Image.prototype.setExtent);goog.exportProperty(ol.layer.Image.prototype,"setMaxResolution",ol.layer.Image.prototype.setMaxResolution);goog.exportProperty(ol.layer.Image.prototype,"setMinResolution",ol.layer.Image.prototype.setMinResolution);goog.exportProperty(ol.layer.Image.prototype,"setOpacity",ol.layer.Image.prototype.setOpacity);goog.exportProperty(ol.layer.Image.prototype,"setVisible",ol.layer.Image.prototype.setVisible);goog.exportProperty(ol.layer.Image.prototype,"setZIndex",ol.layer.Image.prototype.setZIndex);goog.exportProperty(ol.layer.Image.prototype,"get",ol.layer.Image.prototype.get);goog.exportProperty(ol.layer.Image.prototype,"getKeys",ol.layer.Image.prototype.getKeys);goog.exportProperty(ol.layer.Image.prototype,"getProperties",ol.layer.Image.prototype.getProperties);goog.exportProperty(ol.layer.Image.prototype,"set",ol.layer.Image.prototype.set);goog.exportProperty(ol.layer.Image.prototype,"setProperties",ol.layer.Image.prototype.setProperties);goog.exportProperty(ol.layer.Image.prototype,"unset",ol.layer.Image.prototype.unset);goog.exportProperty(ol.layer.Image.prototype,"changed",ol.layer.Image.prototype.changed);goog.exportProperty(ol.layer.Image.prototype,"dispatchEvent",ol.layer.Image.prototype.dispatchEvent);goog.exportProperty(ol.layer.Image.prototype,"getRevision",ol.layer.Image.prototype.getRevision);goog.exportProperty(ol.layer.Image.prototype,"on",ol.layer.Image.prototype.on);goog.exportProperty(ol.layer.Image.prototype,"once",ol.layer.Image.prototype.once);goog.exportProperty(ol.layer.Image.prototype,"un",ol.layer.Image.prototype.un);goog.exportProperty(ol.layer.Tile.prototype,"setMap",ol.layer.Tile.prototype.setMap);goog.exportProperty(ol.layer.Tile.prototype,"setSource",ol.layer.Tile.prototype.setSource);goog.exportProperty(ol.layer.Tile.prototype,"getExtent",ol.layer.Tile.prototype.getExtent);goog.exportProperty(ol.layer.Tile.prototype,"getMaxResolution",ol.layer.Tile.prototype.getMaxResolution);goog.exportProperty(ol.layer.Tile.prototype,"getMinResolution",ol.layer.Tile.prototype.getMinResolution);goog.exportProperty(ol.layer.Tile.prototype,"getOpacity",ol.layer.Tile.prototype.getOpacity);goog.exportProperty(ol.layer.Tile.prototype,"getVisible",ol.layer.Tile.prototype.getVisible);goog.exportProperty(ol.layer.Tile.prototype,"getZIndex",ol.layer.Tile.prototype.getZIndex);goog.exportProperty(ol.layer.Tile.prototype,"setExtent",ol.layer.Tile.prototype.setExtent);goog.exportProperty(ol.layer.Tile.prototype,"setMaxResolution",ol.layer.Tile.prototype.setMaxResolution);goog.exportProperty(ol.layer.Tile.prototype,"setMinResolution",ol.layer.Tile.prototype.setMinResolution);goog.exportProperty(ol.layer.Tile.prototype,"setOpacity",ol.layer.Tile.prototype.setOpacity);goog.exportProperty(ol.layer.Tile.prototype,"setVisible",ol.layer.Tile.prototype.setVisible);goog.exportProperty(ol.layer.Tile.prototype,"setZIndex",ol.layer.Tile.prototype.setZIndex);goog.exportProperty(ol.layer.Tile.prototype,"get",ol.layer.Tile.prototype.get);goog.exportProperty(ol.layer.Tile.prototype,"getKeys",ol.layer.Tile.prototype.getKeys);goog.exportProperty(ol.layer.Tile.prototype,"getProperties",ol.layer.Tile.prototype.getProperties);goog.exportProperty(ol.layer.Tile.prototype,"set",ol.layer.Tile.prototype.set);goog.exportProperty(ol.layer.Tile.prototype,"setProperties",ol.layer.Tile.prototype.setProperties);goog.exportProperty(ol.layer.Tile.prototype,"unset",ol.layer.Tile.prototype.unset);goog.exportProperty(ol.layer.Tile.prototype,"changed",ol.layer.Tile.prototype.changed);goog.exportProperty(ol.layer.Tile.prototype,"dispatchEvent",ol.layer.Tile.prototype.dispatchEvent);goog.exportProperty(ol.layer.Tile.prototype,"getRevision",ol.layer.Tile.prototype.getRevision);goog.exportProperty(ol.layer.Tile.prototype,"on",ol.layer.Tile.prototype.on);goog.exportProperty(ol.layer.Tile.prototype,"once",ol.layer.Tile.prototype.once);goog.exportProperty(ol.layer.Tile.prototype,"un",ol.layer.Tile.prototype.un);goog.exportProperty(ol.layer.VectorTile.prototype,"getStyle",ol.layer.VectorTile.prototype.getStyle);goog.exportProperty(ol.layer.VectorTile.prototype,"getStyleFunction",ol.layer.VectorTile.prototype.getStyleFunction);goog.exportProperty(ol.layer.VectorTile.prototype,"setStyle",ol.layer.VectorTile.prototype.setStyle);goog.exportProperty(ol.layer.VectorTile.prototype,"setMap",ol.layer.VectorTile.prototype.setMap);goog.exportProperty(ol.layer.VectorTile.prototype,"setSource",ol.layer.VectorTile.prototype.setSource);goog.exportProperty(ol.layer.VectorTile.prototype,"getExtent",ol.layer.VectorTile.prototype.getExtent);goog.exportProperty(ol.layer.VectorTile.prototype,"getMaxResolution",ol.layer.VectorTile.prototype.getMaxResolution);goog.exportProperty(ol.layer.VectorTile.prototype,"getMinResolution",ol.layer.VectorTile.prototype.getMinResolution);goog.exportProperty(ol.layer.VectorTile.prototype,"getOpacity",ol.layer.VectorTile.prototype.getOpacity);goog.exportProperty(ol.layer.VectorTile.prototype,"getVisible",ol.layer.VectorTile.prototype.getVisible);goog.exportProperty(ol.layer.VectorTile.prototype,"getZIndex",ol.layer.VectorTile.prototype.getZIndex);goog.exportProperty(ol.layer.VectorTile.prototype,"setExtent",ol.layer.VectorTile.prototype.setExtent);goog.exportProperty(ol.layer.VectorTile.prototype,"setMaxResolution",ol.layer.VectorTile.prototype.setMaxResolution);goog.exportProperty(ol.layer.VectorTile.prototype,"setMinResolution",ol.layer.VectorTile.prototype.setMinResolution);goog.exportProperty(ol.layer.VectorTile.prototype,"setOpacity",ol.layer.VectorTile.prototype.setOpacity);goog.exportProperty(ol.layer.VectorTile.prototype,"setVisible",ol.layer.VectorTile.prototype.setVisible);goog.exportProperty(ol.layer.VectorTile.prototype,"setZIndex",ol.layer.VectorTile.prototype.setZIndex);goog.exportProperty(ol.layer.VectorTile.prototype,"get",ol.layer.VectorTile.prototype.get);goog.exportProperty(ol.layer.VectorTile.prototype,"getKeys",ol.layer.VectorTile.prototype.getKeys);goog.exportProperty(ol.layer.VectorTile.prototype,"getProperties",ol.layer.VectorTile.prototype.getProperties);goog.exportProperty(ol.layer.VectorTile.prototype,"set",ol.layer.VectorTile.prototype.set);goog.exportProperty(ol.layer.VectorTile.prototype,"setProperties",ol.layer.VectorTile.prototype.setProperties);goog.exportProperty(ol.layer.VectorTile.prototype,"unset",ol.layer.VectorTile.prototype.unset);goog.exportProperty(ol.layer.VectorTile.prototype,"changed",ol.layer.VectorTile.prototype.changed);goog.exportProperty(ol.layer.VectorTile.prototype,"dispatchEvent",ol.layer.VectorTile.prototype.dispatchEvent);goog.exportProperty(ol.layer.VectorTile.prototype,"getRevision",ol.layer.VectorTile.prototype.getRevision);goog.exportProperty(ol.layer.VectorTile.prototype,"on",ol.layer.VectorTile.prototype.on);goog.exportProperty(ol.layer.VectorTile.prototype,"once",ol.layer.VectorTile.prototype.once);goog.exportProperty(ol.layer.VectorTile.prototype,"un",ol.layer.VectorTile.prototype.un);goog.exportProperty(ol.interaction.Interaction.prototype,"get",ol.interaction.Interaction.prototype.get);goog.exportProperty(ol.interaction.Interaction.prototype,"getKeys",ol.interaction.Interaction.prototype.getKeys);goog.exportProperty(ol.interaction.Interaction.prototype,"getProperties",ol.interaction.Interaction.prototype.getProperties);goog.exportProperty(ol.interaction.Interaction.prototype,"set",ol.interaction.Interaction.prototype.set);goog.exportProperty(ol.interaction.Interaction.prototype,"setProperties",ol.interaction.Interaction.prototype.setProperties);goog.exportProperty(ol.interaction.Interaction.prototype,"unset",ol.interaction.Interaction.prototype.unset);goog.exportProperty(ol.interaction.Interaction.prototype,"changed",ol.interaction.Interaction.prototype.changed);goog.exportProperty(ol.interaction.Interaction.prototype,"dispatchEvent",ol.interaction.Interaction.prototype.dispatchEvent);goog.exportProperty(ol.interaction.Interaction.prototype,"getRevision",ol.interaction.Interaction.prototype.getRevision);goog.exportProperty(ol.interaction.Interaction.prototype,"on",ol.interaction.Interaction.prototype.on);goog.exportProperty(ol.interaction.Interaction.prototype,"once",ol.interaction.Interaction.prototype.once);goog.exportProperty(ol.interaction.Interaction.prototype,"un",ol.interaction.Interaction.prototype.un);goog.exportProperty(ol.interaction.DoubleClickZoom.prototype,"getActive",ol.interaction.DoubleClickZoom.prototype.getActive);goog.exportProperty(ol.interaction.DoubleClickZoom.prototype,"getMap",ol.interaction.DoubleClickZoom.prototype.getMap);goog.exportProperty(ol.interaction.DoubleClickZoom.prototype,"setActive",ol.interaction.DoubleClickZoom.prototype.setActive);goog.exportProperty(ol.interaction.DoubleClickZoom.prototype,"get",ol.interaction.DoubleClickZoom.prototype.get);goog.exportProperty(ol.interaction.DoubleClickZoom.prototype,"getKeys",ol.interaction.DoubleClickZoom.prototype.getKeys);goog.exportProperty(ol.interaction.DoubleClickZoom.prototype,"getProperties",ol.interaction.DoubleClickZoom.prototype.getProperties);goog.exportProperty(ol.interaction.DoubleClickZoom.prototype,"set",ol.interaction.DoubleClickZoom.prototype.set);goog.exportProperty(ol.interaction.DoubleClickZoom.prototype,"setProperties",ol.interaction.DoubleClickZoom.prototype.setProperties);goog.exportProperty(ol.interaction.DoubleClickZoom.prototype,"unset",ol.interaction.DoubleClickZoom.prototype.unset);goog.exportProperty(ol.interaction.DoubleClickZoom.prototype,"changed",ol.interaction.DoubleClickZoom.prototype.changed);goog.exportProperty(ol.interaction.DoubleClickZoom.prototype,"dispatchEvent",ol.interaction.DoubleClickZoom.prototype.dispatchEvent);goog.exportProperty(ol.interaction.DoubleClickZoom.prototype,"getRevision",ol.interaction.DoubleClickZoom.prototype.getRevision);goog.exportProperty(ol.interaction.DoubleClickZoom.prototype,"on",ol.interaction.DoubleClickZoom.prototype.on);goog.exportProperty(ol.interaction.DoubleClickZoom.prototype,"once",ol.interaction.DoubleClickZoom.prototype.once);goog.exportProperty(ol.interaction.DoubleClickZoom.prototype,"un",ol.interaction.DoubleClickZoom.prototype.un);goog.exportProperty(ol.interaction.DragAndDrop.prototype,"getActive",ol.interaction.DragAndDrop.prototype.getActive);goog.exportProperty(ol.interaction.DragAndDrop.prototype,"getMap",ol.interaction.DragAndDrop.prototype.getMap);goog.exportProperty(ol.interaction.DragAndDrop.prototype,"setActive",ol.interaction.DragAndDrop.prototype.setActive);goog.exportProperty(ol.interaction.DragAndDrop.prototype,"get",ol.interaction.DragAndDrop.prototype.get);goog.exportProperty(ol.interaction.DragAndDrop.prototype,"getKeys",ol.interaction.DragAndDrop.prototype.getKeys);goog.exportProperty(ol.interaction.DragAndDrop.prototype,"getProperties",ol.interaction.DragAndDrop.prototype.getProperties);goog.exportProperty(ol.interaction.DragAndDrop.prototype,"set",ol.interaction.DragAndDrop.prototype.set);goog.exportProperty(ol.interaction.DragAndDrop.prototype,"setProperties",ol.interaction.DragAndDrop.prototype.setProperties);goog.exportProperty(ol.interaction.DragAndDrop.prototype,"unset",ol.interaction.DragAndDrop.prototype.unset);goog.exportProperty(ol.interaction.DragAndDrop.prototype,"changed",ol.interaction.DragAndDrop.prototype.changed);goog.exportProperty(ol.interaction.DragAndDrop.prototype,"dispatchEvent",ol.interaction.DragAndDrop.prototype.dispatchEvent);goog.exportProperty(ol.interaction.DragAndDrop.prototype,"getRevision",ol.interaction.DragAndDrop.prototype.getRevision);goog.exportProperty(ol.interaction.DragAndDrop.prototype,"on",ol.interaction.DragAndDrop.prototype.on);goog.exportProperty(ol.interaction.DragAndDrop.prototype,"once",ol.interaction.DragAndDrop.prototype.once);goog.exportProperty(ol.interaction.DragAndDrop.prototype,"un",ol.interaction.DragAndDrop.prototype.un);goog.exportProperty(ol.interaction.DragAndDrop.Event.prototype,"type",ol.interaction.DragAndDrop.Event.prototype.type);goog.exportProperty(ol.interaction.DragAndDrop.Event.prototype,"target",ol.interaction.DragAndDrop.Event.prototype.target);goog.exportProperty(ol.interaction.DragAndDrop.Event.prototype,"preventDefault",ol.interaction.DragAndDrop.Event.prototype.preventDefault);goog.exportProperty(ol.interaction.DragAndDrop.Event.prototype,"stopPropagation",ol.interaction.DragAndDrop.Event.prototype.stopPropagation);goog.exportProperty(ol.interaction.Pointer.prototype,"getActive",ol.interaction.Pointer.prototype.getActive);goog.exportProperty(ol.interaction.Pointer.prototype,"getMap",ol.interaction.Pointer.prototype.getMap);goog.exportProperty(ol.interaction.Pointer.prototype,"setActive",ol.interaction.Pointer.prototype.setActive);goog.exportProperty(ol.interaction.Pointer.prototype,"get",ol.interaction.Pointer.prototype.get);goog.exportProperty(ol.interaction.Pointer.prototype,"getKeys",ol.interaction.Pointer.prototype.getKeys);goog.exportProperty(ol.interaction.Pointer.prototype,"getProperties",ol.interaction.Pointer.prototype.getProperties);goog.exportProperty(ol.interaction.Pointer.prototype,"set",ol.interaction.Pointer.prototype.set);goog.exportProperty(ol.interaction.Pointer.prototype,"setProperties",ol.interaction.Pointer.prototype.setProperties);goog.exportProperty(ol.interaction.Pointer.prototype,"unset",ol.interaction.Pointer.prototype.unset);goog.exportProperty(ol.interaction.Pointer.prototype,"changed",ol.interaction.Pointer.prototype.changed);goog.exportProperty(ol.interaction.Pointer.prototype,"dispatchEvent",ol.interaction.Pointer.prototype.dispatchEvent);goog.exportProperty(ol.interaction.Pointer.prototype,"getRevision",ol.interaction.Pointer.prototype.getRevision);goog.exportProperty(ol.interaction.Pointer.prototype,"on",ol.interaction.Pointer.prototype.on);goog.exportProperty(ol.interaction.Pointer.prototype,"once",ol.interaction.Pointer.prototype.once);goog.exportProperty(ol.interaction.Pointer.prototype,"un",ol.interaction.Pointer.prototype.un);goog.exportProperty(ol.interaction.DragBox.prototype,"getActive",ol.interaction.DragBox.prototype.getActive);goog.exportProperty(ol.interaction.DragBox.prototype,"getMap",ol.interaction.DragBox.prototype.getMap);goog.exportProperty(ol.interaction.DragBox.prototype,"setActive",ol.interaction.DragBox.prototype.setActive);goog.exportProperty(ol.interaction.DragBox.prototype,"get",ol.interaction.DragBox.prototype.get);goog.exportProperty(ol.interaction.DragBox.prototype,"getKeys",ol.interaction.DragBox.prototype.getKeys);goog.exportProperty(ol.interaction.DragBox.prototype,"getProperties",ol.interaction.DragBox.prototype.getProperties);goog.exportProperty(ol.interaction.DragBox.prototype,"set",ol.interaction.DragBox.prototype.set);goog.exportProperty(ol.interaction.DragBox.prototype,"setProperties",ol.interaction.DragBox.prototype.setProperties);goog.exportProperty(ol.interaction.DragBox.prototype,"unset",ol.interaction.DragBox.prototype.unset);goog.exportProperty(ol.interaction.DragBox.prototype,"changed",ol.interaction.DragBox.prototype.changed);goog.exportProperty(ol.interaction.DragBox.prototype,"dispatchEvent",ol.interaction.DragBox.prototype.dispatchEvent);goog.exportProperty(ol.interaction.DragBox.prototype,"getRevision",ol.interaction.DragBox.prototype.getRevision);goog.exportProperty(ol.interaction.DragBox.prototype,"on",ol.interaction.DragBox.prototype.on);goog.exportProperty(ol.interaction.DragBox.prototype,"once",ol.interaction.DragBox.prototype.once);goog.exportProperty(ol.interaction.DragBox.prototype,"un",ol.interaction.DragBox.prototype.un);goog.exportProperty(ol.interaction.DragBox.Event.prototype,"type",ol.interaction.DragBox.Event.prototype.type);goog.exportProperty(ol.interaction.DragBox.Event.prototype,"target",ol.interaction.DragBox.Event.prototype.target);goog.exportProperty(ol.interaction.DragBox.Event.prototype,"preventDefault",ol.interaction.DragBox.Event.prototype.preventDefault);goog.exportProperty(ol.interaction.DragBox.Event.prototype,"stopPropagation",ol.interaction.DragBox.Event.prototype.stopPropagation);goog.exportProperty(ol.interaction.DragPan.prototype,"getActive",ol.interaction.DragPan.prototype.getActive);goog.exportProperty(ol.interaction.DragPan.prototype,"getMap",ol.interaction.DragPan.prototype.getMap);goog.exportProperty(ol.interaction.DragPan.prototype,"setActive",ol.interaction.DragPan.prototype.setActive);goog.exportProperty(ol.interaction.DragPan.prototype,"get",ol.interaction.DragPan.prototype.get);goog.exportProperty(ol.interaction.DragPan.prototype,"getKeys",ol.interaction.DragPan.prototype.getKeys);goog.exportProperty(ol.interaction.DragPan.prototype,"getProperties",ol.interaction.DragPan.prototype.getProperties);goog.exportProperty(ol.interaction.DragPan.prototype,"set",ol.interaction.DragPan.prototype.set);goog.exportProperty(ol.interaction.DragPan.prototype,"setProperties",ol.interaction.DragPan.prototype.setProperties);goog.exportProperty(ol.interaction.DragPan.prototype,"unset",ol.interaction.DragPan.prototype.unset);goog.exportProperty(ol.interaction.DragPan.prototype,"changed",ol.interaction.DragPan.prototype.changed);goog.exportProperty(ol.interaction.DragPan.prototype,"dispatchEvent",ol.interaction.DragPan.prototype.dispatchEvent);goog.exportProperty(ol.interaction.DragPan.prototype,"getRevision",ol.interaction.DragPan.prototype.getRevision);goog.exportProperty(ol.interaction.DragPan.prototype,"on",ol.interaction.DragPan.prototype.on);goog.exportProperty(ol.interaction.DragPan.prototype,"once",ol.interaction.DragPan.prototype.once);goog.exportProperty(ol.interaction.DragPan.prototype,"un",ol.interaction.DragPan.prototype.un);goog.exportProperty(ol.interaction.DragRotate.prototype,"getActive",ol.interaction.DragRotate.prototype.getActive);goog.exportProperty(ol.interaction.DragRotate.prototype,"getMap",ol.interaction.DragRotate.prototype.getMap);goog.exportProperty(ol.interaction.DragRotate.prototype,"setActive",ol.interaction.DragRotate.prototype.setActive);goog.exportProperty(ol.interaction.DragRotate.prototype,"get",ol.interaction.DragRotate.prototype.get);goog.exportProperty(ol.interaction.DragRotate.prototype,"getKeys",ol.interaction.DragRotate.prototype.getKeys);goog.exportProperty(ol.interaction.DragRotate.prototype,"getProperties",ol.interaction.DragRotate.prototype.getProperties);goog.exportProperty(ol.interaction.DragRotate.prototype,"set",ol.interaction.DragRotate.prototype.set);goog.exportProperty(ol.interaction.DragRotate.prototype,"setProperties",ol.interaction.DragRotate.prototype.setProperties);goog.exportProperty(ol.interaction.DragRotate.prototype,"unset",ol.interaction.DragRotate.prototype.unset);goog.exportProperty(ol.interaction.DragRotate.prototype,"changed",ol.interaction.DragRotate.prototype.changed);goog.exportProperty(ol.interaction.DragRotate.prototype,"dispatchEvent",ol.interaction.DragRotate.prototype.dispatchEvent);goog.exportProperty(ol.interaction.DragRotate.prototype,"getRevision",ol.interaction.DragRotate.prototype.getRevision);goog.exportProperty(ol.interaction.DragRotate.prototype,"on",ol.interaction.DragRotate.prototype.on);goog.exportProperty(ol.interaction.DragRotate.prototype,"once",ol.interaction.DragRotate.prototype.once);goog.exportProperty(ol.interaction.DragRotate.prototype,"un",ol.interaction.DragRotate.prototype.un);goog.exportProperty(ol.interaction.DragRotateAndZoom.prototype,"getActive",ol.interaction.DragRotateAndZoom.prototype.getActive);goog.exportProperty(ol.interaction.DragRotateAndZoom.prototype,"getMap",ol.interaction.DragRotateAndZoom.prototype.getMap);goog.exportProperty(ol.interaction.DragRotateAndZoom.prototype,"setActive",ol.interaction.DragRotateAndZoom.prototype.setActive);goog.exportProperty(ol.interaction.DragRotateAndZoom.prototype,"get",ol.interaction.DragRotateAndZoom.prototype.get);goog.exportProperty(ol.interaction.DragRotateAndZoom.prototype,"getKeys",ol.interaction.DragRotateAndZoom.prototype.getKeys);goog.exportProperty(ol.interaction.DragRotateAndZoom.prototype,"getProperties",ol.interaction.DragRotateAndZoom.prototype.getProperties);goog.exportProperty(ol.interaction.DragRotateAndZoom.prototype,"set",ol.interaction.DragRotateAndZoom.prototype.set);goog.exportProperty(ol.interaction.DragRotateAndZoom.prototype,"setProperties",ol.interaction.DragRotateAndZoom.prototype.setProperties);goog.exportProperty(ol.interaction.DragRotateAndZoom.prototype,"unset",ol.interaction.DragRotateAndZoom.prototype.unset);goog.exportProperty(ol.interaction.DragRotateAndZoom.prototype,"changed",ol.interaction.DragRotateAndZoom.prototype.changed);goog.exportProperty(ol.interaction.DragRotateAndZoom.prototype,"dispatchEvent",ol.interaction.DragRotateAndZoom.prototype.dispatchEvent);goog.exportProperty(ol.interaction.DragRotateAndZoom.prototype,"getRevision",ol.interaction.DragRotateAndZoom.prototype.getRevision);goog.exportProperty(ol.interaction.DragRotateAndZoom.prototype,"on",ol.interaction.DragRotateAndZoom.prototype.on);goog.exportProperty(ol.interaction.DragRotateAndZoom.prototype,"once",ol.interaction.DragRotateAndZoom.prototype.once);goog.exportProperty(ol.interaction.DragRotateAndZoom.prototype,"un",ol.interaction.DragRotateAndZoom.prototype.un);goog.exportProperty(ol.interaction.DragZoom.prototype,"getGeometry",ol.interaction.DragZoom.prototype.getGeometry);goog.exportProperty(ol.interaction.DragZoom.prototype,"getActive",ol.interaction.DragZoom.prototype.getActive);goog.exportProperty(ol.interaction.DragZoom.prototype,"getMap",ol.interaction.DragZoom.prototype.getMap);goog.exportProperty(ol.interaction.DragZoom.prototype,"setActive",ol.interaction.DragZoom.prototype.setActive);goog.exportProperty(ol.interaction.DragZoom.prototype,"get",ol.interaction.DragZoom.prototype.get);goog.exportProperty(ol.interaction.DragZoom.prototype,"getKeys",ol.interaction.DragZoom.prototype.getKeys);goog.exportProperty(ol.interaction.DragZoom.prototype,"getProperties",ol.interaction.DragZoom.prototype.getProperties);goog.exportProperty(ol.interaction.DragZoom.prototype,"set",ol.interaction.DragZoom.prototype.set);goog.exportProperty(ol.interaction.DragZoom.prototype,"setProperties",ol.interaction.DragZoom.prototype.setProperties);goog.exportProperty(ol.interaction.DragZoom.prototype,"unset",ol.interaction.DragZoom.prototype.unset);goog.exportProperty(ol.interaction.DragZoom.prototype,"changed",ol.interaction.DragZoom.prototype.changed);goog.exportProperty(ol.interaction.DragZoom.prototype,"dispatchEvent",ol.interaction.DragZoom.prototype.dispatchEvent);goog.exportProperty(ol.interaction.DragZoom.prototype,"getRevision",ol.interaction.DragZoom.prototype.getRevision);goog.exportProperty(ol.interaction.DragZoom.prototype,"on",ol.interaction.DragZoom.prototype.on);goog.exportProperty(ol.interaction.DragZoom.prototype,"once",ol.interaction.DragZoom.prototype.once);goog.exportProperty(ol.interaction.DragZoom.prototype,"un",ol.interaction.DragZoom.prototype.un);goog.exportProperty(ol.interaction.Draw.prototype,"getActive",ol.interaction.Draw.prototype.getActive);goog.exportProperty(ol.interaction.Draw.prototype,"getMap",ol.interaction.Draw.prototype.getMap);goog.exportProperty(ol.interaction.Draw.prototype,"setActive",ol.interaction.Draw.prototype.setActive);goog.exportProperty(ol.interaction.Draw.prototype,"get",ol.interaction.Draw.prototype.get);goog.exportProperty(ol.interaction.Draw.prototype,"getKeys",ol.interaction.Draw.prototype.getKeys);goog.exportProperty(ol.interaction.Draw.prototype,"getProperties",ol.interaction.Draw.prototype.getProperties);goog.exportProperty(ol.interaction.Draw.prototype,"set",ol.interaction.Draw.prototype.set);goog.exportProperty(ol.interaction.Draw.prototype,"setProperties",ol.interaction.Draw.prototype.setProperties);goog.exportProperty(ol.interaction.Draw.prototype,"unset",ol.interaction.Draw.prototype.unset);goog.exportProperty(ol.interaction.Draw.prototype,"changed",ol.interaction.Draw.prototype.changed);goog.exportProperty(ol.interaction.Draw.prototype,"dispatchEvent",ol.interaction.Draw.prototype.dispatchEvent);goog.exportProperty(ol.interaction.Draw.prototype,"getRevision",ol.interaction.Draw.prototype.getRevision);goog.exportProperty(ol.interaction.Draw.prototype,"on",ol.interaction.Draw.prototype.on);goog.exportProperty(ol.interaction.Draw.prototype,"once",ol.interaction.Draw.prototype.once);goog.exportProperty(ol.interaction.Draw.prototype,"un",ol.interaction.Draw.prototype.un);goog.exportProperty(ol.interaction.Draw.Event.prototype,"type",ol.interaction.Draw.Event.prototype.type);goog.exportProperty(ol.interaction.Draw.Event.prototype,"target",ol.interaction.Draw.Event.prototype.target);goog.exportProperty(ol.interaction.Draw.Event.prototype,"preventDefault",ol.interaction.Draw.Event.prototype.preventDefault);goog.exportProperty(ol.interaction.Draw.Event.prototype,"stopPropagation",ol.interaction.Draw.Event.prototype.stopPropagation);goog.exportProperty(ol.interaction.Extent.prototype,"getActive",ol.interaction.Extent.prototype.getActive);goog.exportProperty(ol.interaction.Extent.prototype,"getMap",ol.interaction.Extent.prototype.getMap);goog.exportProperty(ol.interaction.Extent.prototype,"setActive",ol.interaction.Extent.prototype.setActive);goog.exportProperty(ol.interaction.Extent.prototype,"get",ol.interaction.Extent.prototype.get);goog.exportProperty(ol.interaction.Extent.prototype,"getKeys",ol.interaction.Extent.prototype.getKeys);goog.exportProperty(ol.interaction.Extent.prototype,"getProperties",ol.interaction.Extent.prototype.getProperties);goog.exportProperty(ol.interaction.Extent.prototype,"set",ol.interaction.Extent.prototype.set);goog.exportProperty(ol.interaction.Extent.prototype,"setProperties",ol.interaction.Extent.prototype.setProperties);goog.exportProperty(ol.interaction.Extent.prototype,"unset",ol.interaction.Extent.prototype.unset);goog.exportProperty(ol.interaction.Extent.prototype,"changed",ol.interaction.Extent.prototype.changed);goog.exportProperty(ol.interaction.Extent.prototype,"dispatchEvent",ol.interaction.Extent.prototype.dispatchEvent);goog.exportProperty(ol.interaction.Extent.prototype,"getRevision",ol.interaction.Extent.prototype.getRevision);goog.exportProperty(ol.interaction.Extent.prototype,"on",ol.interaction.Extent.prototype.on);goog.exportProperty(ol.interaction.Extent.prototype,"once",ol.interaction.Extent.prototype.once);goog.exportProperty(ol.interaction.Extent.prototype,"un",ol.interaction.Extent.prototype.un);goog.exportProperty(ol.interaction.Extent.Event.prototype,"type",ol.interaction.Extent.Event.prototype.type);goog.exportProperty(ol.interaction.Extent.Event.prototype,"target",ol.interaction.Extent.Event.prototype.target);goog.exportProperty(ol.interaction.Extent.Event.prototype,"preventDefault",ol.interaction.Extent.Event.prototype.preventDefault);goog.exportProperty(ol.interaction.Extent.Event.prototype,"stopPropagation",ol.interaction.Extent.Event.prototype.stopPropagation);goog.exportProperty(ol.interaction.KeyboardPan.prototype,"getActive",ol.interaction.KeyboardPan.prototype.getActive);goog.exportProperty(ol.interaction.KeyboardPan.prototype,"getMap",ol.interaction.KeyboardPan.prototype.getMap);goog.exportProperty(ol.interaction.KeyboardPan.prototype,"setActive",ol.interaction.KeyboardPan.prototype.setActive);goog.exportProperty(ol.interaction.KeyboardPan.prototype,"get",ol.interaction.KeyboardPan.prototype.get);goog.exportProperty(ol.interaction.KeyboardPan.prototype,"getKeys",ol.interaction.KeyboardPan.prototype.getKeys);goog.exportProperty(ol.interaction.KeyboardPan.prototype,"getProperties",ol.interaction.KeyboardPan.prototype.getProperties);goog.exportProperty(ol.interaction.KeyboardPan.prototype,"set",ol.interaction.KeyboardPan.prototype.set);goog.exportProperty(ol.interaction.KeyboardPan.prototype,"setProperties",ol.interaction.KeyboardPan.prototype.setProperties);goog.exportProperty(ol.interaction.KeyboardPan.prototype,"unset",ol.interaction.KeyboardPan.prototype.unset);goog.exportProperty(ol.interaction.KeyboardPan.prototype,"changed",ol.interaction.KeyboardPan.prototype.changed);goog.exportProperty(ol.interaction.KeyboardPan.prototype,"dispatchEvent",ol.interaction.KeyboardPan.prototype.dispatchEvent);goog.exportProperty(ol.interaction.KeyboardPan.prototype,"getRevision",ol.interaction.KeyboardPan.prototype.getRevision);goog.exportProperty(ol.interaction.KeyboardPan.prototype,"on",ol.interaction.KeyboardPan.prototype.on);goog.exportProperty(ol.interaction.KeyboardPan.prototype,"once",ol.interaction.KeyboardPan.prototype.once);goog.exportProperty(ol.interaction.KeyboardPan.prototype,"un",ol.interaction.KeyboardPan.prototype.un);goog.exportProperty(ol.interaction.KeyboardZoom.prototype,"getActive",ol.interaction.KeyboardZoom.prototype.getActive);goog.exportProperty(ol.interaction.KeyboardZoom.prototype,"getMap",ol.interaction.KeyboardZoom.prototype.getMap);goog.exportProperty(ol.interaction.KeyboardZoom.prototype,"setActive",ol.interaction.KeyboardZoom.prototype.setActive);goog.exportProperty(ol.interaction.KeyboardZoom.prototype,"get",ol.interaction.KeyboardZoom.prototype.get);goog.exportProperty(ol.interaction.KeyboardZoom.prototype,"getKeys",ol.interaction.KeyboardZoom.prototype.getKeys);goog.exportProperty(ol.interaction.KeyboardZoom.prototype,"getProperties",ol.interaction.KeyboardZoom.prototype.getProperties);goog.exportProperty(ol.interaction.KeyboardZoom.prototype,"set",ol.interaction.KeyboardZoom.prototype.set);goog.exportProperty(ol.interaction.KeyboardZoom.prototype,"setProperties",ol.interaction.KeyboardZoom.prototype.setProperties);goog.exportProperty(ol.interaction.KeyboardZoom.prototype,"unset",ol.interaction.KeyboardZoom.prototype.unset);goog.exportProperty(ol.interaction.KeyboardZoom.prototype,"changed",ol.interaction.KeyboardZoom.prototype.changed);goog.exportProperty(ol.interaction.KeyboardZoom.prototype,"dispatchEvent",ol.interaction.KeyboardZoom.prototype.dispatchEvent);goog.exportProperty(ol.interaction.KeyboardZoom.prototype,"getRevision",ol.interaction.KeyboardZoom.prototype.getRevision);goog.exportProperty(ol.interaction.KeyboardZoom.prototype,"on",ol.interaction.KeyboardZoom.prototype.on);goog.exportProperty(ol.interaction.KeyboardZoom.prototype,"once",ol.interaction.KeyboardZoom.prototype.once);goog.exportProperty(ol.interaction.KeyboardZoom.prototype,"un",ol.interaction.KeyboardZoom.prototype.un);goog.exportProperty(ol.interaction.Modify.prototype,"getActive",ol.interaction.Modify.prototype.getActive);goog.exportProperty(ol.interaction.Modify.prototype,"getMap",ol.interaction.Modify.prototype.getMap);goog.exportProperty(ol.interaction.Modify.prototype,"setActive",ol.interaction.Modify.prototype.setActive);goog.exportProperty(ol.interaction.Modify.prototype,"get",ol.interaction.Modify.prototype.get);goog.exportProperty(ol.interaction.Modify.prototype,"getKeys",ol.interaction.Modify.prototype.getKeys);goog.exportProperty(ol.interaction.Modify.prototype,"getProperties",ol.interaction.Modify.prototype.getProperties);goog.exportProperty(ol.interaction.Modify.prototype,"set",ol.interaction.Modify.prototype.set);goog.exportProperty(ol.interaction.Modify.prototype,"setProperties",ol.interaction.Modify.prototype.setProperties);goog.exportProperty(ol.interaction.Modify.prototype,"unset",ol.interaction.Modify.prototype.unset);goog.exportProperty(ol.interaction.Modify.prototype,"changed",ol.interaction.Modify.prototype.changed);goog.exportProperty(ol.interaction.Modify.prototype,"dispatchEvent",ol.interaction.Modify.prototype.dispatchEvent);goog.exportProperty(ol.interaction.Modify.prototype,"getRevision",ol.interaction.Modify.prototype.getRevision);goog.exportProperty(ol.interaction.Modify.prototype,"on",ol.interaction.Modify.prototype.on);goog.exportProperty(ol.interaction.Modify.prototype,"once",ol.interaction.Modify.prototype.once);goog.exportProperty(ol.interaction.Modify.prototype,"un",ol.interaction.Modify.prototype.un);goog.exportProperty(ol.interaction.Modify.Event.prototype,"type",ol.interaction.Modify.Event.prototype.type);goog.exportProperty(ol.interaction.Modify.Event.prototype,"target",ol.interaction.Modify.Event.prototype.target);goog.exportProperty(ol.interaction.Modify.Event.prototype,"preventDefault",ol.interaction.Modify.Event.prototype.preventDefault);goog.exportProperty(ol.interaction.Modify.Event.prototype,"stopPropagation",ol.interaction.Modify.Event.prototype.stopPropagation);goog.exportProperty(ol.interaction.MouseWheelZoom.prototype,"getActive",ol.interaction.MouseWheelZoom.prototype.getActive);goog.exportProperty(ol.interaction.MouseWheelZoom.prototype,"getMap",ol.interaction.MouseWheelZoom.prototype.getMap);goog.exportProperty(ol.interaction.MouseWheelZoom.prototype,"setActive",ol.interaction.MouseWheelZoom.prototype.setActive);goog.exportProperty(ol.interaction.MouseWheelZoom.prototype,"get",ol.interaction.MouseWheelZoom.prototype.get);goog.exportProperty(ol.interaction.MouseWheelZoom.prototype,"getKeys",ol.interaction.MouseWheelZoom.prototype.getKeys);goog.exportProperty(ol.interaction.MouseWheelZoom.prototype,"getProperties",ol.interaction.MouseWheelZoom.prototype.getProperties);goog.exportProperty(ol.interaction.MouseWheelZoom.prototype,"set",ol.interaction.MouseWheelZoom.prototype.set);goog.exportProperty(ol.interaction.MouseWheelZoom.prototype,"setProperties",ol.interaction.MouseWheelZoom.prototype.setProperties);goog.exportProperty(ol.interaction.MouseWheelZoom.prototype,"unset",ol.interaction.MouseWheelZoom.prototype.unset);goog.exportProperty(ol.interaction.MouseWheelZoom.prototype,"changed",ol.interaction.MouseWheelZoom.prototype.changed);goog.exportProperty(ol.interaction.MouseWheelZoom.prototype,"dispatchEvent",ol.interaction.MouseWheelZoom.prototype.dispatchEvent);goog.exportProperty(ol.interaction.MouseWheelZoom.prototype,"getRevision",ol.interaction.MouseWheelZoom.prototype.getRevision);goog.exportProperty(ol.interaction.MouseWheelZoom.prototype,"on",ol.interaction.MouseWheelZoom.prototype.on);goog.exportProperty(ol.interaction.MouseWheelZoom.prototype,"once",ol.interaction.MouseWheelZoom.prototype.once);goog.exportProperty(ol.interaction.MouseWheelZoom.prototype,"un",ol.interaction.MouseWheelZoom.prototype.un);goog.exportProperty(ol.interaction.PinchRotate.prototype,"getActive",ol.interaction.PinchRotate.prototype.getActive);goog.exportProperty(ol.interaction.PinchRotate.prototype,"getMap",ol.interaction.PinchRotate.prototype.getMap);goog.exportProperty(ol.interaction.PinchRotate.prototype,"setActive",ol.interaction.PinchRotate.prototype.setActive);goog.exportProperty(ol.interaction.PinchRotate.prototype,"get",ol.interaction.PinchRotate.prototype.get);goog.exportProperty(ol.interaction.PinchRotate.prototype,"getKeys",ol.interaction.PinchRotate.prototype.getKeys);goog.exportProperty(ol.interaction.PinchRotate.prototype,"getProperties",ol.interaction.PinchRotate.prototype.getProperties);goog.exportProperty(ol.interaction.PinchRotate.prototype,"set",ol.interaction.PinchRotate.prototype.set);goog.exportProperty(ol.interaction.PinchRotate.prototype,"setProperties",ol.interaction.PinchRotate.prototype.setProperties);goog.exportProperty(ol.interaction.PinchRotate.prototype,"unset",ol.interaction.PinchRotate.prototype.unset);goog.exportProperty(ol.interaction.PinchRotate.prototype,"changed",ol.interaction.PinchRotate.prototype.changed);goog.exportProperty(ol.interaction.PinchRotate.prototype,"dispatchEvent",ol.interaction.PinchRotate.prototype.dispatchEvent);goog.exportProperty(ol.interaction.PinchRotate.prototype,"getRevision",ol.interaction.PinchRotate.prototype.getRevision);goog.exportProperty(ol.interaction.PinchRotate.prototype,"on",ol.interaction.PinchRotate.prototype.on);goog.exportProperty(ol.interaction.PinchRotate.prototype,"once",ol.interaction.PinchRotate.prototype.once);goog.exportProperty(ol.interaction.PinchRotate.prototype,"un",ol.interaction.PinchRotate.prototype.un);goog.exportProperty(ol.interaction.PinchZoom.prototype,"getActive",ol.interaction.PinchZoom.prototype.getActive);goog.exportProperty(ol.interaction.PinchZoom.prototype,"getMap",ol.interaction.PinchZoom.prototype.getMap);goog.exportProperty(ol.interaction.PinchZoom.prototype,"setActive",ol.interaction.PinchZoom.prototype.setActive);goog.exportProperty(ol.interaction.PinchZoom.prototype,"get",ol.interaction.PinchZoom.prototype.get);goog.exportProperty(ol.interaction.PinchZoom.prototype,"getKeys",ol.interaction.PinchZoom.prototype.getKeys);goog.exportProperty(ol.interaction.PinchZoom.prototype,"getProperties",ol.interaction.PinchZoom.prototype.getProperties);goog.exportProperty(ol.interaction.PinchZoom.prototype,"set",ol.interaction.PinchZoom.prototype.set);goog.exportProperty(ol.interaction.PinchZoom.prototype,"setProperties",ol.interaction.PinchZoom.prototype.setProperties);goog.exportProperty(ol.interaction.PinchZoom.prototype,"unset",ol.interaction.PinchZoom.prototype.unset);goog.exportProperty(ol.interaction.PinchZoom.prototype,"changed",ol.interaction.PinchZoom.prototype.changed);goog.exportProperty(ol.interaction.PinchZoom.prototype,"dispatchEvent",ol.interaction.PinchZoom.prototype.dispatchEvent);goog.exportProperty(ol.interaction.PinchZoom.prototype,"getRevision",ol.interaction.PinchZoom.prototype.getRevision);goog.exportProperty(ol.interaction.PinchZoom.prototype,"on",ol.interaction.PinchZoom.prototype.on);goog.exportProperty(ol.interaction.PinchZoom.prototype,"once",ol.interaction.PinchZoom.prototype.once);goog.exportProperty(ol.interaction.PinchZoom.prototype,"un",ol.interaction.PinchZoom.prototype.un);goog.exportProperty(ol.interaction.Select.prototype,"getActive",ol.interaction.Select.prototype.getActive);goog.exportProperty(ol.interaction.Select.prototype,"getMap",ol.interaction.Select.prototype.getMap);goog.exportProperty(ol.interaction.Select.prototype,"setActive",ol.interaction.Select.prototype.setActive);goog.exportProperty(ol.interaction.Select.prototype,"get",ol.interaction.Select.prototype.get);goog.exportProperty(ol.interaction.Select.prototype,"getKeys",ol.interaction.Select.prototype.getKeys);goog.exportProperty(ol.interaction.Select.prototype,"getProperties",ol.interaction.Select.prototype.getProperties);goog.exportProperty(ol.interaction.Select.prototype,"set",ol.interaction.Select.prototype.set);goog.exportProperty(ol.interaction.Select.prototype,"setProperties",ol.interaction.Select.prototype.setProperties);goog.exportProperty(ol.interaction.Select.prototype,"unset",ol.interaction.Select.prototype.unset);goog.exportProperty(ol.interaction.Select.prototype,"changed",ol.interaction.Select.prototype.changed);goog.exportProperty(ol.interaction.Select.prototype,"dispatchEvent",ol.interaction.Select.prototype.dispatchEvent);goog.exportProperty(ol.interaction.Select.prototype,"getRevision",ol.interaction.Select.prototype.getRevision);goog.exportProperty(ol.interaction.Select.prototype,"on",ol.interaction.Select.prototype.on);goog.exportProperty(ol.interaction.Select.prototype,"once",ol.interaction.Select.prototype.once);goog.exportProperty(ol.interaction.Select.prototype,"un",ol.interaction.Select.prototype.un);goog.exportProperty(ol.interaction.Select.Event.prototype,"type",ol.interaction.Select.Event.prototype.type);goog.exportProperty(ol.interaction.Select.Event.prototype,"target",ol.interaction.Select.Event.prototype.target);goog.exportProperty(ol.interaction.Select.Event.prototype,"preventDefault",ol.interaction.Select.Event.prototype.preventDefault);goog.exportProperty(ol.interaction.Select.Event.prototype,"stopPropagation",ol.interaction.Select.Event.prototype.stopPropagation);goog.exportProperty(ol.interaction.Snap.prototype,"getActive",ol.interaction.Snap.prototype.getActive);goog.exportProperty(ol.interaction.Snap.prototype,"getMap",ol.interaction.Snap.prototype.getMap);goog.exportProperty(ol.interaction.Snap.prototype,"setActive",ol.interaction.Snap.prototype.setActive);goog.exportProperty(ol.interaction.Snap.prototype,"get",ol.interaction.Snap.prototype.get);goog.exportProperty(ol.interaction.Snap.prototype,"getKeys",ol.interaction.Snap.prototype.getKeys);goog.exportProperty(ol.interaction.Snap.prototype,"getProperties",ol.interaction.Snap.prototype.getProperties);goog.exportProperty(ol.interaction.Snap.prototype,"set",ol.interaction.Snap.prototype.set);goog.exportProperty(ol.interaction.Snap.prototype,"setProperties",ol.interaction.Snap.prototype.setProperties);goog.exportProperty(ol.interaction.Snap.prototype,"unset",ol.interaction.Snap.prototype.unset);goog.exportProperty(ol.interaction.Snap.prototype,"changed",ol.interaction.Snap.prototype.changed);goog.exportProperty(ol.interaction.Snap.prototype,"dispatchEvent",ol.interaction.Snap.prototype.dispatchEvent);goog.exportProperty(ol.interaction.Snap.prototype,"getRevision",ol.interaction.Snap.prototype.getRevision);goog.exportProperty(ol.interaction.Snap.prototype,"on",ol.interaction.Snap.prototype.on);goog.exportProperty(ol.interaction.Snap.prototype,"once",ol.interaction.Snap.prototype.once);goog.exportProperty(ol.interaction.Snap.prototype,"un",ol.interaction.Snap.prototype.un);goog.exportProperty(ol.interaction.Translate.prototype,"getActive",ol.interaction.Translate.prototype.getActive);goog.exportProperty(ol.interaction.Translate.prototype,"getMap",ol.interaction.Translate.prototype.getMap);goog.exportProperty(ol.interaction.Translate.prototype,"setActive",ol.interaction.Translate.prototype.setActive);goog.exportProperty(ol.interaction.Translate.prototype,"get",ol.interaction.Translate.prototype.get);goog.exportProperty(ol.interaction.Translate.prototype,"getKeys",ol.interaction.Translate.prototype.getKeys);goog.exportProperty(ol.interaction.Translate.prototype,"getProperties",ol.interaction.Translate.prototype.getProperties);goog.exportProperty(ol.interaction.Translate.prototype,"set",ol.interaction.Translate.prototype.set);goog.exportProperty(ol.interaction.Translate.prototype,"setProperties",ol.interaction.Translate.prototype.setProperties);goog.exportProperty(ol.interaction.Translate.prototype,"unset",ol.interaction.Translate.prototype.unset);goog.exportProperty(ol.interaction.Translate.prototype,"changed",ol.interaction.Translate.prototype.changed);goog.exportProperty(ol.interaction.Translate.prototype,"dispatchEvent",ol.interaction.Translate.prototype.dispatchEvent);goog.exportProperty(ol.interaction.Translate.prototype,"getRevision",ol.interaction.Translate.prototype.getRevision);goog.exportProperty(ol.interaction.Translate.prototype,"on",ol.interaction.Translate.prototype.on);goog.exportProperty(ol.interaction.Translate.prototype,"once",ol.interaction.Translate.prototype.once);goog.exportProperty(ol.interaction.Translate.prototype,"un",ol.interaction.Translate.prototype.un);goog.exportProperty(ol.interaction.Translate.Event.prototype,"type",ol.interaction.Translate.Event.prototype.type);goog.exportProperty(ol.interaction.Translate.Event.prototype,"target",ol.interaction.Translate.Event.prototype.target);goog.exportProperty(ol.interaction.Translate.Event.prototype,"preventDefault",ol.interaction.Translate.Event.prototype.preventDefault);goog.exportProperty(ol.interaction.Translate.Event.prototype,"stopPropagation",ol.interaction.Translate.Event.prototype.stopPropagation);goog.exportProperty(ol.geom.Geometry.prototype,"get",ol.geom.Geometry.prototype.get);goog.exportProperty(ol.geom.Geometry.prototype,"getKeys",ol.geom.Geometry.prototype.getKeys);goog.exportProperty(ol.geom.Geometry.prototype,"getProperties",ol.geom.Geometry.prototype.getProperties);goog.exportProperty(ol.geom.Geometry.prototype,"set",ol.geom.Geometry.prototype.set);goog.exportProperty(ol.geom.Geometry.prototype,"setProperties",ol.geom.Geometry.prototype.setProperties);goog.exportProperty(ol.geom.Geometry.prototype,"unset",ol.geom.Geometry.prototype.unset);goog.exportProperty(ol.geom.Geometry.prototype,"changed",ol.geom.Geometry.prototype.changed);goog.exportProperty(ol.geom.Geometry.prototype,"dispatchEvent",ol.geom.Geometry.prototype.dispatchEvent);goog.exportProperty(ol.geom.Geometry.prototype,"getRevision",ol.geom.Geometry.prototype.getRevision);goog.exportProperty(ol.geom.Geometry.prototype,"on",ol.geom.Geometry.prototype.on);goog.exportProperty(ol.geom.Geometry.prototype,"once",ol.geom.Geometry.prototype.once);goog.exportProperty(ol.geom.Geometry.prototype,"un",ol.geom.Geometry.prototype.un);goog.exportProperty(ol.geom.SimpleGeometry.prototype,"getClosestPoint",ol.geom.SimpleGeometry.prototype.getClosestPoint);goog.exportProperty(ol.geom.SimpleGeometry.prototype,"intersectsCoordinate",ol.geom.SimpleGeometry.prototype.intersectsCoordinate);goog.exportProperty(ol.geom.SimpleGeometry.prototype,"getExtent",ol.geom.SimpleGeometry.prototype.getExtent);goog.exportProperty(ol.geom.SimpleGeometry.prototype,"rotate",ol.geom.SimpleGeometry.prototype.rotate);goog.exportProperty(ol.geom.SimpleGeometry.prototype,"scale",ol.geom.SimpleGeometry.prototype.scale);goog.exportProperty(ol.geom.SimpleGeometry.prototype,"simplify",ol.geom.SimpleGeometry.prototype.simplify);goog.exportProperty(ol.geom.SimpleGeometry.prototype,"transform",ol.geom.SimpleGeometry.prototype.transform);goog.exportProperty(ol.geom.SimpleGeometry.prototype,"get",ol.geom.SimpleGeometry.prototype.get);goog.exportProperty(ol.geom.SimpleGeometry.prototype,"getKeys",ol.geom.SimpleGeometry.prototype.getKeys);goog.exportProperty(ol.geom.SimpleGeometry.prototype,"getProperties",ol.geom.SimpleGeometry.prototype.getProperties);goog.exportProperty(ol.geom.SimpleGeometry.prototype,"set",ol.geom.SimpleGeometry.prototype.set);goog.exportProperty(ol.geom.SimpleGeometry.prototype,"setProperties",ol.geom.SimpleGeometry.prototype.setProperties);goog.exportProperty(ol.geom.SimpleGeometry.prototype,"unset",ol.geom.SimpleGeometry.prototype.unset);goog.exportProperty(ol.geom.SimpleGeometry.prototype,"changed",ol.geom.SimpleGeometry.prototype.changed);goog.exportProperty(ol.geom.SimpleGeometry.prototype,"dispatchEvent",ol.geom.SimpleGeometry.prototype.dispatchEvent);goog.exportProperty(ol.geom.SimpleGeometry.prototype,"getRevision",ol.geom.SimpleGeometry.prototype.getRevision);goog.exportProperty(ol.geom.SimpleGeometry.prototype,"on",ol.geom.SimpleGeometry.prototype.on);goog.exportProperty(ol.geom.SimpleGeometry.prototype,"once",ol.geom.SimpleGeometry.prototype.once);goog.exportProperty(ol.geom.SimpleGeometry.prototype,"un",ol.geom.SimpleGeometry.prototype.un);goog.exportProperty(ol.geom.Circle.prototype,"getFirstCoordinate",ol.geom.Circle.prototype.getFirstCoordinate);goog.exportProperty(ol.geom.Circle.prototype,"getLastCoordinate",ol.geom.Circle.prototype.getLastCoordinate);goog.exportProperty(ol.geom.Circle.prototype,"getLayout",ol.geom.Circle.prototype.getLayout);goog.exportProperty(ol.geom.Circle.prototype,"rotate",ol.geom.Circle.prototype.rotate);goog.exportProperty(ol.geom.Circle.prototype,"scale",ol.geom.Circle.prototype.scale);goog.exportProperty(ol.geom.Circle.prototype,"getClosestPoint",ol.geom.Circle.prototype.getClosestPoint);goog.exportProperty(ol.geom.Circle.prototype,"intersectsCoordinate",ol.geom.Circle.prototype.intersectsCoordinate);goog.exportProperty(ol.geom.Circle.prototype,"getExtent",ol.geom.Circle.prototype.getExtent);goog.exportProperty(ol.geom.Circle.prototype,"simplify",ol.geom.Circle.prototype.simplify);goog.exportProperty(ol.geom.Circle.prototype,"get",ol.geom.Circle.prototype.get);goog.exportProperty(ol.geom.Circle.prototype,"getKeys",ol.geom.Circle.prototype.getKeys);goog.exportProperty(ol.geom.Circle.prototype,"getProperties",ol.geom.Circle.prototype.getProperties);goog.exportProperty(ol.geom.Circle.prototype,"set",ol.geom.Circle.prototype.set);goog.exportProperty(ol.geom.Circle.prototype,"setProperties",ol.geom.Circle.prototype.setProperties);goog.exportProperty(ol.geom.Circle.prototype,"unset",ol.geom.Circle.prototype.unset);goog.exportProperty(ol.geom.Circle.prototype,"changed",ol.geom.Circle.prototype.changed);goog.exportProperty(ol.geom.Circle.prototype,"dispatchEvent",ol.geom.Circle.prototype.dispatchEvent);goog.exportProperty(ol.geom.Circle.prototype,"getRevision",ol.geom.Circle.prototype.getRevision);goog.exportProperty(ol.geom.Circle.prototype,"on",ol.geom.Circle.prototype.on);goog.exportProperty(ol.geom.Circle.prototype,"once",ol.geom.Circle.prototype.once);goog.exportProperty(ol.geom.Circle.prototype,"un",ol.geom.Circle.prototype.un);goog.exportProperty(ol.geom.GeometryCollection.prototype,"getClosestPoint",ol.geom.GeometryCollection.prototype.getClosestPoint);goog.exportProperty(ol.geom.GeometryCollection.prototype,"intersectsCoordinate",ol.geom.GeometryCollection.prototype.intersectsCoordinate);goog.exportProperty(ol.geom.GeometryCollection.prototype,"getExtent",ol.geom.GeometryCollection.prototype.getExtent);goog.exportProperty(ol.geom.GeometryCollection.prototype,"rotate",ol.geom.GeometryCollection.prototype.rotate);goog.exportProperty(ol.geom.GeometryCollection.prototype,"scale",ol.geom.GeometryCollection.prototype.scale);goog.exportProperty(ol.geom.GeometryCollection.prototype,"simplify",ol.geom.GeometryCollection.prototype.simplify);goog.exportProperty(ol.geom.GeometryCollection.prototype,"transform",ol.geom.GeometryCollection.prototype.transform);goog.exportProperty(ol.geom.GeometryCollection.prototype,"get",ol.geom.GeometryCollection.prototype.get);goog.exportProperty(ol.geom.GeometryCollection.prototype,"getKeys",ol.geom.GeometryCollection.prototype.getKeys);goog.exportProperty(ol.geom.GeometryCollection.prototype,"getProperties",ol.geom.GeometryCollection.prototype.getProperties);goog.exportProperty(ol.geom.GeometryCollection.prototype,"set",ol.geom.GeometryCollection.prototype.set);goog.exportProperty(ol.geom.GeometryCollection.prototype,"setProperties",ol.geom.GeometryCollection.prototype.setProperties);goog.exportProperty(ol.geom.GeometryCollection.prototype,"unset",ol.geom.GeometryCollection.prototype.unset);goog.exportProperty(ol.geom.GeometryCollection.prototype,"changed",ol.geom.GeometryCollection.prototype.changed);goog.exportProperty(ol.geom.GeometryCollection.prototype,"dispatchEvent",ol.geom.GeometryCollection.prototype.dispatchEvent);goog.exportProperty(ol.geom.GeometryCollection.prototype,"getRevision",ol.geom.GeometryCollection.prototype.getRevision);goog.exportProperty(ol.geom.GeometryCollection.prototype,"on",ol.geom.GeometryCollection.prototype.on);goog.exportProperty(ol.geom.GeometryCollection.prototype,"once",ol.geom.GeometryCollection.prototype.once);goog.exportProperty(ol.geom.GeometryCollection.prototype,"un",ol.geom.GeometryCollection.prototype.un);goog.exportProperty(ol.geom.LinearRing.prototype,"getFirstCoordinate",ol.geom.LinearRing.prototype.getFirstCoordinate);goog.exportProperty(ol.geom.LinearRing.prototype,"getLastCoordinate",ol.geom.LinearRing.prototype.getLastCoordinate);goog.exportProperty(ol.geom.LinearRing.prototype,"getLayout",ol.geom.LinearRing.prototype.getLayout);goog.exportProperty(ol.geom.LinearRing.prototype,"rotate",ol.geom.LinearRing.prototype.rotate);goog.exportProperty(ol.geom.LinearRing.prototype,"scale",ol.geom.LinearRing.prototype.scale);goog.exportProperty(ol.geom.LinearRing.prototype,"getClosestPoint",ol.geom.LinearRing.prototype.getClosestPoint);goog.exportProperty(ol.geom.LinearRing.prototype,"intersectsCoordinate",ol.geom.LinearRing.prototype.intersectsCoordinate);goog.exportProperty(ol.geom.LinearRing.prototype,"getExtent",ol.geom.LinearRing.prototype.getExtent);goog.exportProperty(ol.geom.LinearRing.prototype,"simplify",ol.geom.LinearRing.prototype.simplify);goog.exportProperty(ol.geom.LinearRing.prototype,"transform",ol.geom.LinearRing.prototype.transform);goog.exportProperty(ol.geom.LinearRing.prototype,"get",ol.geom.LinearRing.prototype.get);goog.exportProperty(ol.geom.LinearRing.prototype,"getKeys",ol.geom.LinearRing.prototype.getKeys);goog.exportProperty(ol.geom.LinearRing.prototype,"getProperties",ol.geom.LinearRing.prototype.getProperties);goog.exportProperty(ol.geom.LinearRing.prototype,"set",ol.geom.LinearRing.prototype.set);goog.exportProperty(ol.geom.LinearRing.prototype,"setProperties",ol.geom.LinearRing.prototype.setProperties);goog.exportProperty(ol.geom.LinearRing.prototype,"unset",ol.geom.LinearRing.prototype.unset);goog.exportProperty(ol.geom.LinearRing.prototype,"changed",ol.geom.LinearRing.prototype.changed);goog.exportProperty(ol.geom.LinearRing.prototype,"dispatchEvent",ol.geom.LinearRing.prototype.dispatchEvent);goog.exportProperty(ol.geom.LinearRing.prototype,"getRevision",ol.geom.LinearRing.prototype.getRevision);goog.exportProperty(ol.geom.LinearRing.prototype,"on",ol.geom.LinearRing.prototype.on);goog.exportProperty(ol.geom.LinearRing.prototype,"once",ol.geom.LinearRing.prototype.once);goog.exportProperty(ol.geom.LinearRing.prototype,"un",ol.geom.LinearRing.prototype.un);goog.exportProperty(ol.geom.LineString.prototype,"getFirstCoordinate",ol.geom.LineString.prototype.getFirstCoordinate);goog.exportProperty(ol.geom.LineString.prototype,"getLastCoordinate",ol.geom.LineString.prototype.getLastCoordinate);goog.exportProperty(ol.geom.LineString.prototype,"getLayout",ol.geom.LineString.prototype.getLayout);goog.exportProperty(ol.geom.LineString.prototype,"rotate",ol.geom.LineString.prototype.rotate);goog.exportProperty(ol.geom.LineString.prototype,"scale",ol.geom.LineString.prototype.scale);goog.exportProperty(ol.geom.LineString.prototype,"getClosestPoint",ol.geom.LineString.prototype.getClosestPoint);goog.exportProperty(ol.geom.LineString.prototype,"intersectsCoordinate",ol.geom.LineString.prototype.intersectsCoordinate);goog.exportProperty(ol.geom.LineString.prototype,"getExtent",ol.geom.LineString.prototype.getExtent);goog.exportProperty(ol.geom.LineString.prototype,"simplify",ol.geom.LineString.prototype.simplify);goog.exportProperty(ol.geom.LineString.prototype,"transform",ol.geom.LineString.prototype.transform);goog.exportProperty(ol.geom.LineString.prototype,"get",ol.geom.LineString.prototype.get);goog.exportProperty(ol.geom.LineString.prototype,"getKeys",ol.geom.LineString.prototype.getKeys);goog.exportProperty(ol.geom.LineString.prototype,"getProperties",ol.geom.LineString.prototype.getProperties);goog.exportProperty(ol.geom.LineString.prototype,"set",ol.geom.LineString.prototype.set);goog.exportProperty(ol.geom.LineString.prototype,"setProperties",ol.geom.LineString.prototype.setProperties);goog.exportProperty(ol.geom.LineString.prototype,"unset",ol.geom.LineString.prototype.unset);goog.exportProperty(ol.geom.LineString.prototype,"changed",ol.geom.LineString.prototype.changed);goog.exportProperty(ol.geom.LineString.prototype,"dispatchEvent",ol.geom.LineString.prototype.dispatchEvent);goog.exportProperty(ol.geom.LineString.prototype,"getRevision",ol.geom.LineString.prototype.getRevision);goog.exportProperty(ol.geom.LineString.prototype,"on",ol.geom.LineString.prototype.on);goog.exportProperty(ol.geom.LineString.prototype,"once",ol.geom.LineString.prototype.once);goog.exportProperty(ol.geom.LineString.prototype,"un",ol.geom.LineString.prototype.un);goog.exportProperty(ol.geom.MultiLineString.prototype,"getFirstCoordinate",ol.geom.MultiLineString.prototype.getFirstCoordinate);goog.exportProperty(ol.geom.MultiLineString.prototype,"getLastCoordinate",ol.geom.MultiLineString.prototype.getLastCoordinate);goog.exportProperty(ol.geom.MultiLineString.prototype,"getLayout",ol.geom.MultiLineString.prototype.getLayout);goog.exportProperty(ol.geom.MultiLineString.prototype,"rotate",ol.geom.MultiLineString.prototype.rotate);goog.exportProperty(ol.geom.MultiLineString.prototype,"scale",ol.geom.MultiLineString.prototype.scale);goog.exportProperty(ol.geom.MultiLineString.prototype,"getClosestPoint",ol.geom.MultiLineString.prototype.getClosestPoint);goog.exportProperty(ol.geom.MultiLineString.prototype,"intersectsCoordinate",ol.geom.MultiLineString.prototype.intersectsCoordinate);goog.exportProperty(ol.geom.MultiLineString.prototype,"getExtent",ol.geom.MultiLineString.prototype.getExtent);goog.exportProperty(ol.geom.MultiLineString.prototype,"simplify",ol.geom.MultiLineString.prototype.simplify);goog.exportProperty(ol.geom.MultiLineString.prototype,"transform",ol.geom.MultiLineString.prototype.transform);goog.exportProperty(ol.geom.MultiLineString.prototype,"get",ol.geom.MultiLineString.prototype.get);goog.exportProperty(ol.geom.MultiLineString.prototype,"getKeys",ol.geom.MultiLineString.prototype.getKeys);goog.exportProperty(ol.geom.MultiLineString.prototype,"getProperties",ol.geom.MultiLineString.prototype.getProperties);goog.exportProperty(ol.geom.MultiLineString.prototype,"set",ol.geom.MultiLineString.prototype.set);goog.exportProperty(ol.geom.MultiLineString.prototype,"setProperties",ol.geom.MultiLineString.prototype.setProperties);goog.exportProperty(ol.geom.MultiLineString.prototype,"unset",ol.geom.MultiLineString.prototype.unset);goog.exportProperty(ol.geom.MultiLineString.prototype,"changed",ol.geom.MultiLineString.prototype.changed);goog.exportProperty(ol.geom.MultiLineString.prototype,"dispatchEvent",ol.geom.MultiLineString.prototype.dispatchEvent);goog.exportProperty(ol.geom.MultiLineString.prototype,"getRevision",ol.geom.MultiLineString.prototype.getRevision);goog.exportProperty(ol.geom.MultiLineString.prototype,"on",ol.geom.MultiLineString.prototype.on);goog.exportProperty(ol.geom.MultiLineString.prototype,"once",ol.geom.MultiLineString.prototype.once);goog.exportProperty(ol.geom.MultiLineString.prototype,"un",ol.geom.MultiLineString.prototype.un);goog.exportProperty(ol.geom.MultiPoint.prototype,"getFirstCoordinate",ol.geom.MultiPoint.prototype.getFirstCoordinate);goog.exportProperty(ol.geom.MultiPoint.prototype,"getLastCoordinate",ol.geom.MultiPoint.prototype.getLastCoordinate);goog.exportProperty(ol.geom.MultiPoint.prototype,"getLayout",ol.geom.MultiPoint.prototype.getLayout);goog.exportProperty(ol.geom.MultiPoint.prototype,"rotate",ol.geom.MultiPoint.prototype.rotate);goog.exportProperty(ol.geom.MultiPoint.prototype,"scale",ol.geom.MultiPoint.prototype.scale);goog.exportProperty(ol.geom.MultiPoint.prototype,"getClosestPoint",ol.geom.MultiPoint.prototype.getClosestPoint);goog.exportProperty(ol.geom.MultiPoint.prototype,"intersectsCoordinate",ol.geom.MultiPoint.prototype.intersectsCoordinate);goog.exportProperty(ol.geom.MultiPoint.prototype,"getExtent",ol.geom.MultiPoint.prototype.getExtent);goog.exportProperty(ol.geom.MultiPoint.prototype,"simplify",ol.geom.MultiPoint.prototype.simplify);goog.exportProperty(ol.geom.MultiPoint.prototype,"transform",ol.geom.MultiPoint.prototype.transform);goog.exportProperty(ol.geom.MultiPoint.prototype,"get",ol.geom.MultiPoint.prototype.get);goog.exportProperty(ol.geom.MultiPoint.prototype,"getKeys",ol.geom.MultiPoint.prototype.getKeys);goog.exportProperty(ol.geom.MultiPoint.prototype,"getProperties",ol.geom.MultiPoint.prototype.getProperties);goog.exportProperty(ol.geom.MultiPoint.prototype,"set",ol.geom.MultiPoint.prototype.set);goog.exportProperty(ol.geom.MultiPoint.prototype,"setProperties",ol.geom.MultiPoint.prototype.setProperties);goog.exportProperty(ol.geom.MultiPoint.prototype,"unset",ol.geom.MultiPoint.prototype.unset);goog.exportProperty(ol.geom.MultiPoint.prototype,"changed",ol.geom.MultiPoint.prototype.changed);goog.exportProperty(ol.geom.MultiPoint.prototype,"dispatchEvent",ol.geom.MultiPoint.prototype.dispatchEvent);goog.exportProperty(ol.geom.MultiPoint.prototype,"getRevision",ol.geom.MultiPoint.prototype.getRevision);goog.exportProperty(ol.geom.MultiPoint.prototype,"on",ol.geom.MultiPoint.prototype.on);goog.exportProperty(ol.geom.MultiPoint.prototype,"once",ol.geom.MultiPoint.prototype.once);goog.exportProperty(ol.geom.MultiPoint.prototype,"un",ol.geom.MultiPoint.prototype.un);goog.exportProperty(ol.geom.MultiPolygon.prototype,"getFirstCoordinate",ol.geom.MultiPolygon.prototype.getFirstCoordinate);goog.exportProperty(ol.geom.MultiPolygon.prototype,"getLastCoordinate",ol.geom.MultiPolygon.prototype.getLastCoordinate);goog.exportProperty(ol.geom.MultiPolygon.prototype,"getLayout",ol.geom.MultiPolygon.prototype.getLayout);goog.exportProperty(ol.geom.MultiPolygon.prototype,"rotate",ol.geom.MultiPolygon.prototype.rotate);goog.exportProperty(ol.geom.MultiPolygon.prototype,"scale",ol.geom.MultiPolygon.prototype.scale);goog.exportProperty(ol.geom.MultiPolygon.prototype,"getClosestPoint",ol.geom.MultiPolygon.prototype.getClosestPoint);goog.exportProperty(ol.geom.MultiPolygon.prototype,"intersectsCoordinate",ol.geom.MultiPolygon.prototype.intersectsCoordinate);goog.exportProperty(ol.geom.MultiPolygon.prototype,"getExtent",ol.geom.MultiPolygon.prototype.getExtent);goog.exportProperty(ol.geom.MultiPolygon.prototype,"simplify",ol.geom.MultiPolygon.prototype.simplify);goog.exportProperty(ol.geom.MultiPolygon.prototype,"transform",ol.geom.MultiPolygon.prototype.transform);goog.exportProperty(ol.geom.MultiPolygon.prototype,"get",ol.geom.MultiPolygon.prototype.get);goog.exportProperty(ol.geom.MultiPolygon.prototype,"getKeys",ol.geom.MultiPolygon.prototype.getKeys);goog.exportProperty(ol.geom.MultiPolygon.prototype,"getProperties",ol.geom.MultiPolygon.prototype.getProperties);goog.exportProperty(ol.geom.MultiPolygon.prototype,"set",ol.geom.MultiPolygon.prototype.set);goog.exportProperty(ol.geom.MultiPolygon.prototype,"setProperties",ol.geom.MultiPolygon.prototype.setProperties);goog.exportProperty(ol.geom.MultiPolygon.prototype,"unset",ol.geom.MultiPolygon.prototype.unset);goog.exportProperty(ol.geom.MultiPolygon.prototype,"changed",ol.geom.MultiPolygon.prototype.changed);goog.exportProperty(ol.geom.MultiPolygon.prototype,"dispatchEvent",ol.geom.MultiPolygon.prototype.dispatchEvent);goog.exportProperty(ol.geom.MultiPolygon.prototype,"getRevision",ol.geom.MultiPolygon.prototype.getRevision);goog.exportProperty(ol.geom.MultiPolygon.prototype,"on",ol.geom.MultiPolygon.prototype.on);goog.exportProperty(ol.geom.MultiPolygon.prototype,"once",ol.geom.MultiPolygon.prototype.once);goog.exportProperty(ol.geom.MultiPolygon.prototype,"un",ol.geom.MultiPolygon.prototype.un);goog.exportProperty(ol.geom.Point.prototype,"getFirstCoordinate",ol.geom.Point.prototype.getFirstCoordinate);goog.exportProperty(ol.geom.Point.prototype,"getLastCoordinate",ol.geom.Point.prototype.getLastCoordinate);goog.exportProperty(ol.geom.Point.prototype,"getLayout",ol.geom.Point.prototype.getLayout);goog.exportProperty(ol.geom.Point.prototype,"rotate",ol.geom.Point.prototype.rotate);goog.exportProperty(ol.geom.Point.prototype,"scale",ol.geom.Point.prototype.scale);goog.exportProperty(ol.geom.Point.prototype,"getClosestPoint",ol.geom.Point.prototype.getClosestPoint);goog.exportProperty(ol.geom.Point.prototype,"intersectsCoordinate",ol.geom.Point.prototype.intersectsCoordinate);goog.exportProperty(ol.geom.Point.prototype,"getExtent",ol.geom.Point.prototype.getExtent);goog.exportProperty(ol.geom.Point.prototype,"simplify",ol.geom.Point.prototype.simplify);goog.exportProperty(ol.geom.Point.prototype,"transform",ol.geom.Point.prototype.transform);goog.exportProperty(ol.geom.Point.prototype,"get",ol.geom.Point.prototype.get);goog.exportProperty(ol.geom.Point.prototype,"getKeys",ol.geom.Point.prototype.getKeys);goog.exportProperty(ol.geom.Point.prototype,"getProperties",ol.geom.Point.prototype.getProperties);goog.exportProperty(ol.geom.Point.prototype,"set",ol.geom.Point.prototype.set);goog.exportProperty(ol.geom.Point.prototype,"setProperties",ol.geom.Point.prototype.setProperties);goog.exportProperty(ol.geom.Point.prototype,"unset",ol.geom.Point.prototype.unset);goog.exportProperty(ol.geom.Point.prototype,"changed",ol.geom.Point.prototype.changed);goog.exportProperty(ol.geom.Point.prototype,"dispatchEvent",ol.geom.Point.prototype.dispatchEvent);goog.exportProperty(ol.geom.Point.prototype,"getRevision",ol.geom.Point.prototype.getRevision);goog.exportProperty(ol.geom.Point.prototype,"on",ol.geom.Point.prototype.on);goog.exportProperty(ol.geom.Point.prototype,"once",ol.geom.Point.prototype.once);goog.exportProperty(ol.geom.Point.prototype,"un",ol.geom.Point.prototype.un);goog.exportProperty(ol.geom.Polygon.prototype,"getFirstCoordinate",ol.geom.Polygon.prototype.getFirstCoordinate);goog.exportProperty(ol.geom.Polygon.prototype,"getLastCoordinate",ol.geom.Polygon.prototype.getLastCoordinate);goog.exportProperty(ol.geom.Polygon.prototype,"getLayout",ol.geom.Polygon.prototype.getLayout);goog.exportProperty(ol.geom.Polygon.prototype,"rotate",ol.geom.Polygon.prototype.rotate);goog.exportProperty(ol.geom.Polygon.prototype,"scale",ol.geom.Polygon.prototype.scale);goog.exportProperty(ol.geom.Polygon.prototype,"getClosestPoint",ol.geom.Polygon.prototype.getClosestPoint);goog.exportProperty(ol.geom.Polygon.prototype,"intersectsCoordinate",ol.geom.Polygon.prototype.intersectsCoordinate);goog.exportProperty(ol.geom.Polygon.prototype,"getExtent",ol.geom.Polygon.prototype.getExtent);goog.exportProperty(ol.geom.Polygon.prototype,"simplify",ol.geom.Polygon.prototype.simplify);goog.exportProperty(ol.geom.Polygon.prototype,"transform",ol.geom.Polygon.prototype.transform);goog.exportProperty(ol.geom.Polygon.prototype,"get",ol.geom.Polygon.prototype.get);goog.exportProperty(ol.geom.Polygon.prototype,"getKeys",ol.geom.Polygon.prototype.getKeys);goog.exportProperty(ol.geom.Polygon.prototype,"getProperties",ol.geom.Polygon.prototype.getProperties);goog.exportProperty(ol.geom.Polygon.prototype,"set",ol.geom.Polygon.prototype.set);goog.exportProperty(ol.geom.Polygon.prototype,"setProperties",ol.geom.Polygon.prototype.setProperties);goog.exportProperty(ol.geom.Polygon.prototype,"unset",ol.geom.Polygon.prototype.unset);goog.exportProperty(ol.geom.Polygon.prototype,"changed",ol.geom.Polygon.prototype.changed);goog.exportProperty(ol.geom.Polygon.prototype,"dispatchEvent",ol.geom.Polygon.prototype.dispatchEvent);goog.exportProperty(ol.geom.Polygon.prototype,"getRevision",ol.geom.Polygon.prototype.getRevision);goog.exportProperty(ol.geom.Polygon.prototype,"on",ol.geom.Polygon.prototype.on);goog.exportProperty(ol.geom.Polygon.prototype,"once",ol.geom.Polygon.prototype.once);goog.exportProperty(ol.geom.Polygon.prototype,"un",ol.geom.Polygon.prototype.un);goog.exportProperty(ol.format.GML.prototype,"readFeatures",ol.format.GML.prototype.readFeatures);goog.exportProperty(ol.format.GML2.prototype,"readFeatures",ol.format.GML2.prototype.readFeatures);goog.exportProperty(ol.format.GML3.prototype,"readFeatures",ol.format.GML3.prototype.readFeatures);goog.exportProperty(ol.control.Control.prototype,"get",ol.control.Control.prototype.get);goog.exportProperty(ol.control.Control.prototype,"getKeys",ol.control.Control.prototype.getKeys);goog.exportProperty(ol.control.Control.prototype,"getProperties",ol.control.Control.prototype.getProperties);goog.exportProperty(ol.control.Control.prototype,"set",ol.control.Control.prototype.set);goog.exportProperty(ol.control.Control.prototype,"setProperties",ol.control.Control.prototype.setProperties);goog.exportProperty(ol.control.Control.prototype,"unset",ol.control.Control.prototype.unset);goog.exportProperty(ol.control.Control.prototype,"changed",ol.control.Control.prototype.changed);goog.exportProperty(ol.control.Control.prototype,"dispatchEvent",ol.control.Control.prototype.dispatchEvent);goog.exportProperty(ol.control.Control.prototype,"getRevision",ol.control.Control.prototype.getRevision);goog.exportProperty(ol.control.Control.prototype,"on",ol.control.Control.prototype.on);goog.exportProperty(ol.control.Control.prototype,"once",ol.control.Control.prototype.once);goog.exportProperty(ol.control.Control.prototype,"un",ol.control.Control.prototype.un);goog.exportProperty(ol.control.Attribution.prototype,"getMap",ol.control.Attribution.prototype.getMap);goog.exportProperty(ol.control.Attribution.prototype,"setMap",ol.control.Attribution.prototype.setMap);goog.exportProperty(ol.control.Attribution.prototype,"setTarget",ol.control.Attribution.prototype.setTarget);goog.exportProperty(ol.control.Attribution.prototype,"get",ol.control.Attribution.prototype.get);goog.exportProperty(ol.control.Attribution.prototype,"getKeys",ol.control.Attribution.prototype.getKeys);goog.exportProperty(ol.control.Attribution.prototype,"getProperties",ol.control.Attribution.prototype.getProperties);goog.exportProperty(ol.control.Attribution.prototype,"set",ol.control.Attribution.prototype.set);goog.exportProperty(ol.control.Attribution.prototype,"setProperties",ol.control.Attribution.prototype.setProperties);goog.exportProperty(ol.control.Attribution.prototype,"unset",ol.control.Attribution.prototype.unset);goog.exportProperty(ol.control.Attribution.prototype,"changed",ol.control.Attribution.prototype.changed);goog.exportProperty(ol.control.Attribution.prototype,"dispatchEvent",ol.control.Attribution.prototype.dispatchEvent);goog.exportProperty(ol.control.Attribution.prototype,"getRevision",ol.control.Attribution.prototype.getRevision);goog.exportProperty(ol.control.Attribution.prototype,"on",ol.control.Attribution.prototype.on);goog.exportProperty(ol.control.Attribution.prototype,"once",ol.control.Attribution.prototype.once);goog.exportProperty(ol.control.Attribution.prototype,"un",ol.control.Attribution.prototype.un);goog.exportProperty(ol.control.FullScreen.prototype,"getMap",ol.control.FullScreen.prototype.getMap);goog.exportProperty(ol.control.FullScreen.prototype,"setMap",ol.control.FullScreen.prototype.setMap);goog.exportProperty(ol.control.FullScreen.prototype,"setTarget",ol.control.FullScreen.prototype.setTarget);goog.exportProperty(ol.control.FullScreen.prototype,"get",ol.control.FullScreen.prototype.get);goog.exportProperty(ol.control.FullScreen.prototype,"getKeys",ol.control.FullScreen.prototype.getKeys);goog.exportProperty(ol.control.FullScreen.prototype,"getProperties",ol.control.FullScreen.prototype.getProperties);goog.exportProperty(ol.control.FullScreen.prototype,"set",ol.control.FullScreen.prototype.set);goog.exportProperty(ol.control.FullScreen.prototype,"setProperties",ol.control.FullScreen.prototype.setProperties);goog.exportProperty(ol.control.FullScreen.prototype,"unset",ol.control.FullScreen.prototype.unset);goog.exportProperty(ol.control.FullScreen.prototype,"changed",ol.control.FullScreen.prototype.changed);goog.exportProperty(ol.control.FullScreen.prototype,"dispatchEvent",ol.control.FullScreen.prototype.dispatchEvent);goog.exportProperty(ol.control.FullScreen.prototype,"getRevision",ol.control.FullScreen.prototype.getRevision);goog.exportProperty(ol.control.FullScreen.prototype,"on",ol.control.FullScreen.prototype.on);goog.exportProperty(ol.control.FullScreen.prototype,"once",ol.control.FullScreen.prototype.once);goog.exportProperty(ol.control.FullScreen.prototype,"un",ol.control.FullScreen.prototype.un);goog.exportProperty(ol.control.MousePosition.prototype,"getMap",ol.control.MousePosition.prototype.getMap);goog.exportProperty(ol.control.MousePosition.prototype,"setMap",ol.control.MousePosition.prototype.setMap);goog.exportProperty(ol.control.MousePosition.prototype,"setTarget",ol.control.MousePosition.prototype.setTarget);goog.exportProperty(ol.control.MousePosition.prototype,"get",ol.control.MousePosition.prototype.get);goog.exportProperty(ol.control.MousePosition.prototype,"getKeys",ol.control.MousePosition.prototype.getKeys);goog.exportProperty(ol.control.MousePosition.prototype,"getProperties",ol.control.MousePosition.prototype.getProperties);goog.exportProperty(ol.control.MousePosition.prototype,"set",ol.control.MousePosition.prototype.set);goog.exportProperty(ol.control.MousePosition.prototype,"setProperties",ol.control.MousePosition.prototype.setProperties);goog.exportProperty(ol.control.MousePosition.prototype,"unset",ol.control.MousePosition.prototype.unset);goog.exportProperty(ol.control.MousePosition.prototype,"changed",ol.control.MousePosition.prototype.changed);goog.exportProperty(ol.control.MousePosition.prototype,"dispatchEvent",ol.control.MousePosition.prototype.dispatchEvent);goog.exportProperty(ol.control.MousePosition.prototype,"getRevision",ol.control.MousePosition.prototype.getRevision);goog.exportProperty(ol.control.MousePosition.prototype,"on",ol.control.MousePosition.prototype.on);goog.exportProperty(ol.control.MousePosition.prototype,"once",ol.control.MousePosition.prototype.once);goog.exportProperty(ol.control.MousePosition.prototype,"un",ol.control.MousePosition.prototype.un);goog.exportProperty(ol.control.OverviewMap.prototype,"getMap",ol.control.OverviewMap.prototype.getMap);goog.exportProperty(ol.control.OverviewMap.prototype,"setMap",ol.control.OverviewMap.prototype.setMap);goog.exportProperty(ol.control.OverviewMap.prototype,"setTarget",ol.control.OverviewMap.prototype.setTarget);goog.exportProperty(ol.control.OverviewMap.prototype,"get",ol.control.OverviewMap.prototype.get);goog.exportProperty(ol.control.OverviewMap.prototype,"getKeys",ol.control.OverviewMap.prototype.getKeys);goog.exportProperty(ol.control.OverviewMap.prototype,"getProperties",ol.control.OverviewMap.prototype.getProperties);goog.exportProperty(ol.control.OverviewMap.prototype,"set",ol.control.OverviewMap.prototype.set);goog.exportProperty(ol.control.OverviewMap.prototype,"setProperties",ol.control.OverviewMap.prototype.setProperties);goog.exportProperty(ol.control.OverviewMap.prototype,"unset",ol.control.OverviewMap.prototype.unset);goog.exportProperty(ol.control.OverviewMap.prototype,"changed",ol.control.OverviewMap.prototype.changed);goog.exportProperty(ol.control.OverviewMap.prototype,"dispatchEvent",ol.control.OverviewMap.prototype.dispatchEvent);goog.exportProperty(ol.control.OverviewMap.prototype,"getRevision",ol.control.OverviewMap.prototype.getRevision);goog.exportProperty(ol.control.OverviewMap.prototype,"on",ol.control.OverviewMap.prototype.on);goog.exportProperty(ol.control.OverviewMap.prototype,"once",ol.control.OverviewMap.prototype.once);goog.exportProperty(ol.control.OverviewMap.prototype,"un",ol.control.OverviewMap.prototype.un);goog.exportProperty(ol.control.Rotate.prototype,"getMap",ol.control.Rotate.prototype.getMap);goog.exportProperty(ol.control.Rotate.prototype,"setMap",ol.control.Rotate.prototype.setMap);goog.exportProperty(ol.control.Rotate.prototype,"setTarget",ol.control.Rotate.prototype.setTarget);goog.exportProperty(ol.control.Rotate.prototype,"get",ol.control.Rotate.prototype.get);goog.exportProperty(ol.control.Rotate.prototype,"getKeys",ol.control.Rotate.prototype.getKeys);goog.exportProperty(ol.control.Rotate.prototype,"getProperties",ol.control.Rotate.prototype.getProperties);goog.exportProperty(ol.control.Rotate.prototype,"set",ol.control.Rotate.prototype.set);goog.exportProperty(ol.control.Rotate.prototype,"setProperties",ol.control.Rotate.prototype.setProperties);goog.exportProperty(ol.control.Rotate.prototype,"unset",ol.control.Rotate.prototype.unset);goog.exportProperty(ol.control.Rotate.prototype,"changed",ol.control.Rotate.prototype.changed);goog.exportProperty(ol.control.Rotate.prototype,"dispatchEvent",ol.control.Rotate.prototype.dispatchEvent);goog.exportProperty(ol.control.Rotate.prototype,"getRevision",ol.control.Rotate.prototype.getRevision);goog.exportProperty(ol.control.Rotate.prototype,"on",ol.control.Rotate.prototype.on);goog.exportProperty(ol.control.Rotate.prototype,"once",ol.control.Rotate.prototype.once);goog.exportProperty(ol.control.Rotate.prototype,"un",ol.control.Rotate.prototype.un);goog.exportProperty(ol.control.ScaleLine.prototype,"getMap",ol.control.ScaleLine.prototype.getMap);goog.exportProperty(ol.control.ScaleLine.prototype,"setMap",ol.control.ScaleLine.prototype.setMap);goog.exportProperty(ol.control.ScaleLine.prototype,"setTarget",ol.control.ScaleLine.prototype.setTarget);goog.exportProperty(ol.control.ScaleLine.prototype,"get",ol.control.ScaleLine.prototype.get);goog.exportProperty(ol.control.ScaleLine.prototype,"getKeys",ol.control.ScaleLine.prototype.getKeys);goog.exportProperty(ol.control.ScaleLine.prototype,"getProperties",ol.control.ScaleLine.prototype.getProperties);goog.exportProperty(ol.control.ScaleLine.prototype,"set",ol.control.ScaleLine.prototype.set);goog.exportProperty(ol.control.ScaleLine.prototype,"setProperties",ol.control.ScaleLine.prototype.setProperties);goog.exportProperty(ol.control.ScaleLine.prototype,"unset",ol.control.ScaleLine.prototype.unset);goog.exportProperty(ol.control.ScaleLine.prototype,"changed",ol.control.ScaleLine.prototype.changed);goog.exportProperty(ol.control.ScaleLine.prototype,"dispatchEvent",ol.control.ScaleLine.prototype.dispatchEvent);goog.exportProperty(ol.control.ScaleLine.prototype,"getRevision",ol.control.ScaleLine.prototype.getRevision);goog.exportProperty(ol.control.ScaleLine.prototype,"on",ol.control.ScaleLine.prototype.on);goog.exportProperty(ol.control.ScaleLine.prototype,"once",ol.control.ScaleLine.prototype.once);goog.exportProperty(ol.control.ScaleLine.prototype,"un",ol.control.ScaleLine.prototype.un);goog.exportProperty(ol.control.Zoom.prototype,"getMap",ol.control.Zoom.prototype.getMap);goog.exportProperty(ol.control.Zoom.prototype,"setMap",ol.control.Zoom.prototype.setMap);goog.exportProperty(ol.control.Zoom.prototype,"setTarget",ol.control.Zoom.prototype.setTarget);goog.exportProperty(ol.control.Zoom.prototype,"get",ol.control.Zoom.prototype.get);goog.exportProperty(ol.control.Zoom.prototype,"getKeys",ol.control.Zoom.prototype.getKeys);goog.exportProperty(ol.control.Zoom.prototype,"getProperties",ol.control.Zoom.prototype.getProperties);goog.exportProperty(ol.control.Zoom.prototype,"set",ol.control.Zoom.prototype.set);goog.exportProperty(ol.control.Zoom.prototype,"setProperties",ol.control.Zoom.prototype.setProperties);goog.exportProperty(ol.control.Zoom.prototype,"unset",ol.control.Zoom.prototype.unset);goog.exportProperty(ol.control.Zoom.prototype,"changed",ol.control.Zoom.prototype.changed);goog.exportProperty(ol.control.Zoom.prototype,"dispatchEvent",ol.control.Zoom.prototype.dispatchEvent);goog.exportProperty(ol.control.Zoom.prototype,"getRevision",ol.control.Zoom.prototype.getRevision);goog.exportProperty(ol.control.Zoom.prototype,"on",ol.control.Zoom.prototype.on);goog.exportProperty(ol.control.Zoom.prototype,"once",ol.control.Zoom.prototype.once);goog.exportProperty(ol.control.Zoom.prototype,"un",ol.control.Zoom.prototype.un);goog.exportProperty(ol.control.ZoomSlider.prototype,"getMap",ol.control.ZoomSlider.prototype.getMap);goog.exportProperty(ol.control.ZoomSlider.prototype,"setMap",ol.control.ZoomSlider.prototype.setMap);goog.exportProperty(ol.control.ZoomSlider.prototype,"setTarget",ol.control.ZoomSlider.prototype.setTarget);goog.exportProperty(ol.control.ZoomSlider.prototype,"get",ol.control.ZoomSlider.prototype.get);goog.exportProperty(ol.control.ZoomSlider.prototype,"getKeys",ol.control.ZoomSlider.prototype.getKeys);goog.exportProperty(ol.control.ZoomSlider.prototype,"getProperties",ol.control.ZoomSlider.prototype.getProperties);goog.exportProperty(ol.control.ZoomSlider.prototype,"set",ol.control.ZoomSlider.prototype.set);goog.exportProperty(ol.control.ZoomSlider.prototype,"setProperties",ol.control.ZoomSlider.prototype.setProperties);goog.exportProperty(ol.control.ZoomSlider.prototype,"unset",ol.control.ZoomSlider.prototype.unset);goog.exportProperty(ol.control.ZoomSlider.prototype,"changed",ol.control.ZoomSlider.prototype.changed);goog.exportProperty(ol.control.ZoomSlider.prototype,"dispatchEvent",ol.control.ZoomSlider.prototype.dispatchEvent);goog.exportProperty(ol.control.ZoomSlider.prototype,"getRevision",ol.control.ZoomSlider.prototype.getRevision);goog.exportProperty(ol.control.ZoomSlider.prototype,"on",ol.control.ZoomSlider.prototype.on);goog.exportProperty(ol.control.ZoomSlider.prototype,"once",ol.control.ZoomSlider.prototype.once);goog.exportProperty(ol.control.ZoomSlider.prototype,"un",ol.control.ZoomSlider.prototype.un);goog.exportProperty(ol.control.ZoomToExtent.prototype,"getMap",ol.control.ZoomToExtent.prototype.getMap);goog.exportProperty(ol.control.ZoomToExtent.prototype,"setMap",ol.control.ZoomToExtent.prototype.setMap);goog.exportProperty(ol.control.ZoomToExtent.prototype,"setTarget",ol.control.ZoomToExtent.prototype.setTarget);goog.exportProperty(ol.control.ZoomToExtent.prototype,"get",ol.control.ZoomToExtent.prototype.get);goog.exportProperty(ol.control.ZoomToExtent.prototype,"getKeys",ol.control.ZoomToExtent.prototype.getKeys);goog.exportProperty(ol.control.ZoomToExtent.prototype,"getProperties",ol.control.ZoomToExtent.prototype.getProperties);goog.exportProperty(ol.control.ZoomToExtent.prototype,"set",ol.control.ZoomToExtent.prototype.set);goog.exportProperty(ol.control.ZoomToExtent.prototype,"setProperties",ol.control.ZoomToExtent.prototype.setProperties);goog.exportProperty(ol.control.ZoomToExtent.prototype,"unset",ol.control.ZoomToExtent.prototype.unset);goog.exportProperty(ol.control.ZoomToExtent.prototype,"changed",ol.control.ZoomToExtent.prototype.changed);goog.exportProperty(ol.control.ZoomToExtent.prototype,"dispatchEvent",ol.control.ZoomToExtent.prototype.dispatchEvent);goog.exportProperty(ol.control.ZoomToExtent.prototype,"getRevision",ol.control.ZoomToExtent.prototype.getRevision);goog.exportProperty(ol.control.ZoomToExtent.prototype,"on",ol.control.ZoomToExtent.prototype.on);goog.exportProperty(ol.control.ZoomToExtent.prototype,"once",ol.control.ZoomToExtent.prototype.once);goog.exportProperty(ol.control.ZoomToExtent.prototype,"un",ol.control.ZoomToExtent.prototype.un);ol.VERSION="v4.6.5";OPENLAYERS.ol=ol;return OPENLAYERS.ol});!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.proj4=t()}(this,function(){"use strict";function e(e,t){if(e[t])return e[t];for(var o,r=Object.keys(e),i=t.toLowerCase().replace(q,""),n=-1;++n<r.length;)if((o=r[n]).toLowerCase().replace(q,"")===i)return e[o]}function t(e){if("string"!=typeof e)throw new Error("not a string");this.text=e.trim(),this.level=0,this.place=0,this.root=null,this.stack=[],this.currentObject=null,this.state=W}function o(e){return new t(e).output()}function r(e,t,o){Array.isArray(t)&&(o.unshift(t),t=null);var r=t?{}:e,n=o.reduce(function(e,t){return i(t,e),e},r);t&&(e[t]=n)}function i(e,t){if(Array.isArray(e)){var o=e.shift();if("PARAMETER"===o&&(o=e.shift()),1===e.length)return Array.isArray(e[0])?(t[o]={},void i(e[0],t[o])):void(t[o]=e[0]);if(e.length)if("TOWGS84"!==o){Array.isArray(o)||(t[o]={});var n;switch(o){case"UNIT":case"PRIMEM":case"VERT_DATUM":return t[o]={name:e[0].toLowerCase(),convert:e[1]},void(3===e.length&&i(e[2],t[o]));case"SPHEROID":case"ELLIPSOID":return t[o]={name:e[0],a:e[1],rf:e[2]},void(4===e.length&&i(e[3],t[o]));case"PROJECTEDCRS":case"PROJCRS":case"GEOGCS":case"GEOCCS":case"PROJCS":case"LOCAL_CS":case"GEODCRS":case"GEODETICCRS":case"GEODETICDATUM":case"EDATUM":case"ENGINEERINGDATUM":case"VERT_CS":case"VERTCRS":case"VERTICALCRS":case"COMPD_CS":case"COMPOUNDCRS":case"ENGINEERINGCRS":case"ENGCRS":case"FITTED_CS":case"LOCAL_DATUM":case"DATUM":return e[0]=["name",e[0]],void r(t,o,e);default:for(n=-1;++n<e.length;)if(!Array.isArray(e[n]))return i(e,t[o]);return r(t,o,e)}}else t[o]=e;else t[o]=!0}else t[e]=!0}function n(e){return e*z}function a(e){function t(t){return t*(e.to_meter||1)}"GEOGCS"===e.type?e.projName="longlat":"LOCAL_CS"===e.type?(e.projName="identity",e.local=!0):"object"==typeof e.PROJECTION?e.projName=Object.keys(e.PROJECTION)[0]:e.projName=e.PROJECTION,e.UNIT&&(e.units=e.UNIT.name.toLowerCase(),"metre"===e.units&&(e.units="meter"),e.UNIT.convert&&("GEOGCS"===e.type?e.DATUM&&e.DATUM.SPHEROID&&(e.to_meter=e.UNIT.convert*e.DATUM.SPHEROID.a):e.to_meter=e.UNIT.convert));var o=e.GEOGCS;"GEOGCS"===e.type&&(o=e),o&&(o.DATUM?e.datumCode=o.DATUM.name.toLowerCase():e.datumCode=o.name.toLowerCase(),"d_"===e.datumCode.slice(0,2)&&(e.datumCode=e.datumCode.slice(2)),"new_zealand_geodetic_datum_1949"!==e.datumCode&&"new_zealand_1949"!==e.datumCode||(e.datumCode="nzgd49"),"wgs_1984"===e.datumCode&&("Mercator_Auxiliary_Sphere"===e.PROJECTION&&(e.sphere=!0),e.datumCode="wgs84"),"_ferro"===e.datumCode.slice(-6)&&(e.datumCode=e.datumCode.slice(0,-6)),"_jakarta"===e.datumCode.slice(-8)&&(e.datumCode=e.datumCode.slice(0,-8)),~e.datumCode.indexOf("belge")&&(e.datumCode="rnb72"),o.DATUM&&o.DATUM.SPHEROID&&(e.ellps=o.DATUM.SPHEROID.name.replace("_19","").replace(/[Cc]larke\_18/,"clrk"),"international"===e.ellps.toLowerCase().slice(0,13)&&(e.ellps="intl"),e.a=o.DATUM.SPHEROID.a,e.rf=parseFloat(o.DATUM.SPHEROID.rf,10)),~e.datumCode.indexOf("osgb_1936")&&(e.datumCode="osgb36")),e.b&&!isFinite(e.b)&&(e.b=e.a);[["standard_parallel_1","Standard_Parallel_1"],["standard_parallel_2","Standard_Parallel_2"],["false_easting","False_Easting"],["false_northing","False_Northing"],["central_meridian","Central_Meridian"],["latitude_of_origin","Latitude_Of_Origin"],["latitude_of_origin","Central_Parallel"],["scale_factor","Scale_Factor"],["k0","scale_factor"],["latitude_of_center","Latitude_of_center"],["lat0","latitude_of_center",n],["longitude_of_center","Longitude_Of_Center"],["longc","longitude_of_center",n],["x0","false_easting",t],["y0","false_northing",t],["long0","central_meridian",n],["lat0","latitude_of_origin",n],["lat0","standard_parallel_1",n],["lat1","standard_parallel_1",n],["lat2","standard_parallel_2",n],["alpha","azimuth",n],["srsCode","name"]].forEach(function(t){return function(e,t){var o=t[0],r=t[1];!(o in e)&&r in e&&(e[o]=e[r],3===t.length&&(e[o]=t[2](e[o])))}(e,t)}),e.long0||!e.longc||"Albers_Conic_Equal_Area"!==e.projName&&"Lambert_Azimuthal_Equal_Area"!==e.projName||(e.long0=e.longc),e.lat_ts||!e.lat1||"Stereographic_South_Pole"!==e.projName&&"Polar Stereographic (variant B)"!==e.projName||(e.lat0=n(e.lat1>0?90:-90),e.lat_ts=e.lat1)}function l(e){var t=this;if(2===arguments.length){var o=arguments[1];"string"==typeof o?"+"===o.charAt(0)?l[e]=j(arguments[1]):l[e]=Z(arguments[1]):l[e]=o}else if(1===arguments.length){if(Array.isArray(e))return e.map(function(e){Array.isArray(e)?l.apply(t,e):l(e)});if("string"==typeof e){if(e in l)return l[e]}else"EPSG"in e?l["EPSG:"+e.EPSG]=e:"ESRI"in e?l["ESRI:"+e.ESRI]=e:"IAU2000"in e?l["IAU2000:"+e.IAU2000]=e:console.log(e);return}}function s(e){return function(e){return"string"==typeof e}(e)?function(e){return e in l}(e)?l[e]:function(e){return J.some(function(t){return e.indexOf(t)>-1})}(e)?Z(e):function(e){return"+"===e[0]}(e)?j(e):void 0:e}function p(e){return e}function c(e,t){var o=le.length;return e.names?(le[o]=e,e.names.forEach(function(e){ae[e.toLowerCase()]=o}),this):(console.log(t),!0)}function u(t,o){if(!(this instanceof u))return new u(t);o=o||function(e){if(e)throw e};var r=s(t);if("object"==typeof r){var i=u.projections.get(r.projName);if(i){if(r.datumCode&&"none"!==r.datumCode){var n=e(ue,r.datumCode);n&&(r.datum_params=n.towgs84?n.towgs84.split(","):null,r.ellps=n.ellipse,r.datumName=n.datumName?n.datumName:r.datumCode)}r.k0=r.k0||1,r.axis=r.axis||"enu",r.ellps=r.ellps||"wgs84";var a=function(t,o,r,i,n){if(!t){var a=e(pe,i);a||(a=ce),t=a.a,o=a.b,r=a.rf}return r&&!o&&(o=(1-1/r)*t),(0===r||Math.abs(t-o)<D)&&(n=!0,o=t),{a:t,b:o,rf:r,sphere:n}}(r.a,r.b,r.rf,r.ellps,r.sphere),l=function(e,t,o,r){var i=e*e,n=t*t,a=(i-n)/i,l=0;r?(i=(e*=1-a*(I+a*(O+a*N)))*e,a=0):l=Math.sqrt(a);return{es:a,e:l,ep2:(i-n)/n}}(a.a,a.b,a.rf,r.R_A),p=r.datum||function(e,t,o,r,i,n){var a={};return a.datum_type=void 0===e||"none"===e?R:b,t&&(a.datum_params=t.map(parseFloat),0===a.datum_params[0]&&0===a.datum_params[1]&&0===a.datum_params[2]||(a.datum_type=L),a.datum_params.length>3&&(0===a.datum_params[3]&&0===a.datum_params[4]&&0===a.datum_params[5]&&0===a.datum_params[6]||(a.datum_type=w,a.datum_params[3]*=A,a.datum_params[4]*=A,a.datum_params[5]*=A,a.datum_params[6]=a.datum_params[6]/1e6+1))),a.a=o,a.b=r,a.es=i,a.ep2=n,a}(r.datumCode,r.datum_params,a.a,a.b,l.es,l.ep2);Q(this,r),Q(this,i),this.a=a.a,this.b=a.b,this.rf=a.rf,this.sphere=a.sphere,this.es=l.es,this.e=l.e,this.ep2=l.ep2,this.datum=p,this.init(),o(null,this)}else o(t)}else o(t)}function g(e){return e===L||e===w}function d(e,t,o){var r;return Array.isArray(o)&&(o=he(o)),e.datum&&t.datum&&function(e,t){return(e.datum.datum_type===L||e.datum.datum_type===w)&&"WGS84"!==t.datumCode||(t.datum.datum_type===L||t.datum.datum_type===w)&&"WGS84"!==e.datumCode}(e,t)&&(o=d(e,r=new u("WGS84"),o),e=r),"enu"!==e.axis&&(o=de(e,!1,o)),"longlat"===e.projName?o={x:o.x*F,y:o.y*F}:(e.to_meter&&(o={x:o.x*e.to_meter,y:o.y*e.to_meter}),o=e.inverse(o)),e.from_greenwich&&(o.x+=e.from_greenwich),o=ge(e.datum,t.datum,o),t.from_greenwich&&(o={x:o.x-t.from_greenwich,y:o.y}),"longlat"===t.projName?o={x:o.x*k,y:o.y*k}:(o=t.forward(o),t.to_meter&&(o={x:o.x/t.to_meter,y:o.y/t.to_meter})),"enu"!==t.axis?de(t,!0,o):o}function h(e,t,o){var r;return Array.isArray(o)?(r=d(e,t,o),3===o.length?[r.x,r.y,r.z]:[r.x,r.y]):d(e,t,o)}function f(e){return e instanceof u?e:e.oProj?e.oProj:u(e)}function y(e,t,o){e=f(e);var r,i=!1;return void 0===t?(t=e,e=fe,i=!0):(void 0!==t.x||Array.isArray(t))&&(o=t,t=e,e=fe,i=!0),t=f(t),o?h(e,t,o):(r={forward:function(o){return h(e,t,o)},inverse:function(o){return h(t,e,o)}},i&&(r.oProj=t),r)}function m(e,t){return t=t||5,function(e,t){var o="00000"+e.easting,r="00000"+e.northing;return e.zoneNumber+e.zoneLetter+function(e,t,o){var r=_(o),i=Math.floor(e/1e5),n=Math.floor(t/1e5)%20;return function(e,t,o){var r=o-1,i=me.charCodeAt(r),n=ve.charCodeAt(r),a=i+e-1,l=n+t,s=!1;a>Ee&&(a=a-Ee+Ce-1,s=!0),(a===Te||i<Te&&a>Te||(a>Te||i<Te)&&s)&&a++,(a===Se||i<Se&&a>Se||(a>Se||i<Se)&&s)&&++a===Te&&a++,a>Ee&&(a=a-Ee+Ce-1),l>_e?(l=l-_e+Ce-1,s=!0):s=!1,(l===Te||n<Te&&l>Te||(l>Te||n<Te)&&s)&&l++,(l===Se||n<Se&&l>Se||(l>Se||n<Se)&&s)&&++l===Te&&l++,l>_e&&(l=l-_e+Ce-1);return String.fromCharCode(a)+String.fromCharCode(l)}(i,n,r)}(e.easting,e.northing,e.zoneNumber)+o.substr(o.length-5,t)+r.substr(r.length-5,t)}(function(e){var t,o,r,i,n,a,l,s,p=e.lat,c=e.lon,u=6378137,g=.00669438,d=C(p),h=C(c);s=Math.floor((c+180)/6)+1,180===c&&(s=60),p>=56&&p<64&&c>=3&&c<12&&(s=32),p>=72&&p<84&&(c>=0&&c<9?s=31:c>=9&&c<21?s=33:c>=21&&c<33?s=35:c>=33&&c<42&&(s=37)),l=C(6*(s-1)-180+3),t=g/(1-g),o=u/Math.sqrt(1-g*Math.sin(d)*Math.sin(d)),r=Math.tan(d)*Math.tan(d),i=t*Math.cos(d)*Math.cos(d),n=Math.cos(d)*(h-l),a=u*(.9983242984503243*d-.002514607064228144*Math.sin(2*d)+2639046602129982e-21*Math.sin(4*d)-35*g*g*g/3072*Math.sin(6*d));var f=.9996*o*(n+(1-r+i)*n*n*n/6+(5-18*r+r*r+72*i-58*t)*n*n*n*n*n/120)+5e5,y=.9996*(a+o*Math.tan(d)*(n*n/2+(5-r+9*i+4*i*i)*n*n*n*n/24+(61-58*r+r*r+600*i-330*t)*n*n*n*n*n*n/720));return p<0&&(y+=1e7),{northing:Math.round(y),easting:Math.round(f),zoneNumber:s,zoneLetter:function(e){var t="Z";return 84>=e&&e>=72?t="X":72>e&&e>=64?t="W":64>e&&e>=56?t="V":56>e&&e>=48?t="U":48>e&&e>=40?t="T":40>e&&e>=32?t="S":32>e&&e>=24?t="R":24>e&&e>=16?t="Q":16>e&&e>=8?t="P":8>e&&e>=0?t="N":0>e&&e>=-8?t="M":-8>e&&e>=-16?t="L":-16>e&&e>=-24?t="K":-24>e&&e>=-32?t="J":-32>e&&e>=-40?t="H":-40>e&&e>=-48?t="G":-48>e&&e>=-56?t="F":-56>e&&e>=-64?t="E":-64>e&&e>=-72?t="D":-72>e&&e>=-80&&(t="C"),t}(p)}}({lat:e[1],lon:e[0]}),t)}function v(e){var t=S(E(e.toUpperCase()));return t.lat&&t.lon?[t.lon,t.lat]:[(t.left+t.right)/2,(t.top+t.bottom)/2]}function C(e){return e*(Math.PI/180)}function T(e){return e/Math.PI*180}function S(e){var t=e.northing,o=e.easting,r=e.zoneLetter,i=e.zoneNumber;if(i<0||i>60)return null;var n,a,l,s,p,c,u,g,d,h=6378137,f=.00669438,y=(1-Math.sqrt(1-f))/(1+Math.sqrt(1-f)),m=o-5e5,v=t;r<"N"&&(v-=1e7),u=6*(i-1)-180+3,n=f/(1-f),d=(g=v/.9996/6367449.145945056)+(3*y/2-27*y*y*y/32)*Math.sin(2*g)+(21*y*y/16-55*y*y*y*y/32)*Math.sin(4*g)+151*y*y*y/96*Math.sin(6*g),a=h/Math.sqrt(1-f*Math.sin(d)*Math.sin(d)),l=Math.tan(d)*Math.tan(d),s=n*Math.cos(d)*Math.cos(d),p=h*(1-f)/Math.pow(1-f*Math.sin(d)*Math.sin(d),1.5),c=m/(.9996*a);var C=d-a*Math.tan(d)/p*(c*c/2-(5+3*l+10*s-4*s*s-9*n)*c*c*c*c/24+(61+90*l+298*s+45*l*l-252*n-3*s*s)*c*c*c*c*c*c/720);C=T(C);var _,E=(c-(1+2*l+s)*c*c*c/6+(5-2*s+28*l-3*s*s+8*n+24*l*l)*c*c*c*c*c/120)/Math.cos(d);E=u+T(E);if(e.accuracy){var x=S({northing:e.northing+e.accuracy,easting:e.easting+e.accuracy,zoneLetter:e.zoneLetter,zoneNumber:e.zoneNumber});_={top:x.lat,right:x.lon,bottom:C,left:E}}else _={lat:C,lon:E};return _}function _(e){var t=e%ye;return 0===t&&(t=ye),t}function E(e){if(e&&0===e.length)throw"MGRSPoint coverting from nothing";for(var t,o=e.length,r=null,i="",n=0;!/[A-Z]/.test(t=e.charAt(n));){if(n>=2)throw"MGRSPoint bad conversion from: "+e;i+=t,n++}var a=parseInt(i,10);if(0===n||n+3>o)throw"MGRSPoint bad conversion from: "+e;var l=e.charAt(n++);if(l<="A"||"B"===l||"Y"===l||l>="Z"||"I"===l||"O"===l)throw"MGRSPoint zone letter "+l+" not handled: "+e;r=e.substring(n,n+=2);for(var s=_(a),p=function(e,t){for(var o=me.charCodeAt(t-1),r=1e5,i=!1;o!==e.charCodeAt(0);){if(++o===Te&&o++,o===Se&&o++,o>Ee){if(i)throw"Bad character: "+e;o=Ce,i=!0}r+=1e5}return r}(r.charAt(0),s),c=function(e,t){if(e>"V")throw"MGRSPoint given invalid Northing "+e;for(var o=ve.charCodeAt(t-1),r=0,i=!1;o!==e.charCodeAt(0);){if(++o===Te&&o++,o===Se&&o++,o>_e){if(i)throw"Bad character: "+e;o=Ce,i=!0}r+=1e5}return r}(r.charAt(1),s);c<x(l);)c+=2e6;var u=o-n;if(u%2!=0)throw"MGRSPoint has to have an even number \nof digits after the zone letter and two 100km letters - front \nhalf for easting meters, second half for \nnorthing meters"+e;var g,d,h,f=u/2,y=0,m=0;return f>0&&(g=1e5/Math.pow(10,f),d=e.substring(n,n+f),y=parseFloat(d)*g,h=e.substring(n+f),m=parseFloat(h)*g),{easting:y+p,northing:m+c,zoneLetter:l,zoneNumber:a,accuracy:g}}function x(e){var t;switch(e){case"C":t=11e5;break;case"D":t=2e6;break;case"E":t=28e5;break;case"F":t=37e5;break;case"G":t=46e5;break;case"H":t=55e5;break;case"J":t=64e5;break;case"K":t=73e5;break;case"L":t=82e5;break;case"M":t=91e5;break;case"N":t=0;break;case"P":t=8e5;break;case"Q":t=17e5;break;case"R":t=26e5;break;case"S":t=35e5;break;case"T":t=44e5;break;case"U":t=53e5;break;case"V":t=62e5;break;case"W":t=7e6;break;case"X":t=79e5;break;default:t=-1}if(t>=0)return t;throw"Invalid zone letter: "+e}function P(e,t,o){if(!(this instanceof P))return new P(e,t,o);if(Array.isArray(e))this.x=e[0],this.y=e[1],this.z=e[2]||0;else if("object"==typeof e)this.x=e.x,this.y=e.y,this.z=e.z||0;else if("string"==typeof e&&void 0===t){var r=e.split(",");this.x=parseFloat(r[0],10),this.y=parseFloat(r[1],10),this.z=parseFloat(r[2],10)||0}else this.x=e,this.y=t,this.z=o||0;console.warn("proj4.Point will be removed in version 3, use proj4.toPoint")}var L=1,w=2,b=4,R=5,A=484813681109536e-20,M=Math.PI/2,I=.16666666666666666,O=.04722222222222222,N=.022156084656084655,D=void 0===Number.EPSILON?1e-10:Number.EPSILON,F=.017453292519943295,k=57.29577951308232,G=Math.PI/4,U=2*Math.PI,B={greenwich:0,lisbon:-9.131906111111,paris:2.337229166667,bogota:-74.080916666667,madrid:-3.687938888889,rome:12.452333333333,bern:7.439583333333,jakarta:106.807719444444,ferro:-17.666666666667,brussels:4.367975,stockholm:18.058277777778,athens:23.7163375,oslo:10.722916666667},$={ft:{to_meter:.3048},"us-ft":{to_meter:1200/3937}},q=/[\s_\-\/\(\)]/g,j=function(t){var o,r,i,n={},a=t.split("+").map(function(e){return e.trim()}).filter(function(e){return e}).reduce(function(e,t){var o=t.split("=");return o.push(!0),e[o[0].toLowerCase()]=o[1],e},{}),l={proj:"projName",datum:"datumCode",rf:function(e){n.rf=parseFloat(e)},lat_0:function(e){n.lat0=e*F},lat_1:function(e){n.lat1=e*F},lat_2:function(e){n.lat2=e*F},lat_ts:function(e){n.lat_ts=e*F},lon_0:function(e){n.long0=e*F},lon_1:function(e){n.long1=e*F},lon_2:function(e){n.long2=e*F},alpha:function(e){n.alpha=parseFloat(e)*F},lonc:function(e){n.longc=e*F},x_0:function(e){n.x0=parseFloat(e)},y_0:function(e){n.y0=parseFloat(e)},k_0:function(e){n.k0=parseFloat(e)},k:function(e){n.k0=parseFloat(e)},a:function(e){n.a=parseFloat(e)},b:function(e){n.b=parseFloat(e)},r_a:function(){n.R_A=!0},zone:function(e){n.zone=parseInt(e,10)},south:function(){n.utmSouth=!0},towgs84:function(e){n.datum_params=e.split(",").map(function(e){return parseFloat(e)})},to_meter:function(e){n.to_meter=parseFloat(e)},units:function(t){n.units=t;var o=e($,t);o&&(n.to_meter=o.to_meter)},from_greenwich:function(e){n.from_greenwich=e*F},pm:function(t){var o=e(B,t);n.from_greenwich=(o||parseFloat(t))*F},nadgrids:function(e){"@null"===e?n.datumCode="none":n.nadgrids=e},axis:function(e){var t="ewnsud";3===e.length&&-1!==t.indexOf(e.substr(0,1))&&-1!==t.indexOf(e.substr(1,1))&&-1!==t.indexOf(e.substr(2,1))&&(n.axis=e)}};for(o in a)r=a[o],o in l?"function"==typeof(i=l[o])?i(r):n[i]=r:n[o]=r;return"string"==typeof n.datumCode&&"WGS84"!==n.datumCode&&(n.datumCode=n.datumCode.toLowerCase()),n},W=1,V=/\s/,Y=/[A-Za-z]/,K=/[A-Za-z84]/,X=/[,\]]/,H=/[\d\.E\-\+]/;t.prototype.readCharicter=function(){var e=this.text[this.place++];if(4!==this.state)for(;V.test(e);){if(this.place>=this.text.length)return;e=this.text[this.place++]}switch(this.state){case W:return this.neutral(e);case 2:return this.keyword(e);case 4:return this.quoted(e);case 5:return this.afterquote(e);case 3:return this.number(e);case-1:return}},t.prototype.afterquote=function(e){if('"'===e)return this.word+='"',void(this.state=4);if(X.test(e))return this.word=this.word.trim(),void this.afterItem(e);throw new Error("havn't handled \""+e+'" in afterquote yet, index '+this.place)},t.prototype.afterItem=function(e){return","===e?(null!==this.word&&this.currentObject.push(this.word),this.word=null,void(this.state=W)):"]"===e?(this.level--,null!==this.word&&(this.currentObject.push(this.word),this.word=null),this.state=W,this.currentObject=this.stack.pop(),void(this.currentObject||(this.state=-1))):void 0},t.prototype.number=function(e){if(!H.test(e)){if(X.test(e))return this.word=parseFloat(this.word),void this.afterItem(e);throw new Error("havn't handled \""+e+'" in number yet, index '+this.place)}this.word+=e},t.prototype.quoted=function(e){return'"'===e?void(this.state=5):void(this.word+=e)},t.prototype.keyword=function(e){if(K.test(e))this.word+=e;else{if("["===e){var t=[];return t.push(this.word),this.level++,null===this.root?this.root=t:this.currentObject.push(t),this.stack.push(this.currentObject),this.currentObject=t,void(this.state=W)}if(!X.test(e))throw new Error("havn't handled \""+e+'" in keyword yet, index '+this.place);this.afterItem(e)}},t.prototype.neutral=function(e){if(Y.test(e))return this.word=e,void(this.state=2);if('"'===e)return this.word="",void(this.state=4);if(H.test(e))return this.word=e,void(this.state=3);if(!X.test(e))throw new Error("havn't handled \""+e+'" in neutral yet, index '+this.place);this.afterItem(e)},t.prototype.output=function(){for(;this.place<this.text.length;)this.readCharicter();if(-1===this.state)return this.root;throw new Error('unable to parse string "'+this.text+'". State is '+this.state)};var z=.017453292519943295,Z=function(e){var t=o(e),r=t.shift(),n=t.shift();t.unshift(["name",n]),t.unshift(["type",r]);var l={};return i(t,l),a(l),l};!function(e){e("EPSG:4326","+title=WGS 84 (long/lat) +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees"),e("EPSG:4269","+title=NAD83 (long/lat) +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees"),e("EPSG:3857","+title=WGS 84 / Pseudo-Mercator +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs"),e.WGS84=e["EPSG:4326"],e["EPSG:3785"]=e["EPSG:3857"],e.GOOGLE=e["EPSG:3857"],e["EPSG:900913"]=e["EPSG:3857"],e["EPSG:102113"]=e["EPSG:3857"]}(l);var J=["PROJECTEDCRS","PROJCRS","GEOGCS","GEOCCS","PROJCS","LOCAL_CS","GEODCRS","GEODETICCRS","GEODETICDATUM","ENGCRS","ENGINEERINGCRS"],Q=function(e,t){e=e||{};var o,r;if(!t)return e;for(r in t)void 0!==(o=t[r])&&(e[r]=o);return e},ee=function(e,t,o){var r=e*t;return o/Math.sqrt(1-r*r)},te=function(e){return e<0?-1:1},oe=function(e){return Math.abs(e)<=3.14159265359?e:e-te(e)*U},re=function(e,t,o){var r=e*o,i=.5*e;return r=Math.pow((1-r)/(1+r),i),Math.tan(.5*(M-t))/r},ie=function(e,t){for(var o,r,i=.5*e,n=M-2*Math.atan(t),a=0;a<=15;a++)if(o=e*Math.sin(n),n+=r=M-2*Math.atan(t*Math.pow((1-o)/(1+o),i))-n,Math.abs(r)<=1e-10)return n;return-9999},ne=[{init:function(){var e=this.b/this.a;this.es=1-e*e,"x0"in this||(this.x0=0),"y0"in this||(this.y0=0),this.e=Math.sqrt(this.es),this.lat_ts?this.sphere?this.k0=Math.cos(this.lat_ts):this.k0=ee(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)):this.k0||(this.k?this.k0=this.k:this.k0=1)},forward:function(e){var t,o,r=e.x,i=e.y;if(i*k>90&&i*k<-90&&r*k>180&&r*k<-180)return null;if(Math.abs(Math.abs(i)-M)<=D)return null;if(this.sphere)t=this.x0+this.a*this.k0*oe(r-this.long0),o=this.y0+this.a*this.k0*Math.log(Math.tan(G+.5*i));else{var n=Math.sin(i),a=re(this.e,i,n);t=this.x0+this.a*this.k0*oe(r-this.long0),o=this.y0-this.a*this.k0*Math.log(a)}return e.x=t,e.y=o,e},inverse:function(e){var t,o,r=e.x-this.x0,i=e.y-this.y0;if(this.sphere)o=M-2*Math.atan(Math.exp(-i/(this.a*this.k0)));else{var n=Math.exp(-i/(this.a*this.k0));if(-9999===(o=ie(this.e,n)))return null}return t=oe(this.long0+r/(this.a*this.k0)),e.x=t,e.y=o,e},names:["Mercator","Popular Visualisation Pseudo Mercator","Mercator_1SP","Mercator_Auxiliary_Sphere","merc"]},{init:function(){},forward:p,inverse:p,names:["longlat","identity"]}],ae={},le=[],se={start:function(){ne.forEach(c)},add:c,get:function(e){if(!e)return!1;var t=e.toLowerCase();return void 0!==ae[t]&&le[ae[t]]?le[ae[t]]:void 0}},pe={MERIT:{a:6378137,rf:298.257,ellipseName:"MERIT 1983"},SGS85:{a:6378136,rf:298.257,ellipseName:"Soviet Geodetic System 85"},GRS80:{a:6378137,rf:298.257222101,ellipseName:"GRS 1980(IUGG, 1980)"},IAU76:{a:6378140,rf:298.257,ellipseName:"IAU 1976"},airy:{a:6377563.396,b:6356256.91,ellipseName:"Airy 1830"},APL4:{a:6378137,rf:298.25,ellipseName:"Appl. Physics. 1965"},NWL9D:{a:6378145,rf:298.25,ellipseName:"Naval Weapons Lab., 1965"},mod_airy:{a:6377340.189,b:6356034.446,ellipseName:"Modified Airy"},andrae:{a:6377104.43,rf:300,ellipseName:"Andrae 1876 (Den., Iclnd.)"},aust_SA:{a:6378160,rf:298.25,ellipseName:"Australian Natl & S. Amer. 1969"},GRS67:{a:6378160,rf:298.247167427,ellipseName:"GRS 67(IUGG 1967)"},bessel:{a:6377397.155,rf:299.1528128,ellipseName:"Bessel 1841"},bess_nam:{a:6377483.865,rf:299.1528128,ellipseName:"Bessel 1841 (Namibia)"},clrk66:{a:6378206.4,b:6356583.8,ellipseName:"Clarke 1866"},clrk80:{a:6378249.145,rf:293.4663,ellipseName:"Clarke 1880 mod."},clrk58:{a:6378293.645208759,rf:294.2606763692654,ellipseName:"Clarke 1858"},CPM:{a:6375738.7,rf:334.29,ellipseName:"Comm. des Poids et Mesures 1799"},delmbr:{a:6376428,rf:311.5,ellipseName:"Delambre 1810 (Belgium)"},engelis:{a:6378136.05,rf:298.2566,ellipseName:"Engelis 1985"},evrst30:{a:6377276.345,rf:300.8017,ellipseName:"Everest 1830"},evrst48:{a:6377304.063,rf:300.8017,ellipseName:"Everest 1948"},evrst56:{a:6377301.243,rf:300.8017,ellipseName:"Everest 1956"},evrst69:{a:6377295.664,rf:300.8017,ellipseName:"Everest 1969"},evrstSS:{a:6377298.556,rf:300.8017,ellipseName:"Everest (Sabah & Sarawak)"},fschr60:{a:6378166,rf:298.3,ellipseName:"Fischer (Mercury Datum) 1960"},fschr60m:{a:6378155,rf:298.3,ellipseName:"Fischer 1960"},fschr68:{a:6378150,rf:298.3,ellipseName:"Fischer 1968"},helmert:{a:6378200,rf:298.3,ellipseName:"Helmert 1906"},hough:{a:6378270,rf:297,ellipseName:"Hough"},intl:{a:6378388,rf:297,ellipseName:"International 1909 (Hayford)"},kaula:{a:6378163,rf:298.24,ellipseName:"Kaula 1961"},lerch:{a:6378139,rf:298.257,ellipseName:"Lerch 1979"},mprts:{a:6397300,rf:191,ellipseName:"Maupertius 1738"},new_intl:{a:6378157.5,b:6356772.2,ellipseName:"New International 1967"},plessis:{a:6376523,rf:6355863,ellipseName:"Plessis 1817 (France)"},krass:{a:6378245,rf:298.3,ellipseName:"Krassovsky, 1942"},SEasia:{a:6378155,b:6356773.3205,ellipseName:"Southeast Asia"},walbeck:{a:6376896,b:6355834.8467,ellipseName:"Walbeck"},WGS60:{a:6378165,rf:298.3,ellipseName:"WGS 60"},WGS66:{a:6378145,rf:298.25,ellipseName:"WGS 66"},WGS7:{a:6378135,rf:298.26,ellipseName:"WGS 72"}},ce=pe.WGS84={a:6378137,rf:298.257223563,ellipseName:"WGS 84"};pe.sphere={a:6370997,b:6370997,ellipseName:"Normal Sphere (r=6370997)"};var ue={wgs84:{towgs84:"0,0,0",ellipse:"WGS84",datumName:"WGS84"},ch1903:{towgs84:"674.374,15.056,405.346",ellipse:"bessel",datumName:"swiss"},ggrs87:{towgs84:"-199.87,74.79,246.62",ellipse:"GRS80",datumName:"Greek_Geodetic_Reference_System_1987"},nad83:{towgs84:"0,0,0",ellipse:"GRS80",datumName:"North_American_Datum_1983"},nad27:{nadgrids:"@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat",ellipse:"clrk66",datumName:"North_American_Datum_1927"},potsdam:{towgs84:"606.0,23.0,413.0",ellipse:"bessel",datumName:"Potsdam Rauenberg 1950 DHDN"},carthage:{towgs84:"-263.0,6.0,431.0",ellipse:"clark80",datumName:"Carthage 1934 Tunisia"},hermannskogel:{towgs84:"653.0,-212.0,449.0",ellipse:"bessel",datumName:"Hermannskogel"},ire65:{towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"mod_airy",datumName:"Ireland 1965"},rassadiran:{towgs84:"-133.63,-157.5,-158.62",ellipse:"intl",datumName:"Rassadiran"},nzgd49:{towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993",ellipse:"intl",datumName:"New Zealand Geodetic Datum 1949"},osgb36:{towgs84:"446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894",ellipse:"airy",datumName:"Airy 1830"},s_jtsk:{towgs84:"589,76,480",ellipse:"bessel",datumName:"S-JTSK (Ferro)"},beduaram:{towgs84:"-106,-87,188",ellipse:"clrk80",datumName:"Beduaram"},gunung_segara:{towgs84:"-403,684,41",ellipse:"bessel",datumName:"Gunung Segara Jakarta"},rnb72:{towgs84:"106.869,-52.2978,103.724,-0.33657,0.456955,-1.84218,1",ellipse:"intl",datumName:"Reseau National Belge 1972"}};u.projections=se,u.projections.start();var ge=function(e,t,o){return function(e,t){return e.datum_type===t.datum_type&&!(e.a!==t.a||Math.abs(e.es-t.es)>5e-11)&&(e.datum_type===L?e.datum_params[0]===t.datum_params[0]&&e.datum_params[1]===t.datum_params[1]&&e.datum_params[2]===t.datum_params[2]:e.datum_type!==w||e.datum_params[0]===t.datum_params[0]&&e.datum_params[1]===t.datum_params[1]&&e.datum_params[2]===t.datum_params[2]&&e.datum_params[3]===t.datum_params[3]&&e.datum_params[4]===t.datum_params[4]&&e.datum_params[5]===t.datum_params[5]&&e.datum_params[6]===t.datum_params[6])}(e,t)?o:e.datum_type===R||t.datum_type===R?o:e.es!==t.es||e.a!==t.a||g(e.datum_type)||g(t.datum_type)?(o=function(e,t,o){var r,i,n,a,l=e.x,s=e.y,p=e.z?e.z:0;if(s<-M&&s>-1.001*M)s=-M;else if(s>M&&s<1.001*M)s=M;else if(s<-M||s>M)return null;return l>Math.PI&&(l-=2*Math.PI),i=Math.sin(s),a=Math.cos(s),n=i*i,{x:((r=o/Math.sqrt(1-t*n))+p)*a*Math.cos(l),y:(r+p)*a*Math.sin(l),z:(r*(1-t)+p)*i}}(o,e.es,e.a),g(e.datum_type)&&(o=function(e,t,o){if(t===L)return{x:e.x+o[0],y:e.y+o[1],z:e.z+o[2]};if(t===w){var r=o[0],i=o[1],n=o[2],a=o[3],l=o[4],s=o[5],p=o[6];return{x:p*(e.x-s*e.y+l*e.z)+r,y:p*(s*e.x+e.y-a*e.z)+i,z:p*(-l*e.x+a*e.y+e.z)+n}}}(o,e.datum_type,e.datum_params)),g(t.datum_type)&&(o=function(e,t,o){if(t===L)return{x:e.x-o[0],y:e.y-o[1],z:e.z-o[2]};if(t===w){var r=o[0],i=o[1],n=o[2],a=o[3],l=o[4],s=o[5],p=o[6],c=(e.x-r)/p,u=(e.y-i)/p,g=(e.z-n)/p;return{x:c+s*u-l*g,y:-s*c+u+a*g,z:l*c-a*u+g}}}(o,t.datum_type,t.datum_params)),function(e,t,o,r){var i,n,a,l,s,p,c,u,g,d,h,f,y,m,v,C=1e-12,T=e.x,S=e.y,_=e.z?e.z:0;if(i=Math.sqrt(T*T+S*S),n=Math.sqrt(T*T+S*S+_*_),i/o<C){if(m=0,n/o<C)return v=-r,{x:e.x,y:e.y,z:e.z}}else m=Math.atan2(S,T);a=_/n,u=(l=i/n)*(1-t)*(s=1/Math.sqrt(1-t*(2-t)*l*l)),g=a*s,y=0;do{y++,p=t*(c=o/Math.sqrt(1-t*g*g))/(c+(v=i*u+_*g-c*(1-t*g*g))),f=(h=a*(s=1/Math.sqrt(1-p*(2-p)*l*l)))*u-(d=l*(1-p)*s)*g,u=d,g=h}while(f*f>1e-24&&y<30);return{x:m,y:Math.atan(h/Math.abs(d)),z:v}}(o,t.es,t.a,t.b)):o},de=function(e,t,o){var r,i,n,a=o.x,l=o.y,s=o.z||0,p={};for(n=0;n<3;n++)if(!t||2!==n||void 0!==o.z)switch(0===n?(r=a,i="x"):1===n?(r=l,i="y"):(r=s,i="z"),e.axis[n]){case"e":p[i]=r;break;case"w":p[i]=-r;break;case"n":p[i]=r;break;case"s":p[i]=-r;break;case"u":void 0!==o[i]&&(p.z=r);break;case"d":void 0!==o[i]&&(p.z=-r);break;default:return null}return p},he=function(e){var t={x:e[0],y:e[1]};return e.length>2&&(t.z=e[2]),e.length>3&&(t.m=e[3]),t},fe=u("WGS84"),ye=6,me="AJSAJS",ve="AFAFAF",Ce=65,Te=73,Se=79,_e=86,Ee=90,xe={forward:m,inverse:function(e){var t=S(E(e.toUpperCase()));return t.lat&&t.lon?[t.lon,t.lat,t.lon,t.lat]:[t.left,t.bottom,t.right,t.top]},toPoint:v};P.fromMGRS=function(e){return new P(v(e))},P.prototype.toMGRS=function(e){return m([this.x,this.y],e)};var Pe,Le=.01953125,we=.01068115234375,be=function(e){var t=[];t[0]=1-e*(.25+e*(.046875+e*(Le+e*we))),t[1]=e*(.75-e*(.046875+e*(Le+e*we)));var o=e*e;return t[2]=o*(.46875-e*(.013020833333333334+.007120768229166667*e)),o*=e,t[3]=o*(.3645833333333333-.005696614583333333*e),t[4]=o*e*.3076171875,t},Re=function(e,t,o,r){return o*=t,t*=t,r[0]*e-o*(r[1]+t*(r[2]+t*(r[3]+t*r[4])))},Ae=function(e,t,o){for(var r=1/(1-t),i=e,n=20;n;--n){var a=Math.sin(i),l=1-t*a*a;if(i-=l=(Re(i,a,Math.cos(i),o)-e)*(l*Math.sqrt(l))*r,Math.abs(l)<D)return i}return i},Me={init:function(){this.x0=void 0!==this.x0?this.x0:0,this.y0=void 0!==this.y0?this.y0:0,this.long0=void 0!==this.long0?this.long0:0,this.lat0=void 0!==this.lat0?this.lat0:0,this.es&&(this.en=be(this.es),this.ml0=Re(this.lat0,Math.sin(this.lat0),Math.cos(this.lat0),this.en))},forward:function(e){var t,o,r,i=e.x,n=e.y,a=oe(i-this.long0),l=Math.sin(n),s=Math.cos(n);if(this.es){var p=s*a,c=Math.pow(p,2),u=this.ep2*Math.pow(s,2),g=Math.pow(u,2),d=Math.abs(s)>D?Math.tan(n):0,h=Math.pow(d,2),f=Math.pow(h,2);t=1-this.es*Math.pow(l,2),p/=Math.sqrt(t);var y=Re(n,l,s,this.en);o=this.a*(this.k0*p*(1+c/6*(1-h+u+c/20*(5-18*h+f+14*u-58*h*u+c/42*(61+179*f-f*h-479*h)))))+this.x0,r=this.a*(this.k0*(y-this.ml0+l*a*p/2*(1+c/12*(5-h+9*u+4*g+c/30*(61+f-58*h+270*u-330*h*u+c/56*(1385+543*f-f*h-3111*h))))))+this.y0}else{var m=s*Math.sin(a);if(Math.abs(Math.abs(m)-1)<D)return 93;if(o=.5*this.a*this.k0*Math.log((1+m)/(1-m))+this.x0,r=s*Math.cos(a)/Math.sqrt(1-Math.pow(m,2)),(m=Math.abs(r))>=1){if(m-1>D)return 93;r=0}else r=Math.acos(r);n<0&&(r=-r),r=this.a*this.k0*(r-this.lat0)+this.y0}return e.x=o,e.y=r,e},inverse:function(e){var t,o,r,i,n=(e.x-this.x0)*(1/this.a),a=(e.y-this.y0)*(1/this.a);if(this.es)if(t=this.ml0+a/this.k0,o=Ae(t,this.es,this.en),Math.abs(o)<M){var l=Math.sin(o),s=Math.cos(o),p=Math.abs(s)>D?Math.tan(o):0,c=this.ep2*Math.pow(s,2),u=Math.pow(c,2),g=Math.pow(p,2),d=Math.pow(g,2);t=1-this.es*Math.pow(l,2);var h=n*Math.sqrt(t)/this.k0,f=Math.pow(h,2);r=o-(t*=p)*f/(1-this.es)*.5*(1-f/12*(5+3*g-9*c*g+c-4*u-f/30*(61+90*g-252*c*g+45*d+46*c-f/56*(1385+3633*g+4095*d+1574*d*g)))),i=oe(this.long0+h*(1-f/6*(1+2*g+c-f/20*(5+28*g+24*d+8*c*g+6*c-f/42*(61+662*g+1320*d+720*d*g))))/s)}else r=M*te(a),i=0;else{var y=Math.exp(n/this.k0),m=.5*(y-1/y),v=this.lat0+a/this.k0,C=Math.cos(v);t=Math.sqrt((1-Math.pow(C,2))/(1+Math.pow(m,2))),r=Math.asin(t),a<0&&(r=-r),i=0===m&&0===C?0:oe(Math.atan2(m,C)+this.long0)}return e.x=i,e.y=r,e},names:["Transverse_Mercator","Transverse Mercator","tmerc"]},Ie=function(e){var t=Math.exp(e);return(t-1/t)/2},Oe=function(e,t){e=Math.abs(e),t=Math.abs(t);var o=Math.max(e,t),r=Math.min(e,t)/(o||1);return o*Math.sqrt(1+Math.pow(r,2))},Ne=function(e){var t=Math.abs(e);return t=function(e){var t=1+e,o=t-1;return 0===o?e:e*Math.log(t)/o}(t*(1+t/(Oe(1,t)+1))),e<0?-t:t},De=function(e,t){for(var o,r=2*Math.cos(2*t),i=e.length-1,n=e[i],a=0;--i>=0;)o=r*n-a+e[i],a=n,n=o;return t+o*Math.sin(2*t)},Fe=function(e,t){for(var o,r=2*Math.cos(t),i=e.length-1,n=e[i],a=0;--i>=0;)o=r*n-a+e[i],a=n,n=o;return Math.sin(t)*o},ke=function(e,t,o){for(var r,i,n=Math.sin(t),a=Math.cos(t),l=Ie(o),s=function(e){var t=Math.exp(e);return(t+1/t)/2}(o),p=2*a*s,c=-2*n*l,u=e.length-1,g=e[u],d=0,h=0,f=0;--u>=0;)r=h,i=d,g=p*(h=g)-r-c*(d=f)+e[u],f=c*h-i+p*d;return[(p=n*s)*g-(c=a*l)*f,p*f+c*g]},Ge={init:function(){if(void 0===this.es||this.es<=0)throw new Error("incorrect elliptical usage");this.x0=void 0!==this.x0?this.x0:0,this.y0=void 0!==this.y0?this.y0:0,this.long0=void 0!==this.long0?this.long0:0,this.lat0=void 0!==this.lat0?this.lat0:0,this.cgb=[],this.cbg=[],this.utg=[],this.gtu=[];var e=this.es/(1+Math.sqrt(1-this.es)),t=e/(2-e),o=t;this.cgb[0]=t*(2+t*(-2/3+t*(t*(116/45+t*(26/45+t*(-2854/675)))-2))),this.cbg[0]=t*(t*(2/3+t*(4/3+t*(-82/45+t*(32/45+t*(4642/4725)))))-2),o*=t,this.cgb[1]=o*(7/3+t*(t*(-227/45+t*(2704/315+t*(2323/945)))-1.6)),this.cbg[1]=o*(5/3+t*(-16/15+t*(-13/9+t*(904/315+t*(-1522/945))))),o*=t,this.cgb[2]=o*(56/15+t*(-136/35+t*(-1262/105+t*(73814/2835)))),this.cbg[2]=o*(-26/15+t*(34/21+t*(1.6+t*(-12686/2835)))),o*=t,this.cgb[3]=o*(4279/630+t*(-332/35+t*(-399572/14175))),this.cbg[3]=o*(1237/630+t*(t*(-24832/14175)-2.4)),o*=t,this.cgb[4]=o*(4174/315+t*(-144838/6237)),this.cbg[4]=o*(-734/315+t*(109598/31185)),o*=t,this.cgb[5]=o*(601676/22275),this.cbg[5]=o*(444337/155925),o=Math.pow(t,2),this.Qn=this.k0/(1+t)*(1+o*(.25+o*(1/64+o/256))),this.utg[0]=t*(t*(2/3+t*(-37/96+t*(1/360+t*(81/512+t*(-96199/604800)))))-.5),this.gtu[0]=t*(.5+t*(-2/3+t*(5/16+t*(41/180+t*(-127/288+t*(7891/37800)))))),this.utg[1]=o*(-1/48+t*(-1/15+t*(437/1440+t*(-46/105+t*(1118711/3870720))))),this.gtu[1]=o*(13/48+t*(t*(557/1440+t*(281/630+t*(-1983433/1935360)))-.6)),o*=t,this.utg[2]=o*(-17/480+t*(37/840+t*(209/4480+t*(-5569/90720)))),this.gtu[2]=o*(61/240+t*(-103/140+t*(15061/26880+t*(167603/181440)))),o*=t,this.utg[3]=o*(-4397/161280+t*(11/504+t*(830251/7257600))),this.gtu[3]=o*(49561/161280+t*(-179/168+t*(6601661/7257600))),o*=t,this.utg[4]=o*(-4583/161280+t*(108847/3991680)),this.gtu[4]=o*(34729/80640+t*(-3418889/1995840)),o*=t,this.utg[5]=-.03233083094085698*o,this.gtu[5]=.6650675310896665*o;var r=De(this.cbg,this.lat0);this.Zb=-this.Qn*(r+Fe(this.gtu,2*r))},forward:function(e){var t=oe(e.x-this.long0),o=e.y;o=De(this.cbg,o);var r=Math.sin(o),i=Math.cos(o),n=Math.sin(t),a=Math.cos(t);o=Math.atan2(r,a*i),t=Math.atan2(n*i,Oe(r,i*a)),t=Ne(Math.tan(t));var l,s,p=ke(this.gtu,2*o,2*t);o+=p[0],t+=p[1];return Math.abs(t)<=2.623395162778?(l=this.a*(this.Qn*t)+this.x0,s=this.a*(this.Qn*o+this.Zb)+this.y0):(l=1/0,s=1/0),e.x=l,e.y=s,e},inverse:function(e){var t,o,r=(e.x-this.x0)*(1/this.a),i=(e.y-this.y0)*(1/this.a);i=(i-this.Zb)/this.Qn,r/=this.Qn;if(Math.abs(r)<=2.623395162778){var n=ke(this.utg,2*i,2*r);i+=n[0],r+=n[1],r=Math.atan(Ie(r));var a=Math.sin(i),l=Math.cos(i),s=Math.sin(r),p=Math.cos(r);i=Math.atan2(a*p,Oe(s,p*l)),r=Math.atan2(s,p*l),t=oe(r+this.long0),o=De(this.cgb,i)}else t=1/0,o=1/0;return e.x=t,e.y=o,e},names:["Extended_Transverse_Mercator","Extended Transverse Mercator","etmerc"]},Ue=function(e,t){if(void 0===e){if((e=Math.floor(30*(oe(t)+Math.PI)/Math.PI)+1)<0)return 0;if(e>60)return 60}return e},Be={init:function(){var e=Ue(this.zone,this.long0);if(void 0===e)throw new Error("unknown utm zone");this.lat0=0,this.long0=(6*Math.abs(e)-183)*F,this.x0=5e5,this.y0=this.utmSouth?1e7:0,this.k0=.9996,Ge.init.apply(this),this.forward=Ge.forward,this.inverse=Ge.inverse},names:["Universal Transverse Mercator System","utm"],dependsOn:"etmerc"},$e=function(e,t){return Math.pow((1-e)/(1+e),t)},qe=20,je={init:function(){var e=Math.sin(this.lat0),t=Math.cos(this.lat0);t*=t,this.rc=Math.sqrt(1-this.es)/(1-this.es*e*e),this.C=Math.sqrt(1+this.es*t*t/(1-this.es)),this.phic0=Math.asin(e/this.C),this.ratexp=.5*this.C*this.e,this.K=Math.tan(.5*this.phic0+G)/(Math.pow(Math.tan(.5*this.lat0+G),this.C)*$e(this.e*e,this.ratexp))},forward:function(e){var t=e.x,o=e.y;return e.y=2*Math.atan(this.K*Math.pow(Math.tan(.5*o+G),this.C)*$e(this.e*Math.sin(o),this.ratexp))-M,e.x=this.C*t,e},inverse:function(e){for(var t=e.x/this.C,o=e.y,r=Math.pow(Math.tan(.5*o+G)/this.K,1/this.C),i=qe;i>0&&(o=2*Math.atan(r*$e(this.e*Math.sin(e.y),-.5*this.e))-M,!(Math.abs(o-e.y)<1e-14));--i)e.y=o;return i?(e.x=t,e.y=o,e):null},names:["gauss"]},We={init:function(){je.init.apply(this),this.rc&&(this.sinc0=Math.sin(this.phic0),this.cosc0=Math.cos(this.phic0),this.R2=2*this.rc,this.title||(this.title="Oblique Stereographic Alternative"))},forward:function(e){var t,o,r,i;return e.x=oe(e.x-this.long0),je.forward.apply(this,[e]),t=Math.sin(e.y),o=Math.cos(e.y),r=Math.cos(e.x),i=this.k0*this.R2/(1+this.sinc0*t+this.cosc0*o*r),e.x=i*o*Math.sin(e.x),e.y=i*(this.cosc0*t-this.sinc0*o*r),e.x=this.a*e.x+this.x0,e.y=this.a*e.y+this.y0,e},inverse:function(e){var t,o,r,i,n;if(e.x=(e.x-this.x0)/this.a,e.y=(e.y-this.y0)/this.a,e.x/=this.k0,e.y/=this.k0,n=Math.sqrt(e.x*e.x+e.y*e.y)){var a=2*Math.atan2(n,this.R2);t=Math.sin(a),o=Math.cos(a),i=Math.asin(o*this.sinc0+e.y*t*this.cosc0/n),r=Math.atan2(e.x*t,n*this.cosc0*o-e.y*this.sinc0*t)}else i=this.phic0,r=0;return e.x=r,e.y=i,je.inverse.apply(this,[e]),e.x=oe(e.x+this.long0),e},names:["Stereographic_North_Pole","Oblique_Stereographic","Polar_Stereographic","sterea","Oblique Stereographic Alternative"]},Ve={init:function(){this.coslat0=Math.cos(this.lat0),this.sinlat0=Math.sin(this.lat0),this.sphere?1===this.k0&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=D&&(this.k0=.5*(1+te(this.lat0)*Math.sin(this.lat_ts))):(Math.abs(this.coslat0)<=D&&(this.lat0>0?this.con=1:this.con=-1),this.cons=Math.sqrt(Math.pow(1+this.e,1+this.e)*Math.pow(1-this.e,1-this.e)),1===this.k0&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=D&&(this.k0=.5*this.cons*ee(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts))/re(this.e,this.con*this.lat_ts,this.con*Math.sin(this.lat_ts))),this.ms1=ee(this.e,this.sinlat0,this.coslat0),this.X0=2*Math.atan(this.ssfn_(this.lat0,this.sinlat0,this.e))-M,this.cosX0=Math.cos(this.X0),this.sinX0=Math.sin(this.X0))},forward:function(e){var t,o,r,i,n,a,l=e.x,s=e.y,p=Math.sin(s),c=Math.cos(s),u=oe(l-this.long0);return Math.abs(Math.abs(l-this.long0)-Math.PI)<=D&&Math.abs(s+this.lat0)<=D?(e.x=NaN,e.y=NaN,e):this.sphere?(t=2*this.k0/(1+this.sinlat0*p+this.coslat0*c*Math.cos(u)),e.x=this.a*t*c*Math.sin(u)+this.x0,e.y=this.a*t*(this.coslat0*p-this.sinlat0*c*Math.cos(u))+this.y0,e):(o=2*Math.atan(this.ssfn_(s,p,this.e))-M,i=Math.cos(o),r=Math.sin(o),Math.abs(this.coslat0)<=D?(n=re(this.e,s*this.con,this.con*p),a=2*this.a*this.k0*n/this.cons,e.x=this.x0+a*Math.sin(l-this.long0),e.y=this.y0-this.con*a*Math.cos(l-this.long0),e):(Math.abs(this.sinlat0)<D?(t=2*this.a*this.k0/(1+i*Math.cos(u)),e.y=t*r):(t=2*this.a*this.k0*this.ms1/(this.cosX0*(1+this.sinX0*r+this.cosX0*i*Math.cos(u))),e.y=t*(this.cosX0*r-this.sinX0*i*Math.cos(u))+this.y0),e.x=t*i*Math.sin(u)+this.x0,e))},inverse:function(e){e.x-=this.x0,e.y-=this.y0;var t,o,r,i,n,a=Math.sqrt(e.x*e.x+e.y*e.y);if(this.sphere){var l=2*Math.atan(a/(.5*this.a*this.k0));return t=this.long0,o=this.lat0,a<=D?(e.x=t,e.y=o,e):(o=Math.asin(Math.cos(l)*this.sinlat0+e.y*Math.sin(l)*this.coslat0/a),t=oe(Math.abs(this.coslat0)<D?this.lat0>0?this.long0+Math.atan2(e.x,-1*e.y):this.long0+Math.atan2(e.x,e.y):this.long0+Math.atan2(e.x*Math.sin(l),a*this.coslat0*Math.cos(l)-e.y*this.sinlat0*Math.sin(l))),e.x=t,e.y=o,e)}if(Math.abs(this.coslat0)<=D){if(a<=D)return o=this.lat0,t=this.long0,e.x=t,e.y=o,e;e.x*=this.con,e.y*=this.con,r=a*this.cons/(2*this.a*this.k0),o=this.con*ie(this.e,r),t=this.con*oe(this.con*this.long0+Math.atan2(e.x,-1*e.y))}else i=2*Math.atan(a*this.cosX0/(2*this.a*this.k0*this.ms1)),t=this.long0,a<=D?n=this.X0:(n=Math.asin(Math.cos(i)*this.sinX0+e.y*Math.sin(i)*this.cosX0/a),t=oe(this.long0+Math.atan2(e.x*Math.sin(i),a*this.cosX0*Math.cos(i)-e.y*this.sinX0*Math.sin(i)))),o=-1*ie(this.e,Math.tan(.5*(M+n)));return e.x=t,e.y=o,e},names:["stere","Stereographic_South_Pole","Polar Stereographic (variant B)"],ssfn_:function(e,t,o){return t*=o,Math.tan(.5*(M+e))*Math.pow((1-t)/(1+t),.5*o)}},Ye={init:function(){var e=this.lat0;this.lambda0=this.long0;var t=Math.sin(e),o=this.a,r=1/this.rf,i=2*r-Math.pow(r,2),n=this.e=Math.sqrt(i);this.R=this.k0*o*Math.sqrt(1-i)/(1-i*Math.pow(t,2)),this.alpha=Math.sqrt(1+i/(1-i)*Math.pow(Math.cos(e),4)),this.b0=Math.asin(t/this.alpha);var a=Math.log(Math.tan(Math.PI/4+this.b0/2)),l=Math.log(Math.tan(Math.PI/4+e/2)),s=Math.log((1+n*t)/(1-n*t));this.K=a-this.alpha*l+this.alpha*n/2*s},forward:function(e){var t=Math.log(Math.tan(Math.PI/4-e.y/2)),o=this.e/2*Math.log((1+this.e*Math.sin(e.y))/(1-this.e*Math.sin(e.y))),r=-this.alpha*(t+o)+this.K,i=2*(Math.atan(Math.exp(r))-Math.PI/4),n=this.alpha*(e.x-this.lambda0),a=Math.atan(Math.sin(n)/(Math.sin(this.b0)*Math.tan(i)+Math.cos(this.b0)*Math.cos(n))),l=Math.asin(Math.cos(this.b0)*Math.sin(i)-Math.sin(this.b0)*Math.cos(i)*Math.cos(n));return e.y=this.R/2*Math.log((1+Math.sin(l))/(1-Math.sin(l)))+this.y0,e.x=this.R*a+this.x0,e},inverse:function(e){for(var t=e.x-this.x0,o=e.y-this.y0,r=t/this.R,i=2*(Math.atan(Math.exp(o/this.R))-Math.PI/4),n=Math.asin(Math.cos(this.b0)*Math.sin(i)+Math.sin(this.b0)*Math.cos(i)*Math.cos(r)),a=Math.atan(Math.sin(r)/(Math.cos(this.b0)*Math.cos(r)-Math.sin(this.b0)*Math.tan(i))),l=this.lambda0+a/this.alpha,s=0,p=n,c=-1e3,u=0;Math.abs(p-c)>1e-7;){if(++u>20)return;s=1/this.alpha*(Math.log(Math.tan(Math.PI/4+n/2))-this.K)+this.e*Math.log(Math.tan(Math.PI/4+Math.asin(this.e*Math.sin(p))/2)),c=p,p=2*Math.atan(Math.exp(s))-Math.PI/2}return e.x=l,e.y=p,e},names:["somerc"]},Ke={init:function(){this.no_off=this.no_off||!1,this.no_rot=this.no_rot||!1,isNaN(this.k0)&&(this.k0=1);var e=Math.sin(this.lat0),t=Math.cos(this.lat0),o=this.e*e;this.bl=Math.sqrt(1+this.es/(1-this.es)*Math.pow(t,4)),this.al=this.a*this.bl*this.k0*Math.sqrt(1-this.es)/(1-o*o);var r,i,n=re(this.e,this.lat0,e),a=this.bl/t*Math.sqrt((1-this.es)/(1-o*o));a*a<1&&(a=1);if(isNaN(this.longc)){var l=re(this.e,this.lat1,Math.sin(this.lat1)),s=re(this.e,this.lat2,Math.sin(this.lat2));this.lat0>=0?this.el=(a+Math.sqrt(a*a-1))*Math.pow(n,this.bl):this.el=(a-Math.sqrt(a*a-1))*Math.pow(n,this.bl);var p=Math.pow(l,this.bl),c=Math.pow(s,this.bl);i=.5*((r=this.el/p)-1/r);var u=(this.el*this.el-c*p)/(this.el*this.el+c*p),g=(c-p)/(c+p),d=oe(this.long1-this.long2);this.long0=.5*(this.long1+this.long2)-Math.atan(u*Math.tan(.5*this.bl*d)/g)/this.bl,this.long0=oe(this.long0);var h=oe(this.long1-this.long0);this.gamma0=Math.atan(Math.sin(this.bl*h)/i),this.alpha=Math.asin(a*Math.sin(this.gamma0))}else r=this.lat0>=0?a+Math.sqrt(a*a-1):a-Math.sqrt(a*a-1),this.el=r*Math.pow(n,this.bl),i=.5*(r-1/r),this.gamma0=Math.asin(Math.sin(this.alpha)/a),this.long0=this.longc-Math.asin(i*Math.tan(this.gamma0))/this.bl;this.no_off?this.uc=0:this.lat0>=0?this.uc=this.al/this.bl*Math.atan2(Math.sqrt(a*a-1),Math.cos(this.alpha)):this.uc=-1*this.al/this.bl*Math.atan2(Math.sqrt(a*a-1),Math.cos(this.alpha))},forward:function(e){var t,o,r,i=e.x,n=e.y,a=oe(i-this.long0);if(Math.abs(Math.abs(n)-M)<=D)r=n>0?-1:1,o=this.al/this.bl*Math.log(Math.tan(G+r*this.gamma0*.5)),t=-1*r*M*this.al/this.bl;else{var l=re(this.e,n,Math.sin(n)),s=this.el/Math.pow(l,this.bl),p=.5*(s-1/s),c=.5*(s+1/s),u=Math.sin(this.bl*a),g=(p*Math.sin(this.gamma0)-u*Math.cos(this.gamma0))/c;o=Math.abs(Math.abs(g)-1)<=D?Number.POSITIVE_INFINITY:.5*this.al*Math.log((1-g)/(1+g))/this.bl,t=Math.abs(Math.cos(this.bl*a))<=D?this.al*this.bl*a:this.al*Math.atan2(p*Math.cos(this.gamma0)+u*Math.sin(this.gamma0),Math.cos(this.bl*a))/this.bl}return this.no_rot?(e.x=this.x0+t,e.y=this.y0+o):(t-=this.uc,e.x=this.x0+o*Math.cos(this.alpha)+t*Math.sin(this.alpha),e.y=this.y0+t*Math.cos(this.alpha)-o*Math.sin(this.alpha)),e},inverse:function(e){var t,o;this.no_rot?(o=e.y-this.y0,t=e.x-this.x0):(o=(e.x-this.x0)*Math.cos(this.alpha)-(e.y-this.y0)*Math.sin(this.alpha),t=(e.y-this.y0)*Math.cos(this.alpha)+(e.x-this.x0)*Math.sin(this.alpha),t+=this.uc);var r=Math.exp(-1*this.bl*o/this.al),i=.5*(r-1/r),n=.5*(r+1/r),a=Math.sin(this.bl*t/this.al),l=(a*Math.cos(this.gamma0)+i*Math.sin(this.gamma0))/n,s=Math.pow(this.el/Math.sqrt((1+l)/(1-l)),1/this.bl);return Math.abs(l-1)<D?(e.x=this.long0,e.y=M):Math.abs(l+1)<D?(e.x=this.long0,e.y=-1*M):(e.y=ie(this.e,s),e.x=oe(this.long0-Math.atan2(i*Math.cos(this.gamma0)-a*Math.sin(this.gamma0),Math.cos(this.bl*t/this.al))/this.bl)),e},names:["Hotine_Oblique_Mercator","Hotine Oblique Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin","Hotine_Oblique_Mercator_Azimuth_Center","omerc"]},Xe={init:function(){if(this.lat2||(this.lat2=this.lat1),this.k0||(this.k0=1),this.x0=this.x0||0,this.y0=this.y0||0,!(Math.abs(this.lat1+this.lat2)<D)){var e=this.b/this.a;this.e=Math.sqrt(1-e*e);var t=Math.sin(this.lat1),o=Math.cos(this.lat1),r=ee(this.e,t,o),i=re(this.e,this.lat1,t),n=Math.sin(this.lat2),a=Math.cos(this.lat2),l=ee(this.e,n,a),s=re(this.e,this.lat2,n),p=re(this.e,this.lat0,Math.sin(this.lat0));Math.abs(this.lat1-this.lat2)>D?this.ns=Math.log(r/l)/Math.log(i/s):this.ns=t,isNaN(this.ns)&&(this.ns=t),this.f0=r/(this.ns*Math.pow(i,this.ns)),this.rh=this.a*this.f0*Math.pow(p,this.ns),this.title||(this.title="Lambert Conformal Conic")}},forward:function(e){var t=e.x,o=e.y;Math.abs(2*Math.abs(o)-Math.PI)<=D&&(o=te(o)*(M-2*D));var r,i,n=Math.abs(Math.abs(o)-M);if(n>D)r=re(this.e,o,Math.sin(o)),i=this.a*this.f0*Math.pow(r,this.ns);else{if((n=o*this.ns)<=0)return null;i=0}var a=this.ns*oe(t-this.long0);return e.x=this.k0*(i*Math.sin(a))+this.x0,e.y=this.k0*(this.rh-i*Math.cos(a))+this.y0,e},inverse:function(e){var t,o,r,i,n,a=(e.x-this.x0)/this.k0,l=this.rh-(e.y-this.y0)/this.k0;this.ns>0?(t=Math.sqrt(a*a+l*l),o=1):(t=-Math.sqrt(a*a+l*l),o=-1);var s=0;if(0!==t&&(s=Math.atan2(o*a,o*l)),0!==t||this.ns>0){if(o=1/this.ns,r=Math.pow(t/(this.a*this.f0),o),-9999===(i=ie(this.e,r)))return null}else i=-M;return n=oe(s/this.ns+this.long0),e.x=n,e.y=i,e},names:["Lambert Tangential Conformal Conic Projection","Lambert_Conformal_Conic","Lambert_Conformal_Conic_2SP","lcc"]},He={init:function(){this.a=6377397.155,this.es=.006674372230614,this.e=Math.sqrt(this.es),this.lat0||(this.lat0=.863937979737193),this.long0||(this.long0=.4334234309119251),this.k0||(this.k0=.9999),this.s45=.785398163397448,this.s90=2*this.s45,this.fi0=this.lat0,this.e2=this.es,this.e=Math.sqrt(this.e2),this.alfa=Math.sqrt(1+this.e2*Math.pow(Math.cos(this.fi0),4)/(1-this.e2)),this.uq=1.04216856380474,this.u0=Math.asin(Math.sin(this.fi0)/this.alfa),this.g=Math.pow((1+this.e*Math.sin(this.fi0))/(1-this.e*Math.sin(this.fi0)),this.alfa*this.e/2),this.k=Math.tan(this.u0/2+this.s45)/Math.pow(Math.tan(this.fi0/2+this.s45),this.alfa)*this.g,this.k1=this.k0,this.n0=this.a*Math.sqrt(1-this.e2)/(1-this.e2*Math.pow(Math.sin(this.fi0),2)),this.s0=1.37008346281555,this.n=Math.sin(this.s0),this.ro0=this.k1*this.n0/Math.tan(this.s0),this.ad=this.s90-this.uq},forward:function(e){var t,o,r,i,n,a,l,s=e.x,p=e.y,c=oe(s-this.long0);return t=Math.pow((1+this.e*Math.sin(p))/(1-this.e*Math.sin(p)),this.alfa*this.e/2),o=2*(Math.atan(this.k*Math.pow(Math.tan(p/2+this.s45),this.alfa)/t)-this.s45),r=-c*this.alfa,i=Math.asin(Math.cos(this.ad)*Math.sin(o)+Math.sin(this.ad)*Math.cos(o)*Math.cos(r)),n=Math.asin(Math.cos(o)*Math.sin(r)/Math.cos(i)),a=this.n*n,l=this.ro0*Math.pow(Math.tan(this.s0/2+this.s45),this.n)/Math.pow(Math.tan(i/2+this.s45),this.n),e.y=l*Math.cos(a)/1,e.x=l*Math.sin(a)/1,this.czech||(e.y*=-1,e.x*=-1),e},inverse:function(e){var t,o,r,i,n,a,l,s=e.x;e.x=e.y,e.y=s,this.czech||(e.y*=-1,e.x*=-1),n=Math.sqrt(e.x*e.x+e.y*e.y),i=Math.atan2(e.y,e.x)/Math.sin(this.s0),r=2*(Math.atan(Math.pow(this.ro0/n,1/this.n)*Math.tan(this.s0/2+this.s45))-this.s45),t=Math.asin(Math.cos(this.ad)*Math.sin(r)-Math.sin(this.ad)*Math.cos(r)*Math.cos(i)),o=Math.asin(Math.cos(r)*Math.sin(i)/Math.cos(t)),e.x=this.long0-o/this.alfa,a=t,l=0;var p=0;do{e.y=2*(Math.atan(Math.pow(this.k,-1/this.alfa)*Math.pow(Math.tan(t/2+this.s45),1/this.alfa)*Math.pow((1+this.e*Math.sin(a))/(1-this.e*Math.sin(a)),this.e/2))-this.s45),Math.abs(a-e.y)<1e-10&&(l=1),a=e.y,p+=1}while(0===l&&p<15);return p>=15?null:e},names:["Krovak","krovak"]},ze=function(e,t,o,r,i){return e*i-t*Math.sin(2*i)+o*Math.sin(4*i)-r*Math.sin(6*i)},Ze=function(e){return 1-.25*e*(1+e/16*(3+1.25*e))},Je=function(e){return.375*e*(1+.25*e*(1+.46875*e))},Qe=function(e){return.05859375*e*e*(1+.75*e)},et=function(e){return e*e*e*(35/3072)},tt=function(e,t,o){var r=t*o;return e/Math.sqrt(1-r*r)},ot=function(e){return Math.abs(e)<M?e:e-te(e)*Math.PI},rt=function(e,t,o,r,i){var n,a;n=e/t;for(var l=0;l<15;l++)if(n+=a=(e-(t*n-o*Math.sin(2*n)+r*Math.sin(4*n)-i*Math.sin(6*n)))/(t-2*o*Math.cos(2*n)+4*r*Math.cos(4*n)-6*i*Math.cos(6*n)),Math.abs(a)<=1e-10)return n;return NaN},it={init:function(){this.sphere||(this.e0=Ze(this.es),this.e1=Je(this.es),this.e2=Qe(this.es),this.e3=et(this.es),this.ml0=this.a*ze(this.e0,this.e1,this.e2,this.e3,this.lat0))},forward:function(e){var t,o,r=e.x,i=e.y;if(r=oe(r-this.long0),this.sphere)t=this.a*Math.asin(Math.cos(i)*Math.sin(r)),o=this.a*(Math.atan2(Math.tan(i),Math.cos(r))-this.lat0);else{var n=Math.sin(i),a=Math.cos(i),l=tt(this.a,this.e,n),s=Math.tan(i)*Math.tan(i),p=r*Math.cos(i),c=p*p,u=this.es*a*a/(1-this.es);t=l*p*(1-c*s*(1/6-(8-s+8*u)*c/120)),o=this.a*ze(this.e0,this.e1,this.e2,this.e3,i)-this.ml0+l*n/a*c*(.5+(5-s+6*u)*c/24)}return e.x=t+this.x0,e.y=o+this.y0,e},inverse:function(e){e.x-=this.x0,e.y-=this.y0;var t,o,r=e.x/this.a,i=e.y/this.a;if(this.sphere){var n=i+this.lat0;t=Math.asin(Math.sin(n)*Math.cos(r)),o=Math.atan2(Math.tan(r),Math.cos(n))}else{var a=this.ml0/this.a+i,l=rt(a,this.e0,this.e1,this.e2,this.e3);if(Math.abs(Math.abs(l)-M)<=D)return e.x=this.long0,e.y=M,i<0&&(e.y*=-1),e;var s=tt(this.a,this.e,Math.sin(l)),p=s*s*s/this.a/this.a*(1-this.es),c=Math.pow(Math.tan(l),2),u=r*this.a/s,g=u*u;t=l-s*Math.tan(l)/p*u*u*(.5-(1+3*c)*u*u/24),o=u*(1-g*(c/3+(1+3*c)*c*g/15))/Math.cos(l)}return e.x=oe(o+this.long0),e.y=ot(t),e},names:["Cassini","Cassini_Soldner","cass"]},nt=function(e,t){var o;return e>1e-7?(1-e*e)*(t/(1-(o=e*t)*o)-.5/e*Math.log((1-o)/(1+o))):2*t},at=.3333333333333333,lt=.17222222222222222,st=.10257936507936508,pt=.06388888888888888,ct=.0664021164021164,ut=.016415012942191543,gt={init:function(){var e=Math.abs(this.lat0);if(Math.abs(e-M)<D?this.mode=this.lat0<0?this.S_POLE:this.N_POLE:Math.abs(e)<D?this.mode=this.EQUIT:this.mode=this.OBLIQ,this.es>0){var t;switch(this.qp=nt(this.e,1),this.mmf=.5/(1-this.es),this.apa=function(e){var t,o=[];return o[0]=e*at,t=e*e,o[0]+=t*lt,o[1]=t*pt,t*=e,o[0]+=t*st,o[1]+=t*ct,o[2]=t*ut,o}(this.es),this.mode){case this.N_POLE:case this.S_POLE:this.dd=1;break;case this.EQUIT:this.rq=Math.sqrt(.5*this.qp),this.dd=1/this.rq,this.xmf=1,this.ymf=.5*this.qp;break;case this.OBLIQ:this.rq=Math.sqrt(.5*this.qp),t=Math.sin(this.lat0),this.sinb1=nt(this.e,t)/this.qp,this.cosb1=Math.sqrt(1-this.sinb1*this.sinb1),this.dd=Math.cos(this.lat0)/(Math.sqrt(1-this.es*t*t)*this.rq*this.cosb1),this.ymf=(this.xmf=this.rq)/this.dd,this.xmf*=this.dd}}else this.mode===this.OBLIQ&&(this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0))},forward:function(e){var t,o,r,i,n,a,l,s,p,c,u=e.x,g=e.y;if(u=oe(u-this.long0),this.sphere){if(n=Math.sin(g),c=Math.cos(g),r=Math.cos(u),this.mode===this.OBLIQ||this.mode===this.EQUIT){if((o=this.mode===this.EQUIT?1+c*r:1+this.sinph0*n+this.cosph0*c*r)<=D)return null;t=(o=Math.sqrt(2/o))*c*Math.sin(u),o*=this.mode===this.EQUIT?n:this.cosph0*n-this.sinph0*c*r}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(r=-r),Math.abs(g+this.phi0)<D)return null;o=G-.5*g,t=(o=2*(this.mode===this.S_POLE?Math.cos(o):Math.sin(o)))*Math.sin(u),o*=r}}else{switch(l=0,s=0,p=0,r=Math.cos(u),i=Math.sin(u),n=Math.sin(g),a=nt(this.e,n),this.mode!==this.OBLIQ&&this.mode!==this.EQUIT||(l=a/this.qp,s=Math.sqrt(1-l*l)),this.mode){case this.OBLIQ:p=1+this.sinb1*l+this.cosb1*s*r;break;case this.EQUIT:p=1+s*r;break;case this.N_POLE:p=M+g,a=this.qp-a;break;case this.S_POLE:p=g-M,a=this.qp+a}if(Math.abs(p)<D)return null;switch(this.mode){case this.OBLIQ:case this.EQUIT:p=Math.sqrt(2/p),o=this.mode===this.OBLIQ?this.ymf*p*(this.cosb1*l-this.sinb1*s*r):(p=Math.sqrt(2/(1+s*r)))*l*this.ymf,t=this.xmf*p*s*i;break;case this.N_POLE:case this.S_POLE:a>=0?(t=(p=Math.sqrt(a))*i,o=r*(this.mode===this.S_POLE?p:-p)):t=o=0}}return e.x=this.a*t+this.x0,e.y=this.a*o+this.y0,e},inverse:function(e){e.x-=this.x0,e.y-=this.y0;var t,o,r,i,n,a,l,s=e.x/this.a,p=e.y/this.a;if(this.sphere){var c,u=0,g=0;if((o=.5*(c=Math.sqrt(s*s+p*p)))>1)return null;switch(o=2*Math.asin(o),this.mode!==this.OBLIQ&&this.mode!==this.EQUIT||(g=Math.sin(o),u=Math.cos(o)),this.mode){case this.EQUIT:o=Math.abs(c)<=D?0:Math.asin(p*g/c),s*=g,p=u*c;break;case this.OBLIQ:o=Math.abs(c)<=D?this.phi0:Math.asin(u*this.sinph0+p*g*this.cosph0/c),s*=g*this.cosph0,p=(u-Math.sin(o)*this.sinph0)*c;break;case this.N_POLE:p=-p,o=M-o;break;case this.S_POLE:o-=M}t=0!==p||this.mode!==this.EQUIT&&this.mode!==this.OBLIQ?Math.atan2(s,p):0}else{if(l=0,this.mode===this.OBLIQ||this.mode===this.EQUIT){if(s/=this.dd,p*=this.dd,(a=Math.sqrt(s*s+p*p))<D)return e.x=0,e.y=this.phi0,e;i=2*Math.asin(.5*a/this.rq),r=Math.cos(i),s*=i=Math.sin(i),this.mode===this.OBLIQ?(l=r*this.sinb1+p*i*this.cosb1/a,n=this.qp*l,p=a*this.cosb1*r-p*this.sinb1*i):(l=p*i/a,n=this.qp*l,p=a*r)}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(p=-p),!(n=s*s+p*p))return e.x=0,e.y=this.phi0,e;l=1-n/this.qp,this.mode===this.S_POLE&&(l=-l)}t=Math.atan2(s,p),o=function(e,t){var o=e+e;return e+t[0]*Math.sin(o)+t[1]*Math.sin(o+o)+t[2]*Math.sin(o+o+o)}(Math.asin(l),this.apa)}return e.x=oe(this.long0+t),e.y=o,e},names:["Lambert Azimuthal Equal Area","Lambert_Azimuthal_Equal_Area","laea"],S_POLE:1,N_POLE:2,EQUIT:3,OBLIQ:4},dt=function(e){return Math.abs(e)>1&&(e=e>1?1:-1),Math.asin(e)},ht={init:function(){Math.abs(this.lat1+this.lat2)<D||(this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e3=Math.sqrt(this.es),this.sin_po=Math.sin(this.lat1),this.cos_po=Math.cos(this.lat1),this.t1=this.sin_po,this.con=this.sin_po,this.ms1=ee(this.e3,this.sin_po,this.cos_po),this.qs1=nt(this.e3,this.sin_po,this.cos_po),this.sin_po=Math.sin(this.lat2),this.cos_po=Math.cos(this.lat2),this.t2=this.sin_po,this.ms2=ee(this.e3,this.sin_po,this.cos_po),this.qs2=nt(this.e3,this.sin_po,this.cos_po),this.sin_po=Math.sin(this.lat0),this.cos_po=Math.cos(this.lat0),this.t3=this.sin_po,this.qs0=nt(this.e3,this.sin_po,this.cos_po),Math.abs(this.lat1-this.lat2)>D?this.ns0=(this.ms1*this.ms1-this.ms2*this.ms2)/(this.qs2-this.qs1):this.ns0=this.con,this.c=this.ms1*this.ms1+this.ns0*this.qs1,this.rh=this.a*Math.sqrt(this.c-this.ns0*this.qs0)/this.ns0)},forward:function(e){var t=e.x,o=e.y;this.sin_phi=Math.sin(o),this.cos_phi=Math.cos(o);var r=nt(this.e3,this.sin_phi,this.cos_phi),i=this.a*Math.sqrt(this.c-this.ns0*r)/this.ns0,n=this.ns0*oe(t-this.long0),a=i*Math.sin(n)+this.x0,l=this.rh-i*Math.cos(n)+this.y0;return e.x=a,e.y=l,e},inverse:function(e){var t,o,r,i,n,a;return e.x-=this.x0,e.y=this.rh-e.y+this.y0,this.ns0>=0?(t=Math.sqrt(e.x*e.x+e.y*e.y),r=1):(t=-Math.sqrt(e.x*e.x+e.y*e.y),r=-1),i=0,0!==t&&(i=Math.atan2(r*e.x,r*e.y)),r=t*this.ns0/this.a,this.sphere?a=Math.asin((this.c-r*r)/(2*this.ns0)):(o=(this.c-r*r)/this.ns0,a=this.phi1z(this.e3,o)),n=oe(i/this.ns0+this.long0),e.x=n,e.y=a,e},names:["Albers_Conic_Equal_Area","Albers","aea"],phi1z:function(e,t){var o,r,i,n,a,l=dt(.5*t);if(e<D)return l;for(var s=e*e,p=1;p<=25;p++)if(o=Math.sin(l),r=Math.cos(l),l+=a=.5*(n=1-(i=e*o)*i)*n/r*(t/(1-s)-o/n+.5/e*Math.log((1-i)/(1+i))),Math.abs(a)<=1e-7)return l;return null}},ft={init:function(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0),this.infinity_dist=1e3*this.a,this.rc=1},forward:function(e){var t,o,r,i,n,a,l,s=e.x,p=e.y;return r=oe(s-this.long0),t=Math.sin(p),o=Math.cos(p),i=Math.cos(r),(n=this.sin_p14*t+this.cos_p14*o*i)>0||Math.abs(n)<=D?(a=this.x0+1*this.a*o*Math.sin(r)/n,l=this.y0+1*this.a*(this.cos_p14*t-this.sin_p14*o*i)/n):(a=this.x0+this.infinity_dist*o*Math.sin(r),l=this.y0+this.infinity_dist*(this.cos_p14*t-this.sin_p14*o*i)),e.x=a,e.y=l,e},inverse:function(e){var t,o,r,i,n,a;return e.x=(e.x-this.x0)/this.a,e.y=(e.y-this.y0)/this.a,e.x/=this.k0,e.y/=this.k0,(t=Math.sqrt(e.x*e.x+e.y*e.y))?(i=Math.atan2(t,this.rc),o=Math.sin(i),r=Math.cos(i),a=dt(r*this.sin_p14+e.y*o*this.cos_p14/t),n=Math.atan2(e.x*o,t*this.cos_p14*r-e.y*this.sin_p14*o),n=oe(this.long0+n)):(a=this.phic0,n=0),e.x=n,e.y=a,e},names:["gnom"]},yt=function(e,t){var o=1-(1-e*e)/(2*e)*Math.log((1-e)/(1+e));if(Math.abs(Math.abs(t)-o)<1e-6)return t<0?-1*M:M;for(var r,i,n,a,l=Math.asin(.5*t),s=0;s<30;s++)if(i=Math.sin(l),n=Math.cos(l),a=e*i,l+=r=Math.pow(1-a*a,2)/(2*n)*(t/(1-e*e)-i/(1-a*a)+.5/e*Math.log((1-a)/(1+a))),Math.abs(r)<=1e-10)return l;return NaN},mt={init:function(){this.sphere||(this.k0=ee(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)))},forward:function(e){var t,o,r=e.x,i=e.y,n=oe(r-this.long0);if(this.sphere)t=this.x0+this.a*n*Math.cos(this.lat_ts),o=this.y0+this.a*Math.sin(i)/Math.cos(this.lat_ts);else{var a=nt(this.e,Math.sin(i));t=this.x0+this.a*this.k0*n,o=this.y0+this.a*a*.5/this.k0}return e.x=t,e.y=o,e},inverse:function(e){e.x-=this.x0,e.y-=this.y0;var t,o;return this.sphere?(t=oe(this.long0+e.x/this.a/Math.cos(this.lat_ts)),o=Math.asin(e.y/this.a*Math.cos(this.lat_ts))):(o=yt(this.e,2*e.y*this.k0/this.a),t=oe(this.long0+e.x/(this.a*this.k0))),e.x=t,e.y=o,e},names:["cea"]},vt={init:function(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Equidistant Cylindrical (Plate Carre)",this.rc=Math.cos(this.lat_ts)},forward:function(e){var t=e.x,o=e.y,r=oe(t-this.long0),i=ot(o-this.lat0);return e.x=this.x0+this.a*r*this.rc,e.y=this.y0+this.a*i,e},inverse:function(e){var t=e.x,o=e.y;return e.x=oe(this.long0+(t-this.x0)/(this.a*this.rc)),e.y=ot(this.lat0+(o-this.y0)/this.a),e},names:["Equirectangular","Equidistant_Cylindrical","eqc"]},Ct=20,Tt={init:function(){this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=Ze(this.es),this.e1=Je(this.es),this.e2=Qe(this.es),this.e3=et(this.es),this.ml0=this.a*ze(this.e0,this.e1,this.e2,this.e3,this.lat0)},forward:function(e){var t,o,r,i=e.x,n=e.y,a=oe(i-this.long0);if(r=a*Math.sin(n),this.sphere)Math.abs(n)<=D?(t=this.a*a,o=-1*this.a*this.lat0):(t=this.a*Math.sin(r)/Math.tan(n),o=this.a*(ot(n-this.lat0)+(1-Math.cos(r))/Math.tan(n)));else if(Math.abs(n)<=D)t=this.a*a,o=-1*this.ml0;else{var l=tt(this.a,this.e,Math.sin(n))/Math.tan(n);t=l*Math.sin(r),o=this.a*ze(this.e0,this.e1,this.e2,this.e3,n)-this.ml0+l*(1-Math.cos(r))}return e.x=t+this.x0,e.y=o+this.y0,e},inverse:function(e){var t,o,r,i,n,a,l,s,p;if(r=e.x-this.x0,i=e.y-this.y0,this.sphere)if(Math.abs(i+this.a*this.lat0)<=D)t=oe(r/this.a+this.long0),o=0;else{a=this.lat0+i/this.a,l=r*r/this.a/this.a+a*a,s=a;var c;for(n=Ct;n;--n)if(s+=p=-1*(a*(s*(c=Math.tan(s))+1)-s-.5*(s*s+l)*c)/((s-a)/c-1),Math.abs(p)<=D){o=s;break}t=oe(this.long0+Math.asin(r*Math.tan(s)/this.a)/Math.sin(o))}else if(Math.abs(i+this.ml0)<=D)o=0,t=oe(this.long0+r/this.a);else{a=(this.ml0+i)/this.a,l=r*r/this.a/this.a+a*a,s=a;var u,g,d,h,f;for(n=Ct;n;--n)if(f=this.e*Math.sin(s),u=Math.sqrt(1-f*f)*Math.tan(s),g=this.a*ze(this.e0,this.e1,this.e2,this.e3,s),d=this.e0-2*this.e1*Math.cos(2*s)+4*this.e2*Math.cos(4*s)-6*this.e3*Math.cos(6*s),s-=p=(a*(u*(h=g/this.a)+1)-h-.5*u*(h*h+l))/(this.es*Math.sin(2*s)*(h*h+l-2*a*h)/(4*u)+(a-h)*(u*d-2/Math.sin(2*s))-d),Math.abs(p)<=D){o=s;break}u=Math.sqrt(1-this.es*Math.pow(Math.sin(o),2))*Math.tan(o),t=oe(this.long0+Math.asin(r*u/this.a)/Math.sin(o))}return e.x=t,e.y=o,e},names:["Polyconic","poly"]},St={init:function(){this.A=[],this.A[1]=.6399175073,this.A[2]=-.1358797613,this.A[3]=.063294409,this.A[4]=-.02526853,this.A[5]=.0117879,this.A[6]=-.0055161,this.A[7]=.0026906,this.A[8]=-.001333,this.A[9]=67e-5,this.A[10]=-34e-5,this.B_re=[],this.B_im=[],this.B_re[1]=.7557853228,this.B_im[1]=0,this.B_re[2]=.249204646,this.B_im[2]=.003371507,this.B_re[3]=-.001541739,this.B_im[3]=.04105856,this.B_re[4]=-.10162907,this.B_im[4]=.01727609,this.B_re[5]=-.26623489,this.B_im[5]=-.36249218,this.B_re[6]=-.6870983,this.B_im[6]=-1.1651967,this.C_re=[],this.C_im=[],this.C_re[1]=1.3231270439,this.C_im[1]=0,this.C_re[2]=-.577245789,this.C_im[2]=-.007809598,this.C_re[3]=.508307513,this.C_im[3]=-.112208952,this.C_re[4]=-.15094762,this.C_im[4]=.18200602,this.C_re[5]=1.01418179,this.C_im[5]=1.64497696,this.C_re[6]=1.9660549,this.C_im[6]=2.5127645,this.D=[],this.D[1]=1.5627014243,this.D[2]=.5185406398,this.D[3]=-.03333098,this.D[4]=-.1052906,this.D[5]=-.0368594,this.D[6]=.007317,this.D[7]=.0122,this.D[8]=.00394,this.D[9]=-.0013},forward:function(e){var t,o=e.x,r=e.y-this.lat0,i=o-this.long0,n=r/A*1e-5,a=i,l=1,s=0;for(t=1;t<=10;t++)l*=n,s+=this.A[t]*l;var p,c=s,u=a,g=1,d=0,h=0,f=0;for(t=1;t<=6;t++)p=d*c+g*u,g=g*c-d*u,d=p,h=h+this.B_re[t]*g-this.B_im[t]*d,f=f+this.B_im[t]*g+this.B_re[t]*d;return e.x=f*this.a+this.x0,e.y=h*this.a+this.y0,e},inverse:function(e){var t,o,r=e.x,i=e.y,n=r-this.x0,a=(i-this.y0)/this.a,l=n/this.a,s=1,p=0,c=0,u=0;for(t=1;t<=6;t++)o=p*a+s*l,s=s*a-p*l,p=o,c=c+this.C_re[t]*s-this.C_im[t]*p,u=u+this.C_im[t]*s+this.C_re[t]*p;for(var g=0;g<this.iterations;g++){var d,h=c,f=u,y=a,m=l;for(t=2;t<=6;t++)d=f*c+h*u,h=h*c-f*u,f=d,y+=(t-1)*(this.B_re[t]*h-this.B_im[t]*f),m+=(t-1)*(this.B_im[t]*h+this.B_re[t]*f);h=1,f=0;var v=this.B_re[1],C=this.B_im[1];for(t=2;t<=6;t++)d=f*c+h*u,h=h*c-f*u,f=d,v+=t*(this.B_re[t]*h-this.B_im[t]*f),C+=t*(this.B_im[t]*h+this.B_re[t]*f);var T=v*v+C*C;c=(y*v+m*C)/T,u=(m*v-y*C)/T}var S=c,_=u,E=1,x=0;for(t=1;t<=9;t++)E*=S,x+=this.D[t]*E;var P=this.lat0+x*A*1e5,L=this.long0+_;return e.x=L,e.y=P,e},names:["New_Zealand_Map_Grid","nzmg"]},_t={init:function(){},forward:function(e){var t=e.x,o=e.y,r=oe(t-this.long0),i=this.x0+this.a*r,n=this.y0+this.a*Math.log(Math.tan(Math.PI/4+o/2.5))*1.25;return e.x=i,e.y=n,e},inverse:function(e){e.x-=this.x0,e.y-=this.y0;var t=oe(this.long0+e.x/this.a),o=2.5*(Math.atan(Math.exp(.8*e.y/this.a))-Math.PI/4);return e.x=t,e.y=o,e},names:["Miller_Cylindrical","mill"]},Et=20,xt={init:function(){this.sphere?(this.n=1,this.m=0,this.es=0,this.C_y=Math.sqrt((this.m+1)/this.n),this.C_x=this.C_y/(this.m+1)):this.en=be(this.es)},forward:function(e){var t,o,r=e.x,i=e.y;if(r=oe(r-this.long0),this.sphere){if(this.m)for(var n=this.n*Math.sin(i),a=Et;a;--a){var l=(this.m*i+Math.sin(i)-n)/(this.m+Math.cos(i));if(i-=l,Math.abs(l)<D)break}else i=1!==this.n?Math.asin(this.n*Math.sin(i)):i;t=this.a*this.C_x*r*(this.m+Math.cos(i)),o=this.a*this.C_y*i}else{var s=Math.sin(i),p=Math.cos(i);o=this.a*Re(i,s,p,this.en),t=this.a*r*p/Math.sqrt(1-this.es*s*s)}return e.x=t,e.y=o,e},inverse:function(e){var t,o,r,i;return e.x-=this.x0,r=e.x/this.a,e.y-=this.y0,t=e.y/this.a,this.sphere?(t/=this.C_y,r/=this.C_x*(this.m+Math.cos(t)),this.m?t=dt((this.m*t+Math.sin(t))/this.n):1!==this.n&&(t=dt(Math.sin(t)/this.n)),r=oe(r+this.long0),t=ot(t)):(t=Ae(e.y/this.a,this.es,this.en),(i=Math.abs(t))<M?(i=Math.sin(t),o=this.long0+e.x*Math.sqrt(1-this.es*i*i)/(this.a*Math.cos(t)),r=oe(o)):i-D<M&&(r=this.long0)),e.x=r,e.y=t,e},names:["Sinusoidal","sinu"]},Pt={init:function(){},forward:function(e){for(var t=e.x,o=e.y,r=oe(t-this.long0),i=o,n=Math.PI*Math.sin(o),a=0;;a++){var l=-(i+Math.sin(i)-n)/(1+Math.cos(i));if(i+=l,Math.abs(l)<D)break}i/=2,Math.PI/2-Math.abs(o)<D&&(r=0);var s=.900316316158*this.a*r*Math.cos(i)+this.x0,p=1.4142135623731*this.a*Math.sin(i)+this.y0;return e.x=s,e.y=p,e},inverse:function(e){var t,o;e.x-=this.x0,e.y-=this.y0,o=e.y/(1.4142135623731*this.a),Math.abs(o)>.999999999999&&(o=.999999999999),t=Math.asin(o);var r=oe(this.long0+e.x/(.900316316158*this.a*Math.cos(t)));r<-Math.PI&&(r=-Math.PI),r>Math.PI&&(r=Math.PI),o=(2*t+Math.sin(2*t))/Math.PI,Math.abs(o)>1&&(o=1);var i=Math.asin(o);return e.x=r,e.y=i,e},names:["Mollweide","moll"]},Lt={init:function(){Math.abs(this.lat1+this.lat2)<D||(this.lat2=this.lat2||this.lat1,this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=Ze(this.es),this.e1=Je(this.es),this.e2=Qe(this.es),this.e3=et(this.es),this.sinphi=Math.sin(this.lat1),this.cosphi=Math.cos(this.lat1),this.ms1=ee(this.e,this.sinphi,this.cosphi),this.ml1=ze(this.e0,this.e1,this.e2,this.e3,this.lat1),Math.abs(this.lat1-this.lat2)<D?this.ns=this.sinphi:(this.sinphi=Math.sin(this.lat2),this.cosphi=Math.cos(this.lat2),this.ms2=ee(this.e,this.sinphi,this.cosphi),this.ml2=ze(this.e0,this.e1,this.e2,this.e3,this.lat2),this.ns=(this.ms1-this.ms2)/(this.ml2-this.ml1)),this.g=this.ml1+this.ms1/this.ns,this.ml0=ze(this.e0,this.e1,this.e2,this.e3,this.lat0),this.rh=this.a*(this.g-this.ml0))},forward:function(e){var t,o=e.x,r=e.y;if(this.sphere)t=this.a*(this.g-r);else{var i=ze(this.e0,this.e1,this.e2,this.e3,r);t=this.a*(this.g-i)}var n=this.ns*oe(o-this.long0),a=this.x0+t*Math.sin(n),l=this.y0+this.rh-t*Math.cos(n);return e.x=a,e.y=l,e},inverse:function(e){e.x-=this.x0,e.y=this.rh-e.y+this.y0;var t,o,r,i;this.ns>=0?(o=Math.sqrt(e.x*e.x+e.y*e.y),t=1):(o=-Math.sqrt(e.x*e.x+e.y*e.y),t=-1);var n=0;if(0!==o&&(n=Math.atan2(t*e.x,t*e.y)),this.sphere)return i=oe(this.long0+n/this.ns),r=ot(this.g-o/this.a),e.x=i,e.y=r,e;var a=this.g-o/this.a;return r=rt(a,this.e0,this.e1,this.e2,this.e3),i=oe(this.long0+n/this.ns),e.x=i,e.y=r,e},names:["Equidistant_Conic","eqdc"]},wt={init:function(){this.R=this.a},forward:function(e){var t,o,r=e.x,i=e.y,n=oe(r-this.long0);Math.abs(i)<=D&&(t=this.x0+this.R*n,o=this.y0);var a=dt(2*Math.abs(i/Math.PI));(Math.abs(n)<=D||Math.abs(Math.abs(i)-M)<=D)&&(t=this.x0,o=i>=0?this.y0+Math.PI*this.R*Math.tan(.5*a):this.y0+Math.PI*this.R*-Math.tan(.5*a));var l=.5*Math.abs(Math.PI/n-n/Math.PI),s=l*l,p=Math.sin(a),c=Math.cos(a),u=c/(p+c-1),g=u*u,d=u*(2/p-1),h=d*d,f=Math.PI*this.R*(l*(u-h)+Math.sqrt(s*(u-h)*(u-h)-(h+s)*(g-h)))/(h+s);n<0&&(f=-f),t=this.x0+f;var y=s+u;return f=Math.PI*this.R*(d*y-l*Math.sqrt((h+s)*(s+1)-y*y))/(h+s),o=i>=0?this.y0+f:this.y0-f,e.x=t,e.y=o,e},inverse:function(e){var t,o,r,i,n,a,l,s,p,c,u,g;return e.x-=this.x0,e.y-=this.y0,u=Math.PI*this.R,n=(r=e.x/u)*r+(i=e.y/u)*i,u=3*(i*i/(s=-2*(a=-Math.abs(i)*(1+n))+1+2*i*i+n*n)+(2*(l=a-2*i*i+r*r)*l*l/s/s/s-9*a*l/s/s)/27)/(p=(a-l*l/3/s)/s)/(c=2*Math.sqrt(-p/3)),Math.abs(u)>1&&(u=u>=0?1:-1),g=Math.acos(u)/3,o=e.y>=0?(-c*Math.cos(g+Math.PI/3)-l/3/s)*Math.PI:-(-c*Math.cos(g+Math.PI/3)-l/3/s)*Math.PI,t=Math.abs(r)<D?this.long0:oe(this.long0+Math.PI*(n-1+Math.sqrt(1+2*(r*r-i*i)+n*n))/2/r),e.x=t,e.y=o,e},names:["Van_der_Grinten_I","VanDerGrinten","vandg"]},bt={init:function(){this.sin_p12=Math.sin(this.lat0),this.cos_p12=Math.cos(this.lat0)},forward:function(e){var t,o,r,i,n,a,l,s,p,c,u,g,d,h,f,y,m,v,C,T,S,_,E=e.x,x=e.y,P=Math.sin(e.y),L=Math.cos(e.y),w=oe(E-this.long0);return this.sphere?Math.abs(this.sin_p12-1)<=D?(e.x=this.x0+this.a*(M-x)*Math.sin(w),e.y=this.y0-this.a*(M-x)*Math.cos(w),e):Math.abs(this.sin_p12+1)<=D?(e.x=this.x0+this.a*(M+x)*Math.sin(w),e.y=this.y0+this.a*(M+x)*Math.cos(w),e):(v=this.sin_p12*P+this.cos_p12*L*Math.cos(w),m=(y=Math.acos(v))/Math.sin(y),e.x=this.x0+this.a*m*L*Math.sin(w),e.y=this.y0+this.a*m*(this.cos_p12*P-this.sin_p12*L*Math.cos(w)),e):(t=Ze(this.es),o=Je(this.es),r=Qe(this.es),i=et(this.es),Math.abs(this.sin_p12-1)<=D?(n=this.a*ze(t,o,r,i,M),a=this.a*ze(t,o,r,i,x),e.x=this.x0+(n-a)*Math.sin(w),e.y=this.y0-(n-a)*Math.cos(w),e):Math.abs(this.sin_p12+1)<=D?(n=this.a*ze(t,o,r,i,M),a=this.a*ze(t,o,r,i,x),e.x=this.x0+(n+a)*Math.sin(w),e.y=this.y0+(n+a)*Math.cos(w),e):(l=P/L,s=tt(this.a,this.e,this.sin_p12),p=tt(this.a,this.e,P),c=Math.atan((1-this.es)*l+this.es*s*this.sin_p12/(p*L)),C=0===(u=Math.atan2(Math.sin(w),this.cos_p12*Math.tan(c)-this.sin_p12*Math.cos(w)))?Math.asin(this.cos_p12*Math.sin(c)-this.sin_p12*Math.cos(c)):Math.abs(Math.abs(u)-Math.PI)<=D?-Math.asin(this.cos_p12*Math.sin(c)-this.sin_p12*Math.cos(c)):Math.asin(Math.sin(w)*Math.cos(c)/Math.sin(u)),g=this.e*this.sin_p12/Math.sqrt(1-this.es),y=s*C*(1-(T=C*C)*(f=(d=this.e*this.cos_p12*Math.cos(u)/Math.sqrt(1-this.es))*d)*(1-f)/6+(S=T*C)/8*(h=g*d)*(1-2*f)+(_=S*C)/120*(f*(4-7*f)-3*g*g*(1-7*f))-_*C/48*h),e.x=this.x0+y*Math.sin(u),e.y=this.y0+y*Math.cos(u),e))},inverse:function(e){e.x-=this.x0,e.y-=this.y0;var t,o,r,i,n,a,l,s,p,c,u,g,d,h,f,y,m,v,C,T,S,_;if(this.sphere){if((t=Math.sqrt(e.x*e.x+e.y*e.y))>2*M*this.a)return;return o=t/this.a,r=Math.sin(o),i=Math.cos(o),n=this.long0,Math.abs(t)<=D?a=this.lat0:(a=dt(i*this.sin_p12+e.y*r*this.cos_p12/t),l=Math.abs(this.lat0)-M,n=oe(Math.abs(l)<=D?this.lat0>=0?this.long0+Math.atan2(e.x,-e.y):this.long0-Math.atan2(-e.x,e.y):this.long0+Math.atan2(e.x*r,t*this.cos_p12*i-e.y*this.sin_p12*r))),e.x=n,e.y=a,e}return s=Ze(this.es),p=Je(this.es),c=Qe(this.es),u=et(this.es),Math.abs(this.sin_p12-1)<=D?(g=this.a*ze(s,p,c,u,M),t=Math.sqrt(e.x*e.x+e.y*e.y),a=rt((g-t)/this.a,s,p,c,u),n=oe(this.long0+Math.atan2(e.x,-1*e.y)),e.x=n,e.y=a,e):Math.abs(this.sin_p12+1)<=D?(g=this.a*ze(s,p,c,u,M),t=Math.sqrt(e.x*e.x+e.y*e.y),a=rt((t-g)/this.a,s,p,c,u),n=oe(this.long0+Math.atan2(e.x,e.y)),e.x=n,e.y=a,e):(t=Math.sqrt(e.x*e.x+e.y*e.y),f=Math.atan2(e.x,e.y),d=tt(this.a,this.e,this.sin_p12),y=Math.cos(f),v=-(m=this.e*this.cos_p12*y)*m/(1-this.es),C=3*this.es*(1-v)*this.sin_p12*this.cos_p12*y/(1-this.es),_=1-v*(S=(T=t/d)-v*(1+v)*Math.pow(T,3)/6-C*(1+3*v)*Math.pow(T,4)/24)*S/2-T*S*S*S/6,h=Math.asin(this.sin_p12*Math.cos(S)+this.cos_p12*Math.sin(S)*y),n=oe(this.long0+Math.asin(Math.sin(f)*Math.sin(S)/Math.cos(h))),a=Math.atan((1-this.es*_*this.sin_p12/Math.sin(h))*Math.tan(h)/(1-this.es)),e.x=n,e.y=a,e)},names:["Azimuthal_Equidistant","aeqd"]},Rt={init:function(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0)},forward:function(e){var t,o,r,i,n,a,l,s=e.x,p=e.y;return r=oe(s-this.long0),t=Math.sin(p),o=Math.cos(p),i=Math.cos(r),((n=this.sin_p14*t+this.cos_p14*o*i)>0||Math.abs(n)<=D)&&(a=1*this.a*o*Math.sin(r),l=this.y0+1*this.a*(this.cos_p14*t-this.sin_p14*o*i)),e.x=a,e.y=l,e},inverse:function(e){var t,o,r,i,n,a,l;return e.x-=this.x0,e.y-=this.y0,t=Math.sqrt(e.x*e.x+e.y*e.y),o=dt(t/this.a),r=Math.sin(o),i=Math.cos(o),a=this.long0,Math.abs(t)<=D?(l=this.lat0,e.x=a,e.y=l,e):(l=dt(i*this.sin_p14+e.y*r*this.cos_p14/t),n=Math.abs(this.lat0)-M,Math.abs(n)<=D?(a=oe(this.lat0>=0?this.long0+Math.atan2(e.x,-e.y):this.long0-Math.atan2(-e.x,e.y)),e.x=a,e.y=l,e):(a=oe(this.long0+Math.atan2(e.x*r,t*this.cos_p14*i-e.y*this.sin_p14*r)),e.x=a,e.y=l,e))},names:["ortho"]};return y.defaultDatum="WGS84",y.Proj=u,y.WGS84=new y.Proj("WGS84"),y.Point=P,y.toPoint=he,y.defs=l,y.transform=d,y.mgrs=xe,y.version="2.4.3",(Pe=y).Proj.projections.add(Me),Pe.Proj.projections.add(Ge),Pe.Proj.projections.add(Be),Pe.Proj.projections.add(We),Pe.Proj.projections.add(Ve),Pe.Proj.projections.add(Ye),Pe.Proj.projections.add(Ke),Pe.Proj.projections.add(Xe),Pe.Proj.projections.add(He),Pe.Proj.projections.add(it),Pe.Proj.projections.add(gt),Pe.Proj.projections.add(ht),Pe.Proj.projections.add(ft),Pe.Proj.projections.add(mt),Pe.Proj.projections.add(vt),Pe.Proj.projections.add(Tt),Pe.Proj.projections.add(St),Pe.Proj.projections.add(_t),Pe.Proj.projections.add(xt),Pe.Proj.projections.add(Pt),Pe.Proj.projections.add(Lt),Pe.Proj.projections.add(wt),Pe.Proj.projections.add(bt),Pe.Proj.projections.add(Rt),y});!function(e,t){"object"==typeof module&&"object"==typeof module.exports?module.exports=e.document?t(e,!0):function(e){if(!e.document)throw new Error("jQuery requires a window with a document");return t(e)}:t(e)}("undefined"!=typeof window?window:this,function(e,t){var o=[],r=o.slice,i=o.concat,n=o.push,a=o.indexOf,l={},s=l.toString,p=l.hasOwnProperty,c={},u=e.document,g=function(e,t){return new g.fn.init(e,t)},d=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,h=/^-ms-/,f=/-([\da-z])/gi,y=function(e,t){return t.toUpperCase()};g.fn=g.prototype={jquery:"2.1.3",constructor:g,selector:"",length:0,toArray:function(){return r.call(this)},get:function(e){return null!=e?e<0?this[e+this.length]:this[e]:r.call(this)},pushStack:function(e){var t=g.merge(this.constructor(),e);t.prevObject=this;t.context=this.context;return t},each:function(e,t){return g.each(this,e,t)},map:function(e){return this.pushStack(g.map(this,function(t,o){return e.call(t,o,t)}))},slice:function(){return this.pushStack(r.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(e){var t=this.length,o=+e+(e<0?t:0);return this.pushStack(o>=0&&o<t?[this[o]]:[])},end:function(){return this.prevObject||this.constructor(null)},push:n,sort:o.sort,splice:o.splice};g.extend=g.fn.extend=function(){var e,t,o,r,i,n,a=arguments[0]||{},l=1,s=arguments.length,p=!1;if("boolean"==typeof a){p=a;a=arguments[l]||{};l++}"object"==typeof a||g.isFunction(a)||(a={});if(l===s){a=this;l--}for(;l<s;l++)if(null!=(e=arguments[l]))for(t in e){o=a[t];if(a!==(r=e[t]))if(p&&r&&(g.isPlainObject(r)||(i=g.isArray(r)))){if(i){i=!1;n=o&&g.isArray(o)?o:[]}else n=o&&g.isPlainObject(o)?o:{};a[t]=g.extend(p,n,r)}else void 0!==r&&(a[t]=r)}return a};g.extend({expando:"jQuery"+("2.1.3"+Math.random()).replace(/\D/g,""),isReady:!0,error:function(e){throw new Error(e)},noop:function(){},isFunction:function(e){return"function"===g.type(e)},isArray:Array.isArray,isWindow:function(e){return null!=e&&e===e.window},isNumeric:function(e){return!g.isArray(e)&&e-parseFloat(e)+1>=0},isPlainObject:function(e){return"object"===g.type(e)&&!e.nodeType&&!g.isWindow(e)&&!(e.constructor&&!p.call(e.constructor.prototype,"isPrototypeOf"))},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},type:function(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?l[s.call(e)]||"object":typeof e},globalEval:function(e){var t,o=eval;if(e=g.trim(e))if(1===e.indexOf("use strict")){(t=u.createElement("script")).text=e;u.head.appendChild(t).parentNode.removeChild(t)}else o(e)},camelCase:function(e){return e.replace(h,"ms-").replace(f,y)},nodeName:function(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()},each:function(e,t,o){var r=0,i=e.length,n=m(e);if(o){if(n)for(;r<i&&!1!==t.apply(e[r],o);r++);else for(r in e)if(!1===t.apply(e[r],o))break}else if(n)for(;r<i&&!1!==t.call(e[r],r,e[r]);r++);else for(r in e)if(!1===t.call(e[r],r,e[r]))break;return e},trim:function(e){return null==e?"":(e+"").replace(d,"")},makeArray:function(e,t){var o=t||[];null!=e&&(m(Object(e))?g.merge(o,"string"==typeof e?[e]:e):n.call(o,e));return o},inArray:function(e,t,o){return null==t?-1:a.call(t,e,o)},merge:function(e,t){for(var o=+t.length,r=0,i=e.length;r<o;r++)e[i++]=t[r];e.length=i;return e},grep:function(e,t,o){for(var r=[],i=0,n=e.length,a=!o;i<n;i++)!t(e[i],i)!==a&&r.push(e[i]);return r},map:function(e,t,o){var r,n=0,a=e.length,l=[];if(m(e))for(;n<a;n++)null!=(r=t(e[n],n,o))&&l.push(r);else for(n in e)null!=(r=t(e[n],n,o))&&l.push(r);return i.apply([],l)},guid:1,proxy:function(e,t){var o,i,n;if("string"==typeof t){o=e[t];t=e;e=o}if(g.isFunction(e)){i=r.call(arguments,2);(n=function(){return e.apply(t||this,i.concat(r.call(arguments)))}).guid=e.guid=e.guid||g.guid++;return n}},now:Date.now,support:c});g.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(e,t){l["[object "+t+"]"]=t.toLowerCase()});function m(e){var t=e.length,o=g.type(e);return"function"!==o&&!g.isWindow(e)&&(!(1!==e.nodeType||!t)||("array"===o||0===t||"number"==typeof t&&t>0&&t-1 in e))}var v=function(e){var t,o,r,i,n,a,l,s,p,c,u,g,d,h,f,y,m,v,C,T="sizzle"+1*new Date,S=e.document,_=0,E=0,x=ae(),P=ae(),L=ae(),w=function(e,t){e===t&&(u=!0);return 0},b=1<<31,R={}.hasOwnProperty,A=[],M=A.pop,I=A.push,O=A.push,N=A.slice,D=function(e,t){for(var o=0,r=e.length;o<r;o++)if(e[o]===t)return o;return-1},F="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",k="[\\x20\\t\\r\\n\\f]",G="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",U=G.replace("w","w#"),B="\\["+k+"*("+G+")(?:"+k+"*([*^$|!~]?=)"+k+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+U+"))|)"+k+"*\\]",$=":("+G+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+B+")*)|.*)\\)|)",q=new RegExp(k+"+","g"),j=new RegExp("^"+k+"+|((?:^|[^\\\\])(?:\\\\.)*)"+k+"+$","g"),W=new RegExp("^"+k+"*,"+k+"*"),V=new RegExp("^"+k+"*([>+~]|"+k+")"+k+"*"),Y=new RegExp("="+k+"*([^\\]'\"]*?)"+k+"*\\]","g"),K=new RegExp($),X=new RegExp("^"+U+"$"),H={ID:new RegExp("^#("+G+")"),CLASS:new RegExp("^\\.("+G+")"),TAG:new RegExp("^("+G.replace("w","w*")+")"),ATTR:new RegExp("^"+B),PSEUDO:new RegExp("^"+$),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+k+"*(even|odd|(([+-]|)(\\d*)n|)"+k+"*(?:([+-]|)"+k+"*(\\d+)|))"+k+"*\\)|)","i"),bool:new RegExp("^(?:"+F+")$","i"),needsContext:new RegExp("^"+k+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+k+"*((?:-\\d)?\\d*)"+k+"*\\)|)(?=[^-]|$)","i")},z=/^(?:input|select|textarea|button)$/i,Z=/^h\d$/i,J=/^[^{]+\{\s*\[native \w/,Q=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,ee=/[+~]/,te=/'|\\/g,oe=new RegExp("\\\\([\\da-f]{1,6}"+k+"?|("+k+")|.)","ig"),re=function(e,t,o){var r="0x"+t-65536;return r!=r||o?t:r<0?String.fromCharCode(r+65536):String.fromCharCode(r>>10|55296,1023&r|56320)},ie=function(){g()};try{O.apply(A=N.call(S.childNodes),S.childNodes);A[S.childNodes.length].nodeType}catch(e){O={apply:A.length?function(e,t){I.apply(e,N.call(t))}:function(e,t){for(var o=e.length,r=0;e[o++]=t[r++];);e.length=o-1}}}function ne(e,t,r,i){var n,l,p,c,u,h,m,v,_,E;(t?t.ownerDocument||t:S)!==d&&g(t);t=t||d;r=r||[];c=t.nodeType;if("string"!=typeof e||!e||1!==c&&9!==c&&11!==c)return r;if(!i&&f){if(11!==c&&(n=Q.exec(e)))if(p=n[1]){if(9===c){if(!(l=t.getElementById(p))||!l.parentNode)return r;if(l.id===p){r.push(l);return r}}else if(t.ownerDocument&&(l=t.ownerDocument.getElementById(p))&&C(t,l)&&l.id===p){r.push(l);return r}}else{if(n[2]){O.apply(r,t.getElementsByTagName(e));return r}if((p=n[3])&&o.getElementsByClassName){O.apply(r,t.getElementsByClassName(p));return r}}if(o.qsa&&(!y||!y.test(e))){v=m=T;_=t;E=1!==c&&e;if(1===c&&"object"!==t.nodeName.toLowerCase()){h=a(e);(m=t.getAttribute("id"))?v=m.replace(te,"\\$&"):t.setAttribute("id",v);v="[id='"+v+"'] ";u=h.length;for(;u--;)h[u]=v+ye(h[u]);_=ee.test(e)&&he(t.parentNode)||t;E=h.join(",")}if(E)try{O.apply(r,_.querySelectorAll(E));return r}catch(e){}finally{m||t.removeAttribute("id")}}}return s(e.replace(j,"$1"),t,r,i)}function ae(){var e=[];return function t(o,i){e.push(o+" ")>r.cacheLength&&delete t[e.shift()];return t[o+" "]=i}}function le(e){e[T]=!0;return e}function se(e){var t=d.createElement("div");try{return!!e(t)}catch(e){return!1}finally{t.parentNode&&t.parentNode.removeChild(t);t=null}}function pe(e,t){for(var o=e.split("|"),i=e.length;i--;)r.attrHandle[o[i]]=t}function ce(e,t){var o=t&&e,r=o&&1===e.nodeType&&1===t.nodeType&&(~t.sourceIndex||b)-(~e.sourceIndex||b);if(r)return r;if(o)for(;o=o.nextSibling;)if(o===t)return-1;return e?1:-1}function ue(e){return function(t){return"input"===t.nodeName.toLowerCase()&&t.type===e}}function ge(e){return function(t){var o=t.nodeName.toLowerCase();return("input"===o||"button"===o)&&t.type===e}}function de(e){return le(function(t){t=+t;return le(function(o,r){for(var i,n=e([],o.length,t),a=n.length;a--;)o[i=n[a]]&&(o[i]=!(r[i]=o[i]))})})}function he(e){return e&&void 0!==e.getElementsByTagName&&e}o=ne.support={};n=ne.isXML=function(e){var t=e&&(e.ownerDocument||e).documentElement;return!!t&&"HTML"!==t.nodeName};g=ne.setDocument=function(e){var t,i,a=e?e.ownerDocument||e:S;if(a===d||9!==a.nodeType||!a.documentElement)return d;d=a;h=a.documentElement;(i=a.defaultView)&&i!==i.top&&(i.addEventListener?i.addEventListener("unload",ie,!1):i.attachEvent&&i.attachEvent("onunload",ie));f=!n(a);o.attributes=se(function(e){e.className="i";return!e.getAttribute("className")});o.getElementsByTagName=se(function(e){e.appendChild(a.createComment(""));return!e.getElementsByTagName("*").length});o.getElementsByClassName=J.test(a.getElementsByClassName);o.getById=se(function(e){h.appendChild(e).id=T;return!a.getElementsByName||!a.getElementsByName(T).length});if(o.getById){r.find.ID=function(e,t){if(void 0!==t.getElementById&&f){var o=t.getElementById(e);return o&&o.parentNode?[o]:[]}};r.filter.ID=function(e){var t=e.replace(oe,re);return function(e){return e.getAttribute("id")===t}}}else{delete r.find.ID;r.filter.ID=function(e){var t=e.replace(oe,re);return function(e){var o=void 0!==e.getAttributeNode&&e.getAttributeNode("id");return o&&o.value===t}}}r.find.TAG=o.getElementsByTagName?function(e,t){return void 0!==t.getElementsByTagName?t.getElementsByTagName(e):o.qsa?t.querySelectorAll(e):void 0}:function(e,t){var o,r=[],i=0,n=t.getElementsByTagName(e);if("*"===e){for(;o=n[i++];)1===o.nodeType&&r.push(o);return r}return n};r.find.CLASS=o.getElementsByClassName&&function(e,t){if(f)return t.getElementsByClassName(e)};m=[];y=[];if(o.qsa=J.test(a.querySelectorAll)){se(function(e){h.appendChild(e).innerHTML="<a id='"+T+"'></a><select id='"+T+"-\f]' msallowcapture=''><option selected=''></option></select>";e.querySelectorAll("[msallowcapture^='']").length&&y.push("[*^$]="+k+"*(?:''|\"\")");e.querySelectorAll("[selected]").length||y.push("\\["+k+"*(?:value|"+F+")");e.querySelectorAll("[id~="+T+"-]").length||y.push("~=");e.querySelectorAll(":checked").length||y.push(":checked");e.querySelectorAll("a#"+T+"+*").length||y.push(".#.+[+~]")});se(function(e){var t=a.createElement("input");t.setAttribute("type","hidden");e.appendChild(t).setAttribute("name","D");e.querySelectorAll("[name=d]").length&&y.push("name"+k+"*[*^$|!~]?=");e.querySelectorAll(":enabled").length||y.push(":enabled",":disabled");e.querySelectorAll("*,:x");y.push(",.*:")})}(o.matchesSelector=J.test(v=h.matches||h.webkitMatchesSelector||h.mozMatchesSelector||h.oMatchesSelector||h.msMatchesSelector))&&se(function(e){o.disconnectedMatch=v.call(e,"div");v.call(e,"[s!='']:x");m.push("!=",$)});y=y.length&&new RegExp(y.join("|"));m=m.length&&new RegExp(m.join("|"));t=J.test(h.compareDocumentPosition);C=t||J.test(h.contains)?function(e,t){var o=9===e.nodeType?e.documentElement:e,r=t&&t.parentNode;return e===r||!(!r||1!==r.nodeType||!(o.contains?o.contains(r):e.compareDocumentPosition&&16&e.compareDocumentPosition(r)))}:function(e,t){if(t)for(;t=t.parentNode;)if(t===e)return!0;return!1};w=t?function(e,t){if(e===t){u=!0;return 0}var r=!e.compareDocumentPosition-!t.compareDocumentPosition;return r||(1&(r=(e.ownerDocument||e)===(t.ownerDocument||t)?e.compareDocumentPosition(t):1)||!o.sortDetached&&t.compareDocumentPosition(e)===r?e===a||e.ownerDocument===S&&C(S,e)?-1:t===a||t.ownerDocument===S&&C(S,t)?1:c?D(c,e)-D(c,t):0:4&r?-1:1)}:function(e,t){if(e===t){u=!0;return 0}var o,r=0,i=e.parentNode,n=t.parentNode,l=[e],s=[t];if(!i||!n)return e===a?-1:t===a?1:i?-1:n?1:c?D(c,e)-D(c,t):0;if(i===n)return ce(e,t);o=e;for(;o=o.parentNode;)l.unshift(o);o=t;for(;o=o.parentNode;)s.unshift(o);for(;l[r]===s[r];)r++;return r?ce(l[r],s[r]):l[r]===S?-1:s[r]===S?1:0};return a};ne.matches=function(e,t){return ne(e,null,null,t)};ne.matchesSelector=function(e,t){(e.ownerDocument||e)!==d&&g(e);t=t.replace(Y,"='$1']");if(o.matchesSelector&&f&&(!m||!m.test(t))&&(!y||!y.test(t)))try{var r=v.call(e,t);if(r||o.disconnectedMatch||e.document&&11!==e.document.nodeType)return r}catch(e){}return ne(t,d,null,[e]).length>0};ne.contains=function(e,t){(e.ownerDocument||e)!==d&&g(e);return C(e,t)};ne.attr=function(e,t){(e.ownerDocument||e)!==d&&g(e);var i=r.attrHandle[t.toLowerCase()],n=i&&R.call(r.attrHandle,t.toLowerCase())?i(e,t,!f):void 0;return void 0!==n?n:o.attributes||!f?e.getAttribute(t):(n=e.getAttributeNode(t))&&n.specified?n.value:null};ne.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)};ne.uniqueSort=function(e){var t,r=[],i=0,n=0;u=!o.detectDuplicates;c=!o.sortStable&&e.slice(0);e.sort(w);if(u){for(;t=e[n++];)t===e[n]&&(i=r.push(n));for(;i--;)e.splice(r[i],1)}c=null;return e};i=ne.getText=function(e){var t,o="",r=0,n=e.nodeType;if(n){if(1===n||9===n||11===n){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)o+=i(e)}else if(3===n||4===n)return e.nodeValue}else for(;t=e[r++];)o+=i(t);return o};(r=ne.selectors={cacheLength:50,createPseudo:le,match:H,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){e[1]=e[1].replace(oe,re);e[3]=(e[3]||e[4]||e[5]||"").replace(oe,re);"~="===e[2]&&(e[3]=" "+e[3]+" ");return e.slice(0,4)},CHILD:function(e){e[1]=e[1].toLowerCase();if("nth"===e[1].slice(0,3)){e[3]||ne.error(e[0]);e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3]));e[5]=+(e[7]+e[8]||"odd"===e[3])}else e[3]&&ne.error(e[0]);return e},PSEUDO:function(e){var t,o=!e[6]&&e[2];if(H.CHILD.test(e[0]))return null;if(e[3])e[2]=e[4]||e[5]||"";else if(o&&K.test(o)&&(t=a(o,!0))&&(t=o.indexOf(")",o.length-t)-o.length)){e[0]=e[0].slice(0,t);e[2]=o.slice(0,t)}return e.slice(0,3)}},filter:{TAG:function(e){var t=e.replace(oe,re).toLowerCase();return"*"===e?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=x[e+" "];return t||(t=new RegExp("(^|"+k+")"+e+"("+k+"|$)"))&&x(e,function(e){return t.test("string"==typeof e.className&&e.className||void 0!==e.getAttribute&&e.getAttribute("class")||"")})},ATTR:function(e,t,o){return function(r){var i=ne.attr(r,e);if(null==i)return"!="===t;if(!t)return!0;i+="";return"="===t?i===o:"!="===t?i!==o:"^="===t?o&&0===i.indexOf(o):"*="===t?o&&i.indexOf(o)>-1:"$="===t?o&&i.slice(-o.length)===o:"~="===t?(" "+i.replace(q," ")+" ").indexOf(o)>-1:"|="===t&&(i===o||i.slice(0,o.length+1)===o+"-")}},CHILD:function(e,t,o,r,i){var n="nth"!==e.slice(0,3),a="last"!==e.slice(-4),l="of-type"===t;return 1===r&&0===i?function(e){return!!e.parentNode}:function(t,o,s){var p,c,u,g,d,h,f=n!==a?"nextSibling":"previousSibling",y=t.parentNode,m=l&&t.nodeName.toLowerCase(),v=!s&&!l;if(y){if(n){for(;f;){u=t;for(;u=u[f];)if(l?u.nodeName.toLowerCase()===m:1===u.nodeType)return!1;h=f="only"===e&&!h&&"nextSibling"}return!0}h=[a?y.firstChild:y.lastChild];if(a&&v){d=(p=(c=y[T]||(y[T]={}))[e]||[])[0]===_&&p[1];g=p[0]===_&&p[2];u=d&&y.childNodes[d];for(;u=++d&&u&&u[f]||(g=d=0)||h.pop();)if(1===u.nodeType&&++g&&u===t){c[e]=[_,d,g];break}}else if(v&&(p=(t[T]||(t[T]={}))[e])&&p[0]===_)g=p[1];else for(;u=++d&&u&&u[f]||(g=d=0)||h.pop();)if((l?u.nodeName.toLowerCase()===m:1===u.nodeType)&&++g){v&&((u[T]||(u[T]={}))[e]=[_,g]);if(u===t)break}return(g-=i)===r||g%r==0&&g/r>=0}}},PSEUDO:function(e,t){var o,i=r.pseudos[e]||r.setFilters[e.toLowerCase()]||ne.error("unsupported pseudo: "+e);if(i[T])return i(t);if(i.length>1){o=[e,e,"",t];return r.setFilters.hasOwnProperty(e.toLowerCase())?le(function(e,o){for(var r,n=i(e,t),a=n.length;a--;)e[r=D(e,n[a])]=!(o[r]=n[a])}):function(e){return i(e,0,o)}}return i}},pseudos:{not:le(function(e){var t=[],o=[],r=l(e.replace(j,"$1"));return r[T]?le(function(e,t,o,i){for(var n,a=r(e,null,i,[]),l=e.length;l--;)(n=a[l])&&(e[l]=!(t[l]=n))}):function(e,i,n){t[0]=e;r(t,null,n,o);t[0]=null;return!o.pop()}}),has:le(function(e){return function(t){return ne(e,t).length>0}}),contains:le(function(e){e=e.replace(oe,re);return function(t){return(t.textContent||t.innerText||i(t)).indexOf(e)>-1}}),lang:le(function(e){X.test(e||"")||ne.error("unsupported lang: "+e);e=e.replace(oe,re).toLowerCase();return function(t){var o;do{if(o=f?t.lang:t.getAttribute("xml:lang")||t.getAttribute("lang"))return(o=o.toLowerCase())===e||0===o.indexOf(e+"-")}while((t=t.parentNode)&&1===t.nodeType);return!1}}),target:function(t){var o=e.location&&e.location.hash;return o&&o.slice(1)===t.id},root:function(e){return e===h},focus:function(e){return e===d.activeElement&&(!d.hasFocus||d.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:function(e){return!1===e.disabled},disabled:function(e){return!0===e.disabled},checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){e.parentNode&&e.parentNode.selectedIndex;return!0===e.selected},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType<6)return!1;return!0},parent:function(e){return!r.pseudos.empty(e)},header:function(e){return Z.test(e.nodeName)},input:function(e){return z.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||"text"===t.toLowerCase())},first:de(function(){return[0]}),last:de(function(e,t){return[t-1]}),eq:de(function(e,t,o){return[o<0?o+t:o]}),even:de(function(e,t){for(var o=0;o<t;o+=2)e.push(o);return e}),odd:de(function(e,t){for(var o=1;o<t;o+=2)e.push(o);return e}),lt:de(function(e,t,o){for(var r=o<0?o+t:o;--r>=0;)e.push(r);return e}),gt:de(function(e,t,o){for(var r=o<0?o+t:o;++r<t;)e.push(r);return e})}}).pseudos.nth=r.pseudos.eq;for(t in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})r.pseudos[t]=ue(t);for(t in{submit:!0,reset:!0})r.pseudos[t]=ge(t);function fe(){}fe.prototype=r.filters=r.pseudos;r.setFilters=new fe;a=ne.tokenize=function(e,t){var o,i,n,a,l,s,p,c=P[e+" "];if(c)return t?0:c.slice(0);l=e;s=[];p=r.preFilter;for(;l;){if(!o||(i=W.exec(l))){i&&(l=l.slice(i[0].length)||l);s.push(n=[])}o=!1;if(i=V.exec(l)){o=i.shift();n.push({value:o,type:i[0].replace(j," ")});l=l.slice(o.length)}for(a in r.filter)if((i=H[a].exec(l))&&(!p[a]||(i=p[a](i)))){o=i.shift();n.push({value:o,type:a,matches:i});l=l.slice(o.length)}if(!o)break}return t?l.length:l?ne.error(e):P(e,s).slice(0)};function ye(e){for(var t=0,o=e.length,r="";t<o;t++)r+=e[t].value;return r}function me(e,t,o){var r=t.dir,i=o&&"parentNode"===r,n=E++;return t.first?function(t,o,n){for(;t=t[r];)if(1===t.nodeType||i)return e(t,o,n)}:function(t,o,a){var l,s,p=[_,n];if(a){for(;t=t[r];)if((1===t.nodeType||i)&&e(t,o,a))return!0}else for(;t=t[r];)if(1===t.nodeType||i){if((l=(s=t[T]||(t[T]={}))[r])&&l[0]===_&&l[1]===n)return p[2]=l[2];s[r]=p;if(p[2]=e(t,o,a))return!0}}}function ve(e){return e.length>1?function(t,o,r){for(var i=e.length;i--;)if(!e[i](t,o,r))return!1;return!0}:e[0]}function Ce(e,t,o,r,i){for(var n,a=[],l=0,s=e.length,p=null!=t;l<s;l++)if((n=e[l])&&(!o||o(n,r,i))){a.push(n);p&&t.push(l)}return a}function Te(e,t,o,r,i,n){r&&!r[T]&&(r=Te(r));i&&!i[T]&&(i=Te(i,n));return le(function(n,a,l,s){var p,c,u,g=[],d=[],h=a.length,f=n||function(e,t,o){for(var r=0,i=t.length;r<i;r++)ne(e,t[r],o);return o}(t||"*",l.nodeType?[l]:l,[]),y=!e||!n&&t?f:Ce(f,g,e,l,s),m=o?i||(n?e:h||r)?[]:a:y;o&&o(y,m,l,s);if(r){p=Ce(m,d);r(p,[],l,s);c=p.length;for(;c--;)(u=p[c])&&(m[d[c]]=!(y[d[c]]=u))}if(n){if(i||e){if(i){p=[];c=m.length;for(;c--;)(u=m[c])&&p.push(y[c]=u);i(null,m=[],p,s)}c=m.length;for(;c--;)(u=m[c])&&(p=i?D(n,u):g[c])>-1&&(n[p]=!(a[p]=u))}}else{m=Ce(m===a?m.splice(h,m.length):m);i?i(null,a,m,s):O.apply(a,m)}})}function Se(e){for(var t,o,i,n=e.length,a=r.relative[e[0].type],l=a||r.relative[" "],s=a?1:0,c=me(function(e){return e===t},l,!0),u=me(function(e){return D(t,e)>-1},l,!0),g=[function(e,o,r){var i=!a&&(r||o!==p)||((t=o).nodeType?c(e,o,r):u(e,o,r));t=null;return i}];s<n;s++)if(o=r.relative[e[s].type])g=[me(ve(g),o)];else{if((o=r.filter[e[s].type].apply(null,e[s].matches))[T]){i=++s;for(;i<n&&!r.relative[e[i].type];i++);return Te(s>1&&ve(g),s>1&&ye(e.slice(0,s-1).concat({value:" "===e[s-2].type?"*":""})).replace(j,"$1"),o,s<i&&Se(e.slice(s,i)),i<n&&Se(e=e.slice(i)),i<n&&ye(e))}g.push(o)}return ve(g)}l=ne.compile=function(e,t){var o,i=[],n=[],l=L[e+" "];if(!l){t||(t=a(e));o=t.length;for(;o--;)(l=Se(t[o]))[T]?i.push(l):n.push(l);(l=L(e,function(e,t){var o=t.length>0,i=e.length>0,n=function(n,a,l,s,c){var u,g,h,f=0,y="0",m=n&&[],v=[],C=p,T=n||i&&r.find.TAG("*",c),S=_+=null==C?1:Math.random()||.1,E=T.length;c&&(p=a!==d&&a);for(;y!==E&&null!=(u=T[y]);y++){if(i&&u){g=0;for(;h=e[g++];)if(h(u,a,l)){s.push(u);break}c&&(_=S)}if(o){(u=!h&&u)&&f--;n&&m.push(u)}}f+=y;if(o&&y!==f){g=0;for(;h=t[g++];)h(m,v,a,l);if(n){if(f>0)for(;y--;)m[y]||v[y]||(v[y]=M.call(s));v=Ce(v)}O.apply(s,v);c&&!n&&v.length>0&&f+t.length>1&&ne.uniqueSort(s)}if(c){_=S;p=C}return m};return o?le(n):n}(n,i))).selector=e}return l};s=ne.select=function(e,t,i,n){var s,p,c,u,g,d="function"==typeof e&&e,h=!n&&a(e=d.selector||e);i=i||[];if(1===h.length){if((p=h[0]=h[0].slice(0)).length>2&&"ID"===(c=p[0]).type&&o.getById&&9===t.nodeType&&f&&r.relative[p[1].type]){if(!(t=(r.find.ID(c.matches[0].replace(oe,re),t)||[])[0]))return i;d&&(t=t.parentNode);e=e.slice(p.shift().value.length)}s=H.needsContext.test(e)?0:p.length;for(;s--;){c=p[s];if(r.relative[u=c.type])break;if((g=r.find[u])&&(n=g(c.matches[0].replace(oe,re),ee.test(p[0].type)&&he(t.parentNode)||t))){p.splice(s,1);if(!(e=n.length&&ye(p))){O.apply(i,n);return i}break}}}(d||l(e,h))(n,t,!f,i,ee.test(e)&&he(t.parentNode)||t);return i};o.sortStable=T.split("").sort(w).join("")===T;o.detectDuplicates=!!u;g();o.sortDetached=se(function(e){return 1&e.compareDocumentPosition(d.createElement("div"))});se(function(e){e.innerHTML="<a href='#'></a>";return"#"===e.firstChild.getAttribute("href")})||pe("type|href|height|width",function(e,t,o){if(!o)return e.getAttribute(t,"type"===t.toLowerCase()?1:2)});o.attributes&&se(function(e){e.innerHTML="<input/>";e.firstChild.setAttribute("value","");return""===e.firstChild.getAttribute("value")})||pe("value",function(e,t,o){if(!o&&"input"===e.nodeName.toLowerCase())return e.defaultValue});se(function(e){return null==e.getAttribute("disabled")})||pe(F,function(e,t,o){var r;if(!o)return!0===e[t]?t.toLowerCase():(r=e.getAttributeNode(t))&&r.specified?r.value:null});return ne}(e);g.find=v;g.expr=v.selectors;g.expr[":"]=g.expr.pseudos;g.unique=v.uniqueSort;g.text=v.getText;g.isXMLDoc=v.isXML;g.contains=v.contains;var C=g.expr.match.needsContext,T=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,S=/^.[^:#\[\.,]*$/;function _(e,t,o){if(g.isFunction(t))return g.grep(e,function(e,r){return!!t.call(e,r,e)!==o});if(t.nodeType)return g.grep(e,function(e){return e===t!==o});if("string"==typeof t){if(S.test(t))return g.filter(t,e,o);t=g.filter(t,e)}return g.grep(e,function(e){return a.call(t,e)>=0!==o})}g.filter=function(e,t,o){var r=t[0];o&&(e=":not("+e+")");return 1===t.length&&1===r.nodeType?g.find.matchesSelector(r,e)?[r]:[]:g.find.matches(e,g.grep(t,function(e){return 1===e.nodeType}))};g.fn.extend({find:function(e){var t,o=this.length,r=[],i=this;if("string"!=typeof e)return this.pushStack(g(e).filter(function(){for(t=0;t<o;t++)if(g.contains(i[t],this))return!0}));for(t=0;t<o;t++)g.find(e,i[t],r);(r=this.pushStack(o>1?g.unique(r):r)).selector=this.selector?this.selector+" "+e:e;return r},filter:function(e){return this.pushStack(_(this,e||[],!1))},not:function(e){return this.pushStack(_(this,e||[],!0))},is:function(e){return!!_(this,"string"==typeof e&&C.test(e)?g(e):e||[],!1).length}});var E,x=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/;(g.fn.init=function(e,t){var o,r;if(!e)return this;if("string"==typeof e){if(!(o="<"===e[0]&&">"===e[e.length-1]&&e.length>=3?[null,e,null]:x.exec(e))||!o[1]&&t)return!t||t.jquery?(t||E).find(e):this.constructor(t).find(e);if(o[1]){t=t instanceof g?t[0]:t;g.merge(this,g.parseHTML(o[1],t&&t.nodeType?t.ownerDocument||t:u,!0));if(T.test(o[1])&&g.isPlainObject(t))for(o in t)g.isFunction(this[o])?this[o](t[o]):this.attr(o,t[o]);return this}if((r=u.getElementById(o[2]))&&r.parentNode){this.length=1;this[0]=r}this.context=u;this.selector=e;return this}if(e.nodeType){this.context=this[0]=e;this.length=1;return this}if(g.isFunction(e))return void 0!==E.ready?E.ready(e):e(g);if(void 0!==e.selector){this.selector=e.selector;this.context=e.context}return g.makeArray(e,this)}).prototype=g.fn;E=g(u);var P=/^(?:parents|prev(?:Until|All))/,L={children:!0,contents:!0,next:!0,prev:!0};g.extend({dir:function(e,t,o){for(var r=[],i=void 0!==o;(e=e[t])&&9!==e.nodeType;)if(1===e.nodeType){if(i&&g(e).is(o))break;r.push(e)}return r},sibling:function(e,t){for(var o=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&o.push(e);return o}});g.fn.extend({has:function(e){var t=g(e,this),o=t.length;return this.filter(function(){for(var e=0;e<o;e++)if(g.contains(this,t[e]))return!0})},closest:function(e,t){for(var o,r=0,i=this.length,n=[],a=C.test(e)||"string"!=typeof e?g(e,t||this.context):0;r<i;r++)for(o=this[r];o&&o!==t;o=o.parentNode)if(o.nodeType<11&&(a?a.index(o)>-1:1===o.nodeType&&g.find.matchesSelector(o,e))){n.push(o);break}return this.pushStack(n.length>1?g.unique(n):n)},index:function(e){return e?"string"==typeof e?a.call(g(e),this[0]):a.call(this,e.jquery?e[0]:e):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){return this.pushStack(g.unique(g.merge(this.get(),g(e,t))))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}});function w(e,t){for(;(e=e[t])&&1!==e.nodeType;);return e}g.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return g.dir(e,"parentNode")},parentsUntil:function(e,t,o){return g.dir(e,"parentNode",o)},next:function(e){return w(e,"nextSibling")},prev:function(e){return w(e,"previousSibling")},nextAll:function(e){return g.dir(e,"nextSibling")},prevAll:function(e){return g.dir(e,"previousSibling")},nextUntil:function(e,t,o){return g.dir(e,"nextSibling",o)},prevUntil:function(e,t,o){return g.dir(e,"previousSibling",o)},siblings:function(e){return g.sibling((e.parentNode||{}).firstChild,e)},children:function(e){return g.sibling(e.firstChild)},contents:function(e){return e.contentDocument||g.merge([],e.childNodes)}},function(e,t){g.fn[e]=function(o,r){var i=g.map(this,t,o);"Until"!==e.slice(-5)&&(r=o);r&&"string"==typeof r&&(i=g.filter(r,i));if(this.length>1){L[e]||g.unique(i);P.test(e)&&i.reverse()}return this.pushStack(i)}});var b,R=/\S+/g,A={};g.Callbacks=function(e){var t,o,r,i,n,a,l=[],s=!(e="string"==typeof e?A[e]||function(e){var t=A[e]={};g.each(e.match(R)||[],function(e,o){t[o]=!0});return t}(e):g.extend({},e)).once&&[],p=function(u){t=e.memory&&u;o=!0;a=i||0;i=0;n=l.length;r=!0;for(;l&&a<n;a++)if(!1===l[a].apply(u[0],u[1])&&e.stopOnFalse){t=!1;break}r=!1;l&&(s?s.length&&p(s.shift()):t?l=[]:c.disable())},c={add:function(){if(l){var o=l.length;!function t(o){g.each(o,function(o,r){var i=g.type(r);"function"===i?e.unique&&c.has(r)||l.push(r):r&&r.length&&"string"!==i&&t(r)})}(arguments);if(r)n=l.length;else if(t){i=o;p(t)}}return this},remove:function(){l&&g.each(arguments,function(e,t){for(var o;(o=g.inArray(t,l,o))>-1;){l.splice(o,1);if(r){o<=n&&n--;o<=a&&a--}}});return this},has:function(e){return e?g.inArray(e,l)>-1:!(!l||!l.length)},empty:function(){l=[];n=0;return this},disable:function(){l=s=t=void 0;return this},disabled:function(){return!l},lock:function(){s=void 0;t||c.disable();return this},locked:function(){return!s},fireWith:function(e,t){if(l&&(!o||s)){t=[e,(t=t||[]).slice?t.slice():t];r?s.push(t):p(t)}return this},fire:function(){c.fireWith(this,arguments);return this},fired:function(){return!!o}};return c};g.extend({Deferred:function(e){var t=[["resolve","done",g.Callbacks("once memory"),"resolved"],["reject","fail",g.Callbacks("once memory"),"rejected"],["notify","progress",g.Callbacks("memory")]],o="pending",r={state:function(){return o},always:function(){i.done(arguments).fail(arguments);return this},then:function(){var e=arguments;return g.Deferred(function(o){g.each(t,function(t,n){var a=g.isFunction(e[t])&&e[t];i[n[1]](function(){var e=a&&a.apply(this,arguments);e&&g.isFunction(e.promise)?e.promise().done(o.resolve).fail(o.reject).progress(o.notify):o[n[0]+"With"](this===r?o.promise():this,a?[e]:arguments)})});e=null}).promise()},promise:function(e){return null!=e?g.extend(e,r):r}},i={};r.pipe=r.then;g.each(t,function(e,n){var a=n[2],l=n[3];r[n[1]]=a.add;l&&a.add(function(){o=l},t[1^e][2].disable,t[2][2].lock);i[n[0]]=function(){i[n[0]+"With"](this===i?r:this,arguments);return this};i[n[0]+"With"]=a.fireWith});r.promise(i);e&&e.call(i,i);return i},when:function(e){var t,o,i,n=0,a=r.call(arguments),l=a.length,s=1!==l||e&&g.isFunction(e.promise)?l:0,p=1===s?e:g.Deferred(),c=function(e,o,i){return function(n){o[e]=this;i[e]=arguments.length>1?r.call(arguments):n;i===t?p.notifyWith(o,i):--s||p.resolveWith(o,i)}};if(l>1){t=new Array(l);o=new Array(l);i=new Array(l);for(;n<l;n++)a[n]&&g.isFunction(a[n].promise)?a[n].promise().done(c(n,i,a)).fail(p.reject).progress(c(n,o,t)):--s}s||p.resolveWith(i,a);return p.promise()}});g.fn.ready=function(e){g.ready.promise().done(e);return this};g.extend({isReady:!1,readyWait:1,holdReady:function(e){e?g.readyWait++:g.ready(!0)},ready:function(e){if(!0===e?!--g.readyWait:!g.isReady){g.isReady=!0;if(!(!0!==e&&--g.readyWait>0)){b.resolveWith(u,[g]);if(g.fn.triggerHandler){g(u).triggerHandler("ready");g(u).off("ready")}}}}});function M(){u.removeEventListener("DOMContentLoaded",M,!1);e.removeEventListener("load",M,!1);g.ready()}g.ready.promise=function(t){if(!b){b=g.Deferred();if("complete"===u.readyState)setTimeout(g.ready);else{u.addEventListener("DOMContentLoaded",M,!1);e.addEventListener("load",M,!1)}}return b.promise(t)};g.ready.promise();var I=g.access=function(e,t,o,r,i,n,a){var l=0,s=e.length,p=null==o;if("object"===g.type(o)){i=!0;for(l in o)g.access(e,t,l,o[l],!0,n,a)}else if(void 0!==r){i=!0;g.isFunction(r)||(a=!0);if(p)if(a){t.call(e,r);t=null}else{p=t;t=function(e,t,o){return p.call(g(e),o)}}if(t)for(;l<s;l++)t(e[l],o,a?r:r.call(e[l],l,t(e[l],o)))}return i?e:p?t.call(e):s?t(e[0],o):n};g.acceptData=function(e){return 1===e.nodeType||9===e.nodeType||!+e.nodeType};function O(){Object.defineProperty(this.cache={},0,{get:function(){return{}}});this.expando=g.expando+O.uid++}O.uid=1;O.accepts=g.acceptData;O.prototype={key:function(e){if(!O.accepts(e))return 0;var t={},o=e[this.expando];if(!o){o=O.uid++;try{t[this.expando]={value:o};Object.defineProperties(e,t)}catch(r){t[this.expando]=o;g.extend(e,t)}}this.cache[o]||(this.cache[o]={});return o},set:function(e,t,o){var r,i=this.key(e),n=this.cache[i];if("string"==typeof t)n[t]=o;else if(g.isEmptyObject(n))g.extend(this.cache[i],t);else for(r in t)n[r]=t[r];return n},get:function(e,t){var o=this.cache[this.key(e)];return void 0===t?o:o[t]},access:function(e,t,o){var r;if(void 0===t||t&&"string"==typeof t&&void 0===o)return void 0!==(r=this.get(e,t))?r:this.get(e,g.camelCase(t));this.set(e,t,o);return void 0!==o?o:t},remove:function(e,t){var o,r,i,n=this.key(e),a=this.cache[n];if(void 0===t)this.cache[n]={};else{if(g.isArray(t))r=t.concat(t.map(g.camelCase));else{i=g.camelCase(t);r=t in a?[t,i]:(r=i)in a?[r]:r.match(R)||[]}o=r.length;for(;o--;)delete a[r[o]]}},hasData:function(e){return!g.isEmptyObject(this.cache[e[this.expando]]||{})},discard:function(e){e[this.expando]&&delete this.cache[e[this.expando]]}};var N=new O,D=new O,F=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,k=/([A-Z])/g;function G(e,t,o){var r;if(void 0===o&&1===e.nodeType){r="data-"+t.replace(k,"-$1").toLowerCase();if("string"==typeof(o=e.getAttribute(r))){try{o="true"===o||"false"!==o&&("null"===o?null:+o+""===o?+o:F.test(o)?g.parseJSON(o):o)}catch(e){}D.set(e,t,o)}else o=void 0}return o}g.extend({hasData:function(e){return D.hasData(e)||N.hasData(e)},data:function(e,t,o){return D.access(e,t,o)},removeData:function(e,t){D.remove(e,t)},_data:function(e,t,o){return N.access(e,t,o)},_removeData:function(e,t){N.remove(e,t)}});g.fn.extend({data:function(e,t){var o,r,i,n=this[0],a=n&&n.attributes;if(void 0===e){if(this.length){i=D.get(n);if(1===n.nodeType&&!N.get(n,"hasDataAttrs")){o=a.length;for(;o--;)if(a[o]&&0===(r=a[o].name).indexOf("data-")){r=g.camelCase(r.slice(5));G(n,r,i[r])}N.set(n,"hasDataAttrs",!0)}}return i}return"object"==typeof e?this.each(function(){D.set(this,e)}):I(this,function(t){var o,r=g.camelCase(e);if(n&&void 0===t)return void 0!==(o=D.get(n,e))?o:void 0!==(o=D.get(n,r))?o:void 0!==(o=G(n,r,void 0))?o:void 0;this.each(function(){var o=D.get(this,r);D.set(this,r,t);-1!==e.indexOf("-")&&void 0!==o&&D.set(this,e,t)})},null,t,arguments.length>1,null,!0)},removeData:function(e){return this.each(function(){D.remove(this,e)})}});g.extend({queue:function(e,t,o){var r;if(e){t=(t||"fx")+"queue";r=N.get(e,t);o&&(!r||g.isArray(o)?r=N.access(e,t,g.makeArray(o)):r.push(o));return r||[]}},dequeue:function(e,t){t=t||"fx";var o=g.queue(e,t),r=o.length,i=o.shift(),n=g._queueHooks(e,t);if("inprogress"===i){i=o.shift();r--}if(i){"fx"===t&&o.unshift("inprogress");delete n.stop;i.call(e,function(){g.dequeue(e,t)},n)}!r&&n&&n.empty.fire()},_queueHooks:function(e,t){var o=t+"queueHooks";return N.get(e,o)||N.access(e,o,{empty:g.Callbacks("once memory").add(function(){N.remove(e,[t+"queue",o])})})}});g.fn.extend({queue:function(e,t){var o=2;if("string"!=typeof e){t=e;e="fx";o--}return arguments.length<o?g.queue(this[0],e):void 0===t?this:this.each(function(){var o=g.queue(this,e,t);g._queueHooks(this,e);"fx"===e&&"inprogress"!==o[0]&&g.dequeue(this,e)})},dequeue:function(e){return this.each(function(){g.dequeue(this,e)})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,t){var o,r=1,i=g.Deferred(),n=this,a=this.length,l=function(){--r||i.resolveWith(n,[n])};if("string"!=typeof e){t=e;e=void 0}e=e||"fx";for(;a--;)if((o=N.get(n[a],e+"queueHooks"))&&o.empty){r++;o.empty.add(l)}l();return i.promise(t)}});var U=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,B=["Top","Right","Bottom","Left"],$=function(e,t){e=t||e;return"none"===g.css(e,"display")||!g.contains(e.ownerDocument,e)},q=/^(?:checkbox|radio)$/i;!function(){var e=u.createDocumentFragment().appendChild(u.createElement("div")),t=u.createElement("input");t.setAttribute("type","radio");t.setAttribute("checked","checked");t.setAttribute("name","t");e.appendChild(t);c.checkClone=e.cloneNode(!0).cloneNode(!0).lastChild.checked;e.innerHTML="<textarea>x</textarea>";c.noCloneChecked=!!e.cloneNode(!0).lastChild.defaultValue}();c.focusinBubbles="onfocusin"in e;var j=/^key/,W=/^(?:mouse|pointer|contextmenu)|click/,V=/^(?:focusinfocus|focusoutblur)$/,Y=/^([^.]*)(?:\.(.+)|)$/;function K(){return!0}function X(){return!1}function H(){try{return u.activeElement}catch(e){}}g.event={global:{},add:function(e,t,o,r,i){var n,a,l,s,p,c,u,d,h,f,y,m=N.get(e);if(m){if(o.handler){o=(n=o).handler;i=n.selector}o.guid||(o.guid=g.guid++);(s=m.events)||(s=m.events={});(a=m.handle)||(a=m.handle=function(t){return void 0!==g&&g.event.triggered!==t.type?g.event.dispatch.apply(e,arguments):void 0});p=(t=(t||"").match(R)||[""]).length;for(;p--;){h=y=(l=Y.exec(t[p])||[])[1];f=(l[2]||"").split(".").sort();if(h){u=g.event.special[h]||{};h=(i?u.delegateType:u.bindType)||h;u=g.event.special[h]||{};c=g.extend({type:h,origType:y,data:r,handler:o,guid:o.guid,selector:i,needsContext:i&&g.expr.match.needsContext.test(i),namespace:f.join(".")},n);if(!(d=s[h])){(d=s[h]=[]).delegateCount=0;u.setup&&!1!==u.setup.call(e,r,f,a)||e.addEventListener&&e.addEventListener(h,a,!1)}if(u.add){u.add.call(e,c);c.handler.guid||(c.handler.guid=o.guid)}i?d.splice(d.delegateCount++,0,c):d.push(c);g.event.global[h]=!0}}}},remove:function(e,t,o,r,i){var n,a,l,s,p,c,u,d,h,f,y,m=N.hasData(e)&&N.get(e);if(m&&(s=m.events)){p=(t=(t||"").match(R)||[""]).length;for(;p--;){h=y=(l=Y.exec(t[p])||[])[1];f=(l[2]||"").split(".").sort();if(h){u=g.event.special[h]||{};d=s[h=(r?u.delegateType:u.bindType)||h]||[];l=l[2]&&new RegExp("(^|\\.)"+f.join("\\.(?:.*\\.|)")+"(\\.|$)");a=n=d.length;for(;n--;){c=d[n];if((i||y===c.origType)&&(!o||o.guid===c.guid)&&(!l||l.test(c.namespace))&&(!r||r===c.selector||"**"===r&&c.selector)){d.splice(n,1);c.selector&&d.delegateCount--;u.remove&&u.remove.call(e,c)}}if(a&&!d.length){u.teardown&&!1!==u.teardown.call(e,f,m.handle)||g.removeEvent(e,h,m.handle);delete s[h]}}else for(h in s)g.event.remove(e,h+t[p],o,r,!0)}if(g.isEmptyObject(s)){delete m.handle;N.remove(e,"events")}}},trigger:function(t,o,r,i){var n,a,l,s,c,d,h,f=[r||u],y=p.call(t,"type")?t.type:t,m=p.call(t,"namespace")?t.namespace.split("."):[];a=l=r=r||u;if(3!==r.nodeType&&8!==r.nodeType&&!V.test(y+g.event.triggered)){if(y.indexOf(".")>=0){y=(m=y.split(".")).shift();m.sort()}c=y.indexOf(":")<0&&"on"+y;(t=t[g.expando]?t:new g.Event(y,"object"==typeof t&&t)).isTrigger=i?2:3;t.namespace=m.join(".");t.namespace_re=t.namespace?new RegExp("(^|\\.)"+m.join("\\.(?:.*\\.|)")+"(\\.|$)"):null;t.result=void 0;t.target||(t.target=r);o=null==o?[t]:g.makeArray(o,[t]);h=g.event.special[y]||{};if(i||!h.trigger||!1!==h.trigger.apply(r,o)){if(!i&&!h.noBubble&&!g.isWindow(r)){s=h.delegateType||y;V.test(s+y)||(a=a.parentNode);for(;a;a=a.parentNode){f.push(a);l=a}l===(r.ownerDocument||u)&&f.push(l.defaultView||l.parentWindow||e)}n=0;for(;(a=f[n++])&&!t.isPropagationStopped();){t.type=n>1?s:h.bindType||y;(d=(N.get(a,"events")||{})[t.type]&&N.get(a,"handle"))&&d.apply(a,o);if((d=c&&a[c])&&d.apply&&g.acceptData(a)){t.result=d.apply(a,o);!1===t.result&&t.preventDefault()}}t.type=y;if(!i&&!t.isDefaultPrevented()&&(!h._default||!1===h._default.apply(f.pop(),o))&&g.acceptData(r)&&c&&g.isFunction(r[y])&&!g.isWindow(r)){(l=r[c])&&(r[c]=null);g.event.triggered=y;r[y]();g.event.triggered=void 0;l&&(r[c]=l)}return t.result}}},dispatch:function(e){e=g.event.fix(e);var t,o,i,n,a,l,s=r.call(arguments),p=(N.get(this,"events")||{})[e.type]||[],c=g.event.special[e.type]||{};s[0]=e;e.delegateTarget=this;if(!c.preDispatch||!1!==c.preDispatch.call(this,e)){l=g.event.handlers.call(this,e,p);t=0;for(;(n=l[t++])&&!e.isPropagationStopped();){e.currentTarget=n.elem;o=0;for(;(a=n.handlers[o++])&&!e.isImmediatePropagationStopped();)if(!e.namespace_re||e.namespace_re.test(a.namespace)){e.handleObj=a;e.data=a.data;if(void 0!==(i=((g.event.special[a.origType]||{}).handle||a.handler).apply(n.elem,s))&&!1===(e.result=i)){e.preventDefault();e.stopPropagation()}}}c.postDispatch&&c.postDispatch.call(this,e);return e.result}},handlers:function(e,t){var o,r,i,n,a=[],l=t.delegateCount,s=e.target;if(l&&s.nodeType&&(!e.button||"click"!==e.type))for(;s!==this;s=s.parentNode||this)if(!0!==s.disabled||"click"!==e.type){r=[];for(o=0;o<l;o++){void 0===r[i=(n=t[o]).selector+" "]&&(r[i]=n.needsContext?g(i,this).index(s)>=0:g.find(i,this,null,[s]).length);r[i]&&r.push(n)}r.length&&a.push({elem:s,handlers:r})}l<t.length&&a.push({elem:this,handlers:t.slice(l)});return a},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(e,t){null==e.which&&(e.which=null!=t.charCode?t.charCode:t.keyCode);return e}},mouseHooks:{props:"button buttons clientX clientY offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(e,t){var o,r,i,n=t.button;if(null==e.pageX&&null!=t.clientX){r=(o=e.target.ownerDocument||u).documentElement;i=o.body;e.pageX=t.clientX+(r&&r.scrollLeft||i&&i.scrollLeft||0)-(r&&r.clientLeft||i&&i.clientLeft||0);e.pageY=t.clientY+(r&&r.scrollTop||i&&i.scrollTop||0)-(r&&r.clientTop||i&&i.clientTop||0)}e.which||void 0===n||(e.which=1&n?1:2&n?3:4&n?2:0);return e}},fix:function(e){if(e[g.expando])return e;var t,o,r,i=e.type,n=e,a=this.fixHooks[i];a||(this.fixHooks[i]=a=W.test(i)?this.mouseHooks:j.test(i)?this.keyHooks:{});r=a.props?this.props.concat(a.props):this.props;e=new g.Event(n);t=r.length;for(;t--;)e[o=r[t]]=n[o];e.target||(e.target=u);3===e.target.nodeType&&(e.target=e.target.parentNode);return a.filter?a.filter(e,n):e},special:{load:{noBubble:!0},focus:{trigger:function(){if(this!==H()&&this.focus){this.focus();return!1}},delegateType:"focusin"},blur:{trigger:function(){if(this===H()&&this.blur){this.blur();return!1}},delegateType:"focusout"},click:{trigger:function(){if("checkbox"===this.type&&this.click&&g.nodeName(this,"input")){this.click();return!1}},_default:function(e){return g.nodeName(e.target,"a")}},beforeunload:{postDispatch:function(e){void 0!==e.result&&e.originalEvent&&(e.originalEvent.returnValue=e.result)}}},simulate:function(e,t,o,r){var i=g.extend(new g.Event,o,{type:e,isSimulated:!0,originalEvent:{}});r?g.event.trigger(i,null,t):g.event.dispatch.call(t,i);i.isDefaultPrevented()&&o.preventDefault()}};g.removeEvent=function(e,t,o){e.removeEventListener&&e.removeEventListener(t,o,!1)};g.Event=function(e,t){if(!(this instanceof g.Event))return new g.Event(e,t);if(e&&e.type){this.originalEvent=e;this.type=e.type;this.isDefaultPrevented=e.defaultPrevented||void 0===e.defaultPrevented&&!1===e.returnValue?K:X}else this.type=e;t&&g.extend(this,t);this.timeStamp=e&&e.timeStamp||g.now();this[g.expando]=!0};g.Event.prototype={isDefaultPrevented:X,isPropagationStopped:X,isImmediatePropagationStopped:X,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=K;e&&e.preventDefault&&e.preventDefault()},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=K;e&&e.stopPropagation&&e.stopPropagation()},stopImmediatePropagation:function(){var e=this.originalEvent;this.isImmediatePropagationStopped=K;e&&e.stopImmediatePropagation&&e.stopImmediatePropagation();this.stopPropagation()}};g.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(e,t){g.event.special[e]={delegateType:t,bindType:t,handle:function(e){var o,r=e.relatedTarget,i=e.handleObj;if(!r||r!==this&&!g.contains(this,r)){e.type=i.origType;o=i.handler.apply(this,arguments);e.type=t}return o}}});c.focusinBubbles||g.each({focus:"focusin",blur:"focusout"},function(e,t){var o=function(e){g.event.simulate(t,e.target,g.event.fix(e),!0)};g.event.special[t]={setup:function(){var r=this.ownerDocument||this,i=N.access(r,t);i||r.addEventListener(e,o,!0);N.access(r,t,(i||0)+1)},teardown:function(){var r=this.ownerDocument||this,i=N.access(r,t)-1;if(i)N.access(r,t,i);else{r.removeEventListener(e,o,!0);N.remove(r,t)}}}});g.fn.extend({on:function(e,t,o,r,i){var n,a;if("object"==typeof e){if("string"!=typeof t){o=o||t;t=void 0}for(a in e)this.on(a,t,o,e[a],i);return this}if(null==o&&null==r){r=t;o=t=void 0}else if(null==r)if("string"==typeof t){r=o;o=void 0}else{r=o;o=t;t=void 0}if(!1===r)r=X;else if(!r)return this;if(1===i){n=r;(r=function(e){g().off(e);return n.apply(this,arguments)}).guid=n.guid||(n.guid=g.guid++)}return this.each(function(){g.event.add(this,e,r,o,t)})},one:function(e,t,o,r){return this.on(e,t,o,r,1)},off:function(e,t,o){var r,i;if(e&&e.preventDefault&&e.handleObj){r=e.handleObj;g(e.delegateTarget).off(r.namespace?r.origType+"."+r.namespace:r.origType,r.selector,r.handler);return this}if("object"==typeof e){for(i in e)this.off(i,t,e[i]);return this}if(!1===t||"function"==typeof t){o=t;t=void 0}!1===o&&(o=X);return this.each(function(){g.event.remove(this,e,o,t)})},trigger:function(e,t){return this.each(function(){g.event.trigger(e,t,this)})},triggerHandler:function(e,t){var o=this[0];if(o)return g.event.trigger(e,t,o,!0)}});var z=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,Z=/<([\w:]+)/,J=/<|&#?\w+;/,Q=/<(?:script|style|link)/i,ee=/checked\s*(?:[^=]|=\s*.checked.)/i,te=/^$|\/(?:java|ecma)script/i,oe=/^true\/(.*)/,re=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,ie={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};ie.optgroup=ie.option;ie.tbody=ie.tfoot=ie.colgroup=ie.caption=ie.thead;ie.th=ie.td;function ne(e,t){return g.nodeName(e,"table")&&g.nodeName(11!==t.nodeType?t:t.firstChild,"tr")?e.getElementsByTagName("tbody")[0]||e.appendChild(e.ownerDocument.createElement("tbody")):e}function ae(e){e.type=(null!==e.getAttribute("type"))+"/"+e.type;return e}function le(e){var t=oe.exec(e.type);t?e.type=t[1]:e.removeAttribute("type");return e}function se(e,t){for(var o=0,r=e.length;o<r;o++)N.set(e[o],"globalEval",!t||N.get(t[o],"globalEval"))}function pe(e,t){var o,r,i,n,a,l,s,p;if(1===t.nodeType){if(N.hasData(e)){n=N.access(e);a=N.set(t,n);if(p=n.events){delete a.handle;a.events={};for(i in p)for(o=0,r=p[i].length;o<r;o++)g.event.add(t,i,p[i][o])}}if(D.hasData(e)){l=D.access(e);s=g.extend({},l);D.set(t,s)}}}function ce(e,t){var o=e.getElementsByTagName?e.getElementsByTagName(t||"*"):e.querySelectorAll?e.querySelectorAll(t||"*"):[];return void 0===t||t&&g.nodeName(e,t)?g.merge([e],o):o}g.extend({clone:function(e,t,o){var r,i,n,a,l,s,p,u=e.cloneNode(!0),d=g.contains(e.ownerDocument,e);if(!(c.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||g.isXMLDoc(e))){a=ce(u);for(r=0,i=(n=ce(e)).length;r<i;r++)l=n[r],s=a[r],void 0,"input"===(p=s.nodeName.toLowerCase())&&q.test(l.type)?s.checked=l.checked:"input"!==p&&"textarea"!==p||(s.defaultValue=l.defaultValue)}if(t)if(o){n=n||ce(e);a=a||ce(u);for(r=0,i=n.length;r<i;r++)pe(n[r],a[r])}else pe(e,u);(a=ce(u,"script")).length>0&&se(a,!d&&ce(e,"script"));return u},buildFragment:function(e,t,o,r){for(var i,n,a,l,s,p,c=t.createDocumentFragment(),u=[],d=0,h=e.length;d<h;d++)if((i=e[d])||0===i)if("object"===g.type(i))g.merge(u,i.nodeType?[i]:i);else if(J.test(i)){n=n||c.appendChild(t.createElement("div"));a=(Z.exec(i)||["",""])[1].toLowerCase();l=ie[a]||ie._default;n.innerHTML=l[1]+i.replace(z,"<$1></$2>")+l[2];p=l[0];for(;p--;)n=n.lastChild;g.merge(u,n.childNodes);(n=c.firstChild).textContent=""}else u.push(t.createTextNode(i));c.textContent="";d=0;for(;i=u[d++];)if(!r||-1===g.inArray(i,r)){s=g.contains(i.ownerDocument,i);n=ce(c.appendChild(i),"script");s&&se(n);if(o){p=0;for(;i=n[p++];)te.test(i.type||"")&&o.push(i)}}return c},cleanData:function(e){for(var t,o,r,i,n=g.event.special,a=0;void 0!==(o=e[a]);a++){if(g.acceptData(o)&&(i=o[N.expando])&&(t=N.cache[i])){if(t.events)for(r in t.events)n[r]?g.event.remove(o,r):g.removeEvent(o,r,t.handle);N.cache[i]&&delete N.cache[i]}delete D.cache[o[D.expando]]}}});g.fn.extend({text:function(e){return I(this,function(e){return void 0===e?g.text(this):this.empty().each(function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=e)})},null,e,arguments.length)},append:function(){return this.domManip(arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){ne(this,e).appendChild(e)}})},prepend:function(){return this.domManip(arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=ne(this,e);t.insertBefore(e,t.firstChild)}})},before:function(){return this.domManip(arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return this.domManip(arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},remove:function(e,t){for(var o,r=e?g.filter(e,this):this,i=0;null!=(o=r[i]);i++){t||1!==o.nodeType||g.cleanData(ce(o));if(o.parentNode){t&&g.contains(o.ownerDocument,o)&&se(ce(o,"script"));o.parentNode.removeChild(o)}}return this},empty:function(){for(var e,t=0;null!=(e=this[t]);t++)if(1===e.nodeType){g.cleanData(ce(e,!1));e.textContent=""}return this},clone:function(e,t){e=null!=e&&e;t=null==t?e:t;return this.map(function(){return g.clone(this,e,t)})},html:function(e){return I(this,function(e){var t=this[0]||{},o=0,r=this.length;if(void 0===e&&1===t.nodeType)return t.innerHTML;if("string"==typeof e&&!Q.test(e)&&!ie[(Z.exec(e)||["",""])[1].toLowerCase()]){e=e.replace(z,"<$1></$2>");try{for(;o<r;o++)if(1===(t=this[o]||{}).nodeType){g.cleanData(ce(t,!1));t.innerHTML=e}t=0}catch(e){}}t&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(){var e=arguments[0];this.domManip(arguments,function(t){e=this.parentNode;g.cleanData(ce(this));e&&e.replaceChild(t,this)});return e&&(e.length||e.nodeType)?this:this.remove()},detach:function(e){return this.remove(e,!0)},domManip:function(e,t){e=i.apply([],e);var o,r,n,a,l,s,p=0,u=this.length,d=this,h=u-1,f=e[0],y=g.isFunction(f);if(y||u>1&&"string"==typeof f&&!c.checkClone&&ee.test(f))return this.each(function(o){var r=d.eq(o);y&&(e[0]=f.call(this,o,r.html()));r.domManip(e,t)});if(u){r=(o=g.buildFragment(e,this[0].ownerDocument,!1,this)).firstChild;1===o.childNodes.length&&(o=r);if(r){a=(n=g.map(ce(o,"script"),ae)).length;for(;p<u;p++){l=o;if(p!==h){l=g.clone(l,!0,!0);a&&g.merge(n,ce(l,"script"))}t.call(this[p],l,p)}if(a){s=n[n.length-1].ownerDocument;g.map(n,le);for(p=0;p<a;p++){l=n[p];te.test(l.type||"")&&!N.access(l,"globalEval")&&g.contains(s,l)&&(l.src?g._evalUrl&&g._evalUrl(l.src):g.globalEval(l.textContent.replace(re,"")))}}}}return this}});g.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,t){g.fn[e]=function(e){for(var o,r=[],i=g(e),a=i.length-1,l=0;l<=a;l++){o=l===a?this:this.clone(!0);g(i[l])[t](o);n.apply(r,o.get())}return this.pushStack(r)}});var ue,ge={};function de(t,o){var r,i=g(o.createElement(t)).appendTo(o.body),n=e.getDefaultComputedStyle&&(r=e.getDefaultComputedStyle(i[0]))?r.display:g.css(i[0],"display");i.detach();return n}function he(e){var t=u,o=ge[e];if(!o){if("none"===(o=de(e,t))||!o){(t=(ue=(ue||g("<iframe frameborder='0' width='0' height='0'/>")).appendTo(t.documentElement))[0].contentDocument).write();t.close();o=de(e,t);ue.detach()}ge[e]=o}return o}var fe=/^margin/,ye=new RegExp("^("+U+")(?!px)[a-z%]+$","i"),me=function(t){return t.ownerDocument.defaultView.opener?t.ownerDocument.defaultView.getComputedStyle(t,null):e.getComputedStyle(t,null)};function ve(e,t,o){var r,i,n,a,l=e.style;(o=o||me(e))&&(a=o.getPropertyValue(t)||o[t]);if(o){""!==a||g.contains(e.ownerDocument,e)||(a=g.style(e,t));if(ye.test(a)&&fe.test(t)){r=l.width;i=l.minWidth;n=l.maxWidth;l.minWidth=l.maxWidth=l.width=a;a=o.width;l.width=r;l.minWidth=i;l.maxWidth=n}}return void 0!==a?a+"":a}function Ce(e,t){return{get:function(){if(!e())return(this.get=t).apply(this,arguments);delete this.get}}}!function(){var t,o,r=u.documentElement,i=u.createElement("div"),n=u.createElement("div");if(n.style){n.style.backgroundClip="content-box";n.cloneNode(!0).style.backgroundClip="";c.clearCloneStyle="content-box"===n.style.backgroundClip;i.style.cssText="border:0;width:0;height:0;top:0;left:-9999px;margin-top:1px;position:absolute";i.appendChild(n);e.getComputedStyle&&g.extend(c,{pixelPosition:function(){a();return t},boxSizingReliable:function(){null==o&&a();return o},reliableMarginRight:function(){var t,o=n.appendChild(u.createElement("div"));o.style.cssText=n.style.cssText="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;margin:0;border:0;padding:0";o.style.marginRight=o.style.width="0";n.style.width="1px";r.appendChild(i);t=!parseFloat(e.getComputedStyle(o,null).marginRight);r.removeChild(i);n.removeChild(o);return t}})}function a(){n.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;display:block;margin-top:1%;top:1%;border:1px;padding:1px;width:4px;position:absolute";n.innerHTML="";r.appendChild(i);var a=e.getComputedStyle(n,null);t="1%"!==a.top;o="4px"===a.width;r.removeChild(i)}}();g.swap=function(e,t,o,r){var i,n,a={};for(n in t){a[n]=e.style[n];e.style[n]=t[n]}i=o.apply(e,r||[]);for(n in t)e.style[n]=a[n];return i};var Te=/^(none|table(?!-c[ea]).+)/,Se=new RegExp("^("+U+")(.*)$","i"),_e=new RegExp("^([+-])=("+U+")","i"),Ee={position:"absolute",visibility:"hidden",display:"block"},xe={letterSpacing:"0",fontWeight:"400"},Pe=["Webkit","O","Moz","ms"];function Le(e,t){if(t in e)return t;for(var o=t[0].toUpperCase()+t.slice(1),r=t,i=Pe.length;i--;)if((t=Pe[i]+o)in e)return t;return r}function we(e,t,o){var r=Se.exec(t);return r?Math.max(0,r[1]-(o||0))+(r[2]||"px"):t}function be(e,t,o,r,i){for(var n=o===(r?"border":"content")?4:"width"===t?1:0,a=0;n<4;n+=2){"margin"===o&&(a+=g.css(e,o+B[n],!0,i));if(r){"content"===o&&(a-=g.css(e,"padding"+B[n],!0,i));"margin"!==o&&(a-=g.css(e,"border"+B[n]+"Width",!0,i))}else{a+=g.css(e,"padding"+B[n],!0,i);"padding"!==o&&(a+=g.css(e,"border"+B[n]+"Width",!0,i))}}return a}function Re(e,t,o){var r=!0,i="width"===t?e.offsetWidth:e.offsetHeight,n=me(e),a="border-box"===g.css(e,"boxSizing",!1,n);if(i<=0||null==i){((i=ve(e,t,n))<0||null==i)&&(i=e.style[t]);if(ye.test(i))return i;r=a&&(c.boxSizingReliable()||i===e.style[t]);i=parseFloat(i)||0}return i+be(e,t,o||(a?"border":"content"),r,n)+"px"}function Ae(e,t){for(var o,r,i,n=[],a=0,l=e.length;a<l;a++)if((r=e[a]).style){n[a]=N.get(r,"olddisplay");o=r.style.display;if(t){n[a]||"none"!==o||(r.style.display="");""===r.style.display&&$(r)&&(n[a]=N.access(r,"olddisplay",he(r.nodeName)))}else{i=$(r);"none"===o&&i||N.set(r,"olddisplay",i?o:g.css(r,"display"))}}for(a=0;a<l;a++)(r=e[a]).style&&(t&&"none"!==r.style.display&&""!==r.style.display||(r.style.display=t?n[a]||"":"none"));return e}g.extend({cssHooks:{opacity:{get:function(e,t){if(t){var o=ve(e,"opacity");return""===o?"1":o}}}},cssNumber:{columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{float:"cssFloat"},style:function(e,t,o,r){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var i,n,a,l=g.camelCase(t),s=e.style;t=g.cssProps[l]||(g.cssProps[l]=Le(s,l));a=g.cssHooks[t]||g.cssHooks[l];if(void 0===o)return a&&"get"in a&&void 0!==(i=a.get(e,!1,r))?i:s[t];if("string"===(n=typeof o)&&(i=_e.exec(o))){o=(i[1]+1)*i[2]+parseFloat(g.css(e,t));n="number"}if(null!=o&&o==o){"number"!==n||g.cssNumber[l]||(o+="px");c.clearCloneStyle||""!==o||0!==t.indexOf("background")||(s[t]="inherit");a&&"set"in a&&void 0===(o=a.set(e,o,r))||(s[t]=o)}}},css:function(e,t,o,r){var i,n,a,l=g.camelCase(t);t=g.cssProps[l]||(g.cssProps[l]=Le(e.style,l));(a=g.cssHooks[t]||g.cssHooks[l])&&"get"in a&&(i=a.get(e,!0,o));void 0===i&&(i=ve(e,t,r));"normal"===i&&t in xe&&(i=xe[t]);if(""===o||o){n=parseFloat(i);return!0===o||g.isNumeric(n)?n||0:i}return i}});g.each(["height","width"],function(e,t){g.cssHooks[t]={get:function(e,o,r){if(o)return Te.test(g.css(e,"display"))&&0===e.offsetWidth?g.swap(e,Ee,function(){return Re(e,t,r)}):Re(e,t,r)},set:function(e,o,r){var i=r&&me(e);return we(0,o,r?be(e,t,r,"border-box"===g.css(e,"boxSizing",!1,i),i):0)}}});g.cssHooks.marginRight=Ce(c.reliableMarginRight,function(e,t){if(t)return g.swap(e,{display:"inline-block"},ve,[e,"marginRight"])});g.each({margin:"",padding:"",border:"Width"},function(e,t){g.cssHooks[e+t]={expand:function(o){for(var r=0,i={},n="string"==typeof o?o.split(" "):[o];r<4;r++)i[e+B[r]+t]=n[r]||n[r-2]||n[0];return i}};fe.test(e)||(g.cssHooks[e+t].set=we)});g.fn.extend({css:function(e,t){return I(this,function(e,t,o){var r,i,n={},a=0;if(g.isArray(t)){r=me(e);i=t.length;for(;a<i;a++)n[t[a]]=g.css(e,t[a],!1,r);return n}return void 0!==o?g.style(e,t,o):g.css(e,t)},e,t,arguments.length>1)},show:function(){return Ae(this,!0)},hide:function(){return Ae(this)},toggle:function(e){return"boolean"==typeof e?e?this.show():this.hide():this.each(function(){$(this)?g(this).show():g(this).hide()})}});function Me(e,t,o,r,i){return new Me.prototype.init(e,t,o,r,i)}g.Tween=Me;Me.prototype={constructor:Me,init:function(e,t,o,r,i,n){this.elem=e;this.prop=o;this.easing=i||"swing";this.options=t;this.start=this.now=this.cur();this.end=r;this.unit=n||(g.cssNumber[o]?"":"px")},cur:function(){var e=Me.propHooks[this.prop];return e&&e.get?e.get(this):Me.propHooks._default.get(this)},run:function(e){var t,o=Me.propHooks[this.prop];this.options.duration?this.pos=t=g.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):this.pos=t=e;this.now=(this.end-this.start)*t+this.start;this.options.step&&this.options.step.call(this.elem,this.now,this);o&&o.set?o.set(this):Me.propHooks._default.set(this);return this}};Me.prototype.init.prototype=Me.prototype;Me.propHooks={_default:{get:function(e){var t;return null==e.elem[e.prop]||e.elem.style&&null!=e.elem.style[e.prop]?(t=g.css(e.elem,e.prop,""))&&"auto"!==t?t:0:e.elem[e.prop]},set:function(e){g.fx.step[e.prop]?g.fx.step[e.prop](e):e.elem.style&&(null!=e.elem.style[g.cssProps[e.prop]]||g.cssHooks[e.prop])?g.style(e.elem,e.prop,e.now+e.unit):e.elem[e.prop]=e.now}}};Me.propHooks.scrollTop=Me.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}};g.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2}};g.fx=Me.prototype.init;g.fx.step={};var Ie,Oe,Ne=/^(?:toggle|show|hide)$/,De=new RegExp("^(?:([+-])=|)("+U+")([a-z%]*)$","i"),Fe=/queueHooks$/,ke=[function(e,t,o){var r,i,n,a,l,s,p,c=this,u={},d=e.style,h=e.nodeType&&$(e),f=N.get(e,"fxshow");if(!o.queue){if(null==(l=g._queueHooks(e,"fx")).unqueued){l.unqueued=0;s=l.empty.fire;l.empty.fire=function(){l.unqueued||s()}}l.unqueued++;c.always(function(){c.always(function(){l.unqueued--;g.queue(e,"fx").length||l.empty.fire()})})}if(1===e.nodeType&&("height"in t||"width"in t)){o.overflow=[d.overflow,d.overflowX,d.overflowY];p=g.css(e,"display");"inline"===("none"===p?N.get(e,"olddisplay")||he(e.nodeName):p)&&"none"===g.css(e,"float")&&(d.display="inline-block")}if(o.overflow){d.overflow="hidden";c.always(function(){d.overflow=o.overflow[0];d.overflowX=o.overflow[1];d.overflowY=o.overflow[2]})}for(r in t){i=t[r];if(Ne.exec(i)){delete t[r];n=n||"toggle"===i;if(i===(h?"hide":"show")){if("show"!==i||!f||void 0===f[r])continue;h=!0}u[r]=f&&f[r]||g.style(e,r)}else p=void 0}if(g.isEmptyObject(u))"inline"===("none"===p?he(e.nodeName):p)&&(d.display=p);else{f?"hidden"in f&&(h=f.hidden):f=N.access(e,"fxshow",{});n&&(f.hidden=!h);h?g(e).show():c.done(function(){g(e).hide()});c.done(function(){var t;N.remove(e,"fxshow");for(t in u)g.style(e,t,u[t])});for(r in u){a=$e(h?f[r]:0,r,c);if(!(r in f)){f[r]=a.start;if(h){a.end=a.start;a.start="width"===r||"height"===r?1:0}}}}}],Ge={"*":[function(e,t){var o=this.createTween(e,t),r=o.cur(),i=De.exec(t),n=i&&i[3]||(g.cssNumber[e]?"":"px"),a=(g.cssNumber[e]||"px"!==n&&+r)&&De.exec(g.css(o.elem,e)),l=1,s=20;if(a&&a[3]!==n){n=n||a[3];i=i||[];a=+r||1;do{a/=l=l||".5";g.style(o.elem,e,a+n)}while(l!==(l=o.cur()/r)&&1!==l&&--s)}if(i){a=o.start=+a||+r||0;o.unit=n;o.end=i[1]?a+(i[1]+1)*i[2]:+i[2]}return o}]};function Ue(){setTimeout(function(){Ie=void 0});return Ie=g.now()}function Be(e,t){var o,r=0,i={height:e};t=t?1:0;for(;r<4;r+=2-t)i["margin"+(o=B[r])]=i["padding"+o]=e;t&&(i.opacity=i.width=e);return i}function $e(e,t,o){for(var r,i=(Ge[t]||[]).concat(Ge["*"]),n=0,a=i.length;n<a;n++)if(r=i[n].call(o,t,e))return r}function qe(e,t,o){var r,i,n=0,a=ke.length,l=g.Deferred().always(function(){delete s.elem}),s=function(){if(i)return!1;for(var t=Ie||Ue(),o=Math.max(0,p.startTime+p.duration-t),r=1-(o/p.duration||0),n=0,a=p.tweens.length;n<a;n++)p.tweens[n].run(r);l.notifyWith(e,[p,r,o]);if(r<1&&a)return o;l.resolveWith(e,[p]);return!1},p=l.promise({elem:e,props:g.extend({},t),opts:g.extend(!0,{specialEasing:{}},o),originalProperties:t,originalOptions:o,startTime:Ie||Ue(),duration:o.duration,tweens:[],createTween:function(t,o){var r=g.Tween(e,p.opts,t,o,p.opts.specialEasing[t]||p.opts.easing);p.tweens.push(r);return r},stop:function(t){var o=0,r=t?p.tweens.length:0;if(i)return this;i=!0;for(;o<r;o++)p.tweens[o].run(1);t?l.resolveWith(e,[p,t]):l.rejectWith(e,[p,t]);return this}}),c=p.props;!function(e,t){var o,r,i,n,a;for(o in e){i=t[r=g.camelCase(o)];n=e[o];if(g.isArray(n)){i=n[1];n=e[o]=n[0]}if(o!==r){e[r]=n;delete e[o]}if((a=g.cssHooks[r])&&"expand"in a){n=a.expand(n);delete e[r];for(o in n)if(!(o in e)){e[o]=n[o];t[o]=i}}else t[r]=i}}(c,p.opts.specialEasing);for(;n<a;n++)if(r=ke[n].call(p,e,c,p.opts))return r;g.map(c,$e,p);g.isFunction(p.opts.start)&&p.opts.start.call(e,p);g.fx.timer(g.extend(s,{elem:e,anim:p,queue:p.opts.queue}));return p.progress(p.opts.progress).done(p.opts.done,p.opts.complete).fail(p.opts.fail).always(p.opts.always)}g.Animation=g.extend(qe,{tweener:function(e,t){if(g.isFunction(e)){t=e;e=["*"]}else e=e.split(" ");for(var o,r=0,i=e.length;r<i;r++){o=e[r];Ge[o]=Ge[o]||[];Ge[o].unshift(t)}},prefilter:function(e,t){t?ke.unshift(e):ke.push(e)}});g.speed=function(e,t,o){var r=e&&"object"==typeof e?g.extend({},e):{complete:o||!o&&t||g.isFunction(e)&&e,duration:e,easing:o&&t||t&&!g.isFunction(t)&&t};r.duration=g.fx.off?0:"number"==typeof r.duration?r.duration:r.duration in g.fx.speeds?g.fx.speeds[r.duration]:g.fx.speeds._default;null!=r.queue&&!0!==r.queue||(r.queue="fx");r.old=r.complete;r.complete=function(){g.isFunction(r.old)&&r.old.call(this);r.queue&&g.dequeue(this,r.queue)};return r};g.fn.extend({fadeTo:function(e,t,o,r){return this.filter($).css("opacity",0).show().end().animate({opacity:t},e,o,r)},animate:function(e,t,o,r){var i=g.isEmptyObject(e),n=g.speed(t,o,r),a=function(){var t=qe(this,g.extend({},e),n);(i||N.get(this,"finish"))&&t.stop(!0)};a.finish=a;return i||!1===n.queue?this.each(a):this.queue(n.queue,a)},stop:function(e,t,o){var r=function(e){var t=e.stop;delete e.stop;t(o)};if("string"!=typeof e){o=t;t=e;e=void 0}t&&!1!==e&&this.queue(e||"fx",[]);return this.each(function(){var t=!0,i=null!=e&&e+"queueHooks",n=g.timers,a=N.get(this);if(i)a[i]&&a[i].stop&&r(a[i]);else for(i in a)a[i]&&a[i].stop&&Fe.test(i)&&r(a[i]);for(i=n.length;i--;)if(n[i].elem===this&&(null==e||n[i].queue===e)){n[i].anim.stop(o);t=!1;n.splice(i,1)}!t&&o||g.dequeue(this,e)})},finish:function(e){!1!==e&&(e=e||"fx");return this.each(function(){var t,o=N.get(this),r=o[e+"queue"],i=o[e+"queueHooks"],n=g.timers,a=r?r.length:0;o.finish=!0;g.queue(this,e,[]);i&&i.stop&&i.stop.call(this,!0);for(t=n.length;t--;)if(n[t].elem===this&&n[t].queue===e){n[t].anim.stop(!0);n.splice(t,1)}for(t=0;t<a;t++)r[t]&&r[t].finish&&r[t].finish.call(this);delete o.finish})}});g.each(["toggle","show","hide"],function(e,t){var o=g.fn[t];g.fn[t]=function(e,r,i){return null==e||"boolean"==typeof e?o.apply(this,arguments):this.animate(Be(t,!0),e,r,i)}});g.each({slideDown:Be("show"),slideUp:Be("hide"),slideToggle:Be("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,t){g.fn[e]=function(e,o,r){return this.animate(t,e,o,r)}});g.timers=[];g.fx.tick=function(){var e,t=0,o=g.timers;Ie=g.now();for(;t<o.length;t++)(e=o[t])()||o[t]!==e||o.splice(t--,1);o.length||g.fx.stop();Ie=void 0};g.fx.timer=function(e){g.timers.push(e);e()?g.fx.start():g.timers.pop()};g.fx.interval=13;g.fx.start=function(){Oe||(Oe=setInterval(g.fx.tick,g.fx.interval))};g.fx.stop=function(){clearInterval(Oe);Oe=null};g.fx.speeds={slow:600,fast:200,_default:400};g.fn.delay=function(e,t){e=g.fx&&g.fx.speeds[e]||e;t=t||"fx";return this.queue(t,function(t,o){var r=setTimeout(t,e);o.stop=function(){clearTimeout(r)}})};!function(){var e=u.createElement("input"),t=u.createElement("select"),o=t.appendChild(u.createElement("option"));e.type="checkbox";c.checkOn=""!==e.value;c.optSelected=o.selected;t.disabled=!0;c.optDisabled=!o.disabled;(e=u.createElement("input")).value="t";e.type="radio";c.radioValue="t"===e.value}();var je,We=g.expr.attrHandle;g.fn.extend({attr:function(e,t){return I(this,g.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each(function(){g.removeAttr(this,e)})}});g.extend({attr:function(e,t,o){var r,i,n=e.nodeType;if(e&&3!==n&&8!==n&&2!==n){if(void 0===e.getAttribute)return g.prop(e,t,o);if(1!==n||!g.isXMLDoc(e)){t=t.toLowerCase();r=g.attrHooks[t]||(g.expr.match.bool.test(t)?je:void 0)}if(void 0===o)return r&&"get"in r&&null!==(i=r.get(e,t))?i:null==(i=g.find.attr(e,t))?void 0:i;if(null!==o){if(r&&"set"in r&&void 0!==(i=r.set(e,o,t)))return i;e.setAttribute(t,o+"");return o}g.removeAttr(e,t)}},removeAttr:function(e,t){var o,r,i=0,n=t&&t.match(R);if(n&&1===e.nodeType)for(;o=n[i++];){r=g.propFix[o]||o;g.expr.match.bool.test(o)&&(e[r]=!1);e.removeAttribute(o)}},attrHooks:{type:{set:function(e,t){if(!c.radioValue&&"radio"===t&&g.nodeName(e,"input")){var o=e.value;e.setAttribute("type",t);o&&(e.value=o);return t}}}}});je={set:function(e,t,o){!1===t?g.removeAttr(e,o):e.setAttribute(o,o);return o}};g.each(g.expr.match.bool.source.match(/\w+/g),function(e,t){var o=We[t]||g.find.attr;We[t]=function(e,t,r){var i,n;if(!r){n=We[t];We[t]=i;i=null!=o(e,t,r)?t.toLowerCase():null;We[t]=n}return i}});var Ve=/^(?:input|select|textarea|button)$/i;g.fn.extend({prop:function(e,t){return I(this,g.prop,e,t,arguments.length>1)},removeProp:function(e){return this.each(function(){delete this[g.propFix[e]||e]})}});g.extend({propFix:{for:"htmlFor",class:"className"},prop:function(e,t,o){var r,i,n=e.nodeType;if(e&&3!==n&&8!==n&&2!==n){if(1!==n||!g.isXMLDoc(e)){t=g.propFix[t]||t;i=g.propHooks[t]}return void 0!==o?i&&"set"in i&&void 0!==(r=i.set(e,o,t))?r:e[t]=o:i&&"get"in i&&null!==(r=i.get(e,t))?r:e[t]}},propHooks:{tabIndex:{get:function(e){return e.hasAttribute("tabindex")||Ve.test(e.nodeName)||e.href?e.tabIndex:-1}}}});c.optSelected||(g.propHooks.selected={get:function(e){var t=e.parentNode;t&&t.parentNode&&t.parentNode.selectedIndex;return null}});g.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){g.propFix[this.toLowerCase()]=this});var Ye=/[\t\r\n\f]/g;g.fn.extend({addClass:function(e){var t,o,r,i,n,a,l="string"==typeof e&&e,s=0,p=this.length;if(g.isFunction(e))return this.each(function(t){g(this).addClass(e.call(this,t,this.className))});if(l){t=(e||"").match(R)||[];for(;s<p;s++)if(r=1===(o=this[s]).nodeType&&(o.className?(" "+o.className+" ").replace(Ye," "):" ")){n=0;for(;i=t[n++];)r.indexOf(" "+i+" ")<0&&(r+=i+" ");a=g.trim(r);o.className!==a&&(o.className=a)}}return this},removeClass:function(e){var t,o,r,i,n,a,l=0===arguments.length||"string"==typeof e&&e,s=0,p=this.length;if(g.isFunction(e))return this.each(function(t){g(this).removeClass(e.call(this,t,this.className))});if(l){t=(e||"").match(R)||[];for(;s<p;s++)if(r=1===(o=this[s]).nodeType&&(o.className?(" "+o.className+" ").replace(Ye," "):"")){n=0;for(;i=t[n++];)for(;r.indexOf(" "+i+" ")>=0;)r=r.replace(" "+i+" "," ");a=e?g.trim(r):"";o.className!==a&&(o.className=a)}}return this},toggleClass:function(e,t){var o=typeof e;return"boolean"==typeof t&&"string"===o?t?this.addClass(e):this.removeClass(e):g.isFunction(e)?this.each(function(o){g(this).toggleClass(e.call(this,o,this.className,t),t)}):this.each(function(){if("string"===o)for(var t,r=0,i=g(this),n=e.match(R)||[];t=n[r++];)i.hasClass(t)?i.removeClass(t):i.addClass(t);else if("undefined"===o||"boolean"===o){this.className&&N.set(this,"__className__",this.className);this.className=this.className||!1===e?"":N.get(this,"__className__")||""}})},hasClass:function(e){for(var t=" "+e+" ",o=0,r=this.length;o<r;o++)if(1===this[o].nodeType&&(" "+this[o].className+" ").replace(Ye," ").indexOf(t)>=0)return!0;return!1}});var Ke=/\r/g;g.fn.extend({val:function(e){var t,o,r,i=this[0];if(!arguments.length)return i?(t=g.valHooks[i.type]||g.valHooks[i.nodeName.toLowerCase()])&&"get"in t&&void 0!==(o=t.get(i,"value"))?o:"string"==typeof(o=i.value)?o.replace(Ke,""):null==o?"":o:void 0;r=g.isFunction(e);return this.each(function(o){var i;if(1===this.nodeType){null==(i=r?e.call(this,o,g(this).val()):e)?i="":"number"==typeof i?i+="":g.isArray(i)&&(i=g.map(i,function(e){return null==e?"":e+""}));(t=g.valHooks[this.type]||g.valHooks[this.nodeName.toLowerCase()])&&"set"in t&&void 0!==t.set(this,i,"value")||(this.value=i)}})}});g.extend({valHooks:{option:{get:function(e){var t=g.find.attr(e,"value");return null!=t?t:g.trim(g.text(e))}},select:{get:function(e){for(var t,o,r=e.options,i=e.selectedIndex,n="select-one"===e.type||i<0,a=n?null:[],l=n?i+1:r.length,s=i<0?l:n?i:0;s<l;s++)if(((o=r[s]).selected||s===i)&&(c.optDisabled?!o.disabled:null===o.getAttribute("disabled"))&&(!o.parentNode.disabled||!g.nodeName(o.parentNode,"optgroup"))){t=g(o).val();if(n)return t;a.push(t)}return a},set:function(e,t){for(var o,r,i=e.options,n=g.makeArray(t),a=i.length;a--;)((r=i[a]).selected=g.inArray(r.value,n)>=0)&&(o=!0);o||(e.selectedIndex=-1);return n}}}});g.each(["radio","checkbox"],function(){g.valHooks[this]={set:function(e,t){if(g.isArray(t))return e.checked=g.inArray(g(e).val(),t)>=0}};c.checkOn||(g.valHooks[this].get=function(e){return null===e.getAttribute("value")?"on":e.value})});g.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(e,t){g.fn[t]=function(e,o){return arguments.length>0?this.on(t,null,e,o):this.trigger(t)}});g.fn.extend({hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)},bind:function(e,t,o){return this.on(e,null,t,o)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,o,r){return this.on(t,e,o,r)},undelegate:function(e,t,o){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",o)}});var Xe=g.now(),He=/\?/;g.parseJSON=function(e){return JSON.parse(e+"")};g.parseXML=function(e){var t;if(!e||"string"!=typeof e)return null;try{t=(new DOMParser).parseFromString(e,"text/xml")}catch(e){t=void 0}t&&!t.getElementsByTagName("parsererror").length||g.error("Invalid XML: "+e);return t};var ze=/#.*$/,Ze=/([?&])_=[^&]*/,Je=/^(.*?):[ \t]*([^\r\n]*)$/gm,Qe=/^(?:GET|HEAD)$/,et=/^\/\//,tt=/^([\w.+-]+:)(?:\/\/(?:[^\/?#]*@|)([^\/?#:]*)(?::(\d+)|)|)/,ot={},rt={},it="*/".concat("*"),nt=e.location.href,at=tt.exec(nt.toLowerCase())||[];function lt(e){return function(t,o){if("string"!=typeof t){o=t;t="*"}var r,i=0,n=t.toLowerCase().match(R)||[];if(g.isFunction(o))for(;r=n[i++];)if("+"===r[0]){r=r.slice(1)||"*";(e[r]=e[r]||[]).unshift(o)}else(e[r]=e[r]||[]).push(o)}}function st(e,t,o,r){var i={},n=e===rt;function a(l){var s;i[l]=!0;g.each(e[l]||[],function(e,l){var p=l(t,o,r);if("string"==typeof p&&!n&&!i[p]){t.dataTypes.unshift(p);a(p);return!1}if(n)return!(s=p)});return s}return a(t.dataTypes[0])||!i["*"]&&a("*")}function pt(e,t){var o,r,i=g.ajaxSettings.flatOptions||{};for(o in t)void 0!==t[o]&&((i[o]?e:r||(r={}))[o]=t[o]);r&&g.extend(!0,e,r);return e}g.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:nt,type:"GET",isLocal:/^(?:about|app|app-storage|.+-extension|file|res|widget):$/.test(at[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":it,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":g.parseJSON,"text xml":g.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?pt(pt(e,g.ajaxSettings),t):pt(g.ajaxSettings,e)},ajaxPrefilter:lt(ot),ajaxTransport:lt(rt),ajax:function(e,t){if("object"==typeof e){t=e;e=void 0}t=t||{};var o,r,i,n,a,l,s,p,c=g.ajaxSetup({},t),u=c.context||c,d=c.context&&(u.nodeType||u.jquery)?g(u):g.event,h=g.Deferred(),f=g.Callbacks("once memory"),y=c.statusCode||{},m={},v={},C=0,T="canceled",S={readyState:0,getResponseHeader:function(e){var t;if(2===C){if(!n){n={};for(;t=Je.exec(i);)n[t[1].toLowerCase()]=t[2]}t=n[e.toLowerCase()]}return null==t?null:t},getAllResponseHeaders:function(){return 2===C?i:null},setRequestHeader:function(e,t){var o=e.toLowerCase();if(!C){e=v[o]=v[o]||e;m[e]=t}return this},overrideMimeType:function(e){C||(c.mimeType=e);return this},statusCode:function(e){var t;if(e)if(C<2)for(t in e)y[t]=[y[t],e[t]];else S.always(e[S.status]);return this},abort:function(e){var t=e||T;o&&o.abort(t);_(0,t);return this}};h.promise(S).complete=f.add;S.success=S.done;S.error=S.fail;c.url=((e||c.url||nt)+"").replace(ze,"").replace(et,at[1]+"//");c.type=t.method||t.type||c.method||c.type;c.dataTypes=g.trim(c.dataType||"*").toLowerCase().match(R)||[""];if(null==c.crossDomain){l=tt.exec(c.url.toLowerCase());c.crossDomain=!(!l||l[1]===at[1]&&l[2]===at[2]&&(l[3]||("http:"===l[1]?"80":"443"))===(at[3]||("http:"===at[1]?"80":"443")))}c.data&&c.processData&&"string"!=typeof c.data&&(c.data=g.param(c.data,c.traditional));st(ot,c,t,S);if(2===C)return S;(s=g.event&&c.global)&&0==g.active++&&g.event.trigger("ajaxStart");c.type=c.type.toUpperCase();c.hasContent=!Qe.test(c.type);r=c.url;if(!c.hasContent){if(c.data){r=c.url+=(He.test(r)?"&":"?")+c.data;delete c.data}!1===c.cache&&(c.url=Ze.test(r)?r.replace(Ze,"$1_="+Xe++):r+(He.test(r)?"&":"?")+"_="+Xe++)}if(c.ifModified){g.lastModified[r]&&S.setRequestHeader("If-Modified-Since",g.lastModified[r]);g.etag[r]&&S.setRequestHeader("If-None-Match",g.etag[r])}(c.data&&c.hasContent&&!1!==c.contentType||t.contentType)&&S.setRequestHeader("Content-Type",c.contentType);S.setRequestHeader("Accept",c.dataTypes[0]&&c.accepts[c.dataTypes[0]]?c.accepts[c.dataTypes[0]]+("*"!==c.dataTypes[0]?", "+it+"; q=0.01":""):c.accepts["*"]);for(p in c.headers)S.setRequestHeader(p,c.headers[p]);if(c.beforeSend&&(!1===c.beforeSend.call(u,S,c)||2===C))return S.abort();T="abort";for(p in{success:1,error:1,complete:1})S[p](c[p]);if(o=st(rt,c,t,S)){S.readyState=1;s&&d.trigger("ajaxSend",[S,c]);c.async&&c.timeout>0&&(a=setTimeout(function(){S.abort("timeout")},c.timeout));try{C=1;o.send(m,_)}catch(e){if(!(C<2))throw e;_(-1,e)}}else _(-1,"No Transport");function _(e,t,n,l){var p,m,v,T,_,E=t;if(2!==C){C=2;a&&clearTimeout(a);o=void 0;i=l||"";S.readyState=e>0?4:0;p=e>=200&&e<300||304===e;n&&(T=function(e,t,o){for(var r,i,n,a,l=e.contents,s=e.dataTypes;"*"===s[0];){s.shift();void 0===r&&(r=e.mimeType||t.getResponseHeader("Content-Type"))}if(r)for(i in l)if(l[i]&&l[i].test(r)){s.unshift(i);break}if(s[0]in o)n=s[0];else{for(i in o){if(!s[0]||e.converters[i+" "+s[0]]){n=i;break}a||(a=i)}n=n||a}if(n){n!==s[0]&&s.unshift(n);return o[n]}}(c,S,n));T=function(e,t,o,r){var i,n,a,l,s,p={},c=e.dataTypes.slice();if(c[1])for(a in e.converters)p[a.toLowerCase()]=e.converters[a];n=c.shift();for(;n;){e.responseFields[n]&&(o[e.responseFields[n]]=t);!s&&r&&e.dataFilter&&(t=e.dataFilter(t,e.dataType));s=n;if(n=c.shift())if("*"===n)n=s;else if("*"!==s&&s!==n){if(!(a=p[s+" "+n]||p["* "+n]))for(i in p)if((l=i.split(" "))[1]===n&&(a=p[s+" "+l[0]]||p["* "+l[0]])){if(!0===a)a=p[i];else if(!0!==p[i]){n=l[0];c.unshift(l[1])}break}if(!0!==a)if(a&&e.throws)t=a(t);else try{t=a(t)}catch(e){return{state:"parsererror",error:a?e:"No conversion from "+s+" to "+n}}}}return{state:"success",data:t}}(c,T,S,p);if(p){if(c.ifModified){(_=S.getResponseHeader("Last-Modified"))&&(g.lastModified[r]=_);(_=S.getResponseHeader("etag"))&&(g.etag[r]=_)}if(204===e||"HEAD"===c.type)E="nocontent";else if(304===e)E="notmodified";else{E=T.state;m=T.data;p=!(v=T.error)}}else{v=E;if(e||!E){E="error";e<0&&(e=0)}}S.status=e;S.statusText=(t||E)+"";p?h.resolveWith(u,[m,E,S]):h.rejectWith(u,[S,E,v]);S.statusCode(y);y=void 0;s&&d.trigger(p?"ajaxSuccess":"ajaxError",[S,c,p?m:v]);f.fireWith(u,[S,E]);if(s){d.trigger("ajaxComplete",[S,c]);--g.active||g.event.trigger("ajaxStop")}}}return S},getJSON:function(e,t,o){return g.get(e,t,o,"json")},getScript:function(e,t){return g.get(e,void 0,t,"script")}});g.each(["get","post"],function(e,t){g[t]=function(e,o,r,i){if(g.isFunction(o)){i=i||r;r=o;o=void 0}return g.ajax({url:e,type:t,dataType:i,data:o,success:r})}});g._evalUrl=function(e){return g.ajax({url:e,type:"GET",dataType:"script",async:!1,global:!1,throws:!0})};g.fn.extend({wrapAll:function(e){var t;if(g.isFunction(e))return this.each(function(t){g(this).wrapAll(e.call(this,t))});if(this[0]){t=g(e,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&t.insertBefore(this[0]);t.map(function(){for(var e=this;e.firstElementChild;)e=e.firstElementChild;return e}).append(this)}return this},wrapInner:function(e){return g.isFunction(e)?this.each(function(t){g(this).wrapInner(e.call(this,t))}):this.each(function(){var t=g(this),o=t.contents();o.length?o.wrapAll(e):t.append(e)})},wrap:function(e){var t=g.isFunction(e);return this.each(function(o){g(this).wrapAll(t?e.call(this,o):e)})},unwrap:function(){return this.parent().each(function(){g.nodeName(this,"body")||g(this).replaceWith(this.childNodes)}).end()}});g.expr.filters.hidden=function(e){return e.offsetWidth<=0&&e.offsetHeight<=0};g.expr.filters.visible=function(e){return!g.expr.filters.hidden(e)};var ct=/%20/g,ut=/\[\]$/,gt=/\r?\n/g,dt=/^(?:submit|button|image|reset|file)$/i,ht=/^(?:input|select|textarea|keygen)/i;function ft(e,t,o,r){var i;if(g.isArray(t))g.each(t,function(t,i){o||ut.test(e)?r(e,i):ft(e+"["+("object"==typeof i?t:"")+"]",i,o,r)});else if(o||"object"!==g.type(t))r(e,t);else for(i in t)ft(e+"["+i+"]",t[i],o,r)}g.param=function(e,t){var o,r=[],i=function(e,t){t=g.isFunction(t)?t():null==t?"":t;r[r.length]=encodeURIComponent(e)+"="+encodeURIComponent(t)};void 0===t&&(t=g.ajaxSettings&&g.ajaxSettings.traditional);if(g.isArray(e)||e.jquery&&!g.isPlainObject(e))g.each(e,function(){i(this.name,this.value)});else for(o in e)ft(o,e[o],t,i);return r.join("&").replace(ct,"+")};g.fn.extend({serialize:function(){return g.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=g.prop(this,"elements");return e?g.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!g(this).is(":disabled")&&ht.test(this.nodeName)&&!dt.test(e)&&(this.checked||!q.test(e))}).map(function(e,t){var o=g(this).val();return null==o?null:g.isArray(o)?g.map(o,function(e){return{name:t.name,value:e.replace(gt,"\r\n")}}):{name:t.name,value:o.replace(gt,"\r\n")}}).get()}});g.ajaxSettings.xhr=function(){try{return new XMLHttpRequest}catch(e){}};var yt=0,mt={},vt={0:200,1223:204},Ct=g.ajaxSettings.xhr();e.attachEvent&&e.attachEvent("onunload",function(){for(var e in mt)mt[e]()});c.cors=!!Ct&&"withCredentials"in Ct;c.ajax=Ct=!!Ct;g.ajaxTransport(function(e){var t;if(c.cors||Ct&&!e.crossDomain)return{send:function(o,r){var i,n=e.xhr(),a=++yt;n.open(e.type,e.url,e.async,e.username,e.password);if(e.xhrFields)for(i in e.xhrFields)n[i]=e.xhrFields[i];e.mimeType&&n.overrideMimeType&&n.overrideMimeType(e.mimeType);e.crossDomain||o["X-Requested-With"]||(o["X-Requested-With"]="XMLHttpRequest");for(i in o)n.setRequestHeader(i,o[i]);t=function(e){return function(){if(t){delete mt[a];t=n.onload=n.onerror=null;"abort"===e?n.abort():"error"===e?r(n.status,n.statusText):r(vt[n.status]||n.status,n.statusText,"string"==typeof n.responseText?{text:n.responseText}:void 0,n.getAllResponseHeaders())}}};n.onload=t();n.onerror=t("error");t=mt[a]=t("abort");try{n.send(e.hasContent&&e.data||null)}catch(e){if(t)throw e}},abort:function(){t&&t()}}});g.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(e){g.globalEval(e);return e}}});g.ajaxPrefilter("script",function(e){void 0===e.cache&&(e.cache=!1);e.crossDomain&&(e.type="GET")});g.ajaxTransport("script",function(e){if(e.crossDomain){var t,o;return{send:function(r,i){t=g("<script>").prop({async:!0,charset:e.scriptCharset,src:e.url}).on("load error",o=function(e){t.remove();o=null;e&&i("error"===e.type?404:200,e.type)});u.head.appendChild(t[0])},abort:function(){o&&o()}}}});var Tt=[],St=/(=)\?(?=&|$)|\?\?/;g.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=Tt.pop()||g.expando+"_"+Xe++;this[e]=!0;return e}});g.ajaxPrefilter("json jsonp",function(t,o,r){var i,n,a,l=!1!==t.jsonp&&(St.test(t.url)?"url":"string"==typeof t.data&&!(t.contentType||"").indexOf("application/x-www-form-urlencoded")&&St.test(t.data)&&"data");if(l||"jsonp"===t.dataTypes[0]){i=t.jsonpCallback=g.isFunction(t.jsonpCallback)?t.jsonpCallback():t.jsonpCallback;l?t[l]=t[l].replace(St,"$1"+i):!1!==t.jsonp&&(t.url+=(He.test(t.url)?"&":"?")+t.jsonp+"="+i);t.converters["script json"]=function(){a||g.error(i+" was not called");return a[0]};t.dataTypes[0]="json";n=e[i];e[i]=function(){a=arguments};r.always(function(){e[i]=n;if(t[i]){t.jsonpCallback=o.jsonpCallback;Tt.push(i)}a&&g.isFunction(n)&&n(a[0]);a=n=void 0});return"script"}});g.parseHTML=function(e,t,o){if(!e||"string"!=typeof e)return null;if("boolean"==typeof t){o=t;t=!1}t=t||u;var r=T.exec(e),i=!o&&[];if(r)return[t.createElement(r[1])];r=g.buildFragment([e],t,i);i&&i.length&&g(i).remove();return g.merge([],r.childNodes)};var _t=g.fn.load;g.fn.load=function(e,t,o){if("string"!=typeof e&&_t)return _t.apply(this,arguments);var r,i,n,a=this,l=e.indexOf(" ");if(l>=0){r=g.trim(e.slice(l));e=e.slice(0,l)}if(g.isFunction(t)){o=t;t=void 0}else t&&"object"==typeof t&&(i="POST");a.length>0&&g.ajax({url:e,type:i,dataType:"html",data:t}).done(function(e){n=arguments;a.html(r?g("<div>").append(g.parseHTML(e)).find(r):e)}).complete(o&&function(e,t){a.each(o,n||[e.responseText,t,e])});return this};g.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){g.fn[t]=function(e){return this.on(t,e)}});g.expr.filters.animated=function(e){return g.grep(g.timers,function(t){return e===t.elem}).length};var Et=e.document.documentElement;function xt(e){return g.isWindow(e)?e:9===e.nodeType&&e.defaultView}g.offset={setOffset:function(e,t,o){var r,i,n,a,l,s,p=g.css(e,"position"),c=g(e),u={};"static"===p&&(e.style.position="relative");l=c.offset();n=g.css(e,"top");s=g.css(e,"left");if(("absolute"===p||"fixed"===p)&&(n+s).indexOf("auto")>-1){a=(r=c.position()).top;i=r.left}else{a=parseFloat(n)||0;i=parseFloat(s)||0}g.isFunction(t)&&(t=t.call(e,o,l));null!=t.top&&(u.top=t.top-l.top+a);null!=t.left&&(u.left=t.left-l.left+i);"using"in t?t.using.call(e,u):c.css(u)}};g.fn.extend({offset:function(e){if(arguments.length)return void 0===e?this:this.each(function(t){g.offset.setOffset(this,e,t)});var t,o,r=this[0],i={top:0,left:0},n=r&&r.ownerDocument;if(n){t=n.documentElement;if(!g.contains(t,r))return i;void 0!==r.getBoundingClientRect&&(i=r.getBoundingClientRect());o=xt(n);return{top:i.top+o.pageYOffset-t.clientTop,left:i.left+o.pageXOffset-t.clientLeft}}},position:function(){if(this[0]){var e,t,o=this[0],r={top:0,left:0};if("fixed"===g.css(o,"position"))t=o.getBoundingClientRect();else{e=this.offsetParent();t=this.offset();g.nodeName(e[0],"html")||(r=e.offset());r.top+=g.css(e[0],"borderTopWidth",!0);r.left+=g.css(e[0],"borderLeftWidth",!0)}return{top:t.top-r.top-g.css(o,"marginTop",!0),left:t.left-r.left-g.css(o,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var e=this.offsetParent||Et;e&&!g.nodeName(e,"html")&&"static"===g.css(e,"position");)e=e.offsetParent;return e||Et})}});g.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(t,o){var r="pageYOffset"===o;g.fn[t]=function(i){return I(this,function(t,i,n){var a=xt(t);if(void 0===n)return a?a[o]:t[i];a?a.scrollTo(r?e.pageXOffset:n,r?n:e.pageYOffset):t[i]=n},t,i,arguments.length,null)}});g.each(["top","left"],function(e,t){g.cssHooks[t]=Ce(c.pixelPosition,function(e,o){if(o){o=ve(e,t);return ye.test(o)?g(e).position()[t]+"px":o}})});g.each({Height:"height",Width:"width"},function(e,t){g.each({padding:"inner"+e,content:t,"":"outer"+e},function(o,r){g.fn[r]=function(r,i){var n=arguments.length&&(o||"boolean"!=typeof r),a=o||(!0===r||!0===i?"margin":"border");return I(this,function(t,o,r){var i;if(g.isWindow(t))return t.document.documentElement["client"+e];if(9===t.nodeType){i=t.documentElement;return Math.max(t.body["scroll"+e],i["scroll"+e],t.body["offset"+e],i["offset"+e],i["client"+e])}return void 0===r?g.css(t,o,a):g.style(t,o,r,a)},t,n?r:void 0,n,null)}})});g.fn.size=function(){return this.length};g.fn.andSelf=g.fn.addBack;"function"==typeof define&&define.amd&&define("jquery",[],function(){return g});var Pt=e.jQuery,Lt=e.$;g.noConflict=function(t){e.$===g&&(e.$=Lt);t&&e.jQuery===g&&(e.jQuery=Pt);return g};void 0===t&&(e.jQuery=e.$=g);return g});!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):e(jQuery)}(function(e){if(!e.support.cors&&e.ajaxTransport&&window.XDomainRequest){var t=/^https?:\/\//i,o=/^get|post$/i,r=new RegExp("^"+location.protocol,"i");e.ajaxTransport("* text html xml json",function(i,n,a){if(i.crossDomain&&i.async&&o.test(i.type)&&t.test(i.url)&&r.test(i.url)){var l=null;return{send:function(t,o){var r="",a=(n.dataType||"").toLowerCase();l=new XDomainRequest;/^\d+$/.test(n.timeout)&&(l.timeout=n.timeout);l.ontimeout=function(){o(500,"timeout")};l.onload=function(){var t="Content-Length: "+l.responseText.length+"\r\nContent-Type: "+l.contentType,r={code:200,message:"success"},i={text:l.responseText};try{if("html"===a||/text\/html/i.test(l.contentType))i.html=l.responseText;else if("json"===a||"text"!==a&&/\/json/i.test(l.contentType))try{i.json=e.parseJSON(l.responseText)}catch(e){r.code=500;r.message="parseerror"}else if("xml"===a||"text"!==a&&/\/xml/i.test(l.contentType)){var n=new ActiveXObject("Microsoft.XMLDOM");n.async=!1;try{n.loadXML(l.responseText)}catch(e){n=void 0}if(!n||!n.documentElement||n.getElementsByTagName("parsererror").length){r.code=500;r.message="parseerror";throw"Invalid XML: "+l.responseText}i.xml=n}}catch(e){throw e}finally{o(r.code,r.message,i,t)}};l.onprogress=function(){};l.onerror=function(){o(500,"error",{text:l.responseText})};n.data&&(r="string"===e.type(n.data)?n.data:e.param(n.data));l.open(i.type,i.url);l.send(r)},abort:function(){l&&l.abort()}}}})}});!function(e){"use strict";e();var t=function(t,r,i){var n=[];if(r)if(i.buildHTML)e(i.target).html(i.buildHTML({results:r}));else{for(var a=0;a<r.length;a++){var l=r[a];e.isPlainObject(l)?n[n.length]='<li><a href="'+i.link+encodeURIComponent(l.id)+'">'+l.label+"</a></li>":n[n.length]='<li><a href="'+i.link+encodeURIComponent(l)+'">'+l+"</a></li>"}e(i.target).html(n.join(""))}null!==i.callback&&e.isFunction(i.callback)&&o(i);t.val().length>0?t.trigger("targetUpdated.autocomplete"):t.trigger("targetCleared.autocomplete")},o=function(t){e("li a",e(t.target)).on("click.autocomplete",function(e){e.stopPropagation();e.preventDefault();t.callback(e)})},r=function(e,t){t.html("").closest("fieldset").removeClass("ui-search-active");e.trigger("targetCleared.autocomplete")},i=function(o){var i,n,a,l,s=e(this),p=s.attr("id"),c=s.data("autocomplete");if(c){var u=c.settings,g=c.openXHR;if((i=s.val()).length<u.minLength)r(s,e(u.target));else if(e.isArray(u.source)){n=u.source.sort().filter(function(t){l=u.matchFromStart?new RegExp("^"+i,"i"):new RegExp(i,"i");a=e.isPlainObject(t)?t.label:t;return l.test(a)});t(s,n,u)}else"function"==typeof u.source?u.source(i,function(e){t(s,e,u)}):e.ajax({type:u.method,url:u.source,data:{term:i},beforeSend:function(e){if(u.cancelRequests){if(g[p])g[p].abort();else{u.target.html('<li><a href="#">Searching...</a></li>');u.target.closest("fieldset").addClass("ui-search-active")}g[p]=e}},success:function(e){t(s,e,u)},complete:function(e,t){u.cancelRequests&&(g[p]=null)},dataType:"json"})}},n={init:function(t){var o=this,n={settings:null};n.settings=e.extend({},n.defaults,t);o.data("autocomplete",n);var a=n.settings;return o.off("keyup.autocomplete").on("keyup.autocomplete",i).next(".ui-input-clear").on("click",function(t){r(o,e(a.target))})},update:function(t){var o=this.data("autocomplete");if(o){o.settings=e.extend(o.settings,t);this.data("autocomplete",o)}return this},clear:function(){var t=this.data("autocomplete");t&&r(this,e(t.settings.target));return this},destroy:function(){var t=this.data("autocomplete");if(t){r(this,e(t.settings.target));this.removeData("autocomplete");this.off(".autocomplete")}return this}};e.fn.autocomplete=function(e){return n[e]?n[e].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof e&&e?void 0:n.init.apply(this,arguments)}}(jQuery);!function(e){e.fn.drag=function(t,o,r){var i="string"==typeof t?t:"",n=e.isFunction(t)?t:e.isFunction(o)?o:null;0!==i.indexOf("drag")&&(i="drag"+i);r=(t==n?o:r)||{};return n?this.bind(i,r,n):this.trigger(i)};var t=e.event,o=t.special,r=o.drag={defaults:{which:1,distance:0,not:":input",handle:null,relative:!1,drop:!0,click:!1},datakey:"dragdata",noBubble:!0,add:function(t){var o=e.data(this,r.datakey),i=t.data||{};o.related+=1;e.each(r.defaults,function(e,t){void 0!==i[e]&&(o[e]=i[e])})},remove:function(){e.data(this,r.datakey).related-=1},setup:function(){if(!e.data(this,r.datakey)){var o=e.extend({related:0},r.defaults);e.data(this,r.datakey,o);t.add(this,"touchstart mousedown",r.init,o);this.attachEvent&&this.attachEvent("ondragstart",r.dontstart)}},teardown:function(){if(!(e.data(this,r.datakey)||{}).related){e.removeData(this,r.datakey);t.remove(this,"touchstart mousedown",r.init);r.textselect(!0);this.detachEvent&&this.detachEvent("ondragstart",r.dontstart)}},init:function(i){if(!r.touched){var n,a=i.data;if(!(0!=i.which&&a.which>0&&i.which!=a.which)&&!e(i.target).is(a.not)&&(!a.handle||e(i.target).closest(a.handle,i.currentTarget).length)){r.touched="touchstart"==i.type?this:null;a.propagates=1;a.mousedown=this;a.interactions=[r.interaction(this,a)];a.target=i.target;a.pageX=i.pageX;a.pageY=i.pageY;a.dragging=null;n=r.hijack(i,"draginit",a);if(a.propagates){if((n=r.flatten(n))&&n.length){a.interactions=[];e.each(n,function(){a.interactions.push(r.interaction(this,a))})}a.propagates=a.interactions.length;!1!==a.drop&&o.drop&&o.drop.handler(i,a);r.textselect(!1);r.touched?t.add(r.touched,"touchmove touchend",r.handler,a):t.add(document,"mousemove mouseup",r.handler,a);return!(!r.touched||a.live)&&void 0}}}},interaction:function(t,o){var i=e(t)[o.relative?"position":"offset"]()||{top:0,left:0};return{drag:t,callback:new r.callback,droppable:[],offset:i}},handler:function(i){var n=i.data;switch(i.type){case!n.dragging&&"touchmove":i.preventDefault();case!n.dragging&&"mousemove":if(Math.pow(i.pageX-n.pageX,2)+Math.pow(i.pageY-n.pageY,2)<Math.pow(n.distance,2))break;i.target=n.target;r.hijack(i,"dragstart",n);n.propagates&&(n.dragging=!0);case"touchmove":i.preventDefault();case"mousemove":if(n.dragging){r.hijack(i,"drag",n);if(n.propagates){!1!==n.drop&&o.drop&&o.drop.handler(i,n);break}i.type="mouseup"}case"touchend":case"mouseup":default:r.touched?t.remove(r.touched,"touchmove touchend",r.handler):t.remove(document,"mousemove mouseup",r.handler);if(n.dragging){!1!==n.drop&&o.drop&&o.drop.handler(i,n);r.hijack(i,"dragend",n)}r.textselect(!0);!1===n.click&&n.dragging&&e.data(n.mousedown,"suppress.click",(new Date).getTime()+5);n.dragging=r.touched=!1}},hijack:function(o,i,n,a,l){if(n){var s,p,c,u={event:o.originalEvent,type:o.type},g=i.indexOf("drop")?"drag":"drop",d=a||0,h=isNaN(a)?n.interactions.length:a;o.type=i;o.originalEvent=null;n.results=[];do{if(p=n.interactions[d]){if("dragend"!==i&&p.cancelled)continue;c=r.properties(o,n,p);p.results=[];e(l||p[g]||n.droppable).each(function(a,l){c.target=l;o.isPropagationStopped=function(){return!1};if(!1===(s=l?t.dispatch.call(l,o,c):null)){if("drag"==g){p.cancelled=!0;n.propagates-=1}"drop"==i&&(p[g][a]=null)}else"dropinit"==i&&p.droppable.push(r.element(s)||l);"dragstart"==i&&(p.proxy=e(r.element(s)||p.drag)[0]);p.results.push(s);delete o.result;if("dropinit"!==i)return s});n.results[d]=r.flatten(p.results);"dropinit"==i&&(p.droppable=r.flatten(p.droppable));"dragstart"!=i||p.cancelled||c.update()}}while(++d<h);o.type=u.type;o.originalEvent=u.event;return r.flatten(n.results)}},properties:function(e,t,o){var i=o.callback;i.drag=o.drag;i.proxy=o.proxy||o.drag;i.startX=t.pageX;i.startY=t.pageY;i.deltaX=e.pageX-t.pageX;i.deltaY=e.pageY-t.pageY;i.originalX=o.offset.left;i.originalY=o.offset.top;i.offsetX=i.originalX+i.deltaX;i.offsetY=i.originalY+i.deltaY;i.drop=r.flatten((o.drop||[]).slice());i.available=r.flatten((o.droppable||[]).slice());return i},element:function(e){if(e&&(e.jquery||1==e.nodeType))return e},flatten:function(t){return e.map(t,function(t){return t&&t.jquery?e.makeArray(t):t&&t.length?r.flatten(t):t})},textselect:function(t){e(document)[t?"unbind":"bind"]("selectstart",r.dontstart).css("MozUserSelect",t?"":"none");document.unselectable=t?"off":"on"},dontstart:function(){return!1},callback:function(){}};r.callback.prototype={update:function(){o.drop&&this.available.length&&e.each(this.available,function(e){o.drop.locate(this,e)})}};var i=t.dispatch;t.dispatch=function(t){if(!(e.data(this,"suppress."+t.type)-(new Date).getTime()>0))return i.apply(this,arguments);e.removeData(this,"suppress."+t.type)};var n=t.fixHooks.touchstart=t.fixHooks.touchmove=t.fixHooks.touchend=t.fixHooks.touchcancel={props:"clientX clientY pageX pageY screenX screenY".split(" "),filter:function(t,o){if(o){var r=o.touches&&o.touches[0]||o.changedTouches&&o.changedTouches[0]||null;r&&e.each(n.props,function(e,o){t[o]=r[o]})}return t}};o.draginit=o.dragstart=o.dragend=r}(jQuery);!function(e){e.fn.drop=function(t,o,r){var i="string"==typeof t?t:"",n=e.isFunction(t)?t:e.isFunction(o)?o:null;0!==i.indexOf("drop")&&(i="drop"+i);r=(t==n?o:r)||{};return n?this.bind(i,r,n):this.trigger(i)};e.drop=function(t){t=t||{};o.multi=!0===t.multi?1/0:!1===t.multi?1:isNaN(t.multi)?o.multi:t.multi;o.delay=t.delay||o.delay;o.tolerance=e.isFunction(t.tolerance)?t.tolerance:null===t.tolerance?null:o.tolerance;o.mode=t.mode||o.mode||"intersect"};var t=e.event.special,o=e.event.special.drop={multi:1,delay:20,mode:"overlap",targets:[],datakey:"dropdata",noBubble:!0,add:function(t){e.data(this,o.datakey).related+=1},remove:function(){e.data(this,o.datakey).related-=1},setup:function(){if(!e.data(this,o.datakey)){e.data(this,o.datakey,{related:0,active:[],anyactive:0,winner:0,location:{}});o.targets.push(this)}},teardown:function(){if(!(e.data(this,o.datakey)||{}).related){e.removeData(this,o.datakey);var t=this;o.targets=e.grep(o.targets,function(e){return e!==t})}},handler:function(r,i){var n;if(i)switch(r.type){case"mousedown":case"touchstart":n=e(o.targets);"string"==typeof i.drop&&(n=n.filter(i.drop));n.each(function(){var t=e.data(this,o.datakey);t.active=[];t.anyactive=0;t.winner=0});i.droppable=n;t.drag.hijack(r,"dropinit",i);break;case"mousemove":case"touchmove":o.event=r;o.timer||o.tolerate(i);break;case"mouseup":case"touchend":o.timer=clearTimeout(o.timer);if(i.propagates){t.drag.hijack(r,"drop",i);t.drag.hijack(r,"dropend",i)}}},locate:function(t,r){var i=e.data(t,o.datakey),n=e(t),a=n.offset()||{},l=n.outerHeight(),s=n.outerWidth(),p={elem:t,width:s,height:l,top:a.top,left:a.left,right:a.left+s,bottom:a.top+l};if(i){i.location=p;i.index=r;i.elem=t}return p},contains:function(e,t){return(t[0]||t.left)>=e.left&&(t[0]||t.right)<=e.right&&(t[1]||t.top)>=e.top&&(t[1]||t.bottom)<=e.bottom},modes:{intersect:function(e,t,o){return this.contains(o,[e.pageX,e.pageY])?1e9:this.modes.overlap.apply(this,arguments)},overlap:function(e,t,o){return Math.max(0,Math.min(o.bottom,t.bottom)-Math.max(o.top,t.top))*Math.max(0,Math.min(o.right,t.right)-Math.max(o.left,t.left))},fit:function(e,t,o){return this.contains(o,t)?1:0},middle:function(e,t,o){return this.contains(o,[t.left+.5*t.width,t.top+.5*t.height])?1:0}},sort:function(e,t){return t.winner-e.winner||e.index-t.index},tolerate:function(r){var i,n,a,l,s,p,c,u,g=0,d=r.interactions.length,h=[o.event.pageX,o.event.pageY],f=o.tolerance||o.modes[o.mode];do{if(u=r.interactions[g]){if(!u)return;u.drop=[];s=[];p=u.droppable.length;f&&(a=o.locate(u.proxy));i=0;do{if(c=u.droppable[i]){if(!(n=(l=e.data(c,o.datakey)).location))continue;l.winner=f?f.call(o,o.event,a,n):o.contains(n,h)?1:0;s.push(l)}}while(++i<p);s.sort(o.sort);i=0;do{if(l=s[i])if(l.winner&&u.drop.length<o.multi){if(!l.active[g]&&!l.anyactive)if(!1!==t.drag.hijack(o.event,"dropstart",r,g,l.elem)[0]){l.active[g]=1;l.anyactive+=1}else l.winner=0;l.winner&&u.drop.push(l.elem)}else if(l.active[g]&&1==l.anyactive){t.drag.hijack(o.event,"dropend",r,g,l.elem);l.active[g]=0;l.anyactive-=1}}while(++i<p)}}while(++g<d);o.last&&h[0]==o.last.pageX&&h[1]==o.last.pageY?delete o.timer:o.timer=setTimeout(function(){o.tolerate(r)},o.delay);o.last=o.event}};t.dropinit=t.dropstart=t.dropend=o}(jQuery);!function(e,t){e.fn.track=function(o){var r=e.extend({properties:null,interval:100,id:"_watcher",watchChildren:!1,callback:null},o);return this.each(function(){var o=this,n=e(this),a={id:r.id,props:r.properties.split(","),vals:[r.properties.split(",").length],func:r.callback,fnc:function(n,a){(function(o){var r=e(this),n=r.data(o);if(n&&n.func){for(var a=!1,l=0;l<n.props.length;l++){var s=n.props[l],p="";if((p=s.startsWith("attr_")?r.attr(s.replace("attr_","")):r.css(s))!=t&&n.vals[l]!=p){n.vals[l]=p;a=!0;break}}if(a){r.untrack(o);n.func.call(this,n,l);i(r,o,n)}}}).call(o,r.id)},origProps:r.properties,interval:r.interval,intervalId:null};e.each(a.props,function(e){a.vals[e]=n.css(a.props[e])});n.data(r.id,a);i(n,r.id,a)});function i(t,o,i){t.each(function(){var t=e(this);if(window.MutationObserver){var o=t.data("__watcherObserver");if(null==o){o=new MutationObserver(i.fnc);t.data("__watcherObserver",o)}o.observe(this,{attributes:!0,subtree:r.watchChildren,childList:r.watchChildren,characterData:!0})}else i.intervalId=setInterval(i.fnc,interval)})}};e.fn.untrack=function(t){this.each(function(){var o=e(this),r=o.data(t);try{if(window.MutationObserver){var i=o.data("__watcherObserver");if(i){i.disconnect();o.removeData("__watcherObserver")}}else clearInterval(r.intervalId)}catch(e){}});return this};String.prototype.startsWith=function(e){return 0!=this.length&&e==this.substr(0,e.length)}}(jQuery,void 0);!function(){function e(e){this.mode=l.MODE_8BIT_BYTE,this.data=e,this.parsedData=[];for(var t=[],o=0,r=this.data.length;r>o;o++){var i=this.data.charCodeAt(o);i>65536?(t[0]=240|(1835008&i)>>>18,t[1]=128|(258048&i)>>>12,t[2]=128|(4032&i)>>>6,t[3]=128|63&i):i>2048?(t[0]=224|(61440&i)>>>12,t[1]=128|(4032&i)>>>6,t[2]=128|63&i):i>128?(t[0]=192|(1984&i)>>>6,t[1]=128|63&i):t[0]=i,this.parsedData=this.parsedData.concat(t)}this.parsedData.length!=this.data.length&&(this.parsedData.unshift(191),this.parsedData.unshift(187),this.parsedData.unshift(239))}function t(e,t){this.typeNumber=e,this.errorCorrectLevel=t,this.modules=null,this.moduleCount=0,this.dataCache=null,this.dataList=[]}function o(e,t){if(void 0==e.length)throw new Error(e.length+"/"+t);for(var o=0;o<e.length&&0==e[o];)o++;this.num=new Array(e.length-o+t);for(var r=0;r<e.length-o;r++)this.num[r]=e[r+o]}function r(e,t){this.totalCount=e,this.dataCount=t}function i(){this.buffer=[],this.length=0}function n(){var e=!1,t=navigator.userAgent;return/android/i.test(t)&&(e=!0,aMat=t.toString().match(/android ([0-9]\.[0-9])/i),aMat&&aMat[1]&&(e=parseFloat(aMat[1]))),e}function a(e,t){for(var o=1,r=function(e){var t=encodeURI(e).toString().replace(/\%[0-9a-fA-F]{2}/g,"a");return t.length+(t.length!=e?3:0)}(e),i=0,n=d.length;n>=i;i++){var a=0;switch(t){case s.L:a=d[i][0];break;case s.M:a=d[i][1];break;case s.Q:a=d[i][2];break;case s.H:a=d[i][3]}if(a>=r)break;o++}if(o>d.length)throw new Error("Too long data");return o}e.prototype={getLength:function(){return this.parsedData.length},write:function(e){for(var t=0,o=this.parsedData.length;o>t;t++)e.put(this.parsedData[t],8)}},t.prototype={addData:function(t){var o=new e(t);this.dataList.push(o),this.dataCache=null},isDark:function(e,t){if(0>e||this.moduleCount<=e||0>t||this.moduleCount<=t)throw new Error(e+","+t);return this.modules[e][t]},getModuleCount:function(){return this.moduleCount},make:function(){this.makeImpl(!1,this.getBestMaskPattern())},makeImpl:function(e,o){this.moduleCount=4*this.typeNumber+17,this.modules=new Array(this.moduleCount);for(var r=0;r<this.moduleCount;r++){this.modules[r]=new Array(this.moduleCount);for(var i=0;i<this.moduleCount;i++)this.modules[r][i]=null}this.setupPositionProbePattern(0,0),this.setupPositionProbePattern(this.moduleCount-7,0),this.setupPositionProbePattern(0,this.moduleCount-7),this.setupPositionAdjustPattern(),this.setupTimingPattern(),this.setupTypeInfo(e,o),this.typeNumber>=7&&this.setupTypeNumber(e),null==this.dataCache&&(this.dataCache=t.createData(this.typeNumber,this.errorCorrectLevel,this.dataList)),this.mapData(this.dataCache,o)},setupPositionProbePattern:function(e,t){for(var o=-1;7>=o;o++)if(!(-1>=e+o||this.moduleCount<=e+o))for(var r=-1;7>=r;r++)-1>=t+r||this.moduleCount<=t+r||(this.modules[e+o][t+r]=o>=0&&6>=o&&(0==r||6==r)||r>=0&&6>=r&&(0==o||6==o)||o>=2&&4>=o&&r>=2&&4>=r)},getBestMaskPattern:function(){for(var e=0,t=0,o=0;8>o;o++){this.makeImpl(!0,o);var r=c.getLostPoint(this);(0==o||e>r)&&(e=r,t=o)}return t},createMovieClip:function(e,t,o){var r=e.createEmptyMovieClip(t,o);this.make();for(var i=0;i<this.modules.length;i++)for(var n=1*i,a=0;a<this.modules[i].length;a++){var l=1*a;this.modules[i][a]&&(r.beginFill(0,100),r.moveTo(l,n),r.lineTo(l+1,n),r.lineTo(l+1,n+1),r.lineTo(l,n+1),r.endFill())}return r},setupTimingPattern:function(){for(var e=8;e<this.moduleCount-8;e++)null==this.modules[e][6]&&(this.modules[e][6]=0==e%2);for(var t=8;t<this.moduleCount-8;t++)null==this.modules[6][t]&&(this.modules[6][t]=0==t%2)},setupPositionAdjustPattern:function(){for(var e=c.getPatternPosition(this.typeNumber),t=0;t<e.length;t++)for(var o=0;o<e.length;o++){var r=e[t],i=e[o];if(null==this.modules[r][i])for(var n=-2;2>=n;n++)for(var a=-2;2>=a;a++)this.modules[r+n][i+a]=-2==n||2==n||-2==a||2==a||0==n&&0==a}},setupTypeNumber:function(e){for(var t=c.getBCHTypeNumber(this.typeNumber),o=0;18>o;o++){var r=!e&&1==(1&t>>o);this.modules[Math.floor(o/3)][o%3+this.moduleCount-8-3]=r}for(o=0;18>o;o++){r=!e&&1==(1&t>>o);this.modules[o%3+this.moduleCount-8-3][Math.floor(o/3)]=r}},setupTypeInfo:function(e,t){for(var o=this.errorCorrectLevel<<3|t,r=c.getBCHTypeInfo(o),i=0;15>i;i++){var n=!e&&1==(1&r>>i);6>i?this.modules[i][8]=n:8>i?this.modules[i+1][8]=n:this.modules[this.moduleCount-15+i][8]=n}for(i=0;15>i;i++){n=!e&&1==(1&r>>i);8>i?this.modules[8][this.moduleCount-i-1]=n:9>i?this.modules[8][15-i-1+1]=n:this.modules[8][15-i-1]=n}this.modules[this.moduleCount-8][8]=!e},mapData:function(e,t){for(var o=-1,r=this.moduleCount-1,i=7,n=0,a=this.moduleCount-1;a>0;a-=2)for(6==a&&a--;;){for(var l=0;2>l;l++)if(null==this.modules[r][a-l]){var s=!1;n<e.length&&(s=1==(1&e[n]>>>i));c.getMask(t,r,a-l)&&(s=!s),this.modules[r][a-l]=s,-1==--i&&(n++,i=7)}if(0>(r+=o)||this.moduleCount<=r){r-=o,o=-o;break}}}},t.PAD0=236,t.PAD1=17,t.createData=function(e,o,n){for(var a=r.getRSBlocks(e,o),l=new i,s=0;s<n.length;s++){var p=n[s];l.put(p.mode,4),l.put(p.getLength(),c.getLengthInBits(p.mode,e)),p.write(l)}var u=0;for(s=0;s<a.length;s++)u+=a[s].dataCount;if(l.getLengthInBits()>8*u)throw new Error("code length overflow. ("+l.getLengthInBits()+">"+8*u+")");for(l.getLengthInBits()+4<=8*u&&l.put(0,4);0!=l.getLengthInBits()%8;)l.putBit(!1);for(;!(l.getLengthInBits()>=8*u)&&(l.put(t.PAD0,8),!(l.getLengthInBits()>=8*u));)l.put(t.PAD1,8);return t.createBytes(l,a)},t.createBytes=function(e,t){for(var r=0,i=0,n=0,a=new Array(t.length),l=new Array(t.length),s=0;s<t.length;s++){var p=t[s].dataCount,u=t[s].totalCount-p;i=Math.max(i,p),n=Math.max(n,u),a[s]=new Array(p);for(var g=0;g<a[s].length;g++)a[s][g]=255&e.buffer[g+r];r+=p;var d=c.getErrorCorrectPolynomial(u),h=new o(a[s],d.getLength()-1).mod(d);l[s]=new Array(d.getLength()-1);for(g=0;g<l[s].length;g++){var f=g+h.getLength()-l[s].length;l[s][g]=f>=0?h.get(f):0}}var y=0;for(g=0;g<t.length;g++)y+=t[g].totalCount;var m=new Array(y),v=0;for(g=0;i>g;g++)for(s=0;s<t.length;s++)g<a[s].length&&(m[v++]=a[s][g]);for(g=0;n>g;g++)for(s=0;s<t.length;s++)g<l[s].length&&(m[v++]=l[s][g]);return m};for(var l={MODE_NUMBER:1,MODE_ALPHA_NUM:2,MODE_8BIT_BYTE:4,MODE_KANJI:8},s={L:1,M:0,Q:3,H:2},p={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7},c={PATTERN_POSITION_TABLE:[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],G15:1335,G18:7973,G15_MASK:21522,getBCHTypeInfo:function(e){for(var t=e<<10;c.getBCHDigit(t)-c.getBCHDigit(c.G15)>=0;)t^=c.G15<<c.getBCHDigit(t)-c.getBCHDigit(c.G15);return(e<<10|t)^c.G15_MASK},getBCHTypeNumber:function(e){for(var t=e<<12;c.getBCHDigit(t)-c.getBCHDigit(c.G18)>=0;)t^=c.G18<<c.getBCHDigit(t)-c.getBCHDigit(c.G18);return e<<12|t},getBCHDigit:function(e){for(var t=0;0!=e;)t++,e>>>=1;return t},getPatternPosition:function(e){return c.PATTERN_POSITION_TABLE[e-1]},getMask:function(e,t,o){switch(e){case p.PATTERN000:return 0==(t+o)%2;case p.PATTERN001:return 0==t%2;case p.PATTERN010:return 0==o%3;case p.PATTERN011:return 0==(t+o)%3;case p.PATTERN100:return 0==(Math.floor(t/2)+Math.floor(o/3))%2;case p.PATTERN101:return 0==t*o%2+t*o%3;case p.PATTERN110:return 0==(t*o%2+t*o%3)%2;case p.PATTERN111:return 0==(t*o%3+(t+o)%2)%2;default:throw new Error("bad maskPattern:"+e)}},getErrorCorrectPolynomial:function(e){for(var t=new o([1],0),r=0;e>r;r++)t=t.multiply(new o([1,u.gexp(r)],0));return t},getLengthInBits:function(e,t){if(t>=1&&10>t)switch(e){case l.MODE_NUMBER:return 10;case l.MODE_ALPHA_NUM:return 9;case l.MODE_8BIT_BYTE:case l.MODE_KANJI:return 8;default:throw new Error("mode:"+e)}else if(27>t)switch(e){case l.MODE_NUMBER:return 12;case l.MODE_ALPHA_NUM:return 11;case l.MODE_8BIT_BYTE:return 16;case l.MODE_KANJI:return 10;default:throw new Error("mode:"+e)}else{if(!(41>t))throw new Error("type:"+t);switch(e){case l.MODE_NUMBER:return 14;case l.MODE_ALPHA_NUM:return 13;case l.MODE_8BIT_BYTE:return 16;case l.MODE_KANJI:return 12;default:throw new Error("mode:"+e)}}},getLostPoint:function(e){for(var t=e.getModuleCount(),o=0,r=0;t>r;r++)for(var i=0;t>i;i++){for(var n=0,a=e.isDark(r,i),l=-1;1>=l;l++)if(!(0>r+l||r+l>=t))for(var s=-1;1>=s;s++)0>i+s||i+s>=t||(0!=l||0!=s)&&a==e.isDark(r+l,i+s)&&n++;n>5&&(o+=3+n-5)}for(r=0;t-1>r;r++)for(i=0;t-1>i;i++){var p=0;e.isDark(r,i)&&p++,e.isDark(r+1,i)&&p++,e.isDark(r,i+1)&&p++,e.isDark(r+1,i+1)&&p++,(0==p||4==p)&&(o+=3)}for(r=0;t>r;r++)for(i=0;t-6>i;i++)e.isDark(r,i)&&!e.isDark(r,i+1)&&e.isDark(r,i+2)&&e.isDark(r,i+3)&&e.isDark(r,i+4)&&!e.isDark(r,i+5)&&e.isDark(r,i+6)&&(o+=40);for(i=0;t>i;i++)for(r=0;t-6>r;r++)e.isDark(r,i)&&!e.isDark(r+1,i)&&e.isDark(r+2,i)&&e.isDark(r+3,i)&&e.isDark(r+4,i)&&!e.isDark(r+5,i)&&e.isDark(r+6,i)&&(o+=40);var c=0;for(i=0;t>i;i++)for(r=0;t>r;r++)e.isDark(r,i)&&c++;return o+10*(Math.abs(100*c/t/t-50)/5)}},u={glog:function(e){if(1>e)throw new Error("glog("+e+")");return u.LOG_TABLE[e]},gexp:function(e){for(;0>e;)e+=255;for(;e>=256;)e-=255;return u.EXP_TABLE[e]},EXP_TABLE:new Array(256),LOG_TABLE:new Array(256)},g=0;8>g;g++)u.EXP_TABLE[g]=1<<g;for(g=8;256>g;g++)u.EXP_TABLE[g]=u.EXP_TABLE[g-4]^u.EXP_TABLE[g-5]^u.EXP_TABLE[g-6]^u.EXP_TABLE[g-8];for(g=0;255>g;g++)u.LOG_TABLE[u.EXP_TABLE[g]]=g;o.prototype={get:function(e){return this.num[e]},getLength:function(){return this.num.length},multiply:function(e){for(var t=new Array(this.getLength()+e.getLength()-1),r=0;r<this.getLength();r++)for(var i=0;i<e.getLength();i++)t[r+i]^=u.gexp(u.glog(this.get(r))+u.glog(e.get(i)));return new o(t,0)},mod:function(e){if(this.getLength()-e.getLength()<0)return this;for(var t=u.glog(this.get(0))-u.glog(e.get(0)),r=new Array(this.getLength()),i=0;i<this.getLength();i++)r[i]=this.get(i);for(i=0;i<e.getLength();i++)r[i]^=u.gexp(u.glog(e.get(i))+t);return new o(r,0).mod(e)}},r.RS_BLOCK_TABLE=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]],r.getRSBlocks=function(e,t){var o=r.getRsBlockTable(e,t);if(void 0==o)throw new Error("bad rs block @ typeNumber:"+e+"/errorCorrectLevel:"+t);for(var i=o.length/3,n=[],a=0;i>a;a++)for(var l=o[3*a+0],s=o[3*a+1],p=o[3*a+2],c=0;l>c;c++)n.push(new r(s,p));return n},r.getRsBlockTable=function(e,t){switch(t){case s.L:return r.RS_BLOCK_TABLE[4*(e-1)+0];case s.M:return r.RS_BLOCK_TABLE[4*(e-1)+1];case s.Q:return r.RS_BLOCK_TABLE[4*(e-1)+2];case s.H:return r.RS_BLOCK_TABLE[4*(e-1)+3];default:return}},i.prototype={get:function(e){var t=Math.floor(e/8);return 1==(1&this.buffer[t]>>>7-e%8)},put:function(e,t){for(var o=0;t>o;o++)this.putBit(1==(1&e>>>t-o-1))},getLengthInBits:function(){return this.length},putBit:function(e){var t=Math.floor(this.length/8);this.buffer.length<=t&&this.buffer.push(0),e&&(this.buffer[t]|=128>>>this.length%8),this.length++}};var d=[[17,14,11,7],[32,26,20,14],[53,42,32,24],[78,62,46,34],[106,84,60,44],[134,106,74,58],[154,122,86,64],[192,152,108,84],[230,180,130,98],[271,213,151,119],[321,251,177,137],[367,287,203,155],[425,331,241,177],[458,362,258,194],[520,412,292,220],[586,450,322,250],[644,504,364,280],[718,560,394,310],[792,624,442,338],[858,666,482,382],[929,711,509,403],[1003,779,565,439],[1091,857,611,461],[1171,911,661,511],[1273,997,715,535],[1367,1059,751,593],[1465,1125,805,625],[1528,1190,868,658],[1628,1264,908,698],[1732,1370,982,742],[1840,1452,1030,790],[1952,1538,1112,842],[2068,1628,1168,898],[2188,1722,1228,958],[2303,1809,1283,983],[2431,1911,1351,1051],[2563,1989,1423,1093],[2699,2099,1499,1139],[2809,2213,1579,1219],[2953,2331,1663,1273]],h=function(){var e=function(e,t){this._el=e,this._htOption=t};return e.prototype.draw=function(e){function t(e,t){var o=document.createElementNS("http://www.w3.org/2000/svg",e);for(var r in t)t.hasOwnProperty(r)&&o.setAttribute(r,t[r]);return o}var o=this._htOption,r=this._el,i=e.getModuleCount();Math.floor(o.width/i),Math.floor(o.height/i),this.clear();var n=t("svg",{viewBox:"0 0 "+String(i)+" "+String(i),width:"100%",height:"100%",fill:o.colorLight});n.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink"),r.appendChild(n),n.appendChild(t("rect",{fill:o.colorDark,width:"1",height:"1",id:"template"}));for(var a=0;i>a;a++)for(var l=0;i>l;l++)if(e.isDark(a,l)){var s=t("use",{x:String(a),y:String(l)});s.setAttributeNS("http://www.w3.org/1999/xlink","href","#template"),n.appendChild(s)}},e.prototype.clear=function(){for(;this._el.hasChildNodes();)this._el.removeChild(this._el.lastChild)},e}(),f="svg"===document.documentElement.tagName.toLowerCase()?h:"undefined"!=typeof CanvasRenderingContext2D?function(){function e(){this._elImage.src=this._elCanvas.toDataURL("image/png"),this._elImage.style.display="block",this._elCanvas.style.display="none"}if(this._android&&this._android<=2.1){var t=1/window.devicePixelRatio,o=CanvasRenderingContext2D.prototype.drawImage;CanvasRenderingContext2D.prototype.drawImage=function(e,r,i,n,a,l,s,p){if("nodeName"in e&&/img/i.test(e.nodeName))for(var c=arguments.length-1;c>=1;c--)arguments[c]=arguments[c]*t;else void 0===p&&(arguments[1]*=t,arguments[2]*=t,arguments[3]*=t,arguments[4]*=t);o.apply(this,arguments)}}var r=function(e,t){this._bIsPainted=!1,this._android=n(),this._htOption=t,this._elCanvas=document.createElement("canvas"),this._elCanvas.width=t.width,this._elCanvas.height=t.height,e.appendChild(this._elCanvas),this._el=e,this._oContext=this._elCanvas.getContext("2d"),this._bIsPainted=!1,this._elImage=document.createElement("img"),this._elImage.style.display="none",this._el.appendChild(this._elImage),this._bSupportDataURI=null};return r.prototype.draw=function(e){var t=this._elImage,o=this._oContext,r=this._htOption,i=e.getModuleCount(),n=r.width/i,a=r.height/i,l=Math.round(n),s=Math.round(a);t.style.display="none",this.clear();for(var p=0;i>p;p++)for(var c=0;i>c;c++){var u=e.isDark(p,c),g=c*n,d=p*a;o.strokeStyle=u?r.colorDark:r.colorLight,o.lineWidth=1,o.fillStyle=u?r.colorDark:r.colorLight,o.fillRect(g,d,n,a),o.strokeRect(Math.floor(g)+.5,Math.floor(d)+.5,l,s),o.strokeRect(Math.ceil(g)-.5,Math.ceil(d)-.5,l,s)}this._bIsPainted=!0},r.prototype.makeImage=function(){this._bIsPainted&&function(e,t){var o=this;if(o._fFail=t,o._fSuccess=e,null===o._bSupportDataURI){var r=document.createElement("img"),i=function(){o._bSupportDataURI=!1,o._fFail&&_fFail.call(o)};return r.onabort=i,r.onerror=i,r.onload=function(){o._bSupportDataURI=!0,o._fSuccess&&o._fSuccess.call(o)},void(r.src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAHElEQVQI12P4//8/w38GIAXDIBKE0DHxgljNBAAO9TXL0Y4OHwAAAABJRU5ErkJggg==")}!0===o._bSupportDataURI&&o._fSuccess?o._fSuccess.call(o):!1===o._bSupportDataURI&&o._fFail&&o._fFail.call(o)}.call(this,e)},r.prototype.isPainted=function(){return this._bIsPainted},r.prototype.clear=function(){this._oContext.clearRect(0,0,this._elCanvas.width,this._elCanvas.height),this._bIsPainted=!1},r.prototype.round=function(e){return e?Math.floor(1e3*e)/1e3:e},r}():function(){var e=function(e,t){this._el=e,this._htOption=t};return e.prototype.draw=function(e){for(var t=this._htOption,o=this._el,r=e.getModuleCount(),i=Math.floor(t.width/r),n=Math.floor(t.height/r),a=['<table style="border:0;border-collapse:collapse;">'],l=0;r>l;l++){a.push("<tr>");for(var s=0;r>s;s++)a.push('<td style="border:0;border-collapse:collapse;padding:0;margin:0;width:'+i+"px;height:"+n+"px;background-color:"+(e.isDark(l,s)?t.colorDark:t.colorLight)+';"></td>');a.push("</tr>")}a.push("</table>"),o.innerHTML=a.join("");var p=o.childNodes[0],c=(t.width-p.offsetWidth)/2,u=(t.height-p.offsetHeight)/2;c>0&&u>0&&(p.style.margin=u+"px "+c+"px")},e.prototype.clear=function(){this._el.innerHTML=""},e}();(QRCode=function(e,t){if(this._htOption={width:256,height:256,typeNumber:4,colorDark:"#000000",colorLight:"#ffffff",correctLevel:s.H},"string"==typeof t&&(t={text:t}),t)for(var o in t)this._htOption[o]=t[o];"string"==typeof e&&(e=document.getElementById(e)),this._android=n(),this._el=e,this._oQRCode=null,this._oDrawing=new f(this._el,this._htOption),this._htOption.text&&this.makeCode(this._htOption.text)}).prototype.makeCode=function(e){this._oQRCode=new t(a(e,this._htOption.correctLevel),this._htOption.correctLevel),this._oQRCode.addData(e),this._oQRCode.make(),this._el.title=e,this._oDrawing.draw(this._oQRCode),this.makeImage()},QRCode.prototype.makeImage=function(){"function"==typeof this._oDrawing.makeImage&&(!this._android||this._android>=3)&&this._oDrawing.makeImage()},QRCode.prototype.clear=function(){this._oDrawing.clear()},QRCode.CorrectLevel=s}();(void 0!==define&&define.amd?define:function(e,t){var o,r=t();if(void 0!==exports)for(o in r)exports[o]=r[o];else window.jsonpack=r})([],function(){var e=-4,t=function(e){return"string"!=typeof e?e:e.replace(/[\+ \|\^\%]/g,function(e){return{" ":"+","+":"%2B","|":"%7C","^":"%5E","%":"%25"}[e]})},o=function(e){return"string"!=typeof e?e:e.replace(/\+|%2B|%7C|%5E|%25/g,function(e){return{"+":" ","%2B":"+","%7C":"|","%5E":"^","%25":"%"}[e]})},r=function(e){return Number.prototype.toString.call(e,36).toUpperCase()},i=function(e){return parseInt(e,36)},n=Array.prototype.indexOf||function(e,t){for(var o=t||0,r=this.length;o<r;o++)if(this[o]===e)return o;return-1};return{JSON:JSON,pack:function(o,i){var a,l,s;(a=(i=i||{}).verbose||!1)&&console.log("Normalize the JSON Object");o="string"==typeof o?this.JSON.parse(o):o;a&&console.log("Creating a empty dictionary");l={strings:[],integers:[],floats:[]};a&&console.log("Creating the AST");var p=function o(i){var s,p,c,u,g;if(a&&console.log("Calling recursiveAstBuilder with "+this.JSON.stringify(i)),s=typeof i,null===i)return{type:"null",index:-3};if(void 0===i)return{type:"undefined",index:-5};if(i instanceof Array){c=["@"];for(p in i)i.hasOwnProperty(p)&&c.push(o(i[p]));return c}if("object"===s){c=["$"];for(u in i)i.hasOwnProperty(u)&&(c.push(o(u)),c.push(o(i[u])));return c}if(""===i)return{type:"empty",index:e};if("string"===s)return-1==(g=n.call(l.strings,i))&&(l.strings.push(t(i)),g=l.strings.length-1),{type:"strings",index:g};if("number"===s&&i%1==0)return-1==(g=n.call(l.integers,i))&&(l.integers.push(r(i)),g=l.integers.length-1),{type:"integers",index:g};if("number"===s)return-1==(g=n.call(l.floats,i))&&(l.floats.push(i),g=l.floats.length-1),{type:"floats",index:g};if("boolean"===s)return{type:"boolean",index:i?-1:-2};throw new Error("Unexpected argument of type "+typeof i)}(o),c=l.strings.length,u=l.integers.length;l.floats.length;return a&&console.log("Parsing the dictionary"),s=l.strings.join("|"),s+="^"+l.integers.join("|"),s+="^"+l.floats.join("|"),a&&console.log("Parsing the structure"),s+="^"+function t(o){var i,n,l,s;if(a&&console.log("Calling a recursiveParser with "+this.JSON.stringify(o)),o instanceof Array){i=o.shift();for(n in o)o.hasOwnProperty(n)&&(i+=t(o[n])+"|");return("|"===i[i.length-1]?i.slice(0,-1):i)+"]"}if(l=o.type,s=o.index,"strings"===l)return r(s);if("integers"===l)return r(c+s);if("floats"===l)return r(c+u+s);if("boolean"===l)return o.index;if("null"===l)return-3;if("undefined"===l)return-5;if("empty"===l)return e;throw new TypeError("The item is alien!")}(p),a&&console.log("Ending parser"),i.debug?{dictionary:l,ast:p,packed:s}:s},unpack:function(t,r){var n,a,l,s,p,c,u,g;if(r=r||{},n=t.split("^"),r.verbose&&console.log("Building dictionary"),a=[],""!==(l=n[0]))for(l=l.split("|"),r.verbose&&console.log("Parse the strings dictionary"),p=0,s=l.length;p<s;p++)a.push(o(l[p]));if(""!==(l=n[1]))for(l=l.split("|"),r.verbose&&console.log("Parse the integers dictionary"),p=0,s=l.length;p<s;p++)a.push(i(l[p]));if(""!==(l=n[2]))for(l=l.split("|"),r.verbose&&console.log("Parse the floats dictionary"),p=0,s=l.length;p<s;p++)a.push(parseFloat(l[p]));l=null;r.verbose&&console.log("Tokenizing the structure");var d="",h=[],f=n[3].length;for(p=0;p<f;p++)"|"===(c=n[3].charAt(p))||"$"===c||"@"===c||"]"===c?(d&&(h.push(i(d)),d=""),"|"!==c&&h.push(c)):d+=c;return u=h.length,g=0,r.verbose&&console.log("Starting recursive parser"),function t(){var o,i,n,l=h[g++];if(r.verbose&&console.log("Reading collection type "+("$"===l?"object":"Array")),"@"===l){for(o=[];g<u;g++){if(n=h[g],r.verbose&&console.log("Read "+n+" symbol"),"]"===n)return o;if("@"===n||"$"===n)o.push(t());else switch(n){case-1:o.push(!0);break;case-2:o.push(!1);break;case-3:o.push(null);break;case-5:o.push(void 0);break;case e:o.push("");break;default:o.push(a[n])}}return r.verbose&&console.log("Parsed "+this.JSON.stringify(o)),o}if("$"===l){for(o={};g<u;g++){if("]"===(i=h[g]))return o;if(i=i===e?"":a[i],"@"===(n=h[++g])||"$"===n)o[i]=t();else switch(n){case-1:o[i]=!0;break;case-2:o[i]=!1;break;case-3:o[i]=null;break;case-5:o[i]=void 0;break;case e:o[i]="";break;default:o[i]=a[n]}}return r.verbose&&console.log("Parsed "+this.JSON.stringify(o)),o}throw new TypeError("Bad token "+l+" isn't a type")}()}}});!function(e,t){"use strict";var o="model",r="name",i="type",n="vendor",a="version",l="mobile",s="tablet",p={extend:function(e,t){var o={};for(var r in e)t[r]&&t[r].length%2==0?o[r]=t[r].concat(e[r]):o[r]=e[r];return o},has:function(e,t){return"string"==typeof e&&-1!==t.toLowerCase().indexOf(e.toLowerCase())},lowerize:function(e){return e.toLowerCase()},major:function(e){return"string"==typeof e?e.replace(/[^\d\.]/g,"").split(".")[0]:void 0},trim:function(e){return e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}},c={rgx:function(e,t){for(var o,r,i,n,a,l,s=0;s<t.length&&!a;){var p=t[s],c=t[s+1];o=r=0;for(;o<p.length&&!a;)if(a=p[o++].exec(e))for(i=0;i<c.length;i++){l=a[++r];"object"==typeof(n=c[i])&&n.length>0?2==n.length?"function"==typeof n[1]?this[n[0]]=n[1].call(this,l):this[n[0]]=n[1]:3==n.length?"function"!=typeof n[1]||n[1].exec&&n[1].test?this[n[0]]=l?l.replace(n[1],n[2]):void 0:this[n[0]]=l?n[1].call(this,l,n[2]):void 0:4==n.length&&(this[n[0]]=l?n[3].call(this,l.replace(n[1],n[2])):void 0):this[n]=l||void 0}s+=2}},str:function(e,t){for(var o in t)if("object"==typeof t[o]&&t[o].length>0){for(var r=0;r<t[o].length;r++)if(p.has(t[o][r],e))return"?"===o?void 0:o}else if(p.has(t[o],e))return"?"===o?void 0:o;return e}},u={browser:{oldsafari:{version:{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}}},device:{amazon:{model:{"Fire Phone":["SD","KF"]}},sprint:{model:{"Evo Shift 4G":"7373KT"},vendor:{HTC:"APA",Sprint:"Sprint"}}},os:{windows:{version:{ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2000:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"}}}},g={browser:[[/(opera\smini)\/([\w\.-]+)/i,/(opera\s[mobiletab]+).+version\/([\w\.-]+)/i,/(opera).+version\/([\w\.]+)/i,/(opera)[\/\s]+([\w\.]+)/i],[r,a],[/(opios)[\/\s]+([\w\.]+)/i],[[r,"Opera Mini"],a],[/\s(opr)\/([\w\.]+)/i],[[r,"Opera"],a],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/\s]?([\w\.]+)*/i,/(avant\s|iemobile|slim|baidu)(?:browser)?[\/\s]?([\w\.]*)/i,/(?:ms|\()(ie)\s([\w\.]+)/i,/(rekonq)\/([\w\.]+)*/i,/(chromium|flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser)\/([\w\.-]+)/i],[r,a],[/(trident).+rv[:\s]([\w\.]+).+like\sgecko/i],[[r,"IE"],a],[/(edge)\/((\d+)?[\w\.]+)/i],[r,a],[/(yabrowser)\/([\w\.]+)/i],[[r,"Yandex"],a],[/(puffin)\/([\w\.]+)/i],[[r,"Puffin"],a],[/((?:[\s\/])uc?\s?browser|(?:juc.+)ucweb)[\/\s]?([\w\.]+)/i],[[r,"UCBrowser"],a],[/(comodo_dragon)\/([\w\.]+)/i],[[r,/_/g," "],a],[/(micromessenger)\/([\w\.]+)/i],[[r,"WeChat"],a],[/(QQ)\/([\d\.]+)/i],[r,a],[/m?(qqbrowser)[\/\s]?([\w\.]+)/i],[r,a],[/xiaomi\/miuibrowser\/([\w\.]+)/i],[a,[r,"MIUI Browser"]],[/;fbav\/([\w\.]+);/i],[a,[r,"Facebook"]],[/headlesschrome(?:\/([\w\.]+)|\s)/i],[a,[r,"Chrome Headless"]],[/\swv\).+(chrome)\/([\w\.]+)/i],[[r,/(.+)/,"$1 WebView"],a],[/((?:oculus|samsung)browser)\/([\w\.]+)/i],[[r,/(.+(?:g|us))(.+)/,"$1 $2"],a],[/android.+version\/([\w\.]+)\s+(?:mobile\s?safari|safari)*/i],[a,[r,"Android Browser"]],[/(chrome|omniweb|arora|[tizenoka]{5}\s?browser)\/v?([\w\.]+)/i],[r,a],[/(dolfin)\/([\w\.]+)/i],[[r,"Dolphin"],a],[/((?:android.+)crmo|crios)\/([\w\.]+)/i],[[r,"Chrome"],a],[/(coast)\/([\w\.]+)/i],[[r,"Opera Coast"],a],[/fxios\/([\w\.-]+)/i],[a,[r,"Firefox"]],[/version\/([\w\.]+).+?mobile\/\w+\s(safari)/i],[a,[r,"Mobile Safari"]],[/version\/([\w\.]+).+?(mobile\s?safari|safari)/i],[a,r],[/webkit.+?(gsa)\/([\w\.]+).+?(mobile\s?safari|safari)(\/[\w\.]+)/i],[[r,"GSA"],a],[/webkit.+?(mobile\s?safari|safari)(\/[\w\.]+)/i],[r,[a,c.str,u.browser.oldsafari.version]],[/(konqueror)\/([\w\.]+)/i,/(webkit|khtml)\/([\w\.]+)/i],[r,a],[/(navigator|netscape)\/([\w\.-]+)/i],[[r,"Netscape"],a],[/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo\sbrowser|minimo|conkeror)[\/\s]?([\w\.\+]+)/i,/(firefox|seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([\w\.-]+)$/i,/(mozilla)\/([\w\.]+).+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir)[\/\s]?([\w\.]+)/i,/(links)\s\(([\w\.]+)/i,/(gobrowser)\/?([\w\.]+)*/i,/(ice\s?browser)\/v?([\w\._]+)/i,/(mosaic)[\/\s]([\w\.]+)/i],[r,a]],cpu:[[/(?:(amd|x(?:(?:86|64)[_-])?|wow|win)64)[;\)]/i],[["architecture","amd64"]],[/(ia32(?=;))/i],[["architecture",p.lowerize]],[/((?:i[346]|x)86)[;\)]/i],[["architecture","ia32"]],[/windows\s(ce|mobile);\sppc;/i],[["architecture","arm"]],[/((?:ppc|powerpc)(?:64)?)(?:\smac|;|\))/i],[["architecture",/ower/,"",p.lowerize]],[/(sun4\w)[;\)]/i],[["architecture","sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|arm(?:64|(?=v\d+;))|(?=atmel\s)avr|(?:irix|mips|sparc)(?:64)?(?=;)|pa-risc)/i],[["architecture",p.lowerize]]],device:[[/\((ipad|playbook);[\w\s\);-]+(rim|apple)/i],[o,n,[i,s]],[/applecoremedia\/[\w\.]+ \((ipad)/],[o,[n,"Apple"],[i,s]],[/(apple\s{0,1}tv)/i],[[o,"Apple TV"],[n,"Apple"]],[/(archos)\s(gamepad2?)/i,/(hp).+(touchpad)/i,/(hp).+(tablet)/i,/(kindle)\/([\w\.]+)/i,/\s(nook)[\w\s]+build\/(\w+)/i,/(dell)\s(strea[kpr\s\d]*[\dko])/i],[n,o,[i,s]],[/(kf[A-z]+)\sbuild\/[\w\.]+.*silk\//i],[o,[n,"Amazon"],[i,s]],[/(sd|kf)[0349hijorstuw]+\sbuild\/[\w\.]+.*silk\//i],[[o,c.str,u.device.amazon.model],[n,"Amazon"],[i,l]],[/\((ip[honed|\s\w*]+);.+(apple)/i],[o,n,[i,l]],[/\((ip[honed|\s\w*]+);/i],[o,[n,"Apple"],[i,l]],[/(blackberry)[\s-]?(\w+)/i,/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[\s_-]?([\w-]+)*/i,/(hp)\s([\w\s]+\w)/i,/(asus)-?(\w+)/i],[n,o,[i,l]],[/\(bb10;\s(\w+)/i],[o,[n,"BlackBerry"],[i,l]],[/android.+(transfo[prime\s]{4,10}\s\w+|eeepc|slider\s\w+|nexus 7|padfone)/i],[o,[n,"Asus"],[i,s]],[/(sony)\s(tablet\s[ps])\sbuild\//i,/(sony)?(?:sgp.+)\sbuild\//i],[[n,"Sony"],[o,"Xperia Tablet"],[i,s]],[/android.+\s([c-g]\d{4}|so[-l]\w+)\sbuild\//i],[o,[n,"Sony"],[i,l]],[/\s(ouya)\s/i,/(nintendo)\s([wids3u]+)/i],[n,o,[i,"console"]],[/android.+;\s(shield)\sbuild/i],[o,[n,"Nvidia"],[i,"console"]],[/(playstation\s[34portablevi]+)/i],[o,[n,"Sony"],[i,"console"]],[/(sprint\s(\w+))/i],[[n,c.str,u.device.sprint.vendor],[o,c.str,u.device.sprint.model],[i,l]],[/(lenovo)\s?(S(?:5000|6000)+(?:[-][\w+]))/i],[n,o,[i,s]],[/(htc)[;_\s-]+([\w\s]+(?=\))|\w+)*/i,/(zte)-(\w+)*/i,/(alcatel|geeksphone|lenovo|nexian|panasonic|(?=;\s)sony)[_\s-]?([\w-]+)*/i],[n,[o,/_/g," "],[i,l]],[/(nexus\s9)/i],[o,[n,"HTC"],[i,s]],[/d\/huawei([\w\s-]+)[;\)]/i,/(nexus\s6p)/i],[o,[n,"Huawei"],[i,l]],[/(microsoft);\s(lumia[\s\w]+)/i],[n,o,[i,l]],[/[\s\(;](xbox(?:\sone)?)[\s\);]/i],[o,[n,"Microsoft"],[i,"console"]],[/(kin\.[onetw]{3})/i],[[o,/\./g," "],[n,"Microsoft"],[i,l]],[/\s(milestone|droid(?:[2-4x]|\s(?:bionic|x2|pro|razr))?(:?\s4g)?)[\w\s]+build\//i,/mot[\s-]?(\w+)*/i,/(XT\d{3,4}) build\//i,/(nexus\s6)/i],[o,[n,"Motorola"],[i,l]],[/android.+\s(mz60\d|xoom[\s2]{0,2})\sbuild\//i],[o,[n,"Motorola"],[i,s]],[/hbbtv\/\d+\.\d+\.\d+\s+\([\w\s]*;\s*(\w[^;]*);([^;]*)/i],[[n,p.trim],[o,p.trim],[i,"smarttv"]],[/hbbtv.+maple;(\d+)/i],[[o,/^/,"SmartTV"],[n,"Samsung"],[i,"smarttv"]],[/\(dtv[\);].+(aquos)/i],[o,[n,"Sharp"],[i,"smarttv"]],[/android.+((sch-i[89]0\d|shw-m380s|gt-p\d{4}|gt-n\d+|sgh-t8[56]9|nexus 10))/i,/((SM-T\w+))/i],[[n,"Samsung"],o,[i,s]],[/smart-tv.+(samsung)/i],[n,[i,"smarttv"],o],[/((s[cgp]h-\w+|gt-\w+|galaxy\snexus|sm-\w[\w\d]+))/i,/(sam[sung]*)[\s-]*(\w+-?[\w-]*)*/i,/sec-((sgh\w+))/i],[[n,"Samsung"],o,[i,l]],[/sie-(\w+)*/i],[o,[n,"Siemens"],[i,l]],[/(maemo|nokia).*(n900|lumia\s\d+)/i,/(nokia)[\s_-]?([\w-]+)*/i],[[n,"Nokia"],o,[i,l]],[/android\s3\.[\s\w;-]{10}(a\d{3})/i],[o,[n,"Acer"],[i,s]],[/android.+([vl]k\-?\d{3})\s+build/i],[o,[n,"LG"],[i,s]],[/android\s3\.[\s\w;-]{10}(lg?)-([06cv9]{3,4})/i],[[n,"LG"],o,[i,s]],[/(lg) netcast\.tv/i],[n,o,[i,"smarttv"]],[/(nexus\s[45])/i,/lg[e;\s\/-]+(\w+)*/i,/android.+lg(\-?[\d\w]+)\s+build/i],[o,[n,"LG"],[i,l]],[/android.+(ideatab[a-z0-9\-\s]+)/i],[o,[n,"Lenovo"],[i,s]],[/linux;.+((jolla));/i],[n,o,[i,l]],[/((pebble))app\/[\d\.]+\s/i],[n,o,[i,"wearable"]],[/android.+;\s(oppo)\s?([\w\s]+)\sbuild/i],[n,o,[i,l]],[/crkey/i],[[o,"Chromecast"],[n,"Google"]],[/android.+;\s(glass)\s\d/i],[o,[n,"Google"],[i,"wearable"]],[/android.+;\s(pixel c)\s/i],[o,[n,"Google"],[i,s]],[/android.+;\s(pixel xl|pixel)\s/i],[o,[n,"Google"],[i,l]],[/android.+(\w+)\s+build\/hm\1/i,/android.+(hm[\s\-_]*note?[\s_]*(?:\d\w)?)\s+build/i,/android.+(mi[\s\-_]*(?:one|one[\s_]plus|note lte)?[\s_]*(?:\d\w)?)\s+build/i,/android.+(redmi[\s\-_]*(?:note)?(?:[\s_]*[\w\s]+)?)\s+build/i],[[o,/_/g," "],[n,"Xiaomi"],[i,l]],[/android.+(mi[\s\-_]*(?:pad)?(?:[\s_]*[\w\s]+)?)\s+build/i],[[o,/_/g," "],[n,"Xiaomi"],[i,s]],[/android.+;\s(m[1-5]\snote)\sbuild/i],[o,[n,"Meizu"],[i,s]],[/android.+a000(1)\s+build/i],[o,[n,"OnePlus"],[i,l]],[/android.+[;\/]\s*(RCT[\d\w]+)\s+build/i],[o,[n,"RCA"],[i,s]],[/android.+[;\/]\s*(Venue[\d\s]*)\s+build/i],[o,[n,"Dell"],[i,s]],[/android.+[;\/]\s*(Q[T|M][\d\w]+)\s+build/i],[o,[n,"Verizon"],[i,s]],[/android.+[;\/]\s+(Barnes[&\s]+Noble\s+|BN[RT])(V?.*)\s+build/i],[[n,"Barnes & Noble"],o,[i,s]],[/android.+[;\/]\s+(TM\d{3}.*\b)\s+build/i],[o,[n,"NuVision"],[i,s]],[/android.+[;\/]\s*(zte)?.+(k\d{2})\s+build/i],[[n,"ZTE"],o,[i,s]],[/android.+[;\/]\s*(gen\d{3})\s+build.*49h/i],[o,[n,"Swiss"],[i,l]],[/android.+[;\/]\s*(zur\d{3})\s+build/i],[o,[n,"Swiss"],[i,s]],[/android.+[;\/]\s*((Zeki)?TB.*\b)\s+build/i],[o,[n,"Zeki"],[i,s]],[/(android).+[;\/]\s+([YR]\d{2}x?.*)\s+build/i,/android.+[;\/]\s+(Dragon[\-\s]+Touch\s+|DT)(.+)\s+build/i],[[n,"Dragon Touch"],o,[i,s]],[/android.+[;\/]\s*(NS-?.+)\s+build/i],[o,[n,"Insignia"],[i,s]],[/android.+[;\/]\s*((NX|Next)-?.+)\s+build/i],[o,[n,"NextBook"],[i,s]],[/android.+[;\/]\s*(Xtreme\_?)?(V(1[045]|2[015]|30|40|60|7[05]|90))\s+build/i],[[n,"Voice"],o,[i,l]],[/android.+[;\/]\s*(LVTEL\-?)?(V1[12])\s+build/i],[[n,"LvTel"],o,[i,l]],[/android.+[;\/]\s*(V(100MD|700NA|7011|917G).*\b)\s+build/i],[o,[n,"Envizen"],[i,s]],[/android.+[;\/]\s*(Le[\s\-]+Pan)[\s\-]+(.*\b)\s+build/i],[n,o,[i,s]],[/android.+[;\/]\s*(Trio[\s\-]*.*)\s+build/i],[o,[n,"MachSpeed"],[i,s]],[/android.+[;\/]\s*(Trinity)[\-\s]*(T\d{3})\s+build/i],[n,o,[i,s]],[/android.+[;\/]\s*TU_(1491)\s+build/i],[o,[n,"Rotor"],[i,s]],[/android.+(KS(.+))\s+build/i],[o,[n,"Amazon"],[i,s]],[/android.+(Gigaset)[\s\-]+(Q.+)\s+build/i],[n,o,[i,s]],[/\s(tablet|tab)[;\/]/i,/\s(mobile)(?:[;\/]|\ssafari)/i],[[i,p.lowerize],n,o],[/(android.+)[;\/].+build/i],[o,[n,"Generic"]]],engine:[[/windows.+\sedge\/([\w\.]+)/i],[a,[r,"EdgeHTML"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m)\/([\w\.]+)/i,/(khtml|tasman|links)[\/\s]\(?([\w\.]+)/i,/(icab)[\/\s]([23]\.[\d\.]+)/i],[r,a],[/rv\:([\w\.]+).*(gecko)/i],[a,r]],os:[[/microsoft\s(windows)\s(vista|xp)/i],[r,a],[/(windows)\snt\s6\.2;\s(arm)/i,/(windows\sphone(?:\sos)*)[\s\/]?([\d\.\s]+\w)*/i,/(windows\smobile|windows)[\s\/]?([ntce\d\.\s]+\w)/i],[r,[a,c.str,u.os.windows.version]],[/(win(?=3|9|n)|win\s9x\s)([nt\d\.]+)/i],[[r,"Windows"],[a,c.str,u.os.windows.version]],[/\((bb)(10);/i],[[r,"BlackBerry"],a],[/(blackberry)\w*\/?([\w\.]+)*/i,/(tizen)[\/\s]([\w\.]+)/i,/(android|webos|palm\sos|qnx|bada|rim\stablet\sos|meego|contiki)[\/\s-]?([\w\.]+)*/i,/linux;.+(sailfish);/i],[r,a],[/(symbian\s?os|symbos|s60(?=;))[\/\s-]?([\w\.]+)*/i],[[r,"Symbian"],a],[/\((series40);/i],[r],[/mozilla.+\(mobile;.+gecko.+firefox/i],[[r,"Firefox OS"],a],[/(nintendo|playstation)\s([wids34portablevu]+)/i,/(mint)[\/\s\(]?(\w+)*/i,/(mageia|vectorlinux)[;\s]/i,/(joli|[kxln]?ubuntu|debian|[open]*suse|gentoo|(?=\s)arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk|linpus)[\/\s-]?(?!chrom)([\w\.-]+)*/i,/(hurd|linux)\s?([\w\.]+)*/i,/(gnu)\s?([\w\.]+)*/i],[r,a],[/(cros)\s[\w]+\s([\w\.]+\w)/i],[[r,"Chromium OS"],a],[/(sunos)\s?([\w\.]+\d)*/i],[[r,"Solaris"],a],[/\s([frentopc-]{0,4}bsd|dragonfly)\s?([\w\.]+)*/i],[r,a],[/(haiku)\s(\w+)/i],[r,a],[/cfnetwork\/.+darwin/i,/ip[honead]+(?:.*os\s([\w]+)\slike\smac|;\sopera)/i],[[a,/_/g,"."],[r,"iOS"]],[/(mac\sos\sx)\s?([\w\s\.]+\w)*/i,/(macintosh|mac(?=_powerpc)\s)/i],[[r,"Mac OS"],[a,/_/g,"."]],[/((?:open)?solaris)[\/\s-]?([\w\.]+)*/i,/(aix)\s((\d)(?=\.|\)|\s)[\w\.]*)*/i,/(plan\s9|minix|beos|os\/2|amigaos|morphos|risc\sos|openvms)/i,/(unix)\s?([\w\.]+)*/i],[r,a]]},d=function(t,o){if("object"==typeof t){o=t;t=void 0}if(!(this instanceof d))return new d(t,o).getResult();var r=t||(e&&e.navigator&&e.navigator.userAgent?e.navigator.userAgent:""),i=o?p.extend(g,o):g;this.getBrowser=function(){var e={name:void 0,version:void 0};c.rgx.call(e,r,i.browser);e.major=p.major(e.version);return e};this.getCPU=function(){var e={architecture:void 0};c.rgx.call(e,r,i.cpu);return e};this.getDevice=function(){var e={vendor:void 0,model:void 0,type:void 0};c.rgx.call(e,r,i.device);return e};this.getEngine=function(){var e={name:void 0,version:void 0};c.rgx.call(e,r,i.engine);return e};this.getOS=function(){var e={name:void 0,version:void 0};c.rgx.call(e,r,i.os);return e};this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}};this.getUA=function(){return r};this.setUA=function(e){r=e;return this};return this};d.VERSION="0.7.17";d.BROWSER={NAME:r,MAJOR:"major",VERSION:a};d.CPU={ARCHITECTURE:"architecture"};d.DEVICE={MODEL:o,VENDOR:n,TYPE:i,CONSOLE:"console",MOBILE:l,SMARTTV:"smarttv",TABLET:s,WEARABLE:"wearable",EMBEDDED:"embedded"};d.ENGINE={NAME:r,VERSION:a};d.OS={NAME:r,VERSION:a};if(void 0!==exports){"undefined"!=typeof module&&module.exports&&(exports=module.exports=d);exports.UAParser=d}else"function"==typeof define&&define.amd?define(function(){return d}):e&&(e.UAParser=d);var h=e&&(e.jQuery||e.Zepto);if(void 0!==h){var f=new d;h.ua=f.getResult();h.ua.get=function(){return f.getUA()};h.ua.set=function(e){f.setUA(e);var t=f.getResult();for(var o in t)h.ua[o]=t[o]}}}("object"==typeof window?window:this);var TC=TC||{};!function(){const e=function(e){return function(t,o,r,i){return o.id===e?r:t}},t={layers:[],contains:function(e){return this.layers.some(function(t){return t.id===e})},getIndex:function(t){return this.layers.reduce(e(t),-1)},add:function(e,o,r,i){var n;const a={id:e,deferred:o,isRaster:r,isBase:i};if(r){n=t.getRasterIndex();this.layers.splice(n,0,a)}else{n=this.layers.length;this.layers[n]=a}},remove:function(e){this.layers.splice(this.getIndex(e),1)},getMapLayers:function(){return this.layers.filter(function(e){return"resolved"===e.deferred.state()}).map(function(e){return e.mapLayer})},resolve:function(e,t,o){this.layers[this.getIndex(t.id)].mapLayer=t;e.layers=this.getMapLayers();o?e.baseLayers=e.layers.filter(function(e){return e.isBase}):e.workLayers=e.layers.filter(function(e){return!e.isBase})},getResolvedWorkLayerIndex:function(t,o){return this.layers.filter(function(e){return e.id===o||!e.isBase&&"pending"!==e.deferred.state()}).reduce(e(o),-1)},getResolvedVisibleLayerIndex:function(e,t){var o=this.getResolvedWorkLayerIndex(e,t);e.baseLayer&&(o+=1);return o},getRasterIndex:function(){return this.layers.reduce((e="isRaster",function(t,o,r){return o[e]?r:t}),-1)+1;var e},checkMapLoad:function(e){const t=this;if(e.options.baseLayers.concat(e.options.workLayers).every(function(e){return t.contains(e.id||e)})&&!this.layers.some(function(e){return"pending"===e.deferred.state()})){const o=function(){if(!e.isLoaded){e.isLoaded=!0;e.$events.trigger($.Event(TC.Consts.event.MAPLOAD));e._$div.removeClass(TC.Consts.classes.LOADING);delete t.state}};if(e.baseLayer)o();else{const t=TC.Cfg.availableBaseLayers.filter(function(t){return t.id===e.state.base});if(t.length>0){t[0].isBase=!0;e.addLayer(t[0]).then(function(t){e.wrap.setBaseLayer(t.wrap.getLayer());e.baseLayer=t;o()})}else{const t=e.baseLayers.filter(function(e){return!e.mustReproject})[0];e.wrap.setBaseLayer(t.wrap.getLayer());e.baseLayer=t;o()}}}}},o=function(e){return(this instanceof TC.Map?this.options.availableBaseLayers:TC.Cfg.availableBaseLayers).filter(function(t){return t.id===e})[0]};TC.Map=TC.Map||function(e,t){var i=this;i.$events=$(i);i.isReady=!1;i.isLoaded=!1;i.controls=[];i.activeControl=null;i.layers=[];i.baseLayers=[];i.workLayers=[];i.baseLayer=null;i.vectors=null;var l=0;i.div=TC.Util.getDiv(e);i._$div=$(i.div);i._$div.addClass(TC.Consts.classes.LOADING);i._$div.data("map",i);i._$div.addClass(TC.Consts.classes.MAP);i._markerDeferreds=[];if(!TC.ready){TC.Cfg=$.extend({},TC.Defaults,TC.Cfg);TC.ready=!0}if(t&&t.controls&&t.controls.search&&t.controls.search.allowedSearchTypes)for(var s in TC.Cfg.controls.search.allowedSearchTypes)t.controls.search.allowedSearchTypes.hasOwnProperty(s)||(t.controls.search.allowedSearchTypes[s]=!1);t=t||{};n.call(i,t);var p=function(){TC.loadJS(i.options.stateful&&!window.jsonpack,[TC.apiLocation+TC.Consts.url.JSONPACK],function(){if(i.options.stateful){c();i.state=i.checkLocation()}i.options.layout&&i.$events.trigger($.Event(TC.Consts.event.LAYOUTLOAD,{map:i}));t&&void 0!==t.workLayers&&(i.options.workLayers=t.workLayers);t&&void 0!==t.baseLayers&&(i.options.baseLayers=t.baseLayers);if(i.options.zoomToFeatures){i.on(TC.Consts.event.FEATURESADD,function e(t){clearTimeout(i._zoomToFeaturesTimeout);i._zoomToFeaturesTimeout=setTimeout(function(){i.zoomToFeatures(t.layer.features,{animate:!1});i.off(TC.Consts.event.FEATURESADD,e)},100)})}else{i.on(TC.Consts.event.LAYERADD,function e(t){if(t.layer.isBase&&t.layer===i.baseLayer){void 0!==i.state&&(i.state.crs?i.loaded(function(){i.setProjection({crs:i.state.crs,extent:i.state.ext})}):i.setExtent(i.state.ext,{animate:!1}));i.off(TC.Consts.event.LAYERADD,e)}})}if(i.state&&i.state.vw3){var e=i.state.vw3;i.loaded(function(){i.getControlsByClass(TC.control.ThreeD)[0].setMapState(e)})}i.crs=i.options.crs;i.initialExtent=i.options.initialExtent;i.maxExtent=i.options.maxExtent;i.wrap=new TC.wrap.Map(i);TC.loadJS(!(TC.isLegacy?window[TC.Consts.PROJ4JSOBJ_LEGACY]:window[TC.Consts.PROJ4JSOBJ]),[TC.url.proj4js],function(){TC.loadJSInOrder(!(TC.isLegacy?window[TC.Consts.OLNS_LEGACY]:window[TC.Consts.OLNS]),[TC.url.ol,TC.url.olConnector],function(){TC.loadProjDef({crs:i.options.crs,callback:function(){i.wrap.setMap();for(var e in i.options.controls){const t=i.options.controls[e];t&&i.addControl(e,"boolean"==typeof t?{}:t)}i.on(TC.Consts.event.BEFORELAYERUPDATE,m);i.on(TC.Consts.event.LAYERUPDATE,v);var t,r;for(t=0;t<i.options.baseLayers.length;t++){"string"==typeof(r=i.options.baseLayers[t])&&(r=o.call(i,r));i.addLayer($.extend({},r,{isBase:!0,map:i}))}var n=function(e){e.isRaster()&&!e.names&&e.setVisibility(!1)};i.options.workLayers.map(function(e){return $.extend({},e,{map:i})}).filter(function(e){return!i.state||!i.state.layers||!i.state.layers.some(function(t){const o=t.u===e.url&&e.layerNames.indexOf(t.n)>=0;o&&(t.id=e.id);return o})}).forEach(function(e){i.addLayer(e).then(n)});i.state&&i.state.layers&&i.state.layers.forEach(function(e){var t=e.o,o=e.v;i.addLayer({id:e.id||TC.getUID(),url:TC.Util.isOnCapabilities(e.u,e.u.indexOf(window.location.protocol)<0)||e.u,hideTitle:e.h,layerNames:e.n?e.n.split(","):"",renderOptions:{opacity:e.o,hide:!e.v}}).then(function(e){e.wrap.$events.on(TC.Consts.event.TILELOADERROR,function(e){var t=this.parent;401!==e.error.code&&403!==e.error.code||t.map.toast(e.error.text,{type:TC.Consts.msgType.ERROR});t.map.removeLayer(t)});var r=e.wrap.getRootLayerNode();e.title=r.Title||r.title;e.setOpacity(t);e.setVisibility(o)})});i.isReady=!0;i.$events.trigger($.Event(TC.Consts.event.MAPREADY));g(i._$div)}})})});i.on(TC.Consts.event.FEATURECLICK,function(e){i.activeControl&&i.activeControl.isExclusive()||e.feature.showPopup()});i.on(TC.Consts.event.NOFEATURECLICK,function(e){e.layer._noFeatureClicked=!0;for(var t=!0,o=0,r=i.workLayers.length;o<r;o++)if(!i.workLayers[o]._noFeatureClicked){t=!1;break}if(t){i.workLayers.forEach(function(e){delete e._noFeatureClicked});i.getControlsByClass(TC.control.Popup).forEach(function(e){e.hide()})}})})},c=function(){var e=[TC.Consts.event.LAYERADD,TC.Consts.event.LAYERORDER,TC.Consts.event.LAYERREMOVE,TC.Consts.event.LAYERVISIBILITY,TC.Consts.event.ZOOM,TC.Consts.event.BASELAYERCHANGE].join(" ");i.on(TC.Consts.event.MAPLOAD,function(){i.loaded(function(){i.replaceCurrent=!0;h();i.on(e,$.proxy(h,i));var t;i.on(TC.Consts.event.LAYEROPACITY,function(e){clearTimeout(t);t=setTimeout(function(){h(e)},500)});window.addEventListener("popstate",function(t){var o;o=i.loadingCtrl&&i.loadingCtrl.addWait();setTimeout(function(){if(t&&null!=t.state){i.off(e,$.proxy(h,i));$.when(y(t.state)).then(function(){setTimeout(function(){i.on(e,$.proxy(h,i))},200);i.loadingCtrl&&i.loadingCtrl.removeWait(o)})}},4)})})})},u=null,d=null,h=function(e){var t=f();if(i.replaceCurrent){window.history.replaceState(t,null,null);delete i.replaceCurrent}else{i.lastEventType=e.type;var o=function(){d=u;(u=TC.Util.utf8ToBase64(t))!==d&&window.history.pushState(t,null,window.location.href.split("#").shift()+"#"+u)};if(e)switch(!0){case e.type==TC.Consts.event.BASELAYERCHANGE.replace(".tc",""):case e.type==TC.Consts.event.LAYERORDER.replace(".tc",""):case e.type==TC.Consts.event.ZOOM.replace(".tc",""):o();break;case e.type.toLowerCase().indexOf("LAYER".toLowerCase())>-1:e.layer.type==TC.Consts.layerType.WMS&&o()}}},f=function(e){var t={};i.crs!==i.options.crs&&(t.crs=i.crs);for(var o,r,n=i.getExtent(),a=0;a<n.length;a++)Math.abs(n[a])>180&&(n[a]=Math.floor(1e3*n[a])/1e3);t.ext=n;t.base=i.getBaseLayer().id;t.layers=[];for(a=0;a<i.workLayers.length;a++)if("WMS"==(o=i.workLayers[a]).type&&!o.options.stateless&&o.layerNames&&o.layerNames.length){r={u:TC.Util.isOnCapabilities(o.url),n:$.isArray(o.names)?o.names.join(","):o.names,o:o.getOpacity(),v:o.getVisibility(),h:o.options.hideTitle};t.layers.push(r)}var l=i.getControlsByClass(TC.control.ThreeD);if(l.length>0&&l[0].mapIs3D&&l[0].map3D.cameraControls){t.vw3=l[0].map3D.cameraControls.getCameraState();t.crs=l[0].map3D.crs;t.ext&&4==t.ext.length&&(t.ext=TC.Util.reproject(t.ext.slice().splice(0,2),i.crs,t.crs).concat(TC.Util.reproject(t.ext.slice().splice(2,2),i.crs,t.crs)))}window.jsonpack||TC.syncLoadJS(TC.apiLocation+TC.Consts.url.JSONPACK);e&&$.extend(t,e);return jsonpack.pack(t)},y=function(e){var t=new $.Deferred,o=[];i.loadingctrl||(i.loadingCtrl=i.getControlsByClass("TC.control.LoadingIndicator")[0]);i.hasWait||(i.hasWait=i.loadingCtrl&&i.loadingCtrl.addWait());var r;if("string"==typeof e)try{r=jsonpack.unpack(e)}catch(t){try{r=JSON.parse(e)}catch(e){TC.error(TC.Util.getLocaleString(i.options.locale,"mapStateNotValid"))}}else r=e;if(r){if(r.crs&&r.crs!==i.crs||void 0===r.crs&&i.crs!==i.options.crs)o.push(i.setProjection({crs:r.crs||i.options.crs,oldCrs:i.crs,extent:r.ext,baseLayer:i.getLayer(r.base)}));else{if(r.base!=i.getBaseLayer().id){i.getLayer(r.base)&&i.setBaseLayer(r.base);const e=i.baseLayers.filter(function(e){return e.options.fallbackLayer===r.base})[0];if(e){const t=i.addLayer(e.getFallbackLayer());o.push(t);t.then(function(e){i.setBaseLayer(e)})}}r.ext&&o.push(i.setExtent(r.ext,{animate:!1}))}!function(){var e=[];i.workLayers.forEach(function(t){t instanceof TC.layer.Vector||e.push(t)});for(var t=0;t<e.length;t++)i.removeLayer(e[t])}();r.layers=r.layers||r.capas||[];if(r.layers.length>0)for(var n=0;n<r.layers.length;n++){var a=r.layers[n],l=a.o,s=a.v,p=!1;for(j=0;j<i.options.workLayers.length;j++){var c=$.extend({},i.options.workLayers[j],{map:i});if(a.u===c.url&&c.layerNames.indexOf(a.n)>=0){p=!0;c.renderOptions={opacity:a.o,hide:!a.v};o.push(i.addLayer(c).then(function(e){e.setVisibility(s);e.setOpacity(l,!0)}))}}p||o.push(i.addLayer({id:TC.getUID(),url:TC.Util.isOnCapabilities(a.u,a.u.indexOf(window.location.protocol)<0)||a.u,hideTitle:a.h,layerNames:a.n?a.n.split(","):"",renderOptions:{opacity:a.o,hide:!a.v}}).then(function(e){var t=e.wrap.getRootLayerNode();e.title=t.Title||t.title;e.setOpacity(l,!0);e.setVisibility(s)}))}$.when.apply($,o).always(function(){!function(){i.loadingCtrl&&i.loadingCtrl.removeWait(i.hasWait);delete i.hasWait;t.resolve()}()})}return t};a.getMapState=function(e){var t=f(e);return TC.Util.utf8ToBase64(t)};a.getPreviousMapState=function(){return d};a.checkLocation=function(){var e=window.location.hash;if(e&&e.length>1){e=e.substr(1);var t;try{t=jsonpack.unpack(TC.Util.base64ToUtf8(e))}catch(o){try{t=JSON.parse(TC.Util.base64ToUtf8(e))}catch(e){TC.error(TC.Util.getLocaleString(i.options.locale,"mapStateNotValid"),TC.Consts.msgErrorMode.TOAST);return}}TC.Util.detectIE()&&2047===window.location.href.length&&TC.error(TC.Util.getLocaleString(i.options.locale,"mapStateNotValidForIE"),TC.Consts.msgErrorMode.TOAST);if(t){var o=!1;if(!t.hasOwnProperty("ext")){o=!0;t.ext=i.options.initialExtent}if(!t.hasOwnProperty("base")){o=!0;t.base=i.options.defaultBaseLayer}if(t.hasOwnProperty("layers"))for(var r=t.layers.length-1;r>=0;r--)if(t.layers[r]&&t.layers[r].hasOwnProperty("u")&&t.layers[r].hasOwnProperty("n")){if(!t.layers[r].hasOwnProperty("o")||!t.layers[r].hasOwnProperty("v")||!t.layers[r].hasOwnProperty("h")){o=!0;jQuery.extend(t.layers[r],{o:t.layers[r].o||1,v:t.layers[r].v||!0,h:t.layers[r].h||!1})}}else{o=!0;t.layers.length=t.layers.length-1}else{o=!0;t.layers=[]}t.hasOwnProperty("vw3")&&(t.vw3?(!t.vw3.cp||t.vw3.cp&&3!=t.vw3.cp.length||!t.vw3.chpr||t.vw3.chpr&&3!=t.vw3.chpr.length||!t.vw3.bcpd)&&(o=!0):o=!0);o&&TC.error(TC.Util.getLocaleString(i.options.locale,"mapStateNotValid"),TC.Consts.msgErrorMode.TOAST);return t}TC.error(TC.Util.getLocaleString(i.options.locale,"mapStateNotValid"),TC.Consts.msgErrorMode.TOAST)}};var m=function(e){if(l<=0){l=0;i.$events.trigger($.Event(TC.Consts.event.BEFOREUPDATE))}l+=1},v=function(e){if((l-=1)<=0){l=0;i.$events.trigger($.Event(TC.Consts.event.UPDATE))}},C=function(e){var t=$.Deferred();if("string"==typeof e){var o=e,r=/^(https?:)?\/\//i.test(o),i=function(t,i){var l=$.Deferred(),s=[o+"/"+i,a+o+"/"+i,a+"layout/responsive/"+i];r&&s.unshift(o+"/"+i);!function o(r){(function(e,t){var o=$.Deferred();$.ajax({type:"HEAD",url:e,complete:function(r,i){o.resolve({resource:t,found:404!==r.status,url:e})}});return o.promise()})(s[r],t).done(function(t){t.found?l.resolve(n(e,t)):o(++r)})}(0);return l.promise()},n=function(e,t){if(!(t.resource in e)){$.extend(!0,{},e);var r=t.found?t.url:a+o+"/"+l[t.resource];e[t.resource]=r}return e},a=TC.apiLocation+"TC/",l=(e={},{script:"script.js",style:"style.css",markup:"markup.html",config:"config.json",i18n:"resources"}),s=Object.keys(l).length;for(var p in l)i(p,l[p]).done(function(e){Object.keys(e).length===s&&t.resolve(e)})}else t.resolve(e);return t.promise()};TC.i18n=TC.i18n||{};TC.i18n.loadResources=TC.i18n.loadResources||function(e,t,o){var r;e?r=$.ajax({url:t+o+".json",type:"GET",dataType:"json",success:function(e){TC.i18n[o]=TC.i18n[o]||{};$.extend(TC.i18n[o],e);"undefined"!=typeof dust&&TC.loadJS(!window.dust.i18n,TC.apiLocation+TC.Consts.url.TEMPLATING_I18N,function(){dust.i18n.add(o,TC.i18n[o])})}}):dust.i18n.add(o,TC.i18n[o]);return r};var T=[],S=i.options.locale,_=$.Deferred();T.push(_);TC.loadJSInOrder(!window.dust||!window.dust.i18n,TC.url.templating,function(){if(S){dust.i18n.setLanguages([S]);T.push(TC.i18n.loadResources(!TC.i18n[S],TC.apiLocation+"TC/resources/",S))}_.resolve()});$.when.apply(this,T).always(function(){const e=TC.Util.getParameterByName(TC.Cfg.layoutURLParamName)||i.options.layout;e?C(e).done(function(e){i.$events.trigger($.Event(TC.Consts.event.BEFORELAYOUTLOAD,{map:i}));var o;"string"==typeof e?o={href:$.trim(e)}:(e.hasOwnProperty("config")||e.hasOwnProperty("markup")||e.hasOwnProperty("style")||e.hasOwnProperty("ie8Style")||e.hasOwnProperty("script")||e.hasOwnProperty("href")||e.hasOwnProperty("i18n"))&&(o=$.extend({},e));o.href&&(o.href+=o.href.match(/\/$/)?"":"/");o.config=o.config||o.href+"config.json";o.markup=o.markup||o.href+"markup.html";o.style=o.style||o.href+"style.css";o.ie8Style=o.ie8Style||o.href+"ie8.css";o.script=o.script||o.href+"script.js";o.i18n=o.i18n||o.href+"resources";o.i18n&&(o.i18n+=o.i18n.match(/\/$/)?"":"/");i.layout=o;var r=[],a=$.Deferred();r.push(a);o.config?r.push($.ajax({url:o.config,type:"GET",dataType:"json",success:function(e){a.resolve(e.i18n);n.call(i,e,t)},error:function(e,t,o){TC.error(t+": "+o);a.resolve(!1)}})):a.resolve(!1);if(o.style){i._$div.addClass("tc-lo");TC.loadCSS(o.style)}!Modernizr.canvas&&o.ie8Style&&TC.loadCSS(o.ie8Style);if(o.markup){var l;if(S){l=$.Deferred();r.push(l)}r.push($.ajax({url:o.markup,type:"GET",dataType:"html",success:function(e){a.then(function(t){if(t&&S)TC.i18n.loadResources(!0,o.i18n,S).always(function(){e=e.replace(/(?:\{\{([^\}\{]+)\}\}|\{@i18n \$key="([^\}\{]+)"\/\})/g,function(e,t,o){return TC.Util.getLocaleString(S,t||o)});i._$div.append(e);l.resolve()});else{i._$div.append(e);S&&l.resolve()}})},error:function(){l.reject()}}))}$.when.apply(this,r).always(function(){TC.loadJS(o.script,o.script,function(){g(i._$div);p()})})}):p()});i.$events.on(TC.Consts.event.UPDATEPARAMS,function(e){r(e.layer)});i.$events.on(TC.Consts.event.ZOOM,function(){for(var e=0;e<i.workLayers.length;e++)r(i.workLayers[e])});var E=TC.error;TC.error=function(e,t,o){TC.isDebug&&console.trace&&console.trace();if(t){var r=function(e,t,o){switch(t){case TC.Consts.msgErrorMode.TOAST:if(!i.toast){console.warn("No existe el objeto Toast");return}i.toast(e,{type:TC.Consts.msgType.ERROR,duration:2*TC.Cfg.toastDuration});break;case TC.Consts.msgErrorMode.EMAIL:TC.Cfg.loggingErrorsEnabled&&JL("onerrorLogger").fatalException(o?{msg:o,errorMsg:e}:e,null);break;case TC.Consts.msgErrorMode.CONSOLE:default:console.error(e)}};if($.isArray(t))for(var n=0;n<t.length;n++)r(e,t[n],o);else r(e,t,o)}else{E(e);i.toast(e,{type:TC.Consts.msgType.ERROR,duration:2*TC.Cfg.toastDuration})}}};var r=function(e){e.type===TC.Consts.layerType.WMS&&(e.tree=null)},i=function(e,t){var r=$.map(e,function(e){var o={};e&&(o[t]=e[t]);return o});"availableBaseLayers"===t&&console.log("layerOptions",r);var i={};i[t]=TC.Cfg[t];r.unshift(i);if("baseLayers"===t&&r[1].baseLayers){i=r[1];for(var n=0;n<i.baseLayers.length;n++)"object"==typeof i.baseLayers[n]&&$.extend(i.baseLayers[n],o.call(this,i.baseLayers[n].id))}else{r.unshift(!0);i=$.extend.apply(this,r);"availableBaseLayers"===t&&console.log("layerOption",i)}return i[t]},n=function(){const e=this.options=$.extend.apply(this,$.merge([!0,{},TC.Cfg],arguments));e.availableBaseLayers=TC.Cfg.availableBaseLayers.concat.apply(TC.Cfg.availableBaseLayers,Array.prototype.map.call(arguments,function(e){return e.availableBaseLayers||[]}));e.baseLayers=i.call(this,arguments,"baseLayers");e.workLayers=i.call(this,arguments,"workLayers");return e},a=TC.Map.prototype,l=function(e,t){var o,r='Layer "'+t.title+'" ("'+t.names+'"): ';o=t.isValidFromNames()?"layerSrsNotCompatible":"layerNameNotValid";r+=TC.Util.getLocaleString(e.options.locale,o);TC.error(r);e.$events.trigger($.Event(TC.Consts.event.LAYERERROR,{layer:t,reason:o}))};a.getCRS=function(){const e=this;return e.on3DView?e.view3D.crs:e.crs};a.addLayer=function(e,r){const i=this,n=new $.Deferred;n.then(function(e){t.resolve(i,e,e.isBase);i.$events.trigger($.Event(TC.Consts.event.LAYERADD,{layer:e}));t.checkMapLoad(i);$.isFunction(r)&&r(e)},function(e){t.checkMapLoad(i)});const a=d(e);"object"!=typeof e||e.id||(e.id=TC.getUID());t.add(e.id||e,n,a,e.isBase);const s=function(e){if(e){var t={projection:i.wrap.map.getView().getProjection(),extent:i.initialExtent},o=i.baseLayer.getResolutions();if(o&&o.length)t.resolutions=o;else{t.minZoom=i.wrap.map.getView().getMinZoom();t.maxZoom=i.wrap.map.getView().getMaxZoom();var r=i.baseLayer.wrap.layer.getMinResolution();0!==r&&(t.minResolution=r);var n=i.baseLayer.wrap.layer.getMaxResolution();n!==Number.POSITIVE_INFINITY&&(t.maxResolution=n)}i.wrap.map.setView(new ol.View(t));i.wrap.map.getView().fit(i.initialExtent)}};var p,c,u;if(a){c=!TC.layer||!TC.layer.Raster;u=TC.apiLocation+"TC/layer/Raster"}else{c=!TC.layer||!TC.layer.Vector;u=TC.apiLocation+"TC/layer/Vector"}TC.loadJS(c,[u],function(){if("string"==typeof e)p=new TC.layer.Raster($.extend({},o.call(i,e),{map:i}));else if(e instanceof TC.Layer)(p=e).map=i;else{e.map=i;p=e.type===TC.Consts.layerType.VECTOR||e.type===TC.Consts.layerType.KML||e.type===TC.Consts.layerType.WFS?new TC.layer.Vector(e):new TC.layer.Raster(e)}i.$events.trigger($.Event(TC.Consts.event.BEFORELAYERADD,{layer:p}));$.when(i.wrap.getMap(),p.wrap.getLayer()).then(function(){var o;d(p)&&(o=i.wrap.indexOfFirstVector());-1===o&&(o=i.wrap.getLayerCount());const r=i.state&&i.state.crs?i.state.crs:i.getCRS(),a=p.isCompatible(r);if(p.isBase){if(!a)if(!p.type===TC.Consts.layerType.WMTS)p.mustReproject=!0;else{const e=p.wrap.getCompatibleMatrixSets(r)[0];e?p.wrap.setMatrixSet(e):p.mustReproject=!0}i.state?p.isDefault=i.state.base===p.id||i.state.base===p.options.fallbackLayer:"string"==typeof i.options.defaultBaseLayer?i.options.defaultBaseLayer===p.id&&(p.isDefault=!0):"number"==typeof i.options.defaultBaseLayer&&i.options.defaultBaseLayer===i.baseLayers.length&&(p.isDefault=!0);if(p.isDefault)if(p.mustReproject&&!p.type===TC.Consts.layerType.WMTS||p.mustReproject&&p.type===TC.Consts.layerType.WMTS&&!p.wrap.getCompatibleMatrixSets(r)[0])if(p.options.fallbackLayer&&p.getFallbackLayer){var c=null===i.baseLayer;i.baseLayer=p.getFallbackLayer();i.addLayer(i.baseLayer).then(function(e){i.wrap.setBaseLayer(e.wrap.getLayer());s(c);n.resolve(p)})}else{l(i,p);n.reject(e)}else{c=null===i.baseLayer;i.wrap.setBaseLayer(p.wrap.getLayer());i.baseLayer=p;s(c);n.resolve(p)}else n.resolve(p)}else if(a){i.wrap.insertLayer(p.wrap.getLayer(),t.getResolvedVisibleLayerIndex(i,p.id));n.resolve(p)}else{l(i,p);n.reject(e)}})});return n.promise()};a.removeLayer=function(e){var o=this,r=new $.Deferred;$.when(e.wrap.getLayer()).then(function(i){for(var n=0;n<o.layers.length;n++)o.layers[n]===e&&o.layers.splice(n,1);if(e.isBase){for(n=0;n<o.baseLayers.length;n++)if(o.baseLayers[n]===e){o.baseLayers.splice(n,1);o.baseLayer===e&&o.setBaseLayer(o.baseLayers[0]);break}}else{for(n=0;n<o.workLayers.length;n++)if(o.workLayers[n]===e){o.workLayers.splice(n,1);break}e===o.vectors&&(o.vectors=null)}o.wrap.removeLayer(i);t.remove(e.id);o.$events.trigger($.Event(TC.Consts.event.LAYERREMOVE,{layer:e}));t.checkMapLoad(o);r.resolve(e)});return r};a.insertLayer=function(e,t,o){for(var r=this,i=-1,n=0;n<r.layers.length;n++)if(e===r.layers[n]){i=n;break}var a=[];a.push(e.wrap.getLayer());var l=r.layers[t];l&&a.push(l.wrap.getLayer());$.when.apply(this,a).then(function(n,a){var l=-1;if((l=a?r.wrap.getLayerIndex(a):r.wrap.getLayerCount())>=0){e.map=r;r.wrap.insertLayer(n,l);i>-1&&r.layers.splice(i,1);r.layers.splice(t,0,e);r.workLayers=r.layers.filter(function(e){return!e.isBase});r.$events.trigger($.Event(TC.Consts.event.LAYERORDER,{layer:e,oldIndex:i,newIndex:t}))}$.isFunction(o)&&o()})};a.setLayerIndex=function(e,t){this.wrap.setLayerIndex(e.wrap.getLayer(),t)};a.putLayerOnTop=function(e){var t=this.wrap.getLayerCount();this.setLayerIndex(e,t-1)};a.setBaseLayer=function(e,t){var r=this,i=null,n=!1;if("string"==typeof e){var a;for(a=0;a<r.layers.length;a++)if(r.layers[a].id===e){e=r.layers[a];n=!0;break}if(!n&&(e=o.call(r,e))){e=r.addLayer($.extend(!0,{},e,{isDefault:!0,map:r}));n=!0}}else{if($.inArray(e,r.layers)<0){e.isDefault=!0;e.map=r;r.addLayer(e).then(function(){r.$events.trigger($.Event(TC.Consts.event.BASELAYERCHANGE,{layer:e}));$.isFunction(t)&&t()})}n=!0}if(n)if(e.isCompatible(r.getCRS())||e.fallbackLayer&&(!e.fallbackLayer||e.fallbackLayer.isCompatible(r.getCRS()))){r.$events.trigger($.Event(TC.Consts.event.BEFOREBASELAYERCHANGE,{oldLayer:r.getBaseLayer(),newLayer:e}));i=e;$.when(r.wrap.getMap(),e).then(function(e,o){$.when(o.wrap.getLayer()).then(function(e){r.wrap.setBaseLayer(e).then(function(){r.baseLayer=o;r.$events.trigger($.Event(TC.Consts.event.BASELAYERCHANGE,{layer:o}));$.isFunction(t)&&t()})})})}else TC.error("Base layer must be reprojected");else TC.error("Base layer is not available");return i};a.on=function(e,t){this.$events.on(e,t);return this};a.one=function(e,t){this.$events.one(e,t);return this};a.off=function(e,t){this.$events.off(e,t);return this};a.ready=function(e){$.isFunction(e)&&(this.isReady?e():this.one(TC.Consts.event.MAPREADY,e))};a.loaded=function(e){$.isFunction(e)&&(this.isLoaded?e():this.one(TC.Consts.event.MAPLOAD,e))};a.getLayerTree=function(){var e={baseLayers:[],workLayers:[]};this.baseLayer&&(e.baseLayers[0]=this.baseLayer.getTree());for(var t=0;t<this.workLayers.length;t++){var o=this.workLayers[t].getTree();o&&e.workLayers.unshift(o)}return e};a.addControl=function(e,t){var o=this,r=new $.Deferred,i=function(e){o.controls.push(e);e.register(o);$dv=$(e.div);0===$dv.parent().length&&$dv.appendTo(o._$div);o.$events.trigger($.Event(TC.Consts.event.CONTROLADD,{control:e}));r.resolve(e)};if("string"==typeof e){e=e.substr(0,1).toUpperCase()+e.substr(1);TC.loadJS(!TC.Control||!TC.control[e],[TC.apiLocation+"TC/control/"+e],function(){i(new TC.control[e](null,t))})}else i(e);return r.promise()};a.getControlsByClass=function(e){var t=[],o=e;if("string"==typeof e){o=window;for(var r=e.split("."),i=0;i<r.length&&(o=o[r[i]]);i++);}if($.isFunction(o))for(i=0;i<this.controls.length;i++){var n=this.controls[i];n instanceof o&&t.push(n)}return t};a.getControlById=function(e){const t=this;for(var o=0,r=t.controls.length;o<r;o++){const r=t.controls[o];if(r.id===e)return r}return null};a.getDefaultControl=function(){var e=this.getControlsByClass("TC.control.FeatureInfo");return e&&e.length?e[0]:null};a.getLoadingIndicator=function(){var e=null,t=this.getControlsByClass("TC.control.LoadingIndicator");t.length&&(e=t[0]);return e};a.setExtent=function(e,t){return this.wrap.setExtent(e,t)};a.getExtent=function(){return this.wrap.getExtent()};a.setCenter=function(e,t){return this.wrap.setCenter(e,t)};a.getCenter=function(){return this.wrap.getCenter()};a.setRotation=function(e){this.wrap.setRotation(e)};a.getRotation=function(){return this.wrap.getRotation()};a.getViewHTML=function(){return this.wrap.getViewport()};a.getCompatibleCRS=function(e){const t=((e=e||{}).layers||this.workLayers.concat(this.baseLayer)).filter(function(e){return e.isRaster()}).map(function(t){return t.getCompatibleCRS({normalized:!0,includeFallback:e.includeFallbacks})}),o=t.slice(1);return t[0].filter(function(e){return o.every(function(t){return t.indexOf(e)>=0})})};a.loadProjections=function(e){e=e||{};const t=$.Deferred(),o=e.crsList||[];$.when.apply(this,o.map(function(e){return TC.getProjectionData({crs:TC.Util.getCRSCode(e)})})).then(function(){var o=Array.prototype.slice.call(arguments).filter(function(e){return"ok"===e.status&&e.number_result>0}).map(function(e){const t=e.results[0],o="EPSG:"+t.code;TC.loadProjDef({crs:o,def:t.def,name:t.name});return{code:o,name:t.name,proj4:t.proj4,unit:t.unit}});e.orderBy&&(o=o.sort(TC.Util.getSorterByProperty(e.orderBy)));t.resolve(o)},function(e){t.reject(e)});return t.promise()};a.setProjection=function(e){const t=this,o=$.Deferred();var r;if((e=e||{}).crs){e.baseLayer?r=e.baseLayer:e.allowFallbackLayer&&(t.baseLayer.isCompatible(e.crs)||0!==t.baseLayer.wrap.getCompatibleMatrixSets(e.crs).length?t.baseLayer.firstOption&&(t.baseLayer.firstOption.isCompatible(e.crs)||t.baseLayer.firstOption.wrap.getCompatibleMatrixSets(e.crs).length>0)&&(r=t.baseLayer.firstOption):t.baseLayer.options.fallbackLayer&&(r=t.baseLayer.getFallbackLayer()));r||(r=t.baseLayer);t.baseLayers.indexOf(r)<0&&t.addLayer(r);TC.loadProjDef({crs:e.crs,callback:function(){r.getCapabilitiesPromise().then(function(){const i=$.extend({},e,{oldCrs:t.crs}),n=function(e){e.setProjection(i)};if(r.isCompatible(e.crs)||r.wrap.getCompatibleMatrixSets(e.crs).length>0){r.setProjection(i);t.wrap.setProjection($.extend({},e,{baseLayer:r}));t.crs=e.crs;t.baseLayers.filter(function(e){return e!==r}).forEach(n);t.workLayers.forEach(n);const a=function(){t.$events.trigger($.Event(TC.Consts.event.PROJECTIONCHANGE,{crs:e.crs}));o.resolve()};r&&r!==t.baseLayer?t.setBaseLayer(r,a):a()}else o.reject()})}})}return o.promise()};a.getMetersPerUnit=function(){return this.wrap.getMetersPerUnit()};a.getCoordinateFromPixel=function(e){return this.wrap.getCoordinateFromPixel(e)};a.getPixelFromCoordinate=function(e){return this.wrap.getPixelFromCoordinate(e)};a.zoomToFeatures=function(e,t){if(e.length>0){var o=[1/0,1/0,-1/0,-1/0],r=t||{},i=r.pointBoundsRadius||this.options.pointBoundsRadius;i/=this.getMetersPerUnit();var n=r.extentMargin;"number"!=typeof n&&(n=this.options.extentMargin);for(var a=0;a<e.length;a++){var l=e[a].getBounds();if(l){o[0]=Math.min(o[0],l[0]);o[1]=Math.min(o[1],l[1]);o[2]=Math.max(o[2],l[2]);o[3]=Math.max(o[3],l[3])}}if(o[2]-o[0]==0){o[0]=o[0]-i;o[2]=o[2]+i}if(o[3]-o[1]==0){o[1]=o[1]-i;o[3]=o[3]+i}if(this.options.extentMargin){var s=(o[2]-o[0])*n/2,p=(o[3]-o[1])*n/2;o[0]=o[0]-s;o[1]=o[1]-p;o[2]=o[2]+s;o[3]=o[3]+p}if(this.options.maxExtent){o[0]=Math.max(o[0],this.options.maxExtent[0]);o[1]=Math.max(o[1],this.options.maxExtent[1]);o[2]=Math.min(o[2],this.options.maxExtent[2]);o[3]=Math.min(o[3],this.options.maxExtent[3])}this.wrap.setExtent(o,r);this.$events.trigger($.Event(TC.Consts.event.ZOOMTO,{extent:o}))}};a.zoomToMarkers=function(e){var t=this;$.when.apply(this,t._markerDeferreds).then(function(){for(var o=[],r=0;r<t.workLayers.length;r++){var i=t.workLayers[r];if(i.type===TC.Consts.layerType.VECTOR)for(var n=0;n<i.features.length;n++){var a=i.features[n];a instanceof TC.feature.Marker&&(o[o.length]=a)}}for(r=0;r<arguments.length;r++)o[o.length]=arguments[r];t.zoomToFeatures(o,e);t._markerDeferreds=[]})};a.getLayer=function(e){var t=null;if("string"==typeof e){for(var o=0;o<this.layers.length;o++)if(this.layers[o].id===e){t=this.layers[o];break}}else TC.Layer&&e instanceof TC.Layer&&(t=e);return t};var s=function(e){var t;if(e.vectors)t=e.vectors;else{t=e.addLayer({id:TC.getUID(),title:TC.i18n[e.options.locale].vectors,type:TC.Consts.layerType.VECTOR});e.vectors=t;t.then(function(t){e.vectors=t})}return t};a.addPoint=function(e,t){if(t&&t.layer){var o=this.getLayer(t.layer);o&&o.addPoint(e,t)}else $.when(s(this)).then(function(o){o.addPoint(e,t)})};a.addMarker=function(e,t){if(t&&t.layer){var o=this.getLayer(t.layer);o&&this._markerDeferreds.push(o.addMarker(e,t))}else{var r=new $.Deferred;this._markerDeferreds.push(r);$.when(s(this)).then(function(o){$.when(o.addMarker(e,t)).then(function(e){r.resolve(e)})})}};a.addPolyline=function(e,t){if(t&&t.layer){this.getLayer(t.layer)&&t.layer.addPolyline(e,t)}else $.when(s(this)).then(function(o){o.addPolyline(e,t)})};a.addPolygon=function(e,t){if(t&&t.layer){this.getLayer(t.layer)&&t.layer.addPolygon(e,t)}else $.when(s(this)).then(function(o){o.addPolygon(e,t)})};a.getBaseLayer=function(){return this.baseLayer||this.baseLayers[0]};a.getResolutions=function(){return this.wrap.getResolutions()};a.getResolution=function(){return this.wrap.getResolution()};a.setResolution=function(e){this.wrap.setResolution(e)};a.exportFeatures=function(e,t){var o=t||{},r=this.getLoadingIndicator(),i=r&&r.addWait(),n=this.wrap.exportFeatures(e,o),a=TC.Consts.mimeType[o.format],l=o.format||"";TC.Util.downloadFile((o.fileName||TC.getUID())+"."+l.toLowerCase(),a,n);r&&r.removeWait(i)};var p={},c=function(){var e=$(this),t=e.parent(".tc-toast-container"),o=e.html();e.addClass(TC.Consts.classes.HIDDEN);void 0!==p[o]&&(p[o]=void 0);setTimeout(function(){e.remove();t.find(".tc-toast").length||t.remove()},1e3)};a.toast=function(e,t){var o=t||{},r=o.duration||TC.Cfg.toastDuration,i=p[e];if(i){clearTimeout(i.timeout);i.$toast.remove()}var n=this._$div.find(".tc-toast-container");n.length||(n=$("<div>").addClass("tc-toast-container").appendTo(o.container?o.container:this._$div));i=p[e]={$toast:$("<div>").addClass("tc-toast").html(e).appendTo(n).on(TC.Consts.event.CLICK,c)};var a="";switch(o.type){case TC.Consts.msgType.INFO:a=TC.Consts.classes.INFO;break;case TC.Consts.msgType.WARNING:a=TC.Consts.classes.WARNING;break;case TC.Consts.msgType.ERROR:a=TC.Consts.classes.ERROR}i.$toast.addClass(a);i.timeout=setTimeout(function(){c.call(i.$toast)},r)};var u=!1,g=function(e){if(/iPad/i.test(navigator.userAgent)){var t=window.innerHeight;e.height()===t+(Modernizr.mq("only screen and (orientation : landscape)")?20:0)&&(u=!0)}var o=function(){e.toggleClass(TC.Consts.classes.IPAD_IOS7_FIX,Modernizr.mq("only screen and (orientation : landscape)"))};if(u){o();$(window).on("resize",o)}else $(window).off("resize",o)},d=function(e){return"string"==typeof e||e.type!==TC.Consts.layerType.VECTOR&&e.type!==TC.Consts.layerType.KML&&e.type!==TC.Consts.layerType.WFS};a.exportImage=function(){var e=null,t="El mapa actual no es compatible con la exportaci\xf3n de im\xe1genes",o=this.wrap.getViewport({synchronous:!0}).getElementsByTagName("canvas")[0];if(o&&this.options.crossOrigin)try{e=o.toDataURL()}catch(e){TC.error(t+": "+e.message)}else TC.error(t);return e}}();var TC=TC||{};!function(e,t){"object"==typeof exports?module.exports=t():"function"==typeof define&&define.amd?define([],t):e.Util=t()}(TC,function(){String.prototype.soundex=function(){var e=this.toLowerCase().split("");f=e.shift(),r="",codes={a:"",e:"",i:"",o:"",u:"",b:1,f:1,p:1,v:1,c:2,g:2,j:2,k:2,q:2,s:2,x:2,z:2,d:3,t:3,l:4,m:5,n:5,r:6};r=f+e.map(function(e,t,o){return codes[e]}).filter(function(e,t,o){return 0===t?e!==codes[f]:e!==o[t-1]}).join("");return(r+"000").slice(0,4).toUpperCase()};Number.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e};var e=Number.prototype.toLocaleString;Number.prototype.toLocaleString=function(t,o){if("eu-ES"!=t||TC.Util.detectIE())return e.apply(this,arguments);var r=e.apply(this,arguments);r=r.replace(/\,/g,".");Math.floor(this)==this&&Number.isInteger(Math.floor(this))||(r=r.replace(/.([^.]*)$/,",$1"));return r};var t={},o={},a=["Capability","Request","GetMap","DCPType","0","HTTP","Get","OnlineResource"],l=["OperationsMetadata","GetTile","DCP","HTTP","Get","0","href"],s=function(e,t,o){return o<t.length-1?e.hasOwnProperty(t[o])?s(e[t[o]],t,++o):null:e[t[o]]},p={getMapLocale:function(e){return e.options&&e.options.locale&&e.options.locale.replace("_","-")||"es-ES"},regex:{PROTOCOL:/(^https?:)/i},isOnCapabilities:function(e){var t=2!=arguments.length||arguments[1],o=t?e:e.replace(TC.Util.regex.PROTOCOL,"");if(t){if(TC.capabilities[o])return e}else for(var r in TC.capabilities)if(r.replace(TC.Util.regex.PROTOCOL,"")==o)return r;for(r in TC.capabilities){var i=s(TC.capabilities[r],a,0)||s(TC.capabilities[r],l,0);if(i&&t&&e==i)return i;if(i&&e.replace(TC.Util.regex.PROTOCOL,"")==i.replace(TC.Util.regex.PROTOCOL,""))return i}return e},reqGetMapOnCapabilities:function(e){var t,o,r=2!=arguments.length||arguments[1];r||e.replace(TC.Util.regex.PROTOCOL,"");return TC.capabilities[e]?(t=TC.capabilities[e],(o=s(t,a,0)||s(t,l,0))?r?o.split("?")[0]:o.split("?")[0].replace(TC.Util.regex.PROTOCOL,""):null):null},getFNFromString:function(e){var t=window,o=e.split(".");for(i=0;i<o.length-1;i++)if(void 0==(t=t[o[i]]))return;return t[o[o.length-1]]},isURL:function(e){return/^(http|https|ftp|mailto)\:\/\//i.test(e)},isSecureURL:function(e){return!/^(f|ht)tps?:\/\//i.test(e)||/^(f|ht)tps:\/\//i.test(e)},isSameOrigin:function(e){var t=0!==e.indexOf("http")&&0!==e.indexOf("//"),o=!t&&e.match(TC.Consts.url.SPLIT_REGEX);if(o){var r=window.location,i=o[1];t=(i==r.protocol||void 0==i)&&o[3]==r.hostname;var n=o[4],a=r.port;(80!=n&&""!==n||"80"!=a&&""!==a)&&(t=t&&n==a)}return t},formatNumber:function(e,t){var o=typeof e;if("number"===o)return e.toLocaleString(t);if("string"===o){n=parseFloat(e);if(n===new Number(e).valueOf())return n.toLocaleString(t)}return e},addProtocol:function(e){var t=e;e&&0===e.indexOf("//")&&(t=location.protocol+e);return t},getDiv:function(e){return"string"==typeof e?document.getElementById(e):1==$(e).length?e:document.createElement("div")},getScriptLocation:function(){var e,t;if(document.currentScript)t=document.currentScript;else{var o=document.getElementsByTagName("script");t=o[o.length-1]}return(e=t.getAttribute("src"))?e.substr(0,e.lastIndexOf("/")+1):""},getBackgroundUrlFromCss:function(e){var o="";if(e)if(void 0!==t[e])o=t[e];else{var r=$('<div style="display:none">').addClass(e).appendTo("body"),i=/^url\(['"]?(.*?)['"]?\)$/gi.exec(r.css("background-image"));i&&i.length>1&&(o=i[i.length-1]);r.remove();t[e]=o}return o},getPointIconUrl:function e(t){var r=null;if(t.url)r=t.url;else{var i;if("string"==typeof t.cssClass)i=t.cssClass;else{var n=t.classes||TC.Cfg.styles.marker.classes;i=n[0];if(t.group){if(void 0===o[t.group]){var a=0;for(var l in o)a++;a%=n.length;o[t.group]=n[a]}i=o[t.group]}}r=TC.Util.getBackgroundUrlFromCss(i)}r||t===TC.Cfg.styles.point||""===t.cssClass||(r=e(TC.Cfg.styles.point));return r},addArrayToTree:function e(t,o,r){var i=null,n=!1,a=t[r=r||0];if(a){for(var l,s=0,p=o.children.length;s<p;s++)if((l=o.children[s]).name===a){n=!0;var c=e(t,l,r+1);c&&(i=c);break}if(!n){l={name:a,title:a,uid:"/"+t.slice(0,r+1).join("/"),children:[]};o.children.push(l);i=l}}return i},parseCoords:function(e){var t=null,o=function(e){var t=e,o={};o.type=TC.Consts.GEOGRAPHIC;var r=t.indexOf("\xb0");o.value=parseFloat(t.substr(0,r));if((r=(t=t.substr(r+1)).indexOf("'"))>=0){var i=parseFloat(t.substr(0,r))/60;o.value>=0?o.value+=i:o.value-=i;if((r=(t=t.substr(r+1)).indexOf("'"))>=0){i=parseFloat(t.substr(0,r).replace(",","."))/3600;o.value>=0?o.value+=i:o.value-=i}}return o},r=function(e){var t=$.trim(e);if(t.match(/^1?\d{0,2}\s*\u00B0(\s*\d{1,2}\s*'(\s*\d{1,2}([.,]\d+)?\s*'')?)?\s*[NnSsWwOoEe]$/g)){switch(t[t.length-1]){case"S":case"s":case"W":case"w":case"O":case"o":t="-"+t}t=t.substr(0,t.length-1);return o(t)}if(t.match(/^[+-]?1?\d{0,2}\s*\u00B0(\s*\d{1,2}\s*'(\s*\d{1,2}([.,]\d+)?\s*'')?)?$/g))return o(t);if(t.match(/^1?\d{0,2}([.,]\d+)?\s*\u00B0?\s*[NnSsWwOoEe]$/g)){var r={type:TC.Consts.GEOGRAPHIC,value:parseFloat(t.substr(0,t.length-1).replace(",","."))};t.match(/[SsWwOo]$/)&&(r.value=-r.value);return r}return t.match(/^[+-]?1?\d{0,2}([.,]\d+)?\s*\u00B0?$/g)?{type:TC.Consts.GEOGRAPHIC,value:parseFloat(t.replace(",","."))}:t.match(/^\d{6,7}([.,]\d+)?$/g)?{type:TC.Consts.UTM,value:parseFloat(t.replace(",","."))}:null},i=(e=$.trim(e).toUpperCase()).split(",");4===i.length?i=[i.slice(0,1).join("."),i.slice(2,3).join(".")]:1!==i.length&&3!==i.length||(i=e.split(" "));if(2===i.length){var n=r(i[0]),a=r(i[1]);null!==n&&null!==a&&(t=[n,a])}return t},reproject:function(e,t,o){var r,i=!0,n=!0,a=!0;if($.isArray(e[0]))if($.isArray(e[0][0])){if(!$.isArray(e[0][0][0])){a=!1;e=[e]}}else{n=!1;e=[[e]]}else{i=!1;n=!1;a=!1;e=[[[e]]]}TC.loadProjDef({crs:t,sync:!0});TC.loadProjDef({crs:o,sync:!0});var l=new Proj4js.Proj(t),s=new Proj4js.Proj(o);r=new Array(e.length);e.forEach(function(e,t){const o=r[t]=[];e.forEach(function(e,t){const r=o[t]=[];e.forEach(function(e,t){var o=Proj4js.transform(l,s,{x:e[0],y:e[1]});r[t]=[o.x,o.y];e.length>2&&(r[t][2]=e[2])})})});i?n?a||(r=r[0]):r=r[0][0]:r=r[0][0][0];return r},getMetersPerDegree:function(e){var t=void 0;if($.isArray(e)&&e.length>=4){var o=this.degToRad(e[3]-e[1]),r=Math.sin(o/2),i=r*r;t=6370997*(2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i)))/(e[3]-e[1])}return t},radToDeg:function(e){return 180*e/Math.PI},degToRad:function(e){return e*Math.PI/180},mod:function(e){return(e%(2*Math.PI)+2*Math.PI)%(2*Math.PI)},getCRSCode:function(e){var t=null;e=e.trim();if(/^EPSG:\d{4,6}$/g.test(e)||/^urn:ogc:def:crs:EPSG:.*:\d{4,6}/g.test(e)||/http:\/\/www.opengis.net\/gml\/srs\/epsg.xml#\d{4,6}$/g.test(e)){var o=e.trim().match(/^.+[:#](\d{4,6})$/);o&&(t=o[1])}return t},CRSCodesEqual:function(e,t){if(e===t)return!0;var o=this.getCRSCode(e),r=this.getCRSCode(t);return null!==o&&null!==r&&o===r},getLocaleString:function(e,t,o){var r=t;if(TC.i18n&&TC.i18n[e]){var i=TC.i18n[e][t];if(i){r=i;if(o)for(var n in o)r=r.replace("{"+n+"}",o[n])}}return r},getSimpleMimeType:function(e){var t="";if(e){var o=e.indexOf(";");o>0&&(e=e.substring(0,o));t=e}return t},getQueryStringParams:function(e){var t;if(e){var o=e.indexOf("?");if(o>=0){var r=(t=e.substr(o)).indexOf("#");r>=0&&(t=t.substr(0,r))}else t="?"}else t=location.search;var i=$.map(t.replace(/(^\?)/,"").split("&"),function(e){return this[(e=e.split("="))[0]]=e[1],this}.bind({}))[0];delete i[""];return i},fastUnshift:function(e,t){for(var o=e.length;o;){e[o]=e[o-1];o--}e[0]=t},storage:{getCookie:function(e){return $.cookie(e)},setCookie:function(e,t,o){return $.cookie(e,t,o)},getLocalValue:function(e){return localStorage&&localStorage instanceof Storage?localStorage.getItem(e):TC.Util.storage.getCookie(e)},setLocalValue:function(e,t){if(localStorage&&localStorage instanceof Storage)void 0===t?localStorage.removeItem(e):localStorage.setItem(e,t);else if(void 0===t){var o=new Date;o.setDate(o.getDate()-1);TC.Util.storage.setCookie(e,"",{expires:o})}else TC.Util.storage.setCookie(e,t);return e},getSessionLocalValue:function(e){return sessionStorage&&sessionStorage instanceof Storage?sessionStorage.getItem(e):TC.Util.storage.getCookie(e)},setSessionLocalValue:function(e,t){if(sessionStorage&&sessionStorage instanceof Storage)void 0===t?sessionStorage.removeItem(e):sessionStorage.setItem(e,t);else if(void 0===t){var o=new Date;o.setDate(o.getDate()-1);TC.Util.storage.setCookie(e,"",{expires:o})}else TC.Util.storage.setCookie(e,t);return e}},detectFirefox:function(){return!!/Firefox[\/\s](\d+\.\d+)/.test(navigator.userAgent)&&new Number(RegExp.$1)},detectIE:function(){var e=window.navigator.userAgent,t=e.indexOf("MSIE ");if(t>0)return parseInt(e.substring(t+5,e.indexOf(".",t)),10);if(e.indexOf("Trident/")>0){var o=e.indexOf("rv:");return parseInt(e.substring(o+3,e.indexOf(".",o)),10)}var r=e.indexOf("Edge/");return r>0&&parseInt(e.substring(r+5,e.indexOf(".",r)),10)},detectChrome:function(){return window.chrome},detectSafari:function(){return!!navigator.userAgent.match(/Version\/[\d\.]+.*Safari/)},detectMouse:function(){if(Modernizr.mq("(pointer:coarse)")&&Modernizr.mq("(pointer:fine)"))return!0;if(Modernizr.mq("(pointer:coarse)")&&!Modernizr.mq("(pointer:fine)")){return!!function(){var e,t="(hover: hover)",o=!Modernizr.touch;"matchMedia"in window?(e=window.matchMedia(t)).media===t&&(o=e.matches):console.log("no dispone de matchMedia");return o}()}return!(Modernizr.mq("(pointer:coarse)")||!Modernizr.mq("(pointer:fine)"))||!Modernizr.mq("(pointer:none)")&&(!Modernizr.touch||void 0)},detectAndroid:function(){return navigator.userAgent.match(/Android/i)},detectBlackBerry:function(){return navigator.userAgent.match(/BlackBerry/i)},detectIOS:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)},detectMobileWindows:function(){return navigator.userAgent.match(/IEMobile/i)},detectMobile:function(){return TC.Util.detectAndroid()||TC.Util.detectIOS()||TC.Util.detectMobileWindows()||TC.Util.detectBlackBerry()},getBrowser:function(){window.UAParser||TC.syncLoadJS(TC.apiLocation+TC.Consts.url.UA_PARSER);var e=(new UAParser).getBrowser();return{name:e.name,version:e.major}},getElementByNodeName:function(e,t){for(var o=t.indexOf(":"),r=t.substr(o+1),i=e.getElementsByTagNameNS("*",r),n=0;n<i.length;n++)if(i[n].nodeName==t)return i},addURLParameters:function(e,t){if(!t)return e;var o=Object.keys(t).map(function(e){return encodeURIComponent(e)+"="+(t[e]?encodeURIComponent(t[e]):"")}).join("&"),r=e.split("?");if(r.length>=2){var i=r[1].split(/[&;]/g);i.push(o);return e=r[0]+"?"+i.join("&")}if((r=e.split("#")).length>=2){r.shift();return e=r[0]+"?"+o+"#"+r.join("#")}return e=e+"?"+o},removeURLParameter:function(e,t){var o=e.split("?");if(o.length>=2){for(var r=encodeURIComponent(t.toLowerCase())+"=",i=o[1].toLowerCase().split(/[&;]/g),n=i.length;n-- >0;)-1!==i[n].lastIndexOf(r,0)&&i.splice(n,1);return e=o[0]+"?"+i.join("&")}return e},showModal:function(e,t){var o=$(e);t=t||{};o.off("click").removeAttr("hidden");o.fadeIn(250,function(){o.on("click",".tc-modal-close",function(e){e.stopPropagation();return TC.Util.closeModal(t.closeCallback,$(e.target))});$.isFunction(t.openCallback)&&t.openCallback()})},closeModal:function(e,t){(t?t.closest(".tc-modal"):$(".tc-modal")).hide().find(".tc-modal-window").removeAttr("style").off();e&&e()},closeAlert:function(e){$(e).parents(".tc-alert").hide()},getParameterByName:function(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)","i").exec(location.search);return null===t?"":decodeURIComponent(t[1].replace(/\+/g," "))},getLocaleUserChoice:function(e){var t="en-US",o=(e=e||{}).cookieName||"SITNA.language",r=e.paramName||"lang",i=navigator.languages&&navigator.languages.length?navigator.languages[0]:navigator.language||navigator.userLanguage,n=TC.Util.getParameterByName(r)||TC.Util.storage.getCookie(o)||i,a=n.indexOf("-");a>=0&&(n=n.substr(0,a));var l=new Date((new Date).getTime()+31536e6);TC.Util.storage.setCookie(o,n,{expires:l});switch(n){case"eu":t="eu-ES";break;case"es":t="es-ES";break;default:t="en-US"}return t},downloadBlob:function(e,t){var o=document.createElement("a");if(void 0!==o.download){var r=URL.createObjectURL(t);o.setAttribute("href",r);o.setAttribute("download",e);o.style.visibility="hidden";document.body.appendChild(o);o.click();document.body.removeChild(o)}},downloadFile:function(e,t,o){var r=new Blob([o],{type:t});navigator.msSaveBlob?navigator.msSaveBlob(r,e):TC.Util.downloadBlob(e,r)},downloadDataURI:function(e,t,o){for(var r=atob(o.split(",")[1]),i=[],n=0;n<r.length;n++)i.push(r.charCodeAt(n));var a=new Blob([new Uint8Array(i)],{type:t});navigator.msSaveBlob?navigator.msSaveBlob(a,e):TC.Util.downloadBlob(e,a)},shortenUrl:function(e){var t;$.ajax({url:"https://api-ssl.bitly.com/v3/shorten",data:{access_token:"6c466047309f44bd8173d83e81491648b243ee3d",longUrl:e},async:!1}).done(function(e){t=e.data.url});return t},utf8ToBase64:function(e){return window.btoa(unescape(encodeURIComponent(e)))},base64ToUtf8:function(e){var t;try{t=decodeURIComponent(escape(window.atob(e)))}catch(e){t=null}return t},colorArrayToString:function(e){$.isArray(e)&&(e=e.slice(0,3).reduce(function(e,t){const o=t.toString(16);return e+"00".substring(0,2-o.length)+o},"#"));return e},operation:function(e,t,o,r){for(var i=[],n=0;n<e.length;n++){for(var a=e[n],l=!1,s=0;s<t.length;s++)if(o(a,t[s])){l=!0;break}l===r&&i.push(a)}return i},isSecureURL:function(e){return!/^(f|ht)tps?:\/\//i.test(e)||/^(f|ht)tps:\/\//i.test(e)},inBoth:function(e,t,o){return this.operation(e,t,o,!0)},inFirstOnly:function(e,t,o){return this.operation(e,t,o,!1)},inSecondOnly:function(e,t,o){return this.inFirstOnly(t,e,o)},toDataUrl:function(e,t){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{type:"image/png",encoderOptions:.92},r=o.type,i=o.encoderOptions,n=e.getContext("2d");if(!n)return"";var a=e.width,l=e.height,s=n.getImageData(0,0,a,l),p=n.globalCompositeOperation;if(t){n.globalCompositeOperation="destination-over";n.fillStyle=t;n.fillRect(0,0,a,l)}var c=e.toDataURL(r,i);if(t){n.clearRect(0,0,a,l);n.putImageData(s,0,0);n.globalCompositeOperation=p}return c},imgToDataUrl:function(e,t){var o=function(e){var t=document.createElement("CANVAS"),o=t.getContext("2d");t.height=e.height;t.width=e.width;o.drawImage(e,0,0);return t},r=$.Deferred(),i=new Image;i.crossOrigin="anonymous";i.onload=function(){var n,a=o(i);try{n=TC.Util.toDataUrl(a,"#ffffff",{type:t||"image/jpeg",encoderOptions:1});r.resolve(n,a)}catch(t){i.src=TC.proxify(e)}};i.onerror=function(n){var a=new XMLHttpRequest;a.open("GET",TC.proxify(e),!0);a.setRequestHeader("Content-Type","application/x-www-form-urlencoded");a.responseType="arraybuffer";a.onload=function(e){if(200===this.status){for(var n=new Uint8Array(this.response),l=n.length,s=new Array(l);l--;)s[l]=String.fromCharCode(n[l]);var p=s.join(""),c=a.getResponseHeader("content-type");if(0===c.indexOf("image")){i.src="data:"+c+";base64,"+window.btoa(p);i.onload=function(){var e=o(i);dataURL=TC.Util.toDataUrl(e,"#ffffff",{type:t||"image/jpeg",encoderOptions:1});r.resolve(dataURL,e)}}}};a.onreadystatechange=function(){4===a.readyState&&200!==a.status&&r.reject()};a.send()};i.src=e;if(i.complete||void 0===i.complete){i.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==";i.src=e}return r.promise()},imgTagToDataUrl:function(e,t){var o=function(e){var t=document.createElement("CANVAS"),o=t.getContext("2d");t.height=e.height;t.width=e.width;o.drawImage(e,0,0);return t}(e);try{return{base64:TC.Util.toDataUrl(o,"#ffffff",{type:t||"image/jpeg",encoderOptions:1}),canvas:o}}catch(e){return null}},addToCanvas:function(e,t,o){var r=TC.Util.cloneCanvas(e),i=$.Deferred(),n=r.getContext("2d"),a=new Image;t.crossOrigin="anonymous";a.src=t;a.onload=function(){n.drawImage(a,o.x||0,o.y||0);i.resolve(r)};return i.promise()},cloneCanvas:function(e){var t=document.createElement("canvas"),o=t.getContext("2d");t.width=e.width;t.height=e.height;o.drawImage(e,0,0);return t},calculateAspectRatioFit:function(e,t,o,r){var i=Math.min(o/e,r/t);return{width:e*i,height:t*i}},getFormattedDate:function(e,t){function o(e){return e<10?"0"+e:e}var r=new Date(e);return[r.getFullYear(),o(r.getMonth()+1),o(r.getDate())].concat(t?["_",o(r.getHours()),o(r.getMinutes()),o(r.getSeconds())]:[]).join("")},replaceAccent:function(e){var t={"\xe4":"a","\xf6":"o","\xfc":"u","\xc4":"A","\xd6":"O","\xdc":"U","\xe1":"a","\xe9":"e",i:"i","\xf3":"o","\xfa":"u","\xc1":"A","\xc9":"E","\xcd":"I","\xd3":"O","\xda":"U","\xf1":"n","\xd1":"N"};return e.replace(/[\xf6\xe4\xfc\xd6\xc4\xdc\xe1\xe9\xed\xf3\xfa\xc1\xc9\xcd\xd3\xda\xf1\xd1]/g,function(e){return t[e]})},downloadFileForm:function(e,t){var o=function(e,t){var o=$("<form/>",{class:"tc-ctl-download-form",method:"post",enctype:"text/plain",action:TC.Util.detectIE()?TC.proxify(e):e}),r=$("<input/>",{class:"tc-ctl-download-query",name:t.substring(0,t.indexOf("="))});o.append(r);var i=$("iframe").filter(function(t,o){return $(o).data("url-download")===e});if(i.length>0)i=i.first();else{(i=$('<iframe style="visibility: hidden; display:none;"></iframe>')).data("url-download",e);$("body").append(i)}var n=i[0].contentDocument;n.open();n.write(o[0].outerHTML);n.close();$("input",n).val(t.substring(t.indexOf("=")+1));return o=$("form",n)},r=[];if(jQuery.isArray(e))for(var i=e,n=0;n<i.length;n++)r.push(o(i[n].url,i[n].data));else r.push(o(e,t));$(r).submit();setTimeout(function(){$(".tc-ctl-download-form").remove()},1e3)},WFSQueryBuilder:function(e,t,o,r,i){$.isArray(e)||(e=[e]);var n='xsi:schemaLocation="http://www.opengis.net/wfs http://schemas.opengis.net/wfs/1.1.0/wfs.xsd" xmlns:ogc="http://www.opengis.net/ogc" service="WFS" {resultType} {format} ';switch(o.version){case"1.0.0":case"1.1.0":n+='xmlns:gml="http://www.opengis.net/gml" xmlns:wfs="http://www.opengis.net/wfs" ';break;case"2.0.0":n+='xmlns:wfs="http://www.opengis.net/wfs/2.0" xmlns:gml="http://www.opengis.net/gml/3.2" '}for(var a in o)"string"==typeof o[a]&&a.indexOf("gml")<0&&o[a].indexOf("wfs")<0&&(n+=a+'="'+o[a]+'" ');var l="<wfs:GetFeature "+n.format({resultType:i?'resultType="hits"':"",format:'outputFormat="'+r+'"'})+">",s="",p="<wfs:Query typeName"+("2.0.0"===o.version?"s":"")+'="{typeName}">{filter}</wfs:Query>';$.each(e,function(e,r){s+=p.format({typeName:r,filter:t?t.getText(o.version):""})});return l+=s+"</wfs:GetFeature>"},WFSFilterBuilder:function(e,t){var o="";if(jQuery.isPlainObject(e))o='<{prefix}:Filter><{prefix}:Intersects><fes:ValueReference></fes:ValueReference><{prefix}:Function name="querySingle"><{prefix}:Literal>{clipLayer}</{prefix}:Literal><{prefix}:Literal>{geometryName}</{prefix}:Literal><{prefix}:Literal>{where}</{prefix}:Literal></{prefix}:Function></{prefix}:Intersects></{prefix}:Filter>'.format({prefix:"2.0.0"===t?"fes":"ogc",clipLayer:e.clipLayer,geometryName:e.geometryName,where:e.where});else switch(!0){case!e:break;case $.isArray(e):var r="<gml:Envelope><gml:lowerCorner>{lowerCorner}</gml:lowerCorner><gml:upperCorner>{upperCorner}</gml:upperCorner></gml:Envelope>".format({lowerCorner:e[0]+" "+e[1],upperCorner:e[2]+" "+e[3]});switch(!0){case"1.0.0"===t:case"1.1.0"===t:o+="<ogc:Filter><ogc:BBOX>"+r+"</ogc:BBOX></ogc:Filter>";break;case"2.0.0"===t:o+="<fes:Filter><fes:BBOX>"+r+"</fes:BBOX></fes:Filter>"}break;case e instanceof TC.Feature:switch(!0){case"1.0.0"===t:case"1.1.0"===t:o+="<ogc:Filter><ogc:Intersects><ogc:PropertyName></ogc:PropertyName>"+TC.Util.writeGMLGeometry(e,"2.0")+"</ogc:Intersects></ogc:Filter>";break;case"2.0.0"===t:o+="<fes:Filter><fes:Intersects><fes:ValueReference></fes:ValueReference>"+TC.Util.writeGMLGeometry(e,"3.2")+"</fes:Intersects></fes:Filter>"}break;default:TC.error("Geometr\xeda no v\xe1lida")}return o},writeGMLGeometry:function(e,t){var o=function(e){var o;if(0===t.indexOf("3")){o=e.toString();for(;o.indexOf(",")>=0;)o=o.replace(","," ")}else{o=e;jQuery.each(o,function(e,t){return t.join(",")}).join(" ")}return o};switch(t){case"3.1.1":break;case"3.2":switch(!0){case TC.feature.Polyline&&e instanceof TC.feature.Polyline:return'<gml:LineString srsDimension="2"><gml:posList>'+o(e.geometry)+"</gml:posList></gml:LineString>";default:return'<gml:Polygon srsDimension="2"><gml:exterior><gml:LinearRing><gml:posList>'+o(e.geometry[0])+"</gml:posList></gml:LinearRing></gml:exterior></gml:Polygon>"}break;case"2.0":default:switch(!0){case TC.feature.Polyline&&e instanceof TC.feature.Polyline:return"<gml:LineString><gml:coordinates>"+o(e.geometry[0])+"</gml:coordinates></gml:LineString>";default:return"<gml:Polygon><gml:outerBoundaryIs><gml:LinearRing><gml:coordinates>"+o(e.geometry[0])+"</gml:coordinates></gml:LinearRing></gml:outerBoundaryIs></gml:Polygon>"}}},isServiceWorker:function(){return!!navigator.serviceWorker&&!(!navigator.serviceWorker.controller||"activated"!==navigator.serviceWorker.controller.state)},isSameOriginByLocation:function(e,t){var o=0!==e.indexOf("http")&&0!==e.indexOf("//"),r=!o&&e.match(TC.Consts.url.SPLIT_REGEX);if(r){var i=r[1];o=(i==t.protocol||void 0==i)&&r[3]==t.hostname;var n=r[4],a=t.port;(80!=n&&""!==n||"80"!=a&&""!==a)&&(o=o&&n==a)}return o},isSameProtocol:function(e,t){if(e.match(/^(\/\/)/i))return!0;var o=/^(https?:\/\/)/i,r=e.match(o);if(r&&r.length>1){var i=t.match(o);if(i&&i.length>1)return r[0].trim()===i[0].trim()}return!1},consoleRegister:function(e){TC.isDebug&&console.log(e)},getSorterByProperty:function(e){return function(t,o){return t[e]>o[e]?1:t[e]<o[e]?-1:0}},getSoundexDifference:function(e,t){for(var o=0,r=0;r<e.length;r++)e.charAt(r)==t.charAt(r)&&o++;return o},toAbsolutePath:function(e){var t=document.createElement("a");t.href=e;return t.href}};String.prototype.format=function(){var e=this.toString();if(!arguments.length)return e;var t="string"==(t=typeof arguments[0])||"number"==t?arguments:arguments[0];for(arg in t)e=e.replace(RegExp("\\{"+arg+"\\}","gi"),t[arg]);return e};return p});loadjs=function(){var e=function(){},t={},o={},r={};function i(e,t){if(e){var i=r[e];if(o[e]=t,i)for(;i.length;)i[0](e,t),i.splice(0,1)}}function n(t,o){t.call&&(t={success:t}),o.length?(t.error||e)(o):(t.success||e)(t)}function a(t,o,r,i){var n,l,s=document,p=r.async,c=(r.numRetries||0)+1,u=r.before||e;i=i||0,/(^css!|\.css$)/.test(t)?(n=!0,(l=s.createElement("link")).rel="stylesheet",l.href=t.replace(/^css!/,"")):((l=s.createElement("script")).src=t,l.async=void 0===p||p),l.onload=l.onerror=l.onbeforeload=function(e){var s=e.type[0];if(n&&"hideFocus"in l)try{l.sheet.cssText.length||(s="e")}catch(e){s="e"}if("e"==s&&(i+=1)<c)return a(t,o,r,i);o(t,s,e.defaultPrevented)},!1!==u(t,l)&&s.head.appendChild(l)}function l(e,o,r){var l,s;if(o&&o.trim&&(l=o),s=(l?r:o)||{},l){if(l in t)throw"LoadJS";t[l]=!0}!function(e,t,o){var r,i,n=(e=e.push?e:[e]).length,l=n,s=[];for(r=function(e,o,r){if("e"==o&&s.push(e),"b"==o){if(!r)return;s.push(e)}--n||t(s)},i=0;i<l;i++)a(e[i],r,o)}(e,function(e){n(s,e),i(l,e)},s)}return l.ready=function(e,t){return function(e,t){var i,n,a,l=[],s=(e=e.push?e:[e]).length,p=s;for(i=function(e,o){o.length&&l.push(e),--p||t(l)};s--;)n=e[s],(a=o[n])?i(n,a):(r[n]=r[n]||[]).push(i)}(e,function(e){n(t,e)}),l},l.done=function(e){i(e,[])},l.reset=function(){t={},o={},r={}},l.isDefined=function(e){return e in t},l}();var TC=TC||{};TC.version="1.5.1";!function(){if(!TC.apiLocation){var e;if(document.currentScript)e=document.currentScript;else{var t=document.getElementsByTagName("script");e=t[t.length-1]}var o=e.getAttribute("src");TC.apiLocation=o.substr(0,o.lastIndexOf("/")+1)}}();if(!TC.Consts){TC.Consts={};TC.Consts.OLNS_LEGACY="OpenLayers";TC.Consts.OLNS="ol";TC.Consts.PROJ4JSOBJ_LEGACY="Proj4js";TC.Consts.PROJ4JSOBJ="proj4";TC.Consts.GEOGRAPHIC="geographic";TC.Consts.UTM="UTM";TC.Consts.OLD_BROWSER_ALERT="TC.oldBrowserAlert";TC.Consts.CLUSTER_ANIMATION_DURATION=200;TC.Consts.ZOOM_ANIMATION_DURATION=300;TC.Consts.URL_MAX_LENGTH=2048;TC.Consts.METER_PRECISION=0;TC.Consts.DEGREE_PRECISION=5;TC.Consts.EXTENT_TOLERANCE=.9998;TC.Consts.url={SPLIT_REGEX:/([^:]*:)?\/\/([^:]*:?[^@]*@)?([^:\/\?]*):?([^\/\?]*)/,MODERNIZR:"lib/modernizr.js",JQUERY_LEGACY:TC.apiLocation+"lib/jquery/jquery.1.10.2.js",JQUERY:"//ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.js",OL_LEGACY:"lib/OpenLayers/OpenLayers.sitna.js",OL:"lib/ol/build/ol-custom.js",OL_CONNECTOR_LEGACY:"TC/ol/ol2.js",OL_CONNECTOR:"TC/ol/ol.js",TEMPLATING:"lib/dust/dust-full-helpers.min.js",TEMPLATING_I18N:"lib/dust/dustjs-i18n.min.js",TEMPLATING_OVERRIDES:"lib/dust/dust.overrides.js",PROJ4JS_LEGACY:"lib/proj4js/legacy/proj4js-compressed.js",PROJ4JS:"lib/proj4js/proj4-src.js",EPSG:"https://epsg.io/",LOCALFORAGE:TC.apiLocation+"lib/localForage/localforage.min.js",D3C3:TC.apiLocation+"lib/d3c3/d3c3.min.js",CESIUM:TC.apiLocation+"lib/cesium/release/Cesium.js",JSNLOG:"lib/jsnlog/jsnlog.min.js",ERROR_LOGGER:TC.apiLocation+"errors/logger.ashx",PDFMAKE:TC.apiLocation+"lib/pdfmake/pdfmake-fonts.min.js",JSONPACK:"lib/jsonpack/jsonpack.min.js",UA_PARSER:"lib/ua-parser/ua-parser.min.js",HASH:"lib/jshash/md5-min.js",URL_POLYFILL:"lib/polyfill/url.js"};TC.Consts.classes={MAP:"tc-map",POINT:"tc-point",MARKER:"tc-marker",VISIBLE:"tc-visible",HIDDEN:"tc-hidden",COLLAPSED:"tc-collapsed",CHECKED:"tc-checked",DISABLED:"tc-disabled",ACTIVE:"tc-active",DEFAULT:"tc-default",LASTCHILD:"tc-lastchild",TRANSPARENT:"tc-transparent",DROP:"tc-drop",LOADING:"tc-loading",IPAD_IOS7_FIX:"tc-ipad-ios7-fix",INFO:"tc-msg-info",WARNING:"tc-msg-warning",ERROR:"tc-msg-error"};TC.Consts.msgType={INFO:"info",WARNING:"warning",ERROR:"error"};TC.Consts.msgErrorMode={TOAST:"toast",CONSOLE:"console",EMAIL:"email"};TC.Consts.event={MAPLOAD:"mapload.tc",MAPREADY:"mapready.tc",BEFORELAYERADD:"beforelayeradd.tc",LAYERADD:"layeradd.tc",LAYERREMOVE:"layerremove.tc",LAYERORDER:"layerorder.tc",BEFORELAYERUPDATE:"beforelayerupdate.tc",LAYERUPDATE:"layerupdate.tc",LAYERERROR:"layererror.tc",BEFOREBASELAYERCHANGE:"beforebaselayerchange.tc",BASELAYERCHANGE:"baselayerchange.tc",BEFOREUPDATE:"beforeupdate.tc",UPDATE:"update.tc",BEFOREZOOM:"beforezoom.tc",ZOOM:"zoom.tc",BEFOREUPDATEPARAMS:"beforeupdateparams.tc",UPDATEPARAMS:"updateparams.tc",VECTORUPDATE:"vectorupdate.tc",FEATUREADD:"featureadd.tc",BEFOREFEATURESADD:"beforefeaturesadd.tc",FEATURESADD:"featuresadd.tc",FEATUREREMOVE:"featureremove.tc",FEATURESCLEAR:"featuresclear.tc",FEATURESIMPORT:"featuresimport.tc",FEATURESIMPORTERROR:"featuresimporterror.tc",BEFORETILELOAD:"beforetileload.tc",TILELOAD:"tileload.tc",TILELOADERROR:"tileloaderror.tc",CONTROLADD:"controladd.tc",CONTROLACTIVATE:"controlactivate.tc",CONTROLDEACTIVATE:"controldeactivate.tc",BEFORECONTROLRENDER:"beforecontrolrender.tc",CONTROLRENDER:"controlrender.tc",BEFORELAYOUTLOAD:"beforelayoutload.tc",LAYOUTLOAD:"layoutload.tc",LAYERVISIBILITY:"layervisibility.tc",LAYEROPACITY:"layeropacity.tc",FEATURECLICK:"featureclick.tc",NOFEATURECLICK:"nofeatureclick.tc",FEATUREOVER:"featureover.tc",FEATUREOUT:"featureout.tc",BEFOREFEATUREINFO:"beforefeatureinfo.tc",FEATUREINFO:"featureinfo.tc",NOFEATUREINFO:"nofeatureinfo.tc",FEATUREINFOERROR:"featureinfoerror.tc",CLICK:"click.tc",MOUSEUP:"mouseup.tc",MOUSEMOVE:"mousemove.tc",MOUSELEAVE:"mouseleave.tc",STARTLOADING:"startloading.tc",STOPLOADING:"stoploading.tc",EXTERNALSERVICEADDED:"externalserviceadded.tc",ZOOMTO:"zoomto.tc",PROJECTIONCHANGE:"projectionchange.tc",VIEWCHANGE:"viewchange.tc",TERRAINPROVIDERADD:"terrainprovideradd.tc",TERRAINPROVIDERREMOVE:"terrainproviderremove.tc"};TC.Consts.layer={IDENA_ORTHOPHOTO:"ortofoto",IDENA_BASEMAP:"mapabase",IDENA_CADASTER:"catastro",IDENA_CARTO:"cartografia",IDENA_ORTHOPHOTO2014:"ortofoto2014",IDENA_ORTHOPHOTO2012:"ortofoto2012",IDENA_DYNBASEMAP:"mapabase_dinamico",IDENA_DYNORTHOPHOTO:"ortofoto_dinamico",IDENA_DYNORTHOPHOTO2014:"ortofoto2014_dinamico",IDENA_DYNORTHOPHOTO2012:"ortofoto2012_dinamico",IDENA_DYNCARTO:"cartografia_dinamico",IDENA_BW_RELIEF:"relieve_bn",IDENA_BASEMAP_ORTHOPHOTO:"base_orto",IGN_ES_CARTO:"ign-raster",IGN_ES_BASEMAP:"ign-base",IGN_ES_RELIEF:"ign-mtn",IGN_ES_ORTHOPHOTO:"ign-pnoa",IGN_ES_DYNCARTO:"ign-raster-dyn",IGN_ES_DYNBASEMAP:"ign-base-dyn",IGN_ES_DYNRELIEF:"ign-mtn-dyn",IGN_ES_DYNORTHOPHOTO:"ign-pnoa-dyn",IGN_FR_CARTO:"ign-fr-cartes",IGN_FR_BASEMAP:"ign-fr-base",IGN_FR_RELIEF:"ign-fr-estompage",IGN_FR_ORTHOPHOTO:"ign-fr-orto",IGN_FR_DYNCARTO:"ign-fr-cartes-dyn",IGN_FR_DYNBASEMAP:"ign-fr-base-dyn",IGN_FR_DYNRELIEF:"ign-fr-estompage-dyn",IGN_FR_DYNORTHOPHOTO:"ign-fr-orto-dyn",OSM:"osm",CARTO_VOYAGER:"carto_voyager",CARTO_LIGHT:"carto_light",CARTO_DARK:"carto_dark",MAPBOX_STREETS:"mapbox_streets",MAPBOX_SATELLITE:"mapbox_satellite",BLANK:"ninguno"};TC.Consts.text={API_ERROR:"Error API SITNA",APP_ERROR:"Error de aplicaci\xf3n"};TC.Consts.layerType={WMS:"WMS",WMTS:"WMTS",WFS:"WFS",VECTOR:"vector",KML:"KML",GPX:"GPX",GML:"GML",GEOJSON:"GeoJSON",GROUP:"group"};TC.Consts.geom={POINT:"point",MULTIPOINT:"multipoint",POLYLINE:"polyline",POLYGON:"polygon",MULTIPOLYLINE:"multipolyline",MULTIPOLYGON:"multipolygon",CIRCLE:"circle",RECTANGLE:"rectangle"};TC.Consts.searchType={CADASTRAL:"cadastral",COORDINATES:"coordinates",MUNICIPALITY:"municipality",COUNCIL:"council",LOCALITY:"locality",STREET:"street",NUMBER:"number",URBAN:"urban",COMMONWEALTH:"commonwealth",ROAD:"road",ROADPK:"roadpk",PLACENAME:"placename",PLACENAMEMUNICIPALITY:"placenamemunicipality"};TC.Consts.mapSearchType={MUNICIPALITY:TC.Consts.searchType.MUNICIPALITY,COUNCIL:TC.Consts.searchType.COUNCIL,URBAN:TC.Consts.searchType.URBAN,COMMONWEALTH:TC.Consts.searchType.COMMONWEALTH,GENERIC:"generic"};TC.Consts.comparison={EQUAL_TO:"==",NOT_EQUAL_TO:"!=",LESS_THAN:"<",GREATER_THAN:">",LESS_THAN_EQUAL_TO:"=<",GREATER_THAN_EQUAL_TO:">=",LIKE:"is"};TC.Consts.logicalOperator={AND:"and",OR:"or"};TC.Consts.WMTSEncoding={KVP:"KVP",RESTFUL:"RESTful"};TC.Consts.mimeType={PNG:"image/png",JPEG:"image/jpeg",JSON:"application/json",GEOJSON:"application/vnd.geo+json",KML:"application/vnd.google-earth.kml+xml",GML:"application/gml+xml",GPX:"application/gpx+xml",XML:"application/xml"};TC.Consts.format={JSON:"JSON",KML:"KML",GML:"GML",GML2:"GML2",GML3:"GML2",GEOJSON:"GeoJSON",TOPOJSON:"TopoJSON",GPX:"GPX",WKT:"WKT"};TC.Consts.WFSErrors={GetFeatureNotAvailable:"GetFeatureNotAvailable",LayersNotAvailable:"LayersNotAvailable",NoLayers:"NoLayers",NoValidLayers:"noValidLayers",QueryNotAvailable:"QueryNotAvailable",CapabilitiesParseError:"CapabilitiesParseError",NumMaxFeatures:"NumMaxFeatures",GetCapabilities:"GetCapabilities",Indeterminate:"Indeterminate",NoFeatures:"NoFeatures"};TC.Consts.visibility={NOT_VISIBLE:0,NOT_VISIBLE_AT_RESOLUTION:1,HAS_VISIBLE:2,VISIBLE:4};TC.Consts.MARKER="marker";TC.Defaults=function(){var e={};return{imageRatio:1.05,proxy:"",crs:"EPSG:25830",utmCrs:"EPSG:25830",geoCrs:"EPSG:4326",initialExtent:[541084.221,4640788.225,685574.4632,4796618.764],maxExtent:!1,baselayerExtent:[480408,4599748,742552,4861892],resolutions:[1024,512,256,128,64,32,16,8,4,2,1,.5,.25],pointBoundsRadius:30,extentMargin:.2,mouseWheelZoom:!0,attribution:'<a href="http://sitna.navarra.es/" target="_blank">SITNA</a>',oldBrowserAlert:!0,notifyApplicationErrors:!1,loggingErrorsEnabled:!0,maxErrorCount:10,layoutURLParamName:"layout",titleURLParamName:"title",locale:"es-ES",screenSize:20,pixelTolerance:10,maxResolutionError:.01,toastDuration:5e3,avgTileSize:31e3,availableBaseLayers:[{id:TC.Consts.layer.IDENA_BASEMAP,title:"Mapa base",type:TC.Consts.layerType.WMTS,url:"//idena.navarra.es/ogc/wmts/",matrixSet:"epsg25830extended",layerNames:"mapabase",encoding:TC.Consts.WMTSEncoding.RESTFUL,format:"image/png",isDefault:!0,hideTree:!0,thumbnail:TC.apiLocation+"TC/css/img/thumb-basemap.png",fallbackLayer:TC.Consts.layer.IDENA_DYNBASEMAP,overviewMapLayer:TC.Consts.layer.IDENA_BASEMAP},{id:TC.Consts.layer.IDENA_ORTHOPHOTO,title:"Ortofoto 2017",type:TC.Consts.layerType.WMTS,url:"//idena.navarra.es/ogc/wmts/",matrixSet:"epsg25830",layerNames:"ortofoto2017",encoding:TC.Consts.WMTSEncoding.RESTFUL,format:"image/jpeg",isDefault:!1,hideTree:!0,thumbnail:TC.apiLocation+"TC/css/img/thumb-orthophoto.jpg",fallbackLayer:TC.Consts.layer.IDENA_DYNORTHOPHOTO,overviewMapLayer:TC.Consts.layer.IDENA_BASEMAP},{id:TC.Consts.layer.IDENA_ORTHOPHOTO2014,title:"Ortofoto 2014",type:TC.Consts.layerType.WMTS,url:"//idena.navarra.es/ogc/wmts/",matrixSet:"epsg25830reduced",layerNames:"ortofoto2014",encoding:TC.Consts.WMTSEncoding.RESTFUL,format:"image/jpeg",isDefault:!1,hideTree:!0,thumbnail:TC.apiLocation+"TC/css/img/thumb-ortho2014.jpg",fallbackLayer:TC.Consts.layer.IDENA_DYNORTHOPHOTO2014,overviewMapLayer:TC.Consts.layer.IDENA_BASEMAP},{id:TC.Consts.layer.IDENA_ORTHOPHOTO2012,title:"Ortofoto 2012",type:TC.Consts.layerType.WMTS,url:"//idena.navarra.es/ogc/wmts/",matrixSet:"epsg25830",layerNames:"ortofoto2012",encoding:TC.Consts.WMTSEncoding.RESTFUL,format:"image/jpeg",isDefault:!1,hideTree:!0,thumbnail:TC.apiLocation+"TC/css/img/thumb-ortho2012.jpg",fallbackLayer:TC.Consts.layer.IDENA_DYNORTHOPHOTO2012,overviewMapLayer:TC.Consts.layer.IDENA_BASEMAP},{id:TC.Consts.layer.IDENA_CARTO,title:"Cartograf\xeda topogr\xe1fica",type:TC.Consts.layerType.WMTS,url:"//idena.navarra.es/ogc/wmts/",matrixSet:"epsg25830",layerNames:"mapaTopografico",encoding:TC.Consts.WMTSEncoding.RESTFUL,format:"image/png",isDefault:!1,hideTree:!0,thumbnail:TC.apiLocation+"TC/css/img/thumb-bta.png",fallbackLayer:TC.Consts.layer.IDENA_DYNCARTO,overviewMapLayer:TC.Consts.layer.IDENA_BASEMAP},{id:TC.Consts.layer.IDENA_CADASTER,title:"Catastro",type:TC.Consts.layerType.WMS,url:"//idena.navarra.es/ogc/wms",layerNames:"catastro,regionesFronterizas",format:"image/png",isDefault:!1,hideTree:!0,thumbnail:TC.apiLocation+"TC/css/img/thumb-cadaster.png",overviewMapLayer:TC.Consts.layer.IDENA_BASEMAP},{id:TC.Consts.layer.IDENA_BW_RELIEF,title:"Relieve",type:TC.Consts.layerType.WMS,url:"//idena.navarra.es/ogc/wms",layerNames:"IDENA:mapa_relieve_bn",format:"image/jpeg",isDefault:!1,hideTree:!0,thumbnail:TC.apiLocation+"TC/css/img/thumb-relief_bw.jpg",overviewMapLayer:TC.Consts.layer.IDENA_BASEMAP},{id:TC.Consts.layer.IDENA_BASEMAP_ORTHOPHOTO,title:"Mapa base/ortofoto",type:TC.Consts.layerType.WMS,url:"//idena.navarra.es/ogc/wms",layerNames:"mapaBase_orto",format:"image/jpeg",isDefault:!1,hideTree:!0,thumbnail:TC.apiLocation+"TC/css/img/thumb-base_ortho.png",overviewMapLayer:TC.Consts.layer.IDENA_BASEMAP},{id:TC.Consts.layer.IDENA_DYNBASEMAP,title:"Mapa base",type:TC.Consts.layerType.WMS,url:"//idena.navarra.es/ogc/wms",layerNames:"mapaBase,regionesFronterizas",format:"image/jpeg",isDefault:!1,hideTree:!0,thumbnail:TC.apiLocation+"TC/css/img/thumb-basemap.png",overviewMapLayer:TC.Consts.layer.IDENA_DYNBASEMAP},{id:TC.Consts.layer.IDENA_DYNORTHOPHOTO,title:"Ortofoto",type:TC.Consts.layerType.WMS,url:"//idena.navarra.es/ogc/wms",layerNames:"ortofoto_maxima_actualidad",format:"image/jpeg",isDefault:!1,hideTree:!0,thumbnail:TC.apiLocation+"TC/css/img/thumb-orthophoto.jpg",overviewMapLayer:TC.Consts.layer.IDENA_DYNBASEMAP},{id:TC.Consts.layer.IDENA_DYNORTHOPHOTO2014,title:"Ortofoto 2014",type:TC.Consts.layerType.WMS,url:"//idena.navarra.es/ogc/wms",layerNames:"ortofoto_5000_2014",format:"image/jpeg",isDefault:!1,hideTree:!0,thumbnail:TC.apiLocation+"TC/css/img/thumb-ortho2014.jpg",overviewMapLayer:TC.Consts.layer.IDENA_DYNBASEMAP},{id:TC.Consts.layer.IDENA_DYNORTHOPHOTO2012,title:"Ortofoto 2012",type:TC.Consts.layerType.WMS,url:"//idena.navarra.es/ogc/wms",layerNames:"ortofoto_5000_2012",format:"image/jpeg",isDefault:!1,hideTree:!0,thumbnail:TC.apiLocation+"TC/css/img/thumb-ortho2012.jpg",overviewMapLayer:TC.Consts.layer.IDENA_DYNBASEMAP},{id:TC.Consts.layer.IDENA_DYNCARTO,title:"Cartograf\xeda topogr\xe1fica",type:TC.Consts.layerType.WMS,url:"//idena.navarra.es/ogc/wms",layerNames:"MTNa5_BTA",format:"image/png",isDefault:!1,hideTree:!0,thumbnail:TC.apiLocation+"TC/css/img/thumb-bta.png",overviewMapLayer:TC.Consts.layer.IDENA_DYNBASEMAP},{id:TC.Consts.layer.IGN_ES_CARTO,type:TC.Consts.layerType.WMTS,title:"Cartograf\xeda raster \r\n (IGN ES)",url:"//www.ign.es/wmts/mapa-raster",encoding:TC.Consts.WMTSEncoding.KVP,layerNames:"MTN",matrixSet:"EPSG:25830",format:"image/jpeg",thumbnail:TC.apiLocation+"tc/css/img/thumb-carto_ign.png",fallbackLayer:TC.Consts.layer.IGN_ES_DYNCARTO,overviewMapLayer:TC.Consts.layer.IGN_ES_BASEMAP},{id:TC.Consts.layer.IGN_ES_BASEMAP,title:"Mapa base \r\n (IGN ES)",type:TC.Consts.layerType.WMTS,url:"//www.ign.es/wmts/ign-base",encoding:TC.Consts.WMTSEncoding.KVP,layerNames:"IGNBaseTodo",matrixSet:"EPSG:25830",format:"image/jpeg",thumbnail:TC.apiLocation+"tc/css/img/thumb-basemap_ign.png",fallbackLayer:TC.Consts.layer.IGN_ES_DYNBASEMAP,overviewMapLayer:TC.Consts.layer.IGN_ES_BASEMAP},{id:TC.Consts.layer.IGN_ES_RELIEF,title:"Relieve \r\n (IGN ES)",type:TC.Consts.layerType.WMTS,url:"//servicios.idee.es/wmts/mdt",encoding:TC.Consts.WMTSEncoding.KVP,layerNames:"Relieve",matrixSet:"EPSG:25830",format:"image/jpeg",thumbnail:TC.apiLocation+"tc/css/img/thumb-relief_ign.jpg",fallbackLayer:TC.Consts.layer.IGN_ES_DYNRELIEF,overviewMapLayer:TC.Consts.layer.IGN_ES_BASEMAP},{id:TC.Consts.layer.IGN_ES_ORTHOPHOTO,title:"Ortofoto PNOA",type:TC.Consts.layerType.WMTS,url:"//www.ign.es/wmts/pnoa-ma",encoding:TC.Consts.WMTSEncoding.KVP,layerNames:"OI.OrthoimageCoverage",matrixSet:"EPSG:25830",format:"image/jpeg",thumbnail:TC.apiLocation+"tc/css/img/thumb-orthophoto_pnoa.jpg",fallbackLayer:TC.Consts.layer.IGN_ES_DYNORTHOPHOTO,overviewMapLayer:TC.Consts.layer.IGN_ES_BASEMAP},{id:TC.Consts.layer.IGN_ES_DYNBASEMAP,title:"Mapa base \r\n (IGN ES)",type:TC.Consts.layerType.WMS,url:"//www.ign.es/wms-inspire/ign-base",layerNames:"IGNBaseTodo",thumbnail:TC.apiLocation+"TC/css/img/thumb-basemap_ign.png",overviewMapLayer:TC.Consts.layer.IGN_ES_BASEMAP},{id:TC.Consts.layer.IGN_ES_DYNORTHOPHOTO,title:"Ortofoto \r\n (IGN ES)",type:TC.Consts.layerType.WMS,url:"//www.ign.es/wms-inspire/pnoa-ma",layerNames:"OI.OrthoimageCoverage",thumbnail:TC.apiLocation+"TC/css/img/thumb-orthophoto_pnoa.jpg",overviewMapLayer:TC.Consts.layer.IGN_ES_BASEMAP},{id:TC.Consts.layer.IGN_ES_DYNCARTO,title:"Cartograf\xeda topogr\xe1fica \r\n (IGN ES)",type:TC.Consts.layerType.WMS,url:"//www.ign.es/wms-inspire/mapa-raster",layerNames:"mtn_rasterizado",thumbnail:TC.apiLocation+"TC/css/img/thumb-carto_ign.png",overviewMapLayer:TC.Consts.layer.IGN_ES_BASEMAP},{id:TC.Consts.layer.IGN_ES_DYNRELIEF,title:"Relieve \r\n (IGN ES)",type:TC.Consts.layerType.WMS,url:"//servicios.idee.es/wms-inspire/mdt",layerNames:"relieve",thumbnail:TC.apiLocation+"TC/css/img/thumb-relief_ign.jpg",overviewMapLayer:TC.Consts.layer.IGN_ES_BASEMAP},{id:TC.Consts.layer.IGN_FR_CARTO,title:"Cartograf\xeda raster \r\n (IGN FR)",type:TC.Consts.layerType.WMTS,url:"//wxs.ign.fr/njfzwf3vgc55gekk8ra4zezx/wmts",encoding:TC.Consts.WMTSEncoding.KVP,layerNames:"GEOGRAPHICALGRIDSYSTEMS.MAPS",matrixSet:"PM",format:"image/jpeg",thumbnail:TC.apiLocation+"tc/css/img/thumb-carto-fr-ign.png",fallbackLayer:TC.Consts.layer.IGN_FR_DYNCARTO,ignoreProxification:!0,overviewMapLayer:TC.Consts.layer.IGN_FR_BASEMAP},{id:TC.Consts.layer.IGN_FR_BASEMAP,title:"Mapa base \r\n (IGN FR)",type:TC.Consts.layerType.WMTS,url:"//wxs.ign.fr/njfzwf3vgc55gekk8ra4zezx/wmts",encoding:TC.Consts.WMTSEncoding.KVP,layerNames:"GEOGRAPHICALGRIDSYSTEMS.PLANIGN",matrixSet:"PM",format:"image/jpeg",thumbnail:TC.apiLocation+"tc/css/img/thumb-base-fr-ign.jpg",fallbackLayer:TC.Consts.layer.IGN_FR_DYNBASEMAP,ignoreProxification:!0,overviewMapLayer:TC.Consts.layer.IGN_FR_BASEMAP},{id:TC.Consts.layer.IGN_FR_RELIEF,title:"Relieve \r\n (IGN FR)",type:TC.Consts.layerType.WMTS,url:"//wxs.ign.fr/njfzwf3vgc55gekk8ra4zezx/wmts",encoding:TC.Consts.WMTSEncoding.KVP,layerNames:"ELEVATION.ELEVATIONGRIDCOVERAGE.SHADOW",matrixSet:"PM",format:"image/png",thumbnail:TC.apiLocation+"tc/css/img/thumb-estom-fr-ign.png",fallbackLayer:TC.Consts.layer.IGN_FR_DYNRELIEF,ignoreProxification:!0,overviewMapLayer:TC.Consts.layer.IGN_FR_BASEMAP},{id:TC.Consts.layer.IGN_FR_ORTHOPHOTO,title:"Ortofoto \r\n (IGN FR)",type:TC.Consts.layerType.WMTS,url:"//wxs.ign.fr/njfzwf3vgc55gekk8ra4zezx/wmts",encoding:TC.Consts.WMTSEncoding.KVP,layerNames:"ORTHOIMAGERY.ORTHOPHOTOS",matrixSet:"PM",format:"image/jpeg",thumbnail:TC.apiLocation+"tc/css/img/thumb-ortho-fr-ign.jpg",fallbackLayer:TC.Consts.layer.IGN_FR_DYNORTHOPHOTO,ignoreProxification:!0,overviewMapLayer:TC.Consts.layer.IGN_FR_BASEMAP},{id:TC.Consts.layer.IGN_FR_DYNCARTO,title:"Cartograf\xeda raster \r\n (IGN FR)",type:TC.Consts.layerType.WMS,url:"//wxs.ign.fr/njfzwf3vgc55gekk8ra4zezx/geoportail/r/wms",layerNames:"GEOGRAPHICALGRIDSYSTEMS.MAPS",thumbnail:TC.apiLocation+"tc/css/img/thumb-carto-fr-ign.png",ignoreProxification:!0,overviewMapLayer:TC.Consts.layer.IGN_FR_BASEMAP},{id:TC.Consts.layer.IGN_FR_DYNBASEMAP,title:"Mapa base \r\n (IGN FR)",type:TC.Consts.layerType.WMS,url:"//wxs.ign.fr/njfzwf3vgc55gekk8ra4zezx/geoportail/r/wms",layerNames:"GEOGRAPHICALGRIDSYSTEMS.PLANIGN",thumbnail:TC.apiLocation+"tc/css/img/thumb-base-fr-ign.jpg",ignoreProxification:!0,overviewMapLayer:TC.Consts.layer.IGN_FR_BASEMAP},{id:TC.Consts.layer.IGN_FR_DYNRELIEF,title:"Relieve \r\n (IGN FR)",type:TC.Consts.layerType.WMS,url:"//wxs.ign.fr/njfzwf3vgc55gekk8ra4zezx/geoportail/r/wms",layerNames:"ELEVATION.ELEVATIONGRIDCOVERAGE.SHADOW",thumbnail:TC.apiLocation+"tc/css/img/thumb-estom-fr-ign.png",ignoreProxification:!0,overviewMapLayer:TC.Consts.layer.IGN_FR_BASEMAP},{id:TC.Consts.layer.IGN_FR_DYNORTHOPHOTO,title:"Ortofoto \r\n (IGN FR)",type:TC.Consts.layerType.WMS,url:"//wxs.ign.fr/njfzwf3vgc55gekk8ra4zezx/geoportail/r/wms",layerNames:"HR.ORTHOIMAGERY.ORTHOPHOTOS",thumbnail:TC.apiLocation+"tc/css/img/thumb-ortho-fr-ign.jpg",ignoreProxification:!0,overviewMapLayer:TC.Consts.layer.IGN_FR_BASEMAP},{id:TC.Consts.layer.OSM,title:"OSM",type:TC.Consts.layerType.WMTS,url:TC.apiLocation+"wmts/osm/",matrixSet:"WorldWebMercatorQuad",layerNames:"osm",encoding:TC.Consts.WMTSEncoding.RESTFUL,format:"image/png",isDefault:!1,hideTree:!0,thumbnail:TC.apiLocation+"TC/css/img/thumb-osm.png",overviewMapLayer:TC.Consts.layer.OSM},{id:TC.Consts.layer.CARTO_VOYAGER,title:"CARTO Voyager",type:TC.Consts.layerType.WMTS,url:TC.apiLocation+"wmts/carto/",matrixSet:"WorldWebMercatorQuad",layerNames:"voyager",encoding:TC.Consts.WMTSEncoding.RESTFUL,format:"image/png",isDefault:!1,hideTree:!0,thumbnail:TC.apiLocation+"TC/css/img/thumb-carto-voyager.png",overviewMapLayer:TC.Consts.layer.CARTO_VOYAGER},{id:TC.Consts.layer.CARTO_LIGHT,title:"CARTO light",type:TC.Consts.layerType.WMTS,url:TC.apiLocation+"wmts/carto/",matrixSet:"WorldWebMercatorQuad",layerNames:"light_all",encoding:TC.Consts.WMTSEncoding.RESTFUL,format:"image/png",isDefault:!1,hideTree:!0,thumbnail:TC.apiLocation+"TC/css/img/thumb-carto-light.png",overviewMapLayer:TC.Consts.layer.CARTO_VOYAGER},{id:TC.Consts.layer.CARTO_DARK,title:"CARTO dark",type:TC.Consts.layerType.WMTS,url:TC.apiLocation+"wmts/carto/",matrixSet:"WorldWebMercatorQuad",layerNames:"dark_all",encoding:TC.Consts.WMTSEncoding.RESTFUL,format:"image/png",isDefault:!1,hideTree:!0,thumbnail:TC.apiLocation+"TC/css/img/thumb-carto-dark.png",overviewMapLayer:TC.Consts.layer.CARTO_VOYAGER},{id:TC.Consts.layer.MAPBOX_STREETS,title:"Mapbox Streets",type:TC.Consts.layerType.WMTS,url:TC.apiLocation+"wmts/mapbox/",matrixSet:"WorldWebMercatorQuad",layerNames:"streets",encoding:TC.Consts.WMTSEncoding.RESTFUL,format:"image/png",isDefault:!1,hideTree:!0,thumbnail:TC.apiLocation+"TC/css/img/thumb-mapbox-streets.png",overviewMapLayer:TC.Consts.layer.MAPBOX_STREETS},{id:TC.Consts.layer.MAPBOX_SATELLITE,title:"Mapbox Satellite",type:TC.Consts.layerType.WMTS,url:TC.apiLocation+"wmts/mapbox/",matrixSet:"WorldWebMercatorQuad",layerNames:"satellite",encoding:TC.Consts.WMTSEncoding.RESTFUL,format:"image/jpeg",isDefault:!1,hideTree:!0,thumbnail:TC.apiLocation+"TC/css/img/thumb-mapbox-satellite.jpg",overviewMapLayer:TC.Consts.layer.MAPBOX_STREETS},{id:TC.Consts.layer.BLANK,title:"Mapa en blanco",type:TC.Consts.layerType.VECTOR}],baseLayers:[TC.Consts.layer.IDENA_BASEMAP,TC.Consts.layer.IDENA_ORTHOPHOTO,TC.Consts.layer.IDENA_CADASTER,TC.Consts.layer.IDENA_CARTO],defaultBaseLayer:TC.Consts.layer.IDENA_BASEMAP,workLayers:[],controls:{loadingIndicator:!0,navBar:!1,scaleBar:!1,scale:!1,scaleSelector:!1,overviewMap:!1,basemapSelector:!1,attribution:!0,TOC:!1,coordinates:!0,legend:!1,popup:!1,search:{url:"//idena.navarra.es/ogc/wfs",allowedSearchTypes:{coordinates:{},municipality:{},urban:{},street:{},number:{},cadastral:{}}},measure:!1,streetView:!0,featureInfo:!0},layout:null,styles:{point:{fillColor:"#000",fillOpacity:.1,strokeColor:"#f00",strokeWidth:2,radius:6,labelOutlineWidth:2,labelOutlineColor:"#fff",labelOffset:[0,-16],fontColor:"#000",fontSize:10},marker:{classes:[TC.Consts.classes.MARKER+1,TC.Consts.classes.MARKER+2,TC.Consts.classes.MARKER+3,TC.Consts.classes.MARKER+4,TC.Consts.classes.MARKER+5],anchor:[.5,1],width:32,height:32,labelOutlineWidth:2,labelOutlineColor:"#fff",labelOffset:[0,-32],fontColor:"#000",fontSize:10},line:{strokeColor:"#f00",strokeWidth:2,labelOutlineWidth:2,labelOutlineColor:"#fff",fontColor:"#000",fontSize:10},polygon:{strokeColor:"#f00",strokeWidth:2,fillColor:"#000",fillOpacity:.3,labelOutlineWidth:2,labelOutlineColor:"#fff",fontColor:"#000",fontSize:10},cluster:{point:{fillColor:"#336",fillOpacity:.6,radius:function(t){var o=t.features.length,r=e[o];if(!r){r=2+Math.round(5*Math.sqrt(o));e[o]=r}return r},label:"${features.length}",fontColor:"#fff",fontSize:9}},selection:{point:{fillColor:"#00f",fillOpacity:.5,strokeColor:"#00f",strokeWidth:2,radius:6,labelOutlineWidth:2,labelOutlineColor:"#fff",labelOffset:[0,-16],fontColor:"#000",fontSize:10},line:{strokeColor:"#00f",strokeWidth:2,labelOutlineWidth:2,labelOutlineColor:"#fff",fontColor:"#000",fontSize:10},polygon:{strokeColor:"#00f",strokeWidth:2,fillColor:"#000",fillOpacity:.3,labelOutlineWidth:2,labelOutlineColor:"#fff",fontColor:"#000",fontSize:10}}}}}();!function(){Array.prototype.map||(Array.prototype.map=function(e){"use strict";if(void 0===this||null===this)throw new TypeError;var t=Object(this),o=t.length>>>0;if("function"!=typeof e)throw new TypeError;for(var r=new Array(o),i=arguments.length>=2?arguments[1]:void 0,n=0;n<o;n++)n in t&&(r[n]=e.call(i,t[n],n,t));return r});TC.proxify=function(e){var t=e=$.trim(e);if(TC.Cfg.proxy){var o=!1;if(TC.Cfg.proxyExceptions)for(var r=0;r<TC.Cfg.proxyExceptions.length;r++)if(e.indexOf(TC.Cfg.proxyExceptions[r])>-1){o=!0;break}if(!o&&!TC.Util.isSameOrigin(e))if("function"==typeof TC.Cfg.proxy)t=TC.Cfg.proxy(e);else{t=TC.Cfg.proxy;"http"!=e.substr(0,4)&&(t+=window.location.protocol);t+=encodeURIComponent(e)}}return t};"boolean"!=typeof TC.isDebug&&(TC.isDebug=!1);var e=function(e){var t=$("."+TC.Consts.classes.MAP).data("map");TC.error(TC.Util.getLocaleString(t.options.locale,"urlFailedToLoad",{url:e}),[TC.Consts.msgErrorMode.TOAST,TC.Consts.msgErrorMode.EMAIL],"Error al cargar "+e)};TC.syncLoadJS=function(t){var o=function(e,t){var o,r=new XMLHttpRequest;r.open("GET",e,!1);r.onreadystatechange=function(e){if(4===r.readyState)if(404===r.status){o=!1;t(!0)}else if(200!==r.status){t();o=!1}else o=r.responseText};try{r.send(null)}catch(e){o=!1;t()}return o};/(\.js|\/)$/i.test(t)||(t+=TC.isDebug?".js":".min.js");var r=o(t,function(r){if(r){e(t);return!1}return o(t,function(){e(t)})});if(r){var i=document.createElement("script");i.type="text/javascript";i.text=r;(function(){var e,t=document,o=t.getElementsByTagName("head");if(0===o.length){e=t.createElement("head");t.documentElement.insertBefore(e,document.body)}else e=o[0];return e})().appendChild(i)}};window.Modernizr||TC.syncLoadJS(TC.apiLocation+TC.Consts.url.MODERNIZR);Modernizr.touch=Modernizr.touchevents;TC.isLegacy=!1;window.jQuery||(Modernizr.canvas&&!TC.isLegacy?TC.syncLoadJS(TC.Consts.url.JQUERY):TC.syncLoadJS(TC.Consts.url.JQUERY_LEGACY));$(document).ready(function(){var e,t="Unknown library",o="OpenLayers 2",r="OpenLayers 4";if(TC.Control){e="Compiled";TC.isLegacy?window.OpenLayers&&(t=o):window.ol&&(t=r)}else{e="On demand";t=TC.isLegacy?o:r}TC.version=TC.version+" ("+e+"; "+t+"; @ "+TC.apiLocation+")"});TC.loadJSInOrder=function(e,t,o){TC.loadJS(e,t,o,!0)};TC.loadJS=function(t,o,r,i){arguments.length<4&&(i=!1);var n=$.isArray(o)?o:[o];n=n.map(function(e){return/\.js$/i.test(e)||0!==e.indexOf(TC.apiLocation)?e:e+(TC.isDebug?".js":".min.js")});if(Modernizr.canvas)t?loadjs(n,{success:function(){r()},error:function(t){e(t)},async:!i,numRetries:1}):r();else{if(t)for(var a=0;a<n.length;a++)TC.syncLoadJS(n[a]);r&&r()}};TC.loadCSS=function(t){(function(e){for(var t=!1,o=0;o<document.styleSheets.length;o++){var r=document.styleSheets[o].href;if(r){var i=r.indexOf(e);if(i>=0&&i===r.length-e.length){t=!0;break}}}return t})(t)||loadjs(t,{error:function(t){e(t)},numRetries:1})};var t={};TC.getProjectionData=function(e){var o=$.Deferred(),r=(e=e||{}).crs.substr(e.crs.indexOf(":")+1);parseInt(r)===Number.NaN&&(r=e.crs.substr(e.crs.lastIndexOf("/")+1));var i=t[r];if(i)o.resolve(i);else{var n=TC.Consts.url.EPSG+"?format=json&q="+r,a={dataType:"json",success:function(e){t[r]=e;o.resolve(e)},error:function(e){o.reject(e)}};e.sync&&(a.async=!1);$.ajax(n,a)}return o.promise()};TC.loadProjDef=function(e){const t=(e=e||{}).crs;var o;if(TC.isLegacy){window[TC.Consts.PROJ4JSOBJ_LEGACY]||TC.syncLoadJS(TC.url.proj4js);o=function(e){return Proj4js.defs[e]}}else{window[TC.Consts.PROJ4JSOBJ]||TC.syncLoadJS(TC.url.proj4js);o=function(e){return proj4.defs(e)}}window.Proj4js||(window.Proj4js={Proj:function(e){return proj4(Proj4js.defs[e])},defs:proj4.defs,transform:proj4});const r=function(e,t){Proj4js.defs[e]=t;TC.isLegacy||proj4.defs(e,t)},i=function(e,i,n){const a="EPSG:"+e,l="urn:ogc:def:crs:EPSG::"+e,s="http://www.opengis.net/gml/srs/epsg.xml#"+e;var p;if("object"==typeof i){p=$.extend({},i);i=$.extend({},i);p.axis&&delete p.axis}else"string"==typeof i&&(p=i.replace("+axis=neu",""));r(a,i);r(l,i);r(s,p);if(0===t.indexOf("http")){r(t,p);o(t).name=n}o(a).name=n;o(s).name=n};var n=t.lastIndexOf("#");n<0&&(n=t.lastIndexOf("/"));n<0&&(n=t.lastIndexOf(":"));var a=t.substr(n+1),l=o(t);if(l){i(a,l,e.name);$.isFunction(e.callback)&&e.callback()}else if(e.def){i(a,e.def,e.name);$.isFunction(e.callback)&&e.callback()}else TC.getProjectionData(e).then(function(t){(function(e){var t="ok"===e.status&&1===e.number_result;if(t){var o=e.results[0];i(o.code,o.proj4,o.name)}return t})(t)&&$.isFunction(e.callback)&&e.callback()})};TC.url={templating:[TC.apiLocation+TC.Consts.url.TEMPLATING,TC.apiLocation+TC.Consts.url.TEMPLATING_I18N,TC.apiLocation+TC.Consts.url.TEMPLATING_OVERRIDES]};if(TC.isLegacy){TC.url.ol=TC.apiLocation+TC.Consts.url.OL_LEGACY;TC.url.olConnector=TC.apiLocation+TC.Consts.url.OL_CONNECTOR_LEGACY;TC.url.proj4js=TC.apiLocation+TC.Consts.url.PROJ4JS_LEGACY}else{TC.url.ol=TC.apiLocation+TC.Consts.url.OL;TC.url.olConnector=TC.apiLocation+TC.Consts.url.OL_CONNECTOR;TC.url.proj4js=TC.apiLocation+TC.Consts.url.PROJ4JS}TC.loadProjDef({crs:"EPSG:25830",name:"ETRS89 / UTM zone 30N",def:"+proj=utm +zone=30 +ellps=GRS80 +units=m +no_defs"});TC.loadProjDef({crs:"EPSG:4258",name:"ETRS89",def:"+proj=longlat +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +no_defs +axis=neu"});TC.loadProjDef({crs:"EPSG:3040",name:"ETRS89 / UTM zone 28N (N-E)",def:"+proj=utm +zone=28 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs +axis=neu"});TC.loadProjDef({crs:"EPSG:3041",name:"ETRS89 / UTM zone 29N (N-E)",def:"+proj=utm +zone=29 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs +axis=neu"});TC.loadProjDef({crs:"EPSG:3042",name:"ETRS89 / UTM zone 30N (N-E)",def:"+proj=utm +zone=30 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs +axis=neu"});TC.loadProjDef({crs:"EPSG:3043",name:"ETRS89 / UTM zone 31N (N-E)",def:"+proj=utm +zone=31 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs +axis=neu"});TC.loadProjDef({crs:"EPSG:4230",name:"ED50",def:"+proj=longlat +ellps=intl +towgs84=-87,-98,-121,0,0,0,0 +no_defs +axis=neu"});TC.Cfg=$.extend(!0,{},TC.Defaults,TC.Cfg);TC.capabilities={};TC.WFScapabilities={};TC.cache={};TC.inherit=function(e,t){function o(){}o.prototype=t.prototype;e._super=t.prototype;e.prototype=new o;e.prototype.constructor=e};TC.alert=function(e){alert(e)};TC.prompt=function(e,t,o){var r=prompt(e,t);$.isFunction(o)&&o(r)};TC.confirm=function(e,t,o){confirm(e)?$.isFunction(t)&&t():$.isFunction(o)&&o()};TC.error=function(e){window.console&&console.error(e)};TC.Object=function(){this.$events=$(this)};TC.Object.prototype.on=function(e,t){this.$events.on(e,t);return this};TC.Object.prototype.one=function(e,t){this.$events.one(e,t);return this};TC.Object.prototype.off=function(e,t){this.$events.off(e,t);return this};TC.wrap={Map:function(e){var t=this;t.parent=e;t.map=null;t.mapDeferred=new $.Deferred;t.getMap=function(){return t.map||t.mapDeferred.promise()}},Layer:function(e){var t=this;t.parent=e;t.layer=null;t.layerDeferred=new $.Deferred;t.getLayer=function(){return t.layer||t.layerDeferred.promise()};t.setLayer=function(e){t.layer=e;e?t.layerDeferred.resolve(e):t.layerDeferred.reject()}},layer:{Raster:function(){TC.wrap.Layer.apply(this,arguments)},Vector:function(){TC.wrap.Layer.apply(this,arguments)}},Control:function(e){this.parent=e},control:{Click:function(){TC.wrap.Control.apply(this,arguments)},ScaleBar:function(){TC.wrap.Control.apply(this,arguments)},NavBar:function(){TC.wrap.Control.apply(this,arguments)},Coordinates:function(){TC.wrap.Control.apply(this,arguments)},Search:function(){TC.wrap.Control.apply(this,arguments)},Measure:function(){TC.wrap.Control.apply(this,arguments)},OverviewMap:function(){TC.wrap.Control.apply(this,arguments)},FeatureInfo:function(){TC.wrap.Control.apply(this,arguments)},Popup:function(){TC.wrap.Control.apply(this,arguments)},GeometryFeatureInfo:function(){TC.wrap.Control.apply(this,arguments)},Geolocation:function(){TC.wrap.Control.apply(this,arguments)},Draw:function(){TC.wrap.Control.apply(this,arguments)},Modify:function(){TC.wrap.Control.apply(this,arguments)},CacheBuilder:function(){TC.wrap.Control.apply(this,arguments)},Edit:function(){TC.wrap.Control.apply(this,arguments)},ResultsPanel:function(){TC.wrap.Control.apply(this,arguments)}},Feature:function(){},Geometry:function(){}};TC.inherit(TC.wrap.layer.Raster,TC.wrap.Layer);TC.inherit(TC.wrap.layer.Vector,TC.wrap.Layer);TC.inherit(TC.wrap.control.Click,TC.wrap.Control);TC.inherit(TC.wrap.control.ScaleBar,TC.wrap.Control);TC.inherit(TC.wrap.control.NavBar,TC.wrap.Control);TC.inherit(TC.wrap.control.Coordinates,TC.wrap.Control);TC.inherit(TC.wrap.control.Measure,TC.wrap.Control);TC.inherit(TC.wrap.control.OverviewMap,TC.wrap.Control);TC.inherit(TC.wrap.control.Popup,TC.wrap.Control);TC.inherit(TC.wrap.control.FeatureInfo,TC.wrap.control.Click);TC.inherit(TC.wrap.control.GeometryFeatureInfo,TC.wrap.control.Click);TC.inherit(TC.wrap.control.Geolocation,TC.wrap.Control);TC.inherit(TC.wrap.control.Draw,TC.wrap.Control);TC.inherit(TC.wrap.control.CacheBuilder,TC.wrap.Control);TC.inherit(TC.wrap.control.Edit,TC.wrap.Control);TC.inherit(TC.wrap.control.ResultsPanel,TC.wrap.Control);TC.loadCSS(TC.apiLocation+"TC/css/tcmap.css");TC.Map||TC.syncLoadJS(TC.apiLocation+"TC/Map");TC.Util||TC.syncLoadJS(TC.apiLocation+"TC/Util");TC.loadJS(!Modernizr.urlparser,TC.apiLocation+TC.Consts.url.URL_POLYFILL,function(){});var o={};TC.getUID=function(e){var t=o[e=e||""];t||(t=o[e]=1);var r=e+t;o[e]=t+1;return r}}();!function(e,t){var o=/\+/g;function r(e){return e}function i(e){return decodeURIComponent(e.replace(o," "))}e.cookie=function(o,n,a){if(arguments.length>1&&(!/Object/.test(Object.prototype.toString.call(n))||null===n)){a=e.extend({},e.cookie.defaults,a);null===n&&(a.expires=-1);if("number"==typeof a.expires){var l=a.expires,s=a.expires=new Date;s.setDate(s.getDate()+l)}n=String(n);return t.cookie=[encodeURIComponent(o),"=",a.raw?n:encodeURIComponent(n),a.expires?";expires="+a.expires.toUTCString():"",a.path?";path="+a.path:"",a.domain?";domain="+a.domain:"",a.secure?";secure":""].join("")}for(var p,c=(a=n||e.cookie.defaults||{}).raw?r:i,u=t.cookie.split("; "),g=0;p=u[g]&&u[g].split("=");g++)if(c(p.shift())===o)return c(p.join("="));return null};e.cookie.defaults={}}(jQuery,document)}$(function(){TC.browser=TC.Util.getBrowser();TC.loadJS(!TC.Cfg.acceptedBrowserVersions,TC.apiLocation+"TC/config/browser-versions.js",function(e){var t=!0,o=TC.Cfg.acceptedBrowserVersions.filter(function(e){return e.name.toLowerCase()===TC.browser.name.toLowerCase()});o.length>0&&!isNaN(o[0].version)&&TC.browser.version<o[0].version&&(t=!1);if(TC.Cfg.oldBrowserAlert&&!t){TC.Cfg.loggingErrorsEnabled=!1;var r=$("."+TC.Consts.classes.MAP).data("map");$.when(TC.i18n.loadResources(!TC.i18n[r.options.locale],TC.apiLocation+"TC/resources/",r.options.locale)).done(function(){TC.error(TC.Util.getLocaleString(r.options.locale,"outdatedBrowser"),TC.Consts.msgErrorMode.TOAST)})}});/ip(ad|hone|od)/i.test(navigator.userAgent)&&(TC.Consts.event.CLICK="touchstart.tc");window.JL||TC.syncLoadJS(TC.apiLocation+TC.Consts.url.JSNLOG);JL.defaultAjaxUrl=TC.Consts.url.ERROR_LOGGER;window.addEventListener("error",(t=0,function(o){e=e||$("."+TC.Consts.classes.MAP).data("map");var r=o.message,i=o.filename,n=o.lineno,a=o.colno,l=o.error,s=i.indexOf(TC.apiLocation)>0;if((TC.Cfg.notifyApplicationErrors||s)&&t<TC.Cfg.maxErrorCount&&TC.Cfg.loggingErrorsEnabled){var p=s?TC.Consts.text.API_ERROR:TC.Consts.text.APP_ERROR;JL("onerrorLogger").fatalException({msg:p,errorMsg:r,url:i,lineNumber:n,column:a,appUrl:location.href,prevState:e.getPreviousMapState(),userAgent:navigator.userAgent},l);t++;TC.isDebug||$.when(TC.i18n.loadResources(!TC.i18n[e.options.locale],TC.apiLocation+"TC/resources/",e.options.locale)).done(function(){TC.error(TC.Util.getLocaleString(e.options.locale,"genericError")+(e.options.contactEmail||"webmaster@itracasa.es"),{type:TC.Consts.msgType.ERROR})})}return!1}),!1);var e,t});TC.Layer=function(e){this.options=e||{};$.extend(this,this.options);this.id=this.options.id||TC.getUID();this.map=this.options.map;this.type=this.options.type||TC.Consts.layerType.WMS;this.customLegend=this.options.customLegend;var t=this.options.isBase?TC.Consts.mimeType.JPEG:TC.Consts.mimeType.PNG;this.options.format=this.options.format||t;void 0===this.options.hideTree&&(this.options.hideTree=!0);void 0===this.options.hideTitle&&(this.options.hideTitle=!1);this._cache={visibilityStates:{}};this.tree=null;this.wrap=null};TC.Layer.state={IDLE:"idle",LOADING:"loading"};TC.Layer.prototype.setVisibility=function(e){this.wrap.setVisibility(e)};TC.Layer.prototype.getVisibility=function(){var e=!1;this.map&&(this.isBase&&this.map.getBaseLayer()!==this||(e=this.wrap.getVisibility()));return e};TC.Layer.prototype.getOpacity=function(){var e=!1;this.map&&(this.isBase&&this.map.getBaseLayer()!==this||(e=this.wrap.getLayer().getOpacity()));return e};TC.Layer.prototype.setOpacity=function(e,t){var o=this;$.when(this.wrap.getLayer()).then(function(r){r.setOpacity(e);o.map&&!t&&o.map.$events.trigger($.Event(TC.Consts.event.LAYEROPACITY,{layer:o,opacity:e}))})};TC.Layer.prototype.isCompatible=function(e){return!0};TC.Layer.prototype.isValidFromNames=function(){return!0};TC.Layer.prototype.isRaster=function(){var e=!0;switch(this.type){case TC.Consts.layerType.VECTOR:case TC.Consts.layerType.KML:case TC.Consts.layerType.WFS:case TC.Consts.layerType.GROUP:e=!1}return e};TC.Layer.prototype.isVisibleByScale=function(e){return!0};TC.Layer.prototype.isVisibleByName=function(e){return!0};TC.Layer.prototype.getTree=function(){return{name:this.name,title:this.title}};TC.Layer.prototype.findNode=function e(t,o){var r=null;if(o.uid==t)r=o;else for(var i=0;i<o.children.length;i++){var n=e(t,o.children[i]);if(n){r=n;break}}return r};TC.Layer.prototype.setNodeVisibility=function(e,t){this.setVisibility(t)};TC.Layer.prototype.getNodeVisibility=function(e){return TC.Consts.visibility.VISIBLE};TC.Layer.prototype.getResolutions=function(){return this.wrap.getResolutions?this.wrap.getResolutions():[]};TC.Layer.prototype.getLegendUrl=function(e){return e};TC.Layer.prototype.setProjection=function(){};TC.control=TC.control||{};TC.Control=function(){this.$events=$(this);this.map=null;this.isActive=!1;this.isDisabled=!1;this._firstRender=$.Deferred();var e=arguments.length;this.options=$.extend({},e>1?arguments[1]:arguments[0]);this.id=this.options.id||TC.getUID(this.CLASS.substr(TC.Control.prototype.CLASS.length+1)+"-");this.div=TC.Util.getDiv(this.options.div?this.options.div:arguments[0]);this._$div=$(this.div);this._$div.addClass(TC.Control.prototype.CLASS).addClass(this.CLASS);this.template=this.options.template||this.template;this.exportsState=!1};TC.Control.prototype.on=function(e,t){this.$events.on(e,t);return this};TC.Control.prototype.one=function(e,t){this.$events.one(e,t);return this};TC.Control.prototype.off=function(e,t){this.$events.off(e,t);return this};TC.Control.prototype.CLASS="tc-ctl";TC.Control.prototype.template="";TC.Control.prototype.show=function(){this._$div.show()};TC.Control.prototype.hide=function(){this._$div.hide()};TC.Control.prototype.render=function(e){this.renderData(null,e)};TC.Control.prototype.renderData=function(e,t){var o=this;if(o.map){var r=$.Event(TC.Consts.event.BEFORECONTROLRENDER,{dataObject:e});o.$events.trigger(r)}o._$div.toggleClass(TC.Consts.classes.DISABLED,o.isDisabled);TC.loadJSInOrder(!window.dust,TC.url.templating,function(){var r,i=function(t){var r=$.Deferred(),i=[];for(var n in t){var a=t[n];if("string"==typeof a)if(dust.cache[o.CLASS])dust.render(o.CLASS,e,function(e,t){o._$div.html(t);e&&TC.error(e)});else{var l=$.ajax({url:a,type:"get",dataType:"html"});l.templateKey=n;i.push(l)}else $.isFunction(a)&&a()}0==i.length?r.resolve():$.when.apply($,i).then(function(){if(3!=arguments.length||$.isArray(arguments[0]))for(var e=0;e<arguments.length;e++){var t=arguments[e];o=t[0],i=t[2].templateKey,n=dust.compile(o,i);dust.loadSource(n)}else{var o=arguments[0],i=arguments[2].templateKey,n=dust.compile(o,i);dust.loadSource(n)}r.resolve()},function(e,t,o){console.error("Deferred fallido")});return r};if("object"==typeof o.template)r=i(o.template);else{var n={};o.template&&(n[o.CLASS]=o.template);r=i(n)}r.then(function(){dust.cache[o.CLASS]&&dust.render(o.CLASS,e,function(e,t){o._$div.html(t);e&&TC.error(e)});o._firstRender.resolve();o.$events.trigger($.Event(TC.Consts.event.CONTROLRENDER));$.isFunction(t)&&t()})})};TC.Control.prototype.getRenderedHtml=function(e,t,o){var r=this,i=$.Deferred(),n=function(){dust.cache[e]&&dust.render(e,t,function(e,t){if(e){TC.error(e);i.reject()}else{$.isFunction(o)&&o(t);i.resolve(t)}})};TC.loadJSInOrder(!window.dust,TC.url.templating,function(){if(dust.cache[e])n();else{var t=r.template[e];if("string"==typeof t)$.ajax({url:t,type:"get",dataType:"html"}).done(function(){var t=arguments[0],o=dust.compile(t,e);dust.loadSource(o);n()});else if($.isFunction(t)){t();n()}}});return i};TC.Control.prototype.register=function(e){this.map=e;this.render();this.options.active&&this.activate()};TC.Control.prototype.activate=function(){if(this.map&&this.map.activeControl&&this.map.activeControl!=this){this.map.previousActiveControl=this.map.activeControl;TC.control.ThreeD&&this instanceof TC.control.ThreeD||this.map.activeControl.deactivate()}this.isActive=!0;if(this.map){this.map.activeControl=this;this.map.$events.trigger($.Event(TC.Consts.event.CONTROLACTIVATE,{control:this}));this.$events.trigger($.Event(TC.Consts.event.CONTROLACTIVATE,{control:this}))}};TC.Control.prototype.deactivate=function(e){0==arguments.length&&(e=!1);this.isActive=!1;if(this.map){this.map.activeControl=null;if(!e){var t=this.map.getDefaultControl();t==this?t=null:this.map.previousActiveControl==this?t=null:t||(t=this.map.previousActiveControl);t&&t.activate()}this.map.$events.trigger($.Event(TC.Consts.event.CONTROLDEACTIVATE,{control:this}));this.$events.trigger($.Event(TC.Consts.event.CONTROLDEACTIVATE,{control:this}))}};TC.Control.prototype.enable=function(){this.isDisabled=!1;this._$div&&this._$div.removeClass(TC.Consts.classes.DISABLED)};TC.Control.prototype.disable=function(){this.isDisabled=!0;this._$div&&this._$div.addClass(TC.Consts.classes.DISABLED)};TC.Control.prototype.renderPromise=function(){return this._firstRender.promise()};TC.Control.prototype.isExclusive=function(){return!1};TC.Control.prototype.getLocaleString=function(e,t){var o=this.map?this.map.options.locale:TC.Cfg.locale;return TC.Util.getLocaleString(o,e,t)};TC.Control.prototype.getUID=function(){return TC.getUID(this.id+"-")};TC.Control.prototype.exportState=function(){return this.exportsState?{}:null};TC.Control.prototype.importState=function(e){};TC.feature=TC.feature||{};TC.Feature=function(e,t){this.wrap=new TC.wrap.Feature;this.wrap.parent=this;if($.isArray(e))this.geometry=e;else if(this.wrap.isNative(e)){this.wrap.feature=e;this.id=this.wrap.getId();this.geometry=this.wrap.getGeometry();this.folders=e._folders;this.data=this.wrap.getData()}var o=this.options=$.extend(!0,{},t);this.id=this.id||o.id||TC.getUID();this.data=o.data||this.data||null;this._visibilityState=TC.Consts.visibility.VISIBLE;void 0===o.showsPopup?this.showsPopup=!0:this.showsPopup=o.showsPopup;this.layer=o.layer||null;this._selected=!1;o.selected&&this.select()};TC.Feature.prototype.STYLETYPE=TC.Consts.geom.POLYGON;TC.Feature.prototype.CLASSNAME="TC.Feature";TC.Feature.prototype.getPath=function(){var e=[];this.folders?e=this.folders:this.options.group&&(e=[this.options.group]);return e};TC.Feature.prototype.setVisibility=function(e){if(e&&this._visibilityState===TC.Consts.visibility.NOT_VISIBLE||!e&&this._visibilityState===TC.Consts.visibility.VISIBLE){this._visibilityState=e?TC.Consts.visibility.VISIBLE:TC.Consts.visibility.NOT_VISIBLE;this.layer.wrap.setFeatureVisibility(this,e)}};TC.Feature.prototype.setId=function(e){this.id=e;this.wrap.setId(e)};TC.Feature.prototype.getBounds=function(){return this.wrap.getBounds()};TC.Feature.prototype.setStyle=function(e){this.wrap.setStyle(e)};TC.Feature.prototype.getLegend=function(){this._legend||(this._legend=this.wrap.getLegend());return this._legend};TC.Feature.prototype.getCoords=function(){return this.wrap.getGeometry()};TC.Feature.prototype.setCoords=function(e){this.geometry=e;return this.wrap.setGeometry(e)};TC.Feature.prototype.getData=function(){return this.data?this.data:this.wrap.getData()};TC.Feature.prototype.setData=function(e){this.data=$.extend(this.data,e);this.wrap.setData(e)};TC.Feature.prototype.getInfo=function(){var e=null,t=this.layer&&this.layer.map&&TC.Util.getMapLocale(this.layer.map),o=this.getData();if("object"==typeof o){var r=this.wrap.getTemplate();if(r)e=r.replace(/\$\[?(?:\w+\/)*(\w+)\]/g,function(e,t){return o[t]});else{var i=[],n=TC.Util.getLocaleString(t,"open");for(var a in o){var l=o[a];if("string"==typeof l||"number"==typeof l||void 0===l){i[i.length]="<tr><th>";i[i.length]=a;i[i.length]="</th><td>";if(TC.Util.isURL(l)){i[i.length]='<a href="';i[i.length]=l;i[i.length]='" target="_blank">';i[i.length]=n;i[i.length]="</a>"}else i[i.length]=void 0!==l?TC.Util.formatNumber(l,t):"&mdash;";i[i.length]="</td></tr>"}}if(i.length>0){i.unshift('<table class="tc-attr">');i[i.length]="</table>";e=i.join("")}}}else"string"==typeof o&&(e=o);if(!e){e=this.title;this.group&&(e+=" "+this.group)}e||(e=TC.Util.getLocaleString(t,"noData"));return e};TC.Feature.prototype.clone=function(){var e=this.wrap.cloneFeature();e._wrap=this.wrap;return new this.constructor(e,this.options)};TC.Feature.prototype.getStyle=function(){return this.wrap.getStyle()};TC.Feature.prototype.showPopup=function(e){var t=this;if(t.layer&&t.layer.map){var o,r=e||t.popup;if(!r)for(var i=t.layer.map.getControlsByClass("TC.control.Popup"),n=0,a=i.length;n<a;n++){var l=i[n];if(!l.caller){r=l;break}}r?(o=$.Deferred()).resolve(r):o=t.layer.map.addControl("popup");o.then(function(e){e.currentFeature=t;t.layer.map.getControlsByClass(TC.control.Popup).forEach(function(e){e.isVisible()&&e.hide()});t.wrap.showPopup(e);t.layer.map.$events.trigger($.Event(TC.Consts.event.POPUP,{control:e}));e.fitToView(!0)})}};TC.Feature.prototype.select=function(){this._selected=!0;this.layer&&this.layer.selectedFeatures.push(this);var e=this.options.selection||{};this.setStyle($.extend({},TC.Cfg.styles.selection[this.STYLETYPE],e[this.STYLETYPE]))};TC.Feature.prototype.unselect=function(){this._selected=!1;this.setStyle(this.options);if(this.layer){var e=$.inArray(this,this.layer.selectedFeatures);e>=0&&this.layer.selectedFeatures.splice(e,1)}};TC.Feature.prototype.isSelected=function(){return this._selected};TC.Feature.prototype.toGML=function(e,t){return this.wrap.toGML(e,t)};TC.feature=TC.feature||{};TC.Feature||TC.syncLoadJS(TC.apiLocation+"TC/Feature");TC.feature.Point=function(e,t){var o;TC.Feature.apply(this,arguments);if(this.wrap.isNative(e)){e._wrap=this.wrap;this.wrap.feature=e}else{o=this.options=$.extend(!0,this.options,TC.Cfg.styles.point,t);this.wrap.createPoint(e,o)}};TC.inherit(TC.feature.Point,TC.Feature);TC.feature.Point.prototype.STYLETYPE=TC.Consts.geom.POINT;TC.feature.Point.prototype.CLASSNAME="TC.feature.Point";TC.feature=TC.feature||{};TC.Feature||TC.syncLoadJS(TC.apiLocation+"TC/Feature");TC.feature.Circle=function(e,t){var o;TC.Feature.apply(this,arguments);if(this.wrap.isNative(e)){e._wrap=this.wrap;this.wrap.feature=e}else{o=this.options=$.extend(!0,this.options,TC.Cfg.styles.polygon,t);this.wrap.createCircle(e,o)}};TC.inherit(TC.feature.Circle,TC.Feature);!function(){var e=TC.feature.Circle.prototype;e.STYLETYPE=TC.Consts.geom.POLYGON;e.CLASSNAME="TC.feature.Circle";e.getCoords=function(){return this.wrap.getGeometry()};e.setCoords=function(e){return this.wrap.setGeometry(e)}}();TC.feature=TC.feature||{};TC.feature.Point||TC.syncLoadJS(TC.apiLocation+"TC/feature/Point");TC.feature.Marker=function(e,t){TC.Feature.apply(this,arguments);if(this.wrap.isNative(e)){e._wrap=this.wrap;this.wrap.feature=e}else{var o=this.options=$.extend(!0,this.options,TC.Cfg.styles.marker,t),r=this.layer&&this.layer.map?this.layer.map.options.locale:TC.Cfg.locale;this.title=o.title||TC.i18n[r][TC.Consts.MARKER];this.wrap.createMarker(e,o)}};TC.inherit(TC.feature.Marker,TC.feature.Point);TC.feature.Marker.prototype.STYLETYPE="marker";TC.feature.Marker.prototype.CLASSNAME="TC.feature.Marker";TC.feature=TC.feature||{};TC.Feature||TC.syncLoadJS(TC.apiLocation+"TC/Feature");TC.feature.MultiPolygon=function(e,t){var o;TC.Feature.apply(this,arguments);if(this.wrap.isNative(e)){e._wrap=this.wrap;this.wrap.feature=e}else{o=this.options=$.extend(!0,this.options,TC.Cfg.styles.polygon,t);this.wrap.createMultiPolygon(e,o)}};TC.inherit(TC.feature.MultiPolygon,TC.Feature);TC.feature.MultiPolygon.prototype.STYLETYPE=TC.Consts.geom.POLYGON;TC.feature.MultiPolygon.prototype.CLASSNAME="TC.feature.MultiPolygon";TC.feature=TC.feature||{};TC.Feature||TC.syncLoadJS(TC.apiLocation+"TC/Feature");TC.feature.MultiPolyline=function(e,t){var o;TC.Feature.apply(this,arguments);if(this.wrap.isNative(e)){e._wrap=this.wrap;this.wrap.feature=e}else{o=this.options=$.extend(!0,this.options,TC.Cfg.styles.line,t);this.wrap.createMultiPolyline(e,o)}};TC.inherit(TC.feature.MultiPolyline,TC.Feature);TC.feature.MultiPolyline.prototype.STYLETYPE="line";TC.feature.MultiPolyline.prototype.CLASSNAME="TC.feature.MultiPolyline";TC.feature=TC.feature||{};TC.Feature||TC.syncLoadJS(TC.apiLocation+"TC/Feature");TC.feature.Polygon=function(e,t){var o;TC.Feature.apply(this,arguments);if(this.wrap.isNative(e)){e._wrap=this.wrap;this.wrap.feature=e}else{o=this.options=$.extend(!0,this.options,TC.Cfg.styles.polygon,t);this.wrap.createPolygon(e,o)}};TC.inherit(TC.feature.Polygon,TC.Feature);TC.feature.Polygon.prototype.STYLETYPE=TC.Consts.geom.POLYGON;TC.feature.Polygon.prototype.CLASSNAME="TC.feature.Polygon";TC.feature.Polygon.prototype.getLength=function(e){return this.wrap.getLength(e)};TC.feature.Polygon.prototype.getArea=function(e){return this.wrap.getArea(e)};TC.feature=TC.feature||{};TC.Feature||TC.syncLoadJS(TC.apiLocation+"TC/Feature");TC.feature.Polyline=function(e,t){var o;TC.Feature.apply(this,arguments);if(this.wrap.isNative(e)){e._wrap=this.wrap;this.wrap.feature=e}else{o=this.options=$.extend(!0,this.options,TC.Cfg.styles.line,t);this.wrap.createPolyline(e,o)}};TC.inherit(TC.feature.Polyline,TC.Feature);TC.feature.Polyline.prototype.STYLETYPE="line";TC.feature.Polyline.prototype.CLASSNAME="TC.feature.Polyline";TC.feature.Polyline.prototype.getLength=function(e){return this.wrap.getLength(e)};TC.filter={};TC.filter.Filter=function(e){this.tagName_=e;this._defaultNSURL="http://www.opengis.net/ogc";this._defaultPrefixNS=this._wfsPrefixNS="ogc";this._fieldTitle="PropertyName";this._defaultNSURL=this._wfsNSURL="http://www.opengis.net/ogc";this._wfs2prefixNS="fes";this._wfs2NSURL="http://www.opengis.net/fes/2.0";this._wfs2FieldTitle="ValueReference"};TC.filter.Filter.prototype.getTagName=function(){return this.tagName_};TC.filter.Filter.prototype.writeFilterCondition_=function(){return'<{prefix}:Filter xmlns:{prefix}="{NSURL}">{inner}</{prefix}:Filter>'.format({prefix:this._defaultPrefixNS,NSURL:this._defaultNSURL,tag:this.getTagName(),inner:this.writeInnerCondition_(this)})};TC.filter.Filter.prototype.writeInnerCondition_=function(e){if(e!=this){e._defaultNSURL=this._defaultNSURL;e._defaultPrefixNS=this._defaultPrefixNS}return e instanceof TC.filter.LogicalNary?e.write():e instanceof TC.filter.ComparisonBinary?e.write():e instanceof TC.filter.Comparison?e.write():e instanceof TC.filter.Spatial?e.write():(TC.filter.Function,e.write())};TC.filter.Filter.prototype.writeInnerArrayCondition_=function(e){return e.reduce(function(e,t,o){return(e instanceof TC.filter.Filter?e.writeInnerCondition_(e):e)+t.writeInnerCondition_(t)})};TC.filter.Filter.prototype.getText=function(e){if(e&&parseFloat(e,10)>=2){this._defaultPrefixNS=this._wfs2prefixNS;this._defaultNSURL=this._wfs2NSURL;this._fieldTitle=this._wfs2FieldTitle}return this.writeFilterCondition_()};TC.filter.and=function(e){var t=[null].concat(Array.prototype.slice.call(arguments));return new(Function.prototype.bind.apply(TC.filter.And,t))};TC.filter.or=function(e){var t=[null].concat(Array.prototype.slice.call(arguments));return new(Function.prototype.bind.apply(TC.filter.Or,t))};TC.filter.not=function(e){return new TC.filter.Not(e)};TC.filter.bbox=function(){return"[object String]"!==Object.prototype.toString.call(arguments[0])?new TC.filter.Bbox(null,arguments[0],arguments[1]):new TC.filter.Bbox(arguments[0],arguments[1],arguments[2])};TC.filter.intersects=function(){return"[object String]"!==Object.prototype.toString.call(arguments[0])?new TC.filter.Intersects(null,arguments[0],arguments[1]):new TC.filter.Intersects(arguments[0],arguments[1],arguments[2])};TC.filter.within=function(){return"[object String]"!==Object.prototype.toString.call(arguments[0])?new TC.filter.Within(null,arguments[0],arguments[1]):new TC.filter.Within(arguments[0],arguments[1],arguments[2])};TC.filter.equalTo=function(e,t,o){return new TC.filter.EqualTo(e,t,o)};TC.filter.notEqualTo=function(e,t,o){return new TC.filter.NotEqualTo(e,t,o)};TC.filter.lessThan=function(e,t){return new TC.filter.LessThan(e,t)};TC.filter.lessThanOrEqualTo=function(e,t){return new TC.filter.LessThanOrEqualTo(e,t)};TC.filter.greaterThan=function(e,t){return new TC.filter.GreaterThan(e,t)};TC.filter.greaterThanOrEqualTo=function(e,t){return new TC.filter.GreaterThanOrEqualTo(e,t)};TC.filter.isNull=function(e){return new TC.filter.IsNull(e)};TC.filter.between=function(e,t,o){return new TC.filter.IsBetween(e,t,o)};TC.filter.function=function(e,t){return new TC.filter.Function(e,t)};TC.filter.like=function(e,t,o,r,i,n){return new TC.filter.IsLike(e,t,o,r,i,n)};TC.filter.LogicalNary=function(e,t){TC.filter.Filter.call(this,e);this.conditions=Array.prototype.slice.call(arguments,1)};TC.inherit(TC.filter.LogicalNary,TC.filter.Filter);TC.filter.And=function(e){var t=["And"].concat(Array.prototype.slice.call(arguments));TC.filter.LogicalNary.apply(this,t)};TC.inherit(TC.filter.And,TC.filter.LogicalNary);TC.filter.Or=function(e){var t=["Or"].concat(Array.prototype.slice.call(arguments));TC.filter.LogicalNary.apply(this,t)};TC.inherit(TC.filter.Or,TC.filter.LogicalNary);TC.filter.LogicalNary.prototype.write=function(){return"<{prefix}:{tag}>{inner}</{prefix}:{tag}>".format({prefix:this._defaultPrefixNS,tag:this.getTagName(),inner:this.writeInnerArrayCondition_(this.conditions)})};TC.filter.Not=function(e){this.condition=e;TC.filter.Filter.call(this,"Not")};TC.inherit(TC.filter.Not,TC.filter.Filter);TC.filter.Filter.prototype.write=function(){return"<{prefix}:{tag}>{inner}</{prefix}:{tag}>".format({prefix:this._defaultPrefixNS,tag:this.getTagName(),inner:this.writeInnerCondition_(this.condition)})};TC.filter.Bbox=function(e,t,o){TC.filter.Filter.call(this,"BBOX");this.geometryName=e;this.extent=t;this.srsName=o};TC.inherit(TC.filter.Bbox,TC.filter.Filter);TC.filter.Comparison=function(e,t){TC.filter.Filter.call(this,e);this.propertyName=t};TC.inherit(TC.filter.Comparison,TC.filter.Filter);TC.filter.Comparison.prototype.write=function(){var e="";this.lowerBoundary&&this.upperBoundary&&(e="<{prefix}:LowerBoundary><{prefix}:Literal>{LowerBoundary}</{prefix}:Literal></{prefix}:LowerBoundary><{prefix}:UpperBoundary><{prefix}:Literal>{UpperBoundary}</{prefix}:Literal></{prefix}:UpperBoundary>".format({prefix:this._defaultPrefixNS,LowerBoundary:this.lowerBoundary,UpperBoundary:this.upperBoundary}));this.pattern&&(e="<{prefix}:Literal>{Pattern}</{prefix}:Literal>".format({prefix:this._defaultPrefixNS,Pattern:this.pattern}));this.params&&(e=$.isArray(this.params)?this.params.reduce(function(e,t,o){var r=function(e){return"<{prefix}:Literal>{value}</{prefix}:Literal>".format({prefix:this._defaultPrefixNS,value:e})};return(o>0?e:r(e))+r(t)}):"<{prefix}:Literal>{value}</{prefix}:Literal>".format({prefix:this._defaultPrefixNS,value:this.params}));return"<{prefix}:{tag}{matchCase}{escape}{singleChar}{wildCard}><{prefix}:{fieldTitle}>{name}</{prefix}:{fieldTitle}>{values}</{prefix}:{tag}>".format({prefix:this._defaultPrefixNS,tag:this.getTagName(),matchCase:void 0!==this.matchCase?' matchCase="'+this.matchCase+'"':"",escape:void 0!==this.escapeChar?' escape="'+this.escapeChar+'"':"",singleChar:void 0!==this.singleChar?' singleChar="'+this.singleChar+'"':"",wildCard:void 0!==this.wildCard?' wildCard="'+this.wildCard+'"':"",name:this.propertyName,values:e,fieldTitle:this._fieldTitle})};TC.filter.ComparisonBinary=function(e,t,o,r){TC.filter.Comparison.call(this,e,t);this.expression=o;this.matchCase=r};TC.inherit(TC.filter.ComparisonBinary,TC.filter.Comparison);TC.filter.ComparisonBinary.prototype.write=function(){return("<{prefix}:{tag}{matchCase}>"+(this.propertyName instanceof TC.filter.Filter?"{name}":"<{prefix}:{fieldTitle}>{name}</{prefix}:{fieldTitle}>")+"<{prefix}:Literal>{value}</{prefix}:Literal></{prefix}:{tag}>").format({prefix:this._defaultPrefixNS,tag:this.getTagName(),matchCase:void 0!==this.matchCase?' matchCase="'+this.matchCase+'"':"",name:this.propertyName instanceof TC.filter.Filter?this.propertyName.write():this.propertyName,value:this.expression,fieldTitle:this._fieldTitle})};TC.filter.EqualTo=function(e,t,o){TC.filter.ComparisonBinary.call(this,"PropertyIsEqualTo",e,t,o)};TC.inherit(TC.filter.EqualTo,TC.filter.ComparisonBinary);TC.filter.GreaterThan=function(e,t){TC.filter.ComparisonBinary.call(this,"PropertyIsGreaterThan",e,t)};TC.inherit(TC.filter.GreaterThan,TC.filter.ComparisonBinary);TC.filter.GreaterThanOrEqualTo=function(e,t){TC.filter.ComparisonBinary.call(this,"PropertyIsGreaterThanOrEqualTo",e,t)};TC.inherit(TC.filter.GreaterThanOrEqualTo,TC.filter.ComparisonBinary);TC.filter.LessThan=function(e,t){TC.filter.ComparisonBinary.call(this,"PropertyIsLessThan",e,t)};TC.inherit(TC.filter.LessThan,TC.filter.ComparisonBinary);TC.filter.LessThanOrEqualTo=function(e,t){TC.filter.ComparisonBinary.call(this,"PropertyIsLessThanOrEqualTo",e,t)};TC.inherit(TC.filter.LessThanOrEqualTo,TC.filter.ComparisonBinary);TC.filter.NotEqualTo=function(e,t,o){TC.filter.ComparisonBinary.call(this,"PropertyIsNotEqualTo",e,t,o)};TC.inherit(TC.filter.NotEqualTo,TC.filter.ComparisonBinary);TC.filter.IsLike=function(e,t,o,r,i,n){TC.filter.Comparison.call(this,"PropertyIsLike",e);this.pattern=t;this.wildCard=void 0!==o?o:"*";this.singleChar=void 0!==r?r:".";this.escapeChar=void 0!==i?i:"!";this.matchCase=n};TC.inherit(TC.filter.IsLike,TC.filter.Comparison);TC.filter.IsNull=function(e){TC.filter.Comparison.call(this,"PropertyIsNull",e)};TC.inherit(TC.filter.IsNull,TC.filter.Comparison);TC.filter.IsBetween=function(e,t,o){TC.filter.Comparison.call(this,"PropertyIsBetween",e);this.lowerBoundary=t;this.upperBoundary=o};TC.inherit(TC.filter.IsBetween,TC.filter.Comparison);TC.filter.Function=function(e,t){TC.filter.Filter.call(this,e);this.params=t};TC.inherit(TC.filter.Function,TC.filter.Filter);TC.filter.Function.prototype.write=function(){var e="";if(this.params){var t=function(e,t){if("string"==typeof e)return"<{prefix}:Literal>{value}</{prefix}:Literal>".format({prefix:t,value:e});if("object"==typeof e){var o="";for(var r in e)o+="<{prefix}:{key}>{value}</{prefix}:{key}>".format({prefix:t,value:e[r],key:r});return o}};if($.isArray(this.params)){var o=this._defaultPrefixNS;e=this.params.reduce(function(e,r,i){var n=function(e){return t(e,o)};return(i>1?e:n(e))+n(r)})}else e=t(this.params,this._defaultPrefixNS)}return'<{prefix}:Function name="{tag}">{inner}</{prefix}:Function>'.format({prefix:this._defaultPrefixNS,tag:this.getTagName(),inner:e})};TC.filter.Spatial=function(e,t,o,r){TC.filter.Filter.call(this,e);this.geometryName=t;this.geometry=o;this.srsName=r};TC.inherit(TC.filter.Spatial,TC.filter.Filter);TC.filter.Spatial.prototype.write=function(){return(this.geometryName?"<{prefix}:{tag}><{prefix}:{fieldTitle}>{name}</{prefix}:{fieldTitle}>{geometry}</{prefix}:{tag}>":"<{prefix}:{tag}><{prefix}:{fieldTitle}/>{geometry}</{prefix}:{tag}>").format({prefix:this._defaultPrefixNS,tag:this.getTagName(),name:this.geometryName,srsName:void 0!==this.srsName?' srsName="'+this.srsName+'"':"",geometry:this.geometry instanceof TC.filter.Function?this.writeInnerCondition_(this.geometry):this.geometry.wrap.toGML(),fieldTitle:this._fieldTitle})};TC.filter.Bbox=function(e,t,o){TC.filter.Filter.call(this,"BBOX");this.geometryName=e;this.extent=t;this.srsName=o};TC.inherit(TC.filter.Bbox,TC.filter.Filter);TC.filter.Bbox.prototype.write=function(){var e="<gml:Envelope{srsName}><gml:lowerCorner>{lowerCorner}</gml:lowerCorner><gml:upperCorner>{upperCorner}</gml:upperCorner></gml:Envelope>".format({srsName:void 0!==this.srsName?' srsName="'+this.srsName+'"':"",lowerCorner:this.extent[0]+" "+this.extent[1],upperCorner:this.extent[2]+" "+this.extent[3]});return(this.geometryName?"<{prefix}:{tag}><{prefix}:{fieldTitle}>{name}</{prefix}:{fieldTitle}>{BBOX}</{prefix}:{tag}>":"<{prefix}:{tag}><{prefix}:{fieldTitle}/>{BBOX}</{prefix}:{tag}>").format({prefix:this._defaultPrefixNS,tag:this.getTagName(),fieldTitle:this._fieldTitle,name:this.geometryName,BBOX:e})};TC.filter.Intersects=function(e,t,o){TC.filter.Spatial.call(this,"Intersects",e,t,o)};TC.inherit(TC.filter.Intersects,TC.filter.Spatial);TC.filter.Within=function(e,t,o){TC.filter.Spatial.call(this,"Within",e,t,o)};TC.inherit(TC.filter.Within,TC.filter.Spatial);TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.control.MapContents=function(){TC.Control.apply(this,arguments);this.layerTrees={}};TC.inherit(TC.control.MapContents,TC.Control);!function(){var e=TC.control.MapContents.prototype;e.CLASS="tc-ctl-mc";var t="tcLayer",o="tcImg";e.render=function(e,t){this.map&&this.renderData(t?$.extend(this.map.getLayerTree(),t):this.map.getLayerTree(),e)};e.register=function(e){var t=this;TC.Control.prototype.register.call(t,e);t.render(function(){for(var o=0,r=e.layers.length;o<r;o++)t.updateLayerTree(e.layers[o]);e.on(TC.Consts.event.ZOOM+" "+TC.Consts.event.PROJECTIONCHANGE,function(){t.updateScale()}).on(TC.Consts.event.UPDATEPARAMS,function(e){var o=e.layer.names;!function e(t){var r=!1;if(t)if($.inArray(t.name,o)>=0)r=!0;else for(var i=0;i<t.children.length;i++)if(e(t.children[i])){r=!0;break}return r}(t.layerTrees[e.layer.id])&&0!==o.length?t.updateLayerTree(e.layer):t.update()}).on(TC.Consts.event.LAYERVISIBILITY,function(e){t.updateLayerVisibility(e.layer)}).on(TC.Consts.event.LAYERADD,function(e){t.updateLayerTree(e.layer)}).on(TC.Consts.event.VECTORUPDATE+" "+TC.Consts.event.FEATUREADD+" "+TC.Consts.event.FEATURESADD,function(e){t._updateLayerTreeTimeout&&clearTimeout(t._updateLayerTreeTimeout);t._updateLayerTreeTimeout=setTimeout(function(){if(t.map.workLayers.indexOf(e.layer)>-1){t.updateLayerTree(e.layer);delete t._updateLayerTreeTimeout}},100)}).on(TC.Consts.event.LAYERREMOVE,function(e){t.removeLayer(e.layer)}).on(TC.Consts.event.LAYERORDER,function(e){t.updateLayerOrder(e.layer,e.oldIndex,e.newIndex)})})};e.updateScale=function(){};e.updateLayerVisibility=function(e){};e.updateLayerTree=function(e){this.layerTrees[e.id]=e.getTree()};e.updateLayerOrder=function(e,o,r,i){if(o>=0&&o!==r)for(var n,a,l=this.getLayerUIElements(),s=(i=i||this.map.workLayers).length-1;s>=0;s--){var p=i[s];a=n;l.each(function(e,o){var r=$(o);if(r.data(t)===p){n=r;return!1}});if(p===e){a?a.after(n):l.parent().prepend(n);break}}};e.removeLayer=function(e){this.update()};e.getLayerUIElements=function(){return this._$div.find("ul").first().children()};e.styleLegendImage=function(e,t){if(!e.attr("src")){var r=e.data(o);e.off("error.tc").on("error.tc",function(){var o=e.attr("src");if(-1===o.indexOf(t.url)){var r=/^(https?:\/\/)/i;r.test(o)&&r.test(t.url)&&(o=o.replace(o.match(r)[1],t.url.match(r)[1]))}e.off("error.tc");e.attr("src",t instanceof TC.layer.Raster?t.getByProxy_(o):TC.proxify(o))}.bind(t));if(t&&t.options.method&&"POST"===t.options.method)t.getLegendGraphicImage().done(function(o){e.attr("src",t.getLegendUrl(o))}).fail(function(e){TC.error(e)});else{if(/[&?]REQUEST=getLegendGraphic/i.test(r)){var i=e.parent(),n=i.css("color"),a=n.indexOf("("),l=n.indexOf(")");if(a>=0&&l>a){color=n.substr(0,l).substr(a+1).split(",");n="0x";for(var s=0;s<3;s++){var p=parseInt(color[s]).toString(16);n+=1===p.length?"0"+p:p}}else n.replace("#","0x");r+="&LEGEND_OPTIONS=fontName:"+i.css("font-family")+";fontSize:"+parseInt(i.css("font-size"))+";fontColor:"+n+";fontAntiAliasing:true";t.params&&t.params.sld_body&&(r=TC.Util.addURLParameters(r,{sld_body:t.params.sld_body}));e.data(o,t.getLegendUrl(r))}e.attr("src",t.getLegendUrl(r))}}}}();TC.control=TC.control||{};TC.control.MapContents||TC.syncLoadJS(TC.apiLocation+"TC/control/MapContents");TC.control.TOC=function(){TC.control.MapContents.apply(this,arguments)};TC.inherit(TC.control.TOC,TC.control.MapContents);!function(){var e=TC.control.TOC.prototype;e.CLASS="tc-ctl-toc";e.template={};if(TC.isDebug){e.template[e.CLASS]=TC.apiLocation+"TC/templates/TOC.html";e.template[e.CLASS+"-branch"]=TC.apiLocation+"TC/templates/TOCBranch.html";e.template[e.CLASS+"-node"]=TC.apiLocation+"TC/templates/TOCNode.html"}else{e.template[e.CLASS]=function(){dust.register(e.CLASS,t);function t(e,t){return e.w("<h2>").h("i18n",t,{},{$key:"worklayers"}).w('</h2><div class="tc-ctl-toc-tree"><form><div class="tc-ctl-toc-empty">').h("i18n",t,{},{$key:"noData"}).w('</div><ul class="tc-ctl-toc-branch tc-ctl-toc-wl">').s(t.get(["workLayers"],!1),t,{block:o},{}).w("</ul></form></div>")}t.__dustBody=!0;function o(e,t){return e.p("tc-ctl-toc-wlbranch",t,t.rebase(t.getPath(!0,[])),{})}o.__dustBody=!0;return t};e.template[e.CLASS+"-branch"]=function(){dust.register(e.CLASS+"-branch",t);function t(e,t){return e.w("<li ").x(t.get(["children"],!1),t,{else:o,block:r},{}).w(' data-tc-layer-name="').f(t.get(["name"],!1),t,"h").w('" data-tc-layer-uid="').f(t.get(["uid"],!1),t,"h").w('"><input type="checkbox" class="tc-ctl-toc-branch-cb" name="toc" value="').f(t.get(["name"],!1),t,"h").w('"').x(t.get(["isVisible"],!1),t,{block:i},{}).w(" /><span>").f(t.get(["title"],!1),t,"h").w('</span><ul class="tc-ctl-toc-branch">').s(t.get(["children"],!1),t,{block:n},{}).w("</ul></li>")}t.__dustBody=!0;function o(e,t){return e.w('class="tc-ctl-toc-node tc-ctl-toc-leaf"')}o.__dustBody=!0;function r(e,t){return e.w('class="tc-ctl-toc-node"')}r.__dustBody=!0;function i(e,t){return e.w(" checked")}i.__dustBody=!0;function n(e,t){return e.p("tc-ctl-toc-node",t,t.rebase(t.getPath(!0,[])),{})}n.__dustBody=!0;return t};e.template[e.CLASS+"-node"]=function(){dust.register(e.CLASS+"-node",t);function t(e,t){return e.w("<li ").x(t.get(["children"],!1),t,{else:o,block:r},{}).w(' data-tc-layer-name="').f(t.get(["name"],!1),t,"h").w('" data-tc-layer-uid="').f(t.get(["uid"],!1),t,"h").w('"><input type="checkbox" name="toc" value="').f(t.get(["name"],!1),t,"h").w('"').x(t.get(["isVisible"],!1),t,{block:i},{}).w(" /><span>").f(t.get(["title"],!1),t,"h").w('</span><ul class="tc-ctl-toc-branch">').s(t.get(["children"],!1),t,{block:n},{}).w("</ul></li>")}t.__dustBody=!0;function o(e,t){return e.w('class="tc-ctl-toc-node tc-ctl-toc-leaf"')}o.__dustBody=!0;function r(e,t){return e.w('class="tc-ctl-toc-node"')}r.__dustBody=!0;function i(e,t){return e.w(" checked")}i.__dustBody=!0;function n(e,t){return e.p("tc-ctl-toc-node",t,t.rebase(t.getPath(!0,[])),{})}n.__dustBody=!0;return t}}var t="tcLayer",o="tcLayerUid";e.register=function(e){var t=this;TC.control.MapContents.prototype.register.call(t,e);t._addBrowserEventHandlers();e.on(TC.Consts.event.EXTERNALSERVICEADDED,function(o){if(o&&o.layer){o.layer.map=e;e.addLayer(o.layer);t.updateLayerTree(o.layer)}})};e._addBrowserEventHandlers=function(){var e=this;e._$div.on("click.tc","input[type=checkbox]",function(r){var i=$(r.target),n=i.closest("ul."+e.CLASS+"-wl").children("li").has(i).data(t),a=i.parents("li").first().data(o),l=i.prop("checked");n.setNodeVisibility(a,l);r.stopPropagation()}).on(TC.Consts.event.MOUSEUP,"li",function(t){var o=$(t.target);if(!o.hasClass(e.CLASS+"-leaf")){o.toggleClass(TC.Consts.classes.COLLAPSED);o.find("ul").first().toggleClass(TC.Consts.classes.COLLAPSED);t.stopPropagation()}})};e.update=function(){var e=function(e){return e.children("input[type=checkbox]")};this._$div.find("ul."+this.CLASS+"-wl").first().children("li").each(function(r,i){var n=$(i),a=n.data(t);if(a){var l=a.getVisibility();e(n).prop("checked",l);a.tree=null;n.find("li").each(function(t,r){var i=$(r),n=e(i),l=i.data(o);switch(a.getNodeVisibility(l)){case TC.Consts.visibility.VISIBLE:case TC.Consts.visibility.NOT_VISIBLE_AT_RESOLUTION:n.prop("checked",!0);n.prop("indeterminate",!1);break;case TC.Consts.visibility.HAS_VISIBLE:n.prop("checked",!1);n.prop("indeterminate",!0);break;default:n.prop("checked",!1);n.prop("indeterminate",!1)}})}});this.updateScale()};e.updateScale=function(){var e=this;e._$div.find("ul."+e.CLASS+"-wl").children("li").each(function(r,i){var n=$(i),a=n.data(t);n.find("li").each(function(t,r){var i=$(r);i.toggleClass(e.CLASS+"-node-notvisible",!a.isVisibleByScale(i.data(o)))})})};e.updateLayerTree=function(e){var r=this;if(!e.isBase&&!e.options.stealth){TC.control.MapContents.prototype.updateLayerTree.call(r,e);r._$div.find("."+r.CLASS+"-empty").addClass(TC.Consts.classes.HIDDEN);var i=r.CLASS+"-branch";TC.loadJSInOrder(!window.dust,TC.url.templating,function(){dust.render(i,r.layerTrees[e.id],function(i,n){var a=$(n);Modernizr.canvas||a.find("li:last-child").addClass(TC.Consts.classes.LASTCHILD);var l=a.data(o),s=r._$div.find("."+r.CLASS+"-wl"),p=s.find('li[data-tc-layer-uid="'+l+'"]');if(1===p.length){p.html(a.html());p.data(t)||p.data(t,e)}else{a.data(t,e);s.prepend(a)}i&&TC.error(i)});var n="ul."+r.CLASS+"-wl",a="ul."+r.CLASS+"-branch",l="li."+r.CLASS+"-node",s="li."+r.CLASS+"-leaf";r._$div.find(n+" "+a+" "+a+","+n+" "+a+" "+l).not(s).addClass(TC.Consts.classes.COLLAPSED);r.update()})}};e.removeLayer=function(e){if(!e.isBase){var o=this,r=function(){return o._$div.find("."+o.CLASS+"-wl").children("li")},i=r();i.each(function(o,n){var a=$(n);if(a.data(t)===e){a.remove();i=r();return!1}});0===i.length&&o._$div.find("."+o.CLASS+"-empty").removeClass(TC.Consts.classes.HIDDEN)}};e.updateLayerVisibility=function(e){var o=this;o._$div.find("."+o.CLASS+"-wl").children("li").each(function(r,i){var n=$(i);if(n.data(t)===e){var a=!e.getVisibility(),l=n.find("input[type=checkbox]"),s=l.filter("."+o.CLASS+"-branch-cb");s.prop("checked",!a);l.not(s).prop("disabled",a);return!1}})};e.updateLayerOrder=function(e,t,o){};e.render=function(e){var t=this;TC.Control.prototype.render.call(t,function(){var o=t.options.controls||[];if(o.length>0){var r=o[0],i=$("<div/>");t._$div.append(i);t.map.addControl(r.name,$.extend({div:i},r.options))}$.isFunction(e)&&e()})}}();TC.control=TC.control||{};TC.control.TOC||TC.syncLoadJS(TC.apiLocation+"TC/control/TOC");TC.control.WorkLayerManager=function(){TC.control.TOC.apply(this,arguments);this.layers=[]};TC.inherit(TC.control.WorkLayerManager,TC.control.TOC);!function(){var e=TC.control.WorkLayerManager.prototype;e.CLASS="tc-ctl-wlm";e.CLICKEVENT="click.tc";TC.Consts.classes.DRAG=TC.Consts.classes.DRAG||"tc-drag";TC.Consts.classes.DRAGEND=TC.Consts.classes.DRAGEND||"tc-dragend";TC.Consts.event.TOOLSOPEN=TC.Consts.event.TOOLSOPEN||"toolsopen.tc";e.template={};if(TC.isDebug){e.template[e.CLASS]=TC.apiLocation+"TC/templates/WorkLayerManager.html";e.template[e.CLASS+"-elm"]=TC.apiLocation+"TC/templates/WorkLayerManagerElement.html";e.template[e.CLASS+"-type-sgl"]=TC.apiLocation+"TC/templates/WorkLayerManagerTooltipSingle.html";e.template[e.CLASS+"-type-grp"]=TC.apiLocation+"TC/templates/WorkLayerManagerTooltipGroup.html";e.template[e.CLASS+"-type-grp-node"]=TC.apiLocation+"TC/templates/WorkLayerManagerTooltipGroupNode.html"}else{e.template[e.CLASS]=function(){dust.register(e.CLASS,t);function t(e,t){return e.w("<h2>").h("i18n",t,{},{$key:"loadedLayers"}).w('<span class="tc-ctl-wlm-n"></span><button class="tc-ctl-wlm-del-all tc-hidden" title="').h("i18n",t,{},{$key:"removeAllLayersFromMap"}).w('"></button></h2><div class="tc-ctl-wlm-empty">').h("i18n",t,{},{$key:"noData"}).w('</div><div class="tc-ctl-wlm-content tc-hidden"><form><ul>').s(t.get(["workLayers"],!1),t,{block:o},{}).w("</ul></form></div>")}t.__dustBody=!0;function o(e,t){return e.p("tc-ctl-wlm-elm",t,t.rebase(t.getPath(!0,[])),{})}o.__dustBody=!0;return t};e.template[e.CLASS+"-elm"]=function(){dust.register(e.CLASS+"-elm",t);function t(e,t){return e.w('<li class="tc-ctl-wlm-elm" tabindex="-1"><div class="tc-ctl-wlm-lyr">').x(t.get(["path"],!1),t,{block:o},{}).w('</div><div class="tc-ctl-wlm-type"></div><div class="tc-ctl-wlm-path" title="').s(t.get(["path"],!1),t,{else:r,block:i},{}).w('">').s(t.get(["path"],!1),t,{else:a,block:l},{}).w('</div><div><div class="tc-ctl-wlm-btn-info" title="').h("i18n",t,{},{$key:"infoFromThisLayer"}).w('"></div><input type="range" value="').f(t.get(["opacity"],!1),t,"h").w('" title="').h("i18n",t,{},{$key:"transparencyOfThisLayer"}).w('" /><input type="checkbox" ').nx(t.get(["hide"],!1),t,{block:p},{}).w(' title="').h("i18n",t,{},{$key:"visibilityOfThisLayer"}).w('" /></div><div class="tc-ctl-wlm-info tc-hidden">').x(t.get(["abstract"],!1),t,{block:c},{}).x(t.get(["customLegend"],!1),t,{else:u,block:h},{}).x(t.get(["metadata"],!1),t,{block:f},{}).w('</div><div class="tc-ctl-wlm-dd ').x(t.get(["hide"],!1),t,{block:m},{}).w('" title="').h("i18n",t,{},{$key:"dragToReorder"}).w('"></div><div class="tc-ctl-wlm-del ').nx(t.get(["hide"],!1),t,{block:v},{}).w('" title="').h("i18n",t,{},{$key:"removeLayerFromMap"}).w('"></div></li>')}t.__dustBody=!0;function o(e,t){return e.f(t.get(["title"],!1),t,"h")}o.__dustBody=!0;function r(e,t){return e.f(t.get(["title"],!1),t,"h")}r.__dustBody=!0;function i(e,t){return e.f(t.getPath(!0,[]),t,"h").h("sep",t,{block:n},{})}i.__dustBody=!0;function n(e,t){return e.w(" &bull; ")}n.__dustBody=!0;function a(e,t){return e.f(t.get(["title"],!1),t,"h")}a.__dustBody=!0;function l(e,t){return e.f(t.getPath(!0,[]),t,"h").h("sep",t,{block:s},{})}l.__dustBody=!0;function s(e,t){return e.w(" &bull; ")}s.__dustBody=!0;function p(e,t){return e.w('checked="checked"')}p.__dustBody=!0;function c(e,t){return e.w('<div class="tc-ctl-wlm-abstract"><h4>').h("i18n",t,{},{$key:"abstract"}).w("</h4><div><pre>").f(t.get(["abstract"],!1),t,"h",["s"]).w("</pre></div></div>")}c.__dustBody=!0;function u(e,t){return e.x(t.get(["legend"],!1),t,{block:g},{})}u.__dustBody=!0;function g(e,t){return e.w('<div class="tc-ctl-wlm-legend" data-tc-layer-name="').f(t.get(["layerNames"],!1),t,"h").w('"><h4>').h("i18n",t,{},{$key:"content"}).w("</h4>").s(t.get(["legend"],!1),t,{block:d},{}).w("</div>")}g.__dustBody=!0;function d(e,t){return e.w("<div><p>").f(t.get(["title"],!1),t,"h").w('</p><img data-tc-img="').f(t.get(["src"],!1),t,"h").w('" /></div>')}d.__dustBody=!0;function h(e,t){return e.w('<ul class="tc-ctl-wlm-custom-legend">').f(t.get(["customLegend"],!1),t,"h",["s"]).w("</ul>")}h.__dustBody=!0;function f(e,t){return e.w('<div class="tc-ctl-wlm-metadata"><h4>').h("i18n",t,{},{$key:"metadata"}).w("</h4><ul>").s(t.get(["metadata"],!1),t,{block:y},{}).w("</ul></div>")}f.__dustBody=!0;function y(e,t){return e.w('<li><a href="').f(t.get(["url"],!1),t,"h",["s"]).w('" type="').f(t.get(["format"],!1),t,"h").w('" title="').f(t.get(["formatDescription"],!1),t,"h").w('" target="_blank">').f(t.get(["formatDescription"],!1),t,"h").w("</a></li>")}y.__dustBody=!0;function m(e,t){return e.w("tc-hidden")}m.__dustBody=!0;function v(e,t){return e.w("tc-hidden")}v.__dustBody=!0;return t};e.template[e.CLASS+"-type-sgl"]=function(){dust.register(e.CLASS+"-type-sgl",t);function t(e,t){return e.h("i18n",t,{},{$key:"singleLayer"})}t.__dustBody=!0;return t};e.template[e.CLASS+"-type-grp"]=function(){dust.register(e.CLASS+"-type-grp",t);function t(e,t){return e.w("<div>").h("i18n",t,{},{$key:"groupLayerThatContains"}).w(":</div><ul>").s(t.get(["Layer"],!1),t,{block:o},{}).w("</ul>")}t.__dustBody=!0;function o(e,t){return e.p("tc-ctl-wlm-type-grp-node",t,t.rebase(t.getPath(!0,[])),{})}o.__dustBody=!0;return t};e.template[e.CLASS+"-type-grp-node"]=function(){dust.register(e.CLASS+"-type-grp-node",t);function t(e,t){return e.w('<li class="tc-ctl-wlm-tip-grp-elm"><span>').f(t.get(["Title"],!1),t,"h").w("</span><ul>").s(t.get(["Layer"],!1),t,{block:o},{}).w("</ul></li>")}t.__dustBody=!0;function o(e,t){return e.p("tc-ctl-wlm-type-grp-node",t,t.rebase(t.getPath(!0,[])),{})}o.__dustBody=!0;return t}}var t="tcLayer",o=function(e,o){var r;e._$div.find("li."+e.CLASS+"-elm").each(function(e,i){var n=$(i);if(n.data(t)===o){r=n;return!1}});return r},r=function(e){return $.grep(e.map.workLayers,function(e){return!e.stealth}).length};e.register=function(e){var t=this;TC.control.TOC.prototype.register.call(t,e);e.off(TC.Consts.event.EXTERNALSERVICEADDED);e.on(TC.Consts.event.LAYEROPACITY,function(e){var r=o(t,e.layer);r&&r.find("input[type=range]").val(Math.round(100*e.opacity))}).on(TC.Consts.event.FEATURESIMPORT,function(o){var r=o.fileName;if(o.features&&o.features.length>0){var i="."+TC.Consts.format.GPX.toLowerCase();if(o.fileName.toLowerCase().indexOf(i)===o.fileName.length-i.length)return;e.one(TC.Consts.event.LAYERADD,function(e){if(e&&e.layer&&e.layer.title==r){if(t.map&&t.map.layout&&t.map.layout.accordion&&t._$div.hasClass(TC.Consts.classes.COLLAPSED))for(var o=0;o<t.map.controls.length;o++)t.map.controls[o]!==t&&t.map.controls[o]._$div.addClass(TC.Consts.classes.COLLAPSED);t.map.$events.trigger($.Event(TC.Consts.event.TOOLSOPEN),{});t._$div.removeClass(TC.Consts.classes.COLLAPSED)}})}})};e._addBrowserEventHandlers=function(){var e=this;e._$div.on(e.CLICKEVENT,"input[type=checkbox]",function(o){var r=$(o.target),i=r.parents("li."+e.CLASS+"-elm").first().data(t),n=r.prop("checked");i.setVisibility(n);o.stopPropagation()}).on("change input","input[type=range]",function(e){var o=$(e.target);o.parents("li").first().data(t).setOpacity(o.val()/100)}).on(e.CLICKEVENT,"."+e.CLASS+"-del",function(o){var r=$(o.target).parents("li").first().data(t);e.map.removeLayer(r)}).on(e.CLICKEVENT,"."+e.CLASS+"-del-all",function(o){TC.confirm(e.getLocaleString("layersRemove.confirm"),function(){var o=e._$div.find("li."+e.CLASS+"-elm"),r=new Array(o.length);o.each(function(e,o){r[e]=$(o).data(t)});for(var i=0,n=r.length;i<n;i++)e.map.removeLayer(r[i])})}).on(e.CLICKEVENT,"."+e.CLASS+"-btn-info",function(o){var r=$(o.target),i=r.parents("li").first(),n=i.find("."+e.CLASS+"-info");n.find("."+e.CLASS+"-legend img").each(function(o,r){var n=i.data(t);e.styleLegendImage($(r),n)});n.toggleClass(TC.Consts.classes.HIDDEN);i.find('input[type="checkbox"]').is(":checked")&&i.find("."+e.CLASS+"-dd").toggleClass(TC.Consts.classes.HIDDEN,!n.hasClass(TC.Consts.classes.HIDDEN));r.toggleClass(TC.Consts.classes.CHECKED)})};e.updateLayerVisibility=function(e){var t=o(this,e);if(t){var r=e.getVisibility();t.find('input[type="checkbox"]').prop("checked",r);t.find("."+this.CLASS+"-del").toggleClass(TC.Consts.classes.HIDDEN,r);t.find("."+this.CLASS+"-info").hasClass(TC.Consts.classes.HIDDEN)&&t.find("."+this.CLASS+"-dd").toggleClass(TC.Consts.classes.HIDDEN,!r)}};e.updateLayerTree=function(e){var o=this,i=function(e,r,i){if(e!==r){for(var n=e.data(t),a=r.data(t),l=-1,s=0;s<o.map.layers.length;s++)if(a===o.map.layers[s]){l=s;break}l>=1&&l<o.map.layers.length&&o.map.insertLayer(n,l,i)}};if(!e.isBase&&!e.options.stealth){TC.control.MapContents.prototype.updateLayerTree.call(o,e);for(var n=!1,a=0,l=o.layers.length;a<l;a++)if(e===o.layers[a]){n=!0;break}if(!n){var s=o.CLASS+"-elm";o.layers.push(e);TC.loadJSInOrder(!window.dust,TC.url.templating,function(){TC.loadJS(!$.fn.drag,[TC.apiLocation+"lib/jQuery/jquery.event.drag.js"],function(){var r=e.title||e.wrap.getServiceTitle(),n={title:e.options.hideTitle?"":r,hide:!(!e.renderOptions||!e.renderOptions.hide),opacity:e.renderOptions&&e.renderOptions.opacity?100*e.renderOptions.opacity:100,customLegend:e.customLegend},a=e.isRaster();if(a){n.layerNames=e.layerNames;var l=e.getPath();l.shift();n.path=l;var p=e.names[0],c=e.wrap.getInfo(p);n.legend=c.legend;n.abstract=c.abstract;var u,g=c.hasOwnProperty("abstract")||c.hasOwnProperty("legend")||c.hasOwnProperty("metadata");if(e.tree&&e.tree.children&&e.tree.children.length&&e.tree.children[0].children&&e.tree.children[0].children.length)u=null;else if(u=c.metadata)for(var d=0,h=u.length;d<h;d++){var f=u[d];f.formatDescription=o.getLocaleString(TC.Util.getSimpleMimeType(f.format))||o.getLocaleString("viewMetadata")}n.metadata=u}(function(e){var t=$.Deferred();e&&e.options.method&&"POST"===e.options.method?e.getLegendGraphicImage().done(function(e){t.resolve(e)}).fail(function(e){TC.error(e)}):t.resolve();return t.promise()})(e).done(function(r){r&&(legend.src=e.getLegendUrl(r));dust.render(s,n,function(r,n){var l,s=$(n),c=!1;if(a&&!(c=e.names.length>1))for(var u=e.wrap.getAllLayerNodes(),d=0;d<u.length;d++){var h=u[d];if(e.wrap.getName(h)===p){l=h;e.wrap.getLayerNodes(h).length>0&&(c=!0);break}}var f=s.find("."+o.CLASS+"-type"),y=c?o.CLASS+"-type-grp":o.CLASS+"-type-sgl";f.addClass(y);g||s.find("."+o.CLASS+"-btn-info").addClass(TC.Consts.classes.HIDDEN);if(l){e.wrap.normalizeLayerNode(l);dust.render(y,l,function(e,t){var r;f.on("mouseover",function(e){var i=f.offset(),n=$(o.map.div).offset();r=$("<div>").addClass(o.CLASS+"-tip").html(t).css({top:i.top-n.top+"px",right:$(o.map.div).width()-(i.left-n.left)+"px"}).appendTo(o.map.div)}).on("mouseout",function(e){r.remove()})})}var m=o._$div.find("ul").first();s.data(t,e);s.drag("start",function(e,t){var o=$(this),r=m.children("li");r.not(o).addClass(TC.Consts.classes.DRAGEND);r.index(o);o.css("zIndex",100).addClass(TC.Consts.classes.DRAG);var i=r.last(),n=o.position();t.limit={top:r.first().position().top-n.top,bottom:i.height()+i.position().top-n.top-o.height()-1};t.dropTargetIndex=-1}).drag("end",function(e,t){var o=$(this);o.removeClass(TC.Consts.classes.DRAG).addClass(TC.Consts.classes.DRAGEND);var r,n,a=function(e){return parseInt(e.substr(e.lastIndexOf(",")+1))},l=a(o.css("transform")),s=this.getBoundingClientRect().top-l;if(t.dropTargetIndex>=0){r=m.children("li").get(t.dropTargetIndex);var p=a((n=$(r)).css("transform")),c=r.getBoundingClientRect().top-p}o.css("transform",n?"translateY("+(c-s)+"px)":"");o.on("transitionend.tc",function e(t){if("transform"===t.originalEvent.propertyName){o.off("transitionend.tc",e).removeClass(TC.Consts.classes.DRAGEND).css("zIndex","");n&&i(o,n,function(){m.children("li").css("transform","").removeClass(TC.Consts.classes.DRAGEND)})}})}).drag(function(e,t){var o,r,i=$(this),n=Math.min(Math.max(t.limit.top,Math.round(t.deltaY)),t.limit.bottom),a=this.getBoundingClientRect(),l=a.height-1,s=(a.top+a.bottom)/2,p=[];m.children("li").each(function(e,r){var i=r.getBoundingClientRect();p[e]={elm:r,top:i.top,bottom:i.bottom};r===t.drag&&(o=e)});for(var c=-1,u=0,g=p.length;u<g;u++){var d=p[u];if(u<o){if(s<d.bottom)if(s>d.top&&t.deltaY>t.prevDeltaY)r="";else{r="translateY("+l+"px)";c<0&&(c=u)}else r="";$(d.elm).css("transform",r)}else if(u>o){if(s>d.top)if(s<d.bottom&&t.deltaY<t.prevDeltaY)r="";else{r="translateY(-"+l+"px)";c=u}else r="";$(d.elm).css("transform",r)}}t.dropTargetIndex=c;i.css("transform","translateY("+n+"px)");t.prevDeltaY=t.deltaY},{handle:"."+o.CLASS+"-dd"}).on("keydown",function(e){var t=this,o=function(){t.focus()},r=$(this);switch(!0){case/Up$/.test(e.key):var n=r.prev();n.length&&i(r,n,o);break;case/Down$/.test(e.key):var a=r.next();a.length&&i(r,a,o)}});const v=o.map.workLayers.filter(function(e){return!e.stealth}).reverse().indexOf(e),C=m.find("li."+o.CLASS+"-elm");C.length<=v?m.append(s):s.insertBefore(C[v]);o.updateScale()})})})});var p=r(o);$("."+o.CLASS+"-n").text(p).toggleClass(TC.Consts.classes.VISIBLE,p>0);o._$div.find("."+o.CLASS+"-empty").toggleClass(TC.Consts.classes.HIDDEN,p>0);o._$div.find("."+o.CLASS+"-content").toggleClass(TC.Consts.classes.HIDDEN,0===p);o._$div.find("."+o.CLASS+"-del-all").toggleClass(TC.Consts.classes.HIDDEN,!1)}}};e.updateScale=function(){var e=this;e._$div.find("ul").find("li."+e.CLASS+"-elm").each(function(o,r){var i=$(r),n=i.data(t);if(n.names){for(var a=!1,l=0;l<n.names.length;l++)if(n.isVisibleByScale(n.names[l])){a=!0;break}i.toggleClass(e.CLASS+"-elm-notvisible",!a)}})};e.updateLayerOrder=function(e,t,o){TC.control.MapContents.prototype.updateLayerOrder.call(this,e,t,o)};e.removeLayer=function(e){var o=this.layers.indexOf(e);o>=0&&this.layers.splice(o,1);this._$div.find("ul").first().find("li."+this.CLASS+"-elm").each(function(o,r){var i=$(r);if(i.data(t)===e){i.remove();return!1}});var i=r(this);this._$div.find("."+this.CLASS+"-del-all").toggleClass(TC.Consts.classes.HIDDEN,0===i);this._$div.find("."+this.CLASS+"-content").toggleClass(TC.Consts.classes.HIDDEN,0===i);this._$div.find("."+this.CLASS+"-empty").toggleClass(TC.Consts.classes.HIDDEN,i>0);$("."+this.CLASS+"-n").text(i).toggleClass(TC.Consts.classes.VISIBLE,i>0)};e.getLayerUIElements=function(){return this._$div.find("ul").first().children("li."+this.CLASS+"-elm")}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.control.Click=function(){TC.Control.apply(this,arguments);this.options&&this.options.callback&&(this.callback=this.options.callback);this.wrap=new TC.wrap.control.Click(this)};TC.inherit(TC.control.Click,TC.Control);!function(){var e=TC.control.Click.prototype;e.CLASS="tc-ctl-click";e.register=function(e){this.wrap.register(e);TC.Control.prototype.register.call(this,e)};e.activate=function(){TC.Control.prototype.activate.call(this);this.wrap.activate()};e.deactivate=function(){this.wrap.deactivate();TC.Control.prototype.deactivate.call(this)};e.callback=function(e,t){console.log("[Click]["+e[0]+", "+e[1]+"]["+t[0]+", "+t[1]+"]")}}();TC.control=TC.control||{};TC.control.Click||TC.syncLoadJS(TC.apiLocation+"TC/control/Click");TC.Consts.event.POPUPHIDE=TC.Consts.event.POPUPHIDE||"popuphide.tc";TC.Consts.event.RESULTSPANELCLOSE=TC.Consts.event.RESULTSPANELCLOSE||"resultspanelclose.tc";TC.control.FeatureInfoCommons=function(){const e=this;TC.control.Click.apply(e,arguments);e.resultsLayer=null;e.filterLayer=null;e._layersDeferred=$.Deferred();e.filterFeature=null;e.info=null;e.popup=null;e.highlightPopup=null;e.resultsPanel=null;e.lastFeatureCount=null;e.tools=[];e._$dialogDiv=$(TC.Util.getDiv(e.options.dialogDiv));e.options.dialogDiv||e._$dialogDiv.appendTo("body")};TC.control.FeatureInfoCommons.displayMode={POPUP:"popup",RESULTS_PANEL:"resultsPanel"};!function(){var e=function(e){return e.info.services?e.info.services.reduce(function(e,t){return e+t.layers.reduce(function(e,t){return e+1},0)},0):0},t="ul.tc-ctl-finfo-features li",o=function(e){$(e.getDisplayTarget()).find("ul."+e.CLASS+"-services li").removeClass(TC.Consts.classes.CHECKED).removeClass(TC.Consts.classes.DISABLED).removeClass(TC.Consts.classes.FROMLEFT).removeClass(TC.Consts.classes.FROMRIGHT)};TC.inherit(TC.control.FeatureInfoCommons,TC.control.Click);var r=TC.control.FeatureInfoCommons.prototype;r.CLASS="tc-ctl-finfo";r.template={};if(TC.isDebug){r.template[r.CLASS]=TC.apiLocation+"TC/templates/FeatureInfo.html";r.template[r.CLASS+"-dialog"]=TC.apiLocation+"TC/templates/FeatureInfoDialog.html";r.template[r.CLASS+"-del-btn"]=TC.apiLocation+"TC/templates/FeatureInfoDeleteButton.html"}else{r.template[r.CLASS]=function(){dust.register(r.CLASS,e);function e(e,o){return e.x(o.get(["elevation"],!1),o,{block:t},{}).w('<ul class="tc-ctl-finfo-services">').s(o.get(["services"],!1),o,{else:n,block:l},{}).w("</ul>").x(o.get(["featureCount"],!1),o,{block:I},{})}e.__dustBody=!0;function t(e,t){return e.w('<div class="tc-ctl-finfo-coords"><span class="tc-ctl-finfo-coords-pair tc-ctl-finfo-coords-crs">CRS: <span class="tc-ctl-finfo-coords-val">').f(t.get(["crs"],!1),t,"h").w("</span></span> ").x(t.get(["isGeo"],!1),t,{else:o,block:i},{}).w(' <span class="tc-ctl-finfo-coords-pair">').h("i18n",t,{},{$key:"ele"}).w(': <span class="tc-ctl-finfo-coords-val">').f(t.get(["elevation"],!1),t,"h").w(" m</span></span></div>")}t.__dustBody=!0;function o(e,t){return e.w('<span class="tc-ctl-finfo-coords-pair tc-ctl-finfo-coords-x">x: <span class="tc-ctl-finfo-coords-val">').f(t.getPath(!1,["coords","0"]),t,"h").w('</span></span> <span class="tc-ctl-finfo-coords-pair tc-ctl-finfo-coords-x">y: <span class="tc-ctl-finfo-coords-val">').f(t.getPath(!1,["coords","1"]),t,"h").w("</span></span> ")}o.__dustBody=!0;function i(e,t){return e.w('<span class="tc-ctl-finfo-coords-pair tc-ctl-finfo-coords-lat">').h("i18n",t,{},{$key:"lat"}).w(': <span class="tc-ctl-finfo-coords-val">').f(t.getPath(!1,["coords","1"]),t,"h").w('</span></span> <span class="tc-ctl-finfo-coords-pair tc-ctl-finfo-coords-lon">').h("i18n",t,{},{$key:"lon"}).w(': <span class="tc-ctl-finfo-coords-val">').f(t.getPath(!1,["coords","0"]),t,"h").w("</span></span> ")}i.__dustBody=!0;function n(e,t){return e.nx(t.get(["elevation"],!1),t,{block:a},{})}n.__dustBody=!0;function a(e,t){return e.w('<li class="tc-ctl-finfo-empty">').h("i18n",t,{},{$key:"noData"}).w("</li>")}a.__dustBody=!0;function l(e,t){return e.w("<li><h3>").x(t.get(["title"],!1),t,{else:s,block:u},{}).w('</h3><div class="tc-ctl-finfo-service-content">').s(t.get(["hasLimits"],!1),t,{else:g,block:M},{}).w("</div></li>")}l.__dustBody=!0;function s(e,t){return e.x(t.getPath(!1,["mapLayer","title"]),t,{else:p,block:c},{})}s.__dustBody=!0;function p(e,t){return e.f(t.getPath(!1,["mapLayer","id"]),t,"h")}p.__dustBody=!0;function c(e,t){return e.f(t.getPath(!1,["mapLayer","title"]),t,"h")}c.__dustBody=!0;function u(e,t){return e.f(t.get(["title"],!1),t,"h")}u.__dustBody=!0;function g(e,t){return e.w('<ul class="tc-ctl-finfo-layers">').s(t.get(["layers"],!1),t,{else:d,block:h},{}).w("</ul>")}g.__dustBody=!0;function d(e,t){return e.w('<li class="tc-ctl-finfo-empty">').h("i18n",t,{},{$key:"noDataAtThisService"}).w("</li>")}d.__dustBody=!0;function h(e,t){return e.w('<li><h4><span class="tc-ctl-finfo-layer-n">').f(t.getPath(!1,["features","length"]),t,"h").w("</span> ").s(t.get(["path"],!1),t,{block:f},{}).w(' </h4> <div class="tc-ctl-finfo-layer-content"><ul class="tc-ctl-finfo-features">').s(t.get(["features"],!1),t,{else:m,block:v},{}).w("</ul></div></li>")}h.__dustBody=!0;function f(e,t){return e.f(t.getPath(!0,[]),t,"h").h("sep",t,{block:y},{})}f.__dustBody=!0;function y(e,t){return e.w(" &bull; ")}y.__dustBody=!0;function m(e,t){return e.w('<li class="tc-ctl-finfo-empty">').h("i18n",t,{},{$key:"noDataInThisLayer"}).w("</li>")}m.__dustBody=!0;function v(e,t){return e.w("<li>").x(t.get(["rawContent"],!1),t,{else:C,block:P},{}).w("</li>")}v.__dustBody=!0;function C(e,t){return e.x(t.get(["error"],!1),t,{else:T,block:x},{})}C.__dustBody=!0;function T(e,t){return e.w("<h5>").f(t.get(["id"],!1),t,"h").w("</h5><table").x(t.get(["geometry"],!1),t,{block:S},{}).w("><tbody>").s(t.get(["attributes"],!1),t,{block:_},{}).w("</tbody></table>").x(t.get(["geometry"],!1),t,{block:E},{})}T.__dustBody=!0;function S(e,t){return e.w(' title="').h("i18n",t,{},{$key:"clickToCenter"}).w('"')}S.__dustBody=!0;function _(e,t){return e.w('<tr><th class="tc-ctl-finfo-attr">').f(t.get(["name"],!1),t,"h").w('</th><td class="tc-ctl-finfo-val">').f(t.get(["value"],!1),t,"h").w("</td></tr>")}_.__dustBody=!0;function E(e,t){return e.w('<div class="tc-ctl-finfo-tools"><button class="tc-ctl-finfo-tools-btn" title="').h("i18n",t,{},{$key:"download"}).w("/").h("i18n",t,{},{$key:"share"}).w('">').h("i18n",t,{},{$key:"download"}).w("/").h("i18n",t,{},{$key:"share"}).w("</button></div>")}E.__dustBody=!0;function x(e,t){return e.w('<span class="tc-ctl-finfo-errors">').h("i18n",t,{},{$key:"fi.error"}).w('<span class="tc-ctl-finfo-error-text">').f(t.get(["error"],!1),t,"h").w("</span></span>")}x.__dustBody=!0;function P(e,t){return e.w("<h5>").h("i18n",t,{},{$key:"feature"}).w("</h5>").h("eq",t,{else:L,block:w},{key:t.get(["rawFormat"],!1),value:"text/html"})}P.__dustBody=!0;function L(e,t){return e.w("<pre>").f(t.get(["rawContent"],!1),t,"h").w("</pre>")}L.__dustBody=!0;function w(e,t){return e.w(" ").x(t.get(["expandUrl"],!1),t,{block:b},{})}w.__dustBody=!0;function b(e,t){return e.h("ne",t,{else:R,block:A},{key:t.get(["expandUrl"],!1),value:""})}b.__dustBody=!0;function R(e,t){return e.w('<iframe src="').f(t.get(["rawUrl"],!1),t,"h").w('" />')}R.__dustBody=!0;function A(e,t){return e.w('<div class="tc-ctl-finfo-features-iframe-cnt"><iframe src="').f(t.get(["rawUrl"],!1),t,"h").w('" /><a class="tc-ctl-finfo-open" onclick="window.open(\'').f(t.get(["expandUrl"],!1),t,"h").w("', '_blank')\" title=\"").h("i18n",t,{},{$key:"expand"}).w('"></a></div>')}A.__dustBody=!0;function M(e,t){return e.w('<span class="tc-ctl-finfo-errors">').f(t.get(["hasLimits"],!1),t,"h").w("</span>")}M.__dustBody=!0;function I(e,t){return e.h("gt",t,{block:O},{key:t.get(["featureCount"],!1),value:"1",type:"number"})}I.__dustBody=!0;function O(e,t){return e.w('<a class="tc-ctl-btn tc-ctl-finfo-btn-prev">').h("i18n",t,{},{$key:"previous"}).w('</a><div class="tc-ctl-finfo-counter"><span class="tc-ctl-finfo-counter-current"></span>/').f(t.get(["featureCount"],!1),t,"h").w('</div><a class="tc-ctl-btn tc-ctl-finfo-btn-next">').h("i18n",t,{},{$key:"next"}).w("</a>")}O.__dustBody=!0;return e};r.template[r.CLASS+"-dialog"]=function(){dust.register(r.CLASS+"-dialog",e);function e(e,t){return e.w('<div class="tc-ctl-finfo-dialog tc-modal"><div class="tc-modal-background tc-modal-close"></div><div class="tc-modal-window"><div class="tc-modal-header"><h3>').h("i18n",t,{},{$key:"feature"}).w('</h3><div class="tc-ctl-popup-close tc-modal-close"></div></div><div class="tc-modal-body"><div class="tc-ctl-finfo-dialog-dl"><h2>').h("i18n",t,{},{$key:"download"}).w('</h2><div><button class="tc-button tc-btn-dl tc-ctl-finfo-dl-btn-kml" data-format="KML" title="KML">KML</button><button class="tc-button tc-btn-dl tc-ctl-finfo-dl-btn-gml" data-format="GML" title="GML">GML</button><button class="tc-button tc-btn-dl tc-ctl-finfo-dl-btn-geojson" data-format="GeoJSON" title="GeoJSON">GeoJSON</button><button class="tc-button tc-btn-dl tc-ctl-finfo-dl-btn-wkt" data-format="WKT" title="WKT">WKT</button></div></div><div class="tc-ctl-finfo-dialog-share"></div></div></div></div>')}e.__dustBody=!0;return e};r.template[r.CLASS+"-del-btn"]=function(){dust.register(r.CLASS+"-del-btn",e);function e(e,t){return e.w('<button class="tc-ctl-finfo-del-btn" title="').h("i18n",t,{},{$key:"deleteFeature"}).w('">').h("i18n",t,{},{$key:"deleteFeature"}).w("</button>")}e.__dustBody=!0;return e}}r.register=function(e){var t,o,r=this;TC.control.Click.prototype.register.call(r,e);r._addHighlightPopup().then(function(e){r.highlightPopup=e});t=r.options.resultsLayer?r.options.resultsLayer:{id:r.getUID(),title:r.CLASS+": Results layer",type:TC.Consts.layerType.VECTOR,stealth:!0};o=r.options.filterLayer?r.options.filterLayer:{id:r.getUID(),title:r.CLASS+": Filter layer",stealth:!0,type:TC.Consts.layerType.VECTOR,styles:{line:{strokeColor:r.lineColor,strokeWidth:2},polygon:{strokeColor:r.lineColor,strokeWidth:2,fillColor:"#000",fillOpacity:.3}}};e.loaded(function(){$.when(e.addLayer(t),e.addLayer(o)).then(function(e,t){r.resultsLayer=e;r.filterLayer=t;r._layersDeferred.resolve()})});r.displayMode=r.options.displayMode||TC.control.FeatureInfoCommons.displayMode.POPUP;r.setDisplayMode(r.displayMode);e.on(TC.Consts.event.POPUPHIDE+" "+TC.Consts.event.RESULTSPANELCLOSE,function(t){if(t.control===r.getDisplayControl()&&r.resultsLayer){const t=e.getControlsByClass("TC.control.Popup");r.resultsLayer.features.filter(function(e){return!t.some(function(t){return t.currentFeature===e})}).forEach(function(e){r.resultsLayer.removeFeature(e)});clearTimeout(r._removeFilterFeatureTimeout);r._removeFilterFeatureTimeout=setTimeout(function(){r.querying||r.filterLayer.clearFeatures()},0)}}).on(TC.Consts.event.POPUP,function(e){const t=e.control;r.resultsLayer&&r.resultsLayer.features.indexOf(t.currentFeature)>=0&&r._processHighlightPopup(t)})};r.render=function(e){var t=this;t._$div.addClass(TC.Consts.classes.HIDDEN);t.getRenderedHtml(t.CLASS+"-dialog",null,function(e){t._$dialogDiv.html(e).on(TC.Consts.event.CLICK,"button[data-format]",function(e){TC.Util.closeModal();var o=t.resultsLayer.features[t.resultsLayer.features.length-1];t.map.exportFeatures([o],{fileName:o.id,format:$(e.target).data("format")})})})};r.responseCallback=function(e){const t=this;t.querying=!1;e&&e.services&&e.services.forEach(function(e){e.layers.forEach(function(e){e.features.forEach(function(e){e.popup=t.highlightPopup})})});if(e.featureCount){t.map.$events.trigger($.Event(TC.Consts.event.FEATUREINFO,$.extend({control:t},e)));t.lastFeatureCount=e.featureCount}else{t.map.$events.trigger($.Event(TC.Consts.event.NOFEATUREINFO,{control:t}));t.lastFeatureCount=0;t.closeResults()}};r.responseError=function(e){const t=this;404===e.status&&t.map.toast(t.getLocaleString("featureInfo.tooManyLayers"),{type:TC.Consts.msgType.ERROR});t.responseCallback({})};r.markerStyle={cssClass:TC.Consts.classes.POINT,anchor:[.5,.5],width:15,height:15,noPrint:!0};r.setDisplayMode=function(e){var t=this;t.displayMode=e;var o=t.map;switch(e){case TC.control.FeatureInfoCommons.displayMode.RESULTS_PANEL:if(!t.resultsPanel){var r=o.getControlsByClass("TC.control.ResultsPanel")[0];if(r)t.resultsPanel=r;else{o.on(TC.Consts.event.CONTROLADD,function e(r){if(TC.control.ResultsPanel&&r.control instanceof TC.control.ResultsPanel){t.resultsPanel=r.control;o.off(TC.Consts.event.CONTROLADD,e)}})}}break;default:t.displayMode=TC.control.FeatureInfoCommons.displayMode.POPUP;t.popup||$.when(o.addControl("popup",{closeButton:!0,draggable:t.options.draggable})).then(function(e){t.popup=e;e.caller=t;o.on(TC.Consts.event.POPUP,function(e){t.onShowPopUp(e)});o.on(TC.Consts.event.POPUPHIDE,function(o){o.control===e&&t.popup.$popupDiv.css("width","auto")})})}};r.getDisplayControl=function(){switch(this.displayMode){case TC.control.FeatureInfoCommons.displayMode.RESULTS_PANEL:return this.resultsPanel;default:return this.popup}};r.getDisplayTarget=function(){switch(this.displayMode){case TC.control.FeatureInfoCommons.displayMode.RESULTS_PANEL:return this.resultsPanel.$divTable.get(0);default:return this.popup.$popupDiv.get(0)}};r.displayResults=function(){this.filterFeature.data=$("<div>").append(this._$div.clone().removeClass(TC.Consts.classes.HIDDEN)).html();switch(this.displayMode){case TC.control.FeatureInfoCommons.displayMode.RESULTS_PANEL:$(this.getDisplayTarget()).html(this.filterFeature.data);this.resultsPanel.open(this.filterFeature.data);this.displayResultsCallback();break;default:this.popup&&this.filterFeature.showPopup(this.popup)}};r.getFeatureElement=function(e){var o,r=this;$(r.getDisplayTarget()).find(t).each(function(t,i){var n=$(i),a=n.parents("li").first(),l=a.parents("li").first();r.getFeature(r.info,l.index(),a.index(),n.index())===e&&(o=n)});return o&&o.get(0)};r.getNextFeatureElement=function(e){var t=$(this.getDisplayTarget()).find("ul."+this.CLASS+"-features > li"),o=t.length,r=t.filter("."+TC.Consts.classes.CHECKED),i=t.index(r.get(0));return t.get((i+e+o)%o)};r.closeResults=function(){switch(this.displayMode){case TC.control.FeatureInfoCommons.displayMode.RESULTS_PANEL:this.resultsPanel&&this.resultsPanel.isVisible()&&this.resultsPanel.close();break;default:this.popup&&this.popup.isVisible()&&this.popup.hide()}};r.displayResultsCallback=function(){var r,i=this,n=$(i.getDisplayTarget()).find("."+i.CLASS).first(),a="click";n.on(a,t,function(e){i.highlightFeature(this)});a="mouseenter";n.on(a,t,function(e){$(this).parents("."+i.CLASS+"-layers > li").hasClass(TC.Consts.classes.CHECKED)&&i.highlightFeature(this)});a=TC.Consts.event.CLICK;r="."+i.CLASS+"-btn-next";n.on(a,r,function(e){i.highlightFeature(i.getNextFeatureElement(1),1);return!1});r="."+i.CLASS+"-btn-prev";n.on(a,r,function(e){i.highlightFeature(i.getNextFeatureElement(-1),-1);return!1});r="ul."+i.CLASS+"-layers h4";n.on(a,r,function(r){var a=$(r.target).parents("li").first();if(a.hasClass(TC.Consts.classes.CHECKED))"none"===n.find(".tc-ctl-finfo-btn-next").css("display")&&e(i)>1&&o(i);else{i.highlightFeature(a.find(t).first()[0]);i.displayMode===TC.control.FeatureInfoCommons.displayMode.POPUP&&i.popup.fitToView(!0)}});r="."+i.CLASS+"-tools-btn";n.on(a,r,function(e){var t=new $.Deferred;i._shareCtl?t.resolve():i.map.addControl("share",{div:i._$dialogDiv.find(".tc-modal-body .tc-ctl-finfo-dialog-share"),includeControls:!1}).then(function(e){i._shareCtl=e;t.resolve()});$.when(t).then(function(){TC.Util.showModal(i._$dialogDiv.find("."+i.CLASS+"-dialog"),{openCallback:function(){i.onShowModal()}})})});if(i.info)if(i.info.defaultFeature){$(i.getFeatureElement(i.info.defaultFeature)).addClass(TC.Consts.classes.DEFAULT);i.highlightFeature(i.info.defaultFeature)}else i.highlightFeature(n.find(t).first()[0]);n.find("table").on(TC.Consts.event.CLICK,function(e){if(!$(this).parent().hasClass(TC.Consts.classes.DISABLED)){if(i.resultsLayer.features[0]){i.map.on(TC.Consts.event.ZOOM,function e(){i._zooming=!1;i.map.off(TC.Consts.event.ZOOM,e)});i._zooming=!0;i.map.zoomToFeatures([i.resultsLayer.features[0]],{animate:!0})}e.stopPropagation()}});n.find("table a").on("click",function(e){e.stopPropagation()});if(Modernizr.touch&&i.displayMode===TC.control.FeatureInfoCommons.displayMode.RESULTS_PANEL&&"none"!==n.find("."+i.CLASS+"-btn-prev").css("display")){i.resultsPanel&&i.resultsPanel._$div.swipe("disable");e(i)>1&&n.swipe({swipeLeft:function(e){i.highlightFeature(i.getNextFeatureElement(1),1);e.stopPropagation()},swipeRight:function(e){i.highlightFeature(i.getNextFeatureElement(-1),-1);e.stopPropagation()}})}};r.onShowPopUp=function(e){this.map;if(e.control===this.popup){this.displayResultsCallback();this.fitSize()}};r.onShowModal=function(){};r.insertLinks=function(){const e=this.getLocaleString("open"),t=this.getLocaleString("linkInNewWindow");this._$div.find("td."+this.CLASS+"-val").each(function(o,r){const i=$(r),n=i.text();TC.Util.isURL(n)&&i.html('<a href="'+n+'" target="_blank" title="'+t+'">'+e+"</a>")})};r.highlightFeature=function(e,t){(function(e,t){if(!e._zooming){var r,i,n,a;if(this instanceof TC.Feature){r=this;var l=e.getFeatureElement(r);l&&(i=$(l))}else i=$(this);a=(n=i.parents("li").first()).parents("li").first();o(e);i.addClass(TC.Consts.classes.CHECKED);n.addClass(TC.Consts.classes.CHECKED);a.addClass(TC.Consts.classes.CHECKED);if(t>0){i.addClass(TC.Consts.classes.FROMLEFT);n.addClass(TC.Consts.classes.FROMLEFT);a.addClass(TC.Consts.classes.FROMLEFT)}else if(t<0){i.addClass(TC.Consts.classes.FROMRIGHT);n.addClass(TC.Consts.classes.FROMRIGHT);a.addClass(TC.Consts.classes.FROMRIGHT)}var s=a.index(),p=n.index(),c=i.index();r=r||e.getFeature(e.info,s,p,c);$(e.getDisplayTarget()).find("."+e.CLASS+"-counter-current").html(e.getFeatureIndex(e.info,s,p,c)+1);var u=e.resultsLayer.features.slice();if(u.filter(function(e){return r&&r.id===e.id}).length>0)return;for(var g=0;g<u.length;g++){var d=u[g];d!==e.filterFeature&&e.resultsLayer.removeFeature(d)}r&&r.geometry?e.resultsLayer.addFeature(r):i.addClass(TC.Consts.classes.DISABLED)}}).call(e,this,t)};r.fitSize=function(){var e=this,t=$(e.getDisplayTarget()),o=0;t.find(".tc-ctl-finfo-features li").each(function(e,t){o=Math.max(o,$(t).position().left+$(t).width())});o&&t.width(o+50)};r.getFeature=function(e,t,o,r){var i;e&&e.services&&(i=e.services[t])&&(i=i.layers[o])&&(i=i.features[r]);return i};r.getFeatureIndex=function(e,t,o,r){var i=-1;if(e)for(var n=0;n<=t;n++)for(var a=e.services[n],l=n===t?o:a.layers.length-1,s=0;s<=l;s++)for(var p=a.layers[s],c=s===o?r:p.features.length-1,u=0;u<=c;u++)i+=1;return i};r.beforeRequest=function(e){this.querying=!0;this.map.$events.trigger($.Event(TC.Consts.event.BEFOREFEATUREINFO,{xy:e.xy,control:this}));this.closeResults();if(this.map&&this.resultsLayer){this.lastFeatureCount=null;this.resultsLayer.clearFeatures();this.info=null}};r.activate=function(){this.wrap&&this.wrap.activate();TC.Control.prototype.activate.call(this)};r.deactivate=function(e){this.popup&&this.popup.hide();this.resultsLayer.clearFeatures();this.filterLayer.clearFeatures();this.wrap&&this.wrap.deactivate();TC.Control.prototype.deactivate.call(this,e)};r.exportState=function(){const e=this;return e.exportsState?{id:e.id,layer:e.resultsLayer.exportState()}:null};r.importState=function(e){const t=this;t._layersDeferred.then(function(){t.resultsLayer.importState(e.layer)})};r._addHighlightPopup=function(){const e=this,t=e.map.addControl("popup",{div:TC.Util.getDiv(),closeButton:!0});t.then(function(t){t.$popupDiv&&t.$popupDiv.addClass(e.CLASS+"-lite")});return t};r._processHighlightPopup=function(e){const t=this,o=e.currentFeature;for(var r,i,n=!1,a=0,l=t.info.services.length;!n&&a<l;a++){const e=t.info.services[a];for(var s=0,p=e.layers.length;!n&&s<p;s++){const t=e.layers[s];for(var c=0,u=t.features.length;!n&&c<u;c++)if(t.features[c]===o){r=e.title;i=t.path.join(" &bull; ");n=!0}}}$("<h4>").html(i).prependTo(e.$contentDiv);$("<h3>").html(r).prependTo(e.$contentDiv);t.getRenderedHtml(t.CLASS+"-del-btn",null,function(r){e.$popupDiv.append(r);e.$popupDiv.find("."+t.CLASS+"-del-btn").on(TC.Consts.event.CLICK,function(r){t.resultsLayer.removeFeature(o);e.hide()})})}}();TC.control=TC.control||{};TC.Consts=TC.Consts||{};TC.Consts.SCREEN_SIZE_KEY="TC.Map.screenSize";TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.control.Scale=function(){TC.Control.apply(this,arguments)};TC.inherit(TC.control.Scale,TC.Control);!function(){var e=TC.control.Scale.prototype;e.CLASS="tc-ctl-scl";TC.isDebug?e.template=TC.apiLocation+"TC/templates/Scale.html":e.template=function(){dust.register(e.CLASS,t);function t(e,t){return e.w('<div class="ol-scale-line ol-unselectable"><span>1:').h("math",t,{},{key:o,method:"round"}).w('</span> <input type="button" value="').f(t.get(["screenSize"],!1),t,"h").w("''\" title=\"").h("i18n",t,{},{$key:"estimatedMapSize"}).w('" /></div>')}t.__dustBody=!0;function o(e,t){return e.f(t.get(["scale"],!1),t,"h")}o.__dustBody=!0;return t};e.render=function(e){var t=this;$("input[type=button]",t._$div).off();t.renderData({scale:t.getScale(),screenSize:TC.Cfg.screenSize},function(){var o=t._$div.find("span");o.text("1:"+t.format(o.text().substr(2)));t._$div.find('input[type="button"]').on(TC.Consts.event.CLICK,function(){t.setScreenSize.call(t)});$.isFunction(e)&&e()})};e.register=function(e){var t=this;TC.Control.prototype.register.call(t,e);var o=TC.Util.storage.getLocalValue(TC.Consts.SCREEN_SIZE_KEY);o&&(TC.Cfg.screenSize=o);t.render(function(){e.on(TC.Consts.event.ZOOM,function(){delete t.metersPerDegree;t.update()})})};e.update=function(){this.render()};e.setScreenSize=function(){var e=this;TC.prompt(e.getLocaleString("selectScreenSize"),TC.Cfg.screenSize,function(t){if(t){TC.Cfg.screenSize=parseFloat(t);TC.Util.storage.setLocalValue(TC.Consts.SCREEN_SIZE_KEY,TC.Cfg.screenSize);e.update()}})};e.getScale=function(e){var t=0,o=!e&&this.map?this.map.wrap.getResolution():e;if(o){t=o*this.getDpi(TC.Cfg.screenSize)/.0254;window.devicePixelRatio&&(t*=window.devicePixelRatio)}if(this.map&&this.map.wrap.isGeo()){if(!this.metersPerDegree){var r=this.map.getExtent();r&&(this.metersPerDegree=TC.Util.getMetersPerDegree(r))}this.metersPerDegree&&(t*=this.metersPerDegree)}return t};e.getDpi=function(e){this.dpi=Math.sqrt(screen.width*screen.width+screen.height*screen.height)/e;return this.dpi};e.format=function(e){for(var t=new Number(e).toFixed(0),o=[];t.length>3;){var r=t.length-3;o.unshift(t.substr(r));t=t.substr(0,r)}t&&o.unshift(t);return o.join(".")}}();TC.control=TC.control||{};TC.control.MapContents||TC.syncLoadJS(TC.apiLocation+"TC/Control");!function(){TC.control.SWCacheClient=function(){this.serviceWorkerEnabled=!1;this._serviceWorkerDeferred=$.Deferred()};TC.inherit(TC.control.SWCacheClient,TC.Control);var e=TC.control.SWCacheClient.prototype;e.CLASS="tc-ctl-swcc";e.register=function(e){var t=this;TC.Control.prototype.register.call(t,e);navigator.serviceWorker?navigator.serviceWorker.register("tc-cb-service-worker.js",{scope:"./"}).then(function(e){t.serviceWorkerEnabled=!0;e.installing?t._serviceWorkerDeferred.resolve(e.installing):e.waiting?t._serviceWorkerDeferred.resolve(e.waiting):e.active&&t._serviceWorkerDeferred.resolve(e.active);console.log(e.scope,"register")},function(e){t.serviceWorkerEnabled=!1;t._serviceWorkerDeferred.reject();console.error("Could not register service worker: "+e)}):t._serviceWorkerDeferred.reject()};e.getServiceWorker=function(){return this._serviceWorkerDeferred.promise()};var t=function(e,t,o,r){navigator.serviceWorker.addEventListener("message",function i(n){if(n.data.name===t){n.data.action===o&&n.data.event===r?e.resolve(t):"error"===n.data.event&&e.reject();navigator.serviceWorker.removeEventListener("message",i)}})};e.createCache=function(e,o){var r=$.Deferred();this.getServiceWorker().then(function(i){var n=o||{};t(r,e,"create","cached");i.postMessage({action:"create",name:e,list:n.urlList||[],silent:n.silent})},function(){r.resolve(!1)});return r.promise()};e.deleteCache=function(e,o){var r=$.Deferred();this.getServiceWorker().then(function(i){var n=o||{};t(r,e,"delete","deleted");i.postMessage({action:"delete",name:e,silent:n.silent})},function(){r.resolve(!1)});return r.promise()}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.Consts.event.POINT="point.tc";TC.control.Measure=function(){var e=this;TC.Control.apply(e,arguments);e.drawControls=[];e.persistentDrawControls=!1;e.NOMEASURE="-";this.renderPromise().then(function(){e.measureMode=e.options.mode;e.history=[];e.historyIndex=0;e.reset=!0;e.wrap=new TC.wrap.control.Measure(e);e._$len=e._$div.find(".tc-ctl-meas-val-len");e._$area=e._$div.find(".tc-ctl-meas-val-area");e._$peri=e._$div.find(".tc-ctl-meas-val-peri");e.setMode(e.options.mode)})};TC.inherit(TC.control.Measure,TC.Control);!function(){var e=TC.control.Measure.prototype;e.CLASS="tc-ctl-meas";TC.isDebug?e.template=TC.apiLocation+"TC/templates/Measure.html":e.template=function(){dust.register(e.CLASS,t);function t(e,t){return e.w("<h2>").h("i18n",t,{},{$key:"measure"}).w('</h2><div class="tc-ctl-meas-select"><form><label class="tc-ctl-meas-btn-len"><input type="radio" name="mode" value="polyline" /><span>').h("i18n",t,{},{$key:"length"}).w('</span></label><label class="tc-ctl-meas-btn-area"><input type="radio" name="mode" value="polygon" /><span>').h("i18n",t,{},{$key:"areaAndPerimeter"}).w('</span></label></form></div><div class="tc-ctl-meas-mode tc-ctl-meas-len tc-hidden"><div class="tc-ctl-meas-line"></div><div class="tc-ctl-meas-txt">').h("i18n",t,{},{$key:"length"}).w(': <span class="tc-ctl-meas-val-len"></span></div></div><div class="tc-ctl-meas-mode tc-ctl-meas-area tc-hidden"><div class="tc-ctl-meas-polygon"></div><div class="tc-ctl-meas-txt">').h("i18n",t,{},{$key:"area"}).w(': <span class="tc-ctl-meas-val-area"></span>, ').h("i18n",t,{},{$key:"perimeter"}).w(': <span class="tc-ctl-meas-val-peri"></span></div></div>')}t.__dustBody=!0;return t};e.render=function(e){var t=this;TC.Control.prototype.render.call(t,function(){TC.loadJS(!TC.control.Draw,TC.apiLocation+"TC/control/Draw",function(){t.options.mode&&t._$div.find(".tc-ctl-meas-select").addClass(TC.Consts.classes.HIDDEN);t._$div.find("span").on(TC.Consts.event.CLICK,function(e){var o=$(this).closest("label").find("input[type=radio][name=mode]"),r=o.val();o.prop("checked",!0);t.setMode(r,!0)});$.isFunction(e)&&e()})})};e.register=function(e){const t=this;TC.Control.prototype.register.call(t,e);const o=t.getUID(),r=t.getUID(),i=t.getUID();t.layerPromise=e.addLayer({id:o,title:t.getLocaleString("measure"),stealth:!0,type:TC.Consts.layerType.VECTOR,styles:{point:e.options.styles.point,line:e.options.styles.line,polygon:e.options.styles.polygon}});$.when(t.layerPromise,t.renderPromise()).then(function(o){t.layer=o;t.layer.map.putLayerOnTop(t.layer);t._drawLinesPromise=e.addControl("draw",{id:r,div:t._$div.find(".tc-ctl-meas-line"),mode:TC.Consts.geom.POLYLINE,measure:!0,persistent:t.persistentDrawControls,styleTools:t.persistentDrawControls,layer:t.layer});t._drawPolygonsPromise=e.addControl("draw",{id:i,div:t._$div.find(".tc-ctl-meas-polygon"),mode:TC.Consts.geom.POLYGON,measure:!0,persistent:t.persistentDrawControls,styleTools:t.persistentDrawControls,layer:t.layer});$.when(t._drawLinesPromise,t._drawPolygonsPromise).then(function(e,o){t.drawLines=e;t.drawPolygons=o;[e,o].forEach(function(e){e.containerControl=t;t.drawControls.push(e);e.$events.on(TC.Consts.event.MEASURE+" "+TC.Consts.event.MEASUREPARTIAL,function(e){t.showMeasures(e)}).on(TC.Consts.event.DRAWCANCEL,function(e){t.cancel()});e.exportsState=!1});t.setMode(t.options.mode)})})};e.displayMode=function(e){const t=this,o=t._$div.find(".tc-ctl-meas-mode");switch(e){case TC.Consts.geom.POLYLINE:t._$activeMode=o.filter(".tc-ctl-meas-len");break;case TC.Consts.geom.POLYGON:t._$activeMode=o.filter(".tc-ctl-meas-area");break;case null:case void 0:t._$activeMode=$()}const r=o.not(t._$activeMode);e?t._$div.find("input[type=radio][name=mode][value="+e+"]").prop("checked",!0).addClass(TC.Consts.classes.CHECKED).next().addClass(TC.Consts.classes.CHECKED):t._$div.find("input[type=radio][name=mode]").prop("checked",!1).removeClass(TC.Consts.classes.CHECKED).next().removeClass(TC.Consts.classes.CHECKED);t._$activeMode.removeClass(TC.Consts.classes.HIDDEN);t._$activeMode.find(".tc-ctl").removeClass(TC.Consts.classes.COLLAPSED);r.addClass(TC.Consts.classes.HIDDEN);return t};e.setMode=function(e){const t=this;t.mode=e;t.displayMode(e);var o;switch(e){case TC.Consts.geom.POLYLINE:t.drawLines.activate();o=TC.Consts.event.CONTROLACTIVATE;break;case TC.Consts.geom.POLYGON:t.drawPolygons.activate();o=TC.Consts.event.CONTROLACTIVATE;break;case null:case void 0:t.drawControls.forEach(function(e){e.isActive&&e.cancel()});o=TC.Consts.event.CONTROLDEACTIVATE;break;default:o=TC.Consts.event.CONTROLACTIVATE}t.resetValues();o&&t.map&&t.map.$events.trigger($.Event(o,{control:t}));return t};e.cancel=function(){this.setMode(null,!1);return this};e.showMeasures=function(e){const t=this;var o,r=(e=e||{}).units;const i=t.map.options.locale||TC.Cfg.locale;if(e.area){var n=e.area;if(n>1e4){n/=1e6;r="km"}o="m"===r?0:3;t._$area.html(TC.Util.formatNumber(n.toFixed(o),i)+" "+r+"&sup2;")}if(e.perimeter){var a=e.perimeter;if(a>1e3){a/=1e3;r="km"}o="m"===r?0:3;t._$peri.html(TC.Util.formatNumber(a.toFixed(o),i)+" "+r)}if(e.length){var l=e.length;if(l>1e3){l/=1e3;r="km"}o="m"===r?0:3;t._$len.html(TC.Util.formatNumber(l.toFixed(o),i)+" "+r)}return t};e.resetValues=function(){const e=this;if(e._$len){e._$len.text(e.NOMEASURE);e._$area.text(e.NOMEASURE);e._$peri.text(e.NOMEASURE)}return e};e.getDrawLines=function(){};e.exportState=function(){return{id:this.id,layer:this.layer.exportState()}};e.importState=function(e){this.layerPromise.then(function(t){t.importState(e.layer)})}}();TC.control=TC.control||{};TC.control.MapContents||TC.syncLoadJS(TC.apiLocation+"TC/Control");!function(){TC.control.ProjectionSelector=function(){const e=this;TC.Control.apply(e,arguments);e._cssClasses={LOAD_CRS_BUTTON:e.CLASS+"-crs-btn-load",CRS_DIALOG:e.CLASS+"-crs-dialog",CRS_LIST:e.CLASS+"-crs-list",CURRENT_CRS_NAME:e.CLASS+"-cur-crs-name",CURRENT_CRS_CODE:e.CLASS+"-cur-crs-code",CHANGE:e.CLASS+"-change",NO_CHANGE:e.CLASS+"-no-change"};e._$dialogDiv=$(TC.Util.getDiv(e.options.dialogDiv));e.options.dialogDiv||e._$dialogDiv.appendTo("body");e._$dialogDiv.on(TC.Consts.event.CLICK,"button",function(o){const r=$(o.target).data(t.PROJCODE);r&&e.setProjection({crs:r,allowFallbackLayer:!0})}).on(TC.Consts.event.CLICK,"button."+e._cssClasses.LOAD_CRS_BUTTON,function(t){e.loadFallbackProjections()})};TC.inherit(TC.control.ProjectionSelector,TC.Control);const e=TC.control.ProjectionSelector.prototype;e.CLASS="tc-ctl-projs";const t={LAYER:"tcLayer",FALLBACK_LAYER:"tcFallbackLayer",PROJCODE:"tcProjCode"};e.render=function(e){const t=this;TC.Control.prototype.render.call(t,e);t.getRenderedHtml(t.CLASS+"-dialog",null,function(e){t._$dialogDiv.html(e)})};e.getAvailableCRS=function(e){return this.map.getCompatibleCRS({includeFallbacks:!0})};e.showProjectionChangeDialog=function(e){const o=this,r=o._$dialogDiv.find("."+o._cssClasses.CRS_DIALOG),i=r.find(".tc-modal-body").addClass(TC.Consts.classes.LOADING),n=i.find("ul."+o._cssClasses.CRS_LIST).empty(),a=o.map.baseLayer.firstOption||o.map.baseLayer,l=a.getFallbackLayer(),s=a.getCompatibleCRS(),p=function(){o.map.loadProjections({crsList:o.getAvailableCRS(e),orderBy:"name"}).then(function(e){var a=!1;e.forEach(function(e){if(TC.Util.CRSCodesEqual(o.map.crs,e.code)){r.find("."+o._cssClasses.CURRENT_CRS_NAME).html(e.name);r.find("."+o._cssClasses.CURRENT_CRS_CODE).html(e.code)}else{const o=$("<button>").html(e.name+" ("+e.code+")").data(t.PROJCODE,e.code),r=$("<li>").append(o);if(0===s.filter(function(t){return TC.Util.CRSCodesEqual(t,e.code)}).length){a=!0;r.addClass(TC.Consts.classes.HIDDEN);o.addClass(TC.Consts.classes.WARNING)}n.append(r)}});a&&n.append($("<li>").append($("<button>").addClass(o._cssClasses.LOAD_CRS_BUTTON).html(o.getLocaleString("showOnTheFlyProjections"))));0===n.find("li").length&&n.append($("<li>").append(o.getLocaleString("thereAreNoCompatibleCRS")));const l=n.find("li").not("."+TC.Consts.classes.HIDDEN);r.find("."+o._cssClasses.CHANGE).css("display",l.length>1?"":"none");r.find("."+o._cssClasses.NO_CHANGE).css("display",l.length>1?"none":"");r.find("ul."+o._cssClasses.CRS_LIST).css("display",l.length>0||a?"":"none");i.removeClass(TC.Consts.classes.LOADING)})};l?l.getCapabilitiesPromise().then(p):p();TC.Util.showModal(r,e)};e.setProjection=function(e){const t=this;e=e||{};TC.loadProjDef({crs:e.crs,callback:function(){t.map.setProjection(e)}})};e.loadFallbackProjections=function(){const e=this._$dialogDiv.find("."+this._cssClasses.CRS_DIALOG).find("ul."+this._cssClasses.CRS_LIST+" li").removeClass(TC.Consts.classes.HIDDEN);e.has("button."+this._cssClasses.LOAD_CRS_BUTTON).addClass(TC.Consts.classes.HIDDEN);this._$dialogDiv.find("p."+TC.Consts.classes.WARNING).removeClass(TC.Consts.classes.HIDDEN);this._$dialogDiv.find("."+this._cssClasses.CHANGE).css("display",e.length>1?"":"none");this._$dialogDiv.find("."+this._cssClasses.NO_CHANGE).css("display",e.length>1?"none":"")}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.control.TabContainer=function(){TC.Control.apply(this,arguments);var e=this._classSelector="."+this.CLASS;this._selectors={TAB:e+"-tab",RADIOBUTTON:"input[type=radio][name=sctnr-sel]",ELEMENT:e+"-elm"};this.controlOptions=this.options.controls||[];var t=this.controlOptions.length;this._ctlDeferreds=new Array(t);for(var o=0;o<t;o++)this._ctlDeferreds[o]=$.Deferred();this.defaultSelection=this.options.defaultSelection};TC.inherit(TC.control.TabContainer,TC.Control);!function(){var e=TC.control.TabContainer.prototype;e.CLASS="tc-ctl-tctr";TC.isDebug?e.template=TC.apiLocation+"TC/templates/TabContainer.html":e.template=function(){dust.register(e.CLASS,t);function t(e,t){return e.w("<h2>").f(t.get(["title"],!1),t,"h").w('</h2><div class="tc-ctl-tctr-select"><form>').s(t.get(["controls"],!1),t,{block:o},{}).w("</form></div>").s(t.get(["controls"],!1),t,{block:r},{})}t.__dustBody=!0;function o(e,t){return e.w('<label class="tc-ctl-tctr-tab tc-ctl-tctr-tab-').f(t.get(["$idx"],!1),t,"h").w('" style="width:calc(100%/').f(t.get(["$len"],!1),t,"h").w(' - 1px)"><input type="radio" name="sctnr-sel" value="').f(t.get(["$idx"],!1),t,"h").w('" /><span>').f(t.get(["title"],!1),t,"h").w("</span></label>")}o.__dustBody=!0;function r(e,t){return e.w('<div class="tc-ctl-tctr-elm tc-ctl-tctr-elm-').f(t.get(["$idx"],!1),t,"h").w(' tc-hidden"></div>')}r.__dustBody=!0;return t};e.register=function(e){var t=this;TC.Control.prototype.register.call(t,e);const o=new Array(t.controlOptions.length);o.forEach(function(e,o,r){r[o]=t.getUID()});t.renderPromise().then(function(){t.title=t.title||t.getLocaleString(t.options.title||"moreControls");t._$div.find("h2").first().html(t.title);for(var r=new Array(t.controlOptions.length),i=0,n=t.controlOptions.length;i<n;i++){var a=t.controlOptions[i];r[i]=e.addControl(a.name,$.extend({id:o[i],div:t._$div.find("."+t.CLASS+"-elm-"+i)},a.options))}var l=function(e,o){e.renderPromise().then(function(){var r=t.getLocaleString(t.controlOptions[o].title)||e._$div.find("h2").first().html();e._$div.parents(t._classSelector).first().find(t._selectors.TAB+"-"+o+" span").html(r)})};$.when.apply(t,r).then(function(){for(var e=0,o=arguments.length;e<o;e++){var r=arguments[e];r.containerControl=t;l(r,e);t._ctlDeferreds[e].resolve(r)}})})};e.render=function(e){var t=this;t.renderData({title:t.title,controls:t.controlOptions},function(){var e=function(e){var o=$(this).closest(t._selectors.TAB).find(t._selectors.RADIOBUTTON),r=o.val(),i=t._$div.find(t._selectors.ELEMENT);if(t._oldValue===r&&t.options.deselectable){setTimeout(function(){o.prop("checked",!1)},0);t._oldValue=null;$active=$();$hidden=i}else{$active=i.filter(t._selectors.ELEMENT+"-"+r);$hidden=i.not($active);t._oldValue=r}$active.removeClass(TC.Consts.classes.HIDDEN);$hidden.addClass(TC.Consts.classes.HIDDEN);o.prop("checked",!0)};t._$div.find("span").on(TC.Consts.event.CLICK,e);"number"==typeof t.defaultSelection&&e.call(t._$div.find(t._selectors.RADIOBUTTON).get(t.defaultSelection))})};e.getControl=function(e){var t=this._ctlDeferreds[e];t||(t=$.Deferred()).reject();return t.promise()}}();!function(e,t){"function"==typeof define&&define.amd?define(["../../lib/ol/build/ol-debug"],t):"object"==typeof exports?module.exports=t(require("../../lib/ol/build/ol-debug")):e.ol=t(e.ol)}(this,function(e){Math.hypot=Math.hypot||function(){for(var e=0,t=arguments.length,o=0;o<t;o++){if(arguments[o]===1/0||arguments[o]===-1/0)return 1/0;e+=arguments[o]*arguments[o]}return Math.sqrt(e)};for(var t=0,o=["ms","moz","webkit","o"],r=0;r<o.length&&!window.requestAnimationFrame;++r){window.requestAnimationFrame=window[o[r]+"RequestAnimationFrame"];window.cancelAnimationFrame=window[o[r]+"CancelAnimationFrame"]||window[o[r]+"CancelRequestAnimationFrame"]}window.requestAnimationFrame||(window.requestAnimationFrame=function(e,o){var r=(new Date).getTime(),i=Math.max(0,16-(r-t)),n=window.setTimeout(function(){e(r+i)},i);t=r+i;return n});window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)});var i="mousemove.tc",n=TC.url.ol.substr(0,TC.url.ol.lastIndexOf("/"));n=n.substr(0,n.lastIndexOf("/")+1)+"css/ol.css";e.proj.get("EPSG:4258").metersPerUnit_=e.proj.EPSG4326.METERS_PER_UNIT;e.proj.get("urn:ogc:def:crs:EPSG::4258").metersPerUnit_=e.proj.EPSG4326.METERS_PER_UNIT;e.proj.get("http://www.opengis.net/gml/srs/epsg.xml#4258").metersPerUnit_=e.proj.EPSG4326.METERS_PER_UNIT;e.proj.oldGet=e.proj.get;e.proj.get=function(t){if("string"==typeof t){t=t.trim();TC.loadProjDef({crs:t,sync:!0})}return e.proj.oldGet.call(this,t)};e.format.GMLBase.prototype.readGeometryElement=function(t,o){var r=o[0];r.srsName=t.firstElementChild.getAttribute("srsName");if((this instanceof e.format.GML2CRS84||this instanceof e.format.GML3CRS84)&&("EPSG:4326"!==r.srsName||!r.srsName))throw new Error("Conflicto de CRS");r.srsName||(r.srsName=this.srsName);r.dataProjection=e.proj.get(r.srsName);var i=e.xml.pushParseAndPop(null,this.GEOMETRY_PARSERS_,t,o,this);return i?e.format.Feature.transformWithOptions(i,!1,r):void 0};e.format.GMLBase.prototype.readFeatureElement=function(t,o){var r,i,n=t.getAttribute("fid")||e.xml.getAttributeNS(t,e.format.GMLBase.GMLNS,"id"),a={};for(r=t.firstElementChild;r;r=r.nextElementSibling){var l=r.localName;if(0===r.childNodes.length||1===r.childNodes.length&&(3===r.firstChild.nodeType||4===r.firstChild.nodeType)){var s=e.xml.getAllTextContent(r,!1);e.format.GMLBase.ONLY_WHITESPACE_RE_.test(s)&&(s=void 0);a[l]=s}else(a[l]=this.readGeometryElement(r,o))&&"boundedBy"!==l&&"referencePoint"!==l&&(i=l)}var p=new e.Feature(a);i&&p.setGeometryName(i);n&&p.setId(n);return p};e.format.GML3.prototype._writePosList_=e.format.GML3.prototype.writePosList_;e.format.GML3.prototype.writePosList_=function(e,t,o){this._writePosList_(e,t,o);const r=t.getCoordinates()[0];r&&r.length>2&&e.setAttribute("srsDimension",r.length)};e.format.GML3.prototype._getCoords_=e.format.GML3.prototype.getCoords_;e.format.GML3.prototype.getCoords_=function(e,t){var o=this._getCoords_(e,t);e.length>2&&(o+=" "+e[2]);return o};e.format.GML3.prototype._writePos_=e.format.GML3.prototype.writePos_;e.format.GML3.prototype.writePos_=function(t,o,r){this._writePos_(t,o,r);const i=o.getCoordinates();i.length>2&&e.format.XSD.writeStringTextNode(t," "+i[2])};var a="http://www.opengis.net/gml",l="http://www.opengis.net/gml/3.2";e.format.GMLBase.prototype.MULTIPOINT_PARSERS_[l]=e.format.GMLBase.prototype.MULTIPOINT_PARSERS_[a];e.format.GMLBase.prototype.MULTILINESTRING_PARSERS_[l]=e.format.GMLBase.prototype.MULTILINESTRING_PARSERS_[a];e.format.GMLBase.prototype.MULTIPOLYGON_PARSERS_[l]=e.format.GMLBase.prototype.MULTIPOLYGON_PARSERS_[a];e.format.GMLBase.prototype.POINTMEMBER_PARSERS_[l]=e.format.GMLBase.prototype.POINTMEMBER_PARSERS_[a];e.format.GMLBase.prototype.LINESTRINGMEMBER_PARSERS_[l]=e.format.GMLBase.prototype.LINESTRINGMEMBER_PARSERS_[a];e.format.GMLBase.prototype.POLYGONMEMBER_PARSERS_[l]=e.format.GMLBase.prototype.POLYGONMEMBER_PARSERS_[a];e.format.GMLBase.prototype.RING_PARSERS[l]=e.format.GMLBase.prototype.RING_PARSERS[a];e.format.GML3.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS_[l]=e.format.GML3.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS_[a];e.format.GML3.prototype.FLAT_LINEAR_RINGS_PARSERS_[l]=e.format.GML3.prototype.FLAT_LINEAR_RINGS_PARSERS_[a];e.format.GML3.prototype.GEOMETRY_PARSERS_[l]=e.format.GML3.prototype.GEOMETRY_PARSERS_[a];e.format.GML3.prototype.MULTICURVE_PARSERS_[l]=e.format.GML3.prototype.MULTICURVE_PARSERS_[a];e.format.GML3.prototype.MULTISURFACE_PARSERS_[l]=e.format.GML3.prototype.MULTISURFACE_PARSERS_[a];e.format.GML3.prototype.CURVEMEMBER_PARSERS_[l]=e.format.GML3.prototype.CURVEMEMBER_PARSERS_[a];e.format.GML3.prototype.SURFACEMEMBER_PARSERS_[l]=e.format.GML3.prototype.SURFACEMEMBER_PARSERS_[a];e.format.GML3.prototype.SURFACE_PARSERS_[l]=e.format.GML3.prototype.SURFACE_PARSERS_[a];e.format.GML3.prototype.CURVE_PARSERS_[l]=e.format.GML3.prototype.CURVE_PARSERS_[a];e.format.GML3.prototype.ENVELOPE_PARSERS_[l]=e.format.GML3.prototype.ENVELOPE_PARSERS_[a];e.format.GML3.prototype.PATCHES_PARSERS_[l]=e.format.GML3.prototype.PATCHES_PARSERS_[a];e.format.GML3.prototype.SEGMENTS_PARSERS_[l]=e.format.GML3.prototype.SEGMENTS_PARSERS_[a];e.format.KML._createStyleDefaults_=e.format.KML.createStyleDefaults_;e.format.KML.createStyleDefaults_=function(){e.format.KML._createStyleDefaults_();e.format.KML.DEFAULT_FILL_STYLE_.color_=v(TC.Cfg.styles.polygon.fillColor,TC.Cfg.styles.polygon.fillOpacity);e.format.KML.DEFAULT_TEXT_STYLE_.fill_=new e.style.Fill({color:e.format.KML.DEFAULT_COLOR_});e.format.KML.DEFAULT_STROKE_STYLE_.color_=v(TC.Cfg.styles.line.strokeColor,1);e.format.KML.DEFAULT_STROKE_STYLE_.width_=TC.Cfg.styles.line.strokeWidth;return e.format.KML.DEFAULT_STYLE_ARRAY_};e.format.KML.prototype._readDocumentOrFolder_=e.format.KML.prototype.readDocumentOrFolder_;e.format.KML.prototype.readDocumentOrFolder_=function(t,o){var r=e.format.KML.prototype._readDocumentOrFolder_.apply(this,arguments);if("Folder"==t.localName)for(var i=0;i<r.length;i++){var n=r[i];$.isArray(n._folders)||(n._folders=[]);var a=t.getElementsByTagName("name")[0];a&&TC.Util.fastUnshift(n._folders,a.innerHTML||a.textContent)}return r};e.format.KML.readText_=function(t,o){e.asserts.assert(t.nodeType==Node.ELEMENT_NODE);e.asserts.assert("text"==t.localName);return e.xml.getAllTextContent(t,!1).trim()};e.format.KML.BALLOON_STYLE_PARSERS_=e.xml.makeStructureNS(e.format.KML.NAMESPACE_URIS_,{text:e.xml.makeObjectPropertySetter(e.format.KML.readText_)});e.format.KML.BalloonStyleParser_=function(t,o){e.asserts.assert(t.nodeType==Node.ELEMENT_NODE);e.asserts.assert("BalloonStyle"==t.localName);var r=e.xml.pushParseAndPop({},e.format.KML.BALLOON_STYLE_PARSERS_,t,o);if(goog.isDef(r)){var i=o[o.length-1];e.asserts.assert(goog.isObject(i));var n=new e.style.Text({text:r.text});i.balloonStyle=n}};for(var s in e.format.KML.STYLE_PARSERS_){e.format.KML.STYLE_PARSERS_[s].BalloonStyle=e.format.KML.BalloonStyleParser_}e.format.KML.readStyle_=function(t,o){var r=e.xml.pushParseAndPop({},e.format.KML.STYLE_PARSERS_,t,o);if(!r)return null;var i="fillStyle"in r?r.fillStyle:e.format.KML.DEFAULT_FILL_STYLE_,n=r.fill;void 0===n||n||(i=null);var a="imageStyle"in r?r.imageStyle:e.format.KML.DEFAULT_IMAGE_STYLE_;a==e.format.KML.DEFAULT_NO_IMAGE_STYLE_&&(a=void 0);var l="textStyle"in r?r.textStyle:e.format.KML.DEFAULT_TEXT_STYLE_,s="strokeStyle"in r?r.strokeStyle:e.format.KML.DEFAULT_STROKE_STYLE_,p="balloonStyle"in r?r.balloonStyle:e.format.KML.DEFAULT_BALLOON_STYLE_,c=r.outline;void 0===c||c||(s=null);var u=new e.style.Style({fill:i,image:a,stroke:s,text:l,zIndex:void 0});u._balloon=p;return[u]};e.format.KML._readURI_=e.format.KML.readURI_;e.format.KML.readURI_=function(t){var o=e.format.KML._readURI_(t);"https:"===location.protocol&&0===o.indexOf("http://")&&(o=o.substr(5));return o};for(var s in e.format.KML.ICON_PARSERS_)e.format.KML.ICON_PARSERS_[s].href=e.xml.makeObjectPropertySetter(e.format.KML.readURI_);e.format.KML.whenParser_=function(t,o){e.asserts.assert(t.nodeType==Node.ELEMENT_NODE,"node.nodeType should be ELEMENT");e.asserts.assert("when"==t.localName,"localName should be when");var r=o[o.length-1];e.asserts.assert(goog.isObject(r),"gxTrackObject should be an Object");r=r.whens;var i=e.xml.getAllTextContent(t,!1);if(i=/^\s*(\d{4})($|-(\d{2})($|-(\d{2})($|T(\d{2}):(\d{2}):(\d{2})(?:.?\d{3})?(Z|(?:([+\-])(\d{2})(?::(\d{2}))?)))))\s*$/.exec(i)){var n=parseInt(i[1],10),a=i[3]?parseInt(i[3],10)-1:0,l=i[5]?parseInt(i[5],10):1,s=i[7]?parseInt(i[7],10):0,p=i[8]?parseInt(i[8],10):0,c=i[9]?parseInt(i[9],10):0;n=Date.UTC(n,a,l,s,p,c);i[10]&&"Z"!=i[10]&&(n+=60*(a="-"==i[11]?-1:1)*parseInt(i[12],10),i[13]&&(n+=3600*a*parseInt(i[13],10)));r.push(n)}else r.push(0)};e.format.KML.GX_TRACK_PARSERS_=e.xml.makeStructureNS(e.format.KML.NAMESPACE_URIS_,{when:e.format.KML.whenParser_},e.xml.makeStructureNS(e.format.KML.GX_NAMESPACE_URIS_,{coord:e.format.KML.gxCoordParser_}));e.format.KML.prototype.readFeatures=function(t,o){if("string"==typeof t){var r=t.indexOf("<kml");if(r>=0){r+="<kml".length;t.indexOf(">",r);t.indexOf("xmlns:xsi=")<0&&(t=t.substr(0,r)+' xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"'+t.substr(r));t=function(t,o){var r=e.xml.parse(t).getElementsByTagName(o.toLowerCase());if(r&&r.length>0){var i=r[0].getAttribute("xmlns");if(i&&i.indexOf(" ")>-1&&h.indexOf(i)>-1)for(var n=i.split(" "),a=[],l=0;l<n.length;l++)a.push("xmlns:"+o.toLowerCase()+l+'="'+n[l].trim()+'"')}return t}(t,"KML")}}return e.format.XMLFeature.prototype.readFeatures.call(this,t,o)};e.format.XSD.readDateTime=function(t){t=e.xml.getAllTextContent(t,!1);if(t=/^\s*(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2})(Z|(?:([+\-])(\d{2})(?::(\d{2}))?))\s*$/.exec(t)){var o=parseInt(t[1],10),r=parseInt(t[2],10)-1,i=parseInt(t[3],10),n=parseInt(t[4],10),a=parseInt(t[5],10),l=parseInt(t[6],10);o=Date.UTC(o,r,i,n,a,l);"Z"!=t[7]&&(o+=60*(r="-"==t[8]?-1:1)*parseInt(t[9],10),void 0!==t[10]&&(o+=3600*r*parseInt(t[10],10)));return o}};e.format.GPX.RTEPT_PARSERS_=e.xml.makeStructureNS(e.format.GPX.NAMESPACE_URIS_,{ele:e.xml.makeObjectPropertySetter(e.format.XSD.readDecimal),time:e.xml.makeObjectPropertySetter(e.format.XSD.readDateTime)});e.format.GPX.TRKPT_PARSERS_=e.xml.makeStructureNS(e.format.GPX.NAMESPACE_URIS_,{ele:e.xml.makeObjectPropertySetter(e.format.XSD.readDecimal),time:e.xml.makeObjectPropertySetter(e.format.XSD.readDateTime)});e.format.GPX.WPT_PARSERS_=e.xml.makeStructureNS(e.format.GPX.NAMESPACE_URIS_,{ele:e.xml.makeObjectPropertySetter(e.format.XSD.readDecimal),time:e.xml.makeObjectPropertySetter(e.format.XSD.readDateTime),magvar:e.xml.makeObjectPropertySetter(e.format.XSD.readDecimal),geoidheight:e.xml.makeObjectPropertySetter(e.format.XSD.readDecimal),name:e.xml.makeObjectPropertySetter(e.format.XSD.readString),cmt:e.xml.makeObjectPropertySetter(e.format.XSD.readString),desc:e.xml.makeObjectPropertySetter(e.format.XSD.readString),src:e.xml.makeObjectPropertySetter(e.format.XSD.readString),link:e.format.GPX.parseLink_,sym:e.xml.makeObjectPropertySetter(e.format.XSD.readString),type:e.xml.makeObjectPropertySetter(e.format.XSD.readString),fix:e.xml.makeObjectPropertySetter(e.format.XSD.readString),sat:e.xml.makeObjectPropertySetter(e.format.XSD.readNonNegativeInteger),hdop:e.xml.makeObjectPropertySetter(e.format.XSD.readDecimal),vdop:e.xml.makeObjectPropertySetter(e.format.XSD.readDecimal),pdop:e.xml.makeObjectPropertySetter(e.format.XSD.readDecimal),ageofdgpsdata:e.xml.makeObjectPropertySetter(e.format.XSD.readDecimal),dgpsid:e.xml.makeObjectPropertySetter(e.format.XSD.readNonNegativeInteger),extensions:e.format.GPX.parseExtensions_});e.format.XSD.writeDateTimeTextNode=function(t,o){var r=new Date(o),i=r.getUTCFullYear()+"-"+e.string.padNumber(r.getUTCMonth()+1,2)+"-"+e.string.padNumber(r.getUTCDate(),2)+"T"+e.string.padNumber(r.getUTCHours(),2)+":"+e.string.padNumber(r.getUTCMinutes(),2)+":"+e.string.padNumber(r.getUTCSeconds(),2)+"Z";t.appendChild(e.xml.DOCUMENT.createTextNode(i))};e.format.GPX.WPT_TYPE_SERIALIZERS_=e.xml.makeStructureNS(e.format.GPX.NAMESPACE_URIS_,{ele:e.xml.makeChildAppender(e.format.XSD.writeDecimalTextNode),time:e.xml.makeChildAppender(e.format.XSD.writeDateTimeTextNode),magvar:e.xml.makeChildAppender(e.format.XSD.writeDecimalTextNode),geoidheight:e.xml.makeChildAppender(e.format.XSD.writeDecimalTextNode),name:e.xml.makeChildAppender(e.format.XSD.writeStringTextNode),cmt:e.xml.makeChildAppender(e.format.XSD.writeStringTextNode),desc:e.xml.makeChildAppender(e.format.XSD.writeStringTextNode),src:e.xml.makeChildAppender(e.format.XSD.writeStringTextNode),link:e.xml.makeChildAppender(e.format.GPX.writeLink_),sym:e.xml.makeChildAppender(e.format.XSD.writeStringTextNode),type:e.xml.makeChildAppender(e.format.XSD.writeStringTextNode),fix:e.xml.makeChildAppender(e.format.XSD.writeStringTextNode),sat:e.xml.makeChildAppender(e.format.XSD.writeNonNegativeIntegerTextNode),hdop:e.xml.makeChildAppender(e.format.XSD.writeDecimalTextNode),vdop:e.xml.makeChildAppender(e.format.XSD.writeDecimalTextNode),pdop:e.xml.makeChildAppender(e.format.XSD.writeDecimalTextNode),ageofdgpsdata:e.xml.makeChildAppender(e.format.XSD.writeDecimalTextNode),dgpsid:e.xml.makeChildAppender(e.format.XSD.writeNonNegativeIntegerTextNode)});const p=TC.Util.detectMouse()?3:10;var c=function(e){for(var t=[],o=[],r=Math.pow(2,e.length),i=0;i<r;i++){o=[];for(var n=0;n<e.length;n++)i&Math.pow(2,n)&&-1==o.indexOf(e[n])&&o.push(e[n]);o.length>0&&-1==t.indexOf(o.join(" "))&&t.push(o.join(" "))}return t},u=function(e,t){if(e&&e.length>0)for(var o=0;o<t.length;o++){var r=e.indexOf(t[o]);r>-1&&e.splice(r,1)}},g=function(e,t){for(var o=0;o<e.length;o++)for(var r=e[o],i=0;i<t.length;i++){var n=t[i].split(" ")[0];r[t[i]]=r[n]}},d=[e.format.KML.DATA_PARSERS_,e.format.KML.EXTENDED_DATA_PARSERS_,e.format.KML.REGION_PARSERS_,e.format.KML.LAT_LON_ALT_BOX_PARSERS_,e.format.KML.LOD_PARSERS_,e.format.KML.EXTRUDE_AND_ALTITUDE_MODE_PARSERS_,e.format.KML.FLAT_LINEAR_RING_PARSERS_,e.format.KML.FLAT_LINEAR_RINGS_PARSERS_,e.format.KML.GX_TRACK_PARSERS_,e.format.KML.GEOMETRY_FLAT_COORDINATES_PARSERS_,e.format.KML.ICON_PARSERS_,e.format.KML.ICON_STYLE_PARSERS_,e.format.KML.INNER_BOUNDARY_IS_PARSERS_,e.format.KML.LABEL_STYLE_PARSERS_,e.format.KML.LINE_STYLE_PARSERS_,e.format.KML.MULTI_GEOMETRY_PARSERS_,e.format.KML.GX_MULTITRACK_GEOMETRY_PARSERS_,e.format.KML.NETWORK_LINK_PARSERS_,e.format.KML.LINK_PARSERS_,e.format.KML.OUTER_BOUNDARY_IS_PARSERS_,e.format.KML.PAIR_PARSERS_,e.format.KML.PLACEMARK_PARSERS_,e.format.KML.POLY_STYLE_PARSERS_,e.format.KML.SCHEMA_DATA_PARSERS_,e.format.KML.STYLE_PARSERS_,e.format.KML.STYLE_MAP_PARSERS_],h=c(e.format.KML.NAMESPACE_URIS_.slice().slice(1));u(h,e.format.KML.NAMESPACE_URIS_);e.format.KML.NAMESPACE_URIS_=e.format.KML.NAMESPACE_URIS_.concat(h);g(d,h);var f=[e.format.GPX.GPX_PARSERS_,e.format.GPX.LINK_PARSERS_,e.format.GPX.RTE_PARSERS_,e.format.GPX.RTEPT_PARSERS_,e.format.GPX.TRK_PARSERS_,e.format.GPX.TRKSEG_PARSERS_,e.format.GPX.TRKPT_PARSERS_,e.format.GPX.WPT_PARSERS_,e.format.GPX.LINK_SERIALIZERS_,e.format.GPX.RTE_SEQUENCE_,e.format.GPX.RTE_SERIALIZERS_,e.format.GPX.RTEPT_TYPE_SEQUENCE_,e.format.GPX.TRK_SEQUENCE_,e.format.GPX.TRK_SERIALIZERS_,e.format.GPX.TRKSEG_SERIALIZERS_,e.format.GPX.WPT_TYPE_SEQUENCE_,e.format.GPX.WPT_TYPE_SERIALIZERS_,e.format.GPX.GPX_SERIALIZERS_],y=c(e.format.GPX.NAMESPACE_URIS_.slice().slice(1));u(y,e.format.GPX.NAMESPACE_URIS_);e.format.GPX.NAMESPACE_URIS_=e.format.GPX.NAMESPACE_URIS_.concat(y);g(f,y);e.format.GML3Patched=function(t){var o=new e.format.GML(t);o.FEATURE_COLLECTION_PARSERS[e.format.GMLBase.GMLNS].featureMember=e.xml.makeArrayPusher(e.format.GMLBase.prototype.readFeaturesInternal);return o};e.format.GMLBase.prototype.readFeaturesInternal=function(t,o){e.DEBUG&&console.assert(t.nodeType==Node.ELEMENT_NODE,"node.nodeType should be ELEMENT");var r=t.localName,i=null;if("FeatureCollection"==r){var n=this.FEATURE_COLLECTION_PARSERS[e.format.GMLBase.GMLNS];n.member||(n.member=e.xml.makeArrayPusher(e.format.GMLBase.prototype.readFeaturesInternal));if("http://www.opengis.net/wfs"===t.namespaceURI)i=e.xml.pushParseAndPop([],this.FEATURE_COLLECTION_PARSERS,t,o,this);else{this.FEATURE_COLLECTION_PARSERS[t.namespaceURI]=this.FEATURE_COLLECTION_PARSERS[t.namespaceURI]||this.FEATURE_COLLECTION_PARSERS[e.format.GMLBase.GMLNS];i=e.xml.pushParseAndPop([],this.FEATURE_COLLECTION_PARSERS,t,o,this)}}else if("featureMembers"==r||"featureMember"==r||"member"==r){var a,l=o[0],s=l.featureType,p=l.featureNS;if(t.childNodes){s=[],p={};for(_=0,a=t.childNodes.length;_<a;++_){var c=t.childNodes[_];if(1===c.nodeType){var u=c.nodeName.split(":").pop();if(-1===s.indexOf(u)){var g="",d=0,h=c.namespaceURI;for(var f in p){if(p[f]===h){g=f;break}++d}g||(p[g="p"+d]=h);s.push(g+":"+u)}}}if("featureMember"!=r&&"member"!=r){l.featureType=s;l.featureNS=p}}if("string"==typeof p){var y=p;(p={}).p0=y}var m={},v=Array.isArray(s)?s:[s];for(var C in p){var T={};for(_=0,a=v.length;_<a;++_){(-1===v[_].indexOf(":")?"p0":v[_].split(":")[0])===C&&(T[v[_].split(":").pop()]="featureMembers"==r?e.xml.makeArrayPusher(this.readFeatureElement,this):e.xml.makeReplacer(this.readFeatureElement,this))}m[p[C]]=T}i="featureMember"==r||"member"==r?e.xml.pushParseAndPop(void 0,m,t,o):e.xml.pushParseAndPop([],m,t,o)}null===i&&(i=[]);var S=function(e){var t=e.getGeometry();if(e.getProperties()[e.getGeometryName()]&&(!t||!t.flatCoordinates.length))throw"Geometr\xeda no v\xe1lida. \xbfPosible versi\xf3n incorrecta de GML?"};if(i instanceof e.Feature)S(i);else for(var _=0,E=i.length;_<E;_++)S(i[_]);return i};e.format.GML3CRS84=function(){e.format.GML3.call(this,{srsName:"CRS:84"})};e.inherits(e.format.GML3CRS84,e.format.GML3);e.format.GML2CRS84=function(){e.format.GML2.call(this,{srsName:"CRS:84"})};e.inherits(e.format.GML2CRS84,e.format.GML2);e.View.prototype.getValueForResolutionFunction=function(e){var t=e||2,o=this.maxResolution_,r=this.minResolution_,i=Math.log(o/r)/Math.log(t);return function(e){var r=Math.log(o/e)/Math.log(t)/i;return r=Math.max(Math.min(1,r),0)}};e.control.OverviewMap.prototype._validateExtent_=e.control.OverviewMap.prototype.validateExtent_;e.control.OverviewMap.prototype.validateExtent_=function(){this._validateExtent_();this._wrap&&this._wrap.parent.options.alwaysCentered&&this.recenter_()};e.control.OverviewMap.prototype._resetExtent_=e.control.OverviewMap.prototype.resetExtent_;e.control.OverviewMap.prototype.resetExtent_=function(){this._resetExtent_.call(this);var t=this._wrap;if(t.is3D){var o=this.ovmap_.getView(),r=o.calculateExtent(),i=t.get3DCameraLayer().getSource().getFeatures()[0];if(i){coordinates=i.getGeometry().getCoordinates();var n=coordinates[0][0],a=coordinates[0][1];if(!e.extent.containsCoordinate(r,n)||!e.extent.containsCoordinate(r,a)){var l=Math.max(r[0]-n[0],r[1]-n[1],n[0]-r[2],n[1]-r[3],r[0]-a[0],r[1]-a[1],a[0]-r[2],a[1]-r[3]);o.fit(e.extent.buffer(r,l))}}}};const m=e.Image;e.Image=function(){7===arguments.length&&Array.prototype.splice.call(arguments,3,1);return m.apply(this,arguments)};TC.inherit(e.Image,m);var v=function(t,o){var r;if(t){r=(r=e.color.asArray(t)).slice();void 0!==o&&(r[3]=o)}else r=[0,0,0,1];return r},C=function(e,t){var o=e.map.getView(),r=o.getResolution(),i={projection:o.getProjection(),center:o.getCenter(),resolution:r,enableRotation:!1};e.parent.maxExtent&&(i.extent=e.parent.maxExtent);if(t.type===TC.Consts.layerType.WMS||t.type===TC.Consts.layerType.WMTS){var n,a,l=t.getResolutions();if(l&&l.length){n=t.maxResolution||l[0];a=t.minResolution||l[l.length-1];var s=l.indexOf(a),p=l.indexOf(n);i.resolutions=l.slice(p,s+1)}else{n=t.maxResolution;a=t.minResolution}if(a){i.minResolution=a;r<a&&(i.resolution=a)}if(n){i.maxResolution=n;r>n&&(i.resolution=n)}}return i};TC.wrap.Map.prototype.setMap=function(){var t=this,o=[(t.parent.initialExtent[0]+t.parent.initialExtent[2])/2,(t.parent.initialExtent[1]+t.parent.initialExtent[3])/2],r=proj4(t.parent.crs);!function(){var o=t.parent.crs.substr(t.parent.crs.lastIndexOf(":")+1),i={units:r.oProj.units,global:!0},n=[];if("4326"!==o){i.code="EPSG:"+o;n.push(new e.proj.Projection(i));i.code="urn:ogc:def:crs:EPSG::"+o;n.push(new e.proj.Projection(i));e.proj.addEquivalentProjections(n)}var a=function(e,t,o,r){for(var i=[],n=r||2,a=0;a<t.length;a+=n){var l=Array.prototype.slice.call(e(t.slice(a,a+n)));3!==n&&4!==n||(l=l.slice(0,2).concat(t.slice(a+2,a+2+(n-2))));i=i.concat(l)}if($.isArray(o)){o.length=0;for(a=0;a<i.length;a++)o[a]=i[a];i=o}return i};e.proj.addEquivalentTransforms(e.proj.EPSG4326.PROJECTIONS,n,function(e,t,o){return a(r.forward,e,t,o)},function(e,t,o){return a(r.inverse,e,t,o)})}();var i={code:t.parent.crs,units:r.oProj.units};"EPSG:4326"===t.parent.crs&&(i.axisOrientation="neu");var n=new e.proj.Projection(i),a=e.interaction.defaults({constrainResolution:!0}),l={projection:n,center:o,enableRotation:!1};if(t.parent.maxExtent){var s=t.parent.maxExtent;l.extent=s;var c=t.parent.div.getBoundingClientRect(),u=(c.width,c.height,s[2]-s[0]),g=s[3]-s[1];c.width/c.height>u/g?l.resolution=u/c.width:l.resolution=g/c.height}else l.zoom=2;t.map=new e.Map({target:t.parent.div,renderer:e.renderer.Type.CANVAS,view:new e.View(l),controls:[],interactions:a});t.map._wrap=t;var d=function(){t.map.updateSize()};$(t.parent.div).on(e.events.EventType.RESIZE,d);t.parent.$events.one(TC.Consts.event.MAPLOAD,d);t.map.on(e.MapBrowserEventType.SINGLECLICK,function(e){t.parent.workLayers.forEach(function(e){delete e._noFeatureClicked});var o=$.map(t.parent.workLayers,function(){return!1});t.map.forEachFeatureAtPixel(e.pixel,function(e,r){if(e._wrap&&e._wrap.parent.showsPopup){for(var i=0;i<t.parent.workLayers.length;i++){if(t.parent.workLayers[i].wrap.layer===r){o[i]=!0;break}}t.parent.$events.trigger($.Event(TC.Consts.event.FEATURECLICK,{feature:e._wrap.parent}));return e}},{hitTolerance:p});for(var r=0;r<o.length;r++)o[r]||t.parent.$events.trigger($.Event(TC.Consts.event.NOFEATURECLICK,{layer:t.parent.workLayers[r]}))});t.map.getView().on("change:resolution",function(){t.parent.$events.trigger($.Event(TC.Consts.event.BEFOREZOOM))},t.parent);t.map.on(e.MapEventType.MOVEEND,function(){t.parent.$events.trigger($.Event(TC.Consts.event.ZOOM))});t.mapDeferred.resolve(t.map);var h=function(o){t.map.getView().getResolution(),t.map.getView().getZoom();var r=C(t,o),i=new e.View(r);t.map.setView(i);t.map.render()};t.parent.$events.on(TC.Consts.event.BASELAYERCHANGE,function(e){t.parent.crs!==t.parent.options.crs||t.parent.on3DView||h(e.layer)});t.parent.$events.on(TC.Consts.event.MAPLOAD,function(e){h(t.parent.getBaseLayer())})};var T=function(t,o){var r=t.getUnits();return r&&r!==e.proj.Units.DEGREES?e.proj.METERS_PER_UNIT[r]:TC.Util.getMetersPerDegree(o)};TC.wrap.Map.prototype.getMetersPerUnit=function(){return T(e.proj.get(this.parent.crs),this.getExtent())};var S=function(t){t=t||{};var o=this.parent.options.crs||TC.Cfg.crs,r=e.proj.get(o),i=e.proj.get(t.crs);return T(i,t.extentInDegrees)/T(r,t.extentInDegrees)},_=function(t){var o;(o=t.axisOrientation?new e.proj.Projection({code:t.crs,axisOrientation:t.axisOrientation}):e.proj.get(t.crs)).getUnits()||(o.units_=e.proj.Units.DEGREES);return o};TC.wrap.Map.prototype.setProjection=function(t){var o,r=(t=t||{}).baseLayer||this.parent.baseLayer;o=t.extent?t.extent:e.proj.transformExtent(this.getExtent(),this.parent.crs,t.crs);var i=S.call(this,{crs:t.crs,extentInDegrees:e.proj.transformExtent(o,t.crs,"EPSG:4326")}),n=_(t),a=this.map.getView(),l={projection:n,enableRotation:!1},s=r.getResolutions();if(s&&s.length)l.resolutions=s;else{l.minZoom=a.getMinZoom();l.maxZoom=a.getMaxZoom();var p=r.wrap.layer.getMinResolution();0!==p&&(l.minResolution=p);var c=r.wrap.layer.getMaxResolution();c!==Number.POSITIVE_INFINITY&&(l.maxResolution=c)}l.center=e.proj.transformExtent(this.getCenter(),this.parent.crs,t.crs);var u=new e.View(l);this.map.setView(u);this.parent.initialExtent=1!==i?e.proj.transformExtent(this.parent.initialExtent,this.parent.crs,t.crs):this.parent.options.initialExtent;this.parent.options.maxExtent&&(this.parent.maxExtent=1!==i?e.proj.transformExtent(this.parent.maxExtent,this.parent.crs,t.crs):this.parent.options.maxExtent);u.fit(o,{nearest:!0})};TC.wrap.Map.prototype.insertLayer=function(t,o){for(var r=this,i=r.map.getLayers(),n=!1,a=0;a<i.getLength();a++)if(i.item(a)===t){n=!0;break}if(n){i.remove(t);i.insertAt(o,t)}else{o<0?i.push(t):i.insertAt(o,t);var l=r.map.getView();if(r.parent.crs===r.parent.options.crs){if(t instanceof e.layer.Tile){var s=t.getSource().getResolutions();l.maxResolution_=s[0];l.minResolution_=s[s.length-1]}}else if(t instanceof e.layer.Tile){t.setMaxResolution(l.getMaxResolution());t.setMinResolution(l.getMinResolution())}var p=t._wrap,c=0,u=function(e){p.parent.state=TC.Layer.state.LOADING;if(c<=0){c=0;r.parent.$events.trigger($.Event(TC.Consts.event.BEFORELAYERUPDATE,{layer:p.parent}))}t._loadingTileCount=t._loadingTileCount+1};p.parent.state===TC.Layer.state.LOADING&&p.parent.isRaster()&&u();p.$events.on(TC.Consts.event.BEFORETILELOAD,u);p.$events.on(TC.Consts.event.TILELOAD,function(e){if((c-=1)<=0){c=0;p.parent.state=TC.Layer.state.IDLE;r.parent.$events.trigger($.Event(TC.Consts.event.LAYERUPDATE,{layer:p.parent}))}})}};TC.wrap.Map.prototype.removeLayer=function(e){this.map.removeLayer(e)};TC.wrap.Map.prototype.getLayerCount=function(){return this.map.getLayerGroup().getLayers().getLength()};TC.wrap.Map.prototype.indexOfFirstVector=function(){var t=-1;this.map.getLayerGroup().getLayers().forEach(function(o,r){o instanceof e.layer.Vector&&-1===t&&(t=r)});return t};TC.wrap.Map.prototype.getLayerIndex=function(e){var t=-1;this.map.getLayerGroup().getLayers().forEach(function(o,r){o===e&&(t=r)});return t};TC.wrap.Map.prototype.setLayerIndex=function(e,t){var o=this.map.getLayers().getArray().indexOf(e);if(o>-1&&o!=t){this.map.removeLayer(e);this.insertLayer(e,t)}};TC.wrap.Map.prototype.setBaseLayer=function(t){var o=this,r=new $.Deferred,i=function(i){if(i=i||o.parent.getBaseLayer()){o.map.removeLayer(i.wrap.getLayer());if(t instanceof e.layer.Image){S.call(o,{crs:o.parent.crs,extent:o.parent.getExtent()});t._wrap.setProjection({crs:o.parent.crs})}if(t._wrap.parent.type===TC.Consts.layerType.WMTS){var n={crs:o.parent.crs,oldCrs:t.getSource().getProjection().getCode()};n.oldCrs!==n.crs&&t._wrap.parent.setProjection(n)}}o.insertLayer(t,0);r.resolve()},n=C(o,t._wrap.parent),a=o.map.getView(),l=a.getResolution();if(o.parent.crs===o.parent.options.crs&&n.resolutions){var s=n.resolutions.sort(function(e,t){return e-t}).reduce(function(e,t){return 0===e&&(t>l||Math.abs(1-l/t)<o.parent.options.maxResolutionError)?t:e},0);if(s!==l)if(o.parent.isLoaded)a.animate({resolution:s,duration:TC.Consts.ZOOM_ANIMATION_DURATION},i.bind(o,o.parent.getBaseLayer()));else{a.setResolution(s);i()}else i()}else i();return r.promise()};TC.wrap.Map.prototype.setExtent=function(t,o){var r=this;r.done&&r.done.resolve();r.done=new $.Deferred;var i=o||{};clearTimeout(r._timeout);r._timeout=setTimeout(function(){var o=r.map.getSize(),n=r.map.getView(),a=function(){r.done.resolve()},l=function(){var e=n.getResolutionForExtent(t,o);if(n.constrainResolution){var r=n.constrainResolution(e,0,0);r<e&&r/e<TC.Consts.EXTENT_TOLERANCE&&(r=n.constrainResolution(r,-1,0));e=r}const l=[(t[0]+t[2])/2,(t[1]+t[3])/2];if(void 0===i.animate||i.animate)n.animate({resolution:e,center:l,duration:TC.Consts.ZOOM_ANIMATION_DURATION},a);else{n.setCenter(l);n.setResolution(e);a()}};r.parent.baseLayer?$.when(r.parent.baseLayer.wrap.getLayer()).then(function(i){if(i.getSource().getResolutions!=goog.abstractMethod){var a=n.getResolutionForExtent(t,o),s=r.map.getView().getResolutions();if(s&&s.length>0){var p=Math.min.apply(r,s);if(p>a){var c=.5*(p/a-1),u=e.extent.getWidth(t)*c,g=e.extent.getHeight(t)*c;(t=t.slice(0))[0]=t[0]-u;t[1]=t[1]-g;t[2]=t[2]+u;t[3]=t[3]+g}}}l()}):l()},50);return r.done};TC.wrap.Map.prototype.getExtent=function(){return this.map.getView().calculateExtent(this.map.getSize())};TC.wrap.Map.prototype.setCenter=function(e,t){var o=$.Deferred(),r=t||{},i=this.map.getView();if(r.animate)i.animate({center:e,duration:TC.Consts.ZOOM_ANIMATION_DURATION},function(){o.resolve()});else{i.setCenter(e);o.resolve()}return o.promise()};TC.wrap.Map.prototype.getCenter=function(){return this.map.getView().getCenter()};TC.wrap.Map.prototype.getResolution=function(){return this.map.getView().getResolution()};TC.wrap.Map.prototype.setResolution=function(e){$.when(this.getMap()).then(function(t){t.getView().setResolution(e)})};TC.wrap.Map.prototype.setRotation=function(e){$.when(this.getMap()).then(function(t){t.getView().setRotation(e)})};TC.wrap.Map.prototype.getRotation=function(){return this.map.getView().getRotation()};TC.wrap.Map.prototype.getResolutions=function(){return this.map.getView().getResolutions()||[]};TC.wrap.Map.prototype.getCoordinateFromPixel=function(e){return this.map.getCoordinateFromPixel(e)};TC.wrap.Map.prototype.getPixelFromCoordinate=function(e){return this.map.getPixelFromCoordinate(e)};TC.wrap.Map.prototype.getViewport=function(e){if((e||{}).synchronous)t=this.map.getViewport();else{var t=new $.Deferred;$.when(this.getMap()).then(function(e){t.resolve(e.getViewport())})}return t};TC.wrap.Map.prototype.isNative=function(t){return t instanceof e.Map};TC.wrap.Map.prototype.isGeo=function(){var t=this.map.getView().getProjection().getUnits();return!t||t===e.proj.Units.DEGREES};TC.wrap.Map.prototype.addPopup=function(t){var o=$.Deferred(),r=this,n=void 0===t.options.draggable||t.options.draggable;TC.loadJS(n&&!$.fn.drag,[TC.apiLocation+"lib/jQuery/jquery.event.drag.js"],function(){$.when(r.getMap()).then(function(o){if(!t.$popupDiv){var a=TC.Util.getDiv();t.$popupDiv=$(a);t.$popupDiv.addClass(TC.control.Popup.prototype.CLASS).appendTo(r.parent.div);t.$contentDiv=$(TC.Util.getDiv()).addClass(TC.control.Popup.prototype.CLASS+"-content").appendTo(t.$popupDiv);t.$menuDiv=$(TC.Util.getDiv()).addClass(TC.control.Popup.prototype.CLASS+"-menu").appendTo(t.$popupDiv);var l=new e.Overlay({element:a,positioning:e.OverlayPositioning.BOTTOM_LEFT});o.addOverlay(l);t.wrap.popup=l;t._firstRender.resolve();t.$events.trigger($.Event(TC.Consts.event.CONTROLRENDER));var s=$(o.getViewport());if(n){var c=t.$popupDiv.parent();t.$popupDiv.addClass(TC.Consts.classes.DRAGGABLE);c.on("touchmove",function(e){$(e.target).parents(".tc-ctl-finfo-layer-content").length&&e.stopPropagation()}).drag("start",function(e,r){var i=e.target.getBoundingClientRect();if(i.left+e.target.clientWidth<e.clientX||i.top+e.target.clientHeight<e.clientY)return!1;t.setDragging(!0);t._currentOffset=l.getOffset();if(t._previousContainerPosition){var n=o.getSize();l.setPosition(o.getCoordinateFromPixel([t._previousContainerPosition[0],n[1]-t._previousContainerPosition[1]]));t._currentOffset=[0,0];l.setOffset(t._currentOffset);delete t._previousContainerPosition}else t._currentOffset=l.getOffset()}).drag("end",function(e,r){t.setDragging(!1);var i=o.getCoordinateFromPixel([0,0]),n=o.getCoordinateFromPixel(l.getOffset()),a=[n[0]-i[0],n[1]-i[1]],s=l.getPosition();l.setPosition([s[0]+a[0],s[1]+a[1]]);l.setOffset([0,0]);t._currentOffset=[0,0];t._previousContainerPosition=[parseInt(c.css("left")),parseInt(c.css("bottom"))]}).drag(function(e,o){if(!e.buttons&&!Modernizr.touch)return!1;l.setOffset([t._currentOffset[0]+o.deltaX,t._currentOffset[1]+o.deltaY])},{not:"th,td, td *,input,select,.tc-ctl-finfo-coords"}).on("mouseenter",function(e){s.off(i+".popup")}).on("mouseleave",function(e){s.on(i+".popup",u)})}var u=function(e){var t=o.getTarget(),i=!1;if(!r.parent.activeControl||!r.parent.activeControl.isExclusive()){var n=o.getEventPixel(e.originalEvent);i=o.forEachFeatureAtPixel(n,function(e,t){var o=!0;!e._wrap||e._wrap.parent.showsPopup||e._wrap.parent.options.selectable||(o=!1);o&&e._wrap&&r.parent.$events.trigger($.Event(TC.Consts.event.FEATUREOVER,{feature:e._wrap.parent}));return o},{hitTolerance:p})}t.style.cursor=i?"pointer":""};s.off(i+".popup").on(i+".popup",u)}});o.resolve()});o.promise()};TC.wrap.Map.prototype.hidePopup=function(e){this.parent.currentFeature=null;e.$popupDiv&&e.$popupDiv.removeClass(TC.Consts.classes.VISIBLE)};var E=function(t){switch(t){case TC.Consts.layerType.KML:case TC.Consts.mimeType.KML:return new e.format.KML({showPointNames:!1});case TC.Consts.layerType.GPX:case TC.Consts.mimeType.GPX:return new e.format.GPX;case TC.Consts.layerType.GEOJSON:case TC.Consts.mimeType.GEOJSON:case TC.Consts.mimeType.JSON:case TC.Consts.format.JSON:return new e.format.GeoJSON;case TC.Consts.format.GML2:return new e.format.GML2;case TC.Consts.format.GML3:return new e.format.GML3Patched;case TC.Consts.mimeType.GML:case TC.Consts.format.GML:return new e.format.GML;case TC.Consts.format.TOPOJSON:return new e.format.TopoJSON;case TC.Consts.format.WKT:return new e.format.WKT;default:return null}};TC.wrap.Map.prototype.exportFeatures=function(t,o){o=o||{};var r=M({styles:this.parent.options.styles}),i=t.map(function(e){var t=e.wrap.feature;t.getStyle()||t.setStyle(r);const o=H.call(t).getText();o&&(t=t.clone()).setProperties({name:o.getText()});return t}),n=E(o.format);if(n instanceof e.format.KML){const t=[];(i=i.map(function(t){const o=t.getGeometry();if(o instanceof e.geom.Point){var r=H.call(t);const i=r.getImage();if(i instanceof e.style.RegularShape){const n=i.getRadius(),a=i.getStroke(),l=(i.getFill(),2*n+a.getWidth()+1),s=l/2,p=document.createElement("canvas");p.width=l;p.height=l;const c=e.render.toContext(p.getContext("2d"),{size:[l,l]}),u=r.getText();(r=r.clone()).setText();c.setStyle(r);c.drawGeometry(new e.geom.Point([s,s]));const g=new e.Feature(o);g.setProperties(t.getProperties());g.setStyle(new e.style.Style({image:new e.style.Icon({src:p.toDataURL("image/png")}),text:u}));return g}}return t})).forEach(function(o){var r=H.call(o);const i=o.getGeometry(),n=r.getText();var a;if(n){switch(!0){case i instanceof e.geom.LineString:a=new e.geom.Point(i.getCoordinateAt(.5));break;case i instanceof e.geom.Polygon:a=i.getInteriorPoint();break;case i instanceof e.geom.MultiLineString:const t=i.getLineStrings();var l=-1;a=new e.geom.Point(t[t.map(function(e){return e.getLength()}).reduce(function(e,t,o){if(t>l){l=t;return o}return e},-1)].getCoordinateAt(.5));break;case i instanceof e.geom.MultiPolygon:const o=i.getPolygons();var s=-1;a=o[o.map(function(e){return e.getArea()}).reduce(function(e,t,o){if(t>s){s=t;return o}return e},-1)].getInteriorPoint()}if(a){const o=new e.Feature(a);o.setStyle(new e.style.Style({text:n.clone(),image:new e.style.Icon({crossOrigin:"anonymous",src:TC.apiLocation+"TC/css/img/transparent.gif"})}));t.push(o)}}});t.length&&(i=i.concat(t))}if(n instanceof e.format.GMLBase){(i=i.map(function(e){return e.clone()})).forEach(function(e){const t=e.values_,o=[];for(var r in t)r.indexOf(" ")>=0&&o.push(r);o.forEach(function(e){var o=e.replace(/ /g,"_");/^\d/.test(o)&&(o="_"+o);if(e!==o)for(;void 0!==t[o];)o+="_";t[o]=t[e];delete t[e]})});n.featureNS="sitna";n.featureType="feature";var a=n.writeFeaturesNode(i,{featureProjection:this.parent.crs}),l=e.xml.createElementNS("http://www.opengis.net/gml","FeatureCollection");e.xml.setAttributeNS(l,"http://www.w3.org/2001/XMLSchema-instance","xsi:schemaLocation",n.schemaLocation);a.removeAttribute("xmlns:xsi");a.removeAttribute("xsi:schemaLocation");l.appendChild(a)}n instanceof e.format.GPX&&(i=i.map(function(t){const o=t.getGeometry();o instanceof e.geom.LineString&&(t=t.clone()).setGeometry(new e.geom.MultiLineString([o.getCoordinates()]));return t}));var s=n.writeFeatures(i,{dataProjection:"EPSG:4326",featureProjection:this.parent.crs});n instanceof e.format.GPX&&(s=s.replace(/<ele>NaN<\/ele>/g,""));return s};var x=function(e){for(var t=0,o=e.dataTransfer.types.length;t<o;t++)if("Files"===e.dataTransfer.types[t])return!0;return!1},P=function(e){if(x(e)){this.getMap()._wrap.parent._$div.addClass(TC.Consts.classes.DROP);e.preventDefault();e.stopPropagation()}},L=function(e){if(x(e)){var t=this.getMap()._wrap.parent;e.target===this.target&&t._$div.removeClass(TC.Consts.classes.DROP)}};TC.wrap.Map.prototype.enableDragAndDrop=function(t){var o=this,r=t||{},i={formatConstructors:[e.format.KML,e.format.GPX,e.format.GML3CRS84,e.format.GML2CRS84,e.format.GML3Patched,e.format.GML2,e.format.GeoJSON,function(){return new e.format.WKT({splitCollection:!0})},e.format.TopoJSON]};r.dropTarget?i.target=TC.getDiv(r.dropTarget):i.target=o.parent.div;var n=new e.interaction.DragAndDrop(i);n.on(e.interaction.DragAndDrop.EventType_.ADD_FEATURES,function(e){var t=e.features?e.features.map(function(e){return TC.wrap.Feature.createFeature(e)}):[];$.when.apply(this,t).then(function(){var t=o.parent.getLoadingIndicator();t&&t.removeWait(o._featureImportWaitId);if(arguments.length){for(var r=new Array(arguments.length),i=0,n=r.length;i<n;i++)r[i]=arguments[i];o.parent.$events.trigger($.Event(TC.Consts.event.FEATURESIMPORT,{features:r,fileName:e.file.name}))}else o.parent.$events.trigger($.Event(TC.Consts.event.FEATURESIMPORTERROR,{file:e.file}))})});if(r.once)n.map_=o.map;else{o.map.addInteraction(n);var a=n.target?n.target:o.map.getViewport(),l=function(e){if(x(e)){var t=o.parent;if(n.target===e.target){var r=t.getLoadingIndicator();r&&(o._featureImportWaitId=r.addWait());e.stopPropagation()}else e.preventDefault();t._$div.removeClass(TC.Consts.classes.DROP)}};n.dropListenKeys_.push(e.events.listen(a,e.events.EventType.DRAGENTER,P,n));n.dropListenKeys_.push(e.events.listen(document.body,e.events.EventType.DRAGENTER,P,n));n.dropListenKeys_.push(e.events.listen(a,e.events.EventType.DRAGOVER,P,n));n.dropListenKeys_.push(e.events.listen(document.body,e.events.EventType.DRAGOVER,P,n));n.dropListenKeys_.push(e.events.listen(a,e.events.EventType.DROP,l,n));n.dropListenKeys_.push(e.events.listen(document.body,e.events.EventType.DROP,l,n));n.dropListenKeys_.push(e.events.listen(document.body,"dragleave",L,n));n.dropListenKeys_.push(e.events.listen(document.body,"dragend",L,n));n.dropListenKeys_.push(e.events.listen(document.body,"dragexit",L,n));document.addEventListener("mouseenter",function(e){e.buttons||o.parent._$div.removeClass(TC.Consts.classes.DROP)},!1);o.ddEnabled=!0}return n};TC.wrap.Map.prototype.loadFiles=function(t){var o;this.ddEnabled?this.map.getInteractions().forEach(function(t){t instanceof e.interaction.DragAndDrop&&(o=t)}):o=this.enableDragAndDrop({once:!0});var r=this.parent.getLoadingIndicator();r&&(this._featureImportWaitId=r.addWait());e.interaction.DragAndDrop.handleDrop_.call(o,{dataTransfer:{files:t}})};TC.wrap.Layer.prototype.getVisibility=function(e){var t=!1;this.layer&&(t=this.layer.getVisible());return t};TC.wrap.Layer.prototype.setVisibility=function(e){$.when(this.getLayer()).then(function(t){t.setVisible(e)})};TC.wrap.Layer.prototype.isNative=function(t){return t instanceof e.layer.Layer};TC.wrap.Layer.prototype.setProjection=function(t){const o=this;t=t||{};const r=o.parent;if(r.map){const n=S.call(o,{crs:t.crs,extentInDegrees:e.proj.transformExtent(r.map.getExtent(),r.map.crs,"EPSG:4326")});var i=r.getResolutions();if(i&&i.length){i=i.map(function(e){return e/n});r.wrap.layer.setMaxResolution(i[0]);r.wrap.layer.setMinResolution(i[i.length-1])}else{if(r.minResolution){r.minResolution=r.minResolution/n;o.layer.setMinResolution(r.minResolution)}if(r.maxResolution){r.maxResolution=r.maxResolution/n;o.layer.setMaxResolution(r.maxResolution)}}}};TC.wrap.layer.Raster.prototype.WmsParser=e.format.WMSCapabilities;TC.wrap.layer.Raster.prototype.WmtsParser=e.format.WMTSCapabilities;TC.wrap.Layer.prototype.addCommonEvents=function(e){var t=this;e.on("change:visible",function(){t.parent.map&&t.parent.map.$events.trigger($.Event(TC.Consts.event.LAYERVISIBILITY,{layer:t.parent}))},t.parent.map)};TC.wrap.layer.Raster.prototype.getGetMapUrl=function(){var e=null;switch(this.getServiceType()){case TC.Consts.layerType.WMS:for(var t=this.parent.capabilities.Capability.Request.GetMap.DCPType,o=0;o<t.length;o++)if(t[o].HTTP&&t[o].HTTP.Get){e=t[o].HTTP.Get.OnlineResource;break}break;case TC.Consts.layerType.WMTS:e=this.parent.capabilities.OperationsMetadata.GetTile.DCP.HTTP.Get[0].href}return e=$("<textarea />").html(e).text()};TC.wrap.layer.Raster.prototype.getInfoFormats=function(){var e=null,t=this.parent.capabilities;t.Capability&&t.Capability.Request.GetFeatureInfo&&(e=t.Capability.Request.GetFeatureInfo.Format);return e};TC.wrap.layer.Raster.infoFormatPreference=["application/json","application/vnd.ogc.gml/3.1.1","application/vnd.ogc.gml","application/vnd.esri.wms_featureinfo_xml","text/html","text/plain","text/xml"];TC.wrap.layer.Raster.prototype.getWMTSLayer=function(){var e=null,t=this.parent.capabilities;if(t&&t.Contents)for(var o=0;o<t.Contents.Layer.length;o++)for(var r=t.Contents.Layer[o],i=0;i<r.TileMatrixSetLink.length;i++)if(this.parent.options.matrixSet===r.TileMatrixSetLink[i].TileMatrixSet){e=r;break}return e};TC.wrap.layer.Raster.prototype.getTileMatrix=function(e){var t=null,o=this.parent.capabilities;if(o&&o.Contents&&o.Contents.TileMatrixSet)for(var r=0;r<o.Contents.TileMatrixSet.length;r++){var i=o.Contents.TileMatrixSet[r];if(i.Identifier===e){t=i.TileMatrix;break}}return t};TC.wrap.layer.Raster.prototype.getScaleDenominators=function(e){var t=[];e.ScaleDenominator?t=[e.ScaleDenominator,e.ScaleDenominator]:(e.MinScaleDenominator||e.MaxScaleDenominator)&&(t=[e.MaxScaleDenominator,e.MinScaleDenominator]);if(!t.length&&!this.getName(e)){for(var o=this.getLayerNodes(e),r=-1/0,i=1/0,n=0,a=o.length;n<a;n++){var l=this.getScaleDenominators(o[n]);l[0]>r&&(r=l[0]);l[1]<i&&(i=l[1])}r>-1/0&&i<1/0&&(t=[r,i])}return t};TC.wrap.layer.Raster.prototype.getAttribution=function(){const e={},t=TC.capabilities[this.parent.url];if(t)if(t.ServiceProvider){e.name=t.ServiceProvider.ProviderName.trim();e.site=t.ServiceProvider.ProviderSite;e.site.href&&e.site.href.trim().length>0&&(e.site=e.site.href)}else t.ServiceIdentification?e.name=t.ServiceIdentification.Title.trim():e.name=t.Service.Title.trim();return e};TC.wrap.layer.Raster.prototype.getInfo=function(e){var t=this,o={},r=t.parent.capabilities;if(r&&r.Capability)for(var i=t.getAllLayerNodes(),n=0;n<i.length;n++){var a=i[n];if(t.parent.compareNames(t.getName(a),e)){a.Title&&(o.title=a.Title);a.Abstract&&(o.abstract=a.Abstract);o.legend=[];var l=function(e,o){if(e.Layer&&e.Layer.length>0)for(var r in e.Layer)l(e.Layer[r],o);else o.apply(t,[e])};l(a,function(e){var t=this.getLegend(e);t.src&&o.legend.push({src:t.src,title:e.Title})});if(a.MetadataURL&&a.MetadataURL.length){o.metadata=[];for(var s=0;s<a.MetadataURL.length;s++){var p=a.MetadataURL[s];o.metadata.push({format:p.Format,type:p.type,url:p.OnlineResource})}}o.queryable=a.queryable;break}}return o};TC.wrap.layer.Raster.prototype.getServiceType=function(){var e=null,t=this.parent.capabilities;t.Capability&&t.Capability.Request&&t.Capability.Request.GetMap?e=TC.Consts.layerType.WMS:t.OperationsMetadata&&t.OperationsMetadata.GetTile&&(e=TC.Consts.layerType.WMTS);return e};TC.wrap.layer.Raster.prototype.getServiceTitle=function(){var e=null,t=this.parent.capabilities;t.Capability&&t.Service?e=t.Service.Title:t.ServiceIdentification&&(e=t.ServiceIdentification.Title);return e};TC.wrap.layer.Raster.prototype.getRootLayerNode=function(){var e;this.getServiceType()===TC.Consts.layerType.WMS&&(e=this.parent.capabilities.Capability.Layer);return e};TC.wrap.layer.Raster.prototype.getName=function(e,t){var o=e.Name;if(o&&t){var r=o.indexOf(":");r>=0&&(o=o.substr(r+1))}return o};TC.wrap.layer.Raster.prototype.getIdentifier=function(e){return e.Identifier};TC.wrap.layer.Raster.prototype.getLayerNodes=function(e){var t=e.Layer;$.isArray(t)||(t=t?[t]:[]);return t};TC.wrap.layer.Raster.prototype.getAllLayerNodes=function(){var e=this;if(!e._layerList)switch(e.getServiceType()){case TC.Consts.layerType.WMS:var t=e.getRootLayerNode();e._layerList=t?function t(o){for(var r=[o],i=e.getLayerNodes(o),n=0;n<i.length;n++)r=r.concat(t(i[n]));return r}(t):[];break;case TC.Consts.layerType.WMTS:e._layerList=e.parent.capabilities.Contents.Layer.slice();break;default:e._layerList=[]}return e._layerList};TC.wrap.layer.Raster.prototype.normalizeLayerNode=function(e){return e};TC.wrap.layer.Raster.prototype.normalizeCapabilities=function(e){return e};TC.wrap.layer.Raster.prototype.getLegend=function(e){var t={},o=e.Style;if(o&&o.length&&o.length&&o[0].LegendURL&&o[0].LegendURL.length){var r=o[0].LegendURL[0];t.src=$("<textarea />").html(r.OnlineResource).text()}return t};TC.wrap.layer.Raster.prototype.isCompatible=function(e){var t=this,o=!0,r=t.parent;switch(t.getServiceType()){case TC.Consts.layerType.WMS:if(r.capabilities&&r.capabilities.Capability&&r.capabilities.Capability.Layer&&r.names.length>0)for(var i=r.names.slice(0),n=function o(i,n,a){var l=!1;if(i)for(var s=0;s<i.length;s++){var p=i[s];const u=p.CRS||p.SRS,g=Array.isArray(u)?u:[u];var c=a||$.inArray(e,g)>=0;if(r.compareNames(t.getName(p),n)){c&&(l=!0);break}if(o(p.Layer,n,c)){l=!0;break}}return l};i.length>0;)if(!n([r.capabilities.Capability.Layer],i.pop())){o=!1;break}break;case TC.Consts.layerType.WMTS:o=!1;if(r.capabilities&&r.capabilities.Contents&&r.capabilities.Contents.TileMatrixSet)for(var a=r.capabilities.Contents.TileMatrixSet,l=0;l<a.length;l++)if(a[l].Identifier===r.options.matrixSet){o=TC.Util.CRSCodesEqual(e,a[l].SupportedCRS);break}}return o};TC.wrap.layer.Raster.prototype.getCompatibleCRS=function(){var e=[],t=this.parent;switch(this.getServiceType()){case TC.Consts.layerType.WMS:if(t.capabilities&&t.capabilities.Capability&&t.capabilities.Capability.Layer&&t.names.length>0){const o=t.names.map(function(e){return t.getNodePath(e).map(function(e){const t=e.CRS||e.SRS||[],o=Array.isArray(t)?t:[t];return $.isArray(o)?o:[o]}).reduce(function(e,t){if(0===e.length)return t;t.forEach(function(t){e.indexOf(t)<0&&(e[e.length-1]=t)});return e})});if(1===o.length)e=o[0];else{const t=o.slice(1);e=o[0].filter(function(e){return t.every(function(t){return t.indexOf(e)>=0})})}}break;case TC.Consts.layerType.WMTS:t.capabilities&&t.capabilities.Contents&&t.capabilities.Contents.Layer.filter(function(e){return e.Identifier===t.layerNames}).forEach(function(o){const r=o.TileMatrixSetLink.map(function(e){return e.TileMatrixSet});e=t.capabilities.Contents.TileMatrixSet.filter(function(e){return r.indexOf(e.Identifier)>=0}).map(function(e){return e.SupportedCRS})})}return e};TC.wrap.layer.Raster.prototype.getCompatibleLayers=function(e){var t=[],o=this.parent;switch(this.getServiceType()){case TC.Consts.layerType.WMS:if(o.capabilities&&o.capabilities.Capability&&o.capabilities.Capability.Layer){var r=function(e,o,i){var n=e.CRS||e.SRS,a=Array.isArray(n)?n:[n],l=i||$.inArray(o,a)>=0;l&&e.Name&&(t[t.length]=e.Name);if(e.Layer)for(var s=0;s<e.Layer.length;s++)r(e.Layer[s],o,l)};r(o.capabilities.Capability.Layer,e)}break;case TC.Consts.layerType.WMTS:if(o.capabilities&&o.capabilities.Contents&&o.capabilities.Contents.TileMatrixSet)for(var i=o.capabilities.Contents.TileMatrixSet,n=0,a=i.length;n<a;n++){var l=i[n];if(TC.Util.CRSCodesEqual(e,l.SupportedCRS))for(var s=l.Identifier,p=o.capabilities.Contents.Layer,c=0,u=p.length;c<u;c++)for(var g=p[c].TileMatrixSetLink,d=0,h=g.length;d<h;d++)if(g[d].TileMatrixSet===s){t[t.length]=p[c].Identifier;break}}}return t};TC.wrap.layer.Raster.prototype.getCompatibleMatrixSets=function(e){var t=[];_({crs:e});var o=this.parent;if(this.getServiceType()===TC.Consts.layerType.WMTS)for(var r=o.capabilities.Contents.Layer,i=o.capabilities.Contents.TileMatrixSet,n=0,a=r.length;n<a;n++)if(o.layerNames===r[n].Identifier)for(var l=r[n].TileMatrixSetLink,s=0,p=l.length;s<p;s++)for(var c=l[s],u=0,g=i.length;u<g;u++){var d=i[u];if(d.Identifier===c.TileMatrixSet){TC.Util.CRSCodesEqual(e,d.SupportedCRS)&&(t[t.length]=d.Identifier);break}}return t};TC.wrap.layer.Raster.prototype.setWMTSUrl=function(){var e=this;$.when(e.getLayer()).then(function(t){e.parent.options=e.parent.options||{};var o=t.getSource().getUrls();e.parent.options.urlPattern=o[o.length-1]})};TC.wrap.layer.Raster.prototype.createWMSLayer=function(t,o,r){var i=this,n=null;i.$events=$(i);var a=new e.source.ImageWMS({url:t,crossOrigin:r.map?r.map.options.crossOrigin:void 0,params:o,extent:TC.Cfg.initialExtent,ratio:TC.Cfg.imageRatio,imageLoadFunction:$.proxy(i.parent.getImageLoad,i.parent)});a.on(e.source.Image.EventType_.IMAGELOADSTART,function(e){i.$events.trigger($.Event(TC.Consts.event.BEFORETILELOAD,{tile:e.image.getImage()}))});a.on(e.source.Image.EventType_.IMAGELOADEND,function(e){i.$events.trigger($.Event(TC.Consts.event.TILELOAD,{tile:e.image.getImage()}))});a.on(e.source.Image.EventType_.IMAGELOADERROR,function(e){i.$events.trigger($.Event(TC.Consts.event.TILELOAD,{tile:e.image.getImage()}))});var l={visible:!!o.LAYERS.length||r&&r.method&&"POST"===r.method,source:a};r.minResolution&&(l.minResolution=r.minResolution);r.maxResolution&&(l.maxResolution=r.maxResolution);(n=new e.layer.Image(l))._wrap=i;i.addCommonEvents(n);return n};var w=function(t){var o=this,r=null,i=e.source.WMTS.optionsFromCapabilities(o.parent.capabilities,{layer:t.layerNames,matrixSet:t.matrixSet,crossOrigin:t.map?t.map.options.crossOrigin:void 0,requestEncoding:t.encoding,format:t.format});"https:"===location.protocol&&(i.urls=i.urls.map(function(e){return e.replace("http:","https:")}));i.crossOrigin=t.map?t.map.options.crossOrigin:void 0;(r=new e.source.WMTS(i)).setTileLoadFunction($.proxy(o.parent.getImageLoad,o.parent));r.on(e.source.TileEventType.TILELOADSTART,function(e){o.$events.trigger($.Event(TC.Consts.event.BEFORETILELOAD,{tile:e.tile.getImage()}))});r.on(e.source.TileEventType.TILELOADEND,function(e){o.$events.trigger($.Event(TC.Consts.event.TILELOAD,{tile:e.tile.getImage()}))});r.on(e.source.TileEventType.TILELOADERROR,function(e){o.$events.trigger($.Event(TC.Consts.event.TILELOAD,{tile:e.tile.getImage()}))});var n=$.proxy(r.getResolutions,r);r.getResolutions=function(){var e=n(),t=o.parent.getLimitedMatrixSet();if(t&&t.length){var r=t[0].matrixIndex;e=e.slice(r,t.length+r)}return e};return r};TC.wrap.layer.Raster.prototype.createWMTSLayer=function(t){var o=null;this.$events=$(this);var r=w.call(this,t),i={source:r};t.minResolution&&(i.minResolution=t.minResolution);t.maxResolution&&(i.maxResolution=t.maxResolution);(o=new e.layer.Tile(i))._wrap=this;this.addCommonEvents(o);var n=r.getResolutions();o.setMaxResolution(n[0]+1);o.setMinResolution(n[n.length-1]);return o};TC.wrap.layer.Raster.prototype.getParams=function(){return this.layer.getSource().getParams()};TC.wrap.layer.Raster.prototype.setParams=function(e){this.layer.getSource().updateParams(e)};TC.wrap.layer.Raster.prototype.setMatrixSet=function(e){const t=this;t.layer.getSource().getResolutions();if(t.parent.type===TC.Consts.layerType.WMTS){const o=w.call(t,$.extend({},t.parent.options,{matrixSet:e})),r=o.getResolutions(),i=r[0],n=r[r.length-1];t.layer.setMaxResolution(i);t.layer.setMinResolution(n);t.parent.minResolution&&(t.parent.minResolution=n);t.parent.maxResolution&&(t.parent.maxResolution=i);t.layer.setSource(o)}};TC.wrap.layer.Raster.prototype.getResolutions=function(){if(this.layer.getSource){var e=this.layer.getSource();return e.getResolutions&&e.getResolutions!=goog.abstractMethod?e.getResolutions():[]}return[]};TC.wrap.Geometry={getNearest:function(t,o){return new e.geom.LineString(o).getClosestPoint(t)}};var b=function(e,t,o){if(e){var r=function(r){var i=(o&&o._wrap?o._wrap.parent.options.width:null)||t;if(i<r){var n=i/r;e.setScale(n)}},i=e.getSize();if(i)r(i[0]);else{var n=e.getImage();n.naturalWidth?r(n.naturalWidth):$('<img src="'+e.getSrc()+'">').on("load",function(){r(this.naturalWidth)})}}},R=function(e,t){var o=e,r=t&&t.wrap&&t.wrap.feature;if("string"==typeof e){var i=e.match(/^\$\{(.+)\}$/);if(i&&r){for(var n=i[1].split("."),a=r.getProperties(),l=0;l<n.length&&void 0!==a;l++)a=a[n[l]];if(void 0===a){a=t.data;for(l=0;l<n.length&&void 0!==a;l++)a=a[n[l]]}o=a}}else $.isFunction(e)&&(o=e(t));return o},A=function(e){var t=e.getStyle();$.isFunction(t)&&(t=t.call(e));$.isArray(t)&&(t=t[0]);return t},M=function(t,o){var r,i,n={};o&&(r=o._wrap?o._wrap.parent:{id:TC.wrap.Feature.prototype.getId.call({feature:o}),features:o.get("features"),getData:function(){return TC.wrap.Feature.prototype.getData.call({feature:o})}});var a={};if((i=r&&$.isArray(r.features)&&r.features.length>1&&t.cluster?$.extend(!0,{},TC.Cfg.styles.cluster,t.cluster.styles):t.styles||TC.Cfg.styles).line){a=i.line;n.stroke=new e.style.Stroke({color:R(i.line.strokeColor,r),width:R(i.line.strokeWidth,r),lineDash:i.line.lineDash})}if(i.polygon){a=i.polygon;n.fill=new e.style.Fill({color:v(R(i.polygon.fillColor,r),R(i.polygon.fillOpacity,r))});n.stroke=new e.style.Stroke({color:R(i.polygon.strokeColor,r),width:R(i.polygon.strokeWidth,r),lineDash:i.polygon.lineDash})}if(i.point){a=i.point;var l={radius:R(a.radius,r)||(R(a.height,r)+R(a.width,r))/4};a.fillColor&&(l.fill=new e.style.Fill({color:v(R(a.fillColor,r),R(a.fillOpacity,r))}));a.strokeColor&&(l.stroke=new e.style.Stroke({color:R(a.strokeColor,r),width:R(a.strokeWidth,r),lineDash:a.lineDash}));isNaN(l.radius)||(n.image=new e.style.Circle(l))}a.label&&(n.text=I(a,r));if(i.marker){if((a=i.marker).url){n.image=new e.style.Icon({crossOrigin:"anonymous",anchor:a.anchor,anchorXUnits:a.anchorXUnits||"fraction",anchorYUnits:a.anchorYUnits||"fraction",src:a.url});n.text=I(a,r)}}return[new e.style.Style(n)]},I=function(t,o){if(t&&t.label){var r={text:""+R(t.label,o)};t.fontSize&&(r.font=R(t.fontSize,o)+"pt sans-serif");t.angle&&(r.rotation=-Math.PI*R(t.angle,o)/180);t.fontColor&&(r.fill=new e.style.Fill({color:v(R(t.fontColor,o),1)}));t.labelOutlineColor&&(r.stroke=new e.style.Stroke({color:v(R(t.labelOutlineColor,o),1),width:R(t.labelOutlineWidth,o)}));if(t.labelOffset){r.offsetX=t.labelOffset[0];r.offsetY=t.labelOffset[1]}return new e.style.Text(r)}},O=function(e){var t=e.toString(16);1===t.length&&(t="0"+t);return t},N=function(e){return"#"+O(e[0])+O(e[1])+O(e[2])},D=function(t,o){var r={};$.isFunction(t)&&o&&(t=t(o));$.isArray(t)&&(t=t[0]);if(!$.isFunction(t)){var i,n,a,l=t.getImage();if(l)if(l instanceof e.style.RegularShape){n=l.getStroke();i=e.color.asArray(n.getColor());r.strokeColor=N(i);r.strokeWidth=n.getWidth();if(a=l.getFill()){i=e.color.asArray(a.getColor());r.fillColor=N(i);r.fillOpacity=i[3]}}else{r.url=l.getSrc();var s=l.getSize();if(s){r.width=s[0];r.height=s[1];r.anchor=l.getAnchor();if(r.anchor){r.anchor[0]=r.anchor[0]/r.width;r.anchor[1]=r.anchor[1]/r.height}}}else{if(n=t.getStroke()){i=e.color.asArray(n.getColor());r.strokeColor=N(i);r.strokeWidth=n.getWidth();r.lineDash=n.getLineDash()}if(a=t.getFill()){i=e.color.asArray(a.getColor());r.fillColor=N(i);r.fillOpacity=i[3]}}}return r};TC.wrap.layer.Vector.prototype.getStyle=function(){return D(this.layer.getStyle())};TC.wrap.layer.Vector.prototype.reloadSource=function(){var t=new $.Deferred,o=this.createVectorSource(this.parent,this.createStyles(this.parent));if(this.parent.type===TC.Consts.layerType.WFS)var r=o.source.on("change",function(i){if("ready"==o.source.getState()){e.Observable.unByKey(r);t.resolve()}});var i=this.layer.getSource().getFeatures();this.layer.setSource(o.source);o.style&&this.layer.setStyle(o.style);if(this.parent.type!=TC.Consts.layerType.WFS){o.source.addFeatures(i);t.resolve()}return t};TC.wrap.layer.Vector.prototype.import=function(e){var t=$.extend({},e);t.type=e.format;var o=this.layer.getSource().getFeatures(),r=this.createVectorSource(t,this.createStyles(this.parent));this.layer.setSource(r.source);r.style&&this.layer.setStyle(r.style);r.source.addFeatures(o)};const F=function(t){const o=$.Deferred();if(t._wrapDeferred)t._wrapDeferred.then(function(e){o.resolve(e.parent)});else{t._wrapDeferred=$.Deferred();var r=void 0,i=t.getGeometry();const n=t.getStyle();n&&(r=D(n,t));const a=function(e){TC.loadJS(!TC.feature||!TC.feature[e],TC.apiLocation+"TC/feature/"+e,function(){o.resolve(new TC.feature[e](t,r));t._wrapDeferred.resolve(t._wrap)})};i instanceof e.geom.Point?!function(t){var o=null,r=A(t);if(r){var i=r.getImage();i instanceof e.style.Icon&&(o=i.getSrc())}return o}(t)?a("Point"):a("Marker"):i instanceof e.geom.LineString?a("Polyline"):i instanceof e.geom.Polygon?a("Polygon"):i instanceof e.geom.MultiLineString?a("MultiPolyline"):i instanceof e.geom.MultiPolygon&&a("MultiPolygon")}return o.promise()};TC.wrap.layer.Vector.prototype.createVectorSource=function(t,o){var r,i,n,a,l,s=this,p=!1;if($.isArray(t.url)||t.urls){var c=t.urls||t.url;i={url:c=$.map(c,function(e,t){return TC.proxify(e)}),format:new e.format.KML({showPointNames:!1}),projection:t.crs}}else if(t.url&&t.type!==TC.Consts.layerType.WFS){(i={url:TC.proxify(t.url),projection:t.crs}).format=E(t.format)||E(function(e){var t=e.indexOf("?");t>=0?e=e.substr(0,t):(t=e.indexOf("#"))>=0&&(e=e.substr(0,t));switch(e.substr(e.lastIndexOf(".")+1).toLowerCase()){case"kml":return TC.Consts.mimeType.KML;case"json":case"geojson":return TC.Consts.mimeType.GEOJSON;case"gml":return TC.Consts.mimeType.GML;case"gpx":return TC.Consts.mimeType.GPX;default:return null}}(t.url))||E(t.type);i.loader=(n=i.url,a=i.format,l=e.featureloader.xhr(n,a),function(e,t,o){s.parent.state=TC.Layer.state.LOADING;s.parent.map&&s.parent.map.$events.trigger($.Event(TC.Consts.event.BEFORELAYERUPDATE,{layer:s.parent}));l.call(this,e,t,o)});p=!0}else if(t.data)(i={projection:t.crs,loader:function(e,o,r){s.parent.state=TC.Layer.state.LOADING;s.parent.map&&s.parent.map.$events.trigger($.Event(TC.Consts.event.BEFORELAYERUPDATE,{layer:s.parent}));var i=this.getFormat();try{var n=i.readFeatures(t.data,{featureProjection:r});this.addFeatures(n);s.parent.state=TC.Layer.state.IDLE;s.parent.map&&s.parent.map.$events.trigger($.Event(TC.Consts.event.LAYERUPDATE,{layer:s.parent,newData:data}))}catch(e){s.parent.state=TC.Layer.state.IDLE;s.parent.map&&s.parent.map.$events.trigger($.Event(TC.Consts.event.LAYERERROR,{layer:s.parent,reason:e.message}))}}}).format=E(t.format)||E(t.type);else if(t.type==TC.Consts.layerType.WFS){var u,g;switch(t.outputFormat){case TC.Consts.format.JSON:u=new e.format.GeoJSON({geometryName:t.geometryName});g="json";break;case TC.Consts.format.GML3:u=new e.format.GML3Patched;g=TC.Consts.mimeType.GML;break;default:u=new e.format.GML2;g=TC.Consts.mimeType.GML}i={format:u,loader:function(e,o,r){var i=this,n=t.url;if(n){s.parent.state=TC.Layer.state.LOADING;s.parent.map.$events.trigger($.Event(TC.Consts.event.BEFORELAYERUPDATE,{layer:s.parent}));var a={},l=r.getCode(),p=t.version||"1.1.0",c=n,d=$.isArray(t.featureType)?t.featureType:[t.featureType];if(!t.properties||t.properties instanceof Array&&!t.properties.length||!Object.keys(t.properties).length){c=c+"?service=WFS&version="+p+"&request=GetFeature&typename="+d.join(",")+"&outputFormat="+g+"&srsname="+l;e[0]!==-1/0&&e[1]!==-1/0&&e[2]!==1/0&&e[3]!==1/0&&(c=c+"&bbox="+e.join(",")+","+l);t.maxFeatures&&(c=c+"maxFeatures="+t.maxFeatures)}else{a.type="POST";a.contentType=TC.Consts.mimeType.XML;a.processData=!1;var h=[];h[h.length]='<wfs:GetFeature xmlns:wfs="http://www.opengis.net/wfs" service="WFS" version="';h[h.length]=p;h[h.length]='" outputFormat="';h[h.length]=t.outputFormat;if(t.maxFeatures){h[h.length]='" maxFeatures="';h[h.length]=t.maxFeatures}h[h.length]='" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.opengis.net/wfs http://schemas.opengis.net/wfs/';h[h.length]=p;h[h.length]='/wfs.xsd">';for(var f=0;f<d.length;f++){h[h.length]='<wfs:Query typeName="feature:';h[h.length]=d[f];h[h.length]='" srsName="';h[h.length]=l;h[h.length]='">';if(t.propertynames){var y="1.1.0"===p?"wfs":"ogc",m="string"==typeof t.propertynames?t.propertynames.split(","):t.propertynames;t.geometryName&&m.push(t.geometryName);for(;f<m.length;f++)h[h.length]="<"+y+":PropertyName>"+m[f].trim()+"</"+y+":PropertyName>"}h[h.length]=t.properties.getText();h[h.length]="</wfs:Query>"}h[h.length]="</wfs:GetFeature>";a.data=h.join("")}a.url=c;s._requestUrl=c;$.ajax(a).done(function(e){i.addFeatures(u.readFeatures(e));s.parent.state=TC.Layer.state.IDLE;s.parent.map.$events.trigger($.Event(TC.Consts.event.LAYERUPDATE,{layer:s.parent,newData:e}))})}},projection:t.crs}}r=new e.source.Vector(i);p&&r.on(e.events.EventType.CHANGE,function(e){s.parent.map&&s.parent.map.$events.trigger($.Event(TC.Consts.event.LAYERUPDATE,{layer:s.parent}))});r._tcLayer=s.parent;var d=t.style&&t.style.marker?t.style.marker:TC.Cfg.styles.marker;t.style&&t.style.marker||(d=$.extend({},d,{anchor:TC.Cfg.styles.point.anchor}));if(t.cluster){r=new e.source.Cluster({projection:t.crs,distance:t.cluster.distance,source:r});if(t.cluster.animate){var h=function(t,o){var r=Date.now(),i=t.getGeometry().getCoordinates(),n=o.getGeometry().getCoordinates();o.setGeometry(new e.geom.Point(i));requestAnimationFrame(function a(){var l=function(e,t,o,r){var i=Math.min((Date.now()-r)/o,1),n=(t[0]-e[0])*i,a=(t[1]-e[1])*i;return[e[0]+n,e[1]+a]}(i,n,TC.Consts.CLUSTER_ANIMATION_DURATION,r);o.setGeometry(new e.geom.Point(l));l[0]!==n[0]&&l[1]!==n[1]?requestAnimationFrame(a):f.splice($.inArray(t,f),1)})},f=[];r.addEventListener(e.source.VectorEventType.REMOVEFEATURE,function(e){var t=e.feature.get("features");t&&t.length>1&&f.push(e.feature)});r.addEventListener(e.source.VectorEventType.ADDFEATURE,function(e){var t=e.feature.get("features");if(t){var o=t[0].getGeometry().getCoordinates();if(t.length>1){var r=$.grep(f,function(e){var t=e.getGeometry().getCoordinates();return t[0]===o[0]&&t[1]===o[1]});r.length&&f.splice($.inArray(r[0],f),1)}var i=$.grep(f,function(e){var t=e.get("features");if(t&&t.length>0){return $.grep(t,function(e){var t=e.getGeometry().getCoordinates();return t[0]===o[0]&&t[1]===o[1]}).length>0}});i.length&&h(i[i.length-1],e.feature)}})}}var y=r;do{y.addEventListener(e.source.VectorEventType.ADDFEATURE,function(e){var t=e.feature,o=A(t);o&&b(o.getImage(),d.width,t)});y=$.isFunction(y.getSource)?y.getSource():null}while(y);r.addEventListener(e.source.VectorEventType.ADDFEATURE,function(e){const t=e.feature,o=function(e){var o;switch(!0){case TC.feature.Point&&e instanceof TC.feature.Point:o=s.parent.addPoint;break;case TC.feature.Polyline&&e instanceof TC.feature.Polyline:o=s.parent.addPolyline;break;case TC.feature.Polygon&&e instanceof TC.feature.Polygon:o=s.parent.addPolygon;break;case TC.feature.MultiPolygon&&e instanceof TC.feature.MultiPolygon:o=s.parent.addMultiPolygon;break;case TC.feature.MultiPolyline&&e instanceof TC.feature.MultiPolyline:o=s.parent.addMultiPolyline}if(o){var r;o.call(s.parent,t).then(function(o){var i=t.get("features");$.isArray(i)&&(o.features=$.map(i,function(t){return new e.constructor(t)}));clearTimeout(r);r=setTimeout(function(){s.parent.map.$events.trigger($.Event(TC.Consts.event.FEATURESADD,{layer:s.parent,features:[o]}))},50)})}};t._wrap&&t._wrap.parent.layer||F(t).then(o)});r.addEventListener(e.source.VectorEventType.REMOVEFEATURE,function(e){var t=e.feature;if(t._wrap){var o=$.inArray(t._wrap.parent,s.parent.features);if(o>-1){s.parent.features.splice(o,1);s.parent.map.$events.trigger($.Event(TC.Consts.event.FEATUREREMOVE,{layer:s.parent,feature:t._wrap.parent}))}}});r.addEventListener(e.source.VectorEventType.ADDFEATURE,function(e){s.parent.map&&s.parent.map.$events.trigger($.Event(TC.Consts.event.VECTORUPDATE,{layer:s.parent}))});r.addEventListener(e.source.VectorEventType.REMOVEFEATURE,function(){s.parent.map&&s.parent.map.$events.trigger($.Event(TC.Consts.event.VECTORUPDATE,{layer:s.parent}))});r.addEventListener(e.source.VectorEventType.CLEAR,function(){s.parent.map&&s.parent.map.$events.trigger($.Event(TC.Consts.event.FEATURESCLEAR,{layer:s.parent}))});var m={source:r};t.minResolution&&(m.minResolution=t.minResolution);t.maxResolution&&(m.maxResolution=t.maxResolution);i&&i.format instanceof e.format.KML&&!t.cluster||(m.style=o||t.styles);return m};TC.wrap.layer.Vector.prototype.createStyles=function(e){var t=this,o=!1;if($.isFunction(e)){o=!0;t.styleFunction=function(t){return M(e(t))}}else{(e=$.extend({},e)).crs=e.crs||TC.Cfg.crs;e.styles=e.styles||TC.Cfg.styles;o=!(!e.cluster||!e.cluster.styles)||function e(t){for(var o in t){var r=t[o];switch(typeof r){case"string":if(/^\$\{(.+)\}$/.test(r))return!0;break;case"object":if(e(r))return!0;break;case"function":return!0}}return!1}(e.styles);t.styleFunction=function(e){return M(t.parent.options,e)}}return o?t.styleFunction:t.styleFunction()};TC.wrap.layer.Vector.prototype.setStyles=function(e){const t=this;$.when(t.getLayer()).then(function(o){o.setStyle(t.createStyles(e))})};TC.wrap.layer.Vector.prototype.createVectorLayer=function(){var t=null;this.$events=$(this);var o=this.parent.options,r=this.createVectorSource(o,this.createStyles(o));r.declutter=this.parent.options.declutter||!1;(t=new e.layer.Vector(r))._wrap=this;this.addCommonEvents(t);return t};TC.wrap.layer.Vector.prototype.addFeatures=function(e){$.when(this.getLayer()).then(function(t){for(var o=t;$.isFunction(o.getSource);)o=o.getSource();o.addFeatures(e)})};TC.wrap.layer.Vector.prototype.getFeatures=function(){var t=this.getLayer();return t instanceof e.layer.Layer?t.getSource().getFeatures():[]};TC.wrap.layer.Vector.prototype.getFeatureById=function(t){var o=this.getLayer();return o instanceof e.layer.Layer?o.getSource().getFeatureById(t):null};TC.wrap.layer.Vector.prototype.removeFeature=function(e){$.when(this.getLayer()).then(function(t){t.getSource().removeFeature(e.wrap.feature)})};TC.wrap.layer.Vector.prototype.clearFeatures=function(){$.when(this.getLayer()).then(function(e){var t=e.getSource();t.clearFeatures?t.clearFeatures():t.clear()})};TC.wrap.layer.Vector.prototype.setFeatureVisibility=function(t,o){var r=this,i={color:"rgba(0, 0, 0, 0)"},n={color:"rgba(0, 0, 0, 0)"},a=new e.style.Style({image:new e.style.Circle({radius:0,fill:new e.style.Fill(i),stroke:new e.style.Stroke(n)}),fill:new e.style.Fill(i),stroke:new e.style.Stroke(n)});if($.inArray(t,r.parent.features)>=0){var l=t.wrap.feature;if(o&&l._originalStyle)l.setStyle(l._originalStyle);else{l._originalStyle=l.getStyle();l.setStyle(a)}$.when(r.getLayer()).then(function(e){r.parent.map.$events.trigger($.Event(TC.Consts.event.VECTORUPDATE,{layer:r.parent}))})}};TC.wrap.layer.Vector.prototype.getRGBA=function(e,t){return v(e,t)};TC.wrap.layer.Vector.prototype.findFeature=function(e){};TC.wrap.layer.Vector.prototype.getGetFeatureUrl=function(){return this._requestUrl};TC.wrap.layer.Vector.prototype.getDescribeFeatureTypeUrl=function(){var e=this.parent,t=e.options.version||"1.1.0",o=e.url;return o=o+"?service=WFS&version="+t+"&request=DescribeFeatureType&typename="+($.isArray(e.options.featureType)?e.options.featureType:[e.options.featureType]).join(",")+"&outputFormat=XMLSCHEMA"};TC.wrap.layer.Vector.prototype.sendTransaction=function(t,o,r){var i=this,n=$.Deferred(),a=function(e){return e.wrap.feature},l=$.map(t,a),s=$.map(o,a),p=$.map(r,a);t.length||o.length||r.length?$.when(i.getLayer()).then(function(t){t.getSource();var o=new e.format.WFS,r=i.parent.options,a=o.writeTransaction(l,s,p,{featurePrefix:r.featurePrefix,featureNS:r.featureNS,featureType:r.featureType[0]}),c={url:i.parent.url,type:"POST",contentType:TC.Consts.mimeType.XML,processData:!1,data:a.outerHTML};$.ajax(c).done(function(e){var t=e.getElementsByTagName("ExceptionReport")[0],r={reason:""};if(t){var i=t.getElementsByTagName("Exception")[0];if(i){r.code=i.getAttribute("exceptionCode");for(var a=i.getElementsByTagName("ExceptionText"),l=0,s=a.length;l<s;l++)r.reason+="\n"+a[l].innerHTML}n.reject(r)}else{var p=o.readTransactionResponse(e);n.resolve(p)}}).fail(function(){n.reject({code:"",reason:"unknown"})})}):n.resolve(i.parent);return n};TC.wrap.layer.Vector.prototype.setDraggable=function(t,o,r){var i=this;$.when(i.parent.map.wrap.getMap(),i.getLayer()).then(function(n,a){if(t){var l={layers:[a],features:new e.Collection(a.getSource().getFeatures())};i.interaction=new e.interaction.Translate(l);$.isFunction(o)&&i.interaction.on(e.interaction.TranslateEventType.TRANSLATEEND,function(e){e.features.getLength()&&o(e.features.item(0)._wrap.parent)});$.isFunction(r)&&i.interaction.on(e.interaction.TranslateEventType.TRANSLATESTART,function(e){e.features.getLength()&&r(e.features.item(0)._wrap.parent)});n.addInteraction(i.interaction);if(TC.Util.detectIE()){i._handlerDraggablePointerMove=function(e){if(!e.dragging){var t=n.getEventPixel(e.originalEvent);n.hasFeatureAtPixel(t)?n.forEachFeatureAtPixel(t,function(e,t){t._wrap&&t._wrap.parent&&t._wrap.parent.id===i.parent.id&&e?n.getTarget().style.cursor="move":n.getTarget().style.cursor=""},{hitTolerance:p}):n.getTarget().style.cursor=""}};n.on("pointermove",i._handlerDraggablePointerMove)}}else if(i.interaction){n.removeInteraction(i.interaction);if(TC.Util.detectIE()&&i._handlerDraggablePointerMove&&$.isFunction(i._handlerDraggablePointerMove)){n.un("pointermove",i._handlerDraggablePointerMove);delete i._handlerDraggablePointerMove}}})};TC.wrap.layer.Vector.prototype.getFeaturesInExtent=function(t,o){var r=this.getLayer().getSource().getFeatures(),i=[];if(o){var n=this.parent.map.getPixelFromCoordinate([t[0],t[1]]),a=this.parent.map.getPixelFromCoordinate([t[2],t[3]]);n[0]-=o[0]/2;n[1]+=o[1];a[0]+=o[0]/2;t=this.parent.map.getCoordinateFromPixel(n).concat(this.parent.map.getCoordinateFromPixel(a))}for(var l=0;l<r.length;l++){var s=r[l],p=s.getGeometry().getCoordinates();e.extent.containsCoordinate(t,p)&&i.push(s._wrap.parent)}return i};TC.wrap.control.Click.prototype.register=function(e){var t=this;t._trigger=function(o){var r=0;e.wrap.map.forEachFeatureAtPixel(o.pixel,function(e,t){e._wrap&&e._wrap.parent.showsPopup&&r++},{hitTolerance:p});if(!r){t.parent.map.$events.trigger($.Event(TC.Consts.event.CLICK,{coordinate:o.coordinate,pixel:o.pixel}));t.parent.callback(o.coordinate,o.pixel)}return 0===r}};TC.wrap.control.Click.prototype.activate=function(){var t=this;$.when(t.parent.map.wrap.getMap()).then(function(o){o.on(e.MapBrowserEventType.SINGLECLICK,t._trigger)})};TC.wrap.control.Click.prototype.deactivate=function(){var t=this;$.when(t.parent.map.wrap.getMap()).then(function(o){o.un(e.MapBrowserEventType.SINGLECLICK,t._trigger)})};TC.wrap.control.ScaleBar.prototype.render=function(){this.ctl?this.ctl.updateElement_():this.ctl=new e.control.ScaleLine({target:this.parent.div})};TC.wrap.control.ScaleBar.prototype.getText=function(){if(this.ctl)return this.ctl.renderedHTML_};TC.wrap.control.NavBar.prototype.register=function(t){var o=this;$.when(t.wrap.getMap()).then(function(r){var i=o.parent.div;o.zCtl=new e.control.Zoom({target:i});o.zsCtl=new e.control.ZoomSlider({target:i,render:function(t){if(!t.frameState||!t.frameState.viewState||r.getView().getMinResolution()<=t.frameState.viewState.resolution){var i=function(){if(this.element.offsetWidth>this.element.offsetHeight){o.requestSliderSize||(o.requestSliderSize=window.requestAnimationFrame(i.bind(this)));window.requestAnimationFrame(i.bind(this))}else if(this.element.offsetWidth<this.element.offsetHeight){if(o.requestSliderSize){window.cancelAnimationFrame(o.requestSliderSize);delete o.requestSliderSize}e.control.ZoomSlider.render.call(this,t)}};i.call(this)}}});o.z2eCtl=new e.control.ZoomToExtent({target:i,extent:t.initialExtent,tipLabel:""});r.addControl(o.zCtl);r.addControl(o.zsCtl);r.addControl(o.z2eCtl);var n=o.parent._$div;$buttons=n.find("button").addClass("tc-ctl-btn "+o.parent.CLASS+"-btn").css("display","block").html("");$buttons.filter(".ol-zoom-in").addClass(o.parent.CLASS+"-btn-zoomin").attr("title",o.parent.getLocaleString("zoomIn"));$buttons.filter(".ol-zoom-out").addClass(o.parent.CLASS+"-btn-zoomout").attr("title",o.parent.getLocaleString("zoomOut"));n.find(".ol-zoom-extent button").addClass(o.parent.CLASS+"-btn-home").attr("title",o.parent.getLocaleString("zoomToInitialExtent"));$(t.div).find(".ol-zoomslider").addClass(o.parent.CLASS+"-bar").find(".ol-zoomslider-thumb").addClass(o.parent.CLASS+"-slider");t.on(TC.Consts.event.BASELAYERCHANGE,$.proxy(o.refresh,o))})};TC.wrap.control.NavBar.prototype.refresh=function(){var t=this,o=t.parent.map.wrap.map;if(t.zsCtl.sliderInitialized_){var r=o.getView().getResolution();t.zsCtl.setThumbPosition_(r)}else o.once(e.MapEventType.POSTRENDER,function(e){t.zsCtl.render(e)})};TC.wrap.control.NavBar.prototype.setInitialExtent=function(e){this.z2eCtl.extent=e};TC.wrap.control.Coordinates.prototype.register=function(t){var o=this,r=new $.Deferred;o.map=t;o._coordsTrigger=function(e){o.parent.coordsToClick(e)};$.when(t.wrap.getMap()).then(function(t){o.olMap=t;var i=t.getView().getProjection();o.parent.crs=i.getCode();o.parent.units=i.getUnits();o.parent.isGeo=o.parent.units===e.proj.Units.DEGREES;$(t.getViewport()).add(o.parent.div);r.resolve()});return r};TC.wrap.control.Coordinates.prototype.onMouseMove=function(e){var t=this;$.when(t.map.wrap.getMap()).then(function(o){var r=o.getEventCoordinate(e);if(r){t.parent.isGeo?t.parent.latLon=r.reverse():t.parent.xy=r;t.parent.update.apply(t.parent,arguments)}})};TC.wrap.control.Geolocation.prototype.register=function(e){var t=this;t.map=e;t._snapTrigger=function(e){e.dragging||t.initSnap(t.olMap.getEventCoordinate(e.originalEvent),e.pixel)};t._postcomposeTrigger=function(e){t.duringTrackSnap(e)};$.when(e.wrap.getMap()).then(function(e){t.olMap=e})};var k=function(){return this.parent.layerTracking.features.filter(function(e){return e instanceof TC.feature.Polyline})[0]};TC.wrap.control.Geolocation.prototype.hasCoordinates=function(){return this.parent.layerTracking.features.length>0&&this.parent.layerTracking.features[0].geometry.length>=1};TC.wrap.control.Geolocation.prototype.showElevationMarker=function(e){TC.wrap.control.ResultsPanel.prototype.showElevationMarker.call(this,{data:e,layer:this.parent.layerTrack,coords:this.parent.chart.coordinates})};TC.wrap.control.Geolocation.prototype.hideElevationMarker=function(){TC.wrap.control.ResultsPanel.prototype.hideElevationMarker.call(this)};TC.wrap.control.Geolocation.prototype.addWaypoint=function(t,o){var r=new e.Feature({geometry:new e.geom.Point([t[0],t[1],o.ele,o.time],"XYZM")});r.setProperties(o);this.parent.layerTracking.wrap.layer.getSource().addFeature(r)};TC.wrap.control.Geolocation.prototype.addPosition=function(e,t,o,r,i,n,a){var l=Math.round(e[0]),s=Math.round(e[1]),p=k.call(this);if(this.parent.layerTracking.features&&p){var c=p.geometry.length>0&&p.geometry[p.geometry.length-1];if(c&&0==c.length){this.parent.layerTracking.features[0].geometry.push([l,s,a,o]);p.wrap.feature.getGeometry().appendCoordinate([l,s,a,o])}else{var u=Math.round(c[0]),g=Math.round(c[1]);if(l!=u||s!=g){this.parent.layerTracking.features[0].geometry.push([l,s,a,o]);p.wrap.feature.getGeometry().appendCoordinate([l,s,a,o])}}TC.Util.storage.setSessionLocalValue(this.parent.Const.LocalStorageKey.TRACKINGTEMP,this.formattedToStorage(this.parent.layerTracking).features)}this.parent.$events.trigger($.Event(this.parent.Const.Event.STATEUPDATED,{moving:void 0!=t&&void 0!=r&&r>0&&t>0}))};TC.wrap.control.Geolocation.prototype.positionChangehandler=function(e){var t,o,r,i,n,a=this,l=$.Deferred();k.call(this)||a.parent.setTracking(!1);if(e&&e.coords){a.parent.layerGPS.clearFeatures();t=e.coords.accuracy/a.parent.map.getMetersPerUnit()||0;o=e.coords.heading||e[2]||0;r=e.coords.speed?3.6*e.coords.speed:0;i=e.coords.altitude||0;n=e.coords.altitudeAccuracy||0;if(a.parent.layerTracking){var s=[e.coords&&e.coords.longitude||e[0],e.coords&&e.coords.latitude||e[1]],p=TC.Util.reproject(s,"EPSG:4326",a.parent.map.crs);a.addPosition(p,o,(new Date).getTime(),r,t,n,i);var c=k.call(this).geometry,u=c.length;u>=2&&(a.parent.deltaMean=(c[u-1][3]-c[0][3])/(u-1));a.parent.$events.trigger($.Event(a.parent.Const.Event.POSITIONCHANGE,{pd:{position:p,altitude:i,accuracy:t,heading:TC.Util.radToDeg(o),speed:r}}));$.when(a.parent.layerGPS.addPoint(p,{radius:4,fillColor:"#00CED1",fillOpacity:1,strokeColor:"#ffffff",strokeWidth:2,showsPopup:!1}),a.parent.layerGPS.addCircle([p,t],{strokeColor:"#00CED1",strokeWidth:.4,fillColor:"#ffffff",fillOpacity:.2,showsPopup:!1})).done(function(e,t){a.parent.geopositionTracking=!0;if(0==a.parent.firstPosition){a.parent.firstPosition=!0;if(a.parent.$centerDiv)a.parent.$centerDiv.toggleClass(TC.Consts.classes.HIDDEN,!1);else{a.parent.$centerDiv=a.parent._$div.find("."+a.parent.CLASS+"-track-center");a.parent.$button=a.parent._$div.find("."+a.parent.CLASS+"-track-center button");a.parent.$button.on("click",function(){a.parent.layerGPS.map.zoomToFeatures(a.parent.layerGPS.features);a.parent.track.$info.find(".prsidebar-body").fadeIn("slide");a.parent.track.$info.find(".prcollapsed").hide()});a.parent.$centerDiv.appendTo(a.parent.map._$div);a.parent.$centerDiv.toggleClass(TC.Consts.classes.HIDDEN,!1)}a.parent.layerGPS.map.zoomToFeatures(a.parent.layerGPS.features)}l.resolve({marker:e,accuracy:t})})}else l.resolve(null)}else l.resolve(null);return l.promise()};TC.wrap.control.Geolocation.prototype.setTracking=function(t){var o=this;if(t){o.parent.firstPosition=!1;var r,i=[];if(o.parent.sessionTracking){var n=(new TC.wrap.parser.JSON).parser.readFeatures(o.parent.sessionTracking);n&&o.parent.storageCRS!==o.parent.map.crs&&(n=n.map(function(e){var t=e.clone();t.getGeometry().transform(o.parent.storageCRS,o.parent.map.crs);return t}));var a=n.filter(function(e){var t=e.getGeometry().getType().toLowerCase();"point"===t&&i.push(e);return"linestring"===t||"multilinestring"===t})[0].getGeometry().getCoordinates();r=new e.Feature({geometry:new e.geom.LineString(a,"XYZM"),tracking:!0})}else r=new e.Feature({geometry:new e.geom.LineString([],"XYZM"),tracking:!0});r&&TC.wrap.Feature.createFeature(r).then(function(e){o.parent.layerTracking.addFeature(e);e.geometry.length>1&&o.parent.map.setExtent(o.parent.layerTracking.wrap.layer.getSource().getExtent());i.length>0&&$.when.apply($,i.map(function(e){return TC.wrap.Feature.createFeature(e)})).then(function(e){(e=Array.prototype.slice.call(arguments,0))&&e.forEach(function(e){o.parent.layerTracking.addFeature(e)})});o.parent.currentPositionWaiting=o.parent.getLoadingIndicator().addWait();o.currentPositionTrk||(o.currentPositionTrk=[]);var t,r=0,n=0,a=!1,l={enableHighAccuracy:!0,timeout:6e5};t=setInterval(function e(i){var s=r++;navigator.geolocation.getCurrentPosition(function(e){clearInterval(t);o.parent.getLoadingIndicator().removeWait(o.parent.currentPositionWaiting);o.positionChangehandler(e).then(function(e){1==o.parent.geopositionTracking&&e&&e.marker&&e.accuracy&&o.currentPositionTrk.push(navigator.geolocation.watchPosition(o.positionChangehandler.bind(o),o.parent.onGeolocateError.bind(o.parent),l))})},i||function(r){switch(r.code){case r.TIMEOUT:if(n>10){clearInterval(t);o.parent.onGeolocateError.call(o.parent,r)}else{n++;e(function(){clearInterval(t);if(!a){a=!0;o.parent.onGeolocateError.call(o.parent,r)}})}break;default:clearInterval(t);o.parent.onGeolocateError.call(o.parent,r)}},{timeout:5e3+s,maximumAge:10,enableHighAccuracy:!0})},1e3);setTimeout(function(){if(o.parent.layerTracking&&o.parent.layerTracking.features&&o.parent.layerTracking.features.length>0&&0==o.parent.layerTracking.features[0].geometry.length){clearInterval(t);o.parent.getLoadingIndicator().removeWait(o.parent.currentPositionWaiting);o.map.toast(o.parent.getLocaleString("geo.error.permission_denied"),{type:TC.Consts.msgType.WARNING});o.parent.track.$activateButton.toggleClass(TC.Consts.classes.HIDDEN,!1);o.parent.track.$deactivateButton.toggleClass(TC.Consts.classes.HIDDEN,!0)}},l.timeout+1e3)})}else{o.parent.firstPosition=!1;if(o.currentPositionTrk){o.currentPositionTrk=o.currentPositionTrk instanceof Array?o.currentPositionTrk:[o.currentPositionTrk];o.currentPositionTrk.forEach(function(e){navigator.geolocation.clearWatch(e)});o.currentPositionTrk=[]}o.parent.$centerDiv&&o.parent.$centerDiv.toggleClass(TC.Consts.classes.HIDDEN,!0)}};TC.wrap.control.Geolocation.prototype.activateSnapping=function(){if(!TC.Util.detectMobile()){this.olMap.on([e.MapBrowserEventType.POINTERMOVE,e.MapBrowserEventType.SINGLECLICK],this._snapTrigger);this.olMap.on(e.render.EventType.POSTCOMPOSE,this._postcomposeTrigger)}};TC.wrap.control.Geolocation.prototype.deactivateSnapping=function(){var t=this;$.when(t.parent.map.wrap.getMap()).then(function(o){if(!TC.Util.detectMobile()){o.un([e.MapBrowserEventType.POINTERMOVE,e.MapBrowserEventType.SINGLECLICK],t._snapTrigger);o.un(e.render.EventType.POSTCOMPOSE,t._postcomposeTrigger)}t.snapInfo&&o.removeOverlay(t.snapInfo);t.snapInfoElement&&(t.snapInfoElement.style.display="none");if(t.snapLine){delete t.snapLine;o.render()}})};TC.wrap.control.Geolocation.prototype.clear=function(e){e&&e.clearFeatures();attachedDTD=!1;this.deactivateSnapping.call(this)};TC.wrap.control.Geolocation.prototype.duringTrackSnap=function(t){var o=t.vectorContext;if(o&&this.snapLine){"function"==typeof o.setFillStrokeStyle&&o.setFillStrokeStyle(null,new e.style.Stroke({color:"rgba(197, 39, 55, 1)",width:1}));"function"==typeof o.drawGeometry&&o.drawGeometry(this.snapLine.wrap.feature.getGeometry())}};TC.wrap.control.Geolocation.prototype.endSnap=function(){var e=this;$.when(e.parent.map.wrap.getMap()).then(function(t){e.snapInfo&&t.removeOverlay(e.snapInfo);e.snapInfoElement&&(e.snapInfoElement.style.display="none");e.snapLine&&delete e.snapLine})};TC.wrap.control.Geolocation.prototype.initSnap=function(t,o){var r=this;if(r.parent.layerTrack){var i=r.parent.layerTrack.wrap.layer.getSource().getClosestFeatureToCoordinate(t);if(null!==i){var n=i.getGeometry().getClosestPoint(t);const u=r.parent.map.getPixelFromCoordinate(n);if(Math.sqrt(Math.pow(o[0]-u[0],2)+Math.pow(o[1]-u[1],2))>r.parent.snappingTolerance)r.endSnap();else{var a=[t,[n[0],n[1]]];r.snapLine?r.snapLine.wrap.feature.getGeometry().setCoordinates(a):r.snapLine=new TC.feature.Polyline(a);r.snapInfoElement||(r.snapInfoElement=document.getElementsByClassName("tc-ctl-geolocation-track-snap-info")[0]);r.snapInfoElement.style.display="block";if(!r.snapInfo){r.snapInfo=new e.Overlay({element:r.snapInfoElement,offset:[5,18]});r.olMap.addOverlay(r.snapInfo)}void 0==r.snapInfo.getMap()&&r.snapInfo.setMap(r.olMap);r.snapInfo.setPosition(t);var l={};"LineString"!=i.getGeometry().getType()&&i.getKeys().indexOf("name")>-1&&(l.n=i.get("name"));var s=r.parent.map.options.locale&&r.parent.map.options.locale.replace("_","-")||void 0;l.x=r.map.wrap.isGeo()?n[0].toLocaleString(s,{minimumFractionDigits:5}):Math.round(n[0]).toLocaleString(s);l.y=r.map.wrap.isGeo()?n[1].toLocaleString(s,{minimumFractionDigits:5}):Math.round(n[1]).toLocaleString(s);r.map.wrap.isGeo()&&(l.isGeo=!0);var p=function(e){return n[e]?(Math.round(100*n[e])/100).toLocaleString(s):void 0},c=function(e){return n[e]>0?new Date(n[e]).toLocaleString(s):void 0};if(i.getGeometry().getLayout()===e.geom.GeometryLayout.XYZM){l.z=p(2);l.m=c(3)}else i.getGeometry().getLayout()===e.geom.GeometryLayout.XYZ?l.z=p(2):i.getGeometry().getLayout()===e.geom.GeometryLayout.XYM&&(l.m=c(2));l&&r.parent.getRenderedHtml(r.parent.CLASS+"-track-snapping-node",l,function(e){r.snapInfoElement.innerHTML=e})}}}r.olMap.render()};TC.wrap.control.Geolocation.prototype.drawTrackingData=function(e){var t=this,o=$.Deferred(),r=[],i=(new TC.wrap.parser.JSON).parser.readFeatures(e.data);i.filter(function(e){return"linestring"===e.getGeometry().getType().toLowerCase()||"multilinestring"===e.getGeometry().getType().toLowerCase()}).forEach(function(t){t.getGeometry().setCoordinates(t.getGeometry().getCoordinates(),e.layout)});t.activateSnapping.call(t);for(var n=0,a=i.length;n<a;n++)r.push(TC.wrap.Feature.createFeature(i[n]));$.when.apply($,r).then(function(){for(var e=0;e<arguments.length;e++){var r=arguments[e];r&&t.parent.layerTrack.addFeature(r)}t.parent.map.zoomToFeatures(t.parent.layerTrack.features);o.resolve()});return o.promise()};TC.wrap.control.Geolocation.prototype.formattedFromStorage=function(t){const o=this;if(o.parent.storageCRS!==o.parent.map.crs){var r=(new e.format.GeoJSON).readFeatures(t);if(r){r=r.map(function(e){var t=e.clone();t.getGeometry().transform(o.parent.storageCRS,o.parent.map.crs);return t});return(new e.format.GeoJSON).writeFeatures(r)}}return t};TC.wrap.control.Geolocation.prototype.formattedToStorage=function(t,o){var r=this,i=new TC.wrap.parser.JSON;i=i.parser;var n,a=t.wrap.layer.getSource().getFeatures();a=a.map(function(t){t.getGeometry()instanceof e.geom.LineString&&(n=t.getGeometry().getLayout());if(r.parent.map.crs!==r.parent.storageCRS){var o=t.clone();o.getGeometry().transform(r.parent.map.crs,r.parent.storageCRS);return o}return t});return{features:i.writeFeatures(a),layout:n}};TC.wrap.control.Geolocation.prototype.export=function(t,o){var r=this,i=new $.Deferred,n=[];r.parent.getTrackingData(o).then(function(a){if(a){var l=(new e.format.GeoJSON).readFeatures(a.data);if(0===l.length){var s=r.parent.getTrackingData(o);l=(new e.format.GeoJSON).readFeatures(s)}n=l.map(function(t){var o=t.clone();o.getGeometry().transform(r.parent.map.crs,"EPSG:4326");return o.getGeometry()instanceof e.geom.LineString?new e.Feature({geometry:new e.geom.MultiLineString([o.getGeometry().getCoordinates()],"XYZM")}):o})}switch(t){case"GPX":i.resolve(n?(new e.format.GPX).writeFeatures(n):null);break;case"KML":i.resolve(n?(new e.format.KML).writeFeatures(n):null)}});return i};var G,U,B=function(e){var t=[],o=[];if(e.length>1){4==e[0].length&&(e=e.sort(function(e,t){return e[0][3]==t[0][3]?0:e[0][3]<t[0][3]?-1:1}));for(var r=0;r<e.length;r++){for(var i=e[r],n=-1,a=1/0,l=i.getLastCoordinate(),s=r+1;s<e.length;s++){var p=e[s].getFirstCoordinate(),c=Math.hypot(l[0]-p[0],l[1]-p[1]);if(c<a){n=s;a=c}}if(t.length<e.length){if(-1==t.indexOf(r)){t.push(r);o=o.concat(i.getCoordinates())}if(-1==t.indexOf(n)){t.push(n);o=o.concat(e[n].getCoordinates())}}}return o}return e[0].getCoordinates()};TC.wrap.control.Geolocation.prototype.processImportedFeatures=function(t){for(var o=this,r=o.parent.layerTrack.wrap.layer.getSource(),i=o.parent.importedFileName,n=[],a=[],l=[],s=[],p=r.getFeatures(),c=[],u=[],g=function(e){e.getProperties().hasOwnProperty("name")&&e.getProperties().name.trim().length>0?n.push(e.getProperties().name):n.push(i)},d=0;d<p.length;d++){var h=p[d];h instanceof TC.Feature&&(h=p[d].wrap.feature);if(h.getGeometry()instanceof e.geom.Point){u.push(h.getGeometry().getCoordinates());s.push(h)}else if(h.getGeometry()instanceof e.geom.LineString){g(h);a.push(new e.Feature({geometry:new e.geom.LineString(h.getGeometry().getCoordinates(),h.getGeometry().getLayout())}));l.push(h)}else if(h.getGeometry()instanceof e.geom.MultiLineString){var f=h.clone();g(f);var y=f.getGeometry().getLineStrings(),m=B(y);a.push(new e.Feature({geometry:new e.geom.LineString(m,h.getGeometry().getLayout())}));l.push(h)}}if(c.length>0){m=B(c);a.push(new e.Feature({geometry:new e.geom.LineString(m)}))}u.length>0&&s.length==p.length&&a.push(new e.Feature({geometry:new e.geom.LineString(u)}));if(l.length>0)for(var v=0;v<l.length;v++)r.removeFeature(l[v]);if(a.length>0){new $.Deferred;var C,T=0;(function(){var e=[];$.each(a,function(t){var l=new $.Deferred;C&&r.removeFeature(C);if(n.length>t){var s=n[t];(function(e,t){for(var o=[],r=e.indexOf(t);-1!=r;){o.push(r);r=e.indexOf(t,r+1);if(o.length>1)return!0}return o.length>1})(n,s)&&(s="["+(t+1)+"] "+s)}o.parent.importedFileName=s||i;C=a[t];r.addFeature(C);o.parent.saveTrack(o.parent.getLocaleString("geo.trk.upload.ok",{trackName:o.parent.importedFileName})).then(function(e){0==t&&(T=e);l.resolve()});e.push(l)});return $.when.apply(void 0,e).promise()})().then(function(){o.parent.layerTrack.setVisibility(!1);o.parent.layerTrack.clearFeatures();o.parent.$events.trigger(o.parent.Const.Event.IMPORTEDTRACK,T);delete o.parent.importedFileName;o.parent.getLoadingIndicator().removeWait(t)})}else{if(o.parent.layerTrack){o.parent.map.removeLayer(o.parent.layerTrack);o.parent.layerTrack=void 0}delete o.parent.importedFileName;o.parent.getLoadingIndicator().removeWait(t);TC.alert(o.parent.getLocaleString("geo.trk.upload.error4"))}};TC.wrap.control.Geolocation.prototype.import=function(t,o,r){var i,n,a=this;if(o&&o.text){var l=a.parent.layerTrack.wrap.createVectorSource({data:o.text,type:r});i=l.source;n=i.on("change",function(o){if("ready"==i.getState()){e.Observable.unByKey(n);a.processImportedFeatures(t)}});a.parent.layerTrack.wrap.layer.setSource(i)}else{if(a.parent.layerTrack){a.parent.map.removeLayer(a.parent.layerTrack);a.parent.layerTrack=void 0}delete a.parent.importedFileName;a.parent.getLoadingIndicator().removeWait(t);TC.alert(a.parent.getLocaleString("geo.trk.upload.error4"))}};TC.wrap.control.Geolocation.prototype.simulateTrackEnd=function(){this.parent.chartProgressClear();if(this.simulateMarker){window.cancelAnimationFrame(G);this.simulateMarker.layer.wrap.layer.getSource().getFeatures().length>0&&this.simulateMarker.layer.removeFeature(this.simulateMarker);delete this.simulateMarker}};TC.wrap.control.Geolocation.prototype.simulateTrack=function(){for(var t,o=this,r=o.parent.layerTrack.wrap.layer.getSource().getFeatures(),i=0;i<r.length;i++)if(r[i].getGeometry()instanceof e.geom.LineString){t=r[i].getGeometry().getCoordinates();break}if(t&&t.length>0){var n=t[0];(function(){var e=new $.Deferred;if(o.simulateMarker){o.simulateMarker.setCoords(n.slice(0,2));e.resolve(o.simulateMarker)}else o.parent.layerTrack.addPoint(n.slice(0,2),{radius:7,fillColor:"#ff0000",fillOpacity:.5,strokeColor:"#ffffff",strokeWidth:2}).then(function(t){e.resolve(t)});return e})().then(function(r){o.simulateMarker=r;var i=function(){t.length;var r,i=!1;const n=function(e){return o.parent.map.crs!==o.parent.map.options.utmCrs?TC.Util.reproject(e,o.parent.map.crs,o.parent.map.options.utmCrs):e};o.parent.hasElevation&&o.parent.chartProgressInit();var a=t;if(4==a[0].length&&a[0][3]>0){r=a[0][3];a[a.length-1][3];i=!0}else{a[0][3]=Date.now();for(var l=1;l<a.length;l++){a[l][3]=0;u=l+1<a.length?new e.geom.LineString(n(a.slice(l-1,l+1))).getLength():new e.geom.LineString(n(a.slice(l-1))).getLength();a[l][3]=a[l-1][3]+36e5*u/o.parent.walkingSpeed}r=a[0][3];a[a.length-1][3]}var s=new e.geom.LineString(a),p=r,c=0;c=o.parent.map.crs!==o.parent.map.options.utmCrs?new e.geom.LineString(n(JSON.parse(JSON.stringify(a)))).getLength():s.getLength();var u=0,g=function(){if(!o.parent.simulate_paused){var t=s.getCoordinateAtM(p),r=function(t){for(var o=0;o<a.length;o++)if(a[o][3]>t)return{d:new e.geom.LineString(n(a.slice(0,o))).getLength(),p:a[o-1].slice(0,2)}}(p);if(!t||!r){o.simulateTrackEnd();var l=o.parent.getSelectedTrack();l&&o.parent.uiSimulate(!1,l);o.parent.chartProgressClear();return}o.parent.hasElevation&&o.parent.chartSetProgress(r,t,c,!!i&&o.parent._getTime(a[0][3],t[3]));if(o.simulateMarker){var u=o.simulateMarker.getCoords(),d=t;Math.atan2(d[1]-u[1],d[0]-u[0]),Math.PI;o.simulateMarker.setCoords(t)}1!==o.parent.simulate_speed?p+=o.parent.delta*o.parent.simulate_speed:p+=o.parent.delta}G=requestAnimationFrame(g)};G=requestAnimationFrame(g)},n=new $.Deferred;window.d3?n.resolve():TC.loadJS(!window.d3,[TC.Consts.url.D3C3],function(){n.resolve()});n.then(function(){G=requestAnimationFrame(i)})})}};TC.wrap.control.Geolocation.prototype.headingChangehandler=function(e){var t=this;t.parent.track.$infoOnMap||(t.parent.track.$infoOnMap=$('<div style="overflow-y: scroll; height: 200px; width: 200px; top: 0; left: 100px; background-color: fuchsia; position: absolute;"></div>').appendTo(t.parent.map._$div));t.parent.track.$infoOnMap.show();t.parent.track.$infoOnMap.html(t.parent.track.$infoOnMap.html()+"<br> <p> salta headingChangehandler </p>");t.parent.track.$infoOnMap.html(t.parent.track.$infoOnMap.html()+"<br> <p> evt.target.getHeading(): "+e.target.getHeading()+" </p>");t.heading=e.target.getHeading();$.when(t.map.wrap.getMap()).then(function(e){e.getView().setRotation(-t.heading)});t.parent.$events.trigger($.Event(t.parent.Const.Event.STATEUPDATED,{moving:void 0!=heading&&heading>0}))};TC.wrap.control.Geolocation.prototype.orientationChangehandler=function(e){var t=this.map.wrap.map.getView(),o=t.getCenter(),r=t.getResolution(),i=e.target.getBeta()||0,n=e.target.getGamma()||0;o[0]-=r*n*25;o[1]+=r*i*25;t.setCenter(t.constrainCenter(o));this.parent.$events.trigger($.Event(this.parent.Const.Event.STATEUPDATED,{moving:void 0!=heading&&heading>0}))};TC.wrap.control.Geolocation.prototype.pulsate=function(t){this.pulsated=!0;var o,r=t.wrap.feature.getGeometry().getRadius(),i=(new Date).getTime();o=this.olMap.on(e.render.EventType.POSTCOMPOSE,function(n){var a=n.vectorContext,l=n.frameState,s=l.time-i,p=t.wrap.feature.getGeometry().clone(),c=function(e){switch(!0){case e<=50:return r;case e>50&&e<=100:return 1.02*r;case e>100&&e<=150:return 1.05*r;case e>150&&e<=200:return 1.02*r;case e>200&&e<=300:return r;case e>300&&e<=350:return 1.02*r;case e>350&&e<=400:return 1.05*r;case e>400&&e<=450:return 1.02*r;case e>450&&e<=500:return 1*r;default:return r}}(s);p.setRadius(c);a.setFillStrokeStyle(new e.style.Fill({color:"rgba(0, 0, 0, 0.1)"}),new e.style.Stroke({color:"rgba(255, 0, 0, .8)",width:1}));a.drawCircleGeometry(p);s>500?e.Observable.unByKey(o):l.animate=!0})};TC.wrap.control.ResultsPanel.prototype.register=function(e){const t=this;t.map=e;$.when(e.wrap.getMap()).then(function(e){t.olMap=e})};TC.wrap.control.ResultsPanel.prototype.showElevationMarker=function(t){const o=this,r=(t=t||{}).data,i=t.layer,n=t.coords;o.elevationMarker||(o.elevationMarker=new e.Overlay({element:$("<div>").addClass("tc-ctl-geolocation-trackMarker elevation").css("display","none")[0],offset:[0,-11],positioning:e.OverlayPositioning.CENTER_CENTER,stopEvent:!1}));if(i.getVisibility()&&i.getOpacity()>0){$(o.elevationMarker.getElement()).show();o.olMap.addOverlay(o.elevationMarker);o.elevationMarker.setPosition(n[r[0].index])}};TC.wrap.control.ResultsPanel.prototype.hideElevationMarker=function(){this.elevationMarker&&$(this.elevationMarker.getElement()).hide()};TC.wrap.control.Coordinates.prototype.coordsActivate=function(){this.olMap.on(e.MapBrowserEventType.SINGLECLICK,this._coordsTrigger)};TC.wrap.control.Coordinates.prototype.coordsDeactivate=function(){this.olMap.un(e.MapBrowserEventType.SINGLECLICK,this._coordsTrigger)};TC.wrap.Parser=function(){};TC.wrap.Parser.prototype.read=function(e){var t=[];if(this.parser){TC.Feature||TC.syncLoadJS(TC.apiLocation+"TC/Feature");t=$.map(this.parser.readFeatures(e),function(e){return new TC.Feature(null,{id:e.getId(),data:e.getProperties()})})}return t};TC.wrap.parser={WFS:function(t){this.parser=new e.format.WFS(t)},JSON:function(t){this.parser=new e.format.GeoJSON(t)}};TC.inherit(TC.wrap.parser.WFS,TC.wrap.Parser);TC.inherit(TC.wrap.parser.JSON,TC.wrap.Parser);TC.wrap.control.OverviewMap.prototype.register=function(t){var o=this;$.when(o.parent.layer.wrap.getLayer()).then(function(r){o.ovMap=new e.control.OverviewMap({target:o.parent.div,collapsed:!1,collapsible:!1,className:o.parent.CLASS+" ol-overviewmap",layers:[r]});o.ovMap._wrap=o;o.ovMap.ovmap_.removeOverlay(o.ovMap.boxOverlay_);var i=document.createElement("DIV");i.className="ol-overviewmap-box";i.style.boxSizing="border-box";o.ovMap.boxOverlay_=new e.Overlay({position:[0,0],positioning:e.OverlayPositioning.BOTTOM_LEFT,element:i});o.ovMap.ovmap_.addOverlay(o.ovMap.boxOverlay_);o._$boxElm=$(o.ovMap.boxOverlay_.getElement()).parents(".ol-overlay-container").first();TC.loadJS(!$.fn.drag,[TC.apiLocation+"lib/jquery/jquery.event.drag.js",TC.apiLocation+"lib/jquery/jquery.event.drop.js"],function(){var e,r,i=o.ovMap.ovmap_;o._$boxElm.drag("start",function(o,n){var a=$(this);n.$dragged=a.clone().addClass(TC.Consts.classes.ACTIVE);a.after(n.$dragged);e=parseInt(a.css("bottom"));r=parseInt(a.css("left"));var l=i.getPixelFromCoordinate([t.maxExtent[0],t.maxExtent[1]]),s=i.getPixelFromCoordinate([t.maxExtent[2],t.maxExtent[3]]),p=i.getSize();n.limit={bottom:p[1]-l[1],left:l[0],top:p[1]-s[1]-a.height(),right:s[0]-a.width()}}).drag("end",function(e,r){r.$dragged.remove();var n=o.ovMap.getMap().getView(),a=i.getPixelFromCoordinate(n.getCenter()),l=i.getCoordinateFromPixel([a[0]+r.deltaX,a[1]+r.deltaY]),s=t.getExtent(),p=(s[2]-s[0])/2,c=(s[3]-s[1])/2;l[0]+p>t.maxExtent[2]?l[0]=t.maxExtent[2]-p:l[0]-p<t.maxExtent[0]&&(l[0]=t.maxExtent[0]+p);l[1]+c>t.maxExtent[3]?l[1]=t.maxExtent[3]-c:l[1]-c<t.maxExtent[1]&&(l[1]=t.maxExtent[1]+c);t.setCenter(l,{animate:!0})}).drag(function(t,o){parseInt(o.$dragged.css("bottom")),parseInt(o.$dragged.css("left"));if(o.limit.top){o.$dragged.css("bottom",Math.min(Math.max(e-o.deltaY,o.limit.bottom),o.limit.top)+"px");o.$dragged.css("left",Math.min(Math.max(r+o.deltaX,o.limit.left),o.limit.right)+"px")}else{o.$dragged.css("bottom",e-o.deltaY+"px");o.$dragged.css("left",r+o.deltaX+"px")}})});$.when(t.wrap.getMap()).then(function(e){o.reset();var t=$(o.parent.div).find("."+o.parent.CLASS+"-load");r._wrap.$events.on(TC.Consts.event.BEFORETILELOAD,function(){t.removeClass(TC.Consts.classes.HIDDEN).addClass(TC.Consts.classes.VISIBLE)});r._wrap.$events.on(TC.Consts.event.TILELOAD,function(){t.removeClass(TC.Consts.classes.VISIBLE).addClass(TC.Consts.classes.HIDDEN)});e.addControl(o.ovMap);o.parent.isLoaded=!0;o.parent.$events.trigger($.Event(TC.Consts.event.MAPLOAD))})})};TC.wrap.control.OverviewMap.prototype.reset=function(t){var o=this;const r=new $.Deferred,i=function(t,i){if(t.type===TC.Consts.layerType.WMTS){var n={crs:i||o.parent.map.crs,oldCrs:t.wrap.layer.getSource().getProjection().getCode()};n.oldCrs!==n.crs&&t.setProjection(n)}$.when(t.wrap.getLayer()).then(function(i){var n=new e.View(C(o.parent.map.wrap,i._wrap.parent));if(n.getResolutions()){n.setResolution(n.getResolutions().filter(function(e){return e>n.getResolutionForExtent(o.parent.map.getExtent(),a.getSize())}).reverse()[0]);a.setView(n)}else n.getProjection().getCode()!==a.getView().getProjection().getCode()&&a.setView(n);i._wrap.$events.one(TC.Consts.event.TILELOAD,function(){a.getLayers().getArray()[0].getSource().refresh()});if(t!==o.parent.layer){a.getLayers().forEach(function(t){(t instanceof e.layer.Image||t instanceof e.layer.Tile)&&a.removeLayer(t)});var l=$(o.parent.div).find("."+o.parent.CLASS+"-load");i._wrap.$events.on(TC.Consts.event.BEFORETILELOAD,function(){l.removeClass(TC.Consts.classes.HIDDEN).addClass(TC.Consts.classes.VISIBLE)});i._wrap.$events.on(TC.Consts.event.TILELOAD,function(){l.removeClass(TC.Consts.classes.VISIBLE).addClass(TC.Consts.classes.HIDDEN)});a.getLayers().insertAt(0,i)}r.resolve(t)})};var n=(t=t||{}).layer||o.parent.layer;if(o.parent.map&&n&&o.ovMap){var a=o.ovMap.ovmap_;n.getCapabilitiesPromise().then(function(){var e=n;n.isCompatible(o.parent.map.crs)||0!==n.wrap.getCompatibleMatrixSets(o.parent.map.crs).length?i(n):(n=n.getFallbackLayer()||o.parent.defaultLayer).getCapabilitiesPromise().then(function(){o.parent.map.on3DView&&!n.isCompatible(o.parent.map.crs)?o.parent.map.loadProjections({crsList:e.getCompatibleCRS(),orderBy:"name"}).then(function(t){i(e,t[0].code)}):n.isCompatible(o.parent.map.crs)&&i(n)})})}return r};TC.wrap.control.OverviewMap.prototype.get3DCameraLayer=function(){var t=null;this.ovMap&&(o=this.ovMap.getOverviewMap()).getLayers().forEach(function(e){"3DCamera"===e.get("id")&&(t=e)});if(!t){var o=this.ovMap.getOverviewMap(),r=M({});r[0].getFill().setColor([0,0,0,0]);t=new e.layer.Vector({id:"3DCamera",source:new e.source.Vector,style:r});o.addLayer(t)}return t};TC.wrap.control.OverviewMap.prototype.draw3DCamera=function(t){this.is3D=!!t;var o=this.get3DCameraLayer();if(o){var r,i=(t=t||{}).fov,n=o.getSource();if(i&&i.length){var a=n.getFeatures();if(a.length)r=a[0];else{r=new e.Feature;n.addFeature(r)}r.setGeometry(new e.geom.Polygon([i]))}else n.clear();var l="number"==typeof t.heading?t.heading:0;this._$boxElm.css("transform","rotate("+l+"rad)")}};TC.wrap.control.OverviewMap.prototype.enable=function(){if(this.parent.layer&&this.parent.layer.setVisibility){this.parent.layer.setVisibility(!0);this.parent.wrap.ovMap.ovmap_.updateSize();$(this.parent.map.div).trigger("resize")}};TC.wrap.control.OverviewMap.prototype.disable=function(){this.parent.layer&&this.parent.layer.setVisibility&&this.parent.layer.setVisibility(!1)};TC.wrap.control.FeatureInfo.prototype.register=function(e){var t=this;$.when(e.wrap.getMap()).then(function(o){TC.wrap.control.Click.prototype.register.call(t,e);var r=t._trigger;t._trigger=function(o){var i=r.call(t,o);i?t.parent.beforeRequest({xy:o.pixel}):e.$events.trigger($.Event(TC.Consts.event.NOFEATUREINFO,{control:t.parent}));return i}})};var q=function(e){var t=e.innerHTML||e.textContent;(U=U||document.createElement("textarea")).innerHTML=t;return U.value},j={readFeatures:function(t){var o=[],r=(new DOMParser).parseFromString(t,"text/xml");if("FeatureInfoResponse"===r.documentElement.tagName)for(var i=r.documentElement.getElementsByTagName("FeatureInfoCollection"),n=0,a=i.length;n<a;n++)for(var l=i[n],s=l.getAttribute("layername"),p=l.getElementsByTagName("FeatureInfo"),c=0,u=p.length;c<u;c++){for(var g=p[c].getElementsByTagName("Field"),d={},h=0,f=g.length;h<f;h++){var y=g[h];d[q(y.getElementsByTagName("FieldName")[0])]=q(y.getElementsByTagName("FieldValue")[0])}var m=new e.Feature(d);m.setId(s+"."+TC.getUID());o[o.length]=m}return o}},W=function(e,t,o){var r=t.getPath(o);e.layers.push({name:o,title:r[r.length-1],path:r.slice(1),features:[]})};TC.wrap.control.FeatureInfo.prototype.getFeatureInfo=function(t,o,r){var i=this,n=r||{},a=i.parent.map;$.when(a.wrap.getMap()).then(function(r){var l={},s={},p=[],c=[],u=[];T=(T=r.getLayers().getArray()).filter(function(t){return t instanceof e.layer.Image&&t.getVisible()});for(var g=0;g<T.length;g++){var d=T[g],h=d._wrap.parent;if((S=d.getSource()).getGetFeatureInfoUrl&&$.inArray(h,a.workLayers)>=0&&h.names.length>0&&(!n.serviceUrl||n.serviceUrl===h.url)){var f={};if(l[h.url]&&l[h.url].title===h.title)f=l[h.url];else{f={layers:[],mapLayer:h,title:h.title,request:null};l[h.url]=f;s[h.url]={source:jQuery.extend(!0,{},S),layers:[]}}var y=h.getDisgregatedLayerNames();if(n.layerName){if(y.indexOf(n.layerName)>=0&&d._wrap.getInfo(n.layerName).queryable){W(f,h,n.layerName);s[h.url].layers.push(n.layerName)}}else{for(var m=0;m<y.length;m++){var v=y[m];if(d._wrap.getInfo(v).queryable)W(f,h,v);else{TC.Util.consoleRegister('Capa "'+y[m]+'" no queryable, la eliminamos de la petici\xf3n GFI');y.splice(m,1);m-=1}}y.length>0&&(s[h.url].layers=s[h.url].layers.concat(y))}}}for(var C in l){u.push(l[C]);f=l[C];var T,S=s[C].source;if((T=s[C].layers)&&(!T||0!==T.length)){var _=S.getParams();S.params_.LAYERS=T.join(",");var E=S.getGetFeatureInfoUrl(t,o,a.crs,{QUERY_LAYERS:T.join(","),INFO_FORMAT:_.INFO_FORMAT,FEATURE_COUNT:1e3,radius:a.options.pixelTolerance,buffer:a.options.pixelTolerance}),x=E=E.replace(/sld_body=[a-zA-Z%0-9._]*/);E=f.mapLayer.getFeatureInfoUrl(E);var P=$.ajax({url:E});P.originalUrl=E;P.serviceUrl=C;P.requestedFormat=_.INFO_FORMAT;P.expandUrl=x;TC.Util.consoleRegister("Lanzamos GFI");p.push(P)}}if(p.length>0)$.when.apply(i,p).then(function(){for(var r=p.length>1?arguments:[arguments],s=!1,u=0,g=[],d=0;d<r.length;d++){var h=r[d],f=l[p[d].serviceUrl],y=h[2];if("success"===h[1]){s=!0;f.text=y.responseText;var m,v=y.getResponseHeader("Content-type");v&&v.indexOf(";")>-1&&(v=v.substr(0,v.indexOf(";")).trim());v||(v=y.requestedFormat);if(v===y.requestedFormat){switch(v){case"application/json":m=new e.format.GeoJSON;break;case"application/vnd.ogc.gml":m=y.responseText.indexOf("FeatureCollection")>-1?new e.format.WFS({gmlFormat:new e.format.GML2({srsName:a.crs})}):new e.format.WMSGetFeatureInfo;break;case"application/vnd.ogc.gml/3.1.1":m=new e.format.GML3Patched({srsName:a.crs});break;case"application/vnd.esri.wms_featureinfo_xml":m=j;break;default:m=null}if(m){var C=m.readFeatures(y.responseText,{featureProjection:e.proj.get(a.crs)});u+=C.length;for(var T=function(e,t,o){var r=!1;if(t===o)r=!0;else{var i=e.getNodePath(t),n=e.getNodePath(o);if(i.length>0&&n.length>=i.length){r=!0;for(var a=0;a<i.length;a++)if(e.wrap.getName(i[a])!==e.wrap.getName(n[a])){r=!1;break}}}return r},S={},_=0;_<C.length;_++){var E=C[_];if(E instanceof e.Feature){for(var x=E.getId()||TC.getUID(),P=!1,L=x.substr(0,x.lastIndexOf(".")),w=0;w<f.layers.length;w++){var b=f.layers[w],R=b.name.substr(b.name.indexOf(":")+1);if(T(f.mapLayer,R,L)){P=!0;if(!n.featureId||E.getId()===n.featureId){c.push(TC.wrap.Feature.createFeature(E));g.push(b.features)}break}}if(!P){var A;if(S[L])A=S[L];else{A={name:L,title:L,path:[L],features:[]};S[L]=A;f.layers.push(A)}if(!n.featureId||E.getId()===n.featureId){c.push(TC.wrap.Feature.createFeature(E));g.push(A.features)}}}}}else{var M={name:"layer"+TC.getUID(),title:"Datos en el punto",features:[]};f.layers[f.layers.length]=M;M.features[0]={rawUrl:y.originalUrl,expandUrl:y.expandUrl,rawContent:y.responseText,rawFormat:v};u+=1}}else{TC.Util.consoleRegister("Respuesta GFI: lo m\xe1s probable es que el servidor est\xe9 devolviendo una excepci\xf3n");TC.Util.consoleRegister("Lanzamos los eventos que corresponde y mostramos tostada");i.parent.responseError({message:y.responseText,status:y.status});a.toast(i.parent.getLocaleString("featureInfo.error"),{type:TC.Consts.msgType.ERROR})}}else i.parent.responseError({message:y.responseText,status:y.status})}if(s){var I=c;if(c.length){var O=$.Deferred();I=I.concat(O);TC.loadJS(!TC.Geometry,TC.apiLocation+"TC/Geometry",function(){O.resolve()})}$.when.apply(this,I).then(function(){var e;if(arguments.length)for(var r=0;r<arguments.length;r++){var n=arguments[r];if(n){n.attributes=[];for(var a in n.data){var s=n.data[a];"object"!=typeof s&&n.attributes.push({name:a,value:"number"==typeof s?s.toLocaleString(TC.Util.getMapLocale(i.parent.map)):s})}!e&&TC.Geometry.isInside(t,n.geometry)&&(e=n);g[r].push(n)}}var p=[];for(var c in l)l.hasOwnProperty(c)&&p.push(l[c]);i.parent.responseCallback({coords:t,resolution:o,services:p,featureCount:u,defaultFeature:e})})}},function(e,t,o){i.parent.responseCallback({});a.toast(i.parent.getLocaleString("featureInfo.error"),{type:TC.Consts.msgType.ERROR})});else{a.workLayers.filter(function(e){return e instanceof TC.layer.Raster}).length>0&&a.toast(i.parent.getLocaleString("featureInfo.notQueryableLayers"),{type:TC.Consts.msgType.INFO});if(u&&0==u.length)for(var C in l)u.push(l[C]);a.$events.on(TC.Consts.event.BEFOREFEATUREINFO,function(){i.parent.responseCallback({coords:t,resolution:o,services:u,featureCount:0})});i.parent.responseCallback({coords:t,resolution:o,services:u,featureCount:0})}})};TC.wrap.control.GeometryFeatureInfo.prototype.register=function(t){var o=this;$.when(t.wrap.getMap()).then(function(r){TC.wrap.control.Click.prototype.register.call(o,t);var i=o._trigger;o._trigger=function(t){o.hasEligibleLayers().then(function(r){r&&(o.parent._isSearching||t.type!=e.MapBrowserEventType.SINGLECLICK||o.parent._isDrawing||o.parent._isSearching||i.call(o,t))})}})};TC.wrap.control.GeometryFeatureInfo.prototype.hasEligibleLayers=function(){var e=$.Deferred(),t=this.parent.map,o=!1;$.when(t.wrap.getMap()).then(function(r){r.getLayers().forEach(function(e){var r=e._wrap.parent;if(e.getSource().getGetFeatureInfoUrl&&$.inArray(r,t.workLayers)>=0){o=!0;return!1}});e.resolve(o)});return e};TC.wrap.control.GeometryFeatureInfo.prototype.beginDraw=function(t){var o=this,r=(t=t||{}).xy,i=t.layer,n=t.callback,a=t.geometryType,l=!1;if(o.drawCtrl){o.drawCtrl.setActive(!0);o.drawCtrl.startDrawing_({coordinate:r})}else $.when(i.wrap.getLayer()).then(function(t){var i;switch(a){case TC.Consts.geom.POLYLINE:i=e.geom.GeometryType.LINE_STRING;break;default:i=e.geom.GeometryType.POLYGON}o.drawCtrl=new e.interaction.Draw({source:t.getSource(),type:i,style:t.getStyle()});var s=function(e){e.parent.showsPopup=!1};t.getSource().on(e.source.VectorEventType.ADDFEATURE,function(e){e.feature._wrap?s(e.feature._wrap):e.feature._wrapDeferred.then(s)});o.drawCtrl.handleEvent=function(t){if(t.type==e.MapBrowserEventType.SINGLECLICK){var o=i===e.geom.GeometryType.POLYGON?this.sketchCoords_[0]:this.sketchCoords_;l&&2==o.length&&null!==this.sketchFeature_?this.addToDrawing_(t):l=!0}return e.interaction.Draw.handleEvent.call(this,t)};o.parent.map.wrap.getMap().addInteraction(o.drawCtrl);o.drawCtrl.on(e.interaction.DrawEventType.DRAWSTART,function(t){o.parent._isDrawing=!0;var r=o.parent.map;$.when(r.wrap.getMap()).then(function(t){t.getInteractions().forEach(function(t,o){t instanceof e.interaction.DoubleClickZoom&&t.setActive(!1)})})});o.drawCtrl.startDrawing_({coordinate:r});o.drawCtrl.on(e.interaction.DrawEventType.DRAWEND,function(r){o.parent._isDrawing=!1;var i=o.parent.map;$.when(i.wrap.getMap()).then(function(t){t.getInteractions().forEach(function(t,o){t instanceof e.interaction.DoubleClickZoom&&t.setActive(!1)})});n&&TC.wrap.Feature.createFeature(r.feature).then(function(e){n(e)});this.setActive(!1);o.parent.map.wrap.getMap().removeInteraction(o.drawCtrl);o.drawCtrl=null;t.getSource().clear();o.parent._drawToken=!0;setTimeout(function(){o.parent._drawToken=!1},500)})})};TC.wrap.control.GeometryFeatureInfo.prototype.cancelDraw=function(e,t,o){if(this.drawCtrl&&this.parent._isDrawing){this.parent._isDrawing=!1;this.drawCtrl.setActive(!1);this.drawCtrl.source_.clear()}};var V=function(e,t,o,r){var i=[],n={},a=function(e){return e.mapLayer.title||e.mapLayer.tree&&e.mapLayer.tree.title||e.mapLayer.capabilities.Service.Title};$.when(e.wrap.getMap()).then(function(l){l.getLayers().forEach(function(l){var s=l._wrap.parent;if(l.getVisible()&&!($.inArray(s,e.workLayers)<0)&&s.type===TC.Consts.layerType.WMS){var p=s.getDisgregatedLayerNames()||s.availableNames;n[s.url.toLowerCase()]||(n[s.url.toLowerCase()]={layers:[],mapLayer:s,layerNames:[]});for(var c=0;c<p.length;c++){var u=p[c];if((s.isVisibleByScale(u)||r)&&s.wrap.getInfo(u).queryable){n[s.url.toLowerCase()].layerNames.push(u);var g=s.getPath(u);n[s.url.toLowerCase()].layers.push({name:u,title:g[g.length-1],path:g.slice(1),features:[]})}}if(0!=n[s.url.toLowerCase()].layerNames.length&&void 0===n[s.url.toLowerCase()].request){n[s.url.toLowerCase()].request=s.getWFSCapabilitiesPromise();n[s.url.toLowerCase()].defer=$.Deferred();i.push(n[s.url.toLowerCase()].defer);$.when(n[s.url.toLowerCase()].request).then(function(e){var i=null,l=[];for(var s in n)n[s].request&&n[s].request.promise()==this&&(i=n[s]);var p=null,c=i.layerNames,u=i.defer;if(c instanceof Array&&c.length)if(void 0!==e.Operations.GetFeature){for(var g=[],d=0;d<c.length;d++){for(var h=c[d].substring(c[d].indexOf(":")+1);"_"===h[h.length-1];)h=h.substring(0,h.lastIndexOf("_"));if(e.FeatureTypes.hasOwnProperty(h))g.indexOf(h)<0&&g.push(h);else{var f=i.mapLayer.getPath(h);l.push({key:TC.Consts.WFSErrors.LayersNotAvailable,params:{serviceTitle:a(i),layerName:f[f.length-1]}})}}if(0!=g.length){e.Operations.GetFeature.CountDefault&&(p=e.Operations.GetFeature.CountDefault.DefaultValue);if("1.0.0"===e.version&&!e.Operations.GetFeature.Operations.hasOwnProperty("Query")||("2.0.0"===e.version||"1.1.0"===e.version)&&e.Operations.QueryExpressions.AllowedValues.Value.indexOf("wfs:Query")<0){l.push({key:TC.Consts.WFSErrors.QueryNotAvailable,params:{serviceTitle:a(i)}});u.resolve({errors:l})}else{s=e.Operations.GetFeature.DCPType?e.Operations.GetFeature.DCPType[1].HTTP.Post.onlineResource:e.Operations.GetFeature.DCP.HTTP.Post["xlink:href"];var y=i.mapLayer.getFeatureUrl(s);p?jQuery.ajax({url:y,data:TC.Util.WFSQueryBuilder(g,t,e,o,!0),cache:!1,contentType:"application/xml",type:"POST"}).then(function(){if(arguments[0]instanceof XMLDocument){var n=xml2json(arguments[0]);if(n.Exception){u.resolve({errors:[{key:TC.Consts.WFSErrors.Indeterminate,params:{err:n.Exception.exceptionCode,errorThrown:n.Exception.ExceptionText,serviceTitle:i.mapLayer.title}}]});return}}var c=parseInt(n.numberMatched||n.numberOfFeatures,10);isNaN(c)||c>parseInt(p,10)?u.resolve({errors:[{key:TC.Consts.WFSErrors.NumMaxFeatures,params:{limit:p,serviceTitle:a(i)}}]}):0===c?u.resolve({errors:[{key:TC.Consts.WFSErrors.NoFeatures,params:{serviceTitle:a(i)}}]}):r&&u.resolve({url:s,data:TC.Util.WFSQueryBuilder(g,t,e,o,!1),service:i,numFeatures:c,errors:l})},function(e,t,o){u.resolve({errors:[{key:TC.Consts.WFSErrors.Indeterminate,params:{err:t,errorThrown:o,serviceTitle:a(i)}}]})}):r||u.resolve({url:y,data:TC.Util.WFSQueryBuilder(g,t,e,o,!1),service:i,errors:l});r&&!p&&u.resolve({url:s,data:TC.Util.WFSQueryBuilder(g,t,e,o,!1),service:i,errors:l});r||jQuery.ajax({url:y,data:TC.Util.WFSQueryBuilder(g,t,e,o,!1),cache:!1,contentType:"application/xml",type:"POST"}).then(function(){if("success"==arguments[1]){if(arguments[0]instanceof XMLDocument){var e=xml2json(arguments[0]);if(e.Exception){u.resolve({errors:[{key:TC.Consts.WFSErrors.Indeterminate,params:{err:e.Exception.exceptionCode,errorThrown:e.Exception.ExceptionText,serviceTitle:i.mapLayer.title}}]});return}}u.resolve({service:i,response:arguments,errors:l})}else u.reject(arguments)},function(e,t,o){u.resolve({errors:[{key:TC.Consts.WFSErrors.Indeterminate,params:{err:t,errorThrown:o,serviceTitle:a(i)}}]})})}}else{l.push({key:TC.Consts.WFSErrors.NoValidLayers,params:{serviceTitle:a(i)}});u.resolve({errors:l})}}else{l.push({key:TC.Consts.WFSErrors.GetFeatureNotAvailable,params:{serviceTitle:a(i)}});u.resolve({errors:l})}},function(e,t,o){var r=null;for(var i in n)n[i].request&&n[i].request.promise()==this&&(r=n[i]);r.defer.resolve({errors:[{key:TC.Consts.WFSErrors.GetCapabilities,params:{err:o,serviceTitle:a(r)}}]})})}}})});return i};TC.WFSGetFeatureBuilder=V;var Y=function(t,o,r){var i,n=r.getResponseHeader("Content-type");n&&n.indexOf(";")>-1&&(n=n.substr(0,n.indexOf(";")).trim());n||(n=o.requestedFormat);switch(n){case"application/json":i=new e.format.GeoJSON;break;case"application/vnd.ogc.gml":i=o.responseText.indexOf("FeatureCollection")>-1?new e.format.WFS({gmlFormat:new e.format.GML2({srsName:t.crs})}):new e.format.WMSGetFeatureInfo;break;case"application/vnd.ogc.gml/3.1.1":i=new e.format.GML3Patched({srsName:t.crs});break;case"text/xml":case"application/xml":(r=xml2json(o)).ServiceException&&TC.error(r.ServiceException);i=null;break;default:i=null}return i?i.readFeatures(r.responseText,{featureProjection:e.proj.get(t.crs)}):null},K=function(t,o){for(var r=[],i=[],n=$.Deferred(),a=function(e,t,o){var r=!1;if(t===o||0===t.indexOf(o))r=!0;else{var i=e.getPath(t),n=e.getPath(o);if(i.length>0&&n.length>=i.length){r=!0;for(var a=0;a<i.length;a++)if(i[a]!==n[a]){r=!1;break}}}return r},l=0;l<t.length;l++){var s=t[l];if(s instanceof e.Feature){for(var p=s.getId()||TC.getUID(),c=!1,u=p.substr(0,p.lastIndexOf(".")),g=0;g<o.layers.length;g++){var d=o.layers[g],h=d.name.substr(d.name.indexOf(":")+1);if(a(o.mapLayer,h,u)){c=!0;r.push(TC.wrap.Feature.createFeature(s));i[s.id_]=d.features;break}}if(!c){var f;if(fakeLayers[u])f=fakeLayers[u];else{f={name:u,title:u,features:[]};fakeLayers[u]=f;o.layers.push(f)}if(!opts.featureId||s.getId()===opts.featureId){r.push(TC.wrap.Feature.createFeature(s));i.push(f.features)}}}}$.when.apply(this,r).done(function(){if(arguments.length)for(var e=0;e<arguments.length;e++){var t=arguments[e];t.attributes=[];t.showsPopup=!1;for(var r in t.data){var a=t.data[r];"object"!=typeof a&&t.attributes.push({name:r,value:a})}i[t.id].push(t)}n.resolve({service:o})});return n};TC.wrap.control.GeometryFeatureInfo.prototype.getFeaturesByGeometry=function(t,o){var r=this,i=r.parent.map;r.parent.filterFeature=t;t.layer=r.parent.filterLayer;$.when(i.wrap.getMap()).then(function(n){var a=t.wrap.feature.getGeometry(),l=a.stride,s=a.getFlatCoordinates();if(!o){for(var p=null,c=1,u=s.length;c<u;c+=l)(!p||p[1]<s[c])&&(p=[s[c-1],s[c]]);o=n.getPixelFromCoordinate(new e.geom.Point(p).getCoordinates())}r.parent.beforeRequest({xy:o});var g=V(i,new TC.filter.intersects(t),"JSON"),d=[];$.when.apply($,g).then(function(){for(var e=[],t=0,n=0;n<arguments.length;n++){d[d.length]=new $.Deferred;if(arguments[n]){if(arguments[n].errors&&arguments[n].errors.length){for(var a=0;a<arguments[n].errors.length;a++){var l,s=TC.Consts.msgType.WARNING;!0;var p=arguments[n].errors[a];switch(p.key){case TC.Consts.WFSErrors.NumMaxFeatures:l=r.parent.getLocaleString("wfs.tooManyFeatures",p.params);break;case TC.Consts.WFSErrors.GetCapabilities:l=r.parent.getLocaleString("wfsGFI.inValidService",p.params);break;case TC.Consts.WFSErrors.NoFeatures:!1;continue;case TC.Consts.WFSErrors.Indeterminate:l=r.parent.getLocaleString("wfs.IndeterminateError");TC.error("Error:{error} \r\n Descripcion:{descripcion} \r\n Servicio:{serviceName}".format({error:p.params.err,descripcion:p.params.errorThrown,serviceName:p.params.serviceTitle}),TC.Consts.msgErrorMode.CONSOLE);s=TC.Consts.msgType.ERROR;break;default:l=r.parent.getLocaleString("wfsGFI."+p.key,p.params)}i.toast(l,{type:s})}if(!arguments[n].response){d[d.length-1].resolve();continue}}var c=arguments[n].response?Y(i,arguments[n].response[0],arguments[n].response[2]):[];d[d.length-1]=K(c,arguments[n].service);e.push(arguments[n].service);t+=c.length}}$.when.apply($,d).then(function(){r.parent.responseCallback({xy:o||null,services:e,featureCount:t})})},function(e){r.parent.responseCallback({})})})};TC.wrap.control.Popup.prototype=function(){this.popup=null};TC.Consts.event.PANANIMATIONSTART="pananimationstart.tc";TC.Consts.event.PANANIMATIONEND="pananimationend.tc";TC.wrap.control.Popup.prototype.fitToView=function(){var t=this,o=t.parent.map,r=t.parent.map.wrap.map,i=t.parent.$popupDiv[0].getBoundingClientRect(),n=o._$div[0].getBoundingClientRect(),a=r.getCoordinateFromPixel([i.left-n.left,i.top-n.top]),l=r.getCoordinateFromPixel([i.right-n.left,i.bottom-n.top]),s=a[0],p=a[1],c=l[0],u=[s,l[1],c,p],g=o.getExtent();if(!e.extent.containsExtent(g,u)){var d={left:Math.max(g[0]-u[0],0),bottom:Math.max(g[1]-u[1],0),right:Math.max(u[2]-g[2],0),top:Math.max(u[3]-g[3],0)};if(t.parent.dragged){var h=t.popup.getPosition();d.right?h[0]=h[0]-d.right:d.left&&(h[0]=h[0]+d.left);d.top?h[1]=h[1]-d.top:d.bottom&&(h[1]=h[1]+d.bottom);var f=r.getPixelFromCoordinate(h);f[1]=r.getSize()[1]-f[1];t.parent._previousContainerPosition=f;t.popup._oldUpdatePixelPosition(h)}else if(t.parent.isVisible()){var y=r.getView(),m=y.getCenter().slice();d.top?m[1]+=d.top:d.bottom&&(m[1]-=d.bottom);d.right?m[0]+=d.right:d.left&&(m[0]-=d.left);y.animate({center:m,easing:function(e){0===e&&t.parent.map.$events.trigger($.Event(TC.Consts.event.PANANIMATIONSTART));1===e&&t.parent.map.$events.trigger($.Event(TC.Consts.event.PANANIMATIONEND));return e}})}}};TC.wrap.control.Popup.prototype.setDragged=function(t){var o=this.popup;if(t){if(!o._oldUpdatePixelPosition){o._oldUpdatePixelPosition=o.updatePixelPosition;o.updatePixelPosition=function(){}}if(!o._newHandleOffsetChanged){o._newHandleOffsetChanged=function(){this._oldUpdatePixelPosition()};e.events.unlisten(o,e.Object.getChangeEventType(e.Overlay.Property.OFFSET),o.handleOffsetChanged,o);e.events.listen(o,e.Object.getChangeEventType(e.Overlay.Property.OFFSET),o._newHandleOffsetChanged,o)}}else{delete this.parent._previousContainerPosition;if(o._oldUpdatePixelPosition){o.updatePixelPosition=o._oldUpdatePixelPosition;delete o._oldUpdatePixelPosition}if(o._newHandleOffsetChanged){e.events.unlisten(o,e.Object.getChangeEventType(e.Overlay.Property.OFFSET),o._newHandleOffsetChanged,o);e.events.listen(o,e.Object.getChangeEventType(e.Overlay.Property.OFFSET),o.handleOffsetChanged,o);delete o._newHandleOffsetChanged}}};TC.wrap.Feature.prototype.getLegend=function(){var t={},o=A(this.feature);if(o){var r=o.getImage();if(r){if(r instanceof e.style.Icon){t.src=r.getSrc();var i=r.getScale();if(i){t.scale=i;var n=r.getImage();if(n.width){t.width=n.width*i;t.height=n.height*i}}}else r instanceof e.style.Circle&&(t.src=r.canvas_.toDataURL());if(this.parent.options.radius)t.height=t.width=2*this.parent.options.radius;else{t.width=t.width||this.parent.options.width;t.height=t.height||this.parent.options.height}}else{var a=o.getStroke(),l=o.getFill();if(a){var s=a.getColor();s&&(t.strokeColor=e.color.asString(s));var p=a.getWidth();p&&(t.strokeWidth=p)}if(l){var c=l.getColor();c&&(t.fillColor=e.color.asString(c))}}}return t};var X=function(t,o,r){var i,n={};n[r||"geometry"]=new o(t);i=new e.Feature(n);r&&i.setGeometryName(r);return i};TC.wrap.Feature.prototype.createPoint=function(t,o){if($.isArray(t))this.feature=X(t,e.geom.Point,o.geometryName);else if(this.isNative(t)){this.feature=t;this.parent.geometry=t.getGeometry().getCoordinates()}this.feature._wrap=this;this.feature.setStyle(M({styles:{point:o}},this.feature));this.setData(this.parent.data)};TC.wrap.Feature.prototype.createMarker=function(t,o){var r=TC.Util.getPointIconUrl(o);if(r){o.url=r;if($.isArray(t))this.feature=X(t,e.geom.Point,o.geometryName);else if(this.isNative(t)){this.feature=t;this.parent.geometry=t.getGeometry().getCoordinates()}this.feature._wrap=this;this.feature.setStyle(M({styles:{marker:o}},this.feature));this.setData(this.parent.data)}else this.createPoint(t,o)};TC.wrap.Feature.prototype.createPolyline=function(t,o){if($.isArray(t))this.feature=X(t,e.geom.LineString,o.geometryName);else if(this.isNative(t)){this.feature=t;this.parent.geometry=t.getGeometry().getCoordinates()}this.feature._wrap=this;o&&this.feature.setStyle(M({styles:{line:o}},this.feature));this.setData(this.parent.data)};TC.wrap.Feature.prototype.createPolygon=function(t,o){if($.isArray(t)){if(t.length){var r=t[0];if($.isArray(r)&&r.length){var i=r[0];$.isArray(i)||(t=[t]);for(var n=0;n<t.length;n++){var a=(r=t[n])[0],l=r[r.length-1];a[0]===l[0]&&a[1]===l[1]||(r[r.length]=a);this.parent.geometry=t;this.feature=X(t,e.geom.MultiLineString,o.geometryName)}this.parent.geometry=t;this.feature=X(t,e.geom.Polygon,o.geometryName)}}}else if(this.isNative(t)){this.feature=t;this.parent.geometry=t.getGeometry().getCoordinates()}this.feature._wrap=this;var s=o||{};(s.strokeColor||s.strokeWidth||s.fillColor||s.fillOpacity)&&this.feature.setStyle(M({styles:{polygon:s}},this.feature));this.setData(this.parent.data)};TC.wrap.Feature.prototype.createMultiPolyline=function(t,o){if($.isArray(t)){if(t.length){var r=t[0];if($.isArray(r)&&r.length){var i=r[0];$.isArray(i)||(t=[t]);this.parent.geometry=t;this.feature=X(t,e.geom.MultiLineString,o.geometryName)}}}else if(this.isNative(t)){this.feature=t;this.parent.geometry=t.getGeometry().getCoordinates()}this.feature._wrap=this;o&&this.feature.setStyle(M({styles:{line:o}},this.feature));this.setData(this.parent.data)};TC.wrap.Feature.prototype.createMultiPolygon=function(t,o){if($.isArray(t)){if(t.length){var r=t[0];if($.isArray(r)&&r.length){var i=r[0];if($.isArray(i)&&i.length){var n=i[0];$.isArray(n)||(t=[t])}else t=[[t]];for(var a=0,l=t.length;a<l;a++)for(var s=0,p=(r=t[a]).length;s<p;s++){var c=(i=r[s])[0],u=i[i.length-1];c[0]===u[0]&&c[1]===u[1]||(i[i.length]=c)}this.parent.geometry=t;this.feature=X(t,e.geom.MultiPolygon,o.geometryName)}}}else if(this.isNative(t)){this.feature=t;this.parent.geometry=t.getGeometry().getCoordinates()}this.feature._wrap=this;var g=o||{};(g.strokeColor||g.strokeWidth||g.fillColor||g.fillOpacity)&&this.feature.setStyle(M({styles:{polygon:g}},this.feature));this.setData(this.parent.data)};TC.wrap.Feature.prototype.createCircle=function(t,o){if($.isArray(t)&&$.isArray(t[0])&&"number"==typeof t[0][0]&&"number"==typeof t[0][1]&&"number"==typeof t[1]){var r={};r[o.geometryName||"geometry"]=new e.geom.Circle(t[0],t[1]);this.feature=new e.Feature(r);o.geometryName&&this.feature.setGeometryName(o.geometryName)}else if(this.isNative(t)){this.feature=t;var i=t.getGeometry();this.parent.geometry=[i.getCenter(),i.getRadius()]}this.feature._wrap=this;o&&this.feature.setStyle(new e.style.Style({stroke:new e.style.Stroke({color:o.strokeColor,width:o.strokeWidth,lineDash:o.lineDash}),fill:new e.style.Fill({color:v(o.fillColor,o.fillOpacity)})}));this.setData(this.parent.data)};TC.wrap.Feature.createFeature=function(t,o){var r,i=new $.Deferred,n=t.getGeometry(),a={id:t.getId()};switch(!0){case n instanceof e.geom.Point:var l=t.getStyle();$.isFunction(l)&&(l=l.call(t));for(var s=l?$.isArray(l)?l:[l]:[],p=0,c=s.length;p<c;p++)if((l=s[p]).getImage()instanceof e.style.Icon){r="Marker";break}r=r||"Point";break;case n instanceof e.geom.LineString:r="Polyline";break;case n instanceof e.geom.Polygon:r="Polygon";break;case n instanceof e.geom.MultiLineString:r="MultiPolyline";break;case n instanceof e.geom.MultiPolygon:r="MultiPolygon"}r?TC.loadJS(!TC.feature||TC.feature&&!TC.feature[r],[TC.apiLocation+"TC/feature/"+r],function(){var e=new TC.feature[r](t,a);e.data=e.wrap.getData();i.resolve(e)}):TC.loadJS(!TC.Feature,[TC.apiLocation+"TC/Feature"],function(){var e=new TC.Feature(t,a);e.data=e.wrap.getData();i.resolve(e)});return i};TC.wrap.Feature.prototype.cloneFeature=function(){return this.feature.clone()};TC.wrap.Feature.prototype.getStyle=function(){var t={},o=this.feature.getStyle();$.isFunction(o)&&(o=o.call(this.feature));var r=o?$.isArray(o)?o:[o]:[];const i=function(e,t){if(e){const o=e.getFill();if(o){t.fillColor=o.getColor();$.isArray(t.fillColor)&&(t.fillOpacity=t.fillColor[3])}}},n=function(e,t){if(e){const o=e.getStroke();if(o){t.strokeColor=o.getColor();t.strokeWidth=o.getWidth()}}};for(var a=0,l=r.length;a<l;a++){i(o=r[a],t);n(o,t);const l=o.getImage();if(l instanceof e.style.Icon){t.url=l.getSrc();const e=l.getSize(),o=l.getScale()||1;if(e){t.width=e[0]*o;t.height=e[1]*o}var s=l.getAnchor();if(s){t.anchor=[s[0]*o,s[1]*o];if(e){t.anchor[0]=t.anchor[0]/e[0];t.anchor[1]=t.anchor[1]/e[1]}}}else{i(l,t);n(l,t)}var p=o.getText();if(p){t.label=p.getText();var c=p.getFont();c&&(t.fontSize=parseInt(c.match(/\d+pt/))||.75*parseInt(c.match(/\d+px/)));var u=p.getRotation();u&&(t.angle=-180*u/Math.PI);t.labelOffset=[p.getOffsetX(),p.getOffsetY()];fill=p.getFill();fill&&(t.fontColor=fill.getColor());stroke=p.getStroke();if(stroke){t.labelOutlineColor=stroke.getColor();t.labelOutlineWidth=stroke.getWidth()}}}$.extend(this.parent.options,t);return t};TC.wrap.Feature.prototype.getGeometry=function(){var t;if(this.feature&&this.feature.getGeometry){var o=this.feature.getGeometry();o&&(o.getCoordinates?t=o.getCoordinates():o instanceof e.geom.Circle&&(t=[o.getCenter(),o.getRadius()]))}return t};TC.wrap.Feature.prototype.setGeometry=function(t){var o=!1;if(this.feature&&this.feature.getGeometry){var r,i,n,a,l,s,p,c=this.feature.getGeometry();switch(!0){case c instanceof e.geom.MultiPolygon:l=!0;a=t;$.isArray(a)&&(n=t[0]);case c instanceof e.geom.Polygon||c instanceof e.geom.MultiLineString:s=!0;n=l?n:t;$.isArray(n)&&(i=n[0]);case c instanceof e.geom.LineString:p=!0;i=s?i:t;$.isArray(i)&&(r=i[0]);case c instanceof e.geom.Point:r=p?r:t;if($.isArray(r)&&"number"==typeof r[0]&&"number"==typeof r[1]){var u;switch(r.length){case 3:u=e.geom.GeometryLayout.XYZ;break;case 4:u=e.geom.GeometryLayout.XYZM;break;default:u=e.geom.GeometryLayout.XY}c.setCoordinates(t,u);o=!0}break;case c instanceof e.geom.Circle:if($.isArray(t)&&$.isArray(t[0])&&"number"==typeof t[0][0]&&"number"==typeof t[0][1]&&"number"==typeof t[1]){c.setCenterAndRadius(t[0],t[1]);o=!0}}}return o};TC.wrap.Feature.prototype.getId=function(){var e;this.feature&&(e=this.feature.getId());return e};TC.wrap.Feature.prototype.setId=function(e){this.feature&&this.feature.setId(e)};TC.wrap.Feature.prototype.getLength=function(t){const o=this;t=t||{};const r=o.feature.getGeometry();var i;if(r instanceof e.geom.Polygon){i=r.getLinearRing(0).getCoordinates();t.crs&&(i=TC.Util.reproject(i,o.parent.layer.map.crs,t.crs));const n=new e.geom.Polygon([i]).getLinearRing(0);return e.geom.flat.length.linearRing(n.flatCoordinates,0,n.flatCoordinates.length,n.stride)}if(r instanceof e.geom.LineString){i=r.getCoordinates();t.crs&&(i=TC.Util.reproject(i,o.parent.layer.map.crs,t.crs));return new e.geom.LineString(i).getLength()}};TC.wrap.Feature.prototype.getArea=function(t){const o=this;t=t||{};const r=o.feature.getGeometry();var i;if(r instanceof e.geom.Polygon){i=r.getLinearRing(0).getCoordinates();t.crs&&(i=TC.Util.reproject(i,o.parent.layer.map.crs,t.crs));return new e.geom.Polygon([i]).getArea()}};const H=function(t){var o=this.getStyle();$.isFunction(o)&&(o=o.call(this));$.isArray(o)&&(o=o[o.length-1]);if(!o&&!t){o=new e.style.Style;this.setStyle(o)}return o};TC.wrap.Feature.prototype.setStyle=function(t){const o=this.feature;if(null===t){o.setStyle(null);return}const r=this.parent,i=o.getGeometry();var n,a=H.call(o);r.layer&&(n=function(t){var o=this.getStyle();$.isFunction(o)&&(o=o(t));$.isArray(o)&&(o=o[o.length-1]);o||(o=new e.style.Style);return o}.call(r.layer.wrap.layer,r.wrap.feature));if(i instanceof e.geom.Point||i instanceof e.geom.MultiPoint){var l;if(t.anchor||t.url||t.cssClass){const o={};if((l=a.getImage())instanceof e.style.Icon){o.src=t.url||TC.Util.getBackgroundUrlFromCss(t.cssClass)||l.getSrc();t.width&&t.height?o.size=[R(t.width,r),R(t.height,r)]:o.size=l.getSize();o.anchor=R(t.anchor,r)||l.getAnchor().map(function(e,t){return e/o.size[t]})}else{o.src=TC.Util.getPointIconUrl(t);o.anchor=R(t.anchor,r);o.size=[R(t.width,r),R(t.height,r)]}t.angle&&(o.angle=t.angle);l=new e.style.Icon(o)}else if(!a.getImage()&&a.getText())if(void 0!==t.label){a=H.call(o);t.label.length?a.setText(I(t,r)):a.setText()}else a.setText();else{(l=a.getImage())||(l=new e.style.Circle);const o={radius:R(t.radius,r)||(R(t.height,r)+R(t.width,r))/4};isNaN(o.radius)&&(o.radius=l.getRadius());t.fillColor?o.fill=new e.style.Fill({color:v(R(t.fillColor,r),R(t.fillOpacity,r))}):o.fill=l.getFill();o.stroke=l.getStroke();const i=n&&n.getStroke();if(t.strokeColor||t.strokeWidth){o.stroke||(o.stroke=new e.style.Stroke);if(t.strokeColor)o.stroke.setColor(R(t.strokeColor,r));else{const e=o.stroke.getColor()||i&&i.getColor()||TC.Cfg.styles.point.strokeColor;o.stroke.setColor(R(e,r))}if(t.strokeWidth)o.stroke.setWidth(R(t.strokeWidth,r));else{const e=o.stroke.getWidth()||i&&i.getWidth()||TC.Cfg.styles.point.strokeWidth;o.stroke.setWidth(R(e,r))}}l=new e.style.Circle(o)}a.setImage(l)}else{var s=a.getStroke(),p=!1;s||(s=new e.style.Stroke);if(t.strokeColor){s.setColor(R(t.strokeColor,r));p=!0}if(t.strokeWidth){s.setWidth(R(t.strokeWidth,r));p=!0;a.setStroke(s)}if(t.lineDash){s.setLineDash(t.lineDash);p=!0;a.setStroke(s)}p&&a.setStroke(s);if((i instanceof e.geom.Polygon||i instanceof e.geom.MultiPolygon)&&(t.fillColor||t.fillOpacity)){var c=a.getFill()||new e.style.Fill;c.setColor(v(R(t.fillColor,r),R(t.fillOpacity,r)));a.setFill(c)}}if(void 0!==t.label){a=H.call(o);t.label.length?a.setText(I(t,r)):a.setText()}o.changed()};TC.wrap.Feature.prototype.getInnerPoint=function(t){var o,r=t||{},i=this.feature.getGeometry(),n=function e(t){if(r.clipBox&&$.isArray(t))if($.isArray(t[0]))for(var o=0,i=t.length;o<i;o++)e(t[o]);else!function(e){var t=r.clipBox;e[0]=Math.min(Math.max(e[0],t[0]),t[2]);e[1]=Math.min(Math.max(e[1],t[1]),t[3])}(t)};o=i.getFirstCoordinate();switch(i.getType()){case e.geom.GeometryType.MULTI_POLYGON:var a=0;i=i.getPolygons().reduce(function(e,t){const o=t.getArea(),r=o>a?t:e;a=o;return r});case e.geom.GeometryType.POLYGON:var l=function(e,t){for(var o=!1,r=0,i=t.length-1;r<t.length;i=r++){var n=t[r][0],a=t[r][1],l=t[i][0],s=t[i][1];a>e[1]!=s>e[1]&&e[0]<(l-n)*(e[1]-a)/(s-a)+n&&(o=!o)}return o};n(u=i.getCoordinates());o=(i=new e.geom.Polygon(u)).getInteriorPoint().getCoordinates();for(var s=i.getLinearRings(),p=1;p<s.length;p++)if(l(o,s[p].getCoordinates())){o=i.getClosestPoint(o);break}break;case e.geom.GeometryType.MULTI_LINE_STRING:var c=0;i=i.getLineStrings().reduce(function(e,t){const o=t.getLength(),r=o>c?t:e;c=o;return r});case e.geom.GeometryType.LINE_STRING:var u,g=[0,0];n(u=i.getCoordinates());i=new e.geom.LineString(u);for(p=0;p<u.length;p++){g[0]+=u[p][0];g[1]+=u[p][1]}g[0]/=u.length;g[1]/=u.length;o=i.getClosestPoint(g)}return o};TC.wrap.Feature.prototype.showPopup=function(t){var o=t.map;if(o){var r=this.feature;if(r){o.currentFeature=this.parent;var i=o.getExtent();this._innerCentroid=this.getInnerPoint({clipBox:i});t.$contentDiv.html(this.parent.getInfo());t.$menuDiv.empty();if(t.options.closeButton||void 0===t.options.closeButton){$("<div>").addClass(t.CLASS+"-close").attr("title",t.getLocaleString("close")).appendTo(t.$menuDiv).on(TC.Consts.event.CLICK,function(){t.hide()});t.$contentDiv.addClass(t.CLASS+"-has-btn");t.$contentDiv.find(".tc-ctl-finfo").css("width","auto").css("height","auto")}var n,a=this.parent.options;if(a.anchor)n=a.anchor;else{for(var l,s=r._wrap.parent,p=0;p<o.workLayers.length;p++){var c=o.workLayers[p];if(!c.isRaster()&&$.inArray(s,c.features)>=0){l=c.wrap.styleFunction(r);break}}if($.isArray(l)){const t=l[0].getImage();n=!t||t instanceof e.style.Icon?[.5,0]:[.5,.5]}}const g=[0,0];if(n)if(a.height)g[1]=-a.height*n[1];else{var u=H.call(r,!0);if(u){const t=u.getImage();t instanceof e.style.Icon&&(g[1]=t.getImageSize()[1]*-t.getScale())}}t.wrap.popup.setOffset(g);t.wrap.popup.setPosition(this._innerCentroid);t.$popupDiv.addClass(TC.Consts.classes.VISIBLE)}else o.wrap.hidePopup(t)}};TC.wrap.Feature.prototype.isNative=function(t){return t instanceof e.Feature};TC.wrap.Feature.prototype.getPath=function(){var e=[];this.feature&&this.feature._folders&&(e=this.feature._folders);return e};TC.wrap.Feature.prototype.getBounds=function(){var e=null;this.feature&&(e=this.feature.getGeometry().getExtent());return e};TC.wrap.Feature.prototype.getTemplate=function(){var e=null,t=this.feature.getStyle();"function"==typeof t&&(t=t.call(this.feature));if($.isArray(t))for(var o=0;o<t.length;o++)if(t[o]._balloon){if(t[o]._balloon.getText()){t=t[o]._balloon;break}}t&&!$.isArray(t)&&t.getText&&(e=t.getText());return e};TC.wrap.Feature.prototype.getData=function(){var e=this.feature.getProperties();$.isArray(e.features)&&(e=1===e.features.length?e.features[0].getProperties():e.features.length+" elementos");var t=this.feature.getGeometryName();e[t]&&delete e[t];return e};TC.wrap.Feature.prototype.setData=function(e){this.feature.setProperties(e)};TC.wrap.Feature.prototype.clearData=function(){const e=this.feature,t=e.getGeometryName();e.getKeys().forEach(function(o){o!==t&&e.unset(o)})};TC.wrap.control.Draw.prototype.mouseMoveHandler=function(e){var t=e.data;t.sketch&&t.parent.$events.trigger($.Event(TC.Consts.event.MEASUREPARTIAL,t.getMeasureData()))};TC.wrap.control.Draw.prototype.mouseOverHandler=function(e){var t=e.data;if(t.sketch&&t.hoverCoordinate){t.pushCoordinate(t.hoverCoordinate);t.hoverCoordinate=null}};TC.wrap.control.Draw.prototype.clickHandler=function(e){const t=this;if(t._mdPx){const o=t._mdPx[0]-e.clientX,r=t._mdPx[1]-e.clientY;if(o*o+r*r>t.interaction.squaredClickTolerance_)return}if(t.sketch){var o=t.sketch.getGeometry().getCoordinates();t.parent.$events.trigger($.Event(TC.Consts.event.POINT,{point:o[o.length-1]}))}};TC.wrap.control.Draw.prototype.mousedownHandler=function(e){this._mdPx=[e.clientX,e.clientY]};TC.wrap.control.Draw.prototype.getMeasureData=function(){var t=this,o={units:e.proj.Units.METERS};if(this.sketch){var r=this.sketch.getGeometry();r instanceof e.geom.Polygon?function(o,r){o=new e.geom.Polygon([TC.Util.reproject(o.getLinearRing(0).getCoordinates(),t.parent.map.crs,t.parent.map.options.utmCrs)]);r.area=o.getArea();var i=o.getLinearRing(0);r.perimeter=e.geom.flat.length.linearRing(i.flatCoordinates,0,i.flatCoordinates.length,i.stride)}(r,o):r instanceof e.geom.LineString&&function(o,r){o=new e.geom.LineString(TC.Util.reproject(o.getCoordinates(),t.parent.map.crs,t.parent.map.options.utmCrs));r.length=o.getLength()}(r,o)}return o};TC.wrap.control.Draw.prototype.activate=function(t){var o,r=this;switch(t){case TC.Consts.geom.POLYGON:o=e.geom.GeometryType.POLYGON;break;case TC.Consts.geom.POINT:o=e.geom.GeometryType.POINT;break;default:o=e.geom.GeometryType.LINE_STRING}r.parent.map&&$.when(r.parent.map.wrap.getMap(),r.parent.getLayer()).then(function(n,a){$.when(a&&a.wrap.getLayer()).then(function(a){r.$viewport||(r.$viewport=$(n.getViewport()));if(r.interaction){n.removeInteraction(r.interaction);r.$viewport.off("mousedown.tc").off(TC.Consts.event.CLICK);r.parent.measure&&r.$viewport.off(i+".draw",r.mouseMoveHandler).off("mouseover.tc",r.mouseOverHandler)}r.snapInteraction&&n.removeInteraction(r.snapInteraction);if(t){r.$viewport.on("mousedown.tc",$.proxy(r.mousedownHandler,r)).on(TC.Consts.event.CLICK,r,$.proxy(r.clickHandler,r));r.parent.measure&&r.$viewport.on(i+".draw",r,r.mouseMoveHandler).on("mouseover.tc",r,r.mouseOverHandler);var l={type:o,snapTolerance:0,condition:function(){e.events.condition.shiftKeyOnly(arguments[0])&&(hole=n.forEachFeatureAtPixel(n.getPixelFromCoordinate(arguments[0].coordinate),function(t){return e.geom.GeometryType.POLYGON==t.getGeometry().getType()||e.geom.GeometryType.MULTI_POLYGON==t.getGeometry().getType()?t:null},{hitTolerance:p}));return!0}};a&&(l.source=a.getSource());switch(t){case TC.Consts.geom.RECTANGLE:l.style=M({styles:{line:r.parent.styles.line}});l.type=e.geom.GeometryType.LINE_STRING;l.maxPoints=2;l.geometryFunction=function(t,o){o||(o=new e.geom.Polygon(null));var r=t[0],i=t[1];o.setCoordinates([[r,[r[0],i[1]],i,[i[0],r[1]],r]]);return o};break;case TC.Consts.geom.POLYGON:l.style=M({styles:{polygon:r.parent.styles.polygon}});break;case TC.Consts.geom.POINT:l.style=M({styles:{point:r.parent.styles.point}});break;default:l.style=M({styles:{line:r.parent.styles.line}})}r.interaction=new e.interaction.Draw(l);r.interaction.on(e.interaction.DrawEventType.DRAWSTART,function(e){r.sketch=e.feature;r.parent.$events.trigger($.Event(TC.Consts.event.DRAWSTART))},this);r.interaction.on(e.interaction.DrawEventType.DRAWEND,function(e){e.feature.setStyle(e.target.overlay_.getStyle().map(function(e){return e.clone()}));r.parent.measure&&r.parent.$events.trigger($.Event(TC.Consts.event.MEASURE,r.getMeasureData()));F(r.sketch).then(function(e){r.parent.$events.trigger($.Event(TC.Consts.event.DRAWEND,{feature:e}));r.sketch=null})},this);r._projectionChangeHandler=function(t){!function(t,o){if(t.sketch){const i=o.oldValue.getProjection(),n=o.target.get(o.key).getProjection();if(i.getCode()!==n.getCode()){const o=t.sketch.getGeometry();o.transform(i,n);t.interaction.sketchPoint_.getGeometry().transform(i,n);const a=[];var r;r=t.interaction.mode_===e.interaction.Draw.Mode_.POLYGON?t.interaction.sketchCoords_[0]:t.interaction.sketchCoords_;e.geom.flat.deflate.coordinates(a,0,r,o.stride);e.proj.getTransform(i,n)(a,a,o.stride);r=e.geom.flat.inflate.coordinates(a,0,a.length,o.stride);t.interaction.mode_===e.interaction.Draw.Mode_.POLYGON?t.interaction.sketchCoords_=[r]:t.interaction.sketchCoords_=r}}}(r,t)};n.on("change:view",r._projectionChangeHandler);n.addInteraction(r.interaction);if(r.parent.snapping){var s={};a?s.source=a.getSource():r.parent.snapping instanceof TC.Layer&&(s.source=r.parent.snapping.wrap.layer.getSource());r.snapInteraction=new e.interaction.Snap(s);n.addInteraction(r.snapInteraction)}}r.redoStack=[]})})};TC.wrap.control.Draw.prototype.deactivate=function(){var e=this;e.parent.map&&$.when(e.parent.map.wrap.getMap(),e.parent.getLayer()).then(function(t,o){e.$viewport&&e.$viewport.off("mousedown.tc").off(TC.Consts.event.CLICK);o&&!e.parent.persistent&&o.clearFeatures();if(e.interaction){t.removeInteraction(e.interaction);e.interaction=null}t.un("change:view",e._projectionChangeHandler)})};TC.wrap.control.Draw.prototype.popCoordinate=function(){var t=null;if(this.interaction){var o=this.interaction.sketchFeature_;if(o){var r,i=o.getGeometry();i instanceof e.geom.Polygon?r=i.getCoordinates()[0]:i instanceof e.geom.LineString&&(r=i.getCoordinates());if(r.length>1){var n;i instanceof e.geom.Polygon?n=this.interaction.sketchCoords_[0]:i instanceof e.geom.LineString&&(n=this.interaction.sketchCoords_);var a,l=!1;if(this.interaction.sketchPoint_)for(var s=this.interaction.sketchPoint_.getGeometry().getCoordinates(),p=0;p<r.length;p++)if(r[p][0]==s[0]&&r[p][1]==s[1]){l=!0;break}t=n[a=l?n.length-2:n.length-1];n.splice(a,1);if(i instanceof e.geom.Polygon){i.setCoordinates([n]);this.interaction.sketchLine_.getGeometry().setCoordinates(n)}else i.setCoordinates(n);o.setGeometry(i)}}}return t};TC.wrap.control.Draw.prototype.pushCoordinate=function(t){var o=!1;if(this.interaction){var r=this.interaction.sketchFeature_;if(r){var i,n=r.getGeometry();n instanceof e.geom.Polygon?i=n.getCoordinates()[0]:n instanceof e.geom.LineString&&(i=n.getCoordinates());var a;n instanceof e.geom.Polygon?a=this.interaction.sketchCoords_[0]:n instanceof e.geom.LineString&&(a=this.interaction.sketchCoords_);var l=!1;if(this.interaction.sketchPoint_)for(var s=this.interaction.sketchPoint_.getGeometry().getCoordinates(),p=0;p<i.length;p++)if(i[p][0]==s[0]&&i[p][1]==s[1]){l=!0;break}index=l?a.length-1:a.length;a.splice(index,0,t);if(n instanceof e.geom.LineString)n.setCoordinates(a,e.geom.GeometryLayout.XY);else{n.setCoordinates([a],e.geom.GeometryLayout.XY);this.interaction.sketchLine_.getGeometry().setCoordinates(a)}o=!0}}return o};TC.wrap.control.Draw.prototype.undo=function(){var e=!1,t=this.popCoordinate();if(t){this.redoStack.push(t);e=!0}this.parent.$events.trigger($.Event(TC.Consts.event.MEASUREPARTIAL,this.getMeasureData()));return e};TC.wrap.control.Draw.prototype.redo=function(){var e=!1;if(this.redoStack.length>0){this.pushCoordinate(this.redoStack.pop());e=!0}this.parent.$events.trigger($.Event(TC.Consts.event.MEASUREPARTIAL,this.getMeasureData()));return e};TC.wrap.control.Draw.prototype.end=function(){this.interaction&&this.interaction.sketchFeature_&&this.interaction.finishDrawing()};TC.wrap.control.Draw.prototype.setStyle=function(e){const t=this;t.interaction&&t.interaction.overlay_.setStyle(M({styles:e}))};TC.wrap.control.CacheBuilder.prototype.getRequestSchemas=function(e){for(var t=e.extent,o=e.layers,r=new Array(o.length),i=0,n=r.length;i<n;i++){var a=o[i],l={layerId:a.id},s=a.wrap.layer.getSource();s.getUrls&&(l.url=s.getUrls()[0]);if(s.getTileGrid){for(var p=s.getTileGrid(),c=p.getResolutions(),u=p.getMatrixIds(),g=a.getLayerNodeByName(a.layerNames),d=null,h=0,f=g.TileMatrixSetLink.length;h<f;h++){var y=g.TileMatrixSetLink[h];if(y.TileMatrixSet===a.matrixSet){d=y.TileMatrixSetLimits;break}}l.tileMatrixLimits=[];h=0;for(var m=c.length;h<m;h++){var v=p.getOrigin(h),C=p.getTileSize(h),T=c[h],S=C*T,_={mId:u[h],res:T,origin:v,tSize:C,cl:Math.floor((t[0]-v[0])/S),cr:Math.floor((t[2]-v[0])/S),rt:Math.floor((v[1]-t[3])/S),rb:Math.floor((v[1]-t[1])/S)};if(d){var E=d[h];if(E){_.cl=Math.max(_.cl,E.MinTileCol);_.cr=Math.min(_.cr,E.MaxTileCol);_.rt=Math.max(_.rt,E.MinTileRow);_.rb=Math.min(_.rb,E.MaxTileRow)}}_.cl<=_.cr&&_.rt<=_.rb&&l.tileMatrixLimits.push(_)}}r[i]=l}return r};TC.wrap.control.CacheBuilder.prototype.getGetTilePattern=function(e){var t="",o=e.wrap.layer.getSource();o.getUrls&&(t=o.getUrls()[0]);if(e.options.encoding!==TC.Consts.WMTSEncoding.RESTFUL){t.indexOf("?")<0&&(t+="?");t.indexOf("?")===t.length-1&&(t=t+"layer="+e.layerNames+"&style=default&tilematrixset="+encodeURIComponent(e.matrixSet)+"&Service=WMTS&Request=GetTile&Version=1.0.0&Format="+encodeURIComponent(e.format)+"&TileMatrix={TileMatrix}&TileCol={TileCol}&TileRow={TileRow}")}return t};const z=function(t){return new e.style.Stroke({color:"#ffffff",width:t+4})},Z=function(t){return new e.style.Stroke({color:"#000000",width:t+6})},J=function(t){t instanceof e.style.Style&&(t=[t]);const o=(t=t.slice())[0],r=o.getImage();var i;if(r instanceof e.style.RegularShape){i=r.getStroke().getWidth();const n=r.getRadius(),a=o.clone();a.setImage(new e.style.Circle({radius:n,stroke:z(i)}));t.unshift(a);const l=o.clone();l.setImage(new e.style.Circle({radius:n,stroke:Z(i)}));t.unshift(l)}else{i=o.getStroke().getWidth();t.unshift(new e.style.Style({stroke:z(i)}));t.unshift(new e.style.Style({stroke:Z(i)}))}return t},Q=function(e){e._originalStyle=e._originalStyle||e.getStyle();return $.isFunction(e._originalStyle)?function(t,o){return J(e._originalStyle(t,o))}:J(e._originalStyle)},ee=function(e){e.setStyle(e._originalStyle);e._originalStyle=null},te=function(){this.style_=Q(this);this.styleFunction_=this.style_?e.Feature.createStyleFunction(this.style_):void 0};TC.wrap.control.Modify.prototype.activate=function(){const t=this;t.parent.map&&$.when(t.parent.map.wrap.getMap(),t.parent.layer.wrap.getLayer()).then(function(o,r){t.selectInteraction&&o.removeInteraction(t.selectInteraction);var n=new e.interaction.Select({layers:[r],hitTolerance:p});t.selectInteraction=n;o.addInteraction(n);var a=function(e){return e._wrap.parent};n.on("select",function(o){if(o.selected.length>0){o.selected.forEach(function(t){t.setStyle(Q(t));e.events.listen(t,e.events.EventType.CHANGE,te,t)});t.parent.$events.trigger($.Event(TC.Consts.event.FEATURESSELECT,{ctrl:t,features:o.selected.map(a)}))}if(o.deselected.length>0){o.deselected.forEach(function(t){e.events.unlisten(t,e.events.EventType.CHANGE,te,t);ee(t)});0==o.selected.length&&t.parent.$events.trigger($.Event(TC.Consts.event.FEATURESUNSELECT,{ctrl:t.parent,features:o.deselected.map(a)}))}});t.modifyInteraction&&o.removeInteraction(t.modifyInteraction);var l=new e.interaction.Modify({features:n.getFeatures()});l.on(e.interaction.ModifyEventType.MODIFYEND,function(e){e.features.forEach(function(e){e._wrap.parent.geometry=e._wrap.getGeometry();t.parent.$events.trigger($.Event(TC.Consts.event.FEATUREMODIFY,{feature:e._wrap.parent,layer:t.parent.layer}))})});t.modifyInteraction=l;o.addInteraction(l);t.snapInteraction&&o.removeInteraction(t.snapInteraction);if(t.parent.snapping){t.snapInteraction=new e.interaction.Snap({source:r.getSource()});o.addInteraction(t.snapInteraction)}t._onMouseMove||(t._onMouseMove=function(e){const r=o.getTarget();var i,n=o.getEventPixel(e.originalEvent);i=o.forEachFeatureAtPixel(n,function(e,o){return o===t.parent.layer.wrap.getLayer()},{hitTolerance:p});r.style.cursor=i?"pointer":""});$(o.getViewport()).on(i,t._onMouseMove)})};TC.wrap.control.Modify.prototype.deactivate=function(){const t=this;if(t.modifyInteraction){t.selectInteraction.getFeatures().forEach(function(t){e.events.unlisten(t,e.events.EventType.CHANGE,te,t);ee(t)});t.modifyInteraction.setActive(!1);t.selectInteraction.setActive(!1);$.when(t.parent.map.wrap.getMap()).then(function(e){$(e.getViewport()).off(i,t._onMouseMove);e.removeInteraction(t.modifyInteraction);e.removeInteraction(t.selectInteraction);t.modifyInteraction=null;t.selectInteraction=null})}};TC.wrap.control.Modify.prototype.getSelectedFeatures=function(){var e=[];this.selectInteraction&&this.selectInteraction.getFeatures().forEach(function(t){e[e.length]=t._wrap.parent});return e};TC.wrap.control.Modify.prototype.setSelectedFeatures=function(e){if(this.selectInteraction){var t=this.selectInteraction.featureOverlay_.getSource();t.clear();t.addFeatures(e.map(function(e){return e.wrap.feature}))}};TC.wrap.control.Modify.prototype.unselectFeatures=function(e){e=e||[];const t=this,o=t.selectInteraction?t.selectInteraction.getFeatures():null;if(o){const r=[];o.getArray().slice().forEach(function(t){if(!e.length||e.indexOf(t)>=0){o.remove(t);r[r.length]=t._wrap.parent}});r.length&&t.parent.$events.trigger($.Event(TC.Consts.event.FEATURESUNSELECT,{features:r}))}};TC.wrap.control.Edit.prototype.activate=function(e){this.cancel(!0);e===TC.Consts.editMode.SELECT&&TC.wrap.control.Modify.prototype.activate.call(this)};TC.wrap.control.Edit.prototype.deactivate=function(){var e=this;TC.wrap.control.Modify.prototype.deactivate.call(e);if(e.drawInteraction){e.drawInteraction.abortDrawing_();e.drawInteraction.setActive(!1);$.when(e.parent.map.wrap.getMap()).then(function(t){t.removeInteraction(e.drawInteraction);e.drawInteraction=null})}e.parent.$events.trigger($.Event(TC.Consts.event.CONTROLDEACTIVATE,{ctrl:e}))};TC.wrap.control.Edit.prototype.cancel=function(e,t){this.points=[];this.histPoints=[];this.control&&this.control.layer||this.modifyInteraction&&this.modifyInteraction.layer;if(this.selectInteraction){var o=this.selectInteraction.getFeatures();this.parent.$events.trigger($.Event(TC.Consts.event.FEATURESUNSELECT,{ctrl:this.parent,feature:o.get(0)}));o.clear();this.selectInteraction.setActive(!1)}};TC.wrap.control.Edit.prototype.getSelectedFeatures=function(){return TC.wrap.control.Modify.prototype.getSelectedFeatures.call(this)};TC.wrap.control.Edit.prototype.setSelectedFeatures=function(e){TC.wrap.control.Modify.prototype.setSelectedFeatures.call(this,e)};TC.wrap.control.Edit.prototype.deleteFeatures=function(e){var t=this;if($.isArray(e)){var o=e.map(function(e){return e.wrap.feature});$.when(t.parent.layer.wrap.getLayer()).then(function(e){for(var r=t.selectInteraction?t.selectInteraction.getFeatures():null,i=0,n=o.length;i<n;i++){var a=o[i];if(r){r.remove(a);t.parent.$events.trigger($.Event(TC.Consts.event.FEATURESUNSELECT,{feature:a._wrap.parent}))}e.getSource().removeFeature(a);t.parent.$events.trigger($.Event(TC.Consts.event.FEATUREREMOVE,{feature:a._wrap.parent}))}})}};TC.wrap.Feature.prototype.toGML=function(t,o){var r=(new e.format.GML).writeGeometryNode(this.feature.getGeometry());return(new XMLSerializer).serializeToString(r.firstChild).replace(/\<\/?\w/gm,function(e){var t=e.indexOf("/")>0?e.indexOf("/")+1:1;return e.substring(0,t)+"gml:"+e.substring(t)})};TC.wrap.Feature.prototype.toGeoJSON=function(){return(new e.format.GeoJSON).writeGeometry(this.feature.getGeometry())};TC.wrap.Geometry.write=function(t){var o;(t=t||{}).format;t.parser=new e.format.GeoJSON;switch(t.type){case TC.Consts.geom.POLYLINE:o=new e.geom.LineString(t.coordinates);break;case TC.Consts.geom.POLYGON:o=new e.geom.Polygon(t.coordinates);break;case TC.Consts.geom.MULTIPOINT:o=new e.geom.MultiPoint(t.coordinates);break;case TC.Consts.geom.MULTIPOLYLINE:o=new e.geom.MultiLineString(t.coordinates);break;case TC.Consts.geom.MULTIPOLYGON:o=new e.geom.MultiPolygon(t.coordinates);break;case TC.Consts.geom.POINT:default:o=new e.geom.Point(t.coordinates)}return t.parser.writeGeometry(o)};TC.wrap.Geometry.toGeoJSON=function(e){return TC.wrap.Geometry.write(e)};return e});TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.control.Attribution=function(){TC.Control.apply(this,arguments);this.apiAttribution="";this.mainDataAttribution="";this.dataAttributions=[];this.options.dataAttributions&&(this.dataAttributions=this.options.dataAttributions instanceof Array?this.options.dataAttributions:[this.options.dataAttributions])};TC.inherit(TC.control.Attribution,TC.Control);!function(){var e=TC.control.Attribution.prototype;e.CLASS="tc-ctl-attrib";TC.isDebug?e.template=TC.apiLocation+"TC/templates/Attribution.html":e.template=function(){dust.register(e.CLASS,t);function t(e,t){return e.w("<div><span>&copy; ").f(t.get(["api"],!1),t,"h",["s"]).w("</span> - ").h("i18n",t,{},{$key:"data"}).w(": ").x(t.getPath(!1,["mainData","site"]),t,{else:o,block:r},{}).x(t.get(["otherData"],!1),t,{block:i},{}).w('<div class="tc-ctl-attrib-other tc-collapsed">').s(t.get(["otherData"],!1),t,{block:n},{}).w("</div></div>")}t.__dustBody=!0;function o(e,t){return e.w("<span>&copy; ").f(t.getPath(!1,["mainData","name"]),t,"h").w("</span>")}o.__dustBody=!0;function r(e,t){return e.w('<span>&copy; <a href="').f(t.getPath(!1,["mainData","site"]),t,"h").w('" target="_blank">').f(t.getPath(!1,["mainData","name"]),t,"h").w("</a></span>")}r.__dustBody=!0;function i(e,t){return e.w(' - <span class="tc-ctl-attrib-cmd">').h("i18n",t,{},{$key:"others"}).w("...</span>")}i.__dustBody=!0;function n(e,t){return e.x(t.getPath(!1,["otherData",t.get(["$idx"],!1),"site"]),t,{else:a,block:l},{}).h("sep",t,{block:s},{})}n.__dustBody=!0;function a(e,t){return e.w("<span>&copy; ").f(t.getPath(!1,["otherData",t.get(["$idx"],!1),"name"]),t,"h").w("</span>")}a.__dustBody=!0;function l(e,t){return e.w('<span>&copy; <a href="').f(t.getPath(!1,["otherData",t.get(["$idx"],!1),"site"]),t,"h").w('" target="_blank">').f(t.getPath(!1,["otherData",t.get(["$idx"],!1),"name"]),t,"h").w("</a></span>")}l.__dustBody=!0;function s(e,t){return e.w(", ")}s.__dustBody=!0;return t};e.register=function(e){var t=this;TC.Control.prototype.register.call(t,e);t.apiAttribution=t.map.options.attribution||t.apiAttribution;var o=function(e){if(e){var o=e.getAttribution();if(o)if(/IDENA/.test(o.name))t.mainDataAttribution={name:"IDENA",site:"http://idena.navarra.es/"};else{for(var r=!1,i=0;i<t.dataAttributions.length;i++)if(o.name===t.dataAttributions[i].name){r=!0;break}r||t.dataAttributions.push(o)}}},r=function(e){if(e){if(!(e instanceof TC.Layer)||function(){if(e.map.workLayers.length>0){for(var t=e.map.workLayers.slice().reverse(),o=0;o<t.length;o++)if(t[o].url==e.url&&t[o].getVisibility())return!1;return!0}return!0}()){var o=e.getAttribution();if(o){var r=t.dataAttributions.reduce(function(e,t,r){return t.name===o.name?r:e},-1);r>-1&&t.dataAttributions.splice(r,1)}}}};t.render();e.on(TC.Consts.event.LAYERADD,function(e){if(e.layer.wrap.getAttribution){o(e.layer.wrap);t.render()}});e.on(TC.Consts.event.LAYERREMOVE,function(e){if(e.layer.wrap.getAttribution){r(e.layer.wrap);t.render()}});e.on(TC.Consts.event.TERRAINPROVIDERADD,function(e){if(e.terrainProvider.getAttribution){o(e.terrainProvider);t.render()}});e.on(TC.Consts.event.TERRAINPROVIDERREMOVE,function(e){if(e.terrainProvider.getAttribution){r(e.terrainProvider);t.render()}});e.on(TC.Consts.event.LAYERVISIBILITY,function(e){if(e.layer.wrap.getAttribution){e.layer.getVisibility()?o(e.layer.wrap):r(e.layer.wrap);t.render()}})};e.render=function(e){var t=this;t.renderData({api:t.apiAttribution,mainData:t.mainDataAttribution,otherData:t.dataAttributions},function(){t._$div.find("."+t.CLASS+"-cmd").on(TC.Consts.event.CLICK,function(){t._$div.find("."+t.CLASS+"-other").toggleClass(TC.Consts.classes.COLLAPSED)});$.isFunction(e)&&e()})}}();TC.control=TC.control||{};TC.control.MapContents||TC.syncLoadJS(TC.apiLocation+"TC/control/MapContents");!function(){TC.control.BasemapSelector=function(){var e=this;TC.control.MapContents.apply(e,arguments);e._$dialogDiv=$(TC.Util.getDiv(e.options.dialogDiv));e.options.dialogDiv||e._$dialogDiv.appendTo("body");e._$dialogDiv.on(TC.Consts.event.CLICK,"button:not(.tc-modal-close)",function(o){TC.Util.closeModal();const r=$(o.target),i=r.data(t.PROJCODE),n=e._$dialogDiv.find("."+e.CLASS+"-crs-dialog");n.addClass(TC.Consts.classes.HIDDEN);const a=n.data(t.LAYER);if(a)if(i)TC.loadProjDef({crs:i,callback:function(){e.map.setProjection({crs:i,baseLayer:a})}});else{r.data(t.FALLBACK_LAYER)&&e.map.setBaseLayer(a)}})};TC.inherit(TC.control.BasemapSelector,TC.control.MapContents);var e=TC.control.BasemapSelector.prototype;e.CLASS="tc-ctl-bms";var t={LAYER:"tcLayer",FALLBACK_LAYER:"tcFallbackLayer",PROJCODE:"tcProjCode"};e.template={};if(TC.isDebug){e.template[e.CLASS]=TC.apiLocation+"TC/templates/BasemapSelector.html";e.template[e.CLASS+"-node"]=TC.apiLocation+"TC/templates/BasemapSelectorNode.html";e.template[e.CLASS+"-dialog"]=TC.apiLocation+"TC/templates/BasemapSelectorDialog.html"}else{e.template[e.CLASS]=function(){dust.register(e.CLASS,t);function t(e,t){return e.w("<h2>").h("i18n",t,{},{$key:"backgroundMaps"}).w('</h2><div class="tc-ctl-bms-tree"><form><ul class="tc-ctl-bms-branch">').s(t.get(["baseLayers"],!1),t,{block:o},{}).s(t.get(["dialogMore"],!1),t,{block:r},{}).w("</ul></form></div>")}t.__dustBody=!0;function o(e,t){return e.p("tc-ctl-bms-node",t,t.rebase(t.getPath(!0,[])),{})}o.__dustBody=!0;function r(e,t){return e.w('<li class="tc-ctl-bms-node"><label class="tc-ctl-bms-more-node" title="').h("i18n",t,{},{$key:"moreBackgroundMaps"}).w('"><input type="radio" name="bms" value="moreLayers" /><span></span></label></li>')}r.__dustBody=!0;return t};e.template[e.CLASS+"-node"]=function(){dust.register(e.CLASS+"-node",t);function t(e,t){return e.w('<li class="tc-ctl-bms-node" data-tc-layer-name="').f(t.get(["name"],!1),t,"h").w('" data-tc-layer-uid="').f(t.get(["uid"],!1),t,"h").w('" ><label').x(t.get(["legend"],!1),t,{block:o},{}).x(t.get(["thumbnail"],!1),t,{block:r},{}).w('><input type="radio" name="bms" value="').f(t.get(["name"],!1),t,"h").w('"').x(t.get(["mustReproject"],!1),t,{block:i},{}).w(" /><span>").f(t.get(["title"],!1),t,"h").w("</span></label></li>")}t.__dustBody=!0;function o(e,t){return e.w(' style="background-image: url(').f(t.getPath(!1,["legend","src"]),t,"h").w(')"')}o.__dustBody=!0;function r(e,t){return e.w(' style="background-image: url(').f(t.get(["thumbnail"],!1),t,"h").w(')"')}r.__dustBody=!0;function i(e,t){return e.w(' class="tc-disabled"')}i.__dustBody=!0;return t};e.template[e.CLASS+"-dialog"]=function(){dust.register(e.CLASS+"-dialog",t);function t(e,t){return e.w('<div class="tc-ctl-bms-more-dialog tc-modal tc-hidden"><div class="tc-modal-background tc-modal-close"></div><div class="tc-modal-window"><div class="tc-modal-header"><h3>').h("i18n",t,{},{$key:"backgroundMaps"}).w('</h3><div class="tc-ctl-popup-close tc-modal-close"></div></div><div class="tc-modal-body"></div><div class="tc-modal-footer"><button type="button" class="tc-button tc-modal-close">').h("i18n",t,{},{$key:"close"}).w('</button></div></div></div><div class="tc-ctl-bms-crs-dialog tc-modal tc-hidden"><div class="tc-modal-background tc-modal-close"></div><div class="tc-modal-window"><div class="tc-modal-header"><h3>').h("i18n",t,{},{$key:"baseLayerNotCompatible"}).w('</h3><div class="tc-ctl-popup-close tc-modal-close"></div></div><div class="tc-modal-body"><p>').h("i18n",t,{},{$key:"baseLayerNotCompatible.instructions|h"}).w('</p><ul class="tc-ctl-bms-crs-list tc-crs-list"></ul></div><div class="tc-modal-footer"><button type="button" class="tc-button tc-modal-close">').h("i18n",t,{},{$key:"close"}).w("</button></div></div></div>")}t.__dustBody=!0;return t}}const o=function(e,o){const r=this;var i=!0,n=$(e.target),a=n.closest("li").data(t.LAYER);r.options.dialogMore&&n.closest("."+r.CLASS+"-more-dialog").length>0&&r._$div.find("input[type=radio]").each(function(e,o){var r=$(o).closest("li").data(t.LAYER);if(r)switch(!0){case r.id===a.id:a=r;n=$(o);return!1}});if(a!=r.map.getBaseLayer())if(a.mustReproject){if(r.map.on3DView){if(!a.getFallbackLayer()){r._$currentSelection.prop("checked",!0);e.stopPropagation();return}if(a.getFallbackLayer()){const e=a.getFallbackLayer();e&&e._capabilitiesPromise.then(function(){e.isCompatible(r.map.getCRS())&&r.map.setBaseLayer(a)});i=!0}}else{r._$currentSelection&&r._$currentSelection.prop("checked",!0);const e={layer:a},t=a.getFallbackLayer();t?t._capabilitiesPromise.then(function(){t.isCompatible(r.map.getCRS())&&(e.fallbackLayer=t);r.showProjectionChangeDialog(e)}):r.showProjectionChangeDialog(e)}i=!1}else{(a.type===TC.Consts.layerType.WMS||a.type===TC.Consts.layerType.WMTS&&a.getProjection()!==r.map.crs)&&a.setProjection({crs:r.map.crs});r.map.setBaseLayer(a)}this._$currentSelection&&this._$currentSelection.prop("checked",!0);o&&o(i)};e.register=function(e){var t=this;TC.control.MapContents.prototype.register.call(t,e);t.options.dialogMore&&e.on(TC.Consts.event.VIEWCHANGE,function(){t._getMoreBaseLayers()});e.on(TC.Consts.event.BASELAYERCHANGE+" "+TC.Consts.event.PROJECTIONCHANGE+" "+TC.Consts.event.VIEWCHANGE,function(e){t.update(t._$div,e.layer)});t._$div.on("change","input[type=radio]",function(e){const t=this;"moreLayers"==$(e.target).val()?t.showMoreLayersDialog():o.call(t,e);e.stopPropagation()}.bind(t))};e.render=function(e){var t=this;TC.control.MapContents.prototype.render.call(t,e,t.options);t.getRenderedHtml(t.CLASS+"-dialog",null,function(e){t._$dialogDiv.html(e);if(t.options.dialogMore){t._$dialogDiv.find("."+t.CLASS+"-more-dialog").on("change","input[type=radio]",function(e){o.call(this,e,function(e){e&&TC.Util.closeModal()});e.stopPropagation()}.bind(t))}})};e.update=function(e,o){var r=this;(e=e||r._$div).find("ul."+r.CLASS+"-branch").children("li").each(function(e,i){var n=$(i),a=n.data(t.LAYER);if(a){var l=o||r.map.baseLayer,s=n.find("input[type=radio]").first(),p=l&&(l===a||l.id===a.id||a.getFallbackLayer&&(l===a.getFallbackLayer()||a.getFallbackLayer()&&l.id===a.getFallbackLayer().id));if(r.map.on3DView&&a.mustReproject&&a.fallbackLayer&&a.getFallbackLayer)a.getFallbackLayer().getCapabilitiesPromise().then(function(){var e=!a.getFallbackLayer().isCompatible(r.map.getCRS());s.prop("checked",p).toggleClass(TC.Consts.classes.DISABLED,e||!1);n.attr("title",e?r.map.on3DView?r.getLocaleString("notAvailableTo3D"):r.getLocaleString("reprojectionNeeded"):null)});else{s.prop("checked",p).toggleClass(TC.Consts.classes.DISABLED,a.mustReproject||!1);n.attr("title",a.mustReproject?r.map.on3DView?r.getLocaleString("notAvailableTo3D"):r.getLocaleString("reprojectionNeeded"):null)}p&&(r._$currentSelection=s)}});r.updateScale()};e.updateLayerTree=function(e){var o=this;if(e.isBase&&!e.options.stealth){TC.control.MapContents.prototype.updateLayerTree.call(o,e);var r=o.CLASS+"-node";TC.loadJSInOrder(!window.dust,TC.url.templating,function(){dust.render(r,o.layerTrees[e.id],function(r,i){var n=$(i),a=n.data("tcLayerUid"),l=o._$div.find("."+o.CLASS+"-branch"),s=l.find('li[data-tc-layer-uid="'+a+'"]');if(1===s.length)s.html(n.html());else{n.data(t.LAYER,e);var p=o.map.baseLayers.filter(function(e){return!e.stealth}).map(function(e){return e.id}).indexOf(e.id);if(p<0)l.append(n);else{p>=l.find("li").length?l.append(n):n.insertBefore(l.find("li").get(p))}}r&&TC.error(r)});o.update()})}};e.updateLayerOrder=function(e,t,o){};e.removeLayer=function(e){if(e.isBase){this._$div.find("."+this.CLASS+"-branch").children("li").each(function(o,r){var i=$(r);if(i.data(t.LAYER)===e){i.remove();return!1}})}};e.showProjectionChangeDialog=function(e){const o=this,r=(e=e||{}).layer,i=o._$dialogDiv.find("."+o.CLASS+"-crs-dialog"),n=i.find(".tc-modal-body").addClass(TC.Consts.classes.LOADING);i.removeClass(TC.Consts.classes.HIDDEN);i.data(t.LAYER,r);const a=i.find("ul."+o.CLASS+"-crs-list").empty();o.map.loadProjections({crsList:o.map.getCompatibleCRS({layers:o.map.workLayers.concat(r)}),orderBy:"name"}).then(function(r){r.forEach(function(e){a.append($("<li>").append($("<button>").html(o.getLocaleString("changeMapToCrs",{crs:e.name+" ("+e.code+")"})).data(t.PROJCODE,e.code)))});e.fallbackLayer&&a.append($("<li>").append($("<button>").html(o.getLocaleString("reprojectOnTheFly")).data(t.FALLBACK_LAYER,e.fallbackLayer)));n.removeClass(TC.Consts.classes.LOADING)});i.find("."+o.CLASS+"-name").html(r.title||r.name);TC.Util.showModal(i)};e.showMoreLayersDialog=function(){const e=this,o=e._$dialogDiv.find("."+e.CLASS+"-more-dialog");e.map.on3DView?o.addClass(TC.Consts.classes.THREED):o.hasClass(TC.Consts.classes.THREED)&&o.removeClass(TC.Consts.classes.THREED);o.find(".tc-modal-body").empty();const r=o.find(".tc-modal-body").addClass(TC.Consts.classes.LOADING);o.removeClass(TC.Consts.classes.HIDDEN);TC.Util.showModal(o,{closeCallback:function(){this._$currentSelection.prop("checked",!0);this.update()}.bind(e)});o.find(".tc-modal-window").hasClass(e.CLASS+"-more-dialog")||o.find(".tc-modal-window").addClass(e.CLASS+"-more-dialog");e._getMoreBaseLayers().then(function(){e.getRenderedHtml(e.CLASS,{baseLayers:e._moreBaseLayers},function(o){r.html(o);r.removeClass(TC.Consts.classes.LOADING);r.find("li").each(function(o,r){$(r).data(t.LAYER,e._moreBaseLayers[o])});e.update(r)})})};const r=function(e){var t=new $.Deferred,o=new $.Deferred;$.when.apply(this,[e.getCapabilitiesPromise(),e.getFallbackLayer()?e.getFallbackLayer().getCapabilitiesPromise():o.resolve()]).then(function(){t.resolve()});return t};e._getMoreBaseLayers=function(){const e=this;if(e._moreBaseLayers||e._moreBaseLayersPromise){if(e._moreBaseLayers){$.when.apply(this,e._moreBaseLayers.filter(function(e){return e.type===TC.Consts.layerType.WMS||e.type===TC.Consts.layerType.WMTS}).map(function(t){return e.map.on3DView?r(t):t.getCapabilitiesPromise()})).then(function(){e._moreBaseLayers=e._moreBaseLayers.map(function(t){if(t.type===TC.Consts.layerType.WMTS){var o=t.wrap.getCompatibleMatrixSets(e.map.getCRS())[0];t.mustReproject=!o}else t.type===TC.Consts.layerType.WMS&&(t.mustReproject=!t.isCompatible(e.map.getCRS()));if(e.map.on3DView&&t.mustReproject&&t.getFallbackLayer&&t.getFallbackLayer()){t.mustReproject=!t.getFallbackLayer().isCompatible(e.map.getCRS());return t}return t})});e._moreBaseLayersPromise.resolve(e._moreBaseLayers)}}else{e._moreBaseLayersPromise=new $.Deferred;var t=TC.Cfg.availableBaseLayers.filter(function(e){return-1==TC.Cfg.availableBaseLayers.filter(function(e){return e.fallbackLayer}).map(function(e){return e.fallbackLayer}).indexOf(e.id)});$.when.apply(this,t.map(function(e){return e.type===TC.Consts.layerType.WMS||e.type===TC.Consts.layerType.WMTS?new TC.layer.Raster(e):e.type==TC.Consts.layerType.VECTOR?new TC.layer.Vector(e):void 0})).then(function(){var t=Array.prototype.slice.call(arguments);$.when.apply(this,t.filter(function(e){return e.type===TC.Consts.layerType.WMS||e.type===TC.Consts.layerType.WMTS}).map(function(t){return e.map.on3DView?r(t):t.getCapabilitiesPromise()})).then(function(){e._moreBaseLayers=t.map(function(t){t.map=e.map;t.isBase=t.options.isBase=!0;if(t.type===TC.Consts.layerType.WMTS){var o=t.wrap.getCompatibleMatrixSets(e.map.getCRS())[0];t.mustReproject=!o}else t.type===TC.Consts.layerType.WMS&&(t.mustReproject=!t.isCompatible(e.map.getCRS()));if(e.map.on3DView&&t.mustReproject&&t.getFallbackLayer&&t.getFallbackLayer()){t.mustReproject=!t.getFallbackLayer().isCompatible(e.map.getCRS());return t}return t});e._moreBaseLayersPromise.resolve(e._moreBaseLayers)})})}return e._moreBaseLayersPromise.promise()}}();TC.control=TC.control||{};TC.control.SWCacheClient||TC.syncLoadJS(TC.apiLocation+"TC/control/SWCacheClient");!function(){TC.Consts.classes.CONNECTION_OFFLINE=TC.Consts.classes.CONNECTION_OFFLINE||"tc-conn-offline";TC.Consts.classes.CONNECTION_WIFI=TC.Consts.classes.CONNECTION_WIFI||"tc-conn-wifi";TC.Consts.classes.CONNECTION_MOBILE=TC.Consts.classes.CONNECTION_MOBILE||"tc-conn-mobile";TC.Consts.classes.OFFLINE=TC.Consts.classes.OFFLINE||"tc-offline";var e=window.applicationCache;TC._appCacheBuilders||(TC._appCacheBuilders=[]);TC._appCacheUpdater||(TC._appCacheUpdater=function(e,t){TC.Util.getQueryStringParams(t);for(var o=0,r=TC._appCacheBuilders.length;o<r;o++){var i=TC._appCacheBuilders[o];switch(e.type){case"cached":i.$events.trigger($.Event(TC.Consts.event.MAPCACHEDOWNLOAD,{url:t}));break;case"obsolete":i.$events.trigger($.Event(TC.Consts.event.MAPCACHEDELETE,{url:t}));break;case"checking":break;case"progress":i.$events.trigger($.Event(TC.Consts.event.MAPCACHEPROGRESS,{url:t,loaded:e.loaded,total:e.total}));break;case"error":i.$events.trigger($.Event(TC.Consts.event.MAPCACHEERROR,{url:t,reason:e.reason,status:e.status}));break;case"noupdate":case"updateready":i.$events.trigger($.Event(TC.Consts.event.MAPCACHEERROR,{url:t,reason:"already_exists",status:e.status}))}}});var t,o=function(){var e=$.Deferred(),t=$("html").attr("manifest");t?$.ajax({url:t,type:"GET",dataType:"text"}).done(function(t){TC.loadJS(!window.hex_md5,[TC.apiLocation+TC.Consts.url.HASH],function(){var o=hex_md5(t),r=t.indexOf("NETWORK:");r>=0&&(t=t.substr(0,r));(r=t.indexOf("FALLBACK:"))>=0&&(t=t.substr(0,r));(r=t.indexOf("SETTINGS:"))>=0&&(t=t.substr(0,r));var i=$.grep(t.split(/[\n\r]/),function(e){return e.length>0&&0!==e.indexOf("#")&&"CACHE:"!==e});i.shift();e.resolve({hash:o,urls:i})})}).fail(function(){e.reject()}):e.reject();return e};if(e){const o=(t=window.parent!==window&&document.referrer&&TC.Util.isSameOrigin(document.referrer)&&parent.TC&&parent.TC._appCacheUpdater,function(e){t&&parent.TC._appCacheUpdater(e,location.href)});e.addEventListener("cached",o,!1);e.addEventListener("error",o,!1);e.addEventListener("noupdate",o,!1);e.addEventListener("obsolete",o,!1);e.addEventListener("progress",o,!1);e.addEventListener("updateready",o,!1)}TC.control.CacheBuilder=function(){var e=this;TC.control.SWCacheClient.apply(this,arguments);var t=e._classSelector="."+e.CLASS;e._selectors={DRAW:t+"-draw",DRAWING:t+"-drawing",PROGRESS:t+"-progress",NEW:t+"-new",LIST:t+"-list",LISTITEM:t+"-list > li",DELBTN:t+"-btn-del",OKBTN:t+"-btn-ok",NEWBTN:t+"-btn-new",SAVEBTN:".tc-btn-save",CANCELBTN:".tc-btn-cancel",EDITBTN:".tc-btn-edit",VIEWBTN:".tc-btn-view",DELETEBTN:".tc-btn-delete",TILECOUNT:t+"-tile-count",NAMETB:t+"-txt-name",TEXTBOX:"input.tc-textbox",EXIT:t+"-link-exit",OFFPANEL:t+"-off-panel",BLLIST:t+"-bl-list",BLLISTITEM:t+"-bl-list > li",BLLISTTEXT:t+"-bl-panel-txt",RNGMAXRES:t+"-rng-maxres",SEARCH:t+"-map-available-srch",EMPTYLIST:t+"-map-available-empty",OFFLINEHIDDEN:"[data-no-cb]"};e.storedMaps=[];TC._appCacheBuilders.push(e);try{if(window.localStorage){for(var o=0,r=localStorage.length;o<r;o++){var n=localStorage.key(o);if(0===n.indexOf(e.LOCAL_STORAGE_KEY_PREFIX)&&n!==e.LOCAL_STORAGE_KEY_PREFIX+e.ROOT_CACHE_NAME+".hash"){var a=localStorage.getItem(n).split(" "),l=i(a.shift()),s={name:a.join(" "),extent:l,url:decodeURIComponent(n.substr(e.LOCAL_STORAGE_KEY_PREFIX.length))};e.storedMaps.push(s)}}e.storedMaps.sort(function(e,t){return e.name>t.name?1:e.name<t.name?-1:0})}}catch(t){TC.error(e.getLocaleString("couldNotAccessLocalStorage"))}var p=$.extend({},r>1?arguments[1]:arguments[0]);e._$dialogDiv=$(TC.Util.getDiv(p.dialogDiv));p.dialogDiv||e._$dialogDiv.appendTo("body");e.mapIsOffline=location.pathname.indexOf("/"+e.CACHE_REQUEST_PATH)===location.pathname.length-e.CACHE_REQUEST_PATH.length-1;e.mapIsOffline&&$(e._selectors.OFFLINEHIDDEN).addClass(TC.Consts.classes.HIDDEN);TC.Control.apply(e,arguments);e.wrap=new TC.wrap.control.CacheBuilder(e);e.isDownloading=!1;e.baseLayers=[];e.options.avgTileSize=e.options.avgTileSize||TC.Cfg.avgTileSize;e.requestSchemas=[];e.minResolution=0;e.currentMap=null;e._loadedCount=0;var c=history.pushState;history.pushState=function(t){var o;o=c.apply(history,arguments);if(e._$offlinePanelDiv){var r=location.pathname.replace("/"+e.CACHE_REQUEST_PATH,"/"),i=TC.Util.getQueryStringParams();delete i[e.MAP_DEFINITION_PARAM_NAME];delete i[e.MAP_EXTENT_PARAM_NAME];delete i[e.SERVICE_WORKER_FLAG];var n=$.param(i);n.length&&(n="?"+n);var a=r+n+location.hash;e._$offlinePanelDiv.find(e._selectors.EXIT).attr("href",a)}return o};var u=navigator.connection||navigator.mozConnection||navigator.webkitConnection||{},g=function(){if(e._$offlinePanelDiv){var t=e._$offlinePanelDiv.find(e._selectors.OFFPANEL);t.removeClass(TC.Consts.classes.CONNECTION_OFFLINE).removeClass(TC.Consts.classes.CONNECTION_MOBILE).removeClass(TC.Consts.classes.CONNECTION_WIFI);switch(u.type){case 1:case 2:case void 0:t.addClass(TC.Consts.classes.CONNECTION_WIFI);break;default:t.addClass(TC.Consts.classes.CONNECTION_MOBILE)}}};u.addEventListener&&u.addEventListener("typechange",g);window.addEventListener("online",g);window.addEventListener("offline",function(){e._$offlinePanelDiv&&e._$offlinePanelDiv.find(e._selectors.OFFPANEL).addClass(TC.Consts.classes.CONNECTION_OFFLINE).removeClass(TC.Consts.classes.CONNECTION_MOBILE).removeClass(TC.Consts.classes.CONNECTION_WIFI)})};TC.inherit(TC.control.CacheBuilder,TC.control.SWCacheClient);var r=TC.control.CacheBuilder.prototype;r.CLASS="tc-ctl-cbuild";r.MAP_DEFINITION_PARAM_NAME="map-def";r.MAP_EXTENT_PARAM_NAME="map-extent";r.LOCAL_STORAGE_KEY_PREFIX="TC.offline.map.";r.ROOT_CACHE_NAME="root";r.COOKIE_KEY_PREFIX="TC.offline.map.";r.CACHE_REQUEST_PATH="offline";r.SERVICE_WORKER_FLAG="sw";r._states={READY:"ready",EDIT:"editing",DOWNLOADING:"downloading",DELETING:"deleting"};r._actions={CREATE:"create",DELETE:"delete"};r.offlineControls=["attribution","basemapSelector","cacheBuilder","click","coordinates","draw","edit","geolocation","loadingIndicator","measure","navBar","popup","print","scale","scaleBar","scaleSelector","state","fullScreen"];TC.Consts.event.MAPCACHEDOWNLOAD=TC.Consts.event.MAPCACHEDOWNLOAD||"mapcachedownload.tc";TC.Consts.event.MAPCACHEDELETE=TC.Consts.event.MAPCACHEDELETE||"mapcachedelete.tc";TC.Consts.event.MAPCACHEPROGRESS=TC.Consts.event.MAPCACHEPROGRESS||"mapcacheprogress.tc";TC.Consts.event.MAPCACHEERROR=TC.Consts.event.MAPCACHEERROR||"mapcacheerror.tc";r.template={};if(TC.isDebug){r.template[r.CLASS]=TC.apiLocation+"TC/templates/CacheBuilder.html";r.template[r.CLASS+"-map-node"]=TC.apiLocation+"TC/templates/CacheBuilderMapNode.html";r.template[r.CLASS+"-bl-node"]=TC.apiLocation+"TC/templates/CacheBuilderBaseLayerNode.html";r.template[r.CLASS+"-dialog"]=TC.apiLocation+"TC/templates/CacheBuilderDialog.html";r.template[r.CLASS+"-off-panel"]=TC.apiLocation+"TC/templates/CacheBuilderOfflinePanel.html"}else{r.template[r.CLASS]=function(){dust.register(r.CLASS,e);function e(e,r){return e.w("<h2>").h("i18n",r,{},{$key:"offlineMaps"}).w('</h2><div class="tc-ctl-cbuild-content"><div class="tc-ctl-cbuild-draw tc-hidden"></div><i class="tc-ctl-cbuild-map-search-icon"></i><input type="search" list="').f(r.get(["listId"],!1),r,"h").w('" class="tc-ctl-cbuild-map-available-srch tc-textbox" placeholder="').h("i18n",r,{},{$key:"cb.filter.plhr"}).w('"').x(r.get(["storedMaps"],!1),r,{else:t,block:o},{}).w(' maxlength="200" /> <ul id="').f(r.get(["listId"],!1),r,"h").w('" class="tc-ctl-cbuild-list"><li class="tc-ctl-cbuild-map-available-empty"').x(r.get(["storedMaps"],!1),r,{block:i},{}).w("><span>").h("i18n",r,{},{$key:"cb.noMaps"}).w('</span></li><li class="tc-ctl-cbuild-map-not" hidden><span>').h("i18n",r,{},{$key:"noMatches"}).w("</span></li>").s(r.get(["storedMaps"],!1),r,{block:n},{}).w('</ul><div class="tc-ctl-cbuild-new"><button class="tc-button tc-icon-button tc-ctl-cbuild-btn-new" disabled title="').h("i18n",r,{},{$key:"newofflinemap"}).w('">').h("i18n",r,{},{$key:"newOfflineMap"}).w('</button></div><div class="tc-ctl-cbuild-drawing tc-hidden"><div class="tc-ctl-cbuild-tile-cmd"><button class="tc-button tc-icon-button tc-ctl-cbuild-btn-cancel-draw" title="').h("i18n",r,{},{$key:"cancel"}).w('">').h("i18n",r,{},{$key:"cancel"}).w('</button></div></div><div class="tc-ctl-cbuild-progress tc-hidden"><p>').h("i18n",r,{},{$key:"cb.DownloadingMap|s"}).w(': <span class="tc-ctl-cbuild-progress-count"></span></p><div class="tc-ctl-cbuild-progress-bar"><div class="tc-ctl-cbuild-progress-ratio" style="width:0"></div></div><button class="tc-button tc-icon-button tc-ctl-cbuild-btn-cancel-dl" title="').h("i18n",r,{},{$key:"cancel"}).w('">').h("i18n",r,{},{$key:"cancel"}).w("</button></div></div>")}e.__dustBody=!0;function t(e,t){return e.w(" disabled")}t.__dustBody=!0;function o(e,t){return e}o.__dustBody=!0;function i(e,t){return e.w(" hidden")}i.__dustBody=!0;function n(e,t){return e.p("tc-ctl-cbuild-map-node",t,t.rebase(t.getPath(!0,[])),{})}n.__dustBody=!0;return e};r.template[r.CLASS+"-map-node"]=function(){dust.register(r.CLASS+"-map-node",e);function e(e,t){return e.w('<li data-extent="').f(t.get(["extent"],!1),t,"h").w('"><span><a href="').f(t.get(["url"],!1),t,"h").w('" title="').f(t.get(["name"],!1),t,"h").w('">').f(t.get(["name"],!1),t,"h").w('</a></span><input class="tc-textbox tc-hidden" type="text" value="').f(t.get(["name"],!1),t,"h").w('" /><button class="tc-btn-save tc-hidden" title="').h("i18n",t,{},{$key:"save"}).w('"></button><button class="tc-btn-cancel tc-hidden" title="').h("i18n",t,{},{$key:"cancel"}).w('"></button><button class="tc-btn-edit" title="').h("i18n",t,{},{$key:"editMapName"}).w('">').h("i18n",t,{},{$key:"editMapName"}).w('</button><button class="tc-btn-view" title="').h("i18n",t,{},{$key:"viewMapExtent"}).w('">').h("i18n",t,{},{$key:"viewMapExtent"}).w('</button><button class="tc-btn-delete" title="').h("i18n",t,{},{$key:"deleteMap"}).w('">').h("i18n",t,{},{$key:"deleteMap"}).w("</button></li>")}e.__dustBody=!0;return e};r.template[r.CLASS+"-bl-node"]=function(){dust.register(r.CLASS+"-bl-node",e);function e(e,t){return e.w('<li class="tc-ctl-cbuild-bl-node" data-tc-layer-uid="').f(t.get(["id"],!1),t,"h").w('"><label style="background-size: 100% 100%; background-image: url(').f(t.get(["thumbnail"],!1),t,"h").w(')"><input type="checkbox" name="cbbl" value="').f(t.get(["id"],!1),t,"h").w('" disabled><span>').f(t.get(["title"],!1),t,"h").w("</span></label></li>")}e.__dustBody=!0;return e};r.template[r.CLASS+"-dialog"]=function(){dust.register(r.CLASS+"-dialog",e);function e(e,t){return e.w('<div class="tc-ctl-cbuild-dialog tc-modal"><div class="tc-modal-background tc-modal-close"></div><div class="tc-modal-window"><div class="tc-modal-header"><h3>').h("i18n",t,{},{$key:"newOfflineMap"}).w('</h3><div class="tc-ctl-popup-close tc-modal-close"></div></div><div class="tc-modal-body"><input type="text" class="tc-ctl-cbuild-txt-name" placeholder="').h("i18n",t,{},{$key:"nameRequired"}).w('" required /><div class="tc-ctl-cbuild-bl-panel"><h4>').h("i18n",t,{},{$key:"availableOfflineMaps"}).w("</h4><p>").h("i18n",t,{},{$key:"selectAtLeastOne"}).w(':</p><ul class="tc-ctl-cbuild-bl-list"></ul></div><div class="tc-ctl-cbuild-res-panel"><h4>').h("i18n",t,{},{$key:"maxRes"}).w('</h4><div class="tc-ctl-cbuild-res"></div><input type="range" class="tc-ctl-cbuild-rng-maxres" disabled value="0" title="').h("i18n",t,{},{$key:"maxRes"}).w('"></div><div class="tc-ctl-cbuild-tile-count"></div></div><div class="tc-modal-footer"><button class="tc-button tc-modal-close tc-ctl-cbuild-btn-ok" disabled>').h("i18n",t,{},{$key:"ok"}).w('</button><button type="button" class="tc-button tc-modal-close tc-ctl-cbuild-btn-cancel">').h("i18n",t,{},{$key:"cancel"}).w("</button></div></div></div>")}e.__dustBody=!0;return e};r.template[r.CLASS+"-off-panel"]=function(){dust.register(r.CLASS+"-off-panel",e);function e(e,t){return e.w('<div class="tc-ctl-cbuild-off-panel tc-conn-wifi"><span>').h("i18n",t,{},{$key:"offlineMap"}).w('</span> <a href="" class="tc-ctl-cbuild-link-exit" title="').h("i18n",t,{},{$key:"returnToOnlineMaps"}).w('"><span>').h("i18n",t,{},{$key:"returnToOnlineMaps"}).w("</span></a></div>")}e.__dustBody=!0;return e}}var i=function(e){return $.map(decodeURIComponent(e).split(","),function(e){return parseFloat(e)})},n=function(e){e._state=e._states.READY;e.showDownloadProgress(0,1);e._$div.find(e._selectors.DRAWING).addClass(TC.Consts.classes.HIDDEN);e._$div.find(e._selectors.PROGRESS).addClass(TC.Consts.classes.HIDDEN);e._$div.find(e._selectors.NEW).removeClass(TC.Consts.classes.HIDDEN);e._$div.find(e._selectors.LISTITEM).removeClass(TC.Consts.classes.DISABLED);e._$div.find(e._selectors.DELBTN).prop("disabled",!1);e._$dialogDiv.find(e._selectors.OKBTN).prop("disabled",!0);e._$div.find(e._selectors.NEWBTN).prop("disabled",!1);e._$dialogDiv.find(e._selectors.TILECOUNT).html("");e.extent=null;e._loadedCount=0;e.boxDraw&&e.boxDraw.cancel()},a=function(e,t){t.find("span").first().removeClass(TC.Consts.classes.HIDDEN);t.find(e._selectors.TEXTBOX).addClass(TC.Consts.classes.HIDDEN);t.find(e._selectors.SAVEBTN).addClass(TC.Consts.classes.HIDDEN);t.find(e._selectors.CANCELBTN).addClass(TC.Consts.classes.HIDDEN);t.find(e._selectors.EDITBTN).removeClass(TC.Consts.classes.HIDDEN);t.find(e._selectors.VIEWBTN).removeClass(TC.Consts.classes.HIDDEN);t.find(e._selectors.DELETEBTN).removeClass(TC.Consts.classes.HIDDEN)},l=function(e){return e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,".")},s=function(e,t){var o,r,i,n=t||{},a=e._$dialogDiv.find(e._classSelector+"-res"),l=e._$dialogDiv.find(e._selectors.RNGMAXRES),s=e.getResolutions();if(s.length){if(e.minResolution){if(void 0===n.rangeValue)for(var p=0,c=s.length;p<c;p++)if(e.minResolution>=s[p]){l.val(p);break}}else void 0===n.rangeValue&&l.val(Math.floor(s.length/2));r=parseInt(l.attr("max",s.length-1).val());var u=Math.floor(1e3*new Number(s[r]))/1e3;o=e.getLocaleString("metersPerPixel",{value:u.toLocaleString((e.map?e.map.options.locale:TC.Cfg.locale).replace("_","-"))});i=100*(r+1)/(s.length+1)+"%";l.prop("disabled",!1);e.minResolution=s[l.val()]}else{r=0;o="";l.val(0);i="0";e.minResolution=0;l.prop("disabled",!0)}a.css("left",i).html(o)},p=function(e){e._$dialogDiv.find(e._classSelector+"-bl-node input[type=checkbox]").each(function(t,o){var r=$(o);if(r.prop("checked")){var i=e.requestSchemas.filter(function(e){return e.layerId===r.val()})[0];if(i){var n=function(e,t){for(var o=null,r=0,i=e.tileMatrixLimits.length;r<i&&!((o=e.tileMatrixLimits[r]).res<=t);r++);return o}(i,e.minResolution);if(n){var a=i.url;if(a.indexOf("{TileMatrix}")<0){var l=a.indexOf("?");l>=0&&(a=a.substr(0,l));for(var s=0,p=e.baseLayers.length;s<p;s++){var c=e.baseLayers[s];if(c.id===i.layerId){a=a+"?layer="+c.layerNames+"&style=default&tilematrixset="+c.matrixSet+"&Service=WMTS&Request=GetTile&Version=1.0.0&Format="+c.format+"&TileMatrix={TileMatrix}&TileRow={TileRow}&TileCol={TileCol}";break}}}r.parent("label").css("background-size","auto").css("background-position","left bottom").css("background-image","url("+a.replace("{TileMatrix}",n.mId).replace("{TileRow}",n.rt).replace("{TileCol}",n.cl)+")")}}}})},c=function(e,t){return t<1?e.getLocaleString("lessThan1Mb"):e.getLocaleString("approxXMb",{quantity:l(t)})},u=function(e){var t="";e.tileCount=0;for(var o=0,r=e.requestSchemas.length;o<r;o++)for(var i=e.requestSchemas[o],n=0,a=i.tileMatrixLimits.length;n<a;n++){var s=i.tileMatrixLimits[n];e.tileCount+=(s.cr-s.cl+1)*(s.rb-s.rt+1);if(s.res<e.minResolution)break}if(e.tileCount){e.estimatedMapSize=Math.round(e.tileCount*e.options.avgTileSize/1048576);t=e.getLocaleString("xTiles",{quantity:l(e.tileCount)})+" ("+c(e,e.estimatedMapSize)+")"}e._$dialogDiv.find(e._selectors.TILECOUNT).html(t)},g=function(e,t){var o=t.indexOf("#");o>=0&&(t=t.substr(0,o));return e._$div.find(e._selectors.LISTITEM).filter(function(e,o){return $(o).find("a").first().attr("href")===t})},d=function(e,t){$("<iframe>").css("display","none").attr("src",t).appendTo(e._$div)},h=function(e,t){e._$div.find('iframe[src="'+t+'"]').remove()},f=function(e,t){var o=!1;if(window.localStorage){localStorage.setItem(e.LOCAL_STORAGE_KEY_PREFIX+encodeURIComponent(t.url),t.extent+" "+t.name);o=!0}return o},y=function(e,t){var o=e.findStoredMap({url:t});if(o){(function(e,t){var o=!1;if(window.localStorage){localStorage.removeItem(e.LOCAL_STORAGE_KEY_PREFIX+encodeURIComponent(t));o=!0}return o})(e,t)&&function(e,t){return e._$div.find(e._selectors.LISTITEM).filter(function(e,o){return $(o).find("a").first().html()===t})}(e,o.name).remove();var r=$.inArray(o,e.storedMaps);e.storedMaps.splice(r,1);if(!e.storedMaps.length){e._$div.find(e._selectors.SEARCH).prop("disabled",!0);e._$div.find(e._selectors.EMPTYLIST).removeAttr("hidden")}return o.name}return null},v=function(e){e._$dialogDiv.find(e._selectors.OKBTN).prop("disabled",!e.extent||0===e._$dialogDiv.find(e._selectors.NAMETB).val().length||e._$dialogDiv.find(e._selectors.RNGMAXRES).prop("disabled"))};r.render=function(e){var t=this,r={storedMaps:t.storedMaps,listId:t.CLASS+"-list-"+TC.getUID()};t.getRenderedHtml(t.CLASS+"-dialog",null,function(e){t._$dialogDiv.html(e);t._$dialogDiv.find(t._selectors.NAMETB).on(TC.Consts.event.CLICK,function(e){e.preventDefault();this.selectionStart=0;this.selectionEnd=this.value.length;this.focus()})}).then(function(){t.renderData(r,function(){t._$dialogDiv.find(t._selectors.OKBTN).on(TC.Consts.event.CLICK,function(){var e={mapName:t._$dialogDiv.find(t._selectors.NAMETB).val()};if(t.findStoredMap({name:e.mapName}))TC.alert(t.getLocaleString("cb.mapNameAlreadyExists.error",e));else{var r=function(){t._$div.find(t._classSelector+"-name").html(e.mapName);t.map.toast(t.getLocaleString("downloadingMap",{mapName:e.mapName}));!function(e){e._state=e._states.DOWNLOADING;TC.Util.closeModal();e.showDownloadProgress(0,1);e._$div.find(e._selectors.NEW).addClass(TC.Consts.classes.HIDDEN);e._$div.find(e._selectors.DRAWING).addClass(TC.Consts.classes.HIDDEN);e._$div.find(e._selectors.PROGRESS).removeClass(TC.Consts.classes.HIDDEN);e._$dialogDiv.find(e._selectors.OKBTN).prop("disabled",!0);e._$div.find(e._selectors.NEWBTN).prop("disabled",!0);e.layer.clearFeatures();e.boxDraw.cancel()}(t);t.requestCache(e)},i=navigator.temporaryStorage||navigator.webkitTemporaryStorage||{};if(i.queryUsageAndQuota)i.queryUsageAndQuota(function(o,i){var n=(i-o)/1048576;t.estimatedMapSize<n?r():TC.confirm(t.getLocaleString("cb.mapCreation.warning.reasonSize",{mapName:e.mapName,mapSize:c(t,t.estimatedMapSize),availableStorage:c(t,Math.round(n))}),r)},function(e){TC.error(e)});else{var n=TC.Util.detectIE();if(n){var a=n<12?1e3:2e3,s=0,p=function(){var o=t.tileCount+s;o>a?TC.confirm(t.getLocaleString("cb.mapCreation.warning.reasonCount",{mapName:e.mapName,resourceCount:l(o),maxResourceCount:l(a)}),r):r()};o().done(function(e){s=e.urls.length;p()}).fail(p)}else r()}}});t._$dialogDiv.find(t._selectors.NAMETB).on("input",function(){v(t)});t._$div.find(t._selectors.NEWBTN).on(TC.Consts.event.CLICK,function(){!function(e){e._state=e._states.EDITING;e.showDownloadProgress(0,1);e._$div.find(e._selectors.NEW).addClass(TC.Consts.classes.HIDDEN);e._$div.find(e._selectors.PROGRESS).addClass(TC.Consts.classes.HIDDEN);e._$div.find(e._selectors.DRAWING).removeClass(TC.Consts.classes.HIDDEN);e.map.toast(e.getLocaleString("clickOnDownloadAreaFirstCorner"),{type:TC.Consts.msgType.INFO});e._$dialogDiv.find(e._selectors.OKBTN).prop("disabled",!0);e._$div.find(e._selectors.NEWBTN).prop("disabled",!0);e._$dialogDiv.find(e._selectors.NAMETB).val("");e.boxDraw.activate()}(t)});t._$div.find(t._classSelector+"-btn-cancel-draw").on(TC.Consts.event.CLICK,function(){n(t)});t._$div.find(t._classSelector+"-btn-cancel-dl").on(TC.Consts.event.CLICK,function(){t.cancelCacheRequest()});t._$div.find(t._selectors.LIST).on(TC.Consts.event.CLICK,t._selectors.DELETEBTN,function(e){if(navigator.onLine){$btn=$(e.target);var o=$btn.parent().find("a").html();if(o){var r=t.getLocaleString("cb.delete.confirm",{mapName:o});t.serviceWorkerEnabled||(r=r+" "+t.getLocaleString("cb.delete.confirm.connect.warning"));if(confirm(r))if(navigator.onLine){!function(e){e._state=e._states.DELETING;e.showDownloadProgress(0,1);e._$div.find(e._selectors.DRAWING).addClass(TC.Consts.classes.HIDDEN);e._$div.find(e._selectors.PROGRESS).addClass(TC.Consts.classes.HIDDEN);e._$div.find(e._selectors.NEW).removeClass(TC.Consts.classes.HIDDEN);e._$div.find(e._selectors.LISTITEM).addClass(TC.Consts.classes.DISABLED);e._$div.find(e._selectors.DELBTN).prop("disabled",!0);e._$dialogDiv.find(e._selectors.OKBTN).prop("disabled",!0);e._$div.find(e._selectors.NEWBTN).prop("disabled",!1);e._$dialogDiv.find(e._selectors.TILECOUNT).html("");e.boxDraw.cancel()}(t);t.deleteMap(o)}else TC.alert(t.getLocaleString("cb.delete.conn.alert"))}}else TC.alert(t.getLocaleString("cb.delete.conn.alert"))}).on(TC.Consts.event.CLICK,t._selectors.EDITBTN,function(e){!function(e,t){t.find("span").first().addClass(TC.Consts.classes.HIDDEN);t.find(e._selectors.TEXTBOX).removeClass(TC.Consts.classes.HIDDEN).val(t.find("span a").html()).focus();t.find(e._selectors.SAVEBTN).removeClass(TC.Consts.classes.HIDDEN);t.find(e._selectors.CANCELBTN).removeClass(TC.Consts.classes.HIDDEN);t.find(e._selectors.EDITBTN).addClass(TC.Consts.classes.HIDDEN);t.find(e._selectors.VIEWBTN).addClass(TC.Consts.classes.HIDDEN);t.find(e._selectors.DELETEBTN).addClass(TC.Consts.classes.HIDDEN)}(t,$(e.target).parent())}).on(TC.Consts.event.CLICK,t._selectors.CANCELBTN,function(e){var o=$(e.target).parent();o.find(t._selectors.TEXTBOX).val(o.find("a").html());a(t,$(e.target).parent())}).on(TC.Consts.event.CLICK,t._selectors.SAVEBTN,function(e){var o=$(e.target).parent();a(t,o);var r=o.find("a"),i=(r.html(),o.find(t._selectors.TEXTBOX).val()),n=t.findStoredMap({url:r.attr("href")});if(n){n.name=i;r.html(i);r.attr("title",i);f(t,n)}}).on(TC.Consts.event.CLICK,t._selectors.VIEWBTN,function(e){$btn=$(e.target);var o=!$btn.hasClass(TC.Consts.classes.ACTIVE);t._$div.find(t._selectors.VIEWBTN).removeClass(TC.Consts.classes.ACTIVE).parent().removeClass(TC.Consts.classes.ACTIVE);var r=$btn.parent().find("a").html();if(r){var n=t.findStoredMap({name:r});if(n){var a=i(n.extent);t.layer.clearFeatures();if(o){t.layer.addPolygon([[[a[0],a[1]],[a[0],a[3]],[a[2],a[3]],[a[2],a[1]]]],{showsPopup:!1}).then(function(){t.layer.map.zoomToFeatures(t.layer.features)});$btn.addClass(TC.Consts.classes.ACTIVE);$btn.parent().addClass(TC.Consts.classes.ACTIVE);$btn.attr("title",t.getLocaleString("removeMapExtent"))}}}});var r=function(e){e=e.toLowerCase();var o=t._$div.find(t._selectors.LISTITEM).hide(),r=o.filter("li:not([class]),li."+TC.Consts.classes.ACTIVE);if(0===e.length){r.show();t._$div.find(t._classSelector+"-map-search-icon").css("visibility","visible")}else{t._$div.find(t._classSelector+"-map-search-icon").css("visibility","hidden");var i=new RegExp(e,"i");r.each(function(){var e=$(this);e.toggle(i.test(e.find("a").text()))});0===r.filter(":visible").length&&o.filter('[class^="tc-ctl-cbuild-map-not"]').show()}},d=t._$div.find(t._selectors.SEARCH);d.on("keyup search",function(){r($(this).val().toLowerCase().trim())});try{if(d.has($("::-ms-clear"))){d.on("mouseup",function(e){""!==d.val()&&setTimeout(function(){var e=d.val();""===e&&r(e)},1)})}}catch(e){}t._$dialogDiv.find(t._selectors.BLLIST).on("change","input[type=checkbox]",function(e){t.baseLayers.length=0;t._$dialogDiv.find(t._selectors.BLLIST+" input[type=checkbox]").each(function(e,o){var r=$(o);if(r.prop("checked"))for(var i=r.val(),n=0,a=t.map.baseLayers.length;n<a;n++){var l=t.map.baseLayers[n];if(l.id===i&&l.type===TC.Consts.layerType.WMTS){t.baseLayers[t.baseLayers.length]=l;break}}});t.updateRequestSchemas();s(t);p(t);v(t);u(t)});t._$dialogDiv.find(t._selectors.RNGMAXRES).on("input change",function(e){s(t,{rangeValue:$(e.target).val()});p(t);u(t)});TC.Util.getQueryStringParams();g(t,location.href).addClass(TC.Consts.classes.ACTIVE);$.isFunction(e)&&e()})});window.addEventListener("beforeunload",function(e){if(t.isDownloading){var o=t.getLocaleString("cb.mapDownloading.warning");e.returnValue=o;return o}},!0)};r.register=function(e){var t=this;TC.control.SWCacheClient.prototype.register.call(t,e);if(navigator.serviceWorker){navigator.serviceWorker.addEventListener("message",function(e){switch(e.data.event){case"progress":t.$events.trigger($.Event(TC.Consts.event.MAPCACHEPROGRESS,{url:e.data.name,loaded:e.data.count,total:e.data.total}));break;case"cached":t.$events.trigger($.Event(TC.Consts.event.MAPCACHEDOWNLOAD,{url:e.data.name}));break;case"deleted":t.$events.trigger($.Event(TC.Consts.event.MAPCACHEDELETE,{url:e.data.name}));break;case"error":e.data.action===t._actions.CREATE&&TC.error(t.getLocaleString("cb.resourceDownload.error",{url:e.data.url}))}});o().then(function(e){const o=t.LOCAL_STORAGE_KEY_PREFIX+t.ROOT_CACHE_NAME+".hash";var r;window.localStorage&&(r=localStorage.getItem(o));if(r!==e.hash){t.cacheUrlList(e.urls);t.one(TC.Consts.event.MAPCACHEDOWNLOAD,function(){window.localStorage&&localStorage.setItem(o,e.hash)})}})}if(t.mapIsOffline){e._$div.addClass(TC.Consts.classes.OFFLINE);t._$offlinePanelDiv=$(TC.Util.getDiv(t.options.offlinePanelDiv));t.options.offlinePanelDiv||t._$offlinePanelDiv.appendTo(e._$div);t.getRenderedHtml(t.CLASS+"-off-panel",null,function(e){t._$offlinePanelDiv.html(e);navigator.onLine||t._$offlinePanelDiv.find(t._selectors.OFFPANEL).addClass(TC.Consts.classes.CONNECTION_OFFLINE).removeClass(TC.Consts.classes.CONNECTION_MOBILE).removeClass(TC.Consts.classes.CONNECTION_WIFI);t._$offlinePanelDiv.find(t._selectors.EXIT).on(TC.Consts.event.CLICK,function(e){TC.confirm(t.getLocaleString("offlineMapExit.confirm"),null,function(){e.preventDefault()})})})}const r=t.getUID(),a=t.getUID();t.layer=null;$.when(t.renderPromise(),e.addControl("draw",{id:r,div:t._$div.find(t._selectors.DRAW),mode:TC.Consts.geom.RECTANGLE,persistent:!1}),e.addLayer({id:a,type:TC.Consts.layerType.VECTOR,stealth:!0,styles:{line:e.options.styles.line}})).then(function(o,r,i){t.boxDraw=r;t.layer=i;r.setLayer(i);r.$events.on(TC.Consts.event.DRAWSTART,function(e){t.map.toast(t.getLocaleString("clickOnDownloadAreaOppositeCorner"),{type:TC.Consts.msgType.INFO})}).on(TC.Consts.event.DRAWEND,function(e){var o=e.feature.geometry[0],r=o[0],i=o[2],n=Math.min(r[0],i[0]),a=Math.max(r[0],i[0]),l=Math.min(r[1],i[1]),s=Math.max(r[1],i[1]);t.setExtent([n,l,a,s]);var c,g=t._$dialogDiv.find("input[type=checkbox]");g.each(function(e,o){for(var r=0,i=t.map.baseLayers.length;r<i;r++){var n=t.map.baseLayers[r];if(o.value===n.id){var a=$(o),l=a.parents("li").first(),s=n.getResolutions(),p=t.wrap.getRequestSchemas({extent:t.extent,layers:[n]})[0].tileMatrixLimits;if(p.length&&s[s.length-1]==p[p.length-1].res)l.removeClass(TC.Consts.classes.HIDDEN);else{a.prop("checked",!1);l.addClass(TC.Consts.classes.HIDDEN)}break}}});c=t._$dialogDiv.find(t._selectors.BLLISTITEM).filter(":not(."+TC.Consts.classes.HIDDEN+")").length?"selectAtLeastOne":"cb.noMapsAtSelectedExtent";t._$dialogDiv.find(t._selectors.BLLISTTEXT).html(t.getLocaleString(c));p(t);u(t);TC.Util.showModal(t._$dialogDiv.find(t._classSelector+"-dialog"),{openCallback:function(){g.prop("disabled",!1);var e;if(Date.prototype.toLocaleString){var o={};o.year=o.month=o.day=o.hour=o.minute=o.second="numeric";e=(new Date).toLocaleString(t.map.options.locale.replace("_","-"),o)}else e=(new Date).toString();t._$dialogDiv.find(t._selectors.NAMETB).val(e)[0];v(t)},closeCallback:function(){g.prop("disabled",!0);t.layer.clearFeatures()}})});e.on(TC.Consts.event.CONTROLDEACTIVATE,function(e){r===e.control&&t._state===t._states.EDITING&&n(t)})});var l=function(e){var o=!1,r=t._$dialogDiv.find(t._selectors.BLLIST),i=function(){return r.find('li[data-tc-layer-uid="'+e.id+'"]').length>0},n=e.type===TC.Consts.layerType.WMTS&&!e.mustReproject;TC.Util.detectSafari()&&TC.Util.detectIOS()&&(n=n&&TC.Util.isSameOrigin(e.url));if(n&&!i()){o=!0;t.getRenderedHtml(t.CLASS+"-bl-node",e,function(e){i()||r.append(e)})}return o};e.on(TC.Consts.event.LAYERADD,function(e){l(e.layer)}).on(TC.Consts.event.LAYERREMOVE,function(e){e.layer.type===TC.Consts.layerType.WMTS&&t._$dialogDiv.find(t._selectors.BLLIST).find('li[data-tc-layer-uid="'+e.layer.id+'"]').remove()});var s=TC.Util.getQueryStringParams(),c=s[t.MAP_DEFINITION_PARAM_NAME],d=s[t.MAP_EXTENT_PARAM_NAME];e.ready(function(){if(t.mapIsOffline){for(var o=[],r=0,i=t.offlineControls.length;r<i;r++){var n=t.offlineControls[r];n=n.substr(0,1).toUpperCase()+n.substr(1);o=o.concat(e.getControlsByClass("TC.control."+n))}for(r=0,i=e.controls.length;r<i;r++){var a=e.controls[r];o.indexOf(a)<0&&a.disable()}$(t._selectors.OFFLINEHIDDEN).addClass(TC.Consts.classes.HIDDEN)}});e.loaded(function(){e.putLayerOnTop(t.layer);t._firstRender.then(function(){t._$div.find(t._selectors.NEWBTN).prop("disabled",!1);for(var o=0,r=e.baseLayers.length;o<r;o++)l(e.baseLayers[o])});if(t.mapIsOffline){var o=JSON.parse(window.atob(decodeURIComponent(c))),r=[],n=$.grep(e.baseLayers,function(e){var t=!1;if(e.type===TC.Consts.layerType.WMTS)for(var i=0,n=o.layers.length;i<n;i++){var a=o.layers[i];if((0===e.url.indexOf("//")?location.protocol+e.url:e.url)===o.url[a.urlIdx]&&e.layerNames===a.id&&e.matrixSet===o.tms[a.tmsIdx]){t=!0;break}}t||e.type!==TC.Consts.layerType.VECTOR&&(r[r.length]=e);return t})[0];n&&e.setBaseLayer(n);for(var a=0,s=r.length;a<s;a++)e.removeLayer(r[a]);e.setExtent(i(d))}});t.$events.on(TC.Consts.event.MAPCACHEDOWNLOAD,function(o){t.isDownloading=!1;var r=function(e){var t=e.indexOf("#");return t>=0?e.substr(0,t):e}(o.url),i=g(t,r);if(i.length&&!t.serviceWorkerEnabled){i.removeClass(TC.Consts.classes.DISABLED);i.find(t._selectors.DELBTN).prop("disabled",!1);TC.alert(t.getLocaleString("cb.delete.error"))}else if(t.currentMap&&r===t.currentMap.url){!function(e){var t=e.currentMap;if(f(e,t)){e.getRenderedHtml(e.CLASS+"-map-node",{name:t.name,url:t.url},function(t){e._$div.find(e._selectors.LIST).append(t);e._$div.find(e._selectors.EMPTYLIST).attr("hidden","hidden");e._$div.find(e._selectors.SEARCH).prop("disabled",!1)});e.storedMaps.push(t)}}(t);e.toast(t.getLocaleString("mapDownloaded",{mapName:t.currentMap.name}))}t.currentMap=null;h(t,o.url);n(t)}).on(TC.Consts.event.MAPCACHEDELETE,function(o){t.isDownloading=!1;var r=y(t,o.url)||t.currentMap&&t.currentMap.name;h(t,o.url);t.currentMap=null;if(r){document.cookie=t.COOKIE_KEY_PREFIX+"delete=; expires=Thu, 01 Jan 1970 00:00:01 GMT;";e.toast(t.getLocaleString("mapDeleted",{mapName:r}))}n(t)}).on(TC.Consts.event.MAPCACHEPROGRESS,function(e){var o=e.total;!o&&t.requestSchemas&&(o=t.requestSchemas[0].tileCount);var r=e.loaded;if(r)t._loadedCount=r;else{t._loadedCount+=1;r=t._loadedCount}t.showDownloadProgress(r,o)}).on(TC.Consts.event.MAPCACHEERROR,function(e){t.isDownloading=!1;h(t,e.url);n(t);var o=t.getLocaleString("cb.mapCreation.error"),r=!0;switch(e.reason){case"quota":o+=". "+t.getLocaleString("cb.mapCreation.error.reasonQuota");break;case"resource":o+=". "+t.getLocaleString("cb.mapCreation.error.reasonResource");break;case"manifest":"410"==e.status&&y(t,e.url);r=!1;break;case"already_exists":o+=". "+t.getLocaleString("cb.mapCreation.error.reasonAlreadyExists")}if(r)if(TC.Util.detectIE()){TC.error(o);TC.alert(t.getLocaleString("cb.mapCreation.error.reasonIE"))}else TC.alert(o);t.currentMap=null})};r.setExtent=function(e){if($.isArray(e)&&e.length>=4){this.extent=e;this.updateRequestSchemas()}};r.cacheUrlList=function(e,t){var o=t||{};this.createCache(o.name||this.LOCAL_STORAGE_KEY_PREFIX+this.ROOT_CACHE_NAME,{urlList:e,silent:o.silent})};r.requestCache=function(e){var t=this,o=e||{};if(t.map){var r=o.extent||t.extent||t.map.getExtent();t.updateRequestSchemas({extent:r});if(t.requestSchemas){for(var i=function(e,o,r){var i=e.res>=t.minResolution;!i&&o>0&&(i=r[o-1].res>t.minResolution);return i},n=function(e){return{mId:e.mId,cl:e.cl,cr:e.cr,rt:e.rt,rb:e.rb}},a=t.requestSchemas.map(function(e){return{layerId:e.layerId,tileMatrixLimits:e.tileMatrixLimits.filter(i)}}),l=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY],s=0,p=a.length;s<p;s++){var c=a[s],u=(M=c.tileMatrixLimits[c.tileMatrixLimits.length-1]).res*M.tSize;l[0]=Math.min(l[0],M.origin[0]+u*M.cl);l[1]=Math.min(l[1],M.origin[1]-u*(M.rb+1));l[2]=Math.max(l[2],M.origin[0]+u*(M.cr+1));l[3]=Math.max(l[3],M.origin[1]-u*M.rt);c.tileMatrixLimits=c.tileMatrixLimits.map(n)}var g=Math.pow(10,t.map.wrap.isGeo()?TC.Consts.DEGREE_PRECISION:TC.Consts.METER_PRECISION),h={bBox:l=l.map(function(e,t){return(t<3?Math.ceil:Math.floor)(e*g)/g}),res:Math.floor(1e3*t.minResolution)/1e3,url:[],tms:[],format:[],layers:new Array(t.baseLayers.length)};for(s=0,p=t.baseLayers.length;s<p;s++){var f=t.baseLayers[s],y=0===f.url.indexOf("//")?location.protocol+f.url:f.url,v=$.inArray(y,h.url);v<0&&(v=h.url.push(y)-1);var C=$.inArray(f.matrixSet,h.tms);C<0&&(C=h.tms.push(f.matrixSet)-1);var T=f.format.substr(f.format.indexOf("/")+1),S=$.inArray(T,h.format);S<0&&(S=h.format.push(T)-1);h.layers[s]={urlIdx:v,id:f.layerNames,tmsIdx:C,formatIdx:S}}var _=TC.Util.getQueryStringParams(),E=_[t.MAP_EXTENT_PARAM_NAME]=l.toString();_[t.MAP_DEFINITION_PARAM_NAME]=btoa(JSON.stringify(h));t.serviceWorkerEnabled&&(_[t.SERVICE_WORKER_FLAG]=1);var x=location.origin+location.pathname.substr(0,location.pathname.lastIndexOf("/")+1)+t.CACHE_REQUEST_PATH+"?"+$.param(_);t.currentMap={name:o.mapName,extent:E,url:x};t.isDownloading=!0;if(t.serviceWorkerEnabled)for(s=0,p=a.length;s<p;s++){for(var P=a[s],L=null,w=0,b=t.baseLayers.length;w<b;w++){var R=t.baseLayers[w];if(R.id===P.layerId){L=t.wrap.getGetTilePattern(R);break}}if(L){urlList=[];var A=0;for(k=0,lenk=P.tileMatrixLimits.length;k<lenk;k++){var M;for(R=(M=P.tileMatrixLimits[k]).cl;R<=M.cr;R++)for(m=M.rt;m<=M.rb;m++)urlList[A++]=L.replace("{TileMatrix}",M.mId).replace("{TileCol}",R).replace("{TileRow}",m)}urlList.push(x);t.cacheUrlList(urlList,{name:x})}}else d(t,x)}}};r.cancelCacheRequest=function(){var e=this;if(e.currentMap){h(e,e.currentMap.url);e.deleteCache(e.currentMap.url).then(function(t){t||(e.currentMap=null)})}e.isDownloading=!1;n(e)};r.deleteMap=function(e){var t=this,o=t.findStoredMap({name:e});if(o){var r=TC.Util.getQueryStringParams(o.url);t.deleteCache(o.url).then(function(e){if(!e){document.cookie=t.COOKIE_KEY_PREFIX+"delete="+atob(decodeURIComponent(r[t.MAP_DEFINITION_PARAM_NAME]));d(t,o.url)}})}};r.findStoredMap=function(e){return $.grep(this.storedMaps,function(t){var o=!0;e.name&&e.name!==t.name&&(o=!1);o&&e.url&&e.url!==t.url&&(o=!1);return o})[0]};r.showDownloadProgress=function(e,t){var o=this._classSelector,r=this._$div.find(o+"-progress-count");if(t){var i=Math.min(Math.round(100*e/t),100)+"%";this._$div.find(o+"-progress-ratio").css("width",i);r.html(i)}else{this._$div.find(o+"-progress-bar").addClass(TC.Consts.classes.HIDDEN);r.html(this.getLocaleString("xFiles",{quantity:e}))}};r.updateRequestSchemas=function(e){var t=e||{};t.extent=t.extent||this.extent;t.layers=t.layers||this.baseLayers;this.requestSchemas=this.wrap.getRequestSchemas(t);return this.requestSchemas};r.getResolutions=function(){for(var e=[],t=function(e){return e.res},o=this.requestSchemas.map(function(e){return e.tileMatrixLimits.map(t)}),r=Number.POSITIVE_INFINITY,i=0,n=0,a=o.length;n<a;n++){var l=o[n];r=Math.min(r,l[0]);i=Math.max(i,l[l.length-1])}for(n=0,a=o.length;n<a;n++)e=e.concat(o[n].filter(function(t){return t<=r&&t>=i&&e.indexOf(t)<0}));e.sort(function(e,t){return t-e});return e}}();TC.control=TC.control||{};TC.control.ProjectionSelector||TC.syncLoadJS(TC.apiLocation+"TC/control/ProjectionSelector");!function(){TC.control.Coordinates=function(e){e=e||{};this.crs="";this.xy=[0,0,0];this.latLon=[0,0,0];this.x=0;this.y=0;this.lat=0;this.lon=0;this.units="m";this.isGeo=!1;TC.control.ProjectionSelector.apply(this,arguments);$.extend(this._cssClasses,{CRS:this.CLASS+"-crs",GEOCRS:this.CLASS+"-geocrs",X:this.CLASS+"-x",Y:this.CLASS+"-y",LAT:this.CLASS+"-lat",LON:this.CLASS+"-lon",ELEVATION:this.CLASS+"-elevation"});this.geoCrs=this.options.geoCrs||TC.Cfg.geoCrs;this.wrap=new TC.wrap.control.Coordinates(this)};TC.inherit(TC.control.Coordinates,TC.control.ProjectionSelector);var e=TC.control.Coordinates.prototype;e.CLASS="tc-ctl-coords";var t;e.template={};if(TC.isDebug){e.template[e.CLASS]=TC.apiLocation+"TC/templates/Coordinates.html";e.template[e.CLASS+"-dialog"]=TC.apiLocation+"TC/templates/CoordinatesDialog.html"}else{e.template[e.CLASS]=function(){dust.register(e.CLASS,t);function t(e,t){return e.w('<div>CRS: <span class="tc-ctl-coords-crs">').f(t.get(["crs"],!1),t,"h").w('</span><button class="tc-ctl-coords-crs" title="').h("i18n",t,{},{$key:"changeCRS"}).w('">').f(t.get(["crs"],!1),t,"h").w('</button></div><div class="tc-ctl-coords-xy">').x(t.get(["isGeo"],!1),t,{else:o,block:i},{}).w("</div>").x(t.get(["showGeo"],!1),t,{block:a},{}).w('<span class="close"></span>')}t.__dustBody=!0;function o(e,t){return e.w('x: <span class="tc-ctl-coords-x">').f(t.get(["x"],!1),t,"h").w('</span> y: <span class="tc-ctl-coords-y">').f(t.get(["y"],!1),t,"h").w("</span> ").x(t.get(["ele"],!1),t,{block:r},{})}o.__dustBody=!0;function r(e,t){return e.w(' z: <span class="tc-ctl-coords-elevation">').f(t.get(["ele"],!1),t,"h").w("</span> ")}r.__dustBody=!0;function i(e,t){return e.h("i18n",t,{},{$key:"lat"}).w(': <span class="tc-ctl-coords-lat">').f(t.get(["lat"],!1),t,"h").w("</span> ").h("i18n",t,{},{$key:"lon"}).w(': <span class="tc-ctl-coords-lon">').f(t.get(["lon"],!1),t,"h").w("</span> ").x(t.get(["ele"],!1),t,{block:n},{})}i.__dustBody=!0;function n(e,t){return e.w(" ").h("i18n",t,{},{$key:"ele"}).w(': <span class="tc-ctl-coords-elevation">').f(t.get(["ele"],!1),t,"h").w("</span> ")}n.__dustBody=!0;function a(e,t){return e.w('<div class="tc-ctl-coords-alt">CRS: <span class="tc-ctl-coords-geocrs">').f(t.get(["geoCrs"],!1),t,"h").w('</span></div><div class="tc-ctl-coords-xy">').h("i18n",t,{},{$key:"lat"}).w(': <span class="tc-ctl-coords-lat">').f(t.get(["lat"],!1),t,"h").w("</span> ").h("i18n",t,{},{$key:"lon"}).w(': <span class="tc-ctl-coords-lon">').f(t.get(["lon"],!1),t,"h").w("</span> ").x(t.get(["ele"],!1),t,{block:l},{}).w(" </div>")}a.__dustBody=!0;function l(e,t){return e.w(" ").h("i18n",t,{},{$key:"ele"}).w(': <span class="tc-ctl-coords-elevation">').f(t.get(["ele"],!1),t,"h").w("</span> ")}l.__dustBody=!0;return t};e.template[e.CLASS+"-dialog"]=function(){dust.register(e.CLASS+"-dialog",t);function t(e,t){return e.w('<div class="tc-ctl-coords-crs-dialog tc-modal"><div class="tc-modal-background tc-modal-close"></div><div class="tc-modal-window"><div class="tc-modal-header"><h3>').h("i18n",t,{},{$key:"changeCRS"}).w('</h3><div class="tc-ctl-popup-close tc-modal-close"></div></div><div class="tc-modal-body"><p>').h("i18n",t,{},{$key:"coords.currentProjection|h"}).w('</p><p class="tc-ctl-coords-no-change">').h("i18n",t,{},{$key:"coords.noCrs.warning|s"}).w('</p><div class="tc-ctl-coords-change"><p>').h("i18n",t,{},{$key:"coords.instructions|s"}).w('</p><p class="tc-msg-warning tc-hidden">').h("i18n",t,{},{$key:"coords.instructions.warning|s"}).w('</p></div><ul class="tc-ctl-coords-crs-list tc-crs-list"></ul></div><div class="tc-modal-footer"><button type="button" class="tc-button tc-modal-close">').h("i18n",t,{},{$key:"close"}).w("</button></div></div></div>")}t.__dustBody=!0;return t}}e.register=function(e){var t=this;TC.control.ProjectionSelector.prototype.register.call(t,e);t.crs=t.map.crs;t.clear();e.loaded(function(){t.wrap.register(e).then(function(){t.render(function(){t.clear()})});if(TC.Util.detectMobile()){t.getLayer();t.activateCoords()}e.on(TC.Consts.event.PROJECTIONCHANGE,function(o){t.isGeo=e.wrap.isGeo();t.crs=o.crs;t.render()});$.when(t.map.wrap.getViewport()).then(function(e){$(e).on(TC.Consts.event.MOUSEMOVE+".coords",function(e){t.onMouseMove(e)}).on(TC.Consts.event.MOUSELEAVE+".coords",function(e){t.onMouseLeave(e)})})})};e.render=function(e){var t=this;t.getRenderedHtml(t.CLASS+"-dialog",null,function(e){t._$dialogDiv.html(e)}).then(function(){TC.Control.prototype.renderData.call(t,{x:t.x,y:t.y,lat:t.lat,lon:t.lon,ele:t.isGeo&&t.latLon.length>2?t.latLon[2]:!t.isGeo&&t.xy.length>2?t.xy[2]:null,crs:t.crs,geoCrs:t.geoCrs,isGeo:t.isGeo,showGeo:!t.isGeo&&t.options.showGeo},function(){t.$crs=t._$div.find("."+t._cssClasses.CRS);t.$geoCrs=t._$div.find("."+t._cssClasses.GEOCRS);t.$x=t._$div.find("."+t._cssClasses.X);t.$y=t._$div.find("."+t._cssClasses.Y);t.$lat=t._$div.find("."+t._cssClasses.LAT);t.$lon=t._$div.find("."+t._cssClasses.LON);t.$ele=t._$div.find("."+t._cssClasses.ELEVATION);t.$crs.filter("button").on(TC.Consts.event.CLICK,function(e){t.showProjectionChangeDialog()});$.isFunction(e)&&e()})})};e.onMouseMove=function(e){this.wrap.onMouseMove(e)};e.onMouseLeave=function(e){var t=this;setTimeout(function(){t.div.getBoundingClientRect();if(!t.isPointerOver(e)){t._$div.css("visibility","hidden");t.clear()}},200)};e.isPointerOver=function(e){var t=this.div.getBoundingClientRect();return t.left<=e.clientX&&t.left+t.width>=e.clientX&&t.top<=e.clientY&&t.top+t.height>=e.clientY};e.formatCoord=function(e,t){var o;o=e.toFixed(t);t<=3&&(o=o.replace(/\B(?=(\d{3})+(?!\d))/g,"|"));return o=o.replace(".",",").replace(/\|/g,".")};e.update=function(){var e=this;!e.isGeo&&e.options.showGeo&&(e.latLon=TC.Util.reproject(e.xy,e.crs,e.geoCrs).reverse());if(!e.isGeo){e.x=e.formatCoord(e.xy[0],TC.Consts.METER_PRECISION);e.y=e.formatCoord(e.xy[1],TC.Consts.METER_PRECISION)}if(e.isGeo||e.options.showGeo){e.lat=e.formatCoord(e.latLon[0],TC.Consts.DEGREE_PRECISION);e.lon=e.formatCoord(e.latLon[1],TC.Consts.DEGREE_PRECISION)}e.render(function(){if(TC.Util.detectMobile()){e._$div.find("span.close").click(function(){e._$div.toggleClass(TC.Consts.classes.HIDDEN,!0);e.clear()});e._$div.find("span.close").show()}else{e._$div.removeClass(TC.Consts.classes.HIDDEN);e._$div.css("visibility","visible");e._$div.find("span.close").hide()}})};e.clear=function(){this._$div.addClass(TC.Consts.classes.HIDDEN);this._$div.css("visibility","hidden");delete this.currentCoordsMarker;this.getLayer().then(function(e){e.clearFeatures()})};e.deactivateCoords=function(){this._$div.toggleClass(TC.Consts.classes.HIDDEN,!0);this.clear();this.wrap.coordsDeactivate()};e.activateCoords=function(){this.wrap.coordsActivate()};e.getCoords=function(){var e=this.map.getControlsByClass(TC.control.Popup);if(e&&e.length>0&&e[0].isVisible())this.coordsToPopup(e[0]);else{this.updateCoordsCtrl([(this.map.getExtent()[0]+this.map.getExtent()[2])/2,(this.map.getExtent()[1]+this.map.getExtent()[3])/2]);this.coordsToClick.call(this,{coordinate:this.xy})}};e.coordsToPopup=function(e){e&&this.updateCoordsCtrl(e.wrap.popup.getPosition())};e.updateCoordsCtrl=function(e){if(e){if(!this.isGeo){this.x=e[0];this.y=e[1];this.xy=[this.x,this.y];e.length>2&&this.xy.push(e[2])}if(this.isGeo||this.options.showGeo){this.lat=e[0];this.lon=e[1];this.latLon=[this.lat,this.lon];e.length>2&&this.latLon.push(e[2])}this.update()}};e.coordsToClick=function(e){var o=this;if(!$(o.map._$div).hasClass("tc-ctl-sv-active "+TC.Consts.classes.COLLAPSED)){var r=o._$div[0].getBoundingClientRect();if(r.left<=e.clientX&&e.clientX<=r.right&&r.top<=e.clientY&&e.clientY<=r.bottom){o._$div.toggleClass(TC.Consts.classes.HIDDEN,!0);o.clear();return}$(o._$div).stop(!0,!0);t&&clearTimeout(t);o.updateCoordsCtrl(e.coordinate);o.coordsMarkerAdd(e.coordinate,e.cssClass);o._$div.removeClass(TC.Consts.classes.HIDDEN);o._$div.css("visibility","visible");$(o._$div).css({opacity:.7});t=setTimeout(function(){$(o._$div).animate({opacity:0},3e3,"linear",function(){o.clear()})},5e3)}};e.coordsMarkerAdd=function(e,t){var o=this;o.currentCoordsMarker?o.currentCoordsMarker.setCoords(e):o.getLayer().then(function(r){$.when(r.addMarker(e,{title:"Coord",showsPopup:!1,cssClass:t||TC.Consts.classes.POINT,anchor:[.5,.5]})).then(function(e){o.currentCoordsMarker=e})})};e.getLayer=function(){var e=this,t=new $.Deferred;void 0==e.layer?e.map.addLayer({id:e.getUID(),type:TC.Consts.layerType.VECTOR,stealth:!0,title:"Coordenadas"}).then(function(o){e.layer=o;e.layer.map.putLayerOnTop(e.layer);t.resolve(e.layer)}):t.resolve(e.layer);return t}}();TC.control=TC.control||{};TC.control.TabContainer||TC.syncLoadJS(TC.apiLocation+"TC/control/TabContainer");TC.control.DataLoader=function(){TC.control.TabContainer.apply(this,arguments);this.controlOptions=[{name:"externalWMS",title:"addWMS",options:{suggestions:this.options.wmsSuggestions}},{name:"fileImport",options:{enableDragAndDrop:this.options.enableDragAndDrop}}];this._ctlDeferreds.length=2;this._ctlDeferreds[0]=$.Deferred();this._ctlDeferreds[1]=$.Deferred();this.defaultSelection=0};TC.inherit(TC.control.DataLoader,TC.control.TabContainer);TC.control.DataLoader.prototype.register=function(e){this.title=this.getLocaleString("addMaps");TC.control.TabContainer.prototype.register.call(this,e)};TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.filter||TC.syncLoadJS(TC.apiLocation+"TC/Filter");TC.control.Download=function(e){this._classSelector="."+this.CLASS;TC.Control.apply(this,arguments);var t=e||{};this._$dialogDiv=$(TC.Util.getDiv(t.dialogDiv));t.dialogDiv||this._$dialogDiv.appendTo("body")};TC.inherit(TC.control.Download,TC.Control);!function(){var e=TC.control.Download.prototype;e.CLASS="tc-ctl-download";e.template={};if(TC.isDebug){e.template[e.CLASS]=TC.apiLocation+"TC/templates/Download.html";e.template[e.CLASS+"-dialog"]=TC.apiLocation+"TC/templates/DownloadDialog.html"}else{e.template[e.CLASS]=function(){dust.register(e.CLASS,t);function t(e,t){return e.w("<h2>").h("i18n",t,{},{$key:"download"}).w(' </h2><div class="tc-ctl-tctr tc-ctl-tctr-select"><form><label class="tc-ctl-tctr-tab tc-ctl-download-image" style="width:calc(100%/2 - 1px)"><input type="radio" name="sctnr-sel" value="image" /><span>').h("i18n",t,{},{$key:"dl.export.map"}).w('</span></label><label class="tc-ctl-tctr-tab tc-ctl-download-data" style="width:calc(100%/2 - 1px)"><input type="radio" name="sctnr-sel" value="data" /><span>').h("i18n",t,{},{$key:"dl.export.vector"}).w('</span></label></form></div><div class="tc-ctl tc-ctl-tctr-elm tc-ctl-tctr-elm-image tc-group tc-ctl-download-cnt tc-ctl-download-image tc-hidden"><label>').h("i18n",t,{},{$key:"format"}).w(':</label><select id="download-format-image" class="tc-combo"><option value="image/png">PNG</option><option value="image/jpeg">JPEG</option></select><div class="tc-ctl-download-div"><input id="tc-ctl-download-image-qr" class="tc-hidden" type="checkbox" checked style="display:none;" /><label for="tc-ctl-download-image-qr" class="tc-ctl-download-image-qr-label" title="').h("i18n",t,{},{$key:"createQrCodeToImage"}).w('">').h("i18n",t,{},{$key:"appendQRCode"}).w('</label></div><div class="tc-group tc-group tc-ctl-download-cnt" style="text-align:right;"><button type="button" class="tc-ctl-download-btn tc-button tc-icon-button" title="').h("i18n",t,{},{$key:"downloadImageFromCurrentMap"}).w('" name="descargar">').h("i18n",t,{},{$key:"download"}).w('</button></div></div><div class="tc-ctl tc-ctl-tctr-elm tc-ctl-tctr-elm-data tc-group tc-ctl-download-cnt tc-hidden"><label>').h("i18n",t,{},{$key:"format"}).w(':</label><select id="download-format" class="tc-combo"><option value="GML32">GML</option><option value="application/json">GeoJSON</option><option value="application/vnd.google-earth.kml+xml">KML (Google Earth)</option><option value="shape-zip">Shape (ESRI)</option></select><div class="tc-ctl-download-div"><i class="tc-ctl-download-help icon-question-sign" data-toggle="tooltip" data-placement="top" title="').h("i18n",t,{},{$key:"showDownloadHelp"}).w('"></i></div><div class="tc-group tc-group tc-ctl-download-cnt" style="text-align:right;"><button type="button" class="tc-ctl-download-btn tc-button tc-icon-button" title="').h("i18n",t,{},{$key:"downloadLayersFromCurrentExtent"}).w('" name="descargar">').h("i18n",t,{},{$key:"download"}).w('</button></div><div class="tc-alert alert-warning tc-hidden"><p id="zoom-msg"><strong>').h("i18n",t,{},{$key:"tooManyFeatures"}).w(": </strong>").h("i18n",t,{},{$key:"tooManyFeatures.instructions"}).w('</p><p id="layers-msg"><strong>').h("i18n",t,{},{$key:"noLayersLoaded"}).w(": </strong>").h("i18n",t,{},{$key:"noLayersLoaded.instructions"}).w('</p><p id="url-msg"><strong>').h("i18n",t,{},{$key:"tooManySelectedLayers"}).w(": </strong>").h("i18n",t,{},{$key:"tooManySelectedLayers.instructions"}).w('</p><p id="noFeatures-msg"><strong>').h("i18n",t,{},{$key:"noData"}).w(": </strong>").h("i18n",t,{},{$key:"noData.instructions"}).w('</p><p id="novalid-msg"><strong>').h("i18n",t,{},{$key:"noValidService"}).w(": </strong>").h("i18n",t,{},{$key:"noValidService.instructions"}).w("</p></div></div>")}t.__dustBody=!0;return t};e.template[e.CLASS+"-dialog"]=function(){dust.register(e.CLASS+"-dialog",t);function t(e,t){return e.w(' <div class="tc-ctl-download-help-dialog tc-modal"><div class="tc-modal-background tc-modal-close"></div><div class="tc-modal-window"><div class="tc-modal-header"><h3>').h("i18n",t,{},{$key:"downloadData"}).w('</h3><div class="tc-ctl-popup-close tc-modal-close"></div></div><div class="tc-modal-body"><p>').h("i18n",t,{},{$key:"dl.instructions.1|s"}).w("</p><ul><li>").h("i18n",t,{},{$key:"dl.instructions.2|s"}).w("</li><li>").h("i18n",t,{},{$key:"dl.instructions.3|s"}).w("</li><li>").h("i18n",t,{},{$key:"dl.instructions.4|s"}).w("<ul><li>").h("i18n",t,{},{$key:"dl.instructions.5|s"}).w("</li><li>").h("i18n",t,{},{$key:"dl.instructions.6|s"}).w('</li></ul></li></ul></div><div class="tc-modal-footer"><button type="button" class="tc-button tc-modal-close">').h("i18n",t,{},{$key:"close"}).w("</button></div></div></div>")}t.__dustBody=!0;return t}}e.render=function(e){var t=this;t.getRenderedHtml(t.CLASS+"-dialog",null,function(e){t._$dialogDiv.html(e)}).then(function(){TC.Control.prototype.render.call(t,function(){t.CLASS;var o=".tc-ctl-tctr";t._selectors={TAB:o+"-tab",RADIOBUTTON:"input[type=radio][name=sctnr-sel]",ELEMENT:o+"-elm"};t._$div.find("span").on(TC.Consts.event.CLICK,function(e){var o=$(this).closest(t._selectors.TAB).find(t._selectors.RADIOBUTTON),r=o.val(),i=t._$div.find(t._selectors.ELEMENT);if(t._oldValue===r&&t.options.deselectable){setTimeout(function(){o.prop("checked",!1)},0);t._oldValue=null;$active=$();$hidden=i}else{$active=i.filter(t._selectors.ELEMENT+"-"+r);$hidden=i.not($active);t._oldValue=r}$active.removeClass(TC.Consts.classes.HIDDEN);$hidden.addClass(TC.Consts.classes.HIDDEN);o.prop("checked",!0)});e&&e()})})};e.register=function(e){var t=this;TC.Control.prototype.register.call(t,e);t.map.mustBeExportable=!0;var o=function(){for(var e=[],o=0;o<t.map.workLayers.length;o++){var r=t.map.workLayers[o];r.type===TC.Consts.layerType.WMS&&r.getVisibility()&&r.names.length>0&&e.push(r)}return e},r=function(e,o){var r,i=t._$div.find(".alert-warning");switch(e.key){case TC.Consts.WFSErrors.NumMaxFeatures:r=i.find("#zoom-msg").html().format({serviceName:e.params.serviceTitle});break;case TC.Consts.WFSErrors.NoLayers:r=t.getLocaleString("noLayersLoaded");break;case TC.Consts.WFSErrors.GetCapabilities:r=i.find("#novalid-msg").html().format({serviceName:e.params.serviceTitle});break;case TC.Consts.WFSErrors.NoFeatures:r=i.find("#noFeatures-msg").html();break;case TC.Consts.WFSErrors.Indeterminate:r=t.getLocaleString("wfs.IndeterminateError");t.map.toast(r,{type:TC.Consts.msgType.ERROR});TC.error("Error:{error} \r\n Descripcion:{descripcion} \r\n Servicio:{serviceName}".format({error:e.params.err,descripcion:e.params.errorThrown,serviceName:e.params.serviceTitle}),TC.Consts.msgErrorMode.CONSOLE);t.map.getLoadingIndicator().removeWait(o);return;default:r=t.getLocaleString("wfs."+e.key,e.params)}t.map.toast(r,{type:TC.Consts.msgType.WARNING});t.map.getLoadingIndicator().removeWait(o)};t._$div.on(TC.Consts.event.CLICK,".tc-ctl-download-btn",function(){var e=t.map.getLoadingIndicator().addWait(),i=$active.find("select").val();if($active.find("select").val().indexOf("image")>-1){var n,a=$.Deferred(),l=t.map.wrap.getViewport({synchronous:!0}).getElementsByTagName("canvas")[0],s=TC.Util.cloneCanvas(l),p=t.map.getControlsByClass(TC.control.ScaleBar);if(0==p.length){(p=new TC.control.ScaleBar).register(t.map);p.render()}if(p){var c=s.getContext("2d");c.save();var u,g,d=document.getElementsByClassName("ol-scale-line-inner"),h=d.item(0),f=$.extend({},h.getBoundingClientRect()),y=(d=document.getElementsByClassName(p[0].CLASS)).item(0),m=$.extend({},y.getBoundingClientRect()),v=h.textContent;c.beginPath();c.strokeStyle=window.getComputedStyle(h).borderColor;if(f.width>f.height){u=f.width;g=f.height}else{u=f.height;g=f.width}m.left=f.left=15;m.left=m.left-2;m.top=f.top=15;m.top--;c.moveTo(f.left,f.top);c.lineTo(f.left,f.top+g);c.lineTo(f.left+u,f.top+g);c.lineTo(f.left+u,f.top);c.stroke();c.measureText(v);var C={x:f.left+u/2,y:f.top+g/2};c.globalAlpha=.5;c.fillStyle=window.getComputedStyle(y).backgroundColor;u+=4;g+=4;c.fillRect(m.left,m.top,u,g);c.globalAlpha=1;c.fillStyle=window.getComputedStyle(h).color;c.font=window.getComputedStyle(h).fontSize+" "+window.getComputedStyle(h).fontFamily;c.textAlign="center";c.textBaseline="middle";c.fillText(v,C.x,C.y)}$active.find("#tc-ctl-download-image-qr:checked").length>0?$.when(function(e){var t=$.Deferred();e?TC.loadJS(void 0===QRCode,[TC.apiLocation+"lib/qrcode/qrcode.min.js"],function(){e.length>150&&(e=TC.Util.shortenUrl(e));$("body").append('<div id="qrcode"></div>');var o=$("#qrcode");new QRCode(o.get(0),{text:e,width:85,height:85});setTimeout(function(){var e=o.find("img").attr("src");o.remove();t.resolve(e)},100)}):t.resolve(imgBase64);return t.promise()}(function(){var e=window.location.href,t=e.indexOf("?"),o=e.indexOf("#");t>0&&(e=t<o?e.replace(e.substring(t,o),""):e.replace(e.substring(t,e.length-1),""));return e}())).then(function(o){if(o){var r=s.getContext("2d");r.fillStyle="#ffffff";r.fillRect(s.width-91,s.height-91,91,91);$.when(TC.Util.addToCanvas(s,o,{x:s.width-88,y:s.height-88})).then(function(e){a.resolve(e)})}else{TC.error(t.getLocaleString("dl.export.map.error")+": QR");t.map.getLoadingIndicator().removeWait(e)}}):a.resolve(s);$.when(a).then(function(o){try{n=o.toDataURL(i);TC.Util.downloadDataURI(window.location.hostname+"_"+TC.Util.getFormattedDate((new Date).toString(),!0)+"."+i.split("/")[1],i,n)}catch(e){TC.error(t.getLocaleString("dl.export.map.error")+": "+e.message)}t.map.getLoadingIndicator().removeWait(e)})}else{o();var T=t.map.getExtent(),S=TC.Util.reproject(T.slice(0,2),t.map.crs,TC.Defaults.crs),_=TC.Util.reproject(T.slice(2),t.map.crs,TC.Defaults.crs),E=TC.WFSGetFeatureBuilder(t.map,new TC.filter.bbox([S[0],S[1],_[0],_[1]]),i,!0);$.when.apply($,E).then(function(){var o=$.grep(arguments,function(e){return null!=e});if(0!==o.length){for(var i=[],n=0;n<o.length;n++)if(o[n].errors&&o[n].errors.length)for(var a=0;a<o[n].errors.length;a++){var l=o[n].errors[a];r(l,e)}else{var s=o[n].data,p=o[n].url;s&&p&&i.push({url:p+"?download=zip",data:s})}TC.Util.downloadFileForm(i);t.map.getLoadingIndicator().removeWait(e)}else r({key:TC.Consts.WFSErrors.NoLayers},e)})}});t._$div.on(TC.Consts.event.CLICK,".tc-ctl-download-help",function(e){e.stopPropagation();TC.Util.showModal(t._$dialogDiv.find(t._classSelector+"-help-dialog"))})}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.Feature&&TC.feature.Point||TC.syncLoadJS(TC.apiLocation+"TC/feature/Point");TC.Feature&&TC.feature.Polyline||TC.syncLoadJS(TC.apiLocation+"TC/feature/Polyline");TC.Feature&&TC.feature.Polygon||TC.syncLoadJS(TC.apiLocation+"TC/feature/Polygon");TC.Consts.event.DRAWSTART="drawstart.tc";TC.Consts.event.DRAWEND="drawend.tc";TC.Consts.event.DRAWCANCEL="drawcancel.tc";TC.Consts.event.DRAWUNDO="drawundo.tc";TC.Consts.event.DRAWREDO="drawredo.tc";TC.Consts.event.MEASURE="measure.tc";TC.Consts.event.MEASUREPARTIAL="measurepartial.tc";TC.Consts.event.STYLECHANGE="stylechange.tc";TC.Consts.event.CHANGE="change.tc";!function(){TC.control.Draw=function(){var e=this;TC.Control.apply(e,arguments);e._classSelector="."+e.CLASS;e._pointClass=e.CLASS+"-point";e._lineClass=e.CLASS+"-line";e._polygonClass=e.CLASS+"-polygon";e.history=[];e.historyIndex=0;e.exportsState=!0;e.$events.on(TC.Consts.event.DRAWSTART,function(t){e.resetValues()});e.$events.on(TC.Consts.event.POINT,function(o){e.layer&&!e.persistent&&e.layer.features&&e.layer.features.length>0&&e.layer.clearFeatures();e.history.length=e.historyIndex;e.history[e.historyIndex++]=o.point;t(e)});e.$events.on(TC.Consts.event.DRAWEND,function(t){o(e);e.callBack&&e.callBack(t.feature)});e.layerPromise=$.Deferred();this.renderPromise().then(function(){e.reset=!0;e.callBack=null;e.measure=!1;e._cancelClick=!1;e.mode=e.options.mode||TC.Consts.geom.POLYLINE;e.options.measure&&(e.measure=e.options.measure);$.isFunction(e.options.callback)&&(e.callBack=e.options.callback);void 0===e.options.persistent?e.persistent=!0:e.persistent=e.options.persistent;e.wrap=new TC.wrap.control.Draw(e);e._$newBtn=e._$div.find(e._classSelector+"-btn-new").on(TC.Consts.event.CLICK,function(){e.new()});e._$cancelBtn=e._$div.find(e._classSelector+"-btn-cancel").on(TC.Consts.event.CLICK,function(){e.cancel()});e._$endBtn=e._$div.find(e._classSelector+"-btn-end").on(TC.Consts.event.CLICK,function(){e.end()});e._$undoBtn=e._$div.find(e._classSelector+"-btn-undo").on(TC.Consts.event.CLICK,function(){e.undo()});e._$redoBtn=e._$div.find(e._classSelector+"-btn-redo").on(TC.Consts.event.CLICK,function(){e.redo()});if(e.options.styleTools){e._$strokeColorPicker=e._$div.find(e._classSelector+"-str-c").on(TC.Consts.event.CHANGE,function(t){e.setStrokeColor(t.target.value)});e._$strokeWidthSelector=e._$div.find(e._classSelector+"-str-w").on(TC.Consts.event.CHANGE,function(t){e.setStrokeWidth(t.target.value)});e._$strokeWidthWatch=e._$div.find(e._classSelector+"-str-w-watch")}})};TC.inherit(TC.control.Draw,TC.Control);var e=TC.control.Draw.prototype;e.CLASS="tc-ctl-draw";var t=function(e){e._$endBtn.prop("disabled",0===e.historyIndex||e.mode===TC.Consts.geom.POLYGON&&e.historyIndex<3||e.mode===TC.Consts.geom.POLYLINE&&e.historyIndex<2);e._$redoBtn.prop("disabled",e.history.length===e.historyIndex);e._$undoBtn.prop("disabled",0===e.historyIndex)},o=function(e){e.resetValues();e._$endBtn.prop("disabled",!0);e._$cancelBtn.prop("disabled",!1)};TC.isDebug?e.template=TC.apiLocation+"TC/templates/Draw.html":e.template=function(){dust.register(e.CLASS,t);function t(e,t){return e.w('<div class="tc-ctl-draw-tools"><button class="tc-ctl-btn tc-ctl-draw-btn-new" title="').f(t.get(["tooltip"],!1),t,"h").w('">').h("i18n",t,{},{$key:"new"}).w('</button><button class="tc-ctl-btn tc-ctl-draw-btn-undo" disabled title="').h("i18n",t,{},{$key:"undo"}).w('">').h("i18n",t,{},{$key:"undo"}).w('</button><button class="tc-ctl-btn tc-ctl-draw-btn-redo" disabled title="').h("i18n",t,{},{$key:"redo"}).w('">').h("i18n",t,{},{$key:"redo"}).w('</button><button class="tc-ctl-btn tc-ctl-draw-btn-end" disabled title="').h("i18n",t,{},{$key:"end"}).w('">').h("i18n",t,{},{$key:"end"}).w('</button><button class="tc-ctl-btn tc-ctl-draw-btn-cancel" title="').h("i18n",t,{},{$key:"cancel"}).w('">').h("i18n",t,{},{$key:"cancel"}).w("</button></div>").x(t.get(["styleTools"],!1),t,{block:o},{})}t.__dustBody=!0;function o(e,t){return e.w('<div class="tc-ctl-draw-style">').h("i18n",t,{},{$key:"strokeColor"}).w('<input type="color" class="tc-ctl-col tc-ctl-draw-str-c" value="').f(t.get(["strokeColor"],!1),t,"h").w('" title="').h("i18n",t,{},{$key:"selectColor"}).w('" />').h("i18n",t,{},{$key:"strokeWidth"}).w('<div class="tc-ctl-draw-str-w-watch" style="border-bottom-width:').f(t.get(["strokeWidth"],!1),t,"h").w('px;"> </div><input type="number" class="tc-ctl-draw-str-w tc-textbox" value="').f(t.get(["strokeWidth"],!1),t,"h").w('" min="1" max="15" /></div>')}o.__dustBody=!0;return t};e.render=function(e){var t,o,r,i=this;switch(i.options.mode){case TC.Consts.geom.POLYLINE:case TC.Consts.geom.MULTIPOLYLINE:t=i.getLocaleString("drawLine");i._$div.addClass(i._lineClass);o=TC.Cfg.styles.line.strokeColor;r=TC.Cfg.styles.line.strokeWidth;break;case TC.Consts.geom.POLYGON:case TC.Consts.geom.MULTIPOLYGON:t=i.getLocaleString("drawPolygon");i._$div.addClass(i._polygonClass);o=TC.Cfg.styles.polygon.strokeColor;r=TC.Cfg.styles.polygon.strokeWidth;break;case TC.Consts.geom.POINT:case TC.Consts.geom.MULTIPOINT:t=i.getLocaleString("drawPoint");i._$div.addClass(i._pointClass);o=TC.Cfg.styles.point.strokeColor;r=TC.Cfg.styles.point.strokeWidth;break;default:t=i.getLocaleString("draw");o=TC.Cfg.styles.line.strokeColor;r=TC.Cfg.styles.line.strokeWidth}const n={tooltip:t,strokeColor:function(e){const t=e.match(/^#([0-9a-f])([0-9a-f])([0-9a-f])$/i);return t&&t.length?"#"+t[1]+t[1]+t[2]+t[2]+t[3]+t[3]:e}(o),strokeWidth:r,styleTools:i.options.styleTools};i.renderData(n,function(){Modernizr.inputtypes.color?$.isFunction(e)&&e():TC.loadJS(!$.fn.spectrum,TC.apiLocation+"lib/spectrum/spectrum.min.js",function(){TC.loadCSS(TC.apiLocation+"lib/spectrum/spectrum.css");i._$div.find("input[type=color]").spectrum({preferredFormat:"hex",showPalette:!0,palette:[],selectionPalette:[],cancelText:i.getLocaleString("cancel"),chooseText:i.getLocaleString("ok"),replacerClassName:i.CLASS+"-str-c"});$.isFunction(e)&&e()})})};e.register=function(e){var t=this;TC.Control.prototype.register.call(t,e);const o=function(){t.styles={};$.extend(!0,t.styles,t.options.styles||t.layer.options.styles)};e.loaded(function(){if(t.options.layer){t.setLayer(t.options.layer);o()}else"boolean"!=typeof t.options.layer&&e.addLayer({id:t.getUID(),title:"DrawControl",stealth:!0,type:TC.Consts.layerType.VECTOR,styles:{point:e.options.styles.point,line:e.options.styles.line,polygon:e.options.styles.polygon}}).then(function(r){t.layer=r;o();e.putLayerOnTop(t.layer);t.layerPromise.resolve(r)})})};e.new=function(){this.layer&&!this.persistent&&this.layer.clearFeatures();this._$cancelBtn.prop("disabled",!1);this.setMode(this.mode,!0);return this};e.undo=function(){var e=this.wrap.undo();if(e){this.historyIndex--;t(this);this.historyIndex<=0&&this.resetValues();this.$events.trigger($.Event(TC.Consts.event.DRAWUNDO))}return e};e.redo=function(){var e=this.wrap.redo();if(e){this.historyIndex++;t(this);this.$events.trigger($.Event(TC.Consts.event.DRAWREDO))}return e};e.cancel=function(){this._cancelClick=!0;this.setMode(null,!1);this.resetValues();o(this);this._$cancelBtn.prop("disabled",!0);this.$events.trigger($.Event(TC.Consts.event.DRAWCANCEL,{ctrl:this}));return this};e.activate=function(){this._$newBtn.addClass(TC.Consts.classes.ACTIVE);this._$cancelBtn.prop("disabled",!1);TC.Control.prototype.activate.call(this);this.wrap.activate(this.mode);this._$div.removeClass(this._pointClass).removeClass(this._lineClass).removeClass(this._polygonClass);switch(this.mode){case TC.Consts.geom.POINT:this._$div.addClass(this._pointClass);break;case TC.Consts.geom.POLYLINE:this._$div.addClass(this._lineClass);break;case TC.Consts.geom.POLYGON:this._$div.addClass(this._polygonClass)}};e.deactivate=function(){this._$newBtn&&this._$newBtn.removeClass(TC.Consts.classes.ACTIVE);this._$cancelBtn&&this._$cancelBtn.prop("disabled",!0);TC.Control.prototype.deactivate.call(this,!this._cancelClick);this.wrap&&this.wrap.deactivate();this.resetValues();this._cancelClick=!1};e.clear=function(){const e=this;e.layer&&e.layer.clearFatures();e.resetValues();return e};e.isExclusive=function(){return!0};e.end=function(){this.wrap.end();this.resetValues();return this};e.setMode=function(e,t){const o=this;e&&(o.mode=e);if(t&&e){o.layer&&o.layer.map.putLayerOnTop(o.layer);o.activate()}else o.deactivate();var r=t?TC.Consts.event.CONTROLACTIVATE:TC.Consts.event.CONTROLDEACTIVATE;o.map&&o.map.$events.trigger($.Event(r,{control:o}));return o};e.setStyle=function(e){const t=this;if(e)$.extend(t.style,e);else switch(t.options.mode){case TC.Consts.geom.POLYLINE:case TC.Consts.geom.MULTIPOLYLINE:e={line:t.styles.line};break;case TC.Consts.geom.POLYGON:case TC.Consts.geom.MULTIPOLYGON:e={polygon:t.styles.polygon};break;case TC.Consts.geom.POINT:case TC.Consts.geom.MULTIPOINT:e={point:t.styles.point};break;default:e={}}t.isActive&&t.wrap.setStyle(e)};e.getModeStyle=function(e){const t=this;switch(e=e||t.options.mode){case TC.Consts.geom.POLYLINE:case TC.Consts.geom.MULTIPOLYLINE:return t.styles.line;case TC.Consts.geom.POLYGON:case TC.Consts.geom.MULTIPOLYGON:return t.styles.polygon;case TC.Consts.geom.POINT:case TC.Consts.geom.MULTIPOINT:return t.styles.point;default:return null}};e.setStrokeColorWatch=function(e){const t=this;if(t.options.styleTools){void 0===e&&(e=t.getModeStyle().strokeColor);const o=e.match(/^#([0-9a-f])([0-9a-f])([0-9a-f])$/i);o&&o.length&&(e="#"+o[1]+o[1]+o[2]+o[2]+o[3]+o[3]);t._$strokeColorPicker.val(e);Modernizr.inputtypes.color||t._$strokeColorPicker.spectrum("set",e)}return t};e.setStrokeColor=function(e){const t=this,o=t.getModeStyle();o&&(o.strokeColor=e);t.isActive&&t.setStyle();t.setStrokeColorWatch(e);t.$events.trigger($.Event(TC.Consts.event.STYLECHANGE,{property:"strokeColor",value:e}));return t};e.setStrokeWidthWatch=function(e){const t=this;if(t.options.styleTools){void 0===e&&(e=t.getModeStyle().strokeWidth);if((e=parseInt(e,10))!==Number.NaN){t._$strokeWidthSelector.val(e);t._$strokeWidthWatch.css("border-bottom-width",e+"px")}}return t};e.setStrokeWidth=function(e){const t=this;if((e=parseInt(e,10))!==Number.NaN){const o=t.getModeStyle();o&&(o.strokeWidth=e);t.isActive&&t.setStyle();t.setStrokeWidthWatch(e);t.$events.trigger($.Event(TC.Consts.event.STYLECHANGE,{property:"strokeWidth",value:e}))}return t};e.getLayer=function(){return this.options&&"boolean"==typeof this.options.layer&&!this.options.layer?null:this.layer?this.layer:this.layerPromise};e.setLayer=function(e){if(this.map){this.layer="string"==typeof e?this.map.getLayer(e):e;this.layerPromise.resolve(this.layer)}};e.resetValues=function(){this.history.length=0;this.historyIndex=0;t(this);return this};e.exportState=function(){const e=this;return e.exportsState?{id:e.id,layer:e.layer.exportState()}:null};e.importState=function(e){$.when(this.getLayer()).then(function(t){t.importState(e.layer)})}}();TC.control=TC.control||{};TC.control.Measure||TC.syncLoadJS(TC.apiLocation+"TC/control/Measure");TC.control.DrawMeasureModify=function(){var e=this;TC.control.Measure.apply(e,arguments);e.persistentDrawControls=!0;e.renderPromise().then(function(){e._$coord=e._$div.find(".tc-ctl-meas-val-coord")});e._$dialogDiv=$(TC.Util.getDiv(e.options.dialogDiv));e.options.dialogDiv||e._$dialogDiv.appendTo("body");if(e.options.displayElevation){e.elevationActive=!0;e.elevationProfileActive=!0;TC.loadJS(!TC.tool||!TC.tool.Elevation,TC.apiLocation+"TC/tool/Elevation",function(){const t="boolean"==typeof e.options.displayElevation?{}:e.options.displayElevation;e.elevation=new TC.tool.Elevation(t)})}};TC.inherit(TC.control.DrawMeasureModify,TC.control.Measure);!function(){var e=TC.control.DrawMeasureModify.prototype;e.CLASS="tc-ctl-dmm";TC.Consts.event.DRAWCHART=TC.Consts.event.DRAWCHART||"drawchart.tc";const t=[],o=function(e){return t.filter(function(t){return t.feature===e})[0]},r=function(e){const o=t.reduce(function(t,o,r){return o.feature===e?r:t},-1);o>=0&&t.splice(o,1)};e.template={};if(TC.isDebug){e.template[e.CLASS]=TC.apiLocation+"TC/templates/DrawMeasureModify.html";e.template[e.CLASS+"-dialog"]=TC.apiLocation+"TC/templates/DrawMeasureModifyDialog.html"}else{e.template[e.CLASS]=function(){dust.register(e.CLASS,t);function t(e,t){return e.w("<h2>").h("i18n",t,{},{$key:"drawAndMeasure"}).w(' <span class="tc-beta">').h("i18n",t,{},{$key:"beta"}).w('</span></h2><div class="tc-ctl-meas-select"><form><label class="tc-ctl-meas-btn-pt"><input type="radio" name="mode" value="point" /><span>').h("i18n",t,{},{$key:"points"}).w('</span></label><label class="tc-ctl-meas-btn-len"><input type="radio" name="mode" value="polyline" /><span>').h("i18n",t,{},{$key:"lines"}).w('</span></label><label class="tc-ctl-meas-btn-area"><input type="radio" name="mode" value="polygon" /><span>').h("i18n",t,{},{$key:"polygons"}).w('</span></label></form></div><div class="tc-ctl-meas-mode tc-ctl-meas-pt tc-hidden"><div class="tc-ctl-meas-point"></div><div class="tc-ctl-meas-txt">').h("i18n",t,{},{$key:"search.list.coordinates"}).w(': <span class="tc-ctl-meas-val-coord"></span></div></div><div class="tc-ctl-meas-mode tc-ctl-meas-len tc-hidden"><div class="tc-ctl-meas-line"></div><div class="tc-ctl-meas-txt">').h("i18n",t,{},{$key:"2dLength"}).w(': <span class="tc-ctl-meas-val-len"></span><button class="tc-ctl-meas-prof-btn tc-active" title="').h("i18n",t,{},{$key:"deactivateElevationProfile"}).w('">').h("i18n",t,{},{$key:"geo.trk.chart.chpe"}).w('</button></div></div><div class="tc-ctl-meas-mode tc-ctl-meas-area tc-hidden"><div class="tc-ctl-meas-polygon"></div><div class="tc-ctl-meas-txt">').h("i18n",t,{},{$key:"area"}).w(': <span class="tc-ctl-meas-val-area"></span>, ').h("i18n",t,{},{$key:"2dPerimeter"}).w(': <span class="tc-ctl-meas-val-peri"></span></div></div><div class="tc-ctl-dmm-tool"><div class="tc-ctl-dmm-mod"></div><div class="tc-ctl-dmm-cmd"><button class="tc-ctl-dmm-btn-clr" disabled title="').h("i18n",t,{},{$key:"deleteAll"}).w('">').h("i18n",t,{},{$key:"deleteAll"}).w('</button><button class="tc-ctl-dmm-btn-dl" disabled title="').h("i18n",t,{},{$key:"download"}).w('">').h("i18n",t,{},{$key:"download"}).w("...</button></div></div>")}t.__dustBody=!0;return t};e.template[e.CLASS+"-dialog"]=function(){dust.register(e.CLASS+"-dialog",t);function t(e,t){return e.w('<div class="tc-ctl-dmm-dialog tc-modal"><div class="tc-modal-background tc-modal-close"></div><div class="tc-modal-window"><div class="tc-modal-header"><h3>').h("i18n",t,{},{$key:"downloadSketch"}).w('</h3><div class="tc-ctl-popup-close tc-modal-close"></div></div><div class="tc-modal-body"><div class="tc-ctl-dmm-dialog-ip"><h4>').h("i18n",t,{},{$key:"interpolateCoordsFromElevProfile"}).w('</h4><label><input type="radio" name="ip-coords" value="0" checked /><span>').h("i18n",t,{},{$key:"no"}).w('</span></label><label><input type="radio" name="ip-coords" value="1"/><span>').h("i18n",t,{},{$key:"yes"}).w('</span></label><div class="tc-ctl-dmm-dialog-ip-m tc-hidden">').h("i18n",t,{},{$key:"interpolateEveryXMeters.1"}).w('<input type="number" min="1" step="1" class="tc-textbox" value="').f(t.get(["interpolationInterval"],!1),t,"h").w('" />').h("i18n",t,{},{$key:"interpolateEveryXMeters.2"}).w('</div></div><div class="tc-ctl-dmm-dialog-dl"><button class="tc-button tc-btn-dl tc-ctl-dmm-dl-btn-kml" data-format="KML" title="KML">KML</button><button class="tc-button tc-btn-dl tc-ctl-dmm-dl-btn-gml" data-format="GML" title="GML">GML</button><button class="tc-button tc-btn-dl tc-ctl-dmm-dl-btn-geojson" data-format="GeoJSON" title="GeoJSON">GeoJSON</button><button class="tc-button tc-btn-dl tc-ctl-dmm-dl-btn-wkt" data-format="WKT" title="WKT">WKT</button><button class="tc-button tc-btn-dl tc-ctl-dmm-dl-btn-gpx" data-format="GPX" title="GPX">GPX</button></div></div></div></div>')}t.__dustBody=!0;return t}}e.render=function(e){var t=this;TC.control.Measure.prototype.render.call(t,function(){t._$clearBtn=t._$div.find(".tc-ctl-dmm-cmd button.tc-ctl-dmm-btn-clr").on(TC.Consts.event.CLICK,function(e){TC.confirm(t.getLocaleString("deleteAll.confirm"),function(){t.clear()})});t._$downloadBtn=t._$div.find(".tc-ctl-dmm-cmd button.tc-ctl-dmm-btn-dl").on(TC.Consts.event.CLICK,function(e){t.showSketchDownloadDialog()});t._$elevProfileBtn=t._$div.find(".tc-ctl-meas-prof-btn").on(TC.Consts.event.CLICK,function(e){t.elevationProfileActive?t.deactivateElevationProfile():t.activateElevationProfile()});t.options.displayElevation||t._$elevProfileBtn.hide();$.isFunction(e)&&e()});const o={};t.options.displayElevation&&(o.interpolationInterval=t.options.displayElevation.resolution);t.getRenderedHtml(t.CLASS+"-dialog",o,function(e){const o=function(e){const o={fileName:t.getLocaleString("sketch").toLowerCase().replace(" ","_")+"_"+TC.Util.getFormattedDate((new Date).toString(),!0),format:e};if(t.options.displayElevation){const e="1"===t._$dialogDiv.find("input[type=radio][name=ip-coords]:checked").val(),r={crs:t.map.crs,sampleNumber:0};r.resolution=e?t._$dialogDiv.find("."+t.CLASS+"-dialog-ip-m input[type=number]").val()||t.options.displayElevation.resolution:0;if(r.resolution){if(t.layer.features.reduce(function(e,t){switch(!0){case TC.feature.Polyline&&t instanceof TC.feature.Polyline:case TC.feature.Polygon&&t instanceof TC.feature.Polygon:return e+t.getLength();default:return e}},0)/r.resolution>t.options.displayElevation.maxCoordLength){TC.alert(t.getLocaleString("tooManyCoordinatesForElevation.warning"));return}}TC.Util.closeModal();const i=t.map.getLoadingIndicator(),n=i&&i.addWait();$.when.apply(this,t.layer.features.map(function(e){const i=TC.feature.Polygon&&e instanceof TC.feature.Polygon;if(i||TC.feature.Polyline&&e instanceof TC.feature.Polyline){const n=$.Deferred(),a=e.getData(),l=$.extend({coordinates:e.geometry},r);t.elevation.getElevation(l).then(function(t){const r=o.format===TC.Consts.format.GPX?Number.NaN:0;t.forEach(function(e){null===e[2]&&(e[2]=r)});const l=i?new TC.feature.Polygon([t],e.options):new TC.feature.Polyline(t,e.options);l.setData(a);l.setStyle(e.getStyle());n.resolve(l)},function(e){n.reject(e)});return n.promise()}return e})).then(function(){i&&i.removeWait(n);t.map.exportFeatures(Array.prototype.slice.call(arguments),o)},function(e){i&&i.removeWait(n);TC.error(t.getLocaleString("elevation.error"))})}else{TC.Util.closeModal();t.map.exportFeatures(t.layer.features,o)}};t._$dialogDiv.html(e).on("change","input[type=radio][name=ip-coords]",function(e){t._$dialogDiv.find("."+t.CLASS+"-dialog-ip-m").toggleClass(TC.Consts.classes.HIDDEN,"0"===e.target.value)}).on(TC.Consts.event.CLICK,"button[data-format]",function(e){const r=$(e.target).data("format");r===TC.Consts.format.GPX&&t.layer.features.some(function(e){return TC.feature.Polygon&&e instanceof TC.feature.Polygon})?TC.confirm(t.getLocaleString("gpxNotCompatible.confirm"),function(){o(r)}):o(r)})})};e.register=function(e){const i=this;TC.control.Measure.prototype.register.call(i,e);const n=i.getUID(),a=i.getUID();$.when(i.layerPromise,i.renderPromise()).then(function(l){i._modifyPromise=e.addControl("modify",{id:a,div:i._$div.find("."+i.CLASS+"-mod"),layer:l});i._modifyPromise.then(function(t){i.modify=t;t.on(TC.Consts.event.FEATURESSELECT,function(e){const t=e.features[e.features.length-1];if(t){i.showMeasures(i.getFeatureMeasureData(t));const e=t._originalStyle||t.getStyle();switch(!0){case TC.feature.Polygon&&t instanceof TC.feature.Polygon:i.displayMode(TC.Consts.geom.POLYGON);i.drawPolygons.setStrokeColorWatch(e.strokeColor).setStrokeWidthWatch(e.strokeWidth);break;case TC.feature.Polyline&&t instanceof TC.feature.Polyline:i.displayMode(TC.Consts.geom.POLYLINE);i.drawLines.setStrokeColorWatch(e.strokeColor).setStrokeWidthWatch(e.strokeWidth);const r=o(t);r&&i.renderElevationChart(r.data);break;case TC.feature.Point&&t instanceof TC.feature.Point:i.displayMode(TC.Consts.geom.POINT);i.drawPoints.setStrokeColorWatch(e.strokeColor).setStrokeWidthWatch(e.strokeWidth)}i.modify.setFontColorWatch(e.fontColor).setFontSizeWatch(e.fontSize)}}).on(TC.Consts.event.FEATURESUNSELECT,function(e){i.modify.getSelectedFeatures().length||i.resetDrawWatches();i.resetElevationProfile();i.resultsPanelChart&&i.resultsPanelChart.hide()}).on(TC.Consts.event.FEATUREMODIFY,function(e){if(e.layer===i.layer){r(e.feature);const t=function(e){const t=i.getFeatureMeasureData(e);i.showMeasures(t);i.setFeatureMeasureData(e)};t(e.feature);i.options.displayElevation&&i.elevation.setGeometry({feature:e.feature,crs:i.map.crs}).then(t);i.map.getControlsByClass("TC.control.Popup").forEach(function(t){t.isVisible()&&t.currentFeature===e.feature&&t.hide()})}});e.on(TC.Consts.event.CONTROLDEACTIVATE,function(e){if(e.control===i.modify){i.resetDrawWatches();i.resetElevationProfile();i.resultsPanelChart&&i.resultsPanelChart.hide()}else if(e.control===i.drawLines){i.resetElevationProfile();i.resultsPanelChart&&i.resultsPanelChart.hide()}}).on(TC.Consts.event.FEATURECLICK,function(t){if(TC.feature.Polyline&&t.feature instanceof TC.feature.Polyline&&i.layer.features.indexOf(t.feature)>=0){const r=o(t.feature);r?i.renderElevationChart(r.data):i.displayElevationProfile(t.feature.geometry);i.elevationProfileActive&&e.getControlsByClass("TC.control.Popup").forEach(function(e){e.currentFeature===t.feature&&e.hide()})}})});i._drawLinesPromise.then(function(e){e.$events.on(TC.Consts.event.DRAWSTART,function(){i.resetValues()}).on(TC.Consts.event.DRAWUNDO+" "+TC.Consts.event.DRAWREDO,function(){i.displayElevationProfile(this.history.slice(0,this.historyIndex))}).on(TC.Consts.event.POINT,function(e){const t=this.history.slice(0,this.historyIndex),o=t[t.length-1];o[0]===e.point[0]&&o[1]===e.point[1]||t.push(e.point);i.displayElevationProfile(t)}).on(TC.Consts.event.STYLECHANGE,function(e){i.onStyleChange(e)})});i._drawPolygonsPromise.then(function(e){e.$events.on(TC.Consts.event.DRAWSTART,function(){i.resetValues()}).on(TC.Consts.event.DRAWEND,function(e){i.options.displayElevation&&i.elevation.setGeometry({feature:e.feature,crs:i.map.crs})}).on(TC.Consts.event.STYLECHANGE,function(e){i.onStyleChange(e)})});i._drawPointsPromise=e.addControl("draw",{id:n,div:i._$div.find("."+TC.control.Measure.prototype.CLASS+"-point"),mode:TC.Consts.geom.POINT,persistent:i.persistentDrawControls,styleTools:!0,layer:i.layer});i._drawPointsPromise.then(function(t){t.containerControl=i;i.drawControls.push(t);i.drawPoints=t;i.resetValues();t.$events.on(TC.Consts.event.DRAWEND,function(t){const o=function(t){i.showMeasures({coords:t.geometry,units:e.wrap.isGeo()?"degrees":"m"});i.setFeatureMeasureData(t)};o(t.feature);i.options.displayElevation&&i.elevation.setGeometry({feature:t.feature,crs:i.map.crs}).then(o)}).on(TC.Consts.event.DRAWCANCEL,function(e){i.cancel()}).on(TC.Consts.event.STYLECHANGE,function(e){i.onStyleChange(e)});t.exportsState=!1});i.setMode(i.options.mode);e.on(TC.Consts.event.FEATUREADD,function(e){if(e.layer===i.layer){i.setFeatureMeasureData(e.feature);i._modifyPromise.then(function(t){t.displayLabelText(e.feature.getStyle().label)});i._$clearBtn.prop("disabled",!1);i._$downloadBtn.prop("disabled",!1)}}).on(TC.Consts.event.FEATUREREMOVE+" "+TC.Consts.event.FEATURESCLEAR,function(e){if(e.layer===i.layer)if(0===i.layer.features.length){i._$clearBtn.prop("disabled",!0);i._$downloadBtn.prop("disabled",!0);i.resetValues();t.length=0}else e.feature&&r(e.feature)})})};e.displayMode=function(e){const t=this;e===TC.Consts.geom.POINT&&(t._$activeMode=t._$div.find(".tc-ctl-meas-pt"));t.modify&&t.modify._$div.removeClass(TC.Consts.classes.COLLAPSED);return TC.control.Measure.prototype.displayMode.call(t,e)};e.setMode=function(e){const t=this;e===TC.Consts.geom.POINT&&t.drawPoints.activate();return TC.control.Measure.prototype.setMode.call(t,e)};e.setFeatureMeasureData=function(e){const t=this,o={};switch(!0){case TC.feature.Point&&e instanceof TC.feature.Point:o[t.getLocaleString("search.list.coordinates")]=t._$coord.html();e.setData(o);break;case TC.feature.Polyline&&e instanceof TC.feature.Polyline:o[t.getLocaleString("2dLength")]=t._$len.html();e.setData(o);break;case TC.feature.Polygon&&e instanceof TC.feature.Polygon:o[t.getLocaleString("area")]=t._$area.html();o[t.getLocaleString("2dPerimeter")]=t._$peri.html();e.setData(o)}return t};e.getFeatureMeasureData=function(e){const t=this,r={units:"m"},i={};t.map.wrap.isGeo()&&(i.crs=TC.Cfg.utmCrs);switch(!0){case TC.feature.Polygon&&e instanceof TC.feature.Polygon:r.area=e.getArea(i);r.perimeter=e.getLength(i);break;case TC.feature.Polyline&&e instanceof TC.feature.Polyline:r.length=e.getLength(i);const n=o(e);n?t.renderElevationChart(n.data):t.displayElevationProfile(e.geometry);break;case TC.feature.Point&&e instanceof TC.feature.Point:r.coords=e.geometry}return r};e.showMeasures=function(e){const t=this;TC.control.Measure.prototype.showMeasures.call(t,e);(e=e||{}).units;const o=t.map.options.locale||TC.Cfg.locale;if(e.coords){var r="m"===e.units?"x: "+TC.Util.formatNumber(e.coords[0].toFixed(TC.Consts.METER_PRECISION),o)+", y: "+TC.Util.formatNumber(e.coords[1].toFixed(TC.Consts.METER_PRECISION),o):TC.Util.formatNumber(e.coords[1].toFixed(TC.Consts.DEGREE_PRECISION),o)+", "+TC.Util.formatNumber(e.coords[0].toFixed(TC.Consts.DEGREE_PRECISION),o);e.coords.length>2&&(r+=", "+t.getLocaleString("ele")+": "+TC.Util.formatNumber(e.coords[2].toFixed(TC.Consts.METER_PRECISION)));t._$coord.html(r)}return t};e.resetValues=function(){const e=this;TC.control.Measure.prototype.resetValues.call(e);e._$coord&&e._$coord.text(e.NOMEASURE);return e};e.resetDrawWatches=function(){this.drawControls.forEach(function(e){e.setStrokeColorWatch().setStrokeWidthWatch()})};e.clear=function(){const e=this;e.resetValues();e.layer.clearFeatures();e.modify.isActive&&e.modify.deactivate();if(e.options.displayElevation){e.resetElevationProfile();e.resultsPanelChart&&e.resultsPanelChart.hide()}e._$clearBtn.prop("disabled",!0);e._$downloadBtn.prop("disabled",!0);return e};e.showSketchDownloadDialog=function(e){const t=this._$dialogDiv.find("."+this.CLASS+"-dialog");t.find("."+this.CLASS+"-dialog-ip").toggleClass(TC.Consts.classes.HIDDEN,!this.layer.features.some(function(e){return TC.feature.Polyline&&e instanceof TC.feature.Polyline||TC.feature.Polygon&&e instanceof TC.feature.Polygon}));TC.Util.showModal(t,e);return this};e.onStyleChange=function(e){const t=this;var o;switch(e.target.mode){case TC.Consts.geom.POLYGON:o=TC.feature.Polygon;break;case TC.Consts.geom.POLYLINE:o=TC.feature.Polyline;break;case TC.Consts.geom.POINT:o=TC.feature.Point}o&&t.modify.getSelectedFeatures().forEach(function(t){if(t instanceof o){const o={};o[e.property]=e.value;t.setStyle(o)}})};e.displayElevationProfile=function(r){const i=this;1===r.length&&(r=r.slice()).push(r[0]);const n=i.map.getLoadingIndicator(),a=n&&n.addWait();i.elevation.getElevation({crs:i.map.crs,coordinates:r}).then(function(l){n&&n.removeWait(a);var s=0,p=Number.NEGATIVE_INFINITY,c=Number.POSITIVE_INFINITY;const u=l.map(function(e,t,o){const r=0===t?e:o[t-1],i=e[0]-r[0],n=e[1]-r[1];s+=Math.sqrt(i*i+n*n);var a=e[2];if("number"==typeof a){p=Math.max(a,p);c=Math.min(a,c)}return[s,a]});i.elevationProfileData={x:u.map(function(e){return e[0]}),ele:u.map(function(e){return e[1]}),coords:l};const g={coords:l};"object"==typeof i.options.displayElevation&&(g.hillDeltaThreshold=i.options.displayElevation.hillDeltaThreshold);$.extend(i.elevationProfileData,TC.tool.Elevation.getElevationGain(g));const d=i.layer.features.filter(function(e){return TC.feature.Polyline&&e instanceof TC.feature.Polyline}).filter(function(e){for(var t=0,o=r.length;t<o;t++){const o=r[t],i=e.geometry[t];if(o[0]!==i[0]||o[1]!==i[1])return!1}return!0})[0];d&&function(e,r){var i=o(e);if(!i){i={feature:e};t.push(i)}i.data=r}(d,i.elevationProfileData);if(i.resultsPanelChart)i.renderElevationChart();else{const t=i.map.getControlsByClass(TC.control.ResultsPanel).filter(function(e){return"chart"===e.options.content})[0],o=t?t._$div:$("<div>").appendTo(i.map._$div);i.map.addControl("resultsPanel",{id:i.getUID(),div:o,content:"chart",titles:{main:i.getLocaleString("geo.trk.chart.chpe"),max:i.getLocaleString("geo.trk.chart.chpe")},chart:{ctx:i,onmouseout:e.removeElevationTooltip,tooltip:e.getElevationTooltip}}).then(function(e){i.resultsPanelChart=e;i.resultsPanelChart.render(function(){i.renderElevationChart()})})}},function(e){i.resetElevationProfile();n&&n.removeWait(a)})};e.renderElevationChart=function(e){const t=this;t.elevationProfileData=e||t.elevationProfileData;if(t.resultsPanelChart&&t.elevationProfileActive){t.resultsPanelChart.openChart(t.elevationProfileData);t.resultsPanelChart.isMinimized()||t.resultsPanelChart.show()}};e.getElevationTooltip=function(e){this.resultsPanelChart.wrap.showElevationMarker({data:e,layer:this.layer,coords:this.elevationProfileData.coords});return this.resultsPanelChart.getElevationChartTooltip(e)};e.removeElevationTooltip=function(){this.resultsPanelChart.wrap.hideElevationMarker()};e.activateElevationProfile=function(){const e=this;e.elevationProfileActive=!0;e._$elevProfileBtn.addClass(TC.Consts.classes.ACTIVE).attr("title",e.getLocaleString("deactivateElevationProfile"));var t=!1;if(e.drawLines.historyIndex>1){e.displayElevationProfile(e.drawLines.history.slice(0,e.drawLines.historyIndex));t=!0}else{const o=e.modify.getActiveFeatures().filter(function(e){return TC.feature.Polyline&&e instanceof TC.feature.Polyline});if(o.length){const r=o[o.length-1];e.displayElevationProfile(r.geometry);t=!0}}t||e.resetElevationProfile();e.resultsPanelChart&&e.resultsPanelChart.show()};e.deactivateElevationProfile=function(){const e=this;e.elevationProfileActive=!1;e._$elevProfileBtn.removeClass(TC.Consts.classes.ACTIVE).attr("title",e.getLocaleString("activateElevationProfile"));e.resetElevationProfile();e.resultsPanelChart&&e.resultsPanelChart.hide()};e.resetElevationProfile=function(){const e=this;if(e.options.displayElevation){e.elevationProfileData={x:[0],ele:[0],coords:[0,0,0],upHill:0,downHill:0};e.resultsPanelChart&&e.renderElevationChart()}}}();TC.control=TC.control||{};TC.control.SWCacheClient||TC.syncLoadJS(TC.apiLocation+"TC/control/SWCacheClient");TC.Consts.editMode={SELECT:"select",ADDPOINT:"addpoint",ADDLINE:"addline",ADDPOLYGON:"addpolygon"};TC.Consts.editStyles={NEW:"temporary",SELECTED:"select",DEFAULT:"default"};TC.Consts.event.POINT="point.tc";TC.Consts.event.BEFOREFEATUREMODIFY="beforefeaturemodify.tc";TC.Consts.event.FEATUREMODIFY="featuremodify.tc";TC.Consts.event.FEATURESSELECT="featureselect.tc";TC.Consts.event.FEATURESUNSELECT="featureunselect.tc";!function(){var e=0,t=function(e,t){var o=$.Deferred();TC.loadJS(!window.localforage,[TC.Consts.url.LOCALFORAGE],function(){var r,i;switch(!0){case t instanceof TC.feature.Polygon:i=TC.Consts.geom.POLYGON;break;case t instanceof TC.feature.Polyline:i=TC.Consts.geom.POLYLINE;break;case t instanceof TC.feature.Point:i=TC.Consts.geom.POINT;break;case t instanceof TC.feature.MultiPolygon:i=TC.Consts.geom.MULTIPOLYGON;break;case t instanceof TC.feature.MultiPolyline:i=TC.Consts.geom.MULTIPOLYLINE}r={id:t.id||t.provId,attributes:t.data,type:i,geometry:t.geometry};localforage.setItem(e,r).then(function(){o.resolve({feature:t})}).catch(function(e){o.reject({feature:t,error:e})})});return o.promise()},o=function(e){var t=$.Deferred();TC.loadJS(!window.localforage,[TC.Consts.url.LOCALFORAGE],function(){localforage.removeItem(e).then(function(){t.resolve(e)}).catch(function(e){t.reject(e)})});return t.promise()},r=function(e){var t=$.Deferred();TC.loadJS(!window.localforage,[TC.Consts.url.LOCALFORAGE],function(){localforage.getItem(e).then(function(o){t.resolve({key:e,feature:o})}).catch(function(e){t.reject(e)})});return t.promise()},i=function(e,t){return e.LOCAL_STORAGE_KEY_PREFIX+(t||e.layer.id)},n=function(e,t){return i(e,t)+e.LOCAL_STORAGE_ADDED_KEY_PREFIX},a=function(e,t){return i(e,t)+e.LOCAL_STORAGE_MODIFIED_KEY_PREFIX},l=function(e,t){return i(e,t)+e.LOCAL_STORAGE_REMOVED_KEY_PREFIX},s=function(e){var t=!1;(TC.feature.MultiPolygon&&e instanceof TC.feature.MultiPolygon||TC.feature.MultiPolyline&&e instanceof TC.feature.MultiPolyline)&&e.geometry.length>1&&(t=!0);return t},p=function(e,t){e._$deleteBtn.prop("disabled",0===t.length);e._$joinBtn.prop("disabled",t.length<2);e._$splitBtn.prop("disabled",0===t.filter(s).length)},c=function(e,t){e._$saveBtn.prop("disabled",t);e._$discardBtn.prop("disabled",t);self.checkedOut=!t},u=function(e,t){void 0!==t?c(e,!t):TC.loadJS(!window.localforage,[TC.Consts.url.LOCALFORAGE],function(){var t=i(e);localforage.keys().then(function(o){if(o){for(var r=!0,i=0,n=o.length;i<n;i++)if(0===o[i].indexOf(t)){r=!1;break}c(e,r)}})})},g=function(e,t){var o=$.Deferred(),r=e._changesLayers[t.id];if(r)o.resolve(r);else{r=e._changesLayers[t.id]=new TC.layer.Vector({id:TC.getUID(),title:t.title+" - cambios pendientes",stealth:!0,styles:e.getChangesLayerStyle(t)});var i=e.map.layers.indexOf(t);e.map.insertLayer(r,i+1,function(){o.resolve(r)})}return o.promise()};TC.control.Edit=function(){var r=this;TC.control.SWCacheClient.apply(this,arguments);r._classSelector="."+r.CLASS;r.$events=$(r);r.wrap=new TC.wrap.control.Edit(r);r._layerDeferred=$.Deferred();r.layer=null;r.checkedOut=!1;r.callback=arguments[2]&&$.isFunction(arguments[2])?arguments[2]:r.options.callback?r.options.callback:null;r.multi=!!r.options.multi&&r.options.multi;r.eraseActionConfirmTxt=r.options.eraseText?r.options.eraseText:"\xbfEst\xe1 seguro de eliminar esta(s) geometr\xeda(s)?";r.cancelActionConfirmTxt=r.options.cancelText?r.options.eraseText:"Si continua todos los cambios se perder\xe1n. \xbfDesea continuar?";r.styles=r.options.styles;r.features={};r.attributeEditor=null;r.pointDraw=null;r.lineDraw=null;r.polygonDraw=null;r.snapping="boolean"!=typeof r.options.snapping||r.options.snapping;r._changesLayers={};r._showsChanges="boolean"!=typeof r.options.showChanges||r.options.showChanges;$.isFunction(r.options.getChangesLayerStyleFunction)&&(r.getChangesLayerStyleFunction=r.getChangesLayerStyle);r.$events.on(TC.Consts.event.FEATUREADD,function(o){var i=o.feature;i.provId="NewFeature."+e++;var a=r._changesLayers[r.layer.id];r.features[r.layer.id].added.push(i);a.addFeature(i);t(n(r)+i.provId,i).then(function(){u(r,!0);TC.toast("Adici\xf3n guardada")},function(){TC.error("Fallo al guardar adici\xf3n")})}).on(TC.Consts.event.FEATUREREMOVE,function(e){var i=e.feature,s=i.provId||i.id,p=function(){u(r);TC.toast("Eliminaci\xf3n guardada")},c=function(){TC.error("Fallo al guardar eliminaci\xf3n")},g=r._changesLayers[r.layer.id],d=r.features[r.layer.id],h=d.added.indexOf(i);if(h<0){var f=l(r);if((h=d.modified.indexOf(i))<0){if((h=d.removed.indexOf(i))<0){d.removed.push(i);g.addFeature(i);t(f+i.id,i).then(p,c)}}else{d.modified.splice(h,1);d.removed.push(i);o(a(r)+i.id).then(function(){p();t(f+i.id,i).then(p,c)},c)}}else{g.removeFeature(i);d.added.splice(h,1);o(n(r)+s).then(p,c)}}).on(TC.Consts.event.FEATUREMODIFY,function(e){var o=e.feature,i=o.provId||o.id,l=function(){u(r,!0);TC.toast("Modificaci\xf3n guardada")},s=function(){TC.error("Fallo al guardar modificaci\xf3n")},p=r._changesLayers[r.layer.id],c=r.features[r.layer.id],g=c.added.indexOf(o);if(g<0){if((g=c.modified.indexOf(o))<0){p.addFeature(o);c.modified.push(o)}t(a(r)+i,o).then(l,s)}else t(n(r)+i,o).then(l,s)}).on(TC.Consts.event.FEATUREADD+" "+TC.Consts.event.FEATUREREMOVE+" "+TC.Consts.event.FEATUREMODIFY,function(e){if(r.serviceWorkerEnabled&&navigator.onLine){var t=r.layer.wrap.getGetFeatureUrl(),o=r.layer.wrap.getDescribeFeatureTypeUrl();t&&o&&r.createCache(r.LOCAL_STORAGE_KEY_PREFIX+r.layer.id,{urlList:[t,o]})}}).on(TC.Consts.event.CONTROLDEACTIVATE,function(e){}).on(TC.Consts.event.FEATURESSELECT,function(e){var t=r.getSelectedFeatures();p(r,t);t.length&&t[0].showPopup(r.attributeEditor)}).on(TC.Consts.event.FEATURESUNSELECT,function(e){p(r,r.getSelectedFeatures())})};TC.inherit(TC.control.Edit,TC.control.SWCacheClient);var d=TC.control.Edit.prototype;d.CLASS="tc-ctl-edit";d.LOCAL_STORAGE_KEY_PREFIX="TC.offline.edit.";d.LOCAL_STORAGE_ADDED_KEY_PREFIX=".added.";d.LOCAL_STORAGE_MODIFIED_KEY_PREFIX=".modified.";d.LOCAL_STORAGE_REMOVED_KEY_PREFIX=".removed.";d.template={};if(TC.isDebug){d.template[d.CLASS]=TC.apiLocation+"TC/templates/Edit.html";d.template[d.CLASS+"-attr"]=TC.apiLocation+"TC/templates/EditAttributes.html"}else{d.template[d.CLASS]=function(){dust.register(d.CLASS,e);function e(e,r){return e.w("<h2>").h("i18n",r,{},{$key:"featureEdit"}).w(' <span class="tc-beta">').h("i18n",r,{},{$key:"beta"}).w('</span></h2><div class="tc-ctl-edit-layer"><select class="tc-combo tc-ctl-edit-layer-sel"><option value="">').h("i18n",r,{},{$key:"selectLayerToEdit"}).w("</option>").s(r.get(["layers"],!1),r,{block:t},{}).w('</select><input type="checkbox" id="tc-ctl-edit-view-changes-cb"').x(r.get(["showChanges"],!1),r,{block:o},{}).w(' /><label class="tc-ctl-edit-view-changes" for="tc-ctl-edit-view-changes-cb">').h("i18n",r,{},{$key:"highlightUnsyncedChanges"}).w('</label></div><div class="tc-ctl-edit-mode"><form><label class="tc-ctl-edit-btn-select" title="').h("i18n",r,{},{$key:"select"}).w('"><input type="radio" name="mode" value="select" /><span>').h("i18n",r,{},{$key:"select"}).w('</span></label><label class="tc-ctl-edit-btn-point" title="').h("i18n",r,{},{$key:"newPoint"}).w('"><input type="radio" name="mode" value="addpoint" /><span>').h("i18n",r,{},{$key:"newPoint"}).w('</span></label><label class="tc-ctl-edit-btn-line" title="').h("i18n",r,{},{$key:"newLine"}).w('"><input type="radio" name="mode" value="addline" /><span>').h("i18n",r,{},{$key:"newLine"}).w('</span></label><label class="tc-ctl-edit-btn-polygon" title="').h("i18n",r,{},{$key:"newPolygon"}).w('"><input type="radio" name="mode" value="addpolygon" /><span>').h("i18n",r,{},{$key:"newPolygon"}).w('</span></label></form></div><div class="tc-ctl-edit-select tc-hidden"><button class="tc-ctl-btn tc-ctl-edit-btn-delete" disabled title="').h("i18n",r,{},{$key:"delete"}).w('">').h("i18n",r,{},{$key:"delete"}).w('</button><button class="tc-ctl-btn tc-ctl-edit-btn-join" disabled title="').h("i18n",r,{},{$key:"joinGeometries.tooltip"}).w('">').h("i18n",r,{},{$key:"joinGeometries"}).w('</button><button class="tc-ctl-btn tc-ctl-edit-btn-split" disabled title="').h("i18n",r,{},{$key:"splitGeometry"}).w('">').h("i18n",r,{},{$key:"splitGeometry"}).w('</button><button class="tc-ctl-btn tc-ctl-edit-btn-cancel" disabled title="').h("i18n",r,{},{$key:"cancel"}).w('">').h("i18n",r,{},{$key:"cancel"}).w('</button></div><div class="tc-ctl-edit-point tc-hidden"></div><div class="tc-ctl-edit-line tc-hidden"></div><div class="tc-ctl-edit-polygon tc-hidden"></div><div class="tc-ctl-edit-save"><button class="tc-button tc-icon-button tc-ctl-edit-btn-save" disabled title="').h("i18n",r,{},{$key:"syncChanges"}).w('">').h("i18n",r,{},{$key:"syncChanges"}).w('</button><button class="tc-button tc-icon-button tc-ctl-edit-btn-discard" disabled title="').h("i18n",r,{},{$key:"discardChanges"}).w('">').h("i18n",r,{},{$key:"discardChanges"}).w("</button></div>")}e.__dustBody=!0;function t(e,t){return e.w('<option value="').f(t.get(["id"],!1),t,"h").w('">').f(t.get(["title"],!1),t,"h").w("</option>")}t.__dustBody=!0;function o(e,t){return e.w(" checked")}o.__dustBody=!0;return e};d.template[d.CLASS+"-attr"]=function(){dust.register(d.CLASS+"-attr",t);var e={inputText:R,inputNumber:A,inputCheckbox:M,inputDate:O,inputTime:N,inputDatetime:D};function t(t,r){r=r.shiftBlocks(e);return t.w('<div class="tc-ctl-edit-attr"><h3>').h("i18n",r,{},{$key:"attributeEdit"}).w('</h3><div class="tc-ctl-edit-attr-body"><table><tbody>').s(r.get(["data"],!1),r,{block:o},{}).w('</tbody></table></div><div class="tc-ctl-edit-attr-footer"><button class="tc-button tc-ctl-edit-btn-attr-ok">').h("i18n",r,{},{$key:"ok"}).w('</button><button class="tc-button tc-ctl-edit-btn-attr-cancel">').h("i18n",r,{},{$key:"cancel"}).w("</button></div></div>")}t.__dustBody=!0;function o(t,o){o=o.shiftBlocks(e);return t.w("<tr><th>").f(o.get(["name"],!1),o,"h").w("</th><td>").x(o.get(["readOnly"],!1),o,{else:r,block:F},{}).w("</td></tr>")}o.__dustBody=!0;function r(t,o){o=o.shiftBlocks(e);return t.x(o.get(["availableValues"],!1),o,{block:i},{}).h("select",o,{block:a},{key:o.get(["type"],!1)})}r.__dustBody=!0;function i(t,o){o=o.shiftBlocks(e);return t.w('<select class="tc-combo" name="').f(o.get(["name"],!1),o,"h").w('"><option value=""></option>').s(o.get(["availableValues"],!1),o,{block:n},{}).w("</select>")}i.__dustBody=!0;function n(t,o){o=o.shiftBlocks(e);return t.w('<option value="').f(o.getPath(!0,[]),o,"h").w('">').f(o.getPath(!0,[]),o,"h").w("</option>")}n.__dustBody=!0;function a(t,o){o=o.shiftBlocks(e);return t.h("none",o,{block:l},{}).h("eq",o,{block:s},{value:"int"}).h("eq",o,{block:p},{value:"integer"}).h("eq",o,{block:c},{value:"double"}).h("eq",o,{block:u},{value:"boolean"}).h("eq",o,{block:g},{value:"date"}).h("eq",o,{block:h},{value:"time"}).h("eq",o,{block:f},{value:"dateTime"}).h("eq",o,{block:y},{value:"byte"}).h("eq",o,{block:m},{value:"long"}).h("eq",o,{block:v},{value:"negativeInteger"}).h("eq",o,{block:C},{value:"nonNegativeInteger"}).h("eq",o,{block:T},{value:"nonPositiveInteger"}).h("eq",o,{block:S},{value:"positiveInteger"}).h("eq",o,{block:_},{value:"short"}).h("eq",o,{block:E},{value:"unsignedLong"}).h("eq",o,{block:x},{value:"unsignedInt"}).h("eq",o,{block:P},{value:"unsignedShort"}).h("eq",o,{block:L},{value:"unsignedByte"}).h("eq",o,{block:w},{value:"float"}).h("eq",o,{block:b},{value:"decimal"})}a.__dustBody=!0;function l(t,o){o=o.shiftBlocks(e);return t.b(o.getBlock("inputText"),o,{},{})}l.__dustBody=!0;function s(t,o){o=o.shiftBlocks(e);return t.b(o.getBlock("inputNumber"),o,{},{})}s.__dustBody=!0;function p(t,o){o=o.shiftBlocks(e);return t.b(o.getBlock("inputNumber"),o,{},{})}p.__dustBody=!0;function c(t,o){o=o.shiftBlocks(e);return t.b(o.getBlock("inputNumber"),o,{},{})}c.__dustBody=!0;function u(t,o){o=o.shiftBlocks(e);return t.b(o.getBlock("inputCheckbox"),o,{},{})}u.__dustBody=!0;function g(t,o){o=o.shiftBlocks(e);return t.b(o.getBlock("inputDate"),o,{},{})}g.__dustBody=!0;function h(t,o){o=o.shiftBlocks(e);return t.b(o.getBlock("inputTime"),o,{},{})}h.__dustBody=!0;function f(t,o){o=o.shiftBlocks(e);return t.b(o.getBlock("inputDatetime"),o,{},{})}f.__dustBody=!0;function y(t,o){o=o.shiftBlocks(e);return t.b(o.getBlock("inputNumber"),o,{},{})}y.__dustBody=!0;function m(t,o){o=o.shiftBlocks(e);return t.b(o.getBlock("inputNumber"),o,{},{})}m.__dustBody=!0;function v(t,o){o=o.shiftBlocks(e);return t.b(o.getBlock("inputNumber"),o,{},{})}v.__dustBody=!0;function C(t,o){o=o.shiftBlocks(e);return t.b(o.getBlock("inputNumber"),o,{},{})}C.__dustBody=!0;function T(t,o){o=o.shiftBlocks(e);return t.b(o.getBlock("inputNumber"),o,{},{})}T.__dustBody=!0;function S(t,o){o=o.shiftBlocks(e);return t.b(o.getBlock("inputNumber"),o,{},{})}S.__dustBody=!0;function _(t,o){o=o.shiftBlocks(e);return t.b(o.getBlock("inputNumber"),o,{},{})}_.__dustBody=!0;function E(t,o){o=o.shiftBlocks(e);return t.b(o.getBlock("inputNumber"),o,{},{})}E.__dustBody=!0;function x(t,o){o=o.shiftBlocks(e);return t.b(o.getBlock("inputNumber"),o,{},{})}x.__dustBody=!0;function P(t,o){o=o.shiftBlocks(e);return t.b(o.getBlock("inputNumber"),o,{},{})}P.__dustBody=!0;function L(t,o){o=o.shiftBlocks(e);return t.b(o.getBlock("inputNumber"),o,{},{})}L.__dustBody=!0;function w(t,o){o=o.shiftBlocks(e);return t.b(o.getBlock("inputNumber"),o,{},{})}w.__dustBody=!0;function b(t,o){o=o.shiftBlocks(e);return t.b(o.getBlock("inputNumber"),o,{},{})}b.__dustBody=!0;function R(t,o){o=o.shiftBlocks(e);return t.w('<input type="text" class="tc-textbox" name="').f(o.get(["name"],!1),o,"h").w('" value="').f(o.get(["value"],!1),o,"h").w('" />')}R.__dustBody=!0;function A(t,o){o=o.shiftBlocks(e);return t.w('<input type="number" class="tc-textbox" name="').f(o.get(["name"],!1),o,"h").w('" value="').f(o.get(["value"],!1),o,"h").w('" />')}A.__dustBody=!0;function M(t,o){o=o.shiftBlocks(e);return t.w('<input type="checkbox" name="').f(o.get(["name"],!1),o,"h").w('"').x(o.get(["value"],!1),o,{block:I},{}).w("/>")}M.__dustBody=!0;function I(t,o){o=o.shiftBlocks(e);return t.w(" checked")}I.__dustBody=!0;function O(t,o){o=o.shiftBlocks(e);return t.w('<input type="date" class="tc-textbox" name="').f(o.get(["name"],!1),o,"h").w('" value="').f(o.get(["value"],!1),o,"h").w('" />')}O.__dustBody=!0;function N(t,o){o=o.shiftBlocks(e);return t.w('<input type="time" class="tc-textbox" name="').f(o.get(["name"],!1),o,"h").w('" value="').f(o.get(["value"],!1),o,"h").w('" />')}N.__dustBody=!0;function D(t,o){o=o.shiftBlocks(e);return t.w('<input type="datetime" class="tc-textbox" name="').f(o.get(["name"],!1),o,"h").w('" value="').f(o.get(["value"],!1),o,"h").w('" />')}D.__dustBody=!0;function F(t,o){o=o.shiftBlocks(e);return t.f(o.get(["value"],!1),o,"h")}F.__dustBody=!0;return t}}d.register=function(t){var o=this;TC.control.SWCacheClient.prototype.register.call(o,t);const s=o.getUID(),p=o.getUID(),c=o.getUID();t.addControl("popup",{closeButton:!0}).then(function(e){o.attributeEditor=e});t.on(TC.Consts.event.LAYERUPDATE,function(t){if(t.layer.type===TC.Consts.layerType.WFS&&!t.layer.options.stealth){var s=t.layer,p=o.features[t.layer.id]=o.features[t.layer.id]||{added:[],modified:[],removed:[]};g(o,s).then(function(t){o.layer!==s&&t.setVisibility(!1);var c=i(o,s.id),u=n(o,s.id),g=a(o,s.id),d=l(o,s.id);TC.loadJS(!window.localforage,[TC.Consts.url.LOCALFORAGE],function(){TC.getUID();localforage.keys().then(function(o){if(o)for(var i=0,n=o.length;i<n;i++){var a=o[i];0===a.indexOf(c)&&r(a).then(function(o){var r,i=o.key;if(0===i.indexOf(d)){r=i.substr(d.length);var n=s.getFeatureById(r);s.removeFeature(n);t.addFeature(n);p.removed.push(n)}else if(0===i.indexOf(g)){r=i.substr(g.length);if(n=s.getFeatureById(r)){t.addFeature(n);p.modified.push(n);n.wrap.setGeometry(o.feature.geometry);n.setData(o.feature.attributes)}}else if(0===i.indexOf(u)){r=i.substr(u.length);var a,l=parseInt(r.substr(r.lastIndexOf(".")+1));e=Math.max(e,l+1);switch(o.feature.type){case TC.Consts.geom.POINT:a=s.addPoint(o.feature.geometry);break;case TC.Consts.geom.POLYLINE:a=s.addPolyline(o.feature.geometry);break;case TC.Consts.geom.POLYGON:a=s.addPolygon(o.feature.geometry);break;case TC.Consts.geom.MULTIPOLYLINE:a=s.addMultiPolyline(o.feature.geometry);break;case TC.Consts.geom.MULTIPOLYGON:a=s.addMultiPolygon(o.feature.geometry)}a.then(function(e){t.addFeature(e);p.added.push(e);e.provId=r;e.setData(o.feature.attributes)})}})}})})})}}).on(TC.Consts.event.LAYERADD,function(e){if(e.layer.type===TC.Consts.layerType.WFS&&!e.layer.options.stealth){o.features[e.layer.id]=o.features[e.layer.id]||{added:[],modified:[],removed:[]};$("<option>").attr("value",e.layer.id).html(e.layer.title||e.layer.id).appendTo(o._$layerSelect)}}).on(TC.Consts.event.LAYERREMOVE,function(e){if(e.layer.type===TC.Consts.layerType.WFS&&!e.layer.options.stealth){var t=o._$layerSelect.find("option[value="+e.layer.id+"]");t.filter(":selected").length>0&&o.setLayer(null);t.remove()}}).on(TC.Consts.event.POPUP,function(e){if(e.control===o.attributeEditor){for(var t=e.control.currentFeature,r=o.attributes.slice(),i={},n=o._joinedFeatureAttributes||[],a=0,l=r.length;a<l;a++){var s=t.getData()||{},p=r[a];p.value=s[p.name];"id"===p.name&&(p.readOnly=!0);p.availableValues=[];for(var c=0,u=n.length;c<u;c++){var g=n[c][p.name];void 0!==g&&""!==g&&(p.availableValues[p.availableValues.length]=g)}i[p.name]=p.type}r.sort(function(e,t){return(e.readOnly?!t.readOnly:t.readOnly)?!e.readOnly-!t.readOnly:e.name>t.name?1:e.name<t.name?-1:0});o.getRenderedHtml(o.CLASS+"-attr",{data:r},function(e){var r=o.attributeEditor.$contentDiv;r.html(e);var n=r.find("input"),a=r.find("select");n.on("input",function(e){var t=$(e.target),o=a.filter("[name="+t.attr("name")+"]");o.val()!==t.val()&&o.val("")});a.on("change",function(e){var t=$(e.target);n.filter("[name="+t.attr("name")+"]").val(t.val())});r.find("."+o.CLASS+"-btn-attr-ok").on("click",function(){var e={};n.each(function(t,o){var r=(n=$(o)).attr("name"),a=n.val();switch(i[r]){case"int":case"integer":case"byte":case"long":case"negativeInteger":case"nonNegativeInteger":case"nonPositiveInteger":case"positiveInteger":case"short":case"unsignedLong":case"unsignedInt":case"unsignedShort":case"unsignedByte":a=parseInt(a);Number.isNaN(a)||(e[r]=a);break;case"double":case"float":case"decimal":a=parseFloat(a);Number.isNaN(a)||(e[r]=a);break;case"date":case"time":case"dateTime":e[r]=new Date(a);break;case"boolean":e[r]=!!a;break;case void 0:break;default:e[r]=a}});t.setData(e);o.$events.trigger($.Event(TC.Consts.event.FEATUREMODIFY,{feature:t,layer:o.layer}));o.attributeEditor.hide()});r.find("."+o.CLASS+"-btn-attr-cancel").on("click",function(){o.attributeEditor.hide()})})}});t.loaded(function(){if(o.options.layer)o.setLayer(o.options.layer);else{var e=t.workLayers.filter(function(e){return e.type===TC.Consts.layerType.WFS&&!e.options.stealth});1===e.length?o.setLayer(e[0].id):o.setLayer(null)}o.showChanges(o._showsChanges);o.renderPromise().then(function(){$.when.apply(o,[t.addControl("draw",{id:s,div:o._$div.find("."+o.CLASS+"-point"),mode:TC.Consts.geom.POINT,layer:!1}),t.addControl("draw",{id:p,div:o._$div.find("."+o.CLASS+"-line"),mode:TC.Consts.geom.POLYLINE,layer:!1}),t.addControl("draw",{id:c,div:o._$div.find("."+o.CLASS+"-polygon"),mode:TC.Consts.geom.POLYGON,layer:!1})]).then(function(e,t,r){o.pointDraw=e;o.lineDraw=t;o.polygonDraw=r;var i=function(e){var t,r=e.feature;switch(o.geometryType){case TC.Consts.geom.POINT:t=TC.feature.Point;break;case TC.Consts.geom.POLYLINE:t=TC.feature.Polyline;break;case TC.Consts.geom.POLYGON:t=TC.feature.Polygon;break;case TC.Consts.geom.MULTIPOLYLINE:t=TC.feature.MultiPolyline;break;case TC.Consts.geom.MULTIPOLYGON:t=TC.feature.MultiPolygon}t&&(r=new t(r.geometry,{geometryName:o.layer.options.geometryName}));o.layer.addFeature(r);o.$events.trigger($.Event(TC.Consts.event.FEATUREADD,{feature:r}))},n=function(){o.cancel()};e.on(TC.Consts.event.DRAWEND,i).on(TC.Consts.event.DRAWCANCEL,n);t.on(TC.Consts.event.DRAWEND,i).on(TC.Consts.event.DRAWCANCEL,n);r.on(TC.Consts.event.DRAWEND,i).on(TC.Consts.event.DRAWCANCEL,n);o.options.modes&&$.isArray(o.options.modes)&&1==o.options.modes.length&&o.setMode(o.options.modes[0],null)})})})};d.render=function(e){var t=this,o=[];if(t.map)for(var r=0,i=t.map.workLayers.length;r<i;r++){var n=t.map.workLayers[r];n.type!==TC.Consts.layerType.WFS||n.options.stealth||o.push({id:n.id,title:n.title||n.id})}TC.Control.prototype.renderData.call(t,{layers:o,showChanges:t.showChanges},function(){t._$layerDiv=t._$div.find(t._classSelector+"-layer");t._$layerSelect=t._$layerDiv.find(t._classSelector+"-layer-sel").on("change",function(e){t.setLayer(t._$layerSelect.val())});t._$layerDiv.find("#"+t.CLASS+"-view-changes-cb").on("change",function(e){t.showChanges($(e.target).prop("checked"))});t._$cancelBtn=t._$div.find(t._classSelector+"-btn-cancel").on("click",function(){t.cancel()});t._$deleteBtn=t._$div.find(t._classSelector+"-btn-delete").on("click",function(){TC.confirm(t.eraseActionConfirmTxt,function(){t.deleteFeatures(t.getSelectedFeatures())})});t._$joinBtn=t._$div.find(t._classSelector+"-btn-join").on("click",function(){t.joinFeatures(t.getSelectedFeatures())});t._$splitBtn=t._$div.find(t._classSelector+"-btn-split").on("click",function(){t.splitFeatures(t.getSelectedFeatures())});t._$saveBtn=t._$div.find(t._classSelector+"-btn-save").on("click",function(){t.applyEdits()});t._$discardBtn=t._$div.find(t._classSelector+"-btn-discard").on("click",function(){t.discardEdits()});if(t.options.modes&&$.isArray(t.options.modes)&&t.options.modes.length>0){for(var o in TC.Consts.editMode)if("string"==typeof o&&t.options.modes.indexOf(TC.Consts.editMode[o])<0){$("label"+t._classSelector+"-btn-"+TC.Consts.editMode[o],t._$div).remove();$("div"+t._classSelector+"-"+TC.Consts.editMode[o],t._$div).remove()}if(1==t.options.modes.length){var r=t.options.modes[0];$("label"+t._classSelector+"-btn-"+r,t._$div).css("display","none")}}t._$div.find("input[type=radio][name=mode]").on("change",function(){var e=$(this).val(),o=t.mode===e?void 0:e;t.setMode(o)});$.isFunction(e)&&e()})};d.setLayer=function(e){var t=this;t.layer=map.getLayer(e);t.setMode(null);if(t.layer){g(t,t.layer).then(function(e){for(var o in t._changesLayers){var r=t._changesLayers[o];r.setVisibility(t._showsChanges&&r===e)}});t.layer.describeFeatureType().then(function(e){t.attributes=e.filter(function(e){switch(e.type){case"gml:LinearRingPropertyType":case"gml:PolygonPropertyType":t.geometryType=TC.Consts.geom.POLYGON;return!1;case"gml:MultiPolygonPropertyType":case"gml:MultiSurfacePropertyType":t.geometryType=TC.Consts.geom.MULTIPOLYGON;return!1;case"gml:LineStringPropertyType":t.geometryType=TC.Consts.geom.POLYLINE;return!1;case"gml:MultiLineStringPropertyType":t.geometryType=TC.Consts.geom.MULTIPOLYLINE;return!1;case"gml:PointPropertyType":case"gml:MultiPointPropertyType":t.geometryType=TC.Consts.geom.POINT;return!1;case"gml:BoxPropertyType":t.geometryType=TC.Consts.geom.RECTANGLE;return!1;case"gml:GeometryCollectionPropertyType":case"gml:GeometryAssociationType":return!1;default:return!0}});for(var o=0,r=t.attributes.length;o<r;o++){var i=t.attributes[o];i.type=i.type.substr(i.type.indexOf(":")+1)}t.renderPromise().then(function(){u(t);t._$div.find(t._classSelector+"-layer-sel").val(t.layer.id);$rb=t._$div.find("input[type=radio][name=mode]");var e;switch(t.geometryType){case TC.Consts.geom.POINT:e="[value=select],[value="+TC.Consts.editMode.ADDPOINT+"]";break;case TC.Consts.geom.POLYLINE:case TC.Consts.geom.MULTIPOLYLINE:e="[value=select],[value="+TC.Consts.editMode.ADDLINE+"]";break;case TC.Consts.geom.POLYGON:case TC.Consts.geom.MULTIPOLYGON:e="[value=select],[value="+TC.Consts.editMode.ADDPOLYGON+"]";break;default:e="[value]"}var o=$rb.filter(e).attr("disabled",!1);$rb.not(o).attr("disabled",!0)})});t._layerDeferred.resolve(t.layer)}else{t.renderPromise().then(function(){u(t,!1);$rb=t._$div.find("input[type=radio][name=mode]").attr("disabled",!0);$rb.each(function(e,t){$(t).prop("checked",!1)})});t._layerDeferred.resolve(null)}};d.setMode=function(e){var t=this;t.mode=e;!function(e){e._$deleteBtn.prop("disabled",!0);e._$joinBtn.prop("disabled",!0);e._$splitBtn.prop("disabled",!0)}(t);var o,r,i=function(e){if(e){t.snapping&&(e.snapping=t.layer);e.activate()}};switch(e){case TC.Consts.editMode.SELECT:o=t._$div.find(t._classSelector+"-select");r=t._$div.find(t._classSelector+"-point,"+t._classSelector+"-line,"+t._classSelector+"-polygon");t.activate();break;case TC.Consts.editMode.ADDPOINT:o=t._$div.find(t._classSelector+"-point");r=t._$div.find(t._classSelector+"-select,"+t._classSelector+"-line,"+t._classSelector+"-polygon");i(t.pointDraw);break;case TC.Consts.editMode.ADDLINE:o=t._$div.find(t._classSelector+"-line");r=t._$div.find(t._classSelector+"-select,"+t._classSelector+"-point,"+t._classSelector+"-polygon");i(t.lineDraw);break;case TC.Consts.editMode.ADDPOLYGON:o=t._$div.find(t._classSelector+"-polygon");r=t._$div.find(t._classSelector+"-select,"+t._classSelector+"-point,"+t._classSelector+"-line");i(t.polygonDraw);break;default:o=$();r=t._$div.find(t._classSelector+"-select,"+t._classSelector+"-point,"+t._classSelector+"-line,"+t._classSelector+"-polygon");t.isActive&&t.deactivate();t.pointDraw&&t.pointDraw.isActive&&t.pointDraw.deactivate();t.lineDraw&&t.lineDraw.isActive&&t.lineDraw.deactivate();t.polygonDraw&&t.polygonDraw.isActive&&t.polygonDraw.deactivate()}e?t._$div.find("input[type=radio][name=mode][value="+e+"]").prop("checked",!0).addClass(TC.Consts.classes.CHECKED).next().addClass(TC.Consts.classes.CHECKED):t._$div.find("input[type=radio][name=mode]").prop("checked",!1).removeClass(TC.Consts.classes.CHECKED).next().removeClass(TC.Consts.classes.CHECKED);o.removeClass(TC.Consts.classes.HIDDEN);r.addClass(TC.Consts.classes.HIDDEN)};d.showChanges=function(e){this._showsChanges=e;for(var t in this._changesLayers){this._changesLayers[t].setVisibility(e&&this.layer&&t===this.layer.id)}};d.cancel=function(){this.options.modes&&$.isArray(this.options.modes)&&1==this.options.modes.length?this.setMode(this.options.modes[0],null):this.setMode(null,!1);this.wrap.cancel(!0,this.cancelActionConfirmTxt)};d.onFeatureClick=function(e){self.activeControl&&self.activeControl.isExclusive()||e.feature.show()};d.activate=function(e){var t=this;TC.Control.prototype.activate.call(t);var o=e||{};t._$cancelBtn.prop("disabled",!1);$.when(t.getLayer()).then(function(){t.wrap.activate(o.mode?o.mode:t.mode);TC.Control.prototype.activate.call(t)})};d.deactivate=function(){TC.Control.prototype.deactivate.call(this);this.wrap.cancel(!0);this._$cancelBtn.prop("disabled",!0);this.wrap.deactivate()};d.isExclusive=function(){return!0};d.joinFeatures=function(e){var t=this;if(t.geometryType===TC.Consts.geom.MULTIPOLYLINE||t.geometryType===TC.Consts.geom.MULTIPOLYGON||t.geometryType===TC.Consts.geom.MULTIPOINT){t._joinedFeatureAttributes=[];if(e.length>1){for(var o=e.map(function(e){t._joinedFeatureAttributes[t._joinedFeatureAttributes.length]=e.getData();return e.geometry}).reduce(function(e,t){return e.concat(t)}),r=new e[0].constructor(o),i=0,n=e.length;i<n;i++){var a=e[i];t.layer.removeFeature(a);t.$events.trigger($.Event(TC.Consts.event.FEATUREREMOVE,{feature:a}))}t.layer.addFeature(r).then(function(e){t.setSelectedFeatures([r]);t.$events.trigger($.Event(TC.Consts.event.FEATUREADD,{feature:e}));e.showPopup(t.attributeEditor)})}p(t,[r])}};d.splitFeatures=function(e){for(var t=this,o=e.filter(s),r=o.map(function(e){return e.geometry}),i=[],n=0,a=o.length;n<a;n++)for(var l=(h=o[n]).getData(),c=r[n],u=0,g=c.length;u<g;u++)i[i.length]=new h.constructor([c[u]],{data:l});n=0;for(var d=o.length;n<d;n++){var h=o[n];t.layer.removeFeature(h);t.$events.trigger($.Event(TC.Consts.event.FEATUREREMOVE,{feature:h}))}var f=new Array(i.length);for(n=0,d=i.length;n<d;n++){(f[n]=t.layer.addFeature(i[n])).then(function(e){t.$events.trigger($.Event(TC.Consts.event.FEATUREADD,{feature:e}))})}$.when.apply(this,f).then(function(){t.setSelectedFeatures(i)});p(t,i)};d.deleteFeatures=function(e){this.wrap.deleteFeatures(e);0===this.layer.features.length&&this._$deleteBtn.prop("disabled",!0)};d.applyEdits=function(){var e=this;if(e.layer){var t=e.features[e.layer.id];e.layer.applyEdits(t.added,t.modified,t.removed).then(function(){e.discardEdits();e.map.toast("Cambios sincronizados con \xe9xito con el servidor")},function(e){TC.error("Error ["+e.code+"] al guardar cambios: "+e.reason)})}};d.discardEdits=function(){var e=this;e._joinedFeatureAttributes=[];var t=i(e);TC.loadJS(!window.localforage,[TC.Consts.url.LOCALFORAGE],function(){localforage.keys().then(function(o){if(o){for(var r=0,i=o.length;r<i;r++){var n=o[r];0===n.indexOf(t)&&localforage.removeItem(n)}if(e.layer){var a=e.features[e.layer.id];a.added.length=0;a.modified.length=0;a.removed.length=0;e.setSelectedFeatures([]);e.attributeEditor.hide();e._changesLayers[e.layer.id].clearFeatures();e.deleteCache(t).then(function(){e.layer.refresh()})}u(e,!1)}})})};d.getSelectedFeatures=function(){return this.wrap.getSelectedFeatures()};d.setSelectedFeatures=function(e){return this.wrap.setSelectedFeatures(e)};d.getLayer=function(){return this.layer||this._layerDeferred};d.getChangesLayerStyle=function(e){var t=function(t){for(var o,r=e.wrap.getRGBA(t),i=0;i<3;i++)r[i]=255-r[i];4===(o=(65536*r[0]+256*r[1]+r[2]).toString(16)).length?o="00"+o:5===o.length&&(o="0"+o);return"#"+o},o=[1,3],r=$.extend(!0,{},e.options.styles);if(r.point){r.point.strokeColor=t(r.point.strokeColor);r.point.lineDash=o}if(r.line){r.line.strokeColor=t(r.line.strokeColor);r.line.lineDash=o}if(r.polygon){r.polygon.strokeColor=t(r.polygon.strokeColor);r.polygon.lineDash=o}return r}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.control.ExternalWMS=function(e){if(TC.isLegacy)console.warn("El control ExternalWMS no soporta modo legacy");else{this.count=0;this._addedUrls=[];TC.Control.apply(this,arguments);this.allowReprojection="boolean"!=typeof this.options.allowReprojection||this.options.allowReprojection}};TC.inherit(TC.control.ExternalWMS,TC.Control);!function(){var e=TC.control.ExternalWMS.prototype;e.CLASS="tc-ctl-xwms";e.markServicesAsSelected=function(e){if(e.length>0){var t=$(e[0]);t.attr("disabled","true");t.addClass("tc-ctl-xwms-option-selected")}};e.register=function(e){if(TC.isLegacy)console.warn("El control ExternalWMS no soporta modo legacy");else{var t=this;TC.Control.prototype.register.call(t,e);t._$div.on("change","select",function(e){if(""!=this.value){var o=this.value;0===o.indexOf("//")&&(o=location.protocol+o);t._$div.find("input").val(o);$(this).val("")}});t._$div.on("click","button[name='agregar']",function(e){var o=t._$div.find("input").val().trim();if(o)if(/^((https?|ftp):)?(\/\/)?(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i.test(o))if(t._addedUrls.indexOf(o)>-1)TC.alert(t.getLocaleString("serviceAlreadyAdded"));else{var r=t.map.getControlsByClass("TC.control.LoadingIndicator")[0];r.show();var i=TC.Util.getQueryStringParams(o),n=["version","service","request"],a=function(e,t){for(var o=0;o<t.length;o++)e=TC.Util.removeURLParameter(e,t[o]);e.match(/\?$/)&&(e=e.substr(0,e.length-1));return e}(o,Object.keys(i));for(var l in i)n.indexOf(l.toLowerCase())>=0&&delete i[l];var s=t._$div.find("button");s.attr("disabled","true");for(var p={id:"xwms"+ ++t.count,type:"WMS",url:a,hideTree:!1,queryParams:i},c=0;c<t.options.suggestions.length;c++){var u=$.grep(t.options.suggestions[c].items,function(e,t){return e.url===o});if(u.length>0&&u[0].layerNames){p.layerNames=u[0].layerNames;break}}var g=new TC.layer.Raster(p);g.getCapabilitiesPromise().then(function(e){if(void 0!==e.Capability){var i=e.Capability.Layer;if(!i.CRS||-1!=i.CRS.indexOf(t.map.crs)||t.allowReprojection){t.map.$events.trigger($.Event(TC.Consts.event.EXTERNALSERVICEADDED,{layer:g}));t._$div.find("input").val("");var n=t._$div.find("select option[value='"+o+"']");t.markServicesAsSelected(n);t._addedUrls.push(o);r.hide();s.removeAttr("disabled")}else{TC.alert(t.getLocaleString("serviceSrsNotCompatible"));r.hide();s.removeAttr("disabled")}}else{TC.alert(t.getLocaleString("noLayersFoundInService"));r.hide();s.removeAttr("disabled")}},function(e){TC.alert(t.getLocaleString("serviceCouldNotBeLoaded")+":\n"+e);r.hide();s.removeAttr("disabled")})}else TC.alert(t.getLocaleString("typeAValidAddress"));else TC.alert(t.getLocaleString("typeAnAddress"))});e.on(TC.Consts.event.LAYERADD,function(e){if(e.layer&&!e.layer.isBase){var o=e.layer.url;if(o){t.pending_markServicesAsSelected=t.pending_markServicesAsSelected||[];0===t._$div.find("select option").length&&o&&-1===t.pending_markServicesAsSelected.indexOf(o)&&t.pending_markServicesAsSelected.push(o);var r=t._$div.find("select option").filter(function(e,t){return TC.Util.addProtocol(t.value)===TC.Util.addProtocol(o)});t.markServicesAsSelected(r);t._addedUrls.push(o)}}})}};e.template={};TC.isDebug?e.template[e.CLASS]=TC.apiLocation+"TC/templates/ExternalWMS.html":e.template[e.CLASS]=function(){dust.register(e.CLASS,t);function t(e,t){return e.x(t.get(["title"],!1),t,{block:o},{}).w('<div><div class="tc-group tc-ctl-xwms-cnt"> <select id="add-wms-select" class="tc-combo" title="WMS (Web Map Service)"><option value="">WMS</option>').s(t.get(["suggestions"],!1),t,{block:r},{}).w('</select><input type="text" class="tc-textbox" placeholder="').h("i18n",t,{},{$key:"writeAddressOrSelect"}).w('" /></div><div class="tc-group tc-group tc-ctl-xwms-cnt" style="text-align:right;"><button type="button" class="tc-button tc-icon-button" title="').h("i18n",t,{},{$key:"addService.title"}).w('" name="agregar">').h("i18n",t,{},{$key:"addService"}).w("</button></div></div>")}t.__dustBody=!0;function o(e,t){return e.w("<h2>").h("i18n",t,{},{$key:"addMaps"}).w("</h2>")}o.__dustBody=!0;function r(e,t){return e.x(t.get(["group"],!1),t,{block:i},{}).s(t.get(["items"],!1),t,{block:n},{}).x(t.get(["group"],!1),t,{block:a},{})}r.__dustBody=!0;function i(e,t){return e.w('<optgroup label="').f(t.get(["group"],!1),t,"h").w('">')}i.__dustBody=!0;function n(e,t){return e.w('<option value="').f(t.get(["url"],!1),t,"h").w('">').f(t.get(["name"],!1),t,"h").w("</option>")}n.__dustBody=!0;function a(e,t){return e.w("\t</optgroup>")}a.__dustBody=!0;return t};e.render=function(e){var t=this;t.renderData(t.options,function(){t.pending_markServicesAsSelected=t.pending_markServicesAsSelected||[];t.pending_markServicesAsSelected.forEach(function(e){var o=t._$div.find("select option").filter(function(t,o){return TC.Util.addProtocol(o.value)===TC.Util.addProtocol(e)});t.markServicesAsSelected(o);t._addedUrls.push(e)});t.pending_markServicesAsSelected=[]})}}();TC.control=TC.control||{};TC.control.FeatureInfoCommons||TC.syncLoadJS(TC.apiLocation+"TC/control/FeatureInfoCommons");!function(){TC.control.FeatureInfo=function(){var e=this;TC.control.FeatureInfoCommons.apply(this,arguments);e.wrap=new TC.wrap.control.FeatureInfo(e);TC.Consts.classes.FROMLEFT="tc-fromleft";TC.Consts.classes.FROMRIGHT="tc-fromright";e.options.displayElevation&&TC.loadJS(!TC.tool||!TC.tool.Elevation,TC.apiLocation+"TC/tool/Elevation",function(){const t="boolean"==typeof e.options.displayElevation?{}:e.options.displayElevation;e.elevation=new TC.tool.Elevation(t)})};TC.inherit(TC.control.FeatureInfo,TC.control.FeatureInfoCommons);var e=TC.control.FeatureInfo.prototype;e.FEATURE_PARAM="showfeature";var t=function e(t,o){var r;if($.isArray(t))for(var i=0,n=(r=t.slice()).length;i<n;i++)r[i]=e(r[i]);else r="number"==typeof t?Math.round(t.toFixed(o)):t;return r};e.register=function(e){var t=this;TC.control.FeatureInfoCommons.prototype.register.call(t,e);t._$div.appendTo("<div>");e.loaded(function(){t._layersDeferred.then(function(){var e=TC.Util.getParameterByName(t.FEATURE_PARAM);if(e){var o;try{o=JSON.parse(decodeURIComponent(escape(window.atob(e))))}catch(e){TC.error(TC.Util.getLocaleString(t.map.options.locale,"sharedFeatureNotValid"),TC.Consts.msgErrorMode.TOAST)}o&&function(e,t){if(0!==jQuery.grep(e.map.workLayers,function(e,o){return e.type===TC.Consts.layerType.WMS&&e.url===t.s&&e.getDisgregatedLayerNames().indexOf(t.l)>=0}).length){e.sharedFeatureInfo=t;TC.loadJS(!window.hex_md5,[TC.apiLocation+TC.Consts.url.HASH],function(){const o=[-100,-100];e.beforeRequest({xy:o});e.filterLayer.clearFeatures();$.when(e.filterLayer.addMarker(o)).then(function(o){e.filterFeature=o;e.wrap.getFeatureInfo(t.xy,t.r,{serviceUrl:t.s,layerName:t.l,featureId:t.f})})})}else TC.error(TC.Util.getLocaleString(e.map.options.locale,"sharedFeatureNotValid"),TC.Consts.msgErrorMode.TOAST)}(t,o)}})})};e.onShowModal=function(){var e=this,o=$(e.getDisplayTarget()).find("ul."+e.CLASS+"-features li."+TC.Consts.classes.CHECKED),r=e._shareCtl;r.extraParams=null;var i=o.parents("li").first(),n=i.parents("li").first(),a=e.info.services[n.index()];if(a){var l=a.layers[i.index()];if(l){var s=l.features[o.index()];TC.loadJS(!window.hex_md5,[TC.apiLocation+TC.Consts.url.HASH],function(){var o=hex_md5(JSON.stringify({data:s.getData(),geometry:t(s.geometry,TC.Consts.DEGREE_PRECISION)}));r.extraParams={};r.extraParams[e.FEATURE_PARAM]=window.btoa(unescape(encodeURIComponent(JSON.stringify({xy:s.wrap.getInnerPoint(),r:e.map.getResolution(),s:a.mapLayer.url,l:l.name,f:s.id,h:o}))));var i=r._$div;i.find(".tc-url input[type=text]").val(r.generateLink());i.find(".tc-iframe input[type=text]").val(r.generateIframe())})}}};e.callback=function(e,t){var o=this;if(o.elevation){o.querying=!0;o.elevationRequest=o.elevation.getElevation({crs:o.map.crs,coordinates:e})}if(o.map&&o.filterLayer){var r=o.getLocaleString("featureInfo"),i=$.extend({},o.map.options.styles.marker,o.markerStyle,{title:r,set:r});o.displayMode!==TC.control.FeatureInfoCommons.POPUP&&(i.showsPopup=!1);o.filterLayer.clearFeatures();$.when(o.filterLayer.addMarker(e,i)).then(function(t){o.map.putLayerOnTop(o.filterLayer);o.filterFeature=t;for(var r=!1,i=0;i<o.map.workLayers.length;i++){var n=o.map.workLayers[i];if(n.type===TC.Consts.layerType.WMS&&n.getVisibility()&&n.names.length>0){r=!0;break}}var a=o.map.getResolution();r?o.wrap.getFeatureInfo(e,a):o.responseCallback({coords:e})})}};e.responseCallback=function(e){var o=this;const r=function(r){TC.control.FeatureInfoCommons.prototype.responseCallback.call(o,e);o.querying=!0;if(o.filterFeature){var i=e.services;o.info={services:i,defaultFeature:e.defaultFeature};if(i)for(var n=0;n<i.length;n++){for(var a=i[n],l=0;l<a.layers.length;l++)if(!a.layers[l].features.length){a.layers.splice(l,1);l-=1}if(!a.layers.length){i.splice(n,1);n-=1}}var s=o.map.options.locale||TC.Cfg.locale;e.isGeo=o.map.wrap.isGeo();if(r.length){const t=r[0][2];e.elevation=null===t?null:TC.Util.formatNumber(Math.round(t),s)}if(e.coords){e.crs=o.map.crs;e.coords=e.coords.map(function(t){return TC.Util.formatNumber(t.toFixed(e.isGeo?TC.Consts.DEGREE_PRECISION:TC.Consts.METER_PRECISION),s)})}if(i&&i.length||null!==e.elevation)o.renderData(e,function(){o.insertLinks();if(o.sharedFeatureInfo){o._$div.find("ul."+o.CLASS+"-services li").addClass(TC.Consts.classes.CHECKED);for(var e,r=o.sharedFeatureInfo,i=0,n=o.info.services.length;i<n;i++){var a=o.info.services[i];if(a.mapLayer.url===r.s){for(var l=0,s=a.layers.length;l<s;l++){var p=a.layers[l];if(p.name===r.l){for(var c=0,u=p.features.length;c<u;c++){var g=p.features[c];if(g.id===r.f){e=g;var d=hex_md5(JSON.stringify({data:g.getData(),geometry:t(g.geometry,TC.Consts.DEGREE_PRECISION)}));r.h!==d&&TC.alert(o.getLocaleString("finfo.featureChanged.warning"));break}}break}}break}}e&&o._addHighlightPopup().then(function(t){e.data=o._$div.html();o.getRenderedHtml(o.CLASS+"-del-btn",null,function(e){t.$popupDiv.append(e);t.$popupDiv.find("."+o.CLASS+"-del-btn").on(TC.Consts.event.CLICK,function(e){TC.confirm(o.getLocaleString("deleteFeature.confirm"),function(){o.map.removeLayer(o.sharedFeatureLayer);delete o.sharedFeatureLayer})})});e.showsPopup=!0;e.popup=t;o.map.addLayer({id:o.getUID(),type:TC.Consts.layerType.VECTOR,title:o.getLocaleString("foi")}).then(function(t){o.sharedFeatureLayer=t;o.filterLayer.clearFeatures();t.addFeature(e);o.map.zoomToFeatures([e])});o.map.on(TC.Consts.event.POPUP,function(r){r.control===t&&t.$popupDiv.find("table").on(TC.Consts.event.CLICK,function(t){o.map.zoomToFeatures([e])})})});delete o.sharedFeatureInfo}else o.displayResults()});else{o.resultsLayer.clearFeatures();o.filterLayer.clearFeatures()}o.querying=!1}};o.elevationRequest?o.elevationRequest.then(r):r([])}}();TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.control.FileImport=function(){TC.Control.apply(this,arguments);$.isArray(this.options.formats)?this.formats=this.options.formats:this.formats=[TC.Consts.format.KML,TC.Consts.format.GML,TC.Consts.format.GML2,TC.Consts.format.GEOJSON,TC.Consts.format.WKT,TC.Consts.format.GPX];this.layers=[];this.apiAttribution="";this.mainDataAttribution="";this.dataAttributions=[]};TC.inherit(TC.control.FileImport,TC.Control);!function(){var e=TC.control.FileImport.prototype;e.CLASS="tc-ctl-file";TC.isDebug?e.template=TC.apiLocation+"TC/templates/FileImport.html":e.template=function(){dust.register(e.CLASS,t);function t(e,t){return e.w("<h2>").h("i18n",t,{},{$key:"openFile"}).w("</h2><div><p>").h("i18n",t,{},{$key:"fileImport.instructions"}).w('</p><div class="tc-ctl-file-open"><label class="tc-button tc-ctl-file-open-label tc-icon-button"><input type="file" class="tc-ctl-file-open-ipt tc-button" accept="').s(t.get(["formats"],!1),t,{block:o},{}).w('" />').h("i18n",t,{},{$key:"openFile"}).w("</label></div></div>")}t.__dustBody=!0;function o(e,t){return e.w(".").f(t.getPath(!0,[]),t,"h").h("sep",t,{block:r},{})}o.__dustBody=!0;function r(e,t){return e.w(",")}r.__dustBody=!0;return t};e.register=function(e){var t=this;TC.Control.prototype.register.call(t,e);t.options.enableDragAndDrop&&e.wrap.enableDragAndDrop(t.options);e.on(TC.Consts.event.FEATURESIMPORT,function(o){var r="."+TC.Consts.format.GPX.toLowerCase();o.fileName.toLowerCase().indexOf(r)!==o.fileName.length-r.length&&e.addLayer({id:t.getUID(),title:o.fileName,type:TC.Consts.layerType.VECTOR}).then(function(r){t.layers.push(r);const i=function(e,t){return e.concat(t)};for(var n=function(e){var o=e.geometry;if(o){var r;switch(!0){case TC.feature.Point&&e instanceof TC.feature.Point:r=[o];break;case TC.feature.MultiPoint&&e instanceof TC.feature.MultiPoint:case TC.feature.Polyline&&e instanceof TC.feature.Polyline:r=o;break;case TC.feature.MultiPolyline&&e instanceof TC.feature.MultiPolyline:case TC.feature.Polygon&&e instanceof TC.feature.Polygon:r=o.reduce(i);break;case TC.feature.MultiPolygon&&e instanceof TC.feature.MultiPolygon:r=o.reduce(i).reduce(i)}r.every(function(e){return Math.abs(e[0])<=180&&Math.abs(e[1])<=90})&&e.setCoords(TC.Util.reproject(o,"EPSG:4326",t.map.crs))}return e},a=0,l=o.features.length;a<l;a++){var s=n(o.features[a]);r.addFeature(s)}setTimeout(function(){e.zoomToFeatures(r.features)},100)})}).on(TC.Consts.event.FEATURESIMPORTERROR,function(e){var o,r=e.file.name;o=".kmz"===r.toLowerCase().substr(r.length-4)?"fileImport.error.reasonKmz":"fileImport.error.reasonUnknown";TC.error(t.getLocaleString(o,{fileName:r}),TC.Consts.msgErrorMode.TOAST);var i=new FileReader;i.onload=function(e){TC.error("Nombre del archivo: "+r+" \n Contenido del archivo: \n\n"+e.target.result,TC.Consts.msgErrorMode.EMAIL,"Error en la subida de un archivo")};i.readAsText(e.file)}).on(TC.Consts.event.LAYERREMOVE,function(e){const o=t.layers.indexOf(e.layer);o>=0&&t.layers.splice(o,1)})};e.render=function(){var e=this;e.renderData({formats:e.formats},function(){e._$div.find("input[type=file]").on(TC.Consts.event.CLICK,function(e){$(this).wrap("<form>").closest("form").get(0).reset();$(this).unwrap()}).on("change",function(t){if(e.map){console.log("salta el change");e.map.wrap.loadFiles(t.target.files)}})})};e.exportState=function(){return{id:this.id,layers:this.layers.map(function(e){return{title:e.title,state:e.exportState()}})}};e.importState=function(e){const t=this;if(t.map){const o=[];e.layers.forEach(function(e){o.push(t.map.addLayer({id:t.getUID(),title:e.title,type:TC.Consts.layerType.VECTOR}))});$.when.apply($,o).then(function(){for(var o=0,r=arguments.length;o<r;o++){const r=arguments[o];r.importState(e.layers[o].state);t.layers.push(r)}})}}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.control.FullScreen=function(){TC.Control.apply(this,arguments);this.fullScreenElement=document.documentElement};TC.inherit(TC.control.FullScreen,TC.Control);!function(){var e=TC.control.FullScreen.prototype;e.CLASS="tc-ctl-fscreen";TC.isDebug?e.template=TC.apiLocation+"TC/templates/FullScreen.html":e.template=function(){dust.register(e.CLASS,t);function t(e,t){return e.w('<button class="tc-ctl-fscreen-btn" title="').h("i18n",t,{},{$key:"fscreen.tip"}).w('"></button>')}t.__dustBody=!0;return t};e.register=function(e){var t=this;TC.Control.prototype.register.call(t,e);t.renderPromise().then(function(){var e=t._$div.find("."+t.CLASS+"-btn");if(t.enabledFullScreen()){e.on("click",function(){t.toggleFullScreen()});$(document).on("fullscreenchange mozfullscreenchange webkitfullscreenchange MSFullscreenChange",function(){e.toggleClass(TC.Consts.classes.ACTIVE,t.isFullScreen());e.attr("title",t.isFullScreen()?t.getLocaleString("fscreen.tip.return"):t.getLocaleString("fscreen.tip"))})}else e.addClass(TC.Consts.classes.HIDDEN)})};e.requestFullScreen=function(){var e=this.fullScreenElement;document.documentElement.requestFullScreen?e.requestFullScreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullScreen?e.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT):e.msRequestFullscreen&&e.msRequestFullscreen()};e.cancelFullScreen=function(){document.cancelFullScreen?document.cancelFullScreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen()};e.isFullScreen=function(){return document.fullScreenElement||document.mozFullScreen||document.webkitIsFullScreen||document.msFullscreenElement};e.toggleFullScreen=function(){this.isFullScreen()?this.cancelFullScreen():this.requestFullScreen()};e.enabledFullScreen=function(){var e=this.fullScreenElement,t=document.documentElement.requestFullScreen||e.mozRequestFullScreen||e.webkitRequestFullScreen||e.msRequestFullscreen;return t&&"function"==typeof t}}();Math.hypot=Math.hypot||function(){for(var e=0,t=arguments.length,o=0;o<t;o++){if(arguments[o]===1/0||arguments[o]===-1/0)return 1/0;e+=arguments[o]*arguments[o]}return Math.sqrt(e)};!function(){for(var e=0,t=["ms","moz","webkit","o"],o=!(!window.performance||!window.performance.now),r=0,i=t.length;r<i&&!window.requestAnimationFrame;r+=1){window.requestAnimationFrame=window[t[r]+"RequestAnimationFrame"];window.cancelAnimationFrame=window[t[r]+"CancelAnimationFrame"]||window[t[r]+"CancelRequestAnimationFrame"]}window.requestAnimationFrame||(window.requestAnimationFrame=function(t,o){var r=(new Date).getTime(),i=Math.max(0,16-(r-e)),n=window.setTimeout(function(){t(r+i)},i);e=r+i;return n});window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)});if(!o){var n=window.requestAnimationFrame,a=+new Date;window.requestAnimationFrame=function(e,t){n(function(t){return e(t<1e12?t:t-a)},t)}}}();!function(){if(window.performance){if(window.performance&&!window.performance.now){window.performance.offset=Date.now();window.performance.now=function(){return Date.now()-window.performance.offset}}}else window.performance={offset:Date.now(),now:function(){return Date.now()-this.offset}}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.control.Geolocation=function(e){this.$events=$(this);this._classSelector="."+this.CLASS;this.Const={Classes:{ACTIVE:"tc-ctl-geolocation-active",CLOSED:"closed",SELECTEDTRACK:"selectedTrack",DRAWACTIVATED:"draw-activated",SIMULATIONACTIVATED:"simulation-activated"},Selector:{SIMULATE:".tc-btn-simulate",DRAW:".tc-draw",EDIT:".tc-btn-edit",DELETE:".tc-btn-delete",SAVE:".tc-btn-save",CANCEL:".tc-btn-cancel",EXPORT_GPX:".tc-btn-export-gpx",EXPORT_KML:".tc-btn-export-kml",STOP:".tc-btn-stop",PAUSE:".tc-btn-pause",BACKWARD:".tc-btn-backward",FORWARD:".tc-btn-forward",SPEED:".tc-spn-speed"},LocalStorageKey:{TRACKING:"trk",TRACKINGTEMP:"trktemp",TRACKINGSHOWADVERTISEMENT:"trkAdvertisement",GPSSHOWADVERTISEMENT:"gpsAdvertisement",TEST:"test"},Message:{VALIDATENAME:""},Event:{POSITIONCHANGE:"positionchange.tc.geolocation",GPSPOSITIONCHANGE:"gpspositionchange.tc.geolocation",GPSPOSITIONERROR:"positionerror.tc.geolocation",STATEUPDATED:"stateupdated.tc.geolocation",GPSADD:"gpsadd.tc.geolocation",TRACKSNAPPING:"tracksnapping.tc.geolocation",DRAWTRACK:"drawtrack.tc.geolocation",CLEARTRACK:"cleartrack.tc.geolocation",IMPORTEDTRACK:"importedtrack.tc.geolocation"},MimeMap:{KML:"application/vnd.google-earth.kml+xml",GPX:"application/gpx+xml"},SupportedFileExtensions:[".kml",".gpx"],Tabs:{GPS:"gps"},Layers:{GPS:"gps",TRACK:"track",TRACKING:"tracking"}};TC.Control.apply(this,arguments);var t=e||{};this._$dialogDiv=$(TC.Util.getDiv(t.dialogDiv));t.dialogDiv||this._$dialogDiv.appendTo("body");this.delta=500;this.walkingSpeed=5e3;this.gapHill=this.options.gapHill||20;this.snappingTolerance=this.options.snappingTolerance||50;this.exportsState=!0;this.storageCRS="EPSG:4326";this._trackingLayerDeferred=$.Deferred()};TC.inherit(TC.control.Geolocation,TC.Control);!function(){var e=TC.control.Geolocation.prototype;e.CLASS="tc-ctl-geolocation";e.CHART_SIZE={MIN_HEIGHT:70,MAX_HEIGHT:128,MIN_WIDTH:215,MEDIUM_WIDTH:310,MAX_WIDTH:445};TC.Consts.event.TOOLSCLOSE=TC.Consts.event.TOOLSCLOSE||"toolsclose.tc";TC.Consts.event.TOOLSOPEN=TC.Consts.event.TOOLSOPEN||"toolsopen.tc";e.template={};if(TC.isDebug){e.template[e.CLASS]=TC.apiLocation+"TC/templates/Geolocation.html";e.template[e.CLASS+"-track-node"]=TC.apiLocation+"TC/templates/GeolocationTrackNode.html";e.template[e.CLASS+"-track-snapping-node"]=TC.apiLocation+"TC/templates/GeolocationTrackSnappingNode.html";e.template[e.CLASS+"-dialog"]=TC.apiLocation+"TC/templates/GeolocationDialog.html";e.template[e.CLASS+"-tracking-toast"]=TC.apiLocation+"TC/templates/GeolocationTrackingToast.html"}else{e.template[e.CLASS]=function(){dust.register(e.CLASS,t);function t(e,t){return e.w("<h2>").h("i18n",t,{},{$key:"geo"}).w(' <span class="tc-beta tc-hidden">').h("i18n",t,{},{$key:"beta"}).w('</span></h2><div class="tc-ctl-geolocation-content"> <div class="tc-ctl-geolocation-track"><div class="tc-ctl-geolocation-track-snap-info"></div><div class="tc-ctl-geolocation-info-tracking tc-hidden"><div class="tc-ctl-p-results"><div class="prpanel-group prsidebar-body "><div class="prpanel prpanel-default"><div class="prpanel-heading"><h4 class="prpanel-title"><label>').h("i18n",t,{},{$key:"geo.mylocation"}).w('</label> <span id="trackingInfoClose" class="prcollapsed-pull-right prcollapsed-slide-submenu prcollapsed-slide-submenu-close" title="').h("i18n",t,{},{$key:"close"}).w('"><i class="fa fa-times"></i></span><span id="trackingInfoMin" class="prcollapsed-pull-right prcollapsed-slide-submenu prcollapsed-slide-submenu-min" title="').h("i18n",t,{},{$key:"hide"}).w('"><i class="fa fa-chevron-left"></i></span> </h4></div><div id="results" class="prpanel-collapse"><div class="prpanel-body list-group"> </div> </div></div></div><div id="trackingInfoMax" class="prcollapsed prcollapsed-max prcollapsed-pull-left" style="display: none;" title="').h("i18n",t,{},{$key:"geo.trk.panel.3"}).w('"><i class="fa fa-list-alt tracking"></i></div></div></div>\x3c!-- img se insertan en el div del mapa--\x3e <div id="tc-ctl-geolocation-track-elevation-marker" class="tc-ctl-geolocation-trackMarker elevation" style="display: none;" /> <div class="tc-ctl-geolocation-track-panel-block" ><input id="tc-ctl-geolocation-track-panel-opened" type="checkbox" checked/><label for="tc-ctl-geolocation-track-panel-opened" title="').h("i18n",t,{},{$key:"geo.trk.panel.help.1"}).w('">').h("i18n",t,{},{$key:"geo.trk.panel.help.2"}).w('</label><i class="tc-ctl-geolocation-track-panel-help icon-question-sign" title="').h("i18n",t,{},{$key:"geo.trk.panel.help.3"}).w('"></i></div><div class="tc-ctl-geolocation-track-mng"><div class="tc-ctl-geolocation-select"><form> <label class="tc-ctl-geolocation-btn-track" title="').h("i18n",t,{},{$key:"geo.track.title"}).w('"><input type="radio" name="mode" checked value="tracks" /><span>').h("i18n",t,{},{$key:"geo.gps"}).w('</span></label><label class="tc-ctl-geolocation-btn-tracks" title="').h("i18n",t,{},{$key:"geo.tracks.title"}).w('"><input type="radio" name="mode" value="track-available" /><span>').h("i18n",t,{},{$key:"geo.tracks"}).w('</span></label> </form></div> <div class="tc-ctl-geolocation-track-available tc-ctl-geolocation-track-cnt tc-ctl-geolocation-panel tc-hidden"><i class="tc-ctl-geolocation-track-search-icon"></i><input id="tc-ctl-geolocation-track-available-srch" type="search" list="tc-ctl-geolocation-track-available-lst" class="tc-ctl-geolocation-track-available-srch tc-textbox" placeholder="').h("i18n",t,{},{$key:"geo.filter.plhr"}).w('" maxlength="200" /> <ol id="tc-ctl-geolocation-track-available-lst" class="tc-ctl-geolocation-track-available-lst"><li class="tc-ctl-geolocation-track-available-empty"><span>').h("i18n",t,{},{$key:"geo.noTracks"}).w('</span></li><li class="tc-ctl-geolocation-track-not" hidden><span>').h("i18n",t,{},{$key:"noMatches"}).w('</span></li></ol><div class="tc-ctl-geolocation-track-cnt"><input name="uploaded-file" id="uploaded-file" type="file" class="tc-ctl-geolocation-track-import tc-button" accept=".gpx,.kml" disabled /><label class="tc-button tc-icon-button" for="uploaded-file" title="').h("i18n",t,{},{$key:"geo.trk.import.upload"}).w('">').h("i18n",t,{},{$key:"geo.trk.import.lbl"}).w('</label></div></div><div class="tc-ctl-geolocation-tracks tc-ctl-geolocation-panel"> <div class="tc-alert alert-warning tc-hidden" ><p id="panel-msg">').h("i18n",t,{},{$key:"geo.trk.panel.1"}).w(" <ul><li>").h("i18n",t,{},{$key:"geo.trk.panel.2"}).w("</li><li>").h("i18n",t,{},{$key:"geo.trk.panel.3"}).w("</li><li>").h("i18n",t,{},{$key:"geo.trk.panel.4"}).w("</li><li>").h("i18n",t,{},{$key:"geo.trk.panel.5"}).w('</li></ul></p></div> <div class="tc-ctl-geolocation-track-ui"> <div class="tc-ctl-geolocation-track-render"><input id="tc-ctl-geolocation-track-render" type="checkbox" hidden checked /><label for="tc-ctl-geolocation-track-render" class="tc-ctl-geolocation-track-render" title="').h("i18n",t,{},{$key:"geo.trk.render"}).w('">').h("i18n",t,{},{$key:"geo.trk.render"}).w('</label></div><button class="tc-button tc-icon-button tc-ctl-geolocation-track-ui-activate" title="').h("i18n",t,{},{$key:"geo.track.activate.title"}).w('">').h("i18n",t,{},{$key:"geo.track.activate"}).w('</button><button class="tc-button tc-icon-button tc-ctl-geolocation-track-ui-deactivate tc-hidden" title="').h("i18n",t,{},{$key:"geo.track.deactivate.title"}).w('">').h("i18n",t,{},{$key:"geo.track.deactivate"}).w('</button></div><div class="tc-ctl-geolocation-track-current tc-ctl-geolocation-track-cnt"><input type="text" class="tc-ctl-geolocation-track-title tc-textbox" disabled placeholder="').h("i18n",t,{},{$key:"geo.trk.name.plhr"}).w('" maxlength="200" /><button class="tc-button tc-icon-button tc-ctl-geolocation-track-save" disabled title="').h("i18n",t,{},{$key:"geo.trk.name.save"}).w('"></button><input type="text" class="tc-ctl-geolocation-track-waypoint tc-textbox" disabled placeholder="').h("i18n",t,{},{$key:"geo.trk.wyp.plhr"}).w('" maxlength="200" /><button class="tc-button tc-icon-button tc-ctl-geolocation-track-add-wpt" disabled title="').h("i18n",t,{},{$key:"geo.trk.wyp.save"}).w('"></button></div></div></div></div></div>\x3c!--se inserta en el div del mapa--\x3e<div class="tc-ctl-geolocation-track-center tc-hidden"> <button class="tc-ctl-btn tc-button tc-icon-button" title="').h("i18n",t,{},{$key:"geo.trk.center"}).w('"></button></div>')}t.__dustBody=!0;return t};e.template[e.CLASS+"-track-node"]=function(){dust.register(e.CLASS+"-track-node",t);function t(e,t){return e.w('<li data-id="').f(t.get(["id"],!1),t,"h").w('" data-uid="').f(t.get(["uid"],!1),t,"h").w('"><span class="tc-draw tc-selectable" title="').f(t.get(["name"],!1),t,"h").w('">').f(t.get(["name"],!1),t,"h").w('</span><input class="tc-textbox tc-hidden" type="text" value="').f(t.get(["name"],!1),t,"h").w('" /> <button class="tc-btn-simulate" title="').h("i18n",t,{},{$key:"tr.lst.simulate"}).w('"></button><button hidden class="tc-btn-stop" title="').h("i18n",t,{},{$key:"tr.lst.stop"}).w('"></button><button class="tc-btn-edit" title="').h("i18n",t,{},{$key:"tr.lst.edit"}).w('"></button><button hidden class="tc-btn-pause" title="').h("i18n",t,{},{$key:"tr.lst.pause"}).w('"></button> <button hidden class="tc-btn-backward" title="').h("i18n",t,{},{$key:"tr.lst.backward"}).w('"></button><label hidden class="tc-spn-speed" title="').h("i18n",t,{},{$key:"tr.lst.velocity"}).w('"></label><button hidden class="tc-btn-forward" title="').h("i18n",t,{},{$key:"tr.lst.forward"}).w('"></button> <button class="tc-btn-save tc-hidden" title="').h("i18n",t,{},{$key:"save"}).w('"></button><button class="tc-btn-cancel tc-hidden" title="').h("i18n",t,{},{$key:"tr.lst.cancel"}).w('"></button><button class="tc-btn-delete" title="').h("i18n",t,{},{$key:"tr.lst.delete"}).w('"></button><button class="tc-btn-export-gpx" title="').h("i18n",t,{},{$key:"tr.lst.exportGPX"}).w('"></button><button class="tc-btn-export-kml" title="').h("i18n",t,{},{$key:"tr.lst.exportKML"}).w('"></button> </li>')}t.__dustBody=!0;return t};e.template[e.CLASS+"-track-snapping-node"]=function(){dust.register(e.CLASS+"-track-snapping-node",t);function t(e,t){return e.w("<ul>").x(t.get(["n"],!1),t,{block:o},{}).w("<li> <span>").x(t.get(["isGeo"],!1),t,{else:r,block:i},{}).w(":</span> ").f(t.get(["x"],!1),t,"h").w("</li><li> <span>").x(t.get(["isGeo"],!1),t,{else:n,block:a},{}).w(":</span> ").f(t.get(["y"],!1),t,"h").w(" </li>").x(t.get(["z"],!1),t,{block:l},{}).x(t.get(["m"],!1),t,{block:p},{}).w("</ul>")}t.__dustBody=!0;function o(e,t){return e.w("<li><span>").h("i18n",t,{},{$key:"geo.trk.snapping.name"}).w(":</span> ").f(t.get(["n"],!1),t,"h").w("</li>")}o.__dustBody=!0;function r(e,t){return e.w("X")}r.__dustBody=!0;function i(e,t){return e.h("i18n",t,{},{$key:"lon"})}i.__dustBody=!0;function n(e,t){return e.w("Y")}n.__dustBody=!0;function a(e,t){return e.h("i18n",t,{},{$key:"lat"})}a.__dustBody=!0;function l(e,t){return e.h("ne",t,{block:s},{key:t.get(["z"],!1),value:0})}l.__dustBody=!0;function s(e,t){return e.w("<li> <span>Z:</span> ").f(t.get(["z"],!1),t,"h").w(" </li>")}s.__dustBody=!0;function p(e,t){return e.w("<li> ").f(t.get(["m"],!1),t,"h").w(" </li>")}p.__dustBody=!0;return t};e.template[e.CLASS+"-dialog"]=function(){dust.register(e.CLASS+"-dialog",t);function t(e,t){return e.w('<div class="tc-ctl-geolocation-continue-track-dialog tc-modal" ><div class="tc-modal-background tc-modal-close"></div><div class="tc-modal-window"><div class="tc-modal-header"><h3>').h("i18n",t,{},{$key:"geo.gps"}).w('</h3><div class="tc-ctl-popup-close tc-modal-close"></div></div><div class="tc-modal-body"><button class="tc-button tc-ctl-geolocation-track-continue"> ').h("i18n",t,{},{$key:"geo.trk.dialog.cnt"}).w(' </button><button class="tc-button tc-ctl-geolocation-track-new"> ').h("i18n",t,{},{$key:"geo.trk.dialog.new"}).w(' </button> <button class="tc-button tc-modal-close"> ').h("i18n",t,{},{$key:"geo.trk.dialog.cancel"}).w(' </button></div></div></div><div class="tc-ctl-geolocation-track-advert-dialog tc-modal" ><div class="tc-modal-background tc-modal-close"></div><div class="tc-modal-window"><div class="tc-modal-header"><h3>').h("i18n",t,{},{$key:"geo.track.activate.title"}).w('</h3><div class="tc-ctl-popup-close tc-modal-close"></div></div><div class="tc-modal-body"><p id="pageBlurMsg">').h("i18n",t,{},{$key:"geo.trk.page.blur"}).w('</p><p class="tc-ctl-geolocation-track-advertisement p"> <label> <input type="checkbox" name="checkbox" id="advertisement"> ').h("i18n",t,{},{$key:"geo.trk.dialog.advertisement"}).w(' </label> </p></div><div class="tc-modal-footer"><button class="tc-button tc-ctl-geolocation-track-advert-ok"> ').h("i18n",t,{},{$key:"ok"}).w(" </button></div></div></div>")}t.__dustBody=!0;return t};e.template[e.CLASS+"-tracking-toast"]=function(){dust.register(e.CLASS+"-tracking-toast",t);function t(e,t){return e.w("<ul><li><span>").x(t.get(["isGeo"],!1),t,{else:o,block:r},{}).w(":</span> ").f(t.get(["x"],!1),t,"h").w("<br /><span>").x(t.get(["isGeo"],!1),t,{else:i,block:n},{}).w(":</span> ").f(t.get(["y"],!1),t,"h").w("<br />").x(t.get(["z"],!1),t,{block:a},{}).w("</li><li>").x(t.get(["accuracy"],!1),t,{block:p},{}).x(t.get(["speed"],!1),t,{block:c},{}).x(t.get(["mdt"],!1),t,{block:u},{}).w("</li></ul>")}t.__dustBody=!0;function o(e,t){return e.w("X")}o.__dustBody=!0;function r(e,t){return e.h("i18n",t,{},{$key:"lon"})}r.__dustBody=!0;function i(e,t){return e.w("Y")}i.__dustBody=!0;function n(e,t){return e.h("i18n",t,{},{$key:"lat"})}n.__dustBody=!0;function a(e,t){return e.w("<span>").x(t.get(["isGeo"],!1),t,{else:l,block:s},{}).w(":</span> ").f(t.get(["z"],!1),t,"h").w(" m<br />")}a.__dustBody=!0;function l(e,t){return e.w("Z")}l.__dustBody=!0;function s(e,t){return e.h("i18n",t,{},{$key:"ele"})}s.__dustBody=!0;function p(e,t){return e.w("<span>").h("i18n",t,{},{$key:"geo.trk.accuracy"}).w(":</span> ").f(t.get(["accuracy"],!1),t,"h").w(" m<br />")}p.__dustBody=!0;function c(e,t){return e.w("<span>").h("i18n",t,{},{$key:"geo.trk.speed"}).w(":</span> ").f(t.get(["speed"],!1),t,"h").w(" km/h<br />")}c.__dustBody=!0;function u(e,t){return e.w('<span title="').h("i18n",t,{},{$key:"mdt.title"}).w('">').h("i18n",t,{},{$key:"ele"}).w(" (").h("i18n",t,{},{$key:"mdt"}).w("):</span> ").f(t.get(["mdt"],!1),t,"h").w(" m<br />")}u.__dustBody=!0;return t}}e.register=function(e){var t=this;TC.Control.prototype.register.call(t,e);t.wrap=new TC.wrap.control.Geolocation(t);t.wrap.register(e);e.addLayer({id:t.getUID(),type:TC.Consts.layerType.VECTOR,stealth:!0,title:"Posicionar.GPS"}).then(function(e){t.layerGPS=e});e.addLayer({id:t.getUID(),type:TC.Consts.layerType.VECTOR,stealth:!0,title:"Posicionar.Tracking",styles:{point:{radius:3,fillColor:"#00ced1",fillOpacity:function(){return this.track.renderTrack.checked?1:0}.bind(t),strokeColor:"#ffffff",fontColor:"#00ced1",labelOutlineColor:"#ffffff",labelOutlineWidth:1,label:function(e){var t=e.getData().name;return t=t&&(t+"").trim().length>0?(t+"").trim().toLowerCase():""}},line:{strokeOpacity:function(){return this.track.renderTrack.checked?1:0}.bind(t),strokeWidth:2,strokeColor:"#00ced1",lineDash:[.1,6]}}}).then(function(e){t.layerTracking=e;t._trackingLayerDeferred.resolve(e)});var o=function(e){if(e.layer==this.layerTrack)switch(!0){case e.type+"."+e.namespace===TC.Consts.event.LAYERREMOVE:this.wrap.deactivateSnapping();this.getSelectedTrack()&&this.clearSelectedTrack();this.resultsPanelChart&&this.resultsPanelChart.close();this.layerTrack=void 0;break;case e.opacity>0&&e.opacity<1:return;case 0==e.layer.getVisibility():this.resultsPanelChart&&this.resultsPanelChart.minimize();case 0==e.opacity:this.wrap.deactivateSnapping();break;case 1==e.layer.getVisibility():this.resultsPanelChart&&this.resultsPanelChart.maximize();case 1==e.opacity:this.wrap.activateSnapping()}}.bind(t);t._trackLayerBindEvents=function(t){t?e.on(TC.Consts.event.LAYERVISIBILITY+" "+TC.Consts.event.LAYEROPACITY+" "+TC.Consts.event.LAYERREMOVE,o):e.off(TC.Consts.event.LAYERVISIBILITY+" "+TC.Consts.event.LAYEROPACITY+" "+TC.Consts.event.LAYERREMOVE,o)};e.on(TC.Consts.event.FEATURESIMPORT,function(e){const t=this,o=/.kml$/g.test(e.fileName.toLowerCase())&&t.importedByMe||!1;if(/.gpx$/g.test(e.fileName.toLowerCase())||o){if(o){for(var r=0;r<t.map.workLayers.slice().reverse().length;r++){var i=t.map.workLayers.slice().reverse()[r];if(i.title&&i.title.toLowerCase().trim()===e.fileName.toLowerCase().trim()){t.map.removeLayer(i);break}}t.importedByMe=!1}t.importTrack(e);o&&t.layerTrack&&t.layerTrack.styles&&t.layerTrack.features.forEach(function(e){e instanceof TC.feature.Point&&t.layerTrack.styles.point?e.setStyle(t.layerTrack.styles.point):e instanceof TC.feature.Polyline&&t.layerTrack.styles.line&&e.setStyle(t.layerTrack.styles.line)})}}.bind(t))};e.render=function(e){var t=this;t.getRenderedHtml(t.CLASS+"-dialog",null,function(e){t._$dialogDiv.html(e)}).then(function(){TC.Control.prototype.render.call(t,e)})};e.importTrack=function(e){var t=this;if(t.isDisabled)/.gpx$/g.test(e.fileName.toLowerCase())&&t.map.toast(t.getLocaleString("geo.trk.import.disabled"),{type:TC.Consts.msgType.WARNING});else if(e.fileName&&e.features&&e.features.length>0){if(t.layerTrack){t.map.removeLayer(t.layerTrack);t.layerTrack=void 0}t.getLayer(t.Const.Layers.TRACK).then(function(o){t._trackLayerBindEvents(!1);t.layerTrack.setVisibility(!1);t._trackLayerBindEvents(!0);var r=t.getLoadingIndicator().addWait();t.importedFileName=e.fileName;for(var i=0,n=e.features.length;i<n;i++)t.layerTrack.addFeature(e.features[i]);t.wrap.processImportedFeatures(r);if(t.layerTrack){t.map&&t.map.layout&&t.map.layout.accordion&&t._$div.hasClass(TC.Consts.classes.COLLAPSED)&&t.map.controls.filter(function(e){return e!==t&&!e.containerControl}).forEach(function(e){e._$div.addClass(TC.Consts.classes.COLLAPSED)});t._$div.removeClass(TC.Consts.classes.COLLAPSED);$("."+t.CLASS+"-btn-tracks > span").click();t.map.$events.trigger($.Event(TC.Consts.event.TOOLSOPEN),{})}})}};var t=!0;e.renderData=function(a,l){var s=this,p=function(e,t){return(t.match(/(moveTop.*)/g)||[]).join(" ")};s.trackingActive={isTrackingActive:!1,get:function(){return this.isTrackingActive},set:function(e){this.isTrackingActive=e;s.$geoInfoResult||(s.$geoInfoResult=$("."+s.CLASS+"-info-tracking div.tc-ctl-p-results"));switch(this.isTrackingActive){case!0:if(s.elevationActiveCollapsed.get()){s.$geoInfoResult.removeClass(p).addClass("moveTop57");s.$geoInfoResult.find(".prcollapsed").removeClass("prcollapsed-samehw");s.$geoInfoResult.find(".prpanel-heading").removeClass("prpanel-heading-samehw")}else if(s.elevationActive.get()){s.$geoInfoResult.removeClass(p).addClass("moveTop159");s.$geoInfoResult.find(".prcollapsed").addClass("prcollapsed-samehw");s.$geoInfoResult.find(".prpanel-heading").addClass("prpanel-heading-samehw")}else{s.$geoInfoResult.removeClass(p).addClass("moveTop33");s.$geoInfoResult.find(".prcollapsed").removeClass("prcollapsed-samehw");s.$geoInfoResult.find(".prpanel-heading").removeClass("prpanel-heading-samehw")}}}};s.elevationActive={isElevationActive:!1,get:function(){return this.isElevationActive},set:function(e){this.isElevationActive=e;s.$geoInfoResult||(s.$geoInfoResult=$("."+s.CLASS+"-info-tracking div.tc-ctl-p-results"));switch(this.isElevationActive){case!0:if(s.trackingActive.get()){s.$geoInfoResult.removeClass(p).addClass("moveTop159");s.$geoInfoResult.find(".prcollapsed").addClass("prcollapsed-samehw");s.$geoInfoResult.find(".prpanel-heading").addClass("prpanel-heading-samehw")}break;case!1:if(s.trackingActive.get()){s.$geoInfoResult.removeClass(p).addClass("moveTop33");s.$geoInfoResult.find(".prcollapsed").removeClass("prcollapsed-samehw");s.$geoInfoResult.find(".prpanel-heading").removeClass("prpanel-heading-samehw")}}}};s.elevationActiveCollapsed={isElevationActiveCollapsed:!1,get:function(){return this.isElevationActiveCollapsed},set:function(e){this.isElevationActiveCollapsed=e;s.$geoInfoResult||(s.$geoInfoResult=$("."+s.CLASS+"-info-tracking div.tc-ctl-p-results"));switch(this.isElevationActiveCollapsed){case!0:if(s.trackingActive.get()){s.$geoInfoResult.removeClass(p).addClass("moveTop57");s.$geoInfoResult.find(".prcollapsed").removeClass("prcollapsed-samehw");s.$geoInfoResult.find(".prpanel-heading").removeClass("prpanel-heading-samehw")}break;case!1:if(s.trackingActive.get()){s.$geoInfoResult.removeClass(p).addClass("moveTop159");s.$geoInfoResult.find(".prcollapsed").addClass("prcollapsed-samehw");s.$geoInfoResult.find(".prpanel-heading").addClass("prpanel-heading-samehw")}}}};var u=s.Const.Selector;TC.Control.prototype.renderData.call(s,a,function(){var a=s._$div.find(s._classSelector+"-panel");s._$div.find(".tc-ctl-geolocation-select span").on(TC.Consts.event.CLICK,function(e){var t=$(this).closest("label").find("input[type=radio][name=mode]").val();a.removeClass(TC.Consts.classes.HIDDEN);a.not(".tc-ctl-geolocation-"+t).addClass(TC.Consts.classes.HIDDEN)});s.gps={};s.gps.$activateButton=s._$div.find(s._classSelector+"-locate-show");s.gps.$deactivateButton=s._$div.find(s._classSelector+"-locate-hide");s.track={};s.track.$activateButton=s._$div.find(s._classSelector+"-track-ui-activate");s.track.$deactivateButton=s._$div.find(s._classSelector+"-track-ui-deactivate");s.track.$info=s._$div.find(s._classSelector+"-info-tracking").appendTo(s.map._$div);$(document).on("click","#trackingInfoMin",function(){var e=$(this).closest("div.tc-ctl-p-results");e.find(".prsidebar-body").toggle("slide",function(){e.find(".prcollapsed-max").fadeIn()})});$(document).on("click","#trackingInfoMax",function(){var e=$(this).closest("div.tc-ctl-p-results");e.find(".prsidebar-body").toggle("slide");e.find(".prcollapsed-max").hide()});$(document).on("click","#trackingInfoClose",function(){$(this).closest("div.tc-ctl-p-results").find(".prsidebar-body").fadeOut("slide")});s.track.$trackSearch=s._$div.find(s._classSelector+"-track-available-srch");s.track.$trackList=s._$div.find(s._classSelector+"-track-available-lst");s.track.$trackToolPanelOpened=s._$div.find("#tc-ctl-geolocation-track-panel-opened");s._$div.find("."+e.CLASS+"-track-panel-help").on("click",function(){n.call(s)});s.track.$trackName=s._$div.find(s._classSelector+"-track-title");s.track.$trackSave=s._$div.find(s._classSelector+"-track-save");s.track.$trackWPT=s._$div.find(s._classSelector+"-track-waypoint");s.track.$trackAdd=s._$div.find(s._classSelector+"-track-add-wpt");s.track.$trackContinue=s._$dialogDiv.find(".tc-ctl-geolocation-track-continue");s.track.$trackRenew=s._$dialogDiv.find(".tc-ctl-geolocation-track-new");s.track.$trackClose=s._$dialogDiv.find(".tc-ctl-geolocation-continue-track-dialog button.tc-modal-close");s.track.$trackAddSegment=s._$div.find("#tc-ctl-geolocation-track-segment");s.track.$trackAdvertisementOK=s._$dialogDiv.find(".tc-ctl-geolocation-track-advert-ok");s.track.$trackImportFile=s._$div.find(s._classSelector+"-track-import");TC.Util.detectMobile()&&Modernizr.mq("screen and (max-height: 50em) and (max-width: 50em)")&&s.track.$trackToolPanelOpened.prop("checked",!1);if(window.File&&window.FileReader&&window.FileList&&window.Blob){s.track.$trackImportFile.prop("disabled",!1);s.track.$trackImportFile.on(TC.Consts.event.CLICK,function(e){$(this).wrap("<form>").closest("form").get(0).reset();$(this).unwrap()});s.track.$trackImportFile.on("change",function(e){if(!s._cleaning){s.clear(s.Const.Layers.TRACK);if(s.map){s.map.on(TC.Consts.event.LAYERERROR,o);s.importedByMe=!0;s.map.wrap.loadFiles(e.target.files)}}})}else console.log("no es posible la importaci\xf3n");s.gps.$activateButton.on("click",function(){s.activateGPS()});s.gps.$deactivateButton.on("click",function(){s.deactivateGPS()});s.track.$activateButton.on("click",function(){s.activateTracking();r.call(s)});s.track.$deactivateButton.on("click",function(){s.deactivateTracking();i.call(s)});var l=function(e){e=e.toLowerCase();var t=s.track.$trackList.find("li").hide(),o=t.filter("li:not([class]),li."+s.Const.Classes.SELECTEDTRACK);if(0===e.length){o.show();s._$div.find(s._classSelector+"-track-search-icon").css("visibility","visible")}else{s._$div.find(s._classSelector+"-track-search-icon").css("visibility","hidden");var r=new RegExp(e,"i");o.each(function(){var e=$(this);e.toggle(r.test(e.children("span").text()))});0===o.filter(":visible").length&&t.filter('[class^="tc-ctl-geolocation-track-not"]').show()}};s.track.$trackSearch.on("keyup search",function(){l($(this).val().toLowerCase().trim())});try{if(s.track.$trackSearch.has($("::-ms-clear"))){s.track.$trackSearch.on("mouseup",function(e){""!==s.track.$trackSearch.val()&&setTimeout(function(){var e=s.track.$trackSearch.val();""===e&&l(e)},1)})}}catch(e){}s.track.$trackSave.on("click",$.proxy(s.saveTrack,s));s.track.$trackAdd.on("click",$.proxy(s.addWaypoint,s));var p=function(e,t){t.is("li")||(t=t.parent());if(e){t.find("input").first().removeClass(TC.Consts.classes.HIDDEN);t.find("span").first().addClass(TC.Consts.classes.HIDDEN);t.find("input").first().focus().val(t.find("span").first().text());t.find(u.SIMULATE).first().addClass(TC.Consts.classes.HIDDEN);t.find(u.EDIT).first().addClass(TC.Consts.classes.HIDDEN);t.find(u.DELETE).first().addClass(TC.Consts.classes.HIDDEN);t.find(u.DRAW).first().addClass(TC.Consts.classes.HIDDEN);t.find(u.EXPORT_GPX).first().addClass(TC.Consts.classes.HIDDEN);t.find(u.EXPORT_KML).first().addClass(TC.Consts.classes.HIDDEN);t.find(u.SAVE).first().removeClass(TC.Consts.classes.HIDDEN);t.find(u.CANCEL).first().removeClass(TC.Consts.classes.HIDDEN)}else{t.find("input").first().addClass(TC.Consts.classes.HIDDEN);t.find("span").first().removeClass(TC.Consts.classes.HIDDEN);t.find(u.SIMULATE).first().removeClass(TC.Consts.classes.HIDDEN);t.find(u.EDIT).first().removeClass(TC.Consts.classes.HIDDEN);t.find(u.DELETE).first().removeClass(TC.Consts.classes.HIDDEN);t.find(u.DRAW).first().removeClass(TC.Consts.classes.HIDDEN);t.find(u.EXPORT_GPX).first().removeClass(TC.Consts.classes.HIDDEN);t.find(u.EXPORT_KML).first().removeClass(TC.Consts.classes.HIDDEN);t.find(u.SAVE).first().addClass(TC.Consts.classes.HIDDEN);t.find(u.CANCEL).first().addClass(TC.Consts.classes.HIDDEN)}};s.uiSimulate=function(e,t){var o=[u.SIMULATE,u.EDIT,u.DELETE,u.EXPORT_GPX,u.EXPORT_KML],r=[u.STOP,u.PAUSE,u.BACKWARD,u.FORWARD,u.SPEED],i=t.is("li")?t:t.parent();if(e){for(var n=0;n<o.length;n++)$(i).find(o[n]).first().attr("hidden","hidden");for(n=0;n<r.length;n++)$(i).find(r[n]).first().removeAttr("hidden")}else{for(n=0;n<r.length;n++)$(i).find(r[n]).first().attr("hidden","hidden");for(n=0;n<o.length;n++)$(i).find(o[n]).first().removeAttr("hidden")}};$(document).on("click",u.SIMULATE,function(){var e=s.getLoadingIndicator().addWait();$(this).parent().find(u.SPEED).text("x 1");$.when(h(s,this)).then(function(){s.getLoadingIndicator().removeWait(e)})});$(document).on("click",u.DRAW,function(){var e=s.getLoadingIndicator().addWait();$.when(d(s,this)).then(function(){s.getLoadingIndicator().removeWait(e)})});s.$events.on(s.Const.Event.IMPORTEDTRACK,function(e,t){if(s.isDisabled)s.map.toast(s.getLocaleString("geo.trk.import.disabled"),{type:TC.Consts.msgType.WARNING});else{var o=s.track.$trackList.find('li[data-id="'+t+'"]');d(s,o.find(u.DRAW));s.track.$trackList.animate({scrollTop:t*o.outerHeight()},"slow")}});var g=function(e,t){for(var o=e.track.$trackList.find("li[data-id]"),r=0;r<o.length;r++){var i=$(o[r]);if(i&&i.attr("data-id")!==t){var n=i.find(u.SIMULATE),a=i.find(u.PAUSE);n.toggleClass(e.Const.Classes.SIMULATIONACTIVATED,!1);n.attr("title",e.getLocaleString("tr.lst.simulate"));a.toggleClass("play",!1);a.attr("title",e.getLocaleString("tr.lst.pause"));e.uiSimulate(!1,i);p(!1,i)}}e.clear(e.Const.Layers.TRACK)},d=function(e,t){var o=$.Deferred(),r=$(t).parent();setTimeout(function(){if(r.hasClass(e.Const.Classes.SELECTEDTRACK)){e.uiSimulate(!1,$(t));e.clear(e.Const.Layers.TRACK);$(t).attr("title",$(t).text());e.elevationActive.set(!1);if(void 0!==e.layerTrack){e.map.removeLayer(e.layerTrack);e.layerTrack=void 0}}else if(e.getSelectedTrack().length>0){g(e,r.attr("data-id"));e.drawTrack(r)}else e.drawTrack(r);o.resolve()},0);return o.promise()},h=function(e,t){var o=$.Deferred();setTimeout(function(){var r=$(t).parent();e.getLayer(e.Const.Layers.TRACK).then(function(i){g(e,r.attr("data-id"));e.uiSimulate(!1,e.getSelectedTrack());$(this).parent().addClass(e.Const.Classes.SELECTEDTRACK);e.uiSimulate(!0,$(t));e.simulate_paused=!1;e.simulateTrack($(t).parent());o.resolve()})},0);return o.promise()};$(document).on("click",s._classSelector+" "+u.EDIT,function(){p(!0,$(this))});$(document).on("click",s._classSelector+" "+u.DELETE,function(){s.removeTrack($(this).parent())});$(document).on("click",s._classSelector+" "+u.SAVE,function(){if(0==$(this).parent().find("input").first().val().trim().length)TC.alert(s.getLocaleString("geo.trk.edit.alert"));else{s.editTrackName($(this).parent().attr("data-id"),$(this).parent().find("input").first().val());p(!1,$(this))}});$(document).on("click",s._classSelector+" "+u.CANCEL,function(){p(!1,$(this))});$(document).on("click",s._classSelector+" "+u.EXPORT_GPX+","+s._classSelector+" "+u.EXPORT_KML,function(){var e=this,t=$.grep($(this).attr("class").split(" "),function(e){return 0===e.indexOf("tc-btn-export-")})[0].replace("tc-btn-export-","").toUpperCase();s.export(t,$(this).parent()).then(function(o){if(o){var r=$(e).parent().find("span").first().text(),i=new RegExp(s.Const.SupportedFileExtensions.join("|"),"gi"),n=r.replace(i,"");TC.Util.downloadFile(n+"."+t.toLowerCase(),s.Const.MimeMap[t],o)}else TC.alert(s.getLocaleString("geo.error.export"))})});$(document).on("click",s._classSelector+" "+u.STOP,function(){s.uiSimulate(!1,$(this));s.wrap.simulateTrackEnd();var e=$(this).parent().find(u.PAUSE);e.toggleClass("play",!1);e.attr("title",s.getLocaleString("tr.lst.pause"));$(this).parent().find(u.SPEED).text("x 1");s.simulate_speed=1});$(document).on("click",s._classSelector+" "+u.PAUSE,function(){s.simulate_paused=!$(this).hasClass("play");s.simulate_paused&&(s.simulate_pausedElapse=-1);$(this).attr("title",s.getLocaleString(s.simulate_paused?"tr.lst.play":"tr.lst.pause"));$(this).toggleClass("play",s.simulate_paused)});$(document).on("click",s._classSelector+" "+u.BACKWARD,function(){1==s.simulate_speed?s.simulate_speed=.5:s.simulate_speed=s.simulate_speed/2;$(s._classSelector+" "+u.FORWARD).removeAttr("disabled");$(this).parent().find(u.SPEED).text(s.simulate_speed<1?"/ "+1/s.simulate_speed:"x "+s.simulate_speed);.000244140625==s.simulate_speed&&$(this).attr("disabled","disabled")});$(document).on("click",s._classSelector+" "+u.FORWARD,function(){s.simulate_speed=s.simulate_speed/.5;$(this).parent().find(u.SPEED).text(s.simulate_speed<1?"/ "+1/s.simulate_speed:"x "+s.simulate_speed);$(s._classSelector+" "+u.BACKWARD).removeAttr("disabled");4096==s.simulate_speed&&$(this).attr("disabled","disabled")});s.track.$trackContinue.on("click",function(){TC.Util.closeModal();c.call(s)});s.track.$trackRenew.on("click",function(){delete s.sessionTracking;TC.Util.storage.setSessionLocalValue(s.Const.LocalStorageKey.TRACKINGTEMP,void 0);localforage.removeItem(s.Const.LocalStorageKey.TRACKINGTEMP);TC.Util.closeModal();c.call(s)});s.track.$trackClose.on("click",function(){i.call(s)});s.track.$trackAddSegment.on("click",function(){TC.alert("pendiente");TC.Util.closeModal()});s.track.$trackAdvertisementOK.on("click",function(){var e=$("body").find('input[name*="Advertisement"]:checked');if(e.length>0){var t=new $.Deferred;window.localforage?t.resolve():TC.loadJS(!window.localforage,[TC.Consts.url.LOCALFORAGE],function(){t.resolve()});t.then(function(){localforage.setItem(e.first().attr("name"),!1)})}TC.Util.closeModal()});s.track.renderTrack=$("#tc-ctl-geolocation-track-render").on("change",function(){s.track.$activateButton.hasClass(TC.Consts.classes.HIDDEN)&&s.layerTracking.setVisibility(this.checked);t=this.checked});window.localforage?s.bindTracks():TC.loadJS(!window.localforage,[TC.Consts.url.LOCALFORAGE],function(){s.bindTracks()})});$.isFunction(l)&&l()};e.activate=function(){};e.deactivate=function(){TC.Util.closeModal();this.clearSelection();this.deactivateTracking()};var o=function(){this.map.off(TC.Consts.event.LAYERERROR,o);this.clearFileInput(this.track.$trackImportFile);TC.alert(this.getLocaleString("geo.trk.upload.error3"))},r=function(){this.track.$activateButton.toggleClass(TC.Consts.classes.HIDDEN,!0);this.track.$deactivateButton.toggleClass(TC.Consts.classes.HIDDEN,!1)},i=function(){this.track.$activateButton.toggleClass(TC.Consts.classes.HIDDEN,!1);this.track.$deactivateButton.toggleClass(TC.Consts.classes.HIDDEN,!0)},n=function(){this.map.toast(this._$div.find(".alert-warning").html(),{duration:1e4})};e.markerStyle={radius:7,fillColor:[255,0,0,100],strokeColor:[255,255,255,255],strokeWidth:2};e.lineStyle={strokeWidth:2,strokeColor:[0,206,209,255]};e.getLayer=function(e){var t,o=this,r="";switch(!0){case e==o.Const.Layers.TRACKING:void 0!==o.layerTracking;r="layerTracking";break;case e==o.Const.Layers.TRACK:void 0!==o.layerTrack;r="layerTrack";t={line:{strokeWidth:2,strokeColor:"#C52737"},point:{radius:function(e){var t=e.getData().name;return t&&(t+"").trim().length>0?3:6},fillColor:"#C52737",strokeColor:"#ffffff",fontColor:"#C52737",fontSize:10,labelOutlineColor:"#ffffff",labelOutlineWidth:2,label:function(e){var t=e.getData().name;return t=t&&(t+"").trim().length>0?(t+"").trim().toLowerCase():""}}};break;case e==o.Const.Layers.GPS:void 0!==o.layerGPS;r="layerGPS"}if(this[r]){var i=new $.Deferred;i.resolve(this[r]);return i}if(o.layerPromise&&"resolved"!==o.layerPromise.state())return o.layerPromise;o.layerPromise=new $.Deferred;var n={id:o.getUID(),type:TC.Consts.layerType.VECTOR,title:o.getLocaleString("geo")+" - "+e,stealth:!0};t&&(n.styles=t);o.map.addLayer(n).then(function(e){this[r]=e;this[r].map.putLayerOnTop(e);o.layerPromise.resolve(this[r])}.bind(o));return o.layerPromise};e.activateGPS=function(){var e=this;e.deactivateTracking();C.call(e,e.Const.LocalStorageKey.GPSSHOWADVERTISEMENT);u.apply(e);f.apply(e);e.gps.$activateButton.toggleClass(TC.Consts.classes.HIDDEN,!0);e.gps.$deactivateButton.toggleClass(TC.Consts.classes.HIDDEN,!1);e.track.$trackToolPanelOpened.prop("checked")||e.map.$events.trigger($.Event(TC.Consts.event.TOOLSCLOSE),{});$.when(e.getLayer(e.Const.Layers.GPS)).then(function(t){e.currentPositionWaiting=e.getLoadingIndicator().addWait();if(navigator.geolocation){var o=function(o){o=o.coords;e.geopositionGPS=!0;var r=TC.Util.reproject([o.longitude,o.latitude],"EPSG:4326",e.map.crs);e.getLoadingIndicator().removeWait(e.currentPositionWaiting);t&&t.clearFeatures();var i;i=r,function(e,t){return!(e instanceof Array)||t[0]>=e[0]&&t[0]<=e[2]&&t[1]>=e[1]&&t[1]<=e[3]}(e.map.options.maxExtent,i)?$.when(t.addCircle([r,o.accuracy/e.map.getMetersPerUnit()]),t.addMarker(r,{title:"GPS",cssClass:TC.Consts.classes.POINT,anchor:[.5,.5]})).then(function(o,r){e.gps.accuracyCircle=o;e.gps.geoPosition=r;if(!e.wrap.pulsated){e.map.zoomToFeatures(t.features,{animate:!1});e.wrap.pulsate(o)}}):TC.alert(e.getLocaleString("geo.error.out"))};if(navigator.geolocation){navigator.geolocation.getCurrentPosition(function(t){e.data=t;o(t);e.currentPosition=navigator.geolocation.watchPosition(o,e.onGeolocateError.bind(e))},e.onGeolocateError.bind(e));setTimeout(function(){if(!e.data){e.getLoadingIndicator().removeWait(e.currentPositionWaiting);e.map.toast(e.getLocaleString("geo.error.permission_denied"),{type:TC.Consts.msgType.WARNING});e.gps.$activateButton.toggleClass(TC.Consts.classes.HIDDEN,!1);e.gps.$deactivateButton.toggleClass(TC.Consts.classes.HIDDEN,!0)}},61e3)}else alert("not supported")}else e.onGeolocateError()})};e.deactivateGPS=function(){delete this.geopositionGPS;g();y();delete this.wrap.pulsated;navigator.geolocation&&this.currentPosition&&navigator.geolocation.clearWatch(this.currentPosition);$.when(this.getLayer(this.Const.Layers.GPS)).then(function(e){e&&e.clearFeatures()});this.gps.$activateButton.toggleClass(TC.Consts.classes.HIDDEN,!1);this.gps.$deactivateButton.toggleClass(TC.Consts.classes.HIDDEN,!0);this.currentPositionWaiting&&this.getLoadingIndicator().removeWait(this.currentPositionWaiting);return!0};e.setFormatInfoNewPosition=function(e){var t={},o=TC.Util.getMapLocale(this.map);t.x=Math.round(e.position[0]).toLocaleString(o);t.y=Math.round(e.position[1]).toLocaleString(o);t.z=Math.round(e.altitude).toLocaleString(o);t.accuracy=Math.round(e.accuracy).toLocaleString(o);t.speed=e.speed.toLocaleString(o,{minimumFractionDigits:1,maximumFractionDigits:1});return t};e.renderInfoNewPosition=function(e){var t=this;t.getRenderedHtml(t.CLASS+"-tracking-toast",t.setFormatInfoNewPosition(e.pd),function(e){t.track.$info.find(".prpanel-body").html(e);t.track.$info.hasClass(TC.Consts.classes.HIDDEN)&&t.track.$info.removeClass(TC.Consts.classes.HIDDEN);t.trackingActive.set(!0)})};var a,l,s,p=function(){this.track.$trackToolPanelOpened.prop("checked")||this.map.$events.trigger($.Event(TC.Consts.event.TOOLSCLOSE),{})},c=function(){var e=this;e.activate();r.call(e);p.call(e);e.track.$info.find(".prsidebar-body").show();e.$events.on(e.Const.Event.POSITIONCHANGE,function(t){e.currentPoint=t.pd;e.renderInfoNewPosition(t);e.track.$trackName.removeAttr("disabled");e.track.$trackSave.removeAttr("disabled");e.track.$trackWPT.removeAttr("disabled");e.track.$trackAdd.removeAttr("disabled");TC.Util.storage.setSessionLocalValue(e.Const.LocalStorageKey.TRACKINGTEMP,e.wrap.formattedToStorage(e.layerTracking).features)});e.$events.on(e.Const.Event.STATEUPDATED,function(e){});e.clear(e.Const.Layers.TRACKING);C.call(e,e.Const.LocalStorageKey.TRACKINGSHOWADVERTISEMENT);e.wrap.setTracking(!0)},u=function(){if(!this.videoScreenOn){var e={WebM:"data:video/webm;base64,GkXfo0AgQoaBAUL3gQFC8oEEQvOBCEKCQAR3ZWJtQoeBAkKFgQIYU4BnQI0VSalmQCgq17FAAw9CQE2AQAZ3aGFtbXlXQUAGd2hhbW15RIlACECPQAAAAAAAFlSua0AxrkAu14EBY8WBAZyBACK1nEADdW5khkAFVl9WUDglhohAA1ZQOIOBAeBABrCBCLqBCB9DtnVAIueBAKNAHIEAAIAwAQCdASoIAAgAAUAmJaQAA3AA/vz0AAA=",MP4:"data:video/mp4;base64,AAAAHGZ0eXBpc29tAAACAGlzb21pc28ybXA0MQAAAAhmcmVlAAAAG21kYXQAAAGzABAHAAABthADAowdbb9/AAAC6W1vb3YAAABsbXZoZAAAAAB8JbCAfCWwgAAAA+gAAAAAAAEAAAEAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAIVdHJhawAAAFx0a2hkAAAAD3wlsIB8JbCAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAQAAAAAAIAAAACAAAAAABsW1kaWEAAAAgbWRoZAAAAAB8JbCAfCWwgAAAA+gAAAAAVcQAAAAAAC1oZGxyAAAAAAAAAAB2aWRlAAAAAAAAAAAAAAAAVmlkZW9IYW5kbGVyAAAAAVxtaW5mAAAAFHZtaGQAAAABAAAAAAAAAAAAAAAkZGluZgAAABxkcmVmAAAAAAAAAAEAAAAMdXJsIAAAAAEAAAEcc3RibAAAALhzdHNkAAAAAAAAAAEAAACobXA0dgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAIAAgASAAAAEgAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABj//wAAAFJlc2RzAAAAAANEAAEABDwgEQAAAAADDUAAAAAABS0AAAGwAQAAAbWJEwAAAQAAAAEgAMSNiB9FAEQBFGMAAAGyTGF2YzUyLjg3LjQGAQIAAAAYc3R0cwAAAAAAAAABAAAAAQAAAAAAAAAcc3RzYwAAAAAAAAABAAAAAQAAAAEAAAABAAAAFHN0c3oAAAAAAAAAEwAAAAEAAAAUc3RjbwAAAAAAAAABAAAALAAAAGB1ZHRhAAAAWG1ldGEAAAAAAAAAIWhkbHIAAAAAAAAAAG1kaXJhcHBsAAAAAAAAAAAAAAAAK2lsc3QAAAAjqXRvbwAAABtkYXRhAAAAAQAAAABMYXZmNTIuNzguMw=="};this.videoScreenOn=document.createElement("video");this.videoScreenOn.setAttribute("loop","");this.videoScreenOn.setAttribute("muted","");this.videoScreenOn.setAttribute("webkit-playsinline","");this.videoScreenOn.setAttribute("playsinline","");this.videoScreenOn.setAttribute("style","transform: translateZ(0px);");var t=document.createElement("source");t.src=e.WebM;t.type="video/webm";this.videoScreenOn.appendChild(t);var o=document.createElement("source");o.src=e.MP4;o.type="video/mp4";this.videoScreenOn.appendChild(o)}this.videoScreenOn.play()},g=function(){this.videoScreenOn&&this.videoScreenOn.pause()},d=function(){this.videoScreenOn.paused&&this.videoScreenOn.play();v.apply(this)},h=function(){var e=function(){var e=["webkit","moz","ms","o"];if("hidden"in document)return"hidden";for(var t=0;t<e.length;t++)if(e[t]+"Hidden"in document)return e[t]+"Hidden";return null}();document[e]||d.apply(this);console.log("video is: "+this.videoScreenOn.paused)},f=function(){s||(s=h.bind(this));a||(a=function(){m.apply(this)}.bind(this));l||(l=d.bind(this));window.addEventListener("visibilitychange",s,!1);if(TC.Util.detectSafari()&&Modernizr.touch&&!navigator.userAgent.match(/Android/i)&&!navigator.userAgent.match(/CriOS/i)){window.addEventListener("pagehide",a,!1);window.addEventListener("pageshow",l,!1)}else{window.addEventListener("blur",a,!1);window.addEventListener("focus",l,!1)}},y=function(){window.removeEventListener("visibilitychange",s,!1);if(TC.Util.detectSafari()&&Modernizr.touch&&!navigator.userAgent.match(/Android/i)&&!navigator.userAgent.match(/CriOS/i)){window.removeEventListener("pagehide",a,!1);window.removeEventListener("pageshow",l,!1)}else{window.removeEventListener("blur",a,!1);window.removeEventListener("focus",l,!1)}},m=function(){var e=TC.Util.storage.getSessionLocalValue(this.Const.LocalStorageKey.TRACKINGTEMP);e&&e.length>0&&localforage.setItem(this.Const.LocalStorageKey.TRACKINGTEMP,"string"==typeof e?e:JSON.stringify(e))},v=function(){var e=this;localforage.getItem(e.Const.LocalStorageKey.TRACKINGTEMP).then(function(t){null!==t&&"null"!==t&&t.length>0&&TC.Util.storage.setSessionLocalValue(e.Const.LocalStorageKey.TRACKINGTEMP,t)})},C=function(e){var t=this,o=new $.Deferred;window.localforage?o.resolve():TC.loadJS(!window.localforage,[TC.Consts.url.LOCALFORAGE],function(){o.resolve()});o.then(function(){localforage.getItem(e).then(function(o){if(null==o){var r=t._$dialogDiv.find(".tc-ctl-geolocation-track-advert-dialog");r.find('input[type="checkbox"]').first().attr("name",e).removeAttr("checked");TC.Util.detectMobile()?$("#pageBlurMsg").text(t.getLocaleString("geo.trk.page.blur")):$("#pageBlurMsg").text(t.getLocaleString("geo.trk.page.blur.desktop"));e==t.Const.LocalStorageKey.GPSSHOWADVERTISEMENT?r.find("h3").text(t.getLocaleString("geo.track.activate")+" "+t.getLocaleString("geo.gps")):r.find("h3").text(t.getLocaleString("geo.track.activate.title"));TC.Util.showModal(t._$dialogDiv.find(".tc-ctl-geolocation-track-advert-dialog"))}})});t.map.toast(TC.Util.detectMobile()?t.getLocaleString("geo.trk.page.blur"):t.getLocaleString("geo.trk.page.blur.desktop"),{type:TC.Consts.msgType.WARNING})};e._askTracking=function(e){TC.Util.showModal(this._$dialogDiv.find(".tc-ctl-geolocation-continue-track-dialog"),{closeCallback:function(){$.isFunction(e)&&e()}});return!0};e.activateTracking=function(){var e=this,t=!0;e.isActive||e.activate();e.clear(e.Const.Layers.TRACKING);try{TC.Util.storage.setSessionLocalValue(e.Const.LocalStorageKey.TEST,e.Const.LocalStorageKey.TEST)}catch(o){o.code===DOMException.QUOTA_EXCEEDED_ERR?TC.alert(e.getLocaleString("geo.error.trackinglocalstorage")):TC.error(o);t=!1}if(t){u.apply(e);f.apply(e);e.sessionTracking=TC.Util.storage.getSessionLocalValue(e.Const.LocalStorageKey.TRACKINGTEMP);if(e.sessionTracking){e._askTracking(function(){i.call(e)})||e.track.$trackRenew.click()}else c.call(e)}else i.call(e)};e.deactivateTracking=function(){var e=this,o=function(){e.track.$info.addClass(TC.Consts.classes.HIDDEN);$("#trackingInfoMax").hide();m.apply(e);e.wrap.setTracking(!1);delete e.geopositionTracking;t||$(e._classSelector+"-track-render").find("label").click();g.apply(e);y.apply(e);e.$events.off(e.Const.Event.POSITIONCHANGE);e.$events.off(e.Const.Event.STATEUPDATED);i.call(e);e.trackingActive.set(!1);e.track.$trackName.val("");e.track.$trackName.attr("disabled","disabled");e.track.$trackSave.attr("disabled","disabled");e.track.$trackWPT.val("");e.track.$trackWPT.attr("disabled","disabled");e.track.$trackAdd.attr("disabled","disabled");e.clear(e.Const.Layers.TRACKING);e.clear(e.Const.Layers.GPS);return!0};if(e.wrap.hasCoordinates()){e.map.toast(e.getLocaleString("geo.trk.deactivate.alert"),{duration:1e4});return o()}return o()};e.getStoredTracks=function(){var e=this,t=new $.Deferred,o=[];localforage.keys().then(function(r){var i=[];if(0==(r=r.filter(function(t){if(!t.startsWith(e.Const.LocalStorageKey.TRACKINGTEMP)&&t.startsWith(e.Const.LocalStorageKey.TRACKING)){if(/trk#\d/i.exec(t)){i.push(new $.Deferred);return!0}return!1}return!1})).length){e.availableTracks=o;t.resolve(o)}i.forEach(function(e,t){localforage.getItem(r[t],function(t,o){e.resolve(o)})});$.when.apply($,i).then(function(){var r=Array.prototype.slice.call(arguments,0);if(r&&r.length){r.forEach(function(e){(e=JSON.parse(e))instanceof Array?o=o.concat(e):o.push(e)});var i=o.length>1?T(o):o;e.availableTracks=i;t.resolve(i)}})});return t};var T=function(e){var t=[];for(var o in e)if(e[o]&&"object"==typeof e[o]){t.push(e[o]);t.sort(function(e,t){return"string"==typeof e.name&&$.isFunction(e.name.localeCompare)?e.name.localeCompare(t.name):0})}return t};e.setStoredTracks=function(e){var t=this,o=new $.Deferred,r=[];e.forEach(function(e){r.push(new $.Deferred);var o=r[r.length-1];localforage.setItem(t.Const.LocalStorageKey.TRACKING+"#"+e.uid,JSON.stringify(e),function(e,t){o.resolve(t)})});$.when.apply($,r).then(function(){t.getStoredTracks().then(function(){t.bindTracks();o.resolve()})});return o};e.getAvailableTracks=function(){var e=new $.Deferred;this.availableTracks?e.resolve(this.availableTracks):this.getStoredTracks().then(function(t){e.resolve(t)});return e};e.bindTracks=function(){var e=this;e.track.$trackList.find('li:not([class^="tc-ctl-geolocation-track-available-empty"])').hide();e.track.$trackList.find('li[class^="tc-ctl-geolocation-track-available-empty"]').hide();e.getAvailableTracks().then(function(t){if(S(t)){e.track.$trackList.find('li[class^="tc-ctl-geolocation-track-available-empty"]').show();e.track.$trackSearch.attr("disabled","disabled")}else{var o=$(e.getSelectedTrack()[0]).attr("data-uid");e.track.$trackList.find("li[data-id]").remove();for(var r=0;r<t.length;r++){var i=t[r];"object"==typeof i&&e.getRenderedHtml(e.CLASS+"-track-node",{id:r,uid:i.uid,name:i.name?i.name.trim():""},function(t){e.track.$trackList.append(t)})}o&&e.setSelectedTrack(e.track.$trackList.find('li[data-uid="'+o+'"]'));e.track.$trackSearch.removeAttr("disabled")}})};e.chartProgressInit=function(){window.d3||TC.syncLoadJS(TC.Consts.url.D3C3);var e=d3.select(".c3-event-rects,.c3-event-rects-single").node().getBoundingClientRect();$("body").append('<div class="miDiv">');this.miDiv=$("div.miDiv");this.miDiv.width(e.width);this.miDiv.height(e.height);this.miDiv.append('<div class="miProgressDiv">');this.miProgressDiv=$("div.miProgressDiv");this.miProgressDiv.addClass("tc-ctl-geolocation-track-elevation-chart-progress");this.miProgressDiv.width("0%");this.miProgressDiv.height(e.height);this.miProgressDiv.append('<div class="miProgressTextDiv">');this.miProgressTextDiv=$("div.miProgressTextDiv");this.miProgressTextDiv.addClass("tc-ctl-geolocation-track-elevation-chart-progress text");this.miProgressTextDiv.width(e.width);this.miProgressTextDiv.height(e.height);this.miDiv.css({top:e.top,left:e.left,bottom:e.bottom,right:e.right,position:"absolute","z-index":10007})};e.chartProgressClear=function(){$(this.miProgressTextDiv).remove();$(this.miProgressDiv).remove();$(this.miDiv).remove()};e.chartSetProgress=function(e,t,o,r){var i=e.d,n=(i+Math.hypot(e.p[0]-t[0],e.p[1]-t[1]))/o*100;this.miProgressDiv.width(n+"%");var a,l,s=this.map.options.locale&&this.map.options.locale.replace("_","-")||void 0,p=parseInt(t[2].toFixed(0)).toLocaleString(s);if(i/1e3<1){a=Math.round(i/1e3*1e3);l=" m"}else{a=Math.round(i/1e3*100)/100;l=" km"}a=a.toLocaleString(s);this.miProgressTextDiv.html("<div><span>"+p+" m</span><br><span>"+a+l+"</span></div>"+(r?"<br><span>"+r.toString+"</span>":""))};e._getTime=function(e,t){var o=t-e,r={},i=Math.floor(o/1e3/60/60/24);o-=1e3*i*60*60*24;var n=Math.floor(o/1e3/60/60);o-=1e3*n*60*60;r.h=n+24*i;var a=Math.floor(o/1e3/60);o-=1e3*a*60;r.m=a;r.s=Math.floor(o/1e3);return $.extend({},r,{toString:("00000"+r.h).slice(-2)+":"+("00000"+r.m).slice(-2)+":"+("00000"+r.s).slice(-2)})};e.simulateTrack=function(e){this.simulate_speed=1;this.drawTrack(e,!1);this.wrap.simulateTrack()};e.drawTrack=function(e,t){var o=this;p.call(o);o.getLayer(o.Const.Layers.TRACK).then(function(t){o.setSelectedTrack(e);o.drawTrackingData(e);o.elevationTrack(e);o.activate()})};e.elevationTrack=function(t,o){var r=this;if(o){r.resultsPanelChart.close();r.wrap.simulateTrackEnd();r.uiSimulate(!1,t)}if(!r.onResize){r.onResize=r.elevationTrack.bind(r,t,!0);window.addEventListener("resize",r.onResize,!1)}r.chart={coordinates:[]};r.track.elevationChart&&(r.track.elevationChart=r.track.elevationChart.destroy());(function(e){var t=new $.Deferred;TC.loadJS(!TC.tool||!TC.tool.Elevation,TC.apiLocation+"TC/tool/Elevation",function(){r.getTrackingData(e).then(function(e){var o=e.data;if(o){var i,n;i=[];n=[];var a,l,s,p=!0,c={},u={},g=function(){if(s.getLayout()==ol.geom.GeometryLayout.XYZ||s.getLayout()==ol.geom.GeometryLayout.XYZM){var e=0;if(r.map.crs!==r.map.options.utmCrs){line=new ol.geom.LineString(TC.Util.reproject(s.getCoordinates(),r.map.crs,r.map.options.utmCrs));e=line.getLength()}else e=s.getLength();return parseFloat((e/1e3).toFixed(2))}return null},d=function(){if(s.getLayout()==ol.geom.GeometryLayout.XYZM||s.getLayout()==ol.geom.GeometryLayout.XYM){var e=s.getLastCoordinate()[3]-s.getFirstCoordinate()[3];return{s:Math.floor(e/1e3%60),m:Math.floor(e/6e4%60),h:Math.floor(e/36e5%24)}}return null},h=function(e){if(r.chart.coordinates.length>0){var t=0;r.chart.coordinates.forEach(function(o,i,n){var a=0===i?o:n[i-1];if(r.map.crs!==r.map.options.utmCrs){o=TC.Util.reproject(o,r.map.crs,r.map.options.utmCrs);a=TC.Util.reproject(a,r.map.crs,r.map.options.utmCrs)}const l=o[0]-a[0],s=o[1]-a[1];t+=Math.sqrt(l*l+s*s);e.push(parseFloat(t.toFixed(2)))})}},f=function(e){for(var o=0;o<r.chart.coordinates.length;o++){if(!(r.chart.coordinates[o].length>2))return t.resolve(null);var i=Math.round(10*r.chart.coordinates[o][2])/10;p&&i>0&&(p=!1);e.push(i);0==o&&(a=l=i);a=Math.min(a,i);l=Math.max(l,i)}};(new ol.format.GeoJSON).readFeatures(o).filter(function(e){return"linestring"===e.getGeometry().getType().toLowerCase()||"multilinestring"===e.getGeometry().getType().toLowerCase()}).forEach(function(t){switch((s=t.getGeometry()).getType().toLowerCase()){case"linestring":if(e.layout===ol.geom.GeometryLayout.XYZM||e.layout===ol.geom.GeometryLayout.XYZ){u=d();g();c=TC.tool.Elevation.getElevationGain({coords:s.getCoordinates(),hillDeltaThreshold:r.gapHill});r.chart.coordinates=r.chart.coordinates.concat(s.getCoordinates());h(i);f(n)}break;case"multilinestring":if(e.layout===ol.geom.GeometryLayout.XYZM||e.layout===ol.geom.GeometryLayout.XYZ)for(var o,a=s.getLineStrings(),l=0;l<a.length;l++){g(a[l]);a[l].getLayout()==ol.geom.GeometryLayout.XYZM&&(o+=a[l].getLastCoordinate()[3]-a[l].getFirstCoordinate()[3]);r.chart.coordinates=r.chart.coordinates.concat(a[l].getCoordinates());o&&(u=d());h(i);f(n)}break;default:return null}});n instanceof Array&&0==n.length&&(p=!0);r.chartData=p?null:$.extend({},{time:u,ele:n,x:i,miny:a,maxy:l},c);return t.resolve(r.chartData)}return t.resolve(null)})});return t})(t).then(function(t){TC.Util.getMapLocale(r.map);if(null!=t){t.time&&(t.time=("00000"+t.time.h).slice(-2)+":"+("00000"+t.time.m).slice(-2)+":"+("00000"+t.time.s).slice(-2));t.coords=r.chart.coordinates;r.hasElevation=!0;r.elevationActive.set(!0)}else{r.hasElevation=!1;t={msg:r.getLocaleString("geo.trk.chart.chpe.empty")};r.elevationActive.set(!1)}t.minHeight=r.CHART_SIZE.MIN_HEIGHT;t.maxHeight=r.CHART_SIZE.MAX_HEIGHT;t.minWidth=r.CHART_SIZE.MIN_WIDTH;t.mediumWidth=r.CHART_SIZE.MEDIUM_WIDTH;t.maxWidth=r.CHART_SIZE.MAX_WIDTH;if(r.resultsPanelChart){r.resultsPanelChart.show();r.map.$events.trigger($.Event(r.Const.Event.DRAWTRACK),{data:t})}else{window.c3||TC.syncLoadJS(TC.Consts.url.D3C3||TC.apiLocation+"lib/d3c3/d3c3.min.js");r.map.addControl("resultsPanel",{div:$("<div>").appendTo(r.map._$div),content:"chart",titles:{main:r.getLocaleString("geo.trk.chart.chpe"),max:r.getLocaleString("geo.trk.chart.chpe")},openOn:r.Const.Event.DRAWTRACK,closeOn:r.Const.Event.CLEARTRACK,chart:{ctx:r,onmouseout:e.removeElevationTooltip,tooltip:e.getElevationTooltip}}).then(function(e){r.resultsPanelChart=e;e.renderPromise().then(function(){e.activateSnapping=function(e){r.layerTrack&&!r.layerTrack.getVisibility()&&0==r.layerTrack.getOpacity()&&r.wrap.deactivateSnapping.call(r.wrap)};e.deactivateSnapping=function(e){r.layerTrack&&r.layerTrack.getVisibility()&&r.layerTrack.getOpacity()>0&&r.wrap.activateSnapping.call(r.wrap)};e._$div.on("mouseover",e.deactivateSnapping);e._$div.on("mouseout",e.activateSnapping);r.map.$events.on(TC.Consts.event.RESULTSPANELMIN,function(){$(r.miDiv).hide();r.elevationActiveCollapsed.set(!0)}).on(TC.Consts.event.RESULTSPANELMAX,function(){$(r.miDiv).show();r.elevationActiveCollapsed.set(!1)}).on(TC.Consts.event.RESULTSPANELCLOSE,function(){$(r.miDiv).hide();r.elevationActive.set(!1)});e.show();r.map.$events.trigger($.Event(r.Const.Event.DRAWTRACK),{data:t})})})}})};e.clear=function(e){var t=this;if(t.onResize){window.removeEventListener("resize",t.onResize,!1);t.onResize=void 0}if(e==t.Const.Layers.TRACK){t.resultsPanelChart&&t.resultsPanelChart.close();delete t.chartData;t.wrap.simulateTrackEnd();t.wrap.clear();t.track.$trackList.find("li").removeClass(t.Const.Classes.SELECTEDTRACK);if(void 0!==t.layerTrack){t.map.removeLayer(t.layerTrack);t.layerTrack=void 0}t.map.$events.trigger($.Event(t.Const.Event.CLEARTRACK),{})}else t.getLayer(e).then(function(e){t.wrap.clear(e)})};e.saveTrack=function(){var e=this,t=new $.Deferred,o=arguments.length>0&&"string"==typeof arguments[0]?arguments[0]:e.getLocaleString("geo.trk.save.alert"),r=function(r){e.getLayer(r).then(function(r){var i;i=e.getLoadingIndicator().addWait();var n=e.importedFileName||e.track.$trackName.val().trim(),a=e.availableTracks;a||(a=[]);var l=TC.getUID(),s=e.wrap.formattedToStorage(r,!0);a.push({name:n,data:s.features,layout:s.layout,uid:parseInt(l),crs:e.storageCRS});a=T(a);var c=function(t){e.track.$trackName.val("");e.track.$trackName.attr("disabled","disabled");e.track.$trackSave.attr("disabled","disabled");e.track.$trackWPT.val("");e.track.$trackWPT.attr("disabled","disabled");e.track.$trackAdd.attr("disabled","disabled");e.getLoadingIndicator().removeWait(t);p.call(e)};try{e.setStoredTracks(a).then(function(){e.map.toast(o,{duration:3e3});c(i);for(var r,n=0;n<a.length;n++)if(parseInt(a[n].uid)===parseInt(l)){r=n;break}t.resolve(r)})}catch(o){TC.alert(e.getLocaleString("geo.error.savelocalstorage")+": "+o.message);c(i);t.reject()}})};if(e.importedFileName)r(e.Const.Layers.TRACK);else if(0==e.track.$trackName.val().trim().length){e.track.$trackName.val((new Date).toLocaleString());r(e.Const.Layers.TRACKING)}else r(e.Const.Layers.TRACKING);return t};e.addWaypoint=function(){var e=this.track.$trackWPT.val().trim();e||(e=(new Date).toLocaleString());var t=this.getLoadingIndicator().addWait();p.call(this);this.wrap.addWaypoint(this.currentPoint.position,{name:e,ele:this.currentPoint.heading,time:(new Date).getTime()});this.track.$trackWPT.val("");this.track.$trackWPT.attr("disabled","disabled");this.track.$trackAdd.attr("disabled","disabled");TC.Util.storage.setSessionLocalValue(this.Const.LocalStorageKey.TRACKINGTEMP,this.wrap.formattedToStorage(this.layerTracking).features);this.getLoadingIndicator().removeWait(t)};e.editTrackName=function(e,t){var o=this;o.getAvailableTracks().then(function(r){if(r&&r[e]){r[e].name=t;o.setStoredTracks(r)}})};e.removeTrack=function(e){var t=this;t.getAvailableTracks().then(function(o){if(o){var r=$(e).attr("data-id");if(o[r]){var i=o[r].uid;TC.confirm(t.getLocaleString("geo.trk.delete.alert"),function(){t.getSelectedTrack().length>0&&$(t.getSelectedTrack()[0]).attr("data-id")==r&&t.clear(t.Const.Layers.TRACK);localforage.removeItem(t.Const.LocalStorageKey.TRACKING+"#"+i).then(function(){t.getStoredTracks().then(function(){t.bindTracks()})}).catch(function(e){console.log(e)})},function(){})}}})};e.setSelectedTrack=function(e){this.isActive||this.activate();this.track.$trackList.find("li[data-id] > span").each(function(){$(this).attr("title",$(this).text())});this.track.$trackList.find("li").removeClass(this.Const.Classes.SELECTEDTRACK);e.addClass(this.Const.Classes.SELECTEDTRACK);$(e).attr("title",this.getLocaleString("tr.lst.clear")+" "+$(e).find("span").text());$(e).find(this.Const.Selector.DRAW).attr("title",$(e).attr("title"))};e.getSelectedTrack=function(){return this.track.$trackList.find("li."+this.Const.Classes.SELECTEDTRACK)};e.clearSelectedTrack=function(){var e=this.getSelectedTrack();if(e){if(this.onResize){window.removeEventListener("resize",this.onResize,!1);this.onResize=void 0}e.removeClass(this.Const.Classes.SELECTEDTRACK);e.attr("title",e.text());e.find(this.Const.Selector.DRAW).attr("title",e.attr("title"))}};e.clearSelection=function(){this.wrap.deactivateSnapping();this.getSelectedTrack()&&this.clearSelectedTrack();if(this.resultsPanelChart){this.resultsPanelChart._$div.off("mouseover",this.resultsPanelChart.deactivateSnapping);this.resultsPanelChart._$div.off("mouseout",this.resultsPanelChart.activateSnapping);this.resultsPanelChart.close()}this.clear(this.Const.Layers.TRACK)};e.drawTrackingData=function(e){var t=this;t.wrap.clear();t.getTrackingData(e).then(function(e){e.data;e.data&&t.wrap.drawTrackingData(e).then(function(){var e=t.layerTrack.features;if(e&&e.length>0){var o=e.filter(function(e){e.showsPopup=!1;return!!(TC.feature.MultiPolyline&&e instanceof TC.feature.MultiPolyline)||e instanceof TC.feature.Polyline}).map(function(e){return TC.feature.MultiPolyline&&e instanceof TC.feature.MultiPolyline?e.geometry[0]:e instanceof TC.feature.Polyline?e.geometry:void 0})[0];if(o){var r=o[0],i=o[o.length-1];r&&r!==i&&t.layerTrack.addMarker(r.slice().splice(0,2),{showsPopup:!1,cssClass:t.CLASS+"-track-marker-icon-end",anchor:[.5,1]});i&&t.layerTrack.addMarker(i.slice().splice(0,2),{showsPopup:!1,cssClass:t.CLASS+"-track-marker-icon",anchor:[.5,1]})}}t.layerTrack.setVisibility(!0)})})};e.getTrackingData=function(e){var t=this,o=e,r=new $.Deferred;t.getAvailableTracks().then(function(e){if(e){var i=$(o).attr("data-id");if(e[i]){var n=e[i].data;n=t.wrap.formattedFromStorage(n);return r.resolve({data:n,layout:e[i].layout})}}return r.resolve()});return r};e.export=function(e,t){return this.wrap.export(e,t)};e.getElevationTooltip=function(e){this.wrap.showElevationMarker(e);return this.resultsPanelChart.getElevationChartTooltip(e)};e.removeElevationTooltip=function(){this.wrap.hideElevationMarker()};e.clearFileInput=function(e){var t=$(e);t.wrap("<form>").closest("form").get(0).reset();t.unwrap()};e.getLoadingIndicator=function(){if(!this.loading){this.loading=this.map.getControlsByClass(TC.control.LoadingIndicator);this.loading&&this.loading.length>0&&(this.loading=this.loading[0])}return this.loading};e.onGeolocateError=function(e){var t;if(navigator.geolocation){this.currentPosition&&navigator.geolocation.clearWatch(this.currentPosition);if(this.currentPositionTrk){this.currentPositionTrk=this.currentPositionTrk instanceof Array?this.currentPositionTrk:[this.currentPositionTrk];this.currentPositionTrk.forEach(function(e){navigator.geolocation.clearWatch(e)});this.currentPositionTrk=[]}}this.currentPositionWaiting&&this.getLoadingIndicator().removeWait(this.currentPositionWaiting);switch(e.code){case e.PERMISSION_DENIED:t=this.getLocaleString("geo.error.permission_denied");break;case e.POSITION_UNAVAILABLE:t=this.getLocaleString("geo.error.position_unavailable");break;case e.TIMEOUT:t=this.getLocaleString("geo.error.timeout");break;default:t=this.getLocaleString("geo.error.default")}this.map.toast(t,{type:TC.Consts.msgType.WARNING});if(!this.geopositionTracking&&this.track){this.track.$activateButton.toggleClass(TC.Consts.classes.HIDDEN,!1);this.track.$deactivateButton.toggleClass(TC.Consts.classes.HIDDEN,!0)}};e.getTrackingLayer=function(){return this._trackingLayerDeferred};var S=function(e){return!e||0===e.length};e.exportState=function(){const e=this;if(e.exportsState){const t={};if(e.layerTrack){const o=e.layerTrack.exportState();t.id=e.id;t.features=o.features;t.trackName=e.getSelectedTrack().find("span").html()}return t}return null};e.importState=function(e){const t=this;if(t.map&&e.features.length){t.enable();const o=new TC.layer.Vector;o.importState({features:e.features}).then(function(){t.importTrack({features:o.features,fileName:e.trackName})})}}}();TC.control=TC.control||{};TC.control.FeatureInfoCommons||TC.syncLoadJS(TC.apiLocation+"TC/control/FeatureInfoCommons");TC.filter||TC.syncLoadJS(TC.apiLocation+"TC/Filter");!function(){TC.control.GeometryFeatureInfo=function(){TC.control.FeatureInfoCommons.apply(this,arguments);this.wrap=new TC.wrap.control.GeometryFeatureInfo(this);this.lineColor=this.options.lineColor?this.options.lineColor:"#c00";this._isDrawing=!1;this._isSearching=!1;this._drawToken=!1};TC.inherit(TC.control.GeometryFeatureInfo,TC.control.FeatureInfoCommons);var e=TC.control.GeometryFeatureInfo.prototype;e.register=function(e){var t=this;TC.control.FeatureInfoCommons.prototype.register.call(t,e);t.$events.on(TC.Consts.event.CONTROLDEACTIVATE,function(e){t.wrap.cancelDraw()})};e.callback=function(e,t){var o=this;if(!o._drawToken){o.closeResults();for(var r=!1,i=0;i<o.map.workLayers.length;i++){var n=o.map.workLayers[i];if(n.type===TC.Consts.layerType.WMS&&n.getVisibility()&&n.names.length>0){r=!0;break}}if(r){o.closeResults();o.wrap.beginDraw({geometryType:o.geometryType,xy:e,layer:o.filterLayer,callback:function(e){o.wrap.getFeaturesByGeometry(e)}})}}};e.responseCallback=function(e){var t=this;TC.control.FeatureInfoCommons.prototype.responseCallback.call(t,e);if(t.filterFeature){var o=e.services;t.info={services:o};for(var r=0;r<o.length;r++){var i=o[r];if(i.hasLimits){delete i.layers;i.hasLimits=i.hasLimits}else{for(var n=0;n<i.layers.length;n++)if(!i.layers[n].features.length){i.layers.splice(n,1);n-=1}if(!i.layers.length){o.splice(r,1);r-=1}}}o.length?t.renderData(e,function(){t.insertLinks();t.displayResults()}):t.resultsLayer.clearFeatures()}}}();TC.control=TC.control||{};TC.control.ProjectionSelector||TC.syncLoadJS(TC.apiLocation+"TC/control/ProjectionSelector");!function(){TC.control.LayerCatalog=function(){var e=this;e.layers=[];e.searchInit=!1;TC.control.ProjectionSelector.apply(e,arguments);e._selectors={LAYER_ROOT:"div."+e.CLASS+"-tree > ul."+e.CLASS+"-branch > li."+e.CLASS+"-node"};e._readyDeferred=$.Deferred();TC.Consts.classes.SELECTABLE||(TC.Consts.classes.SELECTABLE="tc-selectable");TC.Consts.classes.INCOMPATIBLE||(TC.Consts.classes.INCOMPATIBLE="tc-incompatible");TC.Consts.classes.ACTIVE||(TC.Consts.classes.ACTIVE="tc-active");e._$div.on("mouseup.tc","li",function(t){var o=$(t.target);if(!o.hasClass(e.CLASS+"-leaf")){o.toggleClass(TC.Consts.classes.COLLAPSED);o.find("ul").first().toggleClass(TC.Consts.classes.COLLAPSED);t.stopPropagation()}})};TC.inherit(TC.control.LayerCatalog,TC.control.ProjectionSelector);var e=TC.control.LayerCatalog.prototype;e.CLASS="tc-ctl-lcat";e.template={};if(TC.isDebug){e.template[e.CLASS]=TC.apiLocation+"TC/templates/LayerCatalog.html";e.template[e.CLASS+"-branch"]=TC.apiLocation+"TC/templates/LayerCatalogBranch.html";e.template[e.CLASS+"-node"]=TC.apiLocation+"TC/templates/LayerCatalogNode.html";e.template[e.CLASS+"-info"]=TC.apiLocation+"TC/templates/LayerCatalogInfo.html";e.template[e.CLASS+"-results"]=TC.apiLocation+"TC/templates/LayerCatalogResults.html";e.template[e.CLASS+"-dialog"]=TC.apiLocation+"TC/templates/LayerCatalogDialog.html"}else{e.template[e.CLASS]=function(){dust.register(e.CLASS,t);function t(e,t){return e.w("<h2>").h("i18n",t,{},{$key:"availableLayers"}).x(t.get(["enableSearch"],!1),t,{block:o},{}).w('</h2><div class="tc-ctl-lcat-search tc-hidden tc-collapsed"><div class="tc-group"><input type="search" class="tc-ctl-lcat-input tc-textbox" placeholder="').h("i18n",t,{},{$key:"textToSearchInLayers"}).w('" /></div><ul></ul></div><div class="tc-ctl-lcat-tree">').x(t.get(["layerTrees"],!1),t,{else:i,block:n},{}).w('</div><div class="tc-ctl-lcat-info tc-hidden">').p("tc-ctl-lcat-info",t,t.rebase(t.getPath(!0,[])),{}).w("</div>")}t.__dustBody=!0;function o(e,t){return e.x(t.get(["layerTrees"],!1),t,{block:r},{})}o.__dustBody=!0;function r(e,t){return e.w('<button class="tc-ctl-lcat-btn-search" title="').h("i18n",t,{},{$key:"searchLayersbytext"}).w('"></button>')}r.__dustBody=!0;function i(e,t){return e.w('<div class="tc-ctl tc-ctl-lcat-loading"><span>').h("i18n",t,{},{$key:"loadingLayerTree"}).w("...</span></div>")}i.__dustBody=!0;function n(e,t){return e.w('<ul class="tc-ctl-lcat-branch">').s(t.get(["layerTrees"],!1),t,{block:a},{}).w("</ul>")}n.__dustBody=!0;function a(e,t){return e.p("tc-ctl-lcat-branch",t,t.rebase(t.getPath(!0,[])),{})}a.__dustBody=!0;return t};e.template[e.CLASS+"-branch"]=function(){dust.register(e.CLASS+"-branch",t);function t(e,t){return e.w("<li ").x(t.get(["children"],!1),t,{else:o,block:r},{}).w(' data-tc-layer-name="').f(t.get(["name"],!1),t,"h").w('" data-tc-layer-uid="').f(t.get(["uid"],!1),t,"h").w('"><span>').f(t.get(["title"],!1),t,"h").w('</span><ul class="tc-ctl-lcat-branch tc-collapsed">').s(t.get(["children"],!1),t,{block:i},{}).w("</ul></li>")}t.__dustBody=!0;function o(e,t){return e.w('class="tc-ctl-lcat-node tc-ctl-lcat-leaf"')}o.__dustBody=!0;function r(e,t){return e.w('class="tc-ctl-lcat-node tc-collapsed"')}r.__dustBody=!0;function i(e,t){return e.p("tc-ctl-lcat-node",t,t.rebase(t.getPath(!0,[])),{})}i.__dustBody=!0;return t};e.template[e.CLASS+"-node"]=function(){dust.register(e.CLASS+"-node",t);function t(e,t){return e.x(t.get(["isVisible"],!1),t,{block:o},{})}t.__dustBody=!0;function o(e,t){return e.w("<li ").x(t.get(["children"],!1),t,{else:r,block:i},{}).w(' data-tc-layer-name="').f(t.get(["name"],!1),t,"h").w('" data-tc-layer-uid="').f(t.get(["uid"],!1),t,"h").w('"><span data-tooltip="').x(t.get(["name"],!1),t,{block:n},{}).w('">').f(t.get(["title"],!1),t,"h").w("</span>").x(t.get(["name"],!1),t,{block:a},{}).w('<ul class="tc-ctl-lcat-branch tc-collapsed">').s(t.get(["children"],!1),t,{block:l},{}).w("</ul></li>")}o.__dustBody=!0;function r(e,t){return e.w('class="tc-ctl-lcat-node tc-ctl-lcat-leaf"')}r.__dustBody=!0;function i(e,t){return e.w('class="tc-ctl-lcat-node tc-collapsed"')}i.__dustBody=!0;function n(e,t){return e.h("i18n",t,{},{$key:"clickToAddToMap"})}n.__dustBody=!0;function a(e,t){return e.w('<button class="tc-ctl-lcat-btn-info"/>')}a.__dustBody=!0;function l(e,t){return e.p("tc-ctl-lcat-node",t,t.rebase(t.getPath(!0,[])),{})}l.__dustBody=!0;return t};e.template[e.CLASS+"-info"]=function(){dust.register(e.CLASS+"-info",t);function t(e,t){return e.w('<a class="tc-ctl-lcat-info-close"></a><h2>').h("i18n",t,{},{$key:"layerInfo"}).w('</h2><h3 class="tc-ctl-lcat-title">').f(t.get(["title"],!1),t,"h").w("</h3>").x(t.get(["abstract"],!1),t,{block:o},{}).x(t.get(["metadata"],!1),t,{block:r},{})}t.__dustBody=!0;function o(e,t){return e.w('<div class="tc-ctl-lcat-abstract"><h4>').h("i18n",t,{},{$key:"abstract"}).w("</h4><div>").f(t.get(["abstract"],!1),t,"h").w("</div></div>")}o.__dustBody=!0;function r(e,t){return e.w('<div class="tc-ctl-lcat-metadata"><h4>').h("i18n",t,{},{$key:"metadata"}).w("</h4><ul>").s(t.get(["metadata"],!1),t,{block:i},{}).w("</ul></div>")}r.__dustBody=!0;function i(e,t){return e.w('<li><a href="').f(t.get(["url"],!1),t,"h",["s"]).w('" type="').f(t.get(["format"],!1),t,"h").w('" title="').f(t.get(["formatDescription"],!1),t,"h").w('" target="_blank">').f(t.get(["formatDescription"],!1),t,"h").w("</a></li>")}i.__dustBody=!0;return t};e.template[e.CLASS+"-results"]=function(){dust.register(e.CLASS+"-results",t);function t(e,t){return e.s(t.get(["servicesFound"],!1),t,{else:o,block:r},{})}t.__dustBody=!0;function o(e,t){return e.w('<li class="tc-ctl-lcat-no-results"><h5>').h("i18n",t,{},{$key:"noMatches"}).w("</h5></li>")}o.__dustBody=!0;function r(e,t){return e.h("gt",t,{block:i},{key:t.get(["servicesLooked"],!1),value:1}).s(t.get(["founds"],!1),t,{block:a},{}).h("gt",t,{block:p},{key:t.get(["servicesLooked"],!1),value:1})}r.__dustBody=!0;function i(e,t){return e.w('<li class="tc-ctl-lcat-search-group ').x(t.getPath(!1,["service","isCollapsed"]),t,{block:n},{}).w('" data-tc-service-index="').f(t.getPath(!1,["service","index"]),t,"h").w('"><h5>').f(t.getPath(!1,["service","title"]),t,"h").w("</h5><ul>")}i.__dustBody=!0;function n(e,t){return e.w("tc-collapsed")}n.__dustBody=!0;function a(e,t){return e.w('<li data-tc-layer-name="').f(t.get(["Name"],!1),t,"h").w('" ').x(t.get(["alreadyAdded"],!1),t,{else:l,block:s},{}).w('><h5 class="tc-selectable">').f(t.get(["Title"],!1),t,"h").w('</h5><button class="tc-ctl-lcat-search-btn-info" /></li>')}a.__dustBody=!0;function l(e,t){return e.w(' data-tooltip="').h("i18n",t,{},{$key:"clickToAddToMap"}).w('" ')}l.__dustBody=!0;function s(e,t){return e.w(' data-tooltip="').h("i18n",t,{},{$key:"layerAlreadyAdded"}).w('" class="tc-checked" ')}s.__dustBody=!0;function p(e,t){return e.w("</ul></li>")}p.__dustBody=!0;return t};e.template[e.CLASS+"-dialog"]=function(){dust.register(e.CLASS+"-dialog",t);function t(e,t){return e.w('<div class="tc-ctl-lcat-crs-dialog tc-modal"><div class="tc-modal-background tc-modal-close"></div><div class="tc-modal-window"><div class="tc-modal-header"><h3>').h("i18n",t,{},{$key:"changeCRS"}).w('</h3><div class="tc-ctl-popup-close tc-modal-close"></div></div><div class="tc-modal-body"><p>').h("i18n",t,{},{$key:"wmsLayerNotCompatible.instructions|h"}).w('</p><ul class="tc-ctl-lcat-crs-list tc-crs-list"></ul></div><div class="tc-modal-footer"><button type="button" class="tc-button tc-modal-close">').h("i18n",t,{},{$key:"close"}).w("</button></div></div></div>")}t.__dustBody=!0;return t}}var t="tcLayer",o="tcLayerName",r="tcLayerInfo",i="tcServiceIndex";const n=function(e,t){e.showProjectionChangeDialog({layer:t,closeCallback:function(){$(e.getLayerNodes(t)).removeClass(TC.Consts.classes.LOADING).find("span").attr(a,e.getLocaleString("clickToAddToMap"))}})};var a="data-tooltip";e.register=function(e){var r=this;TC.control.ProjectionSelector.prototype.register.call(r,e);var i=function(){if($.isArray(r.options.layers)){for(var e=0;e<r.options.layers.length;e++){var t=r.options.layers[e];if(!t.type||t.type===TC.Consts.layerType.WMS){t.id||(t.id=TC.getUID());$.isPlainObject(t)&&(t=new TC.layer.Raster(t));r.layers.push(t)}}r.render(function(){r._readyDeferred.resolve()})}else r._readyDeferred.resolve()},n=function(t){if(t.layer===e.baseLayer){i();e.off(TC.Consts.event.LAYERUPDATE,n)}};e.loaded(function(){e.baseLayer.state&&e.baseLayer.state!==TC.Layer.state.IDLE?e.on(TC.Consts.event.LAYERUPDATE,n):i()});var l=function(){if("createEvent"in document){var e=document.createEvent("HTMLEvents");e.initEvent("keyup",!1,!0);r.$text&&r.$text[0].dispatchEvent(e)}else r.$text&&r.$text[0].fireEvent("keyup")},s=r.getLocaleString("layerAlreadyAdded"),p=r.getLocaleString("clickToAddToMap");e.on(TC.Consts.event.BEFORELAYERADD+" "+TC.Consts.event.BEFOREUPDATEPARAMS,function(e){const t=$(r.getLayerNodes(e.layer));t.hasClass(TC.Consts.classes.LOADING)||t.addClass(TC.Consts.classes.LOADING).find("span").removeAttr(a)}).on(TC.Consts.event.LAYERADD+" "+TC.Consts.event.UPDATEPARAMS,function(e){var t=e.layer;t.isBase||t.type!==TC.Consts.layerType.WMS||r._readyDeferred.then(function(){var e=$(r.getLayerRootNode(t)),o=function(){$(r.getLayerNodes(t)).removeClass(TC.Consts.classes.LOADING).addClass(TC.Consts.classes.CHECKED).find("span").attr(a,s);l()};if(e.length)o();else{for(var i=!1,n=0,p=r.layers.length;n<p;n++){var c=r.layers[n];if(c.type===t.type&&c.options.url===t.options.url){i=!0;break}}i||r.addLayer(new TC.layer.Raster({url:t.options.url,type:t.type,layerNames:[],title:t.title||t.wrap.getServiceTitle(),hideTitle:!0,hideTree:!1})).then(function(){e=$(r.getLayerRootNode(t));o()})}})}).on(TC.Consts.event.LAYERERROR,function(e){e.reason&&TC.alert(r.getLocaleString(e.reason,{url:e.layer.url}));$(r.getLayerNodes(e.layer)).removeClass(TC.Consts.classes.LOADING)}).on(TC.Consts.event.LAYERREMOVE,function(e){$(r.getLayerNodes(e.layer)).removeClass(TC.Consts.classes.CHECKED).find("span").attr(a,p);(function(e){var o=$();if(!e.isBase){var i=e.options.url;r.$list&&r.$list.find("li").each(function(r,n){var a=$(n),l=a.data(t);if(l&&l.type===e.type&&l.options.url===i)for(var s=0;s<e.names.length;s++)a.is('li[data-tc-layer-name="'+e.names[s]+'"]')&&(o=o.add(a))})}return o})(e.layer).removeClass(TC.Consts.classes.CHECKED).attr(a,p);!function(e){var t=r.map.getControlsByClass(TC.control.WorkLayers)[0];if(t)for(var o=t.layers,i=0;i<o.length;i++){var n=o[i];n!==e&&$(r.getLayerNodes(n)).addClass(TC.Consts.classes.CHECKED).find("span").attr(a,s)}}(e.layer);l()}).on(TC.Consts.event.EXTERNALSERVICEADDED,function(e){if(e&&e.layer){r.addLayer(e.layer);r._$div.removeClass("tc-collapsed")}}).on(TC.Consts.event.PROJECTIONCHANGE,function(e){r.update()});r._$div.on(TC.Consts.event.CLICK,"span",function(e){var i=$(e.target).parent();if(!i.hasClass(TC.Consts.classes.LOADING)&&!i.hasClass(TC.Consts.classes.CHECKED)){e.preventDefault;var n=i.data(o);n=void 0!==n?n.toString():"";var l=r._$roots.has(i).data(t);l||(l=i.data(t));if(l&&n){var s=1;/iPad/i.test(navigator.userAgent)?s=10:TC.Util.detectFirefox()&&(s=250);l.title||(l.title=l.getTree().title);i.addClass(TC.Consts.classes.LOADING).find("span").attr(a,"");(function(e){var t=new $.Deferred;setTimeout(function(){e[0].offsetHeight=e[0].offsetHeight;e[0].offsetWidth=e[0].offsetWidth;t.resolve()},s);return t.promise()})(i).then(function(){r.addLayerToMap(l,n);e.stopPropagation()})}}})};e.render=function(e){var l=this,s=$.map(l.layers,function(e){return e.wrap.getLayer()});$.when.apply(l,s).then(function(){var s=$.map(l.layers,function(e){var t=e.getTree();!function t(o){for(var r=!1,i=0;i<o.children.length;i++)t(o.children[i])&&(r=!0);o.hasOwnProperty("isVisible")&&(o.isVisible=!e.names||!e.names.length||r||o.isVisible);return o.isVisible}(t);return t});l.renderData({layerTrees:s,enableSearch:l.options.enableSearch},function(){var s=l.getLocaleString("layerAlreadyAdded");l._$roots=l._$div.find(l._selectors.LAYER_ROOT);l._$roots.each(function(e,i){var n=l.layers[e],p={};$(i).data(t,n).find("."+l.CLASS+"-btn-info").each(function(e,t){var i=$(t),c=i.parent().find("span").first(),u=i.parent().data(o).toString();if(u){c.addClass(TC.Consts.classes.SELECTABLE);var g=n.wrap.getInfo(u);if(g.hasOwnProperty("abstract")||g.hasOwnProperty("legend")||g.hasOwnProperty("metadata")){if(g.metadata)for(var d=0,h=g.metadata.length;d<h;d++){var f=g.metadata[d];f.formatDescription=p[f.format]=p[f.format]||l.getLocaleString(TC.Util.getSimpleMimeType(f.format))||l.getLocaleString("viewMetadata")}i.data(r,g);i.on(TC.Consts.event.CLICK,function(){if($(this).hasClass(TC.Consts.classes.CHECKED)){$(this).removeClass(TC.Consts.classes.CHECKED);l.hideLayerInfo()}else{l.showLayerInfo(n,u);$(this).addClass(TC.Consts.classes.CHECKED)}})}else i.remove();n.compatibleLayers&&n.compatibleLayers.indexOf(u)<0&&c.addClass(TC.Consts.classes.INCOMPATIBLE).attr("title",l.getLocaleString("reprojectionNeeded"));if(l.map)for(d=0,h=l.map.workLayers.length;d<h;d++){var y=l.map.workLayers[d];if(y.type===TC.Consts.layerType.WMS&&y.url===n.url&&1===y.names.length&&y.names[0]===u){c.parent().addClass(TC.Consts.classes.CHECKED);c.attr(a,s)}}}else{c.attr(a,"");i.remove()}})});l.getRenderedHtml(l.CLASS+"-dialog",null,function(e){l._$dialogDiv.html(e)});l.$text=l._$div.find("."+l.CLASS+"-input");l.$list=l._$div.find("."+l.CLASS+"-search ul");l.$text.on("mouseup",function(e){""!==l.$text.val()&&setTimeout(function(){""===l.$text.val()&&l.$list.empty()},1)});var p=[];TC._search=TC._search||{};TC._search.retryTimeout=null;TC.loadJS(!l.$text.autocomplete,[TC.apiLocation+"lib/jQuery/autocomplete.js"],function(){l.$text.autocomplete({link:"#",target:l.$list,minLength:0,source:function(e,t){p=[];l._$roots.find("li."+TC.Consts.classes.CHECKED).each(function(e,t){p.push($(t).data(o).toString())});if((e=e.trim()).length<3)l.$list.html("");else if(e.length>=3){TC._search.retryTimeout&&clearTimeout(TC._search.retryTimeout);TC._search.retryTimeout=setTimeout(function(){for(var o=[],r=0;r<l.layers.length;r++){var i=l.layers[r].searchSubLayers(e);i.length&&o.push({service:{index:r,title:l.layers[r].title||l.layers[r].id},founds:i})}t({servicesFound:o,servicesLooked:l.layers.length})},TC._search.interval)}},callback:function(e){l.$text.val(e.target.text||e.target.innerText);TC._search.lastPattern=l.$text.val();l.goToResult(unescape(e.target.hash).substring(1));l.$text.autocomplete("clear")},buildHTML:function(e){if(e.results&&e.results.servicesFound.length>0)for(var t=l.map.getLayerTree().workLayers,o=0;o<e.results.servicesFound.length;o++){for(var r=e.results.servicesFound[o].founds,i=0;i<r.length;i++){delete r[i].alreadyAdded;for(var n=0;n<t.length;n++)if(p.indexOf(r[i].Name)>=0){r[i].alreadyAdded=!0;break}if(!r[i].Name){r.splice(i,1);i--}}e.results.servicesFound[o].founds.length?e.results.servicesFound[o].service.isCollapsed=$(l._$div.find(".tc-ctl-lcat-search-group")[o]).hasClass(TC.Consts.classes.COLLAPSED):e.results.servicesFound.splice(o,1)}var a="";dust.render(l.CLASS+"-results",e.results,function(e,t){a=t});return a}})});if(!l.searchInit){l._$div.on("click","h2 button",function(){var e=l._$div.hasClass("tc-collapsed");l._$div.removeClass("tc-collapsed");var t=l._$div.find("."+l.CLASS+"-search"),o=l._$div.find("."+l.CLASS+"-tree"),r=l._$div.find("."+l.CLASS+"-info");if(t.hasClass(TC.Consts.classes.HIDDEN)||e){t.removeClass(TC.Consts.classes.HIDDEN);o.addClass(TC.Consts.classes.HIDDEN);l.$text[0].focus();$(this).addClass(l.CLASS+"-btn-tree");$(this).attr("title",l.getLocaleString("viewAvailableLayersTree"));$(this).removeClass(l.CLASS+"-btn-search");0===$(".tc-ctl-lcat-search li button.tc-checked").length&&r.addClass(TC.Consts.classes.HIDDEN)}else{t.addClass(TC.Consts.classes.HIDDEN);o.removeClass(TC.Consts.classes.HIDDEN);$(this).addClass(l.CLASS+"-btn-search");$(this).attr("title",l.getLocaleString("searchLayersByText"));$(this).removeClass(l.CLASS+"-btn-tree");$(".tc-ctl-lcat-tree li button.tc-checked").length>0&&r.removeClass(TC.Consts.classes.HIDDEN)}});l._$div.on("click","."+l.CLASS+"-search button."+l.CLASS+"-search-btn-info",function(e){e.stopPropagation();if($(this).hasClass(TC.Consts.classes.CHECKED)){$(this).removeClass(TC.Consts.classes.CHECKED);l.hideLayerInfo()}else{var t=$(this).parent();l.showLayerInfo(l.layers[t.parents("li").data(i)],t.data(o));$(this).addClass(TC.Consts.classes.CHECKED)}});l._$div.on("click",".tc-ctl-lcat-search li",function(e){e.stopPropagation();var r=$(this);if(!r.hasClass("tc-ctl-lcat-no-results"))if(r.hasClass("tc-ctl-lcat-search-group"))r.toggleClass(TC.Consts.classes.COLLAPSED);else{var p=r.data(o);p=void 0!==p?p.toString():"";if(!$(this).hasClass(TC.Consts.classes.CHECKED)){var c=r.parents("li.tc-ctl-lcat-search-group"),u=l.layers[0==c.length?0:c.data(i)].options.url,g=l.layers[0==c.length?0:c.data(i)].title;const e=new TC.layer.Raster({id:l.getUID(),url:u,title:g,hideTitle:!0,layerNames:[p]});if(e.isCompatible(l.map.crs)){l.map.addLayer(e,function(e){r.data(t,e);e.wrap.$events.on(TC.Consts.event.TILELOADERROR,function(e){var t=this.parent;401!==e.error.code&&403!==e.error.code||t.map.toast(e.error.text,{type:TC.Consts.msgType.ERROR});t.map.removeLayer(t)})});$(this).addClass(TC.Consts.classes.CHECKED);$(this).attr(a,s)}else n(l,e)}}});l.searchInit=!0}$.isFunction(e)&&e()})})};e.getLayerRootNode=function(e){const o=this;var r=null;if(!e.isBase){var i=e.options.url;o._$roots&&o._$roots.each(function(o,n){var a=$(n).data(t);a&&a.type===e.type&&a.options.url===i&&(r=n)})}return r};e.getLayerNodes=function(e){var t=[],o=$(this.getLayerRootNode(e));if(o.length)for(var r=0;r<e.names.length;r++){const i=o.find('li[data-tc-layer-name="'+e.names[r]+'"]');if(0!=i.length){t[t.length]=i[0];i.find("li").each(function(e,o){t[t.length]=o})}}return t};e.showLayerInfo=function(e,i){var n=this,a=null,l=n._$div.find("."+n.CLASS+"-info");n._$div.find("."+n.CLASS+"-btn-info, ."+n.CLASS+"-search-btn-info").removeClass(TC.Consts.classes.CHECKED);n._$roots.each(function(s,p){var c=$(p);if(c.data(t)===e){c.find("."+n.CLASS+"-btn-info").each(function(e,t){var s=$(t),p=s.parent().data(o).toString();if(p===i){var c=s.data(r);n._$div.find('li [data-tc-layer-name="'+p+'"] > button').toggleClass(TC.Consts.classes.CHECKED,function(e,t){var r=!1;l.data(o);if(t){r=!0;l.data(o,e);l.removeClass(TC.Consts.classes.HIDDEN);dust.render(n.CLASS+"-info",t,function(e,t){l.html(t);e&&TC.error(e);l.find("."+n.CLASS+"-info-close").on(TC.Consts.event.CLICK,function(){n.hideLayerInfo()})})}return r}(p,c));a=c;return!1}});return!1}});return a};e.update=function(){const e=this;e.layers.forEach(function(t){t.getCapabilitiesPromise().then(function(){t.compatibleLayers=t.wrap.getCompatibleLayers(e.map.crs);$(e.getLayerRootNode(t)).find("li[data-tc-layer-name]").each(function(r,i){const n=$(i),a=n.data(o),l=n.find("span."+TC.Consts.classes.SELECTABLE);t.compatibleLayers.indexOf(a)<0?l.addClass(TC.Consts.classes.INCOMPATIBLE).attr("title",e.getLocaleString("reprojectionNeeded")):l.removeClass(TC.Consts.classes.INCOMPATIBLE).attr("title",null)})})})};e.hideLayerInfo=function(){this._$div.find("."+this.CLASS+"-btn-info, ."+this.CLASS+"-search-btn-info").removeClass(TC.Consts.classes.CHECKED);this._$div.find("."+this.CLASS+"-info").addClass(TC.Consts.classes.HIDDEN)};e.addLayer=function(e){var t=$.Deferred(),o=this,r=[];o.options.layers&&o.options.layers.length&&(r=$.grep(o.options.layers,function(t){var o=TC.Util.reqGetMapOnCapabilities(t.url);return o&&o.replace(TC.Util.regex.PROTOCOL)==e.url.replace(TC.Util.regex.PROTOCOL)}));0==r.length&&(r=$.grep(o.layers,function(t){return t.url.replace(TC.Util.regex.PROTOCOL)==e.url.replace(TC.Util.regex.PROTOCOL)}));if(0==r.length){o.layers.push(e);e.getCapabilitiesPromise().then(function(){e.compatibleLayers=e.wrap.getCompatibleLayers(o.map.crs);e.title=e.title||e.wrap.getServiceTitle();o.render(function(){t.resolve()})})}else t.resolve();return t};e.addLayerToMap=function(e,t){const o=this,r=$.extend({},e.options);r.id=o.getUID();r.layerNames=[t];r.title=e.title;const i=new TC.layer.Raster(r);i.isCompatible(o.map.crs)?o.map.addLayer(r).then(function(e){e.wrap.$events.on(TC.Consts.event.TILELOADERROR,function(e){var t=this.parent;401!==e.error.code&&403!==e.error.code||t.map.toast(e.error.text,{type:TC.Consts.msgType.ERROR});t.map.removeLayer(t)})}):n(o,i)};e.loaded=function(){return this._readyDeferred.promise()};e.getAvailableCRS=function(e){e=e||{};return this.map.getCompatibleCRS({layers:this.map.workLayers.concat(this.map.baseLayer,e.layer),includeFallbacks:!0})};e.setProjection=function(e){const t=this;e=e||{};TC.loadProjDef({crs:e.crs,callback:function(){t.map.setProjection(e).then(function(){t._layerToAdd&&t.map.addLayer(t._layerToAdd);TC.Util.closeModal()})}})};e.showProjectionChangeDialog=function(e){this._layerToAdd=e.layer;TC.control.ProjectionSelector.prototype.showProjectionChangeDialog.call(this,e)}}();TC.control=TC.control||{};TC.control.MapContents||TC.syncLoadJS(TC.apiLocation+"TC/control/MapContents");TC.control.Legend=function(){TC.control.MapContents.apply(this,arguments)};TC.inherit(TC.control.Legend,TC.control.MapContents);!function(){var e=TC.control.Legend.prototype;e.CLASS="tc-ctl-legend";e.template={};if(TC.isDebug){e.template[e.CLASS]=TC.apiLocation+"TC/templates/Legend.html";e.template[e.CLASS+"-node"]=TC.apiLocation+"TC/templates/LegendNode.html"}else{e.template[e.CLASS]=function(){dust.register(e.CLASS,t);function t(e,t){return e.w("<h2>").h("i18n",t,{},{$key:"legend"}).w('</h2><div class="tc-ctl-legend-tree"><ul class="tc-ctl-legend-branch">').s(t.get(["workLayers"],!1),t,{else:o,block:r},{}).w("</ul></div>")}t.__dustBody=!0;function o(e,t){return e.w('<li class="tc-ctl-legend-empty">').h("i18n",t,{},{$key:"noData"}).w("</li>")}o.__dustBody=!0;function r(e,t){return e.p("tc-ctl-legend-node",t,t.rebase(t.getPath(!0,[])),{})}r.__dustBody=!0;return t};e.template[e.CLASS+"-node"]=function(){dust.register(e.CLASS+"-node",t);function t(e,t){return e.x(t.get(["customLegend"],!1),t,{else:o,block:g},{})}t.__dustBody=!0;function o(e,t){return e.w("<li ").x(t.get(["children"],!1),t,{else:r,block:i},{}).w(' data-tc-layer-name="').f(t.get(["name"],!1),t,"h").w('" data-tc-layer-uid="').f(t.get(["uid"],!1),t,"h").w('"><div class="tc-ctl-legend-title">').f(t.get(["title"],!1),t,"h").w("</div>").x(t.get(["legend"],!1),t,{block:n},{}).w('<ul class="tc-ctl-legend-branch">').s(t.get(["children"],!1),t,{block:u},{}).w("</ul></li>")}o.__dustBody=!0;function r(e,t){return e.w('class="tc-ctl-legend-node tc-ctl-legend-leaf" ')}r.__dustBody=!0;function i(e,t){return e.w('class="tc-ctl-legend-node" ')}i.__dustBody=!0;function n(e,t){return e.w('<div class="tc-ctl-legend-watch">').x(t.getPath(!1,["legend","src"]),t,{else:a,block:p},{}).w('</div><div class="tc-ctl-legend-nvr">').h("i18n",t,{},{$key:"notVisibleAtCurrentResolution"}).w("</div>")}n.__dustBody=!0;function a(e,t){return e.x(t.getPath(!1,["legend","width"]),t,{block:l},{})}a.__dustBody=!0;function l(e,t){return e.w('<div class="tc-ctl-legend-img" style="border:solid ').f(t.getPath(!1,["legend","strokeWidth"]),t,"h").w("px ").f(t.getPath(!1,["legend","strokeColor"]),t,"h").w(";background-color:").f(t.getPath(!1,["legend","fillColor"]),t,"h").x(t.getPath(!1,["legend","width"]),t,{block:s},{}).w('"></div>')}l.__dustBody=!0;function s(e,t){return e.w(";width:").f(t.getPath(!1,["legend","width"]),t,"h").w("px;height:").f(t.getPath(!1,["legend","height"]),t,"h").w("px;border-radius:50%")}s.__dustBody=!0;function p(e,t){return e.w('<img src="" data-tc-img="').f(t.getPath(!1,["legend","src"]),t,"h").w('" ').x(t.getPath(!1,["legend","width"]),t,{block:c},{}).w(" />")}p.__dustBody=!0;function c(e,t){return e.w('style="width:').f(t.getPath(!1,["legend","width"]),t,"h").w("px;height:").f(t.getPath(!1,["legend","height"]),t,"h").w('px;" ')}c.__dustBody=!0;function u(e,t){return e.p("tc-ctl-legend-node",t,t.rebase(t.getPath(!0,[])),{})}u.__dustBody=!0;function g(e,t){return e.f(t.get(["customLegend"],!1),t,"h",["s"])}g.__dustBody=!0;return t}}var t="tcLayer",o="tcLayerUid";e.register=function(e){TC.control.MapContents.prototype.register.call(this,e)};e.loadGraphics=function(){var e=this;e._$div.find("ul."+e.CLASS+"-branch").first().children("li").not("."+e.CLASS+"-empty").each(function(o,r){var i=$(r),n=i.data(t);n&&i.find("li.tc-ctl-legend-node-visible").each(function(t,o){var r=$(o).find("img").first();r&&void 0!=r.attr("src")&&0==r.attr("src").length&&e.styleLegendImage(r,n)})})};e.updateScale=function(){var e=this,r=e.CLASS+"-node-inscale",i=e.CLASS+"-node-outofscale";e._$div.find("ul."+e.CLASS+"-branch").first().children("li").not("."+e.CLASS+"-empty").each(function(n,a){var l=$(a),s=l.data(t);if(s){var p=!1;l.find("li").each(function(t,n){var a=$(n);if(a.hasClass(e.CLASS+"-node-visible")){var l=a.data(o);if(s.isVisibleByScale(l)){p=!0;a.removeClass(i).addClass(r);var c=a.find("img").first();c.length>0&&e.styleLegendImage(c,s)}else a.addClass(i).removeClass(r)}});l.toggleClass(r,p);l.toggleClass(i,!p)}})};e.update=function(){var e=this;e._$div.find("ul."+e.CLASS+"-branch").first().children("li").each(function(r,i){var n=$(i),a=n.data(t);if(a){a.getTree();n.find("li").each(function(t,r){var i=$(r),n=i.data(o),l=e.CLASS+"-node-visible",s=e.CLASS+"-node-notvisible",p=e.CLASS+"-node-hasvisible";switch(a._cache.visibilityStates[n]){case TC.Consts.visibility.NOT_VISIBLE:i.removeClass(l+" "+p).addClass(s);break;case TC.Consts.visibility.HAS_VISIBLE:i.removeClass(l+" "+s).addClass(p);break;default:i.removeClass(s+" "+p).addClass(l)}});e.updateLayerVisibility(a)}});e.updateScale()};e.updateLayerTree=function(e){var r=this;if(!e.isBase&&!e.options.stealth){TC.control.MapContents.prototype.updateLayerTree.call(r,e);r._$div.find("."+r.CLASS+"-empty").addClass(TC.Consts.classes.HIDDEN);TC.loadJSInOrder(!window.dust,TC.url.templating,function(){dust.render(r.CLASS+"-node",r.layerTrees[e.id],function(i,n){var a=$(n),l=a.data(o),s=r._$div.find("ul."+r.CLASS+"-branch").first(),p=s.find('li[data-tc-layer-uid="'+l+'"]');if(1===p.length)p.html(a.html());else{a.data(t,e);s.prepend(a)}i&&TC.error(i)});r.update()})}};e.removeLayer=function(e){var o=this,r=function(){return o._$div.find("."+o.CLASS+"-branch").first().children("li").not("."+o.CLASS+"-empty")};if(!e.isBase){var i=r();i.each(function(o,n){var a=$(n);if(a.data(t)===e){a.remove();i=r();return!1}});0===i.length&&o._$div.find("."+o.CLASS+"-empty").removeClass(TC.Consts.classes.HIDDEN)}};e.updateLayerVisibility=function(e){var o=this;o._$div.find("."+o.CLASS+"-branch").first().children("li").each(function(r,i){var n=$(i);if(n.data(t)===e){n.toggleClass(o.CLASS+"-node-notvisible",!e.getVisibility());return!1}})};e.getLayerUIElements=function(){return this._$div.find("ul."+this.CLASS+"-branch").first().children("li."+this.CLASS+"-node")}}();TC.control=TC.control||{};TC.control.GeometryFeatureInfo||TC.syncLoadJS(TC.apiLocation+"TC/control/GeometryFeatureInfo");!function(){TC.control.LineFeatureInfo=function(){TC.control.GeometryFeatureInfo.apply(this,arguments);this.geometryType=TC.Consts.geom.POLYLINE};TC.inherit(TC.control.LineFeatureInfo,TC.control.GeometryFeatureInfo);var e=TC.control.LineFeatureInfo.prototype;e.CLASS="tc-ctl-finfo";e.template={};if(TC.isDebug){e.template[e.CLASS]=TC.apiLocation+"TC/templates/FeatureInfo.html";e.template[e.CLASS+"-dialog"]=TC.apiLocation+"TC/templates/FeatureInfoDialog.html"}else{e.template[e.CLASS]=function(){dust.register(e.CLASS,t);function t(e,t){return e.w('<ul class="tc-ctl-finfo-services">').s(t.get(["services"],!1),t,{else:o,block:r},{}).w("</ul>").x(t.get(["featureCount"],!1),t,{block:L},{})}t.__dustBody=!0;function o(e,t){return e.w('<li class="tc-ctl-finfo-empty">').h("i18n",t,{},{$key:"noData"}).w("</li>")}o.__dustBody=!0;function r(e,t){return e.w("<li><h3>").x(t.getPath(!1,["mapLayer","title"]),t,{else:i,block:n},{}).w('</h3><div class="tc-ctl-finfo-service-content">').s(t.get(["hasLimits"],!1),t,{else:a,block:P},{}).w("</div></li>")}r.__dustBody=!0;function i(e,t){return e.f(t.getPath(!1,["mapLayer","id"]),t,"h")}i.__dustBody=!0;function n(e,t){return e.f(t.getPath(!1,["mapLayer","title"]),t,"h")}n.__dustBody=!0;function a(e,t){return e.w('<ul class="tc-ctl-finfo-layers">').s(t.get(["layers"],!1),t,{else:l,block:s},{}).w("</ul>")}a.__dustBody=!0;function l(e,t){return e.w('<li class="tc-ctl-finfo-empty">').h("i18n",t,{},{$key:"noDataAtThisService"}).w("</li>")}l.__dustBody=!0;function s(e,t){return e.w("<li><h4>").s(t.get(["path"],!1),t,{block:p},{}).w(' <span class="tc-ctl-finfo-layer-n">').f(t.getPath(!1,["features","length"]),t,"h").w('</span> </h4> <div class="tc-ctl-finfo-layer-content"><ul class="tc-ctl-finfo-features">').s(t.get(["features"],!1),t,{else:u,block:g},{}).w("</ul></div></li>")}s.__dustBody=!0;function p(e,t){return e.f(t.getPath(!0,[]),t,"h").h("sep",t,{block:c},{})}p.__dustBody=!0;function c(e,t){return e.w(" &bull; ")}c.__dustBody=!0;function u(e,t){return e.w('<li class="tc-ctl-finfo-empty">').h("i18n",t,{},{$key:"noDataInThisLayer"}).w("</li>")}u.__dustBody=!0;function g(e,t){return e.w("<li>").x(t.get(["rawContent"],!1),t,{else:d,block:C},{}).w("</li>")}g.__dustBody=!0;function d(e,t){return e.x(t.get(["error"],!1),t,{else:h,block:v},{})}d.__dustBody=!0;function h(e,t){return e.w("<h5>").f(t.get(["id"],!1),t,"h").w("</h5><table").x(t.get(["geometry"],!1),t,{block:f},{}).w("><tbody>").s(t.get(["attributes"],!1),t,{block:y},{}).w("</tbody></table>").x(t.get(["geometry"],!1),t,{block:m},{})}h.__dustBody=!0;function f(e,t){return e.w(' title="').h("i18n",t,{},{$key:"clickToCenter"}).w('"')}f.__dustBody=!0;function y(e,t){return e.w('<tr><th class="tc-ctl-finfo-attr">').f(t.get(["name"],!1),t,"h").w('</th><td class="tc-ctl-finfo-val">').f(t.get(["value"],!1),t,"h").w("</td></tr>")}y.__dustBody=!0;function m(e,t){return e.w('<div class="tc-ctl-finfo-tools"><button class="tc-ctl-finfo-tools-btn" title="').h("i18n",t,{},{$key:"download"}).w("/").h("i18n",t,{},{$key:"share"}).w('">').h("i18n",t,{},{$key:"download"}).w("/").h("i18n",t,{},{$key:"share"}).w("</button></div>")}m.__dustBody=!0;function v(e,t){return e.w('<span class="tc-ctl-finfo-errors">').h("i18n",t,{},{$key:"fi.error"}).w('<span class="tc-ctl-finfo-error-text">').f(t.get(["error"],!1),t,"h").w("</span></span>")}v.__dustBody=!0;function C(e,t){return e.w("<h5>").h("i18n",t,{},{$key:"feature"}).w("</h5>").h("eq",t,{else:T,block:S},{key:t.get(["rawFormat"],!1),value:"text/html"})}C.__dustBody=!0;function T(e,t){return e.w("<pre>").f(t.get(["rawContent"],!1),t,"h").w("</pre>")}T.__dustBody=!0;function S(e,t){return e.w(" ").x(t.get(["expandUrl"],!1),t,{block:_},{})}S.__dustBody=!0;function _(e,t){return e.h("ne",t,{else:E,block:x},{key:t.get(["expandUrl"],!1),value:""})}_.__dustBody=!0;function E(e,t){return e.w('<iframe src="').f(t.get(["rawUrl"],!1),t,"h").w('" />')}E.__dustBody=!0;function x(e,t){return e.w('<div class="tc-ctl-finfo-features-iframe-cnt"><iframe src="').f(t.get(["rawUrl"],!1),t,"h").w('" /><a class="tc-ctl-finfo-open" onclick="window.open(\'').f(t.get(["expandUrl"],!1),t,"h").w("', '_blank')\" title=\"").h("i18n",t,{},{$key:"expand"}).w('"></a></div>')}x.__dustBody=!0;function P(e,t){return e.w('<span class="tc-ctl-finfo-errors">').f(t.get(["hasLimits"],!1),t,"h").w("</span>")}P.__dustBody=!0;function L(e,t){return e.h("gt",t,{block:w},{key:t.get(["featureCount"],!1),value:"1",type:"number"})}L.__dustBody=!0;function w(e,t){return e.w('<a class="tc-ctl-btn tc-ctl-finfo-btn-prev">').h("i18n",t,{},{$key:"previous"}).w('</a><div class="tc-ctl-finfo-counter"><span class="tc-ctl-finfo-idx"></span>/').f(t.get(["featureCount"],!1),t,"h").w('</div><a class="tc-ctl-btn tc-ctl-finfo-btn-next">').h("i18n",t,{},{$key:"next"}).w("</a>")}w.__dustBody=!0;return t};e.template[e.CLASS+"-dialog"]=function(){dust.register(e.CLASS+"-dialog",t);function t(e,t){return e.w('<div class="tc-ctl-finfo-dialog tc-modal"><div class="tc-modal-background tc-modal-close"></div><div class="tc-modal-window"><div class="tc-modal-header"><h3>').h("i18n",t,{},{$key:"feature"}).w('</h3><div class="tc-ctl-popup-close tc-modal-close"></div></div><div class="tc-modal-body"><div class="tc-ctl-finfo-dialog-dl"><h2>').h("i18n",t,{},{$key:"download"}).w('</h2><div><button class="tc-button tc-ctl-finfo-dl-btn-kml" data-format="KML" title="KML">KML</button><button class="tc-button tc-ctl-finfo-dl-btn-gml" data-format="GML" title="GML">GML</button><button class="tc-button tc-ctl-finfo-dl-btn-geojson" data-format="GeoJSON" title="GeoJSON">GeoJSON</button><button class="tc-button tc-ctl-finfo-dl-btn-wkt" data-format="WKT" title="WKT">WKT</button></div></div><div class="tc-ctl-finfo-dialog-share"></div></div><div class="tc-modal-footer"><button type="button" class="tc-button tc-modal-close">').h("i18n",t,{},{$key:"close"}).w("</button></div></div></div>")}t.__dustBody=!0;return t}}}();TC.control=TC.control||{};TC.control.WorkLayerManager||TC.syncLoadJS(TC.apiLocation+"TC/control/WorkLayerManager");TC.control.ListTOC=TC.control.WorkLayerManager;TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.control.LoadingIndicator=function(){var e=this;TC.Control.apply(e,arguments);window.addEventListener("error",function(){e.reset();return!1},!1)};TC.inherit(TC.control.LoadingIndicator,TC.Control);!function(){var e=TC.control.LoadingIndicator.prototype;e.CLASS="tc-ctl-load";TC.isDebug?e.template=TC.apiLocation+"TC/templates/LoadingIndicator.html":e.template=function(){dust.register(e.CLASS,t);function t(e,t){return e.w('<div class="tc-ctl-load-bar"><div class="tc-ctl-load-dots tc-ctl-load-dot1"> </div><div class="tc-ctl-load-dots tc-ctl-load-dot2"> </div><div class="tc-ctl-load-dots tc-ctl-load-dot3"> </div><div class="tc-ctl-load-dots tc-ctl-load-dot4"> </div><div class="tc-ctl-load-dots tc-ctl-load-dot5"> </div><div class="tc-ctl-load-dots tc-ctl-load-dot6"> </div><div class="tc-ctl-load-dots tc-ctl-load-dot7"> </div><div class="tc-ctl-load-dots tc-ctl-load-dot8"> </div></div>')}t.__dustBody=!0;return t};e.waits={};e.startWait=function(t){void 0===e.waits[t.layer.id]&&(e.waits[t.layer.id]=0);e.waits[t.layer.id]=e.waits[t.layer.id]+1;this.show();this.map.$events.trigger($.Event(TC.Consts.event.STARTLOADING))};e.stopWait=function(t){var o=e.waits[t.layer.id];o>0&&(o=e.waits[t.layer.id]=o-1);o||delete e.waits[t.layer.id];var r=0;for(var i in e.waits)r++;if(!r){this.map?this.map.isLoaded&&this.hide():this.hide();this.map.$events.trigger($.Event(TC.Consts.event.STOPLOADING))}};e.reset=function(t){e.waits={};this.hide();this.map.$events.trigger($.Event(TC.Consts.event.STOPLOADING))};e.register=function(e){var t=this;TC.Control.prototype.register.call(t,e);e.on(TC.Consts.event.BEFORELAYERADD+" "+TC.Consts.event.BEFORELAYERUPDATE+" "+TC.Consts.event.BEFOREFEATURESADD,function(e){t.startWait(e)}).on(TC.Consts.event.LAYERADD+" "+TC.Consts.event.LAYERERROR+" "+TC.Consts.event.LAYERUPDATE+" "+TC.Consts.event.FEATURESADD,function(e){t.stopWait(e)}).on(TC.Consts.event.BEFOREFEATUREINFO,function(e){t.addWait(TC.Consts.event.FEATUREINFO)}).on(TC.Consts.event.FEATUREINFO+" "+TC.Consts.event.NOFEATUREINFO+" "+TC.Consts.event.FEATUREINFOERROR,function(e){t.removeWait(TC.Consts.event.FEATUREINFO)});if(!TC.isDebug){window.addEventListener("error",function(e,o,r,i,n){t.reset();return!1});$(document).ajaxError(function(e,o,r){t.reset()})}};e.addWait=function(e){var t=e||TC.getUID();this.startWait({layer:{id:t}});return t};e.removeWait=function(e){this.stopWait({layer:{id:e}})}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.Consts.event.BEFOREFEATUREMODIFY="beforefeaturemodify.tc";TC.Consts.event.FEATUREMODIFY="featuremodify.tc";TC.Consts.event.FEATURESSELECT="featureselect.tc";TC.Consts.event.FEATURESUNSELECT="featureunselect.tc";TC.Consts.event.CHANGE="change.tc";!function(){TC.control.Modify=function(){TC.Control.apply(this,arguments);this.__firstRender=$.Deferred();this.styles=$.extend(!0,TC.Cfg.styles.selection,this.options.styles);this.styles.text=this.styles.text||{fontSize:this.styles.line.fontSize,fontColor:this.styles.line.fontColor,labelOutlineColor:this.styles.line.labelOutlineColor,labelOutlineWidth:this.styles.line.labelOutlineWidth};this._classSelector="."+this.CLASS;this.wrap=new TC.wrap.control.Modify(this);this._layerPromise=$.Deferred()};TC.inherit(TC.control.Modify,TC.Control);var e=TC.control.Modify.prototype;e.CLASS="tc-ctl-mod";TC.isDebug?e.template=TC.apiLocation+"TC/templates/Modify.html":e.template=function(){dust.register(e.CLASS,t);function t(e,t){return e.w('<button class="tc-ctl-btn tc-ctl-mod-btn-select" disabled title="').h("i18n",t,{},{$key:"select"}).w('">').h("i18n",t,{},{$key:"select"}).w('</button><button class="tc-ctl-btn tc-ctl-mod-btn-delete" disabled title="').h("i18n",t,{},{$key:"deleteSelection"}).w('">').h("i18n",t,{},{$key:"deleteSelection"}).w('</button><button class="tc-ctl-btn tc-ctl-mod-btn-join" disabled title="').h("i18n",t,{},{$key:"joinGeometries.tooltip"}).w('">').h("i18n",t,{},{$key:"joinGeometries"}).w('</button><button class="tc-ctl-btn tc-ctl-mod-btn-split" disabled title="').h("i18n",t,{},{$key:"splitGeometry"}).w('">').h("i18n",t,{},{$key:"splitGeometry"}).w('</button><button class="tc-ctl-btn tc-ctl-mod-btn-text" contenteditable="true" disabled title="').h("i18n",t,{},{$key:"addText"}).w('">').h("i18n",t,{},{$key:"addText"}).w('</button><div class="tc-ctl-mod-style tc-hidden"><input type="text" class="tc-ctl-mod-txt tc-textbox" placeholder="').h("i18n",t,{},{$key:"writeTextForSketch"}).w('" style="font-size:').f(t.get(["fontSize"],!1),t,"h").w("pt;font-color:").f(t.get(["fontColor"],!1),t,"h").w(";text-shadow: 0 0 ").f(t.get(["labelOutlineWidth"],!1),t,"h").w("px ").f(t.get(["labelOutlineColor"],!1),t,"h").w(';" />').h("i18n",t,{},{$key:"textColor"}).w('<input type="color" class="tc-ctl-mod-fnt-c" value="').f(t.get(["fontColor"],!1),t,"h").w('" />').h("i18n",t,{},{$key:"fontSize"}).w('<input type="number" class="tc-ctl-mod-fnt-s tc-textbox" value="').f(t.get(["fontSize"],!1),t,"h").w('" min="7" max="20" /></div>')}t.__dustBody=!0;return t};const t=function(e,t){e._$deleteBtn.prop("disabled",0===t.length);e._$joinBtn.prop("disabled",t.length<2);e._$splitBtn.prop("disabled",0===t.filter(o).length);e.displayLabelText()},o=function(e){var t=!1;(TC.feature.MultiPolygon&&e instanceof TC.feature.MultiPolygon||TC.feature.MultiPolyline&&e instanceof TC.feature.MultiPolyline)&&e.geometry.length>1&&(t=!0);return t};e.register=function(e){var o=this;TC.Control.prototype.register.call(o,e);if(o.options.layer){o.setLayer(o.options.layer);e.on(TC.Consts.event.FEATUREADD+" "+TC.Consts.event.FEATURESADD,function(e){$.when(o.getLayer(),o.renderPromise()).then(function(t){if(e.layer===t){o._$selectBtn.prop("disabled",!1);o._$textBtn.prop("disabled",!1)}})}).on(TC.Consts.event.FEATUREREMOVE+" "+TC.Consts.event.FEATURESCLEAR,function(e){$.when(o.getLayer(),o.renderPromise()).then(function(r){if(e.layer===r){e.feature?o.unselectFeatures([e.feature]):o.unselectFeatures();t(o,o.getSelectedFeatures());if(0===o.layer.features.length){o._$selectBtn.prop("disabled",!0);o.setTextMode(!1);o._$textBtn.prop("disabled",!0)}}})});o.on(TC.Consts.event.FEATURESSELECT,function(e){const r=o.getSelectedFeatures();t(o,r)}).on(TC.Consts.event.FEATURESUNSELECT,function(e){t(o,o.getSelectedFeatures())})}};e.render=function(e){const t=this,o=function(){t._$selectBtn=t._$div.find("."+t.CLASS+"-btn-select").on(TC.Consts.event.CLICK,function(e){e.target.disabled||(t.isActive?t.deactivate():t.activate())});t._$deleteBtn=t._$div.find("."+t.CLASS+"-btn-delete").on(TC.Consts.event.CLICK,function(){t.deleteSelectedFeatures()});t._$textBtn=t._$div.find("."+t.CLASS+"-btn-text").on(TC.Consts.event.CLICK,function(){t.setTextMode(!t.textActive)});t._$joinBtn=t._$div.find("."+t.CLASS+"-btn-join");t._$splitBtn=t._$div.find("."+t.CLASS+"-btn-split");t._$text=t._$div.find("input."+t.CLASS+"-txt").on("input.tc",function(e){t.labelFeatures(e.target.value)});t._$styleSection=t._$div.find("."+t.CLASS+"-style");t._$fontColorPicker=t._$div.find(t._classSelector+"-fnt-c").on(TC.Consts.event.CHANGE,function(e){t.setFontColor(e.target.value)});t._$fontSizeSelector=t._$div.find("."+t.CLASS+"-fnt-s").on(TC.Consts.event.CHANGE,function(e){t.setFontSize(e.target.value)});t.__firstRender.resolve();$.isFunction(e)&&e()},r={fontSize:t.styles.text.fontSize,fontColor:t.styles.text.fontColor,labelOutlineColor:t.styles.text.labelOutlineColor,labelOutlineWidth:t.styles.text.labelOutlineWidth};Modernizr.inputtypes.color?t.renderData(r,o):TC.loadJS(!$.fn.spectrum,TC.apiLocation+"lib/spectrum/spectrum.min.js",function(){TC.loadCSS(TC.apiLocation+"lib/spectrum/spectrum.css");t.renderData(r,function(){t._$div.find("input[type=color]").spectrum({preferredFormat:"hex",showPalette:!0,palette:[],selectionPalette:[],cancelText:t.getLocaleString("cancel"),chooseText:t.getLocaleString("ok"),replacerClassName:t.CLASS+"-str-c"});o()})})};e.renderPromise=function(){return this.__firstRender.promise()};e.activate=function(){this._$selectBtn.addClass(TC.Consts.classes.ACTIVE);TC.Control.prototype.activate.call(this);this.wrap.activate(this.mode)};e.deactivate=function(){this._$selectBtn&&this._$selectBtn.removeClass(TC.Consts.classes.ACTIVE);TC.Control.prototype.deactivate.call(this);this._$selectBtn&&t(this,[]);this.wrap&&this.wrap.deactivate()};e.clear=function(){const e=this;e.layer&&e.layer.clearFatures();return e};e.isExclusive=function(){return!0};e.end=function(){this.wrap.end();return this};e.setMode=function(e,t){const o=this;e&&(o.mode=e);if(t&&e){o.layer&&o.layer.map.putLayerOnTop(o.layer);o.activate()}else o.deactivate();var r=t?TC.Consts.event.CONTROLACTIVATE:TC.Consts.event.CONTROLDEACTIVATE;o.map&&o.map.$events.trigger($.Event(r,{control:o}));return o};e.getLayer=function(){return this.options&&"boolean"==typeof this.options.layer&&!this.options.layer?null:this.layer?this.layer:this._layerPromise};e.setLayer=function(e){var t=this;if(t.map)if("string"==typeof e)t.map.loaded(function(){t.layer=t.map.getLayer(e);t._layerPromise.resolve(t.layer)});else{t.layer=e;t._layerPromise.resolve(t.layer)}};e.getSelectedFeatures=function(){return this.wrap.getSelectedFeatures()};e.setSelectedFeatures=function(e){const t=this.wrap.setSelectedFeatures(e);this.displayLabelText();return t};e.getActiveFeatures=function(){const e=this,t=e.getSelectedFeatures();!t.length&&e.layer.features.length&&t.push(e.layer.features[e.layer.features.length-1]);return t};e.unselectFeatures=function(e){e=e||[];this.wrap.unselectFeatures(e.map(function(e){return e.wrap.feature}));return this};e.deleteSelectedFeatures=function(){const e=this,t=e.getSelectedFeatures();e.wrap.unselectFeatures(t);t.forEach(function(t){e.layer.removeFeature(t)});return e};e.styleFunction=function(e,t){var o;const r=this.map.options.styles.selection;switch(!0){case TC.feature.Polygon&&e instanceof TC.feature.Polygon:case TC.feature.MultiPolygon&&e instanceof TC.feature.MultiPolygon:o=$.extend({},r.polygon);break;case TC.feature.Point&&e instanceof TC.feature.Point:case TC.feature.MultiPoint&&e instanceof TC.feature.MultiPoint:o=$.extend({},r.point);break;default:o=$.extend({},r.line)}const i=e.getStyle();if(i.label){o.label=i.label;o.fontSize=i.fontSize;o.fontColor=i.fontColor;o.labelOutlineColor=i.labelOutlineColor;o.labelOutlineWidth=i.labelOutlineWidth}return o};e.setTextMode=function(e){this.textActive=e;this._$textBtn.toggleClass(TC.Consts.classes.ACTIVE,e);this._$styleSection.toggleClass(TC.Consts.classes.HIDDEN,!e);this.displayLabelText();return this};e.setFontColorWatch=function(e,t){const o=this;void 0===e&&(e=o.styles.text.fontColor);e=TC.Util.colorArrayToString(e);t=t||o.getLabelOutlineColor(e);o.renderPromise().then(function(){o._$fontColorPicker.val(e);Modernizr.inputtypes.color||o._$fontColorPicker.spectrum("set",e);o._$text.css("color",e);o._$text.css("text-shadow","0 0 "+o.styles.text.labelOutlineWidth+"px "+t)});return o};e.setFontColor=function(e){const t=this;t.styles.text.fontColor=e;t.styles.text.labelOutlineColor=t.getLabelOutlineColor(e);t.setFontColorWatch(e,t.styles.text.labelOutlineColor);t.getActiveFeatures().forEach(function(o){const r=o.getStyle();r.fontColor=e;r.labelOutlineColor=t.styles.text.labelOutlineColor;o.setStyle(r)});return t};e.setFontSizeWatch=function(e){const t=this;void 0===e&&(e=t.styles.text.fontSize);const o=parseInt(e);o!==Number.NaN&&t.renderPromise().then(function(){t._$fontSizeSelector.val(o);t._$text.css("font-size",o+"pt")});return t};e.setFontSize=function(e){const t=this,o=parseInt(e);if(o!==Number.NaN){t.styles.text.fontSize=o;t.setFontSizeWatch(o);t.getActiveFeatures().forEach(function(e){const t=e.getStyle();t.fontSize=o;e.setStyle(t)})}return t};e.getLabelOutlineColor=function(e){if(e){const t=(e=TC.Util.colorArrayToString(e)).match(/^#([0-9a-f])([0-9a-f])([0-9a-f])$/i);t&&t.length&&(e="#"+t[1]+t[1]+t[2]+t[2]+t[3]+t[3]);const o=e.match(/^#([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})$/i);if(o&&o.length){return(parseInt(o[1],16)+parseInt(o[2],16)+parseInt(o[3],16))/3<128?"#fff":"#000"}}return"#fff"};e.displayLabelText=function(){const e=this,t=e.getSelectedFeatures();var o,r,i;if(e.isActive&&t.length){const e=t[t.length-1].getStyle();o=e.label;i=e.fontColor;r=e.fontSize}else{o="";i=e.styles.text.fontColor;r=e.styles.text.fontSize}e.renderPromise().then(function(){e.setFontSizeWatch(r).setFontColorWatch(i)._$text.val(o)});return e};e.labelFeatures=function(e){const t=this,o=t.getActiveFeatures();if(o.length){const r=o[0].getStyle();o.forEach(function(o){const i=$.extend({},t.styles.text,r);r.label=e;r.labelOffset=i.labelOffset;r.fontColor=i.fontColor;r.fontSize=i.fontSize;r.labelOutlineColor=i.labelOutlineColor;r.labelOutlineWidth=i.labelOutlineWidth;o.setStyle(r)})}return t}}();TC.control=TC.control||{};TC.control.FeatureInfoCommons||TC.syncLoadJS(TC.apiLocation+"TC/control/FeatureInfoCommons");!function(){TC.control.MultiFeatureInfo=function(){this.lineColor=null;TC.Control.apply(this,arguments);this.modes=this.options.modes||{};void 0===this.modes[TC.Consts.geom.POINT]&&(this.modes[TC.Consts.geom.POINT]=!0);void 0===this.modes[TC.Consts.geom.POLYGON]&&(this.modes[TC.Consts.geom.POLYGON]=!0);this.fInfoCtrl=null;this.lineFInfoCtrl=null;this.polygonFInfoCtrl=null;this.lastCtrlActive=null;this.popup=null};TC.inherit(TC.control.MultiFeatureInfo,TC.control.FeatureInfoCommons);var e=TC.control.MultiFeatureInfo.prototype;e.CLASS="tc-ctl-m-finfo";TC.isDebug?e.template=TC.apiLocation+"TC/templates/MultiFeatureInfo.html":e.template=function(){dust.register(e.CLASS,t);function t(e,t){return e.w('<div class="tc-ctl-m-finfo-select"><form><span>').h("i18n",t,{},{$key:"selection"}).w("</span>").x(t.get(["pointSelectValue"],!1),t,{block:o},{}).x(t.get(["lineSelectValue"],!1),t,{block:r},{}).x(t.get(["polygonSelectValue"],!1),t,{block:i},{}).w("</form></div>")}t.__dustBody=!0;function o(e,t){return e.w('<label class="tc-ctl-m-finfo-btn-point" title="').h("i18n",t,{},{$key:"selectionByPoint"}).w('"><input type="radio" name="selectmode" value="').f(t.get(["pointSelectValue"],!1),t,"h").w('" checked /><span class="tc-ctl-btn">').h("i18n",t,{},{$key:"byPoint"}).w("</span></label>")}o.__dustBody=!0;function r(e,t){return e.w('<label class="tc-ctl-m-finfo-btn-line" title="').h("i18n",t,{},{$key:"selectionByLine"}).w('"><input type="radio" name="selectmode" value="').f(t.get(["lineSelectValue"],!1),t,"h").w('" /><span class="tc-ctl-btn">').h("i18n",t,{},{$key:"byLine"}).w("</span></label>")}r.__dustBody=!0;function i(e,t){return e.w('<label class="tc-ctl-m-finfo-btn-polygon" title="').h("i18n",t,{},{$key:"selectionByPrecinct"}).w('"><input type="radio" name="selectmode" value="').f(t.get(["polygonSelectValue"],!1),t,"h").w('" /><span class="tc-ctl-btn">').h("i18n",t,{},{$key:"byPrecinct"}).w("</span></label>")}i.__dustBody=!0;return t};e.register=function(e){var t=this;TC.Control.prototype.register.call(t,e);e.loaded(function(){var o=[];if(t.modes[TC.Consts.geom.POINT]){var r=$.Deferred();o.push(r);$.when(e.addControl("featureInfo",{displayMode:t.options.displayMode})).then(function(e){t.fInfoCtrl=e;r.resolve()})}if(t.modes[TC.Consts.geom.POLYLINE]){var i=$.Deferred();o.push(i);$.when(e.addControl("lineFeatureInfo",{displayMode:t.options.displayMode,lineColor:t.lineColor})).then(function(e){t.lineFInfoCtrl=e;i.resolve()})}if(t.modes[TC.Consts.geom.POLYGON]){var n=$.Deferred();o.push(n);$.when(e.addControl("polygonFeatureInfo",{displayMode:t.options.displayMode,lineColor:t.lineColor})).then(function(e){t.polygonFInfoCtrl=e;n.resolve()})}$.when.apply(this,o).then(function(){if(t.fInfoCtrl){t.fInfoCtrl.activate();t.lastCtrlActive=t.fInfoCtrl}})})};e.render=function(e){var t=this;t.lineColor=t.options.lineColor?t.options.lineColor:"#c00";var o={};t.modes[TC.Consts.geom.POINT]&&(o.pointSelectValue=TC.Consts.geom.POINT);t.modes[TC.Consts.geom.POLYLINE]&&(o.lineSelectValue=TC.Consts.geom.POLYLINE);t.modes[TC.Consts.geom.POLYGON]&&(o.polygonSelectValue=TC.Consts.geom.POLYGON);TC.Control.prototype.renderData.call(t,o,function(){t._$div.find("input[type=radio]").on("change",function(){switch(this.value){case TC.Consts.geom.POLYLINE:console.log("seleccion por l\xednea");t.map.activeControl!==t.fInfoCtrl&&t.map.activeControl!==t.polygonFInfoCtrl||t.lineFInfoCtrl.activate();t.lastCtrlActive=t.lineFInfoCtrl;break;case TC.Consts.geom.POLYGON:console.log("seleccion por pol\xedgono");t.map.activeControl!==t.fInfoCtrl&&t.map.activeControl!==t.lineFInfoCtrl||t.polygonFInfoCtrl.activate();t.lastCtrlActive=t.polygonFInfoCtrl;break;default:console.log("seleccion por punto");t.map.activeControl!==t.polygonFInfoCtrl&&t.map.activeControl!==t.lineFInfoCtrl||t.fInfoCtrl.activate();t.lastCtrlActive=t.fInfoCtrl}});$.isFunction(e)&&e()})};e.activate=function(){this.lastCtrlActive&&this.lastCtrlActive.activate()};e.deactivate=function(){this.lastCtrlActive.deactivate(!1)};TC.Map.prototype.getDefaultControl=function(){var e=this.getControlsByClass("TC.control.MultiFeatureInfo");return e&&e.length?e[0].lastCtrlActive:(e=this.getControlsByClass("TC.control.FeatureInfo"))&&e.length?e[0]:null}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.control.NavBar=function(){TC.Control.apply(this,arguments)};TC.inherit(TC.control.NavBar,TC.Control);!function(){var e=TC.control.NavBar.prototype;e.CLASS="tc-ctl-nav";e.render=function(){this.wrap||(this.wrap=new TC.wrap.control.NavBar(this))};e.register=function(e){var t=this;TC.Control.prototype.register.call(t,e);t.wrap.register(e);e.loaded(function(){t.wrap.refresh()});e.on(TC.Consts.event.PROJECTIONCHANGE,function(o){var r=TC.Util.reproject([e.options.initialExtent[0],e.options.initialExtent[1]],e.options.crs,o.crs),i=TC.Util.reproject([e.options.initialExtent[2],e.options.initialExtent[3]],e.options.crs,o.crs);t.wrap.setInitialExtent([r[0],r[1],i[0],i[1]])})}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.control.OverviewMap=function(){TC.Control.apply(this,arguments);this.$events=$(this);this.isLoaded=!1;this.layer=null;this.wrap=new TC.wrap.control.OverviewMap(this)};TC.inherit(TC.control.OverviewMap,TC.Control);!function(){var e=TC.control.OverviewMap.prototype;e.CLASS="tc-ctl-ovmap";TC.isDebug?e.template=TC.apiLocation+"TC/templates/OverviewMap.html":e.template=function(){dust.register(e.CLASS,t);function t(e,t){return e.w('<div class="tc-ctl-ovmap-load tc-hidden"></div>')}t.__dustBody=!0;return t};e.register=function(e){var t=this;TC.Control.prototype.register.call(t,e);const o=function(t){return function(t){var o,r=function(e,t){for(var o=null,r=0;r<t.length;r++){var i=t[r];if((i.id||i)===e){o=i;break}}return o};if("string"==typeof t){var i=r(t,e.options.availableBaseLayers);$.isPlainObject(i)||(i=r(t,e.options.baseLayers));$.isPlainObject(i)&&(o=new TC.layer.Raster(i))}else o=t instanceof TC.Layer?t:t.type===TC.Consts.layerType.VECTOR||t.type===TC.Consts.layerType.KML||t.type===TC.Consts.layerType.WFS?new TC.layer.Vector(t):new TC.layer.Raster(t);return o}(t)};e.loaded(function(){t.defaultLayer=o(t.options.layer);t.layer=o(e.baseLayer.overviewMapLayer||t.options.layer||e.options.baseLayers[0]||e.options.availableBaseLayers[0]);t.wrap.register(e);!function(o){const r={};t.layer.getCapabilitiesPromise().then(function(){t.layer.isCompatible(e.crs)||0!==t.layer.wrap.getCompatibleMatrixSets(e.crs).length||(r.layer=t.layer.getFallbackLayer());t.wrap.reset(r)})}(e.crs);e.on(TC.Consts.event.PROJECTIONCHANGE+" "+TC.Consts.event.BASELAYERCHANGE,function(e){const t=this;if(t.map.baseLayer.type===TC.Consts.layerType.WMS||t.map.baseLayer.type===TC.Consts.layerType.WMTS){var r=t.map.baseLayer.overviewMapLayer||t.options.layer;if(t.layer.id!==r){var i=o(r);t.wrap.reset({layer:i}).then(function(e){t.layer=e})}else TC.Consts.event.PROJECTIONCHANGE.indexOf(e.type)>-1&&t.wrap.reset({layer:t.layer}).then(function(e){t.layer=e})}}.bind(t))})};e.loaded=function(e){$.isFunction(e)&&(this.isLoaded&&this.map&&this.map.isLoaded?e():this.$events.on(TC.Consts.event.MAPLOAD,e))};e.activate=function(){this.enable()};e.deactivate=function(){this.disable()};e.enable=function(){TC.Control.prototype.enable.call(this);this.wrap.enable()};e.disable=function(){TC.Control.prototype.disable.call(this);this.wrap.disable()}}();TC.control=TC.control||{};TC.control.GeometryFeatureInfo||TC.syncLoadJS(TC.apiLocation+"TC/control/GeometryFeatureInfo");!function(){TC.control.PolygonFeatureInfo=function(){TC.control.GeometryFeatureInfo.apply(this,arguments);this.geometryType=TC.Consts.geom.POLYGON};TC.inherit(TC.control.PolygonFeatureInfo,TC.control.GeometryFeatureInfo);var e=TC.control.PolygonFeatureInfo.prototype;e.CLASS="tc-ctl-finfo";e.template={};if(TC.isDebug){e.template[e.CLASS]=TC.apiLocation+"TC/templates/FeatureInfo.html";e.template[e.CLASS+"-dialog"]=TC.apiLocation+"TC/templates/FeatureInfoDialog.html"}else{e.template[e.CLASS]=function(){dust.register(e.CLASS,t);function t(e,t){return e.w('<ul class="tc-ctl-finfo-services">').s(t.get(["services"],!1),t,{else:o,block:r},{}).w("</ul>").x(t.get(["featureCount"],!1),t,{block:L},{})}t.__dustBody=!0;function o(e,t){return e.w('<li class="tc-ctl-finfo-empty">').h("i18n",t,{},{$key:"noData"}).w("</li>")}o.__dustBody=!0;function r(e,t){return e.w("<li><h3>").x(t.getPath(!1,["mapLayer","title"]),t,{else:i,block:n},{}).w('</h3><div class="tc-ctl-finfo-service-content">').s(t.get(["hasLimits"],!1),t,{else:a,block:P},{}).w("</div></li>")}r.__dustBody=!0;function i(e,t){return e.f(t.getPath(!1,["mapLayer","id"]),t,"h")}i.__dustBody=!0;function n(e,t){return e.f(t.getPath(!1,["mapLayer","title"]),t,"h")}n.__dustBody=!0;function a(e,t){return e.w('<ul class="tc-ctl-finfo-layers">').s(t.get(["layers"],!1),t,{else:l,block:s},{}).w("</ul>")}a.__dustBody=!0;function l(e,t){return e.w('<li class="tc-ctl-finfo-empty">').h("i18n",t,{},{$key:"noDataAtThisService"}).w("</li>")}l.__dustBody=!0;function s(e,t){return e.w("<li><h4>").s(t.get(["path"],!1),t,{block:p},{}).w(' <span class="tc-ctl-finfo-layer-n">').f(t.getPath(!1,["features","length"]),t,"h").w('</span> </h4> <div class="tc-ctl-finfo-layer-content"><ul class="tc-ctl-finfo-features">').s(t.get(["features"],!1),t,{else:u,block:g},{}).w("</ul></div></li>")}s.__dustBody=!0;function p(e,t){return e.f(t.getPath(!0,[]),t,"h").h("sep",t,{block:c},{})}p.__dustBody=!0;function c(e,t){return e.w(" &bull; ")}c.__dustBody=!0;function u(e,t){return e.w('<li class="tc-ctl-finfo-empty">').h("i18n",t,{},{$key:"noDataInThisLayer"}).w("</li>")}u.__dustBody=!0;function g(e,t){return e.w("<li>").x(t.get(["rawContent"],!1),t,{else:d,block:C},{}).w("</li>")}g.__dustBody=!0;function d(e,t){return e.x(t.get(["error"],!1),t,{else:h,block:v},{})}d.__dustBody=!0;function h(e,t){return e.w("<h5>").f(t.get(["id"],!1),t,"h").w("</h5><table").x(t.get(["geometry"],!1),t,{block:f},{}).w("><tbody>").s(t.get(["attributes"],!1),t,{block:y},{}).w("</tbody></table>").x(t.get(["geometry"],!1),t,{block:m},{})}h.__dustBody=!0;function f(e,t){return e.w(' title="').h("i18n",t,{},{$key:"clickToCenter"}).w('"')}f.__dustBody=!0;function y(e,t){return e.w('<tr><th class="tc-ctl-finfo-attr">').f(t.get(["name"],!1),t,"h").w('</th><td class="tc-ctl-finfo-val">').f(t.get(["value"],!1),t,"h").w("</td></tr>")}y.__dustBody=!0;function m(e,t){return e.w('<div class="tc-ctl-finfo-tools"><button class="tc-ctl-finfo-tools-btn" title="').h("i18n",t,{},{$key:"download"}).w("/").h("i18n",t,{},{$key:"share"}).w('">').h("i18n",t,{},{$key:"download"}).w("/").h("i18n",t,{},{$key:"share"}).w("</button></div>")}m.__dustBody=!0;function v(e,t){return e.w('<span class="tc-ctl-finfo-errors">').h("i18n",t,{},{$key:"fi.error"}).w('<span class="tc-ctl-finfo-error-text">').f(t.get(["error"],!1),t,"h").w("</span></span>")}v.__dustBody=!0;function C(e,t){return e.w("<h5>").h("i18n",t,{},{$key:"feature"}).w("</h5>").h("eq",t,{else:T,block:S},{key:t.get(["rawFormat"],!1),value:"text/html"})}C.__dustBody=!0;function T(e,t){return e.w("<pre>").f(t.get(["rawContent"],!1),t,"h").w("</pre>")}T.__dustBody=!0;function S(e,t){return e.w(" ").x(t.get(["expandUrl"],!1),t,{block:_},{})}S.__dustBody=!0;function _(e,t){return e.h("ne",t,{else:E,block:x},{key:t.get(["expandUrl"],!1),value:""})}_.__dustBody=!0;function E(e,t){return e.w('<iframe src="').f(t.get(["rawUrl"],!1),t,"h").w('" />')}E.__dustBody=!0;function x(e,t){return e.w('<div class="tc-ctl-finfo-features-iframe-cnt"><iframe src="').f(t.get(["rawUrl"],!1),t,"h").w('" /><a class="tc-ctl-finfo-open" onclick="window.open(\'').f(t.get(["expandUrl"],!1),t,"h").w("', '_blank')\" title=\"").h("i18n",t,{},{$key:"expand"}).w('"></a></div>')}x.__dustBody=!0;function P(e,t){return e.w('<span class="tc-ctl-finfo-errors">').f(t.get(["hasLimits"],!1),t,"h").w("</span>")}P.__dustBody=!0;function L(e,t){return e.h("gt",t,{block:w},{key:t.get(["featureCount"],!1),value:"1",type:"number"})}L.__dustBody=!0;function w(e,t){return e.w('<a class="tc-ctl-btn tc-ctl-finfo-btn-prev">').h("i18n",t,{},{$key:"previous"}).w('</a><div class="tc-ctl-finfo-counter"><span class="tc-ctl-finfo-idx"></span>/').f(t.get(["featureCount"],!1),t,"h").w('</div><a class="tc-ctl-btn tc-ctl-finfo-btn-next">').h("i18n",t,{},{$key:"next"}).w("</a>")}w.__dustBody=!0;return t};e.template[e.CLASS+"-dialog"]=function(){dust.register(e.CLASS+"-dialog",t);function t(e,t){return e.w('<div class="tc-ctl-finfo-dialog tc-modal"><div class="tc-modal-background tc-modal-close"></div><div class="tc-modal-window"><div class="tc-modal-header"><h3>').h("i18n",t,{},{$key:"feature"}).w('</h3><div class="tc-ctl-popup-close tc-modal-close"></div></div><div class="tc-modal-body"><div class="tc-ctl-finfo-dialog-dl"><h2>').h("i18n",t,{},{$key:"download"}).w('</h2><div><button class="tc-button tc-ctl-finfo-dl-btn-kml" data-format="KML" title="KML">KML</button><button class="tc-button tc-ctl-finfo-dl-btn-gml" data-format="GML" title="GML">GML</button><button class="tc-button tc-ctl-finfo-dl-btn-geojson" data-format="GeoJSON" title="GeoJSON">GeoJSON</button><button class="tc-button tc-ctl-finfo-dl-btn-wkt" data-format="WKT" title="WKT">WKT</button></div></div><div class="tc-ctl-finfo-dialog-share"></div></div><div class="tc-modal-footer"><button type="button" class="tc-button tc-modal-close">').h("i18n",t,{},{$key:"close"}).w("</button></div></div></div>")}t.__dustBody=!0;return t}}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.Consts.event.POPUP="popup.tc";TC.Consts.event.POPUPHIDE="popuphide.tc";TC.Consts.classes.DRAG=TC.Consts.classes.DRAG||"tc-drag";TC.Consts.classes.DRAGGED=TC.Consts.classes.DRAGGED||"tc-dragged";TC.Consts.classes.DRAGGABLE=TC.Consts.classes.DRAGGABLE||"tc-draggable";TC.control.Popup=function(){TC.Control.apply(this,arguments);this.currentFeature=null;this.wrap=new TC.wrap.control.Popup(this)};TC.inherit(TC.control.Popup,TC.Control);!function(){var e=TC.control.Popup.prototype;e.CLASS="tc-ctl-popup";e.render=function(){};e.register=function(e){var t=this;TC.Control.prototype.register.call(t,e);$.when(e.wrap.addPopup(t)).then(function(){e.on(TC.Consts.event.LAYERVISIBILITY,function(e){t.currentFeature&&t.currentFeature.layer===e.layer&&!e.layer.getVisibility()&&t.isVisible()&&t.hide()});e.on(TC.Consts.event.LAYERREMOVE,function(e){t.currentFeature&&t.currentFeature.layer===e.layer&&t.isVisible()&&t.hide()});e.on(TC.Consts.event.UPDATE,function(){t.currentFeature&&t.currentFeature._visibilityState!==TC.Consts.visibility.NOT_VISIBLE||t.isVisible()&&t.hide()});e.on(TC.Consts.event.FEATUREREMOVE,function(e){t.currentFeature===e.feature&&t.isVisible()&&t.hide()})})};e.fitToView=function(e){var t=this;e?setTimeout(function(){t.wrap.fitToView()},1e3):t.wrap.fitToView()};e.hide=function(){if(this.map){this.map.wrap.hidePopup(this);this.setDragged(!1);this.map.$events.trigger($.Event(TC.Consts.event.POPUPHIDE,{control:this}))}};e.setDragged=function(e){this.dragged=e;this.$popupDiv&&this.$popupDiv.toggleClass(TC.Consts.classes.DRAGGED,e);this.wrap.setDragged(e)};e.setDragging=function(e){e&&this.setDragged(!0);this.$popupDiv.toggleClass(TC.Consts.classes.DRAG,e)};e.isVisible=function(){return this.$popupDiv&&this.$popupDiv.hasClass(TC.Consts.classes.VISIBLE)}}();TC.control=TC.control||{};TC.Consts.classes.PRINTABLE="tc-printable";TC.control.Print=function(e){var t=this,o=e||{};t.ready=!1;t.title=o.title||TC.Util.getLocaleString(TC.Cfg.locale,"printPage");t.cssUrl=o.cssUrl||TC.apiLocation+"TC/css/print.css";if(o.target){for(var r in t.template)dust.cache[r]||t.template[r]();var i=$(o.target);i.addClass(TC.Consts.classes.PRINTABLE);var n=function(e){var o=open(null,t.CLASS),r=i.html();dust.render(t.CLASS+"-page",{title:t.title,content:r,cssUrl:t.cssUrl},function(e,t){o.document.write(t);o.document.close();o.focus();e&&TC.error(e)})};dust.render(t.CLASS,null,function(e,o){i.append(o);i.find("."+t.CLASS+"-btn").on("click",n)})}};!function(){var e=TC.control.Print.prototype;e.CLASS="tc-ctl-print";e.template={};e.template[e.CLASS]=function(){dust.register(e.CLASS,t);function t(e,t){return e.w('<a class="tc-ctl-print-btn" title="').h("i18n",t,{},{$key:"printThisWindow"}).w('">').h("i18n",t,{},{$key:"print"}).w("</a>")}t.__dustBody=!0;return t};e.template[e.CLASS+"-page"]=function(){dust.register(e.CLASS+"-page",t);function t(e,t){return e.w('<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml"><head><title>').f(t.get(["title"],!1),t,"h").w('</title><link rel="stylesheet" href="').f(t.get(["cssUrl"],!1),t,"h").w('" /></head><body onload="print()" class="tc-ctl-print-page"><h1>').f(t.get(["title"],!1),t,"h").w("</h1>").f(t.get(["content"],!1),t,"h",["s"]).w("</body></html>")}t.__dustBody=!0;return t}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.control.PrintMap=function(){TC.Control.apply(this,arguments)};TC.inherit(TC.control.PrintMap,TC.Control);!function(){var e=TC.control.PrintMap.prototype;e.CLASS="tc-ctl-printMap";e.template={};TC.isDebug?e.template[e.CLASS]=TC.apiLocation+"TC/templates/PrintMap.html":e.template[e.CLASS]=function(){dust.register(e.CLASS,t);function t(e,t){return e.w("<h2>").h("i18n",t,{},{$key:"print"}).w('</h2><div><div class="tc-ctl-printMap-div"><div class="tc-group tc-ctl-printMap-cnt"><label>').h("i18n",t,{},{$key:"title"}).w(':</label><input type="text" class="tc-ctl-printMap-title tc-textbox" maxlength="30" placeholder="').h("i18n",t,{},{$key:"mapTitle"}).w('" /></div><div class="tc-group tc-ctl-printMap-cnt"><label>').h("i18n",t,{},{$key:"layout"}).w(':</label><select id="print-design" class="tc-combo"><option value="landscape">').h("i18n",t,{},{$key:"landscape"}).w('</option><option value="portrait">').h("i18n",t,{},{$key:"portrait"}).w('</option></select></div><div class="tc-group tc-ctl-printMap-cnt"><label>').h("i18n",t,{},{$key:"size"}).w(':</label><select id="print-size" class="tc-combo"><option value="a4">A4</option><option value="a3">A3</option></select></div><div class="tc-group tc-ctl-printMap-cnt"><button class="tc-ctl-printMap-btn tc-button tc-icon-button" title="').h("i18n",t,{},{$key:"printMap"}).w('">').h("i18n",t,{},{$key:"print"}).w("</button></div></div></div>")}t.__dustBody=!0;return t};e.register=function(e){var t=this;TC.Control.prototype.register.call(t,e);t._$div.on("click",".tc-ctl-printMap-btn",function(){var o,r="?";$.isEmptyObject(TC.Util.getQueryStringParams(window.location.href))||(r="&");r+="layout=layout/print&orientation="+$("#print-design").val()+"&title="+$("input.tc-ctl-printMap-title").val()+"&size="+$("#print-size").val();o=window.location.hash?window.location.href.replace(window.location.hash,r+window.location.hash):window.location.href+r;t.printWindow&&void 0!==t.printWindow&&t.printWindow.close();TC.printPreview={};TC.printPreview.refererMap=e;for(var i,n=[],a=0;a<e.workLayers.length;a++)if(((i=e.workLayers[a]).type===TC.Consts.layerType.VECTOR||i.type===TC.Consts.layerType.WFS)&&i.getVisibility()&&i.features.length>0)for(var l=i.features,s=0;s<l.length;s++){var p=l[s],c={};if(!(TC.feature.Marker&&p instanceof TC.feature.Marker&&p.options.noPrint)){if(p.layer.styles){var u=void 0==p.layer.styles[p.STYLETYPE]?p.layer.styles["polyline"===p.STYLETYPE?"line":p.STYLETYPE]:p.layer.styles["multipolygon"===p.STYLETYPE?"polygon":p.STYLETYPE];for(var g in u)c[g]="function"==typeof u[g]?u[g](p):u[g]}var d=function(e){return e>1?"pixels":"fraction"},h=p.getStyle(),f=$.isEmptyObject(h)?p.options:h;if(f.anchor&&$.isArray(f.anchor))var y={anchorXUnits:d(f.anchor[0]),anchorYUnits:d(f.anchor[1])};n.push({geometry:p.geometry,CLASSNAME:p.CLASSNAME,options:$.extend({},c,f,y,{layer:null})})}}TC.printPreview.mapFeatures=n;t.printWindow=window.open(o,"print");t.printWindow.onbeforeunload=function(){delete this.printWindow}.bind(this)})}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.control.PrintPdf=function(){TC.Control.apply(this,arguments)};TC.inherit(TC.control.PrintPdf,TC.Control);!function(){var e=TC.control.PrintPdf.prototype;e.CLASS="tc-ctl-print-pdf";var t={marginTop:20,marginLeft:55,a4:{width:596,height:842},a3:{width:842,height:1191},qrCode:{sideLength:85},headerHeight:20},o="portrait",r="landscape",i="a4",n=TC.Util.getParameterByName("orientation"),a=TC.Util.getParameterByName("size");TC.isDebug?e.template=TC.apiLocation+"TC/templates/PrintPdf.html":e.template=function(){dust.register(e.CLASS,t);function t(e,t){return e.w('<button disabled class="disabled tc-button tc-ctl-print-pdf-btn" title="').h("i18n",t,{},{$key:"printpdf"}).w('"></button>')}t.__dustBody=!0;return t};var l=function(){var e=window.location.href,t=e.indexOf("?"),o=e.indexOf("#");t>0&&(e=t<o?e.replace(e.substring(t,o),""):e.replace(e.substring(t,e.length-1),""));return e},s=function(e){var o=$.Deferred();e?TC.loadJS(void 0===QRCode,[TC.apiLocation+"lib/qrcode/qrcode.min.js"],function(){e.length>150&&(e=TC.Util.shortenUrl(e));var r=$("#qrcode");r.empty();new QRCode(r.get(0),{text:e,width:t.qrCode.sideLength,height:t.qrCode.sideLength});setTimeout(function(){var e=r.find("img").attr("src");o.resolve(e)},100)}):o.resolve(imgBase64);return o.promise()};e.register=function(e){var t=this;TC.Control.prototype.register.call(t,e);t.map.mustBeExportable=!0;t.pdfLibPromise=function(){var e=$.Deferred();window.pdfMake?e.resolve():TC.loadJS(!window.pdfMake,[TC.Consts.url.PDFMAKE],function(){e.resolve()});return e.promise()}();var o=!0;e._$div.on("mouseover",function(){if(o){e.toast(t.getLocaleString("print.advice.title")+": "+t.getLocaleString("print.advice.desc"),{type:TC.Consts.msgType.INFO,duration:7e3});o=!1}});var r="."+t.CLASS+"-btn";t.map.$events.on(TC.Consts.event.STARTLOADING,function(){var e=t._$div.find(r);e.addClass("disabled");e.attr("disabled","disabled")});t.map.$events.on(TC.Consts.event.STOPLOADING,function(){var e=t._$div.find(r);e.removeClass("disabled");e.removeAttr("disabled")});t.getLayersFromOpener();t.options.qrCode&&s(l());t._$div.on("click","."+t.CLASS+"-btn",function(){t.createPdf()})};var p=function(){var e=$.Deferred(),o={pageOrientation:n||r,pageSize:a||i,pageMargins:[t.marginLeft,t.marginTop]};e.resolve(o);return e.promise()};e.createPdf=function(){var e=this,r=function(e,r){return e===o?t[r].width:t[r].height}(n,a),i=function(e,r){return e===o?t[r].height:t[r].width}(n,a);e.canvas=$(".tc-map .ol-viewport canvas")[0];e.mapSize=TC.Util.calculateAspectRatioFit(e.canvas.width,e.canvas.height,r-2*t.marginLeft,i-2*t.marginTop-t.headerHeight);var c=function(t){TC.error(e.getLocaleString("print.error"));TC.error("No se ha podido generar el base64 correspondiente a la imagen: "+t,TC.Consts.msgErrorMode.EMAIL,"Error en la impresi\xf3n")},u=e.map.getControlsByClass(TC.control.LoadingIndicator)[0],g=u.addWait(),d=function(){u.removeWait(g)};$.when(e.pdfLibPromise).then(p).then(function(o){o.content=o.content||[];var r=$.Deferred(),i=e.map.getControlsByClass(TC.control.ScaleBar)[0];if(i)var n=$(".tc-ctl-sb .ol-scale-line-inner"),a=e.canvas.width/e.mapSize.width,l=n.width()/a;var s=function(e){var t=[],n=e||{text:""};t.push(n);t.push({text:TC.Util.getParameterByName(TC.Cfg.titleURLParamName),alignment:"center",fontSize:11});i&&t.push({table:{widths:[l],body:[[{text:i.getText(),fontSize:10,alignment:"center"}]]},layout:{hLineWidth:function(e,t){return 0===e?0:1},paddingLeft:function(e,t){return 0},paddingRight:function(e,t){return 0},paddingTop:function(e,t){return 0},paddingBottom:function(e,t){return 0}}});o.content.push({table:{widths:[l,"*",l]},layout:"noBorders"});o.content[0].table.body=[t];r.resolve(o)};e.options.logo?$.when(TC.Util.imgToDataUrl(e.options.logo,"image/png")).then(function(e,o){o.width,o.height;var r=TC.Util.calculateAspectRatioFit(o.width,o.height,l,t.headerHeight);s({image:e,height:r.height,width:r.width})},function(){c(e.options.logo);r.reject()}):s();return r.promise()}).fail(d).then(function(o){var r=$.Deferred();o.content=o.content||[];var i=function(t){o.content.push({table:{widths:["*"],body:[[{image:TC.Util.toDataUrl(t),width:e.mapSize.width}]]},layout:{paddingLeft:function(e,t){return 0},paddingRight:function(e,t){return 0},paddingTop:function(e,t){return.1},paddingBottom:function(e,t){return 0}}});r.resolve(o)};e.options.qrCode?$.when(s(l())).then(function(o){if(o)$.when(TC.Util.addToCanvas(e.canvas,o,{x:e.canvas.width-t.qrCode.sideLength,y:e.canvas.height-t.qrCode.sideLength})).then(function(e){i(e)});else{TC.error(e.getLocaleString("print.qr.error"));i(e.canvas)}}):i(e.canvas);return r.promise()}).then(function(t){var o=$.Deferred(),r=function(e,t,o){if(t.isVisibleByScale(e.name)){var r,i;t.options&&t.options.params&&t.options.params.base64LegendSrc?i=t.options.params.base64LegendSrc:e.legend&&(r=e.legend.src);result.push({src:r,title:e.title,level:o,srcBase64:i})}},i=function(e,t,o,r){if(Array.isArray(e))for(var n=0;n<e.length;n++)i(e[n],t,o,r);else if(e&&e.hasOwnProperty("children")&&e.children.length>0){e.title&&e.name&&result.push({header:e.title,level:r});i(e.children,t,o,++r)}if(e&&e.hasOwnProperty("children")&&0==e.children.length){t.apply(this,[e,o,r]);r--}};if(e.options.legend&&e.options.legend.visible){var a=e.options.legend.orientation||n,l=e.map.workLayers,s=[];t.content=t.content||{};if(l.length>0){for(var p=l.length-1;p>=0;p--){var u=l[p];if(u.type===TC.Consts.layerType.WMS&&u.getVisibility()){result=[];i(u.getTree(),r,u,0);result.length>0&&s.push({title:u.title,layers:result})}}$.when.apply($,function(){for(var e=[],t=0;t<s.length;t++)for(var o=s[t].layers,r=0;r<o.length;r++)!function(o,r){var i=s[t].layers[r],n=i.src||i.srcBase64;if(n){TC.tool&&TC.tool.Proxification||TC.syncLoadJS(TC.apiLocation+"TC/tool/Proxification");e.push($.Deferred());var a=e[e.length-1];new TC.tool.Proxification(TC.proxify,{allowedMixedContent:!0}).getImage(n,!0).then(function(e){if(e.complete){var t=TC.Util.imgTagToDataUrl(e,"image/png");i.image={base64:t.base64,canvas:t.canvas}}else c(n);a.resolve()},function(e){c(n);a.reject()})}}(0,r);return e}()).then(function(){s.length>0&&t.content.push({text:" ",pageBreak:"before",pageOrientation:a});for(var e=0;e<s.length;e++){var r=s[e],i=10;t.content.push({text:r.title,fontSize:11,margin:[0,0,0,5]});for(var n=0;n<r.layers.length;n++){var l=r.layers[n];i=7*l.level;if(!l.header||l.header!==r.title)if(l.header)t.content.push({text:l.header,fontSize:10,margin:[i,0,0,3]});else{t.content.push({text:l.title,fontSize:9,margin:[i,0,0,2]});if(l.image){var p=l.image.canvas.width/2,c=p*l.image.canvas.height/l.image.canvas.width;t.content.push({image:l.image.base64,width:p,height:c,margin:[i,0,0,2]})}}}}o.resolve(t)},function(){o.reject()})}else o.resolve(t)}else o.resolve(t);return o.promise()}).fail(d).then(function(e){var t=window.location.host+"_",o=TC.Util.getParameterByName("title");t+=o||TC.Util.getFormattedDate((new Date).toString(),!0);pdfMake.createPdf(e).download(t.replace(/[\\\/:*?"<>\|]/g,"")+".pdf")}).then(d)};e.getLayersFromOpener=function(e){var t=this,o=window.opener;if(o){var r=o.TC,i=r.printPreview?r.printPreview.refererMap:null;i&&t.map.loaded(function(){for(var e=0;e<t.map.baseLayers.length;e++)t.map.removeLayer(t.map.baseLayers[e]);var o=i.getBaseLayer();t.map.addLayer({id:o.id,title:o.title,type:o.type,url:o.url,encoding:o.encoding,layerNames:o.layerNames,matrixSet:o.matrixSet,format:o.format,minResolution:o.minResolution,maxZoom:o.maxZoom,isBase:!0});var n,a=i.workLayers;for(e=0;e<a.length;e++)(n=a[e]).type===r.Consts.layerType.WMS&&n.options.stateless&&t.map.addLayer({id:n.id,title:n.title,type:n.type,method:n.method,url:n.url,format:n.format,stateless:n.stateless,params:n.params,layerNames:n.layerNames},function(e){e.setVisibility(n.getVisibility());e.setOpacity(n.getOpacity())});var l=r.printPreview.mapFeatures;l&&t.map.addLayer({id:t.getUID(),type:r.Consts.layerType.VECTOR},function(e){r.loadJS(!r.feature,[r.apiLocation+"TC/Feature",r.apiLocation+"TC/feature/Point",r.apiLocation+"TC/feature/Polyline",r.apiLocation+"TC/feature/Polygon",r.apiLocation+"TC/feature/MultiPolygon",r.apiLocation+"TC/feature/MultiPolyline",r.apiLocation+"TC/feature/Circle",r.apiLocation+"TC/feature/Marker"],function(){for(var t=0;t<l.length;t++){var o=l[t];switch(o.CLASSNAME){case"TC.feature.Point":e.addPoint(o.geometry,o.options);break;case"TC.feature.Polyline":e.addPolyline(o.geometry,o.options);break;case"TC.feature.Polygon":e.addPolygon(o.geometry,o.options);break;case"TC.feature.MultiPolygon":e.addMultiPolygon(o.geometry,o.options);break;case"TC.feature.MultiPolyline":e.addMultiPolyline(o.geometry,o.options);break;case"TC.feature.Circle":e.addCircle(o.geometry,o.options);break;case"TC.feature.Marker":e.addMarker(o.geometry,o.options)}}})})})}}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.Consts.event.RESULTTOOLTIP="resulttooltip.tc";TC.Consts.event.RESULTTOOLTIPEND="resulttooltipend.tc";TC.Consts.event.DRAWCHART="drawchart.tc";TC.Consts.event.DRAWTABLE="drawtable.tc";TC.Consts.event.RESULTSPANELMIN="resultspanelmin.tc";TC.Consts.event.RESULTSPANELMAX="resultspanelmax.tc";TC.Consts.event.RESULTSPANELCLOSE="resultspanelclose.tc";TC.control.ResultsPanel=function(){TC.Control.apply(this,arguments);this.wrap=new TC.wrap.control.ResultsPanel(this);this.data={};this.classes={FA:"fa"};this.contentType={TABLE:{fnOpen:TC.control.ResultsPanel.prototype.openTable,collapsedClass:".fa-list-alt"},CHART:{fnOpen:TC.control.ResultsPanel.prototype.openChart,collapsedClass:".fa-area-chart"}};this.content=this.contentType.TABLE;if(this.options){this.options.content&&(this.content=this.contentType[this.options.content.toUpperCase()]);this.options.chart&&(this.chart=this.options.chart);this.options.table&&(this.table=this.options.table);this.options.save&&(this.save=this.options.save)}};TC.inherit(TC.control.ResultsPanel,TC.Control);!function(){const ctlProto=TC.control.ResultsPanel.prototype;ctlProto.CLASS="tc-ctl-p-results";ctlProto.template={};ctlProto.CHART_SIZE={MIN_HEIGHT:70,MAX_HEIGHT:128,MIN_WIDTH:215,MEDIUM_WIDTH:310,MAX_WIDTH:445};if(TC.isDebug){ctlProto.template[ctlProto.CLASS]=TC.apiLocation+"TC/templates/ResultsPanel.html";ctlProto.template[ctlProto.CLASS+"-table"]=TC.apiLocation+"TC/templates/ResultsPanelTable.html";ctlProto.template[ctlProto.CLASS+"-chart"]=TC.apiLocation+"TC/templates/ResultsPanelChart.html"}else{ctlProto.template[ctlProto.CLASS]=function(){dust.register(ctlProto.CLASS,e);function e(e,t){return e.w('<div class="prpanel-group prsidebar-body " style="display: none" data-no-cb><div class="prpanel prpanel-default"><div class="prpanel-heading"><h4 class="prpanel-title"><span class="prpanel-title-text"></span> <span class="prcollapsed-pull-right prcollapsed-slide-submenu prcollapsed-slide-submenu-close" title="').h("i18n",t,{},{$key:"close"}).w('"><i class="fa fa-times"></i></span><span class="prcollapsed-pull-right prcollapsed-slide-submenu prcollapsed-slide-submenu-min" title="').h("i18n",t,{},{$key:"hide"}).w('"><i class="fa fa-chevron-left"></i></span><span class="prcollapsed-pull-right prcollapsed-slide-submenu prcollapsed-slide-submenu-csv" hidden title="').h("i18n",t,{},{$key:"export.excel"}).w('"><i class="fa fa-file-excel-o"></i></span></h4></div><div id="results" class="prpanel-collapse collapse in"><div class="prpanel-body list-group tc-ctl-p-results-table"> </div><div class="prpanel-body list-group tc-ctl-p-results-chart"></div></div></div></div><div class="prcollapsed prcollapsed-max prcollapsed-pull-left" style="display: none;" title="').h("i18n",t,{},{$key:"expand"}).w('" data-no-cb><i class="fa-list-alt" hidden></i><i class="fa-area-chart" hidden></i></div>')}e.__dustBody=!0;return e};ctlProto.template[ctlProto.CLASS+"-table"]=function(){dust.register(ctlProto.CLASS+"-table",e);function e(e,r){return e.w('<table class="table" style="display:none;"><thead>').s(r.get(["columns"],!1),r,{block:t},{}).w("</thead><tbody>").s(r.get(["results"],!1),r,{block:o},{}).w("</tbody></table>")}e.__dustBody=!0;function t(e,t){return e.w("<th>").f(t.getPath(!0,[]),t,"h").w("</th>")}t.__dustBody=!0;function o(e,t){return e.w("<tr>").h("iterate",t,{block:r},{on:t.getPath(!0,[])}).w("</tr>")}o.__dustBody=!0;function r(e,t){return e.w("<td>").f(t.get(["value"],!1),t,"h").w("</td>")}r.__dustBody=!0;return e};ctlProto.template[ctlProto.CLASS+"-chart"]=function(){dust.register(ctlProto.CLASS+"-chart",e);function e(e,r){return e.w('<div id="track-chart">').x(r.get(["msg"],!1),r,{else:t,block:o},{}).w("</div>")}e.__dustBody=!0;function t(e,t){return e.w('<span id="elevationGain" >').h("i18n",t,{},{$key:"geo.trk.chart.elevationGain"}).w(": +").f(t.get(["upHill"],!1),t,"h").w("m, -").f(t.get(["downHill"],!1),t,"h").w('m</span><div id="chart"></div>')}t.__dustBody=!0;function o(e,t){return e.f(t.get(["msg"],!1),t,"h")}o.__dustBody=!0;return e}}ctlProto.isVisible=function(){this._$div.find(".prsidebar-body").is(":visible")||this._$div.find(".prcollapsed-max").is(":visible")};ctlProto.render=function(e){var t=this;TC.Control.prototype.render.call(t,function(){t.$mainTitle=t._$div.find(".prpanel-title-text");t.$minimize=t._$div.find(".prcollapsed-slide-submenu-min");t.$minimize.on("click",function(){t.minimize()});t.$close=t._$div.find(".prcollapsed-slide-submenu-close");t.$close.on("click",function(){t.close()});t.$maximize=t._$div.find(".prcollapsed-max");t.$maximize.on("click",function(){t.maximize()});if(t.save){t.$save=t._$div.find(".prcollapsed-slide-submenu-csv");t.$save.on("click",function(){t.exportToExcel()});t.$save.removeAttr("hidden")}if(t.content){t.content=t.content;if(t.options.titles){if(t.options.titles.main){t.$mainTitle.attr("title",t.options.titles.main);t.$mainTitle.html(t.options.titles.main)}t.options.titles.max&&t.$maximize.attr("title",t.options.titles.max)}}t._$div.find(t.content.collapsedClass).removeAttr("hidden").addClass(t.classes.FA);t.$divTable=t._$div.find("."+t.CLASS+"-table");t.$divChart=t._$div.find("."+t.CLASS+"-chart");TC.loadJS(Modernizr.touch,TC.apiLocation+"lib/jQuery/jquery.touchSwipe.min.js",function(){if(Modernizr.touch)t._$div.swipe({swipeLeft:function(){t.minimize()}})});e&&"function"==typeof e&&e.call()})};ctlProto.minimize=function(){var e=this;if(0==e._$div.find(e.content.collapsedClass+":visible").length){e._$div.find(e.content.collapsedClass).hasClass(e.classes.FA)||e._$div.find(e.content.collapsedClass).addClass(e.classes.FA);e._$div.find(e.content.collapsedClass).removeAttr("hidden");e._$div.find(".prsidebar-body").toggle("slide",function(){e._$div.find(".prcollapsed-max").fadeIn()});e.map.$events.trigger($.Event(TC.Consts.event.RESULTSPANELMIN),{})}};ctlProto.maximize=function(){if(0==this._$div.find(this.content.collapsedClass+":hidden").length){this._$div.find(this.content.collapsedClass).attr("hidden","hidden");this._$div.find(".prsidebar-body").toggle("slide");this._$div.find(".prcollapsed-max").hide();this.map.$events.trigger($.Event(TC.Consts.event.RESULTSPANELMAX),{})}};ctlProto.isMinimized=function(){return 1===this._$div.find(".prcollapsed-max:visible").length&&0===this._$div.find(".prsidebar-body:visible").length};ctlProto.close=function(){this._$div.find(".prsidebar-body").fadeOut("slide");this._$div.find(".prcollapsed-max").hide();this._$div.find(this.content.collapsedClass).attr("hidden","hidden").removeClass(this.classes.FA);this.chart&&this.chart.chart&&(this.chart.chart=this.chart.chart.destroy());this.map.$events.trigger($.Event(TC.Consts.event.RESULTSPANELCLOSE,{control:this}))};ctlProto.openChart=function(e){const t=this;if(e)if(e.msg)t.map.toast(e.msg);else{t.elevationProfileCoordinates=e.coords;t.renderElevationProfileChart({data:e,div:t._$div.find("."+ctlProto.CLASS+"-chart")})}else t.map.toast(options.msg);t.map.getLoadingIndicator().hide()};ctlProto.renderElevationProfileChart=function(options){const self=this;options=options||{};TC.loadJS(!window.c3,TC.Consts.url.D3C3||TC.apiLocation+"lib/d3c3/d3c3.min.js",function(){const data=options.data,$div=$(options.div);var locale=TC.Util.getMapLocale(self.map);self.getRenderedHtml(ctlProto.CLASS+"-chart",{upHill:data.upHill.toLocaleString(locale),downHill:data.downHill.toLocaleString(locale)},function(out){$div.html(out);$div.show();if(self.options.titles){if(self.options.titles.main){self._$div.find(".prpanel-title-text").attr("title",self.options.titles.main);self._$div.find(".prpanel-title-text").html(self.options.titles.main)}self.options.titles.max&&self._$div.find(".prcollapsed-max").attr("title",self.options.titles.max)}var chartOptions=$.extend({bindto:$div.find(".tc-chart")[0],padding:{top:0,right:15,bottom:0,left:45},legend:{show:!1}},self.createChartOptions(data));self.chart.tooltip&&(chartOptions.tooltip={contents:function(d){var fn=self.chart.tooltip;"function"!=typeof fn&&(fn=TC.Util.getFNFromString(self.chart.tooltip));return fn.call(eval(self.chart.ctx),d)}});self.chart&&self.chart.onmouseout&&(chartOptions.onmouseout=function(){var fn=self.chart.onmouseout;"function"!=typeof fn&&(fn=TC.Util.getFNFromString(self.chart.onmouseout));fn.call(eval(self.chart.ctx))});chartOptions.onrendered=function(){$.isFunction(chartOptions._onrendered)&&chartOptions._onrendered.call(this);self.map.$events.trigger($.Event(TC.Consts.event.DRAWCHART,{control:self,svg:this.svg[0][0],chart:this}))};if(window.c3){if(!c3._isOverriden){window.c3.chart.internal.fn.generateDrawLine=function(e,t){var o=this,r=o.config,i=o.d3.svg.line(),n=o.generateGetLinePoints(e,t),a=t?o.getSubYScale:o.getYScale,l=function(e){return(t?o.subxx:o.xx).call(o,e)},s=function(e,t){return r.data_groups.length>0?n(e,t)[0][1]:a.call(o,e.id)(e.value)};i=r.axis_rotated?i.x(s).y(l):i.x(l).y(s);r.line_connectNull||(i=i.defined(function(e){return null!=e.value}));return function(e){var n,l=r.line_connectNull?o.filterRemoveNull(e.values):e.values,s=t?o.x:o.subX,p=a.call(o,e.id),c=0,u=0;if(o.isLineType(e))if(r.data_regions[e.id])n=o.lineWithRegions(l,s,p,r.data_regions[e.id]);else{o.isStepType(e)&&(l=o.convertValuesToStep(l));n=i.interpolate("linear")(l)}else{if(l[0]){c=s(l[0].x);u=p(l[0].value)}n=r.axis_rotated?"M "+u+" "+c:"M "+c+" "+u}return n||"M 0 0"}};window.c3.chart.internal.fn.generateDrawArea=function(e,t){var o=this,r=o.config,i=o.d3.svg.area(),n=o.generateGetAreaPoints(e,t),a=t?o.getSubYScale:o.getYScale,l=function(e){return(t?o.subxx:o.xx).call(o,e)},s=function(e,t){return r.data_groups.length>0?n(e,t)[0][1]:a.call(o,e.id)(0)},p=function(e,t){return r.data_groups.length>0?n(e,t)[1][1]:a.call(o,e.id)(e.value)};i=r.axis_rotated?i.x0(s).x1(p).y(l):i.x(l).y0(s).y1(p);r.line_connectNull||(i=i.defined(function(e){return null!==e.value}));return function(e){var t,n=r.line_connectNull?o.filterRemoveNull(e.values):e.values,a=0,l=0;if(o.isAreaType(e)){o.isStepType(e)&&(n=o.convertValuesToStep(n));t=i.interpolate("linear")(n)}else{if(n[0]){a=o.x(n[0].x);l=o.getYScale(e.id)(n[0].value)}t=r.axis_rotated?"M "+l+" "+a:"M "+a+" "+l}return t||"M 0 0"}};c3._isOverriden=!0}self.chart.chart=c3.generate(chartOptions)}})})};ctlProto.openTable=function(){var e=this;if(o=arguments[0]){var t;o.css&&(t=o.css);var o,r=o.callback,i=o.columns;if((o=o.data)&&o.length>0){if(!i){i=[];for(var n in o[0])i.push(n)}e.tableData={columns:i,results:o,css:t,callback:r};e.getRenderedHtml(e.CLASS+"-table",e.tableData).then(function(t){var o=e._$div.find("."+e.CLASS+"-table"),r=o.parent();o.detach();o.append(t);r.append(o);e.tableData.callback&&e.tableData.callback(o)});e._$div.find("."+e.CLASS+"-chart").hide();e._$div.find(".prsidebar-body").fadeIn("slide")}}e.map.getLoadingIndicator().hide()};ctlProto.open=function(e){var t=this._$div.find("."+this.CLASS+"-table");this.requestIsRendered=window.requestAnimationFrame(function(){var e=t[0].getBoundingClientRect();if(e&&e.width>100){window.cancelAnimationFrame(this.requestIsRendered);this.map.$events.trigger($.Event(TC.Consts.event.DRAWTABLE),{})}}.bind(this));if(e){this._$div.find("."+this.CLASS+"-table").html(e);this._$div.find("."+this.CLASS+"-table").show()}this._$div.find("."+this.CLASS+"-chart").hide();if(this.options.titles){if(this.options.titles.main){this._$div.find(".prpanel-title-text").attr("title",this.options.titles.main);this._$div.find(".prpanel-title-text").html(this.options.titles.main)}this.options.titles.max&&this._$div.find(".prcollapsed-max").attr("title",this.options.titles.max)}1==this._$div.find(this.content.collapsedClass+":visible").length&&this.maximize();this._$div.find(".prsidebar-body").fadeIn("slide");this.map.getLoadingIndicator().hide()};ctlProto.createChartOptions=function(e){const t=this;var o={};const r=(e=e||{}).locale||TC.Util.getMapLocale(t.map);e.chartType;if(null!=e.ele){const a=function(){const o=document.documentElement.clientWidth/100*40;return{height:o>445?e.maxHeight||t.CHART_SIZE.MAX_HEIGHT:e.minHeight||t.CHART_SIZE.MIN_HEIGHT,width:o>445?e.maxWidth||t.CHART_SIZE.MAX_WIDTH:o>310?e.mediumWidth||t.CHART_SIZE.MEDIUM_WIDTH:e.minWidth||t.CHART_SIZE.MIN_WIDTH}};var i=Number.NEGATIVE_INFINITY,n=Number.POSITIVE_INFINITY;e.ele.forEach(function(e){if("number"==typeof e){i=Math.max(e,i);n=Math.min(e,n)}});const l="grad"+TC.getUID();o={data:{x:"x",columns:[["x"].concat(e.x),["ele"].concat(e.ele)],types:{ele:"area-spline"},colors:{ele:"url(#"+l+")"}},size:a(),point:{show:!1},axis:{x:{tick:{outer:!1,count:5,format:function(e){var t,o;if((e/=1e3)<1){t=Math.round(1e3*e);o=" m"}else{t=Math.round(100*e)/100;o=" km"}return(t=t.toLocaleString(r))+o}}},y:{padding:{top:0,bottom:0},max:i,min:n,tick:{count:2,format:function(e){return(parseInt(e.toFixed(0))||0).toLocaleString(r)+"m"}}}},onresize:function(){this.api.resize(a())}};e.time&&(o.time=("00000"+e.time.h).slice(-2)+":"+("00000"+e.time.m).slice(-2)+":"+("00000"+e.time.s).slice(-2));o._onrendered=function(){const e=this.svg[0][0];var o=e.getElementsByTagName("defs")[0],r="http://www.w3.org/2000/svg",i=document.createElementNS(r,"linearGradient");i.setAttributeNS(null,"id",l);i.setAttributeNS(null,"x1","0%");i.setAttributeNS(null,"x2","0%");i.setAttributeNS(null,"y1","0%");i.setAttributeNS(null,"y2","100%");i.setAttributeNS(null,"gradientUnits","userSpaceOnUse");const n=document.createElementNS(r,"stop");n.setAttributeNS(null,"offset","0%");n.setAttributeNS(null,"stop-color","red");n.setAttributeNS(null,"stop-opacity","0.7");i.appendChild(n);const a=document.createElementNS(r,"stop");a.setAttributeNS(null,"offset","50%");a.setAttributeNS(null,"stop-color","orange");a.setAttributeNS(null,"stop-opacity","0.9");i.appendChild(a);const s=document.createElementNS(r,"stop");s.setAttributeNS(null,"offset","100%");s.setAttributeNS(null,"stop-color","green");s.setAttributeNS(null,"stop-opacity","1");i.appendChild(s);o.appendChild(i);$(d3.select(".c3-brush").node()).remove();d3.select(".c3-event-rects,.c3-event-rects-single").selectAll("rect").style("cursor","pointer").on("click",function(e){d3.event.stopPropagation();const o=t.elevationProfileCoordinates[e.index].slice(0,2);o&&TC.loadJS(!TC.feature||TC.feature&&!TC.feature.Point,[TC.apiLocation+"TC/feature/Point"],function(){t.map.zoomToFeatures([new TC.feature.Point(o)])})});var p=d3.select(".c3-axis.c3-axis-x").select("path").attr("d");if(/^M\d\,(\d)V\dH\d{3}V(\d)$/i.exec(p)){p=p.replace(/(M\d\,)\d/i,"$10").replace(/(H\d{3}V)(\d)/i,"$10");d3.select(".c3-axis.c3-axis-x").select("path").attr("d",p)}else{if(/^M\s\d\s(\d)\sV\s\d\sH\s\d{3}\sV\s(\d)$/i.exec(p)){p=p.replace(/(M\s\d\s)\d/i,"$10").replace(/(H\s\d{3}\sV\s)(\d)/i,"$10");d3.select(".c3-axis.c3-axis-x").select("path").attr("d",p)}}const c=$(e),u={width:c.width(),height:c.height()};var g=function(){var e=d3.scale.ordinal().rangeRoundBands([0,u.width],.1,.3);d3.select(".c3-axis-x").selectAll("text:not(.c3-axis-x-label)").call(function(e,t){e.each(function(){e.each(function(e,t){if(0!=t){d3text=d3.select(this);if(!d3text.attr("edited")){d3text.attr("edited",!0);var o=d3text.select("tspan").node().cloneNode(),r=d3text.text().split(" ");d3text.select("tspan").text(r[0]);o.textContent=r[1];var i=o.getAttribute("dy");i=(i=i?parseFloat(o.getAttribute("dy")):.71)+.18+"em";o.setAttribute("dy",i);d3text.node().appendChild(o)}}})})},e.rangeBand())};if(d3.select(".c3-axis-x").node().getBoundingClientRect().width)(d3.select(".c3-axis-x").node().getBoundingClientRect().width>=u.width-d3.select(".c3-axis-y").node().getBoundingClientRect().width||100*d3.select(".c3-axis-x").node().getBoundingClientRect().width/(u.width-d3.select(".c3-axis-y").node().getBoundingClientRect().width)>90)&&g();else{if(t.elevationChartLabelsRAF){window.cancelAnimationFrame(t.elevationChartLabelsRAF);t.elevationChartLabelsRAF=void 0}t.elevationChartLabelsRAF=requestAnimationFrame(function e(){if(d3.select(".c3-axis-x").length&&!d3.select(".c3-axis-x").node())t.elevationChartLabelsRAF=requestAnimationFrame(e);else if(d3.select(".c3-axis-x").length&&d3.select(".c3-axis-x").node()&&!d3.select(".c3-axis-x").node().getBoundingClientRect().width)t.elevationChartLabelsRAF=requestAnimationFrame(e);else{window.cancelAnimationFrame(t.elevationChartLabelsRAF);t.elevationChartLabelsRAF=void 0;(d3.select(".c3-axis-x").node().getBoundingClientRect().width>=u.width-d3.select(".c3-axis-y").node().getBoundingClientRect().width||100*d3.select(".c3-axis-x").node().getBoundingClientRect().width/(u.width-d3.select(".c3-axis-y").node().getBoundingClientRect().width)>90)&&g()}})}t.isMinimized()||t._$div.find(".prsidebar-body").fadeIn("slide");t._$div.find("."+t.CLASS+"-table").hide()}}else o={msg:t.getLocaleString("geo.trk.chart.chpe.empty")};return o};const getTime=function(e,t){var o=t-e,r={},i=Math.floor(o/1e3/60/60/24);o-=1e3*i*60*60*24;var n=Math.floor(o/1e3/60/60);o-=1e3*n*60*60;r.h=n+24*i;var a=Math.floor(o/1e3/60);o-=1e3*a*60;r.m=a;r.s=Math.floor(o/1e3);return $.extend({},r,{toString:("00000"+r.h).slice(-2)+":"+("00000"+r.m).slice(-2)+":"+("00000"+r.s).slice(-2)})};ctlProto.getElevationChartTooltip=function(e){const t=this.elevationProfileCoordinates;var o=e[0].x;o/=1e3;const r=t[e[0].index];var i;4==t[0].length&&t[0][3]>0&&(i=getTime(t[0][3],r[3]));const n=this.map.options.locale&&this.map.options.locale.replace("_","-")||void 0,a=parseInt(e[0].value.toFixed(0)).toLocaleString(n);var l,s;if(o<1){l=Math.round(1e3*o);s=" m"}else{l=Math.round(100*o)/100;s=" km"}return'<div class="track-elevation-tooltip"><div><span>'+a+" m </span><br><span>"+(l=l.toLocaleString(n))+s+" </span></div>"+(i?"<span>"+i.toString+"</span><div/>":"")};ctlProto.register=function(e){var t=this;TC.Control.prototype.register.call(t,e);t.wrap.register(e);t.openOn&&t.map.$events.one(t.openOn,function(e,o){t.content.fnOpen.call(t,o.data)});t.closeOn&&t.map.$events.one(t.closeOn,function(e,o){t.close()});t.options.openOn&&t.map.$events.on(t.options.openOn,function(e,o){t.content.fnOpen.call(t,o.data)});t.options.closeOn&&t.map.$events.on(t.options.closeOn,function(e,o){t.close()})};ctlProto.exportToExcel=function(){var e=this,t=[e.tableData.columns];$.each(e.tableData.results,function(e,o){var r=[];for(var i in o)o.hasOwnProperty(i)&&"Id"!==i&&"Geom"!==i&&r.push(o[i]);t.push(r)});var o=function(o){var r=e.save.fileName?e.save.fileName:"resultados.xls",i=e.options.titles&&e.options.titles.main?e.options.titles.main:null;o.Save(r,t,i)};TC.Util.ExcelExport?o(new TC.Util.ExcelExport):TC.loadJS(!0,TC.apiLocation+"TC/TC.Util.ExcelExport",function(){o(new TC.Util.ExcelExport)})}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.control.ScaleBar=function(){TC.Control.apply(this,arguments)};TC.inherit(TC.control.ScaleBar,TC.Control);!function(){var e=TC.control.ScaleBar.prototype;e.CLASS="tc-ctl-sb";e.render=function(){this.wrap||(this.wrap=new TC.wrap.control.ScaleBar(this));this.wrap.render()};e.register=function(e){TC.Control.prototype.register.call(this,e);e.wrap.getMap().addControl(this.wrap.ctl)};e.getText=function(){return this.wrap.getText()}}();TC.control=TC.control||{};TC.control.Scale||TC.syncLoadJS(TC.apiLocation+"TC/control/Scale");TC.control.ScaleSelector=function(){TC.control.Scale.apply(this,arguments);this.scales=null};TC.inherit(TC.control.ScaleSelector,TC.control.Scale);!function(){var e=TC.control.ScaleSelector.prototype;e.CLASS="tc-ctl-ss";TC.isDebug?e.template=TC.apiLocation+"TC/templates/ScaleSelector.html":e.template=function(){dust.register(e.CLASS,t);function t(e,t){return e.w('<div class="ol-scale-line ol-unselectable"><nobr><select>').s(t.get(["scales"],!1),t,{block:o},{}).w('</select> <input type="button" value="').f(t.get(["screenSize"],!1),t,"h").w("''\" title=\"").h("i18n",t,{},{$key:"estimatedMapSize"}).w('" /></nobr></div>')}t.__dustBody=!0;function o(e,t){return e.w('<option value="').f(t.getPath(!0,[]),t,"h").w('"').h("eq",t,{block:r},{key:i,value:n}).w(">1:").h("math",t,{},{key:a,method:"round"}).w("</option>\n")}o.__dustBody=!0;function r(e,t){return e.w(' selected="true"')}r.__dustBody=!0;function i(e,t){return e.f(t.getPath(!0,[]),t,"h")}i.__dustBody=!0;function n(e,t){return e.f(t.get(["scale"],!1),t,"h")}n.__dustBody=!0;function a(e,t){return e.f(t.getPath(!0,[]),t,"h")}a.__dustBody=!0;return t};e.render=function(e){var t=this;if(t.map){!t.scales&&t.map.options.resolutions&&(t.scales=t.map.options.resolutions.map(t.getScale,t));var o=function(){t.scales=t.map.wrap.getResolutions().map(t.getScale,t);$("input[type=button]",t._$div).off();$("select",t._$div).off();t.renderData({scale:t.getScale(),screenSize:TC.Cfg.screenSize,scales:t.scales},function(){t._$div.find("option").each(function(e,o){$elm=$(o);$elm.text("1:"+t.format($elm.text().substr(2)))});t._$div.find('input[type="button"]').on(TC.Consts.event.CLICK,function(){t.setScreenSize.call(t)});$("select",t._$div).on("change",function(){t.setScale($(this).val())});$.isFunction(e)&&e()})};t.scales?o():$.when(t.map.wrap.getMap()).then(o)}};e.setScale=function(e){var t=.0254*e/this.getDpi(TC.Cfg.screenSize);window.devicePixelRatio&&(t/=window.devicePixelRatio);this.metersPerDegree&&(t/=this.metersPerDegree);this.map.wrap.setResolution(t);return t}}();!function(){if(window.performance){if(window.performance&&!window.performance.now){window.performance.offset=Date.now();window.performance.now=function(){return Date.now()-window.performance.offset}}}else window.performance={offset:Date.now(),now:function(){return Date.now()-this.offset}}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");var SearchType=function(e,t,o){var r=this;r.parent=o;r._featureTypes=[];$.extend(r,t);r.typeName=e;r._throwConfigError=function(){throw new Error("Error en la configuraci\xf3n de la b\xfasqueda: "+this.typeName)};r.getFeatureTypes=function(e){if(e)return this.featureType instanceof Array?this.featureType:[this.featureType];if(0===this._featureTypes.length){var t=this.featureType instanceof Array?this.featureType:[this.featureType],o=this.renderFeatureType?this.renderFeatureType instanceof Array?this.renderFeatureType:[this.renderFeatureType]:[];this._featureTypes=t.concat(o)}return this._featureTypes};r.isFeatureOfThisType=function(e){return this.getFeatureTypes().indexOf(e)>-1};r.getStyleByFeatureType=function(e){return this.getFeatureTypes().indexOf(e)>-1?this.styles[this.getFeatureTypes().indexOf(e)]:null};var i=function(e,t,o){var r=function(e,t,o){if(t){if(e.hasOwnProperty(t)&&e[t].hasOwnProperty(o))return e[t][o]}else for(var t in e)if(e[t].hasOwnProperty(o))return e[t][o]};if(o){return r(this.getStyleByFeatureType(o),t,e)}for(var i=0;i<this.styles.length;i++){var n=r(this.styles[i],t,e);if(n)return n}};r.getSuggestionListHead=function(){var e,t,o,r=this;if("function"==typeof r.suggestionListHead){e=r.suggestionListHead();t=e.label;o=[{color:e.color,title:e.label}]}else{e=r.suggestionListHead;t=r.parent.getLocaleString(e.label);if("string"==typeof e.color)o=[{color:i.call(r,e.color),title:t}];else if(e.color instanceof Array){var n=r.getFeatureTypes();e.color.length===n.length?o=e.color.map(function(e,o){return{color:i.call(r,e[n[o]].color.css,e[n[o]].color.geomType,n[o]),title:r.parent.getLocaleString(e[n[o]].title)||t}}):r._throwConfigError()}else"object"==typeof e.color&&(o=[{color:i.call(r,e.color.css,e.color.geomType),title:t}])}if(t&&o){var a='<li header><span class="header">'+t+"</span>";return a+=o.map(function(e){if(e.color)return'<span class="header-color" title="'+e.title+'" style="color: '+e.color+';"></span>'}).join("")+"</li>"}r._throwConfigError()};r.getSuggestionListElements=function(e){var t=this,o=[],r=function(e,t){switch(!0){case"number"==typeof e:if(e===t)return!0;break;case"string"==typeof e:if(isNaN(e)&&isNaN(t)){if(e.trim()===t.trim())return!0}else if(e===t)return!0}return!1},i=function(e){for(var t=[],o=0;o<e.length;o++)-1==jQuery.inArray(e[o],t)&&t.push(e[o]);return t};t.parseFeatures(e).forEach(function(e){var n=[],a=[],l="",s=t.outputProperties,p=t.dataIdProperty,c=t.outputFormatLabel,u=e.id.split(".").slice(0,1).shift();if(!(t.outputProperties instanceof Array)){s=t.outputProperties[u];p=t.dataIdProperty[u];c=c[u]}for(var g=0;g<s.length;g++)n.push(e.data[s[g]]);for(g=0;g<p.length;g++)a.push(e.data[p[g]]);for(var d={},h=0;h<t.outputProperties.length;h++)d[t.outputProperties[h]]=n[h];n instanceof Array&&c&&i(n).length>1?l=c.tcFormat(n):n instanceof Array&&1==i(n).length&&(l=n[0]);var f=l.toCamelCase();(function(e){for(var t=0;t<o.length;t++){var i=0,n=[];for(var a in e){n.push(r(e[a],o[t].properties[a]));i++}if(n.filter(function(e){return e}).length===i)return!0}return!1})(d)||o.push({text:f,label:f,id:a.join("#"),dataRole:t.typeName,dataLayer:u,properties:d})});return o};r.parseFeatures=function(e){return(r.outputFormat===TC.Consts.format.JSON?new TC.wrap.parser.JSON:new TC.wrap.parser.WFS({featureNS:r.featurePrefix,featureType:r.featureType})).read(e)};r.getPattern=function(){return"function"==typeof this.pattern?this.pattern():this.pattern};r.filter=function(e){const t=function(t,o){var r=[];if(o!=e.parent.rootCfg.active.root)if(-1!==o.indexOf("#")||e.parent.rootCfg.active.limit)for(var i=o.split("#"),n=0;n<e.parent.rootCfg.active.dataIdProperty.length;n++){0==n&&e.parent.rootCfg.active.dataIdProperty.length>1&&r.push("<ogc:And>");r.push(e.filter.getFilterNode(e.parent.rootCfg.active.dataIdProperty[n],i.length>n?i[n]:i[0]));n==e.parent.rootCfg.active.dataIdProperty.length-1&&e.parent.rootCfg.active.dataIdProperty.length>1&&r.push("</ogc:And>")}else{var a=e.parent.rootCfg.active.queryProperties.firstQueryWord.map(function(t,r){return e.filter.getFilterNode(t,e.parent._LIKE_PATTERN+o+e.parent._LIKE_PATTERN)});if(a.length>1){r.push("<ogc:And>");(r=r.concat(a)).push("</ogc:And>")}else r=r.concat(a)}else{for(var l=0;l<e.parent.rootCfg.active.root.length;l++){i=e.parent.rootCfg.active.root[l];0==l&&e.parent.rootCfg.active.root.length>1&&r.push("<ogc:Or>");for(n=0;n<e.parent.rootCfg.active.dataIdProperty.length;n++){0==n&&e.parent.rootCfg.active.dataIdProperty.length>1&&r.push("<ogc:And>");r.push(e.filter.getFilterNode(e.parent.rootCfg.active.dataIdProperty[n],i.length>n?i[n]:i[0]));n==e.parent.rootCfg.active.dataIdProperty.length-1&&e.parent.rootCfg.active.dataIdProperty.length>1&&r.push("</ogc:And>")}}e.parent.rootCfg.active.root.length>1&&r.push("</ogc:Or>")}return t.concat(r)};return{getPropertyValue:function(t,o){return e.getSearchTypeByRole(t)[o]},getIsLikeNode:function(t,o){var r=/([\-\"\.\xba\(\)\/])/g;r.test(o)&&(o=o.replace(r,"\\$1"));return o.toString().indexOf(e.parent._LIKE_PATTERN)>-1?'<Or><PropertyIsLike escape="\\" singleChar="_" wildCard="*" matchCase="false"><PropertyName>'+t+"</PropertyName><Literal>"+o.toLowerCase().replace(/\</gi,"&lt;").replace(/\>/gi,"&gt;")+'</Literal></PropertyIsLike><PropertyIsLike escape="\\" singleChar="_" wildCard="*" matchCase="false"><PropertyName>'+t+"</PropertyName><Literal>"+o.toUpperCase().replace(/\</gi,"&lt;").replace(/\>/gi,"&gt;")+"</Literal></PropertyIsLike></Or>":"<PropertyIsEqualTo><PropertyName>"+t+"</PropertyName><Literal>"+o.replace(/\</gi,"&lt;").replace(/\>/gi,"&gt;")+"</Literal></PropertyIsEqualTo>"},getFunctionStrMatches:function(t,o){var r=/([\-\"\xba\(\)\/])/g;r.test(o)&&(o=o.replace(r,"\\$1"));if(o.toString().indexOf(e.parent._LIKE_PATTERN)>-1){var i=o;return'<ogc:PropertyIsEqualTo> <ogc:Function name="strMatches"> <ogc:PropertyName>'+t+"</ogc:PropertyName> <ogc:Literal>(?i)"+(i=(i=(i=(i=(i=i.replace(/a/gi,"[a\xe1\xe0]")).replace(/e/gi,"[e\xe9\xe8]")).replace(/i/gi,"[i\xed\xec]")).replace(/o/gi,"[o\xf3\xf2]")).replace(/u/gi,"[u\xfa\xfc\xf9]")).replace(/\</gi,"&lt;").replace(/\>/gi,"&gt;")+"</ogc:Literal> </ogc:Function> <ogc:Literal>true</ogc:Literal> </ogc:PropertyIsEqualTo>"}return"<PropertyIsEqualTo><PropertyName>"+t+"</PropertyName><Literal>"+o.replace(/\</gi,"&lt;").replace(/\>/gi,"&gt;")+"</Literal></PropertyIsEqualTo>"},getFilterNode:function(t,o){var r,i=e.filter.getIsLikeNode;if(e.filterByMatch){i=e.filter.getFunctionStrMatches;var n=new RegExp("\\"+e.parent._LIKE_PATTERN,"gi");o=o.replace(n,e.parent._MATCH_PATTERN)}if(t instanceof Array||"string"==typeof t){if(t instanceof Array&&t.length>1){r="<ogc:Or>";for(s=0;s<t.length;s++)r+=i($.trim(t[s]),o);return r+"</ogc:Or>"}return i(t instanceof Array&&1===t.length?$.trim(t[0]):$.trim(t),o)}var a=[];for(var l in t)if(t[l]instanceof Array&&t[l].length>1){r="<Or>";for(var s=0;s<t[l].length;s++)r+=i($.trim(t[l][s]),o);r+="</Or>";a.push('(<Filter xmlns="http://www.opengis.net/ogc">'+r+"</Filter>)")}else{var p=t[l];t[l]instanceof Array&&1==t[l].length&&(p=t[l][0]);a.push('(<Filter xmlns="http://www.opengis.net/ogc"><Or>'+i($.trim(p),o)+"</Or></Filter>)")}return a.join("")},getFilter:function(o){var r={multiL:!1,f:""};switch(!0){case e.typeName===TC.Consts.searchType.NUMBER:n=[];if(e.parent.rootCfg.active||!/(\<|\>|\<\>)/gi.exec(o.t)&&!/(\<|\>|\<\>)/gi.exec(o.s)){e.parent.rootCfg.active?n=t(n,o.t):n.push(e.filter.getFilterNode(e.queryProperties.firstQueryWord,e.parent._LIKE_PATTERN+o.t+e.parent._LIKE_PATTERN));n.push(e.filter.getFilterNode(e.queryProperties.secondQueryWord,e.parent._LIKE_PATTERN+o.s+e.parent._LIKE_PATTERN))}else{(i=/(\<|\>|\<\>)/gi.exec(o.t))?n.push(e.filter.getFilterNode(e.queryProperties.firstQueryWord,e.parent._LIKE_PATTERN+o.t.substring(0,o.t.indexOf(i[0])).trim()+e.parent._LIKE_PATTERN)):e.parent.rootCfg.active?n=t(n,o.t):n.push(e.filter.getFilterNode(e.queryProperties.firstQueryWord,e.parent._LIKE_PATTERN+o.t+e.parent._LIKE_PATTERN));(i=/(\<|\>|\<\>)/gi.exec(o.s))?n.push(e.filter.getFilterNode(e.queryProperties.secondQueryWord,e.parent._LIKE_PATTERN+o.s.substring(0,o.s.indexOf(i[0])).trim()+e.parent._LIKE_PATTERN)):n.push(e.filter.getFilterNode(e.queryProperties.secondQueryWord,e.parent._LIKE_PATTERN+o.s+e.parent._LIKE_PATTERN))}n.push(e.filter.getFilterNode(e.queryProperties.thirdQueryWord,o.p+e.parent._LIKE_PATTERN));r.f='<ogc:Filter xmlns:ogc="http://www.opengis.net/ogc"><ogc:And>'+n.join("")+"</ogc:And></ogc:Filter>";break;case e.typeName===TC.Consts.searchType.STREET:n=[];if(e.parent.rootCfg.active||!/(\<|\>|\<\>)/gi.exec(o.t)&&!/(\<|\>|\<\>)/gi.exec(o.s)){e.parent.rootCfg.active?n=t(n,o.t):n.push(e.filter.getFilterNode(e.queryProperties.firstQueryWord,e.parent._LIKE_PATTERN+o.t+e.parent._LIKE_PATTERN));n.push(e.filter.getFilterNode(e.queryProperties.secondQueryWord,e.parent._LIKE_PATTERN+o.s+e.parent._LIKE_PATTERN))}else{var i;(i=/(\<|\>|\<\>)/gi.exec(o.t))?n.push(e.filter.getFilterNode(e.queryProperties.firstQueryWord,e.parent._LIKE_PATTERN+o.t.substring(0,o.t.indexOf(i[0])).trim()+e.parent._LIKE_PATTERN)):e.parent.rootCfg.active?n=t(n,o.t):n.push(e.filter.getFilterNode(e.queryProperties.firstQueryWord,e.parent._LIKE_PATTERN+o.t+e.parent._LIKE_PATTERN));(i=/(\<|\>|\<\>)/gi.exec(o.s))?n.push(e.filter.getFilterNode(e.queryProperties.secondQueryWord,e.parent._LIKE_PATTERN+o.s.substring(0,o.s.indexOf(i[0])).trim()+e.parent._LIKE_PATTERN)):n.push(e.filter.getFilterNode(e.queryProperties.secondQueryWord,e.parent._LIKE_PATTERN+o.s+e.parent._LIKE_PATTERN))}r.f='<ogc:Filter xmlns:ogc="http://www.opengis.net/ogc"><ogc:And>'+n.join("")+"</ogc:And></ogc:Filter>";break;case e.typeName===TC.Consts.searchType.LOCALITY:r.f=e.filter.getFilterNode(e.queryProperties.firstQueryWord,e.parent._LIKE_PATTERN+o.t+e.parent._LIKE_PATTERN);r.multiL=!0;break;case e.queryProperties.hasOwnProperty("secondQueryWord"):var n;(n=[]).push(e.filter.getFilterNode(e.queryProperties.firstQueryWord,e.parent._LIKE_PATTERN+o.t+e.parent._LIKE_PATTERN));n.push(e.filter.getFilterNode(e.queryProperties.secondQueryWord,e.parent._LIKE_PATTERN+o.s+e.parent._LIKE_PATTERN));r.f='<ogc:Filter xmlns:ogc="http://www.opengis.net/ogc"><ogc:And>'+n.join("")+"</ogc:And></ogc:Filter>";break;default:r.f='<ogc:Filter xmlns:ogc="http://www.opengis.net/ogc">'+e.filter.getFilterNode(e.queryProperties.firstQueryWord,e.parent._LIKE_PATTERN+o.t+e.parent._LIKE_PATTERN)+"</ogc:Filter>"}return r},getParams:function(t){var o=e.filter.getFilter(t),r={REQUEST:"GetFeature",SERVICE:"WFS",MAXFEATURES:500,VERSION:e.version,OUTPUTFORMAT:e.outputFormat},i=e.getFeatureTypes(!0);if(i instanceof Array){for(var n=[],a=0;a<i.length;a++)n.push(e.featurePrefix?e.featurePrefix+":"+$.trim(i[a]):$.trim(i[a]));r.TYPENAME=n.join(",")}else r.TYPENAME=e.featurePrefix?e.featurePrefix+":"+$.trim(i):$.trim(i);var l=function(e){if(""!==(e||"")){if(e instanceof Array)return e.join(",");var t=[];if(e instanceof Object)for(var o in e){var r=e[o][0];e[o].length>1&&(r=e[o].join(","));t.push(r)}return t}},s=l(e.outputProperties),p=l(e.dataIdProperty);if(s instanceof Array&&p instanceof Array){r.PROPERTYNAME="";for(a=0;a<s.length;a++)r.PROPERTYNAME+="("+s[a]+","+p[a]+")"}else r.PROPERTYNAME=s+","+p;r.FILTER=o.f;return $.param(r)},getGoToFilter:function(t){var o=[],r=t.split("#"),i=e.dataIdProperty,n=e.getFeatureTypes();if(i&&n)if(t.indexOf("#")>-1&&n instanceof Array&&n.length>1)for(var a=0;a<n.length;a++)for(var l=0;l<i[n[a]].length;l++)o.push({name:i[n[a]][l],value:r[l]});else if(-1==t.indexOf("#")&&n instanceof Array){var s=i;for(a=0;a<n.length;a++)if(!o.hasOwnProperty(n[a])){s instanceof Object&&i.hasOwnProperty(n[a])&&(s=i[n[a]]);for(l=0;l<s.length;l++)l<r.length&&o.push({name:s[l],value:r[l]})}}else{i instanceof Object&&i.hasOwnProperty(n)&&(i=i[n]);for(a=0;a<i.length;a++)o.push({name:i[a],value:r[a]})}return e.filter.transformFilter(o)},transformFilter:function(e){TC.filter||TC.syncLoadJS(TC.apiLocation+"TC/Filter");if(e&&e instanceof Array){var t=e.map(function(e){if(!e.hasOwnProperty("type"))return new TC.filter.equalTo(e.name,e.value);switch(!0){case e.type==TC.Consts.comparison.EQUAL_TO:return new TC.filter.equalTo(e.name,e.value)}});return t.length>1?TC.filter.and.apply(null,t):t[0]}}}}(r)};TC.control.Search=function(){var e=this;TC.Control.apply(e,arguments);e.exportsState=!0;TC.Consts.event.TOOLSCLOSE=TC.Consts.event.TOOLSCLOSE||"toolsclose.tc";e.url="//idena.navarra.es/ogc/wfs";e.version="1.1.0";e.featurePrefix="IDENA";e.layerPromise=$.Deferred();e.options&&e.options.url&&(e.url=e.options.url);e._LIKE_PATTERN="*";e._MATCH_PATTERN=".*";e.UTMX="X";e.UTMY="Y";e.LON="Lon";e.LAT="Lat";e.UTMX_LABEL="X: ";e.UTMY_LABEL="Y: ";e.LON_LABEL="Lon: ";e.LAT_LABEL="Lat: ";e.MUN="Mun";e.POL="Pol";e.PAR="Par";e.MUN_LABEL="Mun: ";e.POL_LABEL="Pol: ";e.PAR_LABEL="Par: ";e.availableSearchTypes={};e.availableSearchTypes[TC.Consts.searchType.CADASTRAL]={suggestionRoot:null,url:e.url||"//idena.navarra.es/ogc/wfs",version:e.version||"1.1.0",outputFormat:TC.Consts.format.JSON,featurePrefix:e.featurePrefix||"IDENA",geometryName:"the_geom",searchWeight:3,featureType:["CATAST_Pol_ParcelaUrba","CATAST_Pol_ParcelaRusti","CATAST_Pol_ParcelaMixta"],municipality:{featureType:"CATAST_Pol_Municipio",labelProperty:"MUNICIPIO",idProperty:"CMUNICIPIO"},queryProperties:{firstQueryWord:"CMUNICIPIO",secondQueryWord:"POLIGONO",thirdQueryWord:"PARCELA"},suggestionListHead:{label:"search.list.cadastral",color:[{CATAST_Pol_ParcelaUrba:{title:"search.list.cadastral.urban",color:{geomType:"polygon",css:"strokeColor"}}},{CATAST_Pol_ParcelaRusti:{title:"search.list.cadastral.rustic",color:{geomType:"polygon",css:"strokeColor"}}},{CATAST_Pol_ParcelaMixta:{title:"search.list.cadastral.mixed",color:{geomType:"polygon",css:"strokeColor"}}}]},styles:[{polygon:{fillColor:"#000000",fillOpacity:.1,strokeColor:"#136278",strokeWidth:2,strokeOpacity:1}},{polygon:{fillColor:"#000000",fillOpacity:.1,strokeColor:"#0c8b3d",strokeWidth:2,strokeOpacity:1}},{polygon:{fillColor:"#000000",fillOpacity:.1,strokeColor:"#e5475f",strokeWidth:2,strokeOpacity:1}}],parser:e.getCadastralRef,goTo:e.goToCadastralRef,goToIdFormat:e.MUN+"{0}"+e.POL+"{1}"+e.PAR+"{2}",idPropertiesIdentifier:"#"};e.availableSearchTypes[TC.Consts.searchType.COORDINATES]={parser:e.getCoordinates,goTo:e.goToCoordinates,searchWeight:4,label:null,suggestionListHead:function(t){return{label:e.availableSearchTypes[TC.Consts.searchType.COORDINATES].label||e.getLocaleString("search.list.coordinates")}}};e.queryProperties={QUERYWORD:"QueryWord",FIRST:"first",SECOND:"second",THIRD:"third"};e.availableSearchTypes[TC.Consts.searchType.MUNICIPALITY]={root:null,limit:!1,url:e.url||"//idena.navarra.es/ogc/wfs",version:e.version||"1.1.0",outputFormat:TC.Consts.format.JSON,url:"//idena.navarra.es/ogc/wfs",featurePrefix:"IDENA",geometryName:"the_geom",featureType:"CATAST_Pol_Municipio",dataIdProperty:["CMUNICIPIO"],queryProperties:{firstQueryWord:["MUNINOAC","MUNICIPIO"]},suggestionListHead:{label:"search.list.municipality",color:"strokeColor"},outputProperties:["MUNICIPIO"],outputFormatLabel:"{0}",searchWeight:1,styles:[{polygon:{fillColor:"#000000",fillOpacity:.1,strokeColor:"#fe06a5",strokeWidth:2,strokeOpacity:1}}],parser:e.getStringPattern.bind(this,[TC.Consts.searchType.MUNICIPALITY]),stringPatternToCheck:e.stringPatternsValidators.s_or_t,goTo:e.goToStringPattern};e.availableSearchTypes[TC.Consts.searchType.COUNCIL]={root:null,limit:!1,url:e.url||"//idena.navarra.es/ogc/wfs",version:e.version||"1.1.0",outputFormat:TC.Consts.format.JSON,featurePrefix:e.featurePrefix||"IDENA",geometryName:"the_geom",featureType:"CATAST_Pol_Concejo",renderFeatureType:"",dataIdProperty:["CMUNICIPIO","CCONCEJO"],queryProperties:{firstQueryWord:["CONCEJO"]},outputProperties:["MUNICIPIO","CONCEJO"],outputFormatLabel:"{1} ({0})",searchWeight:4,parser:e.getStringPattern.bind(this,[TC.Consts.searchType.COUNCIL]),stringPatternToCheck:e.stringPatternsValidators.s_or_t,goTo:e.goToStringPattern,idPropertiesIdentifier:"#",suggestionListHead:{label:"search.list.council",color:"strokeColor"},styles:[{polygon:{fillColor:"#000000",fillOpacity:.1,strokeColor:"#49006a",strokeWidth:2,strokeOpacity:1}}]};e.availableSearchTypes[TC.Consts.searchType.STREET]={root:null,limit:null,url:e.url||"//idena.navarra.es/ogc/wfs",version:e.version||"1.1.0",outputFormat:TC.Consts.format.JSON,featurePrefix:e.featurePrefix||"IDENA",geometryName:"the_geom",renderFeatureType:"CATAST_Txt_Calle",featureType:"CATAST_Lin_CalleEje",dataIdProperty:["CVIA"],searchWeight:5,queryProperties:{firstQueryWord:["ENTINOAC","ENTIDADC"],secondQueryWord:["VIA","VIANOAC"]},suggestionListHead:{label:"search.list.street",color:"strokeColor"},outputProperties:["ENTIDADC","VIA","CVIA","CENTIDADC","CMUNICIPIO"],outputFormatLabel:"{1}, {0}",styles:[{line:{strokeColor:"#CB0000",strokeOpacity:1,strokeWidth:2,strokeLinecap:"round",strokeDashstyle:"solid"}},{point:{label:"VIA",angle:"CADANGLE",fontColor:"#000000",fontSize:10,fontWeight:"bold",labelOutlineColor:"#FFFFFF",labelOutlineWidth:4}}],parser:e.getStringPattern.bind(this,[TC.Consts.searchType.STREET]),goTo:e.goToStringPattern};e.availableSearchTypes[TC.Consts.searchType.NUMBER]={root:null,limit:null,url:e.url||"//idena.navarra.es/ogc/wfs",version:e.version||"1.1.0",outputFormat:TC.Consts.format.JSON,featurePrefix:e.featurePrefix||"IDENA",geometryName:"the_geom",featureType:"CATAST_Txt_Portal",renderFeatureType:"",searchWeight:6,dataIdProperty:["CMUNICIPIO","CENTIDADC","CVIA","PORTAL"],queryProperties:{firstQueryWord:["ENTIDADC","ENTINOAC"],secondQueryWord:["VIA","VIANOAC"],thirdQueryWord:["PORTAL"]},suggestionListHead:{label:"search.list.number",color:"fontColor"},outputProperties:["ENTIDADC","VIA","PORTAL","CVIA","CENTIDADC","CMUNICIPIO"],outputFormatLabel:"{1} {2}, {0}",styles:[{point:{radius:0,label:"PORTAL",angle:"CADANGLE",fontColor:"#CB0000",fontSize:14,labelOutlineColor:"#FFFFFF",labelOutlineWidth:4}}],parser:e.getStringPattern.bind(this,[TC.Consts.searchType.NUMBER]),goTo:e.goToStringPattern};e.availableSearchTypes[TC.Consts.searchType.URBAN]={root:null,limit:!1,url:e.url||"//idena.navarra.es/ogc/wfs",version:e.version||"1.1.0",outputFormat:TC.Consts.format.JSON,featurePrefix:e.featurePrefix||"IDENA",geometryName:"the_geom",featureType:"ESTADI_Pol_EntidadPob",renderFeatureType:"",dataIdProperty:["CMUNICIPIO","CENTIDAD"],idPropertiesIdentifier:"#",queryProperties:{firstQueryWord:["ENTINOAC","ENTIDAD"]},suggestionListHead:{label:"search.list.urban",color:"strokeColor"},outputProperties:["MUNICIPIO","ENTIDAD"],outputFormatLabel:"{1} ({0})",searchWeight:2,styles:[{polygon:{fillColor:"#000000",fillOpacity:.1,strokeColor:"#feba1e",strokeWidth:2,strokeOpacity:1}}],parser:e.getStringPattern.bind(this,[TC.Consts.searchType.URBAN]),stringPatternToCheck:e.stringPatternsValidators.s_or_t,goTo:e.goToStringPattern};e.availableSearchTypes[TC.Consts.searchType.PLACENAME]={root:null,limit:!1,url:e.url||"//idena.navarra.es/ogc/wfs",version:e.version||"1.1.0",outputFormat:TC.Consts.format.JSON,featurePrefix:e.featurePrefix||"IDENA",geometryName:"the_geom",featureType:"TOPONI_Txt_Toponimos",renderFeatureType:"",dataIdProperty:["CTOPONIMO"],idPropertiesIdentifier:"#",queryProperties:{firstQueryWord:["TOPONIMO","TOPONINOAC"]},suggestionListHead:{label:"search.list.placeName",color:"fontColor"},outputProperties:["MUNICIPIO","TOPONIMO","CMUNICIPIO","CTOPONIMO"],outputFormatLabel:"{1} ({0})",searchWeight:7,styles:[{point:{radius:0,label:"CADTEXT",angle:"CADANGLE",fontColor:"#ff5722",fontSize:14,labelOutlineColor:"#FFFFFF",labelOutlineWidth:4}}],parser:e.getStringPattern.bind(this,[TC.Consts.searchType.PLACENAME]),stringPatternToCheck:e.stringPatternsValidators.s_or_t,goTo:e.goToStringPattern};e.availableSearchTypes[TC.Consts.searchType.PLACENAMEMUNICIPALITY]={root:null,limit:!1,url:e.url||"//idena.navarra.es/ogc/wfs",version:e.version||"1.1.0",outputFormat:TC.Consts.format.JSON,featurePrefix:e.featurePrefix||"IDENA",geometryName:"the_geom",featureType:"TOPONI_Txt_Toponimos",renderFeatureType:"",dataIdProperty:["CMUNICIPIO","CTOPONIMO"],idPropertiesIdentifier:"#",queryProperties:{firstQueryWord:["MUNICIPIO","MUNINOAC"],secondQueryWord:["TOPONIMO","TOPONINOAC"]},suggestionListHead:{label:"search.list.placeName",color:"fontColor"},outputProperties:["MUNICIPIO","TOPONIMO","CMUNICIPIO","CTOPONIMO"],outputFormatLabel:"{1} ({0})",searchWeight:8,styles:[{point:{radius:0,label:"CADTEXT",angle:"CADANGLE",fontColor:"#ff5722",fontSize:14,labelOutlineColor:"#FFFFFF",labelOutlineWidth:4}}],parser:e.getStringPattern.bind(this,[TC.Consts.searchType.PLACENAMEMUNICIPALITY]),goTo:e.goToStringPattern};e.availableSearchTypes[TC.Consts.searchType.COMMONWEALTH]={root:null,limit:!1,url:e.url||"//idena.navarra.es/ogc/wfs",version:e.version||"1.1.0",outputFormat:TC.Consts.format.JSON,featurePrefix:e.featurePrefix||"IDENA",geometryName:"the_geom",featureType:["POLUCI_Pol_MancoRSUg"],renderFeatureType:"",dataIdProperty:["CMANCOMUNI"],queryProperties:{firstQueryWord:["MANCOMUNID"]},outputProperties:["MANCOMUNID"],outputFormatLabel:"{0}",searchWeight:9,styles:[{polygon:{fillColor:"#000000",fillOpacity:.1,strokeColor:"#fc4e2a",strokeWidth:2,strokeOpacity:1}}]};e.availableSearchTypes[TC.Consts.searchType.ROAD]={root:null,limit:!1,url:e.url||"//idena.navarra.es/ogc/wfs",version:e.version||"1.1.0",outputFormat:TC.Consts.format.JSON,featurePrefix:e.featurePrefix||"IDENA",geometryName:"the_geom",featureType:"INFRAE_Lin_CtraEje",dataIdProperty:["DCARRETERA"],queryProperties:{firstQueryWord:["DCARRETERA"]},suggestionListHead:{label:"search.list.road",color:"strokeColor"},outputProperties:["DCARRETERA"],outputFormatLabel:e.getLocaleString("search.list.road.shorter")+": {0}",searchWeight:10,styles:[{polygon:{strokeColor:"#00b2fc",strokeOpacity:1,strokeWidth:5},line:{strokeColor:"#00b2fc",strokeOpacity:1,strokeWidth:5,strokeLinecap:"round",strokeDashstyle:"solid"}}],parser:e.getRoad,goTo:e.goToRoad,pattern:function(){return new RegExp("^(?:(?:"+e.getLocaleString("search.list.road")+"|"+e.getLocaleString("search.list.road.shorter")+")\\:?)?\\s*((A?|AP?|N?|R?|E?|[A-Z]{2}?|[A-Z]{1}?)\\s*\\-?\\s*(\\d{1,4})\\s*\\-?\\s*(A?|B?|C?|R?))$","i")}};e.availableSearchTypes[TC.Consts.searchType.ROADPK]={root:null,limit:!1,url:e.url||"//idena.navarra.es/ogc/wfs",version:e.version||"1.1.0",outputFormat:TC.Consts.format.JSON,featurePrefix:e.featurePrefix||"IDENA",geometryName:"the_geom",featureType:"INFRAE_Sym_CtraPK",dataIdProperty:["DCARRETERA","CPK"],queryProperties:{firstQueryWord:["DCARRETERA"],secondQueryWord:["PK"]},suggestionListHead:{label:"search.list.pk.larger",color:"fontColor"},outputProperties:["DCARRETERA","PK"],outputFormatLabel:e.getLocaleString("search.list.road.shorter")+": {0} "+e.getLocaleString("search.list.pk")+": {1}",searchWeight:11,styles:[{point:{label:["DCARRETERA","PK"],fontColor:"#00b2fc",fontSize:14,labelOutlineColor:"#ffffff",labelOutlineWidth:2}}],parser:e.getPK,goTo:e.goToPK,pattern:function(){return new RegExp("^(?:(?:"+e.getLocaleString("search.list.road")+"|"+e.getLocaleString("search.list.road.shorter")+")\\:?)?\\s*((A?|AP?|N?|R?|E?|[A-Z]{2}?|[A-Z]{1}?)\\s*\\-?\\s*(\\d{1,4})\\s*\\-?\\s*(A?|B?|C?|R?))\\s*\\,*\\s*(?:(?:"+e.getLocaleString("search.list.pk")+"\\:?)|(?:P\\:?)|(?:K\\:?)|(?:KM\\:?)|(?:\\s+|\\,+))\\s*(\\d{1,4})$","i")}};e.rootCfg={};e.rootCfg[TC.Consts.searchType.MUNICIPALITY]={root:null,limit:!1,url:e.url||"//idena.navarra.es/ogc/wfs",version:e.version||"1.1.0",outputFormat:TC.Consts.format.JSON,featurePrefix:e.featurePrefix||"IDENA",geometryName:"the_geom",featureType:"CATAST_Pol_Municipio",dataIdProperty:["CMUNICIPIO"],queryProperties:{firstQueryWord:["MUNICIPIO"]},outputProperties:["MUNICIPIO"],outputFormatLabel:"{0}",getRootLabel:function(){var t=new $.Deferred;if(e.rootCfg.active&&!e.rootCfg[TC.Consts.searchType.MUNICIPALITY].rootLabel){var o={SERVICE:"WFS"};o.VERSION=e.rootCfg[TC.Consts.searchType.MUNICIPALITY].version;o.REQUEST="GetFeature";o.TYPENAME=e.rootCfg[TC.Consts.searchType.MUNICIPALITY].featurePrefix+":"+e.rootCfg[TC.Consts.searchType.MUNICIPALITY].featureType;o.OUTPUTFORMAT=e.rootCfg[TC.Consts.searchType.MUNICIPALITY].outputFormat;o.PROPERTYNAME=["CMUNICIPIO"].concat(e.rootCfg[TC.Consts.searchType.MUNICIPALITY].outputProperties).join(",");o.CQL_FILTER=e.rootCfg[TC.Consts.searchType.MUNICIPALITY].root.map(function(e){return["CMUNICIPIO"].map(function(t,o){return t+"="+e[o]}).join(" AND ")});o.CQL_FILTER=o.CQL_FILTER.join(" OR ");$.ajax({url:e.rootCfg[TC.Consts.searchType.MUNICIPALITY].url+"?"+$.param(o),type:"GET"}).done(function(o){if(o.totalFeatures>0){e.rootCfg[TC.Consts.searchType.MUNICIPALITY].rootLabel=o.features.map(function(t){return{id:["CMUNICIPIO"].map(function(e){return t.properties[e]}).join("#"),label:t.properties[e.rootCfg[TC.Consts.searchType.MUNICIPALITY].outputProperties[0]].toLowerCase()}});t.resolve(e.rootCfg[TC.Consts.searchType.MUNICIPALITY].rootLabel)}else{e.rootCfg[TC.Consts.searchType.MUNICIPALITY].rootLabel=[];t.resolve(e.rootCfg[TC.Consts.searchType.MUNICIPALITY].rootLabel)}}).fail(function(){t.resolve([])})}else t.resolve(e.rootCfg[TC.Consts.searchType.MUNICIPALITY].rootLabel);return t}};e.rootCfg[TC.Consts.searchType.LOCALITY]={root:null,limit:!1,url:e.url||"//idena.navarra.es/ogc/wfs",version:e.version||"1.1.0",outputFormat:TC.Consts.format.JSON,featurePrefix:e.featurePrefix||"IDENA",geometryName:"the_geom",featureType:["ESTADI_Pol_EntidadPob"],renderFeatureType:"",dataIdProperty:["CMUNICIPIO","CENTIDADC"],queryProperties:{firstQueryWord:["ENTINOAC"]},outputProperties:["ENTINOAC"],getRootLabel:function(){var t=new $.Deferred;if(e.rootCfg.active&&!e.rootCfg[TC.Consts.searchType.LOCALITY].rootLabel){var o={SERVICE:"WFS"};o.VERSION=e.rootCfg[TC.Consts.searchType.LOCALITY].version;o.REQUEST="GetFeature";o.TYPENAME=e.rootCfg[TC.Consts.searchType.LOCALITY].featurePrefix+":"+e.rootCfg[TC.Consts.searchType.LOCALITY].featureType;o.OUTPUTFORMAT=e.rootCfg[TC.Consts.searchType.LOCALITY].outputFormat;o.PROPERTYNAME=["CMUNICIPIO","CENTIDAD"].concat(e.rootCfg[TC.Consts.searchType.LOCALITY].outputProperties).join(",");o.CQL_FILTER=e.rootCfg[TC.Consts.searchType.LOCALITY].root.map(function(e){return["CMUNICIPIO","CENTIDAD"].map(function(t,o){return t+"="+e[o]}).join(" AND ")});o.CQL_FILTER=o.CQL_FILTER.join(" OR ");$.ajax({url:e.rootCfg[TC.Consts.searchType.LOCALITY].url+"?"+$.param(o),type:"GET"}).done(function(o){if(o.totalFeatures>0){e.rootCfg[TC.Consts.searchType.LOCALITY].rootLabel=o.features.map(function(t){return{id:["CMUNICIPIO","CENTIDAD"].map(function(e){return t.properties[e]}).join("#"),label:t.properties[e.rootCfg[TC.Consts.searchType.LOCALITY].outputProperties[0]].toLowerCase()}});t.resolve(e.rootCfg[TC.Consts.searchType.LOCALITY].rootLabel)}else{e.rootCfg[TC.Consts.searchType.LOCALITY].rootLabel=[];t.resolve(e.rootCfg[TC.Consts.searchType.LOCALITY].rootLabel)}}).fail(function(){t.resolve([])})}else t.resolve(e.rootCfg[TC.Consts.searchType.LOCALITY].rootLabel);return t}};e.allowedSearchTypes=[];if(e.options.allowedSearchTypes)for(var t in e.options.allowedSearchTypes){if(e.availableSearchTypes[t]&&!$.isEmptyObject(e.options.allowedSearchTypes[t])){if(e.availableSearchTypes[t].renderFeatureType&&e.availableSearchTypes[t].renderFeatureType.length>0&&e.options.allowedSearchTypes[t].featureType&&!e.options.allowedSearchTypes[t].renderFeatureType){delete e.availableSearchTypes[t].renderFeatureType;e.availableSearchTypes[t].styles=e.availableSearchTypes[t].styles.slice(0,e.availableSearchTypes[t].styles.length-1)}$.extend(e.availableSearchTypes[t],e.options.allowedSearchTypes[t]);if(e.options.allowedSearchTypes[t].root&&t!=TC.Consts.searchType.MUNICIPALITY&&e.options.allowedSearchTypes[t].rootType==TC.Consts.searchType.MUNICIPALITY||t!=TC.Consts.searchType.LOCALITY&&e.options.allowedSearchTypes[t].rootType==TC.Consts.searchType.LOCALITY){e.rootCfg.active=e.rootCfg[e.options.allowedSearchTypes[t].rootType];e.rootCfg.active.root=e.options.allowedSearchTypes[t].root;e.rootCfg.active.limit=e.options.allowedSearchTypes[t].limit;e.availableSearchTypes[TC.Consts.searchType.STREET].queryProperties.firstQueryWord=e.availableSearchTypes[TC.Consts.searchType.NUMBER].queryProperties.firstQueryWord=e.rootCfg.active.dataIdProperty}}e.options.allowedSearchTypes[t]?e.addAllowedSearchType(t,e.availableSearchTypes[t]?e.availableSearchTypes[t]:e.options.allowedSearchTypes[t],e):delete e.options.allowedSearchTypes[t]}e.rootCfg.active&&e.rootCfg.active.getRootLabel();e.queryableFeatures=e.options.queryableFeatures||!1;e.UTMX_LEN=6;e.UTMY_LEN=7;e.wrap=new TC.wrap.control.Search(e);e.interval=500;e.NORMAL_PATTERNS={ROMAN_NUMBER:/M{0,4}(CM|CD|D?C{0,3})(XC|XL|L?X{0,3})(IX|IV|V?I{0,3}){1,}?\S?\./i,ABSOLUTE_NOT_DOT:/[`~!@#$%^&*_|+\=?;:'"\{\}\[\]\\]/gi,ABSOLUTE:/[`~!@#$%^&*_|+\=?;:'.\{\}\[\]\\]/gi}};TC.inherit(TC.control.Search,TC.Control);!function(){var e=TC.control.Search.prototype;e.CLASS="tc-ctl-search";TC.Consts.event.SEARCHQUERYEMPTY=TC.Consts.event.SEARCHQUERYEMPTY||"searchqueryempty.tc";TC.isDebug?e.template=TC.apiLocation+"TC/templates/Search.html":e.template=function(){dust.register(e.CLASS,t);function t(e,t){return e.w("<h2>").h("i18n",t,{},{$key:"search.1"}).w('</h2><div class="tc-ctl-search-content"><input type="search" class="tc-ctl-search-txt" placeholder="').h("i18n",t,{},{$key:"search.placeholder"}).w('" title="').h("i18n",t,{},{$key:"search.instructions"}).w('" /><a title="').h("i18n",t,{},{$key:"search.instructions"}).w('" class="tc-ctl-btn tc-ctl-search-btn">').h("i18n",t,{},{$key:"search.2"}).w('</a><ul class="tc-ctl-search-list"></ul></div>')}t.__dustBody=!0;return t};e.register=function(e){var t=this;TC.Control.prototype.register.call(t,e);t._search={data:[]};t.layerStyleFN=function(){function e(e){return e.indexOf(".")>-1?e.split(".")[0]:e}function o(o,r,i){var n=t.getSearchTypeByFeature(i);if(n){var a=n.getStyleByFeatureType(e(i));if(a&&a.hasOwnProperty(r))return a[r][o]}return TC.Cfg.styles[r][o]}return function(t,r,i,n){!TC.Feature||n instanceof TC.Feature||this.map.$events.trigger($.Event(TC.Consts.event.FEATURESADD,{layer:this.layer,geom:n.geom}));var a=o(r,t,e(n.id));if(i){if(a instanceof Array){var l=a.map(function(e){return n.getData().hasOwnProperty(e)?n.getData()[e]:""}),s=this.getSearchTypeByFeature(e(n.id));return s?s.outputFormatLabel.tcFormat(l):l.join(" ")}return n.getData().hasOwnProperty(a)?n.getData()[a]:""}return a}}();var o=t.layerStyleFN;e.addLayer({id:t.getUID(),title:"B\xfasquedas",stealth:!0,declutter:!0,type:TC.Consts.layerType.VECTOR,styles:{polygon:{fillColor:o.bind(t,"polygon","fillColor",!1),fillOpacity:o.bind(t,"polygon","fillOpacity",!1),strokeColor:o.bind(t,"polygon","strokeColor",!1),strokeOpacity:o.bind(t,"polygon","strokeOpacity",!1),strokeWidth:o.bind(t,"polygon","strokeWidth",!1)},line:{strokeColor:o.bind(t,"line","strokeColor",!1),strokeOpacity:o.bind(t,"line","strokeOpacity",!1),strokeWidth:o.bind(t,"line","strokeWidth",!1)},marker:{anchor:TC.Defaults.styles.marker.anchor,height:TC.Defaults.styles.marker.height,width:TC.Defaults.styles.marker.width},point:{radius:o.bind(t,"point","radius",!1),height:o.bind(t,"point","height",!1),width:o.bind(t,"point","width",!1),fillColor:o.bind(t,"point","fillColor",!1),fillOpacity:o.bind(t,"point","fillOpacity",!1),strokeColor:o.bind(t,"point","strokeColor",!1),strokeWidth:o.bind(t,"point","strokeWidth",!1),fontSize:o.bind(t,"point","fontSize",!1),fontColor:o.bind(t,"point","fontColor",!1),labelOutlineColor:o.bind(t,"point","labelOutlineColor",!1),labelOutlineWidth:o.bind(t,"point","labelOutlineWidth",!1),label:o.bind(t,"point","label",!0),angle:o.bind(t,"point","angle",!0)}}}).then(function(e){t.layer=e;t.layerPromise.resolve(e)},function(e){t.layerPromise.reject(e)});t.EMPTY_RESULTS_LABEL=t.getLocaleString("noResults");t.EMPTY_RESULTS_TITLE=t.getLocaleString("checkCriterion");t.OUTBBX_LABEL=t.getLocaleString("outsideOfLimits");t.WFS_TYPE_ATTRS=["url","version","geometryName","featurePrefix","featureType","properties","outputFormat"]};e.renderData=function(e,t){var o=this;o._search=o._search||{};var r=function(){o.search(o.$text.val(),function(e){if(1===e.length){o.$text.val(e[0].label);o._goToResult(e[0].id,o.$list.find("li:not([header])").attr("dataRole"));o.$list.hide("fast")}else 0===e.length&&o.$list.hide("fast")})};TC.Control.prototype.renderData.call(o,e,function(){var e=function(){o.$text.val(o.$list[0].label||o.$list.find("li:not([header]) > a > span").text());o.lastPattern=o.$text.val();o._goToResult(o.$list[0].id||unescape(o.$list.find("li:not([header]) > a").attr("href")).substring(1),o.$list.find("li:not([header])").attr("dataRole"));o.$list.hide("fast")};o.$text=o._$div.find("input.tc-ctl-search-txt");o.options&&o.options.placeHolder&&o.$text.attr("placeHolder",o.options.placeHolder.trim());o.$list=o._$div.find(".tc-ctl-search-list");o.$button=o._$div.find(".tc-ctl-search-btn");o.$button.on(TC.Consts.event.CLICK,function(){o.getLayer().then(function(t){o.$list.find("li > a:not(.tc-ctl-search-li-loading,.tc-ctl-search-li-empty)").length>1||(t.features.length>0?t.map.zoomToFeatures(t.features):1===o.$list.find("li > a:not(.tc-ctl-search-li-loading,.tc-ctl-search-li-empty)").length?e():o.$text.trigger("keyup.autocomplete"))})});if(o.options.instructions){o.$text.attr("title",o.options.instructions.trim());o.$button.attr("title",o.options.instructions.trim())}o.$list.on(TC.Consts.event.CLICK,"a.tc-ctl-search-li-empty",function(){o.$list.hide("fast");o.$text.focus()});try{if(o.$text.has($("::-ms-clear"))){o.$text.on("mouseup",function(e){""!==o.$text.val()&&setTimeout(function(){if(""===o.$text.val()){o.$list.hide("fast");r()}},1)})}}catch(e){}o.$text.on("keypress",function(t){if(13==t.which){t.preventDefault();t.stopPropagation();o.lastPattern="";1===o.$list.find("li > a:not(.tc-ctl-search-li-loading,.tc-ctl-search-li-empty)").length?e():r();return!1}}).on("search",function(){if(0===o.$text.val().length){o.$list.hide("fast");r()}}).on("input",function(){if(0===o.$text.val().length){o.$list.hide("fast");r()}}).on("targetCleared.autocomplete",function(){o.$list.hide("fast")}).on("targetUpdated.autocomplete",function(){o.$list.find("li").length>0&&o.$list.show("fast")});o.lastPattern="";o.retryTimeout=null;TC.loadJS(!o.$text.autocomplete,[TC.apiLocation+"lib/jQuery/autocomplete.js"],function(){var e;o.$text=o._$div.find("input.tc-ctl-search-txt");o.$text.autocomplete({link:"#",target:o.$list,minLength:2,ctx:o,source:function(t,r){o.lastpress=performance.now();if(!e){e=requestAnimationFrame(function t(){var i=o.$text.val().trim();if(i.length>0&&(!o.lastPattern||i!=o.lastPattern)&&performance.now()-o.lastpress>o.interval){window.cancelAnimationFrame(e);e=void 0;o.$list.hide("fast");o.lastPattern=i;o.search(i,r)}else e=requestAnimationFrame(t)})}},callback:function(e){var t=$(e.target);$(e.target).is("a")||(t=$(e.target).closest("a"));o.$text.val($(t).find("span[hidden]").text());o.lastPattern=o.$text.val();o._goToResult(unescape($(t).attr("href")).substring(1),$(t).parent().attr("dataRole"));o.$text.autocomplete("clear")},buildHTML:function(e){var t=[],r=[],i=/[^a-zA-Z]/g,n=/[^0-9]/g;function a(e,t){var o=parseInt(e,10),r=parseInt(t,10);if(isNaN(o)&&isNaN(r)){var a=e.replace(i,""),l=t.replace(i,"");if(a===l){var s=parseInt(e.replace(n,""),10),p=parseInt(t.replace(n,""),10);return s===p?0:s>p?1:-1}return a>l?1:-1}return isNaN(o)?1:isNaN(r)?-1:o>r?1:-1}var l=e.results.sort(function(e,t){return this.ctx.getSearchTypeByRole(e.dataRole).searchWeight&&this.ctx.getSearchTypeByRole(t.dataRole).searchWeight?(this.ctx.getSearchTypeByRole(e.dataRole).searchWeight||0)>(this.ctx.getSearchTypeByRole(t.dataRole).searchWeight||0)?1:(this.ctx.getSearchTypeByRole(e.dataRole).searchWeight||0)<(this.ctx.getSearchTypeByRole(t.dataRole).searchWeight||0)?-1:a(e.label,t.label):e.dataRole>t.dataRole?1:e.dataRole<t.dataRole?-1:a(e.label,t.label)}.bind(this));o.rootCfg.active&&(l=l.sort(function(e,t){const o=function(){var o,r,i=this.rootCfg.active.root[0]instanceof Array?this.rootCfg.active.root[0].join("-"):this.rootCfg.active.root[0];if(e.properties&&e.properties.length>0&&t.properties&&t.properties.length>0){o=this.rootCfg.active.dataIdProperty.map(function(t){return e.properties[t].toString()}).join("-");r=this.rootCfg.active.dataIdProperty.map(function(e){return t.properties[e].toString()}).join("-")}else{o=e.id;r=t.id}return o!==i&&r===i?1:o===i&&r!==i?-1:a(e.label,t.label)}.bind(this);return this.getSearchTypeByRole(e.dataRole).searchWeight&&this.getSearchTypeByRole(t.dataRole).searchWeight?(this.getSearchTypeByRole(e.dataRole).searchWeight||0)>(this.getSearchTypeByRole(t.dataRole).searchWeight||0)?1:(this.getSearchTypeByRole(e.dataRole).searchWeight||0)<(this.getSearchTypeByRole(t.dataRole).searchWeight||0)?-1:o():o()}.bind(o)));for(var s=0;s<l.length;s++){var p=l[s];if(-1==r.indexOf(p.dataRole)){var c=this.ctx.getSearchTypeByRole(p.dataRole);t[t.length]=c.getSuggestionListHead();r.push(p.dataRole)}const e=function(){p.label;var e=[],t=this.ctx.lastPattern,r=[],i=",";-1==(t=o.NORMAL_PATTERNS.ROMAN_NUMBER.test(t)?t.replace(o.NORMAL_PATTERNS.ABSOLUTE_NOT_DOT,""):t.replace(o.NORMAL_PATTERNS.ABSOLUTE,"")).indexOf(i)&&(i=" ");r=t.trim().split(i);if(p.label.indexOf(this.ctx.LAT_LABEL)>-1&&p.label.indexOf(this.ctx.LON_LABEL)>-1||p.label.indexOf(this.ctx.UTMX_LABEL)>-1&&p.label.indexOf(this.ctx.UTMY_LABEL)>-1){r=this.ctx.lastPattern.split(" ");for(var n=0;n<r.length;n++)","==r[n].trim().slice(-1)&&(r[n]=r[n].slice(0,-1))}for(var a=0;a<r.length;a++)if(r[a].trim().length>0){e.push("("+r[a].trim().replace(/\(/gi,"").replace(/\)/gi,"")+")");if(c=/((\<)|(\>)|(\<\>))/gi.exec(r[a].trim()))for(var l=r[a].trim().replace(/((\<)|(\>)|(\<\>))/gi,"").split(" "),s=0;s<l.length;s++)l[s].trim().length>0&&e.push("("+l[s].trim().replace(/\(/gi,"\\(").replace(/\)/gi,"\\)")+")")}if(p.dataRole==TC.Consts.searchType.ROAD||p.dataRole==TC.Consts.searchType.ROADPK){var c;if(c=o.getSearchTypeByRole(p.dataRole).getPattern().exec(this.ctx.lastPattern)){e=[];c[2]&&c[3]&&c[4]?e.push("("+c[2]+"-"+c[3]+"-"+c[4]+")"):c[2]&&c[3]?e.push("("+c[2]+"-"+c[3]+")"):c[3]&&c[4]?e.push("("+c[3]+"-"+c[4]+")"):(c[2]||c[3])&&e.push("("+(c[2]||c[3])+")");c[5]&&e.push("(?:"+o.getLocaleString("search.list.pk")+"\\:\\s\\d*)("+c[5]+")\\d*")}else c&&c[5]&&(e=[]).push("(?:"+o.getLocaleString("search.list.pk")+"\\:\\s\\d*)("+c[5]+")\\d*")}var u="("+e.join("|")+")";u=(u=(u=(u=(u=(u=(u=(u=(u=(u=(u=u.replace(/\xe1|\xe0/gi,"a")).replace(/\xe9|\xe8/gi,"e")).replace(/\xed|\xec/gi,"i")).replace(/\xf3|\xf2/gi,"o")).replace(/\xfa|\xf9/gi,"u")).replace(/\xfc/gi,"u")).replace(/a/gi,"[a|\xe1|\xe0]")).replace(/e/gi,"[e|\xe9|\xe8]")).replace(/i/gi,"[i|\xed|\xec]")).replace(/o/gi,"[o|\xf3|\xf2]")).replace(/u/gi,"[u|\xfa|\xfc|\xf9]");var g=new RegExp(u,"gi"),d=p.label;return p.dataRole!==TC.Consts.searchType.ROAD||p.dataRole!==TC.Consts.searchType.ROADPK?d.replace(g,function(){var e=Array.prototype.slice.call(arguments,0);return e[e.length-3]?e[0].replace(e[e.length-3],"<b>"+e[e.length-3]+"</b>"):"<b>"+e[0]+"</b>"}):d.replace(g,"<b>$1</b>")}.bind(this);t[t.length]='<li dataRole="'+p.dataRole+'"><a href="#'+encodeURIComponent(p.id)+'"><span hidden>'+p.label+"</span>"+e()+"</a></li>"}return t.join("")}});o.$text.add(o.$list).on("keydown",function(e){if(!e.ctrlKey&&!e.altKey&&!e.shiftKey)if(40===e.keyCode){o.$text[0]==document.activeElement?o.$list.find("li:not([header]):first a").focus():o.$list.find("li:not([header]):last a").is(":focus")?o.$text.focus():o.$list.find("li:not([header])").find("a:focus").parent("li:not([header])").nextAll("li:not([header]):first").find("a").focus();e.preventDefault();e.stopPropagation()}else if(38===e.keyCode){o.$text[0]==document.activeElement?o.$list.find("li:not([header]):last a").focus():document.activeElement==o.$list.find("li:not([header]):first a").get(0)?o.$list.find("li:not([header]):last a").focus():o.$list.find("li:not([header])").find("a:focus").parent("li:not([header])").prevAll("li:not([header]):first").find("a").focus();e.preventDefault();e.stopPropagation()}e.stopPropagation()})})});$.isFunction(t)&&t()};e.addAllowedSearchType=function(e,t){this.allowedSearchTypes.push(new SearchType(e,t,this))};e.getSearchTypeByRole=function(e){return this.allowedSearchTypes.filter(function(t){return t.typeName==e})[0]};e.getSearchTypeByFeature=function(e){var t=this.allowedSearchTypes.filter(function(t){return t.isFeatureOfThisType(e)});return t.length>0?t[0]:null};e.getElementOnSuggestionList=function(e,t){const o=this;for(var r=0;r<o.parent._search.data.length;r++)if(o.parent._search.data[r].id==e&&(!t||t&&o.parent._search.data[r].dataRole===t))return o.parent._search.data[r]};e.getLayer=function(){return this.layerPromise};e.getFeatures=function(){return this.layer.features};e.cleanMap=function(){var e=this;e.getLayer().then(function(t){var o=t.features;t.clearFeatures();e.map.$events.trigger($.Event(TC.Consts.event.FEATUREREMOVE,{layer:t,feature:o}));for(var r=0;r<e.WFS_TYPE_ATTRS.length;r++)t.hasOwnProperty(e.WFS_TYPE_ATTRS[r])&&delete t[e.WFS_TYPE_ATTRS[r]]})};e.getMunicipalities=function(){var e=this;TC.cache.search=TC.cache.search||{};if(!TC.cache.search.municipalities&&!e._municipalitiesDeferred){e._municipalitiesDeferred=new $.Deferred;var t=e.getSearchTypeByRole(TC.Consts.searchType.CADASTRAL);if(!(t.municipality&&t.municipality.featureType&&t.municipality.labelProperty&&t.municipality.idProperty))throw new Error("Error en la configuraci\xf3n de la b\xfasqueda: "+t.typeName+". Error en el objeto municipality");var o={REQUEST:"GetFeature",SERVICE:"WFS",TYPENAME:t.municipality.featureType,VERSION:t.version,PROPERTYNAME:t.municipality.labelProperty+","+t.municipality.idProperty,OUTPUTFORMAT:t.outputFormat};t.featurePrefix&&(o.TYPENAME=t.featurePrefix+":"+o.TYPENAME);var r=t.url+"?"+$.param(o);$.ajax({url:r,type:"GET",dataType:"text"}).done(function(o){var r=(t.outputFormat===TC.Consts.format.JSON?new TC.wrap.parser.JSON:new TC.wrap.parser.WFS({featureNS:t.municipality.featurePrefix,featureType:t.municipality.featureType})).read(o);TC.cache.search.municipalities=[];for(var i=0;i<r.length;i++){var n=r[i];TC.cache.search.municipalities.push({label:n.data[t.municipality.labelProperty],id:n.data[t.municipality.idProperty]})}TC.cache.search.municipalities.sort(function(e,t){return e.label<t.label?-1:e.label>t.label?1:0});e._municipalitiesDeferred.resolve(TC.cache.search.municipalities)}).fail(function(){e._municipalitiesDeferred.resolve()})}return TC.cache.search.municipalities?e._municipalitiesDeferred.resolve(TC.cache.search.municipalities):e._municipalitiesDeferred.promise()};e.getCoordinates=function(e){var t=new $.Deferred,o=e.match(new RegExp("^"+$.trim(this.UTMX_LABEL.toLowerCase())+"*\\s*([0-9]{"+this.UTMX_LEN+"}(?:[.,]\\d+)?)\\s*\\,?\\s*"+$.trim(this.UTMY_LABEL.toLowerCase())+"*\\s*([0-9]{"+this.UTMY_LEN+"}(?:[.,]\\d+)?)$"));o&&(e=o[1]+" "+o[2]);(o=e.match(new RegExp("^"+$.trim(this.LAT_LABEL.toLowerCase())+"*\\s*([-+]?\\d{1,3}([.,]\\d+)?)\\,?\\s*"+$.trim(this.LON_LABEL.toLowerCase())+"*\\s*([-+]?\\d{1,2}([.,]\\d+)?)$")))&&(e=o[1]+" "+o[3]);if(/\d/.test(e)&&(new RegExp("^([0-9]{"+this.UTMX_LEN+"}(?:[.,]\\d+)?)\\s*\\,?\\s*([0-9]{"+this.UTMY_LEN+"}(?:[.,]\\d+)?)$").test(e)||/^([-+]?\d{1,3}([.,]\d+)?)\,?\s*([-+]?\d{1,2}([.,]\d+)?)$/.test(e))){if((o=/^([-+]?\d{1,3}([.,]\d+)?)\,?\s*([-+]?\d{1,2}([.,]\d+)?)$/.exec(e))&&(o[1].indexOf(",")>-1||o[3].indexOf(",")>-1)){o[1]=o[1].replace(",",".");o[3]=o[3].replace(",",".");e=o[1]+" "+o[3]}if(!o||o&&(o[1].indexOf(",")>-1?o[1].replace(",","."):o[1])<=180&&(o[3].indexOf(",")>-1?o[3].replace(",","."):o[3])<=90){if((o=new RegExp("^([0-9]{"+this.UTMX_LEN+"}(?:[.,]\\d+)?)\\s*\\,?\\s*([0-9]{"+this.UTMY_LEN+"}(?:[.,]\\d+)?)$").exec(e))&&(o[1].indexOf(",")>-1||o[2].indexOf(",")>-1)){o[1]=o[1].replace(",",".");o[2]=o[2].replace(",",".");e=o[1]+" "+o[2]}e=e.replace(this.UTMX_LABEL,"").replace(this.UTMY_LABEL,"").replace(this.LON_LABEL,"").replace(this.LAT_LABEL,"");var r=TC.Util.parseCoords(e);if(r){var i=r[0].value,n=r[1].value,a=r[0].type===TC.Consts.UTM?this.UTMX:this.LAT,l=r[1].type===TC.Consts.UTM?this.UTMY:this.LON,s=a+i+l+n,p=this.getPoint(s);if(p&&!this.insideLimit(p)){i=r[1].value;n=r[0].value;s=(a=r[1].type===TC.Consts.UTM?this.UTMX:this.LAT)+i+(l=r[0].type===TC.Consts.UTM?this.UTMY:this.LON)+n;p=this.getPoint(s)}if(p){this.availableSearchTypes[TC.Consts.searchType.COORDINATES].label=/^X(\d+(?:\.\d+)?)Y(\d+(?:\.\d+)?)$/.test(s)?this.getLocaleString("search.list.coordinates.utm")+this.map.crs:this.getLocaleString("search.list.coordinates.geo");t.resolve([{id:s,label:this.getLabel(s),dataRole:TC.Consts.searchType.COORDINATES}])}else t.resolve([])}else t.resolve([])}else t.resolve([])}else t.resolve([]);return t.promise()};e.getCadastralRef=function(e){var t=this,o=new $.Deferred,r=e.match(new RegExp($.trim(t.MUN_LABEL.toLowerCase())+"?\\s(.*)\\,\\s?"+$.trim(t.POL_LABEL.toLowerCase())+"?\\s(\\d{1,2})\\,\\s?"+$.trim(t.PAR_LABEL.toLowerCase())+"?\\s(\\d{1,4})"));r&&(e=r[1]+", "+r[2]+", "+r[3]);var i=e;!/^(.*)\,(\s*\d{1,2}\s*)\,(\s*\d{1,4}\s*)$/.test(e)&&t.getSearchTypeByRole(TC.Consts.searchType.CADASTRAL).suggestionRoot&&(i=t.getSearchTypeByRole(TC.Consts.searchType.CADASTRAL).suggestionRoot+", "+e);/^(.*)\,(\s*\d{1,2}\s*)\,(\s*\d{1,4}\s*)$/.test(i)&&!new RegExp("^([0-9]{"+t.UTMX_LEN+"})\\s*\\,\\s*([0-9]{"+t.UTMY_LEN+"})$").test(e)?$.when(t.getMunicipalities()).then(function(e){var r=/^(.*)\,(\s*\d{1,2}\s*)\,(\s*\d{1,4}\s*)$/.exec(i);if(r){var n=new RegExp($.trim(r[1]).replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),"i"),a=[];const i=function(e,o,r,i){var n=[];n.push[t.MUN]=e;n.push[t.POL]=r;n.push[t.PAR]=i;return{id:t.MUN+e+t.POL+r+t.PAR+i,label:t.getLabel(t.MUN+o+t.POL+r+t.PAR+i),dataRole:TC.Consts.searchType.CADASTRAL,properties:n}};if((a=$.grep(e,function(e){e=e.label||e.id||e;return n.test(e)||n.test(t.removePunctuation(e))})).length>0)for(var l=0;l<a.length;l++)a[l]=i(a[l].id,a[l].label,$.trim(r[2]),$.trim(r[3]));if(/^[0-9]*$/g.test(r[1])){if(r[1].trim()===t.getSearchTypeByRole(TC.Consts.searchType.CADASTRAL).suggestionRoot){var s=e.filter(function(e){return parseInt(e.id)===parseInt(t.getSearchTypeByRole(TC.Consts.searchType.CADASTRAL).suggestionRoot)})[0];s&&o.resolve([i(s.id,s.label,$.trim(r[2]),$.trim(r[3]))])}a.push(i($.trim(r[1]),$.trim(r[1]),$.trim(r[2]),$.trim(r[3])))}o.resolve(a)}}):o.resolve([]);return o.promise()};e.stringPatternsValidators={tsp:function(e,r,i,n){var a=/^([^0-9\,]+)(?:\s*\,\s*)(?:([^\,][a-z\xf1\xe1\xe9\xed\xf3\xfa\xfc\xe0\xe8\xec\xf2\xf9\s*\-\.\(\)\/0-9]+))(?:\s*\,\s*)(?:(\d{1,3}\s?\-?\s?[a-z]{0,4}\s?\-?\s?[a-z]{0,4})|([a-z]{1,4}\s?\-?\s?\d{1,3})|(sn|S\/N|s\/n|s\-n)|([a-z]{1,4}\s?\+\s?[a-z]{1,4}))$/i.exec(e);if(a&&a[1]&&a[2]){var l=function(){return t((a[3]||a[4]||a[5]||a[6]).trim())};if(/^([^0-9]+)$/i.test(a[1].trim())&&/^([^0-9]+)$/i.test(a[2].trim())){r.push({t:a[1].trim(),s:a[2].trim(),p:l()});r.push({t:a[2].trim(),s:a[1].trim(),p:l()})}else/^([^0-9]+)$/i.test(a[1].trim())?r.push({t:a[1].trim(),s:a[2].trim(),p:l()}):r.push({s:a[1].trim(),t:a[2].trim(),p:l()});o.call(this,r,i,n);return!0}return!1},spt:function(e,r,i,n){var a=/^(?:([^\,][a-z\xf1\xe1\xe9\xed\xf3\xfa\xfc\xe0\xe8\xec\xf2\xf9\s*\-\.\(\)\/0-9]+))(?:\s*\,\s*)(?:(\d{1,3}\s?\-?\s?[a-z]{0,4}\s?\-?\s?[a-z]{0,4})|([a-z]{1,4}\s?\-?\s?\d{1,3})|(sn|S\/N|s\/n|s\-n)|([a-z]{1,4}\s?\+\s?[a-z]{1,4}))(?:\s*\,\s*)([^0-9\,]+)$/i.exec(e);if(a&&a[6]&&a[1]){var l=function(){return t((a[2]||a[3]||a[4]||a[5]).trim())};if(/^([^0-9]+)$/i.test(a[6].trim())&&/^([^0-9]+)$/i.test(a[1].trim())){r.push({t:a[6].trim(),s:a[1].trim(),p:l()});r.push({t:a[1].trim(),s:a[6].trim(),p:l()})}else/^([^0-9]+)$/i.test(a[6].trim())?r.push({t:a[6].trim(),s:a[1].trim(),p:l()}):r.push({s:a[6].trim(),t:a[1].trim(),p:l()});o.call(this,r,i,n);return!0}return!1},tnsp:function(e,r,i,n){var a=/^(?:([^\,][a-z\xf1\xe1\xe9\xed\xf3\xfa\xfc\xe0\xe8\xec\xf2\xf9\s*\-\.\(\)\/0-9]+))(?:\s*\,\s*)([^0-9\,]+)(?:\s*\,\s*)(?:(\d{1,3}\s?\-?\s?[a-z]{0,4}\s?\-?\s?[a-z]{0,4})|([a-z]{1,4}\s?\-?\s?\d{1,3})|(sn|S\/N|s\/n|s\-n)|([a-z]{1,4}\s?\+\s?[a-z]{1,4}))$/i.exec(e);if(a&&a[1]&&a[2]){r.push({t:a[2].trim(),s:a[1].trim(),p:t((a[3]||a[4]||a[5]||a[6]).trim())});o.call(this,r,i,n);return!0}return!1},ts:function(e,t,r,i){var n=/^([^0-9\,]+)(?:\s*\,\s*)(?:([^\,][a-z\xf1\xe1\xe9\xed\xf3\xfa\xfc\xe0\xe8\xec\xf2\xf9"\s*\-\.\(\)\/0-9]+))$/i.exec(e);if(!n&&/^[^0-9]*$/i.test(e.trim())){var a=e.split(",").reverse();n=/^([^0-9\,]+)(?:\s*\,\s*)(?:([^\,][a-z\xf1\xe1\xe9\xed\xf3\xfa\xfc\xe0\xe8\xec\xf2\xf9"\s*\-\.\(\)\/0-9]+))$/i.exec(a.join(","))}if(n&&n[1]&&n[2]){if(/^([^0-9]+)$/i.test(n[1].trim())&&/^([^0-9]+)$/i.test(n[2].trim())){t.push({t:n[1].trim(),s:n[2].trim()});t.push({s:n[1].trim(),t:n[2].trim()});o.call(this,t,r,i)}else{var l=function(e){for(var t=e.split(" ").reverse(),o=[],r=0;r<t.length;r++)if(1==t[r].length){o.push(t[r]);t[r]=""}return o.length>0?t.reverse().join(" ").trim()+self._LIKE_PATTERN+o.reverse().join(self._LIKE_PATTERN):t.reverse().join(" ").trim()};/^([^0-9]+)$/i.test(n[1].trim())?t.push({t:n[1].trim(),s:l(n[2].trim())}):t.push({s:l(n[1].trim()),t:n[2].trim()});o.call(this,t,r,i,!0)}return!0}return!1},st:function(e,r,i,n){var a=/^(?:([^\,][a-z\xf1\xe1\xe9\xed\xf3\xfa\xfc\xe0\xe8\xec\xf2\xf9\s*\-\.\(\)\/0-9]+))(?:\s*\,\s*)([^0-9\,]+)$/i.exec(e);if(!a){var l=e.split(",").reverse();a=/^([^0-9\,]+)(?:\s*\,\s*)(?:([^\,][a-z\xf1\xe1\xe9\xed\xf3\xfa\xfc\xe0\xe8\xec\xf2\xf9"\s*\-\.\(\)\/0-9]+))$/i.exec(l.join(","))}if(a){for(var s={},p=(l=e.split(",").reverse(),0);p<l.length;p++)if(/^([^0-9\,]+)$/i.test(l[p].trim()))s.t=l[p].trim();else if(/(\s*\d+)/i.test(l[p].trim()))if(-1==l[p].trim().indexOf(" "))s.s=l[p].trim();else{for(var c=l[p].trim().split(" ").reverse(),u=function(e){if(/^(?:(\d{1,3}\s?\-?\s?[a-z]{0,4}\s?\-?\s?[a-z]{0,4})|([a-z]{1,4}\s?\-?\s?\d{1,3})|(sn|S\/N|s\/n|s\-n)|([a-z]{1,4}\s?\+\s?[a-z]{1,4}))$/i.exec(e.trim())){s.p=t(e.trim());return!0}return!1},g=0,d=c[g].trim();g<c.length&&!u(d);)++g<c.length&&(d+=c[g]);if(s.p){for(var h=c,f=0;f<h.length;f++){for(var y=!1,m=0;m<h[f].split("").length;m++)s.p.indexOf(h[f][m])>-1&&(y=!0);if(y){h[f];h[f]="";if(s.p==t(d))break}}if(/^([^\,][a-z\xf1\xe1\xe9\xed\xf3\xfa\xfc\xe0\xe8\xec\xf2\xf9\s*\-\.\(\)\/0-9]+)$/i.test(c.reverse().join(" ").trim())){for(var v=[],C=c.reverse(),T=0;T<C.length;T++)if(1==C[T].trim().length){v.push(C[T].trim());C[T]=""}s.s=v.length>0?C.reverse().join(" ").trim()+self._LIKE_PATTERN+v.reverse().join(self._LIKE_PATTERN):C.reverse().join(" ").trim()}r.push({t:s.t,s:s.s+" "+s.p})}else s.s=l[p].trim()}r.push(s);o.call(this,r,i,n);return!0}return!1},s_or_t:function(e,t,o,r){var i=/^([^\,][a-z\xf1\xe1\xe9\xed\xf3\xfa\xfc\xe0\xe8\xec\xf2\xf9\s*\-\.\(\)\/0-9\<\>]+)$/i.exec(e);if(i&&i[1]){if(o){t.push({t:i[1].trim()});t.push({t:o,s:i[1].trim()})}else t.push({t:i[1].trim()});return!0}return!1},sp:function(e,o,r,i){var n=/^([^\,][a-z\xf1\xe1\xe9\xed\xf3\xfa\xfc\xe0\xe8\xec\xf2\xf9\s*\-\.\(\)\/]+)\s*\,?\s*((\d{1,3}\s?\-?\s?[a-z]{0,4}\s?\-?\s?[a-z]{0,4})|([a-z]{1,4}\s?\-?\s?\d{1,3})|(sn|S\/N|s\/n|s\-n)|([a-z]{1,4}\s?\+\s?[a-z]{1,4}))$/i.exec(e);if(n&&n[1]&&n[2]){r?o.push({t:r,s:n[1].trim(),p:t(n[2].trim())}):o.push({t:n[1].trim(),s:n[2].trim()});return!0}return!1},snp:function(e,o,r,i){var n=/^([^\,][0-9\s*\-\.\(\)\/]+)\s*\,?\s*(\d{1,3}\s?\-?\s?[a-z]{0,4}\s?\-?\s?[a-z]{0,4})|([a-z]{1,4}\s?\-?\s?\d{1,3})|(sn|S\/N|s\/n|s\-n)|([a-z]{1,4}\s?\+\s?[a-z]{1,4})$/i.exec(e);if(n&&n[1]&&n[2]&&r){o.push({t:r,s:n[1].trim(),p:t(n[2].trim())});return!0}return!1}};const t=function(e){for(var t=[function(e){return/^(\d{1,3})\s?\-?\s?([a-z]{0,4})\s?\-?\s?([a-z]{0,4})$/i.test(e)},function(e){return/^([a-z]{1,4})\s?\-?\s?(\d{1,3})$/i.test(e)},function(e){return/^(sn|S\/N|s\/n|s\-n)$/i.test(e)},function(e){return/^([a-z]{1,4}\s?\+\s?[a-z]{1,4})$/i.test(e)}],o=[function(e){var t=[],o=/^(\d{1,3})\s?\-?\s?([a-z]{0,4})\s?\-?\s?([a-z]{0,4})$/i.exec(e);if(o){for(var r=1;r<o.length;r++)o[r].trim().length>0&&t.push(o[r].trim());return t.join(self._LIKE_PATTERN)}return e},function(e){var t=[],o=/^([a-z]{1,4})\s?\-?\s?(\d{1,3})$/i.exec(e);if(o){for(var r=1;r<o.length;r++)o[r].trim().length>0&&t.push(o[r].trim());return t.join(self._LIKE_PATTERN)}return e},function(e){return/^(sn|S\/N|s\/n|s\-n)$/i.exec(e)?"s*n":e},function(e){/^([a-z]{1,4}\s?\+\s?[a-z]{1,4})$/i.exec(e);return e}],r=0;r<o.length&&!t[r].call(self,e);)r++;return r<o.length?o[r].call(self,e):e},o=function(e,t,o,r){const i=this;if(t)for(var n=e.length;n--;)if(r)e.push($.extend({},e[n],{t:t}));else if(e[n].t){var a=i.rootCfg.active.rootLabel.filter(function(t){return t.label.indexOf(i.removePunctuation(e[n].t).toLowerCase())>-1}.bind(i));1==a.length?e[n].t=a[0].id:a.length>1?a.map(function(t){var o=$.extend({},e[n]);o.t=t.id;e.push(o)}):0==a.length&&o&&e.splice(n,1)}},r=function(e,t){const o=this,r=o.rootCfg.active&&o.rootCfg.active.root||"",i=o.rootCfg.active&&o.rootCfg.active.limit||!1;var n=[];","==(t=t.trim()).charAt(t.length-1)&&(t=t.substring(0,t.length-1));if(function(){for(var e=[function(e){return e.length>=3},function(e){return!/^\d+$/.test(e)&&!/^\d+\,\s*\d+$/.test(e)}],r=0;r<e.length;r++)if(!e[r].call(o,t))return!1;return!0}()){var a=[];if(0===(a=e.map(function(e){return o.getSearchTypeByRole(e)}).filter(function(e){return e.stringPatternToCheck}).map(function(e){return e.stringPatternToCheck})).length){a=[o.stringPatternsValidators.tsp,o.stringPatternsValidators.spt,o.stringPatternsValidators.tnsp,o.stringPatternsValidators.ts,o.stringPatternsValidators.st];a=r&&t.split(",").length<3?[o.stringPatternsValidators.sp,o.stringPatternsValidators.snp,o.stringPatternsValidators.s_or_t].concat(a):a.concat([o.stringPatternsValidators.sp,o.stringPatternsValidators.snp,o.stringPatternsValidators.s_or_t])}var l=0;try{for(;l<a.length&&!a[l].call(o,t,n,r,i);)l++}catch(e){TC.error("Error seg\xfan el patr\xf3n: "+t,TC.Consts.msgErrorMode.EMAIL,"Error en la b\xfasqueda del callejero")}return n}return null},i=function(e,t,o){const r=this;if(o){var i=[];r._search.data=i;r.request||(r.request=[]);o.forEach(function(t,o){e.filter(function(e){var o=r.getSearchTypeByRole(e);return Object.keys(o.queryProperties).length===Object.keys(t).length}).map(function(e){var o=r.getSearchTypeByRole(e);r.request.push(function(e,t,o){const r=this;return $.ajax({url:e.url,type:"POST",contentType:"application/x-www-form-urlencoded;charset=UTF-8",dataType:"text",data:e.filter.getParams(o),beforeSend:function(){r.$list.html('<li><a class="tc-ctl-search-li-loading" href="#">'+r.getLocaleString("searching")+'<span class="tc-ctl-search-loading-spinner tc-ctl-search-loading"></span></a></li>');r.$text.trigger("targetUpdated.autocomplete")}}).done(t).fail(function(e){"abort"!==e.statusText&&alert("error")})}.call(r,o,function(e){i=i.concat(o.getSuggestionListElements(e))},t))})});$.when.apply($,r.request).then(function(){t.resolve(i)})}else t.resolve([])};e.getStringPattern=function(e,t){var o=new $.Deferred;t=function(e){e=this.removePunctuation(e);return(e=this.NORMAL_PATTERNS.ROMAN_NUMBER.test(e)?e.replace(this.NORMAL_PATTERNS.ABSOLUTE_NOT_DOT,""):e.replace(this.NORMAL_PATTERNS.ABSOLUTE,"")).toLowerCase()}.call(this,t);var n=/(.*)\((.*)\)/.exec(t);if(n&&n.length>2){var a=r.call(this,e,n[1]),l=r.call(this,e,n[1]+","+n[2]);l=(l||[]).concat(a||[]);i.call(this,e,o,l);return o}a=r.call(this,e,t);i.call(this,e,o,a);return o};e.getRoad=function(e){var t=this,o=new $.Deferred;if((e=e.trim()).length<2)o.resolve([]);else{var r=t.getSearchTypeByRole(TC.Consts.searchType.ROAD),i=r.getPattern().exec(e);if(i&&i[3]){var n=i[2]?i[2].trim()+"-"+i[3].trim():i[3].trim();i[4]&&i[4].length>0&&(n=n+"-"+i[4].trim());$.ajax({url:r.url+"?"+r.filter.getParams({t:n}),type:"GET",contentType:"application/x-www-form-urlencoded;charset=UTF-8",beforeSend:function(){t.$list.html('<li><a class="tc-ctl-search-li-loading" href="#">'+t.getLocaleString("searching")+'<span class="tc-ctl-search-loading-spinner tc-ctl-search-loading"></span></a></li>');t.$text.trigger("targetUpdated.autocomplete")}}).done(function(e){var t=[];if(e.totalFeatures>0){e.features.map(function(e){var o=r.outputProperties;if(!t.some(function(t){return t.text==e.properties[o[0]]})){var i=r.outputFormatLabel.tcFormat(r.outputProperties.map(function(t){return e.properties[t]})),n=r.outputProperties.map(function(t){return e.properties[t]}).join("-");t.push({id:r.dataIdProperty.map(function(t){return e.properties[t]}).join("#"),label:i,text:n,dataLayer:e.id.split(".")[0],dataRole:r.typeName})}});o.resolve(t)}else o.resolve([])}).fail(function(e){o.resolve([])})}else o.resolve([])}return o.promise()};e.getPK=function(e){var t=this,o=new $.Deferred;if((e=e.trim()).length<3)o.resolve([]);else{var r=t.getSearchTypeByRole(TC.Consts.searchType.ROADPK),i=r.getPattern().exec(e);if(i&&i[3]&&i[5]){var n=i[2]?i[2].trim()+"-"+i[3].trim():i[3].trim();i[4]&&i[4].length>0&&(n=n+"-"+i[4].trim());$.ajax({url:r.url+"?"+r.filter.getParams({t:n,s:i[5].trim()}),type:"GET",contentType:"application/x-www-form-urlencoded;charset=UTF-8",beforeSend:function(){t.$list.html('<li><a class="tc-ctl-search-li-loading" href="#">'+t.getLocaleString("searching")+'<span class="tc-ctl-search-loading-spinner tc-ctl-search-loading"></span></a></li>');t.$text.trigger("targetUpdated.autocomplete")}}).done(function(e){var t=[];if(e.totalFeatures>0){e.features.map(function(e){var o=r.outputProperties;if(!t.some(function(t){return t.label==e.properties[o[0]]})){var i=r.outputFormatLabel.tcFormat(r.outputProperties.map(function(t){return e.properties[t]}));t.push({id:r.dataIdProperty.map(function(t){return e.properties[t]}).join("#"),label:i,text:i,dataLayer:e.id.split(".")[0],dataRole:r.typeName})}});o.resolve(t)}else o.resolve([])}).fail(function(e){o.resolve([])})}else o.resolve([])}return o.promise()};e.search=function(e,t){var o=this,r=[];if(o.request){for(var i=0;i<o.request.length;i++){console.log("new criteria: search promise/s aborted");o.request[i].abort()}o.request=[]}if((e=$.trim(e)).length>0){e=e.toLowerCase();var n=[];o.allowedSearchTypes.forEach(function(t){t.parser?function(t){var i=new $.Deferred;n.push(i);$.when(t.call(o,e)).then(function(e){r=r.concat(e);i.resolve(r)})}(t.parser):console.log("Falta implementaci\xf3n del m\xe9todo parser")});$.when.apply(o,n).then(function(){r&&(o._search.data=r=r.sort(function(e,t){var o,r=/(\d+)/,i="";if(r.test(e.label)&&r.test(t.label)){o=e.label.match(r)[1];i=t.label.match(r)[1]}else{o=e.label;i=t.label}return o>i?1:o<i?-1:0}.bind(o)));t&&t(r);if(0===r.length){o.cleanMap();if(!o.layer||o.layer&&0===o.layer.features.length){o.$list.html('<li><a title="'+o.EMPTY_RESULTS_TITLE+'" class="tc-ctl-search-li-empty">'+o.EMPTY_RESULTS_LABEL+"</a></li>");o.$text.trigger("targetUpdated.autocomplete")}}o.lastPattern=""})}else o.cleanMap()};var n=function(e){if(e&&e.length>0)for(var t=0;t<e.length;t++)e[t].showsPopup!=this.queryableFeatures&&(e[t].showsPopup=this.queryableFeatures)};e._goToResult=function(e,t){var o=this,r=null;const i=$.Deferred();o.loading||(o.loading=o.map.getControlsByClass("TC.control.LoadingIndicator")[0]);var a;a=o.loading.addWait();if(Modernizr.mq("(max-width: 30em)")){o.$text.blur();o.map.$events.trigger($.Event(TC.Consts.event.TOOLSCLOSE),{})}o.cleanMap();var l=!1,s=!0;o.allowedSearchTypes.forEach(function(i){if(s)if(o.availableSearchTypes[i.typeName]){var n=t||o.getElementOnSuggestionList.call(o,e).dataRole;if(n){var a=o.getSearchTypeByRole(n);if(o.availableSearchTypes[n]&&a&&a.goTo)null!==(r=a.goTo.call(o,e,n))&&(s=!1);else if(!o.availableSearchTypes[n]&&a&&a.goTo){l=!0;null!==(r=a.goTo.call(o,e,n))&&(s=!1)}else console.log("Falta implementaci\xf3n del m\xe9todo goTo")}}else if(i.goTo){l=!0;null!==(r=i.goTo.call(o,e))&&(s=!1)}else console.log("Falta implementaci\xf3n del m\xe9todo goTo")});o.loading.removeWait(a);if(r){o.getLayer().then(function(e){switch(!0){case r.params.type==TC.Consts.layerType.VECTOR:for(var t=0;t<o.WFS_TYPE_ATTRS.length;t++)e.hasOwnProperty(o.WFS_TYPE_ATTRS[t])&&delete e[o.WFS_TYPE_ATTRS[t]];break;case r.params.type==TC.Consts.layerType.WFS:for(t=0;t<o.WFS_TYPE_ATTRS.length;t++)e[o.WFS_TYPE_ATTRS[t]]=r.params[o.WFS_TYPE_ATTRS[t]];a=o.loading.addWait()}e.type=r.params.type;e.refresh().then(function(){o.map.one(TC.Consts.event.LAYERUPDATE,function(t){if(t.layer==e){o.map.one(TC.Consts.event.FEATURESADD,function(t){if(t.layer==e){if(!t.layer.features||0==t.layer.features.length&&t.layer.wrap.layer.getSource().getFeatures()){o.$list.hide("fast");var i=t.layer.wrap.layer.getSource().getExtent(),l=t.layer.map.options.pointBoundsRadius;if(i[2]-i[0]==0){i[0]=i[0]-l;i[2]=i[2]+l}if(i[3]-i[1]==0){i[1]=i[1]-l;i[3]=i[3]+l}t.layer.map.setExtent(i);o.map.$events.trigger($.Event(TC.Consts.event.ZOOMTO,{extent:i,layer:t.layer}))}else if(t.layer.features&&t.layer.features.length>0){o.$list.hide("fast");n.call(o,t.layer.features);o.layer.map.zoomToFeatures(t.layer.features);o.map.$events.trigger($.Event(TC.Consts.event.FEATURESADD,{layer:o.layer,features:o.layer.features}))}else if(t.layer.features&&0==t.layer.features.length&&r.params.type==TC.Consts.layerType.WFS){o.$list.html(r.emptyResultHTML);o.$text.trigger("targetUpdated.autocomplete");o.map.$events.trigger($.Event(TC.Consts.event.SEARCHQUERYEMPTY))}o.loading.removeWait(a)}});if(t.layer.features&&t.layer.features.length>0){o.$list.hide("fast");n.call(o,t.layer.features);o.layer.map.zoomToFeatures(o.layer.features);o.map.$events.trigger($.Event(TC.Consts.event.FEATURESADD,{layer:o.layer,features:o.layer.features}));o.loading.removeWait(a)}else if(t.layer.features&&0==t.layer.features.length&&r.params.type==TC.Consts.layerType.WFS){o.$list.html(r.emptyResultHTML);o.$text.trigger("targetUpdated.autocomplete");t.newData&&t.newData.features&&t.newData.features.length>0||o.map.$events.trigger($.Event(TC.Consts.event.SEARCHQUERYEMPTY));o.loading.removeWait(a)}}})})});i.resolve(r)}else{i.reject();l||o.map.$events.trigger($.Event(TC.Consts.event.SEARCHQUERYEMPTY))}return i.promise()};e.goToResult=function(e,t){if(this.getSearchTypeByRole(t))return this._goToResult(e,t);if(this.availableSearchTypes[t]){this.addAllowedSearchType(t,this.availableSearchTypes[t],this);return this._goToResult(e,t)}alert("No se reconoce el tipo de b\xfasqueda: "+t)};e.goToCoordinates=function(e){var t={};if(/^X(\d+(?:[\.\,]\d+)?)Y(\d+(?:[\.\,]\d+)?)$/.test(e)||/^Lat((?:[+-]?)\d+(?:[.,]\d+)?)Lon((?:[+-]?)\d+(?:[.,]\d+)?)$/.test(e)){t.params={type:TC.Consts.layerType.VECTOR,styles:{marker:{url:this.layerStyleFN.bind(this,"marker","url",!0)}}};t.emptyResultHTML='<li><a class="tc-ctl-search-li-empty">'+this.OUTBBX_LABEL+"</a></li>";(function(e){var t=this;wait=t.loading.addWait();var o,r,i,n=t.getPoint(e);if(n){r=t.getLabel(e);i=t.layer.addMarker(n,$.extend({},t.map.options.styles.point,{title:r,group:r}));o=t.map.options.pointBoundsRadius;t.map.setExtent([n[0]-o,n[1]-o,n[0]+o,n[1]+o])}else{var a=/^Lat((?:[+-]?)\d+(?:\.\d+)?)Lon((?:[+-]?)\d+(?:\.\d+)?)$/.exec(e);e=t.LAT+a[2]+t.LON+a[1];if(n=t.getPoint(e)){r=t.getLabel(e);i=t.layer.addMarker(n,$.extend({},t.map.options.styles.point,{title:r,group:r}));o=t.map.options.pointBoundsRadius;t.map.setExtent([n[0]-o,n[1]-o,n[0]+o,n[1]+o]);t.$text.val(r)}}$.when(i).then(function(e){t.map.$events.trigger($.Event(TC.Consts.event.FEATURESADD,{layer:t.layer,features:[e]}));t.loading.removeWait(wait)})}).call(this,e);return t}return null};e.goToCadastralRef=function(e){var t={},o=new RegExp("^"+this.MUN+"(\\d+)"+this.POL+"(\\d{1,2})"+this.PAR+"{1}(\\d{1,4})");if(o.test(e)){var r=o.exec(e);TC.filter||TC.syncLoadJS(TC.apiLocation+"TC/Filter");var i=this.getSearchTypeByRole(TC.Consts.searchType.CADASTRAL);t.params={type:TC.Consts.layerType.WFS,url:i.url,version:i.version,geometryName:i.geometryName,featurePrefix:i.featurePrefix,featureType:i.featureType,properties:new TC.filter.and(new TC.filter.equalTo(i.queryProperties.firstQueryWord,$.trim(r[1])),new TC.filter.equalTo(i.queryProperties.secondQueryWord,$.trim(r[2])),new TC.filter.equalTo(i.queryProperties.thirdQueryWord,$.trim(r[3]))),outputFormat:i.outputFormat,styles:i.styles};t.emptyResultHTML='<li><a title="'+this.EMPTY_RESULTS_TITLE+'" class="tc-ctl-search-li-empty">'+this.EMPTY_RESULTS_LABEL+"</a></li>";return t}return null};e.goToRoad=function(e){var t={},o=this.getSearchTypeByRole(TC.Consts.searchType.ROAD);t.params={type:TC.Consts.layerType.WFS,url:o.url,version:o.version,geometryName:o.geometryName,featurePrefix:o.featurePrefix,featureType:o.getFeatureTypes(),maxFeatures:3e3,properties:o.filter.getGoToFilter(e),outputFormat:o.outputFormat,styles:o.styles};t.emptyResultHTML='<li><a title="'+this.EMPTY_RESULTS_TITLE+'" class="tc-ctl-search-li-empty">'+this.EMPTY_RESULTS_LABEL+"</a></li>";return t};e.goToPK=function(e){var t={},o=this.getSearchTypeByRole(TC.Consts.searchType.ROADPK);t.params={type:TC.Consts.layerType.WFS,url:o.url,version:o.version,geometryName:o.geometryName,featurePrefix:o.featurePrefix,featureType:o.getFeatureTypes(),maxFeatures:3e3,properties:o.filter.getGoToFilter(e),outputFormat:o.outputFormat,styles:o.styles};t.emptyResultHTML='<li><a title="'+this.EMPTY_RESULTS_TITLE+'" class="tc-ctl-search-li-empty">'+this.EMPTY_RESULTS_LABEL+"</a></li>";return t};e.goToStringPattern=function(e,t){var o={},r=this.getSearchTypeByRole(t);o.params={type:TC.Consts.layerType.WFS,url:r.url,version:r.version,geometryName:r.geometryName,featurePrefix:r.featurePrefix,featureType:r.getFeatureTypes(),maxFeatures:3e3,properties:r.filter.getGoToFilter(e),outputFormat:r.outputFormat,styles:r.styles};return o};e.getPoint=function(e){var t,o=this.map.wrap.isGeo(),r=/^X(\d+(?:\.\d+)?)Y(\d+(?:\.\d+)?)$/.exec(e);if(r&&3===r.length){t=[parseFloat(r[1]),parseFloat(r[2])];o&&(t=TC.Util.reproject(t,this.map.options.utmCrs,this.map.crs))}else{if((r=/^Lat((?:[+-]?)\d+(?:[.,]\d+)?)Lon((?:[+-]?)\d+(?:[.,]\d+)?)$/.exec(e))&&3===r.length){t=[parseFloat(r[2]),parseFloat(r[1])];if(!o)return TC.Util.reproject(t,this.map.options.geoCrs,this.map.crs)}if((r=/^Lon((?:[+-]?)\d+(?:[.,]\d+)?)Lat((?:[+-]?)\d+(?:[.,]\d+)?)$/.exec(e))&&3===r.length){t=[parseFloat(r[2]),parseFloat(r[1])];if(!o)return TC.Util.reproject(t,this.map.options.geoCrs,this.map.crs)}}return t};e.insideLimit=function(e){return!!function(e,t){return!(e instanceof Array)||t[0]>=e[0]&&t[0]<=e[2]&&t[1]>=e[1]&&t[1]<=e[3]}(this.map.options.maxExtent,e)};e.getPattern=function(){return this.$text.val()};e.getLabel=function(e){var t=e,o=TC.Util.getMapLocale(this.map);if(e.match(new RegExp("^(?:"+this.LAT+"[-\\d])|(?:"+this.UTMX+"[\\d])"))){(i=(t=t.replace(this.LAT,this.LAT_LABEL).replace(this.LON," "+this.LON_LABEL).replace(this.UTMX,this.UTMX_LABEL).replace(this.UTMY," "+this.UTMY_LABEL)).match(new RegExp("^"+$.trim(this.LAT_LABEL)+"*\\s*([-+]?\\d{1,3}([.,]\\d+)?)\\,?\\s*"+$.trim(this.LON_LABEL)+"*\\s*([-+]?\\d{1,2}([.,]\\d+)?)$")))&&(t=(t=t.replace(i[1],parseFloat(i[1]).toLocaleString(o))).replace(i[3],parseFloat(i[3]).toLocaleString(o)));var r=1.1.toLocaleString(o).substring(1,2);if(i=t.match(new RegExp("^"+$.trim(this.UTMX_LABEL)+"*\\s*([0-9]{"+this.UTMX_LEN+"}(?:[.,]\\d+)?)\\s*\\,?\\s*"+$.trim(this.UTMY_LABEL)+"*\\s*([0-9]{"+this.UTMY_LEN+"}(?:[.,]\\d+)?)$"))){Number.isInteger(parseFloat(i[1]))||(t=t.replace(i[1],i[1].replace(".",r)));Number.isInteger(parseFloat(i[2]))||(t=t.replace(i[2],i[2].replace(".",r)))}}else if(e.match(new RegExp("^(?:"+this.LON+"[-\\d])"))){(i=(t=t.replace(this.LON,this.LON_LABEL).replace(this.LAT," "+this.LAT_LABEL)).match(new RegExp("^"+$.trim(this.LON_LABEL)+"*\\s*([-+]?\\d{1,3}([.,]\\d+)?)\\,?\\s*"+$.trim(this.LAT_LABEL)+"*\\s*([-+]?\\d{1,2}([.,]\\d+)?)$")))&&(t=(t=t.replace(i[1],parseFloat(i[1]).toLocaleString(o))).replace(i[3],parseFloat(i[3]).toLocaleString(o)))}else if(e.match(new RegExp("^(?:(\\"+this.MUN+"{1})(.*)(\\"+this.POL+"{1})(\\d{1,2})(\\"+this.PAR+"{1})(\\d{1,4}))"))){var i=e.match(new RegExp("^(?:(\\"+this.MUN+"{1})(.*)(\\"+this.POL+"{1})(\\d{1,2})(\\"+this.PAR+"{1})(\\d{1,4}))"));t=this.MUN_LABEL+i[2]+", "+this.POL_LABEL+i[4]+", "+this.PAR_LABEL+i[6]}return t};e.removePunctuation=function(e){e=e||"";for(var t=new Array(e.length),o={"\xe1":"a","\xe0":"a","\xc1":"A","\xc0":"A","\xe9":"e","\xe8":"e","\xc9":"E","\xc8":"E","\xed":"i","\xec":"i","\xcd":"I","\xcc":"I","\xf3":"o","\xf2":"o","\xd3":"O","\xd2":"O","\xfa":"u","\xf9":"u","\xfc":"u","\xda":"U","\xd9":"U","\xdc":"U"},r=0,i=e.length;r<i;r++)t[r]=o[e.charAt(r)]||e.charAt(r);return t.join("")};e.decodeEntities=function(e){return $("<div/>").html(e).text()};e.exportState=function(){const e=this;return e.exportsState?{id:e.id,searchText:e.$text.val(),layer:e.layer.exportState({exportStyles:!1})}:null};e.importState=function(e){const t=this;t.$text.val(e.searchText);t.layer.importState(e.layer).then(function(){t.layer.features.forEach(function(e){e.setStyle(null)})})}}();String.prototype.tcFormat||(String.prototype.tcFormat=function(){var e=(arguments||[""])[0];return this.replace(/{(\d+)}/g,function(t,o){return void 0!==e[o]?e[o]:t})});String.prototype.splitRemoveWhiteSpaces||(String.prototype.splitRemoveWhiteSpaces=function(e){for(var t=[],o=this.split(e),r=0;r<o.length;r++)$.trim(o[r]).length>0&&t.push($.trim(o[r]));return t});String.prototype.toCamelCase||(String.prototype.toCamelCase=function(){var e=this.toLowerCase(),t=this.toLowerCase().match(/[^A-Z\xc1\xc9\xcd\xd3\xda\xdc\xc0\xc8\xcc\xd2\xd9\xe1\xe9\xed\xf3\xfa\xfc\xe0\xe8\xec\xf2\xf9a-z0-9_]+(.)/g);if(t)for(var o=0;o<t.length;o++)/[-;:.<>\{\}\[\]\/\s()]/g.test(t[o])&&(e=e.replace(t[o],t[o].toUpperCase()));return e.charAt(0).toUpperCase()+e.substring(1)});Array.prototype.hasOwnProperty("findByProperty")||Object.defineProperty(Array.prototype,"findByProperty",{enumerable:!1,writable:!0,value:function(e,t){for(var o=0;o<this.length;o++)if(this[o][e]==t)return this[o]}});String.prototype.endsWith||(String.prototype.endsWith=function(e,t){var o=this.toString();("number"!=typeof t||!isFinite(t)||Math.floor(t)!==t||t>o.length)&&(t=o.length);t-=e.length;var r=o.indexOf(e,t);return-1!==r&&r===t});TC.control=TC.control||{};TC.control.TabContainer||TC.syncLoadJS(TC.apiLocation+"TC/control/TabContainer");TC.control.SelectContainer=TC.control.TabContainer;TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.control.Share=function(e){this._classSelector="."+this.CLASS;TC.Control.apply(this,arguments);var t=e||{};this._$dialogDiv=$(TC.Util.getDiv(t.dialogDiv));t.dialogDiv||this._$dialogDiv.appendTo("body");this.includeControls=void 0===this.options.includeControls||this.options.includeControls;this.render()};TC.inherit(TC.control.Share,TC.Control);!function(){var e=TC.control.Share.prototype;e.CLASS="tc-ctl-share";e.QR_MAX_LENGTH=150;e.MAILTO_MAX_LENGTH=256;e.IFRAME_WIDTH="600px";e.IFRAME_HEIGHT="450px";e.MOBILEFAV="Siga las instrucciones del navegador del dispositivo m\xf3vil para a\xf1adir como favorito. Se guardar\xe1 el estado actual del mapa.";e.NAVALERT=" +D para guardar en marcadores.";e.render=function(e){var t=this;t.getRenderedHtml(t.CLASS+"-dialog",null,function(e){t._$dialogDiv.html(e)}).then(function(){TC.Control.prototype.render.call(t,function(){if(TC.Util.detectChrome()||TC.Util.detectIE()>=10||TC.Util.detectFirefox()>=41){t._$div.find("button").removeClass("hide");t._$div.find("input[type=text]").removeAttr("data-original-title")}TC.Util.detectMobile()||t._$div.find(".share-whatsapp").addClass(TC.Consts.classes.HIDDEN);var o=t._$div.find("."+t.CLASS+"-url-box");t._$div.find("span:not(.tc-beta)").on(TC.Consts.event.CLICK,function(e){var t=$(this).closest("label").find("input[type=radio][name=format]").val();o.removeClass(TC.Consts.classes.HIDDEN);o.not(".tc-"+t).addClass(TC.Consts.classes.HIDDEN)});$.isFunction(e)&&e()})})};e.getLocation=function(){var e=window.location.href;window.location.hash&&(e=e.substr(0,e.indexOf(window.location.hash)));return e};e.generateLink=function(){var e=window.location.href,t=e.indexOf("#");t>0&&(e=e.substring(0,t));if(this.extraParams){var o=TC.Util.getQueryStringParams(e);$.extend(o,this.extraParams);var r=e.indexOf("?");r>=0&&(e=e.substring(0,r));e=e.concat("?",$.param(o))}TC.Util.getParameterByName("lang").length>0&&(e=e.indexOf("&")>-1?e.replace("lang="+TC.Util.getParameterByName("lang")+"&",""):e.replace("?lang="+TC.Util.getParameterByName("lang"),""));const i=this.includeControls?this.exportControlStates():[],n=i.length?{ctl:i}:void 0;var a=this.map.getMapState(n),l=e.concat("#",a);this._$div.find("."+this.CLASS+"-alert").toggleClass(TC.Consts.classes.HIDDEN,l.length<=TC.Consts.URL_MAX_LENGTH);return l};e.generateIframe=function(e){var t=e||this.generateLink();if(t)return'<iframe style="width:'+this.IFRAME_WIDTH+";height:"+this.IFRAME_HEIGHT+';" src="'+t+'"></iframe>'};e.exportControlStates=function(){const e=this;return e.map?e.map.controls.map(function(e){return e.exportState()}).filter(function(e){return e}):[]};e.importControlStates=function(e){const t=this;t.map&&e.forEach(function(e){const o=t.map.getControlById(e.id);o&&o.importState(e)})};e.register=function(t){var o=this;TC.Control.prototype.register.call(o,t);o.MOBILEFAV=o.getLocaleString("mobileBookmarks.instructions");o.NAVALERT=o.getLocaleString("bookmarks.instructions");var r=function(e){var t=$(e).parent().find("input[type=text]");t.val(t.hasClass("tc-url")?o.generateLink():o.generateIframe());t.select()};o._$div.on("click","h2",function(e){o._$div.find(".tc-url input[type=text]").val(o.generateLink());o._$div.find(".tc-iframe input[type=text]").val(o.generateIframe())});o._$div.on("click",".tc-ctl-share-url-box button",function(e){r(e.target);document.execCommand("copy");var t=$(this);t.text(o.getLocaleString("copied"));setTimeout(function(){t.text(o.getLocaleString("copy"));!function(){document.getSelection().removeAllRanges();document.getSelection().addRange(document.createRange())}()},1e3)});o._$div.on("click","input[type=text]",function(e){r(e.target)});o._$div.on("click",".ga-share-icon.disabled",function(e){e.stopImmediatePropagation();e.preventDefault();return!1});o._$div.on("click","a.share-email",function(e){e.preventDefault();var r=o.generateLink();if(r){const e=encodeURIComponent(r+"\n");e.length>o.MAILTO_MAX_LENGTH&&t.toast(o.getLocaleString("urlTooLongForMailto"),{type:TC.Consts.msgType.WARNING});window.location.href="mailto:?body="+e}});o._$div.on("click","a.qr-generator",function(e){e.preventDefault();var t=o.generateLink();t&&TC.loadJS(void 0===QRCode,[TC.apiLocation+"lib/qrcode/qrcode.min.js"],function(){t.length>o.QR_MAX_LENGTH&&(t=TC.Util.shortenUrl(t));if(void 0!==t){TC.Util.showModal(o._$dialogDiv.find(o._classSelector+"-qr-dialog"));var e=o._$dialogDiv.find(".qrcode");e.empty();new QRCode(e[0],t)}else TC.error(o.getLocaleString("urlTooLongForShortener"))})});o._$div.on("click","a.share-fb",function(e){e.preventDefault();var t=o.generateLink();if(t){var r=TC.Util.shortenUrl(t);void 0!==r?window.open("https://www.facebook.com/sharer/sharer.php?u="+encodeURIComponent(r)):TC.error(o.getLocaleString("urlTooLongForShortener"));return!1}});o._$div.on("click","a.share-twitter",function(e){e.preventDefault();var t=o.generateLink();if(t){var r=TC.Util.shortenUrl(t);if(void 0!==r){var i=encodeURIComponent(window.document.title?window.document.title:"Visor API SITNA");window.open("https://twitter.com/intent/tweet?text="+i+"&amp;url="+encodeURIComponent(r))}else TC.error(o.getLocaleString("urlTooLongForShortener"));return!1}});TC.Util.detectMobile()&&o._$div.on("click","a.share-whatsapp",function(e){e.preventDefault();var t=o.generateLink();if(t){var r=TC.Util.shortenUrl(t),i="whatsapp://send?text=";location.href=void 0!==r?i+encodeURIComponent(r):i+encodeURIComponent(t);return!1}});o._$div.on("click","a.share-star",function(t){t.preventDefault();var r=o.generateLink(),i=document.title;if(TC.Util.detectMobile())alert(e.MOBILEFAV);else if(window.sidebar&&window.sidebar.addPanel)window.sidebar.addPanel(i,r,"");else if(window.sidebar&&/Firefox/i.test(navigator.userAgent)||window.opera&&window.print){window.location.href=r;alert((/Mac/i.test(navigator.userAgent)?"Cmd":"Ctrl")+e.NAVALERT)}else if(window.external&&"AddFavorite"in window.external)window.external.AddFavorite(r,i);else{window.location.href=r;alert((/Mac/i.test(navigator.userAgent)?"Cmd":"Ctrl")+e.NAVALERT)}return!1});t.loaded(function(){const e=t.state&&t.state.ctl;e&&o.importControlStates(e)})};e.template={};if(TC.isDebug){e.template[e.CLASS]=TC.apiLocation+"TC/templates/Share.html";e.template[e.CLASS+"-dialog"]=TC.apiLocation+"TC/templates/ShareDialog.html"}else{e.template[e.CLASS]=function(){dust.register(e.CLASS,t);function t(e,t){return e.w("<h2>").h("i18n",t,{},{$key:"share"}).w(' <span class="tc-beta tc-hidden">').h("i18n",t,{},{$key:"beta"}).w('</span></h2><div><div class="ga-share-icons"><a class="ga-share-icon share-email" target="_blank" data-toggle="tooltip" data-placement="top" title="').h("i18n",t,{},{$key:"sendMapByEmail"}).w('"href="#"><i class="icon-envelope-alt"></i></a><a class="ga-share-icon qr-generator" target="_blank" data-toggle="tooltip" data-placement="top" title="').h("i18n",t,{},{$key:"createQrCode"}).w('"href="#"><i class="icon-qrcode"></i></a><a class="ga-share-icon share-fb" target="_blank" data-toggle="tooltip" data-placement="top" title="').h("i18n",t,{},{$key:"shareMapToFacebook"}).w('"href="#"><i class="icon-facebook"></i></a><a class="ga-share-icon share-twitter" target="_blank" data-toggle="tooltip" data-placement="top" title="').h("i18n",t,{},{$key:"shareMapToTwitter"}).w('"href="#"><i class="icon-twitter"></i></a><a class="ga-share-icon share-whatsapp" target="_blank" data-toggle="tooltip" data-placement="top" title="').h("i18n",t,{},{$key:"shareMapToWhatsapp"}).w('"href="#"><i class="icon-whatsapp"></i></a><a class="ga-share-icon share-star" target="_blank" data-toggle="tooltip" data-placement="top" title="').h("i18n",t,{},{$key:"addToBookmarks"}).w('"href="#"><i class="icon-star"></i></a></div><div class="tc-ctl-share-select"><form><label class="tc-ctl-share-btn-url"><input type="radio" checked="checked" name="format" value="url" /><span>').h("i18n",t,{},{$key:"shareLink"}).w('</span></label><label class="tc-ctl-share-btn-iframe"><input type="radio" name="format" value="iframe" /><span>').h("i18n",t,{},{$key:"embedMap"}).w('</span></label></form></div><div class="tc-ctl-share-url-box tc-group tc-url"><input type="text" class="tc-textbox tc-url" readonly data-toggle="tooltip" data-placement="top" title="').h("i18n",t,{},{$key:"shareLink.tip.1"}).w('" /><button class="tc-button hide" title="').h("i18n",t,{},{$key:"shareLink.tip.2"}).w('">').h("i18n",t,{},{$key:"copy"}).w('</button></div><div class="tc-ctl-share-url-box tc-group tc-iframe tc-hidden"><input type="text" class="tc-textbox tc-iframe" readonly data-toggle="tooltip" data-placement="top" title="').h("i18n",t,{},{$key:"embedMap.tip.1"}).w('" /><button class="tc-button hide" title="').h("i18n",t,{},{$key:"embedMap.tip.2"}).w('">').h("i18n",t,{},{$key:"copy"}).w('</button></div><div class="tc-ctl-share-alert tc-alert alert-warning tc-hidden"><p>').h("i18n",t,{},{$key:"tooManyLayersLoaded|s"}).w("</p> </div></div>")}t.__dustBody=!0;return t};e.template[e.CLASS+"-dialog"]=function(){dust.register(e.CLASS+"-dialog",t);function t(e,t){return e.w('<div class="tc-ctl-share-qr-dialog tc-modal"><div class="tc-modal-background tc-modal-close"></div><div class="tc-modal-window"><div class="tc-modal-header"><h3>').h("i18n",t,{},{$key:"qrCode"}).w('</h3><div class="tc-ctl-popup-close tc-modal-close"></div></div><div class="tc-modal-body"><div class="qrcode"></div></div><div class="tc-modal-footer"><button type="button" class="tc-button tc-modal-close">').h("i18n",t,{},{$key:"close"}).w("</button></div></div></div>")}t.__dustBody=!0;return t}}}();TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");!function(){TC.Consts.url.GOOGLEMAPS="//maps.googleapis.com/maps/api/js?v=3";var e=TC.Consts.url.GOOGLEMAPS;TC.Cfg.proxyExceptions=TC.Cfg.proxyExceptions||[];TC.Cfg.proxyExceptions.push(TC.Consts.url.GOOGLEMAPS);TC.control.StreetView=function(){this._templatePromise=$.Deferred();this._sv=null;this._mapActiveControl=null;TC.Control.apply(this,arguments);this.options.googleMapsKey&&(e+="&key="+this.options.googleMapsKey);this.viewDiv=null;this._$viewDiv=null;this._startLonLat=null};TC.inherit(TC.control.StreetView,TC.Control);var t=TC.control.StreetView.prototype;t.CLASS="tc-ctl-sv";t.template={};if(TC.isDebug){t.template[t.CLASS]=TC.apiLocation+"TC/templates/StreetView.html";t.template[t.CLASS+"-view"]=TC.apiLocation+"TC/templates/StreetViewView.html"}else{t.template[t.CLASS]=function(){dust.register(t.CLASS,e);function e(e,t){return e.w('<div class="tc-ctl-sv-btn" title="').h("i18n",t,{},{$key:"sv.tip"}).w('"><div class="tc-ctl-sv-drag"></div></div>')}e.__dustBody=!0;return e};t.template[t.CLASS+"-view"]=function(){dust.register(t.CLASS+"-view",e);function e(e,t){return e.w('<div class="tc-ctl-sv-btn-close" title="').h("i18n",t,{},{$key:"closeStreetView"}).w('"></div>')}e.__dustBody=!0;return e}}var o=function(e){e.layer.clearFeatures();e._$div.find("."+e.CLASS+"-btn").removeClass(TC.Consts.classes.CHECKED);e._$div.find("."+e.CLASS+"-drag").removeClass(TC.Consts.classes.HIDDEN);$(e.map.div).removeClass(e.CLASS+"-active");e._startLonLat=null};t.register=function(e){var t=this;if(!t._$viewDiv){t.viewDiv=TC.Util.getDiv(t.options.viewDiv);t._$viewDiv=$(t.viewDiv).addClass(t.CLASS+"-view "+TC.Consts.classes.HIDDEN);t.options.viewDiv||t._$viewDiv.insertBefore(e.div)}TC.Control.prototype.register.call(t,e);t.layer=null;for(var r=t.getUID(),i=0;i<e.workLayers.length;i++){var n=e.workLayers[i];if(n.type===TC.Consts.layerType.VECTOR&&n.id===r){t.layer=n;break}}t.layer||e.loaded(function(){e.addLayer({id:r,stealth:!0,type:TC.Consts.layerType.VECTOR}).then(function(e){t.layer=e})});t._templatePromise.then(function(){TC.loadJS(!$.fn.drag,[TC.apiLocation+"lib/jquery/jquery.event.drag.js",TC.apiLocation+"lib/jquery/jquery.event.drop.js"],function(){var e=t._$div.find("."+t.CLASS+"-drag");e.drag(function(t,o){e.css({transform:"translate("+o.deltaX+"px, "+o.deltaY+"px)"})}).drag("start",function(e,o){!function(e){e._$div.find("."+e.CLASS+"-btn").addClass(TC.Consts.classes.CHECKED);$(e.map.div).addClass(e.CLASS+"-active")}(t);e.preventDefault();e.stopPropagation()}).drag("end",function(r,i){!function(e){var t=!1,r=e._$div.find("."+e.CLASS+"-btn"),i=e._$div.find("."+e.CLASS+"-drag"),n=r[0].getBoundingClientRect(),a=i[0].getBoundingClientRect();i.addClass(TC.Consts.classes.HIDDEN);if(a.top<n.top||a.top>n.bottom||a.left<n.left||a.left>n.right){t=!0;for(var l=e.map.getExtent(),s=[l[2],l[3]],p=(new Array(16),0);p<16;p++)e.layer.addMarker(s,{cssClass:"tc-marker-sv-"+p,width:48,height:48,anchor:[0,1]});var c=e.map.div.getBoundingClientRect(),u=(a.left+a.right)/2-c.left,g=a.bottom-c.top,d=e.map.wrap.getCoordinateFromPixel([u,g]);e.callback(d)}else o(e)}(t);e.css({transform:"none"})})});var e=t._$viewDiv;e.find("."+t.CLASS+"-btn-close").on("mouseup",function(r){const i=$(t.map.div),n=function(){i.hasClass(TC.Consts.classes.COLLAPSED)&&i.removeClass(TC.Consts.classes.COLLAPSED).trigger("resize")};e.off("transitionend.tc").on("transitionend.tc",function(t){if("width"===t.originalEvent.propertyName||"height"===t.originalEvent.propertyName){e.off("transitionend.tc");n()}});setTimeout(n,1e3);e.addClass(TC.Consts.classes.HIDDEN).removeClass(TC.Consts.classes.VISIBLE);t._$div.find("."+t.CLASS+"-drag").removeClass(TC.Consts.classes.HIDDEN);t.layer.wrap.setDraggable(!1);o(t);t._sv.setVisible(!1);r.stopPropagation();var a=t._$div.parents("body").find("header");a.length>0&&a.css("display","");t._previousActiveControl&&t._previousActiveControl.activate()})},function(e,t,o){TC.error("Error de renderizado Streetview")})};t.render=function(){var e=this;TC.Control.prototype.render.call(e,function(){dust.cache[e.CLASS+"-view"]?dust.render(e.CLASS+"-view",null,function(t,o){setTimeout(function(){e._$viewDiv.html(o);t&&TC.error(t);e._templatePromise.resolve()},300)}):TC.error("No hay dust.cache para StreetView")})};var r=0;t.callback=function(t){var i=this,n=function(e){if(i._sv){var t=e.getBounds();lonLat=TC.Util.reproject([(t[0]+t[2])/2,(t[1]+t[3])/2],i.map.crs,"EPSG:4326");i._sv.setPosition({lng:lonLat[0],lat:lonLat[1]})}},a=function(e){if(i._sv){var t=e.getBounds();i._startLonLat=[(t[0]+t[2])/2,(t[1]+t[3])/2]}},l=i.map.getLoadingIndicator();l&&(r=l.addWait(r));var s=$(i.map.div),p=function(e,o){i.layer.clearFeatures();var r,l;if(e){var p=e.getPosition();r=TC.Util.reproject([p.lng(),p.lat()],"EPSG:4326",i.map.crs);l=e.getPov().heading}else{r=t;l=0}i.map.addMarker(r,{cssClass:"tc-marker-sv-"+(Math.round(16*l/360)+16)%16,width:48,height:48,anchor:[.4791666666666667,.7083333333333333],layer:i.layer,showsPopup:!1});$.when.apply(this,i.map._markerDeferreds).then(function(e){i.layer.wrap.setDraggable(!0,n,a)});if(o){var c=function(){i.map.setCenter(r)};s.hasClass(TC.Consts.classes.COLLAPSED)?c():setTimeout(c,1200)}};TC.loadJS(!window.google||!google.maps,e,function(){if(window.google){p();var e=i._$viewDiv,n=TC.Util.reproject(t,i.map.crs,"EPSG:4326"),a=e.hasClass(TC.Consts.classes.VISIBLE),c={position:new google.maps.LatLng(n[1],n[0]),pov:{heading:0,pitch:0},zoom:1,zoomControlOptions:{position:google.maps.ControlPosition.LEFT_TOP},panControlOptions:{position:google.maps.ControlPosition.LEFT_TOP}};if(i._sv)i._sv.setOptions(c);else{i._sv=new google.maps.StreetViewPanorama(e[0],c);google.maps.event.addListener(i._sv,"position_changed",function(){p(i._sv,e.hasClass(TC.Consts.classes.VISIBLE))});google.maps.event.addListener(i._sv,"pov_changed",function(){if(i.layer.features&&i.layer.features.length>0){var e=i.layer.features[0];delete e.options.url;e.options.cssClass="tc-marker-sv-"+(Math.round(16*i._sv.getPov().heading/360)+16)%16;e.setStyle(e.options);i.layer.refresh()}});google.maps.event.addListener(i._sv,"status_changed",function(){var t=i._sv.getStatus();l&&l.removeWait(r);if(t===google.maps.StreetViewStatus.OK){s.addClass(TC.Consts.classes.COLLAPSED).trigger("resize");const t=function(){google.maps.event.trigger(i._sv,"resize")};e.off("transitionend.tc").on("transitionend.tc",function(o){if(("width"===o.originalEvent.propertyName||"height"===o.originalEvent.propertyName)&&!a){a=!0;e.off("transitionend.tc");t()}});setTimeout(t,1e3);if(!e.hasClass(TC.Consts.classes.VISIBLE)){i._sv.setVisible(!0);p(i._sv,!0);if(i.map.activeControl){i._previousActiveControl=i.map.activeControl;i.map.activeControl.deactivate(!0)}setTimeout(function(){e.css("left","").css("top","");e.removeClass(TC.Consts.classes.HIDDEN).addClass(TC.Consts.classes.VISIBLE)},200);var n=i._$div.parents("body").find("header");n.length>0&&n.css("display","none")}}else{TC.alert(t===google.maps.StreetViewStatus.ZERO_RESULTS?i.getLocaleString("noStreetView"):i.getLocaleString("streetViewUnknownError"));if(i._startLonLat)i.callback(i._startLonLat);else{i.layer.wrap.setDraggable(!1);o(i)}}})}p(i._sv)}else o(i)},!1,!0)}}();TC.control=TC.control||{};TC.control.MapContents||TC.syncLoadJS(TC.apiLocation+"TC/Control");!function(){for(var e=0,t=["ms","moz","webkit","o"],o=!(!window.performance||!window.performance.now),r=0,i=t.length;r<i&&!window.requestAnimationFrame;r+=1){window.requestAnimationFrame=window[t[r]+"RequestAnimationFrame"];window.cancelAnimationFrame=window[t[r]+"CancelAnimationFrame"]||window[t[r]+"CancelRequestAnimationFrame"]}window.requestAnimationFrame||(window.requestAnimationFrame=function(t,o){var r=(new Date).getTime(),i=Math.max(0,16-(r-e)),n=window.setTimeout(function(){t(r+i)},i);e=r+i;return n});window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)});if(!o){var n=window.requestAnimationFrame,a=+new Date;window.requestAnimationFrame=function(e,t){n(function(t){return e(t<1e12?t:t-a)},t)}}}();!function(){TC.Consts.classes.THREED=TC.Consts.classes.THREED||"tc-threed";TC.Consts.classes.THREED_HIDDEN=TC.Consts.classes.THREED_HIDDEN||"tc-threed-hidden";TC.Consts.event.TERRAINLOADED=TC.Consts.event.TERRAINLOADED||"terrainloaded.tc.threed";TC.Consts.event.TERRAINRECEIVING=TC.Consts.event.TERRAINRECEIVING||"terrainreceiving.tc.threed";TC.Consts.event.TERRAIN404=TC.Consts.event.TERRAIN404||"terrain404.tc.threed";TC.control.ThreeD=function(){TC.Control.apply(this,arguments);this.$events=$(this);this._manageResultsPanel={};this.selectors={divThreedMap:this.options.divMap};this.Consts={BLANK_BASE:"blank",DEFAULT_TILE_SIZE:256};if(!this.options.terrain)throw Error("Falta configuraci\xf3n del terreno");this.terrain=this.options.terrain;if(this.options.terrainFallback&&this.options.terrainFallback.url&&this.options.terrainFallback.coverageName&&this.options.terrainFallback.noDataValue)this.terrainFallback={url:this.options.terrainFallback.url.trim(),layerName:this.options.terrainFallback.coverageName,format:this.options.terrainFallback.format,noDataValue:this.options.terrainFallback.noDataValue};else if(this.options.terrainFallback&&(!this.options.terrainFallback.url||!this.options.terrainFallback.coverageName||!this.options.terrainFallback.noDataValue))throw Error("Faltan datos sobre el terreno de respaldo");TC.isDebug&&(TC.Consts.url.CESIUM=TC.apiLocation+"lib/cesium/debug/Cesium.js");this.options.controls&&(this.allowedControls=this.options.controls)};TC.inherit(TC.control.ThreeD,TC.Control);var e=TC.control.ThreeD.prototype;e.CLASS="tc-ctl-threed";e.classes={MAPTHREED:"tc-map-threed",LOADING:"tc-loading",BTNACTIVE:"active",CAMERACTRARROWDISABLED:"disabled-arrow",BETA:"tc-beta-button",FOCUS:"focus",HIGHLIGHTED:"highlighted",DISABLED:"disabled",OUTFOCUS:"outfocus",COORDSTHREEDMARKER:"tc-ctl-coords-threed"};e.direction={TO_TWO_D:"two_d",TO_THREE_D:"three_d"};e.allowedControls=[];e.template={};if(TC.isDebug){e.template[e.CLASS]=TC.apiLocation+"TC/templates/ThreeD.html";e.template[e.CLASS+"-overlay"]=TC.apiLocation+"TC/templates/ThreeDOverlay.html";e.template[e.CLASS+"-cm-ctls"]=TC.apiLocation+"TC/templates/ThreeDCameraControls.html"}else{e.template[e.CLASS+"-cm-ctls"]=function(){dust.register(e.CLASS+"-cm-ctls",t);function t(e,t){return e.w('<div><svg xmlns:dc="http://purl.org/dc/elements/1.1/"xmlns:cc="http://creativecommons.org/ns#"xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"xmlns:svg="http://www.w3.org/2000/svg"xmlns="http://www.w3.org/2000/svg"xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"width="220"height="135"viewBox="0 0 63.40233 35.531682"version="1.1"id="threedControls"><g inkscape:groupmode="layer"id="backgroundLayer"inkscape:label="backgroundLayer"transform="translate(-2.3693123,-42.387899)"><path style="fill:#ffffff;fill-opacity:0.23999999;stroke:none;stroke-width:0.2;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:0.3169643;paint-order:stroke fill markers"d="M 48.005285,42.387899 A 17.766048,17.766048 0 0 0 34.067635,49.16888 17.754217,17.754217 0 0 0 20.123267,42.399784 17.754217,17.754217 0 0 0 2.3693123,60.153739 a 17.754217,17.754217 0 0 0 17.7539547,17.75447 17.754217,17.754217 0 0 0 13.923699,-6.76961 17.766048,17.766048 0 0 0 13.958319,6.78098 17.766048,17.766048 0 0 0 17.766357,-17.76584 17.766048,17.766048 0 0 0 -17.766357,-17.76584 z"id="background"inkscape:connector-curvature="0" /></g><g inkscape:label="tiltLayer"inkscape:groupmode="layer"id="tiltLayer"transform="translate(-26.69084,-42.254264)"style="display:inline"><g class="tc-ctl-threed-cm-tilt-indicator"><path class="tc-ctl-threed-cm-tilt-inner"id="tiltInner"d="m 44.44423,52.861576 c 3.959106,0 7.167321,3.203889 7.167321,7.168124 0,3.964234 -3.208215,7.174892 -7.167321,7.174892 -3.959106,0 -7.160559,-3.210658 -7.160559,-7.174892 0,-3.964235 3.201453,-7.168124 7.160559,-7.168124 z"inkscape:connector-curvature="0"><title>').h("i18n",t,{},{$key:"threed.tilt.reset"}).w('</title></path><path class="tc-ctl-threed-cm-tilt-inner-image"d="m 40.116095,64.124648 c -0.12075,-0.119221 -0.171366,-0.928328 -0.171366,-2.739326 0,-2.143319 0.03709,-2.606753 0.223349,-2.79065 0.19727,-0.194769 0.269957,-0.196719 0.622509,-0.01671 0.219537,0.112088 0.761654,0.542242 1.204705,0.955894 l 0.805547,0.752098 v 0.939855 c 0,0.51692 -0.06955,1.085596 -0.154558,1.263727 -0.173436,0.363428 -1.919571,1.804317 -2.186551,1.804317 -0.09475,0 -0.249383,-0.07614 -0.343635,-0.169192 z m 3.287741,-0.05029 c -0.307698,-0.212789 -0.317387,-0.295835 -0.317387,-2.721198 0,-1.757783 0.05096,-2.552024 0.171366,-2.670904 0.120776,-0.119243 0.941399,-0.169194 2.779684,-0.169194 2.432612,0 2.618273,0.01838 2.756146,0.27272 0.08484,0.156511 0.147831,1.267987 0.147831,2.608402 0,3.088986 0.189068,2.899662 -2.895738,2.899662 -1.872744,0 -2.3862,-0.04266 -2.641902,-0.219488 z m 0.586357,-6.180807 c -0.314529,-0.267117 -0.397432,-0.458143 -0.397432,-0.915756 0,-0.785501 0.427643,-1.207722 1.223233,-1.207722 1.162181,0 1.675866,1.23538 0.851939,2.048861 -0.522115,0.515494 -1.126934,0.542392 -1.67774,0.07462 z m 2.780604,-0.09201 c -0.374474,-0.369724 -0.423284,-0.501051 -0.3506,-0.943285 0.118405,-0.72038 0.53618,-1.088187 1.236028,-1.088187 0.699848,0 1.117624,0.367807 1.236028,1.088187 0.07269,0.442234 0.02388,0.573561 -0.3506,0.943285 -0.300932,0.297119 -0.573881,0.429526 -0.885428,0.429526 -0.311544,0 -0.584496,-0.132407 -0.885428,-0.429526 z"id="tiltImage"inkscape:connector-curvature="0"><title>').h("i18n",t,{},{$key:"threed.tilt.reset"}).w('</title></path><path class="tc-ctl-threed-cm-tilt-outer tc-ctl-threed-cm-tilt-outer-circle"id="tiltOuter"d="m 44.44423,48.705554 c -6.246102,0 -11.312196,5.070128 -11.312196,11.324146 0,6.254017 5.066094,11.330914 11.312196,11.330914 6.246102,0 11.312196,-5.076897 11.312196,-11.330914 0,-6.254018 -5.066094,-11.324146 -11.312196,-11.324146 z m 0,4.156022 c 3.959106,0 7.167321,3.203889 7.167321,7.168124 0,3.964234 -3.208215,7.174892 -7.167321,7.174892 -3.959106,0 -7.160559,-3.210658 -7.160559,-7.174892 0,-3.964235 3.201453,-7.168124 7.160559,-7.168124 z"inkscape:connector-curvature="0"><title>').h("i18n",t,{},{$key:"threed.tilt.drag"}).w('</title></path><path class="tc-ctl-threed-cm-tilt-outer tc-ctl-threed-cm-tilt-outer-shell-circle"sodipodi:nodetypes="ssssssccccsccccssccsssccscccccccsccssscsssssccccccccccccccc"inkscape:connector-curvature="0"id="tiltShell"d="m 44.44423,48.705554 c -6.246102,0 -11.312196,5.070128 -11.312196,11.324146 0,6.254017 5.066094,11.330914 11.312196,11.330914 6.246102,0 11.312196,-5.076897 11.312196,-11.330914 0,-6.254018 -5.066094,-11.324146 -11.312196,-11.324146 z m 0,0.379051 c 2.995132,0 5.705501,1.203885 7.681205,3.154245 l -2.386853,2.382605 0.135232,0.135376 2.386853,-2.382606 c 1.930016,1.972963 3.12387,4.674054 3.12387,7.655475 0,2.981421 -1.193854,5.680844 -3.12387,7.655474 l -2.386853,-2.382605 -0.135232,0.135375 2.386853,2.382606 c -1.975664,1.951759 -4.686314,3.161013 -7.681205,3.161013 -1.94179,0 -3.766282,-0.506879 -5.347316,-1.395323 -0.850442,-0.477894 -1.630441,-1.06619 -2.320365,-1.745384 l 2.407138,-2.402912 c 1.358381,1.325983 3.214811,2.145699 5.260543,2.145699 4.163407,0 7.545972,-3.385283 7.545972,-7.553943 0,-4.168661 -3.382565,-7.547175 -7.545972,-7.547175 -2.045732,0 -3.902162,0.81461 -5.260543,2.13893 l -2.407138,-2.402912 c 1.972594,-1.940536 4.681097,-3.133938 7.667681,-3.133938 z m -0.189325,0.182756 v 3.01887 h 0.378651 v -3.01887 z m -7.606826,3.086558 2.400376,2.402912 C 37.721509,56.11715 36.90502,57.97796 36.90502,60.0297 c 0,2.05174 0.816489,3.910884 2.143435,5.272869 l -2.400376,2.402912 c -0.435151,-0.44326 -0.832923,-0.923297 -1.188195,-1.435068 -0.462681,-0.666492 -0.853281,-1.386809 -1.160484,-2.149815 -0.508689,-1.263436 -0.788715,-2.64392 -0.788715,-4.090898 0,-2.99182 1.197141,-5.70104 3.137394,-7.675781 z m 7.796151,0.507657 c 3.959106,0 7.167321,3.203889 7.167321,7.168124 0,3.964234 -3.208215,7.174892 -7.167321,7.174892 -3.959106,0 -7.160559,-3.210658 -7.160559,-7.174892 0,-3.964235 3.201453,-7.168124 7.160559,-7.168124 z m -10.744219,6.978598 v 0.379051 h 3.022445 v -0.379051 z m 18.513325,0 v 0.379051 h 3.029207 v -0.379051 z m -7.931385,7.932994 v 3.01887 h 0.37189 v -3.01887 z"><title>').h("i18n",t,{},{$key:"threed.tilt.drag"}).w('</title></path></g></g><g id="rotateLayer"inkscape:groupmode="layer"inkscape:label="rotateLayer"style="display:inline"transform="translate(-2.3693123,-42.387899)"><path class="tc-ctl-threed-cm-rotate-right"sodipodi:nodetypes="cccccccc"inkscape:connector-curvature="0"id="right"d="m 53.241331,72.907368 0.900176,1.930847 c 3.602027,-1.827343 6.291427,-4.493353 8.092762,-8.066897 l 0.969844,0.452626 -0.663464,-4.788009 -3.222445,2.974451 0.983506,0.459005 c -1.447339,3.107391 -3.949649,5.598011 -7.060379,7.037977 z"><title>').h("i18n",t,{},{$key:"threed.rotate.right"}).w('</title></path><path class="tc-ctl-threed-cm-rotate-left"sodipodi:nodetypes="cccccccc"inkscape:connector-curvature="0"id="left"d="m 42.795431,72.906221 -0.900176,1.930846 c -3.602027,-1.827342 -6.291427,-4.493352 -8.092762,-8.066896 l -0.969844,0.452626 0.663465,-4.788009 3.222444,2.974451 -0.983506,0.459005 c 1.44734,3.107391 3.949649,5.598011 7.060379,7.037977 z"><title>').h("i18n",t,{},{$key:"threed.rotate.left"}).w('</title></path><path class="tc-ctl-threed-cm-tilt-up"sodipodi:nodetypes="cccccccc"inkscape:connector-curvature="0"id="up"d="M 7.737296,54.610066 5.80645,53.70989 c 1.827342,-3.602027 4.493352,-6.291427 8.066896,-8.092762 l -0.452626,-0.969844 4.788009,0.663465 -2.974451,3.222444 -0.459005,-0.983506 c -3.107391,1.44734 -5.598011,3.949649 -7.037977,7.060379 z"><title>').h("i18n",t,{},{$key:"threed.tilt.left"}).w('</title></path><path class="tc-ctl-threed-cm-tilt-down"sodipodi:nodetypes="cccccccc"inkscape:connector-curvature="0"id="down"d="m 7.684579,65.708846 -1.930847,0.900176 c 1.827343,3.602027 4.493353,6.291427 8.066897,8.092762 l -0.452626,0.969844 4.788009,-0.663464 -2.974451,-3.222445 -0.459005,0.983506 C 11.615165,71.321886 9.124545,68.819576 7.684579,65.708846 Z"><title>').h("i18n",t,{},{$key:"threed.tilt.right"}).w('</title></path><g class="tc-ctl-threed-cm-rotate-indicator"><path class="tc-ctl-threed-cm-rotate-inner"inkscape:connector-curvature="0"d="m 48.010487,52.995444 c 3.959106,0 7.167321,3.203889 7.167321,7.168124 0,3.964234 -3.208215,7.174892 -7.167321,7.174892 -3.959106,0 -7.160559,-3.210658 -7.160559,-7.174892 0,-3.964235 3.201453,-7.168124 7.160559,-7.168124 z"id="rotateInner"><title>').h("i18n",t,{},{$key:"threed.rotate.reset"}).w('</title></path><path class="tc-ctl-threed-cm-rotate-inner-image"d="m 45.461645,60.604061 c 0.860585,-1.857231 1.777009,-3.864779 2.036499,-4.461218 0.471802,-1.084433 0.471802,-1.084433 0.66474,-0.667935 2.070474,4.46957 3.86201,8.443545 3.825603,8.485934 -0.02561,0.02982 -0.943964,-0.165127 -2.040793,-0.433206 -1.994234,-0.487419 -1.994234,-0.487419 -3.881098,-0.01711 -1.037775,0.258673 -1.950491,0.470314 -2.028258,0.470314 -0.07777,0 0.562721,-1.519553 1.423307,-3.376784 z m 1.23418,2.027617 c 1.353421,-0.310159 1.353421,-0.310159 1.353421,-2.998288 0,-1.534227 -0.05572,-2.627602 -0.129797,-2.547123 -0.101525,0.110295 -2.316061,4.831583 -2.659547,5.670031 -0.09645,0.23543 -0.15884,0.240844 1.435923,-0.12462 z"id="rotateImage"inkscape:connector-curvature="0"><title>').h("i18n",t,{},{$key:"threed.rotate.reset"}).w('</title></path><path class="tc-ctl-threed-cm-rotate-outer tc-ctl-threed-cm-rotate-outer-circle"inkscape:connector-curvature="0"d="m 48.010487,48.839422 c -6.246102,0 -11.312196,5.070128 -11.312196,11.324146 0,6.254017 5.066094,11.330914 11.312196,11.330914 6.246102,0 11.312196,-5.076897 11.312196,-11.330914 0,-6.254018 -5.066094,-11.324146 -11.312196,-11.324146 z m 0,4.156022 c 3.959106,0 7.167321,3.203889 7.167321,7.168124 0,3.964234 -3.208215,7.174892 -7.167321,7.174892 -3.959106,0 -7.160559,-3.210658 -7.160559,-7.174892 0,-3.964235 3.201453,-7.168124 7.160559,-7.168124 z"id="rotateOuter"><title>').h("i18n",t,{},{$key:"threed.rotate.drag"}).w('</title></path><path class="tc-ctl-threed-cm-rotate-outer tc-ctl-threed-cm-rotate-outer-shell-circle"d="m 48.010487,48.839422 c -6.246102,0 -11.312196,5.070128 -11.312196,11.324146 0,6.254017 5.066094,11.330914 11.312196,11.330914 6.246102,0 11.312196,-5.076897 11.312196,-11.330914 0,-6.254018 -5.066094,-11.324146 -11.312196,-11.324146 z m 0,0.379051 c 2.995132,0 5.705501,1.203885 7.681205,3.154245 l -2.386853,2.382605 0.135232,0.135376 2.386853,-2.382606 c 1.930016,1.972963 3.12387,4.674054 3.12387,7.655475 0,2.981421 -1.193854,5.680844 -3.12387,7.655474 l -2.386853,-2.382605 -0.135232,0.135375 2.386853,2.382606 c -1.975664,1.951759 -4.686314,3.161013 -7.681205,3.161013 -1.94179,0 -3.766282,-0.506879 -5.347316,-1.395323 -0.850442,-0.477894 -1.630441,-1.06619 -2.320365,-1.745384 l 2.407138,-2.402912 c 1.358381,1.325983 3.214811,2.145699 5.260543,2.145699 4.163407,0 7.545972,-3.385283 7.545972,-7.553943 0,-4.168661 -3.382565,-7.547175 -7.545972,-7.547175 -2.045732,0 -3.902162,0.81461 -5.260543,2.13893 l -2.407138,-2.402912 c 1.972594,-1.940536 4.681097,-3.133938 7.667681,-3.133938 z m -0.189325,0.182756 v 3.01887 h 0.378651 v -3.01887 z m -7.606826,3.086558 2.400376,2.402912 c -1.326946,1.360319 -2.143435,3.221129 -2.143435,5.272869 0,2.05174 0.816489,3.910884 2.143435,5.272869 l -2.400376,2.402912 c -0.435151,-0.44326 -0.832923,-0.923297 -1.188195,-1.435068 -0.462681,-0.666492 -0.853281,-1.386809 -1.160484,-2.149815 -0.508689,-1.263436 -0.788715,-2.64392 -0.788715,-4.090898 0,-2.99182 1.197141,-5.70104 3.137394,-7.675781 z m 7.796151,0.507657 c 3.959106,0 7.167321,3.203889 7.167321,7.168124 0,3.964234 -3.208215,7.174892 -7.167321,7.174892 -3.959106,0 -7.160559,-3.210658 -7.160559,-7.174892 0,-3.964235 3.201453,-7.168124 7.160559,-7.168124 z m -10.744219,6.978598 v 0.379051 h 3.022445 v -0.379051 z m 18.513325,0 v 0.379051 H 58.8088 v -0.379051 z m -7.931385,7.932994 v 3.01887 h 0.37189 v -3.01887 z"id="rotateShell"inkscape:connector-curvature="0"sodipodi:nodetypes="ssssssccccsccccssccsssccscccccccsccssscsssssccccccccccccccc"><title>').h("i18n",t,{},{$key:"threed.rotate.drag"}).w("</title></path></g></g></svg></div>")}t.__dustBody=!0;return t};e.template[e.CLASS+"-overlay"]=function(){dust.register(e.CLASS+"-overlay",t);function t(e,t){return e.w('<div class="tc-ctl-threed-overlay" hidden><svg class="tc-ctl-threed-overlay-svg"><defs><filter id="fGaussian" x="0" y="0"><feGaussianBlur in="SourceGraphic" stdDeviation="3" /></filter></defs><rect width="100%" height="100%" fill="white" fill-opacity="0.5" filter="url(#fGaussian)" /> </svg> </div>')}t.__dustBody=!0;return t};e.template[e.CLASS]=function(){dust.register(e.CLASS,t);function t(e,t){return e.w('<button class="tc-ctl-threed-btn tc-beta-button" title="').h("i18n",t,{},{$key:"threed.tip"}).w('"></button>')}t.__dustBody=!0;return t}}e.viewer;e.mapView;e.terrainProvider;e.register=function(e){var t=this;TC.Control.prototype.register.call(t,e);t.mapView=new o(e,t);e.on(TC.Consts.event.PROJECTIONCHANGE,function(e){t.mapView.metersPerUnit=t.map.getMetersPerUnit()})};var t=function(e,t){var o=this;o.waiting||(o.waiting=o.map.getLoadingIndicator().addWait());for(var r=[],i=0,n=o.allowedControls.length;i<n;i++){var a=o.allowedControls[i];a=a.substr(0,1).toUpperCase()+a.substr(1);r=r.concat(o.map.getControlsByClass("TC.control."+a))}o.ctrlsToMng=r;if(o.mapIs3D){o.map.on3DView=!1;o.map.view3D=null;o.deactivate();o.map3D.cameraControls.resetRotation({duration:1e3}).then(function(){var e=u(o.viewer.scene),t=Cesium.Matrix4.fromTranslation(e),r=h(o.viewer.scene,e);o.map3D.rotateAroundAxis(o.viewer.scene.camera,-r,o.viewer.scene.camera.right,t,{duration:1500,callback:function(){o.mapIs3D=!1;o.map._$div.removeClass(TC.Consts.classes.THREED);o.$button.attr("title",o.getLocaleString("threed.tip"));o.map.$events.trigger($.Event(TC.Consts.event.TERRAINPROVIDERREMOVE,{terrainProvider:o.viewer.scene.terrainProvider}));o.viewer.scene.terrainProvider.fallbackProvider&&o.viewer.scene.terrainProvider.fallbackProvider.forEach(function(e){o.map.$events.trigger($.Event(TC.Consts.event.TERRAINPROVIDERREMOVE,{terrainProvider:e}))});o.map3D.destroy.call(o);o.map3D.setViewFromCameraView.call(o).then(function(){o.$divThreedMap.removeClass(o.classes.MAPTHREED);o.$divThreedMap.removeClass("tc-ctl-threed-divMap-fadeIn").addClass("tc-ctl-threed-divMap-fadeOut");$(o.mapView.viewHTML).removeClass("tc-ctl-threed-divMap-fadeOut").addClass("tc-ctl-threed-divMap-fadeIn");o.viewer.destroy();o.viewer=null;o.$button.removeAttr("disabled");o.$button.toggleClass(o.classes.BTNACTIVE);o.map.getLoadingIndicator().removeWait(o.waiting);delete o.waiting});o.mapView.setRotation(0);o._ovMap.wrap.draw3DCamera(null)}})});o.map.activeControl=o.map.previousActiveControl;o.map.activeControl.activate();o.map.previousActiveControl=o}else{o.map.on3DView=!0;o.map.view3D=o.map3D;o.activate();if(o.browserSupportWebGL.call(o)||!o.browserSupportWebGL.call(o)){o.mapIs3D=!0;o.overlay.removeAttr("hidden");o.overlay.appendTo(o.map._$div.parent());o.map._$div.addClass(TC.Consts.classes.THREED);o.$divThreedMap=$("#"+o.selectors.divThreedMap);o.$divThreedMap.addClass(o.classes.MAPTHREED);o.$divThreedMap.addClass(o.classes.LOADING);o.$button.attr("title",o.getLocaleString("threed.two.tip"));o.$button.removeClass(o.classes.BETA);o.map3D.loadViewer.call(o).then(function(){o.$divThreedMap.removeClass("tc-ctl-threed-divMap-fadeOut").addClass("tc-ctl-threed-divMap-fadeIn");$(o.mapView.viewHTML).removeClass("tc-ctl-threed-divMap-fadeIn").addClass("tc-ctl-threed-divMap-fadeOut");o.$divThreedMap.removeClass(o.classes.LOADING);o.$button.toggleClass(o.classes.BTNACTIVE);o.map3D.setCameraFromMapView.call(o);o.map3D.setBaseLayer.call(o,o.map.baseLayer);o.map.workLayers.filter(function(e){return e.type===TC.Consts.layerType.WMTS||e.type===TC.Consts.layerType.WMS}).reverse().forEach(function(e){o.map3D.addLayer.call(o,e)});o.viewer.readyPromise.then(function(){o.map3D.cameraControls?o.map3D.cameraControls.render.call(o.map3D.cameraControls):o.map3D.cameraControls=new f(o);if(t){o.map3D.cameraControls.getCamera().flyTo({destination:Cesium.Cartesian3.fromRadians(t.cp[0],t.cp[1],t.cp[2]),orientation:{heading:t.chpr[0],pitch:t.chpr[1],roll:t.chpr[2]},complete:function(){o.$button.removeAttr("disabled");o.overlay.attr("hidden","hidden");o.map.getLoadingIndicator().removeWait(o.waiting);delete o.waiting}})}else if(e){var r=Cesium.Math.toRadians(50),i=u(o.viewer.scene),n=function(){Cesium.Camera.DEFAULT_VIEW_RECTANGLE=o.map3D.initialRectangle=o.viewer.camera.computeViewRectangle();Cesium.Camera.DEFAULT_VIEW_FACTOR=0;o.$button.removeAttr("disabled");o.overlay.attr("hidden","hidden");o.map.getLoadingIndicator().removeWait(o.waiting);delete o.waiting};if(i){i=Cesium.Matrix4.fromTranslation(i);o.map3D.rotateAroundAxis(o.viewer.scene.camera,-r,o.viewer.scene.camera.right,i,{duration:2e3,callback:n})}else n()}else{o.$button.removeAttr("disabled");o.overlay.attr("hidden","hidden");o.map.getLoadingIndicator().removeWait(o.waiting);delete o.waiting}o.$events.on(TC.Consts.event.TERRAINLOADED,function(){if(o.viewer.billboardCollection){for(var e=0;e<o.viewer.billboardCollection.length;e++){var t=Cesium.Ellipsoid.WGS84.cartesianToCartographic(o.viewer.billboardCollection.get(e).position),r=o.viewer.scene.globe.getHeight(t)||0,i={longitude:t.longitude,latitude:t.latitude,height:t.height+r};o.viewer.billboardCollection.get(e).position=Cesium.Ellipsoid.WGS84.cartographicToCartesian(i)}o.viewer.scene.requestRender()}})}.bind(o))})}}};e.renderData=function(e,o){var r=this;TC.Control.prototype.renderData.call(r,e,function(){r.getRenderedHtml(r.CLASS+"-overlay",{},function(e){r.overlay=$(e)});r.$button=r._$div.find("."+r.CLASS+"-btn");r.$button.on(TC.Consts.event.CLICK,function(){r.$button.attr("disabled","disabled");t.call(r,!0)})});$.isFunction(o)&&o()};e.activate=function(){TC.Control.prototype.activate.call(this)};e.deactivate=function(){window.dispatchEvent(new Event("resize"));TC.Control.prototype.deactivate.call(this)};e.setMapState=function(e){this.map.toast(this.getLocaleString("threed.apply3DState"),{type:TC.Consts.msgType.INFO});t.call(this,!1,e)};var o=function(e,t){var o=this;o.map=e;o.parent=t;$.when(o.map.getViewHTML()).then(function(e){o.viewHTML=e}.bind(o));o.metersPerUnit=e.getMetersPerUnit();o.maxResolution;o._oldMapSetCenter=e.setCenter;e.setCenter=function(r,i){t.mapIs3D?t.map3D.flyToMapCoordinates.call(t,r):o._oldMapSetCenter.call(e,r,i)}};o.prototype.getCenter=function(){return this.map.getCenter()};o.prototype.getExtent=function(){return this.map.getExtent()};o.prototype.getResolution=function(){return this.map.getResolution()};o.prototype.getRotation=function(){return this.map.getRotation()};o.prototype.getMaxResolution=function(){if(this.maxResolution)return this.maxResolution;if(null!==this.map.getResolutions())this.maxResolution=this.map.getResolutions()[0];else{var e=this.map.options.baselayerExtent;this.maxResolution=(e[2]-e[0])/this.parent.Consts.DEFAULT_TILE_SIZE}return this.maxResolution};o.prototype.getPixelFromCoordinate=function(e){return this.map.getPixelFromCoordinate(e)};o.prototype.setCenter=function(e){this._oldMapSetCenter.call(this.map,e)};o.prototype.setExtent=function(e){this.map.setExtent(e)};o.prototype.setResolution=function(e){this.map.setResolution(e)};o.prototype.setRotation=function(e){this.map.setRotation(e)};var r=function(e,t){return e.type===TC.Consts.layerType.WMTS?e.wrap.getCompatibleMatrixSets(t).length>0:e.isCompatible(t)},i=function(e,t){var o=t[0]-e[0],r=t[1]-e[1];return o*o+r*r},n=function(e){if((e=e||{}).nearMapCoords){var t=e.bottomPixel.clone();t.y=Math.round(9*t.y/10);var o=a.call(this,t);if(o){var r=[e.nearMapCoords,o].sort(function(t,o){return i(e.cameraPosition,t)-i(e.cameraPosition,o)});return function(e,t){var o=t[0]-e[0],r=t[1]-e[1],i=Math.atan(r/o);o<0&&(i+=Math.PI);return[e[0]+1e6*Math.cos(i),e[1]+1e6*Math.sin(i)]}.apply(this,r)}}return null},a=function(e){var t=p(this.viewer.scene,e);if(t){t=Cesium.Cartographic.fromCartesian(t);return this.map3D.crs!==this.map.crs?TC.Util.reproject([Cesium.Math.toDegrees(t.longitude),Cesium.Math.toDegrees(t.latitude)],this.map3D.crs,this.map.crs):[Cesium.Math.toDegrees(t.longitude),Cesium.Math.toDegrees(t.latitude)]}return null},l=function(e,t){var o=this.viewer.scene.canvas,r=this.viewer.camera.frustum.fovy,i=2*e*Math.tan(r/2),n=Math.cos(Math.abs(t)),a=i/this.mapView.metersPerUnit/n/o.clientHeight,l=this.map.getResolutions();if(null==l)for(var s=0,p=(l=new Array(22)).length;s<p;++s)l[s]=this.mapView.getMaxResolution()/Math.pow(2,s);for(s=0;s<l.length;s++){if(l[s]<Math.abs(a)){a=l[s-1];break}if(l[s]===Math.abs(a)){a=l[s];break}s===l.length-1&&(a=l[s])}return a},s=function(e,t,o,r,i){var n,a=Cesium.Math.clamp,l=Cesium.defaultValue,s=i||{},p=l(s.duration,500),c=l(s.easing,function(e){return e}),u=s.callback,g=0,d=new Cesium.Matrix4,h=new $.Deferred;requestAnimationFrame(function i(l){n||(n=l);var s=c(a((l-n)/p,0,1));e.transform.clone(d);var f=(s-g)*t;g=s;e.lookAtTransform(r);e.rotate(o,f);e.lookAtTransform(d);if(s<1)requestAnimationFrame(i);else{u&&u();h.resolve()}});return h},p=function(e,t){var o=e.camera.getPickRay(t);return e.globe.pick(o,e)||e.camera.pickEllipsoid(t)},c=function(e){var t=e.canvas,o=new Cesium.Cartesian2(t.clientWidth/2,t.clientHeight/2);return p(e,o)},u=function(e){var t=e.canvas,o=new Cesium.Cartesian2(t.clientWidth/2,t.clientHeight);return p(e,o)},g=function(e,t,o,r){var i=e.camera,n=h(e,o),a=i.right,l=Cesium.Quaternion.fromAxisAngle(a,n),p=Cesium.Matrix3.fromQuaternion(l),c=new Cesium.Cartesian3;Cesium.Cartesian3.subtract(i.position,o,c);var u=new Cesium.Cartesian3;Cesium.Matrix3.multiplyByVector(p,c,u);Cesium.Cartesian3.add(u,o,u);var g=Cesium.Matrix4.fromTranslation(u);s(i,t,u,g,r)},d=function(e,t,o){var r=new Cesium.Cartesian3,i=new Cesium.Cartesian3,n=new Cesium.Cartesian3;Cesium.Cartesian3.normalize(e,r);Cesium.Cartesian3.normalize(t,i);Cesium.Cartesian3.cross(r,i,n);var a=Cesium.Cartesian3.dot(r,i),l=Cesium.Cartesian3.magnitude(n),s=Cesium.Cartesian3.dot(o,n),p=Math.atan2(l,a);return s>=0?p:-p},h=function(e,t){var o=e.camera,r=o.frustum.fovy/2,i=function(e){var t=e.camera,o=t.frustum.fovy/2,r=t.direction,i=Cesium.Quaternion.fromAxisAngle(t.right,o),n=Cesium.Matrix3.fromQuaternion(i),a=new Cesium.Cartesian3;Cesium.Matrix3.multiplyByVector(n,r,a);return new Cesium.Ray(t.position,a)}(e),n=Cesium.Cartesian3.clone(i.direction);Cesium.Cartesian3.negate(n,n);var a=new Cesium.Cartesian3;Cesium.Ellipsoid.WGS84.geocentricSurfaceNormal(t,a);var l=new Cesium.Cartesian3;Cesium.Cartesian3.negate(o.right,l);return d(a,n,l)+r},f=function(e){this.parent=e;var t=function(e,t){var o=$(e)[0].getBBox();value="rotate("+Cesium.Math.toDegrees(t)+" "+(o.x+o.width/2)+" "+(o.y+o.height/2)+")";document.getElementsByClassName(e[0].className.baseVal)[0].setAttribute("transform",value)};this.outControlsEvents=TC.Util.detectMouse()?"mouseleave":"touchleave, touchend";this.outControls=function(e){this.isFocusingCameraCtrls=!1}.bind(this);this.inControlsEvents=TC.Util.detectMouse()?"mouseenter":"touchmove, touchstart";this.inControls=function(){this.isFocusingCameraCtrls=!0;this.lastFocused=performance.now();if(this.$div.hasClass(this.parent.classes.OUTFOCUS)){this.$div.removeClass(this.parent.classes.OUTFOCUS);this.$tiltIndicatorOuterCircle.attr("class",this.$tiltIndicatorOuterCircle.attr("class").replace(this.parent.classes.OUTFOCUS,""));this.$tiltIndicatorOuterShellCircle.attr("class",this.$tiltIndicatorOuterShellCircle.attr("class").replace(this.parent.classes.OUTFOCUS,""));this.$rotateIndicatorOuterCircle.attr("class",this.$rotateIndicatorOuterCircle.attr("class").replace(this.parent.classes.OUTFOCUS,""));this.$rotateIndicatorOuterShellCircle.attr("class",this.$rotateIndicatorOuterShellCircle.attr("class").replace(this.parent.classes.OUTFOCUS,""))}}.bind(this);this.moveStart=function(){this.moving=!0}.bind(this);this.moveEnd=function(){this.moving=!1}.bind(this);this.postRender=function(){var e=this.parent;this.parent.map3D.isLoadingTiles.call(this.parent)&&this.customCollisionDetection();var o=this.getCamera(),r=o.positionCartographic;if(this.moving){t(this.$tiltIndicator,o.pitch);t(this.$rotateIndicator,-o.heading);this.disableRotate();this.disableTilt(5);e.map3D.crs!==e.map.crs?this._coordsXY=TC.Util.reproject([Cesium.Math.toDegrees(r.longitude),Cesium.Math.toDegrees(r.latitude)],e.map3D.crs,e.map.crs):this._coordsXY=[Cesium.Math.toDegrees(r.longitude),Cesium.Math.toDegrees(r.latitude)];e.mapView.setCenter(this._coordsXY);e.mapView.setResolution(l.call(e,r.height,r.latitude))}if(this._coordsXY){e._ovMap=e._ovMap||e.map.getControlsByClass("TC.control.OverviewMap")[0];if(e._ovMap){var i=e.viewer.scene.canvas,s=new Cesium.Cartesian2(0,i.clientHeight-1),p=new Cesium.Cartesian2(i.clientWidth-1,i.clientHeight-1),c=[s,p,new Cesium.Cartesian2(i.clientWidth-1,0),new Cesium.Cartesian2(0,0)].map(function(t){return a.call(e,t)}).filter(function(e){return null!==e});if(c.length&&c.length<4){var u=n.call(e,{nearMapCoords:c[0],bottomPixel:s,cameraPosition:this._coordsXY}),g=n.call(e,{nearMapCoords:c[1],bottomPixel:p,cameraPosition:this._coordsXY});if(u&&g){c[2]=g;c[3]=u}}e._ovMap.wrap.draw3DCamera({position:this._coordsXY,heading:o.heading,fov:c})}}}.bind(this);this.selectors={tilt:"-cm-tilt",rotate:"-cm-rotate",indicator:"-indicator",leftArrow:"-left",rightArrow:"-right",downArrow:"-down",upArrow:"-up"};this.MIN_TILT=Cesium.Math.toRadians(-89);this.MAX_TILT=Cesium.Math.toRadians(-1);this.render()};f.prototype.bind=function(){var e=this;e.getCamera().moveStart.addEventListener(e.moveStart);e.getCamera().moveEnd.addEventListener(e.moveEnd);e.parent.viewer.scene.postRender.addEventListener(e.postRender);e.$div.on(e.outControlsEvents,e.outControls);e.$div.on(e.inControlsEvents,e.inControls);e.rAFInOutControls=requestAnimationFrame(function t(){e.lastFocused||(e.lastFocused=performance.now());if(performance.now()-e.lastFocused>5e3&&!0!==e.isFocusingCameraCtrls&&!e.$div.hasClass(e.parent.classes.OUTFOCUS)){e.$div.addClass(e.parent.classes.OUTFOCUS);e.$tiltIndicatorOuterCircle.attr("class",e.$tiltIndicatorOuterCircle.attr("class")+" "+e.parent.classes.OUTFOCUS);e.$tiltIndicatorOuterShellCircle.attr("class",e.$tiltIndicatorOuterShellCircle.attr("class")+" "+e.parent.classes.OUTFOCUS);e.$rotateIndicatorOuterCircle.attr("class",e.$rotateIndicatorOuterCircle.attr("class")+" "+e.parent.classes.OUTFOCUS);e.$rotateIndicatorOuterShellCircle.attr("class",e.$rotateIndicatorOuterShellCircle.attr("class")+" "+e.parent.classes.OUTFOCUS)}e.rAFInOutControls=requestAnimationFrame(t)})};f.prototype.unbind=function(){this.$div.addClass(TC.Consts.classes.HIDDEN);this.getCamera().moveStart.removeEventListener(this.moveStart);this.getCamera().moveEnd.removeEventListener(this.moveEnd);this.parent.viewer.scene.postRender.removeEventListener(this.postRender);this.$div.off(this.outControlsEvents,this.outControls);this.$div.off(this.inControlsEvents,this.inControls);window.cancelAnimationFrame(this.rAFInOutControls);this.lastFocused=void 0;this.rAFInOutControls=void 0};f.prototype.getCamera=function(){return this.parent.viewer.scene.camera};f.prototype.getCameraState=function(){if(this.parent.viewer){var e=this.parent.viewer.scene.camera,t=e.positionCartographic,o=u(this.parent.viewer.scene);if(o){var r=Cesium.Cartesian3.distance(e.position,o);return{cp:[t.longitude,t.latitude,t.height],chpr:[e.heading,e.pitch,e.roll],bcpd:r}}}};f.prototype.render=function(){var e=this;if(e.$div){e.$div.removeClass(TC.Consts.classes.HIDDEN);e.bind()}else e.parent.getRenderedHtml(e.parent.CLASS+"-cm-ctls",{},function(t){e.$div=$('<div class="'+e.parent.CLASS+'-cm-ctls"></div>');e.$div.appendTo(e.parent.map._$div);$(t).appendTo(e.$div);var o="."+e.parent.CLASS+e.selectors.tilt;e.$tiltIndicatorInner=e.$div.find("[class^="+o.replace(".","")+"-inner]");e.$tiltIndicatorInner.on(TC.Consts.event.CLICK,e.resetTilt.bind(e));e.$tiltIndicator=e.$div.find(o+"-indicator");e.$tiltIndicatorOuterCircle=e.$div.find(o+"-outer-circle");e.$tiltIndicatorOuterShellCircle=e.$div.find(o+"-outer-shell-circle");e.$tiltIndicatorCircle=e.$div.find("[class^="+o.replace(".","")+"-outer]");e.$tiltIndicatorCircle.on("mousedown",function(e){e.stopPropagation&&e.stopPropagation();e.preventDefault&&e.preventDefault();var t=new Cesium.Cartesian2,o=e.currentTarget,r=e.currentTarget.getBoundingClientRect(),i=new Cesium.Cartesian2((r.right-r.left)/2,(r.bottom-r.top)/2),n=new Cesium.Cartesian2(e.clientX-r.left,e.clientY-r.top),a=Cesium.Cartesian2.subtract(n,i,t);this.draggingTilt.call(this,o,a);e.cancelBubble=!0;e.returnValue=!1;return!1}.bind(e));e.$tiltUp=e.$div.find(o+e.selectors.upArrow);e.$tiltUp.on(TC.Util.detectMouse()?"mousedown":"touchstart",function(t){if(void 0!==$(t.target).attr("disabled")){t.stopPropagation&&t.stopPropagation();t.preventDefault&&t.preventDefault();t.cancelBubble=!0;t.returnValue=!1;return!1}t.stopPropagation&&t.stopPropagation();t.preventDefault&&t.preventDefault();e.inControls(t);var o=TC.Util.detectMouse()?"mouseup":"touchend";document.removeEventListener(o,e.tiltUpMouseUpFunction,!1);e.tiltUpMouseUpFunction=void 0;e.tilt.call(e,5);e.tiltUpInterval=setInterval(function(){e.isTiltUpDisabled?e.tiltUpMouseUpFunction():e.tilt.call(e,5)}.bind(e),101);e.tiltUpMouseUpFunction=function(){clearInterval(e.tiltUpInterval);e.tiltUpInterval=void 0;document.removeEventListener(o,e.tiltUpMouseUpFunction,!1);e.tiltUpMouseUpFunction=void 0};document.addEventListener(o,e.tiltUpMouseUpFunction,!1);t.cancelBubble=!0;t.returnValue=!1;return!1}.bind(e));e.$tiltDown=e.$div.find(o+e.selectors.downArrow);e.$tiltDown.on(TC.Util.detectMouse()?"mousedown":"touchstart",function(t){if(void 0!==$(t.target).attr("disabled")){t.stopPropagation&&t.stopPropagation();t.preventDefault&&t.preventDefault();t.cancelBubble=!0;t.returnValue=!1;return!1}t.stopPropagation&&t.stopPropagation();t.preventDefault&&t.preventDefault();e.inControls(t);var o=TC.Util.detectMouse()?"mouseup":"touchend";document.removeEventListener(o,e.tiltDownMouseUpFunction,!1);e.tiltDownMouseUpFunction=void 0;e.tilt.call(e,-5);e.tiltDownInterval=setInterval(function(){e.isTiltDownDisabled?e.tiltDownMouseUpFunction():e.tilt.call(e,-5)}.bind(e),101);e.tiltDownMouseUpFunction=function(){clearInterval(e.tiltDownInterval);e.tiltDownInterval=void 0;document.removeEventListener(o,e.tiltDownMouseUpFunction,!1);e.tiltDownMouseUpFunction=void 0};document.addEventListener(o,e.tiltDownMouseUpFunction,!1);t.cancelBubble=!0;t.returnValue=!1;return!1}.bind(e));var r="."+e.parent.CLASS+e.selectors.rotate;e.$rotateIndicatorInner=e.$div.find("[class^="+r.replace(".","")+"-inner]");e.$rotateIndicatorInner.on(TC.Consts.event.CLICK,e.resetRotation.bind(e));e.$rotateIndicator=e.$div.find(r+"-indicator");e.$rotateIndicatorOuterCircle=e.$div.find(r+"-outer-circle");e.$rotateIndicatorOuterShellCircle=e.$div.find(r+"-outer-shell-circle");e.$rotateIndicatorCircle=e.$div.find("[class^="+r.replace(".","")+"-outer]");e.$rotateIndicatorCircle.on("mousedown",function(e){e.stopPropagation&&e.stopPropagation();e.preventDefault&&e.preventDefault();var t=new Cesium.Cartesian2,o=e.currentTarget,r=e.currentTarget.getBoundingClientRect(),i=new Cesium.Cartesian2((r.right-r.left)/2,(r.bottom-r.top)/2),n=new Cesium.Cartesian2(e.clientX-r.left,e.clientY-r.top),a=Cesium.Cartesian2.subtract(n,i,t);this.draggingRotate.call(this,o,a);e.cancelBubble=!0;e.returnValue=!1;return!1}.bind(e));e.$rotateLeft=e.$div.find(r+e.selectors.leftArrow);e.$rotateLeft.on(TC.Util.detectMouse()?"mousedown":"touchstart",function(t){t.stopPropagation&&t.stopPropagation();t.preventDefault&&t.preventDefault();e.inControls(t);var o=TC.Util.detectMouse()?"mouseup":"touchend";document.removeEventListener(o,e.rotateLeftMouseUpFunction,!1);e.rotateLeftMouseUpFunction=void 0;e.rotate.call(e,-15);e.rotateLeftInterval=setInterval(function(){e.rotate.call(e,-15)}.bind(e),101);e.rotateLeftMouseUpFunction=function(){clearInterval(e.rotateLeftInterval);e.rotateLeftInterval=void 0;document.removeEventListener(o,e.rotateLeftMouseUpFunction,!1);e.rotateLeftMouseUpFunction=void 0};document.addEventListener(o,e.rotateLeftMouseUpFunction,!1);t.cancelBubble=!0;t.returnValue=!1;return!1}.bind(e));e.$rotateRight=e.$div.find(r+e.selectors.rightArrow);e.$rotateRight.on(TC.Util.detectMouse()?"mousedown":"touchstart",function(t){t.stopPropagation&&t.stopPropagation();t.preventDefault&&t.preventDefault();e.inControls(t);var o=TC.Util.detectMouse()?"mouseup":"touchend";document.removeEventListener(o,e.rotateRightMouseUpFunction,!1);e.rotateRightMouseUpFunction=void 0;e.rotate.call(e,15);e.rotateRightInterval=setInterval(function(){e.rotate.call(e,15)}.bind(e),101);e.rotateRightMouseUpFunction=function(){clearInterval(e.rotateRightInterval);e.rotateRightInterval=void 0;document.removeEventListener(o,e.rotateRightMouseUpFunction,!1);e.rotateRightMouseUpFunction=void 0};document.addEventListener(o,e.rotateRightMouseUpFunction,!1);t.cancelBubble=!0;t.returnValue=!1;return!1}.bind(e));e.bind()}.bind(this))};f.prototype.disableTilt=function(e){var t=Cesium.Math.toRadians(e),o=this.getCamera().pitch;this.isTiltDownDisabled=o+-t<this.MIN_TILT;this.isTiltUpDisabled=o+t>this.MAX_TILT;this.$tiltUp.attr("disabled",this.isTiltUpDisabled);this.isTiltUpDisabled?-1==this.$tiltUp.attr("class").indexOf(this.parent.classes.CAMERACTRARROWDISABLED)&&this.$tiltUp.attr("class",this.$tiltUp.attr("class")+" "+this.parent.classes.CAMERACTRARROWDISABLED):this.$tiltUp.attr("class",this.$tiltUp.attr("class").replace(" "+this.parent.classes.CAMERACTRARROWDISABLED,""));this.$tiltDown.attr("disabled",this.isTiltDownDisabled);this.isTiltDownDisabled?-1==this.$tiltDown.attr("class").indexOf(this.parent.classes.CAMERACTRARROWDISABLED)&&this.$tiltDown.attr("class",this.$tiltDown.attr("class")+" "+this.parent.classes.CAMERACTRARROWDISABLED):this.$tiltDown.attr("class",this.$tiltDown.attr("class").replace(" "+this.parent.classes.CAMERACTRARROWDISABLED,""))};f.prototype.disableRotate=function(){var e=!0,t=this.parent.viewer.scene.canvas,o=[new Cesium.Cartesian2(0,t.clientHeight-1),new Cesium.Cartesian2(t.clientWidth-1,t.clientHeight-1),new Cesium.Cartesian2(t.clientWidth-1,0),new Cesium.Cartesian2(0,0)].map(function(e){return a.call(this,e)}.bind(this.parent)).filter(function(e){return null!==e});o.length&&o.length>=2&&(e=!1);this.$rotateIndicatorInner.attr("disabled",e);this.$rotateLeft.attr("disabled",e);e?-1==this.$rotateLeft.attr("class").indexOf(this.parent.classes.CAMERACTRARROWDISABLED)&&this.$rotateLeft.attr("class",this.$rotateLeft.attr("class")+" "+this.parent.classes.CAMERACTRARROWDISABLED):this.$rotateLeft.attr("class",this.$rotateLeft.attr("class").replace(" "+this.parent.classes.CAMERACTRARROWDISABLED,""));this.$rotateRight.attr("disabled",e);e?-1==this.$rotateRight.attr("class").indexOf(this.parent.classes.CAMERACTRARROWDISABLED)&&this.$rotateRight.attr("class",this.$rotateRight.attr("class")+" "+this.parent.classes.CAMERACTRARROWDISABLED):this.$rotateRight.attr("class",this.$rotateRight.attr("class").replace(" "+this.parent.classes.CAMERACTRARROWDISABLED,""));return e};f.prototype.tilt=function(e){this.disableTilt(e);if(this.parent.viewer&&this.parent.viewer.trackedEntity)this.getCamera().rotateUp(Cesium.Math.toRadians(e));else{void 0==c(this.parent.viewer.scene)&&(e>0?this.getCamera().lookUp():this.getCamera().lookDown());if(e>=Cesium.Math.PI_OVER_TWO&&this.isTiltUpDisabled||e<=-Cesium.Math.PI_OVER_TWO&&this.isTiltDownDisabled)return;var t=Cesium.Math.toRadians(e),o=c(this.parent.viewer.scene);if(o){var r=Cesium.Matrix4.fromTranslation(o);this.parent.map3D.rotateAroundAxis(this.getCamera(),-t,this.getCamera().right,r,{duration:100})}}};f.prototype.rotate=function(e){e=Cesium.Math.toRadians(e);if(this.parent.viewer&&this.parent.viewer.trackedEntity)this.getCamera().rotateRight(-e);else{var t=u(this.parent.viewer.scene);t&&g(this.parent.viewer.scene,e,t,{duration:100})}};f.prototype.draggingTilt=function(e,t){var o=this;o.$tiltIndicatorOuterCircle.attr("class",o.$tiltIndicatorOuterCircle.attr("class")+" "+o.parent.classes.HIGHLIGHTED);var r=new Cesium.Matrix4,i=new Cesium.Matrix4,n=new Cesium.Cartesian2;document.removeEventListener("mousemove",o.tiltMouseMoveFunction,!1);document.removeEventListener("mouseup",o.tiltMouseUpFunction,!1);o.tiltMouseMoveFunction=void 0;o.tiltMouseUpFunction=void 0;o.isTilting=!0;var a=o.parent.viewer.scene,l=a.camera,s=c(a);if(s){o.tiltFrame=Cesium.Transforms.northUpEastToFixedFrame(s,Cesium.Ellipsoid.WGS84,i);o.tiltIsLook=!1}else{o.tiltFrame=Cesium.Transforms.northUpEastToFixedFrame(l.positionWC,Cesium.Ellipsoid.WGS84,i);o.tiltIsLook=!0}o.startCursorAngle=Math.atan2(-t.y,t.x);var p=Cesium.Matrix4.clone(l.transform,r);l.lookAtTransform(o.tiltFrame);o.initialCameraAngle=Math.atan2(l.position.y,l.position.x);l.lookAtTransform(p);o.tiltMouseMoveFunction=function(t){a=this.parent.viewer.scene;l=a.camera;var o=e.getBoundingClientRect();center=new Cesium.Cartesian2((o.right-o.left)/2,(o.bottom-o.top)/2);var i=new Cesium.Cartesian2(t.clientX-o.left,t.clientY-o.top),s=Cesium.Cartesian2.subtract(i,center,n);console.log("Entra: "+s.toString());var c=Math.atan2(-s.y,s.x)-this.startCursorAngle,u=Cesium.Math.zeroToTwoPi(this.initialCameraAngle-c);try{p=Cesium.Matrix4.clone(l.transform,r);l.lookAtTransform(this.tiltFrame);var g=u-Math.atan2(l.position.y,l.position.x),d=l.pitch;(d+=g)<this.MIN_TILT?l.rotate(l.right,l.pitch-this.MIN_TILT):d>this.MAX_TILT?l.rotate(l.right,l.pitch-this.MAX_TILT):l.rotate(l.right,-g);this.disableTilt(5);l.lookAtTransform(p)}catch(t){this.tiltMouseUpFunction()}}.bind(o);o.tiltMouseUpFunction=function(e){o.$tiltIndicatorOuterCircle.attr("class",o.$tiltIndicatorOuterCircle.attr("class").replace(o.parent.classes.HIGHLIGHTED,""));o.isTilting=!1;document.removeEventListener("mousemove",o.tiltMouseMoveFunction,!1);document.removeEventListener("mouseup",o.tiltMouseUpFunction,!1);o.tiltMouseMoveFunction=void 0;o.tiltMouseUpFunction=void 0};document.addEventListener("mousemove",o.tiltMouseMoveFunction,!1);document.addEventListener("mouseup",o.tiltMouseUpFunction,!1)};f.prototype.draggingRotate=function(e,t){var o=this;document.removeEventListener("mousemove",o.rotateMouseMoveFunction,!1);document.removeEventListener("mouseup",o.rotateMouseUpFunction,!1);o.rotateMouseMoveFunction=void 0;o.rotateMouseUpFunction=void 0;o.rotateMouseMoveFunction=function(t){var i=e.getBoundingClientRect(),l=new Cesium.Cartesian2((i.right-i.left)/2,(i.bottom-i.top)/2),p=new Cesium.Cartesian2(t.clientX-i.left,t.clientY-i.top),c=Cesium.Cartesian2.subtract(p,l,n),u=Math.atan2(-c.y,c.x)-o.rotateInitialCursorAngle,g=Cesium.Math.zeroToTwoPi(o.rotateInitialCameraAngle-u);a=o.parent.viewer.scene.camera;try{s=Cesium.Matrix4.clone(a.transform,r);a.lookAtTransform(o.rotateFrame);var d=Math.atan2(a.position.y,a.position.x);a.rotateRight(g-d);a.lookAtTransform(s)}catch(t){o.rotateMouseUpFunction()}};o.rotateMouseUpFunction=function(e){o.isRotating=!1;o.$rotateIndicatorOuterCircle.attr("class",o.$rotateIndicatorOuterCircle.attr("class").replace(o.parent.classes.HIGHLIGHTED,""));document.removeEventListener("mousemove",o.rotateMouseMoveFunction,!1);document.removeEventListener("mouseup",o.rotateMouseUpFunction,!1);o.rotateMouseMoveFunction=void 0;o.rotateMouseUpFunction=void 0};if(o.disableRotate())o.rotateMouseUpFunction();else{o.$rotateIndicatorOuterCircle.attr("class",o.$rotateIndicatorOuterCircle.attr("class")+" "+o.parent.classes.HIGHLIGHTED);var r=new Cesium.Matrix4,i=new Cesium.Matrix4,n=new Cesium.Cartesian2;o.isRotating=!0;o.rotateInitialCursorAngle=Math.atan2(-t.y,t.x);var a=o.parent.viewer.scene.camera,l=c(o.parent.viewer.scene);if(null==l||void 0==l)if(null==(l=u(o.parent.viewer.scene))||void 0==l){o.rotateFrame=Cesium.Transforms.eastNorthUpToFixedFrame(a.positionWC,Cesium.Ellipsoid.WGS84,i);o.rotateIsLook=!0}else{o.rotateFrame=Cesium.Transforms.eastNorthUpToFixedFrame(l,Cesium.Ellipsoid.WGS84,i);o.rotateIsLook=!1}else{o.rotateFrame=Cesium.Transforms.eastNorthUpToFixedFrame(l,Cesium.Ellipsoid.WGS84,i);o.rotateIsLook=!1}try{var s=Cesium.Matrix4.clone(a.transform,r);a.lookAtTransform(o.rotateFrame);o.rotateInitialCameraAngle=Math.atan2(a.position.y,a.position.x);o.rotateInitialCameraDistance=Cesium.Cartesian3.magnitude(new Cesium.Cartesian3(a.position.x,a.position.y,0));a.lookAtTransform(s)}catch(e){o.rotateMouseUpFunction()}document.addEventListener("mousemove",o.rotateMouseMoveFunction,!1);document.addEventListener("mouseup",o.rotateMouseUpFunction,!1)}};f.prototype.resetTilt=function(){var e=-this.getCamera().pitch-Cesium.Math.toRadians(50);this.tilt(Cesium.Math.toDegrees(e))};f.prototype.resetRotation=function(e){var t,o=new $.Deferred;t=-this.getCamera().heading;for(;t<-Math.PI;)t+=2*Math.PI;for(;t>Math.PI;)t-=2*Math.PI;e?e.callback=function(){o.resolve()}:o.resolve();if(this.parent.viewer&&this.parent.viewer.trackedEntity){this.getCamera().rotate(Cesium.Cartesian3.fromDegrees(0,90),t)}else{var r=u(this.parent.viewer.scene);r&&g(this.parent.viewer.scene,t,r,e)}return o};f.prototype.customCollisionDetection=function(){var e,t,o=new Cesium.Matrix4,r=new Cesium.Cartographic,i=this.parent.viewer.scene,n=this.parent.viewer.scene.camera,a=i.screenSpaceCameraController,l=(a.enableCollisionDetection,a.minimumCollisionTerrainHeight),s=a.minimumZoomDistance,p=i.globe,c=p.ellipsoid;i.mapProjection;if(!Cesium.Matrix4.equals(n.transform,Cesium.Matrix4.IDENTITY)){e=Cesium.Matrix4.clone(n.transform,o);t=Cesium.Cartesian3.magnitude(n.position);n._setTransform(Cesium.Matrix4.IDENTITY)}var u=r;c.cartesianToCartographic(n.position,u);var g=!1;if(u.height<l){var d=p.getHeight(u);if(void 0!==d&&null!==d){d+=s;if(u.height<d){u.height=d;c.cartographicToCartesian(u,n.position);g=!0}}}if(void 0!==e&&null!==e){n._setTransform(e);if(g){Cesium.Cartesian3.normalize(n.position,n.position);Cesium.Cartesian3.negate(n.position,n.direction);Cesium.Cartesian3.multiplyByScalar(n.position,Math.max(t,s),n.position);Cesium.Cartesian3.normalize(n.direction,n.direction);Cesium.Cartesian3.cross(n.direction,n.up,n.right);Cesium.Cartesian3.cross(n.right,n.direction,n.up)}}};f.prototype.limitCameraToInitExtent=function(){var e=this.viewer.camera.positionCartographic.clone();if(!(e.longitude>=this.initExtent.west&&e.longitude<=this.initExtent.east&&e.latitude>=this.initExtent.south&&e.latitude<=this.initExtent.north)){var t=this.viewer.scene.screenSpaceCameraController.maximumZoomDistance,o=.05*e.height/t;e.longitude=Math.max(this.initExtent.west-o,e.longitude);e.latitude=Math.max(this.initExtent.south-o,e.latitude);e.longitude=Math.min(this.initExtent.east+o,e.longitude);e.latitude=Math.min(this.initExtent.north+o,e.latitude);this.viewer.camera.setView({destination:Cesium.Ellipsoid.WGS84.cartographicToCartesian(e),orientation:{heading:this.viewer.camera.heading,pitch:this.viewer.camera.pitch}})}this.viewer.scene.screenSpaceCameraController.minimumZoomDistance=e.height>1800?400:200};var y,m,v,C,T,S,_,x,P,L,w=function(e){var t,o=!1,r=null,i=null,n=null,a=e.map.getResolution,l=function(){var t=new $.Deferred;if(i)t.resolve();else{TC.control.ResultsPanel||TC.syncLoadJS(TC.apiLocation+"TC/control/ResultsPanel");const o=e.map.getControlsByClass(TC.control.ResultsPanel).filter(function(e){return"chart"===e.options.content})[0],r=o?o._$div:$("<div>").appendTo(e.map._$div);e.map.addControl("ResultsPanel",{div:r,content:"table",titles:{main:e.getLocaleString("threed.rs.panel.gfi"),max:e.getLocaleString("threed.rs.panel.gfi")}}).then(function(o){i=o;e.ctlResultsPanel=i;t.resolve()})}return t},s=function(){e.map3D.removeFeature.call(e,r);r=null};if(n=e.map.getControlsByClass(TC.control.FeatureInfo)[0]){t=n.displayMode;$.when(l()).then(function(){n.setDisplayMode(TC.control.FeatureInfoCommons.displayMode.RESULTS_PANEL);e.map.on(TC.Consts.event.RESULTSPANELCLOSE,function(e){e.control===n.getDisplayControl()&&(n.querying||s())})})}this.clear=function(){n.closeResults();s();e.ctlResultsPanel.close()};this.reset=function(){this.clear();n.setDisplayMode(t);e.map.getResolution=a};this.send=function(t){var i=new $.Deferred;o=!0;n.displayMode!==TC.control.FeatureInfoCommons.displayMode.RESULTS_PANEL&&n.setDisplayMode(TC.control.FeatureInfoCommons.displayMode.RESULTS_PANEL);n.resultsPanel&&n.resultsPanel.close();e.waiting||(e.waiting=e.map.getLoadingIndicator().addWait());!function(t){if(r)r.position=t;else{TC.control.FeatureInfoCommons.prototype.markerStyle;var o={position:t,billboard:{image:TC.Util.getBackgroundUrlFromCss(e.CLASS+"-marker"),eyeOffset:new Cesium.Cartesian3(0,0,-100),verticalOrigin:Cesium.VerticalOrigin.BOTTOM,heightReference:Cesium.HeightReference.CLAMP_TO_GROUND}};r=e.map3D.addNativeFeature.call(e,o)}e.viewer.scene.requestRender()}(t);$.when(l()).then(function(){var r,a=Cesium.Ellipsoid.WGS84.cartesianToCartographic(t);r=e.map3D.crs!==e.map.crs?TC.Util.reproject([Cesium.Math.toDegrees(a.longitude),Cesium.Math.toDegrees(a.latitude)],e.map3D.crs,e.map.crs):[Cesium.Math.toDegrees(a.longitude),Cesium.Math.toDegrees(a.latitude)];e.map.options.pixelTolerance||TC.Cfg.pixelTolerance;for(var l,s=e.viewer.scene.globe._surface._tilesToRender,p=0;!l&&p<s.length;++p){var c=s[p];Cesium.Rectangle.contains(c.rectangle,a)&&(l=c)}if(!l)return i;for(var u=l.data.imagery,g=u.length-1;g>=0;--g){if(!u[g].readyImagery)return i}var d=l.tilingScheme.tileXYToNativeRectangle(l.x,l.y,l.level),h=(u.filter(function(e){return e.readyImagery.imageryLayer.isBaseLayer()})[0]||{}).readyImagery;e.map.getResolution=function(){var t=e.map3D.crs!==e.map.crs?TC.Util.reproject([d.west,d.south],e.map3D.crs,e.map.crs):[d.west,d.south],o=e.map3D.crs!==e.map.crs?TC.Util.reproject([d.east,d.north],e.map3D.crs,e.map.crs):[d.east,d.north],r=(o[0]-t[0])/(h&&h.imageryLayer.imageryProvider.tileWidth||256),i=(o[1]-t[1])/(h&&h.imageryLayer.imageryProvider.tileHeight||256);return Math.max(r,i)}.bind(e,h,d);var f=e;e.map.one(TC.Consts.event.NOFEATUREINFO,function(e){o=!1;f.map3D.linked2DControls.geolocation.track&&f.map3D.linked2DControls.geolocation.track.$info.addClass(TC.Consts.classes.HIDDEN);f.map3D.linked2DControls.geolocation.resultsPanelChart&&f.map3D.linked2DControls.geolocation.resultsPanelChart.close();i.resolve(e)});e.map.one(TC.Consts.event.FEATUREINFO,function(e){o=!1;f.map3D.linked2DControls.geolocation.track&&f.map3D.linked2DControls.geolocation.track.$info.addClass(TC.Consts.classes.HIDDEN);f.map3D.linked2DControls.geolocation.resultsPanelChart&&f.map3D.linked2DControls.geolocation.resultsPanelChart.close();i.resolve(e)});n.isActive;n.isActive=!0;n.beforeRequest({xy:[0,0]});n.callback(r)});return i};this.get2DMarker=function(){return n.filterFeature};this.isPending=function(){return o}},b=function(e){this.layerCrs=null;var t,o=["Contents","TileMatrixSet"],r=function(e,t,o){if(o<t.length-1)return e.hasOwnProperty(t[o])?r(e[t[o]],t,++o):null;if(e instanceof Array){for(var i=[],n=0;n<e.length;n++)e[n].hasOwnProperty(t[o])&&i.push(e[n][t[o]]);return i}return e[t[o]]},i=function(e){var i=new $.Deferred,n=function(e,t){if((capsURL=TC.Util.isOnCapabilities(e.url))&&(caps=TC.capabilities[capsURL]))for(var i=r(caps,o,0),n=0;n<i.length;n++)if(i[n].Identifier===t)return r(i[n],["TileMatrix","Identifier"],0);return null}(e,this.layerCrs),a={url:new t({url:e.options.urlPattern},e),layer:e.layerNames,style:"default",format:e.format||e.options.format,tileMatrixSetID:this.layerCrs,tileMatrixLabels:n,tilingScheme:new Cesium.GeographicTilingScheme};i.resolve(new Cesium.WebMapTileServiceImageryProvider(a));return i},n=function(){try{var e=new XMLHttpRequest;e.open("GET","#",!0);e.responseType="blob";return"blob"===e.responseType}catch(e){return!1}}();function a(e,t){var o=e.request;o.url=e.url;o.requestFunction=function(){var o=e.url,r=!1;e.isDataUri||e.isBlobUri||(r=e.isCrossOriginUrl);var i=Cesium.when.defer();!function(e,t,o,r){var i=function(t){var i=new Image;i.onload=function(e){if(e.getWebGLUrl==TC.layer.Raster.prototype._onQuarantine){e._vaccinated=!0;e.getWebGLUrl=e.getByUrl_}r.resolve(i)}.bind(i,e);i.onerror=function(e,t){if(e._vaccinated)r.reject(t);else{e.getWebGLUrl==TC.layer.Raster.prototype._onQuarantine&&e._retryAttempts>100?e.getWebGLUrl=e.getByProxy_:e.getWebGLUrl==TC.layer.Raster.prototype._onQuarantine&&(e._retryAttempts=e._retryAttempts+1||0);r.reject(t)}}.bind(i,e);o&&(Cesium.TrustedServers.contains(t)?i.crossOrigin="use-credentials":i.crossOrigin="");i.src=t};e.getWebGLUrl===TC.layer.Raster.prototype.getWebGLUrl?e.getWebGLUrl.call(e,t).then(i):i(e.getWebGLUrl(t))}(e.layer,o,r&&t,i);return i.promise};var r=Cesium.RequestScheduler.request(o);if(Cesium.defined(r))return r.otherwise(function(r){return o.state!==Cesium.RequestState.FAILED?Cesium.when.reject(r):e.retryOnError(r).then(function(i){if(i){o.state=Cesium.RequestState.UNISSUED;o.deferred=void 0;return a(e,t)}return Cesium.when.reject(r)})})}var l=function(e,t){Cesium.defined(t)&&Cesium.deprecationWarning("Resource.fetchImage.allowCrossOrigin","The allowCrossOrigin parameter has been deprecated and will be removed in Cesium 1.44. It no longer needs to be specified.");e=Cesium.defaultValue(e,!1);t=Cesium.defaultValue(t,!0);!function(e){if(e.state===Cesium.RequestState.ISSUED||e.state===Cesium.RequestState.ACTIVE)throw new Cesium.RuntimeError("The Resource is already being fetched.");e.state=Cesium.RequestState.UNISSUED;e.deferred=void 0}(this.request);if(!n||this.isDataUri||this.isBlobUri||!this.hasHeaders&&!e)return a(this,t);var o=this.fetchBlob();if(Cesium.defined(o)){var r,i;return o.then(function(e){if(Cesium.defined(e)){i=e;var t=window.URL.createObjectURL(e);return a(r=new Cesium.Resource({url:t}))}}).then(function(e){if(Cesium.defined(e)){window.URL.revokeObjectURL(r.url);e.blob=i;return e}}).otherwise(function(e){Cesium.defined(r)&&window.URL.revokeObjectURL(r.url);return Cesium.when.reject(e)})}};this.convert=function(e,o){this.layerCrs=o;t||function(){(t=function(e,t){Cesium.Resource.call(this,e);this.layer=t}).prototype.constructor=t;t.prototype=Object.create(Cesium.Resource.prototype,{});t.prototype.clone=function(e){var o=Cesium.Resource.prototype.clone.call(this,e);Cesium.defined(e)||(e=new t({url:this._url},this.layer));e._url=o._url;e._queryParameters=o._queryParameters;e._templateValues=o._templateValues;e.headers=o.headers;e.proxy=o.proxy;e.retryCallback=o.retryCallback;e.retryAttempts=o.retryAttempts;e._retryCount=0;e.request=o.request;return e};t.prototype.fetchImage=l}();switch(!0){case TC.Consts.layerType.WMTS==e.type:return i.call(this,e);case TC.Consts.layerType.WMS==e.type:return function(e){var o=new $.Deferred,r={url:new t({url:e.url},e),layers:e.layerNames,parameters:{version:"1.3.0",transparent:!0,format:e.format||e.options.format}},i=function(){var t=[];if(e.capabilities&&e.capabilities.Capability&&e.capabilities.Capability.Layer&&e.names.length>0)for(var o=e.names.slice(0),r=function t(o,r){if(o){for(var i=0;i<o.length;i++){var n=o[i];if(e.compareNames(e.wrap.getName(n),r))return n.EX_GeographicBoundingBox}return t(n.Layer,r)}};o.length>0;){var i=r([e.capabilities.Capability.Layer],o.pop());null!==i&&t.push(i)}return t}();i&&(e.geoBBox=i);o.resolve(new Cesium.WebMapServiceImageryProvider(r));return o}.call(this,e)}}},R=function(){var e=null,t=function(e,t){e instanceof Array&&(e="rgba("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")");var o=Cesium.Color.fromCssColorString(e);return void 0!==t?o.withAlpha(t):o},o=function(e,t,o){for(var r in t){var i=e[t[r].prop];if(void 0!==i)if("function"==typeof i){var n=i(o);n&&(t[r].val=n)}else t[r].val=i}},r=function(e){var t;t=void 0==(t=e.layer.hasOwnProperty("styles")?e.layer.styles:TC.Defaults.styles)[e.STYLETYPE]?t["polyline"===e.STYLETYPE?"line":e.STYLETYPE]:t["multipolygon"===e.STYLETYPE?"polygon":e.STYLETYPE];return t=$.extend({},t,e.options,e.getStyle())};function i(e){return this.provider.sampleTerrainMostDetailed(e.map(function(e){return Cesium.Cartographic.fromCartesian(e)}))}function n(e,t,o,r){r(new Cesium.Entity({id:e,polyline:{positions:Cesium.Ellipsoid.WGS84.cartographicArrayToCartesianArray(t),material:o.material,width:o.width,granularity:Cesium.Math.toRadians(.1)}}))}var a=function(e){var a={},l=r(e);a.options=function(){var r,i={},n={color:{prop:"fillColor"},opacity:{prop:"fillOpacity"},outlineColor:{prop:"strokeColor"},outlineOpacity:{prop:"strokeOpacity"},width:{prop:"strokeWidth"}};o(l,n,e);n.color.hasOwnProperty("val")&&(r=n.opacity.hasOwnProperty("val")?t(n.color.val,n.opacity.val):t(n.color.val));i.color=Cesium.ColorGeometryInstanceAttribute.fromColor(r);n.outlineColor.hasOwnProperty("val")&&(r=n.outlineOpacity.hasOwnProperty("val")?t(n.outlineColor.val,n.outlineOpacity.val):t(n.outlineColor.val));i.outlineColor=r;n.width.hasOwnProperty("val")&&(i.width=n.width.val);return i};TC.feature.MultiPolygon&&e instanceof TC.feature.MultiPolygon?a.geometryType=function(t,o){for(var r,a=new $.Deferred,l=[],s=[],p=[],c=function(t){var r=new $.Deferred;Cesium.when(i.call(this,t),function(t){n(e.id+"outLine"+p.length,t,{material:o.outlineColor,width:o.width},function(e){p.push(e);r.resolve()})});return r},u=0;u<t.length;u++){for(var g=0;g<t[u].length;g++){var d;if(0==g){l.push(c.call(this,t[u][0]));d=new Cesium.PolygonHierarchy(t[u][0])}else{l.push(c.call(this,t[u][g]));d.holes.push(new Cesium.PolygonHierarchy(t[u][g]))}}s.push((r=d,new Cesium.GeometryInstance({id:e.id,geometry:new Cesium.PolygonGeometry({polygonHierarchy:r}),attributes:{color:o.color}})))}$.when.apply($,l).then(function(){l=[];a.resolve([new Cesium.GroundPrimitive({geometryInstances:s}),p])});return a}:TC.feature.Polygon&&e instanceof TC.feature.Polygon&&(a.geometryType=function(t,o){var r=new $.Deferred;$.isArray(t)&&1===t.length&&$.isArray(t[0])&&(t=t[0]);Cesium.when(i.call(this,t),function(i){n(e.id+"outLine",i,{material:o.outlineColor,width:o.width},function(i){r.resolve([new Cesium.GroundPrimitive({geometryInstances:new Cesium.GeometryInstance({id:e.id,geometry:new Cesium.PolygonGeometry({polygonHierarchy:new Cesium.PolygonHierarchy(t)}),attributes:{color:o.color}})}),i])})});return r});return a},l=function(a){var l={},s=r(a);l.options=function(){var e,r={},i={color:{prop:"strokeColor"},opacity:{prop:"strokeOpacity"},width:{prop:"strokeWidth"}};o(s,i,a);i.width.hasOwnProperty("val")&&(r.width=i.width.val);i.color.hasOwnProperty("val")&&(e=i.opacity.hasOwnProperty("val")?t(i.color.val,i.opacity.val):t(i.color.val));r.color=e;return r};TC.feature.MultiPolyline&&a instanceof TC.feature.MultiPolyline?l.geometryType=function(t,o){var r=[],l=new $.Deferred,s=[];if(1==t.length){t=t[0];var p=new $.Deferred;s.push(p);Cesium.when(i.call(this,t),function(e){n(a.id,e,{material:o.color,width:o.width},function(e){r.push(e);p.resolve()})})}else{(function(t){var o;if(1==t.length){var r,i,n,a,l=t[0];r=new Cesium.Cartesian3(l.x-1e3,l.y,l.z);i=new Cesium.Cartesian3(l.x,l.y-1e3,l.z);n=new Cesium.Cartesian3(l.x+1e3,l.y,l.z);a=new Cesium.Cartesian3(l.x,l.y+1e3,l.z);o=Cesium.Rectangle.fromCartesianArray([r,i,n,a],Cesium.Ellipsoid.WGS84)}else o=Cesium.Rectangle.fromCartesianArray(t,Cesium.Ellipsoid.WGS84);var s=e.camera.getRectangleCameraCoordinates(o),p=Cesium.Cartesian3.distance(s,Cesium.BoundingSphere.fromPoints(t).center),c=e.camera.frustum.getPixelDimensions(e.drawingBufferWidth,e.drawingBufferHeight,p,new Cesium.Cartesian2);c=Math.max(c.x,c.y);Math.round(c)})((t=t.sort(function(e,t){return e.length>t.length?-1:e.length<t.length?1:0}))[0]);for(var c=0;c<t.length;c++){p=new $.Deferred;s.push(p);Cesium.when(i.call(this,t[c]),function(e){n(a.id,e,{material:o.color,width:o.width},function(e){r.push(e);p.resolve()})})}}$.when.apply($,s).then(function(){s=[];l.resolve(r)});return l}:TC.feature.Polyline&&a instanceof TC.feature.Polyline&&(l.geometryType=function(e,t){var o=new $.Deferred;Cesium.when(i.call(this,e),function(e){n(a.id,e,{material:t.color,width:t.width},function(e){o.resolve(e)})});return o});return l},s=function(e){var i={},n=r(e);i.options=function(){var r={},i={rotation:{prop:"angle"},label:{prop:"label"},fontSize:{prop:"fontSize"},fontColor:{prop:"fontColor"},outlineLabelColor:{prop:"labelOutlineColor"},outlineLabelWidth:{prop:"labelOutlineWidth"},anchor:{prop:"anchor"},height:{prop:"height"},width:{prop:"width"},url:{prop:"url"},color:{prop:"fillColor"},opacity:{prop:"fillOpacity"},outlineColor:{prop:"strokeColor"},outlineOpacity:{prop:"strokeOpacity"},outlineWidth:{prop:"strokeWidth"},radius:{prop:"radius"}};o(n,i,e);if(i.anchor.hasOwnProperty("val")){!i.url.hasOwnProperty("val")&&e.options.url?r.url=e.options.url:r.url=i.url.val;r.anchor=i.anchor.val}i.height.hasOwnProperty("val")&&(r.height=i.height.val);i.width.hasOwnProperty("val")&&(r.width=i.width.val);i.rotation.hasOwnProperty("val")&&(r.rotation=i.rotation.val);i.label.hasOwnProperty("val")&&(r.label=i.label.val);i.fontSize.hasOwnProperty("val")&&(r.fontSize=i.fontSize.val);i.fontColor.hasOwnProperty("val")&&(r.fontColor=t(i.fontColor.val));i.outlineLabelColor.hasOwnProperty("val")&&(r.outlineLabelColor=t(i.outlineLabelColor.val));i.outlineLabelWidth.hasOwnProperty("val")&&(r.outlineLabelWidth=i.outlineLabelWidth.val);i.color.hasOwnProperty("val")&&(i.opacity.hasOwnProperty("val")?r.color=t(i.color.val,i.opacity.val):r.color=t(i.color.val));i.outlineColor.hasOwnProperty("val")&&(i.outlineOpacity.hasOwnProperty("val")?r.outlineColor=t(i.outlineColor.val,i.outlineOpacity.val):r.outlineColor=t(i.outlineColor.val));i.outlineWidth.hasOwnProperty("val")&&(r.outlineWidth=i.outlineWidth.val);i.radius.hasOwnProperty("val")&&(r.radius=i.radius.val);return r};if(TC.feature.Marker&&e instanceof TC.feature.Marker)i.geometryType=function(t,o){var r={id:e.id,name:e.id,position:t[0],billboard:{image:o.url,width:o.width,height:o.height,eyeOffset:new Cesium.Cartesian3(0,0,-100),verticalOrigin:Cesium.VerticalOrigin.BOTTOM,heightReference:Cesium.HeightReference.CLAMP_TO_GROUND}};o.anchor&&o.anchor.length>0&&(r.pixelOffset=new Cesium.Cartesian2(o.anchor[0],o.anchor[1]));return o.label?[r,{id:e.id,name:e.id,position:t[0],label:{text:o.label,font:"14pt sans-serif",heightReference:Cesium.HeightReference.CLAMP_TO_GROUND,horizontalOrigin:Cesium.HorizontalOrigin.CENTER,verticalOrigin:Cesium.VerticalOrigin.BOTTOM,fillColor:o.fontColor,showBackground:!0,eyeOffset:new Cesium.Cartesian3(0,0,-100)}}]:r};else if(TC.feature.Point&&e instanceof TC.feature.Point){var a=new Cesium.PinBuilder;i.geometryType=function(t,o){var r=o.label;switch(!0){case r&&/^([A-Z])\w+$/gi.test(r):case r&&!/^[0-9]*\-{0,1}[a-z]{0,4}$/gi.test(r):return{id:e.id,name:e.id,position:t[0],label:{text:o.label,font:"14px san-serif Arial",showBackground:!0,eyeOffset:new Cesium.Cartesian3(0,0,-100),heightReference:Cesium.HeightReference.CLAMP_TO_GROUND,horizontalOrigin:Cesium.HorizontalOrigin.CENTER,verticalOrigin:Cesium.VerticalOrigin.BASELINE,fillColor:Cesium.Color.WHITE}};case/^[0-9]*\-{0,1}[a-z]{0,4}$/gi.test(r):return{id:e.id,name:e.id,position:t[0],billboard:{image:a.fromText(r,o.fontColor,48).toDataURL(),eyeOffset:new Cesium.Cartesian3(0,0,-100),verticalOrigin:Cesium.VerticalOrigin.BOTTOM,heightReference:Cesium.HeightReference.CLAMP_TO_GROUND}};default:return{id:e.id,name:e.id,position:t[0],billboard:{image:a.fromColor(e.options.fillColor?new Cesium.Color(e.options.fillColor):Cesium.Color.fromCssColorString(TC.Cfg.styles.point.fillColor),32).toDataURL(),eyeOffset:new Cesium.Cartesian3(0,0,-100),verticalOrigin:Cesium.VerticalOrigin.BOTTOM,horizontalOrigin:Cesium.HorizontalOrigin.CENTER,heightReference:Cesium.HeightReference.CLAMP_TO_GROUND}}}}}return i};this.convert=function(i,n,p,c){e=i;var u,g,d,h,f,y=!1,m=[],v=function(e,t){if($.isArray(e)){p!==c&&(e=TC.Util.reproject(e,p,c));t.push(e.length>2?Cesium.Cartesian3.fromDegrees(e[0],e[1],e[2]):Cesium.Cartesian3.fromDegrees(e[0],e[1]))}},C=n.geometry,T=function(e,t){if($.isArray(e))for(var o=0;o<e.length;o++)v(e[o],t)},S=function(e,t){if($.isArray(e))for(var o=0;o<e.length;o++){t.push([]);T(e[o],t[t.length-1])}};switch(!0){case TC.feature.Circle&&n instanceof TC.feature.Circle:T(C,m);g=function(e){var i={},n=r(e);i.options=function(){var r,i={},a={color:{prop:"strokeColor"},opacity:{prop:"fillOpacity"},outlineColor:{prop:"fillColor"},outlineOpacity:{prop:"strokeOpacity"},width:{prop:"strokeWidth"}};o(n,a,e);a.color.hasOwnProperty("val")&&(r=a.opacity.hasOwnProperty("val")?t(a.color.val,a.opacity.val):t(a.color.val));i.color=Cesium.ColorGeometryInstanceAttribute.fromColor(r);a.outlineColor.hasOwnProperty("val")&&(r=a.outlineOpacity.hasOwnProperty("val")?t(a.outlineColor.val,a.outlineOpacity.val):t(a.outlineColor.val));i.outlineColor=Cesium.ColorGeometryInstanceAttribute.fromColor(r);a.width.hasOwnProperty("val")&&(i.width=a.width.val);return i};i.geometryType=function(t,o){return new Cesium.GroundPrimitive({geometryInstances:new Cesium.GeometryInstance({id:e.id,geometry:new Cesium.CircleGeometry({center:t[0],radius:e.geometry[1]}),attributes:{color:o.color}})})};return i}.call(self,n);break;case TC.feature.MultiPolygon&&n instanceof TC.feature.MultiPolygon:f=C;if($.isArray(f)){!function(e){if($.isArray(e))for(var t=0;t<e.length;t++){m.push([]);S(e[t],m[m.length-1])}}(f);g=a.call(self,n);y=!0}break;case TC.feature.Polygon&&n instanceof TC.feature.Polygon||TC.feature.MultiPolyline&&n instanceof TC.feature.MultiPolyline:h=C;if($.isArray(h)){S(h,m);if(n instanceof TC.feature.Polygon){g=a(n);y=!0}else if(n instanceof TC.feature.MultiPolyline){g=l(n);y=!0}}break;case TC.feature.Polyline&&n instanceof TC.feature.Polyline:d=C;if($.isArray(d)){T(d,m);g=l(n);y=!0}break;case TC.feature.Marker&&n instanceof TC.feature.Marker:case TC.feature.Point&&n instanceof TC.feature.Point:T(d=[C],m);g=s(n)}if(0==m.length)return null;(u={id:n.id,attributes:n.data,boundigSphere:Cesium.BoundingSphere.fromPoints(m)}).geometry=y?function(e){g.provider=e;return g.geometryType(m,g.options())}:g.geometryType(m,g.options());return u}};e.map3D=(y={baseMap:"",baseMaps:[],baseVector:""},m=new b(/(EPSG\:?4326)/i),v=new R,C=function(e){var t=e;switch(!0){case e instanceof Cesium.GroundPrimitive:this.viewer.scene.groundPrimitives.add(e);break;case e instanceof Object&&e.hasOwnProperty("billboard"):this.viewer.billboardCollection||(this.viewer.billboardCollection=this.viewer.scene.primitives.add(new Cesium.BillboardCollection({scene:this.viewer.scene})));t=this.viewer.billboardCollection.add({position:e.position,image:e.billboard.image,verticalOrigin:e.billboard.verticalOrigin,heightReference:e.billboard.heightReference});break;case e instanceof Object:t=this.viewer.entities.add(e)}this.viewer.scene.requestRender();return t},T=function(e,t,o){e.vector2DFeatures.hasOwnProperty(t)?e.vector2DFeatures[t].push(o):e.vector2DFeatures[t]=[o]},S=[TC.Consts.event.BEFOREBASELAYERCHANGE,TC.Consts.event.BASELAYERCHANGE,TC.Consts.event.LAYERADD,TC.Consts.event.LAYERREMOVE,TC.Consts.event.LAYERVISIBILITY,TC.Consts.event.LAYEROPACITY,TC.Consts.event.LAYERORDER,TC.Consts.event.FEATUREADD,TC.Consts.event.FEATUREREMOVE,TC.Consts.event.FEATURESCLEAR,TC.Consts.event.ZOOMTO],_=function(){if(!this.map3D.trackingEntity){var e=this.map3D.linked2DControls.geolocation,t=e.layerTracking.features.filter(function(e){return e instanceof TC.feature.Polyline});if(t&&t.length>0){var o=[],r=new Cesium.Entity({id:"trackingEntity",polyline:{positions:new Cesium.CallbackProperty(function(e,r){if(t[0].geometry.length>o.length){var i=t[0].geometry.slice(o.length).map(function(e){var t=e;this.map.crs!==this.map3D.crs&&(t=TC.Util.reproject(e,this.map.crs,this.map3D.crs));return Cesium.Cartographic.fromDegrees(t[0],t[1],e[2])}.bind(this));Cesium.when(this.viewer.terrainProvider.sampleTerrainMostDetailed(i),function(e){e=e instanceof Array?Cesium.Ellipsoid.WGS84.cartographicArrayToCartesianArray(e):[Cesium.Ellipsoid.WGS84.cartographicToCartesian(e)];return o=o.concat(e)})}return o}.bind(this),!1),width:3,material:new Cesium.PolylineDashMaterialProperty({color:new Cesium.CallbackProperty(function(t,o){return Cesium.Color.fromAlpha(new Cesium.Color(0,255,209),e.track.renderTrack.is(":checked")?1:0)}.bind(this),!1),gapColor:Cesium.Color.TRANSPARENT})}});this.map3D.trackingEntity=this.viewer.entities.add(r);this.viewer.scene.requestRender()}}},x=function(e){var t=this.map3D.linked2DControls.geolocation;switch(!0){case t.Const.Event.IMPORTEDTRACK.indexOf(e.type)>-1:case e.target.className.indexOf("draw")>-1&&$(e.target).parent().hasClass(t.Const.Classes.SELECTEDTRACK):case!$(e.target).parent().hasClass(t.Const.Classes.SELECTEDTRACK):case e.target.className.indexOf("stop")>-1:if(this.mapIs3D){this.viewer.clock.shouldAnimate=!1;this.viewer.clock.currentTime=Cesium.JulianDate.fromDate(new Date)}if(this.map3D.trackDataSource){if(this.map3D.trackDataSource.length>0){var o=this.map3D.trackDataSource.get(0).entities.values[0];this.viewer.entities.removeById(o.id)}this.map3D.trackDataSource.destroy();delete this.map3D.trackDataSource}t.chartProgressClear();e.custom&&t.getSelectedTrack().find(t.Const.Selector.STOP).click();break;case e.target.className.indexOf("play")>-1:this.viewer.clock.shouldAnimate=!1;break;case e.target.className.indexOf("pause")>-1:this.viewer.clock.shouldAnimate=!0;break;case e.target.className.indexOf("back")>-1:case e.target.className.indexOf("for")>-1:this.viewer.clock.multiplier=t.simulate_speed}},P=function(e){var t,o=this;o.map.controls.map(function(t){if(o.ctrlsToMng.indexOf(t)<0)switch(!0){case o.direction.TO_TWO_D==e:t.enable();break;case o.direction.TO_THREE_D==e:t.disable()}});switch(!0){case o.direction.TO_TWO_D==e:$("[data-no-3d]").removeClass(TC.Consts.classes.THREED_HIDDEN);o.ctrlsToMng.forEach(function(e){e._$div.removeClass(TC.Consts.classes.THREED)});break;case o.direction.TO_THREE_D==e:$("[data-no-3d]").addClass(TC.Consts.classes.THREED_HIDDEN);o.ctrlsToMng.forEach(function(e){e._$div.addClass(TC.Consts.classes.THREED)})}!o.map3D.linked2DControls.coordinates&&o.allowedControls.indexOf("coordinates")>-1&&(o.map3D.linked2DControls.coordinates=o.ctrlsToMng.filter(function(e){return e instanceof TC.control.Coordinates})[0]);if(t=o.map3D.linked2DControls.coordinates){$viewport=$(t.map.wrap.getViewport());if(o.direction.TO_THREE_D===e){$viewport.off(TC.Consts.event.MOUSEMOVE+".coords");t.isGeo=!0;t.crs=o.map3D.crs}else{t.isGeo=o.map.wrap.isGeo();t.crs=o.map.crs;$viewport.on(TC.Consts.event.MOUSEMOVE+".coords",function(e){t.onMouseMove(e)})}t.geoCrs=o.map3D.crs;t.render();new Cesium.ScreenSpaceEventHandler(o.viewer.scene.canvas,!1).setInputAction(function(e){if(o.viewer){var r=o.viewer.camera.getPickRay(e.endPosition||e.position),i=o.viewer.scene.globe.pick(r,o.viewer.scene);if(i){var n,a,l,s=Cesium.Ellipsoid.WGS84.cartesianToCartographic(i);n=Cesium.Math.toDegrees(s.latitude);a=Cesium.Math.toDegrees(s.longitude);var p=TC.Util.getMapLocale(o.map);l=Math.round(s.height).toLocaleString(p);if(TC.Util.detectMobile()){var c=o.map3D.crs!==o.map.crs?TC.Util.reproject([a,n],o.map3D.crs,o.map.crs):[a,n];l>0&&c.push(l);t.clear();t.coordsToClick({coordinate:c,cssClass:o.classes.COORDSTHREEDMARKER});t.latLon=[n,a];l>0&&t.latLon.push(l+" m");t.update()}else{t.latLon=[n,a];l>0&&t.latLon.push(l+" m");t.update()}}else t.clear()}},TC.Util.detectMobile()?Cesium.ScreenSpaceEventType.LEFT_CLICK:Cesium.ScreenSpaceEventType.MOUSE_MOVE);$("."+o.classes.MAPTHREED).on("mouseout.tc",function(e){t.isPointerOver(e)||t.clear()})}if(o.direction.TO_THREE_D===e){o.map3D.linked2DControls.legend=new function(e){var t=e.map.getControlsByClass(TC.control.Legend)[0];this.refresh=function(){t&&e.map3D.workLayers.length>0&&t.loadGraphics()}}(o);o.map3D.linked2DControls.featureInfo||(o.map3D.linked2DControls.featureInfo=new w(o));new Cesium.ScreenSpaceEventHandler(o.viewer.canvas,!1).setInputAction(function(e){if(!o.viewer.trackedEntity){var t=o.viewer.camera.getPickRay(e.position),r=o.viewer.scene.globe.pick(t,o.viewer.scene);r&&o.map3D.getInfoOnPickedPosition.call(o,r)}},Cesium.ScreenSpaceEventType.LEFT_CLICK)}!o.map3D.linked2DControls.geolocation&&o.allowedControls.indexOf("geolocation")>-1&&(o.map3D.linked2DControls.geolocation=o.ctrlsToMng.filter(function(e){return e instanceof TC.control.Geolocation})[0]);if(o.map3D.linked2DControls.geolocation){var r=o.map3D.linked2DControls.geolocation;if(o.direction.TO_THREE_D===e){r._CHART_SIZE=$.extend({},r.CHART_SIZE);r.CHART_SIZE.MIN_HEIGHT=80;r.CHART_SIZE.MIN_WIDTH=300;var i=[r.Const.Selector.STOP,r.Const.Selector.PAUSE,r.Const.Selector.BACKWARD,r.Const.Selector.FORWARD,r.Const.Selector.DRAW],n=x.bind(o);r.reset=function(){r.CHART_SIZE=r._CHART_SIZE;TC.wrap.control.Geolocation.prototype.setTracking=r._setTracking;TC.wrap.control.Geolocation.prototype.simulateTrack=r._wrap_simulateTrack;TC.wrap.control.Geolocation.prototype.showElevationMarker=r._wrap_showElevationMarker;TC.wrap.control.Geolocation.prototype.hideElevationMarker=r._wrap_hideElevationMarker;r.renderInfoNewPosition=r._renderInfoNewPosition;r.setFormatInfoNewPosition=r._setFormatInfoNewPosition;r.simulateTrack=r._simulateTrack;r.elevationTrack=r._elevationTrack;i.forEach(function(e){$(document).off("click",o.map3D.linked2DControls.geolocation._classSelector+" "+e,n)});r.$events.off(r.Const.Event.IMPORTEDTRACK,n)};i.forEach(function(e){$(document).on("click",o.map3D.linked2DControls.geolocation._classSelector+" "+e,n)});r.$events.on(r.Const.Event.IMPORTEDTRACK,n);var a,l=o,s=!1;r._setTracking=TC.wrap.control.Geolocation.prototype.setTracking;TC.wrap.control.Geolocation.prototype.setTracking=function(e){r._setTracking.call(r.wrap,e);if(e)r.$events.on(r.Const.Event.POSITIONCHANGE,_.bind(o));else{s=!1;r.$events.off(r.Const.Event.POSITIONCHANGE,_.bind(o));if(o.map3D.trackingEntity){o.viewer.entities.removeById(o.map3D.trackingEntity.id);delete o.map3D.trackingEntity}}};r._elevationTrack=r.elevationTrack;r.elevationTrack=function(e,t){l.map3D.linked2DControls.featureInfo&&l.map3D.linked2DControls.featureInfo.clear();l.map3D.linked2DControls.geolocation.track.$info.hasClass(TC.Consts.classes.HIDDEN);t&&x.call(o,{target:{className:"stop"},custom:!0});r._elevationTrack.call(r,e,t)};r.getSelectedTrack().length>0&&r.hasElevation&&r.elevationTrack.call(o,r.getSelectedTrack().first(),!0);r._simulateTrack=r.simulateTrack;r.simulateTrack=function(e){var t=this.map3D.linked2DControls.geolocation;t.map.toast(t.getLocaleString("threed.interactionSimulation"),{type:TC.Consts.msgType.INFO});if(this.viewer.clock.shouldAnimate&&this.map3D.trackDataSource){a();x.call(this,{target:{className:"stop"},custom:!0})}t.simulate_speed=1;t.drawTrack(e,!1);if(t.hasElevation){t.elevationTrack(e);t.chartProgressInit()}if(t.layerTrack&&t.layerTrack.features){var o=t.layerTrack.features.filter(function(e){return e instanceof TC.feature.Polyline})[0];o&&function(e,t,o,r,i,n){var a=$.Deferred(),l=e.map(function(e){var t=e;this.map.crs!==this.map3D.crs&&(t=TC.Util.reproject(e,this.map.crs,this.map3D.crs));return Cesium.Cartographic.fromDegrees(t[0],t[1])}.bind(this));Cesium.when(this.viewer.terrainProvider.sampleTerrainMostDetailed(l),function(i){var l,s,p=0;if(t===ol.geom.GeometryLayout.XYZM){l=e[0][3];s=e[e.length-1][3]}else if(t===ol.geom.GeometryLayout.XYM){l=e[0][2];s=e[e.length-1][2]}else{e[0][3]=i[0].time=Date.now();for(var c=1;c<i.length;c++){var u,g=[];i[c].time=0;g=c+1<i.length?i.slice(c-1,c+1):i.slice(c-1);p+=u=new Cesium.EllipsoidGeodesic(g[0],g[1]).surfaceDistance;e[c][3]=i[c].time=i[c-1].time+36e5*u/n}l=i[0].time;s=i[i.length-1].time}if(0===p)for(c=1;c<i.length;c++){g=[];g=c+1<i.length?i.slice(c-1,c+1):i.slice(c-1);p+=new Cesium.EllipsoidGeodesic(g[0],g[1]).surfaceDistance}l=new Date(l).toISOString();s=new Date(s).toISOString();var d=[{id:"document",name:"CZML Model",version:"1.0"},{id:"path",name:o,availability:l+"/"+s,position:{epoch:l,cartographicRadians:i.map(function(o,r){return t===ol.geom.GeometryLayout.XYZM?[new Date(e[r][3]).toISOString(),o.longitude,o.latitude,o.height]:t===ol.geom.GeometryLayout.XYM?[new Date(e[r][2]).toISOString(),o.longitude,o.latitude,o.height]:[new Date(o.time).toISOString(),o.longitude,o.latitude,o.height]}).reduce(function(e,t){return e.concat(t)})},point:{heightReference:"NONE",pixelSize:r.radius,color:{rgba:r.fillColor},outlineColor:{rgba:r.strokeColor},outlineWidth:r.strokeWidth}}];a.resolve(d,p,e)});return a}.call(this,o.geometry,o.wrap.feature.getGeometry().layout,"track",t.markerStyle,t.lineStyle,t.walkingSpeed).then(function(t,r,i){this.map3D.trackDataSource=new Cesium.DataSourceCollection;var n=new Cesium.DataSourceDisplay({scene:this.viewer.scene,dataSourceCollection:this.map3D.trackDataSource});this.viewer.scene.preRender.addEventListener(function(e,t){n.update(t)});this.map3D.trackDataSource.add(Cesium.CzmlDataSource.load(t)).then(function(t,o,i){this.viewer.clock.shouldAnimate=!1;var n,l;n=i.clock.startTime;l=i.clock.stopTime;this.viewer.clock.startTime=n.clone();this.viewer.clock.stopTime=l.clone();this.viewer.clock.currentTime=n.clone();this.viewer.clock.clockStep=Cesium.ClockStep.TICK_DEPENDENT;this.viewer.clock.clockRange=Cesium.ClockRange.CLAMPED;this.viewer.clock.multiplier=1;var s=i.entities.values[0];s.layout=t;s.tagLI=e;s.availability=new Cesium.TimeIntervalCollection([new Cesium.TimeInterval({start:n,stop:l})]);this.viewer.entities.add(s);this.viewer.flyTo(s).then(function(){this.viewer.trackedEntity=s;var e,t=0;a=this.viewer.scene.preUpdate.addEventListener(function(i,n){if(0===this.map3D.linked2DControls.geolocation.getSelectedTrack().length||this.map3D.linked2DControls.geolocation.getSelectedTrack().length>0&&this.map3D.linked2DControls.geolocation.getSelectedTrack()&&this.map3D.linked2DControls.geolocation.getSelectedTrack().attr("data-id")!==s.tagLI.attr("data-id")||Cesium.JulianDate.greaterThanOrEquals(n,s.availability.stop)){a();x.call(this,{target:{className:"stop"},custom:!0})}else if(this.viewer.clock.shouldAnimate&&s.isAvailable(n)){e||(e=Cesium.Cartographic.fromCartesian(Cesium.Property.getValueOrUndefined(s.position,s.availability.start)));currentPosition=Cesium.Cartographic.fromCartesian(Cesium.Property.getValueOrUndefined(s.position,n));if(this.map3D.linked2DControls.geolocation.hasElevation){s.layout===ol.geom.GeometryLayout.XYZM||(s.layout,ol.geom.GeometryLayout.XYM);this.map3D.linked2DControls.geolocation.chartSetProgress({p:[e.longitude,e.latitude,e.height],d:t},[currentPosition.longitude,currentPosition.latitude,function(e,t){for(var o,r=0,i=this.map.crs!==this.map3D.crs?TC.Util.reproject(e[0],this.map.crs,this.map3D.crs):e[0],n=new Cesium.Cartographic.fromDegrees(i[0],i[1]),a=1;a<e.length;a++){i=this.map.crs!==this.map3D.crs?TC.Util.reproject(e[a],this.map.crs,this.map3D.crs):e[a];var l=new Cesium.Cartographic.fromDegrees(i[0],i[1]);r+=new Cesium.EllipsoidGeodesic(n,l).surfaceDistance;n=l;if(r>t){o=e[a-1];break}}if(o){var p=s.layout===ol.geom.GeometryLayout.XYZM?2:s.layout===ol.geom.GeometryLayout.XYZ?2:-1;if(p>-1)return o[p]}return 0}.call(this,o,t)],r,(s.layout===ol.geom.GeometryLayout.XYZM||s.layout===ol.geom.GeometryLayout.XYM)&&this.map3D.linked2DControls.geolocation._getTime(Cesium.JulianDate.toDate(s.availability.start),Cesium.JulianDate.toDate(n)))}t+=new Cesium.EllipsoidGeodesic(e,currentPosition).surfaceDistance;e=currentPosition}}.bind(this));this.viewer.clock.shouldAnimate=!0}.bind(this));this.viewer.scene.requestRender()}.bind(this,o.wrap.feature.getGeometry().layout,i))}.bind(this))}}.bind(o);r._wrap_simulateTrack=TC.wrap.control.Geolocation.prototype.simulateTrack;TC.wrap.control.Geolocation.prototype.simulateTrack=function(){this.parent.hasElevation&&this.parent.chartProgressInit()};r._wrap_showElevationMarker=TC.wrap.control.Geolocation.prototype.showElevationMarker;TC.wrap.control.Geolocation.prototype.showElevationMarker=function(e){const t=this.map3D.linked2DControls.geolocation,o=t.chart.coordinates;if(t.layerTrack.getVisibility()&&t.layerTrack.getOpacity()>0){var r=this.viewer.camera,i=this.map.crs!==this.map3D.crs?TC.Util.reproject(o[e[0].index],this.map.crs,this.map3D.crs):o[e[0].index];if(t.elevationMarker){t.elevationMarker.position=Cesium.Cartesian3.fromDegrees(i[0],i[1],r.positionCartographic.height);this.viewer.scene.requestRender()}else{var n=new Cesium.Entity({position:Cesium.Cartesian3.fromDegrees(i[0],i[1]),billboard:{image:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4AcdDDMq7Am38gAAAaFJREFUWMPtlj9rwkAYh3+R0lgKRSi4FCFmczBzp2i+gaMgmK0I3Tq0Y6HDDd0L0tJBSyGbAT9AxI+goFskumUUrDq9XVRi6WkS/xXquyRc7nie++XuOOBYx/rvJYQdqKoqNE1barMsC81mc/cCqqri+eWVfvt2f3sjBJE4CSMwn/kkXVpqj7bL0DQtUAqRTf9hhixkyAo9PnLoRbhWQNd1KIoSGqAoysrxkXXwh8cnMsw6McYCwxljMMw6GWadeBIrBSRJwnA0hivryOULgSQYY8jlC+TKOoajMWKx2Ga7wJV15OwKARCm06lv+FYX4TwJURS5fURR9A0PJBC3q0sSvH5eeLRd3t5BlEomALsKVy6CN7tJuoSJR3g4+tpeAt3eAKlkYpHEurRSycTmArVaDRfnZ7Poi74k5vBub4DT6zsAwFX8Eo7jBBdotVowjU8hbld8SXjhrlyctVXw8f4m8AR87+mO7VADWWogSx27T0S0eHrfO3bf088JdYAFkvDWzuB+JHYOXyWxNzhPYq9wfhJ7hP+UOAjc74XjWH++vgFLJ1bBWXZtUAAAAABJRU5ErkJggg==",eyeOffset:new Cesium.Cartesian3(0,0,-100),verticalOrigin:Cesium.VerticalOrigin.BOTTOM,heightReference:Cesium.HeightReference.CLAMP_TO_GROUND}});t.elevationMarker=this.map3D.addNativeFeature.call(this,n)}}}.bind(o);r._wrap_hideElevationMarker=TC.wrap.control.Geolocation.prototype.hideElevationMarker;TC.wrap.control.Geolocation.prototype.hideElevationMarker=function(){const e=this.map3D.linked2DControls.geolocation;this.map3D.removeFeature.call(this,e.elevationMarker);e.elevationMarker=null}.bind(o);r._renderInfoNewPosition=r.renderInfoNewPosition;r.renderInfoNewPosition=function(e){var t=this;t.getRenderedHtml(t.CLASS+"-tracking-toast",t.setFormatInfoNewPosition(e.pd),function(e){t.track.$info.find(".prpanel-body").html(e);t.trackingActive.set(!0);if(!s){l.map3D.linked2DControls.featureInfo&&l.map3D.linked2DControls.featureInfo.clear();l.map3D.linked2DControls.geolocation.track&&l.map3D.linked2DControls.geolocation.track.$info.removeClass(TC.Consts.classes.HIDDEN);l.map3D.linked2DControls.geolocation.resultsPanelChart&&l.map3D.linked2DControls.geolocation.resultsPanelChart.close()}s||(s=!0)})};r._setFormatInfoNewPosition=r.setFormatInfoNewPosition;r.setFormatInfoNewPosition=function(e){var t={},o=TC.Util.getMapLocale(this.map),r=this.map.crs!==this.map3D.crs?TC.Util.reproject(e.position,this.map.crs,this.map3D.crs):e.position;t.x=r[0].toLocaleString(o);t.y=r[1].toLocaleString(o);t.z=Math.round(e.altitude).toLocaleString(o);t.accuracy=Math.round(e.accuracy).toLocaleString(o);t.speed=e.speed.toLocaleString(o,{minimumFractionDigits:1,maximumFractionDigits:1});var i=new Cesium.Cartographic(Cesium.Math.toRadians(r[0]),Cesium.Math.toRadians(r[1])),n=this.viewer.scene.globe.getHeight(i);n&&(t.mdt=Math.round(n).toLocaleString(o));t.isGeo=!0;return t}.bind(o)}else if(o.map3D.linked2DControls.geolocation.getSelectedTrack().length>0&&o.map3D.linked2DControls.geolocation.hasElevation){r.CHART_SIZE.MIN_HEIGHT=r._CHART_SIZE.MIN_HEIGHT;r.CHART_SIZE.MIN_WIDTH=r._CHART_SIZE.MIN_WIDTH;r._elevationTrack.call(o.map3D.linked2DControls.geolocation,o.map3D.linked2DControls.geolocation.getSelectedTrack().first(),!0)}}},L=function(e){var t,o,r,i=this,n=function(e){var t=new Cesium.Cartesian2(this.viewer.scene.canvas.clientWidth/2,this.viewer.scene.canvas.clientHeight/2);this.map3D.zoomToCartesian.call(this,{endPosition:t},e)};if(e){t=function(e){e.stopPropagation&&e.stopPropagation();e.preventDefault&&e.preventDefault();var t=this.map.crs;this.map.options.crs!==this.map.crs&&(t=this.map.options.crs);var o=TC.Util.reproject(this.map.options.initialExtent.slice(0,2),t,this.map3D.crs),r=TC.Util.reproject(this.map.options.initialExtent.slice(2),t,this.map3D.crs),i=Cesium.Rectangle.fromDegrees(o[0],o[1],r[0],r[1]);this.map3D.flyToRectangle.call(this,i,{duration:.1});return!1}.bind(i);o=function(e){n.call(i,200)}.bind(i);r=function(e){n.call(i,-200)}.bind(i);$("."+TC.control.NavBar.prototype.CLASS+"-btn-home").on("click",t);$("."+TC.control.NavBar.prototype.CLASS+"-btn-zoomin").on("click",o);$("."+TC.control.NavBar.prototype.CLASS+"-btn-zoomout").on("click",r)}else{$("."+TC.control.NavBar.prototype.CLASS+"-btn-home").off("click",t);$("."+TC.control.NavBar.prototype.CLASS+"-btn-zoomin").off("click",o);$("."+TC.control.NavBar.prototype.CLASS+"-btn-zoomout").off("click",r)}},{crs:"EPSG:4326",crsPattern:/(EPSG\:?4326)/i,customRender:null,baseLayer:null,workLayers:[],vector2DLayers:[],vector2DFeatures:{},linked2DControls:{},isLoadingTiles:function(){var e=this.viewer.scene.globe._surface;return!e._tileProvider.ready||e._tileLoadQueueHigh.length>0||e._tileLoadQueueMedium.length>0||e._tileLoadQueueLow.length>0||e._debug.tilesWaitingForChildren>0},loadViewer:function(){var e=this,t=new $.Deferred;e.viewer?t.resolve(e.viewer):TC.loadJS(!window.Cesium,TC.Consts.url.CESIUM,function(){var o=Cesium.Resource.fetchJson({url:TC.apiLocation+"/dataSource/contornoNavarra.json"}).then(function(e){return e&&e.features&&e.features.length>0?e.features[0].geometry.coordinates[0]:[]});Cesium.when(o,function(o){var r,i;e.terrainFallback&&(r={url:e.terrainFallback.url.trim(),layerName:e.terrainFallback.layerName,format:e.terrainFallback.format,noDataValue:e.terrainFallback.noDataValue});if(r)i=new Cesium.MergeTerrainProvider(e.terrain,e,{boundaries:o,fallback:[r]});else{(i=new Cesium.CesiumTerrainProvider({url:e.terrain.url.trim()})).sampleTerrainMostDetailed=function(e){return Cesium.sampleTerrainMostDetailed(i,e)};i.attributions={};if(e.terrain.attributions){i.getAttribution=function(){return i.attributions};i.attributions=e.terrain.attributions;e.map.$events.trigger($.Event(TC.Consts.event.TERRAINPROVIDERADD,{terrainProvider:i}))}}var n=new Cesium.Globe;n.baseColor=Cesium.Color.WHITE;n.enableLighting=!0;n.tileCacheSize=1e3;n.maximumScreenSpaceError=5;e.viewer=e.map3D.viewer=new Cesium.Viewer(e.selectors.divThreedMap,{terrainProvider:i,terrainExaggeration:1,animation:!1,timeline:!1,fullscreenButton:!1,baseLayerPicker:!1,imageryProvider:!1,navigationInstructionsInitiallyVisible:!1,navigationHelpButton:!1,geocoder:!1,homeButton:!1,infoBox:!1,sceneModePicker:!1,selectionIndicator:!1,globe:n,requestRenderMode:!0,maximumRenderTimeChange:1/0});e.viewer.readyPromise=new $.Deferred;e.viewer.scene.backgroundColor=Cesium.Color.WHITE;e.viewer.scene.screenSpaceCameraController.enableCollisionDetection=!0;e.viewer.scene.screenSpaceCameraController.maximumZoomDistance=1e6;e.viewer.scene.globe.depthTestAgainstTerrain=!1;e.viewer.scene.imageryLayers.removeAll();e.viewer.terrainProvider.errorEvent.addEventListener(function(e){if(e.error)switch(e.error.statusCode){case 403:case 404:console.log("es un 404 de terreno")}},e);e.viewer.scene.renderError.addEventListener(function(e,t){if(t&&18===t.code);else{this.$divThreedMap.removeClass(this.classes.LOADING);this.map.toast(this.getLocaleString("fi.error"),{type:TC.Consts.msgType.ERROR});this.$button.click()}},e);e.map3D.tileLoadingHandler=new Cesium.EventHelper;e.map3D.tileLoadingHandler.add(e.viewer.scene.globe.tileLoadProgressEvent,function(t){e.waiting||(e.waiting=e.map.getLoadingIndicator().addWait());if((e.viewer.scene.terrainProvider.allReady||!e.viewer.scene.terrainProvider.allReady&&e.viewer.scene.terrainProvider.ready)&&0===t){e.map.getLoadingIndicator().removeWait(e.waiting);delete e.waiting;e.viewer.readyPromise.resolve();e.$events.trigger(TC.Consts.event.TERRAINLOADED,{})}else e.$events.trigger(TC.Consts.event.TERRAINRECEIVING,{})}.bind(e));L.call(e,!0);$(".cesium-viewer-bottom").remove();e.map3D._event2DHandler=function(e){var t=e.type+".tc";switch(!0){case t==TC.Consts.event.BEFOREBASELAYERCHANGE:this.waiting||(this.waiting=this.map.getLoadingIndicator().addWait());break;case t==TC.Consts.event.BASELAYERCHANGE:this.map3D.setBaseLayer.call(this,e.layer);break;case t==TC.Consts.event.LAYERADD:this.map3D.addLayer.call(this,e.layer);break;case t==TC.Consts.event.LAYERREMOVE:this.map3D.removeLayer.call(this,e.layer);break;case t==TC.Consts.event.LAYERVISIBILITY:this.map3D.setRenderOptionsLayer.call(this,e.layer,{visibility:e.layer.getVisibility()});break;case t==TC.Consts.event.LAYEROPACITY:this.map3D.setRenderOptionsLayer.call(this,e.layer,{opacity:e.layer.getOpacity()});break;case t==TC.Consts.event.LAYERORDER:for(var o=0;o<this.map3D.workLayers.length;o++)if(this.map3D.workLayers[o].imageryProvider&&this.map3D.workLayers[o].imageryProvider.layers.join(",")===e.layer.names.join(",")){if(e.oldIndex>e.newIndex)for(var r=e.oldIndex-e.newIndex,i=0;i<r;i++)this.viewer.scene.imageryLayers.lower(this.map3D.workLayers[o]);else for(r=e.newIndex-e.oldIndex,i=0;i<r;i++)this.viewer.scene.imageryLayers.raise(this.map3D.workLayers[o]);this.map3D.workLayers.splice(e.newIndex,0,this.map3D.workLayers.splice(e.oldIndex,1)[0]);break}break;case t==TC.Consts.event.FEATUREADD:this.map3D.addFeature.call(this,e.feature);break;case t==TC.Consts.event.FEATUREREMOVE:case t==TC.Consts.event.FEATURESCLEAR:if(this.map3D.vector2DFeatures&&this.map3D.vector2DFeatures.hasOwnProperty(e.layer.id)){var n=this.map3D.vector2DFeatures[e.layer.id];for(o=0;o<n.length;o++)this.map3D.removeFeature.call(this,n[o]);delete this.map3D.vector2DFeatures[e.layer.id]}break;case t==TC.Consts.event.ZOOM:if(this.map3D.cameraControls&&!this.map3D.cameraControls.moving){var a=this.map3D.viewer.scene.canvas.clientWidth,l=this.map3D.viewer.scene.canvas.clientHeight;if(!this.map3D._canvasClientHeight||!this.map3D._canvasClientWidth||a!==this.map3D._canvasClientWidth||l!==this.map3D._canvasClientHeight){this.map3D._canvasClientWidth||(this.map3D._canvasClientWidth=this.map3D.viewer.scene.canvas.clientWidth);this.map3D._canvasClientHeight||(this.map3D._canvasClientHeight=this.map3D.viewer.scene.canvas.clientHeight);this.map3D._canvasClientWidth=a;this.map3D._canvasClientHeight=l;return}this.map3D.flyToMapCoordinates.call(this,this.mapView.getCenter())}break;case t==TC.Consts.event.ZOOMTO:if(this.lastZoom&&performance.now()-this.lastZoom<50)return;this.lastZoom=performance.now();var s=this.map.crs!==this.map3D.crs?TC.Util.reproject(e.extent.slice(0,2),this.map.crs,this.map3D.crs):e.extent.slice(0,2),p=this.map.crs!==this.map3D.crs?TC.Util.reproject(e.extent.slice(2),this.map.crs,this.map3D.crs):e.extent.slice(2),c=Cesium.Rectangle.fromDegrees(s[0],s[1],p[0],p[1]);this.map3D.flyToRectangle.call(this,c)}}.bind(e);e.map.on(S.join(" "),e.map3D._event2DHandler);P.call(e,e.direction.TO_THREE_D);e.viewer.readyPromise.then(function(){(function(){var e=this;e.map.workLayers.filter(function(e){return e instanceof TC.layer.Vector}).forEach(function(t){t.features.forEach(function(t){e.map3D.addFeature.call(e,t)})})}).call(e)});t.resolve(e.viewer)})});return t},setBaseLayer:function(e){var t=this,o=function(e){if(!r(e,t.map3D.crs))if(null!==e.getFallbackLayer()&&r(e.getFallbackLayer(),t.map3D.crs))e=e.getFallbackLayer();else{t.map.toast(t.getLocaleString("threed.crsNoCompatible",{name:e.title}));e=null}return e};if(t.map3D.baseLayer){if(t.viewer.scene.imageryLayers.contains(t.map3D.baseLayer)){t.viewer.scene.imageryLayers.raiseToTop(t.map3D.baseLayer);t.viewer.scene.imageryLayers.remove(t.map3D.baseLayer,!0)}if(e instanceof TC.layer.Vector){t.map3D.baseLayer=t.Consts.BLANK_BASE;t.map.getLoadingIndicator().removeWait(t.waiting);delete t.waiting}else if(e=o(e)){e.map=t.map;e.isBase=!0;t.map3D.addLayer.call(t,e)}}else(function(e){var t=this,o=$.Deferred(),i=e.baseLayer instanceof TC.layer.Raster;if(i){if(!r(e.baseLayer,t.map3D.crs)){var n=e.baseLayer.getFallbackLayer();n&&n._capabilitiesPromise.then(function(){n.isCompatible(t.map3D.crs)||e.toast(t.getLocaleString("threed.baseLayerNoCompatible",{name:e.baseLayer.layerNames}))})}}else y.baseVector=e.baseLayer;0===y.baseMaps.length&&$.when.apply($,e.baseLayers.map(function(e){return r(e,t.map3D.crs)?$.Deferred().resolve(!1):(n=e.getFallbackLayer())?n._capabilitiesPromise.then(function(){return!n.isCompatible(t.map3D.crs)}):$.Deferred().resolve(!0)})).then(function(){var t=Array.prototype.slice.call(arguments);if(t.length>0){for(var r=0;r<e.baseLayers.length;r++)e.baseLayers[r].mustReproject=t[r];e.$events.trigger($.Event(TC.Consts.event.VIEWCHANGE))}o.resolve()});y.baseMap=i?e.baseLayer:t.Consts.BLANK_BASE;return o}).call(t,t.map).then(function(){if(e.type===TC.Consts.layerType.WMTS||e.type===TC.Consts.layerType.WMS){if(e.options.relatedWMTS){t.map.baseLayer=e=t.map.getLayer(e.options.relatedWMTS);t.map.$events.trigger($.Event(TC.Consts.event.BASELAYERCHANGE,{layer:t.map.baseLayer}))}else if(e=o(e)){e.isBase||(e.isBase=!0);t.map3D.addLayer.call(t,e)}}else t.map3D.baseLayer=t.Consts.BLANK_BASE});y.baseMap=t.map.baseLayer},addLayer:function(e){var t=this;switch(!0){case TC.Consts.layerType.VECTOR==e.type:t.map3D.vector2DLayers.push(e);break;case TC.Consts.layerType.WMTS==e.type:case TC.Consts.layerType.WMS==e.type:e.isBase||e.isCompatible(t.map3D.crs)?m.convert(e,t.map3D.crs).then(function(o){if(o){if(void 0!==o.enablePickFeatures){o.enablePickFeatures=!1;o.tcLayer=e}if(e.isBase&&t.map3D.baseLayer&&t.viewer.scene.imageryLayers.contains(t.map3D.baseLayer)){t.viewer.scene.imageryLayers.raiseToTop(t.map3D.baseLayer);t.viewer.scene.imageryLayers.remove(t.map3D.baseLayer,!0)}var r=t.viewer.scene.imageryLayers.addImageryProvider(o);if(e.isBase){t.map3D.baseLayer=r;t.viewer.scene.imageryLayers.lowerToBottom(r)}else{r.show=e.getVisibility();r.alpha=e.getOpacity();t.map3D.workLayers.push(r);t.map3D.linked2DControls.legend.refresh()}}}):t.map.toast(t.getLocaleString("threed.crsNoCompatible",{name:e.layerNames}))}},removeLayer:function(e){switch(!0){case TC.Consts.layerType.VECTOR==e.type:if(this.map3D.vector2DFeatures&&this.map3D.vector2DFeatures.hasOwnProperty(e.id)){for(var t=this.map3D.vector2DFeatures[e.id],o=0;o<t.length;o++)this.map3D.removeFeature.call(this,t[o]);delete this.map3D.vector2DFeatures[e.id]}break;case TC.Consts.layerType.WMTS==e.type:case TC.Consts.layerType.WMS==e.type:for(o=0;o<this.map3D.workLayers.length;o++)if(e.names&&this.map3D.workLayers[o].imageryProvider.layers.join(",")===e.names.join(",")||e.title&&this.map3D.workLayers[o].imageryProvider.layers.join(",")===e.title){this.viewer.scene.imageryLayers.raiseToTop(this.map3D.workLayers[o]);this.viewer.scene.imageryLayers.remove(this.map3D.workLayers[o],!0);this.map3D.workLayers.splice(o,1);break}}},setRenderOptionsLayer:function(e,t){switch(!0){case TC.Consts.layerType.VECTOR==e.type:if(this.map3D.vector2DFeatures[e.id])for(var o=this.map3D.vector2DFeatures[e.id],r=0;r<o.length;r++)this.map3D.setRenderOptionsFeature(o[r],{show:e.getVisibility()});break;case TC.Consts.layerType.WMTS==e.type:case TC.Consts.layerType.WMS==e.type:for(r=0;r<this.map3D.workLayers.length;r++)if(e.names&&this.map3D.workLayers[r].imageryProvider.layers.join(",")===e.names.join(",")||e.title&&this.map3D.workLayers[r].imageryProvider.layers.join(",")===e.title){t.hasOwnProperty("visibility")&&(this.map3D.workLayers[r].show=t.visibility);t.hasOwnProperty("opacity")&&(this.map3D.workLayers[r].alpha=t.opacity);break}}},flyToMapCoordinates:function(e){var t=this.map.crs!==this.map3D.crs?TC.Util.reproject(e,this.map.crs,this.map3D.crs):e,o=Cesium.Cartesian3.fromDegrees(t[0],t[1],this.viewer.camera.positionCartographic.height),r=this.viewer.camera;r.flyTo({destination:o,orientation:{heading:r.heading,pitch:r.pitch}})},flyToRectangle:function(e,t){var o=this;o.viewer.scene.camera.cancelFlight();var r=$.Deferred();t=t||{};var i=Cesium.Math.EPSILON3;if(e.east===e.west){e.east+=i;e.west-=i}if(e.north===e.south){e.north+=i;e.south-=i}var n=.2*e.width/2,a=.2*e.height/2;e.east-=n;e.west+=a;e.north+=a;e.south-=a;var l=o.viewer.scene,s=l.camera,p=s.getRectangleCameraCoordinates(e),c=Cesium.Ellipsoid.WGS84.cartesianToCartographic(p);Cesium.when(l.globe.terrainProvider.sampleTerrainMostDetailed([Cesium.Rectangle.center(e)]),function(e){var i={longitude:c.longitude,latitude:c.latitude,height:c.height+e[0].height};s.flyTo({duration:t.duration||1,destination:Cesium.Ellipsoid.WGS84.cartographicToCartesian(i),complete:function(){var e=Cesium.Math.toRadians(50),t=u(this.viewer.scene);t=Cesium.Matrix4.fromTranslation(t);this.map3D.rotateAroundAxis(this.viewer.scene.camera,-e,this.viewer.scene.camera.right,t,{duration:250,callback:function(){r.resolve()}})}.bind(o)})});return r},zoomToCartesian:function(e,t){var o=this,r=o.viewer.scene;if(!e||!e.endPosition){var i=r.canvas,n=new Cesium.Cartesian2(i.clientWidth/2,i.clientHeight/2);e={endPosition:n}}var a=r.camera.getPickRay(e.endPosition),l=r.globe.pick(a,r);if(l){var s=Cesium.Cartesian3.distance(a.origin,l);if(s<1)return;o.map3D._zoomTo||(o.map3D._zoomTo={amount:0});o.map3D._zoomTo.direction=t>0?1:0;o.map3D._zoomTo.amount+=5*s/100;o.map3D._zoomTo.endPosition=e.endPosition}setTimeout(function(){(function(t){var o=this.viewer.scene,r=o.camera.getPickRay(e.endPosition||t.endPosition),i=o.globe.pick(r,o);if(i){if(Cesium.Cartesian3.distance(r.origin,i)<1)return;var n=o.camera.position,a=(o.camera.direction,toGo=new Cesium.Cartesian3);Cesium.Cartesian3.multiplyByScalar(r.direction,1==t.direction?t.amount:-t.amount,a);Cesium.Cartesian3.add(n,a,toGo);var l=new Cesium.Ray(toGo,r.direction),s=o.globe.pick(l,o);s&&(Cesium.Cartesian3.distance(toGo,s)<1||Math.abs(Cesium.Ellipsoid.WGS84.cartesianToCartographic(toGo).height)<o.screenSpaceCameraController.minimumZoomDistance?function(){this.map3D._zoomTo={direction:1,amount:0,endPosition:{}}}.call(this):this.viewer.camera.flyTo({destination:toGo,orientation:{heading:o.camera.heading,pitch:o.camera.pitch,roll:o.camera.roll},duration:1,easingFunction:Cesium.EasingFunction.LINEAR_NONE,complete:function(e){this.map3D._zoomTo={direction:1,amount:0,endPosition:{}}}.bind(this,Cesium.Cartesian3.distance(toGo,s))}))}}).call(o,o.map3D._zoomTo)}.bind(o),50)},rotateAroundAxis:function(e,t,o,r,i){return s(e,t,o,r,i)},addFeature:function(e,t){var o=this,r=function(){var t=v.convert(o.viewer.scene,e,o.map.crs,o.map3D.crs);if(t)if("function"==typeof t.geometry)t.geometry(o.viewer.terrainProvider).then(function(t){if(t instanceof Array)t.forEach(function(t){if(t instanceof Array)t.forEach(function(t){t=C.call(o,t);T(o.map3D,e.layer.id,t)});else{t=C.call(o,t);T(o.map3D,e.layer.id,t)}});else{var r=C.call(o,t);T(o.map3D,e.layer.id,r)}});else if(t.geometry instanceof Array)t.geometry.forEach(function(t){t=C.call(o,t);T(o.map3D,e.layer.id,t)});else{var r=C.call(o,t.geometry);T(o.map3D,e.layer.id,r)}};if(!o.map3D.linked2DControls.coordinates||o.map3D.linked2DControls.coordinates.layer!=e.layer)if(o.map3D.linked2DControls.featureInfo&&o.map3D.linked2DControls.featureInfo.get2DMarker()===e||o.map3D.linked2DControls.featureInfo&&o.map3D.linked2DControls.featureInfo.isPending())setTimeout(function(){o.map3D.linked2DControls.featureInfo.get2DMarker()!==e&&r()},5);else{if(o.map3D.linked2DControls.geolocation&&o.map3D.linked2DControls.geolocation.layerTracking===e.layer&&e instanceof TC.feature.Polyline)return;r()}},removeFeature:function(e){if(e){switch(!0){case e instanceof Cesium.GroundPrimitive:this.viewer.scene.groundPrimitives.remove(e);break;case e instanceof Cesium.Billboard:this.viewer.billboardCollection.remove(e);break;case e instanceof Object:this.viewer.entities.removeById(e.id)}this.viewer.scene.requestRender()}},setRenderOptionsFeature:function(e,t){e&&(e.show=t.show)},addNativeFeature:function(e){return C.call(this,e)},setCameraFromMapView:function(){var e=this;e.viewer.scene.globe.terrainProvider.readyPromise.then(function(){var t=e.mapView.getCenter();if(t){var o=e.map.crs!==e.map3D.crs?TC.Util.reproject(t,e.map.crs,e.map3D.crs):t,r=function(e,t){var o=this.viewer.camera.frustum.fovy,r=e*this.mapView.viewHTML.getBoundingClientRect().height,i=Math.cos(Math.abs(t));return r*this.mapView.metersPerUnit*i/2/Math.tan(o/2)}.call(e,e.mapView.getResolution()||0,Cesium.Math.toRadians(o[0])),i=(o=e.map.crs!==e.map3D.crs?TC.Util.reproject(t,e.map.crs,e.map3D.crs):t,new Cesium.Cartographic(Cesium.Math.toRadians(o[0]),Cesium.Math.toRadians(o[1])));e.viewer.scene.globe&&(i.height=e.viewer.scene.globe.getHeight(i)||0);var n=function(){var t=Cesium.Ellipsoid.WGS84.cartographicToCartesian(i),o={pitch:Cesium.Math.toRadians(-90),heading:-e.mapView.getRotation(),roll:0};e.viewer.camera.setView({destination:t,orientation:o});e.viewer.camera.moveBackward(r)};0===i.height?TC.loadJS(!TC.tool||!TC.tool.Elevation,TC.apiLocation+"TC/tool/Elevation",function(){e.map3D.elevationTool=new TC.tool.Elevation;e.map3D.elevationTool.getElevation({crs:e.map3D.crs,coordinates:o}).then(function(e){if(e&&e.length>0){i.height=e[0][2]?e[0][2]:0;n()}})}):n()}})},setViewFromCameraView:function(){if(!this.setViewFromCameraViewInProgress||"resolved"==this.setViewFromCameraViewInProgress.state()){this.setViewFromCameraViewInProgress=new $.Deferred;var e=Cesium.Ellipsoid.WGS84,t=this.viewer.scene;target_=c(t);if(!target_){var o=this.viewer.scene.globe,r=this.viewer.camera.positionCartographic.clone(),i=o.getHeight(r);r.height=i||0;target_=Cesium.Ellipsoid.WGS84.cartographicToCartesian(r)}var n=Cesium.Cartesian3.distance(target_,this.viewer.camera.position),a=e.cartesianToCartographic(target_),s=this.map3D.crs!==this.map.crs?TC.Util.reproject([Cesium.Math.toDegrees(a.longitude),Cesium.Math.toDegrees(a.latitude)],this.map3D.crs,this.map.crs):[Cesium.Math.toDegrees(a.longitude),Cesium.Math.toDegrees(a.latitude)];this.mapView.setCenter(s);this.mapView.setResolution(l.call(this,n,a?a.latitude:0));this.setViewFromCameraViewInProgress.resolve()}return this.setViewFromCameraViewInProgress},getInfoOnPickedPosition:function(e){var t=this;if(e){t.map.one(TC.Consts.event.DRAWTABLE,function(e){t.map.getLoadingIndicator().removeWait(t.waiting);delete t.waiting});t.map3D.linked2DControls.featureInfo.send.call(t,e).then(function(e){t.map.getLoadingIndicator().removeWait(t.waiting);delete t.waiting})}},destroy:function(){var e=this;e.map.on3DView=!1;e.map.view3D=null;e.map3D.vector2DLayers=[];e.map3D.vector2DFeatures={};e.map.off(S.join(" "),e.map3D._event2DHandler);P.call(e,e.direction.TO_TWO_D);L.call(e,!1);$.when.apply($,e.map.baseLayers.map(function(t){return $.Deferred().resolve(!r(t,e.map.crs))})).then(function(){var t=Array.prototype.slice.call(arguments);if(t.length>0){for(var o,r=0;r<e.map.baseLayers.length;r++){o||t[r]||(o=e.map.baseLayers[r]);e.map.baseLayers[r].mustReproject=t[r]}e.map.$events.trigger($.Event(TC.Consts.event.VIEWCHANGE));var i=y.baseMap==e.Consts.BLANK_BASE?y.baseVector:y.baseMap;if(i.isCompatible(e.map.getCRS()))e.map.setBaseLayer(i);else if(i.fallbackLayer){i.getFallbackLayer();if(i.getFallbackLayer().isCompatible(e.map.getCRS()))e.map.setBaseLayer(i);else{e.map.setBaseLayer(o);e.map.toast(e.getLocaleString("threed.baseLayerNoCompatible",{name:i.title}))}}else{e.map.setBaseLayer(o);e.map.toast(e.getLocaleString("threed.baseLayerNoCompatible",{name:i.title}))}}});y.baseMap="";e.map3D.baseLayer=null;e.map3D.workLayers=[];e.map3D.cameraControls.unbind();e.map3D.linked2DControls.featureInfo&&e.map3D.linked2DControls.featureInfo.reset();e.map3D.linked2DControls.coordinates&&e.map3D.linked2DControls.coordinates.clear();if(e.map3D.linked2DControls.geolocation){e.map3D.linked2DControls.geolocation.isGeo=!1;e.map3D.linked2DControls.geolocation.reset()}e.map3D.tileLoadingHandler.removeAll();delete e.map3D.tileLoadingHandler}});e.browserSupportWebGL=function(){var e=!1;if(window.WebGLRenderingContext){var t=document.createElement("canvas"),o={alpha:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};try{var r=t.getContext("webgl",o)||t.getContext("experimental-webgl",o)||t.getContext("webkit-3d",o)||t.getContext("moz-webgl",o);if(r)e=!0;else{o.failIfMajorPerformanceCaveat=!1;if(r=t.getContext("webgl",o)||t.getContext("experimental-webgl",o)||t.getContext("webkit-3d",o)||t.getContext("moz-webgl",o)){e="slow";this.isSlower=!0}else e=!1}}catch(e){console.log(E)}if("slow"===e||!e){var i="slow"===e?"threed.slowSupport.supported":"threed.not.supported";this.map.toast(this.getLocaleString(i),{type:TC.Consts.msgType.WARNING,duration:1e4})}return e}e=!1}}();TC.layer=TC.layer||{};TC.Layer||TC.syncLoadJS(TC.apiLocation+"TC/Layer");TC.Consts.BLANK_IMAGE="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAQAIBRAA7";!function(){var e={},t=!TC.isLegacy&&window.hasOwnProperty("Worker"),o=$.Deferred();if(t){var r=TC.apiLocation+"TC/workers/tc-caps-web-worker.js";TC.Util.isSameOrigin(TC.apiLocation)?o.resolve(r):$.ajax({url:r,type:"GET",dataType:"text"}).then(function(e){var t=new Blob([e],{type:"text/javascript"}),r=window.URL.createObjectURL(t);o.resolve(r)},function(e){o.reject()})}var i=function(e,o){TC._capabilitiesRequests=TC._capabilitiesRequests||[];return TC._capabilitiesRequests[e]=!o&&TC._capabilitiesRequests[e]||$.ajax({url:o?TC.proxify(e):e,type:"GET",dataType:t?"text":"xml"})},n=function(e,t){var o="No se pudo obtener el documento de capacidades de servicio "+e.url+": ["+t+"]";e._capabilitiesPromise.reject(o);TC.error(o);e.map&&e.map.$events.trigger($.Event(TC.Consts.event.LAYERERROR,{layer:e,reason:"couldNotGetCapabilities"}));e.wrap.setLayer(null)},a=function(e,t){TC.loadJS(!window.localforage,[TC.Consts.url.LOCALFORAGE],function(){var o=e.CAPABILITIES_STORE_KEY_PREFIX+e.options.url,r=function(){t.hasOwnProperty("error")||$.when(e._capabilitiesPromise).then(function(){var e=t._capabilitiesURL;delete t._capabilitiesURL;localforage.setItem(o,t).then(function(){t._capabilitiesURL=e}).catch(function(e){console.log(e)})})};e.map?e.map.loaded(r):r()})},l=function(r,i){var n;if(i.documentElement){if($(i).find("ServiceException").length>0)n={error:$(i).find("ServiceException").text()};else{var l=r.type===TC.Consts.layerType.WMTS?new r.wrap.WmtsParser:new r.wrap.WmsParser;n=l.read(i);r.type===TC.Consts.layerType.WMTS&&n.Contents&&n.Contents.Layer&&$("Layer",i).each(function(e,t){var o=TC.Util.getElementByNodeName(t,"ows:Identifier")[0].firstChild.data,r=$(t),i=n.Contents.Layer.filter(function(e){return e.Identifier==o});if(i.length){i=i[0];for(var a=0;a<i.TileMatrixSetLink.length;a++){var l=i.TileMatrixSetLink[a];matrixId=l.TileMatrixSet;xmlLink=r.find("TileMatrixSetLink").each(function(e,t){return $(t).find("TileMatrixSet:first").text()==matrixId});if(xmlLink.length){xmlLink=xmlLink[0];l.TileMatrixSetLimits=[];$(xmlLink).find("TileMatrixLimits").each(function(e,t){var o=$(t);l.TileMatrixSetLimits.push({TileMatrix:o.find("TileMatrix").text(),MinTileRow:parseInt(o.find("MinTileRow").text()),MinTileCol:parseInt(o.find("MinTileCol").text()),MaxTileRow:parseInt(o.find("MaxTileRow").text()),MaxTileCol:parseInt(o.find("MaxTileCol").text())})})}}}})}e[r.url].resolve(n);a(r,n)}else if(t&&"string"==typeof i)o.then(function(t){var o=new Worker(t);o.onmessage=function(t){if("success"===t.data.state){n=t.data.capabilities;a(r,n)}else n={error:"Web worker error"};e[r.url].resolve(n);o.terminate()};o.postMessage({type:r.type,text:i})});else{n=i;e[r.url].resolve(n)}},s=function(e){var t;if(!e.wrap.layer){switch(e.type){case TC.Consts.layerType.GROUP:break;case TC.Consts.layerType.WMTS:t=c(e);break;default:t=p(e)}e.wrap.setLayer(t)}},p=function(e){var t=$.isArray(e.names)?e.names.join(","):e.names,o=e.options.format,r=e.options,i={LAYERS:t,FORMAT:o,TRANSPARENT:e.transparent,VERSION:e.capabilities.version||"1.3.0"};e.params&&$.extend(i,e.params);e.queryParams&&$.extend(i,e.queryParams);var n=e.getPreferredInfoFormat();null!==n&&(i.INFO_FORMAT=n);return e.wrap.createWMSLayer(e.getGetMapUrl(),i,r)},c=function(e){return e.wrap.createWMTSLayer(e.options)},u=function e(t,o){var r=$.inArray(o.name,t.availableNames);if(-1===r)for(var i=0,n=o.children.length;i<n&&-1===(r=e(t,o.children[i]));i++);return r},g=function e(t,o,r){var i=!1;r.count=r.count+1;if(t.name===o)i=!0;else for(var n=t.children.length-1;n>=0;n--)if(e(t.children[n],o,r)){i=!0;break}return i},d=function(e,t,o){var r=$.Deferred();i(e,!1).done(function(e){r.resolve(!0);t&&$.isFunction(t)&&t(e)}).fail(function(e){r.resolve(!1);o&&$.isFunction(o)&&o(e)});return r.promise()},h=function(e,t,o){return d(e.replace(this.PROTOCOL_REGEX,"https://"),t,o)},f=function(e,t,o){return d(e,t,o)},y=function(e,t){var o,r,i=$.Deferred(),n=document.createElement("img");n.crossOrigin="anonymous";$.isFunction(n.onload)&&(o=n.onload);n.onload=function(){try{var e=function(e){var t=document.createElement("CANVAS"),o=t.getContext("2d");t.height=e.height;t.width=e.width;o.drawImage(e,0,0);return t}(n);result=e.toDataURL("image/png");if(t){t.image_=n;t.state=ol.ImageState.LOADED;t.changed()}i.resolve(!0)}catch(e){if(18===e.code)i.resolve(!1);else{if(t){t.image_=n;t.state=ol.ImageState.LOADED;t.changed()}i.resolve(!0)}}n.onload=void 0;n.onerror=void 0;o&&$.isFunction(o)&&o()};$.isFunction(n.onerror)&&(r=n.onerror);n.onerror=function(){n.onload=void 0;n.onerror=void 0;i.resolve(!1);r&&$.isFunction(r)&&r()};n.src=e;return i.promise()};TC.layer.Raster=function(){this._capabilitiesPromise=null;TC.Layer.apply(this,arguments);this.wrap=new TC.wrap.layer.Raster(this);this.transparent=!1!==this.options.transparent;this.url=this.options.url;this.params=this.options.params;if("string"==typeof this.options.layerNames)this.names=this.availableNames=this.options.layerNames.split(",");else{this.names=[];this.availableNames=[];if($.isArray(this.options.layerNames))for(var t=0;t<this.options.layerNames.length;t++){if("string"==typeof(c=this.options.layerNames[t])){this.names.push(c);this.availableNames.push(c)}else if(c.hasOwnProperty("name")){this.availableNames.push(c.name);(void 0===c.isVisible||c.isVisible)&&this.names.push(c.name)}}else{var o=this.options.params?this.options.params.sld_body:null;if(o){var r=$.parseXML(o),a=TC.Util.getElementByNodeName(r,"sld:NamedLayer");if(a&&a.length>0){var p=TC.Util.getElementByNodeName(a[0],"sld:Name");if(p&&p.length>0){var c=$(p[0]).text();this.names.push(c);this.availableNames.push(c)}}}}}this.ignorePrefixes=void 0===this.options.ignorePrefixes||this.options.ignorePrefixes;this._capabilitiesNodes={};!function(t,o,r){var a=t.url;t._capabilitiesPromise=$.Deferred();var l=e[a];l||(l=e[a]=$.Deferred());var p,c=function(e){if(e.error){n(t,e.error);t._capabilitiesPromise.reject()}else{t.capabilities=t.capabilities||e;t.capabilitiesUrl_?e._capabilitiesURL=t.capabilitiesUrl_:t.capabilitiesUrl_=e._capabilitiesURL;var o=t.getGetMapUrl();TC.capabilities[t.options.url]=TC.capabilities[t.options.url]||e;TC.capabilities[o]=TC.capabilities[o]||e;s(t);t._capabilitiesPromise.resolve(e)}},u={};if(t.type===TC.Consts.layerType.WMTS)if(t.options.encoding===TC.Consts.WMTSEncoding.RESTFUL){var g="/1.0.0/WMTSCapabilities.xml";const e=a.indexOf(g);if(e<0||e<a.length-g.length){"/"===a[a.length-1]&&(g=g.substr(1));p=a+g}else p=a}else{p=a;u.SERVICE="WMTS";u.VERSION="1.0.0";u.REQUEST="GetCapabilities"}else{p=a;u.SERVICE="WMS";u.VERSION="1.3.0";u.REQUEST="GetCapabilities"}p=p+"?"+$.param($.extend(u,t.queryParams));TC._capabilitiesRequests=TC._capabilitiesRequests||{};var d=t.setCapabilitiesUrl_(p,o,r);TC.loadJS(!window.localforage,[TC.Consts.url.LOCALFORAGE],function(){localforage.getItem(t.CAPABILITIES_STORE_KEY_PREFIX+a).then(function(o){if(o){e[t.url].then(c);d.then(function(){e[t.url].resolve(o)})}})});d.then(function(e){e===t.capabilitiesState_.PENDING&&i(t.capabilitiesUrl_(p)).then(function(e){o(t,e)},function(e,n,a){i(p,!0).then(function(e){o(t,e)},function(e){r(t,e.responseText)})})});$.when(d,l).done(function(e,o){e===t.capabilitiesState_.DONE&&o?c(o):o&&c(o)})}(this,l,n);this._disgregatedLayerNames=null;TC.Consts.layerType.WMTS==this.type&&this.wrap.setWMTSUrl()};TC.inherit(TC.layer.Raster,TC.Layer);var m=TC.layer.Raster.prototype;m.PROTOCOL_REGEX=/^(f|ht)tp?:\/\//i;m.capabilitiesState_={PENDING:0,DONE:1};m.getByProxy_=function(e){return TC.proxify(e)};m.getBySSL_=function(e){return e.replace(this.PROTOCOL_REGEX,"https://")};m.getByUrl_=function(e){return e};m.getCapabilitiesUrl_promise_=function(){this.capabilitiesUrl_promise_||(this.capabilitiesUrl_promise_=$.Deferred());return this.capabilitiesUrl_promise_};m.getCapabilitiesUrl_ServiceWorker_=function(e){var t=this,o=e&&e.trim()||t.url.trim();TC.Util.consoleRegister("Escenario: Visor en HTTPS + ServiceWorker");TC.Util.consoleRegister("Service worker nos obliga a estar en HTTPS");TC.Util.consoleRegister("Comprobamos si el servicio a solicitar es HTTPS, si no lo es producir\xe1 contenido mixto y el service worker no lo acepta");if(TC.Util.isSecureURL(o)){TC.Util.consoleRegister("S\xed lo es: validamos si cuenta con CORS");f(o,t.capabilitiesLoad_).then(function(e){if(e){TC.Util.consoleRegister("Tiene cabeceras CORS");t.capabilitiesUrl_=t.getByUrl_;t.getCapabilitiesUrl_promise_().resolve(t.capabilitiesState_.DONE)}else{TC.Util.consoleRegister("NO tiene cabeceras CORS -> proxificamos:");TC.Util.consoleRegister("GetCapabilities, GFI, 3D");TC.Util.consoleRegister("GetMap");t.capabilitiesUrl_=t.getByProxy_;t.getCapabilitiesUrl_promise_().resolve(t.capabilitiesState_.PENDING)}})}else{TC.Util.consoleRegister("No lo es: validamos si soporta SSL, ya que: aunque cuente con cabeceras CORS si el protocolo es distinto, el navegador bloquear\xe1 la petici\xf3n");t.getCapabilitiesUrl_MixedContent_FromHTTPS_(o)}};m.getCapabilitiesUrl_MixedContent_FromHTTPS_=function(e){var t=this,o=e&&e.trim()||t.url.trim();TC.Util.consoleRegister("Escenario: Visor en HTTPS y servicio en HTTP");TC.Util.consoleRegister("Validamos si soporta SSL, ya que: aunque cuente con cabeceras CORS si el protocolo es distinto, el navegador bloquea la petici\xf3n");h.call(t,o,t.capabilitiesLoad_).then(function(e){if(e){TC.Util.consoleRegister("Dado que estamos en un escenario de cross origin y si la petici\xf3n/comprobaci\xf3n de SSL ha funcionado correctamente: podemos afirmar que el servicio cuenta con cabeceras CORS");t.capabilitiesUrl_=t.getBySSL_;t.getCapabilitiesUrl_promise_().resolve(t.capabilitiesState_.DONE)}else{TC.Util.consoleRegister("Realmente no sabemos si el error se produce por no soportar HTTPS o porque no tiene CORS, sea como sea: es necesario proxificar");t.capabilitiesUrl_=t.getByProxy_;t.getCapabilitiesUrl_promise_().resolve(t.capabilitiesState_.PENDING)}})};m.getCapabilitiesUrl_MixedContent_FromHTTP_=function(e){var t=e&&e.trim()||this.url.trim();TC.Util.consoleRegister("Escenario: Visor en HTTP y servicio en HTTPS");this.getCapabilitiesUrl_CORSSupport_.call(this,t)};m.getCapabilitiesUrl_MixedContent_=function(e,t){var o=e&&e.trim()||this.url.trim(),r=t||document.location.href;TC.Util.consoleRegister("\xbfEstamos en HTTPS?");if(TC.Util.isSecureURL(r)){TC.Util.consoleRegister("Al ser un sitio seguro, validamos si existe un service worker (es m\xe1s restrictivo)");if(TC.Util.isServiceWorker()){TC.Util.consoleRegister("S\xed hay ServiceWorker");this.getCapabilitiesUrl_ServiceWorker_.call(this,o)}else{TC.Util.consoleRegister("No hay ServiceWorker");this.getCapabilitiesUrl_MixedContent_FromHTTPS_.call(this,o)}}else{TC.Util.consoleRegister("No lo estamos");this.getCapabilitiesUrl_MixedContent_FromHTTP_.call(this,o)}};m.getCapabilitiesUrl_ProtocolSiblings_=function(e,t){var o=e&&e.trim()||this.url.trim(),r=t||document.location.href;TC.Util.consoleRegister("Validamos si estamos en HTTPS y si hay ServiceWorker (es m\xe1s restrictivo)");if(TC.Util.isSecureURL(r)&&TC.Util.isServiceWorker()){TC.Util.consoleRegister("S\xed hay ServiceWorker");this.getCapabilitiesUrl_ServiceWorker_.call(this,o)}else{TC.Util.consoleRegister("No hay ServiceWorker");this.getCapabilitiesUrl_CORSSupport_.call(this,o)}};m.getCapabilitiesUrl_CORSSupport_=function(e){var t=this,o=e&&e.trim()||t.url.trim();TC.Util.consoleRegister("Validamos si soporta CORS");f(o,t.capabilitiesLoad_).then(function(e){if(e){TC.Util.consoleRegister("Cuenta con cabeceras CORS");t.capabilitiesUrl_=t.getByUrl_;t.getCapabilitiesUrl_promise_().resolve(t.capabilitiesState_.DONE)}else{TC.Util.consoleRegister("NO tiene cabeceras CORS -> proxificamos:");TC.Util.consoleRegister("Capabilities");t.capabilitiesUrl_=t.getByProxy_;t.getCapabilitiesUrl_promise_().resolve(t.capabilitiesState_.PENDING)}})};m.setCapabilitiesUrl_=function(e,t,o,r){var i=this;i.capabilitiesUrl_promise_=$.Deferred();var n=e&&e.trim()||i.url.trim(),a=r||document.location.href;i.capabilitiesLoad_||(i.capabilitiesLoad_=function(e){t(i,e)});i.capabilitiesLoadError_||(i.capabilitiesLoadError_=function(e){o(i,e)});TC.Util.consoleRegister("No hay capa hermana");TC.Util.consoleRegister("Validamos si existe cross origin");if(TC.Util.isSameOriginByLocation(n,a)){TC.Util.consoleRegister("Tenemos mismo origen, cargamos directamente");i.capabilitiesUrl_=i.getByUrl_;i.getCapabilitiesUrl_promise_().resolve(i.capabilitiesState_.PENDING)}else if(TC.Util.isSameProtocol(n,a)){TC.Util.consoleRegister("Hay cross origin");TC.Util.consoleRegister("Sin contenido mixto");i.getCapabilitiesUrl_ProtocolSiblings_.call(i,n)}else{TC.Util.consoleRegister("Tenemos contenido mixto");i.getCapabilitiesUrl_MixedContent_.call(i,n)}return i.getCapabilitiesUrl_promise_()};m.CAPABILITIES_STORE_KEY_PREFIX="TC.capabilities.";m.setVisibility=function(e){this.tree=null;this._cache.visibilityStates={};TC.Layer.prototype.setVisibility.call(this,e)};var v=function e(t,o,r){var i=!1,n=t.wrap.getLayerNodes(r);if(n.length){for(var a=0,l=n.length;a<l;a++)e(t,o,n[a])&&(i=!0);var s,p,c=$.map(n,function(e){return t.wrap.getName(e)}).reverse(),u=!1;p=s=$.inArray(c[0],o);if(s<0)u=!0;else for(a=1,l=c.length;a<l;a++)if(c[a]!=o[++s]){u=!0;break}if(!u){var g=t.wrap.getName(r);if(g&&c.length>1){o.splice(p,c.length,g);i=!0}}}return i},C=function(e,t){for(var o=[],r=t.slice(),i=e.wrap.getRootLayerNode(),n=0,a=r.length;n<a;n++)o=o.concat(T(e,r[n],i));return o},T=function e(t,o,r,i){for(var n=[],a=t.wrap.getName(r),l=t.compareNames(o,a),s=!1,p=t.wrap.getLayerNodes(r),c=0;c<p.length;c++){var u=e(t,o,p[c],i||l);u.length?n=n.concat(u):s=!0}p.length&&!s||(i||l)&&(n=[a]);return n},S=function(e){return $.extend({aggregate:!0,lazy:!1},e)},_=function(e,t,o){var r,i,n=[];r=t||[];i=o||[];for(var a=(e||[]).concat(r),l=0;l<a.length;l++)$.inArray(a[l],a)===l&&-1===$.inArray(a[l],i)&&(n[n.length]=a[l]);return n},E=function(e,t){var o="string"==typeof t?t.split(","):t;if(e.capabilities){var r=e.getTree();o.sort(function(e,t){var o={count:0},i={count:0};g(r,e,o);g(r,t,i);return o.count-i.count})}return o},x=function(e,t,o,r){return $.grep(o,function(o){return e.compareNames(t,o,r)}).length>0};m.getLimitedMatrixSet=function(){return function(e){var t=e.layerNames,o=e.matrixSet,r=e.capabilities,i=[],n=r.Contents.TileMatrixSet.filter(function(e){return e.Identifier==o});if(n.length){n=n[0];var a=r.Contents.Layer.filter(function(e){return e.Identifier==t})[0];if(a.TileMatrixSetLink&&a.TileMatrixSetLink.length&&a.TileMatrixSetLink[0].TileMatrixSetLimits){for(var l,s=a.TileMatrixSetLink[0].TileMatrixSetLimits,p=0;p<s.length;p++){l=s[p];var c=n.TileMatrix.filter(function(e){return e.Identifier==l.TileMatrix});if(c.length){var u=$.extend({matrixIndex:n.TileMatrix.indexOf(c[0])},c[0],l);i.push(u)}}return i}return n.TileMatrix}return null}(this)};m.setLayerNames=function(e,t){var o=this,r=new $.Deferred;$.when(o.wrap.getLayer()).then(function(){var i=$.isArray(e)?e:e.split(",");o.names=i;var n=S(t);n.aggregate&&(i=function(e,t){if(e.type!==TC.Consts.layerType.WMS)return t;var o=t.slice();v(e,o,e.wrap.getRootLayerNode());return o}(o,i));o._disgregatedLayerNames=null;var a={LAYERS:i.join(","),TRANSPARENT:!0};i.length||o.setVisibility(!1);if(n.lazy){var l=o._newParams||o.wrap.getParams();o._newParams=$.extend(l,a)}else{o.map&&o.map.$events.trigger($.Event(TC.Consts.event.BEFOREUPDATEPARAMS,{layer:o}));o.tree=null;o._cache.visibilityStates={};o.wrap.setParams(a);!n.reset&&o.map||(o.availableNames=o.names);o.map&&o.map.$events.trigger($.Event(TC.Consts.event.UPDATEPARAMS,{layer:o}))}r.resolve(o.names)});return r};m.addLayerNames=function(e,t){var o=this,r=new $.Deferred;$.when(o.wrap.getLayer()).then(function(){var i=S(t),n=$.isArray(e)?e:e.split(","),a=o.wrap.getParams().LAYERS;if(i.aggregate){n=C(o,n);a=o.getDisgregatedLayerNames()}$.when(o.setLayerNames(E(o,_(a,n,null)),t)).then(function(e){r.resolve(e)})});return r};m.removeLayerNames=function(e,t){var o=this,r=new $.Deferred;$.when(o.wrap.getLayer()).then(function(){var i=S(t),n=$.isArray(e)?e:e.split(","),a=o.wrap.getParams().LAYERS;if(i.aggregate){n=C(o,n);a=o.getDisgregatedLayerNames()}$.when(o.setLayerNames(E(o,_(a,null,n)),t)).then(function(e){r.resolve(e)})});return r};m.toggleLayerNames=function(e,t){var o=this,r=new $.Deferred;$.when(o.wrap.getLayer()).then(function(){var i=S(t),n=$.isArray(e)?e:e.split(","),a=o.wrap.getParams().LAYERS;if(i.aggregate){n=C(o,n);a=o.getDisgregatedLayerNames()}for(var l=[],s=[],p=0;p<n.length;p++){var c=n[p];$.inArray(c,a)<0?l[l.length]=c:s[s.length]=c}var u=[];l.length>0&&u.push(o.addLayerNames(l,i));s.length>0&&u.push(o.removeLayerNames(s,i));$.when.apply(this,u).then(function(e,t){e?t?r.resolve(e.concat(t)):r.resolve(e):r.resolve([])})});return r};m.getDisgregatedLayerNames=function(){var e=this.wrap.getLayer();if(this.wrap.isNative(e)&&this.type===TC.Consts.layerType.WMS){if(!this._disgregatedLayerNames){var t=this.wrap.getParams().LAYERS;t=$.isArray(t)?t:t.split(",");this._disgregatedLayerNames=C(this,t)}}else this._disgregatedLayerNames=this.names;return this._disgregatedLayerNames.slice()};m.isValidFromNames=function(){for(var e=!0,t=0,o=this.names.length;t<o;t++)if(!this.getLayerNodeByName(this.names[t])){e=!1;break}return e};m.isCompatible=function(e){var t=!1;switch(this.type){case TC.Consts.layerType.WMTS:case TC.Consts.layerType.WMS:t=this.wrap.isCompatible(e)}return t};m.getCompatibleCRS=function(e){const t=this;e=e||{};var o=t.wrap.getCompatibleCRS();if(e.includeFallback&&t.fallbackLayer){const e=t.getFallbackLayer();e instanceof TC.Layer&&(o=o.concat(e.wrap.getCompatibleCRS()))}e.normalized&&(o=o.map(function(e){return TC.Util.getCRSCode(e)}).filter(function(e){return null!==e}).reduce(function(e,t){e.indexOf(t)<0&&(e[e.length]=t);return e},[]).map(function(e){return"EPSG:"+e}));return o};m.getProjection=function(){switch(this.type){case TC.Consts.layerType.WMTS:return this.wrap.layer.getSource().getProjection().getCode();case TC.Consts.layerType.WMS:return this.map.crs}};m.setProjection=function(e){if((e=e||{}).crs)switch(this.type){case TC.Consts.layerType.WMTS:var t=this.wrap.getCompatibleMatrixSets(e.crs)[0];if(t){this.matrixSet=t;this.wrap.setMatrixSet(t)}else this.wrap.setProjection(e);this.mustReproject=!t;break;case TC.Consts.layerType.WMS:this.wrap.setProjection(e);this.mustReproject=!this.isCompatible(e.crs)}};m.isVisibleByScale=function(e,t){var o,r,i,n=this,a=function(){return n.map.wrap.getResolution()*n.map.getMetersPerUnit()/28e-5};switch(n.type){case TC.Consts.layerType.WMTS:o=!1;var l=n.wrap.getTileMatrix(n.options.matrixSet);if(l){r=a();for(i=0;i<l.length;i++){if((u=n.wrap.getScaleDenominators(l[i]))[0]===r){o=!0;break}}}break;case TC.Consts.layerType.WMS:o=!0;var s=n.wrap.getAllLayerNodes();if(s.length>0){r=a();var p;if("number"==typeof e)p=n._capabilitiesNodes[e];else for(i=0;i<s.length;i++){var c=s[i];if(n.compareNames(n.wrap.getName(c),e,t)){p=c;break}}if(p){var u=n.wrap.getScaleDenominators(p);o=!(parseFloat(u[1])>r||parseFloat(u[0])<r)}}break;default:o=!0}return o};m.isVisibleByName=function(e,t){var o=this,r=!1;switch(o.type){case TC.Consts.layerType.WMTS:if(o.wrap.getWMTSLayer()){r=!0;break}break;case TC.Consts.layerType.WMS:var i=function e(r,i){var n=null,a=o.wrap.getName(i);if(o.compareNames(a,r,t))n=[a];else for(var l=o.wrap.getLayerNodes(i),s=0;s<l.length;s++){var p=e(r,l[s]);if(p){TC.Util.fastUnshift(p,a);n=p;break}}return n},n=function(e){return i(e,o.wrap.getRootLayerNode())}(e);if(n)for(var a=0;a<n.length;a++)if(x(o,n[a],o.names)){r=!0;break}break;default:r=!0}return r};m.getTree=function(){var e=this,t=e.tree;if(!t){var o,r=function t(r,i,n){var a;for(var l in e._capabilitiesNodes)if(e._capabilitiesNodes[l]===r){a=l;break}if(!a){a=TC.getUID();e._capabilitiesNodes[a]=r}var s,p,c={name:e.wrap.getName(r),title:r.title||r.Title,uid:a,children:[]};n&&(o=c);x(e,c.name,e.availableNames)&&(i=!0);if(e.options.isBase){c.name=e.names.join(",");c.title=e.title||c.title;c.isBase=e.isDefault;e.options.thumbnail&&(c.legend={src:e.options.thumbnail})}else{c.isVisible=c===o?e.getVisibility():e.isVisibleByName(c.name);var u,g=e.wrap.getLayerNodes(r);for(u=0;u<g.length;u++){var d=t(g[u],i);d&&(s=c,p=d,e.options.inverseTree?TC.Util.fastUnshift(s.children,p):s.children[s.children.length]=p)}c.legend=e.wrap.getLegend(r);if(!i&&!n){o.children=o.children.concat(c.children);c=null}}return c};switch(e.type){case TC.Consts.layerType.WMTS:t=r(e.wrap.getWMTSLayer(),!e.options.hideTree,!0);break;case TC.Consts.layerType.WMS:if(e.capabilities){t=r(e.wrap.getRootLayerNode(),!e.options.hideTree,!0);var i=e._cache.visibilityStates;!function e(t){var o=TC.Consts.visibility.NOT_VISIBLE;if(t){if(void 0!==i[t.uid])o=i[t.uid];else{if(t.children)for(var r=!1,n=!1,a=0,l=t.children.length;a<l;a++){switch(e(t.children[a])){case TC.Consts.visibility.VISIBLE:r=!0;break;case TC.Consts.visibility.NOT_VISIBLE:n=!0;break;case TC.Consts.visibility.HAS_VISIBLE:r=!0;n=!0}r&&(o=n?TC.Consts.visibility.HAS_VISIBLE:TC.Consts.visibility.VISIBLE)}t.isVisible&&(o=TC.Consts.visibility.VISIBLE);i[t.uid]=o}t.visibilityState=o}return o}(t);e.options.hideTree&&function e(t,o){o.children.sort(function(e,o){return u(t,o)-u(t,e)});for(var r=0,i=o.children.length;r<i;r++)e(t,o.children[r])}(e,t)}}t||(t={name:e.name,title:e.title});t.title=e.title||t.title;t.customLegend=e.customLegend||t.customLegend;e.tree=t}return t};m.setNodeVisibility=function(e,t){var o=this;o.tree||(o.tree=o.getTree());var r=o.findNode(e,o.tree);if(r===o.tree)t&&0===o.names.length?o.addLayerNames(o.availableNames).then(function(){o.setVisibility(!0)}):o.setVisibility(t);else{var i=function e(t){var o=[];if(t.name)o[0]=t.name;else for(var r=0;r<t.children.length;r++)o=o.concat(e(t.children[r]));return o}(r);t?o.addLayerNames(i):o.removeLayerNames(i)}};m.getNodeVisibility=function(e){this.tree||(this.tree=this.getTree());return this._cache.visibilityStates[e]};m.getNodePath=function(e,t){var o=this,r=[];if(o.type===TC.Consts.layerType.WMS&&o.capabilities){e=e||o.names[0];r=function r(i){var n=[],a=o.wrap.getName(i);if(o.compareNames(a,e,t))n.push(i);else for(var l=o.wrap.getLayerNodes(i),s=0;s<l.length;s++){var p=r(l[s]);if(p.length){n=p;TC.Util.fastUnshift(n,i);break}}return n}(o.wrap.getRootLayerNode())}return r};m.getPath=function(e,t){return $.map(this.getNodePath(e,t),function(e){return e.title||e.Title})};m.getLayerNodeByName=function(e){for(var t=null,o=this.wrap.getServiceType()===TC.Consts.layerType.WMTS?this.wrap.getIdentifier:this.wrap.getName,r=this.wrap.getAllLayerNodes(),i=0,n=r.length;i<n;i++)if(this.compareNames(o(r[i]),e)){t=r[i];break}return t};m.getChildrenLayers=function(e){var t=[],o=function(e,t){if(e&&e.Layer&&e.Layer.length)for(var r=0;r<e.Layer.length;r++){t[t.length]=e.Layer[r];o(e.Layer[r],t)}};o(e,t);return t};m.compareNames=function(e,t,o){var r=e===t,i=void 0!==o?o:this.ignorePrefixes;if(!r&&i&&e&&t){var n=e.indexOf(":"),a=t.indexOf(":");n>=0&&a<0?r=e.substr(n+1)===t:a>=0&&n<0&&(r=e===t.substr(a+1))}return r};m.getCapabilitiesPromise=function(){return this._capabilitiesPromise};m.getResolutions=function(){return this.wrap.getResolutions()};m.searchSubLayers=function(e){this.patternFn||(this.patternFn=function(e){return e=(e=(e=(e=(e=(e=(e=e.replace(/[^a-z\d\xe1\xe9\xed\xf3\xfa\xfc\xf1]/gi,"\\$&")).replace(/(a|\xe1)/gi,"(a|\xe1)")).replace(/(e|\xe9)/gi,"(e|\xe9)")).replace(/(i|\xed)/gi,"(i|\xed)")).replace(/(o|\xf3)/gi,"(o|\xf3)")).replace(/(u|\xfa|\xfc)/gi,"(u|\xfa|\xfc)")).replace(/n/gi,"(n|\xf1)")});if(e&&e.length&&e.length>=3){var t=this,o=null;if(this.lastPattern&&e.indexOf(this.lastPattern)>=0)o=this.lastMatches;else if(t.availableNames&&t.availableNames.length>0){o=[];for(var r=0;r<t.availableNames.length;r++){var i=t.getLayerNodeByName(t.availableNames[r]);if(i){o[o.length]=i;o=o.concat(t.getChildrenLayers(i))}}}else o=t.wrap.getAllLayerNodes();var n=this.patternFn(e),a=new RegExp(n,"i"),l=o.map(function(e,o){delete e.tcScore;e.tcPosition=o;t.wrap.normalizeLayerNode(e);var r=e.Title.trim(),i=a.exec(r),n=i?i.index:-1,l=-1;if(e.Abstract){var s=e.Abstract.trim(),p=a.exec(s);l=p?p.index:-1}i&&r==i[0]?e.tcScore=20:0==n?e.tcScore=15:n>-1?e.tcScore=10:0==l?e.tcScore=5:l>-1&&(e.tcScore=1);return e.tcScore?e:null}).filter(function(e){return null!=e}).sort(function(e,t){if(t.tcScore===e.tcScore){var o=TC.Util.replaceAccent(e.Title),r=TC.Util.replaceAccent(t.Title);return o<r?-1:o>r?1:0}return t.tcScore-e.tcScore});this.lastPattern=e;this.lastMatches=l;return l}return[]};m.getGetMapUrl=function(){return function(e){var t=e;if(e){var o=e.match(/\??SERVICE=\w+&/i);o&&(t=t.replace(o[0],""))}return t}(this.wrap.getGetMapUrl())};m.getPreferredInfoFormat=function(){for(var e=null,t=this.wrap.getInfoFormats(),o=0;o<TC.wrap.layer.Raster.infoFormatPreference.length;o++){var r=TC.wrap.layer.Raster.infoFormatPreference[o];if($.inArray(r,t)>=0){e=r;break}}return e};m.getLegendGraphicImage=function(){var e=this,t=$.Deferred();if(e.options.params.base64LegendSrc)return t.resolve(e.options.params.base64LegendSrc);if("function"==typeof window.btoa){for(var o=e.names[0],r=e.wrap.getInfo(o),i=new XMLHttpRequest,n=r.legend[0].src.split("?"),a=n[1].split("&"),l=e.options.params.sld_body?"sld_body="+e.options.params.sld_body:"",s=0;s<a.length;s++){var p=a[s].split("=");p&&p.length>1&&p[1]&&(l+="&"+a[s])}e.options.params.env&&(l+="&"+e.options.params.env);i.open("POST",n[0],!0);i.setRequestHeader("Content-Type","application/x-www-form-urlencoded");i.responseType="arraybuffer";i.onload=function(o){if(200===this.status){for(var r=new Uint8Array(this.response),n=r.length,a=new Array(n);n--;)a[n]=String.fromCharCode(r[n]);var l=a.join(""),s=i.getResponseHeader("content-type");if(0===s.indexOf("image")){var p;p="data:"+s+";base64,"+window.btoa(l);e.options.params.base64LegendSrc=p;t.resolve(p)}}};i.send(l)}else t.reject("Funci\xf3n window.btoa no soportada por el navegador");return t.promise()};m.getUrl=function(e){return e};m._onQuarantine=function(e){return e};m.getWebGLUrl=function(e,t){var o=this,r=new $.Deferred;if(o.getWebGLUrl!==m.getWebGLUrl)r.resolve(o.getWebGLUrl.call(o,e));else{TC.Util.consoleRegister("Buscamos en las capas de trabajo si exite alguna del mismo servicio.");TC.Util.consoleRegister("Si hay capa hermana asignamos la misma funci\xf3n de carga de im\xe1genes sin validar nada.");var i=o.getSiblingLoadedLayer.call(o,function(e){return e.getWebGLUrl.toString()!==m.getWebGLUrl.toString()});if(i){TC.Util.consoleRegister("Tenemos capa hermana, no validamos nada m\xe1s.");o.getWebGLUrl=i.getWebGLUrl;r.resolve(o.getWebGLUrl.call(o,e))}else if(TC.Util.detectIE()){o.getWebGLUrl=o.capabilitiesUrl_;r.resolve(o.capabilitiesUrl_.call(o,!TC.Util.isSecureURL(e)&&TC.Util.isSecureURL(TC.Util.toAbsolutePath(o.url))?o.getBySSL_(e):e))}else{TC.Util.consoleRegister("No hay capa hermana.");var n=t||document.location.href;if(TC.Util.isSameOrigin(e)){TC.Util.consoleRegister("Escenario mismo origen");o.getWebGLUrl=o.getByUrl_;r.resolve(o.getByUrl_(e))}else{TC.Util.consoleRegister("Escenario cross origin");var a=function(){if(o.geoBBox&&o.geoBBox.length>0){var t=decodeURIComponent(e.split("&").filter(function(e){return e.indexOf("bbox")>-1})[0]).replace("bbox=","").split(",").map(function(e){return parseInt(e)}),i=o.geoBBox[0];if(!i||t[0]>=i[0]&&t[2]<=i[2]&&t[1]>=i[1]&&t[3]<=i[3]){o.getWebGLUrl=o.getByProxy_;r.resolve(o.getByProxy_(e))}else{o.getWebGLUrl=o._onQuarantine;r.resolve(o._onQuarantine(e))}}else{o.getWebGLUrl=o.getByProxy_;r.resolve(o.getByProxy_(e))}};TC.Util.consoleRegister("Comprobamos si existe service worker");if(TC.Util.isSecureURL(n)&&TC.Util.isServiceWorker()){TC.Util.consoleRegister("Hay serviceworker");TC.Util.consoleRegister("Comprobar si tenemos contenido mixto, ya que en la comprobaci\xf3n de CORS el service worker bloquear\xe1 la petici\xf3n si tenemos contenido mixto");if(TC.Util.isSameProtocol(e,n)){TC.Util.consoleRegister("No hay contenido mixto");TC.Util.consoleRegister("Validamos si tiene CORS");y(e).then(function(t){if(t){TC.Util.consoleRegister("Tiene CORS");o.getWebGLUrl=o.getByUrl_;r.resolve(o.getByUrl_(e))}else{TC.Util.consoleRegister("No tiene CORS");a()}})}else{TC.Util.consoleRegister("Comprobamos si soporta SSL: si no, habr\xe1 que proxificar");h.call(o,e,function(){TC.Util.consoleRegister("Validamos si tiene CORS");y(e).then(function(t){if(t){TC.Util.consoleRegister("Tiene CORS");o.getWebGLUrl=o.getBySSL_;r.resolve(o.getBySSL_(e))}else{TC.Util.consoleRegister("No tiene CORS");o.getWebGLUrl=o.getByProxy_;r.resolve(o.getByProxy_(e))}})},function(){TC.Util.consoleRegister("Al no soportar SSL tenemos contenido mixto, que bloquear\xe1 el service worker: proxificamos");o.getWebGLUrl=o.getByProxy_;r.resolve(o.getByProxy_(e))})}}else{TC.Util.consoleRegister("No hay serviceworker");y(e).then(function(t){if(t){TC.Util.consoleRegister("Tiene cabeceras CORS");o.getWebGLUrl=o.getByUrl_;r.resolve(o.getByUrl_(e))}else{TC.Util.consoleRegister("NO tiene cabeceras CORS");a()}})}}}}return r};m.getLegendUrl=function(e,t){var o=this,r=t||document.location.href,i=/^(https?:\/\/)/i,n=function(e){return!TC.Util.isSameProtocol(e,o.url)&&i.test(e)&&i.test(o.url)&&TC.Util.isSecureURL(o.url.match(i)[1])?e.replace(e.match(i)[1],o.url.match(i)[1]):TC.Util.isServiceWorker()?TC.Util.isSecureURL(e)?e:o.getBySSL_(e):e};return TC.Util.isServiceWorker()?n(e):TC.Util.isSameProtocol(e,r)?/^(https?:)?\/\//i.test(e)?e.substr(e.indexOf("//")):e:TC.Util.isSecureURL(r)&&!TC.Util.isSecureURL(e)?n(e):e};m.getFeatureInfoUrl=function(e){return this.capabilitiesUrl_.call(this,!TC.Util.isSecureURL(e)&&TC.Util.isSecureURL(TC.Util.toAbsolutePath(this.url))?this.getBySSL_(e):e)};m.getFeatureUrl=function(e){return this.capabilitiesUrl_.call(this,!TC.Util.isSecureURL(e)&&TC.Util.isSecureURL(TC.Util.toAbsolutePath(this.url))?this.getBySSL_(e):e)};m.getSiblingLoadedLayer=function(e){var t=this;if(t.map){return t.map.baseLayers.slice(0).concat(t.map.workLayers.slice(0)).filter(function(o){return(o.type===TC.Consts.layerType.WMS||o.type===TC.Consts.layerType.WMTS)&&(o.capabilities===t.capabilities||o.url===t.url)&&(!e||!$.isFunction(e)||e(o))})[0]||null}return null};m.getImageLoad=function(e,t,o){var r=this,i=o||document.location.href,n="POST"===r.options.method;if(r.type===TC.Consts.layerType.WMTS){var a,l,s;if("KVP"!=r.encoding){var p=t.replace("."+r.format.split("/")[1],"");a=(c=p.split("/").slice(p.split("/").length-3).map(function(e){return parseInt(e)}))[0];l=c[1];s=c[2]}else{var c;if((c=/.*TileMatrix=(\d*)&TileCol=(\d*)&TileRow=(\d*)/i.exec(t))&&4==c.length){a=(c=c.slice(1).map(function(e){return parseInt(e)}))[0];l=c[2];s=c[1]}}if(a&&l&&s){var u=r.wrap.getWMTSLayer();if(u){var g=u.TileMatrixSetLink.filter(function(e){return e.TileMatrixSet===r.matrixSet});if(g.length>0&&g[0].TileMatrixSetLimits.length>0){var d=g[0].TileMatrixSetLimits.sort(function(e,t){return parseInt(e.TileMatrix)>parseInt(t.TileMatrix)?1:parseInt(e.TileMatrix)<parseInt(t.TileMatrix)?-1:0})[a];if(d&&r.map&&r.map.on3DView&&!(d.MinTileRow<=l&&d.MaxTileRow>=l&&d.MinTileCol<=s&&d.MaxTileCol>=s)){console.log("Prevenimos petici\xf3n fuera de matrix set, cargamos imagen en blanco");r.imageLoad_blank_.call(r,e);return}}}}}if(r.imageLoad_)r.imageLoad_.call(r,e,t);else{TC.Util.consoleRegister("Buscamos en las capas de trabajo si exite alguna del mismo servicio.");TC.Util.consoleRegister("Si hay capa hermana asignamos la misma funci\xf3n de carga de im\xe1genes sin validar nada.");var h=r.getSiblingLoadedLayer.call(r,function(e){return $.isFunction(e.imageLoad_)});if(!n&&h){TC.Util.consoleRegister("Hay capa hermana cargada, asignamos mismo m\xe9todo de carga");r.imageLoad_=h.imageLoad_;r.getUrl=h.getUrl;r.imageLoad_.call(r,e,t)}else{TC.Util.consoleRegister("No hay capa hermana, pasamos a gestionar");if(TC.Util.isSameOrigin(t)){TC.Util.consoleRegister("Escenario mismo origen");r.imageLoad_=n?m.imageLoadHttpRequest_:m.imageLoad;r.imageLoad_.call(r,e,t)}else{TC.Util.consoleRegister("Escenario cross origin");if(n){r.imageLoad_=m.imageLoad_POST;r.imageLoad_.call(r,e,t);return}TC.Util.consoleRegister("Comprobamos si existe service worker");if(TC.Util.isSecureURL(i)&&TC.Util.isServiceWorker())r.imageLoad_ServiceWorkerCrossOrigin.call(r,e,t);else{TC.Util.consoleRegister("No hay serviceworker");TC.Util.consoleRegister("Siguiente paso: valoramos si el canvas debe mantenerse exportable");if(!r.map||r.map&&!r.map.mustBeExportable){TC.Util.consoleRegister("No hay exportaci\xf3n: no importa un tainted canvas, mantenemos la misma funci\xf3n que si no hubiese cross origin");r.imageLoad_=m.imageLoad;r.imageLoad_.call(r,e,t)}else r.imageLoad_ExportableCrossOrigin.call(r,e,t)}}}}};m.imageLoad_POST=function(e,t){this.getUrl=this.capabilitiesUrl_;this.imageLoadHttpRequest_.call(this,e,!TC.Util.isSecureURL(t)&&TC.Util.isSecureURL(TC.Util.toAbsolutePath(this.url))?this.getBySSL_(t):t)};m.imageLoad_ServiceWorkerCrossOrigin=function(e,t,o){var r=this,i=o||document.location.href;TC.Util.consoleRegister("Hay serviceworker");TC.Util.consoleRegister("Comprobar si tenemos contenido mixto, ya que en la comprobaci\xf3n de CORS el service worker bloquear\xe1 la petici\xf3n si tenemos contenido mixto");if(TC.Util.isSameProtocol(t,i)){TC.Util.consoleRegister("No tenemos contenido mixto");TC.Util.consoleRegister("Valoramos si el canvas debe mantenerse exportable");if(!r.map||r.map&&!r.map.mustBeExportable){TC.Util.consoleRegister("No hay exportaci\xf3n: no importa un tainted canvas, mantenemos la misma funci\xf3n que si no hubiese cross origin");r.imageLoad_=m.imageLoad;r.imageLoad_.call(r,e,t)}else{TC.Util.consoleRegister("Hay exportaci\xf3n a imagen");TC.Util.consoleRegister("Validamos si tiene CORS");$.when(y(r.names.length?r.getUrl(t):TC.Consts.BLANK_IMAGE,e)).then(function(o){if(o){TC.Util.consoleRegister("Tiene cabeceras CORS");r.imageLoad_=m.imageLoad_CrossOrigin;r.imageLoad_.call(r,e,t)}else{TC.Util.consoleRegister("No tiene cabeceras CORS");r.imageLoad_=m.imageLoad_CrossOriginNoCORS;r.imageLoad_.call(r,e,t)}})}}else{TC.Util.consoleRegister("Comprobamos si soporta SSL: si no, habr\xe1 que proxificar");h.call(r,t,function(){TC.Util.consoleRegister("Validamos si debemos mantener un canvas limpio");if(!r.map||r.map&&!r.map.mustBeExportable){TC.Util.consoleRegister("No hay exportaci\xf3n: no importa un tainted canvas, mantenemos la misma funci\xf3n que si no hubiese cross origin");r.imageLoad_=m.imageLoad;r.imageLoad_.call(r,e,t)}else{TC.Util.consoleRegister("Hay exportaci\xf3n a imagen");TC.Util.consoleRegister("Validamos si tiene CORS");$.when(y(r.names.length?r.getBySSL_(t):TC.Consts.BLANK_IMAGE,e)).then(function(o){if(o){TC.Util.consoleRegister("Tiene CORS");r.getUrl=r.getBySSL_;r.imageLoad_=m.imageLoad_CrossOrigin;r.imageLoad_.call(r,e,t)}else{TC.Util.consoleRegister("No tiene CORS");r.imageLoad_=m.imageLoad_CrossOriginNoCORS;r.imageLoad_.call(r,e,t)}})}},function(){TC.Util.consoleRegister("Al no soportar SSL tenemos contenido mixto, que bloquear\xe1 el service worker: proxificamos");r.imageLoad_=m.imageLoad_CrossOriginNoCORS;r.imageLoad_.call(r,e,t)})}};m.imageLoad_ExportableCrossOrigin=function(e,t){var o=this;TC.Util.consoleRegister("El canvas debe manternerse exportable");TC.Util.consoleRegister("Primer paso: validamos si navegamos mediante InternetExplorer. IE es m\xe1s restrictivo en cuanto a la exportaci\xf3n en casos de cross origin");if(TC.Util.detectIE()){TC.Util.consoleRegister("Segundo paso: al navegar mediante IE y haber crossOrigin comprobamos si el servicio cuenta con cabeceras CORS o no");$.when(y(o.names.length?o.getUrl(t):TC.Consts.BLANK_IMAGE,e)).then(function(r){if(r){TC.Util.consoleRegister("Tiene cabeceras CORS");o.imageLoad_=m.imageLoad_CrossOrigin;o.imageLoad_.call(o,e,t)}else{TC.Util.consoleRegister("No tiene cabeceras CORS");o.imageLoad_=m.imageLoad_IE_CrossOriginNoCORS;o.imageLoad_.call(o,e,t)}})}else{TC.Util.consoleRegister("No es IE");o.imageLoad_=m.imageLoad_CrossOrigin;o.imageLoad_.call(o,e,t)}};m.imageLoad_CrossOriginNoCORS=function(e,t){TC.Util.consoleRegister("Proxificamos la url de la imagen para esta petici\xf3n y las siguientes.");this.getUrl=this.getByProxy_;this.imageLoadHttpRequest_.call(this,e,t)};m.imageLoad_IE_CrossOriginNoCORS=function(e,t){this.imageLoad_CrossOriginNoCORS.call(this,e,t)};m.imageLoad_CrossOrigin=function(e,t){var o=this,r=e.getImage();r.crossOrigin="anonymous";r.onerror=function(){if(o.ignoreProxification)o.imageLoad_blank_.call(o,e);else{TC.Util.consoleRegister("La carga de imagen ha dado un error, verificamos si se trata de un 404 u otro tipo de error, tenemos que repetir la petici\xf3n por ajax para poder conocer el status del error, la carga por src no muestra el tipo de error");$.when(d(t,function(e){TC.Util.consoleRegister("Habr\xe1 sido algo moment\xe1neo, no hago nada")},function(i){if(i&&404===i.status){TC.Util.consoleRegister("Se trata de un 404, cargo imagen en blanco y nada m\xe1s.");o.imageLoad_blank_.call(o,e)}else if(400===i.status);else{TC.Util.consoleRegister("No es un 404");o.getUrl=o.getByProxy_;r.onerror=o.imageLoadingError_.bind(o,e,"blob",o.imageLoadedBlob_);r.src=o.names.length?o.getUrl(t):TC.Consts.BLANK_IMAGE;e.load()}}))}};r.src=o.names.length?o.getUrl(t):TC.Consts.BLANK_IMAGE};m.imageLoad=function(e,t){var o=this,r=e.getImage();r.onerror=function(){r.crossOrigin="anonymous";r.onerror=o.imageLoadingError_.bind(o,e,"blob",o.imageLoadedBlob_);r.src=o.names.length?o.getUrl(t):TC.Consts.BLANK_IMAGE};r.src=o.names.length?o.getUrl(t):TC.Consts.BLANK_IMAGE};var P=function(){return this.wrap&&this.wrap.$events?this.wrap.$events:$(this)};m.imageLoadHttpRequest_=function(e,t){var o="",r="POST"===this.options.method;if(r){P.call(this).trigger($.Event(TC.Consts.event.BEFORETILELOAD,{tile:e}));for(var i=t.split("?"),n=i[1].split("&"),a=0;a<n.length;a++){var l=n[a].split("=");l&&l.length>1&&l[1]&&"LAYERS"!==l[0]&&(o+="&"+n[a])}t=i[0]}var s=new XMLHttpRequest;try{s.open(r?this.options.method:"GET",this.names.length?this.getUrl(t):TC.Consts.BLANK_IMAGE);r&&s.setRequestHeader("Content-Type","application/x-www-form-urlencoded");s.responseType="blob";s.onload=this.imageLoadedBlob_.bind(this,s,e);s.onerror=this.imageLoadingError_.bind(this,e,"blob",this.imageLoadedBlob_);o?s.send(o):s.send()}catch(t){this.imageLoadingError_.call(this,e,"blob",this.imageLoadedBlob_)}};m.imageLoadingError_=function(e,t,o){var r=this;e.getImage().onerror=void 0;if(r.ignoreProxification)r.imageLoad_blank_.call(r,e);else{TC.Util.consoleRegister("Se ha producido un error en la petici\xf3n de imagen. Proxificamos la url de la imagen para esta petici\xf3n y las siguientes.");r.getUrl=r.getByProxy_;var i=new XMLHttpRequest;i.open("GET",r.getUrl(e.getImage().getAttribute("src")||e.src_));i.responseType=t;TC.Util.consoleRegister("Si en la gesti\xf3n del error vuelve a dar error, no intentamos nada m\xe1s, cargamos una imagen en blanco y lanzamos el evento de error.");i.onerror=function(){P.call(r).trigger($.Event(TC.Consts.event.TILELOADERROR,{tile:e,error:{code:this.status,text:this.statusText}}));r.imageLoad_blank_.call(r,e)};i.onload=o.bind(r,i,e);i.send()}};m.imageLoadedBlob_=function(e,t){var o=this;if(o.imageLoad_!==m.imageLoadHttpRequest_){TC.Util.consoleRegister("Si hemos llegado hasta aqu\xed es que hemos gestionado un error, por lo tanto: modificamos el m\xe9todo de carga layerProto.imageLoadHttpRequest_");o.imageLoad_=m.imageLoadHttpRequest_}var r=t.getImage();if(e.status>=400&&e.status<=500){P.call(o).trigger($.Event(TC.Consts.event.TILELOADERROR,{tile:t,error:{code:e.status,text:e.statusText}}));o.imageLoad_blank_.call(o,t)}else if(e.response&&e.response.type&&-1===e.response.type.indexOf("image"))o.imageLoad_blank_.call(o,t);else if(200===e.status){var i=URL.createObjectURL(e.response);r.onload=function(e){URL.revokeObjectURL(e.target.src);P.call(o).trigger($.Event(TC.Consts.event.TILELOAD,{tile:t}))};r.setAttribute("src",i)}};m.imageLoad_blank_=function(e){var t=e.getImage();t.crossOrigin="anonymous";t.src=TC.Consts.BLANK_IMAGE};m.getWFSCapabilitiesPromise=function(){void 0===WFSCapabilities&&TC.syncLoadJS(TC.apiLocation+"TC/layer/WFSCapabilitiesParser");var e=this.options.url.replace(/service=wms/i,"service=wfs").replace(/\/wms(\/|\?|\b)/i,"$'/wfs/"),t=$.Deferred(),o=e.substring(e.indexOf("://")<0?0:e.indexOf("://")+3);if(TC.WFScapabilities[o]){setTimeout(function(){t.resolve(TC.WFScapabilities[o])},100);return t}var r={SERVICE:"WFS",VERSION:"2.0.0",REQUEST:"GetCapabilities"};$.ajax({url:this.getUrl(e+"?"+$.param(r)),type:"GET"}).then(function(){var e,r;r=jQuery.isXMLDoc(arguments[0])?arguments[0]:(new DOMParser).parseFromString(arguments[0],"text/xml");var i=$(r).find("ServiceException");0===i.length&&(i=$(r).find("ExceptionText"));if(i.length>0)t.reject(null,"error",i.html());else{try{e=WFSCapabilities.Parse(r)}catch(e){t.reject(e);return}if(e.Operations){var n=e.Operations.GetCapabilities.DCP&&e.Operations.GetCapabilities.DCP.HTTP.Get["xlink:href"]||e.Operations.GetCapabilities.DCPType[0].HTTP.Get.onlineResource;TC.WFScapabilities[n]=e;TC.WFScapabilities[o]=e;t.resolve(e)}else t.reject(null)}},function(e,o,r){t.reject(e,o,r)});return t};m.getFallbackLayer=function(){const e=this;if(e.fallbackLayer instanceof TC.Layer)return e.fallbackLayer;if(e.options.fallbackLayer){var t=e.options.fallbackLayer;if("string"==typeof t){(e.map?e.map.options.availableBaseLayers:TC.Cfg.availableBaseLayers).forEach(function(t){if(e.options.fallbackLayer===t.id){e.fallbackLayer=new TC.layer.Raster($.extend({},t,{isBase:!0,stealth:!0,map:e.map}));e.fallbackLayer.firstOption=e}})}else if(t instanceof TC.Layer){e.fallbackLayer=t;e.fallbackLayer.firstOption=e}else{e.fallbackLayer=new TC.layer.Raster($.extend({},t,{id:TC.getUID(),isBase:!0,stealth:!0,title:layer.title,map:e.map}));e.fallbackLayer.firstOption=e}return e.fallbackLayer}return null}}();var esriParser={parse:function(e){var t=[],o=(new DOMParser).parseFromString(e,"text/xml");if("FeatureInfoResponse"===o.documentElement.tagName)for(var r=o.documentElement.getElementsByTagName("FeatureInfoCollection"),i=0,n=r.length;i<n;i++)for(var a=r[i],l=a.getAttribute("layername"),s=a.getElementsByTagName("FeatureInfo"),p=0,c=s.length;p<c;p++){for(var u=s[p].getElementsByTagName("Field"),g={},d=0,h=u.length;d<h;d++){var f=u[d];g[getElementText(f.getElementsByTagName("FieldName")[0])]=getElementText(f.getElementsByTagName("FieldValue")[0])}var y=new ol.Feature(g);y.setId(l+"."+TC.getUID());t[t.length]=y}return t}};TC.layer=TC.layer||{};TC.Layer||TC.syncLoadJS(TC.apiLocation+"TC/Layer");TC.layer.Vector=function(){TC.Layer.apply(this,arguments);this.type=this.options.type||TC.Consts.layerType.VECTOR;this.features=[];this.selectedFeatures=[];const e=function(e){var t=(e=e||"").indexOf("?");t>=0?e=e.substr(0,t):(t=e.indexOf("#"))>=0&&(e=e.substr(0,t));return e.substr(e.lastIndexOf(".")).toLowerCase()}(this.url),t=function(e){switch(e){case TC.Consts.mimeType.KML:return TC.Consts.format.KML;case TC.Consts.mimeType.GPX:return TC.Consts.format.GPX;case TC.Consts.mimeType.JSON:case TC.Consts.mimeType.GEOJSON:return TC.Consts.format.GEOJSON;case TC.Consts.mimeType.GML:return TC.Consts.format.GML;default:return null}}(this.options.format)||function(e){switch(e){case".kml":return TC.Consts.format.KML;case".gpx":return TC.Consts.format.GPX;case".json":case".geojson":return TC.Consts.format.GEOJSON;case".gml":return TC.Consts.format.GML;case".wkt":return TC.Consts.format.WKT;case".topojson":return TC.Consts.format.TOPOJSON;default:return null}}(e);if(t||this.type===TC.Consts.layerType.KML){t===TC.Consts.format.KML&&(this.type=TC.Consts.layerType.KML);this.title=this.options.title||function(t){for(var o=t=t||"",r=new RegExp("([^/]+"+e+")","i"),i=0;i<3;i++){t=decodeURIComponent(t);var n=r.exec(t);if(n.length>1){o=n[1];break}}return o}(this.url)}this.wrap=new TC.wrap.layer.Vector(this);var o=this.wrap.createVectorLayer();this.wrap.setLayer(o)};TC.inherit(TC.layer.Vector,TC.Layer);!function(){var e=TC.layer.Vector.prototype;e.getTree=function(){var e=null;if(!this.options.stealth){(e={}).children=[];for(var t=0;t<this.features.length;t++){var o=this.features[t].getPath();if(o.length){var r=TC.Util.addArrayToTree(o,e);r&&(r.legend=this.features[t].getLegend())}}e.name=this.name||e.name;e.customLegend=this.options.customLegend;e.title=this.title||e.title;e.uid=this.id}return e};var t=function(e,t,o,r){var i=new $.Deferred;$.when(t.call(e,[o],r)).then(function(t){i.resolve(t[0]);e.map&&e.map.$events.trigger($.Event(TC.Consts.event.FEATUREADD,{layer:e,feature:t[0]}))});return i},o=function(e,t,o,r,i){var n=new $.Deferred,a=e.options.styles&&e.options.styles[r]||TC.Cfg.styles[r],l=$.extend(!0,{},a,i);TC.loadJS(!TC.feature||TC.feature&&!TC.feature[o],[TC.apiLocation+"TC/feature/"+o],function(){for(var r=TC.feature[o],i=new Array(t.length),a=[],s=0,p=t.length;s<p;s++){var c,u=t[s];const o=TC.wrap.Feature.prototype.isNative(u);if(u instanceof r)c=u;else{l.layer=e;o&&(c=u._wrap&&u._wrap.parent);c||(c=new r(u,l))}c.layer=e;i[s]=c;e.features[e.features.length]=c;o||(a[a.length]=c.wrap.feature);c.options.showPopup&&c.showPopup()}a.length&&e.wrap.addFeatures(a);n.resolve(i)});return n};e.addPoint=function(e,o){return t(this,this.addPoints,e,o)};e.addPoints=function(e,t){return o(this,e,"Point",TC.Consts.geom.POINT,t)};e.addMarker=function(e,o){return t(this,this.addMarkers,e,o)};e.addMarkers=function(e,t){return o(this,e,"Marker","marker",t)};e.addPolyline=function(e,o){return t(this,this.addPolylines,e,o)};e.addPolylines=function(e,t){return o(this,e,"Polyline",TC.Consts.geom.POLYLINE,t)};e.addMultiPolyline=function(e,o){return t(this,this.addMultiPolylines,e,o)};e.addMultiPolylines=function(e,t){return o(this,e,"MultiPolyline",TC.Consts.geom.POLYLINE,t)};e.addPolygon=function(e,o){return t(this,this.addPolygons,e,o)};e.addPolygons=function(e,t){return o(this,e,"Polygon",TC.Consts.geom.POLYGON,t)};e.addMultiPolygon=function(e,o){return t(this,this.addMultiPolygons,e,o)};e.addMultiPolygons=function(e,t){return o(this,e,"MultiPolygon",TC.Consts.geom.POLYGON,t)};e.addCircle=function(e,o){return t(this,this.addCircles,e,o)};e.addCircles=function(e,t){return o(this,e,"Circle",TC.Consts.geom.POLYGON,t)};e.addFeature=function(e){var t;TC.feature&&(TC.feature.Point&&e instanceof TC.feature.Point?t=this.addPoint(e):TC.feature.Polyline&&e instanceof TC.feature.Polyline?t=this.addPolyline(e):TC.feature.Polygon&&e instanceof TC.feature.Polygon?t=this.addPolygon(e):TC.feature.MultiPolygon&&e instanceof TC.feature.MultiPolygon?t=this.addMultiPolygon(e):TC.feature.MultiPolyline&&e instanceof TC.feature.MultiPolyline?t=this.addMultiPolyline(e):TC.feature.Circle&&e instanceof TC.feature.Circle&&(t=this.addCircle(e)));return t};e.removeFeature=function(e){const t=this;if(t.map){t.map.getControlsByClass("TC.control.Popup").forEach(function(t){t.isVisible()&&t.currentFeature===e&&t.hide()})}t.wrap.removeFeature(e)};e.getFeatureById=function(e){var t=null,o=this.wrap.getFeatureById(e);o&&(t=o._wrap.parent);return t};e.clearFeatures=function(){var e=this;if(e.features&&e.wrap){if(e.map){e.map.getControlsByClass("TC.control.Popup").forEach(function(t){t.isVisible()&&e.features.indexOf(t.currentFeature)>=0&&t.hide()})}e.features.length=0;e.wrap.clearFeatures()}};e.describeFeatureType=function(e,t){var o=$.Deferred();$.ajax({url:this.wrap.getDescribeFeatureTypeUrl(),type:"GET",dataType:"xml"}).then(function(e){var t="http://www.w3.org/2001/XMLSchema",r=e.getElementsByTagNameNS(t,"complexType")[0];if(r){for(var i=r.getElementsByTagNameNS(t,"element"),n=new Array(i.length),a=0,l=i.length;a<l;a++){var s=i[a];n[a]={name:s.getAttribute("name"),type:s.getAttribute("type"),nillable:"true"===s.getAttribute("nillable"),minOccurs:parseInt(s.getAttribute("minOccurs")),maxOccurs:parseInt(s.getAttribute("maxOccurs"))}}o.resolve(n)}else{var p=e.getElementsByTagName("Exception")[0];p&&o.reject(p.getElementsByTagName("ExceptionText")[0].innerHTML)}},function(e,t,r){o.reject(r)});o.then(function(t){$.isFunction(e)&&e(t)},function(e){$.isFunction(t)&&t(e)});return o.promise()};e.import=function(e){this.wrap.import(e)};e.setNodeVisibility=function(e,t){this.state=TC.Layer.state.LOADING;this.map.$events.trigger($.Event(TC.Consts.event.BEFOREUPDATE));this.map.$events.trigger($.Event(TC.Consts.event.BEFORELAYERUPDATE,{layer:this}));this.tree||(this.tree=this.getTree());if(this.findNode(e,this.tree)===this.tree)this.setVisibility(t);else{this._cache.visibilityStates[e]=t?TC.Consts.visibility.VISIBLE:TC.Consts.visibility.NOT_VISIBLE;var o,r,i=!1;for(o=0;o<this.features.length;o++)if((r=this.features[o]).id==e){i=!0;r.setVisibility(t);break}if(!i)for(o=0;o<this.features.length;o++){void 0===(r=this.features[o])._path&&(r._path="/"+r.getPath().join("/"));r._path===e&&r.setVisibility(t)}}this.state=TC.Layer.state.IDLE;this.map.$events.trigger($.Event(TC.Consts.event.LAYERUPDATE,{layer:this}));this.map.$events.trigger($.Event(TC.Consts.event.UPDATE))};e.getNodeVisibility=function(e){var t=TC.Layer.prototype.getNodeVisibility.call(this,e);this.tree||(this.tree=this.getTree());if(this.findNode(e,this.tree)===this.tree)t=this.getVisibility()?TC.Consts.visibility.VISIBLE:TC.Consts.visibility.NOT_VISIBLE;else{var o=this._cache.visibilityStates[e];void 0!==o&&(t=o)}return t};e.setModifiable=function(e){this.wrap.setModifiable(e)};e.applyEdits=function(e,t,o){return this.wrap.sendTransaction(e,t,o)};e.refresh=function(){return this.wrap.reloadSource()};e.getFeaturesInCurrentExtent=function(e){var t=this.map.getExtent();return this.getFeaturesInExtent(t,e)};e.getFeaturesInExtent=function(e,t){return this.wrap.getFeaturesInExtent(e,t)};e.setProjection=function(e){const t=this;t.wrap.setProjection(e);if(e.crs&&e.oldCrs){t.map.$events.trigger($.Event(TC.Consts.event.BEFORELAYERUPDATE,{layer:t}));t.features.forEach(function(t){t.wrap.setGeometry(TC.Util.reproject(t.geometry,e.oldCrs,e.crs));t.geometry=t.wrap.getGeometry()});t.map.$events.trigger($.Event(TC.Consts.event.LAYERUPDATE,{layer:t}))}};const r=function(e){return $.isArray(e)?e.map(r):e};e.exportState=function(e){const t=this;e=e||{};const o={id:t.id};t.map&&t.map.crs!==t.map.options.crs&&(o.crs=t.map.crs);var i=Math.pow(10,(t.map.wrap.isGeo()?TC.Consts.DEGREE_PRECISION:TC.Consts.METER_PRECISION)+1);o.features=t.features.map(function(o){const n={};var a;switch(!0){case TC.feature.Point&&o instanceof TC.feature.Point:n.type=TC.Consts.geom.POINT;a=t.options.styles&&t.options.styles.point;break;case TC.feature.Marker&&o instanceof TC.feature.Marker:n.type=TC.Consts.geom.POINT;a=t.options.styles&&t.options.styles.marker;break;case TC.feature.Polyline&&o instanceof TC.feature.Polyline:n.type=TC.Consts.geom.POLYLINE;a=t.options.styles&&t.options.styles.line;break;case TC.feature.MultiPolyline&&o instanceof TC.feature.MultiPolyline:n.type=TC.Consts.geom.MULTIPOLYLINE;a=t.options.styles&&t.options.styles.line;break;case TC.feature.Polygon&&o instanceof TC.feature.Polygon:n.type=TC.Consts.geom.POLYGON;a=t.options.styles&&t.options.styles.polygon;break;case TC.feature.MultiPolygon&&o instanceof TC.feature.MultiPolygon:n.type=TC.Consts.geom.MULTIPOLYGON;a=t.options.styles&&t.options.styles.polygon;break;case TC.feature.Circle&&o instanceof TC.feature.Circle:n.type=TC.Consts.geom.CIRCLE;a=t.options.styles&&t.options.styles.polygon}n.id=o.id;n.geom=function(e,t){const o=[Number.MAX_VALUE,Number.MAX_VALUE],i=e.map(r),n=function(e,t){$.isArray(e)?e.forEach(n):0===t&&e<o[0]?o[0]=e:1===t&&e<o[1]&&(o[1]=e)};i.forEach(n);const a=function(e){return Math.round(e*t)/t};o[0]=a(o[0]);o[1]=a(o[1]);const l=function(e,t,r){if($.isArray(e))e.forEach(l);else{0===t&&(r[0]=a(e-o[0]));1===t&&(r[1]=a(e-o[1]))}};i.forEach(l);return{origin:o,geom:i}}(o.geometry,i);n.data=o.getData();n.showsPopup=o.showsPopup;if(void 0===e.exportStyles||e.exportStyles){a=$.extend({},a);for(var l in a){var s=a[l];$.isFunction(s)&&(a[l]=s(o))}n.style=$.extend(a,o.getStyle())}return n});return o};e.importState=function(e){const t=this,o=$.Deferred(),r=new Array(e.features.length);e.features.forEach(function(o,i){const n=$.extend(o.style,{data:o.data,id:o.id,showsPopup:o.showsPopup});var a;switch(o.type){case TC.Consts.geom.POLYGON:a=t.addPolygon;break;case TC.Consts.geom.MULTIPOLYGON:a=t.addMultiPolygon;break;case TC.Consts.geom.POLYLINE:a=t.addPolyline;break;case TC.Consts.geom.MULTIPOLYLINE:a=t.addMultiPolyline;break;case TC.Consts.geom.CIRCLE:a=t.addCircle;break;case TC.Consts.geom.POINT:a=o.style&&(o.style.url||o.style.className)?t.addMarker:t.addPoint}if(a){var l=function(e){const t=e.origin,o=function(e,r,i){if($.isArray(e))e.forEach(o);else{0===r&&(i[0]=e+t[0]);1===r&&(i[1]=e+t[1])}};e.geom.forEach(o);return e.geom}(o.geom);e.crs&&t.map.crs!==e.crs&&(l=TC.Util.reproject(l,e.crs,t.map.crs));r[i]=a.call(t,l,n)}});$.when.apply($,r).then(function(){o.resolve()},function(){o.reject()});return o.promise()}}();function xml2json(e){var t={toObj:function(e){var o={};if(1==e.nodeType){if(e.attributes.length)for(var r=0;r<e.attributes.length;r++)"name"!==e.attributes[r].nodeName&&(o[e.attributes[r].nodeName]=(e.attributes[r].nodeValue||"").toString());if(e.firstChild){for(var i=0,n=0,a=!1,l=e.firstChild;l;l=l.nextSibling)1==l.nodeType?a=!0:3==l.nodeType&&l.nodeValue.match(/[^ \f\n\r\t\v]/)?i++:4==l.nodeType&&n++;if(a)if(2>i&&2>n){t.removeWhite(e);for(l=e.firstChild;l;l=l.nextSibling){var s=t.removePrefix(l.nodeName);if(3==l.nodeType)o["#text"]=t.escape(l.nodeValue);else if(4==l.nodeType)o["#cdata"]=t.escape(l.nodeValue);else if(o[s])o[s]instanceof Array?o[s][o[s].length]=t.toObj(l):o[s]=[o[s],t.toObj(l)];else{var p=null;l.attributes.getNamedItem("name")&&(p=l.attributes.getNamedItem("name").nodeValue),o[p||s]=t.toObj(l)}}}else e.attributes.length?o["#text"]=t.escape(t.innerXml(e)):o=t.escape(t.innerXml(e));else if(i)e.attributes.length?o["#text"]=t.escape(t.innerXml(e)):o=t.escape(t.innerXml(e));else if(n)if(n>1)o=t.escape(t.innerXml(e));else for(l=e.firstChild;l;l=l.nextSibling)o["#cdata"]=t.escape(l.nodeValue)}e.attributes.length||e.firstChild||(o=null)}else 9==e.nodeType?o=t.toObj(e.documentElement):8==e.nodeType?console.log(e.textContent):alert("unhandled node type: "+e.nodeType);return o},toJson:function(e,o,r){var i=o?'"'+o+'"':"";if(e instanceof Array){for(var n=0,a=e.length;a>n;n++)e[n]=t.toJson(e[n],"",r+"\t");i+=(o?":[":"[")+(e.length>1?"\n"+r+"\t"+e.join(",\n"+r+"\t")+"\n"+r:e.join(""))+"]"}else if(null==e)i+=(o&&":")+"null";else if("object"==typeof e){var l=[];for(var s in e)l[l.length]=t.toJson(e[s],s,r+"\t");i+=(o?":{":"{")+(l.length>1?"\n"+r+"\t"+l.join(",\n"+r+"\t")+"\n"+r:l.join(""))+"}"}else i+="string"==typeof e?(o&&":")+'"'+e.toString()+'"':(o&&":")+e.toString();return i},innerXml:function(e){var t="";if("innerHTML"in e)t=e.innerHTML;else for(var o=function(e){var t="";if(1==e.nodeType){t+="<"+e.nodeName;for(var r=0;r<e.attributes.length;r++)t+=" "+e.attributes[r].nodeName+'="'+(e.attributes[r].nodeValue||"").toString()+'"';if(e.firstChild){t+=">";for(var i=e.firstChild;i;i=i.nextSibling)t+=o(i);t+="</"+e.nodeName+">"}else t+="/>"}else 3==e.nodeType?t+=e.nodeValue:4==e.nodeType&&(t+="<![CDATA["+e.nodeValue+"]]>");return t},r=e.firstChild;r;r=r.nextSibling)t+=o(r);return t},escape:function(e){return e.replace(/[\\]/g,"\\\\").replace(/[\"]/g,'\\"').replace(/[\n]/g,"\\n").replace(/[\r]/g,"\\r")},removeWhite:function(e){e.normalize();for(var o=e.firstChild;o;)if(3==o.nodeType)if(o.nodeValue.match(/[^ \f\n\r\t\v]/))o=o.nextSibling;else{var r=o.nextSibling;e.removeChild(o),o=r}else 1==o.nodeType?(t.removeWhite(o),o=o.nextSibling):o=o.nextSibling;return e},removePrefix:function(e){return e.substring(e.indexOf(":")+1)}};return 9==e.nodeType&&(e=e.documentElement),t.toObj(t.removeWhite(e))}var WFSCapabilities=function(){var e="1.0.0",t="1.1.0",o="2.0.0",r=function(r,i){switch(i){case e:var n=r.Capability.Request;if(n.GetFeature){var a=[];for(var l in n.GetFeature.ResultFormat)a.push(l.toLowerCase());n.GetFeature.outputFormat=a,delete n.GetFeature.ResultFormat,n.GetFeature.Operations=r.FeatureTypeList.Operations}return n;case t:return{};case o:var s={};for(var l in r.OperationsMetadata){var p={};p[l]=r.OperationsMetadata[l];for(var c in p[l])p[l][c]&&p[l][c].hasOwnProperty("AllowedValues")&&(p[l][c]=p[l][c].AllowedValues.Value);$.extend(s,p)}return s}return null},i=function(r,i){switch(i){case e:for(var n={},a=0;a<r.FeatureTypeList.FeatureType.length;a++){n[(l=r.FeatureTypeList.FeatureType[a].Name).substring(l.indexOf(":")+1)]=r.FeatureTypeList.FeatureType[a]}return n;case t:return{};case o:for(n={},a=0;a<r.FeatureTypeList.FeatureType.length;a++){var l;n[(l=r.FeatureTypeList.FeatureType[a].Name).substring(l.indexOf(":")+1)]=r.FeatureTypeList.FeatureType[a]}return n}return null},n=function(r,i){switch(i){case e:return r.Filter_Capabilities;case t:return{};case o:return r.Filter_Capabilities}return null},a=function(r,i){switch(i){case e:var n={};for(var a in r)"string"==typeof r[a]&&(n[a]=r[a]);return n;case t:return{};case o:n={};for(var a in r)"string"==typeof r[a]&&(n[a]=r[a]);return n}return{}};return{Promises:function(e){e=e;var t=$.Deferred(),o=e.substring(e.indexOf("://")<0?0:e.indexOf("://")+3);if(TC.capabilities[o])return t.resolve(TC.capabilities[o]),t;var r={SERVICE:"WFS",VERSION:"2.0.0",REQUEST:"GetCapabilities"};return $.ajax({url:TC.proxify(e)+"?"+$.param(r),type:"GET"}).then(function(){var e=WFSCapabilities.Parse(arguments[0]),r=e.Operations.GetCapabilities.DCP&&e.Operations.GetCapabilities.DCP.HTTP.Get["xlink:href"]||e.Operations.GetCapabilities.DCPType[0].HTTP.Get.onlineResource;TC.capabilities[r]=e,TC.capabilities[o]=e,t.resolve(WFSCapabilities.Parse(arguments[0]))}),t},Parse:function(){var l,s,p,c,u=xml2json(arguments[0]);switch(u.version){case e:l=e;break;case t:l=t;break;case o:l=o}s=r(u,l),p=i(u,l),c=n(u,l);var g=a(u,l),d={Operations:s,FeatureTypes:p,Filters:c};return $.extend(d,g),d}}}(),TC=TC||{};TC.Geometry=TC.Geometry||{isPoint:function(e){return $.isArray(e)&&e.length>=2&&"number"==typeof e[0]&&"number"==typeof e[1]},isRing:function(e){return $.isArray(e)&&(0===e.length||TC.Geometry.isPoint(e[0]))},isRingCollection:function(e){return $.isArray(e)&&(0===e.length||TC.Geometry.isRing(e[0]))},isMultiRingCollection:function(e){return $.isArray(e)&&(0===e.length||TC.Geometry.isRingCollection(e[0]))},getNearest:function(e,t){return TC.wrap.Geometry.getNearest(e,t)},isInside:function e(t,o){var r=!1;if(TC.Geometry.isPoint(t))if(TC.Geometry.isPoint(o))r=t[0]===o[0]&&t[1]===o[1];else if(TC.Geometry.isRing(o))for(var i=0,n=o.length-1;i<o.length;n=i++){var a=o[i][0],l=o[i][1],s=o[n][0],p=o[n][1];l>t[1]!=p>t[1]&&t[0]<(s-a)*(t[1]-l)/(p-l)+a&&(r=!r)}else if(TC.Geometry.isRingCollection(o)&&o.length>0){if(e(t,o[0])){var c=!1;for(i=1;i<o.length;i++)if(e(t,o[i])){c=!0;break}c||(r=!0)}}else if(TC.Geometry.isMultiRingCollection(o)&&o.length>0){i=0;for(var u=o.length;i<u;i++)if(e(t,o[i])){r=!0;break}}return r}};var SITNA=window.SITNA||{},TC=window.TC||{};TC.isDebug=!1;!function(){if(!window.TC||!window.TC.Cfg){if(document.currentScript)i=document.currentScript;else{var e=document.getElementsByTagName("script");i=e[e.length-1]}var t=i.getAttribute("src");TC.apiLocation=t.substr(0,t.lastIndexOf("/")+1);var o=TC.apiLocation+(TC.isDebug?"tcmap.js":"tcmap.min.js"),r=new XMLHttpRequest;r.open("GET",o,!1);r.send(null);var i,n=document.getElementsByTagName("head")[0];(i=document.createElement("script")).type="text/javascript";i.text=r.responseText;n.appendChild(i)}}();SITNA.Consts=TC.Consts;SITNA.Cfg=TC.Cfg;SITNA.Cfg.layout=TC.apiLocation+"TC/layout/responsive";SITNA.Map=function(e,t){var o=this;TC.Cfg.controls.search.allowedSearchTypes=$.extend(TC.Cfg.controls.search.allowedSearchTypes,{urban:{},street:{},number:{},cadastral:{}});if(t&&t.controls&&t.controls.search){var r=Object.keys(t.controls.search),i=$.extend(t.controls.search,{allowedSearchTypes:{}});r.forEach(function(e){if("boolean"==typeof t.controls.search[e]||$.isPlainObject(t.controls.search[e])){if(t.controls.search[e])switch(!0){case"postalAddress"===e:i.allowedSearchTypes[TC.Consts.searchType.NUMBER]=$.isPlainObject(t.controls.search[e])?t.controls.search[e]:{};break;case"cadastralParcel"===e:i.allowedSearchTypes[TC.Consts.searchType.CADASTRAL]=$.isPlainObject(t.controls.search[e])?t.controls.search[e]:{};break;case"town"===e:i.allowedSearchTypes[TC.Consts.searchType.URBAN]=$.isPlainObject(t.controls.search[e])?t.controls.search[e]:{};break;default:i.allowedSearchTypes[e]=$.isPlainObject(t.controls.search[e])?t.controls.search[e]:{}}delete i[e]}});t.controls.search=i}var n,a,l=new TC.Map(e,t);o.addLayer=function(e,t){l.addLayer(e,t)};o.setBaseLayer=function(e,t){l.setBaseLayer(e,t)};o.addMarker=function(e,t){l.addMarker(e,t)};o.zoomToMarkers=function(e){l.zoomToMarkers(e)};o.loaded=function(e){l.loaded(e)};l.loaded(function(){TC.loadJS(!TC.control.Search,TC.apiLocation+"TC/control/Search",function(){(n=new TC.control.Search).register(l);n.getLayer().then(function(e){a=e})});if(!l.activeControl){var e=l.getControlsByClass("TC.control.FeatureInfo")[0];e&&e.activate()}});o.getQueryableData=function(e,t){var o=n.availableSearchTypes[e];if(o.queryableData)t&&t(o.queryableData);else{var r={request:"GetFeature",service:"WFS",typename:o.featurePrefix+":"+o.featureType,version:o.version,propertyname:(o.dataIdProperty instanceof Array?o.dataIdProperty:[o.dataIdProperty]).concat(o.outputProperties instanceof Array?o.outputProperties:[o.outputProperties]).join(","),outputformat:TC.Consts.format.JSON},i=o.url+"?"+$.param(r);$.ajax({url:i}).done(function(e){o.queryableData=[];if(e.features)for(var r=e.features,i=0;i<r.length;i++){var a=r[i];e={id:[]};o.dataIdProperty instanceof Array||(o.dataIdProperty=[o.dataIdProperty]);for(var l=0;l<o.dataIdProperty.length;l++)a.properties.hasOwnProperty(o.dataIdProperty[l])&&e.id.push(a.properties[o.dataIdProperty[l]]);e.id=o.idPropertiesIdentifier?e.id.join(o.idPropertiesIdentifier):e.id.join("");e.label=[];o.outputProperties instanceof Array||(o.outputProperties=[o.outputProperties]);for(var s=0;s<o.outputProperties.length;s++)a.properties.hasOwnProperty(o.outputProperties[s])&&e.label.push(a.properties[o.outputProperties[s]]);var p=e.label instanceof Array&&e.label.join("").trim().length>0||!(e.label instanceof Array)&&e.label.trim().length>0;e.label=o.outputFormatLabel?o.outputFormatLabel.tcFormat(e.label):e.label.join("-");p&&o.queryableData.push(e)}o.queryableData=o.queryableData.sort(function(e,t){return o.idPropertiesIdentifier&&-1==e.id.indexOf(o.idPropertiesIdentifier)?n.removePunctuation(e.label)<n.removePunctuation(t.label)?-1:n.removePunctuation(e.label)>n.removePunctuation(t.label)?1:0:n.removePunctuation(e.label.split(" ")[0])<n.removePunctuation(t.label.split(" ")[0])?-1:n.removePunctuation(e.label.split(" ")[0])>n.removePunctuation(t.label.split(" ")[0])?1:0});o.queryableData=o.queryableData.filter(function(e,t,o){return t<1||e.id!==o[t-1].id&&e.label!==o[t-1].label});t&&t(o.queryableData)})}};o.getMunicipalities=function(e){o.getQueryableData(SITNA.Consts.mapSearchType.MUNICIPALITY,e)};o.getUrbanAreas=function(e){o.getQueryableData(SITNA.Consts.mapSearchType.URBAN,e)};o.getCommonwealths=function(e){o.getQueryableData(SITNA.Consts.mapSearchType.COMMONWEALTH,e)};o.getCouncils=function(e){o.getQueryableData(SITNA.Consts.mapSearchType.COUNCIL,e)};o.searchCommonwealth=function(e,t){o.searchTyped(SITNA.Consts.mapSearchType.COMMONWEALTH,e,t)};o.searchCouncil=function(e,t){o.searchTyped(SITNA.Consts.mapSearchType.COUNCIL,e,t)};o.searchUrbanArea=function(e,t){o.searchTyped(SITNA.Consts.mapSearchType.URBAN,e,t)};o.searchMunicipality=function(e,t){o.searchTyped(SITNA.Consts.mapSearchType.MUNICIPALITY,e,t)};o.searchTyped=function(e,t,r){var i=TC.getUID(),s=n.availableSearchTypes[e];t instanceof Array&&s.goToIdFormat&&(t=s.goToIdFormat.tcFormat(t));n._search.data=n._search.data||[];n._search.data.push({dataLayer:s.featureType,dataRole:e,id:t,label:"",text:""});o.removeSearch();if(n.availableSearchTypes[e]&&!n.getSearchTypeByRole(e)){n.availableSearchTypes[e].goTo||(n.availableSearchTypes[e].goTo=function(e){var t=function(e){TC.filter||TC.syncLoadJS(TC.apiLocation+"TC/Filter");var t=[];s.idPropertiesIdentifier&&(e=e.split(s.idPropertiesIdentifier));e instanceof Array||(e=[e]);for(var o=0;o<s.dataIdProperty.length;o++)t.push(new TC.filter.equalTo(s.dataIdProperty[o],$.trim(e[o])));return t=t.length>1?new TC.filter.and(t):t[0]}(e);return{params:{type:TC.Consts.layerType.WFS,url:this.url,version:this.version,geometryName:this.geometryName,featurePrefix:this.featurePrefix,featureType:this.featureType,properties:t,outputFormat:this.outputFormat,styles:this.styles}}}.bind(s));n.addAllowedSearchType(e,n.availableSearchTypes[e],n)}l.one(TC.Consts.event.SEARCHQUERYEMPTY,function(e){l.toast(n.EMPTY_RESULTS_LABEL,{type:TC.Consts.msgType.INFO,duration:5e3});r&&r(null)});l.one(TC.Consts.event.FEATURESADD,function(t){t.layer==a&&t.layer.features&&t.layer.features.length>0&&l.zoomToFeatures(t.layer.features);o.search={layer:t.layer,type:e};r&&r(t.layer.id!==i?t.layer.id:i)});n.goToResult(t,e)};o.searchFeature=function(e,t,r,i){var a=TC.getUID(),s=n.featurePrefix;o.removeSearch();e=(e||"").trim();t=(t||"").trim();r=(r||"").trim();if(0==e.length||0==t.length||0==r.length){l.toast(n.EMPTY_RESULTS_LABEL,{type:TC.Consts.msgType.INFO,duration:5e3});i&&i(null)}else{if(e.indexOf(":")>-1){s=e.split(":")[0];e=e.split(":")[1]}var p,c={id:a,type:SITNA.Consts.layerType.WFS,url:n.url,version:n.version,stealth:!0,geometryName:"the_geom",featurePrefix:s,featureType:e,maxFeatures:1,properties:function(e){TC.filter||TC.syncLoadJS(TC.apiLocation+"TC/Filter");if(e&&e instanceof Array){var t=e.map(function(e){if(!e.hasOwnProperty("type"))return new TC.filter.equalTo(e.name,e.value);switch(!0){case e.type==TC.Consts.comparison.EQUAL_TO:return new TC.filter.equalTo(e.name,e.value)}});return t.length>1?TC.filter.and.apply(null,t):t[0]}}([{name:t,value:r,type:TC.Consts.comparison.EQUAL_TO}]),outputFormat:TC.Consts.format.JSON};l.addLayer(c).then(function(e){p=e;o.search={layer:e,type:SITNA.Consts.mapSearchType.GENERIC}});l.on(TC.Consts.event.FEATURESADD,function(e){if(e.layer==p&&e.layer.features&&e.layer.features.length>0){for(var t=0;t<e.layer.features.length;t++)e.layer.features[t].showsPopup!=n.queryableFeatures&&(e.layer.features[t].showsPopup=n.queryableFeatures);l.zoomToFeatures(e.layer.features)}});l.on(TC.Consts.event.LAYERUPDATE,function(e){e.layer==p&&e.newData&&e.newData.features&&0==e.newData.features.length&&l.toast(n.EMPTY_RESULTS_LABEL,{type:TC.Consts.msgType.INFO,duration:5e3});i&&i(e.layer==p&&e.newData&&e.newData.features&&0==e.newData.features.length?null:a)})}};o.removeSearch=function(e){if(o.search)if(n.availableSearchTypes[o.search.type]&&n.availableSearchTypes[o.search.type].hasOwnProperty("goTo")){for(var t=0;t<o.search.layer.features.length;t++)o.search.layer.removeFeature(o.search.layer.features[t]);o.search=null}else l.removeLayer(o.search.layer).then(function(){o.search=null});e&&e()};o.exportImage=function(){return l.exportImage()};o.search=null};