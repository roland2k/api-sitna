TC.filter={};TC.filter.Filter=function(t){this.tagName_=t;this._defaultNSURL="http://www.opengis.net/ogc";this._defaultPrefixNS=this._wfsPrefixNS="ogc";this._fieldTitle="PropertyName";this._defaultNSURL=this._wfsNSURL="http://www.opengis.net/ogc";this._wfs2prefixNS="fes";this._wfs2NSURL="http://www.opengis.net/fes/2.0";this._wfs2FieldTitle="ValueReference"};TC.filter.Filter.prototype.getTagName=function(){return this.tagName_};TC.filter.Filter.prototype.writeFilterCondition_=function(){return'<{prefix}:Filter xmlns:{prefix}="{NSURL}">{inner}</{prefix}:Filter>'.format({prefix:this._defaultPrefixNS,NSURL:this._defaultNSURL,tag:this.getTagName(),inner:this.writeInnerCondition_(this)})};TC.filter.Filter.prototype.writeInnerCondition_=function(t){if(t!=this){t._defaultNSURL=this._defaultNSURL;t._defaultPrefixNS=this._defaultPrefixNS}return t instanceof TC.filter.LogicalNary?t.write():t instanceof TC.filter.ComparisonBinary?t.write():t instanceof TC.filter.Comparison?t.write():t instanceof TC.filter.Spatial?t.write():(TC.filter.Function,t.write())};TC.filter.Filter.prototype.writeInnerArrayCondition_=function(t){return t.reduce(function(t,e,i){return(t instanceof TC.filter.Filter?t.writeInnerCondition_(t):t)+e.writeInnerCondition_(e)})};TC.filter.Filter.prototype.getText=function(t){if(t&&parseFloat(t,10)>=2){this._defaultPrefixNS=this._wfs2prefixNS;this._defaultNSURL=this._wfs2NSURL;this._fieldTitle=this._wfs2FieldTitle}return this.writeFilterCondition_()};TC.filter.and=function(t){var e=[null].concat(Array.prototype.slice.call(arguments));return new(Function.prototype.bind.apply(TC.filter.And,e))};TC.filter.or=function(t){var e=[null].concat(Array.prototype.slice.call(arguments));return new(Function.prototype.bind.apply(TC.filter.Or,e))};TC.filter.not=function(t){return new TC.filter.Not(t)};TC.filter.bbox=function(){return"[object String]"!==Object.prototype.toString.call(arguments[0])?new TC.filter.Bbox(null,arguments[0],arguments[1]):new TC.filter.Bbox(arguments[0],arguments[1],arguments[2])};TC.filter.intersects=function(){return"[object String]"!==Object.prototype.toString.call(arguments[0])?new TC.filter.Intersects(null,arguments[0],arguments[1]):new TC.filter.Intersects(arguments[0],arguments[1],arguments[2])};TC.filter.within=function(){return"[object String]"!==Object.prototype.toString.call(arguments[0])?new TC.filter.Within(null,arguments[0],arguments[1]):new TC.filter.Within(arguments[0],arguments[1],arguments[2])};TC.filter.equalTo=function(t,e,i){return new TC.filter.EqualTo(t,e,i)};TC.filter.notEqualTo=function(t,e,i){return new TC.filter.NotEqualTo(t,e,i)};TC.filter.lessThan=function(t,e){return new TC.filter.LessThan(t,e)};TC.filter.lessThanOrEqualTo=function(t,e){return new TC.filter.LessThanOrEqualTo(t,e)};TC.filter.greaterThan=function(t,e){return new TC.filter.GreaterThan(t,e)};TC.filter.greaterThanOrEqualTo=function(t,e){return new TC.filter.GreaterThanOrEqualTo(t,e)};TC.filter.isNull=function(t){return new TC.filter.IsNull(t)};TC.filter.between=function(t,e,i){return new TC.filter.IsBetween(t,e,i)};TC.filter.function=function(t,e){return new TC.filter.Function(t,e)};TC.filter.like=function(t,e,i,r,n,a){return new TC.filter.IsLike(t,e,i,r,n,a)};TC.filter.LogicalNary=function(t,e){TC.filter.Filter.call(this,t);this.conditions=Array.prototype.slice.call(arguments,1)};TC.inherit(TC.filter.LogicalNary,TC.filter.Filter);TC.filter.And=function(t){var e=["And"].concat(Array.prototype.slice.call(arguments));TC.filter.LogicalNary.apply(this,e)};TC.inherit(TC.filter.And,TC.filter.LogicalNary);TC.filter.Or=function(t){var e=["Or"].concat(Array.prototype.slice.call(arguments));TC.filter.LogicalNary.apply(this,e)};TC.inherit(TC.filter.Or,TC.filter.LogicalNary);TC.filter.LogicalNary.prototype.write=function(){return"<{prefix}:{tag}>{inner}</{prefix}:{tag}>".format({prefix:this._defaultPrefixNS,tag:this.getTagName(),inner:this.writeInnerArrayCondition_(this.conditions)})};TC.filter.Not=function(t){this.condition=t;TC.filter.Filter.call(this,"Not")};TC.inherit(TC.filter.Not,TC.filter.Filter);TC.filter.Filter.prototype.write=function(){return"<{prefix}:{tag}>{inner}</{prefix}:{tag}>".format({prefix:this._defaultPrefixNS,tag:this.getTagName(),inner:this.writeInnerCondition_(this.condition)})};TC.filter.Bbox=function(t,e,i){TC.filter.Filter.call(this,"BBOX");this.geometryName=t;this.extent=e;this.srsName=i};TC.inherit(TC.filter.Bbox,TC.filter.Filter);TC.filter.Comparison=function(t,e){TC.filter.Filter.call(this,t);this.propertyName=e};TC.inherit(TC.filter.Comparison,TC.filter.Filter);TC.filter.Comparison.prototype.write=function(){var t="";this.lowerBoundary&&this.upperBoundary&&(t="<{prefix}:LowerBoundary><{prefix}:Literal>{LowerBoundary}</{prefix}:Literal></{prefix}:LowerBoundary><{prefix}:UpperBoundary><{prefix}:Literal>{UpperBoundary}</{prefix}:Literal></{prefix}:UpperBoundary>".format({prefix:this._defaultPrefixNS,LowerBoundary:this.lowerBoundary,UpperBoundary:this.upperBoundary}));this.pattern&&(t="<{prefix}:Literal>{Pattern}</{prefix}:Literal>".format({prefix:this._defaultPrefixNS,Pattern:this.pattern}));this.params&&(t=$.isArray(this.params)?this.params.reduce(function(t,e,i){var r=function(t){return"<{prefix}:Literal>{value}</{prefix}:Literal>".format({prefix:this._defaultPrefixNS,value:t})};return(i>0?t:r(t))+r(e)}):"<{prefix}:Literal>{value}</{prefix}:Literal>".format({prefix:this._defaultPrefixNS,value:this.params}));return"<{prefix}:{tag}{matchCase}{escape}{singleChar}{wildCard}><{prefix}:{fieldTitle}>{name}</{prefix}:{fieldTitle}>{values}</{prefix}:{tag}>".format({prefix:this._defaultPrefixNS,tag:this.getTagName(),matchCase:void 0!==this.matchCase?' matchCase="'+this.matchCase+'"':"",escape:void 0!==this.escapeChar?' escape="'+this.escapeChar+'"':"",singleChar:void 0!==this.singleChar?' singleChar="'+this.singleChar+'"':"",wildCard:void 0!==this.wildCard?' wildCard="'+this.wildCard+'"':"",name:this.propertyName,values:t,fieldTitle:this._fieldTitle})};TC.filter.ComparisonBinary=function(t,e,i,r){TC.filter.Comparison.call(this,t,e);this.expression=i;this.matchCase=r};TC.inherit(TC.filter.ComparisonBinary,TC.filter.Comparison);TC.filter.ComparisonBinary.prototype.write=function(){return("<{prefix}:{tag}{matchCase}>"+(this.propertyName instanceof TC.filter.Filter?"{name}":"<{prefix}:{fieldTitle}>{name}</{prefix}:{fieldTitle}>")+"<{prefix}:Literal>{value}</{prefix}:Literal></{prefix}:{tag}>").format({prefix:this._defaultPrefixNS,tag:this.getTagName(),matchCase:void 0!==this.matchCase?' matchCase="'+this.matchCase+'"':"",name:this.propertyName instanceof TC.filter.Filter?this.propertyName.write():this.propertyName,value:this.expression,fieldTitle:this._fieldTitle})};TC.filter.EqualTo=function(t,e,i){TC.filter.ComparisonBinary.call(this,"PropertyIsEqualTo",t,e,i)};TC.inherit(TC.filter.EqualTo,TC.filter.ComparisonBinary);TC.filter.GreaterThan=function(t,e){TC.filter.ComparisonBinary.call(this,"PropertyIsGreaterThan",t,e)};TC.inherit(TC.filter.GreaterThan,TC.filter.ComparisonBinary);TC.filter.GreaterThanOrEqualTo=function(t,e){TC.filter.ComparisonBinary.call(this,"PropertyIsGreaterThanOrEqualTo",t,e)};TC.inherit(TC.filter.GreaterThanOrEqualTo,TC.filter.ComparisonBinary);TC.filter.LessThan=function(t,e){TC.filter.ComparisonBinary.call(this,"PropertyIsLessThan",t,e)};TC.inherit(TC.filter.LessThan,TC.filter.ComparisonBinary);TC.filter.LessThanOrEqualTo=function(t,e){TC.filter.ComparisonBinary.call(this,"PropertyIsLessThanOrEqualTo",t,e)};TC.inherit(TC.filter.LessThanOrEqualTo,TC.filter.ComparisonBinary);TC.filter.NotEqualTo=function(t,e,i){TC.filter.ComparisonBinary.call(this,"PropertyIsNotEqualTo",t,e,i)};TC.inherit(TC.filter.NotEqualTo,TC.filter.ComparisonBinary);TC.filter.IsLike=function(t,e,i,r,n,a){TC.filter.Comparison.call(this,"PropertyIsLike",t);this.pattern=e;this.wildCard=void 0!==i?i:"*";this.singleChar=void 0!==r?r:".";this.escapeChar=void 0!==n?n:"!";this.matchCase=a};TC.inherit(TC.filter.IsLike,TC.filter.Comparison);TC.filter.IsNull=function(t){TC.filter.Comparison.call(this,"PropertyIsNull",t)};TC.inherit(TC.filter.IsNull,TC.filter.Comparison);TC.filter.IsBetween=function(t,e,i){TC.filter.Comparison.call(this,"PropertyIsBetween",t);this.lowerBoundary=e;this.upperBoundary=i};TC.inherit(TC.filter.IsBetween,TC.filter.Comparison);TC.filter.Function=function(t,e){TC.filter.Filter.call(this,t);this.params=e};TC.inherit(TC.filter.Function,TC.filter.Filter);TC.filter.Function.prototype.write=function(){var t="";if(this.params){var e=function(t,e){if("string"==typeof t)return"<{prefix}:Literal>{value}</{prefix}:Literal>".format({prefix:e,value:t});if("object"==typeof t){var i="";for(var r in t)i+="<{prefix}:{key}>{value}</{prefix}:{key}>".format({prefix:e,value:t[r],key:r});return i}};if($.isArray(this.params)){var i=this._defaultPrefixNS;t=this.params.reduce(function(t,r,n){var a=function(t){return e(t,i)};return(n>1?t:a(t))+a(r)})}else t=e(this.params,this._defaultPrefixNS)}return'<{prefix}:Function name="{tag}">{inner}</{prefix}:Function>'.format({prefix:this._defaultPrefixNS,tag:this.getTagName(),inner:t})};TC.filter.Spatial=function(t,e,i,r){TC.filter.Filter.call(this,t);this.geometryName=e;this.geometry=i;this.srsName=r};TC.inherit(TC.filter.Spatial,TC.filter.Filter);TC.filter.Spatial.prototype.write=function(){return(this.geometryName?"<{prefix}:{tag}><{prefix}:{fieldTitle}>{name}</{prefix}:{fieldTitle}>{geometry}</{prefix}:{tag}>":"<{prefix}:{tag}><{prefix}:{fieldTitle}/>{geometry}</{prefix}:{tag}>").format({prefix:this._defaultPrefixNS,tag:this.getTagName(),name:this.geometryName,srsName:void 0!==this.srsName?' srsName="'+this.srsName+'"':"",geometry:this.geometry instanceof TC.filter.Function?this.writeInnerCondition_(this.geometry):this.geometry.wrap.toGML(),fieldTitle:this._fieldTitle})};TC.filter.Bbox=function(t,e,i){TC.filter.Filter.call(this,"BBOX");this.geometryName=t;this.extent=e;this.srsName=i};TC.inherit(TC.filter.Bbox,TC.filter.Filter);TC.filter.Bbox.prototype.write=function(){var t="<gml:Envelope{srsName}><gml:lowerCorner>{lowerCorner}</gml:lowerCorner><gml:upperCorner>{upperCorner}</gml:upperCorner></gml:Envelope>".format({srsName:void 0!==this.srsName?' srsName="'+this.srsName+'"':"",lowerCorner:this.extent[0]+" "+this.extent[1],upperCorner:this.extent[2]+" "+this.extent[3]});return(this.geometryName?"<{prefix}:{tag}><{prefix}:{fieldTitle}>{name}</{prefix}:{fieldTitle}>{BBOX}</{prefix}:{tag}>":"<{prefix}:{tag}><{prefix}:{fieldTitle}/>{BBOX}</{prefix}:{tag}>").format({prefix:this._defaultPrefixNS,tag:this.getTagName(),fieldTitle:this._fieldTitle,name:this.geometryName,BBOX:t})};TC.filter.Intersects=function(t,e,i){TC.filter.Spatial.call(this,"Intersects",t,e,i)};TC.inherit(TC.filter.Intersects,TC.filter.Spatial);TC.filter.Within=function(t,e,i){TC.filter.Spatial.call(this,"Within",t,e,i)};TC.inherit(TC.filter.Within,TC.filter.Spatial);