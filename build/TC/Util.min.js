var TC=TC||{};!function(e,t){"object"==typeof exports?module.exports=t():"function"==typeof define&&define.amd?define([],t):e.Util=t()}(TC,function(){String.prototype.soundex=function(){var e=this.toLowerCase().split("");f=e.shift(),r="",codes={a:"",e:"",i:"",o:"",u:"",b:1,f:1,p:1,v:1,c:2,g:2,j:2,k:2,q:2,s:2,x:2,z:2,d:3,t:3,l:4,m:5,n:5,r:6};r=f+e.map(function(e,t,r){return codes[e]}).filter(function(e,t,r){return 0===t?e!==codes[f]:e!==r[t-1]}).join("");return(r+"000").slice(0,4).toUpperCase()};var e=Number.prototype.toLocaleString;Number.prototype.toLocaleString=function(t,r){if("eu-ES"!=t||TC.Util.detectIE())return e.apply(this,arguments);var n=e.apply(this,arguments);n=n.replace(/\,/g,".");Math.floor(this)==this&&Number.isInteger(Math.floor(this))||(n=n.replace(/.([^.]*)$/,",$1"));return n};var t={},o={},a=["Capability","Request","GetMap","DCPType","0","HTTP","Get","OnlineResource"],s=["OperationsMetadata","GetTile","DCP","HTTP","Get","0","href"],l=function(e,t,r){return r<t.length-1?e.hasOwnProperty(t[r])?l(e[t[r]],t,++r):null:e[t[r]]};const c=new WeakMap,u=new WeakMap,g={}.hasOwnProperty,p=new Map,d=e=>Math.floor(e)!==e&&e.toString().split(".")[1].length||0;var m={getElevationGain:function(e){const t=(e=e||{}).coords;if(t&&t.length>0&&t[0].length>2){var r=0,n=0;const f=e.hillDeltaThreshold||0;for(var o,i,a,s=!0,l=0;l<t.length;l++){var c=t[l][2];if(null!==c){if(void 0===o){o=c;i=c;a=c}i=Math.min(i,c);a=Math.max(a,c);var u=c-o;if(u>f||u>0&&l==t.length-1){if(s)r+=u;else{n-=i-o;r+=c-i;s=!0}o=c;i=c;a=c}else if(u<-f||u<0&&l==t.length-1){if(s){r+=a-o;n-=c-a;s=!1}else n-=u;o=c;i=c;a=c}}}return{upHill:Math.round(r),downHill:Math.round(n)}}return null},isPlainObject:function(e){return"object"==typeof e&&!e.nodeType&&e.window!==e&&!(e.constructor&&!g.call(e.constructor.prototype,"isPrototypeOf"))},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},isFunction:function(e){return"function"==typeof e},extend:function(){var e,t=arguments[0]||{},r=1,n=!1;if("boolean"==typeof t){n=t;t=arguments[r]||{};r++}"object"==typeof t||m.isFunction(t)||(t={});for(var o=arguments.length;r<o;r++){const o=arguments[r];if(null!=o)for(var i in o){const r=t[i],a=o[i];if(t===a)continue;const s=Array.isArray(a);if(n&&a&&(m.isPlainObject(a)||s)){e=s?r&&Array.isArray(r)?r:[]:r&&m.isPlainObject(r)?r:{};t[i]=m.extend(n,e,a)}else void 0!==a&&(t[i]=a)}}return t},getMapLocale:function(e){return e.options&&e.options.locale&&e.options.locale.replace("_","-")||"es-ES"},regex:{PROTOCOL:/(^https?:)/i},isOnCapabilities:function(e){var t=2!=arguments.length||arguments[1],r=t?e:e.replace(m.regex.PROTOCOL,"");if(t){if(TC.capabilities[r])return e}else for(var n in TC.capabilities)if(n.replace(m.regex.PROTOCOL,"")==r)return n;for(n in TC.capabilities){var o=l(TC.capabilities[n],a,0)||l(TC.capabilities[n],s,0);if(o&&t&&e==o)return o;if(o&&e.replace(m.regex.PROTOCOL,"")==o.replace(m.regex.PROTOCOL,""))return o}return e},reqGetMapOnCapabilities:function(e){var t,r,n=2!=arguments.length||arguments[1];n||e.replace(m.regex.PROTOCOL,"");return TC.capabilities[e]?(t=TC.capabilities[e],(r=l(t,a,0)||l(t,s,0))?n?r.split("?")[0]:r.split("?")[0].replace(m.regex.PROTOCOL,""):null):null},getFnFromString:function(e){var t=window,r=e.split(".");for(i=0;i<r.length-1;i++)if(null==(t=t[r[i]]))return;return t[r[r.length-1]]},isURL:function(e){return/^(http|https|ftp|mailto)\:\/\//i.test(e)},isSecureURL:function(e){return!/^(f|ht)tps?:\/\//i.test(e)||/^(f|ht)tps:\/\//i.test(e)},isSameOrigin:function(e){var t=0!==e.indexOf("http")&&0!==e.indexOf("//"),r=!t&&e.match(TC.Consts.url.SPLIT_REGEX);if(r){var n=window.location,o=r[1];t=(o==n.protocol||null==o)&&r[3]==n.hostname;var i=r[4],a=n.port;(80!=i&&""!==i||"80"!=a&&""!==a)&&(t=t&&i==a)}return t},formatNumber:function(e,t){var r=typeof e;if("number"===r)return e.toLocaleString(t,{maximumFractionDigits:Math.min(6,d(e))});if("string"===r){n=parseFloat(e);if(n===new Number(e).valueOf())return n.toLocaleString(t,{maximumFractionDigits:Math.min(6,d(n))})}return e},addProtocol:function(e){var t=e;e&&0===e.indexOf("//")&&(t=location.protocol+e);return t},getDiv:function(e){return"string"==typeof e?document.getElementById(e):e instanceof HTMLElement?e:e&&"$"in window&&e instanceof $&&e.length?e[0]:document.createElement("div")},getScriptLocation:function(){var e,t;if(document.currentScript)t=document.currentScript;else{var r=document.getElementsByTagName("script");t=r[r.length-1]}return(e=t.getAttribute("src"))?e.substr(0,e.lastIndexOf("/")+1):""},getBackgroundUrlFromCss:function(e){var r="";if(e)if(void 0!==t[e])r=t[e];else{const o=document.createElement("div");o.style.display="none";o.classList.add(e);document.body.appendChild(o);var n=/^url\(['"]?(.*?)['"]?\)$/gi.exec(window.getComputedStyle(o,null).backgroundImage);n&&n.length>1&&(r=n[n.length-1]);o.parentElement.removeChild(o);t[e]=r}return r},getPointIconUrl:function e(t){var r=null;if(t.url)r=t.url;else{var n;if("string"==typeof t.cssClass)n=t.cssClass;else{var i=t.classes||TC.Cfg.styles.marker.classes;n=i[0];if(t.group){if(void 0===o[t.group]){var a=0;for(var s in o)a++;a%=i.length;o[t.group]=i[a]}n=o[t.group]}}r=m.getBackgroundUrlFromCss(n)}r||t===TC.Cfg.styles.point||""===t.cssClass||(r=e(TC.Cfg.styles.point));return r},getLegendImageFromStyle:function(e,t){let r=null;t=t||{};if(e.url)r=e.url;else{let n=t.width||32,o=t.height||16;const i=e.strokeWidth||0,a=i/2,s=e.fillColor||"transparent",l=e.fillOpacity||1,c=2*(e.radius||0)+i,u=e.lineDash?`stroke-dasharray="${e.lineDash.join(" ")}" `:"";let f;n=Math.max(n,c);o=Math.max(o,c);switch(t.geometryType){case TC.Consts.geom.POINT:f=`<circle cx="${n/2}" cy="${o/2}" r="${e.radius}" stroke="${e.strokeColor}" stroke-width="${i}" fill="${s}" fill-opacity="${l}" ${u}/>`;break;case TC.Consts.geom.POLYLINE:f=`<polyline points="${a},${o-a} ${n-a},${a}" style="stroke:${e.strokeColor};stroke-width:${i}" ${u}/>`;break;case TC.Consts.geom.POLYGON:f=`<polygon points="${a},${o-a} ${a},${a} ${a+.8*n},${a} ${n-a},${o-a}" style="stroke:${e.strokeColor};stroke-width:${i};fill:${s};fill-opacity:${l}" ${u}/>`;break;default:f=`<rect x="${a}" x="${a}" width="${n-i}" height="${o-i}" style="stroke:${e.strokeColor};stroke-width:${i};fill:${s};fill-opacity:${l}" ${u}/>`}r="data:image/svg+xml,"+encodeURIComponent(`<svg xmlns="http://www.w3.org/2000/svg" width="${n}" height="${o}">${f}</svg>`)}return r},addArrayToTree:function e(t,r,n){var o=null,i=!1,a=t[n=n||0];if(a){for(var s,l=0,c=r.children.length;l<c;l++)if((s=r.children[l]).name===a){i=!0;const r=e(t,s,n+1);r&&(o=r);break}if(!i){s={name:a,title:a,uid:"/"+t.slice(0,n+1).join("/"),children:[]};const i=e(t,s,n+1);o=i||s;r.children.push(s)}}return o},parseCoords:function(e){var t=null,r=function(e){var t=e,r={};r.type=TC.Consts.GEOGRAPHIC;var n=t.indexOf("\xb0");r.value=parseFloat(t.substr(0,n));if((n=(t=t.substr(n+1)).indexOf("'"))>=0){var o=parseFloat(t.substr(0,n))/60;r.value>=0?r.value+=o:r.value-=o;if((n=(t=t.substr(n+1)).indexOf("'"))>=0){o=parseFloat(t.substr(0,n).replace(",","."))/3600;r.value>=0?r.value+=o:r.value-=o}}return r},n=function(e){var t=e.trim();if(t.match(/^1?\d{0,2}\s*\u00B0(\s*\d{1,2}\s*'(\s*\d{1,2}([.,]\d+)?\s*'')?)?\s*[NnSsWwOoEe]$/g)){switch(t[t.length-1]){case"S":case"s":case"W":case"w":case"O":case"o":t="-"+t}t=t.substr(0,t.length-1);return r(t)}if(t.match(/^[+-]?1?\d{0,2}\s*\u00B0(\s*\d{1,2}\s*'(\s*\d{1,2}([.,]\d+)?\s*'')?)?$/g))return r(t);if(t.match(/^1?\d{0,2}([.,]\d+)?\s*\u00B0?\s*[NnSsWwOoEe]$/g)){var n={type:TC.Consts.GEOGRAPHIC,value:parseFloat(t.substr(0,t.length-1).replace(",","."))};t.match(/[SsWwOo]$/)&&(n.value=-n.value);return n}return t.match(/^[+-]?1?\d{0,2}([.,]\d+)?\s*\u00B0?$/g)?{type:TC.Consts.GEOGRAPHIC,value:parseFloat(t.replace(",","."))}:t.match(/^[-+]?\d{6,7}([.,]\d+)?$/g)?{type:TC.Consts.UTM,value:parseFloat(t.replace(",","."))}:null},o=(e=e.trim().toUpperCase()).split(",");4===o.length?o=[o.slice(0,1).join("."),o.slice(2,3).join(".")]:1!==o.length&&3!==o.length||(o=e.split(" "));if(2===o.length){var i=n(o[0]),a=n(o[1]);null!==i&&null!==a&&(t=[i,a])}return t},reproject:function(e,t,r){var n,o=!0,i=!0,a=!0;if(Array.isArray(e[0]))if(Array.isArray(e[0][0])){if(!Array.isArray(e[0][0][0])){a=!1;e=[e]}}else{i=!1;e=[[e]]}else{o=!1;i=!1;a=!1;e=[[[e]]]}TC.loadProjDef({crs:t,sync:!0});TC.loadProjDef({crs:r,sync:!0});var s=proj4(proj4.defs[t]),l=proj4(proj4.defs[r]);n=new Array(e.length);e.forEach(function(e,t){const r=n[t]=[];e.forEach(function(e,t){const n=r[t]=[];e.forEach(function(e,t){if(Array.isArray(e)&&e.length>1){var r=proj4(s,l,{x:e[0],y:e[1]});n[t]=[r.x,r.y];e.length>2&&(n[t][2]=e[2])}else n[t]=e})})});o?i?a||(n=n[0]):n=n[0][0]:n=n[0][0][0];return n},getMetersPerDegree:function(e){let t=void 0;const r=6370997;if(Array.isArray(e)&&e.length>=4)if(e[3]===e[1])t=Math.PI*r*Math.cos(this.degToRad(e[1]))/180;else{const n=this.degToRad(e[3]-e[1]),o=Math.sin(n/2),i=o*o;t=r*(2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i)))/(e[3]-e[1])}return t},radToDeg:function(e){return 180*e/Math.PI},degToRad:function(e){return e*Math.PI/180},mod:function(e){return(e%(2*Math.PI)+2*Math.PI)%(2*Math.PI)},getCRSCode:function(e){var t=null;e=e.trim();if(/^EPSG:\d{4,6}$/g.test(e)||/^urn:ogc:def:crs:EPSG:.*:\d{4,6}/g.test(e)||/http:\/\/www.opengis.net\/gml\/srs\/epsg.xml#\d{4,6}$/g.test(e)){var r=e.trim().match(/^.+[:#](\d{4,6})$/);r&&(t=r[1])}return t},CRSCodesEqual:function(e,t){if(e===t)return!0;var r=this.getCRSCode(e),n=this.getCRSCode(t);return null!==r&&null!==n&&r===n},getLocaleString:function(e,t,r){var n=t;if(TC.i18n&&TC.i18n[e]){var o=TC.i18n[e][t];if(o){n=o;if(r)for(var i in r)n=n.replace("{"+i+"}",r[i])}}return n},getRenderedHtml:function(e,t,r){const n=function(e,t){template=TC._hbs.compile(t);TC._hbs.registerPartial(e,template);p.set(e,template);return template},o=function(e){return new Promise(function(t,r){let i=p.get(e);if(i)t(i);else{p.set(e,!0);TC.ajax({url:TC.apiLocation+`TC/templates/${e}.hbs`,method:"GET",responseType:"text"}).then(function(r){const i=r.data.match(/{{> ([a-zA-Z\-]+)(?:(?:\s[a-zA-Z]+)\s*)?}}/);i?Promise.all(i.slice(1).map(e=>o(e.trim()))).then(function(){t(n(e,r.data))}):t(n(e,r.data))}).catch(function(e){console.log("Error fetching template: "+e);r(e)})}})};return new Promise(function(n,i){const a=function(e){const o=e(t);m.isFunction(r)&&r(o);n(o)};m.isFunction(e)?a(e):o(e).then(e=>a(e)).catch(e=>i(e))})},getSimpleMimeType:function(e){var t="";if(e){var r=e.indexOf(";");r>0&&(e=e.substring(0,r));t=e}return t},getQueryStringParams:function(e){var t;if(e){var r=e.indexOf("?");if(r>=0){var n=(t=e.substr(r)).indexOf("#");n>=0&&(t=t.substr(0,n))}else t="?"}else t=location.search;var o=t.replace(/(^\?)/,"").split("&").map(function(e){return this[(e=e.split("="))[0]]=e[1],this}.bind({}))[0];delete o[""];return o},getParamString:function(e){const t=[];for(var r in e)t.push(encodeURIComponent(r)+"="+encodeURIComponent(e[r]));return t.join("&").replace(/%20/g,"+")},fastUnshift:function(e,t){for(var r=e.length;r;){e[r]=e[r-1];r--}e[0]=t},storage:{getCookie:function(e){return TC.cookie(e)},setCookie:function(e,t,r){return TC.cookie(e,t,r)},getLocalValue:function(e){return localStorage&&localStorage instanceof Storage?localStorage.getItem(e):m.storage.getCookie(e)},setLocalValue:function(e,t){if(localStorage&&localStorage instanceof Storage)void 0===t?localStorage.removeItem(e):localStorage.setItem(e,t);else if(void 0===t){var r=new Date;r.setDate(r.getDate()-1);m.storage.setCookie(e,"",{expires:r})}else m.storage.setCookie(e,t);return e},getSessionLocalValue:function(e){return sessionStorage&&sessionStorage instanceof Storage?sessionStorage.getItem(e):m.storage.getCookie(e)},setSessionLocalValue:function(e,t){if(sessionStorage&&sessionStorage instanceof Storage)void 0===t?sessionStorage.removeItem(e):sessionStorage.setItem(e,t);else if(void 0===t){var r=new Date;r.setDate(r.getDate()-1);m.storage.setCookie(e,"",{expires:r})}else m.storage.setCookie(e,t);return e}},detectFirefox:function(){return!!/Firefox[\/\s](\d+\.\d+)/.test(navigator.userAgent)&&new Number(RegExp.$1)},detectIE:function(){var e=window.navigator.userAgent,t=e.indexOf("MSIE ");if(t>0)return parseInt(e.substring(t+5,e.indexOf(".",t)),10);if(e.indexOf("Trident/")>0){var r=e.indexOf("rv:");return parseInt(e.substring(r+3,e.indexOf(".",r)),10)}var n=e.indexOf("Edge/");return n>0&&parseInt(e.substring(n+5,e.indexOf(".",n)),10)},detectChrome:function(){return window.chrome},detectSafari:function(){return!!navigator.userAgent.match(/Version\/[\d\.]+.*Safari/)},detectMouse:function(){const e=matchMedia("(pointer:coarse)").matches,t=matchMedia("(pointer:fine)").matches;if(e&&t)return!0;if(e&&!t){return!!function(){var e,t="(hover: hover)",r=!TC.browserFeatures.touch();(e=window.matchMedia(t)).media===t&&(r=e.matches);return r}()}return!(e||!t)||!matchMedia("(pointer:none)").matches&&(!TC.browserFeatures.touch()||void 0)},detectAndroid:function(){return navigator.userAgent.match(/Android/i)},detectBlackBerry:function(){return navigator.userAgent.match(/BlackBerry/i)},detectIOS:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)},detectMobileWindows:function(){return navigator.userAgent.match(/IEMobile/i)},detectMobile:function(){return m.detectAndroid()||m.detectIOS()||m.detectMobileWindows()||m.detectBlackBerry()},getBrowser:function(){window.UAParser||TC.syncLoadJS(TC.apiLocation+TC.Consts.url.UA_PARSER);var e=(new UAParser).getBrowser();return{name:e.name,version:e.major}},getElementByNodeName:function(e,t){for(var r=t.indexOf(":"),n=t.substr(r+1),o=e.getElementsByTagNameNS("*",n),i=0;i<o.length;i++)if(o[i].nodeName==t)return o},addURLParameters:function(e,t){if(!t)return e;var r=Object.keys(t).map(function(e){return encodeURIComponent(e)+"="+(t[e]?encodeURIComponent(t[e]):"")}).join("&"),n=e.split("?");if(n.length>=2){var o=n[1].split(/[&;]/g);o.push(r);return e=n[0]+"?"+o.join("&")}if((n=e.split("#")).length>=2){n.shift();return e=n[0]+"?"+r+"#"+n.join("#")}return e=e+"?"+r},removeURLParameter:function(e,t){var r=e.split("?");if(r.length>=2){for(var n=encodeURIComponent(t.toLowerCase())+"=",o=r[1].toLowerCase().split(/[&;]/g),i=o.length;i-- >0;)-1!==o[i].lastIndexOf(n,0)&&o.splice(i,1);return e=r[0]+"?"+o.join("&")}return e},showModal:function(e,t){t=t||{};e.hidden=!1;window.jQuery&&e instanceof jQuery&&(e=e.get(0));e.classList.add(TC.Consts.classes.VISIBLE);const r=e.querySelectorAll(".tc-modal-close");if(r&&r.length>0)for(var n=0;n<r.length;n++){var o=u.get(r[n]);if(o)u.delete(r[n]);else{o=function(e){e.stopPropagation();return TC.Util.closeModal(t.closeCallback,e.target)};u.set(r[n],o)}u.set(r[n],o);r[n].addEventListener("click",o)}m.isFunction(t.openCallback)&&t.openCallback()},closeModal:function(e,t){const r=function(e){e.classList.remove(TC.Consts.classes.VISIBLE)};var n;if(t){n=t;for(;n&&!n.matches(".tc-modal");)n=n.parentElement;r(n)}else Array.prototype.forEach.call(document.querySelectorAll(".tc-modal"),function(e){r(e)});e&&e()},closeAlert:function(e){var t=e;do{(t=t.parentElement).matches(".tc-alert")&&(t.style.display="none")}while(t)},swipe:function(e,t){const r=function(t){e.addEventListener("mousedown",t.start);e.addEventListener("touchstart",t.start,{passive:!0});e.addEventListener("mouseup",t.end);e.addEventListener("touchend",t.end,{passive:!0})};if("disable"===t){const t=c.get(e);if(t){e.removeEventListener("mousedown",t.start);e.removeEventListener("touchstart",t.start);e.removeEventListener("mouseup",t.end);e.removeEventListener("touchend",t.end)}return}if("enable"===t){const t=c.get(e);t&&r(t);return}const n=(t=t||{}).minDistance||30,o=t.maxCrossDistance||30,i=t.maxAllowedTime||1e3;var a={x:-1,y:-1},s={x:-1,y:-1},l=0;const u={start:function(r){if(function(r){if(t.noSwipe)for(var n=r.target;n&&n!==e;){if(n.matches&&n.matches(t.noSwipe))return!1;n=n.parentNode}return!0}(r)){r="changedTouches"in r?r.changedTouches[0]:r;a.x=r.pageX;a.y=r.pageY;l=(new Date).getTime()}},end:function(r){if(l){r="changedTouches"in r?r.changedTouches[0]:r;s.x=r.pageX;s.y=r.pageY;if((new Date).getTime()-l<=i){const r=t[function(e,t){const r=t.x-e.x,i=t.y-e.y,a=Math.abs(r),s=Math.abs(i);return a>s&&a>n&&s<=o?r<0?"left":"right":s>a&&s>n&&a<=o?i<0?"up":"down":"none"}(a,s)];r&&r.call(e)}l=0}}};c.set(e,u);r(u)},getParameterByName:function(e){const t=new URLSearchParams(location.search),r=Array.from(t).find(([t,r])=>t.toLowerCase()==e.toLowerCase());return r?r[1]:""},getLocaleUserChoice:function(e){var t="en-US",r=(e=e||{}).cookieName||"SITNA.language",n=e.paramName||"lang",o=navigator.languages&&navigator.languages.length?navigator.languages[0]:navigator.language||navigator.userLanguage,i=TC.Util.getParameterByName(n)||TC.Util.storage.getCookie(r)||o,a=i.indexOf("-");a>=0&&(i=i.substr(0,a));var s=new Date((new Date).getTime()+31536e6);TC.Util.storage.setCookie(r,i,{expires:s});switch(i){case"eu":t="eu-ES";break;case"es":t="es-ES";break;default:t="en-US"}return t},getValidFilename:function(e){return(e||"").replace(/[\/\\?%*:|"<>]/g,"-")},downloadBlob:function(e,t){var r=document.createElement("a");if(void 0!==r.download){var n=URL.createObjectURL(t);r.setAttribute("href",n);r.setAttribute("download",TC.Util.getValidFilename(e));r.style.visibility="hidden";document.body.appendChild(r);r.click();document.body.removeChild(r)}},downloadFile:function(e,t,r){var n=new Blob([r],{type:t});e=TC.Util.getValidFilename(e);navigator.msSaveBlob?navigator.msSaveBlob(n,e):TC.Util.downloadBlob(e,n)},downloadDataURI:function(e,t,r){for(var n=atob(r.split(",")[1]),o=[],i=0;i<n.length;i++)o.push(n.charCodeAt(i));var a=new Blob([new Uint8Array(o)],{type:t});e=TC.Util.getValidFilename(e);navigator.msSaveBlob?navigator.msSaveBlob(a,e):TC.Util.downloadBlob(e,a)},shortenUrl:function(e){return new Promise(function(t,r){TC.ajax({url:"https://api-ssl.bitly.com/v3/shorten",data:{access_token:"6c466047309f44bd8173d83e81491648b243ee3d",longUrl:e}}).then(function(e){t(e.data)}).catch(function(e){r(e)})})},utf8ToBase64:function(e){return window.btoa(unescape(encodeURIComponent(e)))},base64ToUtf8:function(e){var t;try{t=decodeURIComponent(escape(window.atob(e)))}catch(e){t=null}return t},colorArrayToString:function(e){Array.isArray(e)&&(e=e.slice(0,3).reduce(function(e,t){const r=t.toString(16);return e+"00".substring(0,2-r.length)+r},"#"));return e},operation:function(e,t,r,n){for(var o=[],i=0;i<e.length;i++){for(var a=e[i],s=!1,l=0;l<t.length;l++)if(r(a,t[l])){s=!0;break}s===n&&o.push(a)}return o},isSecureURL:function(e){return!/^(f|ht)tps?:\/\//i.test(e)||/^(f|ht)tps:\/\//i.test(e)},inBoth:function(e,t,r){return this.operation(e,t,r,!0)},inFirstOnly:function(e,t,r){return this.operation(e,t,r,!1)},inSecondOnly:function(e,t,r){return this.inFirstOnly(t,e,r)},toDataUrl:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{type:"image/png",encoderOptions:.92},n=r.type,o=r.encoderOptions,i=e.getContext("2d");if(!i)return"";var a=e.width,s=e.height,l=i.getImageData(0,0,a,s),c=i.globalCompositeOperation;if(t){i.globalCompositeOperation="destination-over";i.fillStyle=t;i.fillRect(0,0,a,s)}var u=e.toDataURL(n,o);if(t){i.clearRect(0,0,a,s);i.putImageData(l,0,0);i.globalCompositeOperation=c}return u},imgToDataUrl:function(e,t){var r=function(e){var t=document.createElement("CANVAS"),r=t.getContext("2d");t.height=e.height;t.width=e.width;r.drawImage(e,0,0);return t};return new Promise(function(n,o){if(!t)switch(e.substr(e.lastIndexOf(".")+1).toLowerCase()){case"svg":case"png":case"gif":break;default:t="image/jpeg"}var i=new Image;i.crossOrigin="anonymous";i.onload=function(){var o,a=r(i);try{o=TC.Util.toDataUrl(a,"#ffffff",{type:t,encoderOptions:1});n({dataUrl:o,canvas:a})}catch(t){i.src=TC.proxify(e)}};i.onerror=function(a){var s=new XMLHttpRequest;s.open("GET",TC.proxify(e),!0);s.setRequestHeader("Content-Type","application/x-www-form-urlencoded");s.responseType="arraybuffer";s.onload=function(e){if(200===this.status){for(var o=new Uint8Array(this.response),a=o.length,l=new Array(a);a--;)l[a]=String.fromCharCode(o[a]);var c=l.join(""),u=s.getResponseHeader("content-type");if(0===u.indexOf("image")){i.src="data:"+u+";base64,"+window.btoa(c);i.onload=function(){var e=r(i);dataURL=TC.Util.toDataUrl(e,"#ffffff",{type:t||"image/jpeg",encoderOptions:1});n({dataUrl:dataURL,canvas:e})}}}};s.onreadystatechange=function(){4===s.readyState&&200!==s.status&&o(Error("HTTP error "+s.status))};s.send()};i.src=e;if(i.complete||void 0===i.complete){i.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==";i.src=e}})},imgTagToDataUrl:function(e,t){var r=function(e){var t=document.createElement("CANVAS"),r=t.getContext("2d");t.height=e.height;t.width=e.width;r.drawImage(e,0,0);return t}(e);try{return{base64:TC.Util.toDataUrl(r,"#ffffff",{type:t||"image/jpeg",encoderOptions:1}),canvas:r}}catch(e){return null}},addToCanvas:function(e,t,r,n){var o=TC.Util.cloneCanvas(e),i=o.getContext("2d");return new Promise(function(e,a){var s=new Image;t.crossOrigin="anonymous";s.src=t;s.onload=function(){n?i.drawImage(s,r.x||0,r.y||0,n.width,n.height):i.drawImage(s,r.x||0,r.y||0);e(o)}})},cloneCanvas:function(e){var t=document.createElement("canvas"),r=t.getContext("2d");t.width=e.width;t.height=e.height;r.drawImage(e,0,0);return t},mergeCanvases:function(e){const t=e.map(e=>e.getBoundingClientRect()),r=t.reduce(function(e,t){return[Math.min(e[0],t.left),Math.min(e[1],t.top),Math.max(e[2],t.right),Math.max(e[3],t.bottom)]},[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY]),n=r[0],o=r[1],i=document.createElement("canvas"),a=i.getContext("2d");i.width=r[2]-n;i.height=r[3]-o;e.forEach(function(e,r){const i=t[r];a.drawImage(e,i.left-n,i.top-o)});return i},calculateAspectRatioFit:function(e,t,r,n){var o=Math.min(r/e,n/t);return{width:e*o,height:t*o}},getFormattedDate:function(e,t){function r(e){return e<10?"0"+e:e}var n=new Date(e);return[n.getFullYear(),r(n.getMonth()+1),r(n.getDate())].concat(t?["_",r(n.getHours()),r(n.getMinutes()),r(n.getSeconds())]:[]).join("")},replaceSpecialCharacters:function(e){var t={"\xe4":"a","\xf6":"o","\xfc":"u","\xc4":"A","\xd6":"O","\xdc":"U","\xe1":"a","\xe9":"e",i:"i","\xf3":"o","\xfa":"u","\xc1":"A","\xc9":"E","\xcd":"I","\xd3":"O","\xda":"U","\xf1":"n","\xd1":"N"};return e.replace(/[\xf6\xe4\xfc\xd6\xc4\xdc\xe1\xe9\xed\xf3\xfa\xc1\xc9\xcd\xd3\xda\xf1\xd1]/g,function(e){return t[e]})},downloadFileForm:async function(e,t){var r,n=async function(e,t){var r=await new Promise(function(r,n){const o=new XMLHttpRequest;o.responseType="blob";o.open("POST",e);o.setRequestHeader("Content-Type","application/xml; charset=UTF-8");o.onreadystatechange=function(t){if(4===o.readyState)if(200!==o.status)n({status:o.status,msg:o.statusText,url:e});else try{const e=o.getResponseHeader("Content-disposition");var i="";if(e){i=e.split("; ")[1].substring(9);"attachment"!==e.split("; ")[0]&&(i=i.substring(0,i.lastIndexOf(".")))}r({data:o.response,contentType:o.getResponseHeader("Content-type"),filename:i})}catch(e){n(e)}};try{o.send(t)}catch(e){n(e)}}),n="";if(r.data.type.indexOf("kml")>=0)n=".kml";else if(r.data.type.indexOf("json")>=0)n=".geojson";else if(r.data.type.indexOf("xml")>=0){n=".gml";if(/outputFormat="\S{1,}"/.exec(t)[0].includes(".kml")||/outputFormat="\S{1,}"/.exec(t)[0].includes("shape-zip"))throw{key:TC.Consts.DownloadError.MIMETYPE_NOT_SUPORTED,url:e,data:t,format:/outputFormat="\S{1,}"/.exec(t)[0]}}TC.Util.downloadFile((r.filename?r.filename:TC.getUID())+n,r.contentType,r.data)};if(Array.isArray(e)){for(var o=e,i=0;i<o.length;i++)try{await n(o[i].url,o[i].data)}catch(e){r=e}if(r)throw r}else await n(e,t)},WFSQueryBuilder:function(e,t,r,n,o,i,a,s){const l=function(){return i?' srsName="'+i+'"':""},c=function(){if(!s)return"";var e="";switch(r.version){case"1.0.0":e="ogc:PropertyName";break;case"1.1.0":e="wfs:PropertyName";break;case"2.0.0":e="wfs:PropertyName"}return(s instanceof Array?s:[s]).reduce(function(t,r){return t+"<"+e+">"+r+"</"+e+">"},"")};Array.isArray(e)||e instanceof Object||(e=[e]);var u="<wfs:GetFeature "+h(r).format({resultType:o?'resultType="hits"':"",format:'outputFormat="'+n+'"'})+("2.0.0"!==r.version&&a?' maxFeatures="'+a+'"':"")+">",f="";if(Array.isArray(e)){var g="<wfs:Query typeName"+("2.0.0"===r.version?"s":"")+'="{typeName}"'+l()+">{fields}{filter}</wfs:Query>";e.forEach(function(e){f+=g.format({typeName:e,filter:t&&t instanceof TC.filter.Filter?t.getText(r.version):"",fields:c()})})}else{g="";for(var p in e){g="<wfs:Query typeName"+("2.0.0"===r.version?"s":"")+'="{typeName}"'+l()+">{fields}{filter}</wfs:Query>";let t=e[p];f+=g.format({typeName:p,filter:t&&t instanceof TC.filter.Filter?t.getText(r.version):"",fields:c()})}}return u+=f+"</wfs:GetFeature>"},WFGetPropertyValue:function(e,t,r,n){return TC.Util.WFSQueryBuilder([e],r,n,"JSON",!1,null,null,t)},WFSFilterBuilder:function(e,t,r){var n="";if(m.isPlainObject(e))n='<{prefix}:Filter><{prefix}:Intersects><fes:ValueReference></fes:ValueReference><{prefix}:Function name="querySingle"><{prefix}:Literal>{clipLayer}</{prefix}:Literal><{prefix}:Literal>{geometryName}</{prefix}:Literal><{prefix}:Literal>{where}</{prefix}:Literal></{prefix}:Function></{prefix}:Intersects></{prefix}:Filter>'.format({prefix:"2.0.0"===t?"fes":"ogc",clipLayer:e.clipLayer,geometryName:e.geometryName,where:e.where});else switch(!0){case!e:break;case Array.isArray(e):var o="<gml:Envelope><gml:lowerCorner>{lowerCorner}</gml:lowerCorner><gml:upperCorner>{upperCorner}</gml:upperCorner></gml:Envelope>".format({lowerCorner:e[0]+" "+e[1],upperCorner:e[2]+" "+e[3]});switch(!0){case"1.0.0"===t:case"1.1.0"===t:n+="<ogc:Filter><ogc:BBOX>"+o+"</ogc:BBOX></ogc:Filter>";break;case"2.0.0"===t:n+="<fes:Filter><fes:BBOX>"+o+"</fes:BBOX></fes:Filter>"}break;case e instanceof TC.Feature:switch(!0){case"1.0.0"===t:case"1.1.0"===t:n+="<ogc:Filter><ogc:Intersects><ogc:PropertyName></ogc:PropertyName>"+TC.Util.writeGMLGeometry(e,{version:"2.0",srsName:r})+"</ogc:Intersects></ogc:Filter>";break;case"2.0.0"===t:n+="<fes:Filter><fes:Intersects><fes:ValueReference></fes:ValueReference>"+TC.Util.writeGMLGeometry(e,{version:"3.2",srsName:r})+"</fes:Intersects></fes:Filter>"}break;default:TC.error("Geometr\xeda no v\xe1lida")}return n},writeGMLGeometry:function(e,t){const r=(t=t||{}).version,n=function(){return t.srsName?' srsName="'+t.srsName+'"':""};var o=function(e){var t;if(0===r.indexOf("3")){t=e.toString();for(;t.indexOf(",")>=0;)t=t.replace(","," ")}else t=e.map(function(e){return e.join(",")}).join(" ");return t};switch(r){case"3.1.1":break;case"3.2":switch(!0){case TC.feature.Polyline&&e instanceof TC.feature.Polyline:return'<gml:LineString srsDimension="2"'+n()+"><gml:posList>"+o(e.geometry)+"</gml:posList></gml:LineString>";default:return'<gml:Polygon srsDimension="2"'+n()+"><gml:exterior><gml:LinearRing><gml:posList>"+o(e.geometry[0])+"</gml:posList></gml:LinearRing></gml:exterior></gml:Polygon>"}break;case"2.0":default:switch(!0){case TC.feature.Polyline&&e instanceof TC.feature.Polyline:return"<gml:LineString"+n()+"><gml:coordinates>"+o(e.geometry[0])+"</gml:coordinates></gml:LineString>";default:return"<gml:Polygon"+n()+"><gml:outerBoundaryIs><gml:LinearRing><gml:coordinates>"+o(e.geometry[0])+"</gml:coordinates></gml:LinearRing></gml:outerBoundaryIs></gml:Polygon>"}}},isServiceWorker:function(){return!!navigator.serviceWorker&&!(!navigator.serviceWorker.controller||"activated"!==navigator.serviceWorker.controller.state)},isSameOriginByLocation:function(e,t){var r=0!==e.indexOf("http")&&0!==e.indexOf("//"),n=!r&&e.match(TC.Consts.url.SPLIT_REGEX);if(n){var o=n[1];r=(o==t.protocol||null==o)&&n[3]==t.hostname;var i=n[4],a=t.port;(80!=i&&""!==i||"80"!=a&&""!==a)&&(r=r&&i==a)}return r},isSameProtocol:function(e,t){if(e.match(/^(\/\/)/i))return!0;var r=/^(https?:\/\/)/i,n=e.match(r);if(n&&n.length>1){var o=t.match(r);if(o&&o.length>1)return n[0].trim()===o[0].trim()}return!1},consoleRegister:function(e){TC.isDebug&&console.log(e)},getSorterByProperty:function(e){return function(t,r){return t[e]>r[e]?1:t[e]<r[e]?-1:0}},getSoundexDifference:function(e,t){for(var r=0,n=0;n<e.length;n++)e.charAt(n)==t.charAt(n)&&r++;return r},toAbsolutePath:function(e){var t=document.createElement("a");t.href=e;return t.href},explodeGeometry:function(e){const t=e.origin,r=function(e,n,o){if(Array.isArray(e))e.forEach(r);else{0===n&&(o[0]=e+t[0]);1===n&&(o[1]=e+t[1])}};e.geom.forEach(r);return e.geom},cloneMappingFunction:function(e){return Array.isArray(e)?e.map(TC.Util.cloneMappingFunction):e},isGeometry:function(e){switch(e){case"gml:LinearRingPropertyType":case"gml:PolygonPropertyType":case"gml:MultiPolygonPropertyType":case"gml:MultiSurfacePropertyType":case"gml:LineStringPropertyType":case"gml:MultiLineStringPropertyType":case"gml:PointPropertyType":case"gml:MultiPointPropertyType":case"gml:BoxPropertyType":case"gml:GeometryCollectionPropertyType":case"gml:GeometryAssociationType":case"gml:GeometryPropertyType":case"gml:MultiCurvePropertyType":case"gml:CurvePropertyType":return!0;default:return!1}},compactGeometry:function(e,t){const r=[Number.MAX_VALUE,Number.MAX_VALUE],n=e.map(TC.Util.cloneMappingFunction),o=function(e,t){Array.isArray(e)?e.forEach(o):0===t&&e<r[0]?r[0]=e:1===t&&e<r[1]&&(r[1]=e)};n.forEach(o);const i=function(e){return Math.round(e*t)/t};r[0]=i(r[0]);r[1]=i(r[1]);const a=function(e,t,n){if(Array.isArray(e))e.forEach(a);else{0===t&&(n[0]=i(e-r[0]));1===t&&(n[1]=i(e-r[1]))}};n.forEach(a);return{origin:r,geom:n}},hasStyleOptions:function(e){return e.hasOwnProperty("strokeColor")||e.hasOwnProperty("strokeWidth")||e.hasOwnProperty("fillColor")||e.hasOwnProperty("strokeOpacity")||e.hasOwnProperty("fillOpacity")||e.hasOwnProperty("url")||e.hasOwnProperty("radius")||e.hasOwnProperty("anchor")||e.hasOwnProperty("width")||e.hasOwnProperty("height")||e.hasOwnProperty("labelOutlineWidth")||e.hasOwnProperty("labelOutlineColor")||e.hasOwnProperty("labelOffset")||e.hasOwnProperty("fontColor")||e.hasOwnProperty("fontSize")},formatCoord:function(e,t){return e.toLocaleString(TC.Util.getLocaleUserChoice(),{maximumFractionDigits:t})},getWebWorkerCrossOriginURL:function(e){return new Promise(function(t,r){window.hasOwnProperty("Worker")?TC.Util.isSameOrigin(e)?t(e):TC.ajax({url:e,method:"GET",responseType:"text"}).then(function(e){const r=e.data;var n=new Blob([r],{type:"text/javascript"}),o=window.URL.createObjectURL(n);t(o)},function(e){r(Error(e))}):r(new Error("No support for service workers"))})}};String.prototype.format=function(){var e=this.toString();if(!arguments.length)return e;var t="string"==(t=typeof arguments[0])||"number"==t?arguments:arguments[0];for(arg in t)e=e.replace(RegExp("\\{"+arg+"\\}","gi"),t[arg]);return e};const h=function(e){var t='xsi:schemaLocation="http://www.opengis.net/wfs http://schemas.opengis.net/wfs/1.1.0/wfs.xsd"  service="WFS" {resultType} {format} ';switch(e.version){case"1.0.0":case"1.1.0":t+='xmlns:gml="http://www.opengis.net/gml" xmlns:wfs="http://www.opengis.net/wfs" ';break;case"2.0.0":t+='xmlns:wfs="http://www.opengis.net/wfs/2.0" xmlns:gml="http://www.opengis.net/gml/3.2" '}for(var r in e)"string"==typeof e[r]&&r.indexOf("gml")<0&&e[r].indexOf("wfs")<0&&(t+=r+'="'+e[r]+'" ');return t};var y=function(e,t,r){return r(e.getBoundingClientRect(),t.getBoundingClientRect())};if(this.HTMLElement){HTMLElement.prototype.colliding=function(e){return y(this,e,function(e,t){return!(e.top>t.bottom||e.right<t.left||e.bottom<t.top||e.left>t.right)})};HTMLElement.prototype.containing=function(e){y(this,e,function(e,t){return!(e.left<=t.left&&t.left<e.width&&e.top<=t.top&&t.top<e.height)})};HTMLElement.prototype.inside=function(e){return y(this,e,function(e,t){return t.top<=e.top&&e.top<=t.bottom&&t.top<=e.bottom&&e.bottom<=t.bottom&&t.left<=e.left&&e.left<=t.right&&t.left<=e.right&&e.right<=t.right})}}return m});
//# sourceMappingURL=maps/Util.min.js.map