var TC=TC||{};!function(e,t){"object"==typeof exports?module.exports=t():"function"==typeof define&&define.amd?define([],t):e.Util=t()}(TC,function(){String.prototype.soundex=function(){var e=this.toLowerCase().split("");f=e.shift(),r="",codes={a:"",e:"",i:"",o:"",u:"",b:1,f:1,p:1,v:1,c:2,g:2,j:2,k:2,q:2,s:2,x:2,z:2,d:3,t:3,l:4,m:5,n:5,r:6};r=f+e.map(function(e,t,r){return codes[e]}).filter(function(e,t,r){return 0===t?e!==codes[f]:e!==r[t-1]}).join("");return(r+"000").slice(0,4).toUpperCase()};Number.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e};var e=Number.prototype.toLocaleString;Number.prototype.toLocaleString=function(t,r){if("eu-ES"!=t||TC.Util.detectIE())return e.apply(this,arguments);var n=e.apply(this,arguments);n=n.replace(/\,/g,".");Math.floor(this)==this&&Number.isInteger(Math.floor(this))||(n=n.replace(/.([^.]*)$/,",$1"));return n};var t={},o={},a=["Capability","Request","GetMap","DCPType","0","HTTP","Get","OnlineResource"],s=["OperationsMetadata","GetTile","DCP","HTTP","Get","0","href"],l=function(e,t,r){return r<t.length-1?e.hasOwnProperty(t[r])?l(e[t[r]],t,++r):null:e[t[r]]},c={getMapLocale:function(e){return e.options&&e.options.locale&&e.options.locale.replace("_","-")||"es-ES"},regex:{PROTOCOL:/(^https?:)/i},isOnCapabilities:function(e){var t=2!=arguments.length||arguments[1],r=t?e:e.replace(TC.Util.regex.PROTOCOL,"");if(t){if(TC.capabilities[r])return e}else for(var n in TC.capabilities)if(n.replace(TC.Util.regex.PROTOCOL,"")==r)return n;for(n in TC.capabilities){var o=l(TC.capabilities[n],a,0)||l(TC.capabilities[n],s,0);if(o&&t&&e==o)return o;if(o&&e.replace(TC.Util.regex.PROTOCOL,"")==o.replace(TC.Util.regex.PROTOCOL,""))return o}return e},reqGetMapOnCapabilities:function(e){var t,r,n=2!=arguments.length||arguments[1];n||e.replace(TC.Util.regex.PROTOCOL,"");return TC.capabilities[e]?(t=TC.capabilities[e],(r=l(t,a,0)||l(t,s,0))?n?r.split("?")[0]:r.split("?")[0].replace(TC.Util.regex.PROTOCOL,""):null):null},getFNFromString:function(e){var t=window,r=e.split(".");for(i=0;i<r.length-1;i++)if(void 0==(t=t[r[i]]))return;return t[r[r.length-1]]},isURL:function(e){return/^(http|https|ftp|mailto)\:\/\//i.test(e)},isSecureURL:function(e){return!/^(f|ht)tps?:\/\//i.test(e)||/^(f|ht)tps:\/\//i.test(e)},isSameOrigin:function(e){var t=0!==e.indexOf("http")&&0!==e.indexOf("//"),r=!t&&e.match(TC.Consts.url.SPLIT_REGEX);if(r){var n=window.location,o=r[1];t=(o==n.protocol||void 0==o)&&r[3]==n.hostname;var i=r[4],a=n.port;(80!=i&&""!==i||"80"!=a&&""!==a)&&(t=t&&i==a)}return t},formatNumber:function(e,t){var r=typeof e;if("number"===r)return e.toLocaleString(t);if("string"===r){n=parseFloat(e);if(n===new Number(e).valueOf())return n.toLocaleString(t)}return e},addProtocol:function(e){var t=e;e&&0===e.indexOf("//")&&(t=location.protocol+e);return t},getDiv:function(e){return"string"==typeof e?document.getElementById(e):1==$(e).length?e:document.createElement("div")},getScriptLocation:function(){var e,t;if(document.currentScript)t=document.currentScript;else{var r=document.getElementsByTagName("script");t=r[r.length-1]}return(e=t.getAttribute("src"))?e.substr(0,e.lastIndexOf("/")+1):""},getBackgroundUrlFromCss:function(e){var r="";if(e)if(void 0!==t[e])r=t[e];else{var n=$('<div style="display:none">').addClass(e).appendTo("body"),o=/^url\(['"]?(.*?)['"]?\)$/gi.exec(n.css("background-image"));o&&o.length>1&&(r=o[o.length-1]);n.remove();t[e]=r}return r},getPointIconUrl:function e(t){var r=null;if(t.url)r=t.url;else{var n;if("string"==typeof t.cssClass)n=t.cssClass;else{var i=t.classes||TC.Cfg.styles.marker.classes;n=i[0];if(t.group){if(void 0===o[t.group]){var a=0;for(var s in o)a++;a%=i.length;o[t.group]=i[a]}n=o[t.group]}}r=TC.Util.getBackgroundUrlFromCss(n)}r||t===TC.Cfg.styles.point||""===t.cssClass||(r=e(TC.Cfg.styles.point));return r},addArrayToTree:function e(t,r,n){var o=null,i=!1,a=t[n=n||0];if(a){for(var s,l=0,c=r.children.length;l<c;l++)if((s=r.children[l]).name===a){i=!0;var u=e(t,s,n+1);u&&(o=u);break}if(!i){s={name:a,title:a,uid:"/"+t.slice(0,n+1).join("/"),children:[]};r.children.push(s);o=s}}return o},parseCoords:function(e){var t=null,r=function(e){var t=e,r={};r.type=TC.Consts.GEOGRAPHIC;var n=t.indexOf("\xb0");r.value=parseFloat(t.substr(0,n));if((n=(t=t.substr(n+1)).indexOf("'"))>=0){var o=parseFloat(t.substr(0,n))/60;r.value>=0?r.value+=o:r.value-=o;if((n=(t=t.substr(n+1)).indexOf("'"))>=0){o=parseFloat(t.substr(0,n).replace(",","."))/3600;r.value>=0?r.value+=o:r.value-=o}}return r},n=function(e){var t=$.trim(e);if(t.match(/^1?\d{0,2}\s*\u00B0(\s*\d{1,2}\s*'(\s*\d{1,2}([.,]\d+)?\s*'')?)?\s*[NnSsWwOoEe]$/g)){switch(t[t.length-1]){case"S":case"s":case"W":case"w":case"O":case"o":t="-"+t}t=t.substr(0,t.length-1);return r(t)}if(t.match(/^[+-]?1?\d{0,2}\s*\u00B0(\s*\d{1,2}\s*'(\s*\d{1,2}([.,]\d+)?\s*'')?)?$/g))return r(t);if(t.match(/^1?\d{0,2}([.,]\d+)?\s*\u00B0?\s*[NnSsWwOoEe]$/g)){var n={type:TC.Consts.GEOGRAPHIC,value:parseFloat(t.substr(0,t.length-1).replace(",","."))};t.match(/[SsWwOo]$/)&&(n.value=-n.value);return n}return t.match(/^[+-]?1?\d{0,2}([.,]\d+)?\s*\u00B0?$/g)?{type:TC.Consts.GEOGRAPHIC,value:parseFloat(t.replace(",","."))}:t.match(/^\d{6,7}([.,]\d+)?$/g)?{type:TC.Consts.UTM,value:parseFloat(t.replace(",","."))}:null},o=(e=$.trim(e).toUpperCase()).split(",");4===o.length?o=[o.slice(0,1).join("."),o.slice(2,3).join(".")]:1!==o.length&&3!==o.length||(o=e.split(" "));if(2===o.length){var i=n(o[0]),a=n(o[1]);null!==i&&null!==a&&(t=[i,a])}return t},reproject:function(e,t,r){var n,o=!0,i=!0,a=!0;if($.isArray(e[0]))if($.isArray(e[0][0])){if(!$.isArray(e[0][0][0])){a=!1;e=[e]}}else{i=!1;e=[[e]]}else{o=!1;i=!1;a=!1;e=[[[e]]]}TC.loadProjDef({crs:t,sync:!0});TC.loadProjDef({crs:r,sync:!0});var s=new Proj4js.Proj(t),l=new Proj4js.Proj(r);n=new Array(e.length);e.forEach(function(e,t){const r=n[t]=[];e.forEach(function(e,t){const n=r[t]=[];e.forEach(function(e,t){var r=Proj4js.transform(s,l,{x:e[0],y:e[1]});n[t]=[r.x,r.y];e.length>2&&(n[t][2]=e[2])})})});o?i?a||(n=n[0]):n=n[0][0]:n=n[0][0][0];return n},getMetersPerDegree:function(e){var t=void 0;if($.isArray(e)&&e.length>=4){var r=this.degToRad(e[3]-e[1]),n=Math.sin(r/2),o=n*n;t=6370997*(2*Math.atan2(Math.sqrt(o),Math.sqrt(1-o)))/(e[3]-e[1])}return t},radToDeg:function(e){return 180*e/Math.PI},degToRad:function(e){return e*Math.PI/180},mod:function(e){return(e%(2*Math.PI)+2*Math.PI)%(2*Math.PI)},getCRSCode:function(e){var t=null;e=e.trim();if(/^EPSG:\d{4,6}$/g.test(e)||/^urn:ogc:def:crs:EPSG:.*:\d{4,6}/g.test(e)||/http:\/\/www.opengis.net\/gml\/srs\/epsg.xml#\d{4,6}$/g.test(e)){var r=e.trim().match(/^.+[:#](\d{4,6})$/);r&&(t=r[1])}return t},CRSCodesEqual:function(e,t){if(e===t)return!0;var r=this.getCRSCode(e),n=this.getCRSCode(t);return null!==r&&null!==n&&r===n},getLocaleString:function(e,t,r){var n=t;if(TC.i18n&&TC.i18n[e]){var o=TC.i18n[e][t];if(o){n=o;if(r)for(var i in r)n=n.replace("{"+i+"}",r[i])}}return n},getSimpleMimeType:function(e){var t="";if(e){var r=e.indexOf(";");r>0&&(e=e.substring(0,r));t=e}return t},getQueryStringParams:function(e){var t;if(e){var r=e.indexOf("?");if(r>=0){var n=(t=e.substr(r)).indexOf("#");n>=0&&(t=t.substr(0,n))}else t="?"}else t=location.search;var o=$.map(t.replace(/(^\?)/,"").split("&"),function(e){return this[(e=e.split("="))[0]]=e[1],this}.bind({}))[0];delete o[""];return o},fastUnshift:function(e,t){for(var r=e.length;r;){e[r]=e[r-1];r--}e[0]=t},storage:{getCookie:function(e){return $.cookie(e)},setCookie:function(e,t,r){return $.cookie(e,t,r)},getLocalValue:function(e){return localStorage&&localStorage instanceof Storage?localStorage.getItem(e):TC.Util.storage.getCookie(e)},setLocalValue:function(e,t){if(localStorage&&localStorage instanceof Storage)void 0===t?localStorage.removeItem(e):localStorage.setItem(e,t);else if(void 0===t){var r=new Date;r.setDate(r.getDate()-1);TC.Util.storage.setCookie(e,"",{expires:r})}else TC.Util.storage.setCookie(e,t);return e},getSessionLocalValue:function(e){return sessionStorage&&sessionStorage instanceof Storage?sessionStorage.getItem(e):TC.Util.storage.getCookie(e)},setSessionLocalValue:function(e,t){if(sessionStorage&&sessionStorage instanceof Storage)void 0===t?sessionStorage.removeItem(e):sessionStorage.setItem(e,t);else if(void 0===t){var r=new Date;r.setDate(r.getDate()-1);TC.Util.storage.setCookie(e,"",{expires:r})}else TC.Util.storage.setCookie(e,t);return e}},detectFirefox:function(){return!!/Firefox[\/\s](\d+\.\d+)/.test(navigator.userAgent)&&new Number(RegExp.$1)},detectIE:function(){var e=window.navigator.userAgent,t=e.indexOf("MSIE ");if(t>0)return parseInt(e.substring(t+5,e.indexOf(".",t)),10);if(e.indexOf("Trident/")>0){var r=e.indexOf("rv:");return parseInt(e.substring(r+3,e.indexOf(".",r)),10)}var n=e.indexOf("Edge/");return n>0&&parseInt(e.substring(n+5,e.indexOf(".",n)),10)},detectChrome:function(){return window.chrome},detectSafari:function(){return!!navigator.userAgent.match(/Version\/[\d\.]+.*Safari/)},detectMouse:function(){if(Modernizr.mq("(pointer:coarse)")&&Modernizr.mq("(pointer:fine)"))return!0;if(Modernizr.mq("(pointer:coarse)")&&!Modernizr.mq("(pointer:fine)")){return!!function(){var e,t="(hover: hover)",r=!Modernizr.touch;"matchMedia"in window?(e=window.matchMedia(t)).media===t&&(r=e.matches):console.log("no dispone de matchMedia");return r}()}return!(Modernizr.mq("(pointer:coarse)")||!Modernizr.mq("(pointer:fine)"))||!Modernizr.mq("(pointer:none)")&&(!Modernizr.touch||void 0)},detectAndroid:function(){return navigator.userAgent.match(/Android/i)},detectBlackBerry:function(){return navigator.userAgent.match(/BlackBerry/i)},detectIOS:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)},detectMobileWindows:function(){return navigator.userAgent.match(/IEMobile/i)},detectMobile:function(){return TC.Util.detectAndroid()||TC.Util.detectIOS()||TC.Util.detectMobileWindows()||TC.Util.detectBlackBerry()},getBrowser:function(){window.UAParser||TC.syncLoadJS(TC.apiLocation+TC.Consts.url.UA_PARSER);var e=(new UAParser).getBrowser();return{name:e.name,version:e.major}},getElementByNodeName:function(e,t){for(var r=t.indexOf(":"),n=t.substr(r+1),o=e.getElementsByTagNameNS("*",n),i=0;i<o.length;i++)if(o[i].nodeName==t)return o},addURLParameters:function(e,t){if(!t)return e;var r=Object.keys(t).map(function(e){return encodeURIComponent(e)+"="+(t[e]?encodeURIComponent(t[e]):"")}).join("&"),n=e.split("?");if(n.length>=2){var o=n[1].split(/[&;]/g);o.push(r);return e=n[0]+"?"+o.join("&")}if((n=e.split("#")).length>=2){n.shift();return e=n[0]+"?"+r+"#"+n.join("#")}return e=e+"?"+r},removeURLParameter:function(e,t){var r=e.split("?");if(r.length>=2){for(var n=encodeURIComponent(t.toLowerCase())+"=",o=r[1].toLowerCase().split(/[&;]/g),i=o.length;i-- >0;)-1!==o[i].lastIndexOf(n,0)&&o.splice(i,1);return e=r[0]+"?"+o.join("&")}return e},showModal:function(e,t){var r=$(e);t=t||{};r.off("click").removeAttr("hidden");r.fadeIn(250,function(){r.on("click",".tc-modal-close",function(e){e.stopPropagation();return TC.Util.closeModal(t.closeCallback,$(e.target))});$.isFunction(t.openCallback)&&t.openCallback()})},closeModal:function(e,t){(t?t.closest(".tc-modal"):$(".tc-modal")).hide().find(".tc-modal-window").removeAttr("style").off();e&&e()},closeAlert:function(e){$(e).parents(".tc-alert").hide()},getParameterByName:function(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)","i").exec(location.search);return null===t?"":decodeURIComponent(t[1].replace(/\+/g," "))},getLocaleUserChoice:function(e){var t="en-US",r=(e=e||{}).cookieName||"SITNA.language",n=e.paramName||"lang",o=navigator.languages&&navigator.languages.length?navigator.languages[0]:navigator.language||navigator.userLanguage,i=TC.Util.getParameterByName(n)||TC.Util.storage.getCookie(r)||o,a=i.indexOf("-");a>=0&&(i=i.substr(0,a));var s=new Date((new Date).getTime()+31536e6);TC.Util.storage.setCookie(r,i,{expires:s});switch(i){case"eu":t="eu-ES";break;case"es":t="es-ES";break;default:t="en-US"}return t},downloadBlob:function(e,t){var r=document.createElement("a");if(void 0!==r.download){var n=URL.createObjectURL(t);r.setAttribute("href",n);r.setAttribute("download",e);r.style.visibility="hidden";document.body.appendChild(r);r.click();document.body.removeChild(r)}},downloadFile:function(e,t,r){var n=new Blob([r],{type:t});navigator.msSaveBlob?navigator.msSaveBlob(n,e):TC.Util.downloadBlob(e,n)},downloadDataURI:function(e,t,r){for(var n=atob(r.split(",")[1]),o=[],i=0;i<n.length;i++)o.push(n.charCodeAt(i));var a=new Blob([new Uint8Array(o)],{type:t});navigator.msSaveBlob?navigator.msSaveBlob(a,e):TC.Util.downloadBlob(e,a)},shortenUrl:function(e){var t;$.ajax({url:"https://api-ssl.bitly.com/v3/shorten",data:{access_token:"6c466047309f44bd8173d83e81491648b243ee3d",longUrl:e},async:!1}).done(function(e){t=e.data.url});return t},utf8ToBase64:function(e){return window.btoa(unescape(encodeURIComponent(e)))},base64ToUtf8:function(e){var t;try{t=decodeURIComponent(escape(window.atob(e)))}catch(e){t=null}return t},colorArrayToString:function(e){$.isArray(e)&&(e=e.slice(0,3).reduce(function(e,t){const r=t.toString(16);return e+"00".substring(0,2-r.length)+r},"#"));return e},operation:function(e,t,r,n){for(var o=[],i=0;i<e.length;i++){for(var a=e[i],s=!1,l=0;l<t.length;l++)if(r(a,t[l])){s=!0;break}s===n&&o.push(a)}return o},isSecureURL:function(e){return!/^(f|ht)tps?:\/\//i.test(e)||/^(f|ht)tps:\/\//i.test(e)},inBoth:function(e,t,r){return this.operation(e,t,r,!0)},inFirstOnly:function(e,t,r){return this.operation(e,t,r,!1)},inSecondOnly:function(e,t,r){return this.inFirstOnly(t,e,r)},toDataUrl:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{type:"image/png",encoderOptions:.92},n=r.type,o=r.encoderOptions,i=e.getContext("2d");if(!i)return"";var a=e.width,s=e.height,l=i.getImageData(0,0,a,s),c=i.globalCompositeOperation;if(t){i.globalCompositeOperation="destination-over";i.fillStyle=t;i.fillRect(0,0,a,s)}var u=e.toDataURL(n,o);if(t){i.clearRect(0,0,a,s);i.putImageData(l,0,0);i.globalCompositeOperation=c}return u},imgToDataUrl:function(e,t){var r=function(e){var t=document.createElement("CANVAS"),r=t.getContext("2d");t.height=e.height;t.width=e.width;r.drawImage(e,0,0);return t},n=$.Deferred(),o=new Image;o.crossOrigin="anonymous";o.onload=function(){var i,a=r(o);try{i=TC.Util.toDataUrl(a,"#ffffff",{type:t||"image/jpeg",encoderOptions:1});n.resolve(i,a)}catch(t){o.src=TC.proxify(e)}};o.onerror=function(i){var a=new XMLHttpRequest;a.open("GET",TC.proxify(e),!0);a.setRequestHeader("Content-Type","application/x-www-form-urlencoded");a.responseType="arraybuffer";a.onload=function(e){if(200===this.status){for(var i=new Uint8Array(this.response),s=i.length,l=new Array(s);s--;)l[s]=String.fromCharCode(i[s]);var c=l.join(""),u=a.getResponseHeader("content-type");if(0===u.indexOf("image")){o.src="data:"+u+";base64,"+window.btoa(c);o.onload=function(){var e=r(o);dataURL=TC.Util.toDataUrl(e,"#ffffff",{type:t||"image/jpeg",encoderOptions:1});n.resolve(dataURL,e)}}}};a.onreadystatechange=function(){4===a.readyState&&200!==a.status&&n.reject()};a.send()};o.src=e;if(o.complete||void 0===o.complete){o.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==";o.src=e}return n.promise()},imgTagToDataUrl:function(e,t){var r=function(e){var t=document.createElement("CANVAS"),r=t.getContext("2d");t.height=e.height;t.width=e.width;r.drawImage(e,0,0);return t}(e);try{return{base64:TC.Util.toDataUrl(r,"#ffffff",{type:t||"image/jpeg",encoderOptions:1}),canvas:r}}catch(e){return null}},addToCanvas:function(e,t,r){var n=TC.Util.cloneCanvas(e),o=$.Deferred(),i=n.getContext("2d"),a=new Image;t.crossOrigin="anonymous";a.src=t;a.onload=function(){i.drawImage(a,r.x||0,r.y||0);o.resolve(n)};return o.promise()},cloneCanvas:function(e){var t=document.createElement("canvas"),r=t.getContext("2d");t.width=e.width;t.height=e.height;r.drawImage(e,0,0);return t},calculateAspectRatioFit:function(e,t,r,n){var o=Math.min(r/e,n/t);return{width:e*o,height:t*o}},getFormattedDate:function(e,t){function r(e){return e<10?"0"+e:e}var n=new Date(e);return[n.getFullYear(),r(n.getMonth()+1),r(n.getDate())].concat(t?["_",r(n.getHours()),r(n.getMinutes()),r(n.getSeconds())]:[]).join("")},replaceAccent:function(e){var t={"\xe4":"a","\xf6":"o","\xfc":"u","\xc4":"A","\xd6":"O","\xdc":"U","\xe1":"a","\xe9":"e",i:"i","\xf3":"o","\xfa":"u","\xc1":"A","\xc9":"E","\xcd":"I","\xd3":"O","\xda":"U","\xf1":"n","\xd1":"N"};return e.replace(/[\xf6\xe4\xfc\xd6\xc4\xdc\xe1\xe9\xed\xf3\xfa\xc1\xc9\xcd\xd3\xda\xf1\xd1]/g,function(e){return t[e]})},downloadFileForm:function(e,t){var r=function(e,t){var r=$("<form/>",{class:"tc-ctl-download-form",method:"post",enctype:"text/plain",action:TC.Util.detectIE()?TC.proxify(e):e}),n=$("<input/>",{class:"tc-ctl-download-query",name:t.substring(0,t.indexOf("="))});r.append(n);var o=$("iframe").filter(function(t,r){return $(r).data("url-download")===e});if(o.length>0)o=o.first();else{(o=$('<iframe style="visibility: hidden; display:none;"></iframe>')).data("url-download",e);$("body").append(o)}var i=o[0].contentDocument;i.open();i.write(r[0].outerHTML);i.close();$("input",i).val(t.substring(t.indexOf("=")+1));return r=$("form",i)},n=[];if(jQuery.isArray(e))for(var o=e,i=0;i<o.length;i++)n.push(r(o[i].url,o[i].data));else n.push(r(e,t));$(n).submit();setTimeout(function(){$(".tc-ctl-download-form").remove()},1e3)},WFSQueryBuilder:function(e,t,r,n,o){$.isArray(e)||(e=[e]);var i='xsi:schemaLocation="http://www.opengis.net/wfs http://schemas.opengis.net/wfs/1.1.0/wfs.xsd" xmlns:ogc="http://www.opengis.net/ogc" service="WFS" {resultType} {format} ';switch(r.version){case"1.0.0":case"1.1.0":i+='xmlns:gml="http://www.opengis.net/gml" xmlns:wfs="http://www.opengis.net/wfs" ';break;case"2.0.0":i+='xmlns:wfs="http://www.opengis.net/wfs/2.0" xmlns:gml="http://www.opengis.net/gml/3.2" '}for(var a in r)"string"==typeof r[a]&&a.indexOf("gml")<0&&r[a].indexOf("wfs")<0&&(i+=a+'="'+r[a]+'" ');var s="<wfs:GetFeature "+i.format({resultType:o?'resultType="hits"':"",format:'outputFormat="'+n+'"'})+">",l="",c="<wfs:Query typeName"+("2.0.0"===r.version?"s":"")+'="{typeName}">{filter}</wfs:Query>';$.each(e,function(e,n){l+=c.format({typeName:n,filter:t?t.getText(r.version):""})});return s+=l+"</wfs:GetFeature>"},WFSFilterBuilder:function(e,t){var r="";if(jQuery.isPlainObject(e))r='<{prefix}:Filter><{prefix}:Intersects><fes:ValueReference></fes:ValueReference><{prefix}:Function name="querySingle"><{prefix}:Literal>{clipLayer}</{prefix}:Literal><{prefix}:Literal>{geometryName}</{prefix}:Literal><{prefix}:Literal>{where}</{prefix}:Literal></{prefix}:Function></{prefix}:Intersects></{prefix}:Filter>'.format({prefix:"2.0.0"===t?"fes":"ogc",clipLayer:e.clipLayer,geometryName:e.geometryName,where:e.where});else switch(!0){case!e:break;case $.isArray(e):var n="<gml:Envelope><gml:lowerCorner>{lowerCorner}</gml:lowerCorner><gml:upperCorner>{upperCorner}</gml:upperCorner></gml:Envelope>".format({lowerCorner:e[0]+" "+e[1],upperCorner:e[2]+" "+e[3]});switch(!0){case"1.0.0"===t:case"1.1.0"===t:r+="<ogc:Filter><ogc:BBOX>"+n+"</ogc:BBOX></ogc:Filter>";break;case"2.0.0"===t:r+="<fes:Filter><fes:BBOX>"+n+"</fes:BBOX></fes:Filter>"}break;case e instanceof TC.Feature:switch(!0){case"1.0.0"===t:case"1.1.0"===t:r+="<ogc:Filter><ogc:Intersects><ogc:PropertyName></ogc:PropertyName>"+TC.Util.writeGMLGeometry(e,"2.0")+"</ogc:Intersects></ogc:Filter>";break;case"2.0.0"===t:r+="<fes:Filter><fes:Intersects><fes:ValueReference></fes:ValueReference>"+TC.Util.writeGMLGeometry(e,"3.2")+"</fes:Intersects></fes:Filter>"}break;default:TC.error("Geometr\xeda no v\xe1lida")}return r},writeGMLGeometry:function(e,t){var r=function(e){var r;if(0===t.indexOf("3")){r=e.toString();for(;r.indexOf(",")>=0;)r=r.replace(","," ")}else{r=e;jQuery.each(r,function(e,t){return t.join(",")}).join(" ")}return r};switch(t){case"3.1.1":break;case"3.2":switch(!0){case TC.feature.Polyline&&e instanceof TC.feature.Polyline:return'<gml:LineString srsDimension="2"><gml:posList>'+r(e.geometry)+"</gml:posList></gml:LineString>";default:return'<gml:Polygon srsDimension="2"><gml:exterior><gml:LinearRing><gml:posList>'+r(e.geometry[0])+"</gml:posList></gml:LinearRing></gml:exterior></gml:Polygon>"}break;case"2.0":default:switch(!0){case TC.feature.Polyline&&e instanceof TC.feature.Polyline:return"<gml:LineString><gml:coordinates>"+r(e.geometry[0])+"</gml:coordinates></gml:LineString>";default:return"<gml:Polygon><gml:outerBoundaryIs><gml:LinearRing><gml:coordinates>"+r(e.geometry[0])+"</gml:coordinates></gml:LinearRing></gml:outerBoundaryIs></gml:Polygon>"}}},isServiceWorker:function(){return!!navigator.serviceWorker&&!(!navigator.serviceWorker.controller||"activated"!==navigator.serviceWorker.controller.state)},isSameOriginByLocation:function(e,t){var r=0!==e.indexOf("http")&&0!==e.indexOf("//"),n=!r&&e.match(TC.Consts.url.SPLIT_REGEX);if(n){var o=n[1];r=(o==t.protocol||void 0==o)&&n[3]==t.hostname;var i=n[4],a=t.port;(80!=i&&""!==i||"80"!=a&&""!==a)&&(r=r&&i==a)}return r},isSameProtocol:function(e,t){if(e.match(/^(\/\/)/i))return!0;var r=/^(https?:\/\/)/i,n=e.match(r);if(n&&n.length>1){var o=t.match(r);if(o&&o.length>1)return n[0].trim()===o[0].trim()}return!1},consoleRegister:function(e){TC.isDebug&&console.log(e)},getSorterByProperty:function(e){return function(t,r){return t[e]>r[e]?1:t[e]<r[e]?-1:0}},getSoundexDifference:function(e,t){for(var r=0,n=0;n<e.length;n++)e.charAt(n)==t.charAt(n)&&r++;return r},toAbsolutePath:function(e){var t=document.createElement("a");t.href=e;return t.href}};String.prototype.format=function(){var e=this.toString();if(!arguments.length)return e;var t="string"==(t=typeof arguments[0])||"number"==t?arguments:arguments[0];for(arg in t)e=e.replace(RegExp("\\{"+arg+"\\}","gi"),t[arg]);return e};return c});