{"version":3,"sources":["control/WorkLayerManager.js"],"names":["TC","control","TOC","syncLoadJS","apiLocation","WorkLayerManager","options","self","this","apply","arguments","layers","layerTools","addLayerTool","renderFn","container","layerId","className","CLASS","checkbox","querySelector","layer","map","getLayer","isRaster","info","getInfo","hasOwnProperty","text","getLocaleString","document","createElement","setAttribute","checkboxId","classList","add","dataset","label","innerHTML","appendChild","actionFn","li","parentElement","tagName","querySelectorAll","forEach","img","styleLegendImage","toggle","Consts","classes","HIDDEN","checked","contains","button","Vector","getDownloadDialog","then","title","fileName","test","substr","lastIndexOf","elevation","open","features","inherit","ctlProto","prototype","CLICKEVENT","DRAG","DRAGEND","event","TOOLSOPEN","template","1","depth0","helpers","partials","data","stack1","lookupProperty","parent","propertyName","Object","call","invokePartial","name","decorators","compiler","main","alias1","nullContext","alias2","escapeExpression","hash","loc","start","line","column","end","fn","program","inverse","noop","usePartial","useData","lambda","3","4","6","7","9","11","13","15","17","19","20","22","24","25","26","27","29","30","31","alias3","indent","findLayerElement","ctl","getLayerUIElements","filter","id","getElligibleLayersNumber","length","shouldBeDelAllVisible","some","unremovable","moveLayer","listItem","oldIndex","newIndex","callback","layerItems","targetItem","sourceLayer","targetLayer","newIdx","indexOf","insertLayer","render","_set1stRenderPromise","renderData","Util","extend","getLayerTree","addUIEventListeners","loadJS","window","Sortable","workLayers","stealth","updateLayerTree","ul","div","_sortable","create","handle","animation","onSort","e","item","addEventListener","EventTarget","listenerBySelector","elm","target","swap","oldIdx","sortableItems","toArray","buffer","sort","listItems","elmIdx","key","focus","stopPropagation","blur","Promise","reject","Error","register","resolve","loaded","updateScale","on","LAYEROPACITY","value","Math","round","opacity","FEATURESIMPORT","pattern","format","GPX","toLowerCase","one","LAYERADD","layout","accordion","COLLAPSED","controls","containerControl","trigger","remove","onExternalServiceAdded","matches","setVisibility","inputRangeListener","range","setOpacity","removeLayer","confirm","updateLayerVisibility","visible","getVisibility","isBase","MapContents","alreadyExists","i","len","layerTitle","wrap","getServiceTitle","l","_timeStamp","find","_title","nameRegExp","RegExp","exec","parseInt","prevLi","getPath","join","push","layerData","hideTitle","hide","renderOptions","customLegend","hasExtent","getExtent","layerNames","path","names","n","p","shift","legend","abstract","metadata","method","getLegendGraphicImage","src","catch","err","error","getLegendImgByPost","getRenderedHtml","out","DOMParser","parseFromString","body","firstChild","layerNode","isGroup","layerNodes","getAllLayerNodes","node","getName","getLayerNodes","typeElm","zoomBtn","CLICK","zoomToLayer","animate","passive","normalizeLayerNode","tip","mapDiv","typeElmRect","getBoundingClientRect","style","top","offsetTop","right","offsetWidth","left","offsetLeft","removeChild","lis","layerList","layerIdx","tool","addLayerToolUI","inserted","ii","referenceLi","insertAdjacentElement","domReadyPromise","elligibleLayersNum","numElm","emptyElm","contentElm","textContent","VISIBLE","isVisible","isVisibleByScale","update","_getCheckbox","tree","updateLayerOrder","idx","splice","numberElm","nChildren","Array","from","isFunction","eventName","getAttribute","updateFn","updateEvents"],"mappings":"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","sourcesContent":["TC.control = TC.control || {};\r\n\r\nif (!TC.control.TOC) {\r\n    TC.syncLoadJS(TC.apiLocation + 'TC/control/TOC');\r\n}\r\n\r\nTC.control.WorkLayerManager = function (options) {\r\n    var self = this;\r\n    TC.control.TOC.apply(self, arguments);\r\n    self.layers = [];\r\n    self.layerTools = [];\r\n\r\n    self.addLayerTool({\r\n        renderFn: function (container, layerId) {\r\n            const className = self.CLASS + '-cb-info';\r\n\r\n            let checkbox = container.querySelector('input[type=\"checkbox\"].' + className);\r\n            if (!checkbox) {\r\n                const layer = self.map.getLayer(layerId);\r\n                if (layer.isRaster()) {\r\n                    const info = layer.getInfo();\r\n                    if (info.hasOwnProperty('abstract') || info.hasOwnProperty('legend') || info.hasOwnProperty('metadata')) {\r\n                        const text = self.getLocaleString('infoFromThisLayer');\r\n                        checkbox = document.createElement('input');\r\n                        checkbox.setAttribute('type', 'checkbox');\r\n                        const checkboxId = className + '-' + layerId;\r\n                        checkbox.setAttribute('id', checkboxId);\r\n                        checkbox.setAttribute('title', text);\r\n                        checkbox.classList.add(className);\r\n                        checkbox.dataset.layerId = layerId;\r\n                        const label = document.createElement('label');\r\n                        label.innerHTML = text;\r\n                        label.setAttribute('title', text);\r\n                        label.setAttribute('for', checkboxId);\r\n                        label.classList.add(className + '-label');\r\n                        container.appendChild(checkbox);\r\n                        container.appendChild(label);\r\n                    }\r\n                }\r\n            }\r\n            return checkbox;\r\n        },\r\n        actionFn: function () {\r\n            const checkbox = this;\r\n            var li = checkbox;\r\n            do {\r\n                li = li.parentElement;\r\n            }\r\n            while (li && li.tagName !== 'LI');\r\n            const info = li.querySelector('.' + self.CLASS + '-info');\r\n            const layer = self.map.getLayer(checkbox.dataset.layerId);\r\n            // Cargamos la imagen de la leyenda\r\n            info.querySelectorAll('.' + self.CLASS + '-legend img').forEach(function (img) {\r\n                self.styleLegendImage(img, layer);\r\n            });\r\n            info.classList.toggle(TC.Consts.classes.HIDDEN, !checkbox.checked);\r\n\r\n            if (li.querySelector('input[type=\"checkbox\"].tc-ctl-wlm-tools-visibility').checked) {\r\n                const dragHandle = li.querySelector('.' + self.CLASS + '-dd');\r\n                dragHandle.classList.toggle(TC.Consts.classes.HIDDEN, !info.classList.contains(TC.Consts.classes.HIDDEN));\r\n            }\r\n        }\r\n    });\r\n\r\n    self.addLayerTool({\r\n        renderFn: function (container, layerId) {\r\n            const className = self.CLASS + '-btn-dl';\r\n\r\n            let button = container.querySelector('button.' + className);\r\n            if (!button) {\r\n                const layer = self.map.getLayer(layerId);\r\n                if (TC.layer.Vector && layer instanceof TC.layer.Vector) {\r\n                    const text = self.getLocaleString('downloadFeatures');\r\n                    button = document.createElement('button');\r\n                    button.innerHTML = text;\r\n                    button.setAttribute('title', text);\r\n                    button.classList.add(className);\r\n                    button.dataset.layerId = layerId;\r\n                    container.appendChild(button);\r\n                }\r\n            }\r\n            return button;\r\n        },\r\n        actionFn: function () {\r\n            const button = this;\r\n            var li = button;\r\n            do {\r\n                li = li.parentElement;\r\n            }\r\n            while (li && li.tagName !== 'LI');\r\n            const layer = self.map.getLayer(button.dataset.layerId);\r\n            self.getDownloadDialog().then(function (control) {\r\n                const title = layer.title || '';\r\n                const options = {\r\n                    title: `${title} - ${self.getLocaleString('downloadFeatures')}`,\r\n                    fileName: /\\.[a-z0-9]+$/i.test(title) ? title.substr(0, title.lastIndexOf('.')) : title,\r\n                    elevation: self.map.elevation && self.map.elevation.options\r\n                };\r\n                control.open(layer.features, options);\r\n            });\r\n        }\r\n    });\r\n};\r\n\r\nTC.inherit(TC.control.WorkLayerManager, TC.control.TOC);\r\n\r\n(function () {\r\n    var ctlProto = TC.control.WorkLayerManager.prototype;\r\n\r\n    ctlProto.CLASS = 'tc-ctl-wlm';\r\n    ctlProto.CLICKEVENT = 'click';\r\n\r\n    TC.Consts.classes.DRAG = TC.Consts.classes.DRAG || 'tc-drag';\r\n    TC.Consts.classes.DRAGEND = TC.Consts.classes.DRAGEND || 'tc-dragend';\r\n\r\n    TC.Consts.event.TOOLSOPEN = TC.Consts.event.TOOLSOPEN || 'toolsopen.tc';\r\n\r\n    ctlProto.template = {};\r\n    ctlProto.template[ctlProto.CLASS] = TC.apiLocation + \"TC/templates/tc-ctl-wlm.hbs\";\r\n    ctlProto.template[ctlProto.CLASS + '-elm'] = TC.apiLocation + \"TC/templates/tc-ctl-wlm-elm.hbs\";\r\n    ctlProto.template[ctlProto.CLASS + '-type-sgl'] = TC.apiLocation + \"TC/templates/tc-ctl-wlm-type-sgl.hbs\";\r\n    ctlProto.template[ctlProto.CLASS + '-type-grp'] = TC.apiLocation + \"TC/templates/tc-ctl-wlm-type-grp.hbs\";\r\n    ctlProto.template[ctlProto.CLASS + '-type-grp-node'] = TC.apiLocation + \"TC/templates/tc-ctl-wlm-type-grp-node.hbs\";\r\n\r\n    const findLayerElement = function (ctl, layer) {\r\n        return ctl.getLayerUIElements().filter(function (li) {\r\n            return li.dataset.layerId === layer.id;\r\n        })[0];\r\n    };\r\n\r\n    var getElligibleLayersNumber = function (ctl) {\r\n        return ctl.layers.length;\r\n    };\r\n\r\n    const shouldBeDelAllVisible = function (ctl) {\r\n        return !ctl.layers.some(function (layer) { return layer.unremovable });\r\n    };\r\n\r\n    const moveLayer = function (ctl, listItem, oldIndex, newIndex, callback) {\r\n        const layerItems = ctl.getLayerUIElements();\r\n        var targetItem;\r\n        if (newIndex > oldIndex) {\r\n            targetItem = layerItems[newIndex - 1];\r\n        }\r\n        else if (newIndex < oldIndex) {\r\n            targetItem = layerItems[newIndex + 1];\r\n        }\r\n        else {\r\n            return;\r\n        }\r\n        const sourceLayer = ctl.map.getLayer(listItem.dataset.layerId);\r\n        const targetLayer = ctl.map.getLayer(targetItem.dataset.layerId);\r\n        const newIdx = ctl.map.layers.indexOf(targetLayer);\r\n        if (newIdx >= 1 && newIdx < ctl.map.layers.length) {\r\n            ctl.map.insertLayer(sourceLayer, newIdx, callback);\r\n        }\r\n    };\r\n\r\n    ctlProto.render = function (callback, options) {\r\n        const self = this;\r\n        return self._set1stRenderPromise(self.map ? self.renderData(options ? TC.Util.extend(self.map.getLayerTree(), options) : self.map.getLayerTree(), function () {\r\n            self.addUIEventListeners();\r\n            TC.loadJS(\r\n                !window.Sortable,\r\n                [TC.apiLocation + 'lib/sortable/Sortable.min.js'],\r\n                function () {\r\n                    self.map.workLayers\r\n                        .filter(function (layer) {\r\n                            return !layer.stealth;\r\n                        })\r\n                        .forEach(function (layer) {\r\n                            self.updateLayerTree(layer);\r\n                        });\r\n\r\n\r\n                    const ul = self.div.querySelector('ul');\r\n                    self._sortable = Sortable.create(ul, {\r\n                        handle: '.' + self.CLASS + '-dd',\r\n                        animation: 150,\r\n                        onSort: function (e) {\r\n                            moveLayer(self, e.item, e.oldIndex, e.newIndex);\r\n                        }\r\n                    });\r\n\r\n                    ul.addEventListener('keydown', TC.EventTarget.listenerBySelector('li', function (e) {\r\n                        // Para mover capas con el teclado.\r\n                        var elm = e.target;\r\n                        while (elm.tagName !== 'LI') {\r\n                            elm = elm.parentElement;\r\n                            if (!elm) {\r\n                                return;\r\n                            }\r\n                        }\r\n                        const swap = function (oldIdx, newIdx) {\r\n                            const sortableItems = self._sortable.toArray();\r\n                            const buffer = sortableItems[oldIdx];\r\n                            sortableItems[oldIdx] = sortableItems[newIdx];\r\n                            sortableItems[newIdx] = buffer;\r\n                            self._sortable.sort(sortableItems);\r\n                            moveLayer(self, elm, oldIdx, newIdx);\r\n                        };\r\n                        const listItems = self.getLayerUIElements();\r\n                        const elmIdx = listItems.indexOf(elm);\r\n                        switch (true) {\r\n                            case /Up$/.test(e.key):\r\n                                if (elmIdx > 0) {\r\n                                    swap(elmIdx, elmIdx - 1);\r\n                                    elm.focus();\r\n                                    e.stopPropagation();\r\n                                }\r\n                                break;\r\n                            case /Down$/.test(e.key):\r\n                                if (elmIdx < listItems.length - 1) {\r\n                                    swap(elmIdx, elmIdx + 1);\r\n                                    elm.focus();\r\n                                    e.stopPropagation();\r\n                                }\r\n                                break;\r\n                            case /Enter$/.test(e.key):\r\n                                elm.blur();\r\n                                e.stopPropagation();\r\n                                break;\r\n                            default:\r\n                                break;\r\n                        }\r\n                    }));\r\n\r\n                    if (typeof callback === 'function') {\r\n                        callback();\r\n                    }\r\n                }\r\n            );\r\n        }) : Promise.reject(Error('Cannot render: control has no map')));\r\n    };\r\n\r\n    ctlProto.register = function (map) {\r\n        const self = this;\r\n\r\n        return new Promise(function (resolve, reject) {\r\n            TC.control.TOC.prototype.register.call(self, map).then(function () {\r\n\r\n                map.loaded(function () {                   \r\n                    self.updateScale();\r\n                });\r\n\r\n                map\r\n                    .on(TC.Consts.event.LAYEROPACITY, function (e) {\r\n                        const li = findLayerElement(self, e.layer);\r\n                        if (li) {\r\n                            li.querySelector('input[type=range]').value = Math.round(e.opacity * 100);\r\n                        }\r\n                    })\r\n                    .on(TC.Consts.event.FEATURESIMPORT, function (e) {\r\n                        var fileName = e.fileName;\r\n                        if (e.features && e.features.length > 0) { // GLS: Escuchamos al evento FEATURESIMPORT para poder desplegar el control de capas cargadas\r\n                            // Ignoramos los GPX (se supone que los gestionará Geolocation)\r\n                            var pattern = '.' + TC.Consts.format.GPX.toLowerCase();\r\n                            if (e.fileName.toLowerCase().indexOf(pattern) === e.fileName.length - pattern.length) {\r\n                                return;\r\n                            }\r\n\r\n                            map.one(TC.Consts.event.LAYERADD, function (e) {\r\n                                if (e && e.layer && e.layer.title == fileName) {\r\n                                    // Desplegamos el control capas cargadas\r\n                                    if (self.map && self.map.layout && self.map.layout.accordion) {\r\n                                        if (self.div.classList.contains(TC.Consts.classes.COLLAPSED)) {\r\n                                            self.map.controls\r\n                                                .filter(function (ctl) {\r\n                                                    // Todos los otros controles que no cuelgan de otro control\r\n                                                    return ctl !== self && !ctl.containerControl;\r\n                                                })\r\n                                                .forEach(function (ctl) {\r\n                                                    ctl.div.classList.add(TC.Consts.classes.COLLAPSED);\r\n                                                });\r\n                                        }\r\n                                    }\r\n\r\n                                    // abrimos el panel de herramientas\r\n                                    self.map.trigger(TC.Consts.event.TOOLSOPEN);\r\n\r\n                                    self.div.classList.remove(TC.Consts.classes.COLLAPSED);\r\n                                }\r\n                            });\r\n                        }\r\n                    });\r\n                resolve(self);\r\n            });\r\n        });\r\n    };\r\n\r\n    ctlProto.onExternalServiceAdded = function (e) {\r\n        // Este control no tiene que aceptar servicios externos directamente\r\n    };\r\n\r\n    ctlProto.addUIEventListeners = function () {\r\n        const self = this;\r\n\r\n        self.div.addEventListener(self.CLICKEVENT, TC.EventTarget.listenerBySelector(`input.${self.CLASS}-tools-visibility[type=\"checkbox\"]`, function (e) {\r\n            // al estar en ipad el evento pasa a ser touchstart en la constante: TC.Consts.event.CLICK, los checkbox no funcionan bien con este evento\r\n            const checkbox = e.target;\r\n            var li = checkbox;\r\n            do {\r\n                li = li.parentElement;\r\n            }\r\n            while (li && !li.matches('li.' + self.CLASS + '-elm'));\r\n\r\n            const layer = self.map.getLayer(li.dataset.layerId);\r\n            layer.setVisibility(checkbox.checked);\r\n            e.stopPropagation();\r\n        }));\r\n\r\n        const inputRangeListener = function (e) {\r\n            const range = e.target;\r\n            var li = range;\r\n            do {\r\n                li = li.parentElement;\r\n            }\r\n            while (li && li.tagName !== 'LI');\r\n\r\n            const layer = self.map.getLayer(li.dataset.layerId);\r\n            layer.setOpacity(range.value / 100);\r\n        };\r\n        self.div.addEventListener('change', TC.EventTarget.listenerBySelector('input[type=range]', inputRangeListener));\r\n        self.div.addEventListener('input', TC.EventTarget.listenerBySelector('input[type=range]', inputRangeListener));\r\n\r\n        self.div.addEventListener(self.CLICKEVENT, TC.EventTarget.listenerBySelector(`.${self.CLASS}-btn-del:not(.disabled)`, function (e) {\r\n            var li = e.target;\r\n            do {\r\n                li = li.parentElement;\r\n            }\r\n            while (li && li.tagName !== 'LI');\r\n            const layer = self.map.getLayer(li.dataset.layerId);\r\n            self.map.removeLayer(layer);\r\n        }));\r\n\r\n        self.div.addEventListener(self.CLICKEVENT, TC.EventTarget.listenerBySelector('.' + self.CLASS + '-del-all', function (e) {\r\n            TC.confirm(self.getLocaleString('layersRemove.confirm'), function () {\r\n                self.getLayerUIElements()\r\n                    .map(function (li) {\r\n                        return self.map.getLayer(li.dataset.layerId);\r\n                    })\r\n                    .forEach(function (layer) {\r\n                        self.map.removeLayer(layer);\r\n                    });\r\n            });\r\n        }));\r\n\r\n    };\r\n\r\n    ctlProto.updateLayerVisibility = function (layer) {\r\n        const self = this;\r\n        const li = findLayerElement(self, layer);\r\n        if (li) {\r\n            const visible = layer.getVisibility();\r\n            li.querySelector(`input.${self.CLASS}-tools-visibility[type=\"checkbox\"]`).checked = visible;\r\n        }\r\n    };\r\n\r\n    ctlProto.updateLayerTree = function (layer) {\r\n        var self = this;        \r\n\r\n        var getLegendImgByPost = function (layer) {\r\n            return new Promise(function (resolve, reject) {\r\n                if (layer && layer.options.method && layer.options.method === \"POST\") {\r\n                    layer.getLegendGraphicImage()\r\n                        .then(function (src) {\r\n                            resolve(src);\r\n                        })\r\n                        .catch(function (err) { TC.error(err); });\r\n                } else {\r\n                    resolve();\r\n                }\r\n            });\r\n        };\r\n\r\n        if (!layer.isBase && !layer.options.stealth) {\r\n            TC.control.MapContents.prototype.updateLayerTree.call(self, layer);\r\n\r\n            var alreadyExists = false;\r\n            for (var i = 0, len = self.layers.length; i < len; i++) {\r\n                if (layer === self.layers[i]) {\r\n                    alreadyExists = true;\r\n                    break;\r\n                }\r\n            }\r\n\r\n            if (!alreadyExists) {\r\n                self.layers.push(layer);\r\n\r\n                var domReadyPromise;\r\n                var layerTitle = layer.title || (layer.wrap.getServiceTitle && layer.wrap.getServiceTitle());                \r\n                layer._title = layerTitle;\r\n                var layerData = {\r\n                    title: layer.options.hideTitle ? '' : layerTitle,\r\n                    hide: layer.renderOptions && layer.renderOptions.hide ? true : false,\r\n                    opacity: layer.renderOptions && layer.renderOptions.opacity ? (layer.renderOptions.opacity * 100) : 100,\r\n                    customLegend: layer.customLegend,\r\n                    unremovable: layer.unremovable,\r\n                    id: layer.id\r\n                };\r\n                var isRaster = layer.isRaster();\r\n                if (isRaster) {\r\n                    layerData.hasExtent = !!layer.getExtent();\r\n                    layerData.layerNames = layer.layerNames;\r\n                    const path = layer.names.map(n => layer.getPath(n));\r\n                    path.forEach(p => p.shift());\r\n                    layerData.path = path;\r\n                    layerData.legend = [];\r\n                    layerData.abstract = [];\r\n                    layerData.metadata = [];\r\n                    layer.names.forEach(function (name) {\r\n                        var info = layer.getInfo(name);\r\n                        layerData.legend.push(info.legend);\r\n                        layerData.abstract.push(info.abstract);\r\n                        layerData.metadata.push(info.metadata);\r\n                    });\r\n                }\r\n                else {\r\n                    layerData.hasExtent = true;\r\n                }\r\n\r\n\r\n                getLegendImgByPost(layer).then(function (src) {\r\n                    if (src) {\r\n                        legend.src = src; // ya se ha validado en getLegendImgByPost\r\n                    }\r\n                             \r\n                    self.getRenderedHtml(self.CLASS + '-elm', layerData).then(function (out) {\r\n                        const parser = new DOMParser();\r\n                        const li = parser.parseFromString(out, 'text/html').body.firstChild;\r\n                        var layerNode;\r\n                        var isGroup = false;\r\n                        if (isRaster) {\r\n                            isGroup = layer.names.length > 1;\r\n                            if (!isGroup) {\r\n                                var layerNodes = layer.wrap.getAllLayerNodes();\r\n                                for (var i = 0; i < layerNodes.length; i++) {\r\n                                    var node = layerNodes[i];\r\n                                    if (layer.wrap.getName(node) === name) {\r\n                                        layerNode = node;\r\n                                        if (layer.wrap.getLayerNodes(node).length > 0) {\r\n                                            isGroup = true;\r\n                                        }\r\n                                        break;\r\n                                    }\r\n                                }\r\n                            }\r\n                        }\r\n\r\n                        const typeElm = li.querySelector('.' + self.CLASS + '-type');\r\n                        const className = isGroup ? self.CLASS + '-type-grp' : self.CLASS + '-type-sgl';\r\n                        typeElm.classList.add(className);\r\n\r\n                        const zoomBtn = li.querySelector(`.${self.CLASS}-btn-zoom`);\r\n                        if (zoomBtn) {\r\n                            zoomBtn.addEventListener(TC.Consts.event.CLICK, function (e) {\r\n                                self.map.zoomToLayer(li.dataset.layerId, { animate: true });\r\n                            }, { passive: true });\r\n                        }\r\n\r\n                        if (layerNode) {\r\n                            layer.wrap.normalizeLayerNode(layerNode);\r\n\r\n                            self.getRenderedHtml(className, layerNode).then(function (out) {\r\n                                var tip;\r\n\r\n                                typeElm.addEventListener('mouseover', function (e) {\r\n                                    const mapDiv = self.map.div;\r\n                                    const typeElmRect = typeElm.getBoundingClientRect();\r\n                                    tip = document.createElement('div');\r\n                                    tip.classList.add(self.CLASS + '-tip');\r\n                                    tip.innerHTML = out;\r\n                                    tip.style.top = (typeElmRect.top - mapDiv.offsetTop) + 'px';\r\n                                    tip.style.right = mapDiv.offsetWidth - (typeElmRect.left - mapDiv.offsetLeft) + 'px';\r\n                                    mapDiv.appendChild(tip);\r\n                                });\r\n                                typeElm.addEventListener('mouseout', function (e) {\r\n                                    tip.parentElement.removeChild(tip);\r\n                                });\r\n                            });\r\n                        }\r\n                        const ul = self.div.querySelector('ul');\r\n                        li.dataset.layerId = layer.id;\r\n\r\n                        const lis = self.getLayerUIElements();\r\n                        const layerList = self.map.workLayers\r\n                            .filter(function (l) {\r\n                                return !l.stealth;\r\n                            });\r\n                        const layerIdx = layerList.indexOf(layer);\r\n\r\n                        self.layerTools.forEach(tool => self.addLayerToolUI(li, tool));\r\n\r\n                        var inserted = false;\r\n                        for (var i = 0, ii = lis.length; i < ii; i++) {\r\n                            const referenceLi = lis[i];\r\n                            const referenceLayerIdx = layerList.indexOf(self.map.getLayer(referenceLi.dataset.layerId));\r\n                            if (referenceLayerIdx < layerIdx) {\r\n                                referenceLi.insertAdjacentElement('beforebegin', li);\r\n                                inserted = true;\r\n                                break;\r\n                            }\r\n                        }\r\n                        if (!inserted) {\r\n                            ul.appendChild(li);\r\n                        }\r\n\r\n                        if (domReadyPromise) domReadyPromise(li);\r\n                        self.updateScale();\r\n                    });\r\n                });\r\n\r\n                var elligibleLayersNum = getElligibleLayersNumber(self);\r\n                const numElm = self.div.querySelector('.' + self.CLASS + '-n');\r\n                const emptyElm = self.div.querySelector('.' + self.CLASS + '-empty');\r\n                const contentElm = self.div.querySelector('.' + self.CLASS + '-content');\r\n                numElm.textContent = elligibleLayersNum;\r\n                if (elligibleLayersNum > 0) {\r\n                    numElm.classList.add(TC.Consts.classes.VISIBLE);\r\n                    emptyElm.classList.add(TC.Consts.classes.HIDDEN);\r\n                    contentElm.classList.remove(TC.Consts.classes.HIDDEN);\r\n                }\r\n                else {\r\n                    numElm.classList.remove(TC.Consts.classes.VISIBLE);\r\n                    emptyElm.classList.remove(TC.Consts.classes.HIDDEN);\r\n                    contentElm.classList.add(TC.Consts.classes.HIDDEN);\r\n                }\r\n\r\n                const deleteAllElm = self.div.querySelector('.' + self.CLASS + '-del-all');\r\n                deleteAllElm.classList.toggle(TC.Consts.classes.HIDDEN, !shouldBeDelAllVisible(self));\r\n            }\r\n            else {\r\n                var layerTitle = layer.title || layer.wrap.getServiceTitle();\r\n                //comprobar si hay capas con títulos repetidos                 \r\n                while (self.layers.filter(function (l) { return l !== layer && (layer._timeStamp !== l._timeStamp) }).find(function (l) { return (l._title || l.title) === layerTitle; })) {\r\n                    var nameRegExp = new RegExp(/(.+\\.\\w+ )\\(([0-9]+)\\)$/gi).exec(layerTitle)\r\n                    layerTitle = !nameRegExp ? layerTitle + \" (2)\" : nameRegExp[1] + \"(\" + (parseInt(nameRegExp[2], 10) + 1) + \")\";\r\n                }\r\n                layer._title = layerTitle;\r\n                const prevLi = self.div.querySelector(\"ul li[data-layer-id='\" + layer.id + \"']\");\r\n                if (layer.features && layer.features.length) {\r\n                    if (layer.features[0].getPath().length) {\r\n                        prevLi.querySelector(\".tc-ctl-wlm-lyr\").innerHTML = layerTitle;\r\n                        prevLi.querySelector(\".tc-ctl-wlm-path\").innerHTML = layer.features[0].getPath().join(' &bull; ');\r\n                    }\r\n                    else\r\n                        prevLi.querySelector(\".tc-ctl-wlm-path\").innerHTML = layerTitle\r\n\r\n                }\r\n            }\r\n        }\r\n    };\r\n\r\n    ctlProto.updateScale = function () {\r\n        var self = this;\r\n        self.getLayerUIElements().forEach(function (li) {\r\n            var layer = self.map.getLayer(li.dataset.layerId);\r\n            if (layer && layer.names) {\r\n                var isVisible = false;\r\n                for (var i = 0; i < layer.names.length; i++) {\r\n                    if (layer.isVisibleByScale(layer.names[i])) {\r\n                        isVisible = true;\r\n                        break;\r\n                    }\r\n                }\r\n                li.classList.toggle(self.CLASS + '-elm-notvisible', !isVisible);\r\n            }\r\n        });\r\n    };\r\n\r\n    ctlProto.update = function () {\r\n        var self = this;\r\n\r\n        var _getCheckbox = function (li) {\r\n            return li.querySelector(`input.${self.CLASS}-tools-visibility[type=\"checkbox\"]`);\r\n        };\r\n\r\n        self.getLayerUIElements().forEach(function (li) {\r\n            const layer = self.map.getLayer(li.dataset.layerId);\r\n            if (layer) {\r\n                _getCheckbox(li).checked = layer.getVisibility();\r\n\r\n                layer.tree = null;\r\n\r\n                //li.querySelectorAll('li').forEach(function (l) {\r\n                //    const checkbox = _getCheckbox(l);\r\n                //    const uid = l.dataset.layerUid;\r\n                //    switch (layer.getNodeVisibility(uid)) {\r\n                //        case TC.Consts.visibility.VISIBLE:\r\n                //            checkbox.checked = true;\r\n                //            checkbox.indeterminate = false;\r\n                //            break;\r\n                //        case TC.Consts.visibility.NOT_VISIBLE_AT_RESOLUTION:\r\n                //            checkbox.checked = true;\r\n                //            checkbox.indeterminate = false;\r\n                //            break;\r\n                //        case TC.Consts.visibility.HAS_VISIBLE:\r\n                //            checkbox.checked = false;\r\n                //            checkbox.indeterminate = true;\r\n                //            break;\r\n                //        default:\r\n                //            checkbox.checked = false;\r\n                //            checkbox.indeterminate = false;\r\n                //    }\r\n                //});\r\n            }\r\n        });\r\n\r\n        self.updateScale();\r\n    };\r\n\r\n    ctlProto.updateLayerOrder = function (layer, oldIdx, newIdx) {\r\n        //TC.control.MapContents.prototype.updateLayerOrder.call(this, layer, oldIdx, newIdx);\r\n        const self = this;\r\n        self.map.workLayers\r\n            .filter(function (layer) {\r\n                return !layer.stealth;\r\n            })\r\n            .forEach(function (layer) {\r\n                const li = findLayerElement(self, layer);\r\n                if (li) {\r\n                    li.parentElement.firstChild.insertAdjacentElement('beforebegin', li);\r\n                }\r\n            });\r\n    };\r\n\r\n    ctlProto.removeLayer = function (layer) {\r\n        var self = this;\r\n        var idx = self.layers.indexOf(layer);\r\n        if (idx >= 0) {\r\n            self.layers.splice(idx, 1);\r\n        }\r\n        self.getLayerUIElements().forEach(function (li) {\r\n            if (li.dataset.layerId === layer.id) {\r\n                li.parentElement.removeChild(li);\r\n            }\r\n        });\r\n        const contentElm = self.div.querySelector('.' + self.CLASS + '-content');\r\n        const emptyElm = self.div.querySelector('.' + self.CLASS + '-empty');\r\n        const numberElm = self.div.querySelector('.' + self.CLASS + '-n');\r\n        var nChildren = getElligibleLayersNumber(self);\r\n        numberElm.textContent = nChildren;\r\n        if (nChildren > 0) {\r\n            contentElm.classList.remove(TC.Consts.classes.HIDDEN);\r\n            emptyElm.classList.add(TC.Consts.classes.HIDDEN);\r\n            numberElm.classList.add(TC.Consts.classes.VISIBLE);\r\n        }\r\n        else {\r\n            if (shouldBeDelAllVisible(self)) {\r\n                self.div.querySelector('.' + self.CLASS + '-del-all').classList.add(TC.Consts.classes.HIDDEN);\r\n            }\r\n            contentElm.classList.add(TC.Consts.classes.HIDDEN);\r\n            emptyElm.classList.remove(TC.Consts.classes.HIDDEN);\r\n            numberElm.classList.remove(TC.Consts.classes.VISIBLE);\r\n        }\r\n    };\r\n\r\n    ctlProto.getLayerUIElements = function () {\r\n        const self = this;\r\n        return Array.from(self.div.querySelectorAll(`ul > li.${self.CLASS}-elm`));\r\n    };\r\n\r\n    ctlProto.addLayerToolUI = function (elm, tool) {\r\n        const self = this;\r\n        if (TC.Util.isFunction(tool.renderFn)) {\r\n            const button = tool.renderFn(elm.querySelector(`.${self.CLASS}-tools`), elm.dataset.layerId);\r\n            if (button) {\r\n                if (TC.Util.isFunction(tool.actionFn)) {\r\n                    const eventName = button.getAttribute('type') === 'checkbox' ? 'change' : TC.Consts.event.CLICK;\r\n                    button.addEventListener(eventName, function (e) {\r\n                        tool.actionFn.call(button);\r\n                    }, { passive: true });\r\n                }\r\n                if (TC.Util.isFunction(tool.updateFn) && tool.updateEvents) {\r\n                    map.on(tool.updateEvents.join(' '), function (e) {\r\n                        if (!e.layer || e.layer.id === button.dataset.layerId) {\r\n                            tool.updateFn.call(button, e);\r\n                        }\r\n                    });\r\n                }\r\n            }\r\n        }\r\n    };\r\n\r\n    ctlProto.addLayerTool = function (options) {\r\n        const self = this;\r\n        self.layerTools.push(options);\r\n        self.getLayerUIElements().forEach(function (elm) {\r\n            self.addLayerToolUI(elm, options);\r\n        });\r\n    };\r\n})();"]}