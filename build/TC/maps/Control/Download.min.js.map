{"version":3,"sources":["control/Download.js"],"names":["TC","control","MapInfo","syncLoadJS","apiLocation","filter","Consts","DownloadError","MIMETYPE_NOT_SUPORTED","Download","options","this","_classSelector","CLASS","Control","apply","arguments","_hiddenElms","opts","_dialogDiv","Util","getDiv","dialogDiv","window","$","_$dialogDiv","document","body","appendChild","inherit","ctlProto","prototype","template","compiler","main","container","depth0","helpers","partials","data","alias1","nullContext","alias2","escapeExpression","alias3","lambda","lookupProperty","parent","propertyName","Object","hasOwnProperty","call","name","hash","loc","start","line","column","end","useData","render","callback","self","getRenderedHtml","html","innerHTML","then","renderData","controlId","id","cs","_selectors","TAB","RADIOBUTTON","ELEMENT","clickHandler","e","tab","matches","parentElement","checkbox","querySelector","newValue","value","elms","div","querySelectorAll","_oldValue","deselectable","setTimeout","checked","_activeElm","forEach","elm","push","classList","add","classes","COLLAPSED","remove","span","addEventListener","event","CLICK","passive","toFixed","number","result","indexOf","replace","register","map","mustBeExportable","_showAlertMsg","error","wait","alert","errorMsg","key","WFSErrors","MAX_NUM_FEATURES","format","serviceName","params","serviceTitle","NO_LAYERS","getLocaleString","GETCAPABILITIES","NO_FEATURES","INDETERMINATE","toast","type","msgType","ERROR","err","descripcion","errorThrown","msgErrorMode","CONSOLE","getLoadingIndicator","removeWait","WARNING","EventTarget","listenerBySelector","li","addWait","extent","getExtent","Promise","resolve","reject","canvas","wrap","getViewport","synchronous","getElementsByTagName","newCanvas","cloneCanvas","getControlsByClass","ScaleBar","drawScaleBarIntoCanvas","fill","codeContainerId","codeContainer","getElementById","createElement","setAttribute","style","top","left","position","makeQRCode","qrCodeBase64","ctx","getContext","fillStyle","fillRect","width","height","addToCanvas","x","y","mapCanvas","_canvas","fileName","location","hostname","crs","getFormattedDate","Date","toString","fileExtension","split","worldFileExtension","mimeType","JPEG","loadJS","JSZip","xScale","yScale","xOrigin","yOrigin","zip","toBlob","blob","file","generateAsync","downloadBlob","message","res","toDataURL","downloadDataURI","downLoadImage","arrPromises","extractFeatures","bbox","getCRS","outputFormat","download","all","async","responseArray","responses","item","length","arrDownloads","i","errors","j","url","downloadFileForm","service","find","response","plural","layers","layerNames","reduce","vi","va","array","Array","concat","title","join","mapLayers","downloadFeatures","evt","stopPropagation","showModal","target","generateLink","HIDDEN","registeredListeners","registerListeners","manageMaxLengthExceed","maxLengthExceed","checkboxQR","disabled","qr","toggle","label","LOADING"],"mappings":"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","sourcesContent":["TC.control = TC.control || {};\r\n\r\nif (!TC.control.MapInfo) {\r\n    TC.syncLoadJS(TC.apiLocation + 'TC/control/MapInfo');\r\n}\r\n\r\nif (!TC.filter) {\r\n    TC.syncLoadJS(TC.apiLocation + 'TC/Filter');\r\n}\r\n\r\nTC.Consts.DownloadError = {\r\n    MIMETYPE_NOT_SUPORTED: \"MimeTypeNotSupported\"\r\n}\r\n\r\nTC.control.Download = function (options) {\r\n    var self = this;\r\n    self._classSelector = '.' + self.CLASS;\r\n\r\n    TC.Control.apply(self, arguments);\r\n\r\n    self._hiddenElms = [];\r\n\r\n    var opts = options || {};\r\n    self._dialogDiv = TC.Util.getDiv(opts.dialogDiv);\r\n    if (window.$) {\r\n        self._$dialogDiv = $(self._dialogDiv);\r\n    }\r\n    if (!opts.dialogDiv) {\r\n        document.body.appendChild(self._dialogDiv);\r\n    }    \r\n};\r\n\r\nTC.inherit(TC.control.Download, TC.control.MapInfo);\r\n\r\n(function () {\r\n    var ctlProto = TC.control.Download.prototype;\r\n\r\n    ctlProto.CLASS = 'tc-ctl-download';\r\n\r\n    ctlProto.template = {};\r\n    ctlProto.template[ctlProto.CLASS] = TC.apiLocation + \"TC/templates/tc-ctl-download.hbs\";\r\n    ctlProto.template[ctlProto.CLASS + '-dialog'] = TC.apiLocation + \"TC/templates/tc-ctl-download-dialog.hbs\";\r\n\r\n    ctlProto.render = function (callback) {\r\n        const self = this;\r\n        return self.getRenderedHtml(self.CLASS + '-dialog', null, function (html) {\r\n            self._dialogDiv.innerHTML = html;\r\n        }).then(function () {\r\n            return TC.Control.prototype.renderData.call(self, { controlId: self.id }, function () {\r\n\r\n                const cs = '.tc-ctl-tctr';\r\n                self._selectors = {\r\n                    TAB: cs + '-tab',\r\n                    RADIOBUTTON: `input[type=radio][name=\"${self.id}-sel\"]`,\r\n                    ELEMENT: cs + '-elm'\r\n                };\r\n\r\n                const clickHandler = function (e) {\r\n                    var tab = this;\r\n                    while (tab && !tab.matches(self._selectors.TAB)) {\r\n                        tab = tab.parentElement;\r\n                    }\r\n                    if (tab) {\r\n                        const checkbox = tab.querySelector(self._selectors.RADIOBUTTON);\r\n                        const newValue = checkbox.value;\r\n                        const elms = self.div.querySelectorAll(self._selectors.ELEMENT);\r\n                        if (self._oldValue === newValue && self.options.deselectable) {\r\n                            setTimeout(function () {\r\n                                checkbox.checked = false;\r\n                            }, 0);\r\n                            self._oldValue = null;\r\n                            self._activeElm = null;\r\n                            elms.forEach(function (elm) {\r\n                                self._hiddenElms.push(elm);\r\n                            });\r\n                        }\r\n                        else {\r\n                            elms.forEach(function (elm) {\r\n                                if (elm.matches(self._selectors.ELEMENT + '-' + newValue)) {\r\n                                    self._activeElm = elm;\r\n                                }\r\n                                else {\r\n                                    self._hiddenElms.push(elm);\r\n                                }\r\n                            });\r\n                            self._oldValue = newValue;\r\n                        }\r\n\r\n                        self._hiddenElms.forEach(function (elm) {\r\n                            elm.classList.add(TC.Consts.classes.COLLAPSED);\r\n                        });\r\n                        if (self._activeElm) {\r\n                            self._activeElm.classList.remove(TC.Consts.classes.COLLAPSED);\r\n                        }\r\n                        checkbox.checked = true;\r\n                    }\r\n                };\r\n\r\n                self.div.querySelectorAll('span').forEach(function (span) {\r\n                    span.addEventListener(TC.Consts.event.CLICK, clickHandler, { passive: true });\r\n                });\r\n                if (callback) {\r\n                    callback();\r\n                }\r\n            });\r\n        });\r\n    };\r\n\r\n    const toFixed = function (number) {\r\n        let result = number.toFixed(20);\r\n        if (result.indexOf('.') >= 0) {\r\n            result = result.replace(/0+$/, '').replace(/\\.$/, '');\r\n        }\r\n        return result;\r\n    };\r\n\r\n    ctlProto.register = function (map) {\r\n        var self = this;\r\n        const result = TC.control.MapInfo.prototype.register.call(self, map);\r\n\r\n        // GLS: Añado el flag al mapa para tenerlo en cuenta cuando se establece la función de carga de imágenes\r\n        self.map.mustBeExportable = true;\r\n\r\n        const downLoadImage = function (format) {\r\n            const li = self.map.getLoadingIndicator();\r\n            const wait = li && li.addWait();\r\n            const extent = self.map.getExtent();\r\n            const doneQR = new Promise(function (resolve, reject) {\r\n                var canvas = self.map.wrap.getViewport({ synchronous: true }).getElementsByTagName('canvas')[0];\r\n                var newCanvas = TC.Util.cloneCanvas(canvas);\r\n\r\n                var sb = self.map.getControlsByClass(TC.control.ScaleBar);\r\n                if (sb) {\r\n                    self.drawScaleBarIntoCanvas({ canvas: newCanvas, fill: true });\r\n                }\r\n\r\n                if (!self._activeElm.querySelector(`#${self.CLASS}-image-qr-${self.id}:disabled`) && self._activeElm.querySelector(`#${self.CLASS}-image-qr-${self.id}:checked`)) {\r\n                    const codeContainerId = 'qrcode';\r\n                    var codeContainer = document.getElementById(codeContainerId);\r\n                    if (codeContainer) {\r\n                        codeContainer.innerHTML = '';\r\n                    }\r\n                    else {\r\n                        codeContainer = document.createElement('div');\r\n                        codeContainer.setAttribute('id', codeContainerId);\r\n                        document.body.appendChild(codeContainer);\r\n                    }\r\n\r\n                    codeContainer.style.top = '-200px';\r\n                    codeContainer.style.left = '-200px';\r\n                    codeContainer.style.position = 'absolute';\r\n\r\n                    self.makeQRCode(codeContainer, 87, 87).then(function (qrCodeBase64) {\r\n                        if (qrCodeBase64) {\r\n                            var ctx = newCanvas.getContext(\"2d\");\r\n                            ctx.fillStyle = \"#ffffff\";\r\n                            ctx.fillRect(newCanvas.width - 91, newCanvas.height - 91, 91, 91);\r\n\r\n                            TC.Util.addToCanvas(newCanvas, qrCodeBase64, { x: newCanvas.width - 88, y: newCanvas.height - 88 }).then(function (mapCanvas) {\r\n                                resolve(mapCanvas);\r\n                            });\r\n                        } else {                            \r\n                            li && li.removeWait(wait);\r\n                        }\r\n                    });\r\n                } else {\r\n                    resolve(newCanvas);\r\n                }\r\n            });\r\n\r\n            doneQR.then(function (_canvas) {\r\n                const fileName = window.location.hostname + '_' + self.map.crs.replace(':', '') + '_' + TC.Util.getFormattedDate(new Date().toString(), true);\r\n                const fileExtension = '.' + format.split('/')[1];\r\n                const worldFileExtension = format === TC.Consts.mimeType.JPEG ? '.jgw' : '.pgw';\r\n                if (self._activeElm.querySelector(`#${self.CLASS}-image-wld-${self.id}:checked`)) {\r\n                    TC.loadJS(!window.JSZip, TC.apiLocation + 'lib/jszip/jszip', function () {\r\n                        const xScale = (extent[2] - extent[0]) / _canvas.width;\r\n                        const ySkew = 0;\r\n                        const xSkew = 0;\r\n                        const yScale = (extent[1] - extent[3]) / _canvas.height;\r\n                        const xOrigin = extent[0];\r\n                        const yOrigin = extent[3];\r\n                        const zip = new JSZip();\r\n                        _canvas.toBlob(function (blob) {\r\n                            zip.file(fileName + fileExtension, blob);\r\n                            zip.file(fileName + worldFileExtension, `${toFixed(xScale)}\r\n${ySkew.toFixed(1)}\r\n${xSkew.toFixed(1)}\r\n${toFixed(yScale)}\r\n${toFixed(xOrigin)}\r\n${toFixed(yOrigin)}`);\r\n                            zip.generateAsync({ type: \"blob\" }).then(function (blob) {\r\n                                TC.Util.downloadBlob(fileName + \".zip\", blob);\r\n                                li && li.removeWait(wait);\r\n                            }, function (err) {\r\n                                TC.error(self.getLocaleString('dl.export.map.error') + ': ' + err.message);\r\n                                li && li.removeWait(wait);\r\n                            });\r\n                        }, format);\r\n                    });\r\n                }\r\n                else {\r\n                    try {\r\n                        const res = _canvas.toDataURL(format);\r\n                        TC.Util.downloadDataURI(fileName + fileExtension, format, res);\r\n                    } catch (e) {\r\n                        TC.error(self.getLocaleString('dl.export.map.error') + ': ' + e.message);\r\n                    }\r\n                    li && li.removeWait(wait);\r\n                }\r\n            });\r\n        };\r\n\r\n\r\n        /**\r\n         * Descarga las features de las capas de trabajo actualmente seleccionadas. Comprueba que el número de features a descargar\r\n         * no excede el límite impuesto por el servidor.\r\n         */\r\n\r\n        const downloadFeatures = function (format) {\r\n            const li = self.map.getLoadingIndicator();\r\n            const wait = li && li.addWait();\r\n\r\n            const arrPromises = self.map.extractFeatures({\r\n                filter: TC.filter.bbox(self.map.getExtent(), self.map.getCRS()),\r\n                outputFormat: format,\r\n                download: true\r\n            });\r\n            Promise.all(arrPromises).then(async function (responseArray) {\r\n\r\n                var responses = responseArray.filter(function (item) { return item != null });\r\n                if (responses.length === 0) {\r\n                    _showAlertMsg({ key: TC.Consts.WFSErrors.NO_LAYERS }, wait);\r\n                    return;\r\n                }\r\n                var arrDownloads = [];\r\n                for (var i = 0; i < responses.length; i++) {\r\n                    //errores del WFS\r\n                    if (responses[i].errors && responses[i].errors.length) {\r\n                        for (var j = 0; j < responses[i].errors.length; j++) {\r\n                            var error = responses[i].errors[j];\r\n                            _showAlertMsg(error, wait);\r\n                        }\r\n                        continue;\r\n                    }\r\n                    var data = responses[i].data;\r\n                    var url = responses[i].url;\r\n                    if (data && url)\r\n                        arrDownloads.push({ url: url + \"?download=zip\", data: data });\r\n                }\r\n                try {\r\n                    await TC.Util.downloadFileForm(arrDownloads);\r\n                }\r\n                catch (err) {\r\n                    if (err.key === TC.Consts.DownloadError.MIMETYPE_NOT_SUPORTED) {\r\n                        const service = responseArray.find(function (response) { return response.data === err.data }).service;\r\n                        const params = {\r\n                            plural: service.layers.length > 1 ? self.getLocaleString(\"dl.format.notSupported.plural\") : \"\",\r\n                            layerNames: service.layers.reduce(function (vi, va, i, array) {\r\n                                return (vi instanceof Array ? vi : [vi]).concat([va.title]).join(i < array.length - 1 ? \", \" : \" \" + self.getLocaleString(\"dl.format.notSupported.conjunction\") + \" \")\r\n                            }, []),\r\n                            serviceTitle: service.mapLayers[0].title,\r\n                            format: format\r\n                        }\r\n                        self.map.toast(self.getLocaleString(\"dl.format.notSupported\").format(params), { type: TC.Consts.msgType.ERROR });\r\n                    }\r\n                }\r\n\r\n                li && li.removeWait(wait);\r\n            });\r\n        };\r\n\r\n        var _download = function () {\r\n            var format = '';\r\n            if (self._activeElm) {\r\n                format = self._activeElm.querySelector('select').value;\r\n            }\r\n            if (format.indexOf('image') > -1) {\r\n                downLoadImage(format);\r\n            }\r\n            else {\r\n                downloadFeatures(format);\r\n            }\r\n        };\r\n\r\n        var _showAlertMsg = function (error, wait) {\r\n            const alert = self.div.querySelector('.alert-warning:not(.' + self.CLASS + '-alert)');\r\n            var errorMsg;\r\n            switch (error.key) {\r\n                case TC.Consts.WFSErrors.MAX_NUM_FEATURES:\r\n                    errorMsg = alert.querySelector(\"#zoom-msg-\" + self.id).innerHTML.format({ serviceName: error.params.serviceTitle });\r\n                    break;\r\n                case TC.Consts.WFSErrors.NO_LAYERS:\r\n                    errorMsg = self.getLocaleString('noLayersLoaded');\r\n                    break;\r\n                case TC.Consts.WFSErrors.GETCAPABILITIES:\r\n                    errorMsg = alert.querySelector(\"#novalid-msg-\" + self.id).innerHTML.format({ serviceName: error.params.serviceTitle });\r\n                    break;\r\n                case TC.Consts.WFSErrors.NO_FEATURES:\r\n                    errorMsg = alert.querySelector(\"#noFeatures-msg-\" + self.id).innerHTML;\r\n                    break;\r\n                case TC.Consts.WFSErrors.INDETERMINATE:\r\n                    errorMsg = self.getLocaleString(\"wfs.IndeterminateError\");\r\n                    self.map.toast(errorMsg, { type: TC.Consts.msgType.ERROR });\r\n                    TC.error(\"Error:{error} \\r\\n Descripcion:{descripcion} \\r\\n Servicio:{serviceName}\".format({ error: error.params.err, descripcion: error.params.errorThrown, serviceName: error.params.serviceTitle }), TC.Consts.msgErrorMode.CONSOLE);\r\n                    self.map.getLoadingIndicator().removeWait(wait);\r\n                    return\r\n                    break;\r\n                default:\r\n                    errorMsg = self.getLocaleString(\"wfs.\" + error.key, error.params);\r\n                    break;\r\n            }\r\n            self.map.toast(errorMsg, { type: TC.Consts.msgType.WARNING });\r\n\r\n            self.map.getLoadingIndicator().removeWait(wait);\r\n        };\r\n\r\n        var _showHelp = function (evt) {\r\n            evt.stopPropagation();\r\n            TC.Util.showModal(self._dialogDiv.querySelector(self._classSelector + '-help-dialog'));\r\n        };\r\n\r\n        self.div.addEventListener(TC.Consts.event.CLICK, TC.EventTarget.listenerBySelector('.tc-ctl-download-btn', _download), { passive: true });\r\n        self.div.addEventListener(TC.Consts.event.CLICK, TC.EventTarget.listenerBySelector('.tc-ctl-download-help', _showHelp), { passive: true });\r\n\r\n        self.div.addEventListener('change', TC.EventTarget.listenerBySelector(`#${self.CLASS}-image-qr-${self.id}`, function (e) {\r\n            if (e.target.checked) {\r\n                self.generateLink();\r\n            } else {\r\n                self.div.querySelector('.' + self.CLASS + '-alert').classList.add(TC.Consts.classes.HIDDEN);\r\n            }\r\n        }));\r\n\r\n        self.div.addEventListener('click', TC.EventTarget.listenerBySelector('h2', function (evt) {            \r\n            if (!self.registeredListeners) {\r\n                self.generateLink();\r\n            }\r\n            self.registerListeners();\r\n        }));\r\n\r\n        return result;\r\n    };\r\n\r\n    ctlProto.manageMaxLengthExceed = function (maxLengthExceed) {\r\n        const self = this;\r\n        const alert = self.div.querySelector('.' + self.CLASS + '-alert');\r\n        const checkboxQR = document.getElementById(`${self.CLASS}-image-qr-${self.id}`);\r\n\r\n        checkboxQR.disabled = maxLengthExceed.qr;\r\n\r\n        if (checkboxQR.checked) {\r\n            alert.classList.toggle(TC.Consts.classes.HIDDEN, !maxLengthExceed.qr);\r\n        } else {\r\n            alert.classList.add(TC.Consts.classes.HIDDEN);\r\n        }\r\n    };\r\n\r\n    ctlProto.generateLink = async function () {\r\n        const self = this;\r\n        const checkbox = self.div.querySelector(`.${self.CLASS}-div input[id|=\"${self.CLASS}-image-qr-download\"]`);\r\n        const label = self.div.querySelector(`label[for=\"${checkbox.id}\"]`);\r\n        checkbox.disabled = true;\r\n        label.classList.add(TC.Consts.classes.LOADING);\r\n        const result = await TC.control.MapInfo.prototype.generateLink.call(self);\r\n        label.classList.remove(TC.Consts.classes.LOADING);\r\n        return result;\r\n    };\r\n\r\n})();\r\n"]}