{"version":3,"sources":["control/Draw.js"],"names":["TC","control","Control","syncLoadJS","apiLocation","Feature","feature","Point","Polyline","Polygon","Consts","event","DRAWSTART","DRAWEND","DRAWCANCEL","DRAWUNDO","DRAWREDO","POINT","MEASURE","MEASUREPARTIAL","STYLECHANGE","CHANGE","formatColor","color","match","length","Draw","self","this","apply","arguments","browserFeatures","inputTypeColor","window","CP","loadCSS","_classSelector","CLASS","_pointClass","_lineClass","_polygonClass","history","historyIndex","exportsState","on","e","resetValues","layer","persistent","features","clearFeatures","point","setDrawState","setFeatureAddReadyState","setId","getUID","getLocaleString","callback","_layerPromise","inherit","ctlProto","prototype","ctl","_endBtn","disabled","mode","geom","POLYGON","POLYLINE","_redoBtn","_undoBtn","_cancelBtn","template","1","container","depth0","helpers","partials","data","alias1","nullContext","alias2","escapeExpression","alias3","lambda","lookupProperty","parent","propertyName","Object","hasOwnProperty","call","name","hash","loc","start","line","column","end","compiler","main","stack1","fn","program","inverse","noop","useData","render","strToolTip","strokeColor","strokeWidth","options","MULTIPOLYLINE","div","classList","add","styles","MULTIPOLYGON","polygon","MULTIPOINT","renderObject","tooltip","styling","_set1stRenderPromise","renderData","input","querySelector","style","backgroundColor","value","picker","document","body","onclick","preventDefault","onfocus","blur","onchange","map","loaded","setStrokeColor","reset","measure","_cancelClick","Util","isFunction","undefined","wrap","_newBtn","addEventListener","CLICK","new","passive","cancel","undo","redo","_strokeColorPicker","target","_strokeWidthSelector","setStrokeWidth","_strokeWidthWatch","register","extend","result","VIEWCHANGE","view","PRINTING","PROJECTIONCHANGE","forEach","idx","arr","reproject","oldCrs","newCrs","Promise","resolve","reject","setLayer","addLayer","id","title","stealth","owner","type","layerType","VECTOR","then","putLayerOnTop","setMode","trigger","ctrl","activate","classes","ACTIVE","remove","deactivate","clear","clearFatures","isExclusive","setStyle","isActive","getModeStyle","setStrokeColorWatch","property","setStrokeWidthWatch","width","parseInt","Number","NaN","borderBottomWidth","getLayer","layerStyles","Cfg","exportState","importState","state"],"mappings":"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","sourcesContent":["TC.control = TC.control || {};\r\n\r\nif (!TC.Control) {\r\n    TC.syncLoadJS(TC.apiLocation + 'TC/Control');\r\n}\r\nif (!TC.Feature || !TC.feature.Point) {\r\n    TC.syncLoadJS(TC.apiLocation + 'TC/feature/Point');\r\n}\r\nif (!TC.Feature || !TC.feature.Polyline) {\r\n    TC.syncLoadJS(TC.apiLocation + 'TC/feature/Polyline');\r\n}\r\nif (!TC.Feature || !TC.feature.Polygon) {\r\n    TC.syncLoadJS(TC.apiLocation + 'TC/feature/Polygon');\r\n}\r\n\r\nTC.Consts.event.DRAWSTART = 'drawstart.tc';\r\nTC.Consts.event.DRAWEND = 'drawend.tc';\r\nTC.Consts.event.DRAWCANCEL = 'drawcancel.tc';\r\nTC.Consts.event.DRAWUNDO = 'drawundo.tc';\r\nTC.Consts.event.DRAWREDO = 'drawredo.tc';\r\nTC.Consts.event.POINT = 'point.tc';\r\nTC.Consts.event.MEASURE = 'measure.tc';\r\nTC.Consts.event.MEASUREPARTIAL = 'measurepartial.tc';\r\nTC.Consts.event.STYLECHANGE = 'stylechange.tc';\r\nTC.Consts.event.CHANGE = 'change';\r\n\r\n(function () {\r\n\r\n    const formatColor = function (color) {\r\n        const match = color.match(/^#([0-9a-f])([0-9a-f])([0-9a-f])$/i);\r\n        if (match && match.length) {\r\n            return '#' + match[1] + match[1] + match[2] + match[2] + match[3] + match[3];\r\n        }\r\n        return color;\r\n    };\r\n\r\n    TC.control.Draw = function () {\r\n        var self = this;\r\n\r\n        TC.Control.apply(self, arguments);\r\n\r\n        if (!TC.browserFeatures.inputTypeColor() && !window.CP) {\r\n            TC.loadCSS(TC.apiLocation + 'lib/color-picker/color-picker.min.css');\r\n            TC.syncLoadJS(TC.apiLocation + 'lib/color-picker/color-picker.min.js');\r\n        }\r\n\r\n        self._classSelector = '.' + self.CLASS;\r\n\r\n        self._pointClass = self.CLASS + '-point';\r\n        self._lineClass = self.CLASS + '-line';\r\n        self._polygonClass = self.CLASS + '-polygon';\r\n\r\n        self.history = [];\r\n        self.historyIndex = 0;\r\n        self.exportsState = true;\r\n\r\n        self\r\n            .on(TC.Consts.event.DRAWSTART, function (e) {\r\n                self.resetValues();\r\n            })\r\n            .on(TC.Consts.event.POINT, function (e) {\r\n                if (self.layer && !self.persistent && self.layer.features && self.layer.features.length > 0) {\r\n                    self.layer.clearFeatures();\r\n                }\r\n\r\n                self.history.length = self.historyIndex;\r\n                self.history[self.historyIndex++] = e.point;\r\n\r\n                setDrawState(self);\r\n            })\r\n            .on(TC.Consts.event.DRAWEND, function (e) {\r\n                setFeatureAddReadyState(self);\r\n\r\n                e.feature.setId(TC.getUID(self.getLocaleString('sketch') + '.'));\r\n\r\n                if (self.callback) {\r\n                    self.callback(e.feature);\r\n                }\r\n            });\r\n\r\n        self._layerPromise = null;\r\n    };\r\n\r\n    TC.inherit(TC.control.Draw, TC.Control);\r\n\r\n    var ctlProto = TC.control.Draw.prototype;\r\n\r\n    ctlProto.CLASS = 'tc-ctl-draw';\r\n\r\n    var setDrawState = function (ctl) {\r\n        ctl._endBtn.disabled =\r\n            ctl.historyIndex === 0 ||\r\n            (ctl.mode === TC.Consts.geom.POLYGON && ctl.historyIndex < 3) ||\r\n            (ctl.mode === TC.Consts.geom.POLYLINE && ctl.historyIndex < 2);\r\n        ctl._redoBtn.disabled = ctl.history.length === ctl.historyIndex;\r\n        ctl._undoBtn.disabled = ctl.historyIndex === 0;\r\n    };\r\n\r\n    var setFeatureAddReadyState = function (ctl) {\r\n        ctl.resetValues();\r\n        ctl._endBtn.disabled = true;\r\n        ctl._cancelBtn.disabled = false;\r\n    };\r\n\r\n    ctlProto.template = TC.apiLocation + \"TC/templates/tc-ctl-draw.hbs\";\r\n\r\n    ctlProto.render = function (callback) {\r\n        const self = this;\r\n        let strToolTip;\r\n        let strokeColor;\r\n        let strokeWidth;\r\n        switch (self.options.mode) {\r\n            case TC.Consts.geom.POLYLINE:\r\n            case TC.Consts.geom.MULTIPOLYLINE:\r\n                strToolTip = self.getLocaleString('drawLine');\r\n                self.div.classList.add(self._lineClass);\r\n                strokeColor = self.styles.line.strokeColor;\r\n                strokeWidth = self.styles.line.strokeWidth;\r\n                break;\r\n            case TC.Consts.geom.POLYGON:\r\n            case TC.Consts.geom.MULTIPOLYGON:\r\n                strToolTip = self.getLocaleString('drawPolygon');\r\n                self.div.classList.add(self._polygonClass);\r\n                strokeColor = self.styles.polygon.strokeColor;\r\n                strokeWidth = self.styles.polygon.strokeWidth;\r\n                break;\r\n            case TC.Consts.geom.POINT:\r\n            case TC.Consts.geom.MULTIPOINT:\r\n                strToolTip = self.getLocaleString('drawPoint');\r\n                self.div.classList.add(self._pointClass);\r\n                strokeColor = self.styles.point.strokeColor;\r\n                strokeWidth = self.styles.point.strokeWidth;\r\n                break;\r\n            default:\r\n                strToolTip = self.getLocaleString('draw');\r\n                strokeColor = self.styles.line.strokeColor;\r\n                strokeWidth = self.styles.line.strokeWidth;\r\n                break;\r\n        }\r\n        const renderObject = {\r\n            tooltip: strToolTip,\r\n            strokeColor: formatColor(strokeColor),\r\n            strokeWidth: strokeWidth,\r\n            styling: self.options.styling\r\n        };\r\n        return self._set1stRenderPromise(self.renderData(renderObject, function () {\r\n            if (!TC.browserFeatures.inputTypeColor()) {\r\n                // El navegador no soporta input[type=color], usamos polyfill\r\n                const input = self.div.querySelector('input[type=color]');\r\n                if (input) {\r\n                    input.style.backgroundColor = input.value;\r\n                    input.style.color = 'transparent';\r\n                    const picker = new CP(input, 'click', document.body);\r\n\r\n                    input.onclick = function (e) {\r\n                        e.preventDefault();\r\n                    };\r\n\r\n                    // Evitamos que salga el teclado virtual en iOS\r\n                    input.onfocus = function (e) {\r\n                        this.blur();\r\n                    };\r\n\r\n                    input.onchange = function (e) {\r\n                        this.style.backgroundColor = this.value;\r\n                    };\r\n\r\n                    self.map.loaded(function () {\r\n                        picker.on(\"change\", function (color) {\r\n                            self.setStrokeColor('#' + color);\r\n                        });\r\n                    });\r\n                }\r\n            }\r\n            self.reset = true;\r\n            self.callback = null;\r\n            self.measure = false;\r\n            self._cancelClick = false;\r\n\r\n            self.mode = self.options.mode || TC.Consts.geom.POLYLINE;\r\n\r\n            if (self.options.measure)\r\n                self.measure = self.options.measure\r\n            if (TC.Util.isFunction(self.options.callback))\r\n                self.callback = self.options.callback;\r\n            if (self.options.persistent === undefined) {\r\n                self.persistent = true;\r\n            }\r\n            else {\r\n                self.persistent = self.options.persistent;\r\n            }\r\n\r\n            self.wrap = new TC.wrap.control.Draw(self);\r\n\r\n            self._newBtn = self.div.querySelector(self._classSelector + '-btn-new');\r\n            self._newBtn.addEventListener(TC.Consts.event.CLICK, function () {\r\n                self.new();\r\n            }, { passive: true });\r\n\r\n            self._cancelBtn = self.div.querySelector(self._classSelector + '-btn-cancel');\r\n            self._cancelBtn.addEventListener(TC.Consts.event.CLICK, function () {\r\n                self.cancel();\r\n            }, { passive: true });\r\n\r\n            self._endBtn = self.div.querySelector(self._classSelector + '-btn-end');\r\n            self._endBtn.addEventListener(TC.Consts.event.CLICK, function () {\r\n                self.end();\r\n            }, { passive: true });\r\n\r\n            self._undoBtn = self.div.querySelector(self._classSelector + '-btn-undo');\r\n            self._undoBtn.addEventListener(TC.Consts.event.CLICK, function () {\r\n                self.undo();\r\n            }, { passive: true });\r\n\r\n            self._redoBtn = self.div.querySelector(self._classSelector + '-btn-redo');\r\n            self._redoBtn.addEventListener(TC.Consts.event.CLICK, function () {\r\n                self.redo();\r\n            }, { passive: true });\r\n\r\n            if (self.options.styling) {\r\n                self._strokeColorPicker = self.div.querySelector(self._classSelector + '-str-c');\r\n                self._strokeColorPicker.addEventListener(TC.Consts.event.CHANGE, function (e) {\r\n                    self.setStrokeColor(e.target.value);\r\n                });\r\n\r\n                self._strokeWidthSelector = self.div.querySelector(self._classSelector + '-str-w');\r\n                self._strokeWidthSelector.addEventListener(TC.Consts.event.CHANGE, function (e) {\r\n                    self.setStrokeWidth(e.target.value);\r\n                });\r\n                self._strokeWidthWatch = self.div.querySelector(self._classSelector + '-str-w-watch');\r\n            }\r\n\r\n            if (TC.Util.isFunction(callback)) {\r\n                callback();\r\n            }\r\n        }));\r\n    };\r\n\r\n    ctlProto.register = function (map) {\r\n        const self = this;\r\n        self.styles = TC.Util.extend(true, {}, map.options.styles, self.options.styles);\r\n        const result = TC.Control.prototype.register.call(self, map);\r\n\r\n        self.map\r\n            .on(TC.Consts.event.VIEWCHANGE, function () {\r\n                if (self.map.view === TC.Consts.view.PRINTING) {\r\n                    self.end();\r\n\r\n                    // No lanzo el evento porque da error al no llegar una feature\r\n                    // self.trigger(TC.Consts.event.DRAWEND);\r\n                }\r\n            })\r\n            .on(TC.Consts.event.PROJECTIONCHANGE, function (e) {\r\n                self.history.forEach(function (point, idx, arr) {\r\n                    arr[idx] = TC.Util.reproject(point, e.oldCrs, e.newCrs);\r\n                });\r\n            });\r\n\r\n        self._layerPromise = new Promise(function (resolve, reject) {\r\n            map.loaded(function () {\r\n                if (self.options.layer) {\r\n                    self.setLayer(self.options.layer);\r\n                    resolve(self.layer);\r\n                }\r\n                else {\r\n                    // Si self.options.layer === false se instancia el control sin capa asociada\r\n                    if (self.options.layer === false) {\r\n                        self.setLayer(null);\r\n                        resolve(null);\r\n                    }\r\n                    else {\r\n                        map.addLayer({\r\n                            id: self.getUID(),\r\n                            title: 'DrawControl',\r\n                            stealth: true,\r\n                            owner: self,\r\n                            type: TC.Consts.layerType.VECTOR,\r\n                            styles: {\r\n                                point: self.styles.point,\r\n                                line: self.styles.line,\r\n                                polygon: self.styles.polygon\r\n                            }\r\n                        }).then(function (layer) {\r\n                            map.putLayerOnTop(layer);\r\n                            self.setLayer(layer);\r\n                            resolve(self.layer);\r\n                        });\r\n                    }\r\n                }\r\n            });\r\n        });\r\n\r\n        return result;\r\n    };\r\n\r\n    ctlProto.new = function () {\r\n        var self = this;\r\n        if (self.layer && !self.persistent) {\r\n            self.layer.clearFeatures();\r\n        }\r\n        self._cancelBtn.disabled = false;\r\n        self.setMode(self.mode, true);\r\n        return self;\r\n    };\r\n\r\n    ctlProto.undo = function () {\r\n        var self = this;\r\n        var result = self.wrap.undo();\r\n        if (result) {\r\n            self.historyIndex--;\r\n            setDrawState(self);\r\n\r\n            if (self.historyIndex <= 0) {\r\n                self.resetValues();\r\n            }\r\n            self.trigger(TC.Consts.event.DRAWUNDO);\r\n        }\r\n\r\n        return result;\r\n    };\r\n\r\n    ctlProto.redo = function () {\r\n        var self = this;\r\n        var result = this.wrap.redo();\r\n        if (result) {\r\n            self.historyIndex++;\r\n            setDrawState(self);\r\n            self.trigger(TC.Consts.event.DRAWREDO);\r\n        }\r\n        return result;\r\n    };\r\n\r\n    ctlProto.cancel = function () {\r\n        var self = this;\r\n        self._cancelClick = true;\r\n        this.setMode(null, false);\r\n        self.resetValues();\r\n        setFeatureAddReadyState(self);\r\n        self._cancelBtn.disabled = true;\r\n        self.trigger(TC.Consts.event.DRAWCANCEL, { ctrl: self });\r\n        return self;\r\n    };\r\n\r\n    ctlProto.activate = function () {\r\n        var self = this;\r\n        self._newBtn.classList.add(TC.Consts.classes.ACTIVE);\r\n        self._cancelBtn.disabled = false;\r\n        TC.Control.prototype.activate.call(self);\r\n        self.wrap.activate(self.mode);\r\n        self.div.classList.remove(self._pointClass, self._lineClass, self._polygonClass);\r\n        switch (self.mode) {\r\n            case TC.Consts.geom.POINT:\r\n                self.div.classList.add(self._pointClass);\r\n                break;\r\n            case TC.Consts.geom.POLYLINE:\r\n                self.div.classList.add(self._lineClass);\r\n                break;\r\n            case TC.Consts.geom.POLYGON:\r\n                self.div.classList.add(self._polygonClass);\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n\r\n    };\r\n\r\n    ctlProto.deactivate = function () {\r\n        var self = this;\r\n        if (self._newBtn) {\r\n            self._newBtn.classList.remove(TC.Consts.classes.ACTIVE);\r\n        }\r\n        if (self._cancelBtn) {\r\n            self._cancelBtn.disabled = true;\r\n        }\r\n        TC.Control.prototype.deactivate.call(self, !self._cancelClick);\r\n        if (self.wrap) {\r\n            self.wrap.deactivate();\r\n        }\r\n        self.resetValues();\r\n        //self.trigger(TC.Consts.event.DRAWCANCEL, { ctrl: self });\r\n        self._cancelClick = false;\r\n    };\r\n\r\n    ctlProto.clear = function () {\r\n        const self = this;\r\n        if (self.layer) {\r\n            self.layer.clearFatures();\r\n        }\r\n        self.resetValues();\r\n        return self;\r\n    };\r\n\r\n    ctlProto.isExclusive = function () {\r\n        return true;\r\n    };\r\n\r\n    ctlProto.end = function () {\r\n        const self = this;\r\n        self.wrap.end();\r\n        self.resetValues();\r\n        return self;\r\n    };\r\n\r\n    ctlProto.setMode = function (mode, activate) {\r\n        const self = this;\r\n\r\n        if (mode)\r\n            self.mode = mode;\r\n\r\n        if (activate && mode) {\r\n            //if (self.layer) {\r\n                //self.layer.map.putLayerOnTop(self.layer);\r\n            //}\r\n            self.activate();\r\n        }\r\n        else {\r\n            self.deactivate();\r\n        }\r\n        return self;\r\n    };\r\n\r\n    ctlProto.setStyle = function (style) {\r\n        const self = this;\r\n        if (style) {\r\n            self.style = TC.Util.extend(self.style, style);\r\n        }\r\n        else {\r\n            switch (self.options.mode) {\r\n                case TC.Consts.geom.POLYLINE:\r\n                case TC.Consts.geom.MULTIPOLYLINE:\r\n                    style = { line: self.styles.line };\r\n                    break;\r\n                case TC.Consts.geom.POLYGON:\r\n                case TC.Consts.geom.MULTIPOLYGON:\r\n                    style = { polygon: self.styles.polygon };\r\n                    break;\r\n                case TC.Consts.geom.POINT:\r\n                case TC.Consts.geom.MULTIPOINT:\r\n                    style = { point: self.styles.point };\r\n                    break;\r\n                default:\r\n                    style = {};\r\n                    break;\r\n            }\r\n        }\r\n        if (self.isActive) {\r\n            self.wrap.setStyle(style);\r\n        }\r\n    };\r\n\r\n    ctlProto.getModeStyle = function(mode) {\r\n        const self = this;\r\n        mode = mode || self.options.mode;\r\n        switch (mode) {\r\n            case TC.Consts.geom.POLYLINE:\r\n            case TC.Consts.geom.MULTIPOLYLINE:\r\n                return self.styles.line;\r\n            case TC.Consts.geom.POLYGON:\r\n            case TC.Consts.geom.MULTIPOLYGON:\r\n                return self.styles.polygon;\r\n            case TC.Consts.geom.POINT:\r\n            case TC.Consts.geom.MULTIPOINT:\r\n                return self.styles.point;\r\n            default:\r\n                return null;\r\n                break;\r\n        }\r\n    };\r\n\r\n    ctlProto.setStrokeColorWatch = function (color) {\r\n        const self = this;\r\n        if (self.options.styling) {\r\n            if (color === undefined) {\r\n                color = self.getModeStyle().strokeColor;\r\n            }\r\n            const match = color.match(/^#([0-9a-f])([0-9a-f])([0-9a-f])$/i);\r\n            if (match && match.length) {\r\n                color = '#' + match[1] + match[1] + match[2] + match[2] + match[3] + match[3];\r\n            }\r\n            self._strokeColorPicker.value = color;\r\n            if (!TC.browserFeatures.inputTypeColor()) {\r\n                const input = self._strokeColorPicker;\r\n                input.style.backgroundColor = color;\r\n                input.blur();\r\n            }\r\n        }\r\n        return self;\r\n    };\r\n\r\n    ctlProto.setStrokeColor = function (color) {\r\n        const self = this;\r\n        const style = self.getModeStyle();\r\n        if (style) {\r\n            style.strokeColor = color;\r\n        }\r\n\r\n        // Resetea el estilo\r\n        if (self.isActive) {\r\n            self.setStyle();\r\n        }\r\n\r\n        self.setStrokeColorWatch(color);\r\n        self.trigger(TC.Consts.event.STYLECHANGE, { property: 'strokeColor', value: color });\r\n        return self;\r\n    };\r\n\r\n    ctlProto.setStrokeWidthWatch = function (width) {\r\n        const self = this;\r\n        if (self.options.styling) {\r\n            if (width === undefined) {\r\n                width = self.getModeStyle().strokeWidth;\r\n            }\r\n            width = parseInt(width, 10);\r\n            if (width !== Number.NaN) {\r\n                self._strokeWidthSelector.value = width;\r\n                self._strokeWidthWatch.style.borderBottomWidth = width + 'px';\r\n            }\r\n        }\r\n        return self;\r\n    };\r\n\r\n    ctlProto.setStrokeWidth = function(width) {\r\n        const self = this;\r\n        width = parseInt(width, 10);\r\n        if (width !== Number.NaN) {\r\n            const style = self.getModeStyle();\r\n            if (style) {\r\n                style.strokeWidth = width;\r\n            }\r\n\r\n            // Resetea el estilo\r\n            if (self.isActive) {\r\n                self.setStyle();\r\n            }\r\n\r\n            self.setStrokeWidthWatch(width);\r\n            self.trigger(TC.Consts.event.STYLECHANGE, { property: 'strokeWidth', value: width });\r\n        }\r\n        return self;\r\n    };\r\n\r\n    ctlProto.getLayer = function () {\r\n        const self = this;\r\n        if (self.layer) {\r\n            return Promise.resolve(self.layer);\r\n        }\r\n        return this._layerPromise;\r\n    };\r\n\r\n    ctlProto.setLayer = function (layer) {\r\n        const self = this;\r\n        if (self.map) {\r\n            if (typeof (layer) === \"string\") {\r\n                self.layer = self.map.getLayer(layer);\r\n            }\r\n            else {\r\n                self.layer = layer;\r\n            }\r\n\r\n            self.styles = {};\r\n            const layerStyles = (self.layer && self.layer.styles) || TC.Cfg.styles;\r\n            TC.Util.extend(true, self.styles, self.options.styles || layerStyles);\r\n\r\n        }\r\n    };\r\n\r\n    ctlProto.resetValues = function () {\r\n        const self = this;\r\n        self.history.length = 0;\r\n        self.historyIndex = 0;\r\n        setDrawState(self);\r\n        return self;\r\n    };\r\n\r\n    ctlProto.exportState = function () {\r\n        const self = this;\r\n        if (self.exportsState && self.layer) {\r\n            return {\r\n                id: self.id,\r\n                layer: self.layer.exportState()\r\n            };\r\n        }\r\n        return null;\r\n    };\r\n\r\n    ctlProto.importState = function (state) {\r\n        const self = this;\r\n        self.getLayer().then(function (layer) {\r\n            layer.importState(state.layer);\r\n        });\r\n    };\r\n})();"]}