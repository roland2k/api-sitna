{"version":3,"sources":["control/Legend.js"],"names":["TC","control","MapContents","syncLoadJS","apiLocation","Legend","apply","this","arguments","inherit","ctlProto","prototype","CLASS","template","1","container","depth0","helpers","partials","data","stack1","lookupProperty","parent","propertyName","Object","hasOwnProperty","call","invokePartial","name","indent","decorators","3","escapeExpression","nullContext","hash","loc","start","line","column","end","compiler","main","alias1","fn","program","inverse","usePartial","useData","lambda","alias2","alias3","noop","4","6","8","9","10","12","13","14","16","register","map","self","on","Consts","event","VIEWCHANGE","e","view","onLayerAdd","loadGraphics","bind","THREED","LAYERADD","DEFAULT","off","getLayerUIElements","forEach","li","layer","getLayer","dataset","layerId","querySelectorAll","l","img","querySelector","undefined","getAttribute","length","styleLegendImage","updateScale","inScale","outOfScale","layersInScale","lis","classList","contains","uid","layerUid","isVisibleByScale","remove","add","toggle","update","getTree","visible","notVisible","hasVisible","_cache","visibilityStates","visibility","NOT_VISIBLE","HAS_VISIBLE","updateLayerVisibility","updateLayerTree","isBase","options","stealth","hideTree","tree","div","classes","HIDDEN","getRenderedHtml","layerTrees","id","then","out","newLi","DOMParser","parseFromString","body","firstChild","ul","innerHTML","setAttribute","insertBefore","catch","err","error","removeLayer","getVisibility"],"mappings":"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","sourcesContent":["TC.control = TC.control || {};\r\n\r\nif (!TC.control.MapContents) {\r\n    TC.syncLoadJS(TC.apiLocation + 'TC/control/MapContents');\r\n}\r\n\r\nTC.control.Legend = function () {\r\n    TC.control.MapContents.apply(this, arguments);\r\n};\r\n\r\nTC.inherit(TC.control.Legend, TC.control.MapContents);\r\n\r\n(function () {\r\n    var ctlProto = TC.control.Legend.prototype;\r\n\r\n    ctlProto.CLASS = 'tc-ctl-legend';\r\n\r\n    ctlProto.template = {};\r\n    ctlProto.template[ctlProto.CLASS] = TC.apiLocation + \"TC/templates/tc-ctl-legend.hbs\";\r\n    ctlProto.template[ctlProto.CLASS + '-node'] = TC.apiLocation + \"TC/templates/tc-ctl-legend-node.hbs\";\r\n\r\n    ctlProto.register = function (map) {\r\n        const self = this;\r\n\r\n        map.on(TC.Consts.event.VIEWCHANGE, function (e) {\r\n            const view = e.view;\r\n            const onLayerAdd = self.loadGraphics.bind(self);\r\n\r\n            if (view === TC.Consts.view.THREED) {                \r\n                map.on(TC.Consts.event.LAYERADD, onLayerAdd);\r\n            } else if (view === TC.Consts.view.DEFAULT) {\r\n                map.off(TC.Consts.event.LAYERADD, onLayerAdd);\r\n            }\r\n        });\r\n\r\n        return TC.control.MapContents.prototype.register.call(self, map);\r\n    };\r\n\r\n    ctlProto.loadGraphics = function () {\r\n        const self = this;\r\n        self.getLayerUIElements().forEach(function (li) {\r\n            const layer = self.map.getLayer(li.dataset.layerId);\r\n            if (layer) {\r\n                li.querySelectorAll('li.' + self.CLASS + '-node-visible').forEach(function (l) {\r\n                    const img = l.querySelector('img');\r\n                    if (img && img.getAttribute('src') !== undefined && img.getAttribute('src').length === 0) {\r\n                        self.styleLegendImage(img, layer);\r\n                    }\r\n                });\r\n            }\r\n        });\r\n    };\r\n\r\n    ctlProto.updateScale = function () {\r\n        const self = this;\r\n        const inScale = self.CLASS + '-node-inscale';\r\n        const outOfScale = self.CLASS + '-node-outofscale';\r\n\r\n        self.getLayerUIElements().forEach(function (li) {\r\n            const layer = self.map.getLayer(li.dataset.layerId);\r\n\r\n            if (layer) {\r\n                let layersInScale = false;\r\n                const lis = li.querySelectorAll('li');\r\n                lis.forEach(function (l) {\r\n                    if (l.classList.contains(self.CLASS + '-node-visible')) {\r\n                        const uid = l.dataset.layerUid;\r\n                        if (layer.isVisibleByScale(uid)) {\r\n                            layersInScale = true;\r\n                            l.classList.remove(outOfScale);\r\n                            l.classList.add(inScale);\r\n                            const img = l.querySelector('img');\r\n                            if (img) {\r\n                                self.styleLegendImage(img, layer);\r\n                            }\r\n                        }\r\n                        else {\r\n                            l.classList.add(outOfScale);\r\n                            l.classList.remove(inScale);\r\n                        }\r\n                    }\r\n                });\r\n                layersInScale = layersInScale || !lis.length;\r\n                if (!lis.length) {\r\n                    const img = li.querySelector('img');\r\n                    if (img) {\r\n                        self.styleLegendImage(img);\r\n                    }\r\n                }\r\n                li.classList.toggle(inScale, layersInScale);\r\n                li.classList.toggle(outOfScale, !layersInScale);\r\n            }\r\n        });\r\n    };\r\n\r\n    ctlProto.update = function () {\r\n        const self = this;\r\n\r\n        self.getLayerUIElements().forEach(function (li) {\r\n            const layer = self.map.getLayer(li.dataset.layerId);\r\n            if (layer) {\r\n                layer.getTree();\r\n\r\n                li.querySelectorAll('li').forEach(function (l) {\r\n                    const uid = l.dataset.layerUid;\r\n                    var visible = self.CLASS + '-node-visible';\r\n                    var notVisible = self.CLASS + '-node-notvisible';\r\n                    var hasVisible = self.CLASS + '-node-hasvisible';\r\n\r\n                    switch (layer._cache.visibilityStates[uid]) {\r\n                        case TC.Consts.visibility.NOT_VISIBLE:\r\n                            l.classList.remove(visible, hasVisible);\r\n                            l.classList.add(notVisible);                            \r\n                            break;\r\n                        case TC.Consts.visibility.HAS_VISIBLE:\r\n                            l.classList.remove(visible, notVisible);\r\n                            l.classList.add(hasVisible);                            \r\n                            break;\r\n                        default:\r\n                            // visible\r\n                            l.classList.remove(notVisible, hasVisible);\r\n                            l.classList.add(visible);                            \r\n                            break;\r\n                    }\r\n                });\r\n\r\n                self.updateLayerVisibility(layer);\r\n            }\r\n        });\r\n        self.updateScale();\r\n    };\r\n\r\n    ctlProto.updateLayerTree = function (layer) {\r\n        var self = this;        \r\n\r\n        if (!layer.isBase && !layer.options.stealth) {\r\n            \r\n            //// 09/04/2019 GLS: ignoramos el atributo que venga en la capa porque en la leyenda queremos que el árbol se muestre siempre y \r\n            //// nos ahorramos el tener que pasarlo en el estado del mapa\r\n            if (layer.hideTree || layer.options.hideTree) {\r\n                layer.tree = null;\r\n                layer.hideTree = layer.options.hideTree = false;\r\n\r\n                layer._cache.visibilityStates = {};\r\n            }            \r\n\r\n            TC.control.MapContents.prototype.updateLayerTree.call(self, layer);\r\n\r\n            self.div.querySelector('.' + self.CLASS + '-empty').classList.add(TC.Consts.classes.HIDDEN);            \r\n\r\n            self.getRenderedHtml(self.CLASS + '-node', self.layerTrees[layer.id])\r\n                .then(function (out) {\r\n                    const parser = new DOMParser();\r\n                    const newLi = parser.parseFromString(out, 'text/html').body.firstChild;\r\n                    const uid = newLi.dataset.layerUid;\r\n                    const ul = self.div.querySelector('ul.' + self.CLASS + '-branch');\r\n                    const lis = ul.querySelectorAll('li[data-layer-uid=\"' + uid + '\"]');\r\n                    if (lis.length === 1) {\r\n                        const li = lis[0];\r\n                        li.innerHTML = newLi.innerHTML;\r\n                        li.setAttribute('class', newLi.getAttribute('class')); // Esto actualiza si un nodo deja de ser hoja o pasa a ser hoja\r\n                    }\r\n                    else {\r\n                        newLi.dataset.layerId = layer.id;\r\n                        ul.insertBefore(newLi, ul.firstChild);\r\n                    }\r\n\r\n                    self.update();\r\n                })\r\n                .catch(function (err) {\r\n                    TC.error(err);\r\n                });\r\n        }\r\n    };\r\n\r\n    ctlProto.removeLayer = function (layer) {\r\n        if (!layer.isBase) {\r\n            TC.control.MapContents.prototype.removeLayer.call(this, layer);\r\n        }\r\n    };\r\n\r\n    ctlProto.updateLayerVisibility = function (layer) {\r\n        var self = this;\r\n        self.getLayerUIElements().forEach(function (li) {\r\n            if (li.dataset.layerId === layer.id) {\r\n                li.classList.toggle(self.CLASS + '-node-notvisible', !layer.getVisibility());\r\n            }\r\n        });\r\n    };\r\n\r\n    ctlProto.getLayerUIElements = function () {\r\n        const self = this;\r\n        return self.div.querySelector('ul.' + self.CLASS + '-branch').querySelectorAll('li.' + self.CLASS + '-node');\r\n    };\r\n})();\r\n"]}