{"version":3,"sources":["control/Print.js"],"names":["TC","control","Consts","classes","PRINTABLE","Print","options","self","this","ready","title","Util","getLocaleString","Cfg","locale","cssUrl","apiLocation","target","printableElement","classList","add","render","inherit","Control","ctlProto","prototype","CLASS","template","compiler","main","container","depth0","helpers","partials","data","alias1","nullContext","alias2","escapeExpression","lookupProperty","parent","propertyName","Object","hasOwnProperty","call","name","hash","loc","start","line","column","end","useData","stack1","lambda","renderPrintPage","page","open","content","innerHTML","getRenderedHtml","then","out","document","write","close","focus","catch","err","error","getRenderTarget","div","addUIEventListeners","_mustAddListeners","btn","querySelector","addEventListener","e","renderData","callback","Promise","resolve","reject","insertAdjacentHTML","isFunction"],"mappings":"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","sourcesContent":["TC.control = TC.control || {};\r\n\r\nTC.Consts.classes.PRINTABLE = 'tc-printable';\r\n\r\nTC.control.Print = function (options)\r\n{\r\n    const self = this;\r\n    self.options = options || {};\r\n\r\n    self.ready = false;\r\n\r\n    self.title = self.options.title || TC.Util.getLocaleString(TC.Cfg.locale, 'printPage');\r\n    self.cssUrl = self.options.cssUrl || TC.apiLocation + 'TC/css/print.css';\r\n\r\n    if (self.options.target) {\r\n        (self.options.printableElement || self.options.target).classList.add(TC.Consts.classes.PRINTABLE);\r\n        self.render();\r\n    }\r\n};\r\n\r\nTC.inherit(TC.control.Print, TC.Control);\r\n\r\n(function () {\r\n    const ctlProto = TC.control.Print.prototype;\r\n\r\n    ctlProto.CLASS = 'tc-ctl-print';\r\n\r\n    ctlProto.template = {};\r\n    ctlProto.template[ctlProto.CLASS] = TC.apiLocation + \"TC/templates/tc-ctl-print.hbs\";\r\n    ctlProto.template[ctlProto.CLASS + '-page'] = TC.apiLocation + \"TC/templates/tc-ctl-print-page.hbs\";\r\n\r\n    ctlProto.renderPrintPage = function () {\r\n        const self = this;\r\n        const page = open(null, self.CLASS);\r\n        const content = (self.options.printableElement || self.options.target).innerHTML;\r\n        self.getRenderedHtml(self.CLASS + '-page', { title: self.title, content: content, cssUrl: self.cssUrl })\r\n            .then(function (out) {\r\n                page.document.write(out);\r\n                page.document.close();\r\n                page.focus();\r\n            })\r\n            .catch(function (err) {\r\n                TC.error(err);\r\n            });\r\n    };\r\n\r\n    ctlProto.getRenderTarget = function () {\r\n        const self = this;\r\n        return self.options.target || self.div;\r\n    };\r\n\r\n    ctlProto.addUIEventListeners = function () {\r\n        const self = this;\r\n        if (self._mustAddListeners) {\r\n            const target = self.getRenderTarget();\r\n            if (target) {\r\n                const btn = target.querySelector('.' + self.CLASS + '-btn');\r\n                if (btn) {\r\n                    btn.addEventListener('click', function (e) {\r\n                        self.renderPrintPage();\r\n                    });\r\n                    delete self._mustAddListeners;\r\n                }\r\n            }\r\n        }\r\n    };\r\n\r\n    ctlProto.renderData = function (data, callback) {\r\n        const self = this;\r\n        return new Promise(function (resolve, reject) {\r\n            if (self.div) {\r\n                TC.Control.prototype.renderData.call(self, data, callback)\r\n                    .then(() => resolve())\r\n                    .catch((e) => reject(e));\r\n            }\r\n            else {\r\n                const target = self.getRenderTarget();\r\n                if (target) {\r\n                    self.getRenderedHtml(self.CLASS, null).then(function (out) {\r\n                        if (!target.querySelector('.' + self.CLASS + '-btn')) {\r\n                            self._mustAddListeners = true;\r\n                            target.insertAdjacentHTML('beforeend', out);\r\n                        }\r\n                        if (TC.Util.isFunction(callback)) {\r\n                            callback();\r\n                        }\r\n                        resolve();\r\n                    });\r\n                }\r\n                else {\r\n                    if (TC.Util.isFunction(callback)) {\r\n                        callback();\r\n                    }\r\n                    resolve();\r\n                }\r\n            }\r\n        });\r\n    };\r\n\r\n})();"]}