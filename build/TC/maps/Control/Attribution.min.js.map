{"version":3,"sources":["control/Attribution.js"],"names":["TC","control","Control","syncLoadJS","apiLocation","Attribution","self","this","apply","arguments","apiAttribution","mainDataAttribution","dataAttributions","options","Array","inherit","ctlProto","prototype","CLASS","template","1","container","depth0","helpers","partials","data","stack1","alias1","nullContext","lookupProperty","parent","propertyName","Object","hasOwnProperty","call","escapeExpression","name","hash","loc","start","line","column","end","fn","program","inverse","2","lambda","alias2","4","noop","5","7","9","11","12","14","16","compiler","main","useData","register","map","result","attribution","addData","obj","attr","getAttribution","test","site","textExists","i","length","push","removeData","Layer","workLayers","_wl","slice","reverse","url","getVisibility","checkRemoveData","index","reduce","prev","cur","idx","checkIsSameAttribution","toCheckName","baseLayer","wrap","id","filter","layer","type","Consts","layerType","WMS","WMTS","some","workLayerAttribution","splice","loaded","render","on","event","LAYERADD","e","isBase","BEFOREBASELAYERCHANGE","OVERVIEWBASELAYERCHANGE","newLayer","oldLayer","indexOf","ignoreLayer","LAYERREMOVE","TERRAINPROVIDERADD","terrainProvider","TERRAINPROVIDERREMOVE","LAYERVISIBILITY","callback","_set1stRenderPromise","renderData","api","getLocaleString","mainData","otherData","isCollapsed","div","querySelector","classList","contains","classes","COLLAPSED","cmd","addEventListener","CLICK","toggleOtherAttributions","passive","toggle"],"mappings":"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","sourcesContent":["TC.control = TC.control || {};\r\n\r\nif (!TC.Control) {\r\n    TC.syncLoadJS(TC.apiLocation + 'TC/Control');\r\n}\r\n\r\nTC.control.Attribution = function () {\r\n    const self = this;\r\n\r\n    TC.Control.apply(self, arguments);\r\n\r\n    self.apiAttribution = '';\r\n    self.mainDataAttribution = null;\r\n    self.dataAttributions = [];\r\n    if (self.options.dataAttributions) {\r\n        self.dataAttributions = self.options.dataAttributions instanceof Array ? self.options.dataAttributions : [self.options.dataAttributions];\r\n    }\r\n};\r\n\r\nTC.inherit(TC.control.Attribution, TC.Control);\r\n\r\n(function () {\r\n    var ctlProto = TC.control.Attribution.prototype;\r\n\r\n    ctlProto.CLASS = 'tc-ctl-attrib';\r\n\r\n    ctlProto.template = TC.apiLocation + \"TC/templates/tc-ctl-attrib.hbs\";\r\n\r\n    ctlProto.register = function (map) {\r\n        const self = this;\r\n        const result = TC.Control.prototype.register.call(self, map);\r\n\r\n        self.apiAttribution = self.map.options.attribution || self.apiAttribution;\r\n\r\n        var addData = function (obj) {\r\n            if (obj) {\r\n                // TODO: sanitizer\r\n                var attr = obj.getAttribution();\r\n                if (attr) {\r\n                    if (/IDENA/.test(attr.name) || /Tracasa Instrumental/.test(attr.name)) {\r\n                        self.mainDataAttribution = {\r\n                            name: 'IDENA',\r\n                            site: 'https://idena.navarra.es/'\r\n                        };\r\n                    }\r\n                    else {\r\n                        var textExists = false;\r\n                        for (var i = 0; i < self.dataAttributions.length; i++) {\r\n                            if (attr.name === self.dataAttributions[i].name) {\r\n                                textExists = true;\r\n                                break;\r\n                            }\r\n                        }\r\n                        if (!textExists) {\r\n                            self.dataAttributions.push(attr);\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        };\r\n\r\n        var removeData = function (obj) {\r\n            if (obj) {\r\n\r\n                var checkRemoveData = function () {\r\n                    if (obj.map.workLayers.length > 0) {\r\n                        var _wl = obj.map.workLayers.slice().reverse();\r\n                        for (var i = 0; i < _wl.length; i++) {\r\n                            if (_wl[i].url == obj.url && _wl[i].getVisibility())\r\n                                return false;\r\n                        }\r\n\r\n                        return true;\r\n                    }\r\n\r\n                    return true;\r\n                };\r\n\r\n                if (obj instanceof TC.Layer ? checkRemoveData() : true) {\r\n                    // TODO: sanitizer\r\n                    var attr = obj.getAttribution();\r\n\r\n                    if (attr) {\r\n                        var index = self.dataAttributions.reduce(function (prev, cur, idx) {\r\n                            if (cur.name === attr.name) {\r\n                                return idx;\r\n                            }\r\n                            return prev;\r\n                        }, -1);\r\n\r\n                        const checkIsSameAttribution = function (toCheckName) {\r\n                            return (/IDENA/.test(attr.name) || /Tracasa Instrumental/.test(attr.name)) &&\r\n                                (/IDENA/.test(toCheckName) || /Tracasa Instrumental/.test(toCheckName)) ||\r\n                                    (attr.name === toCheckName);\r\n                        };\r\n\r\n                        // 07/10/2020 Validamos contra el mapa de fondo antes de cambiar de mapa de fondo así que no se borran cuando deberían.\r\n                        // Validamos que la capa a borrar no sea la de fondo actual\r\n                        // Validamos si las atribuciones a borrar son también del mapa base\r\n                        if (self.map.baseLayer && self.map.baseLayer.wrap.getAttribution() && checkIsSameAttribution(self.map.baseLayer.wrap.getAttribution().name) && \r\n                            obj.parent.id !== self.map.baseLayer.id) {\r\n                            return;\r\n                        } else {\r\n                            // Validamos si las atribuciones a borrar son también de alguna de las capas raster cargadas\r\n                            if (self.map.workLayers.filter(function (layer) {\r\n                                return layer.type === TC.Consts.layerType.WMS || layer.type === TC.Consts.layerType.WMTS;\r\n                            }).some(function (layer) {\r\n                                var workLayerAttribution = layer.wrap.getAttribution();\r\n                                return workLayerAttribution && checkIsSameAttribution(workLayerAttribution.name);\r\n                            })) {\r\n                                return;\r\n                            }\r\n                        }\r\n\r\n                        if (index > -1) {\r\n                            self.dataAttributions.splice(index, 1);\r\n                        } else if (/IDENA/.test(attr.name) || /Tracasa Instrumental/.test(attr.name)) {\r\n                            self.mainDataAttribution = null;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        };\r\n        //URI: Si las atribuciones están vacias evito hace una llamada al renderizado del control ya que lo obtendría sin datos.\r\n        //self.render();\r\n\r\n        map.loaded(function () {\r\n            if (map.baseLayer.wrap.getAttribution) {\r\n                addData(map.baseLayer.wrap);\r\n                self.render();\r\n            }\r\n        });\r\n\r\n        map.on(TC.Consts.event.LAYERADD, function (e) {\r\n            const layer = e.layer;\r\n            if (!layer.isBase && layer.wrap.getAttribution && layer.wrap.getAttribution()) {\r\n                addData(layer.wrap);\r\n                self.render();\r\n            }\r\n        });\r\n\r\n        map.on(TC.Consts.event.BEFOREBASELAYERCHANGE + \" \" + TC.Consts.event.OVERVIEWBASELAYERCHANGE, function (e) {\r\n            const type = e.type;\r\n            const newLayer = e.newLayer;\r\n            const oldLayer = e.oldLayer;\r\n            if (TC.Consts.event.OVERVIEWBASELAYERCHANGE.indexOf(type) > -1) {\r\n                self.ignoreLayer = newLayer;\r\n            }\r\n\r\n            if (oldLayer && oldLayer.wrap.getAttribution) {\r\n                removeData(oldLayer.wrap);\r\n            }\r\n\r\n            if (newLayer && newLayer.wrap.getAttribution) {\r\n                addData(newLayer.wrap);\r\n            }\r\n\r\n            self.render();\r\n        });\r\n\r\n        map.on(TC.Consts.event.LAYERREMOVE, function (e) {\r\n            const layer = e.layer;\r\n            if (layer.wrap.getAttribution) {\r\n                removeData(layer.wrap);\r\n                self.render();\r\n            }\r\n        });\r\n\r\n        map.on(TC.Consts.event.TERRAINPROVIDERADD, function (e) {\r\n            const terrainProvider = e.terrainProvider;\r\n            if (terrainProvider.getAttribution) {\r\n                addData(terrainProvider);\r\n                self.render();\r\n            }\r\n        });\r\n\r\n        map.on(TC.Consts.event.TERRAINPROVIDERREMOVE, function (e) {\r\n            const terrainProvider = e.terrainProvider;\r\n            if (terrainProvider.getAttribution) {\r\n                removeData(terrainProvider);\r\n                self.render();\r\n            }\r\n        });\r\n\r\n        map.on(TC.Consts.event.LAYERVISIBILITY, function (e) {\r\n            const layer = e.layer;\r\n            if (self.ignoreLayer === layer) {\r\n                return;\r\n            }\r\n\r\n            if (layer.wrap.getAttribution) {\r\n                if (layer.getVisibility()) {\r\n                    addData(layer.wrap);\r\n                } else {\r\n                    removeData(layer.wrap);\r\n                }\r\n                self.render();\r\n            }\r\n        });\r\n\r\n        return result;\r\n    };\r\n\r\n    ctlProto.render = function (callback) {\r\n        const self = this;        \r\n\r\n        return self._set1stRenderPromise(self.renderData({\r\n            api: (typeof (self.apiAttribution) === 'function' ? self.apiAttribution.apply(self) : self.getLocaleString(self.apiAttribution)),\r\n            mainData: self.mainDataAttribution,\r\n            otherData: self.dataAttributions,\r\n            isCollapsed: self.div.querySelector('.' + self.CLASS + '-other') ? self.div.querySelector('.' + self.CLASS + '-other').classList.contains(TC.Consts.classes.COLLAPSED) : true\r\n        }, function () {\r\n            const cmd = self.div.querySelector('.' + self.CLASS + '-cmd');\r\n            cmd && cmd.addEventListener(TC.Consts.event.CLICK, function () {\r\n                self.toggleOtherAttributions();\r\n            }, { passive: true });\r\n\r\n            if (typeof callback === 'function') {\r\n                callback();\r\n            }\r\n        }));\r\n    };\r\n\r\n    ctlProto.toggleOtherAttributions = function () {\r\n        const self = this;\r\n        const other = self.div.querySelector('.' + self.CLASS + '-other');\r\n        other.classList.toggle(TC.Consts.classes.COLLAPSED);\r\n    };\r\n})();\r\n"]}