{"version":3,"sources":["control/TOC.js"],"names":["TC","control","MapContents","syncLoadJS","apiLocation","TOC","apply","this","arguments","inherit","ctlProto","prototype","CLASS","template","1","container","depth0","helpers","partials","data","stack1","lookupProperty","parent","propertyName","Object","hasOwnProperty","call","invokePartial","name","indent","decorators","compiler","main","alias1","nullContext","alias2","escapeExpression","hash","loc","start","line","column","end","fn","program","inverse","noop","usePartial","useData","3","5","7","lambda","alias3","9","register","map","self","result","on","Consts","event","EXTERNALSERVICEADDED","e","onExternalServiceAdded","layer","addLayer","then","updateLayerTree","addUIEventListeners","div","addEventListener","EventTarget","listenerBySelector","checkbox","target","ul","matches","parentElement","lis","i","len","children","length","child","tagName","push","li","contains","getLayer","dataset","layerId","uid","layerUid","setNodeVisibility","checked","stopPropagation","MOUSEUP","blur","classList","toggle","classes","COLLAPSED","querySelector","update","_getCheckbox","getLayerUIElements","forEach","getVisibility","tree","querySelectorAll","l","getNodeVisibility","visibility","VISIBLE","NOT_VISIBLE_AT_RESOLUTION","indeterminate","HAS_VISIBLE","updateScale","elm","isVisibleByScale","isBase","options","stealth","add","HIDDEN","getRenderedHtml","layerTrees","id","out","newLi","DOMParser","parseFromString","body","firstChild","innerHTML","setAttribute","getAttribute","insertBefore","wl","branch","node","leaf","catch","err","error","removeLayer","updateLayerVisibility","isHidden","disabled","updateLayerOrder","oldIdx","newIdx","render","callback","Control","controlOptions","controls","ctl","newDiv","document","createElement","appendChild","addControl","Util","extend","isFunction"],"mappings":"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","sourcesContent":["TC.control = TC.control || {};\r\n\r\nif (!TC.control.MapContents) {\r\n    TC.syncLoadJS(TC.apiLocation + 'TC/control/MapContents');\r\n}\r\n\r\nTC.control.TOC = function () {\r\n    var self = this;\r\n\r\n    TC.control.MapContents.apply(self, arguments);\r\n};\r\n\r\nTC.inherit(TC.control.TOC, TC.control.MapContents);\r\n\r\n(function () {\r\n    var ctlProto = TC.control.TOC.prototype;\r\n\r\n    ctlProto.CLASS = 'tc-ctl-toc';\r\n\r\n    ctlProto.template = {};\r\n    ctlProto.template[ctlProto.CLASS] = TC.apiLocation + \"TC/templates/tc-ctl-toc.hbs\";\r\n    ctlProto.template[ctlProto.CLASS + '-branch'] = TC.apiLocation + \"TC/templates/tc-ctl-toc-branch.hbs\";\r\n    ctlProto.template[ctlProto.CLASS + '-node'] = TC.apiLocation + \"TC/templates/tc-ctl-toc-node.hbs\";\r\n\r\n    var CLICKEVENT = 'click';\r\n\r\n    ctlProto.register = function (map) {\r\n        const self = this;\r\n        const result = TC.control.MapContents.prototype.register.call(self, map);\r\n\r\n        map.on(TC.Consts.event.EXTERNALSERVICEADDED, function (e) {\r\n            self.onExternalServiceAdded(e);\r\n        });\r\n\r\n        return result;\r\n    };\r\n\r\n    ctlProto.onExternalServiceAdded = function (e) {\r\n        const self = this;\r\n        if (e && e.layer) {\r\n            e.layer.map = self.map;\r\n            self.map.addLayer(e.layer).then(function (layer) {\r\n                self.updateLayerTree(e.layer);\r\n            });\r\n        }\r\n    };\r\n\r\n    ctlProto.addUIEventListeners = function () {\r\n        const self = this;\r\n        self.div.addEventListener(CLICKEVENT, TC.EventTarget.listenerBySelector('input[type=checkbox]', function (e) { // No usamos TC.Consts.event.CLICK porque en iPad los eventos touchstart no van bien en los checkbox\r\n            const checkbox = e.target;\r\n            var ul = checkbox;\r\n            while (ul && !ul.matches('ul.' + self.CLASS + '-wl')) {\r\n                ul = ul.parentElement;\r\n            }\r\n            const lis = [];\r\n            for (var i = 0, len = ul.children.length; i < len; i++) {\r\n                child = ul.children[i];\r\n                if (child.tagName === 'LI') {\r\n                    lis.push(child);\r\n                }\r\n            }\r\n            for (var i = 0, len = lis.length; i < len; i++) {\r\n                const li = lis[i];\r\n                if (li.contains(checkbox)) {\r\n                    const layer = self.map.getLayer(li.dataset.layerId);\r\n                    var parent = checkbox;\r\n                    do {\r\n                        parent = parent.parentElement;\r\n                    }\r\n                    while (parent && parent.tagName !== 'LI');\r\n                    const uid = parent.dataset.layerUid;\r\n                    layer.setNodeVisibility(uid, checkbox.checked);\r\n                    break;\r\n                }\r\n            }\r\n\r\n            e.stopPropagation();\r\n        }));\r\n        self.div.addEventListener(TC.Consts.event.MOUSEUP, TC.EventTarget.listenerBySelector('button.' + self.CLASS + '-collapse-btn', function (e) {\r\n            e.target.blur();\r\n            const li = e.target.parentElement;\r\n            if (!li.classList.contains(self.CLASS + '-leaf')) {\r\n                li.classList.toggle(TC.Consts.classes.COLLAPSED);\r\n                const ul = li.querySelector('ul');\r\n                ul.classList.toggle(TC.Consts.classes.COLLAPSED);\r\n                e.stopPropagation();\r\n            }\r\n        }));\r\n    };\r\n\r\n    ctlProto.update = function () {\r\n        var self = this;\r\n\r\n        var _getCheckbox = function (li) {\r\n            for (var i = 0, len = li.children.length; i < len; i++) {\r\n                const child = li.children[i];\r\n                if (child.matches('input[type=checkbox]')) {\r\n                    return child;\r\n                }\r\n            }\r\n            return null;\r\n        };\r\n\r\n        self.getLayerUIElements().forEach(function (li) {\r\n            const layer = self.map.getLayer(li.dataset.layerId);\r\n            if (layer) {\r\n                _getCheckbox(li).checked = layer.getVisibility();\r\n\r\n                layer.tree = null;\r\n\r\n                li.querySelectorAll('li').forEach(function (l) {\r\n                    const checkbox = _getCheckbox(l);\r\n                    const uid = l.dataset.layerUid;\r\n                    switch (layer.getNodeVisibility(uid)) {\r\n                        case TC.Consts.visibility.VISIBLE:\r\n                            checkbox.checked = true;\r\n                            checkbox.indeterminate = false;\r\n                            break;\r\n                        case TC.Consts.visibility.NOT_VISIBLE_AT_RESOLUTION:\r\n                            checkbox.checked = true;\r\n                            checkbox.indeterminate = false;\r\n                            break;\r\n                        case TC.Consts.visibility.HAS_VISIBLE:\r\n                            checkbox.checked = false;\r\n                            checkbox.indeterminate = true;\r\n                            break;\r\n                        default:\r\n                            checkbox.checked = false;\r\n                            checkbox.indeterminate = false;\r\n                    }\r\n                });\r\n            }\r\n        });\r\n\r\n        self.updateScale();\r\n    };\r\n\r\n    ctlProto.updateScale = function () {\r\n        const self = this;\r\n        self.getLayerUIElements().forEach(function (li) {\r\n            const layer = self.map.getLayer(li.dataset.layerId);\r\n            li.querySelectorAll('li').forEach(function (elm) {\r\n                const uid = elm.dataset.layerUid;\r\n                elm.classList.toggle(self.CLASS + '-node-notvisible', !layer.isVisibleByScale(uid));\r\n            });\r\n        });\r\n    };\r\n\r\n    ctlProto.updateLayerTree = function (layer) {\r\n        var self = this;\r\n\r\n        if (!layer.isBase && !layer.options.stealth) {\r\n            TC.control.MapContents.prototype.updateLayerTree.call(self, layer);\r\n\r\n            self.div.querySelector('.' + self.CLASS + '-empty').classList.add(TC.Consts.classes.HIDDEN);\r\n\r\n            self.getRenderedHtml(self.CLASS + '-branch', self.layerTrees[layer.id])\r\n                .then(function (out) {\r\n                    const parser = new DOMParser();\r\n                    const newLi = parser.parseFromString(out, 'text/html').body.firstChild;\r\n                    const uid = newLi.dataset.layerUid;\r\n                    const li = self.div.querySelector('.' + self.CLASS + '-wl li[data-layer-uid=\"' + uid + '\"]');\r\n                    if (li) {\r\n                        li.innerHTML = newLi.innerHTML;\r\n                        li.setAttribute('class', newLi.getAttribute('class')); // Esto actualiza si un nodo deja de ser hoja o pasa a ser hoja\r\n                        if (!li.dataset.layerId) {\r\n                            li.dataset.layerId = layer.id;\r\n                        }\r\n                    }\r\n                    else {\r\n                        newLi.dataset.layerId = layer.id;\r\n                        const ul = self.div.querySelector('.' + self.CLASS + '-wl');\r\n                        ul.insertBefore(newLi, ul.firstChild);\r\n                    }\r\n\r\n                    var wl = 'ul.' + self.CLASS + '-wl';\r\n                    var branch = 'ul.' + self.CLASS + '-branch';\r\n                    var node = 'li.' + self.CLASS + '-node';\r\n                    var leaf = 'li.' + self.CLASS + '-leaf';\r\n                    self.div.querySelectorAll(wl + ' ' + branch + ' ' + branch + ',' + wl + ' ' + branch + ' ' + node).forEach(function (node) {\r\n                        if (!node.matches(leaf)) {\r\n                            node.classList.add(TC.Consts.classes.COLLAPSED);\r\n                        }\r\n                    });\r\n                    self.update();\r\n                })\r\n                .catch(function (err) {\r\n                    TC.error(err);\r\n                });\r\n        }\r\n    };\r\n\r\n    ctlProto.removeLayer = function (layer) {\r\n        if (!layer.isBase) {\r\n            TC.control.MapContents.prototype.removeLayer.call(this, layer);\r\n        }\r\n    };\r\n\r\n    ctlProto.updateLayerVisibility = function (layer) {\r\n        var self = this;\r\n        self.getLayerUIElements().forEach(function (li) {\r\n            if (li.dataset.layerId === layer.id) {\r\n                var isHidden = !layer.getVisibility();\r\n                li.querySelectorAll('input[type=checkbox]').forEach(function (checkbox) {\r\n                    if (checkbox.matches('.' + self.CLASS + '-branch-cb')) {\r\n                        checkbox.checked = !isHidden;\r\n                    }\r\n                    else {\r\n                        checkbox.disabled = isHidden;\r\n                    }\r\n                });\r\n            }\r\n        });\r\n    };\r\n\r\n    ctlProto.updateLayerOrder = function (layer, oldIdx, newIdx) {\r\n        // Este control no tiene que hacer nada\r\n    };\r\n\r\n    ctlProto.render = function (callback) {\r\n        const self = this;\r\n\r\n        return TC.Control.prototype.render.call(self, function () {\r\n\r\n            var controlOptions = self.options.controls || [];\r\n\r\n            if (controlOptions.length > 0) {\r\n                var ctl = controlOptions[0];\r\n                var newDiv = document.createElement(\"div\");\r\n                self.div.appendChild(newDiv);\r\n                self.map.addControl(ctl.name, TC.Util.extend({ 'div': newDiv }, ctl.options));\r\n            }\r\n\r\n            if (TC.Util.isFunction(callback)) {\r\n                callback();\r\n            }\r\n        });\r\n    };\r\n\r\n    ctlProto.getLayerUIElements = function () {\r\n        const self = this;\r\n        const result = [];\r\n        const children = self.div.querySelector('ul.' + self.CLASS + '-wl').children;\r\n        for (var i = 0, len = children.length; i < len; i++) {\r\n            child = children[i];\r\n            if (child.tagName === 'LI') {\r\n                result.push(child);\r\n            }\r\n        }\r\n        return result;\r\n    };\r\n})();\r\n"]}