{"version":3,"sources":["control/WFSQuery.js"],"names":["TC","control","Object","assign","defineProperty","value","target","varArgs","TypeError","to","index","arguments","length","nextSource","nextKey","prototype","hasOwnProperty","call","writable","configurable","Control","syncLoadJS","apiLocation","filter","Feature","feature","Point","Polyline","Polygon","MultiPolyline","MultiPolygon","WFSQuery","options","apply","this","styles","highlightStyles","highLightStyles","download","resultsPanel","geometryPanel","filters","Util","extend","polygon","strokeColor","DEFAULT_STROKE_COLOR","strokeWidth","fillColor","fillOpacity","line","cs","CLASS","_selectors","ELEVATION_CHECKBOX","INTERPOLATION_RADIO","INTERPOLATION_DISTANCE","inherit","ctlProto","loadingCssClass","Consts","classes","LOADING","hiddenCssClass","HIDDEN","modalBody","timer","logicalOperator","AND","timerAutocomplete","controller","locale","empty","node","children","removeChild","filterByOperation","eq","Ctor","equalTo","key","neq","notEqualTo","gt","greaterThan","lt","lessThan","gte","greaterThanOrEqualTo","lte","lessThanOrEqualTo","contains","like","starts","ends","btw","between","nbtw","intersects","within","_currentLayer","_currentLayerName","_currentLayercapabilities","_currentLayerTitle","_currentLayerURL","_getStyles","_getHighLightStyles","getLocaleString","type","template","1","container","depth0","helpers","partials","data","stack1","alias1","nullContext","lookupProperty","parent","propertyName","escapeExpression","name","hash","loc","start","column","end","fn","program","inverse","noop","2","lambda","alias2","compiler","main","useData","3","alias3","4","6","8","5","7","invokePartial","decorators","usePartial","indent","9","10","12","14","15","16","18","19","21","checkInput","input","document","createElement","setAttribute","dateInputMask","inputMaskNumber","_createDateMask","txtBox","Promise","resolve","reject","setTimeout","loadJS","isDebug","console","log","then","IMask","mask","Date","pattern","lazy","format","date","day","getDate","month","getMonth","year","getFullYear","join","parse","str","split","blocks","d","MaskedRange","from","maxLength","m","Y","_destroyDateMask","el","destroy","_changeAttributeEvent","form","combo","parentElement","querySelectorAll","forEach","element","offsetTop","numericSection","querySelector","textSection","dateSection","geomSection","whereSection","opSection","valueField","dataset","UI","autocomplete","classList","add","selectedOptions","substring","indexOf","remove","destroyNumberMask","html","isGeometry","insertAdjacentHTML","className","parentNode","insertBefore","nextSibling","firstElementChild","addEventListener","checked","detectIE","Number","scale","signed","thousandsSeparator","padFractionalZeros","normalizeZeros","radix","step","slice","reduce","vi","va","_autocompleteConstructor","getElementsByClassName","_renderFilterConditions","ctl","_hbs","formatNumber","registerHelper","toLocaleString","getForm","whereDiv","getRenderedHtml","conditions","map","f","isSpatial","Spatial","field","opText","_abbr","valueToShow","_valueToShow","getTemplateObjFromFilter","innerHTML","btn","idx","event","CLICK","zoomToFeatures","geometry","showGeometryPanel","passive","removeFilter","_getLayerName","_createResultPanel","layerName","self","_layerName","async","save","fileName","ccontainer","getControlsByClass","ControlContainer","panelOptions","content","titles","max","_self","getDownloadDialog","title","elevation","displayElevation","open","resultsLayer","features","_downloadClickHandler","addControl","position","_showMessage","Message","messageDiv","clearTimeout","msgType","INFO","WARNING","ERROR","property","listCtrl","minLength","source","text","callback","window","_capabilities","abort","signal","AbortController","toolProxification","fetch","WFGetPropertyValue","undefined","contentType","method","startsWith","xmlDoc","DOMParser","parseFromString","responseText","error","arr","item","JSON","properties","pv","cv","Array","concat","err","DOMException","_getPossibleValues","e","currentTarget","buildHTML","style","maxHeight","results","cp","i","_highlightText","which","RegExp","replace","_select","_addFeature","layer","result","addPoint","getCoords","addPolyline","addPolygon","addMultiPolygon","addMultiPolyline","getLayer","addLayer","id","layerType","VECTOR","owner","stealth","render","register","on","LAYERERROR","modalDialog","reason","WFSErrors","MAX_NUM_FEATURES","limit","ctrl","styleFN","geomType","Cfg","bind","strokeOpacity","point","radius","height","width","fontSize","fontColor","labelOutlineColor","labelOutlineWidth","label","angle","_default","texts","ready","addLayerTool","renderFn","layerId","button","WMS","WFS","appendChild","getWFSCapabilities","WFSCapabilities","Operations","GetFeature","layers","getDisgregatedLayerNames","featureType","l","FeatureTypes","catch","finally","updateEvents","actionFn","renderModalDialog","_onFeaturesUpdate","newData","totalFeatures","showResultsPanel","off","LAYERUPDATE","sendQuery","validateQuery","condition","_url","getWFSURL","cacheHost","getAction","url","action","setVisibility","clearFeatures","featurePrefix","refresh","geometryName","outputFormat","RESULTSPANELCLOSE","browserFeatures","touch","swipe","div","clearFilters","layername","innerText","numero","openTable","css","trClass","tdClass","thClass","tabla","maximize","col","dataTypes","_internalGetDataTypes","j","tdNumeric","k","stopPropagation","feat","celdasHoja","celda","offsetWidth","scrollWidth","td","chkBox","nextElementSibling","mode","closeModal","ctlOptions","ctlContainer","POSITION","RIGHT","drawControl","cancel","showModal","closeCallback","close","getTableContainer","DRAWEND","showsPopup","op","Intersects","crs","Within","push","toggle","setMode","_manageDescribeFeature","operators","attributes","controlId","dialog","removeAttribute","ipt","disabled","radio","OR","masked","number","opcion","isComplete","test","checkValidity","trim","_validate","unmaskedValue","toLocaleDateString","dotOrComma","_getValueToShow","parseInt","parseFloat","not","matchCase","onGeomClick","_renderQueryForm","args","capabilities","DescribeFeatureType","DCP","HTTP","Get","CountDefault","_maxRecordCount","DefaultValue","selectedIndex","describeFeatureType","entries","tbody","Title","toast","capabilitiesPromise","path","getPath","getCapabilitiesPromise","renderDialogPromise","sort","a","b","body","elm","modal","childNodes","firstChild","coef","clientWidth","clientHeight","previousElementSibling","all","Filter","removedFilter","splice","removeFeature"],"mappings":"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","sourcesContent":["TC.control = TC.control || {};\r\n\r\n/*pollyfill*/\r\n\r\nif (typeof Object.assign != 'function') {\r\n    // Must be writable: true, enumerable: false, configurable: true\r\n    Object.defineProperty(Object, \"assign\", {\r\n        value: function assign(target, varArgs) { // .length of function is 2\r\n            'use strict';\r\n            if (target == null) { // TypeError if undefined or null\r\n                throw new TypeError('Cannot convert undefined or null to object');\r\n            }\r\n\r\n            var to = Object(target);\r\n\r\n            for (var index = 1; index < arguments.length; index++) {\r\n                var nextSource = arguments[index];\r\n\r\n                if (nextSource != null) { // Skip over if undefined or null\r\n                    for (var nextKey in nextSource) {\r\n                        // Avoid bugs when hasOwnProperty is shadowed\r\n                        if (Object.prototype.hasOwnProperty.call(nextSource, nextKey)) {\r\n                            to[nextKey] = nextSource[nextKey];\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            return to;\r\n        },\r\n        writable: true,\r\n        configurable: true\r\n    });\r\n}\r\n\r\n\r\nif (!TC.Control) {\r\n    TC.syncLoadJS(TC.apiLocation + 'TC/Control');\r\n}\r\n\r\nif (!TC.filter) {\r\n    TC.syncLoadJS(TC.apiLocation + 'TC/filter');\r\n}\r\n//cargo los objetos features si no, no resaltara las geometria\r\nif (!TC.Feature) {\r\n    TC.syncLoadJS(TC.apiLocation + 'TC/Feature');\r\n}\r\nif (!TC.feature.Point) {\r\n    TC.syncLoadJS(TC.apiLocation + 'TC/feature/Point');\r\n}\r\nif (!TC.feature.Polyline) {\r\n    TC.syncLoadJS(TC.apiLocation + 'TC/feature/Polyline');\r\n}\r\nif (!TC.feature.Polygon) {\r\n    TC.syncLoadJS(TC.apiLocation + 'TC/feature/Polygon');\r\n}\r\nif (!TC.feature.MultiPolyline) {\r\n    TC.syncLoadJS(TC.apiLocation + 'TC/feature/MultiPolyline');\r\n}\r\nif (!TC.feature.MultiPolygon) {\r\n    TC.syncLoadJS(TC.apiLocation + 'TC/feature/MultiPolygon');\r\n}\r\n\r\nTC.control.WFSQuery = function (options) {\r\n    var self = this;\r\n\r\n    TC.Control.apply(this, arguments);\r\n    self.styles = self.options.styles;\r\n    self.highlightStyles = self.options.highlightStyles || self.options.highLightStyles;\r\n    self.download = self.options.download;\r\n    self.resultsPanel = null;\r\n    self.geometryPanel = null;\r\n    self.filters = [];\r\n    self.styles = TC.Util.extend(true, {\r\n        polygon: {\r\n            strokeColor: self.DEFAULT_STROKE_COLOR,\r\n            strokeWidth: 2, fillColor: \"#000\",\r\n            fillOpacity: 0.3\r\n        },\r\n        line: {\r\n            strokeColor: self.DEFAULT_STROKE_COLOR,\r\n            strokeWidth: 2, fillColor: \"#000\"\r\n        }\r\n    }, self.options.styles);\r\n\r\n    const cs = '.' + self.CLASS;\r\n    self._selectors = {\r\n        ELEVATION_CHECKBOX: cs + '-dialog-elev input[type=checkbox]',\r\n        INTERPOLATION_RADIO: 'input[type=radio][name=finfo-ip-coords]',\r\n        INTERPOLATION_DISTANCE: cs + '-dialog-ip-m'\r\n    };\r\n};\r\n\r\nTC.inherit(TC.control.WFSQuery, TC.Control);\r\n\r\n(function () {\r\n    const ctlProto = TC.control.WFSQuery.prototype;\r\n    ctlProto.DEFAULT_STROKE_COLOR = '#0000ff';\r\n\r\n    const loadingCssClass = TC.Consts.classes.LOADING;\r\n    const hiddenCssClass = TC.Consts.classes.HIDDEN;\r\n    const spatialCssClass = 'tc-spatial';\r\n    var modalBody = null;\r\n    var logicalOperator = TC.Consts.logicalOperator.AND;\r\n    var timer = null;\r\n    var timerAutocomplete = null;\r\n    var controller = null;\r\n    var locale = null;\r\n\r\n    const empty = function (node) {\r\n        if (node)\r\n            while (node.children.length) {\r\n                node.removeChild(node.children[0]);\r\n            }\r\n    };\r\n\r\n    const getTemplateObjFromFilter = function (ctl, filter) {\r\n        const isSpatial = filter instanceof TC.filter.Spatial;\r\n        return {\r\n            field: isSpatial ? ctl.getLocaleString('geometry') : filter.propertyName,\r\n            opText: ctl.getLocaleString(filterByOperation[filter._abbr].key),\r\n            valueToShow: filter._valueToShow,\r\n            isSpatial: isSpatial\r\n        }\r\n    };\r\n\r\n    const filterByOperation = {\r\n        eq: {\r\n            Ctor: TC.filter.equalTo,\r\n            key: 'query.equalTo'\r\n        },\r\n        neq: {\r\n            Ctor: TC.filter.notEqualTo,\r\n            key: 'query.notEqualTo'\r\n        },\r\n        gt: {\r\n            Ctor: TC.filter.greaterThan,\r\n            key: 'query.greaterThan'\r\n        },\r\n        lt: {\r\n            Ctor: TC.filter.lessThan,\r\n            key: 'query.lowerThan'\r\n        },\r\n        gte: {\r\n            Ctor: TC.filter.greaterThanOrEqualTo,\r\n            key: 'query.greaterThanOrEqualTo'\r\n        },\r\n        lte: {\r\n            Ctor: TC.filter.lessThanOrEqualTo,\r\n            key: 'query.lowerThanOrEqualTo'\r\n        },\r\n        contains: {\r\n            Ctor: TC.filter.like,\r\n            key: 'query.contains'\r\n        },\r\n        starts: {\r\n            Ctor: TC.filter.like,\r\n            key: 'query.startsBy'\r\n        },\r\n        ends: {\r\n            Ctor: TC.filter.like,\r\n            key: 'query.endsBy'\r\n        },\r\n        btw: {\r\n            Ctor: TC.filter.between,\r\n            key: 'query.equalTo'\r\n        },\r\n        nbtw: {\r\n            key: 'query.equalTo'\r\n        },\r\n        intersects: {\r\n            Ctor: TC.filter.like,\r\n            key: 'query.intersects'\r\n        },\r\n        within: {\r\n            Ctor: TC.filter.between,\r\n            key: 'query.within'\r\n        },\r\n        empty: {\r\n            Ctor: TC.filter.equalTo,\r\n            key: 'query.empty'\r\n        }\r\n    };\r\n\r\n    var _currentLayer = null;\r\n    var _currentLayerName = null;\r\n    var _currentLayercapabilities = null;\r\n    var _currentLayerTitle = null;\r\n    var _currentLayerURL = null;\r\n    var _getStyles = function () { return null };\r\n    var _getHighLightStyles = function () { return null };\r\n    var getLocaleString = null;\r\n    var type = null;\r\n    ctlProto.CLASS = 'tc-ctl-wfsquery';\r\n\r\n    ctlProto.template = {};\r\n    ctlProto.template[ctlProto.CLASS + \"-dialog\"] = TC.apiLocation + \"TC/templates/tc-ctl-wfsquery-dialog.hbs\";\r\n    ctlProto.template[ctlProto.CLASS + \"-form\"] = TC.apiLocation + \"TC/templates/tc-ctl-wfsquery-form.hbs\";\r\n    ctlProto.template[ctlProto.CLASS + \"-filter\"] = TC.apiLocation + \"TC/templates/tc-ctl-wfsquery-filter.hbs\";\r\n    ctlProto.template[ctlProto.CLASS + \"-table\"] = TC.apiLocation + \"TC/templates/tc-ctl-wfsquery-table.hbs\";\r\n    ctlProto.template[ctlProto.CLASS + \"-table-object\"] = TC.apiLocation + \"TC/templates/tc-ctl-wfsquery-table-object.hbs\";\r\n    ctlProto.template[ctlProto.CLASS + \"-geom\"] = TC.apiLocation + \"TC/templates/tc-ctl-wfsquery-geom.hbs\";\r\n\r\n\r\n    var checkInput = function (type) {\r\n        var input = document.createElement(\"input\");\r\n        input.setAttribute(\"type\", type);\r\n        return input.type == type;\r\n    };\r\n\r\n    var _loadDatePolyFill = function () {\r\n        return new Promise(function (resolve, reject) {\r\n            if (typeof (IMask) !== \"undefined\") {\r\n                setTimeout(function () {\r\n                    resolve();\r\n                }, 10);\r\n            }\r\n            else {\r\n                TC.loadJS(true,\r\n                    [TC.apiLocation + '/lib/polyfill/IMask' + (TC.isDebug ? '' : '.min') + '.js'],\r\n                    function () {\r\n                        console.log(\"Imask loaded\");\r\n                        resolve();\r\n                    });\r\n            }\r\n        });\r\n    };\r\n    var _loadNumberPolyFill = function () {\r\n        return new Promise(function (resolve, reject) {\r\n            if (typeof (IMask) !== \"undefined\") {\r\n                setTimeout(function () {\r\n                    resolve();\r\n                }, 10);\r\n            }\r\n            else {\r\n                TC.loadJS(true,\r\n                    [TC.apiLocation + '/lib/polyfill/IMask' + (TC.isDebug ? '' : '.min') + '.js'],\r\n                    function () {\r\n                        console.log(\"Imask loaded\");\r\n                        resolve();\r\n                    });\r\n            }\r\n        });\r\n    }\r\n\r\n    var _getValue = function (input) {\r\n        if (inputMaskNumber) {\r\n            return inputMaskNumber.unmaskedValue;\r\n\r\n        } else if (dateInputMask) {\r\n            //si es texto con mascara de fecha convertierto la fecha de dd/mm/yyyy a yyyy-mm-dd\r\n            return dateInputMask.unmaskedValue.substring(4) + \"-\" + dateInputMask.unmaskedValue.substring(2, 4) + \"-\" + dateInputMask.unmaskedValue.substring(0, 2)\r\n        }\r\n        return input.value;//en el resto de los casos la devuelvo tal cual\r\n\r\n    }\r\n    var _getValueToShow = function (input) {\r\n        if (inputMaskNumber) {\r\n            return inputMaskNumber.value;\r\n        }\r\n        else if (dateInputMask) {\r\n            //si es de tipo date devolvemos la fecha en formato dd/mm/yyyy\r\n            return dateInputMask.value;\r\n        }\r\n        else if (input.type === \"date\") {\r\n            return new Date(input.value).toLocaleDateString(locale)\r\n        }\r\n        else if (input.type === \"number\") {\r\n            var dotOrComma = 1.1.toLocaleString(locale).substring(1, 2);\r\n            return input.value.replace(\".\", dotOrComma);\r\n        }\r\n        return input.value;//en el resto de los casos la devuelvo tal cual\r\n\r\n    }\r\n    var dateInputMask = null;\r\n    var inputMaskNumber = null;\r\n    var _createDateMask = function (txtBox) {\r\n        if (checkInput(\"date\"))\r\n            txtBox.type = \"date\";\r\n        else {\r\n            txtBox.type = \"search\";\r\n            _loadDatePolyFill().then(function () {\r\n                //construir el polyfill\r\n                dateInputMask = new IMask(txtBox, {\r\n                    mask: Date,\r\n                    pattern: ((!locale || locale === \"es-ES\") ? 'd/`m/`Y' : (locale === \"eu-ES\" ? 'Y/`m/`d' : 'm/`d/`Y')),\r\n                    lazy: false,\r\n                    format: function (date) {\r\n                        var day = date.getDate();\r\n                        var month = date.getMonth() + 1;\r\n                        var year = date.getFullYear();\r\n                        if (day < 10) day = \"0\" + day;\r\n                        if (month < 10) month = \"0\" + month;\r\n                        switch (locale) {\r\n                            case \"eu-ES\":\r\n                                return [year, month, day].join('/');\r\n                                break;\r\n                            case \"en-US\":\r\n                                return [month, day, year].join('/');\r\n                                break;\r\n                            case \"es-ES\":\r\n                            default:\r\n                                return [day, month, year].join('/');\r\n                                break;\r\n                        }\r\n\r\n                    },\r\n                    // define str -> date convertion\r\n                    parse: function (str) {\r\n                        switch (locale) {\r\n                            case \"eu-ES\":\r\n                                return new Date(str.split('/')[1] + \"/\" + str.split('/')[2] + \"/\" + str.split('/')[0])\r\n                                break;\r\n                            case \"en-US\":\r\n                                return new Date(str)\r\n                                break;\r\n                            case \"es-ES\":\r\n                            default:\r\n                                return new Date(str.split('/')[1] + \"/\" + str.split('/')[0] + \"/\" + str.split('/')[2])\r\n                                break;\r\n                        }\r\n\r\n                    },\r\n                    blocks: {\r\n                        d: {\r\n                            mask: IMask.MaskedRange,\r\n                            from: 1,\r\n                            to: 31,\r\n                            maxLength: 2,\r\n                        },\r\n                        m: {\r\n                            mask: IMask.MaskedRange,\r\n                            from: 1,\r\n                            to: 12,\r\n                            maxLength: 2,\r\n                        },\r\n                        Y: {\r\n                            mask: IMask.MaskedRange,\r\n                            from: 1900,\r\n                            to: 9999,\r\n                        }\r\n                    }\r\n                });\r\n            });\r\n        }\r\n    };\r\n    var _destroyDateMask = function () {\r\n        if (dateInputMask) {\r\n            var input = dateInputMask.el.input;\r\n            dateInputMask.destroy();\r\n            dateInputMask = null;\r\n            input.value = \"\";\r\n            input.type = \"search\";\r\n        }\r\n    };\r\n    var destroyNumberMask = function () {\r\n        if (inputMaskNumber) {\r\n            var input = inputMaskNumber.el.input;\r\n            inputMaskNumber.destroy();\r\n            inputMaskNumber = null;\r\n            input.value = \"\";\r\n            input.type = \"search\";\r\n        }\r\n    };\r\n    var _getDataTypes = function () {\r\n        return _internalGetDataTypes();\r\n    }\r\n\r\n    var _manageComplexTypes = function (type, form) {\r\n\r\n        var html = '';\r\n        html += ('<option value=\"\">' + getLocaleString('query.chooseAttrCombo') + '</option>');\r\n        for (var key in type) {\r\n            if (!type[key].type || TC.Util.isGeometry(type[key].type)) continue;\r\n            html += '<option value=\"' + (type[key].name || key) + '\">' + key + '</option>';\r\n        }\r\n        var container = document.createElement(\"div\")\r\n        container.insertAdjacentHTML('beforeend', '<select class=\"' + this.className + '\" name=\"' + this.name + '\">' + html + '</select>');\r\n        this.parentNode.parentNode.insertBefore(container, this.parentNode.nextSibling).firstElementChild.addEventListener(\"change\", function () {\r\n            _changeAttributeEvent.apply(this, [form, type]);\r\n        });\r\n\r\n    }\r\n\r\n    const _changeAttributeEvent = function (form, data) {\r\n        //borrar los hijos\t\t\r\n        var combo = this;\r\n        combo.parentElement.parentElement.querySelectorAll(\"select\").forEach(function (element) {\r\n            if (combo.offsetTop < element.offsetTop) {\r\n                element.parentElement.parentElement.removeChild(element.parentElement);\r\n            }\r\n        });\r\n\r\n        const numericSection = form.querySelector(`.${ctlProto.CLASS}-numeric`);\r\n        const textSection = form.querySelector(`.${ctlProto.CLASS}-text`);\r\n        const dateSection = form.querySelector(`.${ctlProto.CLASS}-date`);\r\n        const geomSection = form.querySelector(`.${ctlProto.CLASS}-geom`);\r\n        const whereSection = form.querySelector(`.${ctlProto.CLASS}-where`);\r\n        const opSection = form.querySelector(`.${ctlProto.CLASS}-op`);\r\n        var valueField = whereSection.querySelector(\".tc-textbox\");\r\n        if (valueField.dataset[\"autocomplete\"]) {\r\n            TC.UI.autocomplete.call(valueField, \"clear\");\r\n        }\r\n        numericSection.classList.add(hiddenCssClass);\r\n        dateSection.classList.add(hiddenCssClass);\r\n        textSection.classList.add(hiddenCssClass);\r\n        geomSection.classList.add(hiddenCssClass);\r\n        whereSection.classList.add(hiddenCssClass);\r\n        if (!data[this.selectedOptions[0].value.substring(this.selectedOptions[0].value.indexOf(\":\") + 1)]) {\r\n            opSection.classList.add(hiddenCssClass);\r\n            return;\r\n        }\r\n        type = data[this.selectedOptions[0].value.substring(this.selectedOptions[0].value.indexOf(\":\") + 1)].type;\r\n        opSection.classList.remove(hiddenCssClass);\r\n        TC.UI.autocomplete.call(valueField, \"clear\");\r\n        //$(valueField).unbind(\"keydown\");\r\n        destroyNumberMask();\r\n        valueField.type = \"search\";\r\n        switch (true) {\r\n            case !type:\r\n                console.log(\"type es nulo\");\r\n                break;\r\n            case type instanceof Object:\r\n                _manageComplexTypes.apply(this, [type, form]);\r\n                break;\r\n            case TC.Util.isGeometry(type):\r\n                geomSection.classList.remove(hiddenCssClass);\r\n                whereSection.classList.remove(hiddenCssClass);\r\n                whereSection.classList.add(spatialCssClass);\r\n\r\n                if (geomSection.querySelectorAll(\"input:checked\").length === 0) {\r\n                    geomSection.firstElementChild.checked = true;\r\n                }\r\n                _destroyDateMask();\r\n                //const value = [].slice.call(form.querySelectorAll('select[name=' + this.name + ']')).reduce(function (vi, va) { return vi + (vi ? \"/\" : \"\") + va.value; }, \"\");\r\n                //_autocompleteConstructor(valueField, value, form.getElementsByClassName(ctlProto.CLASS + \"-list tc-ctl-search-list\")[0]);\r\n                break;\r\n            case type.indexOf(\"int\") >= 0:\r\n            case type.indexOf(\"float\") >= 0:\r\n            case type.indexOf(\"double\") >= 0:\r\n            case type.indexOf(\"long\") >= 0:\r\n            case type.indexOf(\"decimal\") >= 0:\r\n                numericSection.classList.remove(hiddenCssClass);\r\n                whereSection.classList.remove(hiddenCssClass, spatialCssClass);\r\n\r\n                if (numericSection.querySelectorAll(\"input:checked\").length === 0) {\r\n                    numericSection.firstElementChild.checked = true;\r\n                }\r\n                _destroyDateMask();\r\n\r\n                if (checkInput(\"number\")) {\r\n                    if (TC.Util.detectIE()) {\r\n                        valueField.type = \"text\";\r\n                        _loadNumberPolyFill().then(function () {\r\n                            inputMaskNumber = new IMask(valueField, {\r\n                                mask: Number,  // enable number mask\r\n                                scale: (type.indexOf(\"int\") >= 0 || type.indexOf(\"long\") >= 0) ? 0 : 2,  // digits after point, 0 for integers\r\n                                signed: false,  // disallow negative\r\n                                thousandsSeparator: (locale && locale === \"en-US\") ? ',' : '.',  // any single char\r\n                                padFractionalZeros: false,  // if true, then pads zeros at end to the length of scale\r\n                                normalizeZeros: true,  // appends or removes zeros at ends\r\n                                radix: (locale && locale === \"en-US\") ? '.' : ',',  // fractional delimiter\r\n                            })\r\n                        });\r\n                    }\r\n                    else {\r\n                        valueField.type = \"number\";\r\n                        if (type.indexOf(\"int\") >= 0 || type.indexOf(\"long\") >= 0)\r\n                            valueField.step = \"1\";\r\n                        else\r\n                            valueField.step = \"0.0001\";\r\n                    }\r\n                }\r\n                break\r\n            case type.indexOf(\"dateTime\") >= 0:\r\n            case type.indexOf(\"date\") >= 0:\r\n\r\n                dateSection.classList.remove(hiddenCssClass);\r\n                whereSection.classList.remove(hiddenCssClass, spatialCssClass);\r\n\r\n                if (dateSection.querySelectorAll(\"input:checked\").length === 0) {\r\n                    dateSection.firstElementChild.checked = true;\r\n                }\r\n                _createDateMask(valueField);\r\n                break;\r\n            case type.indexOf(\"string\") >= 0:\r\n                textSection.classList.remove(hiddenCssClass);\r\n                whereSection.classList.remove(hiddenCssClass, spatialCssClass);\r\n\r\n                if (textSection.querySelectorAll(\"input:checked\").length === 0) {\r\n                    textSection.firstElementChild.checked = true;\r\n                }\r\n                _destroyDateMask();\r\n                const value = [].slice.call(form.querySelectorAll('select[name=' + this.name + ']')).reduce(function (vi, va) { return vi + (vi ? \"/\" : \"\") + va.value; }, \"\");\r\n                _autocompleteConstructor(valueField, value, form.getElementsByClassName(ctlProto.CLASS + \"-list tc-ctl-search-list\")[0]);\r\n                break;\r\n        }\r\n    };\r\n\r\n    const _renderFilterConditions = function (ctl) {\r\n\r\n        if (TC._hbs && !TC._hbs.helpers.formatNumber) {\r\n            TC._hbs.registerHelper(\"formatNumber\", function (value) {\r\n                return value.toLocaleString(locale);\r\n            });\r\n        }\r\n        const form = ctl.getForm();\r\n        const whereDiv = form.querySelector(`.${ctl.CLASS}-where-list`);\r\n        empty(whereDiv);\r\n        ctlProto.getRenderedHtml(ctl.CLASS + \"-filter\", {\r\n            conditions: ctl.filters.map(f => getTemplateObjFromFilter(ctl, f))\r\n        }, function (html) {\r\n            whereDiv.innerHTML = html;\r\n            whereDiv.querySelectorAll(`.${ctl.CLASS}-where-cond-view`).forEach(function (btn, idx) {\r\n                btn.addEventListener(TC.Consts.event.CLICK, function () {\r\n                    ctl.map.zoomToFeatures([ctl.filters.filter(f => f instanceof TC.filter.Spatial)[idx].geometry]);\r\n                    ctl.showGeometryPanel();\r\n                }, { passive: true });\r\n            });\r\n            form.querySelectorAll(`.${ctl.CLASS}-del-cond`).forEach(function (btn, idx) {\r\n                btn.addEventListener(TC.Consts.event.CLICK, function () {\r\n                    ctl.removeFilter(idx);\r\n                }, { passive: true });\r\n            });\r\n        });\r\n    }\r\n\r\n    var _validate = function (form) {\r\n        var opcion = form.querySelector('.tc-ctl-wfsquery input[type=\"radio\"]:checked');\r\n\r\n        if (dateInputMask && !dateInputMask.masked.isComplete) {\r\n            if (/^(?=\\d)(?:(?:31(?!.(?:0?[2469]|11))|(?:30|29)(?!.0?2)|29(?=.0?2.(?:(?:(?:1[6-9]|[2-9]\\d)?(?:0[48]|[2468][048]|[13579][26])|(?:(?:16|[2468][048]|[3579][26])00)))(?:\\x20|$))|(?:2[0-8]|1\\d|0?[1-9]))([-.\\/])(?:1[012]|0?[1-9])\\1(?:1[6-9]|[2-9]\\d)?\\d\\d(?:(?=\\x20\\d)\\x20|$))?(((0?[1-9]|1[012])(:[0-5]\\d){0,2}(\\x20[AP]M))|([01]\\d|2[0-3])(:[0-5]\\d){1,2})?$/.test(str) === false)\r\n                _showMessage(\"Fecha \" + str + \" inválida\", TC.Consts.msgType.ERROR);\r\n            return false;\r\n        }\r\n        if (opcion.length == 0) {\r\n            _showMessage(getLocaleString(\"query.msgNoCondition\"));\r\n            return false;\r\n        }\r\n        if (form.querySelectorAll('input[type=\\'date\\']').length && !form.querySelector('input[type=\\'date\\']').checkValidity()) {\r\n            _showMessage(getLocaleString(\"query.msgNoValidDate\"));\r\n            return false;\r\n        }\r\n        var number\r\n        if (form.querySelectorAll('input[type=\\'number\\']').length && ((number = form.querySelector('input[type=\\'number\\']')) != null) && !number.checkValidity()) {\r\n            if (number.step === \"1\")\r\n                _showMessage(getLocaleString(\"query.msgNoValidNumberMustInt\"));\r\n            else\r\n                _showMessage(getLocaleString(\"query.msgNoValidNumber\"));\r\n            return false;\r\n        }\r\n        if (form.querySelector('input.tc-textbox').value.trim() === \"\" && opcion.value!==\"empty\") {\r\n            _showMessage(getLocaleString(\"query.msgNoValueCondition\"));\r\n            return false;\r\n        }\r\n        return true;\r\n    };\r\n\r\n    const _getLayerName = () => { return _currentLayerTitle };\r\n\r\n    var _createResultPanel = function (layerName) {\r\n        const self = this;\r\n        var _layerName = layerName;\r\n        var _downloadClickHandler = function (_self, layerName) {\r\n            const self = _self;\r\n            self.getDownloadDialog().then(function (control) {\r\n                var options = {\r\n                    title: layerName()\r\n                };\r\n                if (self.map.elevation || self.options.displayElevation) {\r\n                    options = Object.assign({}, options, {\r\n                        elevation: Object.assign({}, self.map.elevation && self.map.elevation.options, self.options.displayElevation)\r\n                    });\r\n                }\r\n\r\n                control.open(self.resultsLayer.features, options);\r\n            });\r\n        };\r\n        return new Promise(async function (resolve) {\r\n            if (!self.resultsPanel) {\r\n                var ccontainer = self.map.getControlsByClass(TC.control.ControlContainer);\r\n                const panelOptions = {\r\n                    content: \"table\",\r\n                    titles: {\r\n                        main: \"\",\r\n                        max: \"\"\r\n                    },\r\n                    save: {\r\n                        fileName: _layerName + \".xls\"\r\n                    },\r\n                    download: () => _downloadClickHandler(self, _getLayerName)\r\n                };\r\n                if (ccontainer.length == 0) {\r\n                    self.resultsPanel = await self.map.addControl('resultsPanel', panelOptions);\r\n                }\r\n                else {\r\n                    panelOptions.position = \"right\";\r\n                    self.resultsPanel = await ccontainer[0].addControl('resultsPanel', panelOptions);\r\n                }\r\n                self.resultsPanel.template[self.resultsPanel.CLASS + \"-table\"] = self.template[self.CLASS + \"-table\"];\r\n            }\r\n            else {\r\n                self.resultsPanel.options.save.fileName = _layerName + \".xls\";\r\n            }\r\n            self.resultsPanel.options.titles.max = self.resultsPanel.getLocaleString('geo.trk.chart.exp');\r\n            resolve();\r\n        });\r\n    };\r\n    \r\n    var _showMessage = function (Message, type) {\r\n        var messageDiv = modalBody.getElementsByClassName(\"tc-ctl-wfsquery-message\")[0];\r\n        if (timer) {\r\n            clearTimeout(timer);\r\n        }\r\n        else {\r\n            messageDiv.innerHTML = Message;\r\n            switch (type) {\r\n                case TC.Consts.msgType.INFO:\r\n                    messageDiv.classList.add(\"tc-msg-info\")\r\n                    break;\r\n                case TC.Consts.msgType.WARNING:\r\n                    messageDiv.classList.add(\"tc-msg-warning\")\r\n                    break;\r\n                case TC.Consts.msgType.ERROR:\r\n                default:\r\n                    messageDiv.classList.add(\"tc-msg-error\")\r\n                    break;\r\n            }\r\n            messageDiv.classList.remove(hiddenCssClass);\r\n        }\r\n        timer = setTimeout(function () {\r\n            timer = null;\r\n            messageDiv.classList.add(hiddenCssClass);\r\n        }, 3000)\r\n    };\r\n    var _getPossibleValues = async function (field, value) {\r\n        var _capabilities = Object.assign({}, _currentLayercapabilities);\r\n        switch (document.querySelector(\".tc-ctl-wfsquery.tc-ctl-wfsquery-text input:checked\").value) {\r\n            case \"start\":\r\n                value = (value + \"*\");\r\n                break;\r\n            case \"contains\":\r\n            case \"eq\":\r\n                value = (\"*\" + value + \"*\");\r\n                break;\r\n            case \"end\":\r\n                value = (\"*\" + value);\r\n                break;\r\n        }\r\n\r\n        if (controller) {\r\n            controller.abort();\r\n        }\r\n        controller = new AbortController();\r\n        let signal = controller.signal;\r\n\r\n        try {\r\n            var data = await _currentLayer.toolProxification.fetch(_currentLayerURL, {\r\n                //URI:si el valor de field contiene \"/\" se supone que es un dato compuesto entonces no establezco propiedades a devolver sino que se deja vacío para que devuelva todos.\r\n                data: TC.Util.WFGetPropertyValue(_currentLayerName, field.indexOf(\"/\")>=0 ? false : field, TC.filter.like(field, value, undefined, undefined, undefined, false), _capabilities),//TC.Util.WFSQueryBuilder([_currentLayerName], TC.filter.like(field, value, undefined, undefined, undefined, false), _capabilities, \"JSON\", false),\r\n                contentType: \"application/xml\",\r\n                method: \"POST\",\r\n                signal: signal\r\n            })\r\n\r\n            if (data.contentType.startsWith(\"application/xml\") || data.contentType.startsWith(\"text/xml\")) {\r\n                let xmlDoc = new DOMParser().parseFromString(data.responseText, \"text/xml\");\r\n                let error = xmlDoc.querySelector(\"Exception ExceptionText\");\r\n                if (error) {\r\n                    _showMessage(error.innerHTML, TC.Consts.msgType.ERROR);\r\n                    return [];\r\n                }\r\n                //parser de features XML\r\n                var arr = [];\r\n                xmlDoc.querySelectorAll(\"member > *\").forEach(function (item) { if (arr.indexOf(item.innerHTML)<0)arr[arr.length] = item.innerHTML });\r\n                return arr;\r\n                \r\n            }\r\n            if (data.contentType.startsWith(\"application/json\")) {\r\n                data = JSON.parse(data.responseText);\r\n            }\r\n            if (data.features && data.features.length > 0) {\r\n                var arr;\r\n                if (data.features.length === 1)\r\n                    arr = [field.split(\"/\").reduce(function (vi, va) { return vi[va.substring(va.indexOf(\":\") + 1)] }, data.features[0].properties)];\r\n                if (data.features.length > 1)\r\n                    arr = data.features.reduce(function (pv, cv) {\r\n                        if (pv && pv instanceof Array) {\r\n                            if (pv.indexOf(cv.properties[field]) < 0)\r\n                                return pv.concat(field.split(\"/\").reduce(function (vi, va) { return vi[va.substring(va.indexOf(\":\") + 1)] }, cv.properties));\r\n                            else\r\n                                return pv;\r\n                        }\r\n                    }, []);\r\n                //arr.sort();\r\n                return arr;\r\n            } else\r\n                return [];\r\n        }\r\n        catch (err) {\r\n            if (err instanceof DOMException && err.name !==\"AbortError\")\r\n                _showMessage(err, TC.Consts.msgType.ERROR);\r\n            return null\r\n        }\r\n    };\r\n    var _autocompleteConstructor = function (control, property, listCtrl) {\r\n\r\n        TC.UI.autocomplete.call(control, {\r\n            minLength: 3,\r\n            target: listCtrl,\r\n            source: function (text, callback) {\r\n                var _self = this;\r\n                _self.target.innerHTML = '<li><a class=\"tc-ctl-search-li-loading\" href=\"#\">' + getLocaleString(\"searching\") + '<span class=\"tc-ctl-search-loading-spinner tc-ctl-search-loading\"></span></a></li>'\r\n                _self.target.classList.remove(hiddenCssClass);\r\n                if (timerAutocomplete)\r\n                    window.clearTimeout(timerAutocomplete);\r\n                timerAutocomplete = window.setTimeout(async function () {\r\n                    if (!document.querySelector(\".tc-ctl-wfsquery.tc-ctl-wfsquery-text\").classList.contains(TC.Consts.classes.HIDDEN)) {                        \r\n                        var data = await _getPossibleValues(property, text)\r\n                        if (data) {\r\n                            if (data.length)\r\n                                callback(data);\r\n                            else\r\n                                _self.target.classList.add(hiddenCssClass);\r\n                        }\r\n                    }\r\n                }, 500);\r\n            },\r\n            callback: function (e) {\r\n                control.value = e.currentTarget.dataset[\"value\"];\r\n                this.target.classList.add(hiddenCssClass);\r\n            },\r\n            buildHTML: function (data) {\r\n                var pattern = control.value;\r\n                this.target.style.maxHeight = \"\";\r\n                if (data.results.length > 1)\r\n                    return data.results.reduce(function (pv, cp, i) {\r\n                        return (i > 1 ? pv : _highlightText(pv, pattern)) + _highlightText(cp, pattern);\r\n                    });\r\n                else\r\n                    return _highlightText(data.results[0], pattern);\r\n            }\r\n        });\r\n        control.addEventListener(\"targetCleared.autocomplete\", function () {\r\n            listCtrl.classList.add(hiddenCssClass);\r\n        });\r\n        control.addEventListener('keypress', function (e) {\r\n            if (e.which == 13) {\r\n                TC.UI.autocomplete.call(control, \"clear\");\r\n            }\r\n        });\r\n        control.addEventListener(\"search\", function (e) {\r\n            if (control.value.length === 0) {\r\n                TC.UI.autocomplete.call(control, \"clear\")\r\n            }\r\n        });\r\n        control.addEventListener(\"input\", function (e) {\r\n            if (control.value.length === 0) {\r\n                TC.UI.autocomplete.call(control, \"clear\")\r\n            }\r\n        });\r\n    };\r\n    var _highlightText = function (text, pattern) {\r\n        pattern = new RegExp(pattern.replace(/\\W/g, ''), \"gi\");\r\n        return \"<li><a href=\\\"#\\\" data-value=\\\"\" + text + \"\\\">\" + text.replace(pattern, '<b>$&</b>') + \"</a></li>\";\r\n    };\r\n\r\n    var _select = function (feature) {\r\n        var _addFeature = function (layer, feature) {\r\n            var result\r\n            if (feature instanceof TC.feature.Point) {\r\n                result = layer.addPoint(feature.getCoords());\r\n            }\r\n            else if (feature instanceof TC.feature.Polyline) {\r\n                result = layer.addPolyline(feature.getCoords());\r\n            }\r\n            else if (feature instanceof TC.feature.Polygon) {\r\n                result = layer.addPolygon(feature.getCoords());\r\n            }\r\n            else if (feature instanceof TC.feature.MultiPolygon) {\r\n                result = layer.addMultiPolygon(feature.getCoords());\r\n            }\r\n            else if (feature instanceof TC.feature.MultiPolyline) {\r\n                result = layer.addMultiPolyline(feature.getCoords());\r\n            }\r\n            return result;\r\n        };\r\n        if (!feature.layer)\r\n            return;\r\n        var layer = feature.layer.map.getLayer(\"WFSQueryResultsHighlight\");\r\n        if (!layer) {\r\n            feature.layer.map.addLayer({\r\n                id: \"WFSQueryResultsHighlight\",\r\n                type: TC.Consts.layerType.VECTOR,\r\n                owner: self,\r\n                stealth: true,\r\n                styles: _getHighLightStyles()\r\n            }, function (layer) {\r\n                _addFeature(layer, feature);\r\n            });\r\n        }\r\n        else\r\n            _addFeature(layer, feature);\r\n    };\r\n    var _unselect = function (feature) {\r\n        var layer = feature.layer.map.getLayer(\"WFSQueryResultsHighlight\");\r\n        if (layer) {\r\n            layer.clearFeatures();\r\n        }\r\n    };\r\n    ctlProto.render = function (callback) {\r\n        const self = this;\r\n        const result = TC.Control.prototype.render.call(self, callback);\r\n        return result;\r\n    };\r\n\r\n    ctlProto.register = function (map) {\r\n        const self = this;\r\n        return new Promise(function (resolve) {\r\n\r\n            map.on(TC.Consts.event.LAYERERROR, (e) => {\r\n                if (e.layer === self.resultsLayer) {\r\n                    self.modalDialog.getElementsByClassName(\"tc-modal-body\")[0].classList.remove(loadingCssClass)\r\n                    if (e.reason === TC.Consts.WFSErrors.MAX_NUM_FEATURES) {\r\n                        _showMessage(getLocaleString(\"query.msgTooManyResults\", { limit: e.data.limit }), TC.Consts.msgType.WARNING)\r\n                    }\r\n                    else {\r\n                        console.error(e.reason);\r\n                        _showMessage(getLocaleString(\"query.errorUndefined\"), TC.Consts.msgType.ERROR);\r\n                    }\r\n                }\r\n            })\r\n\r\n            TC.Control.prototype.register.call(self, map).then(function (ctrl) {\r\n                var self = ctrl;\r\n                _getStyles = function () {\r\n                    var styleFN = function (geomType, property) {\r\n                        return this.options.styles && this.options.styles[geomType] ? (this.options.styles[geomType][property] || TC.Cfg.styles[geomType][property]) : TC.Cfg.styles[geomType][property]\r\n                    }\r\n                    return {\r\n                        polygon: {\r\n                            fillColor: styleFN.bind(self, 'polygon', 'fillColor'),\r\n                            fillOpacity: styleFN.bind(self, 'polygon', 'fillOpacity'),\r\n                            strokeColor: styleFN.bind(self, 'polygon', 'strokeColor'),\r\n                            strokeOpacity: styleFN.bind(self, 'polygon', 'strokeOpacity'),\r\n                            strokeWidth: styleFN.bind(self, 'polygon', 'strokeWidth')\r\n                        },\r\n                        line: {\r\n                            strokeColor: styleFN.bind(self, 'line', 'strokeColor'),\r\n                            strokeOpacity: styleFN.bind(self, 'line', 'strokeOpacity'),\r\n                            strokeWidth: styleFN.bind(self, 'line', 'strokeWidth')\r\n                        },\r\n                        point: {\r\n                            radius: styleFN.bind(self, 'point', 'radius'),\r\n                            height: styleFN.bind(self, 'point', 'height'),\r\n                            width: styleFN.bind(self, 'point', 'width'),\r\n                            fillColor: styleFN.bind(self, 'point', 'fillColor'),\r\n                            fillOpacity: styleFN.bind(self, 'point', 'fillOpacity'),\r\n                            strokeColor: styleFN.bind(self, 'point', 'strokeColor'),\r\n                            strokeWidth: styleFN.bind(self, 'point', 'strokeWidth'),\r\n                            fontSize: styleFN.bind(self, 'point', 'fontSize'),\r\n                            fontColor: styleFN.bind(self, 'point', 'fontColor'),\r\n                            labelOutlineColor: styleFN.bind(self, 'point', 'labelOutlineColor'),\r\n                            labelOutlineWidth: styleFN.bind(self, 'point', 'labelOutlineWidth'),\r\n                            label: styleFN.bind(self, 'point', 'label'),\r\n                            angle: styleFN.bind(self, 'point', 'angle')\r\n                        }\r\n                    }\r\n                };\r\n                _getHighLightStyles = function () {\r\n                    var _default = {\r\n                        \"polygon\": TC.Util.extend(true, {}, TC.Cfg.styles.polygon, {\r\n                            fillColor: \"#0099FF\",\r\n                            fillOpacity: 1,\r\n                            strokeColor: \"#0099FF\",\r\n                            strokeWidth: 2\r\n                        }),\r\n                        \"line\": TC.Util.extend(true, {}, TC.Cfg.styles.line, {\r\n                            strokeColor: \"#0099FF\",\r\n                            strokeWidth: 2\r\n                        }),\r\n                        \"point\": TC.Util.extend(true, {}, TC.Cfg.styles.point, {\r\n                            strokeColor: \"#0099FF\"\r\n                        })\r\n                    };\r\n                    return self.highlightStyles ? {\r\n                        \"polygon\": TC.Util.extend(true, {}, _default.polygon, self.highlightStyles.polygon ? self.highlightStyles.polygon : {}),\r\n                        \"line\": TC.Util.extend(true, {}, _default.line, self.highlightStyles.line ? self.highlightStyles.line : {}),\r\n                        \"point\": TC.Util.extend(true, {}, _default.point, self.highlightStyles.point ? self.highlightStyles.point : {})\r\n                    } : _default;\r\n                };\r\n\r\n                locale = map.options.locale;\r\n\r\n                getLocaleString = function (key, texts) {\r\n                    return TC.Util.getLocaleString(locale, key, texts);\r\n                }\r\n\r\n                map.ready(function () {\r\n                    map.getControlsByClass('TC.control.WorkLayerManager').forEach(function (ctl) {\r\n                        ctl.addLayerTool({\r\n                            renderFn: function (container, layerId) {\r\n                                const className = self.CLASS + '-btn-open';\r\n                                let button = container.querySelector('button.' + className);\r\n                                if (!button) {\r\n                                    const layer = map.getLayer(layerId);\r\n                                    if (layer.type === TC.Consts.layerType.WMS || layer.type === TC.Consts.layerType.WFS) {\r\n                                        const text = self.getLocaleString('query.tooltipMagnifBtn');\r\n                                        button = document.createElement('button');\r\n                                        button.innerHTML = text;\r\n                                        button.setAttribute('title', text);\r\n                                        button.classList.add(className);\r\n                                        button.dataset.layerId = layerId;\r\n                                        container.appendChild(button);\r\n                                        if (layer.type === TC.Consts.layerType.WMS) {\r\n                                            button.classList.add(loadingCssClass);\r\n                                            layer.getWFSCapabilities().then((WFSCapabilities) => {\r\n                                                //check si tiene GetFeature Disponible\r\n                                                if (!WFSCapabilities.Operations.GetFeature) {\r\n                                                    button.classList.add(hiddenCssClass);\r\n                                                    return;\r\n                                                }\r\n                                                //check si las capas hijas están en capabilties WFS\r\n                                                var layers = layer.getDisgregatedLayerNames ? layer.getDisgregatedLayerNames() : layer.featureType;\r\n                                                layers = layers.filter(function (l) {\r\n                                                    return WFSCapabilities.FeatureTypes.hasOwnProperty(l.substring(l.indexOf(\":\") + 1));\r\n                                                });\r\n                                                if (!layers.length) {\r\n                                                    button.classList.add(hiddenCssClass);\r\n                                                    return;\r\n                                                }\r\n                                            }).catch(() => button.classList.add(hiddenCssClass))\r\n                                                .finally(() => button.classList.remove(loadingCssClass));\r\n                                        }\r\n                                    }\r\n                                }\r\n                                return button;\r\n                            },\r\n                            updateEvents: [],\r\n                            actionFn: function () {\r\n                                const button = this;\r\n                                if (button.classList.contains('tc-unavailable') || button.classList.contains('tc-loading')) {\r\n                                    return;\r\n                                }\r\n                                const layer = self.map.getLayer(button.dataset.layerId);\r\n                                self.renderModalDialog(layer);\r\n                            }\r\n                        });\r\n                    });\r\n                });\r\n\r\n                resolve(self);\r\n            });\r\n        });\r\n    };\r\n\r\n    const _onFeaturesUpdate = function (e) {\r\n        const ctl = e.layer.owner;\r\n        if (ctl && e.layer == ctl.resultsLayer) {\r\n            if (e.newData && e.newData.totalFeatures === 0) {\r\n                ctl.modalDialog.getElementsByClassName(\"tc-modal-body\")[0].classList.remove(loadingCssClass);\r\n                _showMessage(getLocaleString(\"query.msgNoResults\"), TC.Consts.msgType.INFO);\r\n                return;\r\n            }\r\n            var features = e.layer.features;\r\n            if (features.length > 0) {\r\n                ctl.map.zoomToFeatures(features);\r\n                ctl.showResultsPanel(\r\n                    (features.length > 1 ?\r\n                        features.reduce(function (vi, va, index) {\r\n                            return (vi instanceof Array ? vi : [vi.data]).concat([va.data])\r\n                        })\r\n                        :\r\n                        [features[0].data])\r\n                    , _currentLayerTitle);\r\n            }\r\n\r\n            e.layer.map.off(TC.Consts.event.LAYERUPDATE, _onFeaturesUpdate);\r\n        }\r\n    };\r\n\r\n    ctlProto.sendQuery = async function () {\r\n        const self = this;\r\n        if (!self.validateQuery()) {\r\n            _showMessage(getLocaleString(\"query.msgNoQueryFilter\"));\r\n            return;\r\n        }\r\n        self.modalDialog.getElementsByClassName(\"tc-modal-body\")[0].classList.add(loadingCssClass);\r\n\r\n        let filter;\r\n        if (self.filters.length > 1) {\r\n            const condition = self.modalDialog.querySelector(\".tc-ctl-wfsquery-logOpRadio:checked\").value;\r\n            filter = TC.filter[TC.Consts.logicalOperator[condition]].apply(null, self.filters);\r\n        }\r\n        else {\r\n            filter = self.filters[0];\r\n        }\r\n\r\n        await _createResultPanel.apply(self, [_currentLayerTitle]);\r\n        var _url = await _currentLayer.getWFSURL();\r\n\r\n        _currentLayer.toolProxification.cacheHost.getAction(_url).then(function (cacheHost) {\r\n            const url = cacheHost.action(_url);\r\n            if (!self.resultsLayer) {\r\n                self.map\r\n                    .addLayer({\r\n                        id: \"WFSQueryResults\",\r\n                        type: TC.Consts.layerType.WFS,\r\n                        url: url,\r\n                        owner: self,\r\n                        stealth: true,\r\n                        geometryName: \"the_geom\",\r\n                        featurePrefix: _currentLayerName.substring(0, _currentLayerName.indexOf(\":\")),\r\n                        featureType: _currentLayerName.substring(_currentLayerName.indexOf(\":\") + 1),\r\n                        properties: filter,\r\n                        outputFormat: TC.Consts.format.JSON,\r\n                        styles: _getStyles()\r\n                    })\r\n                    .then(function (layer) {\r\n                        self.resultsLayer = layer;\r\n                        layer.map.on(TC.Consts.event.LAYERUPDATE, _onFeaturesUpdate);\r\n                    });\r\n\r\n                self.map.on(TC.Consts.event.RESULTSPANELCLOSE, function (e) {\r\n                    if (e.control !== self.resultsPanel)\r\n                        return;\r\n                    if (TC.browserFeatures.touch()) {\r\n                        TC.Util.swipe(e.control.div, \"enable\");\r\n                    }\r\n                    self.resultsLayer.clearFeatures();\r\n                    self.resultsLayer.setVisibility(false);\r\n                    self.clearFilters();\r\n                    self.map.off(TC.Consts.event.LAYERUPDATE, _onFeaturesUpdate);\r\n                });\r\n            }\r\n            else {\r\n                self.resultsLayer.setVisibility(false);\r\n                self.resultsLayer.clearFeatures();\r\n                //borro el evento featureUpdate por si hago una búsqueda sin cerra el panel previamente\r\n                self.map.off(TC.Consts.event.LAYERUPDATE, _onFeaturesUpdate);\r\n                self.map.on(TC.Consts.event.LAYERUPDATE, _onFeaturesUpdate);\r\n                self.resultsLayer.url = url;\r\n                self.resultsLayer.featurePrefix = _currentLayerName.substring(0, _currentLayerName.indexOf(\":\"));\r\n                self.resultsLayer.featureType = _currentLayerName.substring(_currentLayerName.indexOf(\":\") + 1);\r\n                self.resultsLayer.properties = filter;\r\n                self.resultsLayer.setVisibility(true);\r\n                self.resultsLayer.refresh();\r\n            }\r\n        });\r\n    };\r\n\r\n    ctlProto.validateQuery = function () {\r\n        return this.filters.length > 0\r\n    };\r\n\r\n    ctlProto.showResultsPanel = function (data, layername) {\r\n        const self = this;\r\n\r\n        //self.map.$events.trigger(TC.Consts.event.SEARCHDONE, { data: data } );\r\n\r\n        //en funcion del número de elementos cargo un título en singular o plural\r\n\r\n        self.resultsPanel.div.querySelector(\".prpanel-title-text\").innerText = self.resultsPanel.getLocaleString(data.length > 1 ? 'query.titleResultPaneMany' : 'query.titleResultPanelOne', { \"numero\": data.length, \"layerName\": layername });\r\n\r\n        self.resultsPanel.div.classList.add(\"tc-ctl-wfsquery-results\");\r\n\r\n        self.modalDialog.parentElement.removeChild(self.modalDialog);\r\n\r\n        self.resultsPanel.openTable({\r\n            data: data,\r\n            css: {\r\n                trClass: \"trClass\",\r\n                tdClass: \"tdClass\",\r\n                thClass: \"thClass\",\r\n            },\r\n            callback: function (tabla) {\r\n\r\n                self.resultsPanel.maximize();\r\n                console.log(\"render del panel de resultados\");\r\n                var col = tabla.querySelectorAll(\".table>tbody>tr\")\r\n                var dataTypes = _getDataTypes();\r\n                var j = 1;\r\n                for (var i in data[0]) {\r\n                    if (dataTypes.hasOwnProperty(i)) {\r\n                        if (dataTypes[i].type && !(dataTypes[i].type instanceof Object))\r\n                            if ((dataTypes[i].type.indexOf(\"int\") >= 0 ||\r\n                                dataTypes[i].type.indexOf(\"float\") >= 0 ||\r\n                                dataTypes[i].type.indexOf(\"double\") >= 0 ||\r\n                                dataTypes[i].type.indexOf(\"long\") >= 0 ||\r\n                                dataTypes[i].type.indexOf(\"decimal\") >= 0)) {\r\n                                var tdNumeric = tabla.querySelectorAll(\"td:nth-child(\" + j + \")\");\r\n                                for (var k = 0; k < tdNumeric.length; k++) {\r\n                                    tdNumeric[k].classList.add(\"tc-numeric\");\r\n                                }\r\n                            }\r\n                        if (dataTypes[i].type && (dataTypes[i].type instanceof Object)) {\r\n                            console.log(\"aki lo que sea\");\r\n                        }\r\n                    }\r\n                    j++;\r\n                }\r\n\r\n                for (var i = 0; i < col.length; i++) {\r\n                    col[i].addEventListener(\"click\", function (e) {\r\n                        e.stopPropagation();\r\n                        var index = this.dataset.index;\r\n                        if (index != undefined)\r\n                            self.resultsLayer.map.zoomToFeatures([self.resultsLayer.features[index]]);\r\n                    });\r\n                    col[i].addEventListener(\"mouseenter\", function () {\r\n                        var index = this.dataset.index;\r\n                        if (index == undefined) return;\r\n                        var feat = self.resultsLayer.features[index]\r\n                        if (feat && feat.geometry) {\r\n                            //feat.select();\r\n                            _select(feat);\r\n                        }\r\n                        var celdasHoja = this.querySelectorAll(\"td.value div\");\r\n                        if (celdasHoja.length > 0) {\r\n                            celdasHoja.forEach(function (celda) {\r\n                                if (celda.offsetWidth < celda.scrollWidth)\r\n                                    celda.title = celda.innerText;\r\n                            })\r\n                        }\r\n                        else\r\n                            this.querySelectorAll(\"td\").forEach(function (td) {\r\n                                if (td.offsetWidth < td.scrollWidth)\r\n                                    td.title = td.innerText;\r\n                            });\r\n\r\n                    });\r\n                    col[i].addEventListener(\"mouseleave\", function () {\r\n                        var index = this.dataset.index;\r\n                        if (index == undefined) return;\r\n                        var feat = self.resultsLayer.features[index]\r\n                        if (feat && feat.geometry) {\r\n                            //feat.unselect();\r\n                            _unselect(feat)\r\n                            //esto es porque el unselect no devulve al estilo por defecto\r\n                            //feat.setStyle(TC.Cfg.styles[feat.STYLETYPE]);\r\n                        }\r\n                    });\r\n                }\r\n                tabla.querySelectorAll(\".complexAttr label,.complexAttr input\").forEach(function (label) {\r\n                    label.addEventListener(\"click\", function (e) {\r\n                        e.stopPropagation();\r\n                    })\r\n                });\r\n                tabla.querySelectorAll(\".complexAttr input\").forEach(function (chkBox) {\r\n                    chkBox.addEventListener(\"change\", function (e) {\r\n                        if (this.checked) {\r\n                            this.nextElementSibling.querySelectorAll(\"td.value div\").forEach(function (div) {\r\n                                if (div.offsetWidth < div.scrollWidth)\r\n                                    div.title = div.innerText;\r\n                            });\r\n                        }\r\n                    })\r\n                });\r\n\r\n                ////se deshabilita el swipe para que se pueda hacer scroll horizontal del panel de resultados\r\n                if (TC.browserFeatures.touch()) {\r\n                    TC.Util.swipe(self.resultsPanel.div, 'disable');\r\n                }\r\n            }\r\n        });\r\n\r\n    };\r\n\r\n    ctlProto.showGeometryPanel = async function (mode) {\r\n        const self = this;\r\n        TC.Util.closeModal();\r\n        if (!self.geometryPanel) {\r\n            const ctlOptions = {\r\n                titles: {\r\n                    main: self.getLocaleString('query.spatialFilter')\r\n                }\r\n            };\r\n            const ctlContainer = self.map.getControlsByClass(TC.control.ControlContainer)[0];\r\n            if (ctlContainer) {\r\n                ctlOptions.position = ctlContainer.POSITION.RIGHT;\r\n                self.geometryPanel = await ctlContainer.addControl('resultsPanel', ctlOptions);\r\n            }\r\n            else {\r\n                self.geometryPanel = await self.map.addControl('resultsPanel', ctlOptions);\r\n            }\r\n            self.map\r\n                .on(TC.Consts.event.RESULTSPANELCLOSE, function onResultsPanelClose(e) {\r\n                    if (e.control === self.geometryPanel) {\r\n                        setTimeout(() => self.drawControl.cancel(), 500); // timeout para evitar una llamada indeseada a GFI.\r\n                        TC.Util.showModal(self.modalDialog, {\r\n                            closeCallback: () => self.clearFilters()\r\n                        });\r\n                    }\r\n                });\r\n            const html = await self.getRenderedHtml(self.CLASS + '-geom');\r\n            self.geometryPanel.open(html);\r\n            self.geometryPanel.div.querySelector(`.${self.CLASS}-geom-btn-ok`).addEventListener(TC.Consts.event.CLICK, function () {\r\n                self.geometryPanel.close();\r\n            }, { passive: true });\r\n            if (!self.drawControl) {\r\n                self.drawControl = await self.map.addControl('draw', {\r\n                    div: self.geometryPanel.getTableContainer().querySelector(`.${self.CLASS}-geom-draw`),\r\n                    styles: self.styles\r\n                });\r\n                self.drawControl.on(TC.Consts.event.DRAWEND, function (e) {\r\n                    e.feature.showsPopup = false;\r\n                    self.geometryPanel.close();\r\n                    \r\n                    const op = self.modalDialog.querySelector(`input[name=\"${self.id}-condition\"]:checked`).value;\r\n                    let filter;\r\n                    switch (op) {\r\n                        case 'intersects':\r\n                            filter = new TC.filter.Intersects(null, e.feature, self.map.crs);\r\n                            break;\r\n                        default:\r\n                            filter = new TC.filter.Within(null, e.feature, self.map.crs);\r\n                    }\r\n                    filter._abbr = op;\r\n                    switch (e.target.mode) {\r\n                        case 'polygon':\r\n                            filter._valueToShow = self.getLocaleString('polygon');\r\n                            break;\r\n                        case 'line':\r\n                            filter._valueToShow = self.getLocaleString('line');\r\n                            break;\r\n                        case 'rectangle':\r\n                            filter._valueToShow = self.getLocaleString('box');\r\n                            break;\r\n                    }\r\n                    self.filters.push(filter);\r\n                    _renderFilterConditions(self);\r\n                    TC.Util.showModal(self.modalDialog, {\r\n                        closeCallback: () => self.clearFilters()\r\n                    });\r\n                });\r\n            }\r\n        }\r\n        else {\r\n            self.geometryPanel.open();\r\n        }\r\n        self.geometryPanel.div.querySelector(`.${self.CLASS}-geom-draw`).classList.toggle(TC.Consts.classes.HIDDEN, !mode);\r\n        self.geometryPanel.div.querySelector(`.${self.CLASS}-geom-btn`).classList.toggle(TC.Consts.classes.HIDDEN, !!mode);\r\n        if (mode) {\r\n            self.drawControl.setMode(mode, true);\r\n        }\r\n    };\r\n\r\n    const _manageDescribeFeature = function (data, ctl) {\r\n        ctl.clearFilters();\r\n        _internalGetDataTypes = function () {\r\n            return data;\r\n        };\r\n        for (var key in data) {\r\n            const value = data[key];\r\n            if (TC.Util.isGeometry(value.type)) {\r\n                value.isGeometry = true;\r\n            }\r\n        }\r\n        ctlProto.getRenderedHtml(ctlProto.CLASS + \"-form\",\r\n            {\r\n                operators: filterByOperation,\r\n                attributes: data,\r\n                controlId: ctl.id\r\n            }, function (html) {\r\n                const dialog = ctl.modalDialog;\r\n                const form = ctl.getForm();\r\n                empty(form);\r\n                form.insertAdjacentHTML('beforeend', html);\r\n                modalBody.classList.remove(loadingCssClass);\r\n                TC.loadJS(\r\n                    true,\r\n                    [TC.apiLocation + 'TC/ui/autocomplete.js'],\r\n                    function () {\r\n                        console.log(\"autocomplete loaded\");\r\n                    });\r\n                var combo = form.getElementsByClassName(\"tc-combo\");\r\n                if (combo.length == 0)\r\n                    dialog.getElementsByClassName(\"tc-button tc-ctl-wlm-btn-launch\")[0].setAttribute(\"disabled\", \"\");\r\n                else {\r\n                    dialog.getElementsByClassName(\"tc-button tc-ctl-wlm-btn-launch\")[0].removeAttribute(\"disabled\");\r\n                    combo[0].addEventListener(\"change\", function () {\r\n                        _changeAttributeEvent.apply(this, [form, data]);\r\n                    });\r\n                    form.querySelectorAll(`input[name=\"${ctl.id}-condition\"]`).forEach(ipt => {\r\n                        ipt.addEventListener('change', function (e) {\r\n                            form.querySelector(`.${ctlProto.CLASS}-geomtype-line-btn`).disabled = e.target.value === 'within';\r\n                        });\r\n                    });\r\n                    form.querySelectorAll(`.tc-ctl-wfsquery-where input[type=\"radio\"][name=\"${ctl.id}-log-op\"]`).forEach(radio => radio.addEventListener(\"change\", function () {\r\n                        logicalOperator = this.value === \"OR\" ? TC.Consts.logicalOperator.OR : TC.Consts.logicalOperator.AND\r\n                        //reemplazar en la lista\r\n                        //form.getElementsByClassName(\"tc-ctl-wfsquery-where-list-op\")[0].innerHTML = this.nextElementSibling.innerHTML;\r\n                    }));\r\n\r\n                    form.querySelector(\".tc-button\").addEventListener(TC.Consts.event.CLICK, function () {\r\n                        var valueField = form.querySelector('input.tc-textbox');\r\n                        TC.UI.autocomplete.call(valueField, \"clear\");\r\n                        if (inputMaskNumber)\r\n                            inputMaskNumber.masked.remove();\r\n                        if (!_validate(form)) {\r\n                            return;\r\n                        }\r\n                        var field = [].reduce.call(form.querySelectorAll('.tc-combo'), function (vi, va) {\r\n                            return vi + (vi ? \"/\" : \"\") + va.value;\r\n                        }, '');\r\n                        const checkedOp = form.querySelector('.tc-ctl-wfsquery input[type=\"radio\"]:checked');\r\n                        var op = checkedOp.value;\r\n\r\n                        var value = _getValue(valueField);\r\n                        let valueToShow = _getValueToShow(valueField);\r\n                        switch (true) {\r\n                            case type.indexOf(\"int\") >= 0:\r\n                                valueToShow = parseInt(value, 10)\r\n                                break;\r\n                            case type.indexOf(\"float\") >= 0:\r\n                            case type.indexOf(\"double\") >= 0:\r\n                            case type.indexOf(\"long\") >= 0:\r\n                            case type.indexOf(\"decimal\") >= 0:\r\n                                valueToShow = parseFloat(value, 10)\r\n                                break;\r\n                            case type.indexOf(\"string\") >= 0 && op!==\"empty\":\r\n                                valueToShow = '\"' + valueToShow + '\"';\r\n                                break;\r\n                        }\r\n\r\n\r\n                        //reemplazo < y > por y &lt;&gt;\r\n                        //value = value.replace(\"<\", \"&lt;\").replace(\">\", \"&gt;\");\r\n                        //escapo los caracteres no alfamericos                    \r\n                        //value = value.replace(/[^a-z\\dáéíóúü]/gi, '!' + '$&');\r\n                        //se añade asterisco al principio y/o final del valor para las busquedas: \"empieza por\", \"termina en\" o \"contiene\"\r\n                        var f;\r\n                        if (type.indexOf(\"dateTime\") >= 0 || type.indexOf(\"date\") >= 0) {\r\n                            const from = value + \"T00:00:00Z\";\r\n                            const to = value + \"T23:59:59Z\";\r\n                            if (op === \"nbtw\") {\r\n                                //el not bettween es un caso es especial por que concatena un filtro not y otro between\r\n                                f = new TC.filter.not(TC.filter.between(field, from, to));\r\n                            }\r\n                            else {\r\n                                f = new filterByOperation[op].Ctor(field, from, to);\r\n                            }\r\n                        }\r\n                        else {\r\n                            f = new filterByOperation[op].Ctor(\r\n                                field,\r\n                                (((op === \"ends\" || op === \"contains\") ? '*' : '') + value + ((op === \"starts\" || op === \"contains\") ? '*' : '')));\r\n                        }\r\n                        f.matchCase = false;\r\n                        f._abbr = op;\r\n                        f._valueToShow = valueToShow;\r\n                        ctl.filters.push(f);\r\n\r\n                        _renderFilterConditions(ctl);\r\n                        valueField.value = \"\";\r\n                    }, { passive: true });\r\n\r\n                    const onGeomClick = function (e) {\r\n                        ctl.showGeometryPanel(e.target.value);\r\n                    };\r\n                    form.querySelectorAll(\"button[name='geometry']\").forEach(btn => btn.addEventListener(TC.Consts.event.CLICK, onGeomClick, { passive: true }));\r\n                }\r\n            });\r\n    };\r\n\r\n    const _renderQueryForm = function (args) {\r\n        const self = args[0], layer = args[1], dialog = args[2], capabilities = args[3];\r\n        self.modalDialog = dialog;\r\n        _currentLayer = layer;\r\n        _currentLayercapabilities = capabilities;\r\n        _currentLayerURL = capabilities.Operations.DescribeFeatureType.DCP.HTTP.Get[\"href\"];\r\n        _currentLayerURL = _currentLayerURL.substring(_currentLayerURL.indexOf(\":\") + 1);\r\n        if (capabilities.Operations.GetFeature.CountDefault)\r\n            _maxRecordCount = capabilities.Operations.GetFeature.CountDefault.DefaultValue;\r\n        else\r\n            _maxRecordCount = null;\r\n        //analizamos si es una o varias capas, si es una agrupación la disgregamos \r\n        var layers = layer.getDisgregatedLayerNames ? layer.getDisgregatedLayerNames() : layer.featureType;\r\n        //quitamos aquellas que no estén disponibles en el WFS\r\n        layers = layers.filter(function (l) {\r\n            return capabilities.FeatureTypes.hasOwnProperty(l.substring(l.indexOf(\":\") + 1));\r\n        });\r\n        if (layers.length > 1) {\r\n            modalBody.classList.remove(loadingCssClass);\r\n            //bindeamos el onchange de combo\r\n            dialog.getElementsByClassName(\"tc-combo\")[0].addEventListener(\"change\", function () {\r\n                if (!this.value) {\r\n                    var form = self.getForm();\r\n                    empty(form);\r\n                    for (var i = 0; i < form.children.length; i++) form.removeChild(form.children[i]);\r\n                    self.clearFilters();\r\n                    return;\r\n                }\r\n                dialog.querySelector(\".tc-modal-body .tc-ctl-wfsquery-message\", dialog).classList.add(hiddenCssClass);\r\n                _currentLayerTitle = this.options[this.selectedIndex].text;\r\n                modalBody.classList.add(loadingCssClass);\r\n                _currentLayerName = this.value;\r\n                _currentLayer.describeFeatureType(this.value).then(function (data) {\r\n                    var entries = Object.entries(data);\r\n                    _manageDescribeFeature(entries.length > 1 ? data : entries[0][1], self);\r\n                }, function (err) {\r\n                    var tbody = dialog.getElementsByClassName(\"tc-modal-body\")[0];\r\n                    tbody.classList.remove(loadingCssClass);\r\n                    if (!err)\r\n                        tbody.insertAdjacentHTML('beforeend', \"<div class=\\\"tc-ctl-wfsquery-message tc-msg-warning\\\">\" + getLocaleString(\"query.LayerNotAvailable\") + \"</div>\");\r\n                    else\r\n                        tbody.insertAdjacentHTML('beforeend', \"<div class=\\\"tc-ctl-wfsquery-message tc-msg-error\\\">\" + err + \"</div>\");\r\n                });\r\n            });\r\n        }\r\n        else if (layers.length === 1) {\r\n            //comprabamos que la capa existe en el capabilities\r\n            var layerCapabilities = capabilities.FeatureTypes[layers[0].substring(layers[0].indexOf(\":\") + 1)];\r\n            if (layerCapabilities) {\r\n                _currentLayerTitle = capabilities.FeatureTypes[layers[0].substring(layers[0].indexOf(\":\") + 1)].Title;\r\n                _currentLayerName = layers[0];\r\n                _currentLayer.describeFeatureType(layers[0]).then(function (data) {\r\n                    var entries = Object.entries(data);\r\n                    _manageDescribeFeature(entries.length > 1 ? data : entries[0][1], self);\r\n                }, function (err) {\r\n                    var tbody = dialog.getElementsByClassName(\"tc-modal-body\")[0];\r\n                    tbody.classList.remove(loadingCssClass);\r\n                    if (!err)\r\n                        tbody.insertAdjacentHTML('beforeend', \"<div class=\\\"tc-ctl-wfsquery-message tc-msg-warning\\\">\" + getLocaleString(\"query.LayerNotAvailable\") + \"</div>\");\r\n                    else\r\n                        tbody.insertAdjacentHTML('beforeend', \"<div class=\\\"tc-ctl-wfsquery-message tc-msg-error\\\">\" + err + \"</div>\");\r\n\r\n                });\r\n            }\r\n            else {\r\n                var tbody = dialog.getElementsByClassName(\"tc-modal-body\")[0];\r\n                tbody.classList.remove(loadingCssClass);\r\n                tbody.insertAdjacentHTML('beforeend', \"<div class=\\\"tc-ctl-wfsquery-message tc-msg-warning\\\">\" + getLocaleString(\"query.LayerNotAvailable\") + \"</div>\");\r\n                //TC.Util.closeModal();\r\n                //layer.map.toast(\"Mal\", { type: TC.Consts.msgType.WARNING });\r\n            }\r\n\r\n        }\r\n        else {\r\n            TC.Util.closeModal();\r\n            layer.map.toast(TC.Util.getLocaleString(layer.map.options.locale, \"query.LayerNotAvailable\"), { type: TC.Consts.msgType.ERROR });\r\n        }\r\n    };\r\n\r\n    const _renderModalDialog = function (layer, layerName, capabilities, callback) {\r\n        const self = this;\r\n        let layers;\r\n        if (layer.getDisgregatedLayerNames) {\r\n            layers = [];\r\n            layer.getDisgregatedLayerNames().forEach(function (value, index) {\r\n                var path = layer.getPath(value);\r\n                //quitamos aquellas que no estén disponibles en el WFS\r\n                if (capabilities.FeatureTypes.hasOwnProperty(value.substring(value.indexOf(\":\") + 1)))\r\n                    layers.push({ name: value, title: path[path.length - 1] });\r\n            });\r\n            layers.sort(function (a, b) {\r\n                if (a.title < b.title) return -1;\r\n                if (a.title > b.title) return 1;\r\n                return 0;\r\n            });\r\n        }\r\n        else {\r\n            layers = layer.featureType;\r\n        }\r\n\r\n        self.getRenderedHtml(self.CLASS + \"-dialog\",\r\n            {\r\n                layerName: getLocaleString(\"query.titleDialog\", { \"layerName\": layerName }),\r\n                layers: layers\r\n            }, function (html) {\r\n                // Borramos diálogos previos\r\n                document.body.querySelectorAll(`.${self.CLASS}-dialog`).forEach(elm => elm.remove());\r\n\r\n                var d = document.createElement(\"div\");\r\n                d.insertAdjacentHTML('beforeEnd', html);\r\n                var modal = null;\r\n                if (d.childNodes.length > 0) {\r\n                    modal = d.firstChild;\r\n                    document.body.appendChild(modal);\r\n                }\r\n                modalBody = modal.getElementsByClassName(\"tc-modal-body\")[0]\r\n                modalBody.classList.add(loadingCssClass);\r\n\r\n                TC.Util.showModal(modal, {\r\n                    closeCallback: () => self.clearFilters()\r\n                });\r\n                //IE me hace la puñeta con los estilos, no me fuciona el calc el el max-height así que lo calculo cada vez que muestro el dialogo\r\n                if (TC.Util.detectIE()) {\r\n                    var coef = 1;\r\n                    switch (true) {\r\n                        case document.body.clientWidth > 768 && document.body.clientWidth < document.body.clientHeight:\r\n                        case document.body.clientWidth > 1024:\r\n                            coef = 0.8;\r\n                        case document.body.clientWidth > 1140:\r\n                            coef = 0.7;\r\n                            break;\r\n                    }\r\n                    modalBody.style.maxHeight = (document.body.clientHeight * coef) - modalBody.nextElementSibling.clientHeight - modalBody.previousElementSibling.clientHeight;\r\n                }\r\n                self.modalDialog = modal;\r\n                modal.getElementsByClassName(\"tc-button tc-ctl-wlm-btn-launch\")[0].addEventListener(\"click\", function () {\r\n                    self.sendQuery();\r\n                })\r\n                if (callback) callback(modal);\r\n            });\r\n    };\r\n\r\n    ctlProto.renderModalDialog = function (layer) {\r\n        const self = this;\r\n        let title;\r\n        let capabilitiesPromise;\r\n        if (layer.type === TC.Consts.layerType.WMS) {\r\n            const path = layer.getPath();\r\n            title = path[path.length - 1];\r\n            capabilitiesPromise = layer.getWFSCapabilities();\r\n        }\r\n        else if (layer.type === TC.Consts.layerType.WFS) {\r\n            title = layer.title;\r\n            capabilitiesPromise = layer.getCapabilitiesPromise();\r\n        }\r\n        else {\r\n            return;\r\n        }\r\n        let renderDialogPromise = new Promise(function (resolve, reject) {\r\n            capabilitiesPromise.then(function (capabilities) {\r\n                _renderModalDialog.apply(self, [\r\n                    layer,\r\n                    title,\r\n                    capabilities,\r\n                    function (modal) {\r\n                        resolve(modal);\r\n                    }]);\r\n            })\r\n        });\r\n\r\n        Promise.all([self, layer, renderDialogPromise, capabilitiesPromise]).then(_renderQueryForm);\r\n    };\r\n\r\n    ctlProto.removeFilter = function (filter) {\r\n        const self = this;\r\n        let idx = filter;\r\n        if (filter instanceof TC.filter.Filter) {\r\n            idx = self.filters.indexOf(filter);\r\n        }\r\n        if (idx >= 0 && idx < self.filters.length) {\r\n            const removedFilter = self.filters.splice(idx, 1)[0];\r\n            if (removedFilter instanceof TC.filter.Spatial) {\r\n                removedFilter.geometry.layer.removeFeature(removedFilter.geometry);\r\n            }\r\n            _renderFilterConditions(self);\r\n        }\r\n    }\r\n\r\n    ctlProto.clearFilters = function () {\r\n        const self = this;\r\n        self.filters\r\n            .filter(f => f instanceof TC.filter.Spatial)\r\n            .forEach(f => f.geometry.layer.removeFeature(f.geometry));\r\n        self.filters.length = 0;\r\n    };\r\n\r\n    ctlProto.getForm = function () {\r\n        const self = this;\r\n        return self.modalDialog && self.modalDialog.querySelector('.tc-modal-form');\r\n    };\r\n\r\n})();"]}