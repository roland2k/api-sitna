{"version":3,"sources":["control/Share.js"],"names":["TC","control","MapInfo","syncLoadJS","apiLocation","Share","options","this","_classSelector","CLASS","Control","apply","arguments","exportsState","opts","_dialogDiv","Util","getDiv","dialogDiv","window","$","_$dialogDiv","document","body","appendChild","render","inherit","ctlProto","prototype","MAILTO_MAX_LENGTH","IFRAME_WIDTH","IFRAME_HEIGHT","FEATURE_PARAM","MOBILEFAV","NAVALERT","callback","self","getRenderedHtml","html","innerHTML","then","renderData","call","controlId","id","queryCommandSupported","div","querySelectorAll","forEach","btn","classList","remove","input","dataset","dataOriginalTitle","detectMobile","querySelector","add","Consts","classes","HIDDEN","span","addEventListener","event","CLICK","e","label","tagName","parentElement","newFormat","value","option","toggle","matches","passive","isFunction","getLocation","result","location","href","hash","substr","indexOf","manageMaxLengthExceed","maxLengthExceed","browser","qr","generateIframe","async","url","urlString","generateLink","loadParamFeature","featureToShow","getParameterByName","featureObj","JSON","parse","decodeURIComponent","escape","atob","error","getLocaleString","msgErrorMode","TOAST","map","geom","addLayer","getUID","type","layerType","VECTOR","title","owner","stealth","layer","paramFeatureLayer","importState","features","zoomToFeatures","register","EventTarget","listenerBySelector","evt","trim","length","link","registerListeners","on","MAPCHANGE","selectInputField","elm","shorten","shortenedLink","textContent","setTimeout","unselectInputField","select","contains","getSelection","removeAllRanges","addRange","createRange","target","isCopyBtn","execCommand","copy","stopImmediatePropagation","preventDefault","encodeURIComponent","toast","msgType","WARNING","qrContainer","makeQRCode","qrCodeBase64","showModal","openSocialMedia","win","process","close","w","open","waText","undefined","bookmarkURL","bookmarkTitle","alert","sidebar","addPanel","test","navigator","userAgent","opera","print","external","AddFavorite","template","compiler","main","container","depth0","helpers","partials","data","alias1","nullContext","alias2","escapeExpression","alias3","lambda","lookupProperty","parent","propertyName","Object","hasOwnProperty","name","loc","start","line","column","end","useData","shareIconContainer","textboxes","buttons","LOADING","tb","disabled"],"mappings":"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","sourcesContent":["TC.control = TC.control || {};\r\n\r\nif (!TC.control.MapInfo) {\r\n    TC.syncLoadJS(TC.apiLocation + 'TC/control/MapInfo');\r\n}\r\n\r\nTC.control.Share = function (options) {\r\n    var self = this;\r\n    self._classSelector = '.' + self.CLASS;\r\n\r\n    TC.Control.apply(self, arguments);\r\n\r\n    self.exportsState = true;\r\n\r\n    var opts = options || {};\r\n    self._dialogDiv = TC.Util.getDiv(opts.dialogDiv);\r\n    if (window.$) {\r\n        self._$dialogDiv = $(self._dialogDiv);\r\n    }\r\n    if (!opts.dialogDiv) {\r\n        document.body.appendChild(self._dialogDiv);\r\n    }\r\n\r\n    self.render();\r\n};\r\n\r\nTC.inherit(TC.control.Share, TC.control.MapInfo);\r\n\r\n(function () {\r\n    var ctlProto = TC.control.Share.prototype;\r\n\r\n    ctlProto.CLASS = 'tc-ctl-share';\r\n    ctlProto.MAILTO_MAX_LENGTH = 256;\r\n    ctlProto.IFRAME_WIDTH = '600px';\r\n    ctlProto.IFRAME_HEIGHT = '450px';\r\n    ctlProto.FEATURE_PARAM = 'showfeature';\r\n\r\n    ctlProto.MOBILEFAV = 'Siga las instrucciones del navegador del dispositivo móvil para añadir como favorito. Se guardará el estado actual del mapa.';\r\n    ctlProto.NAVALERT = ' +D para guardar en marcadores.';\r\n\r\n\r\n    ctlProto.render = function (callback) {\r\n        const self = this;\r\n        return self.getRenderedHtml(self.CLASS + '-dialog', null, function (html) {\r\n            self._dialogDiv.innerHTML = html;\r\n        }).then(function () {\r\n            return TC.Control.prototype.renderData.call(self, { controlId: self.id }, function () {\r\n                //Si el navegador no soporta copiar al portapapeles, ocultamos el botón de copiar\r\n                if (document.queryCommandSupported && document.queryCommandSupported('copy')) {\r\n                    self.div.querySelectorAll('button').forEach(function (btn) {\r\n                        btn.classList.remove('hide');\r\n                    });\r\n                    self.div.querySelectorAll('input[type=text]').forEach(function (input) {\r\n                        delete input.dataset.dataOriginalTitle;\r\n                    });\r\n                }\r\n\r\n                // Si el SO no es móvil, ocultamos el botón de compartir a WhatsApp\r\n                if (!TC.Util.detectMobile()) {\r\n                    self.div.querySelector(\".share-whatsapp\").classList.add(TC.Consts.classes.HIDDEN);\r\n                }\r\n\r\n                const options = self.div.querySelectorAll('.' + self.CLASS + '-url-box');\r\n                self.div.querySelectorAll('span:not(.tc-beta)').forEach(function (span) {\r\n                    span.addEventListener(TC.Consts.event.CLICK, function (e) {\r\n                        var label = this;\r\n                        while (label && label.tagName !== 'LABEL') {\r\n                            label = label.parentElement;\r\n                        }\r\n                        const newFormat = label.querySelector(`input[type=radio][name=\"${self.id}-format\"]`).value;\r\n\r\n                        options.forEach(function (option) {\r\n                            option.classList.toggle(TC.Consts.classes.HIDDEN, !option.matches('.tc-' + newFormat));\r\n                        });\r\n                    }, { passive: true });\r\n                });\r\n                if (TC.Util.isFunction(callback)) {\r\n                    callback();\r\n                }\r\n            });\r\n        });\r\n    };\r\n\r\n    /**\r\n     * Obtiene una URL \"limpia\" para compartir el mapa.\r\n     */\r\n    ctlProto.getLocation = function () {\r\n        var result = window.location.href;\r\n        if (window.location.hash) {\r\n            result = result.substr(0, result.indexOf(window.location.hash));\r\n        }\r\n        return result;\r\n    };\r\n\r\n    ctlProto.manageMaxLengthExceed = function (maxLengthExceed) {\r\n        const self = this;\r\n\r\n        const browserAlert = self.div.querySelector('.' + self.CLASS + '-alert');\r\n        //Si la URL sobrepasa el tamaño máximo avisamos que puede fallar en Edge\r\n        browserAlert.classList.toggle(TC.Consts.classes.HIDDEN, !maxLengthExceed.browser);\r\n\r\n        const qrAlert = self._dialogDiv.querySelector('.' + self.CLASS + '-qr-alert');\r\n        qrAlert.classList.toggle(TC.Consts.classes.HIDDEN, !maxLengthExceed.qr);\r\n    };\r\n\r\n    ctlProto.generateIframe = async function (url) {\r\n        const self = this;\r\n        const urlString = url || await self.generateLink();\r\n        if (urlString) {\r\n            return '<iframe style=\"width:' + self.IFRAME_WIDTH + ';height:' + self.IFRAME_HEIGHT + ';\" src=\"' + urlString + '\"></iframe>';\r\n        }\r\n        return '';\r\n    }\r\n\r\n    ctlProto.loadParamFeature = function () {\r\n        const self = this;\r\n        var result = null;\r\n        var featureToShow = TC.Util.getParameterByName(self.FEATURE_PARAM);\r\n        if (featureToShow) {\r\n            var featureObj;\r\n            try {\r\n                featureObj = JSON.parse(decodeURIComponent(escape(window.atob(featureToShow))));\r\n            }\r\n            catch (error) {\r\n                TC.error(self.getLocaleString('sharedFeatureNotValid'), TC.Consts.msgErrorMode.TOAST);\r\n            }\r\n            if (featureObj && self.map) {\r\n                if (featureObj.geom) {\r\n                    self.map.addLayer({\r\n                        id: self.getUID(),\r\n                        type: TC.Consts.layerType.VECTOR,\r\n                        title: self.getLocaleString('foi'),\r\n                        owner: self,\r\n                        stealth: true\r\n                    }).then(function (layer) {\r\n                        self.paramFeatureLayer = layer;\r\n                        layer.importState({ features: [featureObj] }).then(function () {\r\n                            self.map.zoomToFeatures(layer.features);\r\n                        });\r\n                    });\r\n                }\r\n                else {\r\n                    result = featureObj;\r\n                }\r\n            }\r\n        }\r\n        return result;\r\n    };\r\n\r\n    ctlProto.register = function (map) {\r\n        const self = this;\r\n\r\n        const result = TC.control.MapInfo.prototype.register.call(self, map);\r\n\r\n        self.exportsState = true;\r\n\r\n        self.MOBILEFAV = self.getLocaleString('mobileBookmarks.instructions');\r\n        self.NAVALERT = self.getLocaleString('bookmarks.instructions');\r\n\r\n        self.div.addEventListener('click', TC.EventTarget.listenerBySelector('h2', async function (evt) {\r\n            const input = self.div.querySelector('.tc-url input[type=text]');\r\n            if (input.value.trim().length === 0) {\r\n                const link = await self.generateLink();\r\n                self.registerListeners();\r\n                input.value = link;\r\n                self.div.querySelector('.tc-iframe input[type=text]').value = await self.generateIframe(link);\r\n            }            \r\n        }));\r\n\r\n        self.map.on(TC.Consts.event.MAPCHANGE, function (e) {\r\n            const self = this;\r\n            const input = self.div.querySelector('.tc-url input[type=text]');\r\n            if (input) {\r\n                input.dataset[\"update\"] = true;\r\n            }\r\n        });\r\n\r\n        var selectInputField = async function (elm, shorten) {\r\n            const input = elm.parentElement.querySelector(\"input[type=text]\");\r\n\r\n            if (shorten) {\r\n                if (input.dataset[\"update\"] || !input.dataset[\"shortened\"]) {\r\n                    self.shortenedLink()\r\n                        .then(async function (value) {\r\n                            if (value && value.trim().length > 0) {\r\n\r\n                                elm.textContent = self.getLocaleString('shortened');\r\n                                setTimeout(function () {\r\n                                    elm.textContent = self.getLocaleString('shorten');\r\n                                    unselectInputField();\r\n                                }, 1000);                                \r\n\r\n                                delete input.dataset[\"update\"];\r\n                                input.dataset[\"shortened\"] = true;\r\n                                input.value = value;\r\n\r\n                                input.select();\r\n\r\n                            } else {\r\n                                delete input.dataset[\"update\"];\r\n                                delete input.dataset[\"shortened\"];\r\n                                input.value = await self.generateLink();\r\n                            }\r\n                        });\r\n                }\r\n            } else {\r\n                if (!input.classList.contains('tc-url')) {\r\n                    input.value = await self.generateIframe();\r\n                } else {\r\n                    if (input.dataset[\"update\"]) {\r\n                        delete input.dataset[\"update\"];\r\n                        delete input.dataset[\"shortened\"];\r\n                        input.value = await self.generateLink();\r\n                    }\r\n                }\r\n\r\n                input.select();\r\n            }            \r\n        };\r\n\r\n        var unselectInputField = function () {\r\n            document.getSelection().removeAllRanges();\r\n            document.getSelection().addRange(document.createRange());\r\n        };\r\n\r\n        self.div.addEventListener('click', TC.EventTarget.listenerBySelector('.tc-ctl-share-url-box button', function (evt) {\r\n            const btn = evt.target;\r\n            const isCopyBtn = !(btn.classList.contains('shorten'));\r\n\r\n            const copy = async function (value) {\r\n                await selectInputField(btn);\r\n\r\n                document.execCommand('copy');\r\n\r\n                btn.textContent = self.getLocaleString('copied');\r\n\r\n                setTimeout(function () {\r\n                    btn.textContent = self.getLocaleString((isCopyBtn ? 'copy' : 'shorten'));\r\n                    unselectInputField();\r\n                }, 1000);\r\n            };\r\n\r\n            if (!isCopyBtn) {                \r\n                selectInputField(btn, true);\r\n            } else {\r\n                copy();\r\n            }\r\n        }));\r\n\r\n        self.div.addEventListener('click', TC.EventTarget.listenerBySelector('input[type=text]', function (evt) {\r\n            selectInputField(evt.target);\r\n        }));\r\n\r\n        //Deshabilitar el click de ratón en los enlaces de compartir cuando están deshabilitados\r\n        self.div.addEventListener('click', TC.EventTarget.listenerBySelector('.ga-share-icon.tc-disabled', function (evt) {\r\n            evt.stopImmediatePropagation();\r\n            evt.preventDefault();\r\n            return false;\r\n        }));\r\n\r\n        //Enviar por e-mail\r\n        self.div.addEventListener('click', TC.EventTarget.listenerBySelector('a.share-email', async function (evt) {\r\n            evt.preventDefault();\r\n            var url = await self.generateLink();\r\n\r\n            if (url) {\r\n                const body = encodeURIComponent(url + \"\\n\");\r\n                if (body.length > self.MAILTO_MAX_LENGTH) {\r\n                    map.toast(self.getLocaleString('urlTooLongForMailto'), { type: TC.Consts.msgType.WARNING });\r\n                }\r\n                window.location.href = 'mailto:?body=' + body;\r\n            }\r\n        }));\r\n\r\n        //Generar código QR        \r\n        self.div.addEventListener(\"click\", TC.EventTarget.listenerBySelector(\"a.qr-generator\", function (evt) {\r\n            evt.preventDefault();\r\n            const qrContainer = self._dialogDiv.querySelector(\".qrcode\");\r\n            qrContainer.innerHTML = '';\r\n\r\n            if (self._dialogDiv.querySelector('.' + self.CLASS + '-qr-alert').classList.contains(TC.Consts.classes.HIDDEN)) {\r\n                self.makeQRCode(qrContainer, 256, 256).then(function (qrCodeBase64) {\r\n                    if (qrCodeBase64) {\r\n                        TC.Util.showModal(self._dialogDiv.querySelector(self._classSelector + '-qr-dialog'));\r\n                    }\r\n                });\r\n            } else {\r\n                TC.Util.showModal(self._dialogDiv.querySelector(self._classSelector + '-qr-dialog'));\r\n            }\r\n        }));\r\n\r\n\r\n        const openSocialMedia = function (win, url, process) {\r\n            if (url && url.trim().length > 0) {\r\n                win.location.href = process(url);\r\n            } else {\r\n                TC.error(self.getLocaleString('urlTooLongForShortener'));\r\n                win.close();\r\n            }\r\n        };\r\n\r\n        //Compartir en Facebook\r\n        self.div.addEventListener(\"click\", TC.EventTarget.listenerBySelector(\"a.share-fb\", function (evt) {\r\n            evt.preventDefault();\r\n\r\n            const w = window.open();\r\n            self.shortenedLink().then(function (url) {\r\n                openSocialMedia(w, url, function (url) {\r\n                    return \"https://www.facebook.com/sharer/sharer.php?u=\" + encodeURIComponent(url)\r\n                });\r\n            });\r\n\r\n            return false;\r\n        }));\r\n\r\n        //Compartir en Twitter\r\n        self.div.addEventListener(\"click\", TC.EventTarget.listenerBySelector(\"a.share-twitter\", function (evt) {\r\n            evt.preventDefault();\r\n\r\n            const w = window.open();\r\n            self.shortenedLink().then(function (url) {\r\n                openSocialMedia(w, url, function (url) {\r\n                    var titulo = encodeURIComponent(window.document.title ? window.document.title : \"Visor API SITNA\");\r\n                    return \"https://twitter.com/intent/tweet?text=\" + titulo + \"&url=\" + encodeURIComponent(url);\r\n                });\r\n            });\r\n\r\n            return false;\r\n        }));\r\n\r\n        //Compartir en Whatsapp\r\n        if (TC.Util.detectMobile()) {\r\n            self.div.addEventListener(\"click\", TC.EventTarget.listenerBySelector(\"a.share-whatsapp\", function (evt) {\r\n                evt.preventDefault();\r\n\r\n                self.shortenedLink().then(async function (url) {\r\n                    var waText = 'whatsapp://send?text=';\r\n                    if (url !== undefined) {\r\n                        location.href = waText + encodeURIComponent(url);\r\n                    } else {\r\n                        location.href = waText + encodeURIComponent(await self.generateLink());\r\n                    }\r\n                });\r\n\r\n                return false;\r\n            }));\r\n        }\r\n\r\n        //Guardar en marcadores\r\n        self.div.addEventListener(\"click\", TC.EventTarget.listenerBySelector(\"a.share-star\", async function (evt) {\r\n            evt.preventDefault();\r\n\r\n            var bookmarkURL = await self.generateLink();\r\n            var bookmarkTitle = document.title;\r\n\r\n            if (TC.Util.detectMobile()) {\r\n                // Mobile browsers\r\n                alert(ctlProto.MOBILEFAV);\r\n            } else if (window.sidebar && window.sidebar.addPanel) {\r\n                // Firefox version < 23\r\n                window.sidebar.addPanel(bookmarkTitle, bookmarkURL, '');\r\n            } else if ((window.sidebar && /Firefox/i.test(navigator.userAgent)) || (window.opera && window.print)) {\r\n                // Firefox version >= 23 and Opera Hotlist                \r\n\r\n                window.location.href = bookmarkURL;\r\n                alert((/Mac/i.test(navigator.userAgent) ? 'Cmd' : 'Ctrl') + ctlProto.NAVALERT);\r\n\r\n            } else if (window.external && ('AddFavorite' in window.external)) {\r\n                // IE Favorite\r\n                window.external.AddFavorite(bookmarkURL, bookmarkTitle);\r\n            } else {\r\n                // Other browsers (mainly WebKit - Chrome/Safari)                \r\n                window.location.href = bookmarkURL;\r\n                alert((/Mac/i.test(navigator.userAgent) ? 'Cmd' : 'Ctrl') + ctlProto.NAVALERT);\r\n            }\r\n\r\n            return false;\r\n        }));\r\n\r\n        //Cuando se añada o borre una capa, comprobamos de nuevo si la URL cumple los requisitos de longitud para habilitar el control\r\n        //map.on(TC.Consts.event.MAPLOAD, function () {\r\n        //    map.on(TC.Consts.event.LAYERREMOVE + ' ' + TC.Consts.event.LAYERADD, function (e) {\r\n        //        self.generateLink();\r\n        //    });\r\n        //});        \r\n\r\n        return result;\r\n    };\r\n\r\n    ctlProto.template = {};\r\n    ctlProto.template[ctlProto.CLASS] = TC.apiLocation + \"TC/templates/tc-ctl-share.hbs\";\r\n    ctlProto.template[ctlProto.CLASS + '-dialog'] = TC.apiLocation + \"TC/templates/tc-ctl-share-dialog.hbs\";\r\n\r\n    ctlProto.generateLink = async function () {\r\n        const self = this;\r\n        const shareIconContainer = self.div.querySelector('.ga-share-icons');\r\n        const textboxes = self.div.querySelectorAll(`.${self.CLASS}-url-box tc-textbox`);\r\n        const buttons = self.div.querySelectorAll(`.${self.CLASS}-url-box button`);\r\n        const alert = self.div.querySelector('.' + self.CLASS + '-alert');\r\n        shareIconContainer.classList.add(TC.Consts.classes.LOADING);\r\n        textboxes.forEach(tb => tb.disabled = true);\r\n        buttons.forEach(btn => {\r\n            btn.classList.add(TC.Consts.classes.LOADING);\r\n            btn.disabled = true;\r\n        });\r\n        alert.classList.add(TC.Consts.classes.LOADING);\r\n        const result = await TC.control.MapInfo.prototype.generateLink.call(self);\r\n        textboxes.forEach(tb => tb.disabled = false);\r\n        buttons.forEach(btn => {\r\n            btn.disabled = false;\r\n            btn.classList.remove(TC.Consts.classes.LOADING);\r\n        });\r\n        shareIconContainer.classList.remove(TC.Consts.classes.LOADING);\r\n        alert.classList.remove(TC.Consts.classes.LOADING);\r\n        return result;\r\n    };\r\n\r\n})();"]}