{"version":3,"sources":["control/TabContainer.js"],"names":["TC","control","Container","syncLoadJS","apiLocation","TabContainer","apply","this","arguments","cs","_classSelector","CLASS","_selectors","TAB","RADIOBUTTON","id","ELEMENT","inherit","ctlProto","prototype","template","1","container","depth0","helpers","partials","data","blockParams","depths","alias1","lambda","alias2","escapeExpression","lookupProperty","parent","propertyName","Object","hasOwnProperty","call","3","compiler","main","stack1","nullContext","name","hash","fn","program","inverse","noop","loc","start","line","column","end","useData","useDepths","onRender","self","Promise","resolve","reject","title","getLocaleString","options","div","querySelector","innerHTML","bufferPromises","Array","ctlCount","i","len","controlOptions","length","ctl","ctlName","ctlOptions","undefined","console","log","keys","filter","key","map","addControl","Util","extend","uids","writeTitle","idx","renderPromise","then","parentElement","matches","all","controls","containerControl","render","callback","_set1stRenderPromise","renderData","controlId","count","clickHandler","e","closest","active","hidden","checkbox","newValue","value","elms","querySelectorAll","_oldValue","deselectable","setTimeout","checked","forEach","elm","push","classList","contains","Consts","classes","COLLAPSED","remove","MutationObserver","mutations","mutation","target","observe","attributes","HIDDEN","add","span","addEventListener","event","CLICK","passive","defaultSelection"],"mappings":"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","sourcesContent":["TC.control = TC.control || {};\r\n\r\nif (!TC.control.Container) {\r\n    TC.syncLoadJS(TC.apiLocation + 'TC/Control/Container');\r\n}\r\n\r\nTC.control.TabContainer = function () {\r\n    var self = this;\r\n\r\n    TC.control.Container.apply(self, arguments);\r\n\r\n    var cs = self._classSelector = '.' + self.CLASS;\r\n    self._selectors = {\r\n        TAB: cs + '-tab',\r\n        RADIOBUTTON: `input[type=radio][name=\"${self.id}-sel\"]`,\r\n        ELEMENT: cs + '-elm'\r\n    };    \r\n};\r\n\r\nTC.inherit(TC.control.TabContainer, TC.control.Container);\r\n\r\n(function () {\r\n    var ctlProto = TC.control.TabContainer.prototype;\r\n\r\n    ctlProto.CLASS = 'tc-ctl-tctr';\r\n\r\n    ctlProto.template = TC.apiLocation + \"TC/templates/tc-ctl-tctr.hbs\";\r\n\r\n    ctlProto.onRender = function () {\r\n        const self = this;\r\n\r\n        return new Promise(function (resolve, reject) {\r\n            self.title = self.title || self.getLocaleString(self.options.title || 'moreControls');\r\n            self.div.querySelector('h2').innerHTML = self.title;\r\n\r\n            var bufferPromises = new Array(self.ctlCount);\r\n            for (var i = 0, len = self.controlOptions.length; i < len; i++) {\r\n                var ctl = self.controlOptions[i];\r\n                var ctlName = \"\";\r\n                var ctlOptions = {};\r\n\r\n                // GLS: 20/01/2020 código compatibilidad hacia atrás\r\n                if (ctl[\"name\"] !== undefined && ctl[\"options\"] !== undefined) {\r\n                    console.log('Gestionamos config de tabContainer antiguo');\r\n\r\n                    ctlName = ctl[\"name\"];\r\n                    ctlOptions = ctl[\"options\"];\r\n                } else {\r\n                    ctlName = Object.keys(ctl).filter((key) => {\r\n                        return key !== \"title\";\r\n                    })[0];\r\n                    ctlOptions = ctl[ctlName];\r\n                }\r\n\r\n                bufferPromises[i] = self.map.addControl(ctlName, TC.Util.extend({\r\n                    id: self.uids[i],\r\n                    div: self.div.querySelector('.' + self.CLASS + '-elm-' + i)\r\n                }, ctlOptions));\r\n            }\r\n            var writeTitle = function (ctl, idx) {\r\n                ctl.renderPromise().then(function () {\r\n                    const title = self.getLocaleString(self.controlOptions[idx].title) || ctl.div.querySelector('h2').innerHTML;\r\n                    var parent = ctl.div;\r\n                    do {\r\n                        parent = parent.parentElement;\r\n                    }\r\n                    while (parent && !parent.matches(self._classSelector));\r\n                    parent.querySelector(self._selectors.TAB + '-' + idx + ' span').innerHTML = title;\r\n                });\r\n            };\r\n            Promise.all(bufferPromises).then(function (controls) {\r\n                for (var i = 0, len = controls.length; i < len; i++) {\r\n                    var ctl = controls[i];\r\n                    ctl.containerControl = self;\r\n                    writeTitle(ctl, i);\r\n                }\r\n                resolve(self);\r\n            });\r\n        });\r\n    };\r\n\r\n    ctlProto.render = function (callback) {\r\n        const self = this;\r\n        return self._set1stRenderPromise(self.renderData({\r\n            controlId: self.id,\r\n            title: self.title,\r\n            controls: self.controlOptions,\r\n            count: self.controlOptions.length\r\n        }, function () {\r\n\r\n            var clickHandler = function (e) {\r\n                var closest = this;\r\n                while (closest && !closest.matches(self._selectors.TAB)) {\r\n                    closest = closest.parentElement;\r\n                }\r\n                var active, hidden = [];\r\n                const checkbox = closest.querySelector(self._selectors.RADIOBUTTON);\r\n                const newValue = checkbox.value;\r\n                const elms = self.div.querySelectorAll(self._selectors.ELEMENT);\r\n                if (self._oldValue === newValue && self.options.deselectable) {\r\n                    setTimeout(function () {\r\n                        checkbox.checked = false;\r\n                    }, 0);\r\n                    self._oldValue = null;\r\n                    active = null;\r\n                    hidden = elms;\r\n                }\r\n                else {\r\n                    elms.forEach(function (elm) {\r\n                        if (elm.matches(self._selectors.ELEMENT + '-' + newValue)) {\r\n                            active = elm;\r\n                        }\r\n                        else {\r\n                            hidden.push(elm);\r\n                        }\r\n                    });\r\n                    self._oldValue = newValue;\r\n                }\r\n\r\n                if (active && active.classList.contains(TC.Consts.classes.COLLAPSED)) {\r\n                    active.classList.remove(TC.Consts.classes.COLLAPSED);\r\n\r\n                    // GLS 24/01/2020 necesitamos un mutation observer para poder quitar el tc.collapsed cuando volvamos de  \r\n                    // otro control ya que no hay click porque la pestaña ya está activa.\r\n                    var observerTabElementAddCollapsedClass = new MutationObserver(function (mutations) {                        \r\n                        mutations.forEach(function (mutation) {\r\n                            if (mutation.target.classList.contains(TC.Consts.classes.COLLAPSED)) {\r\n                                mutation.target.classList.remove(TC.Consts.classes.COLLAPSED);\r\n                            }\r\n                        });\r\n                    });\r\n                    \r\n                    observerTabElementAddCollapsedClass.observe(active, { attributes: true });                    \r\n                }\r\n\r\n                if (active) {\r\n                    active.classList.remove(TC.Consts.classes.HIDDEN);\r\n                }\r\n                hidden.forEach(function (elm) {\r\n                    elm.classList.add(TC.Consts.classes.HIDDEN);\r\n                });\r\n                checkbox.checked = true;\r\n            };\r\n\r\n            self.div.querySelectorAll('span').forEach(function (span) {\r\n                span.addEventListener(TC.Consts.event.CLICK, clickHandler, { passive: true });\r\n            });\r\n\r\n            // GLS: Si en el register de control se llama a render, ¿por qué volvemos a llamarlo aquí?\r\n            //for (var i = 0, len = self._ctlPromises.length; i < len; i++) {\r\n            //    self.getControl(i).then(function (ctl) {\r\n            //        ctl.render();\r\n            //    });\r\n            //}\r\n\r\n            if (typeof self.defaultSelection === 'number') {\r\n                clickHandler.call(self.div.querySelectorAll(self._selectors.RADIOBUTTON)[self.defaultSelection]);\r\n            }\r\n        }));\r\n    };\r\n\r\n})();\r\n"]}