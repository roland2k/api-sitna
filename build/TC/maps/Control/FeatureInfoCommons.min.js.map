{"version":3,"sources":["control/FeatureInfoCommons.js"],"names":["TC","control","Click","syncLoadJS","apiLocation","Consts","event","POPUP","POPUPHIDE","DRAWCHART","DRAWTABLE","RESULTSPANELCLOSE","FEATUREHIGHLIGHT","FEATUREDOWNPLAY","FeatureInfoCommons","apply","this","arguments","_selectors","LIST_ITEM","CLASS","SHOW_ALL_CHECKBOX","SHOW_ALL_LABEL","ZOOM_ALL_BUTTON","DEL_ALL_BUTTON","resultsLayer","filterLayer","_layersPromise","filterFeature","info","_infoHistory","popup","resultsPanel","lastFeatureCount","exportsState","inherit","ctlProto","prototype","CURRENT_CLASS","TITLE_SEPARATOR","DEFAULT_STROKE_COLOR","template","1","container","depth0","helpers","partials","data","stack1","alias1","nullContext","alias2","escapeExpression","alias3","lambda","lookupProperty","parent","propertyName","Object","hasOwnProperty","call","name","hash","loc","start","line","column","end","3","5","7","fn","program","inverse","8","10","11","13","15","17","18","noop","19","20","22","23","24","25","26","28","30","32","33","35","36","38","39","41","invokePartial","decorators","43","45","47","48","49","51","52","compiler","main","usePartial","useData","2","4","6","indent","9","12","14","16","setNotShowAllUI","self","menu","getMenuTarget","showAllCb","querySelector","checked","text","getLocaleString","innerHTML","setAttribute","classList","add","classes","HIDDEN","register","map","result","_createLayers","loaded","shareCtl","getControlsByClass","loadSharedFeature","loadParamFeature","setDisplayMode","options","displayMode","defaultInfoContainer","infoContainer","on","e","getDisplayControl","highlightedFeature","persistentHighlights","downplayFeature","querying","feature","removeFeature","currentFeature","caller","_decorateDisplay","setTimeout","LAYERREMOVE","keys","length","services","workLayers","filter","layer","type","layerType","WMS","forEach","names","url","concat","getDisgregatedLayerNames","featuresDeleted","historyService","service","historyLayer","indexOf","slice","f","closeResults","VIEWCHANGE","render","div","_set1stRenderPromise","Promise","resolve","responseCallback","featureCount","_addSourceAttributes","trigger","FEATUREINFO","Util","extend","NOFEATUREINFO","responseError","status","toast","msgType","ERROR","markerStyle","cssClass","POINT","anchor","width","height","noPrint","mode","RESULTS_PANEL","ctlPromise","resultsPanelOptions","content","titles","max","position","POSITION","RIGHT","addControl","document","createElement","appendChild","then","rp","closeButton","draggable","onShowPopup","_resetSize","getDisplayTarget","Popup","getContainerElement","ResultsPanel","getInfoContainer","getMenuElement","displayResults","clone","cloneNode","remove","outerHTML","ControlContainer","p","isVisible","close","chart","open","displayResultsCallback","showPopup","getElementIndex","elm","Array","from","parentElement","children","getParentElement","tagName","getFeatureFromListItem","ctl","li","currentFeatureLi","currentLayerLi","currentServiceLi","getFeature","getFeatureElement","lis","querySelectorAll","i","ii","getNextFeatureElement","delta","matches","getFeaturePath","j","jj","layers","k","kk","features","title","mapLayers","reduce","prev","cur","path","hide","onListItemClick","highlightFeature","target","addEventListener","nextBtn","CLICK","passive","prevBtn","onTitleClick","contains","CHECKED","anotherLayer","getComputedStyle","display","downplayFeatures","fitToView","h","getFeatures","getRenderedHtml","id","html","insertAdjacentHTML","async","downloadDialog","getDownloadDialog","fileName","_getFileName","elevation","displayElevation","assign","showAllFeatures","hideAllFeatures","zoomToFeatures","defaultFeature","DEFAULT","table","DISABLED","window","getSelection","toString","trim","ZOOM","zoomHandler","_zooming","off","animate","stopPropagation","a","browserFeatures","touch","style","swipe","sCount","lCount","left","right","_fitSize","featureObj","insertLinks","linkText","titleText","td","textContent","isURL","featureOrElement","featureLi","Feature","layerLi","serviceLi","serviceIdx","layerIdx","featureIdx","exception","displayTarget","FROMLEFT","FROMRIGHT","counter","getFeatureIndex","triggerEvent","geometry","showsPopup","addFeature","idx","splice","prevHlFeature","exceptionFLi","undefined","exceptionLLi","exceptionSLi","checkbox","Math","offsetLeft","offsetWidth","removeProperty","c","maxj","maxk","beforeRequest","BEFOREFEATUREINFO","xy","activate","wrap","Control","deactivate","stopChain","clearFeatures","exportState","importState","state","getUID","VECTOR","owner","stealth","styles","geometryType","geom","POLYLINE","POLYGON","polygon","reject","all","addLayer","resultsContainer","loadJS","Print","printTitle","Point","crs","x","formatCoord","isGeo","DEGREE_PRECISION","METER_PRECISION","y","printableElement","serviceAttrName","layerAttrName","newData","join","allData","getData","clearData","setData","toLowerCase","replace","getFormattedDate","Date"],"mappings":"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","sourcesContent":["TC.control = TC.control || {};\r\n\r\nif (!TC.control.Click) {\r\n    TC.syncLoadJS(TC.apiLocation + 'TC/control/Click');\r\n}\r\n\r\nTC.Consts.event.POPUP = TC.Consts.event.POPUP || 'popup.tc';\r\nTC.Consts.event.POPUPHIDE = TC.Consts.event.POPUPHIDE || 'popuphide.tc';\r\nTC.Consts.event.DRAWCHART = TC.Consts.event.DRAWCHART || 'drawchart.tc';\r\nTC.Consts.event.DRAWTABLE = TC.Consts.event.DRAWTABLE || 'drawtable.tc';\r\nTC.Consts.event.RESULTSPANELCLOSE = TC.Consts.event.RESULTSPANELCLOSE || 'resultspanelclose.tc';\r\nTC.Consts.event.FEATUREHIGHLIGHT = 'featurehighlight.tc';\r\nTC.Consts.event.FEATUREDOWNPLAY = 'featuredownplay.tc';\r\n\r\nTC.control.FeatureInfoCommons = function () {\r\n    const self = this;\r\n    TC.control.Click.apply(self, arguments);\r\n\r\n    self._selectors = {\r\n        LIST_ITEM: `ul.${self.CLASS}-features li`,\r\n        SHOW_ALL_CHECKBOX: `.${self.CLASS}-btn input[type=\"checkbox\"].${self.CLASS}-btn-show-all`,\r\n        SHOW_ALL_LABEL: `.${self.CLASS}-btn label.${self.CLASS}-btn-show-all`,\r\n        ZOOM_ALL_BUTTON: `.${self.CLASS}-btn .${self.CLASS}-btn-zoom-all`,\r\n        DEL_ALL_BUTTON: `.${self.CLASS}-btn .${self.CLASS}-btn-del-all`\r\n    };\r\n\r\n    self.resultsLayer = null;\r\n    self.filterLayer = null;\r\n    self._layersPromise = null;\r\n    self.filterFeature = null;\r\n    self.info = null;\r\n    self._infoHistory = {};\r\n    self.popup = null;\r\n    self.resultsPanel = null;\r\n    self.lastFeatureCount = null;\r\n    self.exportsState = true;\r\n};\r\n\r\n(function () {\r\n\r\n    var layerCount = function (ctl) {\r\n        return ctl.info && ctl.info.services ?\r\n            ctl.info.services.reduce(function (sCount, service) {\r\n                return sCount + service.layers.reduce(function (lCount, layer) {\r\n                    return lCount + 1;\r\n                }, 0);\r\n            }, 0) : 0;\r\n    };\r\n\r\n    TC.inherit(TC.control.FeatureInfoCommons, TC.control.Click);\r\n\r\n    var ctlProto = TC.control.FeatureInfoCommons.prototype;\r\n\r\n    ctlProto.CLASS = 'tc-ctl-finfo';\r\n\r\n    ctlProto.CURRENT_CLASS = 'tc-current';\r\n\r\n    ctlProto.TITLE_SEPARATOR = ' • ';\r\n    ctlProto.DEFAULT_STROKE_COLOR = '#0000ff';\r\n    \r\n    ctlProto.template = {};\r\n    ctlProto.template[ctlProto.CLASS] = TC.apiLocation + \"TC/templates/tc-ctl-finfo.hbs\";\r\n    ctlProto.template[ctlProto.CLASS + \"-object\"] = TC.apiLocation + \"TC/templates/tc-ctl-finfo-object.hbs\";\r\n    ctlProto.template[ctlProto.CLASS + \"-buttons\"] = TC.apiLocation + \"TC/templates/tc-ctl-finfo-buttons.hbs\";\r\n\r\n    const setShowAllUI = function () {\r\n        const self = this;\r\n        const menu = self.getMenuTarget();\r\n        const showAllCb = menu.querySelector(self._selectors.SHOW_ALL_CHECKBOX);\r\n        if (showAllCb) {\r\n            showAllCb.checked = true;\r\n            const text = self.getLocaleString('doNotShowOnMapAllResults');\r\n            menu.querySelector(self._selectors.SHOW_ALL_LABEL).setAttribute('title', text);\r\n            showAllCb.innerHTML = text;\r\n        }\r\n        menu.querySelector(self._selectors.ZOOM_ALL_BUTTON).classList.remove(TC.Consts.classes.HIDDEN);\r\n        menu.querySelector(self._selectors.DEL_ALL_BUTTON).classList.remove(TC.Consts.classes.HIDDEN);\r\n    };\r\n\r\n    const setNotShowAllUI = function () {\r\n        const self = this;\r\n        const menu = self.getMenuTarget();\r\n        const showAllCb = menu.querySelector(self._selectors.SHOW_ALL_CHECKBOX);\r\n        if (showAllCb) {\r\n            showAllCb.checked = false;\r\n            const text = self.getLocaleString('showOnMapAllResults');\r\n            showAllCb.innerHTML = text;\r\n            menu.querySelector(self._selectors.SHOW_ALL_LABEL).setAttribute('title', text);\r\n            menu.querySelector(self._selectors.ZOOM_ALL_BUTTON).classList.add(TC.Consts.classes.HIDDEN);\r\n            menu.querySelector(self._selectors.DEL_ALL_BUTTON).classList.add(TC.Consts.classes.HIDDEN);\r\n        }\r\n    };\r\n\r\n    ctlProto.register = function (map) {\r\n        const self = this;\r\n\r\n        const result = TC.control.Click.prototype.register.call(self, map);\r\n\r\n        self._createLayers();\r\n\r\n        map.loaded(function () {\r\n            const shareCtl = map.getControlsByClass('TC.control.Share')[0];\r\n            if (shareCtl) {\r\n                self.loadSharedFeature(shareCtl.loadParamFeature());\r\n            }\r\n            self.setDisplayMode(self.options.displayMode || map.defaultInfoContainer || TC.Consts.infoContainer.POPUP);\r\n        });\r\n\r\n        map\r\n            .on(TC.Consts.event.POPUPHIDE + ' ' + TC.Consts.event.RESULTSPANELCLOSE, function (e) {\r\n                if (e.control === self.getDisplayControl() && self.resultsLayer) {\r\n                    if (self.highlightedFeature && !self.options.persistentHighlights) {\r\n                        self.downplayFeature(self.highlightedFeature);\r\n                        self.highlightedFeature = null;\r\n                    }\r\n                    if (!self.querying && e.feature) {\r\n                        self.filterLayer.removeFeature(e.feature);\r\n                    }\r\n                }\r\n            })\r\n            //.on(TC.Consts.event.RESULTSPANELCLOSE, function (e) {\r\n            //    self.highlightedFeature = null;\r\n            //})\r\n            .on(TC.Consts.event.POPUP + ' ' + TC.Consts.event.DRAWTABLE + ' ' + TC.Consts.event.DRAWCHART, function (e) {\r\n                const control = e.control;\r\n                if (control.currentFeature !== self.filterFeature) {\r\n                    self.highlightedFeature = control.currentFeature;\r\n                }\r\n\r\n                // GLS: si la feature es resultado de GFI decoramos\r\n                if (e.control.caller == self) {\r\n                    self._decorateDisplay(control);\r\n                }\r\n\r\n            })\r\n            .on(TC.Consts.event.DRAWCHART, function (e) {\r\n                setTimeout(function () {\r\n                    self.highlightedFeature = e.control.currentFeature;\r\n                }, 50);\r\n            })\r\n            .on(TC.Consts.event.LAYERREMOVE, function () {\r\n                if (Object.keys(self._infoHistory).length) {\r\n                    const services = {};\r\n                    self.map.workLayers\r\n                        .filter(function (layer) {\r\n                            return layer.type === TC.Consts.layerType.WMS;\r\n                        })\r\n                        .forEach(function (layer) {\r\n                            const names = services[layer.url] || [];\r\n                            services[layer.url] = names.concat(layer.getDisgregatedLayerNames())\r\n                        });\r\n                    let featuresDeleted = false;\r\n                    for (let url in self._infoHistory) {\r\n                        const historyService = self._infoHistory[url];\r\n                        if (services.hasOwnProperty(url)) {\r\n                            const service = services[url];\r\n                            for (let name in historyService) {\r\n                                const historyLayer = historyService[name];\r\n                                if (service.indexOf(name) < 0) {\r\n                                    historyLayer.slice().forEach(f => self.downplayFeature(f));\r\n                                    historyLayer.length = 0;\r\n                                    featuresDeleted = true;\r\n                                }\r\n                            }\r\n                        }\r\n                        else {\r\n                            for (let name in historyService) {\r\n                                const historyLayer = historyService[name];\r\n                                historyLayer.slice().forEach(f => self.downplayFeature(f));\r\n                                featuresDeleted = true;\r\n                            }\r\n                            delete self._infoHistory[url];\r\n                        }\r\n                    }\r\n                    if (featuresDeleted) {\r\n                        self.closeResults();\r\n                    }\r\n                }\r\n            })\r\n            .on(TC.Consts.event.VIEWCHANGE, function (e) {\r\n                self.closeResults();\r\n            });\r\n\r\n        return result;\r\n    };\r\n\r\n    ctlProto.render = function () {\r\n        const self = this;\r\n        // Este div se usa como buffer, así que no debe ser visible.\r\n        self.div.classList.add(TC.Consts.classes.HIDDEN);\r\n        return self._set1stRenderPromise(Promise.resolve());\r\n    };\r\n\r\n    ctlProto.responseCallback = function (options) {\r\n        const self = this;\r\n        self.querying = false;\r\n\r\n        if (self.filterFeature) {\r\n            self.info = { services: options.services };\r\n        }\r\n\r\n        if (!options.featureCount) {\r\n            self.lastFeatureCount = 0;\r\n            self.map.trigger(TC.Consts.event.NOFEATUREINFO, { control: self });\r\n        }\r\n        else {\r\n            self._addSourceAttributes();\r\n            self.lastFeatureCount = options.featureCount;\r\n            self.map.trigger(TC.Consts.event.FEATUREINFO, TC.Util.extend({ control: self }, options));\r\n        }\r\n    };\r\n\r\n    ctlProto.responseError = function (options) {\r\n        const self = this;\r\n        if (options.status === 404) {\r\n            self.map.toast(self.getLocaleString(\"featureInfo.tooManyLayers\"), { type: TC.Consts.msgType.ERROR });\r\n        }\r\n        self.responseCallback({});\r\n    };\r\n\r\n    ctlProto.markerStyle = {\r\n        cssClass: TC.Consts.classes.POINT,\r\n        anchor: [0.5, 0.5],\r\n        width: 15,\r\n        height: 15,\r\n        noPrint: true\r\n    };\r\n\r\n    ctlProto.setDisplayMode = function (mode) {\r\n        const self = this;\r\n        self.displayMode = mode;\r\n        const map = self.map;\r\n        switch (mode) {\r\n            case TC.Consts.infoContainer.RESULTS_PANEL:\r\n                if (!self.resultsPanel) {\r\n                    let ctlPromise;\r\n                    const resultsPanelOptions = {\r\n                        content: \"table\",\r\n                        titles: {\r\n                            main: self.getLocaleString(\"threed.rs.panel.gfi\"),\r\n                            max: self.getLocaleString(\"threed.rs.panel.gfi\")\r\n                        }\r\n                    };\r\n                    const container = map.getControlsByClass('TC.control.ControlContainer')[0];\r\n                    if (container) {\r\n                        resultsPanelOptions.position = container.POSITION.RIGHT;\r\n                        ctlPromise = container.addControl('resultsPanel', resultsPanelOptions);\r\n                    }\r\n                    else {\r\n                        resultsPanelOptions.div = document.createElement('div');\r\n                        map.map.div.appendChild(resultsPanelOptions.div);\r\n                        ctlPromise = map.addControl('resultsPanel', resultsPanelOptions);\r\n                    }\r\n                    ctlPromise\r\n                        .then(function (rp) {\r\n                            self.resultsPanel = rp;\r\n                            rp.caller = self;\r\n                        });\r\n                }\r\n                break;\r\n            default:\r\n                self.displayMode = TC.Consts.infoContainer.POPUP;\r\n                if (!self.popup) {\r\n                    map.addControl('popup', {\r\n                        closeButton: true,\r\n                        draggable: self.options.draggable\r\n                    }).then(function (popup) {\r\n                        self.popup = popup;\r\n                        popup.caller = self;\r\n                        map.on(TC.Consts.event.POPUP, function (e) {\r\n                            self.onShowPopup(e);\r\n                        });\r\n\r\n                        map.on(TC.Consts.event.POPUPHIDE, function (e) {\r\n                            if (e.control === popup) {\r\n                                //restaurar el ancho automático\r\n                                self._resetSize();\r\n                            }\r\n                        });\r\n                    });\r\n                }\r\n                break;\r\n        }\r\n    };\r\n\r\n    ctlProto.getDisplayControl = function () {\r\n        var self = this;\r\n        switch (self.displayMode) {\r\n            case TC.Consts.infoContainer.RESULTS_PANEL:\r\n                return self.resultsPanel;\r\n            default:\r\n                return self.popup;\r\n        }\r\n    };\r\n\r\n    ctlProto.getDisplayTarget = function (options) {\r\n        var self = this;\r\n        options = options || {};\r\n        if (options.control) {\r\n            switch (true) {\r\n                case TC.control.Popup && options.control instanceof TC.control.Popup:\r\n                    return options.control.getContainerElement();\r\n                case TC.control.ResultsPanel && options.control instanceof TC.control.ResultsPanel:\r\n                    return options.control.getInfoContainer();\r\n                default:\r\n                    return null;\r\n            }\r\n        }\r\n        switch (self.displayMode) {\r\n            case TC.Consts.infoContainer.RESULTS_PANEL:\r\n                return self.resultsPanel.getInfoContainer();\r\n            default:\r\n                return self.popup.getContainerElement();\r\n        }\r\n    };\r\n\r\n    ctlProto.getMenuTarget = function () {\r\n        var self = this;\r\n        switch (self.displayMode) {\r\n            case TC.Consts.infoContainer.RESULTS_PANEL:\r\n                return self.resultsPanel.getMenuElement();\r\n            default:\r\n                return self.popup.getMenuElement();\r\n        }\r\n    };\r\n\r\n    ctlProto.displayResults = function () {\r\n        var self = this;\r\n        const clone = self.div.cloneNode(true);\r\n        clone.classList.remove(TC.Consts.classes.HIDDEN);\r\n        self.filterFeature.data = clone.outerHTML;\r\n        switch (self.displayMode) {\r\n            case TC.Consts.infoContainer.RESULTS_PANEL:\r\n                if (self.resultsPanel) {\r\n                    // GLS: si contamos con el control de controles no es necesario cerrar los paneles visibles ya que no habría solape\r\n                    if (self.map.getControlsByClass(TC.control.ControlContainer).length === 0) {\r\n                        self.map.getControlsByClass(TC.control.ResultsPanel).forEach(function (p) {\r\n                            if (p.isVisible()) {\r\n                                p.close();\r\n                            }\r\n                        });\r\n                    }\r\n\r\n                    // cerramos los paneles con feature asociada\r\n                    const panels = self.map.getControlsByClass('TC.control.ResultsPanel');\r\n                    panels.forEach(function (p) {\r\n                        if (p !== self.resultsPanel && p.currentFeature && !p.chart) {\r\n                            p.close();\r\n                        }\r\n                    });\r\n\r\n                    self.resultsPanel.currentFeature = self.filterFeature;\r\n                    self.resultsPanel.open(self.filterFeature.data, self.resultsPanel.getInfoContainer());\r\n                    \r\n                    self.getMenuTarget().innerHTML = \"\";\r\n                    self.displayResultsCallback();\r\n                   \r\n                }\r\n\r\n                break;\r\n            default:\r\n                if (self.popup) {\r\n                    self.filterFeature.showPopup(self.popup);\r\n                }\r\n                break;\r\n        }\r\n    };\r\n\r\n    const getElementIndex = function (elm) {\r\n        return Array.from(elm.parentElement.children).indexOf(elm);\r\n    };\r\n\r\n    const getParentElement = function (elm, tagName) {\r\n        var result = elm;\r\n        do {\r\n            result = result.parentElement;\r\n        }\r\n        while (result && result.tagName !== tagName);\r\n        return result;\r\n    };\r\n\r\n    const getFeatureFromListItem = function (ctl, li) {\r\n        const currentFeatureLi = li;\r\n        const currentLayerLi = getParentElement(li, 'LI');\r\n        const currentServiceLi = getParentElement(currentLayerLi, 'LI');\r\n        return ctl.getFeature(getElementIndex(currentServiceLi), getElementIndex(currentLayerLi), getElementIndex(currentFeatureLi));\r\n    };\r\n\r\n    ctlProto.getFeatureElement = function (feature) {\r\n        const self = this;\r\n        let result;\r\n\r\n        const lis = self.getDisplayTarget().querySelectorAll(self._selectors.LIST_ITEM);\r\n        for (let i = 0, ii = lis.length; i < ii; i++) {\r\n            const li = lis[i];\r\n            const feat = getFeatureFromListItem(self, li);\r\n            if (feat === feature) {\r\n                result = li;\r\n                break;\r\n            }\r\n        }\r\n        return result;\r\n    };\r\n\r\n    ctlProto.getNextFeatureElement = function (delta) {\r\n        const self = this;\r\n        const lis = self.getDisplayTarget().querySelectorAll('ul.' + self.CLASS + '-features > li');\r\n        const length = lis.length;\r\n        for (var i = 0; i < length; i++) {\r\n            if (lis[i].matches('.' + self.CURRENT_CLASS)) {\r\n                return lis[(i + delta + length) % length]\r\n            }\r\n        }\r\n        return null;\r\n    };\r\n\r\n    ctlProto.getFeaturePath = function (feature) {\r\n        const self = this;\r\n        if (self.info && self.info.services) {\r\n            for (var i = 0, ii = self.info.services.length; i < ii; i++) {\r\n                const service = self.info.services[i];\r\n                for (var j = 0, jj = service.layers.length; j < jj; j++) {\r\n                    const layer = service.layers[j];\r\n                    for (var k = 0, kk = layer.features.length; k < kk; k++) {\r\n                        if (layer.features[k] === feature) {\r\n                            return {\r\n                                service: service.title || service.mapLayers.reduce(function (prev, cur) {\r\n                                    return prev || cur.title;\r\n                                }, ''),\r\n                                layer: layer.path\r\n                            };\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        return null;\r\n    };\r\n\r\n    ctlProto.closeResults = function () {\r\n        var self = this;\r\n        switch (self.displayMode) {\r\n            case TC.Consts.infoContainer.RESULTS_PANEL:\r\n                if (self.resultsPanel && self.resultsPanel.isVisible()) {\r\n                    self.resultsPanel.close();\r\n                }\r\n                break;\r\n            default:\r\n                if (self.popup && self.popup.isVisible()) {\r\n                    self.popup.hide();\r\n                }\r\n                break;\r\n        }\r\n    };\r\n\r\n    ctlProto.displayResultsCallback = function () {\r\n        var self = this;\r\n        const content = self.getDisplayTarget().querySelector('.' + self.CLASS);\r\n\r\n        // Evento para resaltar una feature\r\n        const onListItemClick = function (e) {\r\n            self.highlightFeature(e.target);\r\n        };\r\n        // En iPad se usa click en vez de touchstart para evitar que se resalte una feature al hacer scroll\r\n        content.querySelectorAll(self._selectors.LIST_ITEM).forEach(li => li.addEventListener('click', onListItemClick));\r\n\r\n        // Evento para ir a la siguiente feature\r\n        const nextBtn = content.querySelector(`.${self.CLASS}-btn-next`);\r\n        if (nextBtn) {\r\n            nextBtn.addEventListener(TC.Consts.event.CLICK, function (e) {\r\n                self.highlightFeature(self.getNextFeatureElement(1), 1);\r\n                return false;\r\n            }, { passive: true });\r\n        }\r\n\r\n        // Evento para ir a la feature anterior\r\n        const prevBtn = content.querySelector(`.${self.CLASS}-btn-prev`);\r\n        if (prevBtn) {\r\n            prevBtn.addEventListener(TC.Consts.event.CLICK, function (e) {\r\n                self.highlightFeature(self.getNextFeatureElement(-1), -1);\r\n                return false;\r\n            }, { passive: true });\r\n        }\r\n\r\n        // Evento para desplegar/replegar features de capa\r\n        const onTitleClick = function (e) {\r\n            const li = getParentElement(e.target, 'LI');\r\n            if (li.classList.contains(TC.Consts.classes.CHECKED)) {\r\n                // Si no está en modo móvil ocultamos la capa (si hay más de una)\r\n                const anotherLayer = content.querySelector(`.${self.CLASS}-layers li:not(.tc-checked)`);\r\n                if (anotherLayer && getComputedStyle(anotherLayer).display !== 'none') {\r\n                    self.downplayFeatures();\r\n                }\r\n            }\r\n            else {\r\n                self.highlightFeature(li.querySelector(self._selectors.LIST_ITEM));\r\n                if (self.displayMode === TC.Consts.infoContainer.POPUP) {\r\n                    self.popup.fitToView(true);\r\n                }\r\n            }\r\n        };\r\n        content.querySelectorAll(`ul.${self.CLASS}-layers h4`).forEach(h => h.addEventListener(TC.Consts.event.CLICK, onTitleClick, { passive: true }));\r\n\r\n        // Evento para borrar la feature resaltada\r\n        //selector = '.' + self.CLASS + '-del-btn';\r\n        //content.addEventListener(eventType, TC.EventTarget.listenerBySelector(selector, function (e) {\r\n        //    self.downplayFeatures();\r\n        //    self.closeResults();\r\n        //}));\r\n\r\n        if (self.info) {\r\n            const features = self.getFeatures();\r\n            if (features.length > 1) {\r\n                // Hay más de una feature\r\n                self.getRenderedHtml(`${self.CLASS}-buttons`, { id: self.id }).then(function (html) {\r\n                    const menu = self.getMenuTarget();\r\n                    if (!menu.querySelector(`.${self.CLASS}-btn-dl`)) {\r\n                        menu.insertAdjacentHTML('beforeend', html);\r\n                        menu.querySelector(`.${self.CLASS}-btn-dl`).addEventListener(TC.Consts.event.CLICK, async function (e) {\r\n                            const downloadDialog = await self.getDownloadDialog();\r\n                            let options = {\r\n                                title: self.getLocaleString(\"featureInfo\") + \" - \" + self.getLocaleString(\"download\"),\r\n                                fileName: self._getFileName()\r\n                            };\r\n\r\n                            if (self.map.elevation || self.options.displayElevation) {\r\n                                options = Object.assign({}, options, {\r\n                                    elevation: Object.assign({}, self.map.elevation && self.map.elevation.options, self.options.displayElevation)\r\n                                });\r\n                            }\r\n                            downloadDialog.open(features, options);\r\n                        }, { passive: true });\r\n\r\n                        menu.querySelector(self._selectors.SHOW_ALL_CHECKBOX).addEventListener('change', function (e) {\r\n                            if (e.target.checked) {\r\n                                self.showAllFeatures();\r\n                            }\r\n                            else {\r\n                                self.hideAllFeatures();\r\n                            }\r\n                        }, { passive: true });\r\n\r\n                        menu.querySelector(self._selectors.ZOOM_ALL_BUTTON).addEventListener(TC.Consts.event.CLICK, function (e) {\r\n                            self.map.zoomToFeatures(features);\r\n                        }, { passive: true });\r\n\r\n                        menu.querySelector(self._selectors.DEL_ALL_BUTTON).addEventListener(TC.Consts.event.CLICK, function (e) {\r\n                            self.downplayFeatures();\r\n                            self.filterLayer.removeFeature(self.filterFeature);\r\n                        }, { passive: true });\r\n                    }\r\n                });\r\n            }\r\n            if (self.info.defaultFeature && self.getFeatureElement(self.info.defaultFeature)) {\r\n                self.getFeatureElement(self.info.defaultFeature).classList.add(TC.Consts.classes.DEFAULT);\r\n                self.highlightFeature(self.info.defaultFeature);\r\n            }\r\n            else if (content.querySelector(self._selectors.LIST_ITEM)) {\r\n                self.highlightFeature(content.querySelector(self._selectors.LIST_ITEM));\r\n            }\r\n        }\r\n\r\n        content.querySelectorAll('table:not(.complexAttr)').forEach(function (table) {\r\n            table.addEventListener(TC.Consts.event.CLICK, function (e) {\r\n                const li = this.parentElement;\r\n                if (li.classList.contains(TC.Consts.classes.DISABLED)) {\r\n                    return;\r\n                }\r\n                if (li.classList.contains(TC.Consts.classes.CHECKED)) {\r\n                    // Si ya está seleccionada hacemos zoom\r\n                    const feature = getFeatureFromListItem(self, li);\r\n                    if (feature && window.getSelection() && window.getSelection().toString().trim().length === 0) {\r\n                        // Proceso para desactivar highlightFeature mientras hacemos zoom\r\n                        var zoomHandler = function zoomHandler() {\r\n                            self._zooming = false;\r\n                            self.map.off(TC.Consts.event.ZOOM, zoomHandler);\r\n                        };\r\n                        self.map.on(TC.Consts.event.ZOOM, zoomHandler);\r\n                        self._zooming = true;\r\n                        ///////\r\n\r\n                        self.map.zoomToFeatures([feature], { animate: true });\r\n                    }\r\n                }\r\n                else {\r\n                    // Si no está seleccionada la seleccionamos\r\n                    self.highlightFeature(li);\r\n                }\r\n                e.stopPropagation();\r\n            }, { passive: true });\r\n        });\r\n        content.querySelectorAll('table a, table label, table input').forEach(function (a) {\r\n            a.addEventListener(TC.Consts.event.CLICK, function (e) {\r\n                e.stopPropagation();\r\n            }, { passive: true });\r\n        });\r\n\r\n        if (TC.browserFeatures.touch() && self.displayMode === TC.Consts.infoContainer.RESULTS_PANEL) {\r\n            const prevBtn = content.querySelector('.' + self.CLASS + '-btn-prev');\r\n            if (!prevBtn || prevBtn.style.display !== 'none') { // Si los botones de anterior/siguiente están visibles, montamos el swipe\r\n                if (self.resultsPanel) {\r\n                    TC.Util.swipe(self.resultsPanel.div, 'disable');\r\n                }\r\n\r\n                if (layerCount(self) > 1) {\r\n                    TC.Util.swipe(content, {\r\n                        left: function () {\r\n                            self.highlightFeature(self.getNextFeatureElement(1), 1);\r\n                        },\r\n                        right: function () {\r\n                            self.highlightFeature(self.getNextFeatureElement(-1), -1);\r\n                        }\r\n                    });\r\n                }\r\n            }\r\n        }\r\n    };\r\n\r\n    ctlProto.onShowPopup = function (e) {\r\n        const self = this;\r\n        if (e.control === self.popup) {\r\n\r\n            self.displayResultsCallback();\r\n\r\n            //ajustar el ancho para que no sobre a la derecha\r\n            self._fitSize();\r\n        }\r\n    };\r\n\r\n    ctlProto.loadSharedFeature = function (featureObj) {\r\n\r\n    };\r\n\r\n    ctlProto.insertLinks = function () {\r\n        var self = this;\r\n        const linkText = self.getLocaleString('open');\r\n        const titleText = self.getLocaleString('linkInNewWindow');\r\n        self.div.querySelectorAll('td.' + self.CLASS + '-val').forEach(function (td) {\r\n            const text = td.textContent;\r\n            if (TC.Util.isURL(text)) {\r\n                td.innerHTML = '<a href=\"' + text + '\" target=\"_blank\" title=\"' + titleText + '\">' + linkText + '</a>';\r\n            }\r\n        });\r\n    };\r\n\r\n    ctlProto.highlightFeature = function (featureOrElement, delta) {\r\n        const self = this;\r\n        var feature;\r\n        if (!self._zooming) {\r\n            var featureLi;\r\n            // this puede ser o el elemento HTML de la lista correspondiente a la feature o la feature en sí\r\n            if (featureOrElement instanceof TC.Feature) {\r\n                feature = featureOrElement;\r\n                featureLi = self.getFeatureElement(feature);\r\n            }\r\n            else {\r\n                featureLi = featureOrElement;\r\n                while (featureLi && featureLi.tagName !== 'LI') {\r\n                    featureLi = featureLi.parentElement;\r\n                }\r\n            }\r\n            const layerLi = getParentElement(featureLi, 'LI');\r\n            const serviceLi = getParentElement(layerLi, 'LI');\r\n\r\n            const serviceIdx = getElementIndex(serviceLi);\r\n            const layerIdx = getElementIndex(layerLi);\r\n            const featureIdx = getElementIndex(featureLi);\r\n            feature = feature || self.getFeature(serviceIdx, layerIdx, featureIdx);\r\n\r\n            self.downplayFeatures({ exception: feature });\r\n\r\n            // Añadimos feature al historial de features resaltadas\r\n            const service = self.info.services[serviceIdx];\r\n            if (!self._infoHistory.hasOwnProperty(service.url)) {\r\n                self._infoHistory[service.url] = {};\r\n            }\r\n            const historyService = self._infoHistory[service.url];\r\n            const layer = service.layers[layerIdx];\r\n            const historyLayer = historyService[layer.name] || [];\r\n            historyService[layer.name] = historyLayer.concat(feature);\r\n\r\n            const displayTarget = self.getDisplayTarget();\r\n            displayTarget.querySelectorAll('li').forEach(elm => elm.classList.remove(self.CURRENT_CLASS));\r\n            featureLi.classList.add(TC.Consts.classes.CHECKED, self.CURRENT_CLASS);\r\n            layerLi.classList.add(TC.Consts.classes.CHECKED, self.CURRENT_CLASS);\r\n            serviceLi.classList.add(TC.Consts.classes.CHECKED, self.CURRENT_CLASS);\r\n            if (delta > 0) {\r\n                featureLi.classList.add(TC.Consts.classes.FROMLEFT);\r\n                layerLi.classList.add(TC.Consts.classes.FROMLEFT);\r\n                serviceLi.classList.add(TC.Consts.classes.FROMLEFT);\r\n            }\r\n            else if (delta < 0) {\r\n                featureLi.classList.add(TC.Consts.classes.FROMRIGHT);\r\n                layerLi.classList.add(TC.Consts.classes.FROMRIGHT);\r\n                serviceLi.classList.add(TC.Consts.classes.FROMRIGHT);\r\n            }\r\n\r\n            if (featureLi.querySelector('table')) {\r\n                featureLi.querySelector('table').setAttribute('title', self.getLocaleString('clickToCenter'));\r\n            }\r\n\r\n            // Añadida esta condición porque si el servicio no devuelve datos parseables como feature se devuelve una pseudofeature sin geometría\r\n            if (!(feature instanceof TC.Feature)) {\r\n                feature = null;\r\n            }\r\n\r\n            //Si la feature a resaltar ya está resaltada, no hacemos nada. Así evitamos parpadeo\r\n            if (feature && feature === self.highlightedFeature) {\r\n                return;\r\n            }\r\n\r\n            self.highlightedFeature = feature;\r\n\r\n            const counter = displayTarget.querySelector('.' + self.CLASS + '-counter-current');\r\n            if (counter) {\r\n                counter.innerHTML = self.getFeatureIndex(serviceIdx, layerIdx, featureIdx) + 1;\r\n            }\r\n\r\n\r\n            if (!self.options.persistentHighlights) {\r\n                self.resultsLayer.features.slice().forEach(f => {\r\n                    if (f !== self.filterFeature && f !== feature) {\r\n                        self.downplayFeature(f);\r\n                    }\r\n                });\r\n            }\r\n            if (feature) {\r\n                const triggerEvent = () => self.map.trigger(TC.Consts.event.FEATUREHIGHLIGHT, { feature: feature, control: self });\r\n                if (feature.geometry) {\r\n                    feature.showsPopup = self.options.persistentHighlights;\r\n                    self.resultsLayer.addFeature(feature).then(function (f) {\r\n                        triggerEvent();\r\n                    });\r\n                }\r\n                else {\r\n                    featureLi.classList.add(TC.Consts.classes.DISABLED);\r\n                    triggerEvent();\r\n                }\r\n            }\r\n        }\r\n    };\r\n\r\n    ctlProto.downplayFeature = function (feature) {\r\n        const self = this;\r\n        const li = self.getFeatureElement(feature);\r\n        if (li) {\r\n            li.classList.remove(TC.Consts.classes.CHECKED);\r\n        }\r\n        self.resultsLayer.removeFeature(feature);\r\n        for (url in self._infoHistory) {\r\n            const service = self._infoHistory[url];\r\n            for (name in service) {\r\n                const layer = service[name];\r\n                const idx = layer.indexOf(feature);\r\n                if (idx >= 0) {\r\n                    layer.splice(idx, 1);\r\n                    if (!layer.length) {\r\n                        delete service[name];\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        if (self.highlightedFeature === feature) {\r\n            self.highlightedFeature = null;\r\n        }\r\n        self.map.trigger(TC.Consts.event.FEATUREDOWNPLAY, { feature: feature, control: self });\r\n    };\r\n\r\n    ctlProto.downplayFeatures = function (options) {\r\n        const self = this;\r\n        options = options || {};\r\n        const prevHlFeature = self.highlightedFeature;\r\n        if (prevHlFeature && prevHlFeature !== options.exception) {\r\n            self.downplayFeature(prevHlFeature);\r\n            self.highlightedFeature = null;\r\n        }\r\n        self.getFeatures()\r\n            .filter(f => f !== prevHlFeature)\r\n            .forEach(f => self.resultsLayer.removeFeature(f));\r\n\r\n        const exceptionFLi = options.exception ? self.getFeatureElement(options.exception) : undefined;\r\n        var exceptionLLi, exceptionSLi;\r\n        if (exceptionFLi) {\r\n            exceptionLLi = getParentElement(exceptionFLi, 'LI');\r\n            exceptionSLi = getParentElement(exceptionLLi, 'LI');\r\n        }\r\n\r\n        const target = self.getDisplayTarget();\r\n        Array.from(target.querySelectorAll('ul.' + self.CLASS + '-services li'))\r\n            .filter(function (li) {\r\n                return li !== exceptionFLi && li !== exceptionLLi && li !== exceptionSLi;\r\n            })\r\n            .forEach(function (li) {\r\n                li.classList.remove(\r\n                    TC.Consts.classes.CHECKED,\r\n                    TC.Consts.classes.DISABLED,\r\n                    TC.Consts.classes.FROMLEFT,\r\n                    TC.Consts.classes.FROMRIGHT);\r\n            });\r\n        target.querySelectorAll('.' + self.CLASS + '-features table:not(.complexAttr)').forEach(function (table) {\r\n            table.setAttribute('title', self.getLocaleString('clickToShowOnMap'));\r\n        });\r\n\r\n        setNotShowAllUI.call(self);\r\n    };\r\n\r\n    ctlProto.showAllFeatures = function () {\r\n        const self = this;\r\n        if (self.highlightedFeature) {\r\n            self.downplayFeature(self.highlightedFeature);\r\n        }\r\n        const features = self.getFeatures();\r\n        features.forEach(f => {\r\n            f.showsPopup = self.options.persistentHighlights;\r\n            if (self.resultsLayer.features.indexOf(f) < 0) {\r\n                self.resultsLayer.addFeature(f);\r\n            }\r\n        });\r\n        setShowAllUI.call(self);\r\n    };\r\n\r\n    ctlProto.hideAllFeatures = function () {\r\n        const self = this;\r\n        self.downplayFeatures();\r\n        setNotShowAllUI.call(self);\r\n    };\r\n\r\n    ctlProto._fitSize = function () {\r\n        const self = this;\r\n        const target = self.getDisplayTarget();\r\n        var max = 0;\r\n        //medir la máxima anchura de <ul>\r\n        target.querySelectorAll(\"input\").forEach(function (checkbox) { checkbox.checked = true })\r\n        target.querySelectorAll(\".tc-ctl-finfo-features li\").forEach(function (elm) {\r\n            max = Math.max(max, elm.offsetLeft + elm.offsetWidth);\r\n        });\r\n\r\n        //alert(\"max=\" + max);\r\n        if (max) {\r\n            target.style.width = max + 50 + 'px';\r\n        }\r\n        target.querySelectorAll(\"input\").forEach(function (checkbox) { checkbox.checked = false })\r\n    };\r\n\r\n    ctlProto._resetSize = function () {\r\n        const self = this;\r\n        self.getDisplayTarget().style.removeProperty('width');\r\n    };\r\n\r\n    ctlProto.getFeature = function (serviceIdx, layerIdx, featureIdx) {\r\n        const self = this;\r\n        var result;\r\n        const info = self.info;\r\n        if (info && info.services) {\r\n            result = info.services[serviceIdx];\r\n            if (result) {\r\n                result = result.layers[layerIdx];\r\n                if (result) {\r\n                    result = result.features[featureIdx];\r\n                }\r\n            }\r\n        }\r\n        return result;\r\n    };\r\n\r\n    ctlProto.getFeatures = function () {\r\n        const self = this;\r\n        let result = [];\r\n        const info = self.info;\r\n        if (info && info.services) {\r\n            result = info.services.reduce((prev, cur) => {\r\n                return prev.concat(cur.layers.reduce((p, c) => {\r\n                    return p.concat(c.features);\r\n                }, []));\r\n            }, result);\r\n        }\r\n        return result;\r\n    };\r\n\r\n    ctlProto.getFeatureIndex = function (serviceIdx, layerIdx, featureIdx) {\r\n        const self = this;\r\n        var result = -1;\r\n        const info = self.info;\r\n        if (info) {\r\n            for (var i = 0; i <= serviceIdx; i++) {\r\n                var service = info.services[i];\r\n                var maxj = i === serviceIdx ? layerIdx : service.layers.length - 1;\r\n                for (var j = 0; j <= maxj; j++) {\r\n                    var layer = service.layers[j];\r\n                    var maxk = j === layerIdx ? featureIdx : layer.features.length - 1;\r\n                    for (var k = 0; k <= maxk; k++) {\r\n                        result = result + 1;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        return result;\r\n    };\r\n\r\n    ctlProto.beforeRequest = function (options) {\r\n        var self = this;\r\n        self.querying = true;\r\n        self.map.trigger(TC.Consts.event.BEFOREFEATUREINFO, {\r\n            xy: options.xy,\r\n            control: self\r\n        });\r\n        self.closeResults();\r\n        if (self.map && self.resultsLayer) {\r\n            self.lastFeatureCount = null;\r\n\r\n            if (!self.options.persistentHighlights) {\r\n                self.resultsLayer.features.slice().forEach(f => self.downplayFeature(f));\r\n            }\r\n            self.info = null;\r\n        }\r\n    };\r\n\r\n    ctlProto.activate = function () {\r\n        var self = this;\r\n        if (self.wrap) {\r\n            self.wrap.activate();\r\n        }\r\n        TC.Control.prototype.activate.call(self);\r\n    };\r\n\r\n    ctlProto.deactivate = function (stopChain) {\r\n        var self = this;\r\n        if (self.popup && self.popup.isVisible()) {\r\n            self.popup.hide();\r\n        }\r\n        if (!self.options.persistentHighlights) {\r\n            self.resultsLayer.features.slice().forEach(f => self.downplayFeature(f));\r\n            self.info = null;\r\n            self._infoHistory = {};\r\n        }\r\n        self.filterLayer && self.filterLayer.clearFeatures();\r\n        self.filterFeature = null;\r\n        if (self.wrap) {\r\n            self.wrap.deactivate();\r\n        }\r\n        TC.Control.prototype.deactivate.call(self, stopChain);\r\n    };\r\n\r\n    ctlProto.exportState = function () {\r\n        const self = this;\r\n        if (self.exportsState && self.resultsLayer) {\r\n            return {\r\n                id: self.id,\r\n                layer: self.resultsLayer.exportState()\r\n            };\r\n        }\r\n        return null;\r\n    };\r\n\r\n    ctlProto.importState = function (state) {\r\n        const self = this;\r\n        self._layersPromise.then(function () {\r\n            self.resultsLayer.importState(state.layer);\r\n        });\r\n    };\r\n\r\n    ctlProto._createLayers = function () {\r\n        const self = this;\r\n\r\n        var resultsLayer;\r\n        if (self.options.resultsLayer) { // En caso de que se haya indicado una capa por configuración, la utilizamos\r\n            resultsLayer = self.options.resultsLayer;\r\n        } else {\r\n            resultsLayer = {\r\n                id: self.getUID(),\r\n                title: self.CLASS + ': Results layer',\r\n                type: TC.Consts.layerType.VECTOR,\r\n                owner: self,\r\n                stealth: true\r\n            };\r\n        }\r\n        var filterLayer;\r\n        if (self.options.filterLayer) {\r\n            filterLayer = self.options.filterLayer;\r\n        }\r\n        else {\r\n            const styles = {};\r\n            if (self.geometryType === TC.Consts.geom.POLYLINE) {\r\n                styles.line = self.style;\r\n            }\r\n            if (self.geometryType === TC.Consts.geom.POLYGON) {\r\n                styles.polygon = self.style;\r\n            }\r\n\r\n            filterLayer = {\r\n                id: self.getUID(),\r\n                title: self.CLASS + ': Filter layer',\r\n                owner: self,\r\n                stealth: true,\r\n                type: TC.Consts.layerType.VECTOR,\r\n                styles: styles\r\n            };\r\n        }\r\n\r\n        const map = self.map;\r\n        self._layersPromise = new Promise(function (resolve, reject) {\r\n            map.loaded(function () {\r\n                Promise.all([map.addLayer(resultsLayer), map.addLayer(filterLayer)]).then(function (layers) {\r\n                    self.resultsLayer = layers[0];\r\n                    self.filterLayer = layers[1];\r\n                    resolve();\r\n                });\r\n            });\r\n        });\r\n\r\n        return self._layersPromise;\r\n    };\r\n\r\n    ctlProto._decorateDisplay = function (ctl) {\r\n        const self = this;\r\n\r\n        const resultsContainer = self.getMenuTarget({ control: ctl });\r\n\r\n        // Añadimos botón de imprimir\r\n        TC.loadJS(\r\n            !TC.control.Print,\r\n            [TC.apiLocation + 'TC/control/Print'],\r\n            function () {\r\n\r\n                if (!resultsContainer.querySelectorAll('.' + TC.control.Print.prototype.CLASS + '-btn').length) {\r\n                    var printTitle = self.getLocaleString(\"feature\");\r\n                    if (ctl === self.getDisplayControl()) {\r\n                        if (TC.feature.Point && self.filterFeature instanceof TC.feature.Point) {\r\n                            const geom = self.filterFeature.geometry;\r\n                            printTitle = self.getLocaleString('featuresAt', {\r\n                                crs: self.map.crs,\r\n                                x: TC.Util.formatCoord(geom[0], self.map.wrap.isGeo() ? TC.Consts.DEGREE_PRECISION : TC.Consts.METER_PRECISION),\r\n                                y: TC.Util.formatCoord(geom[1], self.map.wrap.isGeo() ? TC.Consts.DEGREE_PRECISION : TC.Consts.METER_PRECISION)\r\n                            });\r\n                        }\r\n                        else {\r\n                            printTitle = self.getLocaleString('spatialQueryResults');\r\n                        }\r\n                    }\r\n                    else if (ctl.currentFeature) {\r\n                        printTitle = ctl.currentFeature.id;\r\n                    }\r\n\r\n                    // Si hay datos porque el popup es de un GFI con éxito o es de una feature resaltada damos la opción de imprimirlos\r\n                    if (self.lastFeatureCount || (ctl.currentFeature && ctl.currentFeature.showsPopup === true)) {\r\n                        new TC.control.Print({\r\n                            target: resultsContainer,\r\n                            printableElement: self.getDisplayTarget({ control: ctl }),\r\n                            title: printTitle\r\n                        });\r\n                    }\r\n                }\r\n            }\r\n        );\r\n    };\r\n\r\n    ctlProto._addSourceAttributes = function () {\r\n        const self = this;\r\n        const serviceAttrName = 'h3_' + self.getLocaleString('service');\r\n        const layerAttrName = 'h4_' + self.getLocaleString('layer');\r\n        // Añadimos como atributos los títulos de servicio y capa\r\n        if (self.info && self.info.services) {\r\n            self.info.services.forEach(function (service) {\r\n                service.layers.forEach(function (layer) {\r\n                    layer.features.forEach(function (feature) {\r\n                        if (feature instanceof TC.Feature) {\r\n                            const path = self.getFeaturePath(feature);\r\n                            if (path) {\r\n                                const newData = {};\r\n                                newData[serviceAttrName] = path.service;\r\n                                if (path.layer) {\r\n                                    newData[layerAttrName] = path.layer.join(self.TITLE_SEPARATOR);\r\n                                }\r\n                                const allData = TC.Util.extend(newData, feature.getData());\r\n                                feature.clearData();\r\n                                feature.setData(allData);\r\n                            }\r\n                        }\r\n                    });\r\n                });\r\n            });\r\n        }\r\n    };\r\n\r\n    ctlProto._getFileName = function () {\r\n        const self = this;\r\n        return self.getLocaleString('featureInfo').toLowerCase().replace(/\\s/gi, '_') + '_' + TC.Util.getFormattedDate(new Date().toString(), true);\r\n    };\r\n\r\n})();\r\n"]}