{"version":3,"sources":["control/FeatureDownloadDialog.js"],"names":["TC","control","Control","syncLoadJS","apiLocation","FeatureDownloadDialog","apply","this","arguments","title","options","cssClass","_selectors","ELEVATION_CHECKBOX","CLASS","INTERPOLATION_PANEL","INTERPOLATION_RADIO","id","INTERPOLATION_DISTANCE","features","inherit","ctlProto","prototype","displayElevation","_formats","interpolation","interpolationDistance","template","1","container","depth0","helpers","partials","data","stack1","alias1","lambda","alias2","escapeExpression","alias3","nullContext","lookupProperty","parent","propertyName","Object","hasOwnProperty","call","name","hash","fn","program","inverse","noop","loc","start","line","column","end","2","4","6","7","9","10","12","13","15","16","18","19","21","22","24","25","27","28","compiler","main","useData","hasLines","getFeatures","some","feature","Polyline","MultiPolyline","hasPolygons","Polygon","MultiPolygon","render","callback","renderData","controlId","close","self","modal","parentElement","Util","closeModal","removeChild","open","featureOrFeatures","setFeatures","excludedFormats","assign","checkboxId","getUID","elevation","slice","Point","MultiPoint","push","Consts","format","GPX","formats","filter","item","indexOf","setOptions","getRenderedHtml","html","document","createElement","innerHTML","content","firstChild","body","appendChild","modalBody","getElementsByClassName","addEventListener","event","CLICK","EventTarget","listenerBySelector","e","resolution","parseFloat","querySelector","value","map","endExport","async","opts","cancel","GEOJSON","WKT","feat","attr","getData","confirm","getLocaleString","li","getLoadingIndicator","waitId","addWait","Promise","resolve","reject","cloneWithId","result","clone","getGeometryStride","f","layer","getCoordsArray","forEach","coord","length","setCoords","geometry","mustInterpolate","featuresToAddElevation","every","p","elevOptions","crs","maxCoordQuantity","sampleNumber","tool","Elevation","setGeometry","then","processedFeatures","index","error","Error","fileName","toLowerCase","replace","getFormattedDate","Date","toString","exportFeatures","message","errors","MAX_COORD_QUANTITY_EXCEEDED","alert","finally","removeWait","target","dataset","getOptions","passive","interpolationPanel","elevationCheckbox","checked","classList","remove","classes","HIDDEN","contains","add","querySelectorAll","toggle","modalOptions","closeCallback","openCallback","showModal","Array","isArray"],"mappings":"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","sourcesContent":["\r\nTC.control = TC.control || {};\r\n\r\nif (!TC.Control) {\r\n    TC.syncLoadJS(TC.apiLocation + 'TC/Control');\r\n}\r\n\r\n\r\nTC.control.FeatureDownloadDialog = function () {\r\n    var self = this;\r\n    TC.Control.apply(self, arguments);\r\n    self.title = self.options.title;\r\n    self.cssClass = self.options.cssClass || \"\";\r\n\r\n    self._selectors = {\r\n        ELEVATION_CHECKBOX: \".\" + self.CLASS + '-elev input[type=checkbox]',\r\n        INTERPOLATION_PANEL: \".\" + self.CLASS + '-ip',\r\n        INTERPOLATION_RADIO: `input[type=radio][name=${self.id}-finfo-ip-coords]`,\r\n        INTERPOLATION_DISTANCE: \".\" + self.CLASS + '-ip-m'\r\n    };\r\n    self.features = [];\r\n    self.options = {};\r\n};\r\n\r\nTC.inherit(TC.control.FeatureDownloadDialog, TC.Control);\r\n\r\n(function () {\r\n\r\n    const ctlProto = TC.control.FeatureDownloadDialog.prototype;\r\n\r\n    ctlProto.CLASS = 'tc-ctl-dldlog';\r\n\r\n    var _formats = [\"KMZ\",/*\"KML\",*/ \"GML\", \"GeoJSON\", \"WKT\", \"GPX\", \"SHP\", \"GPKG\"];\r\n\r\n    var displayElevation, interpolation = false;\r\n    var interpolationDistance = null;\r\n\r\n    ctlProto.template = {};\r\n\r\n    ctlProto.template[ctlProto.CLASS] = TC.apiLocation + \"TC/templates/tc-ctl-dldlog.hbs\";\r\n\r\n    const addElevationAndInterpolation = function (features, options) {\r\n        const self = this;\r\n        options = options || {};\r\n        return new Promise(function (resolve, reject) {\r\n            const cloneWithId = function (feat) {\r\n                const result = feat.clone();\r\n                result.id = feat.id;\r\n                return result;\r\n            };\r\n            //si no se incluyen las elevaciones quito las Z de las geometrias que las tuvieran\r\n            if (!options.displayElevation) {\r\n                resolve(features.map(function (feat) {\r\n                    if (feat.getGeometryStride() > 2) {\r\n                        const f = cloneWithId(feat);\r\n                        f.id = feat.id;\r\n                        f.layer = feat.layer;\r\n                        f.getCoordsArray().forEach(coord => coord.length = 2);\r\n                        f.setCoords(f.geometry);\r\n                        return f;\r\n                    }\r\n                    return feat;\r\n                }));\r\n                return;\r\n            }\r\n\r\n            let mustInterpolate = options.elevation && options.elevation.resolution;\r\n            // Array con features sin altura y nulo donde habia feature con alturas\r\n            let featuresToAddElevation = mustInterpolate ? features.map(f => cloneWithId(f)) : features.map(f => {\r\n                return f.getCoordsArray().every(p => !p[2]) ? cloneWithId(f) : null\r\n            });\r\n\r\n            if (mustInterpolate || featuresToAddElevation.some(f => f !== null)) {\r\n                const elevOptions = {\r\n                    crs: self.map.crs,\r\n                    features: featuresToAddElevation,\r\n                    maxCoordQuantity: options.elevation && options.elevation.maxCoordQuantity,\r\n                    resolution: options.elevation.resolution,\r\n                    sampleNumber: options.elevation.sampleNumber || 0\r\n                };\r\n                (self.map.elevation || new TC.tool.Elevation(typeof options.elevation === 'boolean' ? {} : options.elevation)).setGeometry(elevOptions).then(\r\n                    function (processedFeatures) {\r\n                        // Recombinamos features procesadas y sin procesar\r\n                        processedFeatures.forEach((f, index) => {\r\n                            if (!f) {\r\n                                processedFeatures[index] = features[index];\r\n                            }\r\n                        });\r\n                        resolve(processedFeatures);\r\n                    },\r\n                    function (error) {\r\n                        reject(error instanceof Error ? error : Error(error));\r\n                    }\r\n                );\r\n            }\r\n            else {\r\n                resolve(features);\r\n            }\r\n        });\r\n    };\r\n    const hasPoints = function () {\r\n        return this.getFeatures().some(feature => (TC.feature.Point && feature instanceof TC.feature.Point) ||\r\n            (TC.feature.MultiPoint && feature instanceof TC.feature.MultiPoint));\r\n    };\r\n    const hasLines = function () {\r\n        return this.getFeatures().some(feature => (TC.feature.Polyline && feature instanceof TC.feature.Polyline) ||\r\n            (TC.feature.MultiPolyline && feature instanceof TC.feature.MultiPolyline));\r\n    };\r\n    const hasPolygons = function () {\r\n        return this.getFeatures().some(feature => (TC.feature.Polygon && feature instanceof TC.feature.Polygon) ||\r\n            (TC.feature.MultiPolygon && feature instanceof TC.feature.MultiPolygon));\r\n    };\r\n\r\n    ctlProto.render = function (callback) {\r\n        const self = this;\r\n        const result = TC.Control.prototype.renderData.call(self, { controlId: self.id }, callback);\r\n        return result;\r\n    };\r\n\r\n    ctlProto.close = function (callback) {\r\n        const self = this;\r\n\r\n        if (self.modal && self.modal.parentElement) {\r\n            TC.Util.closeModal();\r\n            self.modal.parentElement.removeChild(self.modal);\r\n        }\r\n    };\r\n\r\n    ctlProto.open = function (featureOrFeatures, options) {\r\n        const self = this;\r\n\r\n        self.close();\r\n\r\n        self.setFeatures(featureOrFeatures);\r\n        options = options || {};\r\n        options = Object.assign({}, {\r\n            controlId: self.id,\r\n            cssClass: self.cssClass,\r\n            checkboxId: self.getUID(),\r\n            elevation: options.elevation//options.elevation ? (options.elevation instanceof Object ? options.elevation : self.map.elevation.options) : options.elevation,\r\n        }, options);\r\n        //si solo hay poligonos ocultamos el botón de formato GPX\r\n        const excludedFormats = options.excludedFormats ? options.excludedFormats.slice() : [];\r\n        if (!hasPoints.call(self) && !hasLines.call(self) && hasPolygons.call(self)) {\r\n            excludedFormats.push(TC.Consts.format.GPX);\r\n        }\r\n        options.formats = _formats.filter(item => excludedFormats.indexOf(item) < 0);\r\n        self.setOptions(options);\r\n\r\n        self.getRenderedHtml(ctlProto.CLASS, options, function (html) {\r\n            const template = document.createElement('template');\r\n            template.innerHTML = html;\r\n            self.modal = template.content ? template.content.firstChild : template.firstChild;\r\n            document.body.appendChild(self.modal);\r\n\r\n            const modalBody = self.modalBody = self.modal.getElementsByClassName(\"tc-modal-body\")[0];\r\n            modalBody.addEventListener(TC.Consts.event.CLICK, TC.EventTarget.listenerBySelector('button[data-format]', function (e) {\r\n\r\n                var resolution = displayElevation && interpolation ? parseFloat(modalBody.querySelector(self._selectors.INTERPOLATION_DISTANCE + ' input[type=number]').value) || (self.options.elevation || (self.map.elevation && self.map.elevation.options)).resolution : 0\r\n\r\n                const endExport = async (features, opts) => {\r\n\r\n                    //checkear si son features con datos complejos\r\n                    var cancel = false;\r\n                    if (format !== TC.Consts.format.GEOJSON && opts.format !== TC.Consts.format.WKT && features.some(function (feat) {\r\n                        for (var attr in feat.getData()) {\r\n                            if (feat.data[attr] instanceof Object)\r\n                                return true\r\n                        }\r\n                        return false;\r\n                    }))\r\n                        await TC.confirm(self.getLocaleString(\"dl.export.complexAttr\").format(format), null,\r\n                            function () {\r\n                                cancel = true\r\n                            });\r\n                    if (cancel) { return };\r\n\r\n                    const li = self.map.getLoadingIndicator();\r\n                    const waitId = li && li.addWait();\r\n\r\n\r\n                    TC.Util.closeModal();\r\n                    addElevationAndInterpolation.apply(self, [features,\r\n                        {\r\n                            displayElevation: displayElevation,\r\n                            elevation: displayElevation ? Object.assign({}, opts.elevation || (self.map.elevation && self.map.elevation.options), { resolution: resolution }) : null\r\n                        }]).then(\r\n                        function (features) {\r\n                            let fileName = (opts ? (opts.fileName || opts.title.toLowerCase().replace(/ /g, '_') + '_' + TC.Util.getFormattedDate(new Date().toString(), true) || \"download_\" + TC.Util.getFormattedDate(new Date().toString(), true)) : (opts.title.toLowerCase().replace(/ /g, '_') + '_' + TC.Util.getFormattedDate(new Date().toString(), true) || \"download_\" + TC.Util.getFormattedDate(new Date().toString(), true)));\r\n                            self.map.exportFeatures(features, {\r\n                                fileName: fileName,\r\n                                format: format\r\n                            });\r\n                        },\r\n                        function (error) {\r\n                            self.open(features, opts)\r\n                            if (TC.tool.Elevation && error.message === TC.tool.Elevation.errors.MAX_COORD_QUANTITY_EXCEEDED) {\r\n                                TC.alert(self.getLocaleString('tooManyCoordinatesForElevation.warning'));\r\n                                return;\r\n                            }\r\n                            TC.error(self.getLocaleString('elevation.error'));\r\n                        }\r\n                        ).finally(function () {\r\n                            li && li.removeWait(waitId);\r\n                        });\r\n                };\r\n\r\n                const format = e.target.dataset.format;\r\n                if (format === TC.Consts.format.GPX) {\r\n                    if (hasPolygons.call(self)) {\r\n                        TC.confirm(self.getLocaleString('gpxNotCompatible.confirm'), function () {\r\n                            endExport(self.getFeatures().filter(function (feature) {\r\n                                return (!TC.feature.Polygon || !(feature instanceof TC.feature.Polygon)) &&\r\n                                    (!TC.feature.MultiPolygon || !(feature instanceof TC.feature.MultiPolygon));\r\n                            }), self.getOptions());\r\n                        });\r\n                    }\r\n                    else {\r\n                        endExport(self.getFeatures(), self.getOptions());\r\n                    }\r\n                }\r\n                else {\r\n                    endExport(self.getFeatures(), self.getOptions());\r\n                }\r\n\r\n\r\n            }), { passive: true });\r\n\r\n            const interpolationPanel = modalBody.querySelector(self._selectors.INTERPOLATION_PANEL);\r\n            const elevationCheckbox = modalBody.querySelector(self._selectors.ELEVATION_CHECKBOX);\r\n\r\n            if (options.elevation) {\r\n                displayElevation = options.elevation.checked ? options.elevation.checked : displayElevation;\r\n\r\n                elevationCheckbox.checked = displayElevation;\r\n\r\n                if (interpolationPanel) {\r\n                    if (displayElevation) {\r\n                        interpolationPanel.classList.remove(TC.Consts.classes.HIDDEN);\r\n                    } else {                        \r\n                        if (!interpolationPanel.classList.contains(TC.Consts.classes.HIDDEN)) {\r\n                            interpolationPanel.classList.add(TC.Consts.classes.HIDDEN);\r\n                        }                        \r\n                    }\r\n\r\n                    if (displayElevation && (hasLines.call(self) || hasPolygons.call(self)) && options.elevation.resolution) {\r\n                        interpolationPanel.classList.remove(TC.Consts.classes.HIDDEN);\r\n                    } else {\r\n                        if (!interpolationPanel.classList.contains(TC.Consts.classes.HIDDEN)) {\r\n                            interpolationPanel.classList.add(TC.Consts.classes.HIDDEN);\r\n                        }\r\n                    }\r\n\r\n                    modalBody.querySelectorAll(self._selectors.INTERPOLATION_RADIO)[interpolation ? 1 : 0].checked = true;\r\n                    if (interpolation) {\r\n                        modalBody.querySelector(self._selectors.INTERPOLATION_DISTANCE).classList.remove(TC.Consts.classes.HIDDEN);\r\n                        modalBody.querySelector(self._selectors.INTERPOLATION_DISTANCE + \" input\").value = interpolationDistance || modalBody.querySelector(self._selectors.INTERPOLATION_DISTANCE + \" input\").value;\r\n                    }\r\n                }\r\n            }\r\n\r\n            modalBody.addEventListener('change', TC.EventTarget.listenerBySelector(self._selectors.ELEVATION_CHECKBOX, function (e) {\r\n                //self.showDownloadDialog(); // Recalculamos todo el aspecto del diálogo de descarga\r\n\r\n                displayElevation = !displayElevation;\r\n\r\n                if (interpolationPanel) {\r\n                    if (displayElevation) {\r\n                        interpolationPanel.classList.remove(TC.Consts.classes.HIDDEN);\r\n                    } else {\r\n                        if (!interpolationPanel.classList.contains(TC.Consts.classes.HIDDEN)) {\r\n                            interpolationPanel.classList.add(TC.Consts.classes.HIDDEN);\r\n                        }\r\n                    }\r\n\r\n                    if (displayElevation && (hasLines.call(self) || hasPolygons.call(self))) {\r\n                        interpolationPanel.classList.remove(TC.Consts.classes.HIDDEN);\r\n                    } else {\r\n                        if (!interpolationPanel.classList.contains(TC.Consts.classes.HIDDEN)) {\r\n                            interpolationPanel.classList.add(TC.Consts.classes.HIDDEN);\r\n                        }\r\n                    }\r\n                }               \r\n                \r\n            }));\r\n            modalBody.addEventListener('change', TC.EventTarget.listenerBySelector(self._selectors.INTERPOLATION_RADIO, function (e) {\r\n                const idDiv = modalBody.querySelector(self._selectors.INTERPOLATION_DISTANCE);\r\n                idDiv.classList.toggle(TC.Consts.classes.HIDDEN);\r\n                interpolation = !interpolation;\r\n                if (interpolation) modalBody.querySelector(self._selectors.INTERPOLATION_DISTANCE + \" input\").value = interpolationDistance || modalBody.querySelector(self._selectors.INTERPOLATION_DISTANCE + \" input\").value;\r\n            }));\r\n            modalBody.addEventListener('change', TC.EventTarget.listenerBySelector(self._selectors.INTERPOLATION_DISTANCE, function (e) {\r\n                interpolationDistance = e.target.value;\r\n            }));\r\n\r\n            let modalOptions = {\r\n                closeCallback: function () {\r\n                    self.modal.parentElement.removeChild(self.modal);\r\n                }\r\n            };\r\n\r\n            if (options.openCallback) {\r\n                modalOptions.openCallback = options.openCallback;\r\n            }\r\n\r\n            TC.Util.showModal(self.modal, modalOptions);\r\n        });\r\n    };\r\n\r\n    ctlProto.setFeatures = function (features) {\r\n        this.features = Array.isArray(features) ? features : [features];\r\n    };\r\n\r\n    ctlProto.getFeatures = function () {\r\n        return this.features;\r\n    };\r\n\r\n    ctlProto.setOptions = function (options) {\r\n        this.options = Object.assign(this.options, options);\r\n    };\r\n\r\n    ctlProto.getOptions = function () {\r\n        return this.options;\r\n    };\r\n\r\n})();"]}