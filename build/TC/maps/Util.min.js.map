{"version":3,"sources":["Util.js"],"names":["TC","root","factory","exports","module","define","amd","Util","String","prototype","soundex","a","this","toLowerCase","split","f","shift","r","codes","e","i","o","u","b","p","v","c","g","j","k","q","s","x","z","d","t","l","m","n","map","filter","join","slice","toUpperCase","toLocaleString","Number","locale","options","detectIE","apply","arguments","sNum","replace","Math","floor","isInteger","iconUrlCache","markerGroupClassCache","path1","path2","getOnPath","obj","length","hasOwnProperty","swipeHandlers","WeakMap","modalCloseHandlers","hasOwn","templateCache","Map","countDecimals","value","toString","getElevationGain","coords","uphill","downhill","hillDeltaThreshold","previousHeight","sectorMinHeight","sectorMaxHeight","previousUphill","height","undefined","min","max","delta","upHill","round","downHill","isPlainObject","nodeType","window","constructor","call","isEmptyObject","name","isFunction","extend","clone","target","deep","len","src","copy","copyIsArray","Array","isArray","getMapLocale","regex","PROTOCOL","isOnCapabilities","url","withProtocol","testUrl","capabilities","reqGetMapOnCapabilities","caps","getFnFromString","fnName","scope","scopeSplit","isURL","text","test","isSecureURL","isSameOrigin","uri","result","indexOf","urlParts","match","Consts","SPLIT_REGEX","location","uProtocol","protocol","hostname","uPort","lPort","port","formatNumber","maximumFractionDigits","parseFloat","valueOf","addProtocol","getDiv","div","document","getElementById","HTMLElement","$","createElement","getScriptLocation","script","currentScript","scripts","getElementsByTagName","getAttribute","substr","lastIndexOf","getBackgroundUrlFromCss","cssClass","iconDiv","style","display","classList","add","body","appendChild","exec","getComputedStyle","backgroundImage","parentElement","removeChild","getPointIconUrl","className","classes","Cfg","styles","marker","group","key","point","getLegendImageFromStyle","width","strokeWidth","strokeHalfWidth","fillColor","fillOpacity","diameter","radius","lineDashText","lineDash","geometryType","geom","POINT","strokeColor","POLYLINE","POLYGON","encodeURIComponent","addArrayToTree","path","treeNode","index","found","children","title","uid","push","parseCoords","_parseGeoCoord","type","GEOGRAPHIC","idx","_parseCoord","trim","UTM","xy","y","reproject","sourceCrs","targetCrs","multipoint","multiring","multipoly","loadProjDef","crs","sync","sourcePrj","proj4","defs","targetPrj","forEach","poly","pidx","rp","ring","ridx","rr","coord","cidx","getMetersPerDegree","extent","R","PI","cos","degToRad","dLat","sindlat2","sin","atan2","sqrt","radToDeg","rad","deg","mod","getCRSCode","CRSCodesEqual","crs1","crs2","code1","code2","getLocaleString","texts","i18n","getRenderedHtml","templateOrId","data","callback","compileTemplate","templateId","txt","template","_hbs","compile","registerPartial","set","fetchTemplate","Promise","resolve","reject","get","ajax","apiLocation","method","responseType","then","response","matches","all","str","catch","err","console","log","endFn","html","getSimpleMimeType","mimeType","end","substring","getQueryStringParams","queryString","queryIdx","fragmentIdx","search","elm","bind","getParamString","arr","fastUnshift","storage","getCookie","cookie","setCookie","getLocalValue","localStorage","Storage","getItem","setLocalValue","removeItem","setItem","exDate","Date","setDate","getDate","expires","getSessionLocalValue","sessionStorage","setSessionLocalValue","detectFirefox","navigator","userAgent","RegExp","$1","ua","msie","parseInt","rv","edge","detectChrome","chrome","detectSafari","detectMouse","matchesCoarse","matchMedia","matchesFine","mqResult","mq","hover","browserFeatures","touch","media","testHover","detectAndroid","detectBlackBerry","detectIOS","detectMobileWindows","detectMobile","getBrowser","UAParser","syncLoadJS","UA_PARSER","browser","version","major","getElementByNodeName","parentNode","nodeName","colonIndex","tag","nodes","getElementsByTagNameNS","addURLParameters","parameters","toAdd","Object","keys","urlparts","params","removeURLParameter","parameter","prefix","pars","splice","showModal","contentNode","hidden","jQuery","VISIBLE","closeButton","querySelectorAll","closeCallback","delete","stopPropagation","closeModal","addEventListener","openCallback","hide","modal","remove","closeAlert","btn","swipe","addListeners","handlers","start","passive","removeEventListener","minDistance","maxCrossDistance","maxAllowedTime","touchStartCoords","touchEndCoords","startTime","noSwipe","mustSwipe","changedTouches","pageX","pageY","getTime","startCoords","endCoords","dx","dy","adx","abs","ady","getDirection","getParameterByName","URLSearchParams","from","find","getLocaleUserChoice","cookieName","paramName","browserLanguage","languages","language","userLanguage","lang","hyphenIdx","expirationDate","getValidFilename","filename","downloadBlob","blob","link","download","URL","createObjectURL","setAttribute","visibility","click","downloadFile","Blob","msSaveBlob","downloadDataURI","dataURI","binary","atob","array","charCodeAt","Uint8Array","shortenUrl","access_token","longUrl","utf8ToBase64","btoa","unescape","base64ToUtf8","decodeURIComponent","escape","error","colorArrayToString","color","reduce","prev","cur","operation","list1","list2","comparerFn","operationIsUnion","item1","inBoth","inFirstOnly","inSecondOnly","toDataUrl","canvas","backgroundColour","_ref","encoderOptions","context","getContext","getImageData","compositeOperation","globalCompositeOperation","fillStyle","fillRect","imageData","toDataURL","clearRect","putImageData","imgToDataUrl","outputFormat","createCanvas","img","ctx","drawImage","Image","crossOrigin","onload","dataURL","dataUrl","proxify","onerror","xhr","XMLHttpRequest","open","setRequestHeader","status","uInt8Array","binaryString","fromCharCode","getResponseHeader","onreadystatechange","readyState","Error","send","complete","imgTagToDataUrl","base64","addToCanvas","position","size","newCanvas","cloneCanvas","newImage","oldCanvas","mergeCanvases","canvases","rects","getBoundingClientRect","bbox","rect","left","top","right","bottom","POSITIVE_INFINITY","NEGATIVE_INFINITY","calculateAspectRatioFit","srcWidth","srcHeight","maxWidth","maxHeight","ratio","getFormattedDate","date","hasTime","pad","getFullYear","getMonth","concat","getHours","getMinutes","getSeconds","replaceSpecialCharacters","translate","ä","ö","ü","Ä","Ö","Ü","á","é","ó","ú","Á","É","Í","Ó","Ú","ñ","Ñ","downloadFileForm","async","_err","request","msg","statusText","contentDispositionHeader","contentType","format","includes","DownloadError","MIMETYPE_NOT_SUPORTED","getUID","arrDownloads","WFSQueryBuilder","layers","onlyHits","srsName","maxFeatures","fields","getSRSAttribute","getFields","tagName","vi","va","query","_queryHeaderConstructor","resultType","queryBody","queryItem","typeName","Filter","getText","layer","WFGetPropertyValue","valueReference","WFSFilterBuilder","feature","clipLayer","geometryName","where","gmlEnvelope","lowerCorner","upperCorner","Feature","writeGMLGeometry","gmlVersion","getSRSName","getGmlCoordinates","Polyline","geometry","isServiceWorker","serviceWorker","controller","state","isSameOriginByLocation","isSameProtocol","protocolRegex","uriProtocol","locationProtocol","consoleRegister","isDebug","getSorterByProperty","propName","getSoundexDifference","res","charAt","toAbsolutePath","href","explodeGeometry","origin","iterationFunction","cloneMappingFunction","isGeometry","compactGeometry","precision","MAX_VALUE","newGeom","firstIterationFunction","val","secondIterationFunction","hasStyleOptions","formatCoord","nDecimales","getWebWorkerCrossOriginURL","args","arg","queryHeader","fncOvelaps","elem1","elem2","comparisonFnc","colliding","other","rect1","rect2","containing","inside"],"mappings":"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","sourcesContent":["; var TC = TC || {};\r\n(function (root, factory) {\r\n    if (typeof exports === \"object\") { // CommonJS\r\n        module.exports = factory();\r\n    } else if (typeof define === \"function\" && define.amd) { // AMD\r\n        define([], factory);\r\n    } else {\r\n        root.Util = factory();\r\n    }\r\n})(TC, function () {\r\n\r\n    String.prototype.soundex = function () {\r\n        var a = this.toLowerCase().split('')\r\n        f = a.shift(),\r\n            r = '',\r\n            codes = {\r\n                a: '', e: '', i: '', o: '', u: '',\r\n                b: 1, f: 1, p: 1, v: 1,\r\n                c: 2, g: 2, j: 2, k: 2, q: 2, s: 2, x: 2, z: 2,\r\n                d: 3, t: 3,\r\n                l: 4,\r\n                m: 5, n: 5,\r\n                r: 6\r\n            };\r\n\r\n        r = f +\r\n            a\r\n                .map(function (v, i, a) { return codes[v] })\r\n                .filter(function (v, i, a) { return ((i === 0) ? v !== codes[f] : v !== a[i - 1]); })\r\n                .join('');\r\n\r\n        return (r + '000').slice(0, 4).toUpperCase();\r\n    }\r\n\r\n    // GLS: Parche: Chrome no formatea correctamente los números en euskera, establece como separador de decimales el (.)\r\n    var toLocaleString = Number.prototype.toLocaleString;\r\n    Number.prototype.toLocaleString = function (locale, options) {\r\n        if (locale == \"eu-ES\" && !TC.Util.detectIE()) {\r\n            var sNum = toLocaleString.apply(this, arguments);\r\n            sNum = sNum.replace(/\\,/g, '.')\r\n            if (!(Math.floor(this) == this && Number.isInteger(Math.floor(this))))\r\n                sNum = sNum.replace(/.([^.]*)$/, \",$1\");\r\n\r\n            return sNum;\r\n        }\r\n        else\r\n            return toLocaleString.apply(this, arguments);\r\n    }\r\n\r\n    var iconUrlCache = {};\r\n    var markerGroupClassCache = {};\r\n\r\n    var path1 = [\"Capability\", \"Request\", \"GetMap\", \"DCPType\", \"0\", \"HTTP\", \"Get\", \"OnlineResource\"];\r\n    var path2 = [\"OperationsMetadata\", \"GetTile\", \"DCP\", \"HTTP\", \"Get\", \"0\", \"href\"];\r\n    var getOnPath = function (obj, p, i) {\r\n        if (i < p.length - 1) {\r\n            if (obj.hasOwnProperty(p[i]))\r\n                return getOnPath(obj[p[i]], p, ++i);\r\n            else return null;\r\n        } else {\r\n            return obj[p[i]];\r\n        }\r\n    };\r\n\r\n    const swipeHandlers = new WeakMap();\r\n    const modalCloseHandlers = new WeakMap();\r\n    const hasOwn = ({}).hasOwnProperty;\r\n    const templateCache = new Map();\r\n\r\n    const countDecimals = (value)=> {\n        if (Math.floor(value) !== value)\n            return value.toString().split(\".\")[1].length || 0;\n        return 0;\n    }\r\n\r\n\r\n    var Util = {\r\n\r\n        getElevationGain: function (options) {\r\n            options = options || {};\r\n            const coords = options.coords;\r\n            if (coords && coords.length > 0 && coords[0].length > 2) { // si tenemos la Z\r\n                var uphill = 0;\r\n                var downhill = 0;\r\n                const hillDeltaThreshold = options.hillDeltaThreshold || 0;\r\n\r\n                var previousHeight;\r\n                var sectorMinHeight;\r\n                var sectorMaxHeight;\r\n                var previousUphill = true;\r\n\r\n                for (var c = 0; c < coords.length; c++) {\r\n                    var point = coords[c];\r\n                    var height = point[2];\r\n                    if (height !== null) {\r\n                        if (previousHeight === undefined) //--inicializar\r\n                        {\r\n                            previousHeight = height;\r\n                            sectorMinHeight = height;\r\n                            sectorMaxHeight = height;\r\n                        }\r\n\r\n                        sectorMinHeight = Math.min(sectorMinHeight, height); //--actualizar mínimo y máximo del sector\r\n                        sectorMaxHeight = Math.max(sectorMaxHeight, height);\r\n\r\n                        var delta = height - previousHeight; //--calcular desnivel del punto respecto al anterior\r\n                        // hillDeltaThreshold: altura de los dientes a despreciar\r\n                        if (delta > hillDeltaThreshold || (delta > 0 && c == coords.length - 1)) //--Si se sube más del filtro (o se acaba el segmento subiendo)\r\n                        {\r\n                            if (previousUphill) //--Si en el segmento anterior también se subía, incrementamos el desnivel positivo acumulado\r\n                            {\r\n                                uphill += delta;\r\n                            }\r\n                            else //--Si en el segmento anterior se bajaba, incrementamos los desniveles acumulados que no habíamos contabilizado desde el último salto del filtro (sector) \r\n                            {\r\n                                downhill -= sectorMinHeight - previousHeight;\r\n                                uphill += height - sectorMinHeight;\r\n                                previousUphill = true; //--preparar para el paso siguiente\r\n                            }\r\n                            previousHeight = height; //--preparar para el paso siguiente\r\n                            sectorMinHeight = height;\r\n                            sectorMaxHeight = height;\r\n                        }\r\n                        else if (delta < -hillDeltaThreshold || (delta < 0 && c == coords.length - 1)) //--Si se baja más del filtro (o se acaba el segmento bajando)\r\n                        {\r\n                            if (!previousUphill) //--Si en el segmento anterior también se bajaba, incrementamos el desnivel negativo acumulado\r\n                            {\r\n                                downhill -= delta;\r\n                            }\r\n                            else //--Si en el segmento anterior se subía, incrementamos los desniveles acumulados que no habíamos contabilizado desde el último salto del filtro (sector) \r\n                            {\r\n                                uphill += sectorMaxHeight - previousHeight;\r\n                                downhill -= height - sectorMaxHeight;\r\n                                previousUphill = false; //--preparar para el paso siguiente\r\n                            }\r\n                            previousHeight = height; //--preparar para el paso siguiente\r\n                            sectorMinHeight = height;\r\n                            sectorMaxHeight = height;\r\n                        }\r\n                    }\r\n                }\r\n\r\n                return {\r\n                    upHill: Math.round(uphill),\r\n                    downHill: Math.round(downhill)\r\n                };\r\n\r\n            } else { return null; }\r\n        },\r\n\r\n        isPlainObject: function (obj) {\r\n            // Not plain objects:\r\n            // - Any object or value whose internal [[Class]] property is not \"[object Object]\"\r\n            // - DOM nodes\r\n            // - window\r\n            if (typeof obj !== 'object' || obj.nodeType || obj.window === obj) {\r\n                return false;\r\n            }\r\n\r\n            if (obj.constructor &&\r\n                !hasOwn.call(obj.constructor.prototype, 'isPrototypeOf')) {\r\n                return false;\r\n            }\r\n\r\n            // If the function hasn't returned already, we're confident that\r\n            // |obj| is a plain object, created by {} or constructed with new Object\r\n            return true;\r\n        },\r\n\r\n        isEmptyObject: function (obj) {\r\n            var name;\r\n            for (name in obj) {\r\n                return false;\r\n            }\r\n            return true;\r\n        },\r\n\r\n        isFunction: function (obj) {\r\n            return typeof obj === 'function';\r\n        },\r\n\r\n        extend: function () {\r\n            var clone,\r\n                target = arguments[0] || {},\r\n                i = 1,\r\n                deep = false;\r\n\r\n            // Comprobar si hay que hacer copia profunda (primer parámetro === true)\r\n            if (typeof target === 'boolean') {\r\n                deep = target;\r\n\r\n                target = arguments[i] || {};\r\n                i++;\r\n            }\r\n\r\n            // Handle case when target is a string or something (possible in deep copy)\r\n            if (typeof target !== 'object' && !Util.isFunction(target)) {\r\n                target = {};\r\n            }\r\n\r\n            for (var len = arguments.length; i < len; i++) {\r\n                // Only deal with non-null/undefined values\r\n                const options = arguments[i];\r\n                if (options != null) {\r\n                    // Extend the base object\r\n                    for (var name in options) {\r\n                        const src = target[name];\r\n                        const copy = options[name];\r\n\r\n                        // Prevent never-ending loop\r\n                        if (target === copy) {\r\n                            continue;\r\n                        }\r\n\r\n                        // Recurse if we're merging plain objects or arrays\r\n                        const copyIsArray = Array.isArray(copy);\r\n                        if (deep && copy && (Util.isPlainObject(copy) || copyIsArray)) {\r\n                            if (copyIsArray) {\r\n                                clone = src && Array.isArray(src) ? src : [];\r\n\r\n                            } else {\r\n                                clone = src && Util.isPlainObject(src) ? src : {};\r\n                            }\r\n\r\n                            // Never move original objects, clone them\r\n                            target[name] = Util.extend(deep, clone, copy);\r\n\r\n                            // Don't bring in undefined values\r\n                        } else if (copy !== undefined) {\r\n                            target[name] = copy;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n\r\n            // Return the modified object\r\n            return target;\r\n        },\r\n\r\n        getMapLocale: function (map) {\r\n            return map.options && map.options.locale && map.options.locale.replace('_', '-') || \"es-ES\";\r\n        },\r\n\r\n        regex: {\r\n            PROTOCOL: /(^https?:)/i\r\n        },\r\n\r\n        isOnCapabilities: function (url) {\r\n            var withProtocol = arguments.length == 2 ? arguments[1] : true;\r\n            var testUrl = !withProtocol ? url.replace(Util.regex.PROTOCOL, \"\") : url;\r\n\r\n            if (withProtocol) {\r\n                if (TC.capabilities[testUrl])\r\n                    return url;\r\n            } else {\r\n                for (var c in TC.capabilities) {\r\n                    if (c.replace(Util.regex.PROTOCOL, \"\") == testUrl)\r\n                        return c;\r\n                }\r\n            }\r\n\r\n            for (c in TC.capabilities) {\r\n                var u = getOnPath(TC.capabilities[c], path1, 0) || getOnPath(TC.capabilities[c], path2, 0);\r\n\r\n                if (u && withProtocol && url == u) return u;\r\n                else if (u && url.replace(Util.regex.PROTOCOL, \"\") == u.replace(Util.regex.PROTOCOL, \"\")) return u;\r\n            }\r\n\r\n            return url;\r\n        },\r\n\r\n        reqGetMapOnCapabilities: function (url) {\r\n            var withProtocol = arguments.length == 2 ? arguments[1] : true;\r\n            var testUrl = !withProtocol ? url.replace(Util.regex.PROTOCOL, \"\") : url;\r\n\r\n            var _get = function (caps) {\r\n                var u = getOnPath(caps, path1, 0) || getOnPath(caps, path2, 0);\r\n                if (u)\r\n                    return !withProtocol ? u.split('?')[0].replace(Util.regex.PROTOCOL, \"\") : u.split('?')[0];\r\n\r\n                return null;\r\n            };\r\n            if (TC.capabilities[url]) {\r\n                return _get(TC.capabilities[url]);\r\n            }\r\n\r\n            return null;\r\n        },\r\n\r\n        getFnFromString: function (fnName) {\r\n            var scope = window;\r\n            var scopeSplit = fnName.split('.');\r\n            for (i = 0; i < scopeSplit.length - 1; i++) {\r\n                scope = scope[scopeSplit[i]];\r\n\r\n                if (scope == undefined) return;\r\n            }\r\n\r\n            return scope[scopeSplit[scopeSplit.length - 1]];\r\n        },\r\n\r\n        isURL: function (text) {\r\n            return /^(http|https|ftp|mailto)\\:\\/\\//i.test(text);\r\n        },\r\n\r\n        isSecureURL: function (url) {\r\n            //sino empieza por http ni por https la consideramos segura\r\n            if (!/^(f|ht)tps?:\\/\\//i.test(url))\r\n                return true;\r\n            return (/^(f|ht)tps:\\/\\//i.test(url));\r\n        },\r\n\r\n        isSameOrigin: function (uri) {\r\n            var result = uri.indexOf(\"http\") !== 0 && uri.indexOf(\"//\") !== 0;\r\n            var urlParts = !result && uri.match(TC.Consts.url.SPLIT_REGEX);\r\n            if (urlParts) {\r\n                var location = window.location;\r\n                var uProtocol = urlParts[1];\r\n                result =\r\n                    (uProtocol == location.protocol || uProtocol == undefined) &&\r\n                    urlParts[3] == location.hostname;\r\n                var uPort = urlParts[4], lPort = location.port;\r\n                if (uPort != 80 && uPort !== \"\" || lPort != \"80\" && lPort !== \"\") {\r\n                    result = result && uPort == lPort;\r\n                }\r\n            }\r\n            return result;\r\n        },\r\n\r\n        formatNumber: function (value, locale) {\r\n            var t = typeof value;\r\n            if (t === 'number') {\r\n                return value.toLocaleString(locale, { maximumFractionDigits: Math.min(6,countDecimals(value)) });\r\n            }\r\n            else if (t === 'string') {\r\n                n = parseFloat(value);\r\n                if (n === new Number(value).valueOf()) {\r\n                    return n.toLocaleString(locale,{ maximumFractionDigits: Math.min(6, countDecimals(n)) });\r\n                }\r\n            }\r\n            return value;\r\n        },\r\n\r\n        addProtocol: function (uri) {\r\n            var result = uri;\r\n            if (uri && uri.indexOf('//') === 0) {\r\n                result = location.protocol + uri;\r\n            }\r\n            return result;\r\n        },\r\n\r\n        /* \r\n        * getDiv: returns HTML element or null if the parameter is invalid\r\n        * Parameter: string with element ID or HTML element\r\n        */\r\n        getDiv: function (div) {\r\n            var result;\r\n            if (typeof div === 'string') {\r\n                result = document.getElementById(div);\r\n            }\r\n            else if (div instanceof HTMLElement) {\r\n                result = div;\r\n            }\r\n            else if (div && '$' in window && div instanceof $ && div.length) {\r\n                result = div[0];\r\n            }\r\n            else {\r\n                result = document.createElement('div');\r\n            }\r\n            return result;\r\n        },\r\n\r\n        getScriptLocation: function () {\r\n            var src;\r\n            var script;\r\n            if (document.currentScript) {\r\n                script = document.currentScript;\r\n            }\r\n            else {\r\n                var scripts = document.getElementsByTagName('script');\r\n                script = scripts[scripts.length - 1];\r\n            }\r\n            src = script.getAttribute('src');\r\n            if (src) {\r\n                return src.substr(0, src.lastIndexOf('/') + 1);\r\n            }\r\n            return \"\";\r\n        },\r\n\r\n        /* \r\n        * getBackgroundUrlFromCss: devuelve la URL de background-image en CSS\r\n        * Parameter: string con nombre de clase\r\n        */\r\n        getBackgroundUrlFromCss: function (cssClass) {\r\n            var result = '';\r\n\r\n            if (cssClass) {\r\n                if (iconUrlCache[cssClass] !== undefined) {\r\n                    result = iconUrlCache[cssClass];\r\n                }\r\n                else {\r\n                    const iconDiv = document.createElement('div');\r\n                    iconDiv.style.display = 'none';\r\n                    iconDiv.classList.add(cssClass);\r\n                    document.body.appendChild(iconDiv);\r\n                    // The regular expression is nongreedy (.*?), otherwise in FF and IE it gets 'url_to_image\"'\r\n                    var match = /^url\\(['\"]?(.*?)['\"]?\\)$/gi.exec(window.getComputedStyle(iconDiv, null).backgroundImage);\r\n                    if (match && match.length > 1) {\r\n                        result = match[match.length - 1];\r\n                    }\r\n                    iconDiv.parentElement.removeChild(iconDiv);\r\n                    iconUrlCache[cssClass] = result;\r\n                }\r\n            }\r\n            return result;\r\n        },\r\n\r\n        getPointIconUrl: function getPointIconUrl(options) {\r\n            var result = null;\r\n            if (options.url) {\r\n                result = options.url;\r\n            }\r\n            else {\r\n                var className;\r\n                if (typeof options.cssClass === 'string') {\r\n                    className = options.cssClass;\r\n                }\r\n                else {\r\n                    var classes = options.classes || TC.Cfg.styles.marker.classes;\r\n                    className = classes[0];\r\n                    if (options.group) {\r\n                        if (markerGroupClassCache[options.group] === undefined) {\r\n                            var i = 0;\r\n                            for (var key in markerGroupClassCache) {\r\n                                i++;\r\n                            }\r\n                            i = i % classes.length;\r\n                            markerGroupClassCache[options.group] = classes[i];\r\n                        }\r\n                        className = markerGroupClassCache[options.group];\r\n                    }\r\n                }\r\n                result = Util.getBackgroundUrlFromCss(className);\r\n            }\r\n            if (!result && options !== TC.Cfg.styles.point && options.cssClass !== '') {\r\n                result = getPointIconUrl(TC.Cfg.styles.point);\r\n            }\r\n            return result;\r\n        },\r\n\r\n        getLegendImageFromStyle: function (style, options) {\r\n            let result = null;\r\n            options = options || {};\r\n            if (style.url) {\r\n                result = style.url;\r\n            }\r\n            else {\r\n                let width = options.width || 32;\r\n                let height = options.height || 16;\r\n                const strokeWidth = style.strokeWidth || 0;\r\n                const strokeHalfWidth = strokeWidth / 2;\r\n                const fillColor = style.fillColor || 'transparent';\r\n                const fillOpacity = style.fillOpacity || 1;\r\n                const diameter = (style.radius || 0) * 2 + strokeWidth;\r\n                const lineDashText = style.lineDash ? `stroke-dasharray=\"${style.lineDash.join(' ')}\" ` : '';\r\n                let body;\r\n                width = Math.max(width, diameter);\r\n                height = Math.max(height, diameter);\r\n                switch (options.geometryType) {\r\n                    case TC.Consts.geom.POINT:\r\n                        body = `<circle cx=\"${width / 2}\" cy=\"${height / 2}\" r=\"${style.radius}\" stroke=\"${style.strokeColor}\" stroke-width=\"${strokeWidth}\" fill=\"${fillColor}\" fill-opacity=\"${fillOpacity}\" ${lineDashText}/>`;\r\n                        break;\r\n                    case TC.Consts.geom.POLYLINE:\r\n                        const xStart = strokeHalfWidth;\r\n                        const yStart = height - strokeHalfWidth;\r\n                        const xEnd = width - strokeHalfWidth;\r\n                        const yEnd = strokeHalfWidth;\r\n                        body = `<polyline points=\"${xStart},${yStart} ${xEnd},${yEnd}\" style=\"stroke:${style.strokeColor};stroke-width:${strokeWidth}\" ${lineDashText}/>`;\r\n                        break;\r\n                    case TC.Consts.geom.POLYGON:\r\n                        const x1 = strokeHalfWidth;\r\n                        const y1 = height - strokeHalfWidth;\r\n                        const x2 = strokeHalfWidth;\r\n                        const y2 = strokeHalfWidth;\r\n                        const x3 = strokeHalfWidth + width * 0.8;\r\n                        const y3 = strokeHalfWidth;\r\n                        const x4 = width - strokeHalfWidth;\r\n                        const y4 = height - strokeHalfWidth;\r\n                        body = `<polygon points=\"${x1},${y1} ${x2},${y2} ${x3},${y3} ${x4},${y4}\" style=\"stroke:${style.strokeColor};stroke-width:${strokeWidth};fill:${fillColor};fill-opacity:${fillOpacity}\" ${lineDashText}/>`;\r\n                        break;\r\n                    default:\r\n                        body = `<rect x=\"${strokeHalfWidth}\" x=\"${strokeHalfWidth}\" width=\"${width - strokeWidth}\" height=\"${height - strokeWidth}\" style=\"stroke:${style.strokeColor};stroke-width:${strokeWidth};fill:${fillColor};fill-opacity:${fillOpacity}\" ${lineDashText}/>`;\r\n                        break;\r\n                }\r\n                result = 'data:image/svg+xml,' + encodeURIComponent(`<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"${width}\" height=\"${height}\">${body}</svg>`);\r\n            }\r\n            return result;\r\n        },\r\n\r\n        /* \r\n        * addArrayToTree: añade a un array a un árbol, cada elemento en un nivel anidado\r\n        * Parameters: array, nodo de árbol, [índice]\r\n        * Returns: último nodo insertado, null si ya existía la ruta\r\n        */\r\n        addArrayToTree: function addArrayToTree(path, treeNode, index) {\r\n            var result = null;\r\n            var found = false;\r\n            index = index || 0;\r\n            var name = path[index];\r\n            if (name) {\r\n                var n;\r\n                for (var i = 0, len = treeNode.children.length; i < len; i++) {\r\n                    n = treeNode.children[i];\r\n                    if (n.name === name) {\r\n                        found = true;\r\n                        const r = addArrayToTree(path, n, index + 1);\r\n                        if (r) {\r\n                            result = r;\r\n                        }\r\n                        break;\r\n                    }\r\n                }\r\n                if (!found) {\r\n                    n = { name: name, title: name, uid: '/' + path.slice(0, index + 1).join('/'), children: [] };\r\n                    const r = addArrayToTree(path, n, index + 1);\r\n                    if (r) {\r\n                        result = r;\r\n                    }\r\n                    else {\r\n                        result = n;\r\n                    }\r\n                    treeNode.children.push(n);\r\n                }\r\n            }\r\n            return result;\r\n        },\r\n\r\n        parseCoords: function (text) {\r\n            var result = null;\r\n\r\n            var _parseGeoCoord = function (text) {\r\n                var t = text;\r\n                var result = {};\r\n                result.type = TC.Consts.GEOGRAPHIC;\r\n                var idx = t.indexOf('\\u00B0');\r\n                result.value = parseFloat(t.substr(0, idx));\r\n                t = t.substr(idx + 1);\r\n                idx = t.indexOf('\\'');\r\n                if (idx >= 0) {\r\n                    var v = parseFloat(t.substr(0, idx)) / 60;\r\n                    if (result.value >= 0) {\r\n                        result.value += v;\r\n                    }\r\n                    else {\r\n                        result.value -= v;\r\n                    }\r\n                    t = t.substr(idx + 1);\r\n                    idx = t.indexOf('\\'');\r\n                    if (idx >= 0) {\r\n                        v = parseFloat(t.substr(0, idx).replace(',', '.')) / 3600;\r\n                        if (result.value >= 0) {\r\n                            result.value += v;\r\n                        }\r\n                        else {\r\n                            result.value -= v;\r\n                        }\r\n                    }\r\n                }\r\n                return result;\r\n            };\r\n\r\n            var _parseCoord = function (text) {\r\n                var t = text.trim();\r\n                // nnºnn'nn''N\r\n                if (t.match(/^1?\\d{0,2}\\s*\\u00B0(\\s*\\d{1,2}\\s*'(\\s*\\d{1,2}([.,]\\d+)?\\s*'')?)?\\s*[NnSsWwOoEe]$/g)) {\r\n                    switch (t[t.length - 1]) {\r\n                        case 'S':\r\n                        case 's':\r\n                        case 'W':\r\n                        case 'w':\r\n                        case 'O':\r\n                        case 'o':\r\n                            t = '-' + t;\r\n                            break;\r\n                    }\r\n                    t = t.substr(0, t.length - 1);\r\n                    return _parseGeoCoord(t);\r\n                }\r\n                // +nnºnn'nn''\r\n                if (t.match(/^[+-]?1?\\d{0,2}\\s*\\u00B0(\\s*\\d{1,2}\\s*'(\\s*\\d{1,2}([.,]\\d+)?\\s*'')?)?$/g)) {\r\n                    return _parseGeoCoord(t);\r\n                }\r\n                // nn.nn N\r\n                if (t.match(/^1?\\d{0,2}([.,]\\d+)?\\s*\\u00B0?\\s*[NnSsWwOoEe]$/g)) {\r\n                    var result = { type: TC.Consts.GEOGRAPHIC, value: parseFloat(t.substr(0, t.length - 1).replace(',', '.')) };\r\n                    if (t.match(/[SsWwOo]$/)) {\r\n                        result.value = -result.value;\r\n                    }\r\n                    return result;\r\n                }\r\n                // +nn.nn\r\n                if (t.match(/^[+-]?1?\\d{0,2}([.,]\\d+)?\\s*\\u00B0?$/g)) {\r\n                    return { type: TC.Consts.GEOGRAPHIC, value: parseFloat(t.replace(',', '.')) };\r\n                }\r\n                // UTM\r\n                if (t.match(/^[-+]?\\d{6,7}([.,]\\d+)?$/g)) {\r\n                    return { type: TC.Consts.UTM, value: parseFloat(t.replace(',', '.')) };\r\n                }\r\n                return null;\r\n            };\r\n\r\n            text = text.trim().toUpperCase();\r\n            var xy = text.split(',');\r\n            if (xy.length === 4) {\r\n                xy = [xy.slice(0, 1).join('.'), xy.slice(2, 3).join('.')];\r\n            }\r\n            else if (xy.length === 1 || xy.length === 3) {\r\n                xy = text.split(' ');\r\n            }\r\n            if (xy.length === 2) {\r\n                var x = _parseCoord(xy[0]);\r\n                var y = _parseCoord(xy[1]);\r\n                if (x !== null && y !== null) {\r\n                    result = [x, y];\r\n                }\r\n            }\r\n            return result;\r\n        },\r\n\r\n        reproject: function (coords, sourceCrs, targetCrs) {\r\n            var result;\r\n            var multipoint = true;\r\n            var multiring = true;\r\n            var multipoly = true;\r\n            if (Array.isArray(coords[0])) {\r\n                if (Array.isArray(coords[0][0])) {\r\n                    if (!Array.isArray(coords[0][0][0])) {\r\n                        multipoly = false;\r\n                        coords = [coords];\r\n                    }\r\n                }\r\n                else {\r\n                    multiring = false;\r\n                    coords = [[coords]];\r\n                }\r\n            }\r\n            else {\r\n                multipoint = false;\r\n                multiring = false;\r\n                multipoly = false;\r\n                coords = [[[coords]]];\r\n            }\r\n            TC.loadProjDef({ crs: sourceCrs, sync: true });\r\n            TC.loadProjDef({ crs: targetCrs, sync: true });\r\n            var sourcePrj = proj4(proj4.defs[sourceCrs]);\r\n            var targetPrj = proj4(proj4.defs[targetCrs]);\r\n            result = new Array(coords.length);\r\n            coords.forEach(function (poly, pidx) {\r\n                const rp = result[pidx] = [];\r\n                poly.forEach(function (ring, ridx) {\r\n                    const rr = rp[ridx] = [];\r\n                    ring.forEach(function (coord, cidx) {\r\n                        if (Array.isArray(coord) && coord.length > 1) {\r\n                            var point = proj4(sourcePrj, targetPrj, { x: coord[0], y: coord[1] });\r\n                            rr[cidx] = [point.x, point.y];\r\n                            if (coord.length > 2) {\r\n                                rr[cidx][2] = coord[2];\r\n                            }\r\n                        } else {\r\n                            rr[cidx] = coord;\r\n                        }\r\n                    });\r\n                });\r\n            });\r\n            if (!multipoint) {\r\n                result = result[0][0][0];\r\n            }\r\n            else if (!multiring) {\r\n                result = result[0][0];\r\n            }\r\n            else if (!multipoly) {\r\n                result = result[0];\r\n            }\r\n            return result;\r\n        },\r\n\r\n        getMetersPerDegree: function (extent) {\r\n            let result = undefined;\r\n            const R = 6370997; // m\r\n            if (Array.isArray(extent) && extent.length >= 4) {\r\n                if (extent[3] === extent[1]) {\r\n                    result = Math.PI * R * Math.cos(this.degToRad(extent[1])) / 180;\r\n                }\r\n                else {\r\n                    const dLat = this.degToRad(extent[3] - extent[1]);\r\n                    const sindlat2 = Math.sin(dLat / 2);\r\n                    const a = sindlat2 * sindlat2;\r\n                    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\r\n                    result = R * c / (extent[3] - extent[1]);\r\n                }\r\n            }\r\n            return result;\r\n        },\r\n\r\n        radToDeg: function (rad) { // convert radians to degrees\r\n            return rad * 180 / Math.PI;\r\n        },\r\n        degToRad: function (deg) { // convert degrees to radians\r\n            return deg * Math.PI / 180;\r\n        },\r\n        mod: function (n) { // modulo for negative values\r\n            return ((n % (2 * Math.PI)) + (2 * Math.PI)) % (2 * Math.PI);\r\n        },\r\n\r\n        getCRSCode: function (crs) {\r\n            var result = null;\r\n            crs = crs.trim();\r\n            if (/^EPSG:\\d{4,6}$/g.test(crs) || //formato EPSG\r\n                /^urn:ogc:def:crs:EPSG:.*:\\d{4,6}/g.test(crs) || // formato URN\r\n                /http:\\/\\/www.opengis.net\\/gml\\/srs\\/epsg.xml#\\d{4,6}$/g.test(crs)) { // formato GML\r\n                var match = crs.trim().match(/^.+[:#](\\d{4,6})$/); // devuelve la parte numérica del código\r\n                if (match) {\r\n                    result = match[1];\r\n                }\r\n            }\r\n            return result;\r\n        },\r\n\r\n        CRSCodesEqual: function (crs1, crs2) {\r\n            if (crs1 === crs2) {\r\n                return true;\r\n            }\r\n            var code1 = this.getCRSCode(crs1);\r\n            var code2 = this.getCRSCode(crs2);\r\n            return code1 !== null && code2 !== null && code1 === code2;\r\n        },\r\n\r\n        getLocaleString: function (locale, key, texts) {\r\n            var result = key;\r\n            if (TC.i18n && TC.i18n[locale]) {\r\n                var text = TC.i18n[locale][key];\r\n                if (text) {\r\n                    result = text;\r\n                    if (texts) {\r\n                        for (var k in texts) {\r\n                            result = result.replace('{' + k + '}', texts[k]);\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            return result;\r\n        },\r\n\r\n        getRenderedHtml: function (templateOrId, data, callback) {\r\n            const compileTemplate = function (templateId, txt) {\r\n                template = TC._hbs.compile(txt); // TODO: add optimization options\r\n                TC._hbs.registerPartial(templateId, template);\r\n                templateCache.set(templateId, template);\r\n                return template;\r\n            };\r\n            const fetchTemplate = function (templateId) {\r\n                return new Promise(function (resolve, reject) {\r\n                    let template = templateCache.get(templateId);\r\n                    if (template) {\r\n                        resolve(template);\r\n                    }\r\n                    else {\r\n                        templateCache.set(templateId, true);\r\n                        TC.ajax({\r\n                            url: TC.apiLocation + `TC/templates/${templateId}.hbs`,\r\n                            method: 'GET',\r\n                            responseType: 'text'\r\n                        })\r\n                            .then(function (response) {\r\n                                const matches = response.data.match(/{{> ([a-zA-Z\\-]+)(?:(?:\\s[a-zA-Z]+)\\s*)?}}/);\r\n                                if (matches) {\r\n                                    Promise.all(matches.slice(1).map(str => fetchTemplate(str.trim()))).then(function () {\r\n                                        resolve(compileTemplate(templateId, response.data));\r\n                                    });\r\n                                }\r\n                                else {\r\n                                    resolve(compileTemplate(templateId, response.data));\r\n                                }\r\n                            })\r\n                            .catch(function (err) {\r\n                                console.log(\"Error fetching template: \" + err);\r\n                                reject(err);\r\n                            });\r\n                    }\r\n                });\r\n            };\r\n            return new Promise(function (resolve, reject) {\r\n                const endFn = function (template) {\r\n                    const html = template(data);\r\n                    if (Util.isFunction(callback)) {\r\n                        callback(html);\r\n                    }\r\n                    resolve(html);\r\n                };\r\n                if (Util.isFunction(templateOrId)) {\r\n                    endFn(templateOrId);\r\n                }\r\n                else {\r\n                    fetchTemplate(templateOrId)\r\n                        .then((template) => endFn(template))\r\n                        .catch(err => reject(err));\r\n                }\r\n            });\r\n        },\r\n\r\n        getSimpleMimeType: function (mimeType) {\r\n            var result = '';\r\n            if (mimeType) {\r\n                var end = mimeType.indexOf(';');\r\n                if (end > 0) {\r\n                    mimeType = mimeType.substring(0, end);\r\n                }\r\n                result = mimeType;\r\n            }\r\n            return result;\r\n        },\r\n\r\n        getQueryStringParams: function (url) {\r\n            var queryString;\r\n            if (url) {\r\n                var queryIdx = url.indexOf('?');\r\n                if (queryIdx >= 0) {\r\n                    queryString = url.substr(queryIdx);\r\n                    var fragmentIdx = queryString.indexOf('#');\r\n                    if (fragmentIdx >= 0) {\r\n                        queryString = queryString.substr(0, fragmentIdx)\r\n                    }\r\n                }\r\n                else {\r\n                    queryString = '?';\r\n                }\r\n            }\r\n            else {\r\n                queryString = location.search;\r\n            }\r\n            var result = queryString.replace(/(^\\?)/, '').split(\"&\").map(function (elm) {\r\n                return elm = elm.split(\"=\"), this[elm[0]] = elm[1], this\r\n            }.bind({}))[0];\r\n            delete result[''];\r\n            return result;\r\n        },\r\n\r\n        getParamString: function (obj) {\r\n            const arr = [];\r\n            for (var key in obj) {\r\n                arr.push(encodeURIComponent(key) + '=' + encodeURIComponent(obj[key]));\r\n            }\r\n            return arr.join('&').replace(/%20/g, '+');\r\n        },\r\n\r\n        fastUnshift: function (a, elm) {\r\n            var len = a.length;\r\n            while (len) {\r\n                a[len] = a[len - 1];\r\n                len--;\r\n            }\r\n            a[0] = elm;\r\n        },\r\n\r\n        storage: {\r\n            getCookie: function (key) {\r\n                return TC.cookie(key);\r\n            },\r\n            setCookie: function (key, value, options) {\r\n                return TC.cookie(key, value, options);\r\n            },\r\n            getLocalValue: function (key) {\r\n                var result = null;\r\n                if (localStorage && localStorage instanceof Storage) {\r\n                    result = localStorage.getItem(key);\r\n                }\r\n                else {\r\n                    result = Util.storage.getCookie(key);\r\n                }\r\n                return result;\r\n            },\r\n            setLocalValue: function (key, value) {\r\n                if (localStorage && localStorage instanceof Storage) {\r\n                    if (value === undefined) {\r\n                        localStorage.removeItem(key);\r\n                    }\r\n                    else {\r\n                        localStorage.setItem(key, value);\r\n                    }\r\n                }\r\n                else {\r\n\r\n                    if (value === undefined) {\r\n                        var exDate = new Date();\r\n                        exDate.setDate(exDate.getDate() - 1);\r\n                        Util.storage.setCookie(key, \"\", { expires: exDate });\r\n                    }\r\n                    else {\r\n                        Util.storage.setCookie(key, value);\r\n                    }\r\n                }\r\n                return key;\r\n            },\r\n            getSessionLocalValue: function (key) {\r\n                var result = null;\r\n                if (sessionStorage && sessionStorage instanceof Storage) {\r\n                    result = sessionStorage.getItem(key);\r\n                }\r\n                else {\r\n                    result = Util.storage.getCookie(key);\r\n                }\r\n                return result;\r\n            },\r\n            setSessionLocalValue: function (key, value) {\r\n                if (sessionStorage && sessionStorage instanceof Storage) {\r\n                    if (value === undefined) {\r\n                        sessionStorage.removeItem(key);\r\n                    }\r\n                    else {\r\n                        sessionStorage.setItem(key, value);\r\n                    }\r\n                }\r\n                else {\r\n\r\n                    if (value === undefined) {\r\n                        var exDate = new Date();\r\n                        exDate.setDate(exDate.getDate() - 1);\r\n                        Util.storage.setCookie(key, \"\", { expires: exDate });\r\n                    }\r\n                    else {\r\n                        Util.storage.setCookie(key, value);\r\n                    }\r\n                }\r\n                return key;\r\n            }\r\n        },\r\n        detectFirefox: function () {\r\n            if (/Firefox[\\/\\s](\\d+\\.\\d+)/.test(navigator.userAgent)) //test for Firefox/x.x or Firefox x.x (ignoring remaining digits);\r\n                return new Number(RegExp.$1); // capture x.x portion and store as a number\r\n            else\r\n                return false;\r\n        },\r\n        detectIE: function () {\r\n            var ua = window.navigator.userAgent;\r\n\r\n            var msie = ua.indexOf('MSIE ');\r\n            if (msie > 0) {\r\n                // IE 10 or older => return version number\r\n                return parseInt(ua.substring(msie + 5, ua.indexOf('.', msie)), 10);\r\n            }\r\n\r\n            var trident = ua.indexOf('Trident/');\r\n            if (trident > 0) {\r\n                // IE 11 => return version number\r\n                var rv = ua.indexOf('rv:');\r\n                return parseInt(ua.substring(rv + 3, ua.indexOf('.', rv)), 10);\r\n            }\r\n\r\n            // GLS: 13/02/2019. Comento lo que respecta a Edge, no tiene sentido meterlo en el mismo saco que un navegador obsoleto.\r\n            // No lo comento porque en la mesa no hay quorum.\r\n            var edge = ua.indexOf('Edge/');\r\n            if (edge > 0) {\r\n                // IE 12 => return version number\r\n                return parseInt(ua.substring(edge + 5, ua.indexOf('.', edge)), 10);\r\n            }\r\n\r\n            // other browser\r\n            return false;\r\n        },\r\n        detectChrome: function () {\r\n            return window.chrome;\r\n\r\n        },\r\n        detectSafari: function () {\r\n            return !!navigator.userAgent.match(/Version\\/[\\d\\.]+.*Safari/);\r\n        },\r\n        detectMouse: function () {\r\n            const matchesCoarse = matchMedia('(pointer:coarse)').matches;\r\n            const matchesFine = matchMedia('(pointer:fine)').matches;\r\n            if (matchesCoarse && matchesFine) {\r\n                return true;\r\n            }\r\n            if (matchesCoarse && !matchesFine) {\r\n                var testHover = function () {\r\n                    //console.log('estamos en testHover');\r\n                    var mq = '(hover: hover)',\r\n                        hover = !TC.browserFeatures.touch(), // fallback if mq4 not supported: no hover for touch\r\n                        mqResult;\r\n\r\n                    mqResult = window.matchMedia(mq);\r\n                    //console.log('resultado de window.matchMedia(mq): ' + mqResult.media);\r\n                    //console.log('mq: ' + mq);\r\n                    if (mqResult.media === mq) {\r\n                        //console.log('es igual');\r\n                        // matchMedia supports hover detection, so we rely on that\r\n                        hover = mqResult.matches;\r\n                        //console.log('va retornar: ' + hover);\r\n                    }\r\n\r\n                    return hover;\r\n                };\r\n\r\n                if (testHover())\r\n                    return true;\r\n                else return false;\r\n            }\r\n            if (!matchesCoarse && matchesFine) {\r\n                return true;\r\n            }\r\n            if (matchMedia('(pointer:none)').matches) {\r\n                return false;\r\n            }\r\n            if (!TC.browserFeatures.touch()) {\r\n                return true;\r\n            }\r\n        },\r\n        detectAndroid: function () {\r\n            return navigator.userAgent.match(/Android/i);\r\n        },\r\n        detectBlackBerry: function () {\r\n            return navigator.userAgent.match(/BlackBerry/i);\r\n        },\r\n        detectIOS: function () {\r\n            return navigator.userAgent.match(/iPhone|iPad|iPod/i);\r\n        },\r\n        detectMobileWindows: function () {\r\n            return navigator.userAgent.match(/IEMobile/i);\r\n        },\r\n        detectMobile: function () {\r\n            return (Util.detectAndroid() || Util.detectIOS() || Util.detectMobileWindows() || Util.detectBlackBerry());\r\n        },\r\n        getBrowser: function () {\r\n            if (!window.UAParser) {\r\n                TC.syncLoadJS(TC.apiLocation + TC.Consts.url.UA_PARSER);\r\n            }\r\n\r\n            var parser = new UAParser();\r\n            var browser = parser.getBrowser();\r\n            return { name: browser.name, version: browser.major };\r\n        },\r\n        getElementByNodeName: function (parentNode, nodeName) {\r\n            var colonIndex = nodeName.indexOf(\":\");\r\n            var tag = nodeName.substr(colonIndex + 1);\r\n            var nodes = parentNode.getElementsByTagNameNS(\"*\", tag);\r\n\r\n            for (var i = 0; i < nodes.length; i++) {\r\n                if (nodes[i].nodeName == nodeName)\r\n                    return nodes;\r\n            }\r\n            return undefined;\r\n        },\r\n        addURLParameters: function (url, parameters) {\r\n            if (!parameters) {\r\n                return url;\r\n            }\r\n            var toAdd = Object.keys(parameters).map(function (key) {\r\n                return encodeURIComponent(key) + '=' + (parameters[key] ? encodeURIComponent(parameters[key]) : '');\r\n            }).join('&');\r\n\r\n            var urlparts = url.split('?');\r\n            if (urlparts.length >= 2) {\r\n\r\n                var params = urlparts[1].split(/[&;]/g);\r\n                params.push(toAdd);\r\n\r\n                url = urlparts[0] + '?' + params.join('&');\r\n                return url;\r\n            } else {\r\n                urlparts = url.split('#');\r\n                if (urlparts.length >= 2) {\r\n                    urlparts.shift();\r\n                    url = urlparts[0] + '?' + toAdd + '#' + urlparts.join('#');\r\n                    return url;\r\n                }\r\n                else {\r\n                    url = url + '?' + toAdd;\r\n                    return url;\r\n                }\r\n            }\r\n        },\r\n        removeURLParameter: function (url, parameter) {\r\n            var urlparts = url.split('?');\r\n            if (urlparts.length >= 2) {\r\n\r\n                var prefix = encodeURIComponent(parameter.toLowerCase()) + '=';\r\n                var pars = urlparts[1].toLowerCase().split(/[&;]/g);\r\n\r\n                //reverse iteration as may be destructive\r\n                for (var i = pars.length; i-- > 0;) {\r\n                    //idiom for string.startsWith\r\n                    if (pars[i].lastIndexOf(prefix, 0) !== -1) {\r\n                        pars.splice(i, 1);\r\n                    }\r\n                }\r\n\r\n                url = urlparts[0] + '?' + pars.join('&');\r\n                return url;\r\n            } else {\r\n                return url;\r\n            }\r\n        },\r\n\r\n        showModal: function (contentNode, options) {\r\n            options = options || {};\r\n\r\n            contentNode.hidden = false;\r\n            if (window.jQuery && contentNode instanceof jQuery) {\r\n                contentNode = contentNode.get(0);\r\n            }\r\n            contentNode.classList.add(TC.Consts.classes.VISIBLE);\r\n            const closeButton = contentNode.querySelectorAll('.tc-modal-close');\r\n            if (closeButton && closeButton.length > 0) {\r\n                for (var i = 0; i < closeButton.length; i++) {\r\n                    var closeCallback = modalCloseHandlers.get(closeButton[i]);\r\n                    if (closeCallback) {\r\n                        modalCloseHandlers.delete(closeButton[i]);\r\n                    }\r\n                    else {\r\n                        closeCallback = function (e) {\r\n                            e.stopPropagation();\r\n                            return TC.Util.closeModal(options.closeCallback, e.target);\r\n                        };\r\n                        modalCloseHandlers.set(closeButton[i], closeCallback);\r\n                    }\r\n                    modalCloseHandlers.set(closeButton[i], closeCallback);\r\n                    closeButton[i].addEventListener('click', closeCallback);                    \r\n                }\r\n            }\r\n\r\n            if (Util.isFunction(options.openCallback)) {\r\n                options.openCallback();\r\n            }\r\n        },\r\n\r\n        closeModal: function (callback, target) {\r\n\r\n            const hide = function (modal) {\r\n                modal.classList.remove(TC.Consts.classes.VISIBLE);\r\n            };\r\n\r\n            var modal;\r\n            if (target) {\r\n                modal = target;\r\n                while (modal && !modal.matches('.tc-modal')) {\r\n                    modal = modal.parentElement;\r\n                }\r\n\r\n                hide(modal);\r\n            } else {\r\n                Array.prototype.forEach.call(document.querySelectorAll('.tc-modal'), function (modal) {\r\n                    hide(modal);\r\n                });\r\n            }\r\n\r\n            if (callback) {\r\n                callback();\r\n            }\r\n        },\r\n\r\n        closeAlert: function (btn) {\r\n            var elm = btn;\r\n            do {\r\n                elm = elm.parentElement;\r\n                if (elm.matches('.tc-alert')) {\r\n                    elm.style.display = 'none';\r\n                }\r\n            }\r\n            while (elm);\r\n        },\r\n\r\n        swipe: function (target, options) {\r\n            const addListeners = function (handlers) {\r\n                target.addEventListener('mousedown', handlers.start);\r\n                target.addEventListener('touchstart', handlers.start, { passive: true });\r\n                target.addEventListener('mouseup', handlers.end);\r\n                target.addEventListener('touchend', handlers.end, { passive: true });\r\n            };\r\n\r\n            if (options === 'disable') {\r\n                const handlers = swipeHandlers.get(target);\r\n                if (handlers) {\r\n                    target.removeEventListener('mousedown', handlers.start);\r\n                    target.removeEventListener('touchstart', handlers.start);\r\n                    target.removeEventListener('mouseup', handlers.end);\r\n                    target.removeEventListener('touchend', handlers.end);\r\n                }\r\n                return;\r\n            }\r\n            else if (options === 'enable') {\r\n                const handlers = swipeHandlers.get(target);\r\n                if (handlers) {\r\n                    addListeners(handlers);\r\n                }\r\n                return;\r\n            }\r\n\r\n            options = options || {};\r\n            const minDistance = options.minDistance || 30;\r\n            const maxCrossDistance = options.maxCrossDistance || 30;\r\n            const maxAllowedTime = options.maxAllowedTime || 1000;\r\n            var touchStartCoords = { 'x': -1, 'y': -1 }, // X and Y coordinates on mousedown or touchstart events.\r\n                touchEndCoords = { 'x': -1, 'y': -1 },// X and Y coordinates on mouseup or touchend events.\r\n                startTime = 0,// Time on swipeStart\r\n                elapsedTime = 0;// Elapsed time between swipeStart and swipeEnd\r\n\r\n            const getDirection = function (startCoords, endCoords) {\r\n                const dx = endCoords.x - startCoords.x;\r\n                const dy = endCoords.y - startCoords.y;\r\n                const adx = Math.abs(dx);\r\n                const ady = Math.abs(dy);\r\n                if (adx > ady && adx > minDistance && ady <= maxCrossDistance) {\r\n                    return dx < 0 ? 'left' : 'right';\r\n                }\r\n                if (ady > adx && ady > minDistance && adx <= maxCrossDistance) {\r\n                    return dy < 0 ? 'up' : 'down';\r\n                }\r\n                return 'none';\r\n            };\r\n\r\n            const mustSwipe = function (e) {\r\n                if (options.noSwipe) {\r\n                    var elm = e.target;\r\n                    while (elm && elm !== target) {\r\n                        if (elm.matches && elm.matches(options.noSwipe)) {\r\n                            return false;\r\n                        }\r\n                        elm = elm.parentNode;\r\n                    }\r\n                }\r\n                return true;\r\n            };\r\n\r\n            const swipeStart = function (e) {\r\n                if (mustSwipe(e)) {\r\n                    e = 'changedTouches' in e ? e.changedTouches[0] : e;\r\n                    touchStartCoords.x = e.pageX;\r\n                    touchStartCoords.y = e.pageY;\r\n                    startTime = new Date().getTime();\r\n                }\r\n            };\r\n\r\n            const swipeEnd = function (e) {\r\n                if (startTime) {\r\n                    e = 'changedTouches' in e ? e.changedTouches[0] : e;\r\n                    touchEndCoords.x = e.pageX;\r\n                    touchEndCoords.y = e.pageY;\r\n                    elapsedTime = new Date().getTime() - startTime;\r\n                    if (elapsedTime <= maxAllowedTime) {\r\n                        const callback = options[getDirection(touchStartCoords, touchEndCoords)];\r\n                        if (callback) {\r\n                            callback.call(target);\r\n                        }\r\n                    }\r\n                    startTime = 0;\r\n                }\r\n            };\r\n\r\n            const handlers = {\r\n                start: swipeStart,\r\n                end: swipeEnd\r\n            };\r\n            swipeHandlers.set(target, handlers);\r\n            addListeners(handlers);\r\n        },\r\n\r\n        getParameterByName: function (name) {\r\n            const filter = ([key, value]) => key.toLowerCase() == name.toLowerCase();\r\n            const params = new URLSearchParams(location.search);\r\n            const paramsArray = Array.from(params);\r\n            const result = paramsArray.find(filter);            \r\n            return result ? result[1] : \"\";\r\n        },\r\n\r\n        getLocaleUserChoice: function (options) {\r\n            var result = 'en-US';\r\n            options = options || {};\r\n            var cookieName = options.cookieName || 'SITNA.language';\r\n            var paramName = options.paramName || 'lang';\r\n            // Obtenemos preferencia de lenguaje\r\n            var browserLanguage = (navigator.languages && navigator.languages.length) ? navigator.languages[0] : navigator.language || navigator.userLanguage;\r\n            var lang = TC.Util.getParameterByName(paramName) || TC.Util.storage.getCookie(cookieName) || browserLanguage;\r\n            var hyphenIdx = lang.indexOf('-');\r\n            if (hyphenIdx >= 0) {\r\n                lang = lang.substr(0, hyphenIdx);\r\n            }\r\n            var expirationDate = new Date(new Date().getTime() + 365 * 24 * 60 * 60 * 1000);\r\n            TC.Util.storage.setCookie(cookieName, lang, { expires: expirationDate });\r\n\r\n            switch (lang) {\r\n                case 'eu':\r\n                    result = 'eu-ES';\r\n                    break;\r\n                case 'es':\r\n                    result = 'es-ES';\r\n                    break;\r\n                default:\r\n                    result = 'en-US';\r\n                    break;\r\n            }\r\n            return result;\r\n        },\r\n\r\n        getValidFilename: function (filename) {\r\n            return (filename || '').replace(/[/\\\\?%*:|\"<>]/g, '-');\r\n        },\r\n\r\n        downloadBlob: function (filename, blob) {\r\n            var link = document.createElement(\"a\");\r\n            if (link.download !== undefined) {\r\n                var url = URL.createObjectURL(blob);\r\n                link.setAttribute(\"href\", url);\r\n                link.setAttribute(\"download\", TC.Util.getValidFilename(filename));\r\n                link.style.visibility = 'hidden';\r\n                document.body.appendChild(link);\r\n                link.click();\r\n                document.body.removeChild(link);\r\n            }\r\n        },\r\n\r\n        downloadFile: function (filename, type, data) {\r\n            var blob = new Blob([data], { type: type });\r\n            filename = TC.Util.getValidFilename(filename);\r\n            if (navigator.msSaveBlob) { // IE 10+\r\n                navigator.msSaveBlob(blob, filename);\r\n            } else {\r\n                TC.Util.downloadBlob(filename, blob);\r\n            }\r\n        },\r\n\r\n        downloadDataURI: function (filename, type, dataURI) {\r\n            var binary = atob(dataURI.split(',')[1]);\r\n\r\n            var array = [];\r\n            for (var i = 0; i < binary.length; i++) {\r\n                array.push(binary.charCodeAt(i));\r\n            }\r\n            var blob = new Blob([new Uint8Array(array)], { type: type });\r\n\r\n            filename = TC.Util.getValidFilename(filename);\r\n            if (navigator.msSaveBlob) { // IE 10+\r\n                navigator.msSaveBlob(blob, filename);\r\n            } else {\r\n                TC.Util.downloadBlob(filename, blob);\r\n            }\r\n        },\r\n\r\n        /**\r\n         * Acorta una URL utilizando el servicio de Bit.ly. No funciona para URLs locales.\r\n         */\r\n        shortenUrl: function (url) {\r\n            return new Promise(function (resolve, reject) {\r\n                TC.ajax({\r\n                    url: \"https://api-ssl.bitly.com/v3/shorten\",\r\n                    data: { access_token: \"6c466047309f44bd8173d83e81491648b243ee3d\", longUrl: url },\r\n                })\r\n                    .then(function (response) {\r\n                        resolve(response.data);\r\n                    })\r\n                    .catch(function (e) {\r\n                        reject(e);\r\n                    });\r\n            });\r\n        },\r\n\r\n        /**\r\n         * Convierte a Base64.\r\n         */\r\n        utf8ToBase64: function (str) {\r\n            return window.btoa(unescape(encodeURIComponent(str)));\r\n        },\r\n\r\n        /**\r\n         * Decodifica un string en Base64.\r\n         */\r\n        base64ToUtf8: function (str) {\r\n            var result;\r\n            try {\r\n                result = decodeURIComponent(escape(window.atob(str)));\r\n            }\r\n            catch (error) {\r\n                result = null;\r\n            }\r\n            return result;\r\n        },\r\n\r\n        colorArrayToString: function (color) {\r\n            if (Array.isArray(color)) {\r\n                color = color\r\n                    .slice(0, 3)\r\n                    .reduce(function (prev, cur) {\r\n                        const str = cur.toString(16);\r\n                        return prev + '00'.substring(0, 2 - str.length) + str;\r\n                    }, '#');\r\n            }\r\n            return color;\r\n        },\r\n\r\n        // Generic helper function that can be used for the three operations:        \r\n        operation: function (list1, list2, comparerFn, operationIsUnion) {\r\n            var result = [];\r\n\r\n            for (var i = 0; i < list1.length; i++) {\r\n                var item1 = list1[i],\r\n                    found = false;\r\n                for (var j = 0; j < list2.length; j++) {\r\n                    if (comparerFn(item1, list2[j])) {\r\n                        found = true;\r\n                        break;\r\n                    }\r\n                }\r\n                if (found === operationIsUnion) {\r\n                    result.push(item1);\r\n                }\r\n            }\r\n            return result;\r\n        },\r\n        isSecureURL: function (url) {\r\n            //sino empieza por http ni por https la consideramos segura\r\n            if (!/^(f|ht)tps?:\\/\\//i.test(url))\r\n                return true;\r\n            return (/^(f|ht)tps:\\/\\//i.test(url));\r\n        },\r\n\r\n        // Following functions are to be used:\r\n        inBoth: function (list1, list2, comparerFn) {\r\n            return this.operation(list1, list2, comparerFn, true);\r\n        },\r\n\r\n        inFirstOnly: function (list1, list2, comparerFn) {\r\n            return this.operation(list1, list2, comparerFn, false);\r\n        },\r\n\r\n        inSecondOnly: function (list1, list2, comparerFn) {\r\n            return this.inFirstOnly(list2, list1, comparerFn);\r\n        },\r\n\r\n        toDataUrl: function (canvas, backgroundColour) {\r\n            var defaultOptions = { type: 'image/png', encoderOptions: 0.92 };\r\n\r\n            var _ref = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : defaultOptions,\r\n                type = _ref.type,\r\n                encoderOptions = _ref.encoderOptions;\r\n\r\n            var context = canvas.getContext('2d');\r\n\r\n            if (!context) {\r\n                return '';\r\n            }\r\n\r\n            var width = canvas.width;\r\n            var height = canvas.height;\r\n\r\n            var data = context.getImageData(0, 0, width, height);\r\n            var compositeOperation = context.globalCompositeOperation;\r\n\r\n            if (backgroundColour) {\r\n\r\n                context.globalCompositeOperation = 'destination-over';\r\n                context.fillStyle = backgroundColour;\r\n                context.fillRect(0, 0, width, height);\r\n            }\r\n\r\n            var imageData = canvas.toDataURL(type, encoderOptions);\r\n\r\n            if (backgroundColour) {\r\n                context.clearRect(0, 0, width, height);\r\n                context.putImageData(data, 0, 0);\r\n                context.globalCompositeOperation = compositeOperation;\r\n            }\r\n\r\n            return imageData;\r\n        },\r\n\r\n        imgToDataUrl: function (src, outputFormat) {\r\n\r\n            var createCanvas = function (img) {\r\n                var canvas = document.createElement('CANVAS');\r\n                var ctx = canvas.getContext('2d');\r\n                canvas.height = img.height;\r\n                canvas.width = img.width;\r\n                ctx.drawImage(img, 0, 0);\r\n\r\n                return canvas;\r\n            };\r\n\r\n            return new Promise(function (resolve, reject) {\r\n                if (!outputFormat) {\r\n                    switch (src.substr(src.lastIndexOf('.') + 1).toLowerCase()) {\r\n                        case 'svg':\r\n                            outputFormat: 'image/svg+xml';\r\n                            break;\r\n                        case 'png':\r\n                            outputFormat: 'image/png';\r\n                            break;\r\n                        case 'gif':\r\n                            outputFormat: 'image/gif';\r\n                            break;\r\n                        default:\r\n                            outputFormat = 'image/jpeg';\r\n                    }\r\n                }\r\n\r\n                var img = new Image();\r\n                img.crossOrigin = 'anonymous';\r\n                img.onload = function () {\r\n                    var canvas = createCanvas(img);\r\n                    var dataURL;\r\n\r\n                    try {\r\n                        dataURL = TC.Util.toDataUrl(canvas, '#ffffff', {\r\n                            type: outputFormat,\r\n                            encoderOptions: 1.0\r\n                        });\r\n                        resolve({ dataUrl: dataURL, canvas: canvas });\r\n                    } catch (error) {\r\n                        img.src = TC.proxify(src);\r\n                    }\r\n                };\r\n\r\n                img.onerror = function (error) {\r\n                    var xhr = new XMLHttpRequest();\r\n                    xhr.open('GET', TC.proxify(src), true);\r\n                    xhr.setRequestHeader(\"Content-Type\", \"application/x-www-form-urlencoded\");\r\n\r\n                    xhr.responseType = 'arraybuffer';\r\n                    xhr.onload = function (e) {\r\n                        if (this.status === 200) {\r\n                            var uInt8Array = new Uint8Array(this.response);\r\n                            var i = uInt8Array.length;\r\n                            var binaryString = new Array(i);\r\n                            while (i--) {\r\n                                binaryString[i] = String.fromCharCode(uInt8Array[i]);\r\n                            }\r\n                            var data = binaryString.join('');\r\n                            var type = xhr.getResponseHeader('content-type');\r\n                            if (type.indexOf('image') === 0) {\r\n                                img.src = 'data:' + type + ';base64,' + window.btoa(data);\r\n                                img.onload = function () {\r\n                                    var canvas = createCanvas(img);\r\n                                    dataURL = TC.Util.toDataUrl(canvas, '#ffffff', {\r\n                                        type: outputFormat || 'image/jpeg',\r\n                                        encoderOptions: 1.0\r\n                                    });\r\n                                    resolve({ dataUrl: dataURL, canvas: canvas });\r\n                                }\r\n                            }\r\n                        }\r\n                    };\r\n                    xhr.onreadystatechange = function () {\r\n                        if (xhr.readyState === 4) {\r\n                            if (xhr.status !== 200) {\r\n                                reject(Error('HTTP error ' + xhr.status));\r\n                            }\r\n                        }\r\n                    };\r\n\r\n                    xhr.send();\r\n                };\r\n\r\n                img.src = src;\r\n                if (img.complete || img.complete === undefined) {\r\n                    img.src = \"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==\";\r\n                    img.src = src;\r\n                }\r\n            });\r\n        },\r\n\r\n        imgTagToDataUrl: function (img, outputFormat) {\r\n            var createCanvas = function (img) {\r\n                var canvas = document.createElement('CANVAS');\r\n                var ctx = canvas.getContext('2d');\r\n                canvas.height = img.height;\r\n                canvas.width = img.width;\r\n                ctx.drawImage(img, 0, 0);\r\n\r\n                return canvas;\r\n            };\r\n\r\n            var canvas = createCanvas(img);\r\n            var dataURL;\r\n\r\n            try {\r\n                dataURL = TC.Util.toDataUrl(canvas, '#ffffff', {\r\n                    type: outputFormat || 'image/jpeg',\r\n                    encoderOptions: 1.0\r\n                });\r\n                return { base64: dataURL, canvas: canvas };\r\n            } catch (error) {\r\n                return null;\r\n            }\r\n        },\r\n\r\n        addToCanvas: function (canvas, img, position, size) {\r\n            var newCanvas = TC.Util.cloneCanvas(canvas);\r\n            var context = newCanvas.getContext('2d');\r\n\r\n            return new Promise(function (resolve, reject) {\r\n                var newImage = new Image();\r\n                img.crossOrigin = 'anonymous';\r\n                newImage.src = img;\r\n                newImage.onload = function () {\r\n                    if (size) {\r\n                        context.drawImage(newImage, position.x || 0, position.y || 0, size.width, size.height);\r\n                    } else {\r\n                        context.drawImage(newImage, position.x || 0, position.y || 0);\r\n                    }\r\n                    resolve(newCanvas);\r\n                }\r\n            });\r\n        },\r\n\r\n        cloneCanvas: function (oldCanvas) {\r\n            //create a new canvas\r\n            var newCanvas = document.createElement('canvas');\r\n            var context = newCanvas.getContext('2d');\r\n\r\n            //set dimensions\r\n            newCanvas.width = oldCanvas.width;\r\n            newCanvas.height = oldCanvas.height;\r\n\r\n            //apply the old canvas to the new one\r\n            context.drawImage(oldCanvas, 0, 0);\r\n\r\n            //return the new canvas\r\n            return newCanvas;\r\n        },\r\n\r\n        mergeCanvases: function (canvases) {\r\n            const rects = canvases.map(c => c.getBoundingClientRect());\r\n            const bbox = rects.reduce(function (prev, rect) {\r\n                return [\r\n                    Math.min(prev[0], rect.left),\r\n                    Math.min(prev[1], rect.top),\r\n                    Math.max(prev[2], rect.right),\r\n                    Math.max(prev[3], rect.bottom)\r\n                ];\r\n            }, [\r\n                    Number.POSITIVE_INFINITY,\r\n                    Number.POSITIVE_INFINITY,\r\n                    Number.NEGATIVE_INFINITY,\r\n                    Number.NEGATIVE_INFINITY\r\n                ]);\r\n            const left = bbox[0];\r\n            const top = bbox[1];\r\n\r\n            //create a new canvas\r\n            const newCanvas = document.createElement('canvas');\r\n            const context = newCanvas.getContext('2d');\r\n\r\n            //set dimensions\r\n            newCanvas.width = bbox[2] - left;\r\n            newCanvas.height = bbox[3] - top;\r\n\r\n            //apply the old canvases to the new one\r\n            canvases.forEach(function (canvas, idx) {\r\n                const rect = rects[idx];\r\n                context.drawImage(canvas, rect.left - left, rect.top - top);\r\n            });\r\n\r\n            //return the new canvas\r\n            return newCanvas;\r\n        },\r\n\r\n        calculateAspectRatioFit: function (srcWidth, srcHeight, maxWidth, maxHeight) {\r\n            var ratio = Math.min(maxWidth / srcWidth, maxHeight / srcHeight);\r\n\r\n            return { width: srcWidth * ratio, height: srcHeight * ratio };\r\n        },\r\n\r\n        getFormattedDate: function (date, hasTime) {\r\n            function pad(s) { return (s < 10) ? '0' + s : s; }\r\n\r\n            var d = new Date(date);\r\n            return [d.getFullYear(), pad(d.getMonth() + 1), pad(d.getDate())].concat(hasTime ? [\"_\", pad(d.getHours()), pad(d.getMinutes()), pad(d.getSeconds())] : []).join('');\r\n\r\n        },\r\n\r\n        replaceSpecialCharacters: function (t) {\r\n            var translate = {\r\n                \"ä\": \"a\", \"ö\": \"o\", \"ü\": \"u\",\r\n                \"Ä\": \"A\", \"Ö\": \"O\", \"Ü\": \"U\",\r\n                \"á\": \"a\", \"é\": \"e\", \"i\": \"i\", \"ó\": \"o\", \"ú\": \"u\",\r\n                \"Á\": \"A\", \"É\": \"E\", \"Í\": \"I\", \"Ó\": \"O\", \"Ú\": \"U\",\r\n                \"ñ\": \"n\", \"Ñ\": \"N\"\r\n            };\r\n            return t.replace(/[öäüÖÄÜáéíóúÁÉÍÓÚñÑ]/g, function (match) {\r\n                return translate[match];\r\n            });\r\n        },\r\n\r\n        downloadFileForm: async function (url, data) {\r\n            var download = async function (url, data) {\r\n\r\n                var response = await new Promise(function (resolve, reject) {\r\n                    const request = new XMLHttpRequest();\r\n                    request.responseType = \"blob\";\r\n                    request.open(\"POST\", url);\r\n                    request.setRequestHeader('Content-Type', 'application/xml; charset=UTF-8');\r\n\r\n                    request.onreadystatechange = function (e) {\r\n                        if (request.readyState === 4) { // DONE\r\n                            if (request.status !== 200) {\r\n                                reject({\r\n                                    status: request.status,\r\n                                    msg: request.statusText,\r\n                                    url: url\r\n                                });\r\n                            } else {\r\n\r\n                                try {\r\n                                    //URI: Miro si devuelve una cabecera content-disposition attachment. Si es asi uso el filenae como nombre de fichero. Esta descarga seguramente venga\r\n                                    //de un proxy con postproceso de zippeado\r\n                                    const contentDispositionHeader = request.getResponseHeader(\"Content-disposition\");\r\n                                    var filename = \"\";\r\n                                    if (contentDispositionHeader) {\r\n                                        filename = contentDispositionHeader.split(\"; \")[1].substring(9);\r\n                                        if (contentDispositionHeader.split(\"; \")[0] !== \"attachment\") {\r\n                                            filename = filename.substring(0, filename.lastIndexOf(\".\"));\r\n                                        }\r\n                                    }\r\n                                    resolve({ data: request.response, contentType: request.getResponseHeader(\"Content-type\"), filename: filename });\r\n                                }\r\n                                catch (error) {\r\n                                    reject(error);\r\n                                }\r\n                            }\r\n                        }\r\n                    };\r\n\r\n                    try {\r\n                        request.send(data);\r\n                    } catch (error) {\r\n                        reject(error);\r\n                    }\r\n                });\r\n                var format = \"\";\r\n                if (response.data.type.indexOf(\"kml\") >= 0)\r\n                    format = \".kml\";\r\n                else if (response.data.type.indexOf(\"json\") >= 0)\r\n                    format = \".geojson\";\r\n                else if (response.data.type.indexOf(\"xml\") >= 0) {\r\n                    format = \".gml\";\r\n                    if (/outputFormat=\"\\S{1,}\"/.exec(data)[0].includes(\".kml\") || /outputFormat=\"\\S{1,}\"/.exec(data)[0].includes(\"shape-zip\")) {\r\n                        throw { key: TC.Consts.DownloadError.MIMETYPE_NOT_SUPORTED, url: url, data: data, format: /outputFormat=\"\\S{1,}\"/.exec(data)[0] };\r\n                    }\r\n                }\r\n                TC.Util.downloadFile((response.filename ? response.filename : TC.getUID()) + format, response.contentType, response.data);\r\n\r\n            };\r\n            var _err;\r\n            if (Array.isArray(url)) {\r\n                var arrDownloads = url;\r\n                for (var i = 0; i < arrDownloads.length; i++) {\r\n                    try {\r\n                        await download(arrDownloads[i].url, arrDownloads[i].data);\r\n                    }\r\n                    catch (err) {\r\n                        _err = err;\r\n                    }\r\n                }\r\n                if (_err) {\r\n                    throw _err;\r\n                }\r\n            }\r\n            else {\r\n                await download(url, data);\r\n            }\r\n        },\r\n        WFSQueryBuilder: function (layers, filter, capabilities, outputFormat, onlyHits, srsName, maxFeatures, fields) {\r\n            const getSRSAttribute = function () {\r\n                if (srsName) {\r\n                    return ' srsName=\"' + srsName + '\"'\r\n                }\r\n                else\r\n                    return '';\r\n            }\r\n            const getFields = function () {\r\n                if (!fields) return '';\r\n                var tagName = '';\r\n                switch (capabilities.version) {\r\n                    case \"1.0.0\":\r\n                        tagName = \"ogc:PropertyName\";\r\n                        break;\r\n                    case \"1.1.0\":\r\n                        tagName = \"wfs:PropertyName\";\r\n                        break;\r\n                    case \"2.0.0\":\r\n                        tagName = \"wfs:PropertyName\";\r\n                    default:\r\n\r\n                        break;\r\n                }\r\n                return (fields instanceof Array ? fields : [fields]).reduce(function (vi, va) {\r\n                    return (vi + '<' + tagName + '>' + va + '</' + tagName + '>')\r\n                }, '')\r\n\r\n            };\r\n            if (!Array.isArray(layers) && !(layers instanceof Object))\r\n                layers = [layers];\r\n\r\n            var query = '<wfs:GetFeature ' + _queryHeaderConstructor(capabilities).format({ resultType: (onlyHits ? 'resultType=\"hits\"' : ''), format: 'outputFormat=\"' + outputFormat + '\"' }) + (capabilities.version !== \"2.0.0\" && maxFeatures ? ' maxFeatures=\"' + maxFeatures + '\"' : '') + '>';\r\n            var queryBody = '';\r\n            if (Array.isArray(layers)) {\r\n                var queryItem = '<wfs:Query typeName' + (capabilities.version === \"2.0.0\" ? 's' : '') + '=\"{typeName}\"' + getSRSAttribute() + '>{fields}{filter}</wfs:Query>';\r\n                layers.forEach(function (value) {\r\n                    queryBody += queryItem.format({ typeName: value, filter: (filter && filter instanceof TC.filter.Filter ? filter.getText(capabilities.version) : \"\"), fields: getFields() });\r\n                });\r\n            }\r\n            else {\r\n                var queryItem = '';\r\n                for (var layer in layers) {\r\n                    var queryItem = ('<wfs:Query typeName' + (capabilities.version === \"2.0.0\" ? 's' : '') + '=\"{typeName}\"' + getSRSAttribute() + '>{fields}{filter}</wfs:Query>');\r\n                    let filter = layers[layer]\r\n                    queryBody += queryItem.format({ typeName: layer, filter: (filter && filter instanceof TC.filter.Filter ? filter.getText(capabilities.version) : \"\"), fields: getFields() });\r\n                }\r\n            }\r\n\r\n            query += queryBody + '</wfs:GetFeature>'\r\n            return query;\r\n        },\r\n\r\n        WFGetPropertyValue: function (layer, valueReference, filter, capabilities) {\r\n            /*if (capabilities.version === \"2.0.0\") {\r\n                var query = '<wfs:GetPropertyValue ' + _queryHeaderConstructor(capabilities).format({ resultType: '', format: '' }) + ' valueReference=\"' + valueReference + '\" >';\r\n                var queryBody = '';\r\n                var queryItem = ('<wfs:Query typeName' + (capabilities.version === \"2.0.0\" ? 's' : '') + '=\"{typeName}\"' + '>{filter}</wfs:Query>');\r\n                queryBody += queryItem.format({ typeName: layer, filter: (filter && filter instanceof TC.filter.Filter ? filter.getText(capabilities.version) : \"\") });\r\n                query += queryBody + '</wfs:GetPropertyValue>'\r\n                return query;\r\n            }\r\n            else*/\r\n                return TC.Util.WFSQueryBuilder([layer], filter, capabilities, \"JSON\", false, null, null, valueReference);\r\n\r\n            \r\n        },\r\n\r\n        WFSFilterBuilder: function (feature, version, srsName) {\r\n            var filter = '';\r\n            if (Util.isPlainObject(feature)) {\r\n                filter = '<{prefix}:Filter><{prefix}:Intersects><fes:ValueReference></fes:ValueReference><{prefix}:Function name=\"querySingle\"><{prefix}:Literal>{clipLayer}</{prefix}:Literal><{prefix}:Literal>{geometryName}</{prefix}:Literal><{prefix}:Literal>{where}</{prefix}:Literal></{prefix}:Function></{prefix}:Intersects></{prefix}:Filter>'\r\n                    .format({ prefix: (version === \"2.0.0\" ? \"fes\" : \"ogc\"), \"clipLayer\": feature.clipLayer, \"geometryName\": feature.geometryName, \"where\": feature.where })\r\n            }\r\n            else {\r\n                switch (true) {\r\n                    case !feature:\r\n                        break;\r\n                    case Array.isArray(feature)://bbox\r\n                        var gmlEnvelope = ('<gml:Envelope>' +\r\n                            '<gml:lowerCorner>{lowerCorner}</gml:lowerCorner>' +\r\n                            '<gml:upperCorner>{upperCorner}</gml:upperCorner>' +\r\n                            '</gml:Envelope>').format({ lowerCorner: (feature[0] + ' ' + feature[1]), upperCorner: (feature[2] + ' ' + feature[3]) });\r\n                        switch (true) {\r\n                            case version === \"1.0.0\":\r\n                            case version === \"1.1.0\":\r\n                                filter += '<ogc:Filter><ogc:BBOX>' + gmlEnvelope + '</ogc:BBOX></ogc:Filter>';\r\n                                break;\r\n                            case version === \"2.0.0\":\r\n                                filter += '<fes:Filter><fes:BBOX>' + gmlEnvelope + '</fes:BBOX></fes:Filter>';\r\n                                break;\r\n                        }\r\n                        break;\r\n                    case feature instanceof TC.Feature:\r\n                        switch (true) {\r\n                            case version === \"1.0.0\":\r\n                            case version === \"1.1.0\":\r\n                                filter += '<ogc:Filter><ogc:Intersects><ogc:PropertyName></ogc:PropertyName>' + TC.Util.writeGMLGeometry(feature, { version: \"2.0\", srsName: srsName }) + '</ogc:Intersects></ogc:Filter>';\r\n                                break;\r\n                            case version === \"2.0.0\":\r\n                                filter += '<fes:Filter><fes:Intersects><fes:ValueReference></fes:ValueReference>' + TC.Util.writeGMLGeometry(feature, { version: \"3.2\", srsName: srsName }) + '</fes:Intersects></fes:Filter>';\r\n                                break;\r\n                        }\r\n\r\n                        break;\r\n                    default:\r\n                        TC.error(\"Geometr\\u00eda no v\\u00e1lida\");\r\n                        break;\r\n                }\r\n            }\r\n\r\n            return filter;\r\n        },\r\n\r\n        writeGMLGeometry: function (feature, options) {\r\n            options = options || {};\r\n            const gmlVersion = options.version;\r\n            const getSRSName = function () {\r\n                if (options.srsName) {\r\n                    return ' srsName=\"' + options.srsName + '\"'\r\n                }\r\n                else\r\n                    return '';\r\n            };\r\n            var getGmlCoordinates = function (coords) {\r\n                var result;\r\n                if (gmlVersion.indexOf('3') === 0) {\r\n                    result = coords.toString();\r\n                    while (result.indexOf(\",\") >= 0) {\r\n                        result = result.replace(\",\", \" \");\r\n                    }\r\n                }\r\n                else {\r\n                    result = coords.map(function (coord) {\r\n                        return coord.join(',');\r\n                    }).join(' ');\r\n                }\r\n                return result;\r\n            };\r\n\r\n            switch (gmlVersion) {\r\n                case \"3.1.1\":\r\n                    break;\r\n                case \"3.2\":\r\n                    switch (true) {\r\n                        case TC.feature.Polyline && feature instanceof TC.feature.Polyline:\r\n                            return \"<gml:LineString srsDimension=\\\"2\\\"\" + getSRSName() + \"><gml:posList>\" +\r\n                                getGmlCoordinates(feature.geometry) +\r\n                                \"</gml:posList></gml:LineString>\";\r\n                            break;\r\n                            break;\r\n                        default:\r\n                            return \"<gml:Polygon srsDimension=\\\"2\\\"\" + getSRSName() + \"><gml:exterior><gml:LinearRing><gml:posList>\" +\r\n                                getGmlCoordinates(feature.geometry[0]) +\r\n                                \"</gml:posList></gml:LinearRing></gml:exterior></gml:Polygon>\";\r\n                            break;\r\n                    }\r\n                    break;\r\n                case \"2.0\":\r\n                default:\r\n                    switch (true) {\r\n                        case TC.feature.Polyline && feature instanceof TC.feature.Polyline:\r\n                            return \"<gml:LineString\" + getSRSName() + \"><gml:coordinates>\" +\r\n                                getGmlCoordinates(feature.geometry[0]) +\r\n                                \"</gml:coordinates></gml:LineString>\";\r\n                            break;\r\n                        default:\r\n                            return \"<gml:Polygon\" + getSRSName() + \"><gml:outerBoundaryIs><gml:LinearRing><gml:coordinates>\" +\r\n                                getGmlCoordinates(feature.geometry[0]) +\r\n                                \"</gml:coordinates></gml:LinearRing></gml:outerBoundaryIs></gml:Polygon>\";\r\n                            break;\r\n                    }\r\n                    break;\r\n            }\r\n        },\r\n\r\n        isServiceWorker: function () {\r\n            if (navigator.serviceWorker) {\r\n                if (navigator.serviceWorker.controller && navigator.serviceWorker.controller.state === \"activated\") {\r\n                    return true;\r\n                } else {\r\n                    return false;\r\n                }\r\n            } else {\r\n                return false;\r\n            }\r\n        },\r\n\r\n        isSameOriginByLocation: function (uri, location) {\r\n            var result = uri.indexOf(\"http\") !== 0 && uri.indexOf(\"//\") !== 0;\r\n            var urlParts = !result && uri.match(TC.Consts.url.SPLIT_REGEX);\r\n            if (urlParts) {\r\n                var uProtocol = urlParts[1];\r\n                result = (uProtocol == location.protocol || uProtocol == undefined) && urlParts[3] == location.hostname;\r\n                var uPort = urlParts[4], lPort = location.port;\r\n                if (uPort != 80 && uPort !== \"\" || lPort != \"80\" && lPort !== \"\") {\r\n                    result = result && uPort == lPort;\r\n                }\r\n            }\r\n            return result;\r\n        },\r\n\r\n        isSameProtocol: function (uri, location) {\r\n            if (uri.match(/^(\\/\\/)/i)) {\r\n                return true;\r\n            }\r\n            var protocolRegex = /^(https?:\\/\\/)/i;\r\n            var uriProtocol = uri.match(protocolRegex);\r\n            if (uriProtocol && uriProtocol.length > 1) {\r\n                var locationProtocol = location.match(protocolRegex);\r\n                if (locationProtocol && locationProtocol.length > 1) {\r\n                    return uriProtocol[0].trim() === locationProtocol[0].trim();\r\n                }\r\n            }\r\n\r\n            return false;\r\n        },\r\n\r\n        consoleRegister: function (msg) {\r\n            if (TC.isDebug) {\r\n                console.log(msg);\r\n            }\r\n        },\r\n\r\n        getSorterByProperty: function (propName) {\r\n            return function (a, b) {\r\n                if (a[propName] > b[propName]) {\r\n                    return 1;\r\n                }\r\n                if (a[propName] < b[propName]) {\r\n                    return -1;\r\n                }\r\n                return 0;\r\n            };\r\n        },\r\n\r\n        getSoundexDifference: function (a, b) {\r\n            var res = 0\r\n\r\n            for (var i = 0; i < a.length; i++) {\r\n                if (a.charAt(i) == b.charAt(i)) {\r\n                    res++;\r\n                }\r\n            }\r\n\r\n            return res;\r\n        },\r\n\r\n        toAbsolutePath: function (href) {\r\n            var link = document.createElement(\"a\");\r\n            link.href = href;\r\n            return link.href;\r\n        },\r\n\r\n        explodeGeometry: function (obj) {\r\n            const origin = obj.origin;\r\n            const iterationFunction = function (elm, idx, arr) {\r\n                if (Array.isArray(elm)) {\r\n                    elm.forEach(iterationFunction);\r\n                }\r\n                else {\r\n                    if (idx === 0) {\r\n                        arr[0] = elm + origin[0];\r\n                    }\r\n                    if (idx === 1) {\r\n                        arr[1] = elm + origin[1];\r\n                    }\r\n                }\r\n            };\r\n            obj.geom.forEach(iterationFunction);\r\n            return obj.geom;\r\n        },\r\n\r\n        cloneMappingFunction: function (elm) {\r\n            if (Array.isArray(elm)) {\r\n                return elm.map(TC.Util.cloneMappingFunction);\r\n            }\r\n            return elm;\r\n        },\r\n\r\n        isGeometry: function (type) {\r\n            switch (type) {\r\n                case 'gml:LinearRingPropertyType':\r\n                case 'gml:PolygonPropertyType':\r\n                case 'gml:MultiPolygonPropertyType':\r\n                case 'gml:MultiSurfacePropertyType':\r\n                case 'gml:LineStringPropertyType':\r\n                case 'gml:MultiLineStringPropertyType':\r\n                case 'gml:PointPropertyType':\r\n                case 'gml:MultiPointPropertyType':\r\n                case 'gml:BoxPropertyType':\r\n                case 'gml:GeometryCollectionPropertyType':\r\n                case 'gml:GeometryAssociationType':\r\n                case 'gml:GeometryPropertyType':\r\n                case 'gml:MultiCurvePropertyType':\r\n                case 'gml:CurvePropertyType':\r\n                    return true;\r\n                    break;\r\n                default:\r\n                    return false;\r\n                    break;\r\n            }\r\n        },\r\n\r\n        compactGeometry: function (geometry, precision) {\r\n            const origin = [Number.MAX_VALUE, Number.MAX_VALUE];\r\n            const newGeom = geometry.map(TC.Util.cloneMappingFunction);\r\n            const firstIterationFunction = function (elm, idx) {\r\n                if (Array.isArray(elm)) {\r\n                    elm.forEach(firstIterationFunction);\r\n                }\r\n                else {\r\n                    if (idx === 0 && elm < origin[0]) {\r\n                        origin[0] = elm;\r\n                    }\r\n                    else if (idx === 1 && elm < origin[1]) {\r\n                        origin[1] = elm;\r\n                    }\r\n                }\r\n            };\r\n            newGeom.forEach(firstIterationFunction);\r\n\r\n            const round = function (val) {\r\n                return Math.round(val * precision) / precision;\r\n            }\r\n            origin[0] = round(origin[0]);\r\n            origin[1] = round(origin[1]);\r\n            const secondIterationFunction = function (elm, idx, arr) {\r\n                if (Array.isArray(elm)) {\r\n                    elm.forEach(secondIterationFunction);\r\n                }\r\n                else {\r\n                    if (idx === 0) {\r\n                        arr[0] = round(elm - origin[0]);\r\n                    }\r\n                    if (idx === 1) {\r\n                        arr[1] = round(elm - origin[1]);\r\n                    }\r\n                }\r\n            };\r\n            newGeom.forEach(secondIterationFunction);\r\n            return {\r\n                origin: origin,\r\n                geom: newGeom\r\n            }\r\n        },\r\n\r\n        hasStyleOptions: function (options) {\r\n            return options.hasOwnProperty('strokeColor') ||\r\n                options.hasOwnProperty('strokeWidth') ||\r\n                options.hasOwnProperty('fillColor') ||\r\n                options.hasOwnProperty('strokeOpacity') ||\r\n                options.hasOwnProperty('fillOpacity') ||\r\n                options.hasOwnProperty('url') ||\r\n                options.hasOwnProperty('radius') ||\r\n                options.hasOwnProperty('anchor') ||\r\n                options.hasOwnProperty('width') ||\r\n                options.hasOwnProperty('height') ||\r\n                options.hasOwnProperty('labelOutlineWidth') ||\r\n                options.hasOwnProperty('labelOutlineColor') ||\r\n                options.hasOwnProperty('labelOffset') ||\r\n                options.hasOwnProperty('fontColor') ||\r\n                options.hasOwnProperty('fontSize');\r\n        },\r\n\r\n        formatCoord: function (x, nDecimales) {\r\n            return x.toLocaleString(TC.Util.getLocaleUserChoice(), { maximumFractionDigits: nDecimales });\r\n\r\n            // No respeta el formato de los números según el idioma\r\n            //var result;            \r\n            //result = x.toFixed(nDecimales);\r\n            //if (nDecimales <= 3) {\r\n            //    result = result.replace(/\\B(?=(\\d{3})+(?!\\d))/g, \"|\");\r\n            //}\r\n\r\n            //result = result.replace(\".\", \",\").replace(/\\|/g, \".\");\r\n            //return result;\r\n        },\r\n\r\n        getWebWorkerCrossOriginURL: function (url) {\r\n            return new Promise(function (resolve, reject) {\r\n                if (window.hasOwnProperty('Worker')) {\r\n                    // Para evitar problemas con IE10 y Opera evitamos el uso de blobs cuando es evitable\r\n                    if (TC.Util.isSameOrigin(url)) {\r\n                        resolve(url);\r\n                    }\r\n                    else {\r\n                        TC.ajax({\r\n                            url: url,\r\n                            method: 'GET',\r\n                            responseType: 'text'\r\n                        }).then(\r\n                            function (response) {\r\n                                const data = response.data;\r\n                                var blob = new Blob([data], { type: \"text/javascript\" });\r\n                                var url = window.URL.createObjectURL(blob);\r\n                                resolve(url);\r\n                            },\r\n                            function (e) {\r\n                                reject(Error(e));\r\n                            }\r\n                        );\r\n                    }\r\n                }\r\n                else {\r\n                    reject(new Error('No support for service workers'));\r\n                }\r\n            });\r\n        }\r\n    };\r\n\r\n    String.prototype.format = function () {\r\n        var str = this.toString();\r\n        if (!arguments.length)\r\n            return str;\r\n        var args = typeof arguments[0],\r\n            args = ((\"string\" == args || \"number\" == args) ? arguments : arguments[0]);\r\n        for (arg in args)\r\n            str = str.replace(RegExp(\"\\\\{\" + arg + \"\\\\}\", \"gi\"), args[arg]);\r\n        return str;\r\n    };\r\n    const _queryHeaderConstructor = function (capabilities) {\r\n        var queryHeader = 'xsi:schemaLocation=\"http://www.opengis.net/wfs http://schemas.opengis.net/wfs/1.1.0/wfs.xsd\" ' +\r\n            ' service=\"WFS\" {resultType} {format} ';\r\n        switch (capabilities.version) {\r\n            case \"1.0.0\":\r\n            case \"1.1.0\":\r\n                queryHeader += 'xmlns:gml=\"http://www.opengis.net/gml\" xmlns:wfs=\"http://www.opengis.net/wfs\" ';\r\n                break;\r\n            case \"2.0.0\":\r\n                queryHeader += 'xmlns:wfs=\\\"http://www.opengis.net/wfs/2.0\\\" xmlns:gml=\\\"http://www.opengis.net/gml/3.2\\\" ';\r\n                break;\r\n        }\r\n        for (var i in capabilities) {\r\n            if (typeof (capabilities[i]) === \"string\" && i.indexOf(\"gml\") < 0 && capabilities[i].indexOf(\"wfs\") < 0)\r\n                queryHeader += (i + '=\"' + capabilities[i] + '\" ');\r\n        }\r\n        return queryHeader\r\n    };\r\n    \r\n    var fncOvelaps = function (elem1, elem2, comparisonFnc) {\r\n        return comparisonFnc(elem1.getBoundingClientRect(), elem2.getBoundingClientRect());\r\n    }\r\n    if (this.HTMLElement) {\r\n        HTMLElement.prototype.colliding = function (other) {\r\n            return fncOvelaps(this, other, function (rect1, rect2) {\r\n                return !(\r\n                    rect1.top > rect2.bottom ||\r\n                    rect1.right < rect2.left ||\r\n                    rect1.bottom < rect2.top ||\r\n                    rect1.left > rect2.right\r\n                );\r\n            });\r\n        };\r\n        HTMLElement.prototype.containing = function (other) {\r\n            fncOvelaps(this, other, function (rect1, rect2) {\r\n                return !(\r\n                    rect1.left <= rect2.left &&\r\n                    rect2.left < rect1.width &&\r\n                    rect1.top <= rect2.top &&\r\n                    rect2.top < rect1.height\r\n                );\r\n            });\r\n        };\r\n        HTMLElement.prototype.inside = function (other) {\r\n            return fncOvelaps(this, other, function (rect1, rect2) {\r\n                return (\r\n                    ((rect2.top <= rect1.top) && (rect1.top <= rect2.bottom)) &&\r\n                    ((rect2.top <= rect1.bottom) && (rect1.bottom <= rect2.bottom)) &&\r\n                    ((rect2.left <= rect1.left) && (rect1.left <= rect2.right)) &&\r\n                    ((rect2.left <= rect1.right) && (rect1.right <= rect2.right))\r\n                );\r\n            });\r\n        };\r\n    }\r\n    return Util;\r\n});\r\n"]}