TC.control=TC.control||{};!function(){const t=this;let e;t.dust||Object.defineProperty(t,"dust",{get:function(){if(!TC._dustLoaded){TC._dustLoaded=!0;TC.syncLoadJS(TC.apiLocation+"lib/dust/dust-full.min.js");TC.syncLoadJS(TC.apiLocation+"lib/dust/dust-helpers.min.js");TC.syncLoadJS(TC.apiLocation+"lib/dust/dust-i18n.min.js");TC.syncLoadJS(TC.apiLocation+"lib/dust/dust.overrides.js");e=t.dust}return e},set:function(t){e=t}})}();TC.Control=function(){const t=this;TC.EventTarget.call(t);t.map=null;t.isActive=!1;t.isDisabled=!1;var e=arguments.length;t.options=TC.Util.extend({},e>1?arguments[1]:arguments[0]);t.id=t.options.id||TC.getUID(t.CLASS.substr(TC.Control.prototype.CLASS.length+1)+"-");t.div=TC.Util.getDiv(t.options.div?t.options.div:arguments[0]);TC._jQueryIsLoaded&&(t._$div=$(t.div));t.div.classList.add(TC.Control.prototype.CLASS,t.CLASS);t.template=t.options.template||t.template;t.exportsState=!1};TC.inherit(TC.Control,TC.EventTarget);!function(){const t=TC.Control.prototype;t.CLASS="tc-ctl";t.template=void 0;t.show=function(){this.div.style.display=""};t.hide=function(){this.div.style.display="none"};t.render=function(t){const e=this;return e._set1stRenderPromise(e.renderData(null,function(){e.addUIEventListeners();"function"==typeof t&&t()}))};t._set1stRenderPromise=function(t){const e=this;e._firstRender||(e._firstRender=t);return t};t.renderData=function(t,e){const o=this;return new Promise(function(i,n){o.map&&o.trigger(TC.Consts.event.BEFORECONTROLRENDER,{dataObject:t});o.div.classList.toggle(TC.Consts.classes.DISABLED,o.isDisabled);let s;if("object"!=typeof o.template||o.template.compiler){s=o.template;o.template={};o.template[o.CLASS]=s}else s=o.template[o.CLASS];o.getRenderedHtml(o.CLASS,t).then(function(t){o.div.innerHTML=t;o.map&&o.trigger(TC.Consts.event.CONTROLRENDER);TC.Util.isFunction(e)&&e();i()})})};const e=function(t,e){e=e||{};return new Promise(function(o,i){let n=!1,s=!1,l=!1;const a=[];for(var r in t){const e=t[r];if("string"==typeof e){n=!0;if(e.endsWith(".hbs")){s=!0;a.push(r)}else l=!0}else if("object"==typeof e||e&&e._isHbs){s=!0;a.push(r)}else"function"==typeof e&&(l=!0)}if(s&&l){a.forEach(function(e){t[e]=TC.apiLocation+"TC/templates/"+e+".html"});n=!1}if(l&&!dust.i18n._done){const t=e.locale;dust.i18n.setLanguages([t]);dust.i18n.add(t,TC.i18n[t]);dust.i18n._done=!0}const c=function(){const e=[];for(var i in t){const o=i;let n=t[o];if("string"==typeof n)e.push(new Promise(function(e,i){TC.ajax({url:n,method:"GET",responseType:"text"}).then(function(i){if(n.endsWith(".html")){dust.loadSource(dust.compile(i.data,o));t[o]=n=dust.cache[o];e(n)}else{t[o]=n=TC._hbs.compile(i.data);n._isHbs=!0;e(n)}}).catch(function(t){console.log("Error fetching template: "+t);i(t)})}));else{if("object"==typeof n){t[i]=n=TC._hbs.template(n);n._isHbs=!0}else if(TC.Util.isFunction(n)&&!n._isHbs&&!dust.cache[o]){n();t[o]=n=dust.cache[o]}e.push(Promise.resolve(n))}}Promise.all(e).then(function(){for(var e in t){const o=t[e];o&&o._isHbs&&e!==self.CLASS&&TC._hbs.registerPartial(e,t[e])}o()})};n?TC.loadJSInOrder(!TC._hbs||!TC._hbs.compile,TC.url.templatingFull,c):TC.loadJSInOrder(!TC._hbs,TC.url.templatingRuntime,c)})};t.getRenderedHtml=function(t,o,i){const n=this;return new Promise(function(s,l){const a=function(r){if(void 0!==r)if(r._isHbs){const t=r(o);TC.Util.isFunction(i)&&i(t);s(t)}else if(dust.cache[t]){n.template[t]=r=dust.cache[t];dust.render(t,o||{},function(t,e){if(t){TC.error(t);l(Error(t))}else{TC.Util.isFunction(i)&&i(e);s(e)}})}else e(n.template,{locale:n.map&&n.map.options.locale}).then(function(){a(n.template[t])});else s("")},r=n.template[t];"function"!=typeof r?e(n.template,{locale:n.map&&n.map.options.locale}).then(function(){a(n.template[t])}):a(r)})};t.register=function(t){const e=this;return new Promise(function(o,i){e.map=t;Promise.resolve(e.render()).then(function(){e.options.active&&e.activate();o(e)})})};t.activate=function(){if(this.map&&this.map.activeControl&&this.map.activeControl!=this){this.map.previousActiveControl=this.map.activeControl;this.map.activeControl.deactivate()}this.isActive=!0;if(this.map){this.map.activeControl=this;this.map.trigger(TC.Consts.event.CONTROLACTIVATE,{control:this});this.trigger(TC.Consts.event.CONTROLACTIVATE,{control:this})}};t.deactivate=function(t){0==arguments.length&&(t=!1);this.isActive=!1;if(this.map){this.map.activeControl=null;if(!t){var e=this.map.getDefaultControl();e==this?e=null:this.map.previousActiveControl==this?e=null:e||(e=this.map.previousActiveControl);e&&e.activate()}this.map.trigger(TC.Consts.event.CONTROLDEACTIVATE,{control:this});this.trigger(TC.Consts.event.CONTROLDEACTIVATE,{control:this})}};t.enable=function(){this.isDisabled=!1;this.div&&this.div.classList.remove(TC.Consts.classes.DISABLED)};t.disable=function(){this.isDisabled=!0;this.div&&this.div.classList.add(TC.Consts.classes.DISABLED)};t.renderPromise=function(){const t=this;return t._firstRender||new Promise(function(e,o){t.one(TC.Consts.event.CONTROLRENDER,function(){e(t)})})};t.addUIEventListener=function(t,e,o){(t?this.div.querySelectorAll(t):[this.div]).forEach(function(t){t.addEventListener(e,o)})};t.addUIEventListeners=function(){};t.isExclusive=function(){return!1};t.getLocaleString=function(t,e){var o=this.map?this.map.options.locale:TC.Cfg.locale;return TC.Util.getLocaleString(o,t,e)};t.getUID=function(){return TC.getUID(this.id+"-")};t.exportState=function(){return this.exportsState?{}:null};t.importState=function(t){};t.getDownloadDialog=function(){const t=this;t._downloadDialog=t._downloadDialog||t.map.getControlsByClass("TC.control.FeatureDownloadDialog")[0];if(t._downloadDialog){t._downloadDialog.caller=t;return Promise.resolve(t._downloadDialog)}return new Promise(function(e,o){t.map.addControl("FeatureDownloadDialog").then(o=>{t._downloadDialog=o;t._downloadDialog.caller=t;e(o)})})};t.getElevationTool=function(){const t=this;return t.displayElevation||t.options.displayElevation?t.elevation?Promise.resolve(t.elevation):new Promise(function(e,o){TC.loadJS(!TC.tool||!TC.tool.Elevation,TC.apiLocation+"TC/tool/Elevation",function(){if("boolean"==typeof t.options.displayElevation)if(t.map)t.map.getElevationTool().then(function(o){t.elevation=o||new TC.tool.Elevation;e(t.elevation)});else{t.elevation=new TC.tool.Elevation;e(t.elevation)}else if(t.map)t.map.getElevationTool().then(function(o){t.elevation=o?new TC.tool.Elevation(TC.Util.extend(!0,{},o.options,t.options.displayElevation)):new TC.tool.Elevation(t.options.displayElevation);e(t.elevation)});else{t.elevation=new TC.tool.Elevation(t.options.displayElevation);e(t.elevation)}})}):Promise.resolve(null)}}();
//# sourceMappingURL=maps/Control.min.js.map