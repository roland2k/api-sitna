TC.control=TC.control||{};!function(){const t=this;let e;Object.defineProperty(t,"dust",{get:function(){if(!TC._dustLoaded){TC._dustLoaded=!0;TC.syncLoadJS(TC.apiLocation+"lib/dust/dust-full.min.js");TC.syncLoadJS(TC.apiLocation+"lib/dust/dust-helpers.min.js");TC.syncLoadJS(TC.apiLocation+"lib/dust/dust-i18n.min.js");TC.syncLoadJS(TC.apiLocation+"lib/dust/dust.overrides.js");e=t.dust}return e},set:function(t){e=t}})}();TC.Control=function(){const t=this;TC.EventTarget.call(t);t.map=null;t.isActive=!1;t.isDisabled=!1;var e=arguments.length;t.options=TC.Util.extend({},e>1?arguments[1]:arguments[0]);t.id=t.options.id||TC.getUID(t.CLASS.substr(TC.Control.prototype.CLASS.length+1)+"-");t.div=TC.Util.getDiv(t.options.div?t.options.div:arguments[0]);TC._jQueryIsLoaded&&(t._$div=$(t.div));t.div.classList.add(TC.Control.prototype.CLASS,t.CLASS);t.template=t.options.template||t.template;t.exportsState=!1};TC.inherit(TC.Control,TC.EventTarget);!function(){const t=TC.Control.prototype;t.CLASS="tc-ctl";t.template=void 0;t.show=function(){this.div.style.display=""};t.hide=function(){this.div.style.display="none"};t.render=function(t){const e=this;return e._set1stRenderPromise(e.renderData(null,function(){e.addUIEventListeners();"function"==typeof t&&t()}))};t._set1stRenderPromise=function(t){const e=this;e._firstRender||(e._firstRender=t);return t};const e=function(t){return new Promise(function(e,i){const o=t.template;let n=!1,s=!1,l=!1;const a=[];for(var r in o){const t=o[r];if("string"==typeof t){n=!0;if(t.endsWith(".hbs")){s=!0;a.push(r)}else l=!0}else if("object"==typeof t||t&&t._isHbs){s=!0;a.push(r)}else"function"==typeof t&&(l=!0)}if(s&&l){a.forEach(function(t){o[t]=TC.apiLocation+"TC/templates/"+t+".html"});n=!1}if(l&&!dust.i18n._done){const e=t.map.options.locale;dust.i18n.setLanguages([e]);dust.i18n.add(e,TC.i18n[e]);dust.i18n._done=!0}const c=function(){const t=[];for(var i in o){const e=i;let n=o[e];if("string"==typeof n)t.push(new Promise(function(t,i){TC.ajax({url:n,method:"GET",responseType:"text"}).then(function(i){if(n.endsWith(".html")){dust.loadSource(dust.compile(i.data,e));o[e]=n=dust.cache[e];t(n)}else{o[e]=n=TC._hbs.compile(i.data);n._isHbs=!0;t(n)}}).catch(function(t){console.log("Error fetching template: "+t);i(t)})}));else{if("object"==typeof n){o[i]=n=TC._hbs.template(n);n._isHbs=!0}else if(TC.Util.isFunction(n)&&!n._isHbs&&!dust.cache[e]){n();o[e]=n=dust.cache[e]}t.push(Promise.resolve(n))}}Promise.all(t).then(function(){for(var t in o){const e=o[t];e&&e._isHbs&&t!==self.CLASS&&TC._hbs.registerPartial(t,o[t])}e()})};n?TC.loadJSInOrder(!TC._hbs||!TC._hbs.compile,TC.url.templatingFull,c):TC.loadJSInOrder(!TC._hbs,TC.url.templatingRuntime,c)})};t.renderData=function(t,e){const i=this;return new Promise(function(o,n){i.map&&i.trigger(TC.Consts.event.BEFORECONTROLRENDER,{dataObject:t});i.div.classList.toggle(TC.Consts.classes.DISABLED,i.isDisabled);let s;if("object"!=typeof i.template||i.template.compiler){s=i.template;i.template={};i.template[i.CLASS]=s}else s=i.template[i.CLASS];i.getRenderedHtml(i.CLASS,t).then(function(t){i.div.innerHTML=t;i.map&&i.trigger(TC.Consts.event.CONTROLRENDER);TC.Util.isFunction(e)&&e();o()})})};t.getRenderedHtml=function(t,i,o){const n=this;return new Promise(function(s,l){const a=function(r){if(void 0!==r)if(r._isHbs){const t=r(i);TC.Util.isFunction(o)&&o(t);s(t)}else if(dust.cache[t]){n.template[t]=r=dust.cache[t];dust.render(t,i||{},function(t,e){if(t){TC.error(t);l(Error(t))}else{TC.Util.isFunction(o)&&o(e);s(e)}})}else e(n).then(function(){a(n.template[t])});else s("")},r=n.template[t];"function"!=typeof r?e(n).then(function(){a(n.template[t])}):a(r)})};t.register=function(t){const e=this;return new Promise(function(i,o){e.map=t;Promise.resolve(e.render()).then(function(){e.options.active&&e.activate();i(e)})})};t.activate=function(){if(this.map&&this.map.activeControl&&this.map.activeControl!=this){this.map.previousActiveControl=this.map.activeControl;this.map.activeControl.deactivate()}this.isActive=!0;if(this.map){this.map.activeControl=this;this.map.trigger(TC.Consts.event.CONTROLACTIVATE,{control:this});this.trigger(TC.Consts.event.CONTROLACTIVATE,{control:this})}};t.deactivate=function(t){0==arguments.length&&(t=!1);this.isActive=!1;if(this.map){this.map.activeControl=null;if(!t){var e=this.map.getDefaultControl();e==this?e=null:this.map.previousActiveControl==this?e=null:e||(e=this.map.previousActiveControl);e&&e.activate()}this.map.trigger(TC.Consts.event.CONTROLDEACTIVATE,{control:this});this.trigger(TC.Consts.event.CONTROLDEACTIVATE,{control:this})}};t.enable=function(){this.isDisabled=!1;this.div&&this.div.classList.remove(TC.Consts.classes.DISABLED)};t.disable=function(){this.isDisabled=!0;this.div&&this.div.classList.add(TC.Consts.classes.DISABLED)};t.renderPromise=function(){const t=this;return t._firstRender||new Promise(function(e,i){t.one(TC.Consts.event.CONTROLRENDER,function(){e(t)})})};t.addUIEventListener=function(t,e,i){(t?this.div.querySelectorAll(t):[this.div]).forEach(function(t){t.addEventListener(e,i)})};t.addUIEventListeners=function(){};t.isExclusive=function(){return!1};t.getLocaleString=function(t,e){var i=this.map?this.map.options.locale:TC.Cfg.locale;return TC.Util.getLocaleString(i,t,e)};t.getUID=function(){return TC.getUID(this.id+"-")};t.exportState=function(){return this.exportsState?{}:null};t.importState=function(t){};t.getDownloadDialog=function(){const t=this;t._downloadDialog=t._downloadDialog||t.map.getControlsByClass("TC.control.FeatureDownloadDialog")[0];if(t._downloadDialog){t._downloadDialog.caller=t;return Promise.resolve(t._downloadDialog)}return new Promise(function(e,i){t.map.addControl("FeatureDownloadDialog").then(i=>{t._downloadDialog=i;t._downloadDialog.caller=t;e(i)})})};t.getElevationTool=function(){const t=this;return t.displayElevation||t.options.displayElevation?t.elevation?Promise.resolve(t.elevation):new Promise(function(e,i){TC.loadJS(!TC.tool||!TC.tool.Elevation,TC.apiLocation+"TC/tool/Elevation",function(){if("boolean"==typeof t.options.displayElevation)if(t.map)t.map.getElevationTool().then(function(i){t.elevation=i||new TC.tool.Elevation;e(t.elevation)});else{t.elevation=new TC.tool.Elevation;e(t.elevation)}else if(t.map)t.map.getElevationTool().then(function(i){t.elevation=i?new TC.tool.Elevation(TC.Util.extend(!0,{},i.options,t.options.displayElevation)):new TC.tool.Elevation(t.options.displayElevation);e(t.elevation)});else{t.elevation=new TC.tool.Elevation(t.options.displayElevation);e(t.elevation)}})}):Promise.resolve(null)}}();
//# sourceMappingURL=maps/Control.min.js.map