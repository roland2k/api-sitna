TC.tool=TC.tool||{};TC.tool.Elevation=function(e){const n=this;n.options=e||{};n._servicePromises=[];(n.options.services||["elevationServiceIDENA","elevationServiceIGNFr"]).forEach(function(e,o){const t=$.Deferred();n._servicePromises[o]=t.promise();var r="ElevationService",i=TC.apiLocation+"TC/tool/ElevationService",l=e;if("string"==typeof e){r=e.substr(0,1).toUpperCase()+e.substr(1);i=TC.apiLocation+"TC/tool/"+r;l={}}TC.loadJS(!TC.tool[r],[i],function(){t.resolve(new TC.tool[r](l))})})};!function(){const e=TC.tool.Elevation.prototype;e.getService=function(e){return this._servicePromises[e]};e.getElevation=function(e){const n=this;void 0===(e=e||{}).resolution&&(e.resolution=n.options.resolution);void 0===e.sampleNumber&&(e.sampleNumber=n.options.sampleNumber);const o=$.Deferred(),t=function(e){o.reject(e)};TC.loadJS(!TC.Geometry,TC.apiLocation+"TC/Geometry",function(){$.when.apply(this,n._servicePromises).then(function(){const n=Array.prototype.map.call(arguments,function(e){return e}),r=new Array(n.length);for(var i=0,l=r.length;i<l;i++)r[i]=$.Deferred();n.map(function(n){return n.request(e)}).forEach(function(e,n){const o=r[n];e.then(function(e){o.resolve(e)},function(){o.resolve(null)})});$.when.apply(this,r).then(function(){const t=arguments,r=n.map(function(n,o){const r=t[o];return r?n.parseResponse(r,e):null}).filter(function(e){return null!==e});var i=r.length?r[0].length:0,l=new Array(i);if(i){const e=function(e){return function(n,o,t){const r=o[e],i=n;null===n[0]&&(i[0]=r[0]);null===n[1]&&(i[1]=r[1]);null===n[2]&&(i[2]=r[2]);return i}};for(var s=0;s<i;s++){var u=e(s);l[s]=r.reduce(u,[null,null,null])}}o.resolve(l)},t)},t)});return o.promise()};e.setGeometry=function(e){const n=this;e=e||{};const o=$.Deferred(),t=e.feature;if(t){var r,i;switch(!0){case TC.feature&&TC.feature.Polygon&&t instanceof TC.feature.Polygon:r=function(e){const n=[];return n.concat.apply(n,e.geometry)};i=function(e,n){var o=0;e.geometry.forEach(function(e){e.forEach(function(t,r){e[r]=n[o++]})});e.setCoords(e.geometry)};break;case TC.feature&&TC.feature.Polyline&&t instanceof TC.feature.Polyline:r=function(e){return e.geometry};i=function(e,n){e.geometry=n;e.setCoords(e.geometry)};break;default:r=function(e){return e.geometry};i=function(e,n){e.setCoords(n[0])}}n.getElevation({crs:e.crs,coordinates:r(t),resolution:0,sampleNumber:0}).then(function(e){e.length&&e.some(function(e){return null!==e[2]})&&i(t,e);o.resolve(t)},function(e){o.reject(e)})}else o.resolve(null);return o.promise()}}();TC.tool.Elevation.getElevationGain=function(e){const n=(e=e||{}).coords;if(n&&n.length>0&&n[0].length>2){var o=0,t=0;const f=e.hillDeltaThreshold||0;for(var r,i,l,s=!0,u=0;u<n.length;u++){var c=n[u][2];if(null!==c){if(void 0===r){r=c;i=c;l=c}i=Math.min(i,c);l=Math.max(l,c);var a=c-r;if(a>f||a>0&&u==n.length-1){if(s)o+=a;else{t-=i-r;o+=c-i;s=!0}r=c;i=c;l=c}else if(a<-f||a<0&&u==n.length-1){if(s){o+=l-r;t-=c-l;s=!1}else t-=a;r=c;i=c;l=c}}}return{upHill:Math.round(o),downHill:Math.round(t)}}return null};