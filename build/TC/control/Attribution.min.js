TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.control.Attribution=function(){const t=this;TC.Control.apply(t,arguments);t.apiAttribution="";t.mainDataAttribution=null;t.dataAttributions=[];t.options.dataAttributions&&(t.dataAttributions=t.options.dataAttributions instanceof Array?t.options.dataAttributions:[t.options.dataAttributions])};TC.inherit(TC.control.Attribution,TC.Control);!function(){var t=TC.control.Attribution.prototype;t.CLASS="tc-ctl-attrib";t.template={1:function(t,n,r,e,a){var o,i=null!=n?n:t.nullContext||{},l=t.lookupProperty||function(t,n){if(Object.prototype.hasOwnProperty.call(t,n))return t[n]};return" - "+t.escapeExpression(l(r,"i18n").call(i,"data",{name:"i18n",hash:{},data:a,loc:{start:{line:3,column:23},end:{line:3,column:38}}}))+":\r\n"+(null!=(o=l(r,"if").call(i,null!=(o=null!=n?l(n,"mainData"):n)?l(o,"site"):o,{name:"if",hash:{},fn:t.program(2,a,0),inverse:t.program(4,a,0),data:a,loc:{start:{line:4,column:8},end:{line:10,column:15}}}))?o:"")},2:function(t,n,r,e,a){var o,i=t.lambda,l=t.escapeExpression,s=t.lookupProperty||function(t,n){if(Object.prototype.hasOwnProperty.call(t,n))return t[n]};return'            <span> <a href="'+l(i(null!=(o=null!=n?s(n,"mainData"):n)?s(o,"site"):o,n))+'" target="_blank">'+l(i(null!=(o=null!=n?s(n,"mainData"):n)?s(o,"name"):o,n))+"</a></span>\r\n"},4:function(t,n,r,e,a){var o,i=t.lookupProperty||function(t,n){if(Object.prototype.hasOwnProperty.call(t,n))return t[n]};return null!=(o=i(r,"if").call(null!=n?n:t.nullContext||{},null!=(o=null!=n?i(n,"mainData"):n)?i(o,"name"):o,{name:"if",hash:{},fn:t.program(5,a,0),inverse:t.noop,data:a,loc:{start:{line:7,column:12},end:{line:9,column:19}}}))?o:""},5:function(t,n,r,e,a){var o,i=t.lookupProperty||function(t,n){if(Object.prototype.hasOwnProperty.call(t,n))return t[n]};return"                <span> "+t.escapeExpression(t.lambda(null!=(o=null!=n?i(n,"mainData"):n)?i(o,"name"):o,n))+"</span>\r\n"},7:function(t,n,r,e,a){var o=t.lookupProperty||function(t,n){if(Object.prototype.hasOwnProperty.call(t,n))return t[n]};return' - <span class="tc-ctl-attrib-cmd">'+t.escapeExpression(o(r,"i18n").call(null!=n?n:t.nullContext||{},"others",{name:"i18n",hash:{},data:a,loc:{start:{line:12,column:56},end:{line:12,column:73}}}))+"...</span>"},9:function(t,n,r,e,a){return" tc-collapsed"},11:function(t,n,r,e,a){var o,i=null!=n?n:t.nullContext||{},l=t.lookupProperty||function(t,n){if(Object.prototype.hasOwnProperty.call(t,n))return t[n]};return(null!=(o=l(r,"unless").call(i,a&&l(a,"first"),{name:"unless",hash:{},fn:t.program(12,a,0),inverse:t.noop,data:a,loc:{start:{line:14,column:20},end:{line:14,column:51}}}))?o:"")+(null!=(o=l(r,"if").call(i,null!=n?l(n,"site"):n,{name:"if",hash:{},fn:t.program(14,a,0),inverse:t.program(16,a,0),data:a,loc:{start:{line:14,column:51},end:{line:14,column:159}}}))?o:"")},12:function(t,n,r,e,a){return", "},14:function(t,n,r,e,a){var o=t.lambda,i=t.escapeExpression,l=t.lookupProperty||function(t,n){if(Object.prototype.hasOwnProperty.call(t,n))return t[n]};return'<span><a href="'+i(o(null!=n?l(n,"site"):n,n))+'" target="_blank">'+i(o(null!=n?l(n,"name"):n,n))+"</a></span>"},16:function(t,n,r,e,a){var o=t.lookupProperty||function(t,n){if(Object.prototype.hasOwnProperty.call(t,n))return t[n]};return"<span>"+t.escapeExpression(t.lambda(null!=n?o(n,"name"):n,n))+"</span>"},compiler:[8,">= 4.3.0"],main:function(t,n,r,e,a){var o,i=null!=n?n:t.nullContext||{},l=t.lookupProperty||function(t,n){if(Object.prototype.hasOwnProperty.call(t,n))return t[n]};return"<div>\r\n    <span>"+(null!=(o=t.lambda(null!=n?l(n,"api"):n,n))?o:"")+"</span>\r\n    "+(null!=(o=l(r,"if").call(i,null!=n?l(n,"mainData"):n,{name:"if",hash:{},fn:t.program(1,a,0),inverse:t.noop,data:a,loc:{start:{line:3,column:4},end:{line:11,column:11}}}))?o:"")+"    "+(null!=(o=l(r,"if").call(i,null!=n?l(n,"otherData"):n,{name:"if",hash:{},fn:t.program(7,a,0),inverse:t.noop,data:a,loc:{start:{line:12,column:4},end:{line:12,column:90}}}))?o:"")+'\r\n    <div class="tc-ctl-attrib-other'+(null!=(o=l(r,"if").call(i,null!=n?l(n,"isCollapsed"):n,{name:"if",hash:{},fn:t.program(9,a,0),inverse:t.noop,data:a,loc:{start:{line:13,column:35},end:{line:13,column:74}}}))?o:"")+'">\r\n\t'+(null!=(o=l(r,"each").call(i,null!=n?l(n,"otherData"):n,{name:"each",hash:{},fn:t.program(11,a,0),inverse:t.noop,data:a,loc:{start:{line:14,column:1},end:{line:14,column:168}}}))?o:"")+"\r\n    </div>\r\n</div>"},useData:!0};t.register=function(t){const n=this,r=TC.Control.prototype.register.call(n,t);n.apiAttribution=n.map.options.attribution||n.apiAttribution;var e=function(t){if(t){var r=t.getAttribution();if(r)if(/IDENA/.test(r.name)||/Tracasa Instrumental/.test(r.name))n.mainDataAttribution={name:"IDENA",site:"https://idena.navarra.es/"};else{for(var e=!1,a=0;a<n.dataAttributions.length;a++)if(r.name===n.dataAttributions[a].name){e=!0;break}e||n.dataAttributions.push(r)}}},a=function(t){if(t){if(!(t instanceof TC.Layer)||function(){if(t.map.workLayers.length>0){for(var n=t.map.workLayers.slice().reverse(),r=0;r<n.length;r++)if(n[r].url==t.url&&n[r].getVisibility())return!1;return!0}return!0}()){var r=t.getAttribution();if(r){var e=n.dataAttributions.reduce(function(t,n,e){return n.name===r.name?e:t},-1);const a=function(t){return(/IDENA/.test(r.name)||/Tracasa Instrumental/.test(r.name))&&(/IDENA/.test(t)||/Tracasa Instrumental/.test(t))||r.name===t};if(n.map.baseLayer&&n.map.baseLayer.wrap.getAttribution()&&a(n.map.baseLayer.wrap.getAttribution().name)&&t.parent.id!==n.map.baseLayer.id)return;if(n.map.workLayers.filter(function(t){return t.type===TC.Consts.layerType.WMS||t.type===TC.Consts.layerType.WMTS}).some(function(t){var n=t.wrap.getAttribution();return n&&a(n.name)}))return;e>-1?n.dataAttributions.splice(e,1):(/IDENA/.test(r.name)||/Tracasa Instrumental/.test(r.name))&&(n.mainDataAttribution=null)}}}};t.loaded(function(){if(t.baseLayer.wrap.getAttribution){e(t.baseLayer.wrap);n.render()}});t.on(TC.Consts.event.LAYERADD,function(t){const r=t.layer;if(!r.isBase&&r.wrap.getAttribution&&r.wrap.getAttribution()){e(r.wrap);n.render()}});t.on(TC.Consts.event.BEFOREBASELAYERCHANGE+" "+TC.Consts.event.OVERVIEWBASELAYERCHANGE,function(t){const r=t.type,o=t.newLayer,i=t.oldLayer;TC.Consts.event.OVERVIEWBASELAYERCHANGE.indexOf(r)>-1&&(n.ignoreLayer=o);i&&i.wrap.getAttribution&&a(i.wrap);o&&o.wrap.getAttribution&&e(o.wrap);n.render()});t.on(TC.Consts.event.LAYERREMOVE,function(t){const r=t.layer;if(r.wrap.getAttribution){a(r.wrap);n.render()}});t.on(TC.Consts.event.TERRAINPROVIDERADD,function(t){const r=t.terrainProvider;if(r.getAttribution){e(r);n.render()}});t.on(TC.Consts.event.TERRAINPROVIDERREMOVE,function(t){const r=t.terrainProvider;if(r.getAttribution){a(r);n.render()}});t.on(TC.Consts.event.LAYERVISIBILITY,function(t){const r=t.layer;if(n.ignoreLayer!==r&&r.wrap.getAttribution){r.getVisibility()?e(r.wrap):a(r.wrap);n.render()}});return r};t.render=function(t){const n=this;return n._set1stRenderPromise(n.renderData({api:"function"==typeof n.apiAttribution?n.apiAttribution.apply(n):n.getLocaleString(n.apiAttribution),mainData:n.mainDataAttribution,otherData:n.dataAttributions,isCollapsed:!n.div.querySelector("."+n.CLASS+"-other")||n.div.querySelector("."+n.CLASS+"-other").classList.contains(TC.Consts.classes.COLLAPSED)},function(){const r=n.div.querySelector("."+n.CLASS+"-cmd");r&&r.addEventListener(TC.Consts.event.CLICK,function(){n.toggleOtherAttributions()},{passive:!0});"function"==typeof t&&t()}))};t.toggleOtherAttributions=function(){this.div.querySelector("."+this.CLASS+"-other").classList.toggle(TC.Consts.classes.COLLAPSED)}}();
//# sourceMappingURL=../maps/control/Attribution.min.js.map