TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.control.OverviewMap=function(){TC.Control.apply(this,arguments);this.$events=$(this);this.isLoaded=!1;this.layer=null;this.wrap=new TC.wrap.control.OverviewMap(this)};TC.inherit(TC.control.OverviewMap,TC.Control);!function(){var e=TC.control.OverviewMap.prototype;e.CLASS="tc-ctl-ovmap";TC.isDebug?e.template=TC.apiLocation+"TC/templates/OverviewMap.html":e.template=function(){dust.register(e.CLASS,t);function t(e,t){return e.w('<div class="tc-ctl-ovmap-load tc-hidden"></div>')}t.__dustBody=!0;return t};e.register=function(e){var t=this;TC.Control.prototype.register.call(t,e);const a=function(t){return function(t){var a,n=function(e,t){for(var a=null,n=0;n<t.length;n++){var r=t[n];if((r.id||r)===e){a=r;break}}return a};if("string"==typeof t){var r=n(t,e.options.availableBaseLayers);$.isPlainObject(r)||(r=n(t,e.options.baseLayers));$.isPlainObject(r)&&(a=new TC.layer.Raster(r))}else a=t instanceof TC.Layer?t:t.type===TC.Consts.layerType.VECTOR||t.type===TC.Consts.layerType.KML||t.type===TC.Consts.layerType.WFS?new TC.layer.Vector(t):new TC.layer.Raster(t);return a}(t)};e.loaded(function(){t.defaultLayer=a(t.options.layer);t.layer=a(e.baseLayer.overviewMapLayer||t.options.layer||e.options.baseLayers[0]||e.options.availableBaseLayers[0]);t.wrap.register(e);!function(a){const n={};t.layer.getCapabilitiesPromise().then(function(){t.layer.isCompatible(e.crs)||0!==t.layer.wrap.getCompatibleMatrixSets(e.crs).length||(n.layer=t.layer.getFallbackLayer());t.wrap.reset(n)})}(e.crs);e.on(TC.Consts.event.PROJECTIONCHANGE+" "+TC.Consts.event.BASELAYERCHANGE,function(e){const t=this;if(t.map.baseLayer.type===TC.Consts.layerType.WMS||t.map.baseLayer.type===TC.Consts.layerType.WMTS){var n=t.map.baseLayer.overviewMapLayer||t.options.layer;if(t.layer.id!==n){var r=a(n);t.wrap.reset({layer:r}).then(function(e){t.layer=e})}else TC.Consts.event.PROJECTIONCHANGE.indexOf(e.type)>-1&&t.wrap.reset({layer:t.layer}).then(function(e){t.layer=e})}}.bind(t))})};e.loaded=function(e){$.isFunction(e)&&(this.isLoaded&&this.map&&this.map.isLoaded?e():this.$events.on(TC.Consts.event.MAPLOAD,e))};e.activate=function(){this.enable()};e.deactivate=function(){this.disable()};e.enable=function(){TC.Control.prototype.enable.call(this);this.wrap.enable()};e.disable=function(){TC.Control.prototype.disable.call(this);this.wrap.disable()}}();