TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.control.Measure=function(){var e=this;TC.Control.apply(e,arguments);e.drawControls=[];e.persistentDrawControls=!1;e.NOMEASURE="-";e.exportsState=!0;this.renderPromise().then(function(){e.measureMode=e.options.mode;e.history=[];e.historyIndex=0;e.reset=!0;e.wrap=new TC.wrap.control.Measure(e);e._len=e.div.querySelector(".tc-ctl-meas-val-len");e._area=e.div.querySelector(".tc-ctl-meas-val-area");e._peri=e.div.querySelector(".tc-ctl-meas-val-peri");e.setMode(e.options.mode)})};TC.control.Measure.units={m:{peso:0,abbr:"m&sup2;"},dam:{peso:1,abbr:"dam&sup2;",precision:2},hm:{peso:2,abbr:"hm&sup2;",precision:2},ha:{peso:2,abbr:"ha",precision:3},km:{peso:3,abbr:"km&sup2;",precision:3}};TC.inherit(TC.control.Measure,TC.Control);!function(){var e=TC.control.Measure.prototype;e.CLASS="tc-ctl-meas";e.template={compiler:[8,">= 4.3.0"],main:function(e,t,n,o,s){var r=null!=t?t:e.nullContext||{},a=e.escapeExpression,l=e.lambda,i=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return"<h2>"+a(i(n,"i18n").call(r,"measure",{name:"i18n",hash:{},data:s,loc:{start:{line:1,column:4},end:{line:1,column:22}}}))+'</h2>\r\n<div class="tc-ctl-meas-select">\r\n    <label class="tc-ctl-meas-btn-len"><input type="radio" name="'+a(l(null!=t?i(t,"controlId"):t,t))+'-mode" value="polyline" /><span>'+a(i(n,"i18n").call(r,"length",{name:"i18n",hash:{},data:s,loc:{start:{line:3,column:110},end:{line:3,column:127}}}))+'</span></label><label class="tc-ctl-meas-btn-area"><input type="radio" name="'+a(l(null!=t?i(t,"controlId"):t,t))+'-mode" value="polygon" /><span>'+a(i(n,"i18n").call(r,"areaAndPerimeter",{name:"i18n",hash:{},data:s,loc:{start:{line:3,column:248},end:{line:3,column:275}}}))+'</span></label>\r\n</div>\r\n<div class="tc-ctl-meas-mode tc-ctl-meas-len tc-hidden">\r\n    <div class="tc-ctl-meas-line"></div>\r\n    <div class="tc-ctl-meas-txt">'+a(i(n,"i18n").call(r,"length",{name:"i18n",hash:{},data:s,loc:{start:{line:7,column:33},end:{line:7,column:50}}}))+': <span class="tc-ctl-meas-val-len"></span></div>\r\n</div>\r\n<div class="tc-ctl-meas-mode tc-ctl-meas-area tc-hidden">\r\n    <div class="tc-ctl-meas-polygon"></div>\r\n    <div class="tc-ctl-meas-txt">'+a(i(n,"i18n").call(r,"area",{name:"i18n",hash:{},data:s,loc:{start:{line:11,column:33},end:{line:11,column:48}}}))+': <span class="tc-ctl-meas-val-area"></span>, '+a(i(n,"i18n").call(r,"perimeter",{name:"i18n",hash:{},data:s,loc:{start:{line:11,column:94},end:{line:11,column:114}}}))+': <span class="tc-ctl-meas-val-peri"></span></div>\r\n</div>'},useData:!0};e.render=function(e){const t=this;return t._set1stRenderPromise(TC.Control.prototype.renderData.call(t,{controlId:t.id},function(){TC.loadJS(!TC.control.Draw,TC.apiLocation+"TC/control/Draw",function(){t.options.mode&&t.div.querySelector(".tc-ctl-meas-select").classList.add(TC.Consts.classes.HIDDEN);t.div.querySelectorAll(`.${TC.control.Measure.prototype.CLASS}-select span`).forEach(function(e){e.addEventListener(TC.Consts.event.CLICK,function(e){for(var n=this;n&&"LABEL"!==n.tagName;)n=n.parentElement;var o=n.querySelector(`input[type=radio][name="${t.id}-mode"]`),s=o.value;o.checked=!0;t.setMode(s,!0)},{passive:!0})});TC.Util.isFunction(e)&&e()})}))};e.register=function(e){const t=this;return new Promise(function(n,o){TC.Control.prototype.register.call(t,e).then(function(){t.map.on(TC.Consts.event.VIEWCHANGE,function(){t.map.view===TC.Consts.view.PRINTING&&t.trigger(TC.Consts.event.DRAWEND)});const s=t.getUID(),r=t.getUID(),a=t.getUID();t.units=t.options.units?t.options.units:["m","km"];t.layerPromise=e.addLayer({id:s,title:t.getLocaleString("measure"),owner:t,stealth:!0,type:TC.Consts.layerType.VECTOR,styles:{point:e.options.styles.point,line:e.options.styles.line,polygon:e.options.styles.polygon}});Promise.all([t.layerPromise,t.renderPromise()]).then(function(s){const l=s[0];t.layer=l;t.layer.map.putLayerOnTop(t.layer);t._lineDrawControlPromise=e.addControl("draw",{id:r,div:t.div.querySelector(".tc-ctl-meas-line"),mode:TC.Consts.geom.POLYLINE,measure:!0,persistent:t.persistentDrawControls,styleTools:t.persistentDrawControls,layer:t.layer});t._polygonDrawControlPromise=e.addControl("draw",{id:a,div:t.div.querySelector(".tc-ctl-meas-polygon"),mode:TC.Consts.geom.POLYGON,measure:!0,persistent:t.persistentDrawControls,styleTools:t.persistentDrawControls,layer:t.layer});Promise.all([t._lineDrawControlPromise,t._polygonDrawControlPromise]).then(function(e){t.lineDrawControl=e[0];t.polygonDrawControl=e[1];e.forEach(function(e){e.containerControl=t;t.drawControls.push(e);e.on(TC.Consts.event.MEASURE+" "+TC.Consts.event.MEASUREPARTIAL,function(e){t.showMeasures(e)}).on(TC.Consts.event.DRAWCANCEL,function(e){setTimeout(function(){t.cancel()},100)});e.exportsState=!1});n(t);t.setMode(t.options.mode)}).catch(o)}).catch(o)})})};e.displayMode=function(e){const t=this,n=[];t.div.querySelectorAll(".tc-ctl-meas-mode").forEach(function(e){n.push(e)});switch(e){case TC.Consts.geom.POLYLINE:t._activeMode=n.filter(function(e){return e.matches(".tc-ctl-meas-len")})[0];break;case TC.Consts.geom.POLYGON:t._activeMode=n.filter(function(e){return e.matches(".tc-ctl-meas-area")})[0];break;case null:case void 0:t._activeMode=null}const o=n.filter(function(e){return e!==t._activeMode});if(e){t.div.querySelector(`input[type=radio][name="${t.id}-mode"][value="${e}"]`).checked=!0}else t.div.querySelectorAll(`input[type=radio][name="${t.id}-mode"]`).forEach(function(e){e.checked=!1});if(t._activeMode){t._activeMode.classList.remove(TC.Consts.classes.HIDDEN);t._activeMode.querySelector(".tc-ctl").classList.remove(TC.Consts.classes.COLLAPSED)}o.forEach(function(e){e.classList.add(TC.Consts.classes.HIDDEN)});return t};e.setMode=function(e){const t=this;t.mode=e;t.displayMode(e);var n;switch(e){case TC.Consts.geom.POLYLINE:t.lineDrawControl.activate();n=TC.Consts.event.CONTROLACTIVATE;break;case TC.Consts.geom.POLYGON:t.polygonDrawControl.activate();n=TC.Consts.event.CONTROLACTIVATE;break;case null:case void 0:t.drawControls.forEach(function(e){e.isActive&&e.cancel()});n=TC.Consts.event.CONTROLDEACTIVATE;break;default:n=TC.Consts.event.CONTROLACTIVATE}t.resetValues();n&&t.map&&t.map.trigger(n,{control:t});return t};e.cancel=function(){this.setMode(null,!1);return this};e.showMeasures=function(e){const t=this;var n,o=(e=e||{}).units;const s=t.map.options.locale||TC.Cfg.locale;if(e.area){var r=e.area;(t.units instanceof Array?t.units:t.units.split(",")).forEach(function(e,n,o){const a=TC.control.Measure.units[e.trim()].peso-TC.control.Measure.units.m.peso;let l=TC.control.Measure.units[e.trim()].precision?TC.control.Measure.units[e.trim()].precision:0;(1===o.length||r>=Math.pow(100,a)/Math.pow(10,l?l-1:l))&&(t._area.innerHTML=TC.Util.formatNumber((r/Math.pow(100,a)).toFixed(l),s)+" "+TC.control.Measure.units[e].abbr)})}if(e.perimeter){var a=e.perimeter;if(a>1e3){a/=1e3;o="km"}n="m"===o?0:3;t._peri.innerHTML=TC.Util.formatNumber(a.toFixed(n),s)+" "+o}if(e.length){var l=e.length;if(l>1e3){l/=1e3;o="km"}n="m"===o?0:3;t._len.innerHTML=TC.Util.formatNumber(l.toFixed(n),s)+" "+o}return t};e.resetValues=function(){const e=this;if(e._len){e._len.textContent=e.NOMEASURE;e._area.textContent=e.NOMEASURE;e._peri.textContent=e.NOMEASURE}return e};e.getDrawLines=function(){};e.exportState=function(){const e=this;return e.exportsState&&e.layer?{id:e.id,layer:e.layer.exportState()}:null};e.importState=function(e){this.layerPromise.then(function(t){t.importState(e.layer)})}}();
//# sourceMappingURL=../maps/control/Measure.min.js.map