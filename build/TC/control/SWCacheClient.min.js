TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");!function(){TC.control.SWCacheClient=function(){TC.Control.apply(this,arguments);this.serviceWorkerEnabled=!1};TC.inherit(TC.control.SWCacheClient,TC.Control);var e=TC.control.SWCacheClient.prototype;e.CLASS="tc-ctl-swcc";e.SW_URL="tc-cb-service-worker.js";e.register=function(e){const r=this,t=TC.Control.prototype.register.call(r,e);r._swPromise=new Promise(function(e,t){navigator.serviceWorker?navigator.serviceWorker.register(r.SW_URL,{scope:"./"}).then(function(t){r.serviceWorkerEnabled=!0;t.installing?e(t.installing):t.waiting?e(t.waiting):t.active&&e(t.active);console.log(t.scope,"register")},function(e){r.serviceWorkerEnabled=!1;t(new Error(e));console.error("Could not register service worker: "+e)}):t(new Error("Browser does not support service workers"))});r._swPromise.catch(()=>{let t=!1;const o=window.parent!==window;for(var n=window;!t;n=n.parent){try{"https:"!==n.location.protocol&&(t=!0)}catch(e){}if(n===n.parent)break}t?e.toast(r.getLocaleString("httpsRequired.warning",{url:location.href.replace(location.protocol,"")}),{type:TC.Consts.msgType.WARNING}):o?e.toast(r.getLocaleString("frameOrNotCompatible.warning"),{type:TC.Consts.msgType.WARNING}):e.toast(r.getLocaleString("browserNotCompatible.warning"),{type:TC.Consts.msgType.WARNING})});return t};e.getServiceWorker=function(){return this._swPromise?this._swPromise:Promise.reject(new Error("No service worker available"))};var r=function(e,r,t,o,n){navigator.serviceWorker.addEventListener("message",function i(a){if(a.data.name===t){a.data.action===o&&a.data.event===n?e(t):"error"===a.data.event&&r(Error(`Error message from service worker [${a.data.url} - ${a.data.action} - ${a.data.name}]`));"progress"!==a.data.event&&navigator.serviceWorker.removeEventListener("message",i)}})};e.createCache=function(e,t){var o=this;return new Promise(function(n,i){o.getServiceWorker().then(function(o){var a=t||{};r(n,i,e,"create","cached");o.postMessage({action:"create",name:e,list:a.urlList||[],silent:a.silent})},function(){n(!1)})})};e.deleteCache=function(e,t){var o=this;return new Promise(function(n,i){o.getServiceWorker().then(function(o){var a=t||{};r(n,i,e,"delete","deleted");o.postMessage({action:"delete",name:e,silent:a.silent})},function(){n(!1)})})}}();
//# sourceMappingURL=../maps/control/SWCacheClient.min.js.map