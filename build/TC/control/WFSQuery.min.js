TC.control=TC.control||{};"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function(e,t){"use strict";if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var n=Object(e),l=1;l<arguments.length;l++){var o=arguments[l];if(null!=o)for(var a in o)Object.prototype.hasOwnProperty.call(o,a)&&(n[a]=o[a])}return n},writable:!0,configurable:!0});TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.control.infoShare||TC.syncLoadJS(TC.apiLocation+"TC/control/infoShare");TC.filter||TC.syncLoadJS(TC.apiLocation+"TC/filter");TC.Feature||TC.syncLoadJS(TC.apiLocation+"TC/Feature");TC.feature.Point||TC.syncLoadJS(TC.apiLocation+"TC/feature/Point");TC.feature.Polyline||TC.syncLoadJS(TC.apiLocation+"TC/feature/Polyline");TC.feature.Polygon||TC.syncLoadJS(TC.apiLocation+"TC/feature/Polygon");TC.feature.MultiPolyline||TC.syncLoadJS(TC.apiLocation+"TC/feature/MultiPolyline");TC.feature.MultiPolygon||TC.syncLoadJS(TC.apiLocation+"TC/feature/MultiPolygon");TC.control.WFSQuery=function(e){TC.Control.apply(this,arguments);this._dialogDiv=TC.Util.getDiv(this.options.dialogDiv);this.options.dialogDiv||document.body.appendChild(this._dialogDiv);this.exportsState=!0;this.styles=this.options.styles;this.highlightStyles=this.options.highlightStyles||this.options.highLightStyles;this.download=this.options.download;this.resultsPanel=null;this.geometryPanel=null;this.filters=[];this.styles=TC.Util.extend(!0,{polygon:{strokeColor:this.DEFAULT_STROKE_COLOR,strokeWidth:2,fillColor:"#000",fillOpacity:.3},line:{strokeColor:this.DEFAULT_STROKE_COLOR,strokeWidth:2,fillColor:"#000"}},this.options.styles);const t="."+this.CLASS;this._selectors={ELEVATION_CHECKBOX:t+"-dialog-elev input[type=checkbox]",INTERPOLATION_RADIO:"input[type=radio][name=finfo-ip-coords]",INTERPOLATION_DISTANCE:t+"-dialog-ip-m"}};TC.inherit(TC.control.WFSQuery,TC.Control);TC.mix(TC.control.WFSQuery,TC.control.infoShare);!function(){const e=TC.control.WFSQuery.prototype;e.DEFAULT_STROKE_COLOR="#0000ff";const t=TC.Consts.classes.LOADING,n=TC.Consts.classes.HIDDEN;var l=null,o=(TC.Consts.logicalOperator.AND,null),a=null,r=null,i=null;const s=function(e){if(e)for(;e.children.length;)e.removeChild(e.children[0])},c={eq:{Ctor:TC.filter.equalTo,key:"query.equalTo"},neq:{Ctor:TC.filter.notEqualTo,key:"query.notEqualTo"},gt:{Ctor:TC.filter.greaterThan,key:"query.greaterThan"},lt:{Ctor:TC.filter.lessThan,key:"query.lowerThan"},gte:{Ctor:TC.filter.greaterThanOrEqualTo,key:"query.greaterThanOrEqualTo"},lte:{Ctor:TC.filter.lessThanOrEqualTo,key:"query.lowerThanOrEqualTo"},contains:{Ctor:TC.filter.like,key:"query.contains"},starts:{Ctor:TC.filter.like,key:"query.startsBy"},ends:{Ctor:TC.filter.like,key:"query.endsBy"},btw:{Ctor:TC.filter.between,key:"query.equalTo"},nbtw:{key:"query.notEqualTo"},intersects:{Ctor:TC.filter.like,key:"query.intersects"},within:{Ctor:TC.filter.between,key:"query.within"},empty:{Ctor:TC.filter.equalTo,key:"query.empty"},null:{Ctor:TC.filter.isNull,key:"query.empty"}};var u=null,d=null,m=null,p=null,f=null,y=function(){return null},h=function(){return null},g=null,v=null;e.CLASS="tc-ctl-wfsquery";e.template={};e.template[e.CLASS+"-dialog"]={1:function(e,t,n,l,o){var a,r=null!=t?t:e.nullContext||{},i=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'                <div>\r\n                    <select class="tc-combo" name="availableLayers">\r\n                        <option value="">'+e.escapeExpression(i(n,"i18n").call(r,"query.chooseALayerCombo",{name:"i18n",hash:{},data:o,loc:{start:{line:13,column:41},end:{line:13,column:75}}}))+"</option>\r\n"+(null!=(a=i(n,"each").call(r,null!=t?i(t,"layers"):t,{name:"each",hash:{},fn:e.program(2,o,0),inverse:e.noop,data:o,loc:{start:{line:14,column:24},end:{line:16,column:33}}}))?a:"")+"                    </select>\r\n                </div>            \r\n"},2:function(e,t,n,l,o){var a=e.lambda,r=e.escapeExpression,i=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'                        <option value="'+r(a(null!=t?i(t,"name"):t,t))+'">'+r(a(null!=t?i(t,"title"):t,t))+"</option>\r\n"},compiler:[8,">= 4.3.0"],main:function(e,t,n,l,o){var a,r=e.escapeExpression,i=null!=t?t:e.nullContext||{},s=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div class="tc-ctl-wfsquery-dialog tc-modal">\r\n    <div class="tc-modal-background tc-modal-close"></div>\r\n    <div class="tc-modal-window tc-ctl-wfsquery-modal-window" >\r\n        <div class="tc-modal-header">\r\n            <h3>'+r(e.lambda(null!=t?s(t,"layerName"):t,t))+'</h3>\r\n            <div title="'+r(s(n,"i18n").call(i,"query.tooltipCloseDialogBtn",{name:"i18n",hash:{},data:o,loc:{start:{line:6,column:24},end:{line:6,column:62}}}))+'" class="tc-modal-close"></div>\r\n        </div>\r\n        <div class="tc-modal-body">\r\n            \r\n'+(null!=(a=s(n,"if").call(i,s(n,"gt").call(i,null!=(a=null!=t?s(t,"layers"):t)?s(a,"length"):a,1,{name:"gt",hash:{},data:o,loc:{start:{line:10,column:18},end:{line:10,column:38}}}),{name:"if",hash:{},fn:e.program(1,o,0),inverse:e.noop,data:o,loc:{start:{line:10,column:12},end:{line:19,column:19}}}))?a:"")+'                <div class="tc-modal-form">\r\n                </div>\r\n                <div class="tc-ctl-wfsquery-message tc-hidden"></div>                 \r\n            </div>\r\n        <div class="tc-modal-footer">\r\n            <button type="button" title="'+r(s(n,"i18n").call(i,"query.tooltipSendQueryBtn",{name:"i18n",hash:{},data:o,loc:{start:{line:25,column:41},end:{line:25,column:77}}}))+'" class="tc-button tc-ctl-wlm-btn-launch">'+r(s(n,"i18n").call(i,"query.sendQueryBtnText",{name:"i18n",hash:{},data:o,loc:{start:{line:25,column:119},end:{line:25,column:152}}}))+'</button>\r\n            <button type="button" title="'+r(s(n,"i18n").call(i,"query.cancelQueryTooltip",{name:"i18n",hash:{},data:o,loc:{start:{line:26,column:41},end:{line:26,column:76}}}))+'" class="tc-button tc-modal-close">'+r(s(n,"i18n").call(i,"query.cancelQueryButton",{name:"i18n",hash:{},data:o,loc:{start:{line:26,column:111},end:{line:26,column:145}}}))+"</button>\r\n        </div>\r\n    </div>\r\n</div>"},useData:!0};e.template[e.CLASS+"-form"]={1:function(e,t,n,l,o){var a,r=null!=t?t:e.nullContext||{},i=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'    <select class="tc-combo" name="attributes">\r\n        <option value="">'+e.escapeExpression(i(n,"i18n").call(r,"query.chooseAttrCombo",{name:"i18n",hash:{},data:o,loc:{start:{line:4,column:25},end:{line:4,column:57}}}))+"</option>\r\n"+(null!=(a=i(n,"each").call(r,null!=t?i(t,"attributes"):t,{name:"each",hash:{},fn:e.program(2,o,0),inverse:e.noop,data:o,loc:{start:{line:5,column:8},end:{line:9,column:17}}}))?a:"")+"    </select>\r\n"},2:function(e,t,n,l,o){var a,r=null!=t?t:e.nullContext||{},i=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return null!=(a=i(n,"unless").call(r,i(n,"eq").call(r,o&&i(o,"key"),"FEATURE",{name:"eq",hash:{},data:o,loc:{start:{line:6,column:22},end:{line:6,column:41}}}),{name:"unless",hash:{},fn:e.program(3,o,0),inverse:e.noop,data:o,loc:{start:{line:6,column:12},end:{line:8,column:23}}}))?a:""},3:function(e,t,n,l,o){var a,r=e.lambda,i=e.escapeExpression,s=null!=t?t:e.nullContext||{},c=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'        <option value="'+i(r(o&&c(o,"key"),t))+'"'+(null!=(a=c(n,"if").call(s,null!=t?c(t,"isGeometry"):t,{name:"if",hash:{},fn:e.program(4,o,0),inverse:e.noop,data:o,loc:{start:{line:7,column:32},end:{line:7,column:95}}}))?a:"")+">"+i(r(o&&c(o,"key"),t))+(null!=(a=c(n,"if").call(s,null!=t?c(t,"isGeometry"):t,{name:"if",hash:{},fn:e.program(6,o,0),inverse:e.noop,data:o,loc:{start:{line:7,column:104},end:{line:7,column:156}}}))?a:"")+"</option>\r\n"},4:function(e,t,n,l,o){return' class="tc-ctl-wfsquery-opt-geom"'},6:function(e,t,n,l,o){var a=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return" ("+e.escapeExpression(a(n,"i18n").call(null!=t?t:e.nullContext||{},"geometry",{name:"i18n",hash:{},data:o,loc:{start:{line:7,column:129},end:{line:7,column:148}}}))+")"},8:function(e,t,n,l,o){var a=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'        <div class="tc-ctl-wfsquery-message tc-msg-warning">'+e.escapeExpression(a(n,"i18n").call(null!=t?t:e.nullContext||{},"query.noAttributes",{name:"i18n",hash:{},data:o,loc:{start:{line:12,column:60},end:{line:12,column:89}}}))+"</div>\r\n"},compiler:[8,">= 4.3.0"],main:function(e,t,n,l,o){var a,r=null!=t?t:e.nullContext||{},i=e.lambda,s=e.escapeExpression,c=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return"<div>\r\n"+(null!=(a=c(n,"if").call(r,c(n,"countif").call(r,null!=t?c(t,"attributes"):t,"FEATURE",{name:"countif",hash:{},data:o,loc:{start:{line:2,column:10},end:{line:2,column:40}}}),{name:"if",hash:{},fn:e.program(1,o,0),inverse:e.program(8,o,0),data:o,loc:{start:{line:2,column:4},end:{line:13,column:11}}}))?a:"")+'    \r\n</div>\r\n<div class="tc-ctl-wfsquery-op tc-hidden">\r\n    <div class="tc-ctl-wfsquery tc-ctl-wfsquery-numeric tc-hidden">\r\n        <input type="radio" id="'+s(i(null!=t?c(t,"controlId"):t,t))+'-cond-1" name="'+s(i(null!=t?c(t,"controlId"):t,t))+'-condition" value="eq" /><label for="'+s(i(null!=t?c(t,"controlId"):t,t))+'-cond-1" class="tc-ctl-btn tc-ctl-wfsquery-cond">'+s(c(n,"i18n").call(r,null!=(a=null!=(a=null!=t?c(t,"operators"):t)?c(a,"eq"):a)?c(a,"key"):a,{name:"i18n",hash:{},data:o,loc:{start:{line:18,column:172},end:{line:18,column:197}}}))+'</label>\r\n        <input type="radio" id="'+s(i(null!=t?c(t,"controlId"):t,t))+'-cond-2" name="'+s(i(null!=t?c(t,"controlId"):t,t))+'-condition" value="neq" /><label for="'+s(i(null!=t?c(t,"controlId"):t,t))+'-cond-2" class="tc-ctl-btn tc-ctl-wfsquery-cond">'+s(c(n,"i18n").call(r,null!=(a=null!=(a=null!=t?c(t,"operators"):t)?c(a,"neq"):a)?c(a,"key"):a,{name:"i18n",hash:{},data:o,loc:{start:{line:19,column:173},end:{line:19,column:199}}}))+'</label>\r\n        <input type="radio" id="'+s(i(null!=t?c(t,"controlId"):t,t))+'-cond-3" name="'+s(i(null!=t?c(t,"controlId"):t,t))+'-condition" value="gt" /><label for="'+s(i(null!=t?c(t,"controlId"):t,t))+'-cond-3" class="tc-ctl-btn tc-ctl-wfsquery-cond">'+s(c(n,"i18n").call(r,null!=(a=null!=(a=null!=t?c(t,"operators"):t)?c(a,"gt"):a)?c(a,"key"):a,{name:"i18n",hash:{},data:o,loc:{start:{line:20,column:172},end:{line:20,column:197}}}))+'</label>\r\n        <input type="radio" id="'+s(i(null!=t?c(t,"controlId"):t,t))+'-cond-4" name="'+s(i(null!=t?c(t,"controlId"):t,t))+'-condition" value="lt" /><label for="'+s(i(null!=t?c(t,"controlId"):t,t))+'-cond-4" class="tc-ctl-btn tc-ctl-wfsquery-cond">'+s(c(n,"i18n").call(r,null!=(a=null!=(a=null!=t?c(t,"operators"):t)?c(a,"lt"):a)?c(a,"key"):a,{name:"i18n",hash:{},data:o,loc:{start:{line:21,column:172},end:{line:21,column:197}}}))+'</label>\r\n        <input type="radio" id="'+s(i(null!=t?c(t,"controlId"):t,t))+'-cond-5" name="'+s(i(null!=t?c(t,"controlId"):t,t))+'-condition" value="gte" /><label for="'+s(i(null!=t?c(t,"controlId"):t,t))+'-cond-5" class="tc-ctl-btn tc-ctl-wfsquery-cond">'+s(c(n,"i18n").call(r,null!=(a=null!=(a=null!=t?c(t,"operators"):t)?c(a,"gte"):a)?c(a,"key"):a,{name:"i18n",hash:{},data:o,loc:{start:{line:22,column:173},end:{line:22,column:199}}}))+'</label>\r\n        <input type="radio" id="'+s(i(null!=t?c(t,"controlId"):t,t))+'-cond-6" name="'+s(i(null!=t?c(t,"controlId"):t,t))+'-condition" value="lte" /><label for="'+s(i(null!=t?c(t,"controlId"):t,t))+'-cond-6" class="tc-ctl-btn tc-ctl-wfsquery-cond">'+s(c(n,"i18n").call(r,null!=(a=null!=(a=null!=t?c(t,"operators"):t)?c(a,"lte"):a)?c(a,"key"):a,{name:"i18n",hash:{},data:o,loc:{start:{line:23,column:173},end:{line:23,column:199}}}))+'</label>\r\n        \x3c!--<input type="radio" id="cond_7" name="condition" value="like" /><label for="cond_7" class="tc-ctl-wfsquery-cond">es como</label>--\x3e\r\n    </div>\r\n    <div class="tc-ctl-wfsquery tc-ctl-wfsquery-text tc-hidden">\r\n        <input type="radio" id="'+s(i(null!=t?c(t,"controlId"):t,t))+'-cond-8" name="'+s(i(null!=t?c(t,"controlId"):t,t))+'-condition" value="eq" /><label for="'+s(i(null!=t?c(t,"controlId"):t,t))+'-cond-8" class="tc-ctl-btn tc-ctl-wfsquery-cond">'+s(c(n,"i18n").call(r,null!=(a=null!=(a=null!=t?c(t,"operators"):t)?c(a,"eq"):a)?c(a,"key"):a,{name:"i18n",hash:{},data:o,loc:{start:{line:27,column:172},end:{line:27,column:197}}}))+'</label>\r\n        <input type="radio" id="'+s(i(null!=t?c(t,"controlId"):t,t))+'-cond-9" name="'+s(i(null!=t?c(t,"controlId"):t,t))+'-condition" value="contains" /><label for="'+s(i(null!=t?c(t,"controlId"):t,t))+'-cond-9" class="tc-ctl-btn tc-ctl-wfsquery-cond">'+s(c(n,"i18n").call(r,null!=(a=null!=(a=null!=t?c(t,"operators"):t)?c(a,"contains"):a)?c(a,"key"):a,{name:"i18n",hash:{},data:o,loc:{start:{line:28,column:178},end:{line:28,column:209}}}))+'</label>\r\n        <input type="radio" id="'+s(i(null!=t?c(t,"controlId"):t,t))+'-cond-10" name="'+s(i(null!=t?c(t,"controlId"):t,t))+'-condition" value="starts" /><label for="'+s(i(null!=t?c(t,"controlId"):t,t))+'-cond-10" class="tc-ctl-btn tc-ctl-wfsquery-cond">'+s(c(n,"i18n").call(r,null!=(a=null!=(a=null!=t?c(t,"operators"):t)?c(a,"starts"):a)?c(a,"key"):a,{name:"i18n",hash:{},data:o,loc:{start:{line:29,column:178},end:{line:29,column:207}}}))+'</label>\r\n        <input type="radio" id="'+s(i(null!=t?c(t,"controlId"):t,t))+'-cond-11" name="'+s(i(null!=t?c(t,"controlId"):t,t))+'-condition" value="ends" /><label for="'+s(i(null!=t?c(t,"controlId"):t,t))+'-cond-11" class="tc-ctl-btn tc-ctl-wfsquery-cond">'+s(c(n,"i18n").call(r,null!=(a=null!=(a=null!=t?c(t,"operators"):t)?c(a,"ends"):a)?c(a,"key"):a,{name:"i18n",hash:{},data:o,loc:{start:{line:30,column:176},end:{line:30,column:203}}}))+'</label>\r\n        <input type="radio" id="'+s(i(null!=t?c(t,"controlId"):t,t))+'-cond-20" name="'+s(i(null!=t?c(t,"controlId"):t,t))+'-condition" value="empty" /><label for="'+s(i(null!=t?c(t,"controlId"):t,t))+'-cond-20" class="tc-ctl-btn tc-ctl-wfsquery-cond">'+s(c(n,"i18n").call(r,null!=(a=null!=(a=null!=t?c(t,"operators"):t)?c(a,"empty"):a)?c(a,"key"):a,{name:"i18n",hash:{},data:o,loc:{start:{line:31,column:177},end:{line:31,column:205}}}))+'</label>\r\n    </div>\r\n    <div class="tc-ctl-wfsquery tc-ctl-wfsquery-date tc-hidden">\r\n        <input type="radio" id="'+s(i(null!=t?c(t,"controlId"):t,t))+'-cond-12" name="'+s(i(null!=t?c(t,"controlId"):t,t))+'-condition" value="btw" /><label for="'+s(i(null!=t?c(t,"controlId"):t,t))+'-cond-12" class="tc-ctl-btn tc-ctl-wfsquery-cond">'+s(c(n,"i18n").call(r,null!=(a=null!=(a=null!=t?c(t,"operators"):t)?c(a,"btw"):a)?c(a,"key"):a,{name:"i18n",hash:{},data:o,loc:{start:{line:34,column:175},end:{line:34,column:201}}}))+'</label>\r\n        <input type="radio" id="'+s(i(null!=t?c(t,"controlId"):t,t))+'-cond-13" name="'+s(i(null!=t?c(t,"controlId"):t,t))+'-condition" value="nbtw" /><label for="'+s(i(null!=t?c(t,"controlId"):t,t))+'-cond-13" class="tc-ctl-btn tc-ctl-wfsquery-cond">'+s(c(n,"i18n").call(r,null!=(a=null!=(a=null!=t?c(t,"operators"):t)?c(a,"nbtw"):a)?c(a,"key"):a,{name:"i18n",hash:{},data:o,loc:{start:{line:35,column:176},end:{line:35,column:203}}}))+'</label>\r\n        <input type="radio" id="'+s(i(null!=t?c(t,"controlId"):t,t))+'-cond-14" name="'+s(i(null!=t?c(t,"controlId"):t,t))+'-condition" value="gt" /><label for="'+s(i(null!=t?c(t,"controlId"):t,t))+'-cond-14" class="tc-ctl-btn tc-ctl-wfsquery-cond">'+s(c(n,"i18n").call(r,null!=(a=null!=(a=null!=t?c(t,"operators"):t)?c(a,"gt"):a)?c(a,"key"):a,{name:"i18n",hash:{},data:o,loc:{start:{line:36,column:174},end:{line:36,column:199}}}))+'</label>\r\n        <input type="radio" id="'+s(i(null!=t?c(t,"controlId"):t,t))+'-cond-15" name="'+s(i(null!=t?c(t,"controlId"):t,t))+'-condition" value="lt" /><label for="'+s(i(null!=t?c(t,"controlId"):t,t))+'-cond-15" class="tc-ctl-btn tc-ctl-wfsquery-cond">'+s(c(n,"i18n").call(r,null!=(a=null!=(a=null!=t?c(t,"operators"):t)?c(a,"lt"):a)?c(a,"key"):a,{name:"i18n",hash:{},data:o,loc:{start:{line:37,column:174},end:{line:37,column:199}}}))+'</label>\r\n        <input type="radio" id="'+s(i(null!=t?c(t,"controlId"):t,t))+'-cond-16" name="'+s(i(null!=t?c(t,"controlId"):t,t))+'-condition" value="gte" /><label for="'+s(i(null!=t?c(t,"controlId"):t,t))+'-cond-16" class="tc-ctl-btn tc-ctl-wfsquery-cond">'+s(c(n,"i18n").call(r,null!=(a=null!=(a=null!=t?c(t,"operators"):t)?c(a,"gte"):a)?c(a,"key"):a,{name:"i18n",hash:{},data:o,loc:{start:{line:38,column:175},end:{line:38,column:201}}}))+'</label>\r\n        <input type="radio" id="'+s(i(null!=t?c(t,"controlId"):t,t))+'-cond-17" name="'+s(i(null!=t?c(t,"controlId"):t,t))+'-condition" value="lte" /><label for="'+s(i(null!=t?c(t,"controlId"):t,t))+'-cond-17" class="tc-ctl-btn tc-ctl-wfsquery-cond">'+s(c(n,"i18n").call(r,null!=(a=null!=(a=null!=t?c(t,"operators"):t)?c(a,"lte"):a)?c(a,"key"):a,{name:"i18n",hash:{},data:o,loc:{start:{line:39,column:175},end:{line:39,column:201}}}))+'</label>\r\n        <input type="radio" id="'+s(i(null!=t?c(t,"controlId"):t,t))+'-cond-21" name="'+s(i(null!=t?c(t,"controlId"):t,t))+'-condition" value="null" /><label for="'+s(i(null!=t?c(t,"controlId"):t,t))+'-cond-21" class="tc-ctl-btn tc-ctl-wfsquery-cond">'+s(c(n,"i18n").call(r,null!=(a=null!=(a=null!=t?c(t,"operators"):t)?c(a,"empty"):a)?c(a,"key"):a,{name:"i18n",hash:{},data:o,loc:{start:{line:40,column:176},end:{line:40,column:204}}}))+'</label>\r\n        \x3c!--<input type="radio" id="cond_7" name="condition" value="like" /><label for="cond_7" class="tc-ctl-wfsquery-cond">es como</label>--\x3e\r\n    </div>\r\n    <div class="tc-ctl-wfsquery tc-ctl-wfsquery-geom tc-hidden">\r\n        <input type="radio" id="'+s(i(null!=t?c(t,"controlId"):t,t))+'-cond-18" name="'+s(i(null!=t?c(t,"controlId"):t,t))+'-condition" value="intersects" /><label for="'+s(i(null!=t?c(t,"controlId"):t,t))+'-cond-18" class="tc-ctl-btn tc-ctl-wfsquery-cond">'+s(c(n,"i18n").call(r,null!=(a=null!=(a=null!=t?c(t,"operators"):t)?c(a,"intersects"):a)?c(a,"key"):a,{name:"i18n",hash:{},data:o,loc:{start:{line:44,column:182},end:{line:44,column:215}}}))+'</label>\r\n        <input type="radio" id="'+s(i(null!=t?c(t,"controlId"):t,t))+'-cond-19" name="'+s(i(null!=t?c(t,"controlId"):t,t))+'-condition" value="within" /><label for="'+s(i(null!=t?c(t,"controlId"):t,t))+'-cond-19" class="tc-ctl-btn tc-ctl-wfsquery-cond">'+s(c(n,"i18n").call(r,null!=(a=null!=(a=null!=t?c(t,"operators"):t)?c(a,"within"):a)?c(a,"key"):a,{name:"i18n",hash:{},data:o,loc:{start:{line:45,column:178},end:{line:45,column:207}}}))+'</label>\r\n    </div>\r\n    <div class="tc-ctl-wfsquery-where tc-hidden">\r\n        <div class="tc-ctl-wfsquery-value">\r\n            <input type="search" placeholder="'+s(c(n,"i18n").call(r,"query.searchFieldPhd",{name:"i18n",hash:{},data:o,loc:{start:{line:49,column:46},end:{line:49,column:77}}}))+'" class="tc-textbox" />\r\n            <button type="button" title="'+s(c(n,"i18n").call(r,"query.tooltipAddCondBtn",{name:"i18n",hash:{},data:o,loc:{start:{line:50,column:41},end:{line:50,column:75}}}))+'" class="tc-button">'+s(c(n,"i18n").call(r,"query.textAddCondBtn",{name:"i18n",hash:{},data:o,loc:{start:{line:50,column:95},end:{line:50,column:126}}}))+'</button>\r\n            <ul class="tc-ctl-wfsquery-list tc-ctl-search-list tc-hidden"></ul>\r\n        </div>\r\n        <div class="tc-ctl-wfsquery-geomtype">\r\n            <button class="tc-ctl-btn tc-ctl-wfsquery-geomtype-box-btn" name="geometry" value="rectangle">'+s(c(n,"i18n").call(r,"box",{name:"i18n",hash:{},data:o,loc:{start:{line:54,column:106},end:{line:54,column:120}}}))+'</button>\r\n            <button class="tc-ctl-btn tc-ctl-wfsquery-geomtype-line-btn" name="geometry" value="line">'+s(c(n,"i18n").call(r,"line",{name:"i18n",hash:{},data:o,loc:{start:{line:55,column:102},end:{line:55,column:117}}}))+'</button>\r\n            <button class="tc-ctl-btn tc-ctl-wfsquery-geomtype-polygon-btn" name="geometry" value="polygon">'+s(c(n,"i18n").call(r,"polygon",{name:"i18n",hash:{},data:o,loc:{start:{line:56,column:108},end:{line:56,column:126}}}))+'</button>\r\n        </div>\r\n        <div class="tc-ctl-wfsquery-key">\r\n            <label>'+s(c(n,"i18n").call(r,"query.logicalOpLbl",{name:"i18n",hash:{},data:o,loc:{start:{line:59,column:19},end:{line:59,column:48}}}))+'</label>\r\n        </div>\r\n        <div class="tc-ctl-wfsquery-log-ops">\r\n            <input type="radio" id="'+s(i(null!=t?c(t,"controlId"):t,t))+'-log-op-1" class="tc-ctl-wfsquery-logOpRadio" checked name="'+s(i(null!=t?c(t,"controlId"):t,t))+'-log-op" value="AND" /><label for="'+s(i(null!=t?c(t,"controlId"):t,t))+'-log-op-1" class="tc-ctl-btn tc-ctl-wfsquery-log-op">'+s(c(n,"i18n").call(r,"query.logicalOpAndLbl",{name:"i18n",hash:{},data:o,loc:{start:{line:62,column:223},end:{line:62,column:255}}}))+'</label>\r\n            <input type="radio" id="'+s(i(null!=t?c(t,"controlId"):t,t))+'-log-op-2" class="tc-ctl-wfsquery-logOpRadio" name="'+s(i(null!=t?c(t,"controlId"):t,t))+'-log-op" value="OR" /><label for="'+s(i(null!=t?c(t,"controlId"):t,t))+'-log-op-2" class="tc-ctl-btn tc-ctl-wfsquery-log-op">'+s(c(n,"i18n").call(r,"query.logicalOpOrLbl",{name:"i18n",hash:{},data:o,loc:{start:{line:63,column:214},end:{line:63,column:245}}}))+'</label>\r\n        </div>\r\n        <div class="tc-ctl-wfsquery-where-list"></div>\r\n    </div>\r\n</div>\r\n'},useData:!0};e.template[e.CLASS+"-filter"]={1:function(e,t,n,l,o){var a,r=e.lambda,i=e.escapeExpression,s=null!=t?t:e.nullContext||{},c=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div class="tc-ctl-wfsquery-where-cond">\r\n    '+i(r(null!=t?c(t,"field"):t,t))+"&nbsp;"+i(r(null!=t?c(t,"opText"):t,t))+"&nbsp;"+i(c(n,"formatNumber").call(s,null!=t?c(t,"valueToShow"):t,{name:"formatNumber",hash:{},data:o,loc:{start:{line:3,column:35},end:{line:3,column:63}}}))+(null!=(a=c(n,"if").call(s,null!=t?c(t,"isSpatial"):t,{name:"if",hash:{},fn:e.program(2,o,0),inverse:e.noop,data:o,loc:{start:{line:3,column:63},end:{line:3,column:172}}}))?a:"")+'\r\n</div>\r\n<div class="tc-ctl-wfsquery-del-cond" title="'+i(c(n,"i18n").call(s,"query.tooltipRemoveCond",{name:"i18n",hash:{},data:o,loc:{start:{line:5,column:45},end:{line:5,column:79}}}))+'"></div>\t\r\n'},2:function(e,t,n,l,o){var a=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return' <button class="tc-icon-btn tc-ctl-wfsquery-where-cond-view">'+e.escapeExpression(a(n,"i18n").call(null!=t?t:e.nullContext||{},"view",{name:"i18n",hash:{},data:o,loc:{start:{line:3,column:141},end:{line:3,column:156}}}))+"</button>"},compiler:[8,">= 4.3.0"],main:function(e,t,n,l,o){var a,r=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return null!=(a=r(n,"each").call(null!=t?t:e.nullContext||{},null!=t?r(t,"conditions"):t,{name:"each",hash:{},fn:e.program(1,o,0),inverse:e.noop,data:o,loc:{start:{line:1,column:0},end:{line:6,column:9}}}))?a:""},useData:!0};e.template[e.CLASS+"-table"]={1:function(e,t,n,l,o,a,r){var i,s=null!=t?t:e.nullContext||{},c=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return null!=(i=c(n,"unless").call(s,c(n,"startsWith").call(s,t,"h3_",{name:"startsWith",hash:{},data:o,loc:{start:{line:4,column:18},end:{line:4,column:41}}}),{name:"unless",hash:{},fn:e.program(2,o,0,a,r),inverse:e.noop,data:o,loc:{start:{line:4,column:8},end:{line:9,column:19}}}))?i:""},2:function(e,t,n,l,o,a,r){var i,s=null!=t?t:e.nullContext||{},c=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return null!=(i=c(n,"unless").call(s,c(n,"startsWith").call(s,t,"h4_",{name:"startsWith",hash:{},data:o,loc:{start:{line:5,column:18},end:{line:5,column:41}}}),{name:"unless",hash:{},fn:e.program(3,o,0,a,r),inverse:e.noop,data:o,loc:{start:{line:5,column:8},end:{line:8,column:19}}}))?i:""},3:function(e,t,n,l,o,a,r){var i,s=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return"        <th"+(null!=(i=s(n,"if").call(null!=t?t:e.nullContext||{},null!=r[1]?s(r[1],"sort"):r[1],{name:"if",hash:{},fn:e.program(4,o,0,a,r),inverse:e.noop,data:o,loc:{start:{line:6,column:11},end:{line:6,column:259}}}))?i:"")+">\r\n            "+e.escapeExpression(e.lambda(t,t))+"</th>\r\n"},4:function(e,t,n,l,o,a,r){var i,s=null!=t?t:e.nullContext||{},c=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return' title="'+e.escapeExpression(c(n,"i18n").call(s,"wfs.QuerySortTitle",{name:"i18n",hash:{},data:o,loc:{start:{line:6,column:34},end:{line:6,column:63}}}))+'" class="tc-ctl-wfsquery-results-sortable'+(null!=(i=c(n,"if").call(s,c(n,"eq").call(s,t,null!=(i=null!=r[1]?c(r[1],"sort"):r[1])?c(i,"field"):i,{name:"eq",hash:{},data:o,loc:{start:{line:6,column:110},end:{line:6,column:133}}}),{name:"if",hash:{},fn:e.program(5,o,0,a,r),inverse:e.noop,data:o,loc:{start:{line:6,column:104},end:{line:6,column:250}}}))?i:"")+'" '},5:function(e,t,n,l,o,a,r){var i,s=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return" "+(null!=(i=s(n,"if").call(null!=t?t:e.nullContext||{},null!=(i=null!=r[1]?s(r[1],"sort"):r[1])?s(i,"order"):i,{name:"if",hash:{},fn:e.program(6,o,0,a,r),inverse:e.program(8,o,0,a,r),data:o,loc:{start:{line:6,column:136},end:{line:6,column:243}}}))?i:"")},6:function(e,t,n,l,o){return"tc-ctl-wfsquery-results-sorting-asc"},8:function(e,t,n,l,o){return"tc-ctl-wfsquery-results-sorting-desc"},10:function(e,t,n,l,o){var a,r=null!=t?t:e.nullContext||{},i=e.escapeExpression,s=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'        <tr title="'+i(s(n,"i18n").call(r,"zoomToFeature",{name:"i18n",hash:{},data:o,loc:{start:{line:15,column:19},end:{line:15,column:44}}}))+'" data-id="'+i(e.lambda(null!=t?s(t,"Id"):t,t))+'" data-index="'+(null!=(a=s(n,"if").call(r,s(n,"gt").call(r,null!=t?s(t,"index"):t,-1,{name:"gt",hash:{},data:o,loc:{start:{line:15,column:81},end:{line:15,column:94}}}),{name:"if",hash:{},fn:e.program(11,o,0),inverse:e.program(13,o,0),data:o,loc:{start:{line:15,column:75},end:{line:15,column:130}}}))?a:"")+'" class="tc-selectable">\r\n'+(null!=(a=s(n,"each").call(r,t,{name:"each",hash:{},fn:e.program(15,o,0),inverse:e.noop,data:o,loc:{start:{line:16,column:12},end:{line:26,column:21}}}))?a:"")+"        </tr>\r\n"},11:function(e,t,n,l,o){var a=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return e.escapeExpression(e.lambda(null!=t?a(t,"index"):t,t))},13:function(e,t,n,l,o){var a=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return e.escapeExpression(e.lambda(o&&a(o,"index"),t))},15:function(e,t,n,l,o){var a,r=null!=t?t:e.nullContext||{},i=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return null!=(a=i(n,"unless").call(r,i(n,"eq").call(r,o&&i(o,"key"),"index",{name:"eq",hash:{},data:o,loc:{start:{line:17,column:22},end:{line:17,column:39}}}),{name:"unless",hash:{},fn:e.program(16,o,0),inverse:e.noop,data:o,loc:{start:{line:17,column:12},end:{line:25,column:23}}}))?a:""},16:function(e,t,n,l,o){var a,r=null!=t?t:e.nullContext||{},i=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return null!=(a=i(n,"unless").call(r,i(n,"startsWith").call(r,o&&i(o,"key"),"h3_",{name:"startsWith",hash:{},data:o,loc:{start:{line:18,column:22},end:{line:18,column:45}}}),{name:"unless",hash:{},fn:e.program(17,o,0),inverse:e.noop,data:o,loc:{start:{line:18,column:12},end:{line:24,column:23}}}))?a:""},17:function(e,t,n,l,o){var a,r=null!=t?t:e.nullContext||{},i=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return null!=(a=i(n,"unless").call(r,i(n,"startsWith").call(r,o&&i(o,"key"),"h4_",{name:"startsWith",hash:{},data:o,loc:{start:{line:19,column:22},end:{line:19,column:45}}}),{name:"unless",hash:{},fn:e.program(18,o,0),inverse:e.noop,data:o,loc:{start:{line:19,column:12},end:{line:23,column:23}}}))?a:""},18:function(e,t,n,l,o){var a,r=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'            <td class="'+e.escapeExpression(r(n,"lowerCase").call(null!=t?t:e.nullContext||{},o&&r(o,"key"),{name:"lowerCase",hash:{},data:o,loc:{start:{line:20,column:23},end:{line:20,column:41}}}))+'">\r\n'+(null!=(a=e.invokePartial(r(l,"tc-ctl-finfo-attr-val"),t,{name:"tc-ctl-finfo-attr-val",hash:{value:t,name:o&&r(o,"key")},data:o,indent:"                ",helpers:n,partials:l,decorators:e.decorators}))?a:"")+"            </td>\r\n"},compiler:[8,">= 4.3.0"],main:function(e,t,n,l,o,a,r){var i,s=null!=t?t:e.nullContext||{},c=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<table class="table">\r\n    <thead>\r\n'+(null!=(i=c(n,"each").call(s,null!=t?c(t,"columns"):t,{name:"each",hash:{},fn:e.program(1,o,0,a,r),inverse:e.noop,data:o,loc:{start:{line:3,column:8},end:{line:10,column:17}}}))?i:"")+"\r\n</thead>\r\n    <tbody>\r\n"+(null!=(i=c(n,"each").call(s,null!=t?c(t,"results"):t,{name:"each",hash:{},fn:e.program(10,o,0,a,r),inverse:e.noop,data:o,loc:{start:{line:14,column:8},end:{line:28,column:13}}}))?i:"")+"    </tbody>\r\n</table>\r\n"},usePartial:!0,useData:!0,useDepths:!0};e.template["tc-ctl-finfo-attr-val"]={1:function(e,t,n,l,o){var a,r=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return null!=(a=e.invokePartial(r(l,"tc-ctl-finfo-attr-video"),t,{name:"tc-ctl-finfo-attr-video",hash:{value:null!=t?r(t,"value"):t,name:null!=t?r(t,"name"):t},data:o,indent:"    ",helpers:n,partials:l,decorators:e.decorators}))?a:""},3:function(e,t,n,l,o){var a,r=null!=t?t:e.nullContext||{},i=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return null!=(a=i(n,"if").call(r,i(n,"isImageAttribute").call(r,null!=t?i(t,"name"):t,null!=t?i(t,"value"):t,{name:"isImageAttribute",hash:{},data:o,loc:{start:{line:4,column:10},end:{line:4,column:39}}}),{name:"if",hash:{},fn:e.program(4,o,0),inverse:e.program(6,o,0),data:o,loc:{start:{line:4,column:4},end:{line:16,column:11}}}))?a:""},4:function(e,t,n,l,o){var a,r=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return null!=(a=e.invokePartial(r(l,"tc-ctl-finfo-attr-image"),t,{name:"tc-ctl-finfo-attr-image",hash:{value:null!=t?r(t,"value"):t,name:null!=t?r(t,"name"):t},data:o,indent:"        ",helpers:n,partials:l,decorators:e.decorators}))?a:""},6:function(e,t,n,l,o){var a,r=null!=t?t:e.nullContext||{},i=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return null!=(a=i(n,"if").call(r,i(n,"isAudioAttribute").call(r,null!=t?i(t,"name"):t,null!=t?i(t,"value"):t,{name:"isAudioAttribute",hash:{},data:o,loc:{start:{line:7,column:14},end:{line:7,column:43}}}),{name:"if",hash:{},fn:e.program(7,o,0),inverse:e.program(9,o,0),data:o,loc:{start:{line:7,column:8},end:{line:15,column:15}}}))?a:""},7:function(e,t,n,l,o){var a,r=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return null!=(a=e.invokePartial(r(l,"tc-ctl-finfo-attr-audio"),t,{name:"tc-ctl-finfo-attr-audio",hash:{value:null!=t?r(t,"value"):t,name:null!=t?r(t,"name"):t},data:o,indent:"            ",helpers:n,partials:l,decorators:e.decorators}))?a:""},9:function(e,t,n,l,o){var a,r=null!=t?t:e.nullContext||{},i=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return null!=(a=i(n,"if").call(r,i(n,"isEmbedAttribute").call(r,null!=t?i(t,"name"):t,null!=t?i(t,"value"):t,{name:"isEmbedAttribute",hash:{},data:o,loc:{start:{line:10,column:18},end:{line:10,column:47}}}),{name:"if",hash:{},fn:e.program(10,o,0),inverse:e.program(12,o,0),data:o,loc:{start:{line:10,column:12},end:{line:14,column:19}}}))?a:""},10:function(e,t,n,l,o){var a,r=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return null!=(a=e.invokePartial(r(l,"tc-ctl-finfo-attr-embed"),t,{name:"tc-ctl-finfo-attr-embed",hash:{value:null!=t?r(t,"value"):t,name:null!=t?r(t,"name"):t},data:o,indent:"                ",helpers:n,partials:l,decorators:e.decorators}))?a:""},12:function(e,t,n,l,o){var a,r=null!=t?t:e.nullContext||{},i=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return"                "+(null!=(a=i(n,"unless").call(r,i(n,"eq").call(r,null!=t?i(t,"value"):t,null,{name:"eq",hash:{},data:o,loc:{start:{line:13,column:26},end:{line:13,column:41}}}),{name:"unless",hash:{},fn:e.program(13,o,0),inverse:e.noop,data:o,loc:{start:{line:13,column:16},end:{line:13,column:86}}}))?a:"")+"\r\n"},13:function(e,t,n,l,o){var a,r=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return null!=(a=e.invokePartial(r(l,"tc-ctl-finfo-object"),null!=t?r(t,"value"):t,{name:"tc-ctl-finfo-object",data:o,helpers:n,partials:l,decorators:e.decorators}))?a:""},compiler:[8,">= 4.3.0"],main:function(e,t,n,l,o){var a,r=null!=t?t:e.nullContext||{},i=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return null!=(a=i(n,"if").call(r,i(n,"isVideoAttribute").call(r,null!=t?i(t,"name"):t,null!=t?i(t,"value"):t,{name:"isVideoAttribute",hash:{},data:o,loc:{start:{line:1,column:6},end:{line:1,column:35}}}),{name:"if",hash:{},fn:e.program(1,o,0),inverse:e.program(3,o,0),data:o,loc:{start:{line:1,column:0},end:{line:17,column:7}}}))?a:""},usePartial:!0,useData:!0};e.template["tc-ctl-finfo-object"]={1:function(e,t,n,l,o){var a;return'<table class="complexAttr">\r\n    <tbody>\r\n'+(null!=(a=(e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]})(n,"each").call(null!=t?t:e.nullContext||{},t,{name:"each",hash:{},fn:e.program(2,o,0),inverse:e.noop,data:o,loc:{start:{line:4,column:4},end:{line:35,column:13}}}))?a:"")+"    </tbody>\r\n</table>\r\n"},2:function(e,t,n,l,o){var a,r=null!=t?t:e.nullContext||{},i=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return null!=(a=i(n,"unless").call(r,i(n,"isObject").call(r,t,{name:"isObject",hash:{},data:o,loc:{start:{line:5,column:18},end:{line:5,column:33}}}),{name:"unless",hash:{},fn:e.program(3,o,0),inverse:e.program(6,o,0),data:o,loc:{start:{line:5,column:8},end:{line:34,column:19}}}))?a:""},3:function(e,t,n,l,o){var a,r=null!=t?t:e.nullContext||{},i=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'        <tr class="keyValue">\r\n            <th class="key">'+e.escapeExpression(e.lambda(o&&i(o,"key"),t))+'</th>\r\n            <td class="value tc-ctl-finfo-val">'+(null!=(a=i(n,"unless").call(r,i(n,"isEmpty").call(r,t,{name:"isEmpty",hash:{},data:o,loc:{start:{line:8,column:57},end:{line:8,column:71}}}),{name:"unless",hash:{},fn:e.program(4,o,0),inverse:e.noop,data:o,loc:{start:{line:8,column:47},end:{line:8,column:115}}}))?a:"")+"</td>\r\n        </tr>\r\n"},4:function(e,t,n,l,o){var a,r=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return null!=(a=e.invokePartial(r(l,"tc-ctl-finfo-object"),t,{name:"tc-ctl-finfo-object",data:o,helpers:n,partials:l,decorators:e.decorators}))?a:""},6:function(e,t,n,l,o){var a,r=null!=t?t:e.nullContext||{},i=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'        <tr>\r\n            <th style="display:none">'+e.escapeExpression(e.lambda(o&&i(o,"key"),t))+"</th>\r\n            <td>\r\n"+(null!=(a=i(n,"if").call(r,i(n,"isObject").call(r,t,{name:"isObject",hash:{},data:o,loc:{start:{line:14,column:22},end:{line:14,column:37}}}),{name:"if",hash:{},fn:e.program(7,o,0),inverse:e.program(9,o,0),data:o,loc:{start:{line:14,column:16},end:{line:29,column:23}}}))?a:"")+(null!=(a=e.invokePartial(i(l,"tc-ctl-finfo-object"),t,{name:"tc-ctl-finfo-object",data:o,indent:"                    ",helpers:n,partials:l,decorators:e.decorators}))?a:"")+"                </div>\r\n            </td>\r\n        </tr>\r\n"},7:function(e,t,n,l,o){var a=null!=t?t:e.nullContext||{},r=e.escapeExpression,i=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'                \x3c!--object--\x3e\r\n                <input type="checkbox" id="complexAttr_'+r(i(n,"getId").call(a,t,{name:"getId",hash:{},data:o,loc:{start:{line:16,column:55},end:{line:16,column:69}}}))+'">\r\n                <div>\r\n                    <label for="complexAttr_'+r(i(n,"getId").call(a,t,{name:"getId",hash:{},data:o,loc:{start:{line:18,column:44},end:{line:18,column:58}}}))+'" class="plus" title=""></label>\r\n                    <label for="complexAttr_'+r(i(n,"getId").call(a,t,{name:"getId",hash:{},data:o,loc:{start:{line:19,column:44},end:{line:19,column:58}}}))+'" class="title" title="">'+r(e.lambda(o&&i(o,"key"),t))+"</label><br />\r\n"},9:function(e,t,n,l,o){var a,r=null!=t?t:e.nullContext||{},i=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return(null!=(a=i(n,"if").call(r,i(n,"isArray").call(r,t,{name:"isArray",hash:{},data:o,loc:{start:{line:21,column:26},end:{line:21,column:40}}}),{name:"if",hash:{},fn:e.program(10,o,0),inverse:e.program(12,o,0),data:o,loc:{start:{line:21,column:20},end:{line:27,column:27}}}))?a:"")+"                    \x3c!--native--\x3e\r\n"},10:function(e,t,n,l,o){var a=e.escapeExpression,r=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'                \x3c!--array--\x3e\r\n                <div>\r\n                    <label for="complexAttr_'+a(r(n,"getId").call(null!=t?t:e.nullContext||{},t,{name:"getId",hash:{},data:o,loc:{start:{line:24,column:44},end:{line:24,column:58}}}))+'" class="title" title="">'+a(e.lambda(o&&r(o,"key"),t))+"</label><br />\r\n"},12:function(e,t,n,l,o){return"                <div>\r\n"},14:function(e,t,n,l,o){var a,r=null!=t?t:e.nullContext||{},i=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return null!=(a=i(n,"if").call(r,i(n,"isArray").call(r,t,{name:"isArray",hash:{},data:o,loc:{start:{line:39,column:10},end:{line:39,column:24}}}),{name:"if",hash:{},fn:e.program(15,o,0),inverse:e.program(18,o,0),data:o,loc:{start:{line:39,column:4},end:{line:62,column:11}}}))?a:""},15:function(e,t,n,l,o){var a,r=null!=t?t:e.nullContext||{},i=e.escapeExpression,s=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div class="complexAttr">\r\n    <input type="checkbox" id="complexAttr_'+i(s(n,"getId").call(r,t,{name:"getId",hash:{},data:o,loc:{start:{line:41,column:43},end:{line:41,column:57}}}))+'">\r\n    <div>\r\n        <label for="complexAttr_'+i(s(n,"getId").call(r,t,{name:"getId",hash:{},data:o,loc:{start:{line:43,column:32},end:{line:43,column:46}}}))+'" class="plus" title=""></label>\r\n        <label for="complexAttr_'+i(s(n,"getId").call(r,t,{name:"getId",hash:{},data:o,loc:{start:{line:44,column:32},end:{line:44,column:46}}}))+'" class="title" title="">'+i(e.lambda(null!=t?s(t,"length"):t,t))+" "+i(s(n,"i18n").call(r,"featureInfo.complexData.array",{name:"i18n",hash:{},data:o,loc:{start:{line:44,column:82},end:{line:44,column:122}}}))+'</label><br />\r\n        <table class="complexAttr">\r\n            <tbody>\r\n'+(null!=(a=s(n,"each").call(r,t,{name:"each",hash:{},fn:e.program(16,o,0),inverse:e.noop,data:o,loc:{start:{line:47,column:16},end:{line:51,column:25}}}))?a:"")+"            </tbody>\r\n        </table>\r\n    </div>\r\n</div>\r\n"},16:function(e,t,n,l,o){var a,r=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return"                <tr>\r\n                    <td>"+(null!=(a=e.invokePartial(r(l,"tc-ctl-finfo-object"),t,{name:"tc-ctl-finfo-object",data:o,helpers:n,partials:l,decorators:e.decorators}))?a:"")+"</td>\r\n                </tr>\r\n"},18:function(e,t,n,l,o){var a,r=null!=t?t:e.nullContext||{},i=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return null!=(a=i(n,"if").call(r,i(n,"isUrl").call(r,t,{name:"isUrl",hash:{},data:o,loc:{start:{line:57,column:14},end:{line:57,column:26}}}),{name:"if",hash:{},fn:e.program(19,o,0),inverse:e.program(21,o,0),data:o,loc:{start:{line:57,column:8},end:{line:61,column:15}}}))?a:""},19:function(e,t,n,l,o){var a=e.escapeExpression,r=null!=t?t:e.nullContext||{},i=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<a href="'+a(e.lambda(t,t))+'" target="_blank" title="'+a(i(n,"i18n").call(r,"linkInNewWindow",{name:"i18n",hash:{},data:o,loc:{start:{line:58,column:42},end:{line:58,column:68}}}))+'">'+a(i(n,"i18n").call(r,"open",{name:"i18n",hash:{},data:o,loc:{start:{line:58,column:70},end:{line:58,column:85}}}))+"</a>\r\n"},21:function(e,t,n,l,o){var a;return(null!=(a=(e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]})(n,"formatDateOrNumber").call(null!=t?t:e.nullContext||{},t,{name:"formatDateOrNumber",hash:{},data:o,loc:{start:{line:60,column:0},end:{line:60,column:30}}}))?a:"")+"\r\n"},compiler:[8,">= 4.3.0"],main:function(e,t,n,l,o){var a,r=null!=t?t:e.nullContext||{},i=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return null!=(a=i(n,"if").call(r,i(n,"isObject").call(r,t,{name:"isObject",hash:{},data:o,loc:{start:{line:1,column:6},end:{line:1,column:21}}}),{name:"if",hash:{},fn:e.program(1,o,0),inverse:e.program(14,o,0),data:o,loc:{start:{line:1,column:0},end:{line:63,column:7}}}))?a:""},usePartial:!0,useData:!0};e.template[e.CLASS+"-geom"]={compiler:[8,">= 4.3.0"],main:function(e,t,n,l,o){var a=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div class="tc-ctl-wfsquery-geom-draw"></div>\r\n<div class="tc-ctl-wfsquery-geom-btn">\r\n    <button class="tc-button tc-ctl-wfsquery-geom-btn-ok">'+e.escapeExpression(a(n,"i18n").call(null!=t?t:e.nullContext||{},"query.returnToQueryBuilder",{name:"i18n",hash:{},data:o,loc:{start:{line:3,column:58},end:{line:3,column:95}}}))+"</button>\r\n</div>"},useData:!0};e.template[e.CLASS+"-share-dialog"]={compiler:[8,">= 4.3.0"],main:function(e,t,n,l,o){var a=null!=t?t:e.nullContext||{},r=e.escapeExpression,i=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div class="tc-ctl-search-dialog tc-ctl-wfsquery-share-dialog tc-modal">\r\n    <div class="tc-modal-background tc-modal-close"></div>\r\n    <div class="tc-modal-window">\r\n        <div class="tc-modal-header">\r\n            <h3>'+r(i(n,"i18n").call(a,"query.tooltipMagnifBtn",{name:"i18n",hash:{},data:o,loc:{start:{line:5,column:16},end:{line:5,column:49}}}))+" - "+r(i(n,"i18n").call(a,"share",{name:"i18n",hash:{},data:o,loc:{start:{line:5,column:52},end:{line:5,column:68}}}))+'</h3>\r\n            <div class="tc-modal-close"></div>\r\n        </div>\r\n        <div class="tc-modal-body">\r\n            <div class="tc-ctl-wfsquery-share-dialog-ctl"></div>\r\n        </div>\r\n    </div>\r\n</div>\r\n\r\n\r\n'},useData:!0};var b=function(e){var t=document.createElement("input");t.setAttribute("type",e);return t.type==e},C=null,T=null,w=function(e){if(b("date"))e.type="date";else{e.type="search";new Promise(function(e,t){"undefined"!=typeof IMask?setTimeout(function(){e()},10):TC.loadJS(!0,[TC.apiLocation+"/lib/polyfill/IMask"+(TC.isDebug?"":".min")+".js"],function(){console.log("Imask loaded");e()})}).then(function(){C=new IMask(e,{mask:Date,pattern:i&&"es-ES"!==i?"eu-ES"===i?"Y/`m/`d":"m/`d/`Y":"d/`m/`Y",lazy:!1,format:function(e){var t=e.getDate(),n=e.getMonth()+1,l=e.getFullYear();t<10&&(t="0"+t);n<10&&(n="0"+n);switch(i){case"eu-ES":return[l,n,t].join("/");case"en-US":return[n,t,l].join("/");case"es-ES":default:return[t,n,l].join("/")}},parse:function(e){switch(i){case"eu-ES":return new Date(e.split("/")[1]+"/"+e.split("/")[2]+"/"+e.split("/")[0]);case"en-US":return new Date(e);case"es-ES":default:return new Date(e.split("/")[1]+"/"+e.split("/")[0]+"/"+e.split("/")[2])}},blocks:{d:{mask:IMask.MaskedRange,from:1,to:31,maxLength:2},m:{mask:IMask.MaskedRange,from:1,to:12,maxLength:2},Y:{mask:IMask.MaskedRange,from:1900,to:9999}}})})}},O=function(){if(C){var e=C.el.input;C.destroy();C=null;e.value="";e.type="search"}};const L=function(t,l){var o=this;o.parentElement.parentElement.querySelectorAll("select").forEach(function(e){o.offsetTop<e.offsetTop&&e.parentElement.parentElement.removeChild(e.parentElement)});const a=t.querySelector(`.${e.CLASS}-numeric`),r=t.querySelector(`.${e.CLASS}-text`),s=t.querySelector(`.${e.CLASS}-date`),c=t.querySelector(`.${e.CLASS}-geom`),u=t.querySelector(`.${e.CLASS}-where`),d=t.querySelector(`.${e.CLASS}-op`);var m=u.querySelector(".tc-textbox");m.disabled=!1;m.dataset.autocomplete&&TC.UI.autocomplete.call(m,"clear");a.classList.add(n);s.classList.add(n);r.classList.add(n);c.classList.add(n);u.classList.add(n);if(l[this.selectedOptions[0].value.substring(this.selectedOptions[0].value.indexOf(":")+1)]){v=l[this.selectedOptions[0].value.substring(this.selectedOptions[0].value.indexOf(":")+1)].type;d.classList.remove(n);TC.UI.autocomplete.call(m,"destroy");!function(){if(T){var e=T.el.input;T.destroy();T=null;e.value="";e.type="search"}}();m.type="search";switch(!0){case!v:console.log("type es nulo");break;case v instanceof Object:(function(e,t){var n="";n+='<option value="">'+g("query.chooseAttrCombo")+"</option>";for(var l in e)e[l].type&&!TC.Util.isGeometry(e[l].type)&&(n+='<option value="'+(e[l].name||l)+'">'+l+"</option>");var o=document.createElement("div");o.insertAdjacentHTML("beforeend",'<select class="'+this.className+'" name="'+this.name+'">'+n+"</select>");this.parentNode.parentNode.insertBefore(o,this.parentNode.nextSibling).firstElementChild.addEventListener("change",function(){L.apply(this,[t,e])})}).apply(this,[v,t]);break;case TC.Util.isGeometry(v):c.classList.remove(n);u.classList.remove(n);u.classList.add("tc-spatial");0===c.querySelectorAll("input:checked").length&&(c.firstElementChild.checked=!0);O();break;case v.indexOf("int")>=0:case v.indexOf("float")>=0:case v.indexOf("double")>=0:case v.indexOf("long")>=0:case v.indexOf("decimal")>=0:a.classList.remove(n);u.classList.remove(n,"tc-spatial");0===a.querySelectorAll("input:checked").length&&(a.firstElementChild.checked=!0);O();if(b("number"))if(TC.Util.detectIE()){m.type="text";new Promise(function(e,t){"undefined"!=typeof IMask?setTimeout(function(){e()},10):TC.loadJS(!0,[TC.apiLocation+"/lib/polyfill/IMask"+(TC.isDebug?"":".min")+".js"],function(){console.log("Imask loaded");e()})}).then(function(){T=new IMask(m,{mask:Number,scale:v.indexOf("int")>=0||v.indexOf("long")>=0?0:2,signed:!1,thousandsSeparator:i&&"en-US"===i?",":".",padFractionalZeros:!1,normalizeZeros:!0,radix:i&&"en-US"===i?".":","})})}else{m.type="number";v.indexOf("int")>=0||v.indexOf("long")>=0?m.step="1":m.step="0.0001"}break;case v.indexOf("dateTime")>=0:case v.indexOf("date")>=0:s.classList.remove(n);u.classList.remove(n,"tc-spatial");0===s.querySelectorAll("input:checked").length&&(s.firstElementChild.checked=!0);w(m);break;case v.indexOf("string")>=0:r.classList.remove(n);u.classList.remove(n,"tc-spatial");0===r.querySelectorAll("input:checked").length&&(r.firstElementChild.checked=!0);O();const l=[].slice.call(t.querySelectorAll("select[name="+this.name+"]")).reduce(function(e,t){return e+(e?"/":"")+t.value},"");q(m,l,t.getElementsByClassName(e.CLASS+"-list tc-ctl-search-list")[0])}}else d.classList.add(n)},S=function(t){const n=t.getForm(),l=n.querySelector(`.${t.CLASS}-where-list`);s(l);e.getRenderedHtml(t.CLASS+"-filter",{conditions:t.filters.map(e=>(function(e,t){const n=t instanceof TC.filter.Spatial;return{field:n?e.getLocaleString("geometry"):t.propertyName,opText:e.getLocaleString(c[t._abbr].key),valueToShow:t._valueToShow,isSpatial:n}})(t,e))},function(e){l.innerHTML=e;l.querySelectorAll(`.${t.CLASS}-where-cond-view`).forEach(function(e,n){e.addEventListener(TC.Consts.event.CLICK,function(){t.map.zoomToFeatures([t.filters.filter(e=>e instanceof TC.filter.Spatial)[n].geometry]);t.showGeometryPanel()},{passive:!0})});n.querySelectorAll(`.${t.CLASS}-del-cond`).forEach(function(e,n){e.addEventListener(TC.Consts.event.CLICK,function(){t.removeFilter(n)},{passive:!0})})})};const P=()=>p;var k=function(e){const t=this;var n=e;return new Promise(async function(e){if(t.resultsPanel)t.resultsPanel.options.save.fileName=n+".xls";else{var l=t.map.getControlsByClass(TC.control.ControlContainer);const e={content:"table",titles:{main:"",max:""},save:{fileName:n+".xls"},download:()=>(function(e,t){const n=e;n.getDownloadDialog().then(function(e){var l={title:t()};(n.map.elevation||n.options.displayElevation)&&(l=Object.assign({},l,{elevation:Object.assign({},n.map.elevation&&n.map.elevation.options,n.options.displayElevation)}));e.open(n.resultsLayer.features,l)})})(t,P),share:!0,resize:!0};if(0==l.length){t.resultsPanel=await t.map.addControl("resultsPanel",e);t.resultsPanel.caller=t}else{e.position="right";t.resultsPanel=await l[0].addControl("resultsPanel",e);t.resultsPanel.caller=t}t.resultsPanel.template[t.resultsPanel.CLASS+"-table"]=t.template[t.CLASS+"-table"]}t.resultsPanel.options.titles.max=t.resultsPanel.getLocaleString("geo.trk.chart.exp");e()})},x=function(e,t){var a=l.getElementsByClassName("tc-ctl-wfsquery-message")[0];if(o)clearTimeout(o);else{a.innerHTML=e;switch(t){case TC.Consts.msgType.INFO:a.classList.add("tc-msg-info");break;case TC.Consts.msgType.WARNING:a.classList.add("tc-msg-warning");break;case TC.Consts.msgType.ERROR:default:a.classList.add("tc-msg-error")}a.classList.remove(n)}o=setTimeout(function(){o=null;a.classList.add(n)},3e3)},q=function(e,t,l){TC.UI.autocomplete.call(e,{minLength:3,target:l,source:function(e,l){var o=this;o.target.innerHTML='<li><a class="tc-ctl-search-li-loading" href="#">'+g("searching")+'<span class="tc-ctl-search-loading-spinner tc-ctl-search-loading"></span></a></li>';o.target.classList.remove(n);a&&window.clearTimeout(a);a=window.setTimeout(async function(){if(!document.querySelector(".tc-ctl-wfsquery.tc-ctl-wfsquery-text").classList.contains(TC.Consts.classes.HIDDEN)){var a=await async function(e,t){var n=Object.assign({},m);switch(document.querySelector(".tc-ctl-wfsquery.tc-ctl-wfsquery-text input:checked").value){case"starts":t+="*";break;case"contains":case"eq":t="*"+t+"*";break;case"ends":t="*"+t}r&&r.abort();let l=(r=new AbortController).signal;try{var o=await u.toolProxification.fetch(f,{data:TC.Util.WFGetPropertyValue(d,!(e.indexOf("/")>=0)&&e,TC.filter.like(e,t,void 0,void 0,void 0,!1),n),contentType:"application/xml",method:"POST",signal:l});if(o.contentType.startsWith("application/xml")||o.contentType.startsWith("text/xml")){let e=(new DOMParser).parseFromString(o.responseText,"text/xml"),t=e.querySelector("Exception ExceptionText");if(t){x(t.innerHTML,TC.Consts.msgType.ERROR);return[]}var a=[];e.querySelectorAll("member > *").forEach(function(e){a.indexOf(e.innerHTML)<0&&(a[a.length]=e.innerHTML)});return a}o.contentType.startsWith("application/json")&&(o=JSON.parse(o.responseText));if(o.features&&o.features.length>0){1===o.features.length&&(a=[e.split("/").reduce(function(e,t){return e[t.substring(t.indexOf(":")+1)]},o.features[0].properties)]);o.features.length>1&&(a=o.features.reduce(function(t,n){if(t&&t instanceof Array)return t.indexOf(n.properties[e])<0?t.concat(e.split("/").reduce(function(e,t){return e[t.substring(t.indexOf(":")+1)]},n.properties)):t},[]));return a}return[]}catch(e){e instanceof DOMException&&"AbortError"!==e.name&&x(e,TC.Consts.msgType.ERROR);return null}}(t,e);a&&(a.length?l(a.sort()):o.target.classList.add(n))}},500)},callback:function(t){e.value=t.currentTarget.dataset.value;this.target.classList.add(n)},buildHTML:function(t){var n=e.value;this.target.style.maxHeight="";return t.results.length>1?t.results.reduce(function(e,t,l){return(l>1?e:E(e,n))+E(t,n)}):E(t.results[0],n)}});e.addEventListener("targetCleared.autocomplete",function(){l.classList.add(n)});e.addEventListener("keypress",function(t){13==t.which&&TC.UI.autocomplete.call(e,"clear")});e.addEventListener("search",function(t){0===e.value.length&&TC.UI.autocomplete.call(e,"clear")});e.addEventListener("input",function(t){0===e.value.length&&TC.UI.autocomplete.call(e,"clear")})},E=function(e,t){t=new RegExp(t.replace(/\W/g,""),"gi");return'<li><a href="#" data-value="'+e+'">'+e.replace(t,"<b>$&</b>")+"</a></li>"},A=function(e){var t=function(e,t){var n;t instanceof TC.feature.Point?n=e.addPoint(t.getCoords()):t instanceof TC.feature.Polyline?n=e.addPolyline(t.getCoords()):t instanceof TC.feature.Polygon?n=e.addPolygon(t.getCoords()):t instanceof TC.feature.MultiPolygon?n=e.addMultiPolygon(t.getCoords()):t instanceof TC.feature.MultiPolyline&&(n=e.addMultiPolyline(t.getCoords()));return n};if(e.layer){var n=e.layer.map.getLayer("WFSQueryResultsHighlight");n?t(n,e):e.layer.map.addLayer({id:"WFSQueryResultsHighlight",type:TC.Consts.layerType.VECTOR,owner:self,stealth:!0,styles:h()},function(n){t(n,e)})}};e.render=function(e){const t=this;return t._set1stRenderPromise(Promise.all([TC.Control.prototype.render.call(t,e),t.getRenderedHtml(t.CLASS+"-share-dialog",{},function(e){t._dialogDiv.innerHTML=e})]))};e.register=function(e){const l=this;return new Promise(function(o,a){e.on(TC.Consts.event.LAYERERROR,e=>{if(e.layer===l.resultsLayer){l.modalDialog&&l.modalDialog.getElementsByClassName("tc-modal-body")[0].classList.remove(t);if(e.reason===TC.Consts.WFSErrors.MAX_NUM_FEATURES)x(g("query.msgTooManyResults",{limit:e.data.limit}),TC.Consts.msgType.WARNING);else{console.error(e.reason);x(g("query.errorUndefined"),TC.Consts.msgType.ERROR)}}});TC.Control.prototype.register.call(l,e).then(function(l){var r=l;TC._hbs&&!TC._hbs.helpers.formatNumber&&TC._hbs.registerHelper("formatNumber",function(e){return e.toLocaleString(i)});y=function(){var e=function(e,t){return this.options.styles&&this.options.styles[e]&&this.options.styles[e][t]||TC.Cfg.styles[e][t]};return{polygon:{fillColor:e.bind(r,"polygon","fillColor"),fillOpacity:e.bind(r,"polygon","fillOpacity"),strokeColor:e.bind(r,"polygon","strokeColor"),strokeOpacity:e.bind(r,"polygon","strokeOpacity"),strokeWidth:e.bind(r,"polygon","strokeWidth")},line:{strokeColor:e.bind(r,"line","strokeColor"),strokeOpacity:e.bind(r,"line","strokeOpacity"),strokeWidth:e.bind(r,"line","strokeWidth")},point:{radius:e.bind(r,"point","radius"),height:e.bind(r,"point","height"),width:e.bind(r,"point","width"),fillColor:e.bind(r,"point","fillColor"),fillOpacity:e.bind(r,"point","fillOpacity"),strokeColor:e.bind(r,"point","strokeColor"),strokeWidth:e.bind(r,"point","strokeWidth"),fontSize:e.bind(r,"point","fontSize"),fontColor:e.bind(r,"point","fontColor"),labelOutlineColor:e.bind(r,"point","labelOutlineColor"),labelOutlineWidth:e.bind(r,"point","labelOutlineWidth"),label:e.bind(r,"point","label"),angle:e.bind(r,"point","angle")}}};h=function(){var e={polygon:TC.Util.extend(!0,{},TC.Cfg.styles.polygon,{fillColor:"#0099FF",fillOpacity:1,strokeColor:"#0099FF",strokeWidth:2}),line:TC.Util.extend(!0,{},TC.Cfg.styles.line,{strokeColor:"#0099FF",strokeWidth:2}),point:TC.Util.extend(!0,{},TC.Cfg.styles.point,{strokeColor:"#0099FF"})};return r.highlightStyles?{polygon:TC.Util.extend(!0,{},e.polygon,r.highlightStyles.polygon?r.highlightStyles.polygon:{}),line:TC.Util.extend(!0,{},e.line,r.highlightStyles.line?r.highlightStyles.line:{}),point:TC.Util.extend(!0,{},e.point,r.highlightStyles.point?r.highlightStyles.point:{})}:e};i=e.options.locale;g=function(e,t){return TC.Util.getLocaleString(i,e,t)};e.ready(function(){e.getControlsByClass("TC.control.WorkLayerManager").forEach(function(l){l.addLayerTool({renderFn:function(l,o){const a=r.CLASS+"-btn-open";let i=l.querySelector("button."+a);if(!i){const s=e.getLayer(o);if(s.type===TC.Consts.layerType.WMS||s.type===TC.Consts.layerType.WFS){const e=r.getLocaleString("query.tooltipMagnifBtn");(i=document.createElement("button")).innerHTML=e;i.setAttribute("title",e);i.classList.add(a);i.dataset.layerId=o;l.appendChild(i);if(s.type===TC.Consts.layerType.WMS){i.classList.add(t);s.getWFSCapabilities().then(e=>{if(e.Operations.GetFeature){var t=s.getDisgregatedLayerNames?s.getDisgregatedLayerNames():s.featureType;(t=t.filter(function(t){return e.FeatureTypes.hasOwnProperty(t.substring(t.indexOf(":")+1))})).length||i.classList.add(n)}else i.classList.add(n)}).catch(()=>i.classList.add(n)).finally(()=>i.classList.remove(t))}}}return i},updateEvents:[],actionFn:function(){if(this.classList.contains("tc-unavailable")||this.classList.contains("tc-loading"))return;const e=r.map.getLayer(this.dataset.layerId);r.renderModalDialog(e)}})})});r.getShareDialog().then(function(){o(r)}).catch(function(e){a(e instanceof Error?e:Error(e))})})})};const I=function(e){const n=e.layer.owner;if(n&&e.layer==n.resultsLayer){if(e.newData&&0===e.newData.totalFeatures){n.modalDialog.getElementsByClassName("tc-modal-body")[0].classList.remove(t);x(g("query.msgNoResults"),TC.Consts.msgType.INFO);return}var l=e.layer.features;if(l.length>0){if(n.toShare&&n.toShare.doZoom){n._setQueryToSearch({doZoom:!1});n.map.zoomToFeatures(l)}const e="h3_"+n.getLocaleString("service"),t="h4_"+n.getLocaleString("layer"),a=n.map.getControlsByClass(TC.control.Click).some(e=>e.TITLE_SEPARATOR)?n.map.getControlsByClass(TC.control.Click).find(e=>e.TITLE_SEPARATOR).TITLE_SEPARATOR:" \u2022 ";for(var o=0;o<l.length;o++){const n=u.getPath(d).slice(1);if(n){const r={};r[e]=u.title;r[t]=n.join(a);const i=TC.Util.extend(r,l[o].getData());l[o].clearData();l[o].setData(i)}}n.showResultsPanel(l.length>1?l.reduce(function(e,t,n){return(e instanceof Array?e:[e.data]).concat([t.data])}):[l[0].data],p)}e.layer.map.off(TC.Consts.event.LAYERUPDATE,I)}},j=function(e){const t=e.layer.owner;t&&e.layer==t.resultsLayer&&e.query&&t._setQueryToSearch({filter:e.query})};e._sendQuery=async function(e){const t=this;if(u&&d&&p&&e){var n=await u.getWFSURL();await k.apply(t,[p]);u.toolProxification.cacheHost.getAction(n).then(function(l){const o=l.action(n);if(t.resultsLayer&&t.resultsLayer.url!==o){t.map.removeLayer(t.resultsLayer);t.resultsLayer=null}if(t.resultsLayer){t.map.off(TC.Consts.event.BEFOREAPPLYQUERY,j);t.map.on(TC.Consts.event.BEFOREAPPLYQUERY,j);t.resultsLayer.setVisibility(!1);t.resultsLayer.clearFeatures();t.map.off(TC.Consts.event.LAYERUPDATE,I);t.map.on(TC.Consts.event.LAYERUPDATE,I);t.resultsLayer.url=o;t.resultsLayer.featurePrefix=d.substring(0,d.indexOf(":"));t.resultsLayer.featureType=d.substring(d.indexOf(":")+1);t.resultsLayer.properties=e;t.resultsLayer.setVisibility(!0);t.resultsLayer.refresh()}else{t.map.on(TC.Consts.event.BEFOREAPPLYQUERY,j);t.map.addLayer({id:"WFSQueryResults",type:TC.Consts.layerType.WFS,url:o,owner:t,stealth:!0,geometryName:"the_geom",featurePrefix:d.substring(0,d.indexOf(":")),featureType:d.substring(d.indexOf(":")+1),properties:e,outputFormat:TC.Consts.format.JSON,styles:y()}).then(function(e){t.resultsLayer=e;e.map.on(TC.Consts.event.LAYERUPDATE,I)});t.map.on(TC.Consts.event.RESULTSPANELCLOSE,function(e){if(e.control===t.resultsPanel){TC.browserFeatures.touch()&&TC.Util.swipe(e.control.div,"enable");t.resultsLayer.clearFeatures();t.resultsLayer.setVisibility(!1);t.clearFilters();t.map.off(TC.Consts.event.LAYERUPDATE,I);t.map.off(TC.Consts.event.BEFOREAPPLYQUERY,j);delete t.toShare}})}})}};e.sendQuery=async function(){const e=this;if(!e.validateQuery()){x(g("query.msgNoQueryFilter"));return}e.modalDialog.getElementsByClassName("tc-modal-body")[0].classList.add(t);let n;if(e.filters.length>1){const t=e.modalDialog.querySelector(".tc-ctl-wfsquery-logOpRadio:checked").value;n=TC.filter[TC.Consts.logicalOperator[t]].apply(null,e.filters)}else n=e.filters[0];e._sendQuery.call(e,n)};e._setQueryToSearch=function(e){const t=this;1===Object.keys(e).length&&e.hasOwnProperty("doZoom")?t.toShare=TC.Util.extend(t.toShare,{doZoom:e.doZoom}):(e.filter||t.resultsLayer&&t.resultsLayer.properties instanceof TC.filter.Filter)&&(t.toShare=TC.Util.extend(t.toShare,{wms:{url:u.url,names:u.names},title:p,name:d,filter:e.filter?e.filter:t.resultsLayer.properties.getText(),doZoom:!e.hasOwnProperty("doZoom")||e.doZoom}))};e._getQueryToSearch=function(){return this.toShare};e.exportState=function(){const e=this;return e.toShare?{id:e.id,queryResult:JSON.stringify(e.toShare)}:null};e.importState=function(e){const t=this;if(e.queryResult){let n=t.map.getLoadingIndicator().addWait();t.map.loaded(function(){let l=JSON.parse(e.queryResult);if(l.wms&&l.filter){let e=t.map.workLayers.filter(e=>e.url&&e.url===l.wms.url&&e.names.join()===l.wms.names.join());if(e.length>0){u=e[0];d=l.name;p=l.title;t._setQueryToSearch({doZoom:l.doZoom});u.describeFeatureType(d).then(function(e){D(e,t,!1);t._sendQuery(l.filter);t._setQueryToSearch({filter:l.filter,doZoom:l.doZoom});t.map.getLoadingIndicator().removeWait(n)})}}else alert("shared query error")})}};e.validateQuery=function(){return this.filters.length>0};e.showResultsPanel=function(e,t){const n=this;n.resultsPanel.div.querySelector(".prpanel-title-text").innerText=n.resultsPanel.getLocaleString(e.length>1?"query.titleResultPaneMany":"query.titleResultPanelOne",{numero:e.length,layerName:t});n.resultsPanel.div.classList.add("tc-ctl-wfsquery-results");n.modalDialog&&n.modalDialog.parentElement.removeChild(n.modalDialog);const l=_internalGetDataTypes();n.resultsPanel.openTable({data:e,css:{trClass:"trClass",tdClass:"tdClass",thClass:"thClass"},sort:!0,callback:function(t){n.resultsPanel.maximize();console.log("render del panel de resultados");var o=t.querySelectorAll(".table>tbody>tr"),a=1;for(var r in e[0])if(l.hasOwnProperty(r)){if(l[r].type&&!(l[r].type instanceof Object)&&(l[r].type.indexOf("int")>=0||l[r].type.indexOf("float")>=0||l[r].type.indexOf("double")>=0||l[r].type.indexOf("long")>=0||l[r].type.indexOf("decimal")>=0))for(var i=t.querySelectorAll("td:nth-child("+a+")"),s=0;s<i.length;s++)i[s].classList.add("tc-numeric");l[r].type&&l[r].type instanceof Object&&console.log("aki lo que sea");a++}for(r=0;r<o.length;r++){o[r].addEventListener("click",function(e){e.stopPropagation();var t=this.dataset.index;null!=t&&n.resultsLayer.map.zoomToFeatures([n.resultsLayer.features[t]])});o[r].addEventListener("mouseenter",function(){var e=this.dataset.index;if(null!=e){var t=n.resultsLayer.features[e];t&&t.geometry&&A(t);var l=this.querySelectorAll("td.value div");l.length>0?l.forEach(function(e){e.offsetWidth<e.scrollWidth&&(e.title=e.innerText)}):this.querySelectorAll("td").forEach(function(e){e.offsetWidth<e.scrollWidth&&(e.title=e.innerText)})}});o[r].addEventListener("mouseleave",function(){var e=this.dataset.index;if(null!=e){var t,l=n.resultsLayer.features[e];l&&l.geometry&&(t=l.layer.map.getLayer("WFSQueryResultsHighlight"))&&t.clearFeatures()}})}t.querySelectorAll(".complexAttr label,.complexAttr input").forEach(function(e){e.addEventListener("click",function(e){e.stopPropagation()})});t.querySelectorAll(".complexAttr input").forEach(function(e){e.addEventListener("change",function(e){this.checked&&this.nextElementSibling.querySelectorAll("td.value div").forEach(function(e){e.offsetWidth<e.scrollWidth&&(e.title=e.innerText)})})});TC.control.FeatureInfoCommons.addSpecialAttributeEventListeners(t);t.querySelectorAll("td > img, td > video, td > audio, td > iframe").forEach(e=>{e.parentNode.classList.add("tc-multimedia")});t.querySelectorAll("video").forEach(e=>{e.addEventListener(TC.Consts.event.CLICK,function(e){e.stopPropagation()},{passive:!0})});TC.browserFeatures.touch()&&TC.Util.swipe(n.resultsPanel.div,"disable")}})};e.showGeometryPanel=async function(e){const t=this;TC.Util.closeModal();if(t.geometryPanel)t.geometryPanel.open();else{const e={titles:{main:t.getLocaleString("query.spatialFilter")}},n=t.map.getControlsByClass(TC.control.ControlContainer)[0];if(n){e.position=n.POSITION.RIGHT;t.geometryPanel=await n.addControl("resultsPanel",e)}else t.geometryPanel=await t.map.addControl("resultsPanel",e);t.map.on(TC.Consts.event.RESULTSPANELCLOSE,function(e){if(e.control===t.geometryPanel){setTimeout(()=>t.drawControl.cancel(),500);TC.Util.showModal(t.modalDialog,{closeCallback:()=>t.clearFilters()})}});const l=await t.getRenderedHtml(t.CLASS+"-geom");t.geometryPanel.open(l);t.geometryPanel.div.querySelector(`.${t.CLASS}-geom-btn-ok`).addEventListener(TC.Consts.event.CLICK,function(){t.geometryPanel.close()},{passive:!0});if(!t.drawControl){t.drawControl=await t.map.addControl("draw",{div:t.geometryPanel.getTableContainer().querySelector(`.${t.CLASS}-geom-draw`),styles:t.styles});t.drawControl.on(TC.Consts.event.DRAWEND,function(e){e.feature.showsPopup=!1;t.geometryPanel.close();const n=t.modalDialog.querySelector(`input[name="${t.id}-condition"]:checked`).value;let l;switch(n){case"intersects":l=new TC.filter.Intersects(null,e.feature,t.map.crs);break;default:l=new TC.filter.Within(null,e.feature,t.map.crs)}l._abbr=n;switch(e.target.mode){case"polygon":l._valueToShow=t.getLocaleString("polygon");break;case"line":l._valueToShow=t.getLocaleString("line");break;case"rectangle":l._valueToShow=t.getLocaleString("box")}t.filters.push(l);S(t);TC.Util.showModal(t.modalDialog,{closeCallback:()=>t.clearFilters()})})}}t.geometryPanel.div.querySelector(`.${t.CLASS}-geom-draw`).classList.toggle(TC.Consts.classes.HIDDEN,!e);t.geometryPanel.div.querySelector(`.${t.CLASS}-geom-btn`).classList.toggle(TC.Consts.classes.HIDDEN,!!e);e&&t.drawControl.setMode(e,!0)};const D=function(n,o,a){let r=Object.entries(n);r=r.length>1?n:r[0][1];_internalGetDataTypes=function(){return n};for(var u in n){const e=n[u];TC.Util.isGeometry(e.type)&&(e.isGeometry=!0)}if(a){o.clearFilters();e.getRenderedHtml(e.CLASS+"-form",{operators:c,attributes:n,controlId:o.id},function(a){const r=o.modalDialog,u=o.getForm();s(u);u.insertAdjacentHTML("beforeend",a);l.classList.remove(t);TC.loadJS(!0,[TC.apiLocation+"TC/ui/autocomplete.js"],function(){console.log("autocomplete loaded")});var d=u.getElementsByClassName("tc-combo");if(0==d.length)r.getElementsByClassName("tc-button tc-ctl-wlm-btn-launch")[0].setAttribute("disabled","");else{r.getElementsByClassName("tc-button tc-ctl-wlm-btn-launch")[0].removeAttribute("disabled");d[0].addEventListener("change",function(){L.apply(this,[u,n])});u.querySelectorAll(`input[name="${o.id}-condition"]`).forEach(t=>{t.addEventListener("change",async function(t){u.querySelector(`.${e.CLASS}-geomtype-line-btn`).disabled="within"===t.target.value;const n=l.querySelector(".tc-ctl-wfsquery-value input");n.disabled=!1;if(this.parentElement.classList.contains("tc-ctl-wfsquery-text")&&"empty"===this.value){n.value="";n.disabled=!0;TC.UI.autocomplete.call(n,"clear")}if(this.parentElement.classList.contains("tc-ctl-wfsquery-date")&&"null"===this.value){n.value="";n.disabled=!0}if(""!=n.value.trim()&&this.parentElement.classList.contains("tc-ctl-wfsquery-text")&&"empty"!==this.value){(t=document.createEvent("HTMLEvents")).initEvent("keyup",!1,!0);n.dispatchEvent(t)}})});u.querySelectorAll(`.tc-ctl-wfsquery-where input[type="radio"][name="${o.id}-log-op"]`).forEach(e=>e.addEventListener("change",function(){"OR"===this.value?TC.Consts.logicalOperator.OR:TC.Consts.logicalOperator.AND}));u.querySelector(".tc-button").addEventListener(TC.Consts.event.CLICK,function(){var e=u.querySelector("input.tc-textbox");TC.UI.autocomplete.call(e,"clear");T&&T.masked.remove();if(!function(e){var t,n=e.querySelector('.tc-ctl-wfsquery input[type="radio"]:checked');if(C&&!C.masked.isComplete){!1===/^(?=\d)(?:(?:31(?!.(?:0?[2469]|11))|(?:30|29)(?!.0?2)|29(?=.0?2.(?:(?:(?:1[6-9]|[2-9]\d)?(?:0[48]|[2468][048]|[13579][26])|(?:(?:16|[2468][048]|[3579][26])00)))(?:\x20|$))|(?:2[0-8]|1\d|0?[1-9]))([-.\/])(?:1[012]|0?[1-9])\1(?:1[6-9]|[2-9]\d)?\d\d(?:(?=\x20\d)\x20|$))?(((0?[1-9]|1[012])(:[0-5]\d){0,2}(\x20[AP]M))|([01]\d|2[0-3])(:[0-5]\d){1,2})?$/.test(str)&&x("Fecha "+str+" inv\xe1lida",TC.Consts.msgType.ERROR);return!1}if(0==n.length){x(g("query.msgNoCondition"));return!1}if(e.querySelectorAll("input[type='date']").length&&!e.querySelector("input[type='date']").checkValidity()){x(g("query.msgNoValidDate"));return!1}if(e.querySelectorAll("input[type='number']").length&&null!=(t=e.querySelector("input[type='number']"))&&!t.checkValidity()){"1"===t.step?x(g("query.msgNoValidNumberMustInt")):x(g("query.msgNoValidNumber"));return!1}if(""===e.querySelector("input.tc-textbox").value.trim()&&"empty"!==n.value&&"null"!==n.value){x(g("query.msgNoValueCondition"));return!1}return!0}(u))return;var t=[].reduce.call(u.querySelectorAll(".tc-combo"),function(e,t){return e+(e?"/":"")+t.value},"");var n,l=u.querySelector('.tc-ctl-wfsquery input[type="radio"]:checked').value,a=(n=e,T?T.unmaskedValue:C?C.unmaskedValue.substring(4)+"-"+C.unmaskedValue.substring(2,4)+"-"+C.unmaskedValue.substring(0,2):n.value);let r=function(e){if(T)return T.value;if(C)return C.value;if("date"===e.type)return new Date(e.value).toLocaleDateString(i,{timeZone:"UTC"});if("number"===e.type){var t=1.1.toLocaleString(i).substring(1,2);return e.value.replace(".",t)}return e.value}(e);switch(!0){case v.indexOf("int")>=0:r=parseInt(a,10);break;case v.indexOf("float")>=0:case v.indexOf("double")>=0:case v.indexOf("long")>=0:case v.indexOf("decimal")>=0:r=parseFloat(a,10);break;case v.indexOf("string")>=0&&"empty"!==l:r='"'+r+'"';break;case v.indexOf("date")>=0&&"null"===l:r=""}var s;if(v.indexOf("dateTime")>=0||v.indexOf("date")>=0)if(a){const e=new Date(a+"T00:00:00").toISOString(),n=new Date(a+"T23:59:59").toISOString();s="nbtw"===l?new TC.filter.not(TC.filter.between(t,e,n)):new c[l].Ctor(t,e,n)}else s=new c[l].Ctor(t);else s=new c[l].Ctor(t,("ends"===l||"contains"===l?"*":"")+a+("starts"===l||"contains"===l?"*":""));s.matchCase=!1;s._abbr=l;s._valueToShow=r;o.filters.push(s);S(o);e.value=""},{passive:!0});const t=function(e){o.showGeometryPanel(e.target.value)};u.querySelectorAll("button[name='geometry']").forEach(e=>e.addEventListener(TC.Consts.event.CLICK,t,{passive:!0}))}})}},R=function(e){const o=e[0],a=e[1],r=e[2],i=e[3];o.modalDialog=r;u=a;m=i;f=i.Operations.DescribeFeatureType.DCP.HTTP.Get.href;new URL(f).host===document.location.host&&(f=f.substring(f.indexOf(":")+1));i.Operations.GetFeature.CountDefault?_maxRecordCount=i.Operations.GetFeature.CountDefault.DefaultValue:_maxRecordCount=null;var c=a.getDisgregatedLayerNames?a.getDisgregatedLayerNames():a.featureType;if((c=c.filter(function(e){return i.FeatureTypes.hasOwnProperty(e.substring(e.indexOf(":")+1))})).length>1){l.classList.remove(t);r.getElementsByClassName("tc-combo")[0].addEventListener("change",function(){if(this.value){r.querySelector(".tc-modal-body .tc-ctl-wfsquery-message",r).classList.add(n);p=this.options[this.selectedIndex].text;l.classList.add(t);d=this.value;u.describeFeatureType(this.value).then(function(e){D(e,o,!0)},function(e){var n=r.getElementsByClassName("tc-modal-body")[0];n.classList.remove(t);e?n.insertAdjacentHTML("beforeend",'<div class="tc-ctl-wfsquery-message tc-msg-error">'+e+"</div>"):n.insertAdjacentHTML("beforeend",'<div class="tc-ctl-wfsquery-message tc-msg-warning">'+g("query.LayerNotAvailable")+"</div>")})}else{var e=o.getForm();s(e);for(var a=0;a<e.children.length;a++)e.removeChild(e.children[a]);o.clearFilters()}})}else if(1===c.length){if(i.FeatureTypes[c[0].substring(c[0].indexOf(":")+1)]){p=i.FeatureTypes[c[0].substring(c[0].indexOf(":")+1)].Title;d=c[0];u.describeFeatureType(c[0]).then(function(e){D(e,o,!0)},function(e){var n=r.getElementsByClassName("tc-modal-body")[0];n.classList.remove(t);e?n.insertAdjacentHTML("beforeend",'<div class="tc-ctl-wfsquery-message tc-msg-error">'+e+"</div>"):n.insertAdjacentHTML("beforeend",'<div class="tc-ctl-wfsquery-message tc-msg-warning">'+g("query.LayerNotAvailable")+"</div>")})}else{var y=r.getElementsByClassName("tc-modal-body")[0];y.classList.remove(t);y.insertAdjacentHTML("beforeend",'<div class="tc-ctl-wfsquery-message tc-msg-warning">'+g("query.LayerNotAvailable")+"</div>")}}else{TC.Util.closeModal();a.map.toast(TC.Util.getLocaleString(a.map.options.locale,"query.LayerNotAvailable"),{type:TC.Consts.msgType.ERROR})}};e.renderModalDialog=function(e){const n=this;let o,a;if(e.type===TC.Consts.layerType.WMS){const t=e.getPath();o=t[t.length-1];a=e.getWFSCapabilities()}else{if(e.type!==TC.Consts.layerType.WFS)return;o=e.title;a=e.getCapabilitiesPromise()}let r=new Promise(function(r,i){a.then(function(a){(function(e,n,o,a){const r=this;let i;if(e.getDisgregatedLayerNames){i=[];e.getDisgregatedLayerNames().forEach(function(t,n){var l=e.getPath(t);o.FeatureTypes.hasOwnProperty(t.substring(t.indexOf(":")+1))&&i.push({name:t,title:l[l.length-1]})});i.sort(function(e,t){return e.title<t.title?-1:e.title>t.title?1:0})}else i=e.featureType;r.getRenderedHtml(r.CLASS+"-dialog",{layerName:g("query.titleDialog",{layerName:n}),layers:i},function(e){document.body.querySelectorAll(`.${r.CLASS}-dialog`).forEach(e=>e.remove());var n=document.createElement("div");n.insertAdjacentHTML("beforeEnd",e);var o=null;if(n.childNodes.length>0){o=n.firstChild;document.body.appendChild(o)}(l=o.getElementsByClassName("tc-modal-body")[0]).classList.add(t);TC.Util.showModal(o,{closeCallback:()=>r.clearFilters()});if(TC.Util.detectIE()){var i=1;switch(!0){case document.body.clientWidth>768&&document.body.clientWidth<document.body.clientHeight:case document.body.clientWidth>1024:i=.8;case document.body.clientWidth>1140:i=.7}l.style.maxHeight=document.body.clientHeight*i-l.nextElementSibling.clientHeight-l.previousElementSibling.clientHeight}r.modalDialog=o;o.getElementsByClassName("tc-button tc-ctl-wlm-btn-launch")[0].addEventListener("click",function(){r.sendQuery()});a&&a(o)})}).apply(n,[e,o,a,function(e){r(e)}])})});Promise.all([n,e,r,a]).then(R)};e.removeFilter=function(e){const t=this;let n=e;e instanceof TC.filter.Filter&&(n=t.filters.indexOf(e));if(n>=0&&n<t.filters.length){const e=t.filters.splice(n,1)[0];e instanceof TC.filter.Spatial&&e.geometry.layer.removeFeature(e.geometry);S(t)}};e.clearFilters=function(){this.filters.filter(e=>e instanceof TC.filter.Spatial).forEach(e=>e.geometry.layer.removeFeature(e.geometry));this.filters.length=0};e.getForm=function(){return this.modalDialog&&this.modalDialog.querySelector(".tc-modal-form")}}();
//# sourceMappingURL=../maps/control/WFSQuery.min.js.map