TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.Consts.event.DRAWCHART="drawchart.tc";TC.Consts.event.DRAWTABLE="drawtable.tc";TC.Consts.event.RESULTSPANELMIN="resultspanelmin.tc";TC.Consts.event.RESULTSPANELMAX="resultspanelmax.tc";TC.Consts.event.RESULTSPANELCLOSE="resultspanelclose.tc";TC.control.ResultsPanel=function(){TC.Control.apply(this,arguments);this.wrap=new TC.wrap.control.ResultsPanel(this);this.data={};this.classes={FA:"fa",SHOW_IN:"showIn",SHOW_OUT:"showOut"};this.content=this.contentType.TABLE;TC.Util.isEmptyObject(this.options)&&(this.options={content:"table"});this.options;this.options.content&&(this.content=this.contentType[this.options.content.toUpperCase()]);this.options.chart&&(this.chart=this.options.chart);this.options.table&&(this.table=this.options.table);this.options.save&&(this.save=this.options.save)};TC.inherit(TC.control.ResultsPanel,TC.Control);!function(){const ctlProto=TC.control.ResultsPanel.prototype;ctlProto.CLASS="tc-ctl-p-results";ctlProto.CHART_SIZE={MIN_HEIGHT:75,MAX_HEIGHT:128,MIN_WIDTH:215,MEDIUM_WIDTH:310,MAX_WIDTH:445};ctlProto.template={};ctlProto.template[ctlProto.CLASS]={compiler:[8,">= 4.3.0"],main:function(t,e,n,l,o){var i=null!=e?e:t.nullContext||{},a=t.escapeExpression,s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<div class="prpanel-group prsidebar-body " style="display: none" data-no-cb>\r\n    <div class="prpanel prpanel-default">\r\n        <div class="prpanel-heading">\r\n            <h4 class="prpanel-title">\r\n                <span class="prpanel-title-text"></span>\r\n                <span class="prcollapsed-pull-right prcollapsed-slide-submenu prcollapsed-slide-submenu-close" title="'+a(s(n,"i18n").call(i,"close",{name:"i18n",hash:{},data:o,loc:{start:{line:6,column:118},end:{line:6,column:134}}}))+'">\r\n                    <i class="fa fa-times"></i>\r\n                </span>\r\n                <span class="prcollapsed-pull-right prcollapsed-slide-submenu prcollapsed-slide-submenu-min" title="'+a(s(n,"i18n").call(i,"hide",{name:"i18n",hash:{},data:o,loc:{start:{line:9,column:116},end:{line:9,column:131}}}))+'">\r\n                    <i class="fa fa-chevron-left"></i>\r\n                </span>\r\n                <span class="prcollapsed-pull-right prcollapsed-slide-submenu prcollapsed-slide-submenu-csv" hidden title="'+a(s(n,"i18n").call(i,"export.excel",{name:"i18n",hash:{},data:o,loc:{start:{line:12,column:123},end:{line:12,column:146}}}))+'">\r\n                    <i class="fa fa-file-excel-o"></i>\r\n                </span>\r\n                <span class="prcollapsed-pull-right prcollapsed-slide-submenu prcollapsed-slide-submenu-dwn" hidden title="'+a(s(n,"i18n").call(i,"download",{name:"i18n",hash:{},data:o,loc:{start:{line:15,column:123},end:{line:15,column:142}}}))+'">\r\n                    <i class="fa fa-download"></i>\r\n                </span>\r\n            </h4>\r\n        </div>\r\n        <div id="results" class="prpanel-collapse collapse in">\r\n            <div class="tc-ctl-p-results-menu"></div>\r\n            <div class="prpanel-body list-group tc-ctl-p-results-info"></div>\r\n            <div class="prpanel-body list-group tc-ctl-p-results-table"></div>\r\n            <div class="prpanel-body list-group tc-ctl-p-results-chart"></div>\r\n        </div>\r\n    </div>\r\n</div>\r\n<div class="prcollapsed prcollapsed-max prcollapsed-pull-left" style="display: none;" title="'+a(s(n,"i18n").call(i,"expand",{name:"i18n",hash:{},data:o,loc:{start:{line:28,column:93},end:{line:28,column:110}}}))+'" data-no-cb>\r\n    <i class="fa-list-alt" hidden></i>\r\n    <i class="fa-area-chart" hidden></i>\r\n</div>'},useData:!0};ctlProto.template[ctlProto.CLASS+"-table"]={1:function(t,e,n,l,o,i,a){var s,r=t.lambda,c=t.escapeExpression,d=null!=e?e:t.nullContext||{},u=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"    <h4>"+c(r(null!=e?u(e,"tableTitle"):e,e))+'</h4>\r\n    <table class="table">            \r\n        <tbody>\r\n            <tr class="'+c(r(null!=(s=null!=e?u(e,"css"):e)?u(s,"trClass"):s,e))+'">\r\n'+(null!=(s=u(n,"each").call(d,null!=e?u(e,"columns"):e,{name:"each",hash:{},fn:t.program(2,o,0,i,a),inverse:t.noop,data:o,loc:{start:{line:7,column:16},end:{line:9,column:25}}}))?s:"")+"             </tr>\r\n"+(null!=(s=u(n,"each").call(d,null!=e?u(e,"results"):e,{name:"each",hash:{},fn:t.program(4,o,0,i,a),inverse:t.noop,data:o,loc:{start:{line:11,column:12},end:{line:16,column:21}}}))?s:"")+"        </tbody>\r\n    </table>\r\n"},2:function(t,e,n,l,o,i,a){var s,r=t.lambda,c=t.escapeExpression,d=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'                    <th class="'+c(r(null!=(s=null!=a[1]?d(a[1],"css"):a[1])?d(s,"thClass"):s,e))+'" title="'+c(r(e,e))+'">'+c(r(e,e))+"</th>\r\n"},4:function(t,e,n,l,o,i,a){var s,r=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'                <tr class="'+t.escapeExpression(t.lambda(null!=(s=null!=a[1]?r(a[1],"css"):a[1])?r(s,"trClass"):s,e))+'">\r\n'+(null!=(s=r(n,"each").call(null!=e?e:t.nullContext||{},e,{name:"each",hash:{},fn:t.program(5,o,0,i,a),inverse:t.noop,data:o,loc:{start:{line:13,column:16},end:{line:15,column:25}}}))?s:"")},5:function(t,e,n,l,o,i,a){var s,r=t.lambda,c=t.escapeExpression,d=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'                    <td class="'+c(r(null!=(s=null!=a[2]?d(a[2],"css"):a[2])?d(s,"tdClass"):s,e))+'" title="'+c(r(e,e))+'">'+c(r(e,e))+"</td>\r\n"},compiler:[8,">= 4.3.0"],main:function(t,e,n,l,o,i,a){var s,r=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"\r\n"+(null!=(s=r(n,"if").call(null!=e?e:t.nullContext||{},null!=e?r(e,"results"):e,{name:"if",hash:{},fn:t.program(1,o,0,i,a),inverse:t.noop,data:o,loc:{start:{line:2,column:0},end:{line:19,column:7}}}))?s:"")},useData:!0,useDepths:!0};ctlProto.template[ctlProto.CLASS+"-chart"]={1:function(t,e,n,l,o){var i=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"    "+t.escapeExpression(t.lambda(null!=e?i(e,"msg"):e,e))+"\r\n"},3:function(t,e,n,l,o){var i,a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return(null!=(i=a(n,"if").call(null!=e?e:t.nullContext||{},null!=e?a(e,"secondChart"):e,{name:"if",hash:{},fn:t.program(4,o,0),inverse:t.program(6,o,0),data:o,loc:{start:{line:5,column:4},end:{line:38,column:15}}}))?i:"")+'        <div class="tc-chart"></div>\r\n'},4:function(t,e,n,l,o){var i,a=t.lambda,s=t.escapeExpression,r=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'    <div class="tc-track-chart-elevation-minmax">\r\n        <div class="tc-track-chart-minmax">\r\n            <span>\r\n                Min,Max:&nbsp;\r\n            </span>\r\n            <div>\r\n                <span>\r\n                    '+s(a(null!=e?r(e,"min"):e,e))+", "+s(a(null!=e?r(e,"max"):e,e))+"\r\n                </span>\r\n                <span>\r\n                    "+s(a(null!=(i=null!=e?r(e,"secondChart"):e)?r(i,"min"):i,e))+", "+s(a(null!=(i=null!=e?r(e,"secondChart"):e)?r(i,"max"):i,e))+'&nbsp;\r\n                </span>\r\n            </div>\r\n        </div>\r\n        <div class="tc-track-chart-elevationGain">\r\n            <span>\r\n                '+s(r(n,"i18n").call(null!=e?e:t.nullContext||{},"geo.trk.chart.elevationGain",{name:"i18n",hash:{},data:o,loc:{start:{line:22,column:16},end:{line:22,column:54}}}))+":&nbsp;\r\n            </span>\r\n            <div>\r\n                <span>\r\n                    +"+s(a(null!=e?r(e,"upHill"):e,e))+" m, -"+s(a(null!=e?r(e,"downHill"):e,e))+" m\r\n                </span>\r\n                <span>\r\n                    +"+s(a(null!=(i=null!=e?r(e,"secondChart"):e)?r(i,"upHill"):i,e))+" m, -"+s(a(null!=(i=null!=e?r(e,"secondChart"):e)?r(i,"downHill"):i,e))+" m\r\n                </span>\r\n            </div>\r\n        </div>\r\n    </div>\r\n"},6:function(t,e,n,l,o){var i=t.escapeExpression,a=t.lambda,s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'        <span class="tc-track-chart-elevationGain">\r\n            '+i(s(n,"i18n").call(null!=e?e:t.nullContext||{},"geo.trk.chart.elevationGain",{name:"i18n",hash:{},data:o,loc:{start:{line:36,column:12},end:{line:36,column:50}}}))+": +"+i(a(null!=e?s(e,"upHill"):e,e))+" m, -"+i(a(null!=e?s(e,"downHill"):e,e))+" m\r\n        </span>\r\n"},compiler:[8,">= 4.3.0"],main:function(t,e,n,l,o){var i,a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<div class="tc-track-chart">\r\n'+(null!=(i=a(n,"if").call(null!=e?e:t.nullContext||{},null!=e?a(e,"msg"):e,{name:"if",hash:{},fn:t.program(1,o,0),inverse:t.program(3,o,0),data:o,loc:{start:{line:2,column:4},end:{line:40,column:15}}}))?i:"")+"    </div>\r\n"},useData:!0};const isElementVisible=function(t){const e=getComputedStyle(t);return t&&!t.hidden&&"none"!==e.display&&"hidden"!==e.visibility};ctlProto.isVisible=function(){const t=this.div.querySelector(".prsidebar-body"),e=this.div.querySelector(".prcollapsed-max");return isElementVisible(t)||isElementVisible(e)};ctlProto.isMinimized=function(){const t=this.div.querySelector(".prsidebar-body"),e=this.div.querySelector(".prcollapsed-max");return isElementVisible(e)&&!isElementVisible(t)};const manageClassList=function(t,e,n){const l=this.div.querySelector("."+t);if(l){l.classList.add(e);l.classList.remove(n)}};ctlProto.show=function(t){const e=this.div.querySelector("."+t);e&&"none"===e.style.display&&(e.style.display="");manageClassList.call(this,t,this.classes.SHOW_IN,this.classes.SHOW_OUT)};ctlProto.hide=function(t){manageClassList.call(this,t,this.classes.SHOW_OUT,this.classes.SHOW_IN);const e=this.div.querySelector("."+t);e&&(e.style.display="none")};ctlProto.doVisible=function(){this.div.classList.remove(TC.Consts.classes.HIDDEN);this.show("prsidebar-body")};ctlProto.render=function(t){const e=this;e.div.classList.add(TC.Consts.classes.HIDDEN);return TC.Control.prototype.render.call(e,function(){e.mainTitleElm=e.div.querySelector(".prpanel-title-text");e.minimizeButton=e.div.querySelector(".prcollapsed-slide-submenu-min");e.minimizeButton.addEventListener("click",function(){e.minimize()});e.closeButton=e.div.querySelector(".prcollapsed-slide-submenu-close");e.closeButton.addEventListener("click",function(){e.close()});e.maximizeButton=e.div.querySelector(".prcollapsed-max");e.maximizeButton.addEventListener("click",function(){e.maximize()});if(e.save){e.saveButton=e.div.querySelector(".prcollapsed-slide-submenu-csv");e.saveButton.addEventListener("click",function(){e.exportToExcel()});e.saveButton.removeAttribute("hidden")}if(e.options.download&&"table"===e.options.content){e.downloadButton=e.div.querySelector(".prcollapsed-slide-submenu-dwn");e.downloadButton.addEventListener("click",function(){TC.Util.isFunction(e.options.download)&&e.options.download.apply(e,[])});e.downloadButton.removeAttribute("hidden")}if(e.content){e.content=e.content;if(e.options.titles){if(e.options.titles.main){e.mainTitleElm.setAttribute("title",e.options.titles.main);e.mainTitleElm.innerHTML=e.options.titles.main}e.options.titles.max&&e.maximizeButton.setAttribute("title",e.options.titles.max)}else{e.mainTitleElm.setAttribute("title",e.getLocaleString("rsp.title"));e.mainTitleElm.innerHTML=e.getLocaleString("rsp.title")}}e.div.querySelector(e.content.collapsedClass).classList.add(e.classes.FA);e.infoDiv=e.div.querySelector("."+e.CLASS+"-info");e.tableDiv=e.div.querySelector("."+e.CLASS+"-table");e.menuDiv=e.div.querySelector("."+e.CLASS+"-menu");TC.browserFeatures.touch()&&TC.Util.swipe(e.div,{left:function(){e.minimize()}});t&&"function"==typeof t&&t.call()})};ctlProto.minimize=function(){const t=this,e=t.div.querySelector(t.content.collapsedClass);if(!isElementVisible(e)){e.classList.add(t.classes.FA);e.hidden=!1;t.hide("prsidebar-body");t.show("prcollapsed-max");t.map.trigger(TC.Consts.event.RESULTSPANELMIN,{control:t})}};ctlProto.maximize=function(){const t=this,e=t.div.querySelector(t.content.collapsedClass);if(isElementVisible(e)){e.hidden=!0;t.show("prsidebar-body");t.hide("prcollapsed-max");t.map.trigger(TC.Consts.event.RESULTSPANELMAX,{control:t})}};ctlProto.close=function(){const t=this;t.div.classList.add(TC.Consts.classes.HIDDEN);t.chart&&t.chart.chart&&(t.chart.chart=t.chart.chart.destroy());const e=t.div.querySelector(".prsidebar-body");if(e){e.style.display="none";t.div.querySelector(".prcollapsed-max").style.display="none";const n=t.div.querySelector(t.content.collapsedClass);n.hidden=!0;n.classList.remove(t.classes.FA);t.map.trigger(TC.Consts.event.RESULTSPANELCLOSE,{control:t})}};ctlProto.openChart=function(t){const e=this;e.div.classList.remove(TC.Consts.classes.HIDDEN);e.map.getControlsByClass(TC.control.ResultsPanel).filter(function(t){return t!==e}).filter(function(t){return"chart"===t.options.content}).forEach(function(t){t.close()});if(t)if(t.msg){e.map.toast(t.msg);e.isVisible()&&e.hide("prsidebar-body")}else{e.elevationProfileChartData=t;e.renderElevationProfileChart({data:t,div:e.div.querySelector("."+ctlProto.CLASS+"-chart")})}else e.map.toast(options.msg)};const formatYAxis=function(t,e){return(parseInt(t.toFixed(0))||0).toLocaleString(e)+" m"};ctlProto.renderElevationProfileChart=function(options){const self=this;options=options||{};TC.loadJS(!window.c3,TC.Consts.url.D3C3||TC.apiLocation+"lib/d3c3/d3c3.min.js",function(){const data=options.data;data.ele=data.ele.map(t=>null===t?0:t);const div=options.div;let locale=TC.Util.getMapLocale(self.map);var templateData={upHill:data.upHill?data.upHill.toLocaleString(locale):"0",downHill:data.downHill?data.downHill.toLocaleString(locale):"0"};if(data.elevationFromServiceChartData){templateData.min=formatYAxis(data.min,locale);templateData.max=formatYAxis(data.max,locale);templateData.secondChart={upHill:data.elevationFromServiceChartData.upHill?data.elevationFromServiceChartData.upHill.toLocaleString(locale):"0",downHill:data.elevationFromServiceChartData.downHill?data.elevationFromServiceChartData.downHill.toLocaleString(locale):"0",min:formatYAxis(data.elevationFromServiceChartData.min,locale),max:formatYAxis(data.elevationFromServiceChartData.max,locale)}}self.getRenderedHtml(ctlProto.CLASS+"-chart",templateData,function(out){div.innerHTML=out;div.style.display="";if(self.options.titles){if(self.options.titles.main){const t=self.div.querySelector(".prpanel-title-text");t.setAttribute("title",self.options.titles.main);t.innerHTML=self.options.titles.main}self.options.titles.max&&self.div.querySelector(".prcollapsed-max").setAttribute("title",self.options.titles.max)}var legendOptions={show:!1};data.elevationFromServiceChartData&&(legendOptions={position:"inset",inset:{anchor:"bottom-left",x:-55,y:-30,step:1}});var chartOptions=TC.Util.extend({bindto:div.querySelector(".tc-chart"),padding:{top:13,right:15,bottom:0,left:45},legend:legendOptions},self.createChartOptions(data));self.chart.tooltip&&(chartOptions.tooltip={position:function(t,e,n,l){let o=document.querySelector(".c3-tooltip-container"),i=document.querySelector(".c3").getBoundingClientRect().left,a=document.querySelector(".c3 g.c3-axis-y").getBoundingClientRect().right,s=o.clientWidth,r=parseInt(l.getAttribute("x"))+a-i-Math.floor(s/2),c=document.querySelector(".c3 g.c3-axis-x").getBoundingClientRect().height+2,d=o.querySelector(".onBottom");d&&c&&(d.style.height=c+"px");return{top:0,left:r}},contents:function(d){var fn=self.chart.tooltip;"function"!=typeof fn&&(fn=TC.Util.getFnFromString(self.chart.tooltip));return fn.call(eval(self.chart.ctx),d)}});self.chart&&self.chart.onmouseout&&(chartOptions.onmouseout=function(){var fn=self.chart.onmouseout;"function"!=typeof fn&&(fn=TC.Util.getFnFromString(self.chart.onmouseout));fn.call(eval(self.chart.ctx))});chartOptions.onrendered=function(){TC.Util.isFunction(chartOptions._onrendered)&&chartOptions._onrendered.call(this);self.map.trigger(TC.Consts.event.DRAWCHART,{control:self,svg:this.svg[0][0],chart:this})};if(window.c3){if(!c3._isOverriden){window.c3.chart.internal.fn.generateDrawLine=function(t,e){var n=this,l=n.config,o=n.d3.svg.line(),i=n.generateGetLinePoints(t,e),a=e?n.getSubYScale:n.getYScale,s=function(t){return(e?n.subxx:n.xx).call(n,t)},r=function(t,e){return l.data_groups.length>0?i(t,e)[0][1]:a.call(n,t.id)(t.value)};o=l.axis_rotated?o.x(r).y(s):o.x(s).y(r);l.line_connectNull||(o=o.defined(function(t){return null!=t.value}));return function(t){var i,s=l.line_connectNull?n.filterRemoveNull(t.values):t.values,r=e?n.x:n.subX,c=a.call(n,t.id),d=0,u=0;if(n.isLineType(t))if(l.data_regions[t.id])i=n.lineWithRegions(s,r,c,l.data_regions[t.id]);else{n.isStepType(t)&&(s=n.convertValuesToStep(s));i=o.interpolate("linear")(s)}else{if(s[0]){d=r(s[0].x);u=c(s[0].value)}i=l.axis_rotated?"M "+u+" "+d:"M "+d+" "+u}return i||"M 0 0"}};window.c3.chart.internal.fn.generateDrawArea=function(t,e){var n=this,l=n.config,o=n.d3.svg.area(),i=n.generateGetAreaPoints(t,e),a=e?n.getSubYScale:n.getYScale,s=function(t){return(e?n.subxx:n.xx).call(n,t)},r=function(t,e){return l.data_groups.length>0?i(t,e)[0][1]:a.call(n,t.id)(0)},c=function(t,e){return l.data_groups.length>0?i(t,e)[1][1]:a.call(n,t.id)(t.value)};o=l.axis_rotated?o.x0(r).x1(c).y(s):o.x(s).y0(r).y1(c);l.line_connectNull||(o=o.defined(function(t){return null!==t.value}));return function(t){var e,i=l.line_connectNull?n.filterRemoveNull(t.values):t.values,a=0,s=0;if(n.isAreaType(t)){n.isStepType(t)&&(i=n.convertValuesToStep(i));e=o.interpolate("linear")(i)}else{if(i[0]){a=n.x(i[0].x);s=n.getYScale(t.id)(i[0].value)}e=l.axis_rotated?"M "+s+" "+a:"M "+a+" "+s}return e||"M 0 0"}};c3._isOverriden=!0}self.chart.chart=c3.generate(chartOptions)}})})};const closeOpenedTableResultsPanel=function(){const t=this;t.map.getControlsByClass(TC.control.ResultsPanel).filter(function(e){return e!==t&&e.isVisible()}).filter(function(t){return"chart"!==t.options.content}).forEach(function(t){t.close()})};ctlProto.openTable=function(){var t=this;t.div.classList.remove(TC.Consts.classes.HIDDEN);if(n=arguments[0]){var e;n.css&&(e=n.css);var n,l=n.callback,o=n.columns;if((n=n.data)&&n.length>0){if(!o){o=[];for(var i in n[0])o.push(i)}t.tableData={columns:o,results:n,css:e,callback:l};t.getRenderedHtml(t.CLASS+"-table",t.tableData).then(function(e){const n=t.div.querySelector("."+t.CLASS+"-table"),l=n.parentElement;l.removeChild(n);n.innerHTML=e;l.appendChild(n);t.tableData.callback&&t.tableData.callback(n);closeOpenedTableResultsPanel.call(t);t.map.trigger(TC.Consts.event.DRAWTABLE,{control:t})});t.div.querySelector("."+t.CLASS+"-chart").style.display="none";t.div.querySelector("."+t.CLASS+"-info").style.display="none";t.show("prsidebar-body")}}};ctlProto.open=function(t,e){const n=this;n.div.classList.remove(TC.Consts.classes.HIDDEN);const l=e||n.div.querySelector("."+n.CLASS+"-table");n.requestIsRendered=window.requestAnimationFrame(function(){var t=l.getBoundingClientRect();if(t&&t.width>100){window.cancelAnimationFrame(this.requestIsRendered);this.map.trigger(TC.Consts.event.DRAWTABLE,{control:n})}}.bind(n));const o=n.div.querySelector("."+n.CLASS+"-chart");o.style.display="none";const i=n.div.querySelector("."+n.CLASS+"-table");i.style.display="none";const a=n.div.querySelector("."+n.CLASS+"-info");a.style.display="none";if(t)if(e){n.getTableContainer=function(){return e};e.innerHTML=t;e.style.display=""}else{i.innerHTML=t;i.style.display=""}else o.childElementCount?o.style.display="":i.childElementCount?i.style.display="":a.childElementCount&&(a.style.display="");const s=n.div.querySelector(".prcollapsed-max");if(n.options.titles){if(n.options.titles.main){const t=n.div.querySelector(".prpanel-title-text");t.setAttribute("title",n.options.titles.main);t.innerHTML=n.options.titles.main}n.options.titles.max&&s.setAttribute("title",n.options.titles.max)}n.options.classes&&n.options.classes.collapsed&&s.querySelector("i.fa-list-alt").classList.add(n.options.classes.collapsed);const r=n.div.querySelector(n.content.collapsedClass);isElementVisible(r)&&n.maximize();n.show("prsidebar-body");n.hide("prcollapsed-max")};ctlProto.loadDataOnChart=function(t){const e=this;e.chart&&e.chart.chart&&e.chart.chart.unload({done:function(){e.elevationProfileChartData=t;e.renderElevationProfileChart({data:t,div:e.div.querySelector("."+ctlProto.CLASS+"-chart")})}})};ctlProto.createChartOptions=function(t){const e=this;var n={};const l=(t=t||{}).locale||TC.Util.getMapLocale(e.map);t.chartType;if(null!=t.ele){const i=function(){const n=getComputedStyle(e.getContainerElement()),l=document.documentElement.clientWidth/100*40,o={height:l>445?t.maxHeight||e.CHART_SIZE.MAX_HEIGHT:t.minHeight||e.CHART_SIZE.MIN_HEIGHT};n.width===getComputedStyle(e.map.div).width?o.width=.95*parseFloat(n.width):o.width=l>445?t.maxWidth||e.CHART_SIZE.MAX_WIDTH:l>310?t.mediumWidth||e.CHART_SIZE.MEDIUM_WIDTH:t.minWidth||e.CHART_SIZE.MIN_WIDTH;return o},a=["grad"+TC.getUID()];let s=Number.NEGATIVE_INFINITY,r=Number.POSITIVE_INFINITY;t.ele.forEach(function(t){if("number"==typeof t){s=Math.max(t,s);r=Math.min(t,r)}});let c=[...t.x],d=[...t.ele];n={data:{x:"x",columns:[["x"].concat(c),["ele"].concat(d)],types:{ele:"area-spline"},colors:{ele:"url(#"+a[0]+")"}},size:i(),point:{show:!1},axis:{x:{tick:{outer:!1,count:5,format:function(t){var e,n;if((t/=1e3)<1){e=Math.round(1e3*t);n=" m"}else{e=Math.round(100*t)/100;n=" km"}return(e=e.toLocaleString(l))+n}}},y:{padding:{top:0,bottom:0},max:s,min:r,tick:{count:2,format:function(t){return formatYAxis(t,l)}}}},onresize:function(){this.api.resize(i())}};if(t.elevationFromServiceChartData){n.data.names={ele:e.getLocaleString("geo.profile.fromTrack"),ele2:e.getLocaleString("mdt")};n.data.columns.push(["ele2"].concat(t.elevationFromServiceChartData.ele));n.data.types.ele2=t.elevationFromServiceChartData.type;a.push("grad"+TC.getUID());n.data.colors.ele2="url(#"+a[a.length-1]+")";n.data.axes={ele:"y"};if(d.every(t=>0===t)){n.axis.y.min=Math.min(...t.elevationFromServiceChartData.ele);n.axis.y.max=Math.max(...t.elevationFromServiceChartData.ele)}else if(t.elevationFromServiceChartData.ele.every(t=>0===t)){n.axis.y.min=Math.min(...d);n.axis.y.max=Math.max(...d)}else{n.axis.y.min=Math.min(...d.concat(t.elevationFromServiceChartData.ele));n.axis.y.max=Math.max(...d.concat(t.elevationFromServiceChartData.ele))}}t.time&&(n.time=("00000"+t.time.h).slice(-2)+":"+("00000"+t.time.m).slice(-2)+":"+("00000"+t.time.s).slice(-2));var o=!1;n._onrendered=function(){if(!o){o=!0;if(t.elevationFromServiceChartData){document.querySelectorAll(".c3-legend-item-tile").forEach(t=>{t.setAttribute("rx",5);t.setAttribute("ry",1)});document.querySelectorAll(".c3-legend-item").forEach(t=>{var n=document.createElementNS("http://www.w3.org/2000/svg","title");n.textContent=e.getLocaleString("hide");t.appendChild(n);t.addEventListener(TC.Consts.event.CLICK,function(){t.classList.contains(TC.Consts.classes.HIDDEN)?t.querySelector("title").textContent=e.getLocaleString("hide"):t.querySelector("title").textContent=e.getLocaleString("show");t.classList.toggle(TC.Consts.classes.HIDDEN)},{passive:!0})})}}const n=this.svg[0][0];var l=n.getElementsByTagName("defs")[0],i="http://www.w3.org/2000/svg";const s=function(t,e){var n=document.createElementNS(i,"linearGradient");n.setAttributeNS(null,"id",t);n.setAttributeNS(null,"x1","0%");n.setAttributeNS(null,"x2","0%");n.setAttributeNS(null,"y1","0%");n.setAttributeNS(null,"y2","100%");n.setAttributeNS(null,"gradientUnits","userSpaceOnUse");const o=document.createElementNS(i,"stop");o.setAttributeNS(null,"offset","0%");o.setAttributeNS(null,"stop-color",e[0]);o.setAttributeNS(null,"stop-opacity","0.7");n.appendChild(o);const a=document.createElementNS(i,"stop");a.setAttributeNS(null,"offset","50%");a.setAttributeNS(null,"stop-color",e[1]);a.setAttributeNS(null,"stop-opacity","0.9");n.appendChild(a);const s=document.createElementNS(i,"stop");s.setAttributeNS(null,"offset","100%");s.setAttributeNS(null,"stop-color",e[2]);s.setAttributeNS(null,"stop-opacity","1");n.appendChild(s);l.appendChild(n)};s(a[0],["red","orange","green"]);t.elevationFromServiceChartData&&s(a[a.length-1],["blue","cian","green"]);const r=d3.select(".c3-brush").node();r&&r.parentNode.removeChild(r);d3.select(".c3-event-rects,.c3-event-rects-single").selectAll("rect").style("cursor","pointer").on("click",function(t){d3.event.stopPropagation();let n=e.elevationProfileChartData.coords[t.index];if(n){n=n.slice(0,2);TC.loadJS(!TC.feature||TC.feature&&!TC.feature.Point,[TC.apiLocation+"TC/feature/Point"],function(){e.map.zoomToFeatures([new TC.feature.Point(n,{})])})}});const c=d3.select(".c3-axis.c3-axis-x").select("path");if(!c.empty()){let t=c.attr("d");if(/^M\d\,(\d)V\dH\d{3}V(\d)$/i.exec(t)){t=t.replace(/(M\d\,)\d/i,"$10").replace(/(H\d{3}V)(\d)/i,"$10");c.attr("d",t)}else{if(/^M\s\d\s(\d)\sV\s\d\sH\s\d{3}\sV\s(\d)$/i.exec(t)){t=t.replace(/(M\s\d\s)\d/i,"$10").replace(/(H\s\d{3}\sV\s)(\d)/i,"$10");c.attr("d",t)}}}const d=n.getBoundingClientRect(),u={width:d.width,height:d.height};var p=function(){var t=d3.scale.ordinal().rangeRoundBands([0,u.width],.1,.3);d3.select(".c3-axis-x").selectAll("text:not(.c3-axis-x-label)").call(function(t,e){t.each(function(){t.each(function(t,e){if(0!=e){d3text=d3.select(this);if(1===d3text.node().childNodes.length){var n=d3text.select("tspan").node().cloneNode(),l=d3text.text().split(" ");d3text.select("tspan").text(l[0]);n.textContent=l[1];var o=n.getAttribute("dy");o=(o=o?parseFloat(n.getAttribute("dy")):.71)+.18+"em";n.setAttribute("dy",o);d3text.node().appendChild(n)}}})})},t.rangeBand())};if(d3.select(".c3-axis-x").node().getBoundingClientRect().width)(d3.select(".c3-axis-x").node().getBoundingClientRect().width>=u.width-d3.select(".c3-axis-y").node().getBoundingClientRect().width||100*d3.select(".c3-axis-x").node().getBoundingClientRect().width/(u.width-d3.select(".c3-axis-y").node().getBoundingClientRect().width)>90)&&p();else{if(e.elevationChartLabelsRAF){window.cancelAnimationFrame(e.elevationChartLabelsRAF);e.elevationChartLabelsRAF=void 0}e.elevationChartLabelsRAF=requestAnimationFrame(function t(){if(d3.select(".c3-axis-x").length&&!d3.select(".c3-axis-x").node())e.elevationChartLabelsRAF=requestAnimationFrame(t);else if(d3.select(".c3-axis-x").length&&d3.select(".c3-axis-x").node()&&!d3.select(".c3-axis-x").node().getBoundingClientRect().width)e.elevationChartLabelsRAF=requestAnimationFrame(t);else{window.cancelAnimationFrame(e.elevationChartLabelsRAF);e.elevationChartLabelsRAF=void 0;(d3.select(".c3-axis-x").node().getBoundingClientRect().width>=u.width-d3.select(".c3-axis-y").node().getBoundingClientRect().width||100*d3.select(".c3-axis-x").node().getBoundingClientRect().width/(u.width-d3.select(".c3-axis-y").node().getBoundingClientRect().width)>90)&&p()}})}d3.select("svg").select(".c3-chart-lines").selectAll(".c3-target-ele").each(function(){this.parentNode.appendChild(this)});if(!e.isMinimized()){e.show("prsidebar-body");e.hide("prcollapsed-max")}e.div.querySelector("."+e.CLASS+"-table").style.display="";e.div.querySelector("."+e.CLASS+"-info").style.display=""}}else n={msg:e.getLocaleString("geo.trk.chart.chpe.empty")};return n};const getTime=function(t,e){var n=e-t,l={},o=Math.floor(n/1e3/60/60/24);n-=1e3*o*60*60*24;var i=Math.floor(n/1e3/60/60);n-=1e3*i*60*60;l.h=i+24*o;var a=Math.floor(n/1e3/60);n-=1e3*a*60;l.m=a;l.s=Math.floor(n/1e3);return TC.Util.extend({},l,{toString:("00000"+l.h).slice(-2)+":"+("00000"+l.m).slice(-2)+":"+("00000"+l.s).slice(-2)})};ctlProto.getElevationChartTooltip=function(t){const e=this.map.options.locale&&this.map.options.locale.replace("_","-")||void 0,n=this.elevationProfileChartData.coords,l=function(t){return t.value?parseInt(t.value.toFixed(0)).toLocaleString(e):"0"},o=n[t[0].index];let i;4==n[0].length&&n[0][3]>0&&o&&(i=getTime(n[0][3],o[3]));let a=t[0].x/1e3,s=(a<1?Math.round(1e3*a):Math.round(100*a)/100).toLocaleString(e)+(a<1?" m":" km");return'<div class="onTop"><span>'+t.map((t,e)=>t?0===e?'<span data-isNumber class="'+("ele"===t.id?"original":"mdt")+'">'+l(t)+" m</span>":'<span data-isNumber class="'+("ele"===t.id?"original":"mdt")+'">'+l(t)+" m </span>":"").join("")+"</span ></div>"+('<div class="onBottom"><span>'+s+" </span>"+(i?"<span>"+i.toString+"</span><div/>":"<div/>"))};ctlProto.getTableContainer=function(){return this.tableDiv};ctlProto.getInfoContainer=function(){return this.infoDiv};ctlProto.getMenuElement=function(){return this.menuDiv};ctlProto.getContainerElement=function(){return this.div.querySelector(".prsidebar-body")||null};ctlProto.register=function(t){const e=this,n=TC.Control.prototype.register.call(e,t);e.wrap.register(t);e.openOn&&e.map.one(e.openOn,function(t,n){e.content.fnOpen.call(e,t.data)});e.closeOn&&e.map.one(e.closeOn,function(t,n){e.close()});e.options.openOn&&e.map.on(e.options.openOn,function(t,n){e.content.fnOpen.call(e,t.data)});e.options.closeOn&&e.map.on(e.options.closeOn,function(t,n){e.close()});return n};ctlProto.exportToExcel=function(){var t=this,e=[t.tableData.columns];t.tableData.results.forEach(function(t){var n=[];for(var l in t)t.hasOwnProperty(l)&&"Id"!==l&&"Geom"!==l&&n.push(t[l]);e.push(n)});var n=function(n){var l=t.save.fileName?t.save.fileName:"resultados.xls",o=t.options.titles&&t.options.titles.main?t.options.titles.main:null;n.Save(l,e,o)};TC.Util.ExcelExport?n(new TC.Util.ExcelExport):TC.loadJS(!0,TC.apiLocation+"TC/Util.ExcelExport",function(){n(new TC.Util.ExcelExport)})};ctlProto.contentType={TABLE:{fnOpen:ctlProto.openTable,collapsedClass:".fa-list-alt"},CHART:{fnOpen:ctlProto.openChart,collapsedClass:".fa-area-chart"}}}();
//# sourceMappingURL=../maps/control/ResultsPanel.min.js.map