TC.control=TC.control||{};TC.control.TOC||TC.syncLoadJS(TC.apiLocation+"TC/control/TOC");TC.control.WorkLayerManager=function(e){var t=this;TC.control.TOC.apply(t,arguments);t.layers=[];t.layerTools=[];t.addLayerTool({renderFn:function(e,n){const a=t.CLASS+"-btn-info";let l=e.querySelector("button."+a);if(!l){const r=t.map.getLayer(n);if(r.isRaster()){const o=r.getInfo();if(o.hasOwnProperty("abstract")||o.hasOwnProperty("legend")||o.hasOwnProperty("metadata")){const r=t.getLocaleString("infoFromThisLayer");(l=document.createElement("button")).innerHTML=r;l.setAttribute("title",r);l.classList.add(a);l.dataset.layerId=n;e.appendChild(l)}}}return l},actionFn:function(){var e=this;do{e=e.parentElement}while(e&&"LI"!==e.tagName);const n=e.querySelector("."+t.CLASS+"-info"),a=t.map.getLayer(this.dataset.layerId);n.querySelectorAll("."+t.CLASS+"-legend img").forEach(function(e){t.styleLegendImage(e,a)});n.classList.toggle(TC.Consts.classes.HIDDEN);if(e.querySelector('input[type="checkbox"]').checked){e.querySelector("."+t.CLASS+"-dd").classList.toggle(TC.Consts.classes.HIDDEN,!n.classList.contains(TC.Consts.classes.HIDDEN))}this.classList.toggle(TC.Consts.classes.CHECKED)}});t.addLayerTool({renderFn:function(e,n){const a=t.CLASS+"-btn-dl";let l=e.querySelector("button."+a);if(!l){const r=t.map.getLayer(n);if(TC.layer.Vector&&r instanceof TC.layer.Vector){const r=t.getLocaleString("downloadFeatures");(l=document.createElement("button")).innerHTML=r;l.setAttribute("title",r);l.classList.add(a);l.dataset.layerId=n;e.appendChild(l)}}return l},actionFn:function(){var e=this;do{e=e.parentElement}while(e&&"LI"!==e.tagName);const n=t.map.getLayer(this.dataset.layerId);t.getDownloadDialog().then(function(e){const a=n.title||"",l={title:`${a} - ${t.getLocaleString("downloadFeatures")}`,fileName:/\.[a-z0-9]+$/i.test(a)?a.substr(0,a.lastIndexOf(".")):a,elevation:t.map.elevation&&t.map.elevation.options};e.open(n.features,l)})}})};TC.inherit(TC.control.WorkLayerManager,TC.control.TOC);!function(){var e=TC.control.WorkLayerManager.prototype;e.CLASS="tc-ctl-wlm";e.CLICKEVENT="click";TC.Consts.classes.DRAG=TC.Consts.classes.DRAG||"tc-drag";TC.Consts.classes.DRAGEND=TC.Consts.classes.DRAGEND||"tc-dragend";TC.Consts.event.TOOLSOPEN=TC.Consts.event.TOOLSOPEN||"toolsopen.tc";e.template={};e.template[e.CLASS]={1:function(e,t,n,a,l){var r,o=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return null!=(r=e.invokePartial(o(a,"tc-ctl-wlm-elm"),t,{name:"tc-ctl-wlm-elm",data:l,helpers:n,partials:a,decorators:e.decorators}))?r:""},compiler:[8,">= 4.3.0"],main:function(e,t,n,a,l){var r,o=null!=t?t:e.nullContext||{},s=e.escapeExpression,i=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return"<h2>"+s(i(n,"i18n").call(o,"loadedLayers",{name:"i18n",hash:{},data:l,loc:{start:{line:1,column:4},end:{line:1,column:27}}}))+'<span class="tc-ctl-wlm-n"></span><button class="tc-ctl-wlm-del-all tc-hidden" title="'+s(i(n,"i18n").call(o,"removeAllLayersFromMap",{name:"i18n",hash:{},data:l,loc:{start:{line:1,column:113},end:{line:1,column:146}}}))+'"></button></h2>\r\n<div class="tc-ctl-wlm-empty">'+s(i(n,"i18n").call(o,"noData",{name:"i18n",hash:{},data:l,loc:{start:{line:2,column:30},end:{line:2,column:47}}}))+'</div>\r\n<div class="tc-ctl-wlm-content tc-hidden">\r\n    <ul>'+(null!=(r=i(n,"each").call(o,null!=t?i(t,"workLayers"):t,{name:"each",hash:{},fn:e.program(1,l,0),inverse:e.noop,data:l,loc:{start:{line:4,column:8},end:{line:4,column:57}}}))?r:"")+"</ul>\r\n</div>"},usePartial:!0,useData:!0};e.template[e.CLASS+"-elm"]={1:function(e,t,n,a,l){var r=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return e.escapeExpression(e.lambda(null!=t?r(t,"title"):t,t))},3:function(e,t,n,a,l){var r,o=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return(null!=(r=o(n,"unless").call(null!=t?t:e.nullContext||{},l&&o(l,"first"),{name:"unless",hash:{},fn:e.program(4,l,0),inverse:e.noop,data:l,loc:{start:{line:3,column:89},end:{line:3,column:126}}}))?r:"")+e.escapeExpression(e.lambda(t,t))},4:function(e,t,n,a,l){return" &bull; "},6:function(e,t,n,a,l){var r=null!=t?t:e.nullContext||{},o=e.escapeExpression,s=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<button class="tc-ctl-wlm-btn-zoom" title="'+o(s(n,"i18n").call(r,"zoomToLayerExtent",{name:"i18n",hash:{},data:l,loc:{start:{line:6,column:68},end:{line:6,column:96}}}))+'">'+o(s(n,"i18n").call(r,"zoomToLayerExtent",{name:"i18n",hash:{},data:l,loc:{start:{line:6,column:98},end:{line:6,column:126}}}))+"</button>"},8:function(e,t,n,a,l){return"disabled"},10:function(e,t,n,a,l){var r=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'title="'+e.escapeExpression(r(n,"i18n").call(null!=t?t:e.nullContext||{},"removeLayerFromMap",{name:"i18n",hash:{},data:l,loc:{start:{line:7,column:85},end:{line:7,column:114}}}))+'"'},12:function(e,t,n,a,l){return'checked="checked"'},14:function(e,t,n,a,l){var r,o=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'            <div class="tc-ctl-wlm-abstract">\r\n                <h4>'+e.escapeExpression(o(n,"i18n").call(null!=t?t:e.nullContext||{},"abstract",{name:"i18n",hash:{},data:l,loc:{start:{line:15,column:20},end:{line:15,column:39}}}))+"</h4>\r\n                <div><pre>"+(null!=(r=e.lambda(null!=t?o(t,"abstract"):t,t))?r:"")+"</pre></div>\r\n            </div>\r\n"},16:function(e,t,n,a,l){var r,o=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'            <ul class="tc-ctl-wlm-custom-legend">\r\n                '+(null!=(r=e.lambda(null!=t?o(t,"customLegend"):t,t))?r:"")+"\r\n            </ul>\r\n"},18:function(e,t,n,a,l){var r,o=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return null!=(r=o(n,"if").call(null!=t?t:e.nullContext||{},null!=t?o(t,"legend"):t,{name:"if",hash:{},fn:e.program(19,l,0),inverse:e.noop,data:l,loc:{start:{line:24,column:16},end:{line:31,column:23}}}))?r:""},19:function(e,t,n,a,l){var r,o=e.escapeExpression,s=null!=t?t:e.nullContext||{},i=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'                <div class="tc-ctl-wlm-legend" data-layer-name="'+o(e.lambda(null!=t?i(t,"layerNames"):t,t))+'">\r\n                    <h4>'+o(i(n,"i18n").call(s,"content",{name:"i18n",hash:{},data:l,loc:{start:{line:26,column:24},end:{line:26,column:42}}}))+"</h4>\r\n"+(null!=(r=i(n,"each").call(s,null!=t?i(t,"legend"):t,{name:"each",hash:{},fn:e.program(20,l,0),inverse:e.noop,data:l,loc:{start:{line:27,column:20},end:{line:29,column:29}}}))?r:"")+"                </div>\r\n"},20:function(e,t,n,a,l){var r=e.lambda,o=e.escapeExpression,s=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return"                    <div><p>"+o(r(null!=t?s(t,"title"):t,t))+'</p><img data-img="'+o(r(null!=t?s(t,"src"):t,t))+'" /></div>\r\n'},22:function(e,t,n,a,l){var r,o=null!=t?t:e.nullContext||{},s=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'            <div class="tc-ctl-wlm-metadata">\r\n                <h4>'+e.escapeExpression(s(n,"i18n").call(o,"metadata",{name:"i18n",hash:{},data:l,loc:{start:{line:35,column:20},end:{line:35,column:39}}}))+"</h4>\r\n                <ul>\r\n"+(null!=(r=s(n,"each").call(o,null!=t?s(t,"metadata"):t,{name:"each",hash:{},fn:e.program(23,l,0),inverse:e.noop,data:l,loc:{start:{line:37,column:20},end:{line:39,column:29}}}))?r:"")+"                </ul>\r\n            </div>\r\n"},23:function(e,t,n,a,l){var r,o=e.lambda,s=e.escapeExpression,i=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'                    <li><a href="'+(null!=(r=o(null!=t?i(t,"url"):t,t))?r:"")+'" type="'+s(o(null!=t?i(t,"format"):t,t))+'" title="'+s(o(null!=t?i(t,"formatDescription"):t,t))+'" target="_blank">'+s(o(null!=t?i(t,"formatDescription"):t,t))+"</a></li>\r\n"},compiler:[8,">= 4.3.0"],main:function(e,t,n,a,l){var r,o=null!=t?t:e.nullContext||{},s=e.escapeExpression,i=e.lambda,c=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<li class="tc-ctl-wlm-elm" tabindex="-1">\r\n    <div class="tc-ctl-wlm-lyr">'+(null!=(r=c(n,"if").call(o,null!=t?c(t,"path"):t,{name:"if",hash:{},fn:e.program(1,l,0),inverse:e.noop,data:l,loc:{start:{line:2,column:32},end:{line:2,column:60}}}))?r:"")+'</div>\r\n    <div class="tc-ctl-wlm-type"></div><div class="tc-ctl-wlm-path" title="'+(null!=(r=c(n,"each").call(o,null!=t?c(t,"path"):t,{name:"each",hash:{},fn:e.program(3,l,0),inverse:e.program(1,l,0),data:l,loc:{start:{line:3,column:75},end:{line:3,column:160}}}))?r:"")+'">'+(null!=(r=c(n,"each").call(o,null!=t?c(t,"path"):t,{name:"each",hash:{},fn:e.program(3,l,0),inverse:e.program(1,l,0),data:l,loc:{start:{line:3,column:162},end:{line:3,column:247}}}))?r:"")+'</div>\r\n    <div class="tc-ctl-wlm-buttons">\r\n        <div class="tc-ctl-wlm-tools"></div>\r\n        '+(null!=(r=c(n,"if").call(o,null!=t?c(t,"hasExtent"):t,{name:"if",hash:{},fn:e.program(6,l,0),inverse:e.noop,data:l,loc:{start:{line:6,column:8},end:{line:6,column:142}}}))?r:"")+'\r\n        <button class="tc-ctl-wlm-btn-del" '+(null!=(r=c(n,"if").call(o,null!=t?c(t,"unremovable"):t,{name:"if",hash:{},fn:e.program(8,l,0),inverse:e.program(10,l,0),data:l,loc:{start:{line:7,column:43},end:{line:7,column:122}}}))?r:"")+">"+s(c(n,"i18n").call(o,"removeLayerFromMap",{name:"i18n",hash:{},data:l,loc:{start:{line:7,column:123},end:{line:7,column:152}}}))+'</button>\r\n        <input type="checkbox" id="tc-ctl-wlm-tools-visibility-'+s(i(null!=t?c(t,"id"):t,t))+'" '+(null!=(r=c(n,"unless").call(o,null!=t?c(t,"hide"):t,{name:"unless",hash:{},fn:e.program(12,l,0),inverse:e.noop,data:l,loc:{start:{line:8,column:71},end:{line:8,column:115}}}))?r:"")+' title="'+s(c(n,"i18n").call(o,"visibilityOfThisLayer",{name:"i18n",hash:{},data:l,loc:{start:{line:8,column:123},end:{line:8,column:155}}}))+'" />\r\n        <label for="tc-ctl-wlm-tools-visibility-'+s(i(null!=t?c(t,"id"):t,t))+'" title="'+s(c(n,"i18n").call(o,"visibilityOfThisLayer",{name:"i18n",hash:{},data:l,loc:{start:{line:9,column:63},end:{line:9,column:95}}}))+'">'+s(c(n,"i18n").call(o,"visibilityOfThisLayer",{name:"i18n",hash:{},data:l,loc:{start:{line:9,column:97},end:{line:9,column:129}}}))+'</label>\r\n        <input type="range" value="'+s(i(null!=t?c(t,"opacity"):t,t))+'" title="'+s(c(n,"i18n").call(o,"transparencyOfThisLayer",{name:"i18n",hash:{},data:l,loc:{start:{line:10,column:55},end:{line:10,column:89}}}))+'" />\r\n    </div>\r\n        <div class="tc-ctl-wlm-info tc-hidden">\r\n'+(null!=(r=c(n,"if").call(o,null!=t?c(t,"abstract"):t,{name:"if",hash:{},fn:e.program(14,l,0),inverse:e.noop,data:l,loc:{start:{line:13,column:12},end:{line:18,column:19}}}))?r:"")+(null!=(r=c(n,"if").call(o,null!=t?c(t,"customLegend"):t,{name:"if",hash:{},fn:e.program(16,l,0),inverse:e.program(18,l,0),data:l,loc:{start:{line:19,column:12},end:{line:32,column:19}}}))?r:"")+(null!=(r=c(n,"if").call(o,null!=t?c(t,"metadata"):t,{name:"if",hash:{},fn:e.program(22,l,0),inverse:e.noop,data:l,loc:{start:{line:33,column:12},end:{line:42,column:19}}}))?r:"")+'        </div>\r\n    <div class="tc-ctl-wlm-dd" title="'+s(c(n,"i18n").call(o,"dragToReorder",{name:"i18n",hash:{},data:l,loc:{start:{line:44,column:38},end:{line:44,column:62}}}))+'"></div>\r\n</li>'},useData:!0};e.template[e.CLASS+"-type-sgl"]={compiler:[8,">= 4.3.0"],main:function(e,t,n,a,l){var r=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return e.escapeExpression(r(n,"i18n").call(null!=t?t:e.nullContext||{},"singleLayer",{name:"i18n",hash:{},data:l,loc:{start:{line:1,column:0},end:{line:1,column:22}}}))},useData:!0};e.template[e.CLASS+"-type-grp"]={1:function(e,t,n,a,l){var r,o=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return null!=(r=e.invokePartial(o(a,"tc-ctl-wlm-type-grp-node"),t,{name:"tc-ctl-wlm-type-grp-node",data:l,indent:"    ",helpers:n,partials:a,decorators:e.decorators}))?r:""},compiler:[8,">= 4.3.0"],main:function(e,t,n,a,l){var r,o=null!=t?t:e.nullContext||{},s=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return"<div>"+e.escapeExpression(s(n,"i18n").call(o,"groupLayerThatContains",{name:"i18n",hash:{},data:l,loc:{start:{line:1,column:5},end:{line:1,column:38}}}))+":</div>\r\n<ul>\r\n"+(null!=(r=s(n,"each").call(o,null!=t?s(t,"Layer"):t,{name:"each",hash:{},fn:e.program(1,l,0),inverse:e.noop,data:l,loc:{start:{line:3,column:4},end:{line:5,column:13}}}))?r:"")+"</ul>"},usePartial:!0,useData:!0};e.template[e.CLASS+"-type-grp-node"]={1:function(e,t,n,a,l){var r,o=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return null!=(r=e.invokePartial(o(a,"tc-ctl-wlm-type-grp-node"),t,{name:"tc-ctl-wlm-type-grp-node",data:l,indent:"        ",helpers:n,partials:a,decorators:e.decorators}))?r:""},compiler:[8,">= 4.3.0"],main:function(e,t,n,a,l){var r,o=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<li class="tc-ctl-ltoc-tip-grp-elm">\r\n    <span>'+e.escapeExpression(e.lambda(null!=t?o(t,"Title"):t,t))+"</span>\r\n    <ul>\r\n"+(null!=(r=o(n,"each").call(null!=t?t:e.nullContext||{},null!=t?o(t,"Layer"):t,{name:"each",hash:{},fn:e.program(1,l,0),inverse:e.noop,data:l,loc:{start:{line:4,column:8},end:{line:6,column:17}}}))?r:"")+"    </ul>\r\n</li>"},usePartial:!0,useData:!0};const t=function(e,t){return e.getLayerUIElements().filter(function(e){return e.dataset.layerId===t.id})[0]};var n=function(e){return e.layers.length};const a=function(e){return!e.layers.some(function(e){return e.unremovable})},l=function(e,t,n,a,l){const r=e.getLayerUIElements();var o;if(a>n)o=r[a-1];else{if(!(a<n))return;o=r[a+1]}const s=e.map.getLayer(t.dataset.layerId),i=e.map.getLayer(o.dataset.layerId),c=e.map.layers.indexOf(i);c>=1&&c<e.map.layers.length&&e.map.insertLayer(s,c,l)};e.render=function(e,t){const n=this;return n._set1stRenderPromise(n.map?n.renderData(t?TC.Util.extend(n.map.getLayerTree(),t):n.map.getLayerTree(),function(){n.addUIEventListeners();TC.loadJS(!window.Sortable,[TC.apiLocation+"lib/sortable/Sortable.min.js"],function(){n.map.workLayers.filter(function(e){return!e.stealth}).forEach(function(e){n.updateLayerTree(e)});const t=n.div.querySelector("ul");n._sortable=Sortable.create(t,{handle:"."+n.CLASS+"-dd",animation:150,onSort:function(e){l(n,e.item,e.oldIndex,e.newIndex)}});t.addEventListener("keydown",TC.EventTarget.listenerBySelector("li",function(e){for(var t=e.target;"LI"!==t.tagName;)if(!(t=t.parentElement))return;const a=function(e,a){const r=n._sortable.toArray(),o=r[e];r[e]=r[a];r[a]=o;n._sortable.sort(r);l(n,t,e,a)},r=n.getLayerUIElements(),o=r.indexOf(t);switch(!0){case/Up$/.test(e.key):if(o>0){a(o,o-1);t.focus();e.stopPropagation()}break;case/Down$/.test(e.key):if(o<r.length-1){a(o,o+1);t.focus();e.stopPropagation()}break;case/Enter$/.test(e.key):t.blur();e.stopPropagation()}}));"function"==typeof e&&e()})}):Promise.reject(Error("Cannot render: control has no map")))};e.register=function(e){const n=this;return new Promise(function(a,l){TC.control.TOC.prototype.register.call(n,e).then(function(){e.loaded(function(){n.updateScale()});e.on(TC.Consts.event.LAYEROPACITY,function(e){const a=t(n,e.layer);a&&(a.querySelector("input[type=range]").value=Math.round(100*e.opacity))}).on(TC.Consts.event.FEATURESIMPORT,function(t){var a=t.fileName;if(t.features&&t.features.length>0){var l="."+TC.Consts.format.GPX.toLowerCase();if(t.fileName.toLowerCase().indexOf(l)===t.fileName.length-l.length)return;e.one(TC.Consts.event.LAYERADD,function(e){if(e&&e.layer&&e.layer.title==a){n.map&&n.map.layout&&n.map.layout.accordion&&n.div.classList.contains(TC.Consts.classes.COLLAPSED)&&n.map.controls.filter(function(e){return e!==n&&!e.containerControl}).forEach(function(e){e.div.classList.add(TC.Consts.classes.COLLAPSED)});n.map.trigger(TC.Consts.event.TOOLSOPEN);n.div.classList.remove(TC.Consts.classes.COLLAPSED)}})}});a(n)})})};e.onExternalServiceAdded=function(e){};e.addUIEventListeners=function(){const e=this;e.div.addEventListener(e.CLICKEVENT,TC.EventTarget.listenerBySelector("input[type=checkbox]",function(t){const n=t.target;var a=n;do{a=a.parentElement}while(a&&!a.matches("li."+e.CLASS+"-elm"));e.map.getLayer(a.dataset.layerId).setVisibility(n.checked);t.stopPropagation()}));const t=function(t){const n=t.target;var a=n;do{a=a.parentElement}while(a&&"LI"!==a.tagName);e.map.getLayer(a.dataset.layerId).setOpacity(n.value/100)};e.div.addEventListener("change",TC.EventTarget.listenerBySelector("input[type=range]",t));e.div.addEventListener("input",TC.EventTarget.listenerBySelector("input[type=range]",t));e.div.addEventListener(e.CLICKEVENT,TC.EventTarget.listenerBySelector(`.${e.CLASS}-btn-del:not(.disabled)`,function(t){var n=t.target;do{n=n.parentElement}while(n&&"LI"!==n.tagName);const a=e.map.getLayer(n.dataset.layerId);e.map.removeLayer(a)}));e.div.addEventListener(e.CLICKEVENT,TC.EventTarget.listenerBySelector("."+e.CLASS+"-del-all",function(t){TC.confirm(e.getLocaleString("layersRemove.confirm"),function(){e.getLayerUIElements().map(function(t){return e.map.getLayer(t.dataset.layerId)}).forEach(function(t){e.map.removeLayer(t)})})}))};e.updateLayerVisibility=function(e){const n=t(this,e);if(n){const t=e.getVisibility();n.querySelector('input[type="checkbox"]').checked=t}};e.updateLayerTree=function(e){var t=this;if(!e.isBase&&!e.options.stealth){TC.control.MapContents.prototype.updateLayerTree.call(t,e);for(var l=!1,r=0,o=t.layers.length;r<o;r++)if(e===t.layers[r]){l=!0;break}if(!l){t.layers.push(e);var s=e.title||e.wrap.getServiceTitle(),i={title:e.options.hideTitle?"":s,hide:!(!e.renderOptions||!e.renderOptions.hide),opacity:e.renderOptions&&e.renderOptions.opacity?100*e.renderOptions.opacity:100,customLegend:e.customLegend,unremovable:e.unremovable,id:e.id},c=e.isRaster();if(c){i.hasExtent=!!e.getExtent();i.layerNames=e.layerNames;var u=e.getPath();u.shift();i.path=u;var d=e.names[0],p=e.getInfo(d);i.legend=p.legend;i.abstract=p.abstract;i.metadata=p.metadata}else i.hasExtent=!0;(function(e){return new Promise(function(t,n){e&&e.options.method&&"POST"===e.options.method?e.getLegendGraphicImage().then(function(e){t(e)}).catch(function(e){TC.error(e)}):t()})})(e).then(function(n){n&&(legend.src=n);t.getRenderedHtml(t.CLASS+"-elm",i).then(function(n){const a=(new DOMParser).parseFromString(n,"text/html").body.firstChild;var l,r=!1;if(c&&!(r=e.names.length>1))for(var o=e.wrap.getAllLayerNodes(),s=0;s<o.length;s++){var i=o[s];if(e.wrap.getName(i)===d){l=i;e.wrap.getLayerNodes(i).length>0&&(r=!0);break}}const u=a.querySelector("."+t.CLASS+"-type"),p=r?t.CLASS+"-type-grp":t.CLASS+"-type-sgl";u.classList.add(p);const m=a.querySelector(`.${t.CLASS}-btn-zoom`);m&&m.addEventListener(TC.Consts.event.CLICK,function(e){t.map.zoomToLayer(a.dataset.layerId,{animate:!0})},{passive:!0});if(l){e.wrap.normalizeLayerNode(l);t.getRenderedHtml(p,l).then(function(e){var n;u.addEventListener("mouseover",function(a){const l=t.map.div,r=u.getBoundingClientRect();(n=document.createElement("div")).classList.add(t.CLASS+"-tip");n.innerHTML=e;n.style.top=r.top-l.offsetTop+"px";n.style.right=l.offsetWidth-(r.left-l.offsetLeft)+"px";l.appendChild(n)});u.addEventListener("mouseout",function(e){n.parentElement.removeChild(n)})})}const f=t.div.querySelector("ul");a.dataset.layerId=e.id;const y=t.getLayerUIElements(),h=t.map.workLayers.filter(function(e){return!e.stealth}),v=h.indexOf(e);t.layerTools.forEach(e=>t.addLayerToolUI(a,e));for(var C=!1,L=(s=0,y.length);s<L;s++){const e=y[s];if(h.indexOf(t.map.getLayer(e.dataset.layerId))<v){e.insertAdjacentElement("beforebegin",a);C=!0;break}}C||f.appendChild(a);void 0;t.updateScale()})});var m=n(t);const l=t.div.querySelector("."+t.CLASS+"-n"),r=t.div.querySelector("."+t.CLASS+"-empty"),o=t.div.querySelector("."+t.CLASS+"-content");l.textContent=m;if(m>0){l.classList.add(TC.Consts.classes.VISIBLE);r.classList.add(TC.Consts.classes.HIDDEN);o.classList.remove(TC.Consts.classes.HIDDEN)}else{l.classList.remove(TC.Consts.classes.VISIBLE);r.classList.remove(TC.Consts.classes.HIDDEN);o.classList.add(TC.Consts.classes.HIDDEN)}t.div.querySelector("."+t.CLASS+"-del-all").classList.toggle(TC.Consts.classes.HIDDEN,!a(t))}}};e.updateScale=function(){var e=this;e.getLayerUIElements().forEach(function(t){var n=e.map.getLayer(t.dataset.layerId);if(n&&n.names){for(var a=!1,l=0;l<n.names.length;l++)if(n.isVisibleByScale(n.names[l])){a=!0;break}t.classList.toggle(e.CLASS+"-elm-notvisible",!a)}})};e.updateLayerOrder=function(e,n,a){const l=this;l.map.workLayers.filter(function(e){return!e.stealth}).forEach(function(e){const n=t(l,e);n&&n.parentElement.firstChild.insertAdjacentElement("beforebegin",n)})};e.removeLayer=function(e){var t=this.layers.indexOf(e);t>=0&&this.layers.splice(t,1);this.getLayerUIElements().forEach(function(t){t.dataset.layerId===e.id&&t.parentElement.removeChild(t)});const l=this.div.querySelector("."+this.CLASS+"-content"),r=this.div.querySelector("."+this.CLASS+"-empty"),o=this.div.querySelector("."+this.CLASS+"-n");var s=n(this);o.textContent=s;if(s>0){l.classList.remove(TC.Consts.classes.HIDDEN);r.classList.add(TC.Consts.classes.HIDDEN);o.classList.add(TC.Consts.classes.VISIBLE)}else{a(this)&&this.div.querySelector("."+this.CLASS+"-del-all").classList.add(TC.Consts.classes.HIDDEN);l.classList.add(TC.Consts.classes.HIDDEN);r.classList.remove(TC.Consts.classes.HIDDEN);o.classList.remove(TC.Consts.classes.VISIBLE)}};e.getLayerUIElements=function(){return Array.from(this.div.querySelectorAll(`ul > li.${this.CLASS}-elm`))};e.addLayerToolUI=function(e,t){const n=this;if(TC.Util.isFunction(t.renderFn)){const a=t.renderFn(e.querySelector(`.${n.CLASS}-tools`),e.dataset.layerId);if(a){TC.Util.isFunction(t.actionFn)&&a.addEventListener(TC.Consts.event.CLICK,function(e){t.actionFn.call(a)},{passive:!0});TC.Util.isFunction(t.updateFn)&&t.updateEvents&&map.on(t.updateEvents.join(" "),function(e){e.layer&&e.layer.id!==a.dataset.layerId||t.updateFn.call(a,e)})}}};e.addLayerTool=function(e){const t=this;t.layerTools.push(e);t.getLayerUIElements().forEach(function(n){t.addLayerToolUI(n,e)})}}();
//# sourceMappingURL=../maps/control/WorkLayerManager.min.js.map