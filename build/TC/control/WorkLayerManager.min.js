TC.control=TC.control||{};TC.control.TOC||TC.syncLoadJS(TC.apiLocation+"TC/control/TOC");TC.control.WorkLayerManager=function(e){var t=this;TC.control.TOC.apply(t,arguments);t.layers=[];t.layerTools=[];t.addLayerTool({renderFn:function(e,n){const l=t.CLASS+"-cb-info";let a=e.querySelector('input[type="checkbox"].'+l);if(!a){const r=t.map.getLayer(n);if(r.isRaster()){const o=r.getInfo();if(o.hasOwnProperty("abstract")||o.hasOwnProperty("legend")||o.hasOwnProperty("metadata")){const r=t.getLocaleString("infoFromThisLayer");(a=document.createElement("input")).setAttribute("type","checkbox");const o=l+"-"+n;a.setAttribute("id",o);a.setAttribute("title",r);a.classList.add(l);a.dataset.layerId=n;const s=document.createElement("label");s.innerHTML=r;s.setAttribute("title",r);s.setAttribute("for",o);s.classList.add(l+"-label");e.appendChild(a);e.appendChild(s)}}}return a},actionFn:function(){var e=this;do{e=e.parentElement}while(e&&"LI"!==e.tagName);const n=e.querySelector("."+t.CLASS+"-info"),l=t.map.getLayer(this.dataset.layerId);n.querySelectorAll("."+t.CLASS+"-legend img").forEach(function(e){t.styleLegendImage(e,l)});n.classList.toggle(TC.Consts.classes.HIDDEN,!this.checked);if(e.querySelector('input[type="checkbox"].tc-ctl-wlm-tools-visibility').checked){e.querySelector("."+t.CLASS+"-dd").classList.toggle(TC.Consts.classes.HIDDEN,!n.classList.contains(TC.Consts.classes.HIDDEN))}}});t.addLayerTool({renderFn:function(e,n){const l=t.CLASS+"-btn-dl";let a=e.querySelector("button."+l);if(!a){const r=t.map.getLayer(n);if(TC.layer.Vector&&r instanceof TC.layer.Vector){const r=t.getLocaleString("downloadFeatures");(a=document.createElement("button")).innerHTML=r;a.setAttribute("title",r);a.classList.add(l);a.dataset.layerId=n;e.appendChild(a)}}return a},actionFn:function(){var e=this;do{e=e.parentElement}while(e&&"LI"!==e.tagName);const n=t.map.getLayer(this.dataset.layerId);t.getDownloadDialog().then(function(e){const l=n.title||"",a={title:`${l} - ${t.getLocaleString("downloadFeatures")}`,fileName:/\.[a-z0-9]+$/i.test(l)?l.substr(0,l.lastIndexOf(".")):l,elevation:t.map.elevation&&t.map.elevation.options};e.open(n.features,a)})}})};TC.inherit(TC.control.WorkLayerManager,TC.control.TOC);!function(){var e=TC.control.WorkLayerManager.prototype;e.CLASS="tc-ctl-wlm";e.CLICKEVENT="click";TC.Consts.classes.DRAG=TC.Consts.classes.DRAG||"tc-drag";TC.Consts.classes.DRAGEND=TC.Consts.classes.DRAGEND||"tc-dragend";TC.Consts.event.TOOLSOPEN=TC.Consts.event.TOOLSOPEN||"toolsopen.tc";e.template={};e.template[e.CLASS]={1:function(e,t,n,l,a){var r,o=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return null!=(r=e.invokePartial(o(l,"tc-ctl-wlm-elm"),t,{name:"tc-ctl-wlm-elm",data:a,helpers:n,partials:l,decorators:e.decorators}))?r:""},compiler:[8,">= 4.3.0"],main:function(e,t,n,l,a){var r,o=null!=t?t:e.nullContext||{},s=e.escapeExpression,i=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return"<h2>"+s(i(n,"i18n").call(o,"loadedLayers",{name:"i18n",hash:{},data:a,loc:{start:{line:1,column:4},end:{line:1,column:27}}}))+'<span class="tc-ctl-wlm-n"></span><button class="tc-ctl-wlm-del-all tc-hidden" title="'+s(i(n,"i18n").call(o,"removeAllLayersFromMap",{name:"i18n",hash:{},data:a,loc:{start:{line:1,column:113},end:{line:1,column:146}}}))+'"></button></h2>\r\n<div class="tc-ctl-wlm-empty">'+s(i(n,"i18n").call(o,"noData",{name:"i18n",hash:{},data:a,loc:{start:{line:2,column:30},end:{line:2,column:47}}}))+'</div>\r\n<div class="tc-ctl-wlm-content tc-hidden">\r\n    <ul>'+(null!=(r=i(n,"each").call(o,null!=t?i(t,"workLayers"):t,{name:"each",hash:{},fn:e.program(1,a,0),inverse:e.noop,data:a,loc:{start:{line:4,column:8},end:{line:4,column:57}}}))?r:"")+"</ul>\r\n</div>"},usePartial:!0,useData:!0};e.template[e.CLASS+"-elm"]={1:function(e,t,n,l,a){var r=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return e.escapeExpression(e.lambda(null!=t?r(t,"title"):t,t))},3:function(e,t,n,l,a){var r,o=null!=t?t:e.nullContext||{},s=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return(null!=(r=s(n,"unless").call(o,a&&s(a,"first"),{name:"unless",hash:{},fn:e.program(4,a,0),inverse:e.noop,data:a,loc:{start:{line:3,column:89},end:{line:3,column:126}}}))?r:"")+(null!=(r=s(n,"each").call(o,t,{name:"each",hash:{},fn:e.program(6,a,0),inverse:e.noop,data:a,loc:{start:{line:3,column:126},end:{line:3,column:196}}}))?r:"")},4:function(e,t,n,l,a){return" &bull; "},6:function(e,t,n,l,a){var r,o=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return(null!=(r=o(n,"unless").call(null!=t?t:e.nullContext||{},a&&o(a,"first"),{name:"unless",hash:{},fn:e.program(7,a,0),inverse:e.noop,data:a,loc:{start:{line:3,column:140},end:{line:3,column:179}}}))?r:"")+e.escapeExpression(e.lambda(t,t))},7:function(e,t,n,l,a){return" &rsaquo; "},9:function(e,t,n,l,a){var r;return"<span>"+(null!=(r=(e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]})(n,"each").call(null!=t?t:e.nullContext||{},t,{name:"each",hash:{},fn:e.program(6,a,0),inverse:e.noop,data:a,loc:{start:{line:3,column:244},end:{line:3,column:314}}}))?r:"")+"</span>"},11:function(e,t,n,l,a){var r=null!=t?t:e.nullContext||{},o=e.escapeExpression,s=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<button class="tc-ctl-wlm-btn-zoom" title="'+o(s(n,"i18n").call(r,"zoomToLayerExtent",{name:"i18n",hash:{},data:a,loc:{start:{line:6,column:68},end:{line:6,column:96}}}))+'">'+o(s(n,"i18n").call(r,"zoomToLayerExtent",{name:"i18n",hash:{},data:a,loc:{start:{line:6,column:98},end:{line:6,column:126}}}))+"</button>"},13:function(e,t,n,l,a){return"disabled"},15:function(e,t,n,l,a){var r=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'title="'+e.escapeExpression(r(n,"i18n").call(null!=t?t:e.nullContext||{},"removeLayerFromMap",{name:"i18n",hash:{},data:a,loc:{start:{line:7,column:85},end:{line:7,column:114}}}))+'"'},17:function(e,t,n,l,a){return'checked="checked"'},19:function(e,t,n,l,a){var r,o=null!=t?t:e.nullContext||{},s=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'            <div class="tc-ctl-wlm-abstract">\r\n                <h4>'+e.escapeExpression(s(n,"i18n").call(o,"abstract",{name:"i18n",hash:{},data:a,loc:{start:{line:15,column:20},end:{line:15,column:39}}}))+"</h4>\r\n"+(null!=(r=s(n,"each").call(o,null!=t?s(t,"abstract"):t,{name:"each",hash:{},fn:e.program(20,a,0),inverse:e.noop,data:a,loc:{start:{line:16,column:16},end:{line:18,column:25}}}))?r:"")+"            </div>\r\n"},20:function(e,t,n,l,a){var r;return"                <div><pre>"+(null!=(r=e.lambda(t,t))?r:"")+"</pre></div>\r\n"},22:function(e,t,n,l,a){var r,o=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'            <ul class="tc-ctl-wlm-custom-legend">\r\n                '+(null!=(r=e.lambda(null!=t?o(t,"customLegend"):t,t))?r:"")+"\r\n            </ul>\r\n"},24:function(e,t,n,l,a){var r,o=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return null!=(r=o(n,"if").call(null!=t?t:e.nullContext||{},null!=(r=null!=t?o(t,"legend"):t)?o(r,"length"):r,{name:"if",hash:{},fn:e.program(25,a,0),inverse:e.noop,data:a,loc:{start:{line:26,column:16},end:{line:35,column:23}}}))?r:""},25:function(e,t,n,l,a){var r,o=e.escapeExpression,s=null!=t?t:e.nullContext||{},i=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'                <div class="tc-ctl-wlm-legend" data-layer-name="'+o(e.lambda(null!=t?i(t,"layerNames"):t,t))+'">\r\n                    <h4>'+o(i(n,"i18n").call(s,"content",{name:"i18n",hash:{},data:a,loc:{start:{line:28,column:24},end:{line:28,column:42}}}))+"</h4>\r\n"+(null!=(r=i(n,"each").call(s,null!=t?i(t,"legend"):t,{name:"each",hash:{},fn:e.program(26,a,0),inverse:e.noop,data:a,loc:{start:{line:29,column:20},end:{line:33,column:29}}}))?r:"")+"                </div>\r\n"},26:function(e,t,n,l,a){var r;return null!=(r=(e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]})(n,"each").call(null!=t?t:e.nullContext||{},t,{name:"each",hash:{},fn:e.program(27,a,0),inverse:e.noop,data:a,loc:{start:{line:30,column:24},end:{line:32,column:33}}}))?r:""},27:function(e,t,n,l,a){var r=e.lambda,o=e.escapeExpression,s=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return"                    <div><p>"+o(r(null!=t?s(t,"title"):t,t))+'</p><img data-img="'+o(r(null!=t?s(t,"src"):t,t))+'" /></div>\r\n'},29:function(e,t,n,l,a){var r,o=null!=t?t:e.nullContext||{},s=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'            <div class="tc-ctl-wlm-metadata">\r\n                <h4>'+e.escapeExpression(s(n,"i18n").call(o,"metadata",{name:"i18n",hash:{},data:a,loc:{start:{line:39,column:20},end:{line:39,column:39}}}))+"</h4>\r\n                <ul>\r\n"+(null!=(r=s(n,"each").call(o,null!=t?s(t,"metadata"):t,{name:"each",hash:{},fn:e.program(30,a,0),inverse:e.noop,data:a,loc:{start:{line:41,column:20},end:{line:49,column:29}}}))?r:"")+"                </ul>\r\n            </div>\r\n"},30:function(e,t,n,l,a){var r;return"                    <li>\r\n                        <ul>\r\n"+(null!=(r=(e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]})(n,"each").call(null!=t?t:e.nullContext||{},t,{name:"each",hash:{},fn:e.program(31,a,0),inverse:e.noop,data:a,loc:{start:{line:44,column:24},end:{line:46,column:33}}}))?r:"")+"                        </ul>\r\n                    </li>\r\n"},31:function(e,t,n,l,a){var r,o=e.lambda,s=e.escapeExpression,i=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'                            <li><a href="'+(null!=(r=o(null!=t?i(t,"url"):t,t))?r:"")+'" type="'+s(o(null!=t?i(t,"format"):t,t))+'" title="'+s(o(null!=t?i(t,"formatDescription"):t,t))+'" target="_blank">'+s(o(null!=t?i(t,"formatDescription"):t,t))+"</a></li>\r\n"},compiler:[8,">= 4.3.0"],main:function(e,t,n,l,a){var r,o=null!=t?t:e.nullContext||{},s=e.escapeExpression,i=e.lambda,c=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<li class="tc-ctl-wlm-elm" tabindex="-1">\r\n    <div class="tc-ctl-wlm-lyr">'+(null!=(r=c(n,"if").call(o,null!=t?c(t,"path"):t,{name:"if",hash:{},fn:e.program(1,a,0),inverse:e.noop,data:a,loc:{start:{line:2,column:32},end:{line:2,column:60}}}))?r:"")+'</div>\r\n    <div class="tc-ctl-wlm-type"></div><div class="tc-ctl-wlm-path" title="'+(null!=(r=c(n,"each").call(o,null!=t?c(t,"path"):t,{name:"each",hash:{},fn:e.program(3,a,0),inverse:e.program(1,a,0),data:a,loc:{start:{line:3,column:75},end:{line:3,column:222}}}))?r:"")+'">'+(null!=(r=c(n,"each").call(o,null!=t?c(t,"path"):t,{name:"each",hash:{},fn:e.program(9,a,0),inverse:e.program(1,a,0),data:a,loc:{start:{line:3,column:224},end:{line:3,column:347}}}))?r:"")+'</div>\r\n    <div class="tc-ctl-wlm-buttons">\r\n        <div class="tc-ctl-wlm-tools"></div>\r\n        '+(null!=(r=c(n,"if").call(o,null!=t?c(t,"hasExtent"):t,{name:"if",hash:{},fn:e.program(11,a,0),inverse:e.noop,data:a,loc:{start:{line:6,column:8},end:{line:6,column:142}}}))?r:"")+'\r\n        <button class="tc-ctl-wlm-btn-del" '+(null!=(r=c(n,"if").call(o,null!=t?c(t,"unremovable"):t,{name:"if",hash:{},fn:e.program(13,a,0),inverse:e.program(15,a,0),data:a,loc:{start:{line:7,column:43},end:{line:7,column:122}}}))?r:"")+">"+s(c(n,"i18n").call(o,"removeLayerFromMap",{name:"i18n",hash:{},data:a,loc:{start:{line:7,column:123},end:{line:7,column:152}}}))+'</button>\r\n        <input type="checkbox" id="tc-ctl-wlm-tools-visibility-'+s(i(null!=t?c(t,"id"):t,t))+'" class="tc-ctl-wlm-tools-visibility" '+(null!=(r=c(n,"unless").call(o,null!=t?c(t,"hide"):t,{name:"unless",hash:{},fn:e.program(17,a,0),inverse:e.noop,data:a,loc:{start:{line:8,column:107},end:{line:8,column:151}}}))?r:"")+' title="'+s(c(n,"i18n").call(o,"visibilityOfThisLayer",{name:"i18n",hash:{},data:a,loc:{start:{line:8,column:159},end:{line:8,column:191}}}))+'" />\r\n        <label for="tc-ctl-wlm-tools-visibility-'+s(i(null!=t?c(t,"id"):t,t))+'" title="'+s(c(n,"i18n").call(o,"visibilityOfThisLayer",{name:"i18n",hash:{},data:a,loc:{start:{line:9,column:63},end:{line:9,column:95}}}))+'" class="tc-ctl-wlm-tools-visibility-label">'+s(c(n,"i18n").call(o,"visibilityOfThisLayer",{name:"i18n",hash:{},data:a,loc:{start:{line:9,column:139},end:{line:9,column:171}}}))+'</label>\r\n        <input type="range" value="'+s(i(null!=t?c(t,"opacity"):t,t))+'" title="'+s(c(n,"i18n").call(o,"transparencyOfThisLayer",{name:"i18n",hash:{},data:a,loc:{start:{line:10,column:55},end:{line:10,column:89}}}))+'" />\r\n    </div>\r\n        <div class="tc-ctl-wlm-info tc-hidden">\r\n'+(null!=(r=c(n,"if").call(o,null!=(r=null!=t?c(t,"abstract"):t)?c(r,"length"):r,{name:"if",hash:{},fn:e.program(19,a,0),inverse:e.noop,data:a,loc:{start:{line:13,column:12},end:{line:20,column:19}}}))?r:"")+(null!=(r=c(n,"if").call(o,null!=t?c(t,"customLegend"):t,{name:"if",hash:{},fn:e.program(22,a,0),inverse:e.program(24,a,0),data:a,loc:{start:{line:21,column:12},end:{line:36,column:19}}}))?r:"")+(null!=(r=c(n,"if").call(o,null!=(r=null!=t?c(t,"metadata"):t)?c(r,"length"):r,{name:"if",hash:{},fn:e.program(29,a,0),inverse:e.noop,data:a,loc:{start:{line:37,column:12},end:{line:52,column:19}}}))?r:"")+'        </div>\r\n    <div class="tc-ctl-wlm-dd" title="'+s(c(n,"i18n").call(o,"dragToReorder",{name:"i18n",hash:{},data:a,loc:{start:{line:54,column:38},end:{line:54,column:62}}}))+'"></div>\r\n</li>'},useData:!0};e.template[e.CLASS+"-type-sgl"]={compiler:[8,">= 4.3.0"],main:function(e,t,n,l,a){var r=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return e.escapeExpression(r(n,"i18n").call(null!=t?t:e.nullContext||{},"singleLayer",{name:"i18n",hash:{},data:a,loc:{start:{line:1,column:0},end:{line:1,column:22}}}))},useData:!0};e.template[e.CLASS+"-type-grp"]={1:function(e,t,n,l,a){var r,o=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return null!=(r=e.invokePartial(o(l,"tc-ctl-wlm-type-grp-node"),t,{name:"tc-ctl-wlm-type-grp-node",data:a,indent:"    ",helpers:n,partials:l,decorators:e.decorators}))?r:""},compiler:[8,">= 4.3.0"],main:function(e,t,n,l,a){var r,o=null!=t?t:e.nullContext||{},s=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return"<div>"+e.escapeExpression(s(n,"i18n").call(o,"groupLayerThatContains",{name:"i18n",hash:{},data:a,loc:{start:{line:1,column:5},end:{line:1,column:38}}}))+":</div>\r\n<ul>\r\n"+(null!=(r=s(n,"each").call(o,null!=t?s(t,"Layer"):t,{name:"each",hash:{},fn:e.program(1,a,0),inverse:e.noop,data:a,loc:{start:{line:3,column:4},end:{line:5,column:13}}}))?r:"")+"</ul>"},usePartial:!0,useData:!0};e.template[e.CLASS+"-type-grp-node"]={1:function(e,t,n,l,a){var r,o=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return null!=(r=e.invokePartial(o(l,"tc-ctl-wlm-type-grp-node"),t,{name:"tc-ctl-wlm-type-grp-node",data:a,indent:"        ",helpers:n,partials:l,decorators:e.decorators}))?r:""},compiler:[8,">= 4.3.0"],main:function(e,t,n,l,a){var r,o=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<li class="tc-ctl-ltoc-tip-grp-elm">\r\n    <span>'+e.escapeExpression(e.lambda(null!=t?o(t,"Title"):t,t))+"</span>\r\n    <ul>\r\n"+(null!=(r=o(n,"each").call(null!=t?t:e.nullContext||{},null!=t?o(t,"Layer"):t,{name:"each",hash:{},fn:e.program(1,a,0),inverse:e.noop,data:a,loc:{start:{line:4,column:8},end:{line:6,column:17}}}))?r:"")+"    </ul>\r\n</li>"},usePartial:!0,useData:!0};const t=function(e,t){return e.getLayerUIElements().filter(function(e){return e.dataset.layerId===t.id})[0]};var n=function(e){return e.layers.length};const l=function(e){return!e.layers.some(function(e){return e.unremovable})},a=function(e,t,n,l,a){const r=e.getLayerUIElements();var o;if(l>n)o=r[l-1];else{if(!(l<n))return;o=r[l+1]}const s=e.map.getLayer(t.dataset.layerId),i=e.map.getLayer(o.dataset.layerId),c=e.map.layers.indexOf(i);c>=1&&c<e.map.layers.length&&e.map.insertLayer(s,c,a)};e.render=function(e,t){const n=this;return n._set1stRenderPromise(n.map?n.renderData(t?TC.Util.extend(n.map.getLayerTree(),t):n.map.getLayerTree(),function(){n.addUIEventListeners();TC.loadJS(!window.Sortable,[TC.apiLocation+"lib/sortable/Sortable.min.js"],function(){n.map.workLayers.filter(function(e){return!e.stealth}).forEach(function(e){n.updateLayerTree(e)});const t=n.div.querySelector("ul");n._sortable=Sortable.create(t,{handle:"."+n.CLASS+"-dd",animation:150,onSort:function(e){a(n,e.item,e.oldIndex,e.newIndex)}});t.addEventListener("keydown",TC.EventTarget.listenerBySelector("li",function(e){for(var t=e.target;"LI"!==t.tagName;)if(!(t=t.parentElement))return;const l=function(e,l){const r=n._sortable.toArray(),o=r[e];r[e]=r[l];r[l]=o;n._sortable.sort(r);a(n,t,e,l)},r=n.getLayerUIElements(),o=r.indexOf(t);switch(!0){case/Up$/.test(e.key):if(o>0){l(o,o-1);t.focus();e.stopPropagation()}break;case/Down$/.test(e.key):if(o<r.length-1){l(o,o+1);t.focus();e.stopPropagation()}break;case/Enter$/.test(e.key):t.blur();e.stopPropagation()}}));"function"==typeof e&&e()})}):Promise.reject(Error("Cannot render: control has no map")))};e.register=function(e){const n=this;return new Promise(function(l,a){TC.control.TOC.prototype.register.call(n,e).then(function(){e.loaded(function(){n.updateScale()});e.on(TC.Consts.event.LAYEROPACITY,function(e){const l=t(n,e.layer);l&&(l.querySelector("input[type=range]").value=Math.round(100*e.opacity))}).on(TC.Consts.event.FEATURESIMPORT,function(t){var l=t.fileName;if(t.features&&t.features.length>0){var a="."+TC.Consts.format.GPX.toLowerCase();if(t.fileName.toLowerCase().indexOf(a)===t.fileName.length-a.length)return;e.one(TC.Consts.event.LAYERADD,function(e){if(e&&e.layer&&e.layer.title==l){n.map&&n.map.layout&&n.map.layout.accordion&&n.div.classList.contains(TC.Consts.classes.COLLAPSED)&&n.map.controls.filter(function(e){return e!==n&&!e.containerControl}).forEach(function(e){e.div.classList.add(TC.Consts.classes.COLLAPSED)});n.map.trigger(TC.Consts.event.TOOLSOPEN);n.div.classList.remove(TC.Consts.classes.COLLAPSED)}})}});l(n)})})};e.onExternalServiceAdded=function(e){};e.addUIEventListeners=function(){const e=this;e.div.addEventListener(e.CLICKEVENT,TC.EventTarget.listenerBySelector(`input.${e.CLASS}-tools-visibility[type="checkbox"]`,function(t){const n=t.target;var l=n;do{l=l.parentElement}while(l&&!l.matches("li."+e.CLASS+"-elm"));e.map.getLayer(l.dataset.layerId).setVisibility(n.checked);t.stopPropagation()}));const t=function(t){const n=t.target;var l=n;do{l=l.parentElement}while(l&&"LI"!==l.tagName);e.map.getLayer(l.dataset.layerId).setOpacity(n.value/100)};e.div.addEventListener("change",TC.EventTarget.listenerBySelector("input[type=range]",t));e.div.addEventListener("input",TC.EventTarget.listenerBySelector("input[type=range]",t));e.div.addEventListener(e.CLICKEVENT,TC.EventTarget.listenerBySelector(`.${e.CLASS}-btn-del:not(.disabled)`,function(t){var n=t.target;do{n=n.parentElement}while(n&&"LI"!==n.tagName);const l=e.map.getLayer(n.dataset.layerId);e.map.removeLayer(l)}));e.div.addEventListener(e.CLICKEVENT,TC.EventTarget.listenerBySelector("."+e.CLASS+"-del-all",function(t){TC.confirm(e.getLocaleString("layersRemove.confirm"),function(){e.getLayerUIElements().map(function(t){return e.map.getLayer(t.dataset.layerId)}).forEach(function(t){e.map.removeLayer(t)})})}))};e.updateLayerVisibility=function(e){const n=this,l=t(n,e);if(l){const t=e.getVisibility();l.querySelector(`input.${n.CLASS}-tools-visibility[type="checkbox"]`).checked=t}};e.updateLayerTree=function(e){var t=this;if(!e.isBase&&!e.options.stealth){TC.control.MapContents.prototype.updateLayerTree.call(t,e);for(var a=!1,r=0,o=t.layers.length;r<o;r++)if(e===t.layers[r]){a=!0;break}if(a){for(i=e.title||e.wrap.getServiceTitle();t.layers.filter(function(t){return t!==e&&e._timeStamp!==t._timeStamp}).find(function(e){return(e._title||e.title)===i});){var s=new RegExp(/(.+\.\w+ )\(([0-9]+)\)$/gi).exec(i);i=s?s[1]+"("+(parseInt(s[2],10)+1)+")":i+" (2)"}e._title=i;const n=t.div.querySelector("ul li[data-layer-id='"+e.id+"']");if(e.features&&e.features.length)if(e.features[0].getPath().length){n.querySelector(".tc-ctl-wlm-lyr").innerHTML=i;n.querySelector(".tc-ctl-wlm-path").innerHTML=e.features[0].getPath().join(" &bull; ")}else n.querySelector(".tc-ctl-wlm-path").innerHTML=i}else{t.layers.push(e);var i=e.title||e.wrap.getServiceTitle&&e.wrap.getServiceTitle();e._title=i;var c={title:e.options.hideTitle?"":i,hide:!(!e.renderOptions||!e.renderOptions.hide),opacity:e.renderOptions&&e.renderOptions.opacity?100*e.renderOptions.opacity:100,customLegend:e.customLegend,unremovable:e.unremovable,id:e.id},u=e.isRaster();if(u){c.hasExtent=!!e.getExtent();c.layerNames=e.layerNames;const t=e.names.map(t=>e.getPath(t));t.forEach(e=>e.shift());c.path=t;c.legend=[];c.abstract=[];c.metadata=[];e.names.forEach(function(t){var n=e.getInfo(t);c.legend.push(n.legend);c.abstract.push(n.abstract);c.metadata.push(n.metadata)})}else c.hasExtent=!0;(function(e){return new Promise(function(t,n){e&&e.options.method&&"POST"===e.options.method?e.getLegendGraphicImage().then(function(e){t(e)}).catch(function(e){TC.error(e)}):t()})})(e).then(function(n){n&&(legend.src=n);t.getRenderedHtml(t.CLASS+"-elm",c).then(function(n){const l=(new DOMParser).parseFromString(n,"text/html").body.firstChild;var a,r=!1;if(u&&!(r=e.names.length>1))for(var o=e.wrap.getAllLayerNodes(),s=0;s<o.length;s++){var i=o[s];if(e.wrap.getName(i)===name){a=i;e.wrap.getLayerNodes(i).length>0&&(r=!0);break}}const c=l.querySelector("."+t.CLASS+"-type"),d=r?t.CLASS+"-type-grp":t.CLASS+"-type-sgl";c.classList.add(d);const p=l.querySelector(`.${t.CLASS}-btn-zoom`);p&&p.addEventListener(TC.Consts.event.CLICK,function(e){t.map.zoomToLayer(l.dataset.layerId,{animate:!0})},{passive:!0});if(a){e.wrap.normalizeLayerNode(a);t.getRenderedHtml(d,a).then(function(e){var n;c.addEventListener("mouseover",function(l){const a=t.map.div,r=c.getBoundingClientRect();(n=document.createElement("div")).classList.add(t.CLASS+"-tip");n.innerHTML=e;n.style.top=r.top-a.offsetTop+"px";n.style.right=a.offsetWidth-(r.left-a.offsetLeft)+"px";a.appendChild(n)});c.addEventListener("mouseout",function(e){n.parentElement.removeChild(n)})})}const m=t.div.querySelector("ul");l.dataset.layerId=e.id;const f=t.getLayerUIElements(),y=t.map.workLayers.filter(function(e){return!e.stealth}),h=y.indexOf(e);t.layerTools.forEach(e=>t.addLayerToolUI(l,e));for(var v=!1,L=(s=0,f.length);s<L;s++){const e=f[s];if(y.indexOf(t.map.getLayer(e.dataset.layerId))<h){e.insertAdjacentElement("beforebegin",l);v=!0;break}}v||m.appendChild(l);void 0;t.updateScale()})});var d=n(t);const a=t.div.querySelector("."+t.CLASS+"-n"),r=t.div.querySelector("."+t.CLASS+"-empty"),o=t.div.querySelector("."+t.CLASS+"-content");a.textContent=d;if(d>0){a.classList.add(TC.Consts.classes.VISIBLE);r.classList.add(TC.Consts.classes.HIDDEN);o.classList.remove(TC.Consts.classes.HIDDEN)}else{a.classList.remove(TC.Consts.classes.VISIBLE);r.classList.remove(TC.Consts.classes.HIDDEN);o.classList.add(TC.Consts.classes.HIDDEN)}t.div.querySelector("."+t.CLASS+"-del-all").classList.toggle(TC.Consts.classes.HIDDEN,!l(t))}}};e.updateScale=function(){var e=this;e.getLayerUIElements().forEach(function(t){var n=e.map.getLayer(t.dataset.layerId);if(n&&n.names){for(var l=!1,a=0;a<n.names.length;a++)if(n.isVisibleByScale(n.names[a])){l=!0;break}t.classList.toggle(e.CLASS+"-elm-notvisible",!l)}})};e.update=function(){var e=this;e.getLayerUIElements().forEach(function(t){const n=e.map.getLayer(t.dataset.layerId);if(n){(function(t){return t.querySelector(`input.${e.CLASS}-tools-visibility[type="checkbox"]`)}(t)).checked=n.getVisibility();n.tree=null}});e.updateScale()};e.updateLayerOrder=function(e,n,l){const a=this;a.map.workLayers.filter(function(e){return!e.stealth}).forEach(function(e){const n=t(a,e);n&&n.parentElement.firstChild.insertAdjacentElement("beforebegin",n)})};e.removeLayer=function(e){var t=this.layers.indexOf(e);t>=0&&this.layers.splice(t,1);this.getLayerUIElements().forEach(function(t){t.dataset.layerId===e.id&&t.parentElement.removeChild(t)});const a=this.div.querySelector("."+this.CLASS+"-content"),r=this.div.querySelector("."+this.CLASS+"-empty"),o=this.div.querySelector("."+this.CLASS+"-n");var s=n(this);o.textContent=s;if(s>0){a.classList.remove(TC.Consts.classes.HIDDEN);r.classList.add(TC.Consts.classes.HIDDEN);o.classList.add(TC.Consts.classes.VISIBLE)}else{l(this)&&this.div.querySelector("."+this.CLASS+"-del-all").classList.add(TC.Consts.classes.HIDDEN);a.classList.add(TC.Consts.classes.HIDDEN);r.classList.remove(TC.Consts.classes.HIDDEN);o.classList.remove(TC.Consts.classes.VISIBLE)}};e.getLayerUIElements=function(){return Array.from(this.div.querySelectorAll(`ul > li.${this.CLASS}-elm`))};e.addLayerToolUI=function(e,t){const n=this;if(TC.Util.isFunction(t.renderFn)){const l=t.renderFn(e.querySelector(`.${n.CLASS}-tools`),e.dataset.layerId);if(l){if(TC.Util.isFunction(t.actionFn)){const e="checkbox"===l.getAttribute("type")?"change":TC.Consts.event.CLICK;l.addEventListener(e,function(e){t.actionFn.call(l)},{passive:!0})}TC.Util.isFunction(t.updateFn)&&t.updateEvents&&map.on(t.updateEvents.join(" "),function(e){e.layer&&e.layer.id!==l.dataset.layerId||t.updateFn.call(l,e)})}}};e.addLayerTool=function(e){const t=this;t.layerTools.push(e);t.getLayerUIElements().forEach(function(n){t.addLayerToolUI(n,e)})}}();
//# sourceMappingURL=../maps/control/WorkLayerManager.min.js.map