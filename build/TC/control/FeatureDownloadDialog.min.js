TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.control.FeatureDownloadDialog=function(){TC.Control.apply(this,arguments);this.title=this.options.title;this.cssClass=this.options.cssClass||"";this._selectors={ELEVATION_CHECKBOX:"."+this.CLASS+"-elev input[type=checkbox]",INTERPOLATION_PANEL:"."+this.CLASS+"-ip",INTERPOLATION_RADIO:`input[type=radio][name=${this.id}-finfo-ip-coords]`,INTERPOLATION_DISTANCE:"."+this.CLASS+"-ip-m"};this.features=[];this.options={}};TC.inherit(TC.control.FeatureDownloadDialog,TC.Control);!function(){const t=TC.control.FeatureDownloadDialog.prototype;t.CLASS="tc-ctl-dldlog";var e,n=["KMZ","GML","GeoJSON","WKT","GPX","SHP","GPKG"],l=!1,o=null;t.template={};t.template[t.CLASS]={1:function(t,e,n,l,o){var a,r=t.lambda,s=t.escapeExpression,i=null!=e?e:t.nullContext||{},c=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'            <div class="tc-ctl-dldlog-elev">\r\n                <input id="'+s(r(null!=e?c(e,"checkboxId"):e,e))+'" type="checkbox" '+(null!=(a=c(n,"if").call(i,null!=(a=null!=e?c(e,"elevation"):e)?c(a,"checked"):a,{name:"if",hash:{},fn:t.program(2,o,0),inverse:t.noop,data:o,loc:{start:{line:11,column:59},end:{line:11,column:98}}}))?a:"")+'>\r\n                <label for="'+s(r(null!=e?c(e,"checkboxId"):e,e))+'" class="tc-ctl-dldlog-elev-label">'+s(c(n,"i18n").call(i,"includeElevations",{name:"i18n",hash:{},data:o,loc:{start:{line:12,column:77},end:{line:12,column:105}}}))+'</label>\r\n            </div>\r\n            <div class="tc-ctl-dldlog-ext">\r\n            </div>\r\n'+(null!=(a=c(n,"if").call(i,null!=(a=null!=e?c(e,"elevation"):e)?c(a,"resolution"):a,{name:"if",hash:{},fn:t.program(4,o,0),inverse:t.noop,data:o,loc:{start:{line:16,column:12},end:{line:29,column:19}}}))?a:"")},2:function(t,e,n,l,o){return"checked"},4:function(t,e,n,l,o){var a,r=null!=e?e:t.nullContext||{},s=t.escapeExpression,i=t.lambda,c=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'            <div class="tc-ctl-dldlog-ip tc-hidden">\r\n                <h4>'+s(c(n,"i18n").call(r,"interpolateCoordsFromElevProfile",{name:"i18n",hash:{},data:o,loc:{start:{line:18,column:20},end:{line:18,column:63}}}))+'</h4>\r\n                <label>\r\n                    <input type="radio" name="'+s(i(null!=e?c(e,"controlId"):e,e))+'-finfo-ip-coords" value="0" checked />\r\n                    <span>'+s(c(n,"i18n").call(r,"no",{name:"i18n",hash:{},data:o,loc:{start:{line:21,column:26},end:{line:21,column:39}}}))+'</span>\r\n                </label>\r\n                <label>\r\n                    <input type="radio" name="'+s(i(null!=e?c(e,"controlId"):e,e))+'-finfo-ip-coords" value="1" />\r\n                    <span>'+s(c(n,"i18n").call(r,"yes",{name:"i18n",hash:{},data:o,loc:{start:{line:25,column:26},end:{line:25,column:40}}}))+'</span>\r\n                </label>\r\n                <div class="tc-ctl-dldlog-ip-m tc-hidden">'+s(c(n,"i18n").call(r,"interpolateEveryXMeters.1",{name:"i18n",hash:{},data:o,loc:{start:{line:27,column:58},end:{line:27,column:94}}}))+'<input type="number" min="1" step="1" class="tc-textbox" value="'+s(i(null!=(a=null!=e?c(e,"elevation"):e)?c(a,"resolution"):a,e))+'" />'+s(c(n,"i18n").call(r,"interpolateEveryXMeters.2",{name:"i18n",hash:{},data:o,loc:{start:{line:27,column:186},end:{line:27,column:222}}}))+"</div>\r\n            </div>\r\n"},6:function(t,e,n,l,o){var a,r=null!=e?e:t.nullContext||{},s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(a=s(n,"if").call(r,s(n,"eq").call(r,e,"KML",{name:"eq",hash:{},data:o,loc:{start:{line:34,column:26},end:{line:34,column:41}}}),{name:"if",hash:{},fn:t.program(7,o,0),inverse:t.program(9,o,0),data:o,loc:{start:{line:34,column:20},end:{line:50,column:28}}}))?a:""},7:function(t,e,n,l,o){return'<button class="tc-button tc-btn-dl tc-ctl-dldlog-btn-kml" data-format="KML" title="KML">KML</button>'},9:function(t,e,n,l,o){var a,r=null!=e?e:t.nullContext||{},s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(a=s(n,"if").call(r,s(n,"eq").call(r,e,"KMZ",{name:"eq",hash:{},data:o,loc:{start:{line:36,column:31},end:{line:36,column:46}}}),{name:"if",hash:{},fn:t.program(10,o,0),inverse:t.program(12,o,0),data:o,loc:{start:{line:36,column:20},end:{line:50,column:20}}}))?a:""},10:function(t,e,n,l,o){return'<button class="tc-button tc-btn-dl tc-ctl-dldlog-btn-kmz" data-format="KMZ" title="KML">KML</button>'},12:function(t,e,n,l,o){var a,r=null!=e?e:t.nullContext||{},s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(a=s(n,"if").call(r,s(n,"eq").call(r,e,"GML",{name:"eq",hash:{},data:o,loc:{start:{line:38,column:31},end:{line:38,column:46}}}),{name:"if",hash:{},fn:t.program(13,o,0),inverse:t.program(15,o,0),data:o,loc:{start:{line:38,column:20},end:{line:50,column:20}}}))?a:""},13:function(t,e,n,l,o){return'<button class="tc-button tc-btn-dl tc-ctl-dldlog-btn-gml" data-format="GML" title="GML">GML</button>'},15:function(t,e,n,l,o){var a,r=null!=e?e:t.nullContext||{},s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(a=s(n,"if").call(r,s(n,"eq").call(r,e,"GeoJSON",{name:"eq",hash:{},data:o,loc:{start:{line:40,column:31},end:{line:40,column:50}}}),{name:"if",hash:{},fn:t.program(16,o,0),inverse:t.program(18,o,0),data:o,loc:{start:{line:40,column:20},end:{line:50,column:20}}}))?a:""},16:function(t,e,n,l,o){return'<button class="tc-button tc-btn-dl tc-ctl-dldlog-btn-geojson" data-format="GeoJSON" title="GeoJSON">GeoJSON</button>'},18:function(t,e,n,l,o){var a,r=null!=e?e:t.nullContext||{},s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(a=s(n,"if").call(r,s(n,"eq").call(r,e,"WKT",{name:"eq",hash:{},data:o,loc:{start:{line:42,column:31},end:{line:42,column:46}}}),{name:"if",hash:{},fn:t.program(19,o,0),inverse:t.program(21,o,0),data:o,loc:{start:{line:42,column:20},end:{line:50,column:20}}}))?a:""},19:function(t,e,n,l,o){return'<button class="tc-button tc-btn-dl tc-ctl-dldlog-btn-wkt" data-format="WKT" title="WKT">WKT</button>'},21:function(t,e,n,l,o){var a,r=null!=e?e:t.nullContext||{},s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(a=s(n,"if").call(r,s(n,"eq").call(r,e,"GPX",{name:"eq",hash:{},data:o,loc:{start:{line:44,column:31},end:{line:44,column:46}}}),{name:"if",hash:{},fn:t.program(22,o,0),inverse:t.program(24,o,0),data:o,loc:{start:{line:44,column:20},end:{line:50,column:20}}}))?a:""},22:function(t,e,n,l,o){return'<button class="tc-button tc-btn-dl tc-ctl-dldlog-btn-gpx" data-format="GPX" title="GPX">GPX</button>'},24:function(t,e,n,l,o){var a,r=null!=e?e:t.nullContext||{},s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(a=s(n,"if").call(r,s(n,"eq").call(r,e,"SHP",{name:"eq",hash:{},data:o,loc:{start:{line:46,column:31},end:{line:46,column:46}}}),{name:"if",hash:{},fn:t.program(25,o,0),inverse:t.program(27,o,0),data:o,loc:{start:{line:46,column:20},end:{line:50,column:20}}}))?a:""},25:function(t,e,n,l,o){return'<button class="tc-button tc-btn-dl tc-ctl-dldlog-btn-shp" data-format="SHP" title="Shapefile">Shapefile</button>'},27:function(t,e,n,l,o){var a,r=null!=e?e:t.nullContext||{},s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(a=s(n,"if").call(r,s(n,"eq").call(r,e,"GPKG",{name:"eq",hash:{},data:o,loc:{start:{line:48,column:31},end:{line:48,column:47}}}),{name:"if",hash:{},fn:t.program(28,o,0),inverse:t.noop,data:o,loc:{start:{line:48,column:20},end:{line:50,column:20}}}))?a:""},28:function(t,e,n,l,o){return'<button class="tc-button tc-btn-dl tc-ctl-dldlog-btn-gpkg" data-format="GPKG" title="GeoPackage">GeoPackage</button>'},compiler:[8,">= 4.3.0"],main:function(t,e,n,l,o){var a,r=t.lambda,s=t.escapeExpression,i=null!=e?e:t.nullContext||{},c=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<div class="tc-ctl-dldlog tc-modal '+s(r(null!=e?c(e,"cssClass"):e,e))+'">\r\n    <div class="tc-modal-background tc-modal-close"></div>\r\n    <div class="tc-modal-window">\r\n        <div class="tc-modal-header">\r\n            <h3>'+s(r(null!=e?c(e,"title"):e,e))+'</h3>\r\n            <div class="tc-modal-close"></div>\r\n        </div>\r\n        <div class="tc-modal-body">\r\n'+(null!=(a=c(n,"if").call(i,null!=e?c(e,"elevation"):e,{name:"if",hash:{},fn:t.program(1,o,0),inverse:t.noop,data:o,loc:{start:{line:9,column:12},end:{line:30,column:19}}}))?a:"")+'            <div class="tc-ctl-dldlog-dl">\r\n                <div>\r\n'+(null!=(a=c(n,"each").call(i,null!=e?c(e,"formats"):e,{name:"each",hash:{},fn:t.program(6,o,0),inverse:t.noop,data:o,loc:{start:{line:33,column:20},end:{line:51,column:29}}}))?a:"")+"                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>"},useData:!0};const a=function(){return this.getFeatures().some(t=>TC.feature.Polyline&&t instanceof TC.feature.Polyline||TC.feature.MultiPolyline&&t instanceof TC.feature.MultiPolyline)},r=function(){return this.getFeatures().some(t=>TC.feature.Polygon&&t instanceof TC.feature.Polygon||TC.feature.MultiPolygon&&t instanceof TC.feature.MultiPolygon)};t.render=function(t){return TC.Control.prototype.renderData.call(this,{controlId:this.id},t)};t.close=function(t){const e=this;if(e.modal&&e.modal.parentElement){TC.Util.closeModal();e.modal.parentElement.removeChild(e.modal)}};t.open=function(s,i){const c=this;c.close();c.setFeatures(s);i=i||{};const u=(i=Object.assign({},{controlId:c.id,cssClass:c.cssClass,checkboxId:c.getUID(),elevation:i.elevation},i)).excludedFormats?i.excludedFormats.slice():[];(function(){return this.getFeatures().some(t=>TC.feature.Point&&t instanceof TC.feature.Point||TC.feature.MultiPoint&&t instanceof TC.feature.MultiPoint)}).call(c)||a.call(c)||!r.call(c)||u.push(TC.Consts.format.GPX);i.formats=n.filter(t=>u.indexOf(t)<0);c.setOptions(i);c.getRenderedHtml(t.CLASS,i,function(t){const n=document.createElement("template");n.innerHTML=t;c.modal=n.content?n.content.firstChild:n.firstChild;document.body.appendChild(c.modal);const s=c.modalBody=c.modal.getElementsByClassName("tc-modal-body")[0];s.addEventListener(TC.Consts.event.CLICK,TC.EventTarget.listenerBySelector("button[data-format]",function(t){var n=e&&l?parseFloat(s.querySelector(c._selectors.INTERPOLATION_DISTANCE+" input[type=number]").value)||(c.options.elevation||c.map.elevation&&c.map.elevation.options).resolution:0;const o=async(t,l)=>{var o=!1;a!==TC.Consts.format.GEOJSON&&l.format!==TC.Consts.format.WKT&&t.some(function(t){for(var e in t.getData())if(t.data[e]instanceof Object)return!0;return!1})&&await TC.confirm(c.getLocaleString("dl.export.complexAttr").format(a),null,function(){o=!0});if(o)return;const r=c.map.getLoadingIndicator(),s=r&&r.addWait();TC.Util.closeModal();(function(t,e){const n=this;e=e||{};return new Promise(function(l,o){const a=function(t){const e=t.clone();e.id=t.id;return e};if(!e.displayElevation){l(t.map(function(t){if(t.getGeometryStride()>2){const e=a(t);e.id=t.id;e.layer=t.layer;e.getCoordsArray().forEach(t=>t.length=2);e.setCoords(e.geometry);return e}return t}));return}let r=e.elevation&&e.elevation.resolution,s=r?t.map(t=>a(t)):t.map(t=>t.getCoordsArray().every(t=>!t[2])?a(t):null);if(r||s.some(t=>null!==t)){const a={crs:n.map.crs,features:s,maxCoordQuantity:e.elevation&&e.elevation.maxCoordQuantity,resolution:e.elevation.resolution,sampleNumber:e.elevation.sampleNumber||0};(n.map.elevation||new TC.tool.Elevation("boolean"==typeof e.elevation?{}:e.elevation)).setGeometry(a).then(function(e){e.forEach((n,l)=>{n||(e[l]=t[l])});l(e)},function(t){o(t instanceof Error?t:Error(t))})}else l(t)})}).apply(c,[t,{displayElevation:e,elevation:e?Object.assign({},l.elevation||c.map.elevation&&c.map.elevation.options,{resolution:n}):null}]).then(function(t){let e=l?l.fileName||l.title.toLowerCase().replace(/ /g,"_")+"_"+TC.Util.getFormattedDate((new Date).toString(),!0)||"download_"+TC.Util.getFormattedDate((new Date).toString(),!0):l.title.toLowerCase().replace(/ /g,"_")+"_"+TC.Util.getFormattedDate((new Date).toString(),!0)||"download_"+TC.Util.getFormattedDate((new Date).toString(),!0);c.map.exportFeatures(t,{fileName:e,format:a})},function(e){c.open(t,l);TC.tool.Elevation&&e.message===TC.tool.Elevation.errors.MAX_COORD_QUANTITY_EXCEEDED?TC.alert(c.getLocaleString("tooManyCoordinatesForElevation.warning")):TC.error(c.getLocaleString("elevation.error"))}).finally(function(){r&&r.removeWait(s)})},a=t.target.dataset.format;a===TC.Consts.format.GPX&&r.call(c)?TC.confirm(c.getLocaleString("gpxNotCompatible.confirm"),function(){o(c.getFeatures().filter(function(t){return!(TC.feature.Polygon&&t instanceof TC.feature.Polygon||TC.feature.MultiPolygon&&t instanceof TC.feature.MultiPolygon)}),c.getOptions())}):o(c.getFeatures(),c.getOptions())}),{passive:!0});const u=s.querySelector(c._selectors.INTERPOLATION_PANEL),d=s.querySelector(c._selectors.ELEVATION_CHECKBOX);if(i.elevation){e=i.elevation.checked?i.elevation.checked:e;d.checked=e;if(u){e?u.classList.remove(TC.Consts.classes.HIDDEN):u.classList.contains(TC.Consts.classes.HIDDEN)||u.classList.add(TC.Consts.classes.HIDDEN);e&&(a.call(c)||r.call(c))&&i.elevation.resolution?u.classList.remove(TC.Consts.classes.HIDDEN):u.classList.contains(TC.Consts.classes.HIDDEN)||u.classList.add(TC.Consts.classes.HIDDEN);s.querySelectorAll(c._selectors.INTERPOLATION_RADIO)[l?1:0].checked=!0;if(l){s.querySelector(c._selectors.INTERPOLATION_DISTANCE).classList.remove(TC.Consts.classes.HIDDEN);s.querySelector(c._selectors.INTERPOLATION_DISTANCE+" input").value=o||s.querySelector(c._selectors.INTERPOLATION_DISTANCE+" input").value}}}s.addEventListener("change",TC.EventTarget.listenerBySelector(c._selectors.ELEVATION_CHECKBOX,function(t){e=!e;if(u){e?u.classList.remove(TC.Consts.classes.HIDDEN):u.classList.contains(TC.Consts.classes.HIDDEN)||u.classList.add(TC.Consts.classes.HIDDEN);e&&(a.call(c)||r.call(c))?u.classList.remove(TC.Consts.classes.HIDDEN):u.classList.contains(TC.Consts.classes.HIDDEN)||u.classList.add(TC.Consts.classes.HIDDEN)}}));s.addEventListener("change",TC.EventTarget.listenerBySelector(c._selectors.INTERPOLATION_RADIO,function(t){s.querySelector(c._selectors.INTERPOLATION_DISTANCE).classList.toggle(TC.Consts.classes.HIDDEN);(l=!l)&&(s.querySelector(c._selectors.INTERPOLATION_DISTANCE+" input").value=o||s.querySelector(c._selectors.INTERPOLATION_DISTANCE+" input").value)}));s.addEventListener("change",TC.EventTarget.listenerBySelector(c._selectors.INTERPOLATION_DISTANCE,function(t){o=t.target.value}));let m={closeCallback:function(){c.modal.parentElement.removeChild(c.modal)}};i.openCallback&&(m.openCallback=i.openCallback);TC.Util.showModal(c.modal,m)})};t.setFeatures=function(t){this.features=Array.isArray(t)?t:[t]};t.getFeatures=function(){return this.features};t.setOptions=function(t){this.options=Object.assign(this.options,t)};t.getOptions=function(){return this.options}}();
//# sourceMappingURL=../maps/control/FeatureDownloadDialog.min.js.map