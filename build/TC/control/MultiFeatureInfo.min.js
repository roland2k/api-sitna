TC.control=TC.control||{};TC.control.FeatureInfoCommons||TC.syncLoadJS(TC.apiLocation+"TC/control/FeatureInfoCommons");!function(){TC.control.MultiFeatureInfo=function(){TC.Control.apply(this,arguments);this.modes=this.options.modes||{};void 0===this.modes[TC.Consts.geom.POINT]&&(this.modes[TC.Consts.geom.POINT]=!0);void 0===this.modes[TC.Consts.geom.POLYGON]&&(this.modes[TC.Consts.geom.POLYGON]=!0);this.featureInfoControl=null;this.lineFeatureInfoControl=null;this.polygonFeatureInfoControl=null;this.featureInfoControls=[];this.lastCtrlActive=null;this.popup=null;this.exportsState=!1};TC.inherit(TC.control.MultiFeatureInfo,TC.control.FeatureInfoCommons);var e=TC.control.MultiFeatureInfo.prototype;e.CLASS="tc-ctl-m-finfo";e.template={1:function(e,t,n,o,l){var s=null!=t?t:e.nullContext||{},a=e.escapeExpression,i=e.lambda,r=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<label class="tc-ctl-m-finfo-btn-point" title="'+a(r(n,"i18n").call(s,"selectionByPoint",{name:"i18n",hash:{},data:l,loc:{start:{line:3,column:75},end:{line:3,column:102}}}))+'"><input type="radio" name="'+a(i(null!=t?r(t,"controlId"):t,t))+'-mode" value="'+a(i(null!=t?r(t,"pointSelectValue"):t,t))+'" checked /><span class="tc-ctl-btn">'+a(r(n,"i18n").call(s,"byPoint",{name:"i18n",hash:{},data:l,loc:{start:{line:3,column:214},end:{line:3,column:232}}}))+"</span></label>"},3:function(e,t,n,o,l){var s=null!=t?t:e.nullContext||{},a=e.escapeExpression,i=e.lambda,r=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<label class="tc-ctl-m-finfo-btn-line" title="'+a(r(n,"i18n").call(s,"selectionByLine",{name:"i18n",hash:{},data:l,loc:{start:{line:4,column:73},end:{line:4,column:99}}}))+'"><input type="radio" name="'+a(i(null!=t?r(t,"controlId"):t,t))+'-mode" value="'+a(i(null!=t?r(t,"lineSelectValue"):t,t))+'" /><span class="tc-ctl-btn">'+a(r(n,"i18n").call(s,"byLine",{name:"i18n",hash:{},data:l,loc:{start:{line:4,column:202},end:{line:4,column:219}}}))+"</span></label>"},5:function(e,t,n,o,l){var s=null!=t?t:e.nullContext||{},a=e.escapeExpression,i=e.lambda,r=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<label class="tc-ctl-m-finfo-btn-polygon" title="'+a(r(n,"i18n").call(s,"selectionByPrecinct",{name:"i18n",hash:{},data:l,loc:{start:{line:5,column:79},end:{line:5,column:109}}}))+'"><input type="radio" name="'+a(i(null!=t?r(t,"controlId"):t,t))+'-mode" value="'+a(i(null!=t?r(t,"polygonSelectValue"):t,t))+'" /><span class="tc-ctl-btn">'+a(r(n,"i18n").call(s,"byPrecinct",{name:"i18n",hash:{},data:l,loc:{start:{line:5,column:215},end:{line:5,column:236}}}))+"</span></label>"},compiler:[8,">= 4.3.0"],main:function(e,t,n,o,l){var s,a=null!=t?t:e.nullContext||{},i=e.escapeExpression,r=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div class="tc-ctl-m-finfo-select">\r\n    <span>'+i(r(n,"i18n").call(a,"selectionBy",{name:"i18n",hash:{},data:l,loc:{start:{line:2,column:10},end:{line:2,column:32}}}))+"</span>\r\n    "+(null!=(s=r(n,"if").call(a,null!=t?r(t,"pointSelectValue"):t,{name:"if",hash:{},fn:e.program(1,l,0),inverse:e.noop,data:l,loc:{start:{line:3,column:4},end:{line:3,column:254}}}))?s:"")+"\r\n    "+(null!=(s=r(n,"if").call(a,null!=t?r(t,"lineSelectValue"):t,{name:"if",hash:{},fn:e.program(3,l,0),inverse:e.noop,data:l,loc:{start:{line:4,column:4},end:{line:4,column:241}}}))?s:"")+"\r\n    "+(null!=(s=r(n,"if").call(a,null!=t?r(t,"polygonSelectValue"):t,{name:"if",hash:{},fn:e.program(5,l,0),inverse:e.noop,data:l,loc:{start:{line:5,column:4},end:{line:5,column:258}}}))?s:"")+'\r\n    <button class="tc-icon-btn tc-ctl-m-finfo-btn-dl" disabled title="'+i(r(n,"i18n").call(a,"downloadFeatures",{name:"i18n",hash:{},data:l,loc:{start:{line:6,column:70},end:{line:6,column:97}}}))+'"></button>\r\n    <button class="tc-icon-btn tc-ctl-m-finfo-btn-remove" disabled title="'+i(r(n,"i18n").call(a,"deleteFeatures",{name:"i18n",hash:{},data:l,loc:{start:{line:7,column:74},end:{line:7,column:99}}}))+'"></button>\r\n</div>\r\n'},useData:!0};const t=function(e,t){if(e){!0===e&&(e={});return TC.Util.extend(!0,e,t)}return e};e.register=function(e){const n=this;n.div.querySelectorAll("input[type=radio]").forEach(function(e){e.checked=!1});return new Promise(function(o,l){const s=[TC.Control.prototype.register.call(n,e)],a=n.options.styles||{},i=n.modes[TC.Consts.geom.POINT],r=n.modes[TC.Consts.geom.POLYLINE],c=n.modes[TC.Consts.geom.POLYGON];i&&s.push(e.addControl("featureInfo",t(n.modes[TC.Consts.geom.POINT],{id:n.getUID(),displayMode:n.options.displayMode,persistentHighlights:n.options.persistentHighlights,share:n.options.share})).then(function(e){n.featureInfoControl=e;n.featureInfoControls.push(e);return e}));n.modes[TC.Consts.geom.POLYLINE]&&s.push(e.addControl("lineFeatureInfo",t(n.modes[TC.Consts.geom.POLYLINE],{id:n.getUID(),active:r.active,displayMode:n.options.displayMode,persistentHighlights:n.options.persistentHighlights,share:n.options.share,style:r.filterStyle||a.line})).then(function(e){n.lineFeatureInfoControl=e;n.featureInfoControls.push(e);return e}));n.modes[TC.Consts.geom.POLYGON]&&s.push(e.addControl("polygonFeatureInfo",t(n.modes[TC.Consts.geom.POLYGON],{id:n.getUID(),active:c.active,displayMode:n.options.displayMode,persistentHighlights:n.options.persistentHighlights,share:n.options.share,style:c.filterStyle||a.polygon})).then(function(e){n.polygonFeatureInfoControl=e;n.featureInfoControls.push(e);return e}));e.on(`${TC.Consts.event.LAYERADD} ${TC.Consts.event.LAYERREMOVE} ${TC.Consts.event.LAYERVISIBILITY}`,function(e){n.updateUI()});e.on(`${TC.Consts.event.CONTROLACTIVATE} ${TC.Consts.event.CONTROLDEACTIVATE}`,function(e){e.control!==n.featureInfoControl&&e.control!==n.lineFeatureInfoControl&&e.control!==n.polygonFeatureInfoControl||n.updateUI()});Promise.all(s).then(function(){if(n.featureInfoControl){n.featureInfoControl.activate();n.lastCtrlActive=n.featureInfoControl}n.updateUI();o(n)})})};e.render=function(e){const t=this;var n={controlId:t.id};t.modes[TC.Consts.geom.POINT]&&(n.pointSelectValue=TC.Consts.geom.POINT);t.modes[TC.Consts.geom.POLYLINE]&&(n.lineSelectValue=TC.Consts.geom.POLYLINE);t.modes[TC.Consts.geom.POLYGON]&&(n.polygonSelectValue=TC.Consts.geom.POLYGON);return t._set1stRenderPromise(t.renderData(n,function(){var n=function(){switch(this.value){case TC.Consts.geom.POLYLINE:t.lineFeatureInfoControl.activate();t.lastCtrlActive=t.lineFeatureInfoControl;break;case TC.Consts.geom.POLYGON:t.polygonFeatureInfoControl.activate();t.lastCtrlActive=t.polygonFeatureInfoControl;break;default:t.featureInfoControl.activate();t.lastCtrlActive=t.featureInfoControl}};t.div.querySelectorAll("input[type=radio]").forEach(function(e){e.addEventListener("change",n)});t.div.querySelector(`.${t.CLASS}-btn-remove`).addEventListener(TC.Consts.event.CLICK,function(e){t.featureInfoControls.forEach(e=>{e.resultsLayer.features.slice().forEach(t=>e.downplayFeature(t));e.filterLayer.features.slice().forEach(e=>e.layer.removeFeature(e))})},{passive:!0});t.div.querySelector(`.${t.CLASS}-btn-dl`).addEventListener(TC.Consts.event.CLICK,async function(e){const n=await t.getDownloadDialog();let o={title:t.getLocaleString("featureInfo")+" - "+t.getLocaleString("download"),fileName:t._getFileName()};(t.map.elevation||t.options.displayElevation)&&(o=Object.assign({},o,{elevation:Object.assign({},t.map.elevation&&t.map.elevation.options,t.options.displayElevation)}));n.open(Array.prototype.concat.apply([],t.featureInfoControls.map(e=>e.resultsLayer.features)),o)},{passive:!0});t.map.on(TC.Consts.event.FEATUREREMOVE,function(e){t.featureInfoControls.some(t=>t.resultsLayer===e.layer||t.filterLayer===e.layer)&&t.updateUI()}).on(TC.Consts.event.FEATUREADD+" "+TC.Consts.event.FEATURESADD,function(e){t.featureInfoControls.some(t=>t.resultsLayer===e.layer||t.filterLayer===e.layer)&&t.updateUI()});TC.Util.isFunction(e)&&e()}))};e.activate=function(){this.lastCtrlActive&&this.lastCtrlActive.activate()};e.deactivate=function(){this.lastCtrlActive.deactivate(!1)};e.updateUI=function(){const e=this;e.renderPromise().then(function(){const t=e.map.workLayers.some(e=>e.type===TC.Consts.layerType.WMS&&e.getVisibility());e.div.querySelectorAll("input").forEach(function(e){e.disabled=!t});if(e.featureInfoControl){const t=e.div.querySelector(`input[value=${TC.Consts.geom.POINT}]`);t&&(t.checked=e.featureInfoControl.isActive)}if(e.lineFeatureInfoControl){const t=e.div.querySelector(`input[value=${TC.Consts.geom.POLYLINE}]`);t&&(t.checked=e.lineFeatureInfoControl.isActive)}if(e.polygonFeatureInfoControl){const t=e.div.querySelector(`input[value=${TC.Consts.geom.POLYGON}]`);t&&(t.checked=e.polygonFeatureInfoControl.isActive)}const n=e.featureInfoControls.some(e=>e.options.persistentHighlights),o=e.featureInfoControls.every(e=>e.resultsLayer&&0===e.resultsLayer.features.length&&e.filterLayer&&0===e.filterLayer.features.length),l=e.div.querySelector(`.${e.CLASS}-btn-remove`);l.classList.toggle(TC.Consts.classes.HIDDEN,!n);l.disabled=o;const s=e.div.querySelector(`.${e.CLASS}-btn-dl`);s.classList.toggle(TC.Consts.classes.HIDDEN,!n);s.disabled=o;const a=e.div.style.display;e.div.style.display="none";a?e.div.style.display=a:e.div.style.removeProperty("display")})}}();
//# sourceMappingURL=../maps/control/MultiFeatureInfo.min.js.map