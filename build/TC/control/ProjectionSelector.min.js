TC.control=TC.control||{};TC.control.MapContents||TC.syncLoadJS(TC.apiLocation+"TC/Control");!function(){TC.control.ProjectionSelector=function(){const e=this;TC.Control.apply(e,arguments);e._cssClasses={LOAD_CRS_BUTTON:e.CLASS+"-crs-btn-load",CRS_DIALOG:e.CLASS+"-crs-dialog",CRS_LIST:e.CLASS+"-crs-list",CURRENT_CRS_NAME:e.CLASS+"-cur-crs-name",CURRENT_CRS_CODE:e.CLASS+"-cur-crs-code",CHANGE:e.CLASS+"-change",NO_CHANGE:e.CLASS+"-no-change"};e._dialogDiv=TC.Util.getDiv(e.options.dialogDiv);window.$&&(e._$dialogDiv=$(e._dialogDiv));e.options.dialogDiv||document.body.appendChild(e._dialogDiv);e._dialogDiv.addEventListener(TC.Consts.event.CLICK,TC.EventTarget.listenerBySelector("button:not(."+e._cssClasses.LOAD_CRS_BUTTON+")",function(s){const t=s.target.dataset.crsCode;t&&e.setProjection({crs:t,allowFallbackLayer:!0})}),{passive:!0});e._dialogDiv.addEventListener(TC.Consts.event.CLICK,TC.EventTarget.listenerBySelector("button."+e._cssClasses.LOAD_CRS_BUTTON,function(s){e.loadFallbackProjections()}),{passive:!0})};TC.inherit(TC.control.ProjectionSelector,TC.Control);const e=TC.control.ProjectionSelector.prototype;e.CLASS="tc-ctl-projs";e.render=function(e){const s=this,t=TC.Control.prototype.render.call(s,e);s.getRenderedHtml(s.CLASS+"-dialog",null,function(e){s._dialogDiv.innerHTML=e});return t};e.getAvailableCRS=function(e){return this.map.getCompatibleCRS(TC.Util.extend(e||{},{includeFallbacks:!0}))};e.showProjectionChangeDialog=function(e){const s=this,t=s._dialogDiv.querySelector("."+s._cssClasses.CRS_DIALOG),o=t.querySelector(".tc-modal-body");o.classList.add(TC.Consts.classes.LOADING);const l=o.querySelector("ul."+s._cssClasses.CRS_LIST);l.innerHTML="";const n=s.map.baseLayer.firstOption||s.map.baseLayer,a=n.isRaster()?n.getFallbackLayer():null,c=function(){var a=[],c=[];e=e||{};if(n.isRaster()){c=n.getCompatibleCRS();a=s.getAvailableCRS(TC.Util.extend(e,{}))}else{c=s.map.baseLayers.filter(e=>e.isRaster()).map(e=>e.getCompatibleCRS({normalized:!0,includeFallback:!0})).reduce((e,s,t,o)=>e.concat(s.filter(s=>e.indexOf(s)<0)));const t=(e.layer?s.map.workLayers.concat(e.layer):s.map.workLayers).filter(function(e){return e.isRaster()}).map(function(e){return e.getCompatibleCRS({normalized:!0,includeFallback:!0})});a=c.filter(e=>t.every(s=>s.indexOf(e)>-1))}s.map.loadProjections({crsList:a,orderBy:"name"}).then(function(e){var n=!1,a=t.querySelector("."+s._cssClasses.CURRENT_CRS_NAME),i=t.querySelector("."+s._cssClasses.CURRENT_CRS_CODE);e.forEach(function(e){if(a&&i&&TC.Util.CRSCodesEqual(s.map.crs,e.code)){a.textContent=e.name;i.textContent=e.code}else{const s=document.createElement("button");s.textContent=e.name+" ("+e.code+")";s.dataset.crsCode=e.code;const t=document.createElement("li");t.appendChild(s);if(0===c.filter(function(s){return TC.Util.CRSCodesEqual(s,e.code)}).length){n=!0;t.classList.add(TC.Consts.classes.HIDDEN);s.classList.add(TC.Consts.classes.WARNING)}l.appendChild(t)}});if(n){const e=document.createElement("li"),t=document.createElement("button");t.classList.add(s._cssClasses.LOAD_CRS_BUTTON);t.innerHTML=s.getLocaleString("showOnTheFlyProjections");e.appendChild(t);l.appendChild(e)}if(0===l.querySelectorAll("li").length){const e=document.createElement("li");e.innerHTML=s.getLocaleString("thereAreNoCompatibleCRS");l.appendChild(e)}const r=l.querySelectorAll("li:not(."+TC.Consts.classes.HIDDEN+")");t.querySelectorAll("."+s._cssClasses.CHANGE).forEach(function(e){e.style.display=r.length>1?"":"none"});t.querySelectorAll("."+s._cssClasses.NO_CHANGE).forEach(function(e){e.style.display=r.length>1?"none":""});t.querySelector("ul."+s._cssClasses.CRS_LIST).style.display=r.length>0||n?"":"none";o.classList.remove(TC.Consts.classes.LOADING)})};a?a.getCapabilitiesPromise().then(c):c();TC.Util.showModal(t,e)};e.setProjection=function(e){const s=this;e=e||{};TC.loadProjDef({crs:e.crs,callback:function(){s.map.setProjection(e)}})};e.loadFallbackProjections=function(){const e=this,s=e._dialogDiv.querySelector("."+e._cssClasses.CRS_DIALOG).querySelectorAll("ul."+e._cssClasses.CRS_LIST+" li");s.forEach(function(s){s.classList.remove(TC.Consts.classes.HIDDEN);s.querySelector("button."+e._cssClasses.LOAD_CRS_BUTTON)&&s.classList.add(TC.Consts.classes.HIDDEN)});e._dialogDiv.querySelectorAll("p."+TC.Consts.classes.WARNING).forEach(function(e){e.classList.remove(TC.Consts.classes.HIDDEN)});e._dialogDiv.querySelectorAll("."+e._cssClasses.CHANGE).forEach(function(e){e.style.display=s.length>1?"":"none"});e._dialogDiv.querySelectorAll("."+e._cssClasses.NO_CHANGE).forEach(function(e){e.style.display=s.length>1?"none":""})}}();
//# sourceMappingURL=../maps/control/ProjectionSelector.min.js.map