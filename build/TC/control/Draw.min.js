TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.Feature&&TC.feature.Point||TC.syncLoadJS(TC.apiLocation+"TC/feature/Point");TC.Feature&&TC.feature.Polyline||TC.syncLoadJS(TC.apiLocation+"TC/feature/Polyline");TC.Feature&&TC.feature.Polygon||TC.syncLoadJS(TC.apiLocation+"TC/feature/Polygon");TC.Consts.event.DRAWSTART="drawstart.tc";TC.Consts.event.DRAWEND="drawend.tc";TC.Consts.event.DRAWCANCEL="drawcancel.tc";TC.Consts.event.DRAWUNDO="drawundo.tc";TC.Consts.event.DRAWREDO="drawredo.tc";TC.Consts.event.POINT="point.tc";TC.Consts.event.MEASURE="measure.tc";TC.Consts.event.MEASUREPARTIAL="measurepartial.tc";TC.Consts.event.STYLECHANGE="stylechange.tc";TC.Consts.event.CHANGE="change";!function(){const t=function(t){const e=t.match(/^#([0-9a-f])([0-9a-f])([0-9a-f])$/i);return e&&e.length?"#"+e[1]+e[1]+e[2]+e[2]+e[3]+e[3]:t};TC.control.Draw=function(){var t=this;TC.Control.apply(t,arguments);if(!TC.browserFeatures.inputTypeColor()&&!window.CP){TC.loadCSS(TC.apiLocation+"lib/color-picker/color-picker.min.css");TC.syncLoadJS(TC.apiLocation+"lib/color-picker/color-picker.min.js")}t._classSelector="."+t.CLASS;t._pointClass=t.CLASS+"-point";t._lineClass=t.CLASS+"-line";t._polygonClass=t.CLASS+"-polygon";t.history=[];t.historyIndex=0;t.exportsState=!0;t.on(TC.Consts.event.DRAWSTART,function(e){t.resetValues()}).on(TC.Consts.event.POINT,function(e){t.layer&&!t.persistent&&t.layer.features&&t.layer.features.length>0&&t.layer.clearFeatures();t.history.length=t.historyIndex;t.history[t.historyIndex++]=e.point;n(t)}).on(TC.Consts.event.DRAWEND,function(e){s(t);e.feature.setId(TC.getUID(t.getLocaleString("sketch")+"."));t.callBack&&t.callBack(e.feature)});t._layerPromise=null};TC.inherit(TC.control.Draw,TC.Control);var e=TC.control.Draw.prototype;e.CLASS="tc-ctl-draw";var n=function(t){t._endBtn.disabled=0===t.historyIndex||t.mode===TC.Consts.geom.POLYGON&&t.historyIndex<3||t.mode===TC.Consts.geom.POLYLINE&&t.historyIndex<2;t._redoBtn.disabled=t.history.length===t.historyIndex;t._undoBtn.disabled=0===t.historyIndex},s=function(t){t.resetValues();t._endBtn.disabled=!0;t._cancelBtn.disabled=!1};e.template={1:function(t,e,n,s,o){var l=null!=e?e:t.nullContext||{},r=t.escapeExpression,i=t.lambda,a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<div class="tc-ctl-draw-style">\r\n    '+r(a(n,"i18n").call(l,"strokeColor",{name:"i18n",hash:{},data:o,loc:{start:{line:10,column:4},end:{line:10,column:26}}}))+'\r\n    <input type="color" class="tc-ctl-col tc-ctl-draw-str-c" value="'+r(i(null!=e?a(e,"strokeColor"):e,e))+'" title="'+r(a(n,"i18n").call(l,"selectColor",{name:"i18n",hash:{},data:o,loc:{start:{line:11,column:92},end:{line:11,column:114}}}))+'" />\r\n    '+r(a(n,"i18n").call(l,"strokeWidth",{name:"i18n",hash:{},data:o,loc:{start:{line:12,column:4},end:{line:12,column:26}}}))+'\r\n    <div class="tc-ctl-draw-str-w-watch" style="border-bottom-width:'+r(i(null!=e?a(e,"strokeWidth"):e,e))+'px;"> </div>\r\n    <input type="number" class="tc-ctl-draw-str-w tc-textbox" value="'+r(i(null!=e?a(e,"strokeWidth"):e,e))+'" min="1" max="15" />\r\n</div>\r\n'},compiler:[8,">= 4.3.0"],main:function(t,e,n,s,o){var l,r=t.escapeExpression,i=null!=e?e:t.nullContext||{},a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<div class="tc-ctl-draw-tools">\r\n    <button class="tc-ctl-btn tc-ctl-draw-btn-new" title="'+r(t.lambda(null!=e?a(e,"tooltip"):e,e))+'">'+r(a(n,"i18n").call(i,"new",{name:"i18n",hash:{},data:o,loc:{start:{line:2,column:71},end:{line:2,column:85}}}))+'</button>\r\n    <button class="tc-ctl-btn tc-ctl-draw-btn-undo" disabled title="'+r(a(n,"i18n").call(i,"undo",{name:"i18n",hash:{},data:o,loc:{start:{line:3,column:68},end:{line:3,column:83}}}))+'">'+r(a(n,"i18n").call(i,"undo",{name:"i18n",hash:{},data:o,loc:{start:{line:3,column:85},end:{line:3,column:100}}}))+'</button>\r\n    <button class="tc-ctl-btn tc-ctl-draw-btn-redo" disabled title="'+r(a(n,"i18n").call(i,"redo",{name:"i18n",hash:{},data:o,loc:{start:{line:4,column:68},end:{line:4,column:83}}}))+'">'+r(a(n,"i18n").call(i,"redo",{name:"i18n",hash:{},data:o,loc:{start:{line:4,column:85},end:{line:4,column:100}}}))+'</button>\r\n    <button class="tc-ctl-btn tc-ctl-draw-btn-end" disabled title="'+r(a(n,"i18n").call(i,"end",{name:"i18n",hash:{},data:o,loc:{start:{line:5,column:67},end:{line:5,column:81}}}))+'">'+r(a(n,"i18n").call(i,"end",{name:"i18n",hash:{},data:o,loc:{start:{line:5,column:83},end:{line:5,column:97}}}))+'</button>\r\n    <button class="tc-ctl-btn tc-ctl-draw-btn-cancel" title="'+r(a(n,"i18n").call(i,"cancel",{name:"i18n",hash:{},data:o,loc:{start:{line:6,column:61},end:{line:6,column:78}}}))+'">'+r(a(n,"i18n").call(i,"cancel",{name:"i18n",hash:{},data:o,loc:{start:{line:6,column:80},end:{line:6,column:97}}}))+"</button>\r\n</div>\r\n"+(null!=(l=a(n,"if").call(i,null!=e?a(e,"styleTools"):e,{name:"if",hash:{},fn:t.program(1,o,0),inverse:t.noop,data:o,loc:{start:{line:8,column:0},end:{line:16,column:7}}}))?l:"")+"\r\n"},useData:!0};e.render=function(e){const n=this;let s,o,l;switch(n.options.mode){case TC.Consts.geom.POLYLINE:case TC.Consts.geom.MULTIPOLYLINE:s=n.getLocaleString("drawLine");n.div.classList.add(n._lineClass);o=n.styles.line.strokeColor;l=n.styles.line.strokeWidth;break;case TC.Consts.geom.POLYGON:case TC.Consts.geom.MULTIPOLYGON:s=n.getLocaleString("drawPolygon");n.div.classList.add(n._polygonClass);o=n.styles.polygon.strokeColor;l=n.styles.polygon.strokeWidth;break;case TC.Consts.geom.POINT:case TC.Consts.geom.MULTIPOINT:s=n.getLocaleString("drawPoint");n.div.classList.add(n._pointClass);o=n.styles.point.strokeColor;l=n.styles.point.strokeWidth;break;default:s=n.getLocaleString("draw");o=n.styles.line.strokeColor;l=n.styles.line.strokeWidth}const r={tooltip:s,strokeColor:t(o),strokeWidth:l,styleTools:n.options.styleTools};return n._set1stRenderPromise(n.renderData(r,function(){if(!TC.browserFeatures.inputTypeColor()){const t=n.div.querySelector("input[type=color]");if(t){t.style.backgroundColor=t.value;t.style.color="transparent";const e=new CP(t,"click",document.body);t.onclick=function(t){t.preventDefault()};t.onfocus=function(t){this.blur()};t.onchange=function(t){this.style.backgroundColor=this.value};n.map.loaded(function(){e.on("change",function(t){n.setStrokeColor("#"+t)})})}}n.reset=!0;n.callBack=null;n.measure=!1;n._cancelClick=!1;n.mode=n.options.mode||TC.Consts.geom.POLYLINE;n.options.measure&&(n.measure=n.options.measure);TC.Util.isFunction(n.options.callback)&&(n.callBack=n.options.callback);void 0===n.options.persistent?n.persistent=!0:n.persistent=n.options.persistent;n.wrap=new TC.wrap.control.Draw(n);n._newBtn=n.div.querySelector(n._classSelector+"-btn-new");n._newBtn.addEventListener(TC.Consts.event.CLICK,function(){n.new()},{passive:!0});n._cancelBtn=n.div.querySelector(n._classSelector+"-btn-cancel");n._cancelBtn.addEventListener(TC.Consts.event.CLICK,function(){n.cancel()},{passive:!0});n._endBtn=n.div.querySelector(n._classSelector+"-btn-end");n._endBtn.addEventListener(TC.Consts.event.CLICK,function(){n.end()},{passive:!0});n._undoBtn=n.div.querySelector(n._classSelector+"-btn-undo");n._undoBtn.addEventListener(TC.Consts.event.CLICK,function(){n.undo()},{passive:!0});n._redoBtn=n.div.querySelector(n._classSelector+"-btn-redo");n._redoBtn.addEventListener(TC.Consts.event.CLICK,function(){n.redo()},{passive:!0});if(n.options.styleTools){n._strokeColorPicker=n.div.querySelector(n._classSelector+"-str-c");n._strokeColorPicker.addEventListener(TC.Consts.event.CHANGE,function(t){n.setStrokeColor(t.target.value)});n._strokeWidthSelector=n.div.querySelector(n._classSelector+"-str-w");n._strokeWidthSelector.addEventListener(TC.Consts.event.CHANGE,function(t){n.setStrokeWidth(t.target.value)});n._strokeWidthWatch=n.div.querySelector(n._classSelector+"-str-w-watch")}TC.Util.isFunction(e)&&e()}))};e.register=function(t){const e=this;e.styles=TC.Util.extend(!0,{},t.options.styles,e.options.styles);const n=TC.Control.prototype.register.call(e,t);e.map.on(TC.Consts.event.VIEWCHANGE,function(){e.map.view===TC.Consts.view.PRINTING&&e.end()}).on(TC.Consts.event.PROJECTIONCHANGE,function(t){e.history.forEach(function(e,n,s){s[n]=TC.Util.reproject(e,t.oldCrs,t.newCrs)})});e._layerPromise=new Promise(function(n,s){t.loaded(function(){if(e.options.layer){e.setLayer(e.options.layer);n(e.layer)}else if(!1===e.options.layer){e.setLayer(null);n(null)}else t.addLayer({id:e.getUID(),title:"DrawControl",stealth:!0,owner:e,type:TC.Consts.layerType.VECTOR,styles:{point:e.styles.point,line:e.styles.line,polygon:e.styles.polygon}}).then(function(s){t.putLayerOnTop(s);e.setLayer(s);n(e.layer)})})});return n};e.new=function(){this.layer&&!this.persistent&&this.layer.clearFeatures();this._cancelBtn.disabled=!1;this.setMode(this.mode,!0);return this};e.undo=function(){var t=this.wrap.undo();if(t){this.historyIndex--;n(this);this.historyIndex<=0&&this.resetValues();this.trigger(TC.Consts.event.DRAWUNDO)}return t};e.redo=function(){var t=this.wrap.redo();if(t){this.historyIndex++;n(this);this.trigger(TC.Consts.event.DRAWREDO)}return t};e.cancel=function(){this._cancelClick=!0;this.setMode(null,!1);this.resetValues();s(this);this._cancelBtn.disabled=!0;this.trigger(TC.Consts.event.DRAWCANCEL,{ctrl:this});return this};e.activate=function(){this._newBtn.classList.add(TC.Consts.classes.ACTIVE);this._cancelBtn.disabled=!1;TC.Control.prototype.activate.call(this);this.wrap.activate(this.mode);this.div.classList.remove(this._pointClass,this._lineClass,this._polygonClass);switch(this.mode){case TC.Consts.geom.POINT:this.div.classList.add(this._pointClass);break;case TC.Consts.geom.POLYLINE:this.div.classList.add(this._lineClass);break;case TC.Consts.geom.POLYGON:this.div.classList.add(this._polygonClass)}};e.deactivate=function(){this._newBtn&&this._newBtn.classList.remove(TC.Consts.classes.ACTIVE);this._cancelBtn&&(this._cancelBtn.disabled=!0);TC.Control.prototype.deactivate.call(this,!this._cancelClick);this.wrap&&this.wrap.deactivate();this.resetValues();this._cancelClick=!1};e.clear=function(){const t=this;t.layer&&t.layer.clearFatures();t.resetValues();return t};e.isExclusive=function(){return!0};e.end=function(){this.wrap.end();this.resetValues();return this};e.setMode=function(t,e){const n=this;t&&(n.mode=t);e&&t?n.activate():n.deactivate();return n};e.setStyle=function(t){const e=this;if(t)e.style=TC.Util.extend(e.style,t);else switch(e.options.mode){case TC.Consts.geom.POLYLINE:case TC.Consts.geom.MULTIPOLYLINE:t={line:e.styles.line};break;case TC.Consts.geom.POLYGON:case TC.Consts.geom.MULTIPOLYGON:t={polygon:e.styles.polygon};break;case TC.Consts.geom.POINT:case TC.Consts.geom.MULTIPOINT:t={point:e.styles.point};break;default:t={}}e.isActive&&e.wrap.setStyle(t)};e.getModeStyle=function(t){const e=this;switch(t=t||e.options.mode){case TC.Consts.geom.POLYLINE:case TC.Consts.geom.MULTIPOLYLINE:return e.styles.line;case TC.Consts.geom.POLYGON:case TC.Consts.geom.MULTIPOLYGON:return e.styles.polygon;case TC.Consts.geom.POINT:case TC.Consts.geom.MULTIPOINT:return e.styles.point;default:return null}};e.setStrokeColorWatch=function(t){const e=this;if(e.options.styleTools){void 0===t&&(t=e.getModeStyle().strokeColor);const n=t.match(/^#([0-9a-f])([0-9a-f])([0-9a-f])$/i);n&&n.length&&(t="#"+n[1]+n[1]+n[2]+n[2]+n[3]+n[3]);e._strokeColorPicker.value=t;if(!TC.browserFeatures.inputTypeColor()){const n=e._strokeColorPicker;n.style.backgroundColor=t;n.blur()}}return e};e.setStrokeColor=function(t){const e=this,n=e.getModeStyle();n&&(n.strokeColor=t);e.isActive&&e.setStyle();e.setStrokeColorWatch(t);e.trigger(TC.Consts.event.STYLECHANGE,{property:"strokeColor",value:t});return e};e.setStrokeWidthWatch=function(t){const e=this;if(e.options.styleTools){void 0===t&&(t=e.getModeStyle().strokeWidth);if((t=parseInt(t,10))!==Number.NaN){e._strokeWidthSelector.value=t;e._strokeWidthWatch.style.borderBottomWidth=t+"px"}}return e};e.setStrokeWidth=function(t){const e=this;if((t=parseInt(t,10))!==Number.NaN){const n=e.getModeStyle();n&&(n.strokeWidth=t);e.isActive&&e.setStyle();e.setStrokeWidthWatch(t);e.trigger(TC.Consts.event.STYLECHANGE,{property:"strokeWidth",value:t})}return e};e.getLayer=function(){const t=this;return t.layer?Promise.resolve(t.layer):this._layerPromise};e.setLayer=function(t){const e=this;if(e.map){e.layer="string"==typeof t?e.map.getLayer(t):t;e.styles={};const n=e.layer&&e.layer.styles||TC.Cfg.styles;TC.Util.extend(!0,e.styles,e.options.styles||n)}};e.resetValues=function(){this.history.length=0;this.historyIndex=0;n(this);return this};e.exportState=function(){const t=this;return t.exportsState&&t.layer?{id:t.id,layer:t.layer.exportState()}:null};e.importState=function(t){this.getLayer().then(function(e){e.importState(t.layer)})}}();
//# sourceMappingURL=../maps/control/Draw.min.js.map