TC.control=TC.control||{};TC.control.Click||TC.syncLoadJS(TC.apiLocation+"TC/control/Click");TC.Consts.event.POPUP=TC.Consts.event.POPUP||"popup.tc";TC.Consts.event.POPUPHIDE=TC.Consts.event.POPUPHIDE||"popuphide.tc";TC.Consts.event.DRAWCHART=TC.Consts.event.DRAWCHART||"drawchart.tc";TC.Consts.event.DRAWTABLE=TC.Consts.event.DRAWTABLE||"drawtable.tc";TC.Consts.event.RESULTSPANELCLOSE=TC.Consts.event.RESULTSPANELCLOSE||"resultspanelclose.tc";TC.Consts.event.FEATUREHIGHLIGHT="featurehighlight.tc";TC.Consts.event.FEATUREDOWNPLAY="featuredownplay.tc";TC.control.FeatureInfoCommons=function(){TC.control.Click.apply(this,arguments);this._selectors={LIST_ITEM:`ul.${this.CLASS}-features li`,SHOW_ALL_CHECKBOX:`.${this.CLASS}-btn input[type="checkbox"].${this.CLASS}-btn-show-all`,SHOW_ALL_LABEL:`.${this.CLASS}-btn label.${this.CLASS}-btn-show-all`,ZOOM_ALL_BUTTON:`.${this.CLASS}-btn .${this.CLASS}-btn-zoom-all`,DEL_ALL_BUTTON:`.${this.CLASS}-btn .${this.CLASS}-btn-del-all`};this.resultsLayer=null;this.filterLayer=null;this._layersPromise=null;this.filterFeature=null;this.info=null;this._infoHistory={};this.popup=null;this.resultsPanel=null;this.lastFeatureCount=null;this.exportsState=!0};!function(){TC.inherit(TC.control.FeatureInfoCommons,TC.control.Click);var e=TC.control.FeatureInfoCommons.prototype;e.CLASS="tc-ctl-finfo";e.CURRENT_CLASS="tc-current";e.TITLE_SEPARATOR=" \u2022 ";e.DEFAULT_STROKE_COLOR="#0000ff";e.template={};e.template[e.CLASS]={1:function(e,t,n,l,o){var r,a=null!=t?t:e.nullContext||{},s=e.escapeExpression,i=e.lambda,c=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'    <span class="tc-ctl-finfo-coords-pair tc-ctl-finfo-coords-lat">'+s(c(n,"i18n").call(a,"lat",{name:"i18n",hash:{},data:o,loc:{start:{line:4,column:67},end:{line:4,column:81}}}))+': <span class="tc-ctl-finfo-coords-val">'+s(i(null!=(r=null!=t?c(t,"coords"):t)?c(r,"1"):r,t))+'</span></span>\r\n    <span class="tc-ctl-finfo-coords-pair tc-ctl-finfo-coords-lon">'+s(c(n,"i18n").call(a,"lon",{name:"i18n",hash:{},data:o,loc:{start:{line:5,column:67},end:{line:5,column:81}}}))+': <span class="tc-ctl-finfo-coords-val">'+s(i(null!=(r=null!=t?c(t,"coords"):t)?c(r,"0"):r,t))+"</span></span>\r\n"},3:function(e,t,n,l,o){var r,a=e.lambda,s=e.escapeExpression,i=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'    <span class="tc-ctl-finfo-coords-pair tc-ctl-finfo-coords-x">x: <span class="tc-ctl-finfo-coords-val">'+s(a(null!=(r=null!=t?i(t,"coords"):t)?i(r,"0"):r,t))+'</span></span>\r\n    <span class="tc-ctl-finfo-coords-pair tc-ctl-finfo-coords-x">y: <span class="tc-ctl-finfo-coords-val">'+s(a(null!=(r=null!=t?i(t,"coords"):t)?i(r,"1"):r,t))+"</span></span>\r\n"},5:function(e,t,n,l,o){var r=null!=t?t:e.nullContext||{},a=e.escapeExpression,s=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<span class="tc-ctl-finfo-coords-pair tc-ctl-finfo-elev" title="'+a(s(n,"i18n").call(r,"elevation",{name:"i18n",hash:{},data:o,loc:{start:{line:10,column:92},end:{line:10,column:112}}}))+'">'+a(s(n,"i18n").call(r,"ele",{name:"i18n",hash:{},data:o,loc:{start:{line:10,column:114},end:{line:10,column:128}}}))+': <span class="tc-ctl-finfo-coords-val"></span></span><span class="tc-ctl-finfo-coords-pair tc-ctl-finfo-height" title="'+a(s(n,"i18n").call(r,"heightOverTerrain",{name:"i18n",hash:{},data:o,loc:{start:{line:10,column:248},end:{line:10,column:276}}}))+'">'+a(s(n,"i18n").call(r,"height",{name:"i18n",hash:{},data:o,loc:{start:{line:10,column:278},end:{line:10,column:295}}}))+': <span class="tc-ctl-finfo-coords-val"></span></span>'},7:function(e,t,n,l,o){var r,a=null!=t?t:e.nullContext||{},s=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return"        <li>\r\n            <h3>"+(null!=(r=s(n,"if").call(a,null!=t?s(t,"title"):t,{name:"if",hash:{},fn:e.program(8,o,0),inverse:e.program(10,o,0),data:o,loc:{start:{line:16,column:16},end:{line:16,column:126}}}))?r:"")+'</h3>\r\n            <div class="tc-ctl-finfo-service-content">\r\n'+(null!=(r=s(n,"each").call(a,null!=t?s(t,"hasLimits"):t,{name:"each",hash:{},fn:e.program(15,o,0),inverse:e.program(17,o,0),data:o,loc:{start:{line:18,column:16},end:{line:72,column:25}}}))?r:"")+"            </div>\r\n        </li>\r\n"},8:function(e,t,n,l,o){var r=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return e.escapeExpression(e.lambda(null!=t?r(t,"title"):t,t))},10:function(e,t,n,l,o){var r,a=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return null!=(r=a(n,"if").call(null!=t?t:e.nullContext||{},null!=(r=null!=(r=null!=t?a(t,"layers"):t)?a(r,"0"):r)?a(r,"title"):r,{name:"if",hash:{},fn:e.program(11,o,0),inverse:e.program(13,o,0),data:o,loc:{start:{line:16,column:46},end:{line:16,column:119}}}))?r:""},11:function(e,t,n,l,o){var r,a=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return e.escapeExpression(e.lambda(null!=(r=null!=(r=null!=t?a(t,"layers"):t)?a(r,"0"):r)?a(r,"title"):r,t))},13:function(e,t,n,l,o){var r,a=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return e.escapeExpression(e.lambda(null!=(r=null!=t?a(t,"layer"):t)?a(r,"name"):r,t))},15:function(e,t,n,l,o){var r=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'                <span class="tc-ctl-finfo-errors">'+e.escapeExpression(e.lambda(null!=t?r(t,"hasLimits"):t,t))+"</span>\r\n"},17:function(e,t,n,l,o){var r,a=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'                    <ul class="tc-ctl-finfo-layers">\r\n'+(null!=(r=a(n,"each").call(null!=t?t:e.nullContext||{},null!=t?a(t,"layers"):t,{name:"each",hash:{},fn:e.program(18,o,0),inverse:e.program(45,o,0),data:o,loc:{start:{line:22,column:24},end:{line:70,column:33}}}))?r:"")+"                    </ul>\r\n"},18:function(e,t,n,l,o){var r,a=null!=t?t:e.nullContext||{},s=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'                        <li>\r\n                            <h4><span class="tc-ctl-finfo-layer-n">'+e.escapeExpression(e.lambda(null!=(r=null!=t?s(t,"features"):t)?s(r,"length"):r,t))+"</span> "+(null!=(r=s(n,"each").call(a,null!=t?s(t,"path"):t,{name:"each",hash:{},fn:e.program(19,o,0),inverse:e.noop,data:o,loc:{start:{line:24,column:94},end:{line:24,column:162}}}))?r:"")+'</h4>                                            \r\n                            <div class="tc-ctl-finfo-layer-content">\r\n                                <ul class="tc-ctl-finfo-features">\r\n'+(null!=(r=s(n,"each").call(a,null!=t?s(t,"features"):t,{name:"each",hash:{},fn:e.program(22,o,0),inverse:e.program(43,o,0),data:o,loc:{start:{line:27,column:36},end:{line:64,column:45}}}))?r:"")+"                                </ul>\r\n                            </div>\r\n                        </li>\r\n"},19:function(e,t,n,l,o){var r,a=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return(null!=(r=a(n,"unless").call(null!=t?t:e.nullContext||{},o&&a(o,"first"),{name:"unless",hash:{},fn:e.program(20,o,0),inverse:e.noop,data:o,loc:{start:{line:24,column:108},end:{line:24,column:145}}}))?r:"")+e.escapeExpression(e.lambda(t,t))},20:function(e,t,n,l,o){return" &bull; "},22:function(e,t,n,l,o){var r,a=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return"                                    <li>\r\n"+(null!=(r=a(n,"if").call(null!=t?t:e.nullContext||{},null!=t?a(t,"rawContent"):t,{name:"if",hash:{},fn:e.program(23,o,0),inverse:e.program(32,o,0),data:o,loc:{start:{line:29,column:40},end:{line:60,column:47}}}))?r:"")+"                                    </li>\r\n"},23:function(e,t,n,l,o){var r,a=null!=t?t:e.nullContext||{},s=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return"                                            <h5>"+e.escapeExpression(s(n,"i18n").call(a,"feature",{name:"i18n",hash:{},data:o,loc:{start:{line:30,column:48},end:{line:30,column:66}}}))+"</h5>\r\n"+(null!=(r=s(n,"if").call(a,s(n,"eq").call(a,null!=t?s(t,"rawFormat"):t,"text/html",{name:"eq",hash:{},data:o,loc:{start:{line:31,column:54},end:{line:31,column:80}}}),{name:"if",hash:{},fn:e.program(24,o,0),inverse:e.program(30,o,0),data:o,loc:{start:{line:31,column:48},end:{line:44,column:55}}}))?r:"")},24:function(e,t,n,l,o){var r,a=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return null!=(r=a(n,"if").call(null!=t?t:e.nullContext||{},null!=t?a(t,"expandUrl"):t,{name:"if",hash:{},fn:e.program(25,o,0),inverse:e.noop,data:o,loc:{start:{line:32,column:52},end:{line:41,column:59}}}))?r:""},25:function(e,t,n,l,o){var r,a=null!=t?t:e.nullContext||{},s=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return null!=(r=s(n,"unless").call(a,s(n,"eq").call(a,null!=t?s(t,"expandUrl"):t,"",{name:"eq",hash:{},data:o,loc:{start:{line:33,column:66},end:{line:33,column:83}}}),{name:"unless",hash:{},fn:e.program(26,o,0),inverse:e.program(28,o,0),data:o,loc:{start:{line:33,column:56},end:{line:40,column:67}}}))?r:""},26:function(e,t,n,l,o){var r=e.lambda,a=e.escapeExpression,s=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'                                                            <div class="tc-ctl-finfo-features-iframe-cnt">\r\n                                                                <iframe src="'+a(r(null!=t?s(t,"rawUrl"):t,t))+'"></iframe>\r\n                                                                <a class="tc-ctl-finfo-open" onclick="window.open(\''+a(r(null!=t?s(t,"expandUrl"):t,t))+"', '_blank')\" title=\""+a(s(n,"i18n").call(null!=t?t:e.nullContext||{},"expand",{name:"i18n",hash:{},data:o,loc:{start:{line:36,column:149},end:{line:36,column:166}}}))+'"></a>\r\n                                                            </div>\r\n'},28:function(e,t,n,l,o){var r=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'                                                            <iframe src="'+e.escapeExpression(e.lambda(null!=t?r(t,"rawUrl"):t,t))+'"></iframe>\r\n'},30:function(e,t,n,l,o){var r=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return"                                                    <pre>"+e.escapeExpression(e.lambda(null!=t?r(t,"rawContent"):t,t))+"</pre>\r\n"},32:function(e,t,n,l,o){var r,a=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return null!=(r=a(n,"if").call(null!=t?t:e.nullContext||{},null!=t?a(t,"error"):t,{name:"if",hash:{},fn:e.program(33,o,0),inverse:e.program(35,o,0),data:o,loc:{start:{line:46,column:44},end:{line:59,column:51}}}))?r:""},33:function(e,t,n,l,o){var r=e.escapeExpression,a=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'                                                <span class="tc-ctl-finfo-errors">'+r(a(n,"i18n").call(null!=t?t:e.nullContext||{},"fi.error",{name:"i18n",hash:{},data:o,loc:{start:{line:47,column:82},end:{line:47,column:101}}}))+'<span class="tc-ctl-finfo-error-text">'+r(e.lambda(null!=t?a(t,"error"):t,t))+"</span></span>\r\n"},35:function(e,t,n,l,o){var r,a=null!=t?t:e.nullContext||{},s=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return"                                                <h5>"+e.escapeExpression(e.lambda(null!=t?s(t,"id"):t,t))+"</h5>\r\n                                                    <table"+(null!=(r=s(n,"if").call(a,null!=t?s(t,"geometry"):t,{name:"if",hash:{},fn:e.program(36,o,0),inverse:e.noop,data:o,loc:{start:{line:50,column:58},end:{line:50,column:117}}}))?r:"")+">\r\n                                                        <tbody>\r\n"+(null!=(r=s(n,"each").call(a,null!=t?s(t,"attributes"):t,{name:"each",hash:{},fn:e.program(38,o,0),inverse:e.noop,data:o,loc:{start:{line:52,column:60},end:{line:56,column:69}}}))?r:"")+"                                                        </tbody>\r\n                                                    </table>\r\n"},36:function(e,t,n,l,o){var r=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return' title="'+e.escapeExpression(r(n,"i18n").call(null!=t?t:e.nullContext||{},"clickToShowOnMap",{name:"i18n",hash:{},data:o,loc:{start:{line:50,column:82},end:{line:50,column:109}}}))+'"'},38:function(e,t,n,l,o){var r,a=null!=t?t:e.nullContext||{},s=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'                                                            <tr>\r\n                                                                <th class="tc-ctl-finfo-attr">'+e.escapeExpression(e.lambda(null!=t?s(t,"name"):t,t))+'</th><td class="tc-ctl-finfo-val">'+(null!=(r=s(n,"if").call(a,s(n,"eq").call(a,null!=t?s(t,"value"):t,null,{name:"eq",hash:{},data:o,loc:{start:{line:54,column:142},end:{line:54,column:157}}}),{name:"if",hash:{},fn:e.program(39,o,0),inverse:e.program(41,o,0),data:o,loc:{start:{line:54,column:136},end:{line:54,column:206}}}))?r:"")+"</td>                                                               \r\n                                                            </tr>                                                            \r\n"},39:function(e,t,n,l,o){return""},41:function(e,t,n,l,o){var r,a=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return null!=(r=e.invokePartial(a(l,"tc-ctl-finfo-object"),null!=t?a(t,"value"):t,{name:"tc-ctl-finfo-object",data:o,helpers:n,partials:l,decorators:e.decorators}))?r:""},43:function(e,t,n,l,o){var r=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'                                        <li class="tc-ctl-finfo-empty">'+e.escapeExpression(r(n,"i18n").call(null!=t?t:e.nullContext||{},"noDataInThisLayer",{name:"i18n",hash:{},data:o,loc:{start:{line:63,column:71},end:{line:63,column:99}}}))+"</li>\r\n"},45:function(e,t,n,l,o){var r=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'                            <li class="tc-ctl-finfo-empty">'+e.escapeExpression(r(n,"i18n").call(null!=t?t:e.nullContext||{},"noDataAtThisService",{name:"i18n",hash:{},data:o,loc:{start:{line:69,column:59},end:{line:69,column:89}}}))+"</li>\r\n"},47:function(e,t,n,l,o){var r,a=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return null!=(r=a(n,"unless").call(null!=t?t:e.nullContext||{},null!=t?a(t,"loading"):t,{name:"unless",hash:{},fn:e.program(48,o,0),inverse:e.noop,data:o,loc:{start:{line:76,column:12},end:{line:78,column:23}}}))?r:""},48:function(e,t,n,l,o){var r,a=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return"                "+(null!=(r=a(n,"unless").call(null!=t?t:e.nullContext||{},null!=t?a(t,"displayElevation"):t,{name:"unless",hash:{},fn:e.program(49,o,0),inverse:e.noop,data:o,loc:{start:{line:77,column:16},end:{line:77,column:108}}}))?r:"")+"\r\n"},49:function(e,t,n,l,o){var r=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<li class="tc-ctl-finfo-empty">'+e.escapeExpression(r(n,"i18n").call(null!=t?t:e.nullContext||{},"noData",{name:"i18n",hash:{},data:o,loc:{start:{line:77,column:75},end:{line:77,column:92}}}))+"</li>"},51:function(e,t,n,l,o){var r,a=null!=t?t:e.nullContext||{},s=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return null!=(r=s(n,"if").call(a,s(n,"gt").call(a,null!=t?s(t,"featureCount"):t,1,{name:"gt",hash:{},data:o,loc:{start:{line:83,column:10},end:{line:83,column:29}}}),{name:"if",hash:{},fn:e.program(52,o,0),inverse:e.noop,data:o,loc:{start:{line:83,column:4},end:{line:87,column:11}}}))?r:""},52:function(e,t,n,l,o){var r=null!=t?t:e.nullContext||{},a=e.escapeExpression,s=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<a class="tc-ctl-btn tc-ctl-finfo-btn-prev">'+a(s(n,"i18n").call(r,"previous",{name:"i18n",hash:{},data:o,loc:{start:{line:84,column:44},end:{line:84,column:63}}}))+'</a>\r\n<div class="tc-ctl-finfo-counter"><span class="tc-ctl-finfo-counter-current"></span>/'+a(e.lambda(null!=t?s(t,"featureCount"):t,t))+'</div>\r\n<a class="tc-ctl-btn tc-ctl-finfo-btn-next">'+a(s(n,"i18n").call(r,"next",{name:"i18n",hash:{},data:o,loc:{start:{line:86,column:44},end:{line:86,column:59}}}))+"</a>\r\n"},compiler:[8,">= 4.3.0"],main:function(e,t,n,l,o){var r,a=null!=t?t:e.nullContext||{},s=e.escapeExpression,i=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div class="tc-ctl-finfo-coords">\r\n    <span class="tc-ctl-finfo-coords-pair tc-ctl-finfo-coords-crs" title="'+s(i(n,"i18n").call(a,"crs",{name:"i18n",hash:{},data:o,loc:{start:{line:2,column:74},end:{line:2,column:88}}}))+'">CRS: <span class="tc-ctl-finfo-coords-val">'+s(e.lambda(null!=t?i(t,"crs"):t,t))+"</span></span>\r\n"+(null!=(r=i(n,"if").call(a,null!=t?i(t,"isGeo"):t,{name:"if",hash:{},fn:e.program(1,o,0),inverse:e.program(3,o,0),data:o,loc:{start:{line:3,column:4},end:{line:9,column:11}}}))?r:"")+"    "+(null!=(r=i(n,"if").call(a,null!=t?i(t,"displayElevation"):t,{name:"if",hash:{},fn:e.program(5,o,0),inverse:e.noop,data:o,loc:{start:{line:10,column:4},end:{line:10,column:356}}}))?r:"")+'\r\n</div>\r\n<div class="tc-ctl-finfo-result">\r\n    <ul class="tc-ctl-finfo-services">\r\n'+(null!=(r=i(n,"each").call(a,null!=t?i(t,"services"):t,{name:"each",hash:{},fn:e.program(7,o,0),inverse:e.program(47,o,0),data:o,loc:{start:{line:14,column:8},end:{line:79,column:17}}}))?r:"")+"    </ul>\r\n</div>\r\n"+(null!=(r=i(n,"if").call(a,null!=t?i(t,"featureCount"):t,{name:"if",hash:{},fn:e.program(51,o,0),inverse:e.noop,data:o,loc:{start:{line:82,column:0},end:{line:88,column:7}}}))?r:"")},usePartial:!0,useData:!0};e.template[e.CLASS+"-object"]={1:function(e,t,n,l,o){var r;return'<table class="complexAttr">\r\n    <tbody>\r\n'+(null!=(r=(e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]})(n,"each").call(null!=t?t:e.nullContext||{},t,{name:"each",hash:{},fn:e.program(2,o,0),inverse:e.noop,data:o,loc:{start:{line:4,column:4},end:{line:35,column:13}}}))?r:"")+"    </tbody>\r\n</table>\r\n"},2:function(e,t,n,l,o){var r,a=null!=t?t:e.nullContext||{},s=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return null!=(r=s(n,"unless").call(a,s(n,"isObject").call(a,t,{name:"isObject",hash:{},data:o,loc:{start:{line:5,column:18},end:{line:5,column:33}}}),{name:"unless",hash:{},fn:e.program(3,o,0),inverse:e.program(6,o,0),data:o,loc:{start:{line:5,column:8},end:{line:34,column:19}}}))?r:""},3:function(e,t,n,l,o){var r,a=null!=t?t:e.nullContext||{},s=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'        <tr class="keyValue">\r\n            <th class="key">'+e.escapeExpression(e.lambda(o&&s(o,"key"),t))+'</th>\r\n            <td class="value tc-ctl-finfo-val">'+(null!=(r=s(n,"unless").call(a,s(n,"isEmpty").call(a,t,{name:"isEmpty",hash:{},data:o,loc:{start:{line:8,column:57},end:{line:8,column:71}}}),{name:"unless",hash:{},fn:e.program(4,o,0),inverse:e.noop,data:o,loc:{start:{line:8,column:47},end:{line:8,column:115}}}))?r:"")+"</td>\r\n        </tr>\r\n"},4:function(e,t,n,l,o){var r,a=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return null!=(r=e.invokePartial(a(l,"tc-ctl-finfo-object"),t,{name:"tc-ctl-finfo-object",data:o,helpers:n,partials:l,decorators:e.decorators}))?r:""},6:function(e,t,n,l,o){var r,a=null!=t?t:e.nullContext||{},s=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'        <tr>\r\n            <th style="display:none">'+e.escapeExpression(e.lambda(o&&s(o,"key"),t))+"</th>\r\n            <td>\r\n"+(null!=(r=s(n,"if").call(a,s(n,"isObject").call(a,t,{name:"isObject",hash:{},data:o,loc:{start:{line:14,column:22},end:{line:14,column:37}}}),{name:"if",hash:{},fn:e.program(7,o,0),inverse:e.program(9,o,0),data:o,loc:{start:{line:14,column:16},end:{line:29,column:23}}}))?r:"")+(null!=(r=e.invokePartial(s(l,"tc-ctl-finfo-object"),t,{name:"tc-ctl-finfo-object",data:o,indent:"                    ",helpers:n,partials:l,decorators:e.decorators}))?r:"")+"                </div>\r\n            </td>\r\n        </tr>\r\n"},7:function(e,t,n,l,o){var r=null!=t?t:e.nullContext||{},a=e.escapeExpression,s=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'                \x3c!--object--\x3e\r\n                <input type="checkbox" id="complexAttr_'+a(s(n,"getId").call(r,t,{name:"getId",hash:{},data:o,loc:{start:{line:16,column:55},end:{line:16,column:69}}}))+'">\r\n                <div>\r\n                    <label for="complexAttr_'+a(s(n,"getId").call(r,t,{name:"getId",hash:{},data:o,loc:{start:{line:18,column:44},end:{line:18,column:58}}}))+'" class="plus" title=""></label>\r\n                    <label for="complexAttr_'+a(s(n,"getId").call(r,t,{name:"getId",hash:{},data:o,loc:{start:{line:19,column:44},end:{line:19,column:58}}}))+'" class="title" title="">'+a(e.lambda(o&&s(o,"key"),t))+"</label><br />\r\n"},9:function(e,t,n,l,o){var r,a=null!=t?t:e.nullContext||{},s=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return(null!=(r=s(n,"if").call(a,s(n,"isArray").call(a,t,{name:"isArray",hash:{},data:o,loc:{start:{line:21,column:26},end:{line:21,column:40}}}),{name:"if",hash:{},fn:e.program(10,o,0),inverse:e.program(12,o,0),data:o,loc:{start:{line:21,column:20},end:{line:27,column:27}}}))?r:"")+"                    \x3c!--native--\x3e\r\n"},10:function(e,t,n,l,o){var r=e.escapeExpression,a=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'                \x3c!--array--\x3e\r\n                <div>\r\n                    <label for="complexAttr_'+r(a(n,"getId").call(null!=t?t:e.nullContext||{},t,{name:"getId",hash:{},data:o,loc:{start:{line:24,column:44},end:{line:24,column:58}}}))+'" class="title" title="">'+r(e.lambda(o&&a(o,"key"),t))+"</label><br />\r\n"},12:function(e,t,n,l,o){return"                <div>\r\n"},14:function(e,t,n,l,o){var r,a=null!=t?t:e.nullContext||{},s=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return null!=(r=s(n,"if").call(a,s(n,"isArray").call(a,t,{name:"isArray",hash:{},data:o,loc:{start:{line:39,column:10},end:{line:39,column:24}}}),{name:"if",hash:{},fn:e.program(15,o,0),inverse:e.program(18,o,0),data:o,loc:{start:{line:39,column:4},end:{line:58,column:11}}}))?r:""},15:function(e,t,n,l,o){var r,a=null!=t?t:e.nullContext||{},s=e.escapeExpression,i=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div class="complexAttr">\r\n    <input type="checkbox" id="complexAttr_'+s(i(n,"getId").call(a,t,{name:"getId",hash:{},data:o,loc:{start:{line:41,column:43},end:{line:41,column:57}}}))+'">\r\n    <div>\r\n        <label for="complexAttr_'+s(i(n,"getId").call(a,t,{name:"getId",hash:{},data:o,loc:{start:{line:43,column:32},end:{line:43,column:46}}}))+'" class="plus" title=""></label>\r\n        <label for="complexAttr_'+s(i(n,"getId").call(a,t,{name:"getId",hash:{},data:o,loc:{start:{line:44,column:32},end:{line:44,column:46}}}))+'" class="title" title="">'+s(e.lambda(null!=t?i(t,"length"):t,t))+" "+s(i(n,"i18n").call(a,"featureInfo.complexData.array",{name:"i18n",hash:{},data:o,loc:{start:{line:44,column:82},end:{line:44,column:122}}}))+'</label><br />\r\n        <table class="complexAttr">\r\n            <tbody>\r\n'+(null!=(r=i(n,"each").call(a,t,{name:"each",hash:{},fn:e.program(16,o,0),inverse:e.noop,data:o,loc:{start:{line:47,column:16},end:{line:51,column:25}}}))?r:"")+"            </tbody>\r\n        </table>\r\n    </div>\r\n</div>\r\n"},16:function(e,t,n,l,o){var r,a=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return"                <tr>\r\n                    <td>"+(null!=(r=e.invokePartial(a(l,"tc-ctl-finfo-object"),t,{name:"tc-ctl-finfo-object",data:o,helpers:n,partials:l,decorators:e.decorators}))?r:"")+"</td>\r\n                </tr>\r\n"},18:function(e,t,n,l,o){var r;return(null!=(r=e.lambda(t,t))?r:"")+"\r\n"},compiler:[8,">= 4.3.0"],main:function(e,t,n,l,o){var r,a=null!=t?t:e.nullContext||{},s=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return null!=(r=s(n,"if").call(a,s(n,"isObject").call(a,t,{name:"isObject",hash:{},data:o,loc:{start:{line:1,column:6},end:{line:1,column:21}}}),{name:"if",hash:{},fn:e.program(1,o,0),inverse:e.program(14,o,0),data:o,loc:{start:{line:1,column:0},end:{line:59,column:7}}}))?r:""},usePartial:!0,useData:!0};e.template[e.CLASS+"-buttons"]={compiler:[8,">= 4.3.0"],main:function(e,t,n,l,o){var r=e.lambda,a=e.escapeExpression,s=null!=t?t:e.nullContext||{},i=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'\ufeff<div class="tc-ctl-finfo-btn">\r\n    <input type="checkbox" class="tc-ctl-finfo-btn-show-all" id="tc-ctl-finfo-btn-show-all-'+a(r(null!=t?i(t,"id"):t,t))+'" title="'+a(i(n,"i18n").call(s,"showOnMapAllResults",{name:"i18n",hash:{},data:o,loc:{start:{line:2,column:106},end:{line:2,column:136}}}))+'" />\r\n    <label for="tc-ctl-finfo-btn-show-all-'+a(r(null!=t?i(t,"id"):t,t))+'" class="tc-icon-btn tc-ctl-finfo-btn-show-all" title="'+a(i(n,"i18n").call(s,"showOnMapAllResults",{name:"i18n",hash:{},data:o,loc:{start:{line:3,column:103},end:{line:3,column:133}}}))+'">'+a(i(n,"i18n").call(s,"showOnMapAllResults",{name:"i18n",hash:{},data:o,loc:{start:{line:3,column:135},end:{line:3,column:165}}}))+'</label>\r\n    <button class="tc-icon-btn tc-ctl-finfo-btn-zoom-all tc-hidden" title="'+a(i(n,"i18n").call(s,"zoomToAllResults",{name:"i18n",hash:{},data:o,loc:{start:{line:4,column:75},end:{line:4,column:102}}}))+'">'+a(i(n,"i18n").call(s,"zoomToAllResults",{name:"i18n",hash:{},data:o,loc:{start:{line:4,column:104},end:{line:4,column:131}}}))+'</button>\r\n    <button class="tc-icon-btn tc-ctl-finfo-btn-del-all tc-hidden" title="'+a(i(n,"i18n").call(s,"removeAllResults",{name:"i18n",hash:{},data:o,loc:{start:{line:5,column:74},end:{line:5,column:101}}}))+'">'+a(i(n,"i18n").call(s,"removeAllResults",{name:"i18n",hash:{},data:o,loc:{start:{line:5,column:103},end:{line:5,column:130}}}))+'</button>\r\n    <button class="tc-icon-btn tc-ctl-finfo-btn-dl" title="'+a(i(n,"i18n").call(s,"downloadAllResults",{name:"i18n",hash:{},data:o,loc:{start:{line:6,column:59},end:{line:6,column:88}}}))+'">'+a(i(n,"i18n").call(s,"downloadAllResults",{name:"i18n",hash:{},data:o,loc:{start:{line:6,column:90},end:{line:6,column:119}}}))+"</button>\r\n</div>"},useData:!0};const t=function(){const e=this,t=e.getMenuTarget(),n=t.querySelector(e._selectors.SHOW_ALL_CHECKBOX);if(n){n.checked=!1;const l=e.getLocaleString("showOnMapAllResults");n.innerHTML=l;t.querySelector(e._selectors.SHOW_ALL_LABEL).setAttribute("title",l);t.querySelector(e._selectors.ZOOM_ALL_BUTTON).classList.add(TC.Consts.classes.HIDDEN);t.querySelector(e._selectors.DEL_ALL_BUTTON).classList.add(TC.Consts.classes.HIDDEN)}};e.register=function(e){const t=this,n=TC.control.Click.prototype.register.call(t,e);t._createLayers();e.loaded(function(){const n=e.getControlsByClass("TC.control.Share")[0];n&&t.loadSharedFeature(n.loadParamFeature());t.setDisplayMode(t.options.displayMode||e.defaultInfoContainer||TC.Consts.infoContainer.POPUP)});e.on(TC.Consts.event.POPUPHIDE+" "+TC.Consts.event.RESULTSPANELCLOSE,function(e){if(e.control===t.getDisplayControl()&&t.resultsLayer){if(t.highlightedFeature&&!t.options.persistentHighlights){t.downplayFeature(t.highlightedFeature);t.highlightedFeature=null}!t.querying&&e.feature&&t.filterLayer.removeFeature(e.feature)}}).on(TC.Consts.event.POPUP+" "+TC.Consts.event.DRAWTABLE+" "+TC.Consts.event.DRAWCHART,function(e){const n=e.control;n.currentFeature!==t.filterFeature&&(t.highlightedFeature=n.currentFeature);e.control.caller==t&&t._decorateDisplay(n)}).on(TC.Consts.event.DRAWCHART,function(e){setTimeout(function(){t.highlightedFeature=e.control.currentFeature},50)}).on(TC.Consts.event.LAYERREMOVE,function(){if(Object.keys(t._infoHistory).length){const e={};t.map.workLayers.filter(function(e){return e.type===TC.Consts.layerType.WMS}).forEach(function(t){const n=e[t.url]||[];e[t.url]=n.concat(t.getDisgregatedLayerNames())});let n=!1;for(let l in t._infoHistory){const o=t._infoHistory[l];if(e.hasOwnProperty(l)){const r=e[l];for(let e in o){const l=o[e];if(r.indexOf(e)<0){l.slice().forEach(e=>t.downplayFeature(e));l.length=0;n=!0}}}else{for(let e in o){o[e].slice().forEach(e=>t.downplayFeature(e));n=!0}delete t._infoHistory[l]}}n&&t.closeResults()}}).on(TC.Consts.event.VIEWCHANGE,function(e){t.closeResults()});return n};e.render=function(){this.div.classList.add(TC.Consts.classes.HIDDEN);return this._set1stRenderPromise(Promise.resolve())};e.responseCallback=function(e){const t=this;t.querying=!1;t.filterFeature&&(t.info={services:e.services});if(e.featureCount){t._addSourceAttributes();t.lastFeatureCount=e.featureCount;t.map.trigger(TC.Consts.event.FEATUREINFO,TC.Util.extend({control:t},e))}else{t.lastFeatureCount=0;t.map.trigger(TC.Consts.event.NOFEATUREINFO,{control:t})}};e.responseError=function(e){const t=this;404===e.status&&t.map.toast(t.getLocaleString("featureInfo.tooManyLayers"),{type:TC.Consts.msgType.ERROR});t.responseCallback({})};e.markerStyle={cssClass:TC.Consts.classes.POINT,anchor:[.5,.5],width:15,height:15,noPrint:!0};e.setDisplayMode=function(e){const t=this;t.displayMode=e;const n=t.map;switch(e){case TC.Consts.infoContainer.RESULTS_PANEL:if(!t.resultsPanel){let e;const l={content:"table",titles:{main:t.getLocaleString("threed.rs.panel.gfi"),max:t.getLocaleString("threed.rs.panel.gfi")}},o=n.getControlsByClass("TC.control.ControlContainer")[0];if(o){l.position=o.POSITION.RIGHT;e=o.addControl("resultsPanel",l)}else{l.div=document.createElement("div");n.map.div.appendChild(l.div);e=n.addControl("resultsPanel",l)}e.then(function(e){t.resultsPanel=e;e.caller=t})}break;default:t.displayMode=TC.Consts.infoContainer.POPUP;t.popup||n.addControl("popup",{closeButton:!0,draggable:t.options.draggable}).then(function(e){t.popup=e;e.caller=t;n.on(TC.Consts.event.POPUP,function(e){t.onShowPopup(e)});n.on(TC.Consts.event.POPUPHIDE,function(n){n.control===e&&t._resetSize()})})}};e.getDisplayControl=function(){switch(this.displayMode){case TC.Consts.infoContainer.RESULTS_PANEL:return this.resultsPanel;default:return this.popup}};e.getDisplayTarget=function(e){if((e=e||{}).control)switch(!0){case TC.control.Popup&&e.control instanceof TC.control.Popup:return e.control.getContainerElement();case TC.control.ResultsPanel&&e.control instanceof TC.control.ResultsPanel:return e.control.getInfoContainer();default:return null}switch(this.displayMode){case TC.Consts.infoContainer.RESULTS_PANEL:return this.resultsPanel.getInfoContainer();default:return this.popup.getContainerElement()}};e.getMenuTarget=function(){switch(this.displayMode){case TC.Consts.infoContainer.RESULTS_PANEL:return this.resultsPanel.getMenuElement();default:return this.popup.getMenuElement()}};e.displayResults=function(){var e=this;const t=e.div.cloneNode(!0);t.classList.remove(TC.Consts.classes.HIDDEN);e.filterFeature.data=t.outerHTML;switch(e.displayMode){case TC.Consts.infoContainer.RESULTS_PANEL:if(e.resultsPanel){0===e.map.getControlsByClass(TC.control.ControlContainer).length&&e.map.getControlsByClass(TC.control.ResultsPanel).forEach(function(e){e.isVisible()&&e.close()});e.map.getControlsByClass("TC.control.ResultsPanel").forEach(function(t){t!==e.resultsPanel&&t.currentFeature&&!t.chart&&t.close()});e.resultsPanel.currentFeature=e.filterFeature;e.resultsPanel.open(e.filterFeature.data,e.resultsPanel.getInfoContainer());e.getMenuTarget().innerHTML="";e.displayResultsCallback()}break;default:e.popup&&e.filterFeature.showPopup(e.popup)}};const n=function(e){return Array.from(e.parentElement.children).indexOf(e)},l=function(e,t){var n=e;do{n=n.parentElement}while(n&&n.tagName!==t);return n},o=function(e,t){const o=t,r=l(t,"LI"),a=l(r,"LI");return e.getFeature(n(a),n(r),n(o))};e.getFeatureElement=function(e){const t=this;let n;const l=t.getDisplayTarget().querySelectorAll(t._selectors.LIST_ITEM);for(let r=0,a=l.length;r<a;r++){const a=l[r];if(o(t,a)===e){n=a;break}}return n};e.getNextFeatureElement=function(e){const t=this,n=t.getDisplayTarget().querySelectorAll("ul."+t.CLASS+"-features > li"),l=n.length;for(var o=0;o<l;o++)if(n[o].matches("."+t.CURRENT_CLASS))return n[(o+e+l)%l];return null};e.getFeaturePath=function(e){const t=this;if(t.info&&t.info.services)for(var n=0,l=t.info.services.length;n<l;n++){const l=t.info.services[n];for(var o=0,r=l.layers.length;o<r;o++){const t=l.layers[o];for(var a=0,s=t.features.length;a<s;a++)if(t.features[a]===e)return{service:l.title||l.mapLayers.reduce(function(e,t){return e||t.title},""),layer:t.path}}}return null};e.closeResults=function(){switch(this.displayMode){case TC.Consts.infoContainer.RESULTS_PANEL:this.resultsPanel&&this.resultsPanel.isVisible()&&this.resultsPanel.close();break;default:this.popup&&this.popup.isVisible()&&this.popup.hide()}};e.displayResultsCallback=function(){var e=this;const t=e.getDisplayTarget().querySelector("."+e.CLASS),n=function(t){e.highlightFeature(t.target)};t.querySelectorAll(e._selectors.LIST_ITEM).forEach(e=>e.addEventListener("click",n));const r=t.querySelector(`.${e.CLASS}-btn-next`);r&&r.addEventListener(TC.Consts.event.CLICK,function(t){e.highlightFeature(e.getNextFeatureElement(1),1);return!1},{passive:!0});const a=t.querySelector(`.${e.CLASS}-btn-prev`);a&&a.addEventListener(TC.Consts.event.CLICK,function(t){e.highlightFeature(e.getNextFeatureElement(-1),-1);return!1},{passive:!0});const s=function(n){const o=l(n.target,"LI");if(o.classList.contains(TC.Consts.classes.CHECKED)){const n=t.querySelector(`.${e.CLASS}-layers li:not(.tc-checked)`);n&&"none"!==getComputedStyle(n).display&&e.downplayFeatures()}else{e.highlightFeature(o.querySelector(e._selectors.LIST_ITEM));e.displayMode===TC.Consts.infoContainer.POPUP&&e.popup.fitToView(!0)}};t.querySelectorAll(`ul.${e.CLASS}-layers h4`).forEach(e=>e.addEventListener(TC.Consts.event.CLICK,s,{passive:!0}));if(e.info){const n=e.getFeatures();n.length>1&&e.getRenderedHtml(`${e.CLASS}-buttons`,{id:e.id}).then(function(t){const l=e.getMenuTarget();if(!l.querySelector(`.${e.CLASS}-btn-dl`)){l.insertAdjacentHTML("beforeend",t);l.querySelector(`.${e.CLASS}-btn-dl`).addEventListener(TC.Consts.event.CLICK,async function(t){const l=await e.getDownloadDialog();let o={title:e.getLocaleString("featureInfo")+" - "+e.getLocaleString("download"),fileName:e._getFileName()};(e.map.elevation||e.options.displayElevation)&&(o=Object.assign({},o,{elevation:Object.assign({},e.map.elevation&&e.map.elevation.options,e.options.displayElevation)}));l.open(n,o)},{passive:!0});l.querySelector(e._selectors.SHOW_ALL_CHECKBOX).addEventListener("change",function(t){t.target.checked?e.showAllFeatures():e.hideAllFeatures()},{passive:!0});l.querySelector(e._selectors.ZOOM_ALL_BUTTON).addEventListener(TC.Consts.event.CLICK,function(t){e.map.zoomToFeatures(n)},{passive:!0});l.querySelector(e._selectors.DEL_ALL_BUTTON).addEventListener(TC.Consts.event.CLICK,function(t){e.downplayFeatures();e.filterLayer.removeFeature(e.filterFeature)},{passive:!0})}});if(e.info.defaultFeature&&e.getFeatureElement(e.info.defaultFeature)){e.getFeatureElement(e.info.defaultFeature).classList.add(TC.Consts.classes.DEFAULT);e.highlightFeature(e.info.defaultFeature)}else t.querySelector(e._selectors.LIST_ITEM)&&e.highlightFeature(t.querySelector(e._selectors.LIST_ITEM))}t.querySelectorAll("table:not(.complexAttr)").forEach(function(t){t.addEventListener(TC.Consts.event.CLICK,function(t){const n=this.parentElement;if(!n.classList.contains(TC.Consts.classes.DISABLED)){if(n.classList.contains(TC.Consts.classes.CHECKED)){const t=o(e,n);if(t&&window.getSelection()&&0===window.getSelection().toString().trim().length){e.map.on(TC.Consts.event.ZOOM,function t(){e._zooming=!1;e.map.off(TC.Consts.event.ZOOM,t)});e._zooming=!0;e.map.zoomToFeatures([t],{animate:!0})}}else e.highlightFeature(n);t.stopPropagation()}},{passive:!0})});t.querySelectorAll("table a, table label, table input").forEach(function(e){e.addEventListener(TC.Consts.event.CLICK,function(e){e.stopPropagation()},{passive:!0})});if(TC.browserFeatures.touch()&&e.displayMode===TC.Consts.infoContainer.RESULTS_PANEL){const n=t.querySelector("."+e.CLASS+"-btn-prev");if(!n||"none"!==n.style.display){e.resultsPanel&&TC.Util.swipe(e.resultsPanel.div,"disable");((i=e).info&&i.info.services?i.info.services.reduce(function(e,t){return e+t.layers.reduce(function(e,t){return e+1},0)},0):0)>1&&TC.Util.swipe(t,{left:function(){e.highlightFeature(e.getNextFeatureElement(1),1)},right:function(){e.highlightFeature(e.getNextFeatureElement(-1),-1)}})}}var i};e.onShowPopup=function(e){const t=this;if(e.control===t.popup){t.displayResultsCallback();t._fitSize()}};e.loadSharedFeature=function(e){};e.insertLinks=function(){const e=this.getLocaleString("open"),t=this.getLocaleString("linkInNewWindow");this.div.querySelectorAll("td."+this.CLASS+"-val").forEach(function(n){const l=n.textContent;TC.Util.isURL(l)&&(n.innerHTML='<a href="'+l+'" target="_blank" title="'+t+'">'+e+"</a>")})};e.highlightFeature=function(e,t){const o=this;var r;if(!o._zooming){var a;if(e instanceof TC.Feature){r=e;a=o.getFeatureElement(r)}else{a=e;for(;a&&"LI"!==a.tagName;)a=a.parentElement}const s=l(a,"LI"),i=l(s,"LI"),c=n(i),u=n(s),p=n(a);r=r||o.getFeature(c,u,p);o.downplayFeatures({exception:r});const f=o.info.services[c];o._infoHistory.hasOwnProperty(f.url)||(o._infoHistory[f.url]={});const h=o._infoHistory[f.url],d=f.layers[u],m=h[d.name]||[];h[d.name]=m.concat(r);const C=o.getDisplayTarget();C.querySelectorAll("li").forEach(e=>e.classList.remove(o.CURRENT_CLASS));a.classList.add(TC.Consts.classes.CHECKED,o.CURRENT_CLASS);s.classList.add(TC.Consts.classes.CHECKED,o.CURRENT_CLASS);i.classList.add(TC.Consts.classes.CHECKED,o.CURRENT_CLASS);if(t>0){a.classList.add(TC.Consts.classes.FROMLEFT);s.classList.add(TC.Consts.classes.FROMLEFT);i.classList.add(TC.Consts.classes.FROMLEFT)}else if(t<0){a.classList.add(TC.Consts.classes.FROMRIGHT);s.classList.add(TC.Consts.classes.FROMRIGHT);i.classList.add(TC.Consts.classes.FROMRIGHT)}a.querySelector("table")&&a.querySelector("table").setAttribute("title",o.getLocaleString("clickToCenter"));r instanceof TC.Feature||(r=null);if(r&&r===o.highlightedFeature)return;o.highlightedFeature=r;const y=C.querySelector("."+o.CLASS+"-counter-current");y&&(y.innerHTML=o.getFeatureIndex(c,u,p)+1);o.options.persistentHighlights||o.resultsLayer.features.slice().forEach(e=>{e!==o.filterFeature&&e!==r&&o.downplayFeature(e)});if(r){const e=()=>o.map.trigger(TC.Consts.event.FEATUREHIGHLIGHT,{feature:r,control:o});if(r.geometry){r.showsPopup=o.options.persistentHighlights;o.resultsLayer.addFeature(r).then(function(t){e()})}else{a.classList.add(TC.Consts.classes.DISABLED);e()}}}};e.downplayFeature=function(e){const t=this,n=t.getFeatureElement(e);n&&n.classList.remove(TC.Consts.classes.CHECKED);t.resultsLayer.removeFeature(e);for(url in t._infoHistory){const n=t._infoHistory[url];for(name in n){const t=n[name],l=t.indexOf(e);if(l>=0){t.splice(l,1);t.length||delete n[name]}}}t.highlightedFeature===e&&(t.highlightedFeature=null);t.map.trigger(TC.Consts.event.FEATUREDOWNPLAY,{feature:e,control:t})};e.downplayFeatures=function(e){const n=this;e=e||{};const o=n.highlightedFeature;if(o&&o!==e.exception){n.downplayFeature(o);n.highlightedFeature=null}n.getFeatures().filter(e=>e!==o).forEach(e=>n.resultsLayer.removeFeature(e));const r=e.exception?n.getFeatureElement(e.exception):void 0;var a,s;if(r){a=l(r,"LI");s=l(a,"LI")}const i=n.getDisplayTarget();Array.from(i.querySelectorAll("ul."+n.CLASS+"-services li")).filter(function(e){return e!==r&&e!==a&&e!==s}).forEach(function(e){e.classList.remove(TC.Consts.classes.CHECKED,TC.Consts.classes.DISABLED,TC.Consts.classes.FROMLEFT,TC.Consts.classes.FROMRIGHT)});i.querySelectorAll("."+n.CLASS+"-features table:not(.complexAttr)").forEach(function(e){e.setAttribute("title",n.getLocaleString("clickToShowOnMap"))});t.call(n)};e.showAllFeatures=function(){const e=this;e.highlightedFeature&&e.downplayFeature(e.highlightedFeature);e.getFeatures().forEach(t=>{t.showsPopup=e.options.persistentHighlights;e.resultsLayer.features.indexOf(t)<0&&e.resultsLayer.addFeature(t)});(function(){const e=this,t=e.getMenuTarget(),n=t.querySelector(e._selectors.SHOW_ALL_CHECKBOX);if(n){n.checked=!0;const l=e.getLocaleString("doNotShowOnMapAllResults");t.querySelector(e._selectors.SHOW_ALL_LABEL).setAttribute("title",l);n.innerHTML=l}t.querySelector(e._selectors.ZOOM_ALL_BUTTON).classList.remove(TC.Consts.classes.HIDDEN);t.querySelector(e._selectors.DEL_ALL_BUTTON).classList.remove(TC.Consts.classes.HIDDEN)}).call(e)};e.hideAllFeatures=function(){this.downplayFeatures();t.call(this)};e._fitSize=function(){const e=this.getDisplayTarget();var t=0;e.querySelectorAll("input").forEach(function(e){e.checked=!0});e.querySelectorAll(".tc-ctl-finfo-features li").forEach(function(e){t=Math.max(t,e.offsetLeft+e.offsetWidth)});t&&(e.style.width=t+50+"px");e.querySelectorAll("input").forEach(function(e){e.checked=!1})};e._resetSize=function(){this.getDisplayTarget().style.removeProperty("width")};e.getFeature=function(e,t,n){var l;const o=this.info;o&&o.services&&(l=o.services[e])&&(l=l.layers[t])&&(l=l.features[n]);return l};e.getFeatures=function(){let e=[];const t=this.info;t&&t.services&&(e=t.services.reduce((e,t)=>e.concat(t.layers.reduce((e,t)=>e.concat(t.features),[])),e));return e};e.getFeatureIndex=function(e,t,n){var l=-1;const o=this.info;if(o)for(var r=0;r<=e;r++)for(var a=o.services[r],s=r===e?t:a.layers.length-1,i=0;i<=s;i++)for(var c=a.layers[i],u=i===t?n:c.features.length-1,p=0;p<=u;p++)l+=1;return l};e.beforeRequest=function(e){var t=this;t.querying=!0;t.map.trigger(TC.Consts.event.BEFOREFEATUREINFO,{xy:e.xy,control:t});t.closeResults();if(t.map&&t.resultsLayer){t.lastFeatureCount=null;t.options.persistentHighlights||t.resultsLayer.features.slice().forEach(e=>t.downplayFeature(e));t.info=null}};e.activate=function(){this.wrap&&this.wrap.activate();TC.Control.prototype.activate.call(this)};e.deactivate=function(e){var t=this;t.popup&&t.popup.isVisible()&&t.popup.hide();if(!t.options.persistentHighlights){t.resultsLayer.features.slice().forEach(e=>t.downplayFeature(e));t.info=null;t._infoHistory={}}t.filterLayer&&t.filterLayer.clearFeatures();t.filterFeature=null;t.wrap&&t.wrap.deactivate();TC.Control.prototype.deactivate.call(t,e)};e.exportState=function(){const e=this;return e.exportsState&&e.resultsLayer?{id:e.id,layer:e.resultsLayer.exportState()}:null};e.importState=function(e){const t=this;t._layersPromise.then(function(){t.resultsLayer.importState(e.layer)})};e._createLayers=function(){const e=this;var t,n;t=e.options.resultsLayer?e.options.resultsLayer:{id:e.getUID(),title:e.CLASS+": Results layer",type:TC.Consts.layerType.VECTOR,owner:e,stealth:!0};if(e.options.filterLayer)n=e.options.filterLayer;else{const t={};e.geometryType===TC.Consts.geom.POLYLINE&&(t.line=e.style);e.geometryType===TC.Consts.geom.POLYGON&&(t.polygon=e.style);n={id:e.getUID(),title:e.CLASS+": Filter layer",owner:e,stealth:!0,type:TC.Consts.layerType.VECTOR,styles:t}}const l=e.map;e._layersPromise=new Promise(function(o,r){l.loaded(function(){Promise.all([l.addLayer(t),l.addLayer(n)]).then(function(t){e.resultsLayer=t[0];e.filterLayer=t[1];o()})})});return e._layersPromise};e._decorateDisplay=function(e){const t=this,n=t.getMenuTarget({control:e});TC.loadJS(!TC.control.Print,[TC.apiLocation+"TC/control/Print"],function(){if(!n.querySelectorAll("."+TC.control.Print.prototype.CLASS+"-btn").length){var l=t.getLocaleString("feature");if(e===t.getDisplayControl())if(TC.feature.Point&&t.filterFeature instanceof TC.feature.Point){const e=t.filterFeature.geometry;l=t.getLocaleString("featuresAt",{crs:t.map.crs,x:TC.Util.formatCoord(e[0],t.map.wrap.isGeo()?TC.Consts.DEGREE_PRECISION:TC.Consts.METER_PRECISION),y:TC.Util.formatCoord(e[1],t.map.wrap.isGeo()?TC.Consts.DEGREE_PRECISION:TC.Consts.METER_PRECISION)})}else l=t.getLocaleString("spatialQueryResults");else e.currentFeature&&(l=e.currentFeature.id);(t.lastFeatureCount||e.currentFeature&&!0===e.currentFeature.showsPopup)&&new TC.control.Print({target:n,printableElement:t.getDisplayTarget({control:e}),title:l})}})};e._addSourceAttributes=function(){const e=this,t="h3_"+e.getLocaleString("service"),n="h4_"+e.getLocaleString("layer");e.info&&e.info.services&&e.info.services.forEach(function(l){l.layers.forEach(function(l){l.features.forEach(function(l){if(l instanceof TC.Feature){const o=e.getFeaturePath(l);if(o){const r={};r[t]=o.service;o.layer&&(r[n]=o.layer.join(e.TITLE_SEPARATOR));const a=TC.Util.extend(r,l.getData());l.clearData();l.setData(a)}}})})})};e._getFileName=function(){return this.getLocaleString("featureInfo").toLowerCase().replace(/\s/gi,"_")+"_"+TC.Util.getFormattedDate((new Date).toString(),!0)}}();
//# sourceMappingURL=../maps/control/FeatureInfoCommons.min.js.map