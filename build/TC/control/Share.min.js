TC.control=TC.control||{};TC.control.MapInfo||TC.syncLoadJS(TC.apiLocation+"TC/control/MapInfo");TC.control.Share=function(t){this._classSelector="."+this.CLASS;TC.Control.apply(this,arguments);this.exportsState=!0;var e=t||{};this._dialogDiv=TC.Util.getDiv(e.dialogDiv);window.$&&(this._$dialogDiv=$(this._dialogDiv));e.dialogDiv||document.body.appendChild(this._dialogDiv);this.render()};TC.inherit(TC.control.Share,TC.control.MapInfo);!function(){var t=TC.control.Share.prototype;t.CLASS="tc-ctl-share";t.MAILTO_MAX_LENGTH=256;t.IFRAME_WIDTH="600px";t.IFRAME_HEIGHT="450px";t.FEATURE_PARAM="showfeature";t.MOBILEFAV="Siga las instrucciones del navegador del dispositivo m\xf3vil para a\xf1adir como favorito. Se guardar\xe1 el estado actual del mapa.";t.NAVALERT=" +D para guardar en marcadores.";t.render=function(t){const e=this;return e.getRenderedHtml(e.CLASS+"-dialog",null,function(t){e._dialogDiv.innerHTML=t}).then(function(){return TC.Control.prototype.renderData.call(e,{controlId:e.id},function(){if(document.queryCommandSupported&&document.queryCommandSupported("copy")){e.div.querySelectorAll("button").forEach(function(t){t.classList.remove("hide")});e.div.querySelectorAll("input[type=text]").forEach(function(t){delete t.dataset.dataOriginalTitle})}TC.Util.detectMobile()||e.div.querySelector(".share-whatsapp").classList.add(TC.Consts.classes.HIDDEN);const n=e.div.querySelectorAll("."+e.CLASS+"-url-box");e.div.querySelectorAll("span:not(.tc-beta)").forEach(function(t){t.addEventListener(TC.Consts.event.CLICK,function(t){for(var a=this;a&&"LABEL"!==a.tagName;)a=a.parentElement;const o=a.querySelector(`input[type=radio][name="${e.id}-format"]`).value;n.forEach(function(t){t.classList.toggle(TC.Consts.classes.HIDDEN,!t.matches(".tc-"+o))})},{passive:!0})});TC.Util.isFunction(t)&&t()})})};t.getLocation=function(){var t=window.location.href;window.location.hash&&(t=t.substr(0,t.indexOf(window.location.hash)));return t};t.manageMaxLengthExceed=function(t){this.div.querySelector("."+this.CLASS+"-alert").classList.toggle(TC.Consts.classes.HIDDEN,!t.browser);this._dialogDiv.querySelector("."+this.CLASS+"-qr-alert").classList.toggle(TC.Consts.classes.HIDDEN,!t.qr)};t.generateIframe=async function(t){const e=this,n=t||await e.generateLink();return n?'<iframe style="width:'+e.IFRAME_WIDTH+";height:"+e.IFRAME_HEIGHT+';" src="'+n+'"></iframe>':""};t.loadParamFeature=function(){const t=this;var e=null,n=TC.Util.getParameterByName(t.FEATURE_PARAM);if(n){var a;try{a=JSON.parse(decodeURIComponent(escape(window.atob(n))))}catch(e){TC.error(t.getLocaleString("sharedFeatureNotValid"),TC.Consts.msgErrorMode.TOAST)}a&&t.map&&(a.geom?t.map.addLayer({id:t.getUID(),type:TC.Consts.layerType.VECTOR,title:t.getLocaleString("foi"),owner:t,stealth:!0}).then(function(e){t.paramFeatureLayer=e;e.importState({features:[a]}).then(function(){t.map.zoomToFeatures(e.features)})}):e=a)}return e};t.update=async function(){const t=this,e=t.div.querySelector(".tc-url input[type=text]");if(0===e.value.trim().length){const n=await t.generateLink();t.registerListeners();e.value=n;t.div.querySelector(".tc-iframe input[type=text]").value=await t.generateIframe(n)}};t.register=function(e){const n=this,a=TC.control.MapInfo.prototype.register.call(n,e);a.then(function(){n.exportsState=!0;n.MOBILEFAV=n.getLocaleString("mobileBookmarks.instructions");n.NAVALERT=n.getLocaleString("bookmarks.instructions");n.div.addEventListener("click",TC.EventTarget.listenerBySelector("h2",function(t){n.update()}));n.map.on(TC.Consts.event.MAPCHANGE,function(t){const e=this.div.querySelector(".tc-url input[type=text]");e&&(e.dataset.update=!0);delete this.map._controlStatesCache}.bind(n));var a=async function(t,e){const a=t.parentElement.querySelector("input[type=text]");if(e)!a.dataset.update&&a.dataset.shortened||n.shortenedLink().then(async function(e){if(e&&e.trim().length>0){t.textContent=n.getLocaleString("shortened");setTimeout(function(){t.textContent=n.getLocaleString("shorten");o()},1e3);delete a.dataset.update;a.dataset.shortened=!0;a.value=e;a.select()}else{delete a.dataset.update;delete a.dataset.shortened;a.value=await n.generateLink()}});else{if(a.classList.contains("tc-url")){if(a.dataset.update){delete a.dataset.update;delete a.dataset.shortened;a.value=await n.generateLink()}}else a.value=await n.generateIframe();a.select()}},o=function(){document.getSelection().removeAllRanges();document.getSelection().addRange(document.createRange())};n.div.addEventListener("click",TC.EventTarget.listenerBySelector(".tc-ctl-share-url-box button",function(t){const e=t.target,l=!e.classList.contains("shorten");l?async function(t){await a(e);document.execCommand("copy");e.textContent=n.getLocaleString("copied");setTimeout(function(){e.textContent=n.getLocaleString(l?"copy":"shorten");o()},1e3)}():a(e,!0)}));n.div.addEventListener("click",TC.EventTarget.listenerBySelector("input[type=text]",function(t){a(t.target)}));n.div.addEventListener("click",TC.EventTarget.listenerBySelector(".ga-share-icon.tc-disabled",function(t){t.stopImmediatePropagation();t.preventDefault();return!1}));n.div.addEventListener("click",TC.EventTarget.listenerBySelector("a.share-email",async function(t){t.preventDefault();n.shortenedLink().then(function(t){if(t){const a=encodeURIComponent(t+"\n");a.length>n.MAILTO_MAX_LENGTH&&e.toast(n.getLocaleString("urlTooLongForMailto"),{type:TC.Consts.msgType.WARNING});window.location.href="mailto:?body="+a}})}));n.div.addEventListener("click",TC.EventTarget.listenerBySelector("a.qr-generator",function(t){t.preventDefault();const e=n._dialogDiv.querySelector(".qrcode");e.innerHTML="";n._dialogDiv.querySelector("."+n.CLASS+"-qr-alert").classList.contains(TC.Consts.classes.HIDDEN)?n.makeQRCode(e,256,256).then(function(t){t&&TC.Util.showModal(n._dialogDiv.querySelector(n._classSelector+"-qr-dialog"))}):TC.Util.showModal(n._dialogDiv.querySelector(n._classSelector+"-qr-dialog"))}));const l=function(t,e,a){if(e&&e.trim().length>0)t.location.href=a(e);else{TC.error(n.getLocaleString("urlTooLongForShortener"));t.close()}};n.div.addEventListener("click",TC.EventTarget.listenerBySelector("a.share-fb",function(t){t.preventDefault();const e=window.open();n.shortenedLink().then(function(t){l(e,t,function(t){return"https://www.facebook.com/sharer/sharer.php?u="+encodeURIComponent(t)})});return!1}));n.div.addEventListener("click",TC.EventTarget.listenerBySelector("a.share-twitter",function(t){t.preventDefault();const e=window.open();n.shortenedLink().then(function(t){l(e,t,function(t){return"https://twitter.com/intent/tweet?text="+encodeURIComponent(window.document.title?window.document.title:"Visor API SITNA")+"&url="+encodeURIComponent(t)})});return!1}));TC.Util.detectMobile()&&n.div.addEventListener("click",TC.EventTarget.listenerBySelector("a.share-whatsapp",function(t){t.preventDefault();n.shortenedLink().then(async function(t){var e="whatsapp://send?text=";location.href=void 0!==t?e+encodeURIComponent(t):e+encodeURIComponent(await n.generateLink())});return!1}));n.div.addEventListener("click",TC.EventTarget.listenerBySelector("a.share-star",async function(e){e.preventDefault();var a=await n.generateLink(),o=document.title;if(TC.Util.detectMobile())alert(t.MOBILEFAV);else if(window.sidebar&&window.sidebar.addPanel)window.sidebar.addPanel(o,a,"");else if(window.sidebar&&/Firefox/i.test(navigator.userAgent)||window.opera&&window.print){window.location.href=a;alert((/Mac/i.test(navigator.userAgent)?"Cmd":"Ctrl")+t.NAVALERT)}else if(window.external&&"AddFavorite"in window.external)window.external.AddFavorite(a,o);else{window.location.href=a;alert((/Mac/i.test(navigator.userAgent)?"Cmd":"Ctrl")+t.NAVALERT)}return!1}));e.loaded(()=>{n.div.classList.contains(TC.Consts.classes.COLLAPSED)||n.update()})});return a};t.template={};t.template[t.CLASS]={compiler:[8,">= 4.3.0"],main:function(t,e,n,a,o){var l=null!=e?e:t.nullContext||{},i=t.escapeExpression,r=t.lambda,s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"<h2>"+i(s(n,"i18n").call(l,"share",{name:"i18n",hash:{},data:o,loc:{start:{line:1,column:4},end:{line:1,column:20}}}))+' </h2>\r\n<div>\r\n    <div class="ga-share-icons"><a class="ga-share-icon share-email" target="_blank" data-toggle="tooltip" data-placement="top" title="'+i(s(n,"i18n").call(l,"sendMapByEmail",{name:"i18n",hash:{},data:o,loc:{start:{line:3,column:135},end:{line:3,column:160}}}))+'"\r\n        href="#">\r\n        <i class="icon-envelope-alt"></i>\r\n        </a><a class="ga-share-icon qr-generator" target="_blank" data-toggle="tooltip" data-placement="top" title="'+i(s(n,"i18n").call(l,"createQrCode",{name:"i18n",hash:{},data:o,loc:{start:{line:6,column:116},end:{line:6,column:139}}}))+'"\r\n        href="#">\r\n        <i class="icon-qrcode"></i>\r\n        </a><a class="ga-share-icon share-fb" target="_blank" data-toggle="tooltip" data-placement="top" title="'+i(s(n,"i18n").call(l,"shareMapToFacebook",{name:"i18n",hash:{},data:o,loc:{start:{line:9,column:112},end:{line:9,column:141}}}))+'"\r\n        href="#">\r\n        <i class="icon-facebook"></i>\r\n        </a><a class="ga-share-icon share-twitter" target="_blank" data-toggle="tooltip" data-placement="top" title="'+i(s(n,"i18n").call(l,"shareMapToTwitter",{name:"i18n",hash:{},data:o,loc:{start:{line:12,column:117},end:{line:12,column:145}}}))+'"\r\n        href="#">\r\n        <i class="icon-twitter"></i>\r\n        </a><a class="ga-share-icon share-whatsapp" target="_blank" data-toggle="tooltip" data-placement="top" title="'+i(s(n,"i18n").call(l,"shareMapToWhatsapp",{name:"i18n",hash:{},data:o,loc:{start:{line:15,column:118},end:{line:15,column:147}}}))+'"\r\n        href="#">\r\n        <i class="icon-whatsapp"></i>\r\n        </a><a class="ga-share-icon share-star" target="_blank" data-toggle="tooltip" data-placement="top" title="'+i(s(n,"i18n").call(l,"addToBookmarks",{name:"i18n",hash:{},data:o,loc:{start:{line:18,column:114},end:{line:18,column:139}}}))+'"\r\n        href="#">\r\n        <i class="icon-star"></i>\r\n        </a>\r\n    </div>\r\n    <div class="tc-ctl-share-select">\r\n        <label class="tc-ctl-share-btn-url" title="'+i(s(n,"i18n").call(l,"shareLink",{name:"i18n",hash:{},data:o,loc:{start:{line:24,column:51},end:{line:24,column:71}}}))+'"><input type="radio" checked="checked" name="'+i(r(null!=e?s(e,"controlId"):e,e))+'-format" value="url" /><span>'+i(s(n,"i18n").call(l,"shareLink",{name:"i18n",hash:{},data:o,loc:{start:{line:24,column:159},end:{line:24,column:179}}}))+'</span></label><label \r\n\t\tclass="tc-ctl-share-btn-iframe" title="'+i(s(n,"i18n").call(l,"embedMap",{name:"i18n",hash:{},data:o,loc:{start:{line:25,column:41},end:{line:25,column:60}}}))+'"><input type="radio" name="'+i(r(null!=e?s(e,"controlId"):e,e))+'-format" value="iframe" /><span>'+i(s(n,"i18n").call(l,"embedMap",{name:"i18n",hash:{},data:o,loc:{start:{line:25,column:133},end:{line:25,column:152}}}))+'</span></label>\r\n    </div>\r\n    <div class="tc-ctl-share-url-box tc-group tc-url">\r\n        <input type="text" class="tc-textbox tc-url" readonly data-toggle="tooltip" data-placement="top" title="'+i(s(n,"i18n").call(l,"shareLink.tip.1",{name:"i18n",hash:{},data:o,loc:{start:{line:28,column:112},end:{line:28,column:138}}}))+'" />\r\n        <button class="tc-button hide shorten" title="'+i(s(n,"i18n").call(l,"shareLink.tip.3",{name:"i18n",hash:{},data:o,loc:{start:{line:29,column:54},end:{line:29,column:80}}}))+'">'+i(s(n,"i18n").call(l,"shorten",{name:"i18n",hash:{},data:o,loc:{start:{line:29,column:82},end:{line:29,column:100}}}))+'</button>\r\n        <button class="tc-button hide" title="'+i(s(n,"i18n").call(l,"shareLink.tip.2",{name:"i18n",hash:{},data:o,loc:{start:{line:30,column:46},end:{line:30,column:72}}}))+'">'+i(s(n,"i18n").call(l,"copy",{name:"i18n",hash:{},data:o,loc:{start:{line:30,column:74},end:{line:30,column:89}}}))+'</button>\r\n    </div>\r\n    <div class="tc-ctl-share-url-box tc-group tc-iframe tc-hidden">\r\n        <input type="text" class="tc-textbox tc-iframe" readonly data-toggle="tooltip" data-placement="top" title="'+i(s(n,"i18n").call(l,"embedMap.tip.1",{name:"i18n",hash:{},data:o,loc:{start:{line:33,column:115},end:{line:33,column:140}}}))+'" />\r\n        <button class="tc-button hide" title="'+i(s(n,"i18n").call(l,"embedMap.tip.2",{name:"i18n",hash:{},data:o,loc:{start:{line:34,column:46},end:{line:34,column:71}}}))+'">'+i(s(n,"i18n").call(l,"copy",{name:"i18n",hash:{},data:o,loc:{start:{line:34,column:73},end:{line:34,column:88}}}))+'</button>\r\n    </div>\r\n    <div class="tc-ctl-share-alert tc-alert alert-warning tc-hidden">\r\n        <p>'+i(s(n,"i18n").call(l,"tooManyLayersLoaded",!0,{name:"i18n",hash:{},data:o,loc:{start:{line:37,column:11},end:{line:37,column:46}}}))+"</p>\r\n    </div>    \r\n</div>\r\n"},useData:!0};t.template[t.CLASS+"-dialog"]={compiler:[8,">= 4.3.0"],main:function(t,e,n,a,o){var l=null!=e?e:t.nullContext||{},i=t.escapeExpression,r=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<div class="tc-ctl-share-qr-dialog tc-modal">\r\n    <div class="tc-modal-background tc-modal-close"></div>\r\n    <div class="tc-modal-window">\r\n        <div class="tc-modal-header">\r\n            <h3>'+i(r(n,"i18n").call(l,"qrCode",{name:"i18n",hash:{},data:o,loc:{start:{line:5,column:16},end:{line:5,column:33}}}))+'</h3>\r\n            <div class="tc-modal-close"></div>\r\n        </div>\r\n        <div class="tc-modal-body">\r\n            <div class="qrcode"></div>      \r\n            <div class="tc-ctl-share-qr-alert tc-alert alert-warning tc-hidden">\r\n                <p>'+i(r(n,"i18n").call(l,"qrAdvice",!0,{name:"i18n",hash:{},data:o,loc:{start:{line:11,column:19},end:{line:11,column:43}}}))+'</p>\r\n            </div>\r\n        </div>\r\n        <div class="tc-modal-footer">\r\n            <button type="button" class="tc-button tc-modal-close">'+i(r(n,"i18n").call(l,"close",{name:"i18n",hash:{},data:o,loc:{start:{line:15,column:67},end:{line:15,column:83}}}))+"</button>\r\n        </div>\r\n    </div>\r\n</div>\r\n"},useData:!0};t.generateLink=async function(){const t=this.div.querySelector(".ga-share-icons"),e=this.div.querySelectorAll(`.${this.CLASS}-url-box tc-textbox`),n=this.div.querySelectorAll(`.${this.CLASS}-url-box button`),a=this.div.querySelector("."+this.CLASS+"-alert");t.classList.add(TC.Consts.classes.LOADING);e.forEach(t=>t.disabled=!0);n.forEach(t=>{t.classList.add(TC.Consts.classes.LOADING);t.disabled=!0});a.classList.add(TC.Consts.classes.LOADING);const o=await TC.control.MapInfo.prototype.generateLink.call(this);e.forEach(t=>t.disabled=!1);n.forEach(t=>{t.disabled=!1;t.classList.remove(TC.Consts.classes.LOADING)});t.classList.remove(TC.Consts.classes.LOADING);a.classList.remove(TC.Consts.classes.LOADING);return o}}();
//# sourceMappingURL=../maps/control/Share.min.js.map