TC.control=TC.control||{};TC.control.MapInfo||TC.syncLoadJS(TC.apiLocation+"TC/control/MapInfo");TC.control.Share=function(e){this._classSelector="."+this.CLASS;TC.Control.apply(this,arguments);this.exportsState=!0;var t=e||{};this._dialogDiv=TC.Util.getDiv(t.dialogDiv);window.$&&(this._$dialogDiv=$(this._dialogDiv));t.dialogDiv||document.body.appendChild(this._dialogDiv);this.render()};TC.inherit(TC.control.Share,TC.control.MapInfo);!function(){var e=TC.control.Share.prototype;e.CLASS="tc-ctl-share";e.MAILTO_MAX_LENGTH=256;e.IFRAME_WIDTH="600px";e.IFRAME_HEIGHT="450px";e.FEATURE_PARAM="showfeature";e.MOBILEFAV="Siga las instrucciones del navegador del dispositivo m\xf3vil para a\xf1adir como favorito. Se guardar\xe1 el estado actual del mapa.";e.NAVALERT=" +D para guardar en marcadores.";e.render=function(e){const t=this;return t.getRenderedHtml(t.CLASS+"-dialog",null,function(e){t._dialogDiv.innerHTML=e}).then(function(){return TC.Control.prototype.renderData.call(t,{controlId:t.id},function(){if(document.queryCommandSupported&&document.queryCommandSupported("copy")){t.div.querySelectorAll("button").forEach(function(e){e.classList.remove("hide")});t.div.querySelectorAll("input[type=text]").forEach(function(e){delete e.dataset.dataOriginalTitle})}TC.Util.detectMobile()||t.div.querySelector(".share-whatsapp").classList.add(TC.Consts.classes.HIDDEN);const n=t.div.querySelectorAll("."+t.CLASS+"-url-box");t.div.querySelectorAll("span:not(.tc-beta)").forEach(function(e){e.addEventListener(TC.Consts.event.CLICK,function(e){for(var a=this;a&&"LABEL"!==a.tagName;)a=a.parentElement;const o=a.querySelector(`input[type=radio][name="${t.id}-format"]`).value;n.forEach(function(e){e.classList.toggle(TC.Consts.classes.HIDDEN,!e.matches(".tc-"+o))})},{passive:!0})});TC.Util.isFunction(e)&&e()})})};e.getLocation=function(){var e=window.location.href;window.location.hash&&(e=e.substr(0,e.indexOf(window.location.hash)));return e};e.manageMaxLengthExceed=function(e){this.div.querySelector("."+this.CLASS+"-alert").classList.toggle(TC.Consts.classes.HIDDEN,!e.browser);this._dialogDiv.querySelector("."+this.CLASS+"-qr-alert").classList.toggle(TC.Consts.classes.HIDDEN,!e.qr)};e.generateIframe=async function(e){const t=this,n=e||await t.generateLink();return n?'<iframe style="width:'+t.IFRAME_WIDTH+";height:"+t.IFRAME_HEIGHT+';" src="'+n+'"></iframe>':""};e.loadParamFeature=function(){const e=this;var t=null,n=TC.Util.getParameterByName(e.FEATURE_PARAM);if(n){var a;try{a=JSON.parse(decodeURIComponent(escape(window.atob(n))))}catch(t){TC.error(e.getLocaleString("sharedFeatureNotValid"),TC.Consts.msgErrorMode.TOAST)}a&&e.map&&(a.geom?e.map.addLayer({id:e.getUID(),type:TC.Consts.layerType.VECTOR,title:e.getLocaleString("foi"),owner:e,stealth:!0}).then(function(t){e.paramFeatureLayer=t;t.importState({features:[a]}).then(function(){e.map.zoomToFeatures(t.features)})}):t=a)}return t};e.register=function(t){const n=this,a=TC.control.MapInfo.prototype.register.call(n,t);n.exportsState=!0;n.MOBILEFAV=n.getLocaleString("mobileBookmarks.instructions");n.NAVALERT=n.getLocaleString("bookmarks.instructions");n.div.addEventListener("click",TC.EventTarget.listenerBySelector("h2",async function(e){const t=n.div.querySelector(".tc-url input[type=text]");if(0===t.value.trim().length){const e=await n.generateLink();n.registerListeners();t.value=e;n.div.querySelector(".tc-iframe input[type=text]").value=await n.generateIframe(e)}}));n.map.on(TC.Consts.event.MAPCHANGE,function(e){const t=this.div.querySelector(".tc-url input[type=text]");t&&(t.dataset.update=!0)});var o=async function(e,t){const a=e.parentElement.querySelector("input[type=text]");if(t)!a.dataset.update&&a.dataset.shortened||n.shortenedLink().then(async function(t){if(t&&t.trim().length>0){e.textContent=n.getLocaleString("shortened");setTimeout(function(){e.textContent=n.getLocaleString("shorten");l()},1e3);delete a.dataset.update;a.dataset.shortened=!0;a.value=t;a.select()}else{delete a.dataset.update;delete a.dataset.shortened;a.value=await n.generateLink()}});else{if(a.classList.contains("tc-url")){if(a.dataset.update){delete a.dataset.update;delete a.dataset.shortened;a.value=await n.generateLink()}}else a.value=await n.generateIframe();a.select()}},l=function(){document.getSelection().removeAllRanges();document.getSelection().addRange(document.createRange())};n.div.addEventListener("click",TC.EventTarget.listenerBySelector(".tc-ctl-share-url-box button",function(e){const t=e.target,a=!t.classList.contains("shorten");a?async function(e){await o(t);document.execCommand("copy");t.textContent=n.getLocaleString("copied");setTimeout(function(){t.textContent=n.getLocaleString(a?"copy":"shorten");l()},1e3)}():o(t,!0)}));n.div.addEventListener("click",TC.EventTarget.listenerBySelector("input[type=text]",function(e){o(e.target)}));n.div.addEventListener("click",TC.EventTarget.listenerBySelector(".ga-share-icon.tc-disabled",function(e){e.stopImmediatePropagation();e.preventDefault();return!1}));n.div.addEventListener("click",TC.EventTarget.listenerBySelector("a.share-email",async function(e){e.preventDefault();var a=await n.generateLink();if(a){const e=encodeURIComponent(a+"\n");e.length>n.MAILTO_MAX_LENGTH&&t.toast(n.getLocaleString("urlTooLongForMailto"),{type:TC.Consts.msgType.WARNING});window.location.href="mailto:?body="+e}}));n.div.addEventListener("click",TC.EventTarget.listenerBySelector("a.qr-generator",function(e){e.preventDefault();const t=n._dialogDiv.querySelector(".qrcode");t.innerHTML="";n._dialogDiv.querySelector("."+n.CLASS+"-qr-alert").classList.contains(TC.Consts.classes.HIDDEN)?n.makeQRCode(t,256,256).then(function(e){e&&TC.Util.showModal(n._dialogDiv.querySelector(n._classSelector+"-qr-dialog"))}):TC.Util.showModal(n._dialogDiv.querySelector(n._classSelector+"-qr-dialog"))}));const i=function(e,t,a){if(t&&t.trim().length>0)e.location.href=a(t);else{TC.error(n.getLocaleString("urlTooLongForShortener"));e.close()}};n.div.addEventListener("click",TC.EventTarget.listenerBySelector("a.share-fb",function(e){e.preventDefault();const t=window.open();n.shortenedLink().then(function(e){i(t,e,function(e){return"https://www.facebook.com/sharer/sharer.php?u="+encodeURIComponent(e)})});return!1}));n.div.addEventListener("click",TC.EventTarget.listenerBySelector("a.share-twitter",function(e){e.preventDefault();const t=window.open();n.shortenedLink().then(function(e){i(t,e,function(e){return"https://twitter.com/intent/tweet?text="+encodeURIComponent(window.document.title?window.document.title:"Visor API SITNA")+"&url="+encodeURIComponent(e)})});return!1}));TC.Util.detectMobile()&&n.div.addEventListener("click",TC.EventTarget.listenerBySelector("a.share-whatsapp",function(e){e.preventDefault();n.shortenedLink().then(async function(e){var t="whatsapp://send?text=";location.href=void 0!==e?t+encodeURIComponent(e):t+encodeURIComponent(await n.generateLink())});return!1}));n.div.addEventListener("click",TC.EventTarget.listenerBySelector("a.share-star",async function(t){t.preventDefault();var a=await n.generateLink(),o=document.title;if(TC.Util.detectMobile())alert(e.MOBILEFAV);else if(window.sidebar&&window.sidebar.addPanel)window.sidebar.addPanel(o,a,"");else if(window.sidebar&&/Firefox/i.test(navigator.userAgent)||window.opera&&window.print){window.location.href=a;alert((/Mac/i.test(navigator.userAgent)?"Cmd":"Ctrl")+e.NAVALERT)}else if(window.external&&"AddFavorite"in window.external)window.external.AddFavorite(a,o);else{window.location.href=a;alert((/Mac/i.test(navigator.userAgent)?"Cmd":"Ctrl")+e.NAVALERT)}return!1}));return a};e.template={};e.template[e.CLASS]={compiler:[8,">= 4.3.0"],main:function(e,t,n,a,o){var l=null!=t?t:e.nullContext||{},i=e.escapeExpression,r=e.lambda,s=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return"<h2>"+i(s(n,"i18n").call(l,"share",{name:"i18n",hash:{},data:o,loc:{start:{line:1,column:4},end:{line:1,column:20}}}))+' </h2>\r\n<div>\r\n    <div class="ga-share-icons"><a class="ga-share-icon share-email" target="_blank" data-toggle="tooltip" data-placement="top" title="'+i(s(n,"i18n").call(l,"sendMapByEmail",{name:"i18n",hash:{},data:o,loc:{start:{line:3,column:135},end:{line:3,column:160}}}))+'"\r\n        href="#">\r\n        <i class="icon-envelope-alt"></i>\r\n        </a><a class="ga-share-icon qr-generator" target="_blank" data-toggle="tooltip" data-placement="top" title="'+i(s(n,"i18n").call(l,"createQrCode",{name:"i18n",hash:{},data:o,loc:{start:{line:6,column:116},end:{line:6,column:139}}}))+'"\r\n        href="#">\r\n        <i class="icon-qrcode"></i>\r\n        </a><a class="ga-share-icon share-fb" target="_blank" data-toggle="tooltip" data-placement="top" title="'+i(s(n,"i18n").call(l,"shareMapToFacebook",{name:"i18n",hash:{},data:o,loc:{start:{line:9,column:112},end:{line:9,column:141}}}))+'"\r\n        href="#">\r\n        <i class="icon-facebook"></i>\r\n        </a><a class="ga-share-icon share-twitter" target="_blank" data-toggle="tooltip" data-placement="top" title="'+i(s(n,"i18n").call(l,"shareMapToTwitter",{name:"i18n",hash:{},data:o,loc:{start:{line:12,column:117},end:{line:12,column:145}}}))+'"\r\n        href="#">\r\n        <i class="icon-twitter"></i>\r\n        </a><a class="ga-share-icon share-whatsapp" target="_blank" data-toggle="tooltip" data-placement="top" title="'+i(s(n,"i18n").call(l,"shareMapToWhatsapp",{name:"i18n",hash:{},data:o,loc:{start:{line:15,column:118},end:{line:15,column:147}}}))+'"\r\n        href="#">\r\n        <i class="icon-whatsapp"></i>\r\n        </a><a class="ga-share-icon share-star" target="_blank" data-toggle="tooltip" data-placement="top" title="'+i(s(n,"i18n").call(l,"addToBookmarks",{name:"i18n",hash:{},data:o,loc:{start:{line:18,column:114},end:{line:18,column:139}}}))+'"\r\n        href="#">\r\n        <i class="icon-star"></i>\r\n        </a>\r\n    </div>\r\n    <div class="tc-ctl-share-select">\r\n        <label class="tc-ctl-share-btn-url" title="'+i(s(n,"i18n").call(l,"shareLink",{name:"i18n",hash:{},data:o,loc:{start:{line:24,column:51},end:{line:24,column:71}}}))+'"><input type="radio" checked="checked" name="'+i(r(null!=t?s(t,"controlId"):t,t))+'-format" value="url" /><span>'+i(s(n,"i18n").call(l,"shareLink",{name:"i18n",hash:{},data:o,loc:{start:{line:24,column:159},end:{line:24,column:179}}}))+'</span></label><label \r\n\t\tclass="tc-ctl-share-btn-iframe" title="'+i(s(n,"i18n").call(l,"embedMap",{name:"i18n",hash:{},data:o,loc:{start:{line:25,column:41},end:{line:25,column:60}}}))+'"><input type="radio" name="'+i(r(null!=t?s(t,"controlId"):t,t))+'-format" value="iframe" /><span>'+i(s(n,"i18n").call(l,"embedMap",{name:"i18n",hash:{},data:o,loc:{start:{line:25,column:133},end:{line:25,column:152}}}))+'</span></label>\r\n    </div>\r\n    <div class="tc-ctl-share-url-box tc-group tc-url">\r\n        <input type="text" class="tc-textbox tc-url" readonly data-toggle="tooltip" data-placement="top" title="'+i(s(n,"i18n").call(l,"shareLink.tip.1",{name:"i18n",hash:{},data:o,loc:{start:{line:28,column:112},end:{line:28,column:138}}}))+'" />\r\n        <button class="tc-button hide shorten" title="'+i(s(n,"i18n").call(l,"shareLink.tip.3",{name:"i18n",hash:{},data:o,loc:{start:{line:29,column:54},end:{line:29,column:80}}}))+'">'+i(s(n,"i18n").call(l,"shorten",{name:"i18n",hash:{},data:o,loc:{start:{line:29,column:82},end:{line:29,column:100}}}))+'</button>\r\n        <button class="tc-button hide" title="'+i(s(n,"i18n").call(l,"shareLink.tip.2",{name:"i18n",hash:{},data:o,loc:{start:{line:30,column:46},end:{line:30,column:72}}}))+'">'+i(s(n,"i18n").call(l,"copy",{name:"i18n",hash:{},data:o,loc:{start:{line:30,column:74},end:{line:30,column:89}}}))+'</button>\r\n    </div>\r\n    <div class="tc-ctl-share-url-box tc-group tc-iframe tc-hidden">\r\n        <input type="text" class="tc-textbox tc-iframe" readonly data-toggle="tooltip" data-placement="top" title="'+i(s(n,"i18n").call(l,"embedMap.tip.1",{name:"i18n",hash:{},data:o,loc:{start:{line:33,column:115},end:{line:33,column:140}}}))+'" />\r\n        <button class="tc-button hide" title="'+i(s(n,"i18n").call(l,"embedMap.tip.2",{name:"i18n",hash:{},data:o,loc:{start:{line:34,column:46},end:{line:34,column:71}}}))+'">'+i(s(n,"i18n").call(l,"copy",{name:"i18n",hash:{},data:o,loc:{start:{line:34,column:73},end:{line:34,column:88}}}))+'</button>\r\n    </div>\r\n    <div class="tc-ctl-share-alert tc-alert alert-warning tc-hidden">\r\n        <p>'+i(s(n,"i18n").call(l,"tooManyLayersLoaded",!0,{name:"i18n",hash:{},data:o,loc:{start:{line:37,column:11},end:{line:37,column:46}}}))+"</p>\r\n    </div>    \r\n</div>\r\n"},useData:!0};e.template[e.CLASS+"-dialog"]={compiler:[8,">= 4.3.0"],main:function(e,t,n,a,o){var l=null!=t?t:e.nullContext||{},i=e.escapeExpression,r=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div class="tc-ctl-share-qr-dialog tc-modal">\r\n    <div class="tc-modal-background tc-modal-close"></div>\r\n    <div class="tc-modal-window">\r\n        <div class="tc-modal-header">\r\n            <h3>'+i(r(n,"i18n").call(l,"qrCode",{name:"i18n",hash:{},data:o,loc:{start:{line:5,column:16},end:{line:5,column:33}}}))+'</h3>\r\n            <div class="tc-modal-close"></div>\r\n        </div>\r\n        <div class="tc-modal-body">\r\n            <div class="qrcode"></div>      \r\n            <div class="tc-ctl-share-qr-alert tc-alert alert-warning tc-hidden">\r\n                <p>'+i(r(n,"i18n").call(l,"qrAdvice",!0,{name:"i18n",hash:{},data:o,loc:{start:{line:11,column:19},end:{line:11,column:43}}}))+'</p>\r\n            </div>\r\n        </div>\r\n        <div class="tc-modal-footer">\r\n            <button type="button" class="tc-button tc-modal-close">'+i(r(n,"i18n").call(l,"close",{name:"i18n",hash:{},data:o,loc:{start:{line:15,column:67},end:{line:15,column:83}}}))+"</button>\r\n        </div>\r\n    </div>\r\n</div>\r\n"},useData:!0};e.generateLink=async function(){const e=this.div.querySelector(".ga-share-icons"),t=this.div.querySelectorAll(`.${this.CLASS}-url-box tc-textbox`),n=this.div.querySelectorAll(`.${this.CLASS}-url-box button`),a=this.div.querySelector("."+this.CLASS+"-alert");e.classList.add(TC.Consts.classes.LOADING);t.forEach(e=>e.disabled=!0);n.forEach(e=>{e.classList.add(TC.Consts.classes.LOADING);e.disabled=!0});a.classList.add(TC.Consts.classes.LOADING);const o=await TC.control.MapInfo.prototype.generateLink.call(this);t.forEach(e=>e.disabled=!1);n.forEach(e=>{e.disabled=!1;e.classList.remove(TC.Consts.classes.LOADING)});e.classList.remove(TC.Consts.classes.LOADING);a.classList.remove(TC.Consts.classes.LOADING);return o}}();
//# sourceMappingURL=../maps/control/Share.min.js.map