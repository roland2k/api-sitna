TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");!function(){TC.control.Edit=function(){TC.Control.apply(this,arguments);this._classSelector="."+this.CLASS;this._selectors={MODE_RADIO_BUTTON:`input[type=radio][name="${this.id}-mode"]`};this.wrap=new TC.wrap.control.Edit(this);this.layer=null;this.callback=TC.Util.isFunction(arguments[2])?arguments[2]:this.options.callback?this.options.callback:null;this.cancelActionConfirmTxt=this.options.cancelText?this.options.eraseText:"Si continua todos los cambios se perder\xe1n. \xbfDesea continuar?";this.styles=this.options.styles;this.layersEditData={};this.pointDrawControl=null;this.lineDrawControl=null;this.polygonDrawControl=null;this.modifyControl=null;this.snapping="boolean"!=typeof this.options.snapping||this.options.snapping};TC.inherit(TC.control.Edit,TC.Control);TC.control.Edit.mode={MODIFY:"modify",ADDPOINT:"addpoint",ADDLINE:"addline",ADDPOLYGON:"addpolygon",CUT:"cut",OTHER:"other"};const e=TC.control.Edit.prototype;e.CLASS="tc-ctl-edit";e.template={};e.template[e.CLASS]={compiler:[8,">= 4.3.0"],main:function(e,t,n,o,l){var r=null!=t?t:e.nullContext||{},a=e.escapeExpression,i=e.lambda,c=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return"<h2>"+a(c(n,"i18n").call(r,"featureEditing",{name:"i18n",hash:{},data:l,loc:{start:{line:1,column:4},end:{line:1,column:29}}}))+'</h2>\r\n<div class="tc-ctl-edit-tools">\r\n    <div class="tc-ctl-edit-mode">\r\n        <label class="tc-ctl-edit-btn-modify" title="'+a(c(n,"i18n").call(r,"select",{name:"i18n",hash:{},data:l,loc:{start:{line:4,column:53},end:{line:4,column:70}}}))+'"><input type="radio" name="'+a(i(null!=t?c(t,"controlId"):t,t))+'-mode" value="modify" /><span>'+a(c(n,"i18n").call(r,"select",{name:"i18n",hash:{},data:l,loc:{start:{line:4,column:141},end:{line:4,column:158}}}))+'</span>\r\n        </label><label class="tc-ctl-edit-btn-point" title="'+a(c(n,"i18n").call(r,"newPoint",{name:"i18n",hash:{},data:l,loc:{start:{line:5,column:60},end:{line:5,column:79}}}))+'"><input type="radio" name="'+a(i(null!=t?c(t,"controlId"):t,t))+'-mode" value="addpoint" /><span>'+a(c(n,"i18n").call(r,"newPoint",{name:"i18n",hash:{},data:l,loc:{start:{line:5,column:152},end:{line:5,column:171}}}))+'</span>\r\n        </label><label class="tc-ctl-edit-btn-line" title="'+a(c(n,"i18n").call(r,"newLine",{name:"i18n",hash:{},data:l,loc:{start:{line:6,column:59},end:{line:6,column:77}}}))+'"><input type="radio" name="'+a(i(null!=t?c(t,"controlId"):t,t))+'-mode" value="addline" /><span>'+a(c(n,"i18n").call(r,"newLine",{name:"i18n",hash:{},data:l,loc:{start:{line:6,column:149},end:{line:6,column:167}}}))+'</span>\r\n        </label><label class="tc-ctl-edit-btn-polygon" title="'+a(c(n,"i18n").call(r,"newPolygon",{name:"i18n",hash:{},data:l,loc:{start:{line:7,column:62},end:{line:7,column:83}}}))+'"><input type="radio" name="'+a(i(null!=t?c(t,"controlId"):t,t))+'-mode" value="addpolygon" /><span>'+a(c(n,"i18n").call(r,"newPolygon",{name:"i18n",hash:{},data:l,loc:{start:{line:7,column:158},end:{line:7,column:179}}}))+'</span>\r\n        </label><label class="tc-ctl-edit-btn-other" title="'+a(c(n,"i18n").call(r,"otherTools",{name:"i18n",hash:{},data:l,loc:{start:{line:8,column:60},end:{line:8,column:81}}}))+'"><input type="radio" name="'+a(i(null!=t?c(t,"controlId"):t,t))+'-mode" value="other" /><span>'+a(c(n,"i18n").call(r,"otherTools",{name:"i18n",hash:{},data:l,loc:{start:{line:8,column:151},end:{line:8,column:172}}}))+'</span></label>\r\n    </div>\r\n    <div class="tc-ctl-edit-modify tc-hidden"></div>\r\n    <div class="tc-ctl-edit-point tc-hidden"></div>\r\n    <div class="tc-ctl-edit-line tc-hidden"></div>\r\n    <div class="tc-ctl-edit-polygon tc-hidden"></div>\r\n    <div class="tc-ctl-edit-other tc-hidden">\r\n        <button class="tc-button tc-ctl-edit-btn-import">'+a(c(n,"i18n").call(r,"importFromOtherLayer",{name:"i18n",hash:{},data:l,loc:{start:{line:15,column:57},end:{line:15,column:88}}}))+'</button><button class="tc-button tc-ctl-edit-btn-dl">'+a(c(n,"i18n").call(r,"download",{name:"i18n",hash:{},data:l,loc:{start:{line:15,column:142},end:{line:15,column:161}}}))+"</button>\r\n    </div>\r\n</div>"},useData:!0};e.template[e.CLASS+"-attr"]={1:function(e,t,n,o,l,r,a){var i,c=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return"            <tr>\r\n                <th>"+e.escapeExpression(e.lambda(null!=t?c(t,"name"):t,t))+"</th>\r\n                <td>\r\n"+(null!=(i=c(n,"if").call(null!=t?t:e.nullContext||{},null!=t?c(t,"readOnly"):t,{name:"if",hash:{},fn:e.program(2,l,0,r,a),inverse:e.program(4,l,0,r,a),data:l,loc:{start:{line:9,column:20},end:{line:48,column:27}}}))?i:"")+"                </td>\r\n            </tr>\r\n"},2:function(e,t,n,o,l){var r=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return"                        "+e.escapeExpression(e.lambda(null!=t?r(t,"value"):t,t))+"\r\n"},4:function(e,t,n,o,l,r,a){var i,c=null!=t?t:e.nullContext||{},s=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return(null!=(i=s(n,"if").call(c,null!=t?s(t,"availableValues"):t,{name:"if",hash:{},fn:e.program(5,l,0,r,a),inverse:e.noop,data:l,loc:{start:{line:12,column:24},end:{line:19,column:31}}}))?i:"")+"                        "+(null!=(i=s(n,"if").call(c,s(n,"eq").call(c,null!=t?s(t,"type"):t,"int",{name:"eq",hash:{},data:l,loc:{start:{line:20,column:30},end:{line:20,column:45}}}),{name:"if",hash:{},fn:e.program(8,l,0,r,a),inverse:e.program(10,l,0,r,a),data:l,loc:{start:{line:20,column:24},end:{line:41,column:31}}}))?i:"")+"                        \r\n                        \r\n                        \r\n                        \r\n                        \r\n                        \r\n"},5:function(e,t,n,o,l){var r,a=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'                        <select class="tc-combo" name="'+e.escapeExpression(e.lambda(null!=t?a(t,"name"):t,t))+'">\r\n                            <option value=""></option>\r\n'+(null!=(r=a(n,"each").call(null!=t?t:e.nullContext||{},null!=t?a(t,"availableValues"):t,{name:"each",hash:{},fn:e.program(6,l,0),inverse:e.noop,data:l,loc:{start:{line:15,column:28},end:{line:17,column:37}}}))?r:"")+"                        </select>\r\n"},6:function(e,t,n,o,l){var r=e.lambda,a=e.escapeExpression;return'                            <option value="'+a(r(t,t))+'">'+a(r(t,t))+"</option>\r\n"},8:function(e,t,n,o,l){var r,a=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return(null!=(r=e.invokePartial(a(o,"inputNumber"),t,{name:"inputNumber",data:l,helpers:n,partials:o,decorators:e.decorators}))?r:"")+"\r\n                        "},10:function(e,t,n,o,l){var r,a=null!=t?t:e.nullContext||{},i=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return null!=(r=i(n,"if").call(a,i(n,"eq").call(a,null!=t?i(t,"type"):t,"integer",{name:"eq",hash:{},data:l,loc:{start:{line:21,column:34},end:{line:21,column:53}}}),{name:"if",hash:{},fn:e.program(8,l,0),inverse:e.program(11,l,0),data:l,loc:{start:{line:21,column:24},end:{line:41,column:24}}}))?r:""},11:function(e,t,n,o,l){var r,a=null!=t?t:e.nullContext||{},i=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return null!=(r=i(n,"if").call(a,i(n,"eq").call(a,null!=t?i(t,"type"):t,"double",{name:"eq",hash:{},data:l,loc:{start:{line:22,column:34},end:{line:22,column:52}}}),{name:"if",hash:{},fn:e.program(8,l,0),inverse:e.program(12,l,0),data:l,loc:{start:{line:22,column:24},end:{line:41,column:24}}}))?r:""},12:function(e,t,n,o,l){var r,a=null!=t?t:e.nullContext||{},i=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return null!=(r=i(n,"if").call(a,i(n,"eq").call(a,null!=t?i(t,"type"):t,"boolean",{name:"eq",hash:{},data:l,loc:{start:{line:23,column:34},end:{line:23,column:53}}}),{name:"if",hash:{},fn:e.program(13,l,0),inverse:e.program(15,l,0),data:l,loc:{start:{line:23,column:24},end:{line:41,column:24}}}))?r:""},13:function(e,t,n,o,l){var r,a=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return(null!=(r=e.invokePartial(a(o,"inputCheckbox"),t,{name:"inputCheckbox",data:l,helpers:n,partials:o,decorators:e.decorators}))?r:"")+"\r\n                        "},15:function(e,t,n,o,l){var r,a=null!=t?t:e.nullContext||{},i=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return null!=(r=i(n,"if").call(a,i(n,"eq").call(a,null!=t?i(t,"type"):t,"date",{name:"eq",hash:{},data:l,loc:{start:{line:24,column:34},end:{line:24,column:50}}}),{name:"if",hash:{},fn:e.program(16,l,0),inverse:e.program(18,l,0),data:l,loc:{start:{line:24,column:24},end:{line:41,column:24}}}))?r:""},16:function(e,t,n,o,l){var r,a=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return(null!=(r=e.invokePartial(a(o,"inputDate"),t,{name:"inputDate",data:l,helpers:n,partials:o,decorators:e.decorators}))?r:"")+"\r\n                        "},18:function(e,t,n,o,l){var r,a=null!=t?t:e.nullContext||{},i=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return null!=(r=i(n,"if").call(a,i(n,"eq").call(a,null!=t?i(t,"type"):t,"time",{name:"eq",hash:{},data:l,loc:{start:{line:25,column:34},end:{line:25,column:50}}}),{name:"if",hash:{},fn:e.program(19,l,0),inverse:e.program(21,l,0),data:l,loc:{start:{line:25,column:24},end:{line:41,column:24}}}))?r:""},19:function(e,t,n,o,l){var r,a=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return(null!=(r=e.invokePartial(a(o,"inputTime"),t,{name:"inputTime",data:l,helpers:n,partials:o,decorators:e.decorators}))?r:"")+"\r\n                        "},21:function(e,t,n,o,l){var r,a=null!=t?t:e.nullContext||{},i=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return null!=(r=i(n,"if").call(a,i(n,"eq").call(a,null!=t?i(t,"type"):t,"dateTime",{name:"eq",hash:{},data:l,loc:{start:{line:26,column:34},end:{line:26,column:54}}}),{name:"if",hash:{},fn:e.program(22,l,0),inverse:e.program(24,l,0),data:l,loc:{start:{line:26,column:24},end:{line:41,column:24}}}))?r:""},22:function(e,t,n,o,l){var r,a=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return(null!=(r=e.invokePartial(a(o,"inputDatetime"),t,{name:"inputDatetime",data:l,helpers:n,partials:o,decorators:e.decorators}))?r:"")+"\r\n                        "},24:function(e,t,n,o,l){var r,a=null!=t?t:e.nullContext||{},i=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return null!=(r=i(n,"if").call(a,i(n,"eq").call(a,null!=t?i(t,"type"):t,"byte",{name:"eq",hash:{},data:l,loc:{start:{line:27,column:34},end:{line:27,column:50}}}),{name:"if",hash:{},fn:e.program(8,l,0),inverse:e.program(25,l,0),data:l,loc:{start:{line:27,column:24},end:{line:41,column:24}}}))?r:""},25:function(e,t,n,o,l){var r,a=null!=t?t:e.nullContext||{},i=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return null!=(r=i(n,"if").call(a,i(n,"eq").call(a,null!=t?i(t,"type"):t,"long",{name:"eq",hash:{},data:l,loc:{start:{line:28,column:34},end:{line:28,column:50}}}),{name:"if",hash:{},fn:e.program(8,l,0),inverse:e.program(26,l,0),data:l,loc:{start:{line:28,column:24},end:{line:41,column:24}}}))?r:""},26:function(e,t,n,o,l){var r,a=null!=t?t:e.nullContext||{},i=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return null!=(r=i(n,"if").call(a,i(n,"eq").call(a,null!=t?i(t,"type"):t,"negativeInteger",{name:"eq",hash:{},data:l,loc:{start:{line:29,column:34},end:{line:29,column:61}}}),{name:"if",hash:{},fn:e.program(8,l,0),inverse:e.program(27,l,0),data:l,loc:{start:{line:29,column:24},end:{line:41,column:24}}}))?r:""},27:function(e,t,n,o,l){var r,a=null!=t?t:e.nullContext||{},i=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return null!=(r=i(n,"if").call(a,i(n,"eq").call(a,null!=t?i(t,"type"):t,"nonNegativeInteger",{name:"eq",hash:{},data:l,loc:{start:{line:30,column:34},end:{line:30,column:64}}}),{name:"if",hash:{},fn:e.program(8,l,0),inverse:e.program(28,l,0),data:l,loc:{start:{line:30,column:24},end:{line:41,column:24}}}))?r:""},28:function(e,t,n,o,l){var r,a=null!=t?t:e.nullContext||{},i=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return null!=(r=i(n,"if").call(a,i(n,"eq").call(a,null!=t?i(t,"type"):t,"nonPositiveInteger",{name:"eq",hash:{},data:l,loc:{start:{line:31,column:34},end:{line:31,column:64}}}),{name:"if",hash:{},fn:e.program(8,l,0),inverse:e.program(29,l,0),data:l,loc:{start:{line:31,column:24},end:{line:41,column:24}}}))?r:""},29:function(e,t,n,o,l){var r,a=null!=t?t:e.nullContext||{},i=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return null!=(r=i(n,"if").call(a,i(n,"eq").call(a,null!=t?i(t,"type"):t,"positiveInteger",{name:"eq",hash:{},data:l,loc:{start:{line:32,column:34},end:{line:32,column:61}}}),{name:"if",hash:{},fn:e.program(8,l,0),inverse:e.program(30,l,0),data:l,loc:{start:{line:32,column:24},end:{line:41,column:24}}}))?r:""},30:function(e,t,n,o,l){var r,a=null!=t?t:e.nullContext||{},i=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return null!=(r=i(n,"if").call(a,i(n,"eq").call(a,null!=t?i(t,"type"):t,"short",{name:"eq",hash:{},data:l,loc:{start:{line:33,column:34},end:{line:33,column:51}}}),{name:"if",hash:{},fn:e.program(8,l,0),inverse:e.program(31,l,0),data:l,loc:{start:{line:33,column:24},end:{line:41,column:24}}}))?r:""},31:function(e,t,n,o,l){var r,a=null!=t?t:e.nullContext||{},i=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return null!=(r=i(n,"if").call(a,i(n,"eq").call(a,null!=t?i(t,"type"):t,"unsignedLong",{name:"eq",hash:{},data:l,loc:{start:{line:34,column:34},end:{line:34,column:58}}}),{name:"if",hash:{},fn:e.program(8,l,0),inverse:e.program(32,l,0),data:l,loc:{start:{line:34,column:24},end:{line:41,column:24}}}))?r:""},32:function(e,t,n,o,l){var r,a=null!=t?t:e.nullContext||{},i=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return null!=(r=i(n,"if").call(a,i(n,"eq").call(a,null!=t?i(t,"type"):t,"unsignedInt",{name:"eq",hash:{},data:l,loc:{start:{line:35,column:34},end:{line:35,column:57}}}),{name:"if",hash:{},fn:e.program(8,l,0),inverse:e.program(33,l,0),data:l,loc:{start:{line:35,column:24},end:{line:41,column:24}}}))?r:""},33:function(e,t,n,o,l){var r,a=null!=t?t:e.nullContext||{},i=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return null!=(r=i(n,"if").call(a,i(n,"eq").call(a,null!=t?i(t,"type"):t,"unsignedShort",{name:"eq",hash:{},data:l,loc:{start:{line:36,column:34},end:{line:36,column:59}}}),{name:"if",hash:{},fn:e.program(8,l,0),inverse:e.program(34,l,0),data:l,loc:{start:{line:36,column:24},end:{line:41,column:24}}}))?r:""},34:function(e,t,n,o,l){var r,a=null!=t?t:e.nullContext||{},i=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return null!=(r=i(n,"if").call(a,i(n,"eq").call(a,null!=t?i(t,"type"):t,"unsignedByte",{name:"eq",hash:{},data:l,loc:{start:{line:37,column:34},end:{line:37,column:58}}}),{name:"if",hash:{},fn:e.program(8,l,0),inverse:e.program(35,l,0),data:l,loc:{start:{line:37,column:24},end:{line:41,column:24}}}))?r:""},35:function(e,t,n,o,l){var r,a=null!=t?t:e.nullContext||{},i=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return null!=(r=i(n,"if").call(a,i(n,"eq").call(a,null!=t?i(t,"type"):t,"float",{name:"eq",hash:{},data:l,loc:{start:{line:38,column:34},end:{line:38,column:51}}}),{name:"if",hash:{},fn:e.program(8,l,0),inverse:e.program(36,l,0),data:l,loc:{start:{line:38,column:24},end:{line:41,column:24}}}))?r:""},36:function(e,t,n,o,l){var r,a=null!=t?t:e.nullContext||{},i=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return null!=(r=i(n,"if").call(a,i(n,"eq").call(a,null!=t?i(t,"type"):t,"decimal",{name:"eq",hash:{},data:l,loc:{start:{line:39,column:34},end:{line:39,column:53}}}),{name:"if",hash:{},fn:e.program(8,l,0),inverse:e.program(37,l,0),data:l,loc:{start:{line:39,column:24},end:{line:41,column:24}}}))?r:""},37:function(e,t,n,o,l){var r,a=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return(null!=(r=e.invokePartial(a(o,"inputText"),t,{name:"inputText",data:l,helpers:n,partials:o,decorators:e.decorators}))?r:"")+"\r\n                        "},39:function(e,t,n,o,l){var r=e.lambda,a=e.escapeExpression,i=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<input type="text" class="tc-textbox" name="'+a(r(null!=t?i(t,"name"):t,t))+'" value="'+a(r(null!=t?i(t,"value"):t,t))+'" />'},41:function(e,t,n,o,l){var r=e.lambda,a=e.escapeExpression,i=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<input type="number" class="tc-textbox" name="'+a(r(null!=t?i(t,"name"):t,t))+'" value="'+a(r(null!=t?i(t,"value"):t,t))+'" />'},43:function(e,t,n,o,l){var r,a=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<input type="checkbox" name="'+e.escapeExpression(e.lambda(null!=t?a(t,"name"):t,t))+'"'+(null!=(r=a(n,"if").call(null!=t?t:e.nullContext||{},null!=t?a(t,"value"):t,{name:"if",hash:{},fn:e.program(44,l,0),inverse:e.noop,data:l,loc:{start:{line:44,column:90},end:{line:44,column:118}}}))?r:"")+"/>"},44:function(e,t,n,o,l){return" checked"},46:function(e,t,n,o,l){var r=e.lambda,a=e.escapeExpression,i=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<input type="date" class="tc-textbox" name="'+a(r(null!=t?i(t,"name"):t,t))+'" value="'+a(r(null!=t?i(t,"value"):t,t))+'" />'},48:function(e,t,n,o,l){var r=e.lambda,a=e.escapeExpression,i=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<input type="time" class="tc-textbox" name="'+a(r(null!=t?i(t,"name"):t,t))+'" value="'+a(r(null!=t?i(t,"value"):t,t))+'" />'},50:function(e,t,n,o,l){var r=e.lambda,a=e.escapeExpression,i=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<input type="datetime" class="tc-textbox" name="'+a(r(null!=t?i(t,"name"):t,t))+'" value="'+a(r(null!=t?i(t,"value"):t,t))+'" />'},compiler:[8,">= 4.3.0"],main:function(e,t,n,o,l,r,a){var i,c=null!=t?t:e.nullContext||{},s=e.escapeExpression,u=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return"<h3>"+s(u(n,"i18n").call(c,"attributeEdit",{name:"i18n",hash:{},data:l,loc:{start:{line:1,column:4},end:{line:1,column:28}}}))+'</h3>\r\n<div class="tc-ctl-mod-attr-body">\r\n    <table>\r\n        <tbody>\r\n'+(null!=(i=e.hooks.blockHelperMissing.call(t,e.lambda(null!=t?u(t,"data"):t,t),{name:"data",hash:{},fn:e.program(1,l,0,r,a),inverse:e.noop,data:l,loc:{start:{line:5,column:12},end:{line:51,column:21}}}))?i:"")+'        </tbody>\r\n    </table>\r\n</div>\r\n<div class="tc-ctl-mod-attr-footer">\r\n    <button class="tc-button tc-ctl-mod-btn-attr-ok">'+s(u(n,"i18n").call(c,"ok",{name:"i18n",hash:{},data:l,loc:{start:{line:56,column:53},end:{line:56,column:66}}}))+'</button>\r\n    <button class="tc-button tc-ctl-mod-btn-attr-cancel">'+s(u(n,"i18n").call(c,"cancel",{name:"i18n",hash:{},data:l,loc:{start:{line:57,column:57},end:{line:57,column:74}}}))+"</button>\r\n</div>\r\n"},"4_d":function(e,t,n,o,l,r,a){var i=n.decorators,c=n.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};e=c(i,"inline")(e,t,n,{name:"inline",hash:{},fn:n.program(39,l,0,r,a),inverse:n.noop,args:["inputText"],data:l,loc:{start:{line:42,column:24},end:{line:42,column:133}}})||e;e=c(i,"inline")(e,t,n,{name:"inline",hash:{},fn:n.program(41,l,0,r,a),inverse:n.noop,args:["inputNumber"],data:l,loc:{start:{line:43,column:24},end:{line:43,column:137}}})||e;e=c(i,"inline")(e,t,n,{name:"inline",hash:{},fn:n.program(43,l,0,r,a),inverse:n.noop,args:["inputCheckbox"],data:l,loc:{start:{line:44,column:24},end:{line:44,column:131}}})||e;e=c(i,"inline")(e,t,n,{name:"inline",hash:{},fn:n.program(46,l,0,r,a),inverse:n.noop,args:["inputDate"],data:l,loc:{start:{line:45,column:24},end:{line:45,column:133}}})||e;e=c(i,"inline")(e,t,n,{name:"inline",hash:{},fn:n.program(48,l,0,r,a),inverse:n.noop,args:["inputTime"],data:l,loc:{start:{line:46,column:24},end:{line:46,column:133}}})||e;return e=c(i,"inline")(e,t,n,{name:"inline",hash:{},fn:n.program(50,l,0,r,a),inverse:n.noop,args:["inputDatetime"],data:l,loc:{start:{line:47,column:24},end:{line:47,column:141}}})||e},useDecorators:!0,usePartial:!0,useData:!0,useDepths:!0};e.template[e.CLASS+"-import"]={1:function(e,t,n,o,l){var r,a=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return null!=(r=e.invokePartial(a(o,"tc-ctl-edit-import-layer"),t,{name:"tc-ctl-edit-import-layer",data:l,indent:"                ",helpers:n,partials:o,decorators:e.decorators}))?r:""},compiler:[8,">= 4.3.0"],main:function(e,t,n,o,l){var r,a=null!=t?t:e.nullContext||{},i=e.escapeExpression,c=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div class="tc-ctl-edit-import">\r\n    <div class="tc-ctl-edit-import-list">\r\n        <ul class="tc-layers">\r\n'+(null!=(r=c(n,"each").call(a,null!=t?c(t,"layers"):t,{name:"each",hash:{},fn:e.program(1,l,0),inverse:e.noop,data:l,loc:{start:{line:4,column:12},end:{line:6,column:21}}}))?r:"")+'        </ul>\r\n        <p class="tc-ctl-edit-import-empty-note">'+i(c(n,"i18n").call(a,"thereAreNoCompatibleFeatures",{name:"i18n",hash:{},data:l,loc:{start:{line:8,column:49},end:{line:8,column:88}}}))+'</p>\r\n    </div>\r\n    <div class="tc-ctl-edit-import-foot">\r\n        <button class="tc-button tc-ctl-edit-import-btn-ok">'+i(c(n,"i18n").call(a,"ok",{name:"i18n",hash:{},data:l,loc:{start:{line:11,column:60},end:{line:11,column:73}}}))+"</button>\r\n    </div>\r\n</div>\r\n"},usePartial:!0,useData:!0};e.template[e.CLASS+"-import-layer"]={1:function(e,t,n,o,l){var r,a=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return null!=(r=e.invokePartial(a(o,"tc-ctl-edit-import-feature"),t,{name:"tc-ctl-edit-import-feature",data:l,indent:"            ",helpers:n,partials:o,decorators:e.decorators}))?r:""},compiler:[8,">= 4.3.0"],main:function(e,t,n,o,l){var r,a=e.lambda,i=e.escapeExpression,c=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<li class="tc-layer" data-layer-id="'+i(a(null!=t?c(t,"id"):t,t))+'">\r\n    <h3>'+i(a(null!=t?c(t,"title"):t,t))+'</h3>\r\n    <ul class="tc-features">\r\n'+(null!=(r=c(n,"each").call(null!=t?t:e.nullContext||{},null!=t?c(t,"features"):t,{name:"each",hash:{},fn:e.program(1,l,0),inverse:e.noop,data:l,loc:{start:{line:4,column:8},end:{line:6,column:17}}}))?r:"")+"    </ul>\r\n</li>"},usePartial:!0,useData:!0};e.template[e.CLASS+"-import-feature"]={compiler:[8,">= 4.3.0"],main:function(e,t,n,o,l){var r,a=e.lambda,i=e.escapeExpression,c=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<li class="tc-feature"><input type="checkbox" id="tc-ctl-edit-import-list-cb-'+i(a(null!=(r=null!=t?c(t,"layer"):t)?c(r,"id"):r,t))+"-"+i(a(null!=t?c(t,"id"):t,t))+'" value="'+i(a(null!=t?c(t,"id"):t,t))+'"> <label for="tc-ctl-edit-import-list-cb-'+i(a(null!=(r=null!=t?c(t,"layer"):t)?c(r,"id"):r,t))+"-"+i(a(null!=t?c(t,"id"):t,t))+'">'+i(a(null!=t?c(t,"id"):t,t))+"</label></li>\r\n"},useData:!0};e.register=function(e){const t=this;return new Promise(function(n,o){TC.Control.prototype.register.call(t,e).then(function(){t._pointDrawCtlPromise=e.addControl("draw",{id:t.getUID(),div:t.div.querySelector(`.${t.CLASS}-point`),mode:TC.Consts.geom.POINT,layer:!1});t._lineDrawCtlPromise=e.addControl("draw",{id:t.getUID(),div:t.div.querySelector(`.${t.CLASS}-line`),mode:TC.Consts.geom.POLYLINE,layer:!1});t._polygonDrawCtlPromise=e.addControl("draw",{id:t.getUID(),div:t.div.querySelector(`.${t.CLASS}-polygon`),mode:TC.Consts.geom.POLYGON,layer:!1});t._modifyCtlPromise=e.addControl("modify",{id:t.getUID(),div:t.div.querySelector(`.${t.CLASS}-modify`),snapping:t.snapping});Promise.all([t._pointDrawCtlPromise,t._lineDrawCtlPromise,t._polygonDrawCtlPromise,t._modifyCtlPromise]).then(function(o){t.pointDrawControl=o[0];t.lineDrawControl=o[1];t.polygonDrawControl=o[2];t.modifyControl=o[3];const l=function(e){e.feature.setStyle(null);t.trigger(TC.Consts.event.DRAWEND,{feature:e.feature})},r=function(){t.cancel()};t.pointDrawControl.on(TC.Consts.event.DRAWEND,l).on(TC.Consts.event.DRAWCANCEL,r);t.lineDrawControl.on(TC.Consts.event.DRAWEND,l).on(TC.Consts.event.DRAWCANCEL,r);t.polygonDrawControl.on(TC.Consts.event.DRAWEND,l).on(TC.Consts.event.DRAWCANCEL,r);t.modifyControl.on(TC.Consts.event.FEATUREMODIFY,function(e){t.trigger(TC.Consts.event.FEATUREMODIFY,{feature:e.feature,layer:e.layer})}).on(TC.Consts.event.FEATUREADD,function(e){t.trigger(TC.Consts.event.FEATUREADD,{feature:e.feature,layer:e.layer})}).on(TC.Consts.event.FEATUREREMOVE,function(e){t.trigger(TC.Consts.event.FEATUREREMOVE,{feature:e.feature,layer:e.layer})});t.modifyControl.displayAttributes=function(){const e=t.getSelectedFeatures(),n=e[e.length-1];if(n){t.modifyControl._editAttrBtn.classList.add(TC.Consts.classes.ACTIVE);const e=t.getLayerEditData(n.layer).attributes,o=Object.keys(e).map(t=>e[t]),l=t._joinedFeatureAttributes||[],r=n.getData()||{};o.forEach(function(e){e.value=r[e.name];"id"===e.name&&(e.readOnly=!0);e.availableValues=[];l.forEach(function(t){const n=t[e.name];void 0!==n&&""!==n&&e.availableValues.push(n)})});o.sort(function(e,t){return(e.readOnly?!t.readOnly:t.readOnly)?!e.readOnly-!t.readOnly:e.name>t.name?1:e.name<t.name?-1:0});t.getRenderedHtml(t.CLASS+"-attr",{data:o},function(e){t.modifyControl._attributesSection;const n=t.getAttributeDisplayTarget();n.classList.remove(TC.Consts.classes.HIDDEN);n.innerHTML=e;const o=n.querySelectorAll("input"),l=n.querySelectorAll("select");o.forEach(function(e){e.addEventListener("input",function(e){const t=e.target;for(var n=0,o=l.length;n<o;n++){const o=l[n];if(o.matches(`[name=${e.target.getAttribute("name")}]`)&&o.value!==t.value){o.value="";break}}})});l.forEach(function(e){e.addEventListener("change",function(e){const t=e.target;for(var n=0,l=o.length;n<l;n++){const l=o[n];if(l.matches(`[name=${e.target.getAttribute("name")}]`)){l.value=t.value;break}}})});n.querySelector(`.${t.modifyControl.CLASS}-btn-attr-ok`).addEventListener(TC.Consts.event.CLICK,function(e){t.modifyControl._onAttrOK()},{passive:!0});n.querySelector(`.${t.modifyControl.CLASS}-btn-attr-cancel`).addEventListener(TC.Consts.event.CLICK,function(){t.modifyControl.closeAttributes()},{passive:!0})})}};t.modifyControl._onAttrOK=function(){const e=this,n=e.getSelectedFeatures()[0];if(n){const o={},l=t.getLayerEditData(n.layer).attributes;e.getAttributeDisplayTarget().querySelectorAll("input").forEach(function(e){var t=e.getAttribute("name"),n=e.value;switch(l[t].type){case"int":case"integer":case"byte":case"long":case"negativeInteger":case"nonNegativeInteger":case"nonPositiveInteger":case"positiveInteger":case"short":case"unsignedLong":case"unsignedInt":case"unsignedShort":case"unsignedByte":n=parseInt(n);Number.isNaN(n)||(o[t]=n);break;case"double":case"float":case"decimal":n=parseFloat(n);Number.isNaN(n)||(o[t]=n);break;case"date":case"time":case"dateTime":o[t]=new Date(n);break;case"boolean":o[t]=!!n;break;case void 0:break;default:o[t]=n}});n.setData(o);e.trigger(TC.Consts.event.FEATUREMODIFY,{feature:n,layer:e.layer});e.closeAttributes()}};Array.isArray(t.options.modes)&&1==t.options.modes.length&&t.setMode(t.options.modes[0],null);n(t);e.loaded(function(){t.setLayer(t.options.layer)});e.on(TC.Consts.event.RESULTSPANELCLOSE,function(e){if(e.control===t.featureImportPanel){t.featuresToImport=[];t.getHighlightsLayer().then(e=>e.clearFeatures())}}).on(TC.Consts.event.LAYERREMOVE+" "+TC.Consts.event.FEATURESCLEAR,function(e){t.featureImportPanel&&!t.featureImportPanel.div.classList.contains(TC.Consts.classes.HIDDEN)&&t.getHighlightsLayer().then(function(n){for(let o=t.featuresToImport.length-1;o>=0;o--){const l=t.featuresToImport[o];if(l.layer===e.layer||l.original&&l.original.layer===e.layer){t.featuresToImport.splice(o,1);n.removeFeature(l)}}const o=t.featureImportPanel.getInfoContainer().querySelector(`li[data-layer-id="${e.layer.id}"]`);o&&o.remove()})}).on(TC.Consts.event.FEATUREREMOVE,function(e){t.featureImportPanel&&!t.featureImportPanel.div.classList.contains(TC.Consts.classes.HIDDEN)&&t.getHighlightsLayer().then(function(n){for(let o=0,l=t.featuresToImport.length;o<l;o++){const l=t.featuresToImport[o];if(l===e.feature||l.original===e.feature){t.featuresToImport.splice(o,1);n.removeFeature(l);const r=t.featureImportPanel.getInfoContainer().querySelector(`li[data-layer-id="${e.layer.id}"]`);if(r){const t=r.querySelector(`#tc-ctl-edit-import-list-cb-${e.layer.id}-${e.feature.id}`);t&&t.remove();r.children.length||r.remove()}break}}})}).on(TC.Consts.event.LAYERUPDATE,function(e){if(t.featureImportPanel&&!t.featureImportPanel.div.classList.contains(TC.Consts.classes.HIDDEN)){const n=t.getAvailableFeaturesToImport().filter(t=>t.id===e.layer.id)[0];n&&t.getRenderedHtml(t.CLASS+"-import-layer",n,function(n){const o=t.featureImportPanel.getInfoContainer().querySelector(`.${t.CLASS}-import-list .tc-layers`);o.querySelector(`li[data-layer-id="${e.layer.id}"]`)||o.insertAdjacentHTML("beforeend",n)})}}).on(TC.Consts.event.FEATUREADD+" "+TC.Consts.event.FEATURESADD,function(e){if(t.featureImportPanel&&!t.featureImportPanel.div.classList.contains(TC.Consts.classes.HIDDEN)){const n=e.layer,o=(e.feature?[e.feature]:e.features).filter(e=>t.isFeatureAllowed(e));o.length&&t.displayLayerToImport({id:n.id,title:n.title,features:o})}})})})})};e.render=function(e){const t=this;return t._set1stRenderPromise(TC.Control.prototype.renderData.call(t,{controlId:t.id},function(){if(Array.isArray(t.options.modes)&&t.options.modes.length>0){for(var n in TC.control.Edit.mode)if("string"==typeof n&&t.options.modes.indexOf(TC.control.Edit.mode[n])<0){const e=t.div.querySelector(`label${t._classSelector}-btn-${TC.control.Edit.mode[n]}`);e.parentElement.removeChild(e);const o=t.div.querySelector(`div${t._classSelector}-${TC.control.Edit.mode[n]}`);o.parentElement.removeChild(o)}if(1===t.options.modes.length){var o=t.options.modes[0];const e=t.div.querySelector(`label${t._classSelector}-btn-${o}`);e.parentElement.removeChild(e)}}t.div.querySelectorAll(t._selectors.MODE_RADIO_BUTTON).forEach(function(e){e.addEventListener("change",function(){var e=this.value,n=t.mode===e?void 0:e;t.setMode(n)})});t.div.querySelector(t._classSelector+"-btn-import").addEventListener(TC.Consts.event.CLICK,function(e){t.showFeatureImportPanel()},{passive:!0});t.div.querySelector(t._classSelector+"-btn-dl").addEventListener(TC.Consts.event.CLICK,function(e){t.getDownloadDialog().then(function(e){const n={title:t.getLocaleString("download"),fileName:t.layer.id.toLowerCase().replace(" ","_")+"_"+TC.Util.getFormattedDate((new Date).toString(),!0),elevation:t.options.downloadElevation};e.open(t.layer.features,n)})},{passive:!0});TC.Util.isFunction(e)&&e()}))};e.getGeometryType=function(e){switch(e){case"gml:LinearRingPropertyType":case"gml:PolygonPropertyType":case"LinearRingPropertyType":case"PolygonPropertyType":return TC.Consts.geom.POLYGON;case"gml:MultiPolygonPropertyType":case"gml:MultiSurfacePropertyType":case"MultiPolygonPropertyType":case"MultiSurfacePropertyType":return TC.Consts.geom.MULTIPOLYGON;case"gml:LineStringPropertyType":case"gml:CurvePropertyType":case"LineStringPropertyType":case"CurvePropertyType":return TC.Consts.geom.POLYLINE;case"gml:MultiLineStringPropertyType":case"gml:MultiCurvePropertyType":case"MultiLineStringPropertyType":case"MultiCurvePropertyType":return TC.Consts.geom.MULTIPOLYLINE;case"gml:PointPropertyType":case"gml:MultiPointPropertyType":case"PointPropertyType":case"MultiPointPropertyType":return TC.Consts.geom.POINT;case"gml:BoxPropertyType":case"BoxPropertyType":return TC.Consts.geom.RECTANGLE;case"gml:GeometryCollectionPropertyType":case"gml:GeometryAssociationType":case"gml:GeometryPropertyType":case"GeometryCollectionPropertyType":case"GeometryAssociationType":case"GeometryPropertyType":return!0;default:return!1}};e.setLayer=function(e){const t=this;t.layer=t.map.getLayer(e);t.layer&&e.describeFeatureType().then(function(n){const o={attributes:{}};for(var l in n){const e=n[l],r=t.getGeometryType(e.type);if(r){o.geometryName=e.name;o.geometryType="boolean"==typeof r?null:r}else o.attributes[l]=e}for(var l in o.attributes){const e=o.attributes[l];e.type=e.type.substr(e.type.indexOf(":")+1)}t.layersEditData[e.id]=o}).catch(function(n){t.layersEditData[e.id]={geometryType:null,attributes:{}}});const n=e=>e.setLayer(t.layer);t.getModifyControl().then(n);t.getPointDrawControl().then(n);t.getLineDrawControl().then(n);t.getPolygonDrawControl().then(n);t.setMode(t.layer?TC.control.Edit.mode.MODIFY:null);o=t,l=t.layer,o.div.querySelectorAll(o._selectors.MODE_RADIO_BUTTON).forEach(e=>e.disabled=!l);var o,l};e.setMode=function(e){var t=this;t.mode=e;var n,o,l=function(e){if(e){t.snapping&&(e.snapping=t.layer);e.activate()}};Promise.all([t._pointDrawCtlPromise,t._lineDrawCtlPromise,t._polygonDrawCtlPromise,t._modifyCtlPromise]).then(function(r){const a=r[0],i=r[1],c=r[2],s=r[3];switch(e){case TC.control.Edit.mode.MODIFY:n=t.div.querySelector(t._classSelector+"-modify");o=t.div.querySelectorAll(t._classSelector+"-point,"+t._classSelector+"-line,"+t._classSelector+"-polygon,"+t._classSelector+"-other");s.activate();break;case TC.control.Edit.mode.ADDPOINT:n=t.div.querySelector(t._classSelector+"-point");o=t.div.querySelectorAll(t._classSelector+"-modify,"+t._classSelector+"-line,"+t._classSelector+"-polygon,"+t._classSelector+"-other");l(a);break;case TC.control.Edit.mode.ADDLINE:n=t.div.querySelector(t._classSelector+"-line");o=t.div.querySelectorAll(t._classSelector+"-modify,"+t._classSelector+"-point,"+t._classSelector+"-polygon,"+t._classSelector+"-other");l(i);break;case TC.control.Edit.mode.ADDPOLYGON:n=t.div.querySelector(t._classSelector+"-polygon");o=t.div.querySelectorAll(t._classSelector+"-modify,"+t._classSelector+"-point,"+t._classSelector+"-line,"+t._classSelector+"-other");l(c);break;case TC.control.Edit.mode.OTHER:n=t.div.querySelector(t._classSelector+"-other");o=t.div.querySelectorAll(t._classSelector+"-modify,"+t._classSelector+"-point,"+t._classSelector+"-line,"+t._classSelector+"-polygon");r.indexOf(t.map.activeControl)>=0&&t.map.activeControl.deactivate();break;default:n=null;o=t.div.querySelectorAll(t._classSelector+"-modify,"+t._classSelector+"-point,"+t._classSelector+"-line,"+t._classSelector+"-polygon,"+t._classSelector+"-other");r.indexOf(t.map.activeControl)>=0&&t.map.activeControl.deactivate()}if(e){t.div.querySelector(`${t._selectors.MODE_RADIO_BUTTON}[value=${e}]`).checked=!0}else t.div.querySelectorAll(t._selectors.MODE_RADIO_BUTTON).forEach(function(e){e.checked=!1});n&&n.classList.remove(TC.Consts.classes.HIDDEN);o.forEach(function(e){e.classList.add(TC.Consts.classes.HIDDEN)})})};e.constrainModes=function(e){const t=this;Array.isArray(e)||(e=[]);t.modes=e.filter(function(e){for(var t in TC.control.Edit.mode)if(TC.control.Edit.mode[t]===e)return!0;return!1}).filter(function(e){return!Array.isArray(t.options.modes)||t.options.modes.indexOf(e)>=0});t.modes.indexOf(t.mode)<0&&t.setMode(null);const n=t.modes.map(e=>`[value=${e}]`).join()||"[value]";t.div.querySelectorAll(t._selectors.MODE_RADIO_BUTTON).forEach(function(e){e.disabled=!e.matches(n)})};e.isFeatureAllowed=function(e){const t=this;switch(!0){case TC.feature.Point&&e instanceof TC.feature.Point:return t.modes.indexOf(TC.control.Edit.mode.ADDPOINT)>=0;case TC.feature.Polyline&&e instanceof TC.feature.Polyline:return t.modes.indexOf(TC.control.Edit.mode.ADDLINE)>=0;case TC.feature.MultiPolyline&&e instanceof TC.feature.MultiPolyline:return t.modes.indexOf(TC.control.Edit.mode.ADDLINE)>=0&&t.isMultiple;case TC.feature.Polygon&&e instanceof TC.feature.Polygon:return t.modes.indexOf(TC.control.Edit.mode.ADDPOLYGON)>=0;case TC.feature.MultiPolygon&&e instanceof TC.feature.MultiPolygon:return t.modes.indexOf(TC.control.Edit.mode.ADDPOLYGON)>=0&&t.isMultiple;default:return!0}};e.setComplexGeometry=function(e){this.isMultiple=e;this.getLineDrawControl().then(t=>t.setMode(e?TC.Consts.geom.MULTIPOLYLINE:TC.Consts.geom.POLYLINE));this.getPolygonDrawControl().then(t=>t.setMode(e?TC.Consts.geom.MULTIPOLYGON:TC.Consts.geom.POLYGON))};e.getLayerEditData=function(e){const t=e||this.layer;return t?this.layersEditData[t.id]=this.layersEditData[t.id]||{checkedOut:!1}:null};e.cancel=function(){Array.isArray(this.options.modes)&&1==this.options.modes.length?this.setMode(this.options.modes[0],null):this.setMode(null,!1);this.wrap.cancel(!0,this.cancelActionConfirmTxt)};e.onFeatureClick=function(e){self.activeControl&&self.activeControl.isExclusive()||e.feature.show()};e.activate=function(e){const t=this,n=function(e){e!==t.map.activeControl&&(t._previousActiveControl=t.map.activeControl)};switch((e=e||{}).mode){case TC.control.Edit.mode.ADDPOINT:t.getPointDrawControl().then(n);break;case TC.control.Edit.mode.ADDLINE:t.getLineDrawControl().then(n);break;case TC.control.Edit.mode.ADDPOLYGON:t.getPolygonDrawControl().then(n);break;default:t.getModifyControl().then(n)}};e.deactivate=function(){const e=this;if(e._previousActiveControl){e.map.previousActiveControl=e._previousActiveControl;switch(e.map.activeControl){case e.pointDrawControl:e.pointDrawControl.deactivate();break;case e.lineDrawControl:e.lineDrawControl.deactivate();break;case e.polygonDrawControl:e.polygonDrawControl.deactivate();break;case e.modifyControl:e.modifyControl.deactivate()}}e.modifyControl&&e.modifyControl.closeAttributes()};e.isExclusive=function(){return!0};e.getAttributeDisplayTarget=function(){return this.modifyControl._attributesSection};e.getSelectedFeatures=function(){return this.modifyControl.getSelectedFeatures()};e.setSelectedFeatures=function(e){return this.modifyControl.setSelectedFeatures(e)};e.getLayer=function(){return this.layer};e.getModifyControl=function(){const e=this;return e._modifyCtlPromise||new Promise(function(t,n){e.renderPromise().then(()=>t(e.modifyControl))})};e.getPointDrawControl=function(){const e=this;return e._pointDrawCtlPromise||new Promise(function(t,n){e.renderPromise().then(()=>t(e.pointDrawControl))})};e.getLineDrawControl=function(){const e=this;return e._lineDrawCtlPromise||new Promise(function(t,n){e.renderPromise().then(()=>t(e.lineDrawControl))})};e.getPolygonDrawControl=function(){const e=this;return e._polygonDrawCtlPromise||new Promise(function(t,n){e.renderPromise().then(()=>t(e.polygonDrawControl))})};e.getFeatureImportPanel=function(){const e=this;if(!e._featureImportPanelPromise){e._featureImportPanelPromise=e.map.addControl("resultsPanel",{titles:{main:e.getLocaleString("importFromOtherLayer")}});e._featureImportPanelPromise.then(t=>e.featureImportPanel=t)}return e._featureImportPanelPromise};e.getHighlightsLayer=function(){const e=this;if(!e._highlightsLayerPromise){e._highlightsLayerPromise=e.map.addLayer({id:e.getUID(),type:TC.Consts.layerType.VECTOR,title:"Highlights Layer",stealth:!0,styles:e.map.options.styles.selection||TC.Cfg.styles.selection});e._highlightsLayerPromise.then(t=>e.highlightsLayer=t)}return e._highlightsLayerPromise};e.highlightFeatures=function(e){const t=this;t.getHighlightsLayer().then(function(n){const o=t.featuresToImport.concat(e);n.features.slice().forEach(function(e){(!e.original||o.indexOf(e.original)<0)&&n.removeFeature(e)});n.addFeatures(o.filter(function(e){return!n.features.some(function(t){return t.original&&t.original===e})}).map(function(e){const t=e.clone();t.toggleSelectedStyle(!0);t.original=e;return t}))})};e.getAvailableFeaturesToImport=function(){const e=this;return e.map.workLayers.filter(e=>!e.isRaster()).filter(t=>t!==e.layer).filter(t=>t!==e.highlightsLayer).map(function(t){return{id:t.id,title:t.title,features:t.features.filter(function(t){return e.isFeatureAllowed(t)})}}).filter(e=>e.features.length)};e.getFeatureFromImportList=function(e){const t=e.querySelector("input"),n=this.map.getLayer(e.parentElement.parentElement.dataset.layerId);return n?n.getFeatureById(t.value):null};e.importFeatures=function(e){const t=this;let n=!1;const o=t.getLayerEditData();(e||t.featuresToImport||[]).filter(e=>{const o=t.isFeatureAllowed(e);o||(n=!0);return o}).map(function(e){let n;const l={data:e.data,geometryName:o.geometryName};if(t.isMultiple)switch(!0){case TC.feature.Polygon&&e instanceof TC.feature.Polygon:n=new TC.feature.MultiPolygon([e.geometry],l);break;case TC.feature.Polyline&&e instanceof TC.feature.Polyline:n=new TC.feature.MultiPolyline([e.geometry],l);break;default:n=e.clone()}else switch(!0){case TC.feature.MultiPolygon&&e instanceof TC.feature.MultiPolygon:n=new TC.feature.Polygon(e.geometry[0],l);break;case TC.feature.MultiPolyline&&e instanceof TC.feature.MultiPolyline:n=new TC.feature.Polyline(e.geometry[0],l);break;default:n=e.clone()}n.setStyle(null);return n}).forEach(function(e){t.layer.addFeature(e);t.trigger(TC.Consts.event.FEATUREADD,{feature:e,layer:t.layer})});n&&t.map.toast(t.getLocaleString("importFromOtherLayer.warning"),{type:TC.Consts.msgType.WARNING})};const t=function(e,t){const n=e.getFeatureFromImportList(t.parentElement);if(t.checked)e.featuresToImport.push(n);else{const t=e.featuresToImport.indexOf(n);t>=0&&e.featuresToImport.splice(t,1)}};e._addImportLayerEvents=function(e){const n=this;e.querySelector("input").addEventListener("change",function(e){const o=this;o.parentElement.querySelectorAll("li.tc-feature input").forEach(function(e){if(e.checked!==o.checked){e.checked=o.checked;t(n,e)}});n.highlightFeatures([])});e.querySelectorAll("li.tc-feature").forEach(function(e){n._addImportFeatureEvents(e)})};e._addImportFeatureEvents=function(e){const n=this,o=function(e){const t=n.getFeatureFromImportList(this);t&&n.highlightFeatures([t])};e.addEventListener(TC.Consts.event.CLICK,o,{passive:!0});e.addEventListener("mouseover",o);e.querySelector("input").addEventListener("change",function(e){t(n,this)})};e.showFeatureImportPanel=function(){const e=this;e.featuresToImport=[];e.getFeatureImportPanel().then(function(t){const n=t.getInfoContainer();e.getRenderedHtml(e.CLASS+"-import",{layers:e.getAvailableFeaturesToImport()},function(o){t.open(o,n);n.querySelector("ul").addEventListener("mouseout",function(t){e.highlightFeatures([])});n.querySelectorAll("li.tc-layer").forEach(function(t){e._addImportLayerEvents(t)});n.querySelector(`.${e.CLASS}-import-btn-ok`).addEventListener(TC.Consts.event.CLICK,function(t){e.importFeatures();e.featureImportPanel.close()},{passive:!0})})})};e.displayLayerToImport=function(e){const t=this;return new Promise(function(n,o){if(t.featureImportPanel&&!t.featureImportPanel.div.classList.contains(TC.Consts.classes.HIDDEN)){const o=t.featureImportPanel.getInfoContainer().querySelector(`.${t.CLASS}-import-list .tc-layers`),l=`li[data-layer-id="${e.id}"]`,r=o.querySelector(l);if(r){features.forEach(function(e){t.isFeatureAllowed(e)&&t.getRenderedHtml(t.CLASS+"-import-feature",layerObj,function(e){r.insertAdjacentHTML("beforeend",e);t._addImportFeatureEvents(r.querySelector("li:last-child"))})});n(r)}else t.getRenderedHtml(t.CLASS+"-import-layer",{id:e.id,title:e.title,features:e.features},function(e){o.insertAdjacentHTML("beforeend",e);const r=o.querySelector(l);t._addImportLayerEvents(r);n(r)})}else n(null)})}}();
//# sourceMappingURL=../maps/control/Edit.min.js.map