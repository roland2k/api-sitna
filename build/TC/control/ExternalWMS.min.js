TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.control.ExternalWMS=function(e){this.count=0;this._addedUrls=[];TC.Control.apply(this,arguments);this.allowReprojection=!this.options.hasOwnProperty("allowReprojection")||this.options.allowReprojection};TC.inherit(TC.control.ExternalWMS,TC.Control);!function(){var e=TC.control.ExternalWMS.prototype;e.CLASS="tc-ctl-xwms";e.markServicesAsSelected=function(e){if(e.length>0){const t=e[0];t.disabled=!0;t.classList.add("tc-ctl-xwms-option-selected")}};e.register=function(e){const t=this,n=TC.Control.prototype.register.call(t,e);t.div.addEventListener("change",TC.EventTarget.listenerBySelector("select",function(e){if(""!==e.target.value){var n=e.target.value;0===n.indexOf("//")&&(n=location.protocol+n);t.div.querySelector("input").value=n;e.target.value=""}}));const r=function(){var e=t.div.querySelector("input").value.trim();if(e)if(/^((https?|ftp):)?(\/\/)?(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i.test(e))if(t._addedUrls.some(function(t){return t.replace(/https?:\/\/|\/\//,"")===e.replace(/https?:\/\/|\/\//,"")}))TC.alert(t.getLocaleString("serviceAlreadyAdded"));else{var n=t.map.getControlsByClass("TC.control.LoadingIndicator")[0];n.show();var r=TC.Util.getQueryStringParams(e);/https?:\/\/|\/\//i.test(e)||(e="//"+e);var l=["version","service","request"],o=function(e,t){for(var n=0;n<t.length;n++)e=TC.Util.removeURLParameter(e,t[n]);e.match(/\?$/)&&(e=e.substr(0,e.length-1));return e}(e,Object.keys(r));for(var a in r)l.indexOf(a.toLowerCase())>=0&&delete r[a];const d=t.div.querySelector("button");d.disabled=!0;for(var i={id:"xwms"+ ++t.count,type:"WMS",url:o,hideTree:!1,queryParams:r},u=0;u<t.options.suggestions.length;u++){var c=t.options.suggestions[u].items.filter(function(t,n){return t.url===e});if(c.length>0&&c[0].layerNames){i.layerNames=c[0].layerNames;break}}var s=new TC.layer.Raster(i);s.getCapabilitiesPromise().then(function(r){if(void 0!==r.Capability){var l=r.Capability.Layer;if(l.CRS&&-1==l.CRS.indexOf(t.map.crs)&&!t.allowReprojection){TC.alert(t.getLocaleString("serviceSrsNotCompatible"));n.hide();d.disabled=!1;return}t.map.trigger(TC.Consts.event.EXTERNALSERVICEADDED,{layer:s});t.div.querySelector("input").value="";const o=[];t.div.querySelectorAll("select option").forEach(function(t){t.value.replace(/https?:\/\/|\/\//,"")===e.replace(/https?:\/\/|\/\//,"")&&o.push(t)});t.markServicesAsSelected(o);t._addedUrls.push(e);n.hide();d.disabled=!1}else{TC.alert(t.getLocaleString("noLayersFoundInService"));n.hide();d.disabled=!1}},function(e){TC.alert(t.getLocaleString("serviceCouldNotBeLoaded")+":\n"+e);n.hide();d.disabled=!1})}else TC.alert(t.getLocaleString("typeAValidAddress"));else TC.alert(t.getLocaleString("typeAnAddress"))};t.renderPromise().then(()=>{t.div.querySelector("input").addEventListener("keyup",e=>{e.key&&"enter"===e.key.toLowerCase()&&t.div.querySelector("input").value.trim().length>0&&r()})});t.div.addEventListener("click",TC.EventTarget.listenerBySelector('button[name="agregar"]',r));e.on(TC.Consts.event.LAYERADD,function(e){const n=e.layer;if(n&&!n.isBase){var r=n.url;if(r){t.pending_markServicesAsSelected=t.pending_markServicesAsSelected||[];0===t.div.querySelectorAll("select option").length&&r&&-1===t.pending_markServicesAsSelected.indexOf(r)&&t.pending_markServicesAsSelected.push(r);const e=[];t.div.querySelectorAll("select option").forEach(function(t){t.value.replace(/https?:\/\/|\/\//,"")===r.replace(/https?:\/\/|\/\//,"")&&e.push(t)});t.markServicesAsSelected(e);t._addedUrls.push(r)}}});return n};e.template={};e.template[e.CLASS]={1:function(e,t,n,r,l){var o=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return"<h2>"+e.escapeExpression(o(n,"i18n").call(null!=t?t:e.nullContext||{},"addMaps",{name:"i18n",hash:{},data:l,loc:{start:{line:1,column:17},end:{line:1,column:35}}}))+"</h2>"},3:function(e,t,n,r,l){var o,a=null!=t?t:e.nullContext||{},i=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return(null!=(o=i(n,"if").call(a,null!=t?i(t,"group"):t,{name:"if",hash:{},fn:e.program(4,l,0),inverse:e.noop,data:l,loc:{start:{line:7,column:7},end:{line:9,column:14}}}))?o:"")+(null!=(o=i(n,"each").call(a,null!=t?i(t,"items"):t,{name:"each",hash:{},fn:e.program(6,l,0),inverse:e.noop,data:l,loc:{start:{line:10,column:16},end:{line:12,column:25}}}))?o:"")+(null!=(o=i(n,"if").call(a,null!=t?i(t,"group"):t,{name:"if",hash:{},fn:e.program(8,l,0),inverse:e.noop,data:l,loc:{start:{line:13,column:7},end:{line:15,column:14}}}))?o:"")},4:function(e,t,n,r,l){var o=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'                <optgroup label="'+e.escapeExpression(e.lambda(null!=t?o(t,"group"):t,t))+'">\r\n'},6:function(e,t,n,r,l){var o=e.lambda,a=e.escapeExpression,i=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'                    <option value="'+a(o(null!=t?i(t,"url"):t,t))+'">'+a(o(null!=t?i(t,"name"):t,t))+"</option>\r\n"},8:function(e,t,n,r,l){return"                </optgroup>\r\n"},compiler:[8,">= 4.3.0"],main:function(e,t,n,r,l){var o,a=null!=t?t:e.nullContext||{},i=e.escapeExpression,u=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return(null!=(o=u(n,"if").call(a,null!=t?u(t,"title"):t,{name:"if",hash:{},fn:e.program(1,l,0),inverse:e.noop,data:l,loc:{start:{line:1,column:0},end:{line:1,column:47}}}))?o:"")+'\r\n<div>\r\n    <div class="tc-group tc-ctl-xwms-cnt">        \r\n        <select class="tc-combo" title="WMS (Web Map Service)">\r\n            <option value="">WMS</option>\r\n'+(null!=(o=u(n,"each").call(a,null!=t?u(t,"suggestions"):t,{name:"each",hash:{},fn:e.program(3,l,0),inverse:e.noop,data:l,loc:{start:{line:6,column:12},end:{line:16,column:21}}}))?o:"")+'        </select>\r\n        <input type="url" class="tc-textbox" placeholder="'+i(u(n,"i18n").call(a,"writeAddressOrSelect",{name:"i18n",hash:{},data:l,loc:{start:{line:18,column:58},end:{line:18,column:89}}}))+'" />\r\n    </div>\r\n\r\n\r\n    <div class="tc-group tc-group tc-ctl-xwms-cnt" style="text-align:right;">\r\n        <button type="button" class="tc-button tc-icon-button" title="'+i(u(n,"i18n").call(a,"addService.title",{name:"i18n",hash:{},data:l,loc:{start:{line:23,column:70},end:{line:23,column:97}}}))+'" name="agregar">'+i(u(n,"i18n").call(a,"addService",{name:"i18n",hash:{},data:l,loc:{start:{line:23,column:114},end:{line:23,column:135}}}))+"</button>\r\n    </div>\r\n</div>\r\n"},useData:!0};e.render=function(e){const t=this;return t._set1stRenderPromise(t.renderData(t.options,function(){t.pending_markServicesAsSelected=t.pending_markServicesAsSelected||[];t.pending_markServicesAsSelected.forEach(function(e){const n=[];t.div.querySelectorAll("select option").forEach(function(t){TC.Util.addProtocol(t.value)===TC.Util.addProtocol(e)&&n.push(t)});t.markServicesAsSelected(n);t._addedUrls.push(e)});t.pending_markServicesAsSelected=[]}))}}();
//# sourceMappingURL=../maps/control/ExternalWMS.min.js.map