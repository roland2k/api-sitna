TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.Consts.event.POPUP="popup.tc";TC.Consts.event.POPUPHIDE="popuphide.tc";TC.Consts.classes.DRAG=TC.Consts.classes.DRAG||"tc-drag";TC.Consts.classes.DRAGGED=TC.Consts.classes.DRAGGED||"tc-dragged";TC.Consts.classes.DRAGGABLE=TC.Consts.classes.DRAGGABLE||"tc-draggable";TC.control.Popup=function(){TC.Control.apply(this,arguments);this.currentFeature=null;this.wrap=new TC.wrap.control.Popup(this)};TC.inherit(TC.control.Popup,TC.Control);!function(){var t=TC.control.Popup.prototype;t.CLASS="tc-ctl-popup";t.render=function(){};t.register=function(t){var s=this;TC.Control.prototype.register.call(s,t);$.when(t.wrap.addPopup(s)).then(function(){t.on(TC.Consts.event.LAYERVISIBILITY,function(t){s.currentFeature&&s.currentFeature.layer===t.layer&&!t.layer.getVisibility()&&s.isVisible()&&s.hide()});t.on(TC.Consts.event.LAYERREMOVE,function(t){s.currentFeature&&s.currentFeature.layer===t.layer&&s.isVisible()&&s.hide()});t.on(TC.Consts.event.UPDATE,function(){s.currentFeature&&s.currentFeature._visibilityState!==TC.Consts.visibility.NOT_VISIBLE||s.isVisible()&&s.hide()});t.on(TC.Consts.event.FEATUREREMOVE,function(t){s.currentFeature===t.feature&&s.isVisible()&&s.hide()})})};t.fitToView=function(t){var s=this;t?setTimeout(function(){s.wrap.fitToView()},1e3):s.wrap.fitToView()};t.hide=function(){if(this.map){this.map.wrap.hidePopup(this);this.setDragged(!1);this.map.$events.trigger($.Event(TC.Consts.event.POPUPHIDE,{control:this}))}};t.setDragged=function(t){this.dragged=t;this.$popupDiv&&this.$popupDiv.toggleClass(TC.Consts.classes.DRAGGED,t);this.wrap.setDragged(t)};t.setDragging=function(t){t&&this.setDragged(!0);this.$popupDiv.toggleClass(TC.Consts.classes.DRAG,t)};t.isVisible=function(){return this.$popupDiv&&this.$popupDiv.hasClass(TC.Consts.classes.VISIBLE)}}();