TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.Consts.event.POPUP=TC.Consts.event.POPUP||"popup.tc";TC.Consts.event.POPUPHIDE=TC.Consts.event.POPUPHIDE||"popuphide.tc";TC.Consts.classes.DRAG=TC.Consts.classes.DRAG||"tc-drag";TC.Consts.classes.DRAGGED=TC.Consts.classes.DRAGGED||"tc-dragged";TC.Consts.classes.DRAGGABLE=TC.Consts.classes.DRAGGABLE||"tc-draggable";TC.control.Popup=function(){TC.Control.apply(this,arguments);this.currentFeature=null;this.wrap=new TC.wrap.control.Popup(this)};TC.inherit(TC.control.Popup,TC.Control);!function(){var t=TC.control.Popup.prototype;t.CLASS="tc-ctl-popup";t.template={};t.template[t.CLASS]={1:function(t,n,e,o,s){return" tc-ctl-popup-has-btn"},3:function(t,n,e,o,s){var i=t.lookupProperty||function(t,n){if(Object.prototype.hasOwnProperty.call(t,n))return t[n]};return'        <button class="tc-ctl-popup-close tc-icon-btn" title="'+t.escapeExpression(i(e,"i18n").call(null!=n?n:t.nullContext||{},"close",{name:"i18n",hash:{},data:s,loc:{start:{line:5,column:62},end:{line:5,column:78}}}))+'"></button>\r\n'},5:function(t,n,e,o,s){var i=t.lookupProperty||function(t,n){if(Object.prototype.hasOwnProperty.call(t,n))return t[n]};return'        <button class="tc-ctl-popup-share tc-icon-btn" title="'+t.escapeExpression(i(e,"i18n").call(null!=n?n:t.nullContext||{},"shareQuery",{name:"i18n",hash:{},data:s,loc:{start:{line:8,column:62},end:{line:8,column:83}}}))+'"></button>\r\n'},compiler:[8,">= 4.3.0"],main:function(t,n,e,o,s){var i,r=null!=n?n:t.nullContext||{},l=t.lookupProperty||function(t,n){if(Object.prototype.hasOwnProperty.call(t,n))return t[n]};return'\ufeff<<div class="tc-ctl-popup">\r\n    <div class="tc-ctl-popup-content'+(null!=(i=l(e,"if").call(r,null!=n?l(n,"closeButton"):n,{name:"if",hash:{},fn:t.program(1,s,0),inverse:t.noop,data:s,loc:{start:{line:2,column:36},end:{line:2,column:83}}}))?i:"")+'"></div>\r\n    <div class="tc-ctl-popup-menu">\r\n'+(null!=(i=l(e,"if").call(r,null!=n?l(n,"closeButton"):n,{name:"if",hash:{},fn:t.program(3,s,0),inverse:t.noop,data:s,loc:{start:{line:4,column:8},end:{line:6,column:15}}}))?i:"")+(null!=(i=l(e,"if").call(r,null!=n?l(n,"shareButton"):n,{name:"if",hash:{},fn:t.program(5,s,0),inverse:t.noop,data:s,loc:{start:{line:7,column:8},end:{line:9,column:15}}}))?i:"")+"    </div>\r\n</div>"},useData:!0};t.render=function(n){const e=this;return e._set1stRenderPromise(new Promise(function(o,s){TC.Control.prototype.renderData.call(e,{closeButton:e.options.closeButton||void 0===e.options.closeButton,shareButton:e.options.share}).then(function(){e.popupDiv=e.div.querySelector(`.${t.CLASS}`);e.contentDiv=e.popupDiv.querySelector(`.${t.CLASS}-content`);e.menuDiv=e.popupDiv.querySelector(`.${t.CLASS}-menu`);e.addUIEventListeners();e.map.wrap.addPopup(e).then(function(){TC.Util.isFunction(n)&&n();o()})}).catch(t=>s(t instanceof Error?t:Error(t)))}))};t.register=function(t){const n=this,e=TC.Control.prototype.register.call(n,t);return new Promise(function(o,s){Promise.all([e,n.renderPromise()]).then(function(){t.on(TC.Consts.event.VIEWCHANGE,function(){t.view===TC.Consts.view.PRINTING&&n.isVisible()&&n.hide()});t.on(TC.Consts.event.LAYERVISIBILITY,function(t){n.currentFeature&&n.currentFeature.layer===t.layer&&!t.layer.getVisibility()&&n.isVisible()&&n.hide()});t.on(TC.Consts.event.LAYERREMOVE+" "+TC.Consts.event.FEATURESCLEAR,function(t){n.currentFeature&&n.currentFeature.layer===t.layer&&n.isVisible()&&n.hide()});t.on(TC.Consts.event.UPDATE,function(){n.currentFeature&&n.currentFeature._visibilityState!==TC.Consts.visibility.NOT_VISIBLE||n.isVisible()&&n.hide()});t.on(TC.Consts.event.FEATUREREMOVE,function(t){n.currentFeature===t.feature&&n.isVisible()&&n.hide()});o(n)}).catch(function(t){s(t instanceof Error?t:Error(t))})})};t.addUIEventListeners=function(){const t=this,n=t.menuDiv.querySelector(`.${t.CLASS}-close`);n&&n.addEventListener(TC.Consts.event.CLICK,function(){t.hide()},{passive:!0});const e=t.menuDiv.querySelector(`.${t.CLASS}-share`);e&&e.addEventListener(TC.Consts.event.CLICK,function(){t.caller&&t.caller.showShareDialog()},{passive:!0})};t.fitToView=function(t){var n=this;t?setTimeout(function(){n.wrap.fitToView()},1e3):n.wrap.fitToView()};t.hide=function(){if(this.map){const t={control:this,feature:this.currentFeature};this.map.wrap.hidePopup(this);this.getContainerElement().innerHTML="";this.setDragged(!1);this.map.trigger(TC.Consts.event.POPUPHIDE,t)}};t.getContainerElement=function(){return this.contentDiv||null};t.getMenuElement=function(){return this.menuDiv||null};t.setDragged=function(t){const n=this;n.dragged=t;n.popupDiv&&n.popupDiv.classList.toggle(TC.Consts.classes.DRAGGED,!!t);n.wrap.setDragged(t)};t.setDragging=function(t){const n=this;if(t){n.setDragged(!0);n.popupDiv.classList.add(TC.Consts.classes.DRAG)}else n.popupDiv.classList.remove(TC.Consts.classes.DRAG)};t.isVisible=function(){return this.popupDiv&&this.popupDiv.classList.contains(TC.Consts.classes.VISIBLE)}}();
//# sourceMappingURL=../maps/control/Popup.min.js.map