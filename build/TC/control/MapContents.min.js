TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.control.MapContents=function(){TC.Control.apply(this,arguments);this.layerTrees={}};TC.inherit(TC.control.MapContents,TC.Control);!function(){var e=TC.control.MapContents.prototype;e.CLASS="tc-ctl-mc";e.render=function(e,t){const n=this;return n._set1stRenderPromise(n.map?n.renderData(t?TC.Util.extend(n.map.getLayerTree(),t):n.map.getLayerTree(),function(){n.addUIEventListeners();"function"==typeof e&&e()}):Promise.reject(Error("Cannot render: control has no map")))};e.register=function(e){const t=this;return new Promise(function(n,r){Promise.all([TC.Control.prototype.register.call(t,e),t.renderPromise()]).then(function(){for(var r=0,o=e.layers.length;r<o;r++)t.updateLayerTree(e.layers[r]);e.on(TC.Consts.event.ZOOM+" "+TC.Consts.event.PROJECTIONCHANGE,function(){t.updateScale()}).on(TC.Consts.event.UPDATEPARAMS,function(e){const n=e.layer;var r=n.names;!function e(t){var n=!1;if(t)if(r.indexOf(t.name)>=0)n=!0;else for(var o=0;o<t.children.length;o++)if(e(t.children[o])){n=!0;break}return n}(t.layerTrees[n.id])&&0!==r.length?t.updateLayerTree(n):t.update()}).on(TC.Consts.event.LAYERVISIBILITY,function(e){t.updateLayerVisibility(e.layer)}).on(TC.Consts.event.LAYERADD,function(e){t.updateLayerTree(e.layer)}).on(TC.Consts.event.VECTORUPDATE+" "+TC.Consts.event.FEATUREADD+" "+TC.Consts.event.FEATURESADD,function(e){const n=e.layer;t._updateLayerTreeTimeouts=t._updateLayerTreeTimeouts||{};t._updateLayerTreeTimeouts[n.id]&&clearTimeout(t._updateLayerTreeTimeouts[n.id]);t._updateLayerTreeTimeouts[n.id]=setTimeout(function(){if(t.map.workLayers.indexOf(n)>-1){t.updateLayerTree(n);delete t._updateLayerTreeTimeouts[n.id]}},100)}).on(TC.Consts.event.LAYERREMOVE,function(e){t.removeLayer(e.layer)}).on(TC.Consts.event.LAYERORDER,function(e){t.updateLayerOrder(e.layer,e.oldIndex,e.newIndex)}).on(TC.Consts.event.LAYERERROR,function(e){t.onErrorLayer(e.layer)});n(t)}).catch(function(e){r(e instanceof Error?e:Error(e))})})};e.updateScale=function(){};e.updateLayerVisibility=function(e){};e.updateLayerTree=function(e){this.layerTrees[e.id]=e.getTree()};e.updateLayerOrder=function(e,t,n,r){const o=this;if(t>=0&&t!==n){var a,s;const t=o.getLayerUIElements();for(var i=(r=r||o.map.workLayers).length-1;i>=0;i--){const n=r[i];s=a;for(var c=0,l=t.length;c<l;c++){const e=t[c];if(e.dataset.layerId===n.id){a=e;break}}if(n===e){a&&(s?s.insertAdjacentElement("afterend",a):a.parentElement.firstChild.insertAdjacentElement("beforebegin",a));break}}}};e.removeLayer=function(e){const t=this,n=t.getLayerUIElements();for(var r=0,o=n.length;r<o;r++){const t=n[r];if(t.dataset.layerId===e.id){t.parentElement.removeChild(t);break}}0===t.getLayerUIElements().length&&t.div.querySelector("."+t.CLASS+"-empty").classList.remove(TC.Consts.classes.HIDDEN)};e.onErrorLayer=function(e){};e.getLayerUIElements=function(){return this.div.querySelector("ul").children};e.styleLegendImage=function(e,t){if(!e.getAttribute("src")){var n=e.dataset.img;const c=new TC.tool.Proxification(TC.proxify);if(t&&t.options.method&&"POST"===t.options.method)t.getLegendGraphicImage().then(function(t){e.src=t}).catch(function(e){TC.error(e)});else{if(/[&?]REQUEST=getLegendGraphic/i.test(n)){const l=e.parentElement;var r=l.style.color,o=r.indexOf("("),a=r.indexOf(")");if(o>=0&&a>o){color=r.substr(0,a).substr(o+1).split(",");r="0x";for(var s=0;s<3;s++){var i=parseInt(color[s]).toString(16);r+=1===i.length?"0"+i:i}}else r.replace("#","0x");n+="&LEGEND_OPTIONS=fontName:"+l.style.fontFamily+";fontSize:"+parseInt(l.style.fontSize)+";fontColor:"+r+";fontAntiAliasing:true";t.params&&t.params.sld_body&&(n=TC.Util.addURLParameters(n,{sld_body:t.params.sld_body}));c.fetchImage(n).then(function(e){e.dataset.img=e.src}).catch(function(e){TC.error(e)})}c.fetchImage(n).then(function(t){e.src=t.src}).catch(function(e){!e.status||404!==e.status&&401!==e.status?TC.error(e):TC.error(TC.Util.getLocaleString(t.map.options.locale,"simbologyImgNotFound",{url:n}))})}}}}();
//# sourceMappingURL=../maps/control/MapContents.min.js.map