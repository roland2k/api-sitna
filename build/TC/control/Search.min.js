!function(){if(window.performance){if(window.performance&&!window.performance.now){window.performance.offset=Date.now();window.performance.now=function(){return Date.now()-window.performance.offset}}}else window.performance={offset:Date.now(),now:function(){return Date.now()-this.offset}}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");var SearchType=function(e,t,r){var a=this;a.parent=r;a._featureTypes=[];$.extend(a,t);a.typeName=e;a._throwConfigError=function(){throw new Error("Error en la configuraci\xf3n de la b\xfasqueda: "+this.typeName)};a.getFeatureTypes=function(e){if(e)return this.featureType instanceof Array?this.featureType:[this.featureType];if(0===this._featureTypes.length){var t=this.featureType instanceof Array?this.featureType:[this.featureType],r=this.renderFeatureType?this.renderFeatureType instanceof Array?this.renderFeatureType:[this.renderFeatureType]:[];this._featureTypes=t.concat(r)}return this._featureTypes};a.isFeatureOfThisType=function(e){return this.getFeatureTypes().indexOf(e)>-1};a.getStyleByFeatureType=function(e){return this.getFeatureTypes().indexOf(e)>-1?this.styles[this.getFeatureTypes().indexOf(e)]:null};var o=function(e,t,r){var a=function(e,t,r){if(t){if(e.hasOwnProperty(t)&&e[t].hasOwnProperty(r))return e[t][r]}else for(var t in e)if(e[t].hasOwnProperty(r))return e[t][r]};if(r){return a(this.getStyleByFeatureType(r),t,e)}for(var o=0;o<this.styles.length;o++){var i=a(this.styles[o],t,e);if(i)return i}};a.getSuggestionListHead=function(){var e,t,r,a=this;if("function"==typeof a.suggestionListHead){e=a.suggestionListHead();t=e.label;r=[{color:e.color,title:e.label}]}else{e=a.suggestionListHead;t=a.parent.getLocaleString(e.label);if("string"==typeof e.color)r=[{color:o.call(a,e.color),title:t}];else if(e.color instanceof Array){var i=a.getFeatureTypes();e.color.length===i.length?r=e.color.map(function(e,r){return{color:o.call(a,e[i[r]].color.css,e[i[r]].color.geomType,i[r]),title:a.parent.getLocaleString(e[i[r]].title)||t}}):a._throwConfigError()}else"object"==typeof e.color&&(r=[{color:o.call(a,e.color.css,e.color.geomType),title:t}])}if(t&&r){var s='<li header><span class="header">'+t+"</span>";return s+=r.map(function(e){if(e.color)return'<span class="header-color" title="'+e.title+'" style="color: '+e.color+';"></span>'}).join("")+"</li>"}a._throwConfigError()};a.getSuggestionListElements=function(e){var t=this,r=[],a=function(e,t){switch(!0){case"number"==typeof e:if(e===t)return!0;break;case"string"==typeof e:if(isNaN(e)&&isNaN(t)){if(e.trim()===t.trim())return!0}else if(e===t)return!0}return!1},o=function(e){for(var t=[],r=0;r<e.length;r++)-1==jQuery.inArray(e[r],t)&&t.push(e[r]);return t};t.parseFeatures(e).forEach(function(e){var i=[],s=[],n="",l=t.outputProperties,p=t.dataIdProperty,c=t.outputFormatLabel,u=e.id.split(".").slice(0,1).shift();if(!(t.outputProperties instanceof Array)){l=t.outputProperties[u];p=t.dataIdProperty[u];c=c[u]}for(var f=0;f<l.length;f++)i.push(e.data[l[f]]);for(f=0;f<p.length;f++)s.push(e.data[p[f]]);for(var h={},T=0;T<t.outputProperties.length;T++)h[t.outputProperties[T]]=i[T];i instanceof Array&&c&&o(i).length>1?n=c.tcFormat(i):i instanceof Array&&1==o(i).length&&(n=i[0]);var g=n.toCamelCase();(function(e){for(var t=0;t<r.length;t++){var o=0,i=[];for(var s in e){i.push(a(e[s],r[t].properties[s]));o++}if(i.filter(function(e){return e}).length===o)return!0}return!1})(h)||r.push({text:g,label:g,id:s.join("#"),dataRole:t.typeName,dataLayer:u,properties:h})});return r};a.parseFeatures=function(e){return(a.outputFormat===TC.Consts.format.JSON?new TC.wrap.parser.JSON:new TC.wrap.parser.WFS({featureNS:a.featurePrefix,featureType:a.featureType})).read(e)};a.getPattern=function(){return"function"==typeof this.pattern?this.pattern():this.pattern};a.filter=function(e){const t=function(t,r){var a=[];if(r!=e.parent.rootCfg.active.root)if(-1!==r.indexOf("#")||e.parent.rootCfg.active.limit)for(var o=r.split("#"),i=0;i<e.parent.rootCfg.active.dataIdProperty.length;i++){0==i&&e.parent.rootCfg.active.dataIdProperty.length>1&&a.push("<ogc:And>");a.push(e.filter.getFilterNode(e.parent.rootCfg.active.dataIdProperty[i],o.length>i?o[i]:o[0]));i==e.parent.rootCfg.active.dataIdProperty.length-1&&e.parent.rootCfg.active.dataIdProperty.length>1&&a.push("</ogc:And>")}else{var s=e.parent.rootCfg.active.queryProperties.firstQueryWord.map(function(t,a){return e.filter.getFilterNode(t,e.parent._LIKE_PATTERN+r+e.parent._LIKE_PATTERN)});if(s.length>1){a.push("<ogc:And>");(a=a.concat(s)).push("</ogc:And>")}else a=a.concat(s)}else{for(var n=0;n<e.parent.rootCfg.active.root.length;n++){o=e.parent.rootCfg.active.root[n];0==n&&e.parent.rootCfg.active.root.length>1&&a.push("<ogc:Or>");for(i=0;i<e.parent.rootCfg.active.dataIdProperty.length;i++){0==i&&e.parent.rootCfg.active.dataIdProperty.length>1&&a.push("<ogc:And>");a.push(e.filter.getFilterNode(e.parent.rootCfg.active.dataIdProperty[i],o.length>i?o[i]:o[0]));i==e.parent.rootCfg.active.dataIdProperty.length-1&&e.parent.rootCfg.active.dataIdProperty.length>1&&a.push("</ogc:And>")}}e.parent.rootCfg.active.root.length>1&&a.push("</ogc:Or>")}return t.concat(a)};return{getPropertyValue:function(t,r){return e.getSearchTypeByRole(t)[r]},getIsLikeNode:function(t,r){var a=/([\-\"\.\xba\(\)\/])/g;a.test(r)&&(r=r.replace(a,"\\$1"));return r.toString().indexOf(e.parent._LIKE_PATTERN)>-1?'<Or><PropertyIsLike escape="\\" singleChar="_" wildCard="*" matchCase="false"><PropertyName>'+t+"</PropertyName><Literal>"+r.toLowerCase().replace(/\</gi,"&lt;").replace(/\>/gi,"&gt;")+'</Literal></PropertyIsLike><PropertyIsLike escape="\\" singleChar="_" wildCard="*" matchCase="false"><PropertyName>'+t+"</PropertyName><Literal>"+r.toUpperCase().replace(/\</gi,"&lt;").replace(/\>/gi,"&gt;")+"</Literal></PropertyIsLike></Or>":"<PropertyIsEqualTo><PropertyName>"+t+"</PropertyName><Literal>"+r.replace(/\</gi,"&lt;").replace(/\>/gi,"&gt;")+"</Literal></PropertyIsEqualTo>"},getFunctionStrMatches:function(t,r){var a=/([\-\"\xba\(\)\/])/g;a.test(r)&&(r=r.replace(a,"\\$1"));if(r.toString().indexOf(e.parent._LIKE_PATTERN)>-1){var o=r;return'<ogc:PropertyIsEqualTo> <ogc:Function name="strMatches"> <ogc:PropertyName>'+t+"</ogc:PropertyName> <ogc:Literal>(?i)"+(o=(o=(o=(o=(o=o.replace(/a/gi,"[a\xe1\xe0]")).replace(/e/gi,"[e\xe9\xe8]")).replace(/i/gi,"[i\xed\xec]")).replace(/o/gi,"[o\xf3\xf2]")).replace(/u/gi,"[u\xfa\xfc\xf9]")).replace(/\</gi,"&lt;").replace(/\>/gi,"&gt;")+"</ogc:Literal> </ogc:Function> <ogc:Literal>true</ogc:Literal> </ogc:PropertyIsEqualTo>"}return"<PropertyIsEqualTo><PropertyName>"+t+"</PropertyName><Literal>"+r.replace(/\</gi,"&lt;").replace(/\>/gi,"&gt;")+"</Literal></PropertyIsEqualTo>"},getFilterNode:function(t,r){var a,o=e.filter.getIsLikeNode;if(e.filterByMatch){o=e.filter.getFunctionStrMatches;var i=new RegExp("\\"+e.parent._LIKE_PATTERN,"gi");r=r.replace(i,e.parent._MATCH_PATTERN)}if(t instanceof Array||"string"==typeof t){if(t instanceof Array&&t.length>1){a="<ogc:Or>";for(l=0;l<t.length;l++)a+=o($.trim(t[l]),r);return a+"</ogc:Or>"}return o(t instanceof Array&&1===t.length?$.trim(t[0]):$.trim(t),r)}var s=[];for(var n in t)if(t[n]instanceof Array&&t[n].length>1){a="<Or>";for(var l=0;l<t[n].length;l++)a+=o($.trim(t[n][l]),r);a+="</Or>";s.push('(<Filter xmlns="http://www.opengis.net/ogc">'+a+"</Filter>)")}else{var p=t[n];t[n]instanceof Array&&1==t[n].length&&(p=t[n][0]);s.push('(<Filter xmlns="http://www.opengis.net/ogc"><Or>'+o($.trim(p),r)+"</Or></Filter>)")}return s.join("")},getFilter:function(r){var a={multiL:!1,f:""};switch(!0){case e.typeName===TC.Consts.searchType.NUMBER:i=[];if(e.parent.rootCfg.active||!/(\<|\>|\<\>)/gi.exec(r.t)&&!/(\<|\>|\<\>)/gi.exec(r.s)){e.parent.rootCfg.active?i=t(i,r.t):i.push(e.filter.getFilterNode(e.queryProperties.firstQueryWord,e.parent._LIKE_PATTERN+r.t+e.parent._LIKE_PATTERN));i.push(e.filter.getFilterNode(e.queryProperties.secondQueryWord,e.parent._LIKE_PATTERN+r.s+e.parent._LIKE_PATTERN))}else{(o=/(\<|\>|\<\>)/gi.exec(r.t))?i.push(e.filter.getFilterNode(e.queryProperties.firstQueryWord,e.parent._LIKE_PATTERN+r.t.substring(0,r.t.indexOf(o[0])).trim()+e.parent._LIKE_PATTERN)):e.parent.rootCfg.active?i=t(i,r.t):i.push(e.filter.getFilterNode(e.queryProperties.firstQueryWord,e.parent._LIKE_PATTERN+r.t+e.parent._LIKE_PATTERN));(o=/(\<|\>|\<\>)/gi.exec(r.s))?i.push(e.filter.getFilterNode(e.queryProperties.secondQueryWord,e.parent._LIKE_PATTERN+r.s.substring(0,r.s.indexOf(o[0])).trim()+e.parent._LIKE_PATTERN)):i.push(e.filter.getFilterNode(e.queryProperties.secondQueryWord,e.parent._LIKE_PATTERN+r.s+e.parent._LIKE_PATTERN))}i.push(e.filter.getFilterNode(e.queryProperties.thirdQueryWord,r.p+e.parent._LIKE_PATTERN));a.f='<ogc:Filter xmlns:ogc="http://www.opengis.net/ogc"><ogc:And>'+i.join("")+"</ogc:And></ogc:Filter>";break;case e.typeName===TC.Consts.searchType.STREET:i=[];if(e.parent.rootCfg.active||!/(\<|\>|\<\>)/gi.exec(r.t)&&!/(\<|\>|\<\>)/gi.exec(r.s)){e.parent.rootCfg.active?i=t(i,r.t):i.push(e.filter.getFilterNode(e.queryProperties.firstQueryWord,e.parent._LIKE_PATTERN+r.t+e.parent._LIKE_PATTERN));i.push(e.filter.getFilterNode(e.queryProperties.secondQueryWord,e.parent._LIKE_PATTERN+r.s+e.parent._LIKE_PATTERN))}else{var o;(o=/(\<|\>|\<\>)/gi.exec(r.t))?i.push(e.filter.getFilterNode(e.queryProperties.firstQueryWord,e.parent._LIKE_PATTERN+r.t.substring(0,r.t.indexOf(o[0])).trim()+e.parent._LIKE_PATTERN)):e.parent.rootCfg.active?i=t(i,r.t):i.push(e.filter.getFilterNode(e.queryProperties.firstQueryWord,e.parent._LIKE_PATTERN+r.t+e.parent._LIKE_PATTERN));(o=/(\<|\>|\<\>)/gi.exec(r.s))?i.push(e.filter.getFilterNode(e.queryProperties.secondQueryWord,e.parent._LIKE_PATTERN+r.s.substring(0,r.s.indexOf(o[0])).trim()+e.parent._LIKE_PATTERN)):i.push(e.filter.getFilterNode(e.queryProperties.secondQueryWord,e.parent._LIKE_PATTERN+r.s+e.parent._LIKE_PATTERN))}a.f='<ogc:Filter xmlns:ogc="http://www.opengis.net/ogc"><ogc:And>'+i.join("")+"</ogc:And></ogc:Filter>";break;case e.typeName===TC.Consts.searchType.LOCALITY:a.f=e.filter.getFilterNode(e.queryProperties.firstQueryWord,e.parent._LIKE_PATTERN+r.t+e.parent._LIKE_PATTERN);a.multiL=!0;break;case e.queryProperties.hasOwnProperty("secondQueryWord"):var i;(i=[]).push(e.filter.getFilterNode(e.queryProperties.firstQueryWord,e.parent._LIKE_PATTERN+r.t+e.parent._LIKE_PATTERN));i.push(e.filter.getFilterNode(e.queryProperties.secondQueryWord,e.parent._LIKE_PATTERN+r.s+e.parent._LIKE_PATTERN));a.f='<ogc:Filter xmlns:ogc="http://www.opengis.net/ogc"><ogc:And>'+i.join("")+"</ogc:And></ogc:Filter>";break;default:a.f='<ogc:Filter xmlns:ogc="http://www.opengis.net/ogc">'+e.filter.getFilterNode(e.queryProperties.firstQueryWord,e.parent._LIKE_PATTERN+r.t+e.parent._LIKE_PATTERN)+"</ogc:Filter>"}return a},getParams:function(t){var r=e.filter.getFilter(t),a={REQUEST:"GetFeature",SERVICE:"WFS",MAXFEATURES:500,VERSION:e.version,OUTPUTFORMAT:e.outputFormat},o=e.getFeatureTypes(!0);if(o instanceof Array){for(var i=[],s=0;s<o.length;s++)i.push(e.featurePrefix?e.featurePrefix+":"+$.trim(o[s]):$.trim(o[s]));a.TYPENAME=i.join(",")}else a.TYPENAME=e.featurePrefix?e.featurePrefix+":"+$.trim(o):$.trim(o);var n=function(e){if(""!==(e||"")){if(e instanceof Array)return e.join(",");var t=[];if(e instanceof Object)for(var r in e){var a=e[r][0];e[r].length>1&&(a=e[r].join(","));t.push(a)}return t}},l=n(e.outputProperties),p=n(e.dataIdProperty);if(l instanceof Array&&p instanceof Array){a.PROPERTYNAME="";for(s=0;s<l.length;s++)a.PROPERTYNAME+="("+l[s]+","+p[s]+")"}else a.PROPERTYNAME=l+","+p;a.FILTER=r.f;return $.param(a)},getGoToFilter:function(t){var r=[],a=t.split("#"),o=e.dataIdProperty,i=e.getFeatureTypes();if(o&&i)if(t.indexOf("#")>-1&&i instanceof Array&&i.length>1)for(var s=0;s<i.length;s++)for(var n=0;n<o[i[s]].length;n++)r.push({name:o[i[s]][n],value:a[n]});else if(-1==t.indexOf("#")&&i instanceof Array){var l=o;for(s=0;s<i.length;s++)if(!r.hasOwnProperty(i[s])){l instanceof Object&&o.hasOwnProperty(i[s])&&(l=o[i[s]]);for(n=0;n<l.length;n++)n<a.length&&r.push({name:l[n],value:a[n]})}}else{o instanceof Object&&o.hasOwnProperty(i)&&(o=o[i]);for(s=0;s<o.length;s++)r.push({name:o[s],value:a[s]})}return e.filter.transformFilter(r)},transformFilter:function(e){TC.filter||TC.syncLoadJS(TC.apiLocation+"TC/Filter");if(e&&e instanceof Array){var t=e.map(function(e){if(!e.hasOwnProperty("type"))return new TC.filter.equalTo(e.name,e.value);switch(!0){case e.type==TC.Consts.comparison.EQUAL_TO:return new TC.filter.equalTo(e.name,e.value)}});return t.length>1?TC.filter.and.apply(null,t):t[0]}}}}(a)};TC.control.Search=function(){var e=this;TC.Control.apply(e,arguments);e.exportsState=!0;TC.Consts.event.TOOLSCLOSE=TC.Consts.event.TOOLSCLOSE||"toolsclose.tc";e.url="//idena.navarra.es/ogc/wfs";e.version="1.1.0";e.featurePrefix="IDENA";e.layerPromise=$.Deferred();e.options&&e.options.url&&(e.url=e.options.url);e._LIKE_PATTERN="*";e._MATCH_PATTERN=".*";e.UTMX="X";e.UTMY="Y";e.LON="Lon";e.LAT="Lat";e.UTMX_LABEL="X: ";e.UTMY_LABEL="Y: ";e.LON_LABEL="Lon: ";e.LAT_LABEL="Lat: ";e.MUN="Mun";e.POL="Pol";e.PAR="Par";e.MUN_LABEL="Mun: ";e.POL_LABEL="Pol: ";e.PAR_LABEL="Par: ";e.availableSearchTypes={};e.availableSearchTypes[TC.Consts.searchType.CADASTRAL]={suggestionRoot:null,url:e.url||"//idena.navarra.es/ogc/wfs",version:e.version||"1.1.0",outputFormat:TC.Consts.format.JSON,featurePrefix:e.featurePrefix||"IDENA",geometryName:"the_geom",searchWeight:3,featureType:["CATAST_Pol_ParcelaUrba","CATAST_Pol_ParcelaRusti","CATAST_Pol_ParcelaMixta"],municipality:{featureType:"CATAST_Pol_Municipio",labelProperty:"MUNICIPIO",idProperty:"CMUNICIPIO"},queryProperties:{firstQueryWord:"CMUNICIPIO",secondQueryWord:"POLIGONO",thirdQueryWord:"PARCELA"},suggestionListHead:{label:"search.list.cadastral",color:[{CATAST_Pol_ParcelaUrba:{title:"search.list.cadastral.urban",color:{geomType:"polygon",css:"strokeColor"}}},{CATAST_Pol_ParcelaRusti:{title:"search.list.cadastral.rustic",color:{geomType:"polygon",css:"strokeColor"}}},{CATAST_Pol_ParcelaMixta:{title:"search.list.cadastral.mixed",color:{geomType:"polygon",css:"strokeColor"}}}]},styles:[{polygon:{fillColor:"#000000",fillOpacity:.1,strokeColor:"#136278",strokeWidth:2,strokeOpacity:1}},{polygon:{fillColor:"#000000",fillOpacity:.1,strokeColor:"#0c8b3d",strokeWidth:2,strokeOpacity:1}},{polygon:{fillColor:"#000000",fillOpacity:.1,strokeColor:"#e5475f",strokeWidth:2,strokeOpacity:1}}],parser:e.getCadastralRef,goTo:e.goToCadastralRef,goToIdFormat:e.MUN+"{0}"+e.POL+"{1}"+e.PAR+"{2}",idPropertiesIdentifier:"#"};e.availableSearchTypes[TC.Consts.searchType.COORDINATES]={parser:e.getCoordinates,goTo:e.goToCoordinates,searchWeight:4,label:null,suggestionListHead:function(t){return{label:e.availableSearchTypes[TC.Consts.searchType.COORDINATES].label||e.getLocaleString("search.list.coordinates")}}};e.queryProperties={QUERYWORD:"QueryWord",FIRST:"first",SECOND:"second",THIRD:"third"};e.availableSearchTypes[TC.Consts.searchType.MUNICIPALITY]={root:null,limit:!1,url:e.url||"//idena.navarra.es/ogc/wfs",version:e.version||"1.1.0",outputFormat:TC.Consts.format.JSON,url:"//idena.navarra.es/ogc/wfs",featurePrefix:"IDENA",geometryName:"the_geom",featureType:"CATAST_Pol_Municipio",dataIdProperty:["CMUNICIPIO"],queryProperties:{firstQueryWord:["MUNINOAC","MUNICIPIO"]},suggestionListHead:{label:"search.list.municipality",color:"strokeColor"},outputProperties:["MUNICIPIO"],outputFormatLabel:"{0}",searchWeight:1,styles:[{polygon:{fillColor:"#000000",fillOpacity:.1,strokeColor:"#fe06a5",strokeWidth:2,strokeOpacity:1}}],parser:e.getStringPattern.bind(this,[TC.Consts.searchType.MUNICIPALITY]),stringPatternToCheck:e.stringPatternsValidators.s_or_t,goTo:e.goToStringPattern};e.availableSearchTypes[TC.Consts.searchType.COUNCIL]={root:null,limit:!1,url:e.url||"//idena.navarra.es/ogc/wfs",version:e.version||"1.1.0",outputFormat:TC.Consts.format.JSON,featurePrefix:e.featurePrefix||"IDENA",geometryName:"the_geom",featureType:"CATAST_Pol_Concejo",renderFeatureType:"",dataIdProperty:["CMUNICIPIO","CCONCEJO"],queryProperties:{firstQueryWord:["CONCEJO"]},outputProperties:["MUNICIPIO","CONCEJO"],outputFormatLabel:"{1} ({0})",searchWeight:4,parser:e.getStringPattern.bind(this,[TC.Consts.searchType.COUNCIL]),stringPatternToCheck:e.stringPatternsValidators.s_or_t,goTo:e.goToStringPattern,idPropertiesIdentifier:"#",suggestionListHead:{label:"search.list.council",color:"strokeColor"},styles:[{polygon:{fillColor:"#000000",fillOpacity:.1,strokeColor:"#49006a",strokeWidth:2,strokeOpacity:1}}]};e.availableSearchTypes[TC.Consts.searchType.STREET]={root:null,limit:null,url:e.url||"//idena.navarra.es/ogc/wfs",version:e.version||"1.1.0",outputFormat:TC.Consts.format.JSON,featurePrefix:e.featurePrefix||"IDENA",geometryName:"the_geom",renderFeatureType:"CATAST_Txt_Calle",featureType:"CATAST_Lin_CalleEje",dataIdProperty:["CVIA"],searchWeight:5,queryProperties:{firstQueryWord:["ENTINOAC","ENTIDADC"],secondQueryWord:["VIA","VIANOAC"]},suggestionListHead:{label:"search.list.street",color:"strokeColor"},outputProperties:["ENTIDADC","VIA","CVIA","CENTIDADC","CMUNICIPIO"],outputFormatLabel:"{1}, {0}",styles:[{line:{strokeColor:"#CB0000",strokeOpacity:1,strokeWidth:2,strokeLinecap:"round",strokeDashstyle:"solid"}},{point:{label:"VIA",angle:"CADANGLE",fontColor:"#000000",fontSize:10,fontWeight:"bold",labelOutlineColor:"#FFFFFF",labelOutlineWidth:4}}],parser:e.getStringPattern.bind(this,[TC.Consts.searchType.STREET]),goTo:e.goToStringPattern};e.availableSearchTypes[TC.Consts.searchType.NUMBER]={root:null,limit:null,url:e.url||"//idena.navarra.es/ogc/wfs",version:e.version||"1.1.0",outputFormat:TC.Consts.format.JSON,featurePrefix:e.featurePrefix||"IDENA",geometryName:"the_geom",featureType:"CATAST_Txt_Portal",renderFeatureType:"",searchWeight:6,dataIdProperty:["CMUNICIPIO","CENTIDADC","CVIA","PORTAL"],queryProperties:{firstQueryWord:["ENTIDADC","ENTINOAC"],secondQueryWord:["VIA","VIANOAC"],thirdQueryWord:["PORTAL"]},suggestionListHead:{label:"search.list.number",color:"fontColor"},outputProperties:["ENTIDADC","VIA","PORTAL","CVIA","CENTIDADC","CMUNICIPIO"],outputFormatLabel:"{1} {2}, {0}",styles:[{point:{radius:0,label:"PORTAL",angle:"CADANGLE",fontColor:"#CB0000",fontSize:14,labelOutlineColor:"#FFFFFF",labelOutlineWidth:4}}],parser:e.getStringPattern.bind(this,[TC.Consts.searchType.NUMBER]),goTo:e.goToStringPattern};e.availableSearchTypes[TC.Consts.searchType.URBAN]={root:null,limit:!1,url:e.url||"//idena.navarra.es/ogc/wfs",version:e.version||"1.1.0",outputFormat:TC.Consts.format.JSON,featurePrefix:e.featurePrefix||"IDENA",geometryName:"the_geom",featureType:"ESTADI_Pol_EntidadPob",renderFeatureType:"",dataIdProperty:["CMUNICIPIO","CENTIDAD"],idPropertiesIdentifier:"#",queryProperties:{firstQueryWord:["ENTINOAC","ENTIDAD"]},suggestionListHead:{label:"search.list.urban",color:"strokeColor"},outputProperties:["MUNICIPIO","ENTIDAD"],outputFormatLabel:"{1} ({0})",searchWeight:2,styles:[{polygon:{fillColor:"#000000",fillOpacity:.1,strokeColor:"#feba1e",strokeWidth:2,strokeOpacity:1}}],parser:e.getStringPattern.bind(this,[TC.Consts.searchType.URBAN]),stringPatternToCheck:e.stringPatternsValidators.s_or_t,goTo:e.goToStringPattern};e.availableSearchTypes[TC.Consts.searchType.PLACENAME]={root:null,limit:!1,url:e.url||"//idena.navarra.es/ogc/wfs",version:e.version||"1.1.0",outputFormat:TC.Consts.format.JSON,featurePrefix:e.featurePrefix||"IDENA",geometryName:"the_geom",featureType:"TOPONI_Txt_Toponimos",renderFeatureType:"",dataIdProperty:["CTOPONIMO"],idPropertiesIdentifier:"#",queryProperties:{firstQueryWord:["TOPONIMO","TOPONINOAC"]},suggestionListHead:{label:"search.list.placeName",color:"fontColor"},outputProperties:["MUNICIPIO","TOPONIMO","CMUNICIPIO","CTOPONIMO"],outputFormatLabel:"{1} ({0})",searchWeight:7,styles:[{point:{radius:0,label:"CADTEXT",angle:"CADANGLE",fontColor:"#ff5722",fontSize:14,labelOutlineColor:"#FFFFFF",labelOutlineWidth:4}}],parser:e.getStringPattern.bind(this,[TC.Consts.searchType.PLACENAME]),stringPatternToCheck:e.stringPatternsValidators.s_or_t,goTo:e.goToStringPattern};e.availableSearchTypes[TC.Consts.searchType.PLACENAMEMUNICIPALITY]={root:null,limit:!1,url:e.url||"//idena.navarra.es/ogc/wfs",version:e.version||"1.1.0",outputFormat:TC.Consts.format.JSON,featurePrefix:e.featurePrefix||"IDENA",geometryName:"the_geom",featureType:"TOPONI_Txt_Toponimos",renderFeatureType:"",dataIdProperty:["CMUNICIPIO","CTOPONIMO"],idPropertiesIdentifier:"#",queryProperties:{firstQueryWord:["MUNICIPIO","MUNINOAC"],secondQueryWord:["TOPONIMO","TOPONINOAC"]},suggestionListHead:{label:"search.list.placeName",color:"fontColor"},outputProperties:["MUNICIPIO","TOPONIMO","CMUNICIPIO","CTOPONIMO"],outputFormatLabel:"{1} ({0})",searchWeight:8,styles:[{point:{radius:0,label:"CADTEXT",angle:"CADANGLE",fontColor:"#ff5722",fontSize:14,labelOutlineColor:"#FFFFFF",labelOutlineWidth:4}}],parser:e.getStringPattern.bind(this,[TC.Consts.searchType.PLACENAMEMUNICIPALITY]),goTo:e.goToStringPattern};e.availableSearchTypes[TC.Consts.searchType.COMMONWEALTH]={root:null,limit:!1,url:e.url||"//idena.navarra.es/ogc/wfs",version:e.version||"1.1.0",outputFormat:TC.Consts.format.JSON,featurePrefix:e.featurePrefix||"IDENA",geometryName:"the_geom",featureType:["POLUCI_Pol_MancoRSUg"],renderFeatureType:"",dataIdProperty:["CMANCOMUNI"],queryProperties:{firstQueryWord:["MANCOMUNID"]},outputProperties:["MANCOMUNID"],outputFormatLabel:"{0}",searchWeight:9,styles:[{polygon:{fillColor:"#000000",fillOpacity:.1,strokeColor:"#fc4e2a",strokeWidth:2,strokeOpacity:1}}]};e.availableSearchTypes[TC.Consts.searchType.ROAD]={root:null,limit:!1,url:e.url||"//idena.navarra.es/ogc/wfs",version:e.version||"1.1.0",outputFormat:TC.Consts.format.JSON,featurePrefix:e.featurePrefix||"IDENA",geometryName:"the_geom",featureType:"INFRAE_Lin_CtraEje",dataIdProperty:["DCARRETERA"],queryProperties:{firstQueryWord:["DCARRETERA"]},suggestionListHead:{label:"search.list.road",color:"strokeColor"},outputProperties:["DCARRETERA"],outputFormatLabel:e.getLocaleString("search.list.road.shorter")+": {0}",searchWeight:10,styles:[{polygon:{strokeColor:"#00b2fc",strokeOpacity:1,strokeWidth:5},line:{strokeColor:"#00b2fc",strokeOpacity:1,strokeWidth:5,strokeLinecap:"round",strokeDashstyle:"solid"}}],parser:e.getRoad,goTo:e.goToRoad,pattern:function(){return new RegExp("^(?:(?:"+e.getLocaleString("search.list.road")+"|"+e.getLocaleString("search.list.road.shorter")+")\\:?)?\\s*((A?|AP?|N?|R?|E?|[A-Z]{2}?|[A-Z]{1}?)\\s*\\-?\\s*(\\d{1,4})\\s*\\-?\\s*(A?|B?|C?|R?))$","i")}};e.availableSearchTypes[TC.Consts.searchType.ROADPK]={root:null,limit:!1,url:e.url||"//idena.navarra.es/ogc/wfs",version:e.version||"1.1.0",outputFormat:TC.Consts.format.JSON,featurePrefix:e.featurePrefix||"IDENA",geometryName:"the_geom",featureType:"INFRAE_Sym_CtraPK",dataIdProperty:["DCARRETERA","CPK"],queryProperties:{firstQueryWord:["DCARRETERA"],secondQueryWord:["PK"]},suggestionListHead:{label:"search.list.pk.larger",color:"fontColor"},outputProperties:["DCARRETERA","PK"],outputFormatLabel:e.getLocaleString("search.list.road.shorter")+": {0} "+e.getLocaleString("search.list.pk")+": {1}",searchWeight:11,styles:[{point:{label:["DCARRETERA","PK"],fontColor:"#00b2fc",fontSize:14,labelOutlineColor:"#ffffff",labelOutlineWidth:2}}],parser:e.getPK,goTo:e.goToPK,pattern:function(){return new RegExp("^(?:(?:"+e.getLocaleString("search.list.road")+"|"+e.getLocaleString("search.list.road.shorter")+")\\:?)?\\s*((A?|AP?|N?|R?|E?|[A-Z]{2}?|[A-Z]{1}?)\\s*\\-?\\s*(\\d{1,4})\\s*\\-?\\s*(A?|B?|C?|R?))\\s*\\,*\\s*(?:(?:"+e.getLocaleString("search.list.pk")+"\\:?)|(?:P\\:?)|(?:K\\:?)|(?:KM\\:?)|(?:\\s+|\\,+))\\s*(\\d{1,4})$","i")}};e.rootCfg={};e.rootCfg[TC.Consts.searchType.MUNICIPALITY]={root:null,limit:!1,url:e.url||"//idena.navarra.es/ogc/wfs",version:e.version||"1.1.0",outputFormat:TC.Consts.format.JSON,featurePrefix:e.featurePrefix||"IDENA",geometryName:"the_geom",featureType:"CATAST_Pol_Municipio",dataIdProperty:["CMUNICIPIO"],queryProperties:{firstQueryWord:["MUNICIPIO"]},outputProperties:["MUNICIPIO"],outputFormatLabel:"{0}",getRootLabel:function(){var t=new $.Deferred;if(e.rootCfg.active&&!e.rootCfg[TC.Consts.searchType.MUNICIPALITY].rootLabel){var r={SERVICE:"WFS"};r.VERSION=e.rootCfg[TC.Consts.searchType.MUNICIPALITY].version;r.REQUEST="GetFeature";r.TYPENAME=e.rootCfg[TC.Consts.searchType.MUNICIPALITY].featurePrefix+":"+e.rootCfg[TC.Consts.searchType.MUNICIPALITY].featureType;r.OUTPUTFORMAT=e.rootCfg[TC.Consts.searchType.MUNICIPALITY].outputFormat;r.PROPERTYNAME=["CMUNICIPIO"].concat(e.rootCfg[TC.Consts.searchType.MUNICIPALITY].outputProperties).join(",");r.CQL_FILTER=e.rootCfg[TC.Consts.searchType.MUNICIPALITY].root.map(function(e){return["CMUNICIPIO"].map(function(t,r){return t+"="+e[r]}).join(" AND ")});r.CQL_FILTER=r.CQL_FILTER.join(" OR ");$.ajax({url:e.rootCfg[TC.Consts.searchType.MUNICIPALITY].url+"?"+$.param(r),type:"GET"}).done(function(r){if(r.totalFeatures>0){e.rootCfg[TC.Consts.searchType.MUNICIPALITY].rootLabel=r.features.map(function(t){return{id:["CMUNICIPIO"].map(function(e){return t.properties[e]}).join("#"),label:t.properties[e.rootCfg[TC.Consts.searchType.MUNICIPALITY].outputProperties[0]].toLowerCase()}});t.resolve(e.rootCfg[TC.Consts.searchType.MUNICIPALITY].rootLabel)}else{e.rootCfg[TC.Consts.searchType.MUNICIPALITY].rootLabel=[];t.resolve(e.rootCfg[TC.Consts.searchType.MUNICIPALITY].rootLabel)}}).fail(function(){t.resolve([])})}else t.resolve(e.rootCfg[TC.Consts.searchType.MUNICIPALITY].rootLabel);return t}};e.rootCfg[TC.Consts.searchType.LOCALITY]={root:null,limit:!1,url:e.url||"//idena.navarra.es/ogc/wfs",version:e.version||"1.1.0",outputFormat:TC.Consts.format.JSON,featurePrefix:e.featurePrefix||"IDENA",geometryName:"the_geom",featureType:["ESTADI_Pol_EntidadPob"],renderFeatureType:"",dataIdProperty:["CMUNICIPIO","CENTIDADC"],queryProperties:{firstQueryWord:["ENTINOAC"]},outputProperties:["ENTINOAC"],getRootLabel:function(){var t=new $.Deferred;if(e.rootCfg.active&&!e.rootCfg[TC.Consts.searchType.LOCALITY].rootLabel){var r={SERVICE:"WFS"};r.VERSION=e.rootCfg[TC.Consts.searchType.LOCALITY].version;r.REQUEST="GetFeature";r.TYPENAME=e.rootCfg[TC.Consts.searchType.LOCALITY].featurePrefix+":"+e.rootCfg[TC.Consts.searchType.LOCALITY].featureType;r.OUTPUTFORMAT=e.rootCfg[TC.Consts.searchType.LOCALITY].outputFormat;r.PROPERTYNAME=["CMUNICIPIO","CENTIDAD"].concat(e.rootCfg[TC.Consts.searchType.LOCALITY].outputProperties).join(",");r.CQL_FILTER=e.rootCfg[TC.Consts.searchType.LOCALITY].root.map(function(e){return["CMUNICIPIO","CENTIDAD"].map(function(t,r){return t+"="+e[r]}).join(" AND ")});r.CQL_FILTER=r.CQL_FILTER.join(" OR ");$.ajax({url:e.rootCfg[TC.Consts.searchType.LOCALITY].url+"?"+$.param(r),type:"GET"}).done(function(r){if(r.totalFeatures>0){e.rootCfg[TC.Consts.searchType.LOCALITY].rootLabel=r.features.map(function(t){return{id:["CMUNICIPIO","CENTIDAD"].map(function(e){return t.properties[e]}).join("#"),label:t.properties[e.rootCfg[TC.Consts.searchType.LOCALITY].outputProperties[0]].toLowerCase()}});t.resolve(e.rootCfg[TC.Consts.searchType.LOCALITY].rootLabel)}else{e.rootCfg[TC.Consts.searchType.LOCALITY].rootLabel=[];t.resolve(e.rootCfg[TC.Consts.searchType.LOCALITY].rootLabel)}}).fail(function(){t.resolve([])})}else t.resolve(e.rootCfg[TC.Consts.searchType.LOCALITY].rootLabel);return t}};e.allowedSearchTypes=[];if(e.options.allowedSearchTypes)for(var t in e.options.allowedSearchTypes){if(e.availableSearchTypes[t]&&!$.isEmptyObject(e.options.allowedSearchTypes[t])){if(e.availableSearchTypes[t].renderFeatureType&&e.availableSearchTypes[t].renderFeatureType.length>0&&e.options.allowedSearchTypes[t].featureType&&!e.options.allowedSearchTypes[t].renderFeatureType){delete e.availableSearchTypes[t].renderFeatureType;e.availableSearchTypes[t].styles=e.availableSearchTypes[t].styles.slice(0,e.availableSearchTypes[t].styles.length-1)}$.extend(e.availableSearchTypes[t],e.options.allowedSearchTypes[t]);if(e.options.allowedSearchTypes[t].root&&t!=TC.Consts.searchType.MUNICIPALITY&&e.options.allowedSearchTypes[t].rootType==TC.Consts.searchType.MUNICIPALITY||t!=TC.Consts.searchType.LOCALITY&&e.options.allowedSearchTypes[t].rootType==TC.Consts.searchType.LOCALITY){e.rootCfg.active=e.rootCfg[e.options.allowedSearchTypes[t].rootType];e.rootCfg.active.root=e.options.allowedSearchTypes[t].root;e.rootCfg.active.limit=e.options.allowedSearchTypes[t].limit;e.availableSearchTypes[TC.Consts.searchType.STREET].queryProperties.firstQueryWord=e.availableSearchTypes[TC.Consts.searchType.NUMBER].queryProperties.firstQueryWord=e.rootCfg.active.dataIdProperty}}e.options.allowedSearchTypes[t]?e.addAllowedSearchType(t,e.availableSearchTypes[t]?e.availableSearchTypes[t]:e.options.allowedSearchTypes[t],e):delete e.options.allowedSearchTypes[t]}e.rootCfg.active&&e.rootCfg.active.getRootLabel();e.queryableFeatures=e.options.queryableFeatures||!1;e.UTMX_LEN=6;e.UTMY_LEN=7;e.wrap=new TC.wrap.control.Search(e);e.interval=500;e.NORMAL_PATTERNS={ROMAN_NUMBER:/M{0,4}(CM|CD|D?C{0,3})(XC|XL|L?X{0,3})(IX|IV|V?I{0,3}){1,}?\S?\./i,ABSOLUTE_NOT_DOT:/[`~!@#$%^&*_|+\=?;:'"\{\}\[\]\\]/gi,ABSOLUTE:/[`~!@#$%^&*_|+\=?;:'.\{\}\[\]\\]/gi}};TC.inherit(TC.control.Search,TC.Control);!function(){var e=TC.control.Search.prototype;e.CLASS="tc-ctl-search";TC.Consts.event.SEARCHQUERYEMPTY=TC.Consts.event.SEARCHQUERYEMPTY||"searchqueryempty.tc";TC.isDebug?e.template=TC.apiLocation+"TC/templates/Search.html":e.template=function(){dust.register(e.CLASS,t);function t(e,t){return e.w("<h2>").h("i18n",t,{},{$key:"search.1"}).w('</h2><div class="tc-ctl-search-content"><input type="search" class="tc-ctl-search-txt" placeholder="').h("i18n",t,{},{$key:"search.placeholder"}).w('" title="').h("i18n",t,{},{$key:"search.instructions"}).w('" /><a title="').h("i18n",t,{},{$key:"search.instructions"}).w('" class="tc-ctl-btn tc-ctl-search-btn">').h("i18n",t,{},{$key:"search.2"}).w('</a><ul class="tc-ctl-search-list"></ul></div>')}t.__dustBody=!0;return t};e.register=function(e){var t=this;TC.Control.prototype.register.call(t,e);t._search={data:[]};t.layerStyleFN=function(){function e(e){return e.indexOf(".")>-1?e.split(".")[0]:e}function r(r,a,o){var i=t.getSearchTypeByFeature(o);if(i){var s=i.getStyleByFeatureType(e(o));if(s&&s.hasOwnProperty(a))return s[a][r]}return TC.Cfg.styles[a][r]}return function(t,a,o,i){!TC.Feature||i instanceof TC.Feature||this.map.$events.trigger($.Event(TC.Consts.event.FEATURESADD,{layer:this.layer,geom:i.geom}));var s=r(a,t,e(i.id));if(o){if(s instanceof Array){var n=s.map(function(e){return i.getData().hasOwnProperty(e)?i.getData()[e]:""}),l=this.getSearchTypeByFeature(e(i.id));return l?l.outputFormatLabel.tcFormat(n):n.join(" ")}return i.getData().hasOwnProperty(s)?i.getData()[s]:""}return s}}();var r=t.layerStyleFN;e.addLayer({id:t.getUID(),title:"B\xfasquedas",stealth:!0,declutter:!0,type:TC.Consts.layerType.VECTOR,styles:{polygon:{fillColor:r.bind(t,"polygon","fillColor",!1),fillOpacity:r.bind(t,"polygon","fillOpacity",!1),strokeColor:r.bind(t,"polygon","strokeColor",!1),strokeOpacity:r.bind(t,"polygon","strokeOpacity",!1),strokeWidth:r.bind(t,"polygon","strokeWidth",!1)},line:{strokeColor:r.bind(t,"line","strokeColor",!1),strokeOpacity:r.bind(t,"line","strokeOpacity",!1),strokeWidth:r.bind(t,"line","strokeWidth",!1)},marker:{anchor:TC.Defaults.styles.marker.anchor,height:TC.Defaults.styles.marker.height,width:TC.Defaults.styles.marker.width},point:{radius:r.bind(t,"point","radius",!1),height:r.bind(t,"point","height",!1),width:r.bind(t,"point","width",!1),fillColor:r.bind(t,"point","fillColor",!1),fillOpacity:r.bind(t,"point","fillOpacity",!1),strokeColor:r.bind(t,"point","strokeColor",!1),strokeWidth:r.bind(t,"point","strokeWidth",!1),fontSize:r.bind(t,"point","fontSize",!1),fontColor:r.bind(t,"point","fontColor",!1),labelOutlineColor:r.bind(t,"point","labelOutlineColor",!1),labelOutlineWidth:r.bind(t,"point","labelOutlineWidth",!1),label:r.bind(t,"point","label",!0),angle:r.bind(t,"point","angle",!0)}}}).then(function(e){t.layer=e;t.layerPromise.resolve(e)},function(e){t.layerPromise.reject(e)});t.EMPTY_RESULTS_LABEL=t.getLocaleString("noResults");t.EMPTY_RESULTS_TITLE=t.getLocaleString("checkCriterion");t.OUTBBX_LABEL=t.getLocaleString("outsideOfLimits");t.WFS_TYPE_ATTRS=["url","version","geometryName","featurePrefix","featureType","properties","outputFormat"]};e.renderData=function(e,t){var r=this;r._search=r._search||{};var a=function(){r.search(r.$text.val(),function(e){if(1===e.length){r.$text.val(e[0].label);r._goToResult(e[0].id,r.$list.find("li:not([header])").attr("dataRole"));r.$list.hide("fast")}else 0===e.length&&r.$list.hide("fast")})};TC.Control.prototype.renderData.call(r,e,function(){var e=function(){r.$text.val(r.$list[0].label||r.$list.find("li:not([header]) > a > span").text());r.lastPattern=r.$text.val();r._goToResult(r.$list[0].id||unescape(r.$list.find("li:not([header]) > a").attr("href")).substring(1),r.$list.find("li:not([header])").attr("dataRole"));r.$list.hide("fast")};r.$text=r._$div.find("input.tc-ctl-search-txt");r.options&&r.options.placeHolder&&r.$text.attr("placeHolder",r.options.placeHolder.trim());r.$list=r._$div.find(".tc-ctl-search-list");r.$button=r._$div.find(".tc-ctl-search-btn");r.$button.on(TC.Consts.event.CLICK,function(){r.getLayer().then(function(t){r.$list.find("li > a:not(.tc-ctl-search-li-loading,.tc-ctl-search-li-empty)").length>1||(t.features.length>0?t.map.zoomToFeatures(t.features):1===r.$list.find("li > a:not(.tc-ctl-search-li-loading,.tc-ctl-search-li-empty)").length?e():r.$text.trigger("keyup.autocomplete"))})});if(r.options.instructions){r.$text.attr("title",r.options.instructions.trim());r.$button.attr("title",r.options.instructions.trim())}r.$list.on(TC.Consts.event.CLICK,"a.tc-ctl-search-li-empty",function(){r.$list.hide("fast");r.$text.focus()});try{if(r.$text.has($("::-ms-clear"))){r.$text.on("mouseup",function(e){""!==r.$text.val()&&setTimeout(function(){if(""===r.$text.val()){r.$list.hide("fast");a()}},1)})}}catch(e){}r.$text.on("keypress",function(t){if(13==t.which){t.preventDefault();t.stopPropagation();r.lastPattern="";1===r.$list.find("li > a:not(.tc-ctl-search-li-loading,.tc-ctl-search-li-empty)").length?e():a();return!1}}).on("search",function(){if(0===r.$text.val().length){r.$list.hide("fast");a()}}).on("input",function(){if(0===r.$text.val().length){r.$list.hide("fast");a()}}).on("targetCleared.autocomplete",function(){r.$list.hide("fast")}).on("targetUpdated.autocomplete",function(){r.$list.find("li").length>0&&r.$list.show("fast")});r.lastPattern="";r.retryTimeout=null;TC.loadJS(!r.$text.autocomplete,[TC.apiLocation+"lib/jQuery/autocomplete.js"],function(){var e;r.$text=r._$div.find("input.tc-ctl-search-txt");r.$text.autocomplete({link:"#",target:r.$list,minLength:2,ctx:r,source:function(t,a){r.lastpress=performance.now();if(!e){e=requestAnimationFrame(function t(){var o=r.$text.val().trim();if(o.length>0&&(!r.lastPattern||o!=r.lastPattern)&&performance.now()-r.lastpress>r.interval){window.cancelAnimationFrame(e);e=void 0;r.$list.hide("fast");r.lastPattern=o;r.search(o,a)}else e=requestAnimationFrame(t)})}},callback:function(e){var t=$(e.target);$(e.target).is("a")||(t=$(e.target).closest("a"));r.$text.val($(t).find("span[hidden]").text());r.lastPattern=r.$text.val();r._goToResult(unescape($(t).attr("href")).substring(1),$(t).parent().attr("dataRole"));r.$text.autocomplete("clear")},buildHTML:function(e){var t=[],a=[],o=/[^a-zA-Z]/g,i=/[^0-9]/g;function s(e,t){var r=parseInt(e,10),a=parseInt(t,10);if(isNaN(r)&&isNaN(a)){var s=e.replace(o,""),n=t.replace(o,"");if(s===n){var l=parseInt(e.replace(i,""),10),p=parseInt(t.replace(i,""),10);return l===p?0:l>p?1:-1}return s>n?1:-1}return isNaN(r)?1:isNaN(a)?-1:r>a?1:-1}var n=e.results.sort(function(e,t){return this.ctx.getSearchTypeByRole(e.dataRole).searchWeight&&this.ctx.getSearchTypeByRole(t.dataRole).searchWeight?(this.ctx.getSearchTypeByRole(e.dataRole).searchWeight||0)>(this.ctx.getSearchTypeByRole(t.dataRole).searchWeight||0)?1:(this.ctx.getSearchTypeByRole(e.dataRole).searchWeight||0)<(this.ctx.getSearchTypeByRole(t.dataRole).searchWeight||0)?-1:s(e.label,t.label):e.dataRole>t.dataRole?1:e.dataRole<t.dataRole?-1:s(e.label,t.label)}.bind(this));r.rootCfg.active&&(n=n.sort(function(e,t){const r=function(){var r,a,o=this.rootCfg.active.root[0]instanceof Array?this.rootCfg.active.root[0].join("-"):this.rootCfg.active.root[0];if(e.properties&&e.properties.length>0&&t.properties&&t.properties.length>0){r=this.rootCfg.active.dataIdProperty.map(function(t){return e.properties[t].toString()}).join("-");a=this.rootCfg.active.dataIdProperty.map(function(e){return t.properties[e].toString()}).join("-")}else{r=e.id;a=t.id}return r!==o&&a===o?1:r===o&&a!==o?-1:s(e.label,t.label)}.bind(this);return this.getSearchTypeByRole(e.dataRole).searchWeight&&this.getSearchTypeByRole(t.dataRole).searchWeight?(this.getSearchTypeByRole(e.dataRole).searchWeight||0)>(this.getSearchTypeByRole(t.dataRole).searchWeight||0)?1:(this.getSearchTypeByRole(e.dataRole).searchWeight||0)<(this.getSearchTypeByRole(t.dataRole).searchWeight||0)?-1:r():r()}.bind(r)));for(var l=0;l<n.length;l++){var p=n[l];if(-1==a.indexOf(p.dataRole)){var c=this.ctx.getSearchTypeByRole(p.dataRole);t[t.length]=c.getSuggestionListHead();a.push(p.dataRole)}const e=function(){p.label;var e=[],t=this.ctx.lastPattern,a=[],o=",";-1==(t=r.NORMAL_PATTERNS.ROMAN_NUMBER.test(t)?t.replace(r.NORMAL_PATTERNS.ABSOLUTE_NOT_DOT,""):t.replace(r.NORMAL_PATTERNS.ABSOLUTE,"")).indexOf(o)&&(o=" ");a=t.trim().split(o);if(p.label.indexOf(this.ctx.LAT_LABEL)>-1&&p.label.indexOf(this.ctx.LON_LABEL)>-1||p.label.indexOf(this.ctx.UTMX_LABEL)>-1&&p.label.indexOf(this.ctx.UTMY_LABEL)>-1){a=this.ctx.lastPattern.split(" ");for(var i=0;i<a.length;i++)","==a[i].trim().slice(-1)&&(a[i]=a[i].slice(0,-1))}for(var s=0;s<a.length;s++)if(a[s].trim().length>0){e.push("("+a[s].trim().replace(/\(/gi,"").replace(/\)/gi,"")+")");if(c=/((\<)|(\>)|(\<\>))/gi.exec(a[s].trim()))for(var n=a[s].trim().replace(/((\<)|(\>)|(\<\>))/gi,"").split(" "),l=0;l<n.length;l++)n[l].trim().length>0&&e.push("("+n[l].trim().replace(/\(/gi,"\\(").replace(/\)/gi,"\\)")+")")}if(p.dataRole==TC.Consts.searchType.ROAD||p.dataRole==TC.Consts.searchType.ROADPK){var c;if(c=r.getSearchTypeByRole(p.dataRole).getPattern().exec(this.ctx.lastPattern)){e=[];c[2]&&c[3]&&c[4]?e.push("("+c[2]+"-"+c[3]+"-"+c[4]+")"):c[2]&&c[3]?e.push("("+c[2]+"-"+c[3]+")"):c[3]&&c[4]?e.push("("+c[3]+"-"+c[4]+")"):(c[2]||c[3])&&e.push("("+(c[2]||c[3])+")");c[5]&&e.push("(?:"+r.getLocaleString("search.list.pk")+"\\:\\s\\d*)("+c[5]+")\\d*")}else c&&c[5]&&(e=[]).push("(?:"+r.getLocaleString("search.list.pk")+"\\:\\s\\d*)("+c[5]+")\\d*")}var u="("+e.join("|")+")";u=(u=(u=(u=(u=(u=(u=(u=(u=(u=(u=u.replace(/\xe1|\xe0/gi,"a")).replace(/\xe9|\xe8/gi,"e")).replace(/\xed|\xec/gi,"i")).replace(/\xf3|\xf2/gi,"o")).replace(/\xfa|\xf9/gi,"u")).replace(/\xfc/gi,"u")).replace(/a/gi,"[a|\xe1|\xe0]")).replace(/e/gi,"[e|\xe9|\xe8]")).replace(/i/gi,"[i|\xed|\xec]")).replace(/o/gi,"[o|\xf3|\xf2]")).replace(/u/gi,"[u|\xfa|\xfc|\xf9]");var f=new RegExp(u,"gi"),h=p.label;return p.dataRole!==TC.Consts.searchType.ROAD||p.dataRole!==TC.Consts.searchType.ROADPK?h.replace(f,function(){var e=Array.prototype.slice.call(arguments,0);return e[e.length-3]?e[0].replace(e[e.length-3],"<b>"+e[e.length-3]+"</b>"):"<b>"+e[0]+"</b>"}):h.replace(f,"<b>$1</b>")}.bind(this);t[t.length]='<li dataRole="'+p.dataRole+'"><a href="#'+encodeURIComponent(p.id)+'"><span hidden>'+p.label+"</span>"+e()+"</a></li>"}return t.join("")}});r.$text.add(r.$list).on("keydown",function(e){if(!e.ctrlKey&&!e.altKey&&!e.shiftKey)if(40===e.keyCode){r.$text[0]==document.activeElement?r.$list.find("li:not([header]):first a").focus():r.$list.find("li:not([header]):last a").is(":focus")?r.$text.focus():r.$list.find("li:not([header])").find("a:focus").parent("li:not([header])").nextAll("li:not([header]):first").find("a").focus();e.preventDefault();e.stopPropagation()}else if(38===e.keyCode){r.$text[0]==document.activeElement?r.$list.find("li:not([header]):last a").focus():document.activeElement==r.$list.find("li:not([header]):first a").get(0)?r.$list.find("li:not([header]):last a").focus():r.$list.find("li:not([header])").find("a:focus").parent("li:not([header])").prevAll("li:not([header]):first").find("a").focus();e.preventDefault();e.stopPropagation()}e.stopPropagation()})})});$.isFunction(t)&&t()};e.addAllowedSearchType=function(e,t){this.allowedSearchTypes.push(new SearchType(e,t,this))};e.getSearchTypeByRole=function(e){return this.allowedSearchTypes.filter(function(t){return t.typeName==e})[0]};e.getSearchTypeByFeature=function(e){var t=this.allowedSearchTypes.filter(function(t){return t.isFeatureOfThisType(e)});return t.length>0?t[0]:null};e.getElementOnSuggestionList=function(e,t){const r=this;for(var a=0;a<r.parent._search.data.length;a++)if(r.parent._search.data[a].id==e&&(!t||t&&r.parent._search.data[a].dataRole===t))return r.parent._search.data[a]};e.getLayer=function(){return this.layerPromise};e.getFeatures=function(){return this.layer.features};e.cleanMap=function(){var e=this;e.getLayer().then(function(t){var r=t.features;t.clearFeatures();e.map.$events.trigger($.Event(TC.Consts.event.FEATUREREMOVE,{layer:t,feature:r}));for(var a=0;a<e.WFS_TYPE_ATTRS.length;a++)t.hasOwnProperty(e.WFS_TYPE_ATTRS[a])&&delete t[e.WFS_TYPE_ATTRS[a]]})};e.getMunicipalities=function(){var e=this;TC.cache.search=TC.cache.search||{};if(!TC.cache.search.municipalities&&!e._municipalitiesDeferred){e._municipalitiesDeferred=new $.Deferred;var t=e.getSearchTypeByRole(TC.Consts.searchType.CADASTRAL);if(!(t.municipality&&t.municipality.featureType&&t.municipality.labelProperty&&t.municipality.idProperty))throw new Error("Error en la configuraci\xf3n de la b\xfasqueda: "+t.typeName+". Error en el objeto municipality");var r={REQUEST:"GetFeature",SERVICE:"WFS",TYPENAME:t.municipality.featureType,VERSION:t.version,PROPERTYNAME:t.municipality.labelProperty+","+t.municipality.idProperty,OUTPUTFORMAT:t.outputFormat};t.featurePrefix&&(r.TYPENAME=t.featurePrefix+":"+r.TYPENAME);var a=t.url+"?"+$.param(r);$.ajax({url:a,type:"GET",dataType:"text"}).done(function(r){var a=(t.outputFormat===TC.Consts.format.JSON?new TC.wrap.parser.JSON:new TC.wrap.parser.WFS({featureNS:t.municipality.featurePrefix,featureType:t.municipality.featureType})).read(r);TC.cache.search.municipalities=[];for(var o=0;o<a.length;o++){var i=a[o];TC.cache.search.municipalities.push({label:i.data[t.municipality.labelProperty],id:i.data[t.municipality.idProperty]})}TC.cache.search.municipalities.sort(function(e,t){return e.label<t.label?-1:e.label>t.label?1:0});e._municipalitiesDeferred.resolve(TC.cache.search.municipalities)}).fail(function(){e._municipalitiesDeferred.resolve()})}return TC.cache.search.municipalities?e._municipalitiesDeferred.resolve(TC.cache.search.municipalities):e._municipalitiesDeferred.promise()};e.getCoordinates=function(e){var t=new $.Deferred,r=e.match(new RegExp("^"+$.trim(this.UTMX_LABEL.toLowerCase())+"*\\s*([0-9]{"+this.UTMX_LEN+"}(?:[.,]\\d+)?)\\s*\\,?\\s*"+$.trim(this.UTMY_LABEL.toLowerCase())+"*\\s*([0-9]{"+this.UTMY_LEN+"}(?:[.,]\\d+)?)$"));r&&(e=r[1]+" "+r[2]);(r=e.match(new RegExp("^"+$.trim(this.LAT_LABEL.toLowerCase())+"*\\s*([-+]?\\d{1,3}([.,]\\d+)?)\\,?\\s*"+$.trim(this.LON_LABEL.toLowerCase())+"*\\s*([-+]?\\d{1,2}([.,]\\d+)?)$")))&&(e=r[1]+" "+r[3]);if(/\d/.test(e)&&(new RegExp("^([0-9]{"+this.UTMX_LEN+"}(?:[.,]\\d+)?)\\s*\\,?\\s*([0-9]{"+this.UTMY_LEN+"}(?:[.,]\\d+)?)$").test(e)||/^([-+]?\d{1,3}([.,]\d+)?)\,?\s*([-+]?\d{1,2}([.,]\d+)?)$/.test(e))){if((r=/^([-+]?\d{1,3}([.,]\d+)?)\,?\s*([-+]?\d{1,2}([.,]\d+)?)$/.exec(e))&&(r[1].indexOf(",")>-1||r[3].indexOf(",")>-1)){r[1]=r[1].replace(",",".");r[3]=r[3].replace(",",".");e=r[1]+" "+r[3]}if(!r||r&&(r[1].indexOf(",")>-1?r[1].replace(",","."):r[1])<=180&&(r[3].indexOf(",")>-1?r[3].replace(",","."):r[3])<=90){if((r=new RegExp("^([0-9]{"+this.UTMX_LEN+"}(?:[.,]\\d+)?)\\s*\\,?\\s*([0-9]{"+this.UTMY_LEN+"}(?:[.,]\\d+)?)$").exec(e))&&(r[1].indexOf(",")>-1||r[2].indexOf(",")>-1)){r[1]=r[1].replace(",",".");r[2]=r[2].replace(",",".");e=r[1]+" "+r[2]}e=e.replace(this.UTMX_LABEL,"").replace(this.UTMY_LABEL,"").replace(this.LON_LABEL,"").replace(this.LAT_LABEL,"");var a=TC.Util.parseCoords(e);if(a){var o=a[0].value,i=a[1].value,s=a[0].type===TC.Consts.UTM?this.UTMX:this.LAT,n=a[1].type===TC.Consts.UTM?this.UTMY:this.LON,l=s+o+n+i,p=this.getPoint(l);if(p&&!this.insideLimit(p)){o=a[1].value;i=a[0].value;l=(s=a[1].type===TC.Consts.UTM?this.UTMX:this.LAT)+o+(n=a[0].type===TC.Consts.UTM?this.UTMY:this.LON)+i;p=this.getPoint(l)}if(p){this.availableSearchTypes[TC.Consts.searchType.COORDINATES].label=/^X(\d+(?:\.\d+)?)Y(\d+(?:\.\d+)?)$/.test(l)?this.getLocaleString("search.list.coordinates.utm")+this.map.crs:this.getLocaleString("search.list.coordinates.geo");t.resolve([{id:l,label:this.getLabel(l),dataRole:TC.Consts.searchType.COORDINATES}])}else t.resolve([])}else t.resolve([])}else t.resolve([])}else t.resolve([]);return t.promise()};e.getCadastralRef=function(e){var t=this,r=new $.Deferred,a=e.match(new RegExp($.trim(t.MUN_LABEL.toLowerCase())+"?\\s(.*)\\,\\s?"+$.trim(t.POL_LABEL.toLowerCase())+"?\\s(\\d{1,2})\\,\\s?"+$.trim(t.PAR_LABEL.toLowerCase())+"?\\s(\\d{1,4})"));a&&(e=a[1]+", "+a[2]+", "+a[3]);var o=e;!/^(.*)\,(\s*\d{1,2}\s*)\,(\s*\d{1,4}\s*)$/.test(e)&&t.getSearchTypeByRole(TC.Consts.searchType.CADASTRAL).suggestionRoot&&(o=t.getSearchTypeByRole(TC.Consts.searchType.CADASTRAL).suggestionRoot+", "+e);/^(.*)\,(\s*\d{1,2}\s*)\,(\s*\d{1,4}\s*)$/.test(o)&&!new RegExp("^([0-9]{"+t.UTMX_LEN+"})\\s*\\,\\s*([0-9]{"+t.UTMY_LEN+"})$").test(e)?$.when(t.getMunicipalities()).then(function(e){var a=/^(.*)\,(\s*\d{1,2}\s*)\,(\s*\d{1,4}\s*)$/.exec(o);if(a){var i=new RegExp($.trim(a[1]).replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),"i"),s=[];const o=function(e,r,a,o){var i=[];i.push[t.MUN]=e;i.push[t.POL]=a;i.push[t.PAR]=o;return{id:t.MUN+e+t.POL+a+t.PAR+o,label:t.getLabel(t.MUN+r+t.POL+a+t.PAR+o),dataRole:TC.Consts.searchType.CADASTRAL,properties:i}};if((s=$.grep(e,function(e){e=e.label||e.id||e;return i.test(e)||i.test(t.removePunctuation(e))})).length>0)for(var n=0;n<s.length;n++)s[n]=o(s[n].id,s[n].label,$.trim(a[2]),$.trim(a[3]));if(/^[0-9]*$/g.test(a[1])){if(a[1].trim()===t.getSearchTypeByRole(TC.Consts.searchType.CADASTRAL).suggestionRoot){var l=e.filter(function(e){return parseInt(e.id)===parseInt(t.getSearchTypeByRole(TC.Consts.searchType.CADASTRAL).suggestionRoot)})[0];l&&r.resolve([o(l.id,l.label,$.trim(a[2]),$.trim(a[3]))])}s.push(o($.trim(a[1]),$.trim(a[1]),$.trim(a[2]),$.trim(a[3])))}r.resolve(s)}}):r.resolve([]);return r.promise()};e.stringPatternsValidators={tsp:function(e,a,o,i){var s=/^([^0-9\,]+)(?:\s*\,\s*)(?:([^\,][a-z\xf1\xe1\xe9\xed\xf3\xfa\xfc\xe0\xe8\xec\xf2\xf9\s*\-\.\(\)\/0-9]+))(?:\s*\,\s*)(?:(\d{1,3}\s?\-?\s?[a-z]{0,4}\s?\-?\s?[a-z]{0,4})|([a-z]{1,4}\s?\-?\s?\d{1,3})|(sn|S\/N|s\/n|s\-n)|([a-z]{1,4}\s?\+\s?[a-z]{1,4}))$/i.exec(e);if(s&&s[1]&&s[2]){var n=function(){return t((s[3]||s[4]||s[5]||s[6]).trim())};if(/^([^0-9]+)$/i.test(s[1].trim())&&/^([^0-9]+)$/i.test(s[2].trim())){a.push({t:s[1].trim(),s:s[2].trim(),p:n()});a.push({t:s[2].trim(),s:s[1].trim(),p:n()})}else/^([^0-9]+)$/i.test(s[1].trim())?a.push({t:s[1].trim(),s:s[2].trim(),p:n()}):a.push({s:s[1].trim(),t:s[2].trim(),p:n()});r.call(this,a,o,i);return!0}return!1},spt:function(e,a,o,i){var s=/^(?:([^\,][a-z\xf1\xe1\xe9\xed\xf3\xfa\xfc\xe0\xe8\xec\xf2\xf9\s*\-\.\(\)\/0-9]+))(?:\s*\,\s*)(?:(\d{1,3}\s?\-?\s?[a-z]{0,4}\s?\-?\s?[a-z]{0,4})|([a-z]{1,4}\s?\-?\s?\d{1,3})|(sn|S\/N|s\/n|s\-n)|([a-z]{1,4}\s?\+\s?[a-z]{1,4}))(?:\s*\,\s*)([^0-9\,]+)$/i.exec(e);if(s&&s[6]&&s[1]){var n=function(){return t((s[2]||s[3]||s[4]||s[5]).trim())};if(/^([^0-9]+)$/i.test(s[6].trim())&&/^([^0-9]+)$/i.test(s[1].trim())){a.push({t:s[6].trim(),s:s[1].trim(),p:n()});a.push({t:s[1].trim(),s:s[6].trim(),p:n()})}else/^([^0-9]+)$/i.test(s[6].trim())?a.push({t:s[6].trim(),s:s[1].trim(),p:n()}):a.push({s:s[6].trim(),t:s[1].trim(),p:n()});r.call(this,a,o,i);return!0}return!1},tnsp:function(e,a,o,i){var s=/^(?:([^\,][a-z\xf1\xe1\xe9\xed\xf3\xfa\xfc\xe0\xe8\xec\xf2\xf9\s*\-\.\(\)\/0-9]+))(?:\s*\,\s*)([^0-9\,]+)(?:\s*\,\s*)(?:(\d{1,3}\s?\-?\s?[a-z]{0,4}\s?\-?\s?[a-z]{0,4})|([a-z]{1,4}\s?\-?\s?\d{1,3})|(sn|S\/N|s\/n|s\-n)|([a-z]{1,4}\s?\+\s?[a-z]{1,4}))$/i.exec(e);if(s&&s[1]&&s[2]){a.push({t:s[2].trim(),s:s[1].trim(),p:t((s[3]||s[4]||s[5]||s[6]).trim())});r.call(this,a,o,i);return!0}return!1},ts:function(e,t,a,o){var i=/^([^0-9\,]+)(?:\s*\,\s*)(?:([^\,][a-z\xf1\xe1\xe9\xed\xf3\xfa\xfc\xe0\xe8\xec\xf2\xf9"\s*\-\.\(\)\/0-9]+))$/i.exec(e);if(!i&&/^[^0-9]*$/i.test(e.trim())){var s=e.split(",").reverse();i=/^([^0-9\,]+)(?:\s*\,\s*)(?:([^\,][a-z\xf1\xe1\xe9\xed\xf3\xfa\xfc\xe0\xe8\xec\xf2\xf9"\s*\-\.\(\)\/0-9]+))$/i.exec(s.join(","))}if(i&&i[1]&&i[2]){if(/^([^0-9]+)$/i.test(i[1].trim())&&/^([^0-9]+)$/i.test(i[2].trim())){t.push({t:i[1].trim(),s:i[2].trim()});t.push({s:i[1].trim(),t:i[2].trim()});r.call(this,t,a,o)}else{var n=function(e){for(var t=e.split(" ").reverse(),r=[],a=0;a<t.length;a++)if(1==t[a].length){r.push(t[a]);t[a]=""}return r.length>0?t.reverse().join(" ").trim()+self._LIKE_PATTERN+r.reverse().join(self._LIKE_PATTERN):t.reverse().join(" ").trim()};/^([^0-9]+)$/i.test(i[1].trim())?t.push({t:i[1].trim(),s:n(i[2].trim())}):t.push({s:n(i[1].trim()),t:i[2].trim()});r.call(this,t,a,o,!0)}return!0}return!1},st:function(e,a,o,i){var s=/^(?:([^\,][a-z\xf1\xe1\xe9\xed\xf3\xfa\xfc\xe0\xe8\xec\xf2\xf9\s*\-\.\(\)\/0-9]+))(?:\s*\,\s*)([^0-9\,]+)$/i.exec(e);if(!s){var n=e.split(",").reverse();s=/^([^0-9\,]+)(?:\s*\,\s*)(?:([^\,][a-z\xf1\xe1\xe9\xed\xf3\xfa\xfc\xe0\xe8\xec\xf2\xf9"\s*\-\.\(\)\/0-9]+))$/i.exec(n.join(","))}if(s){for(var l={},p=(n=e.split(",").reverse(),0);p<n.length;p++)if(/^([^0-9\,]+)$/i.test(n[p].trim()))l.t=n[p].trim();else if(/(\s*\d+)/i.test(n[p].trim()))if(-1==n[p].trim().indexOf(" "))l.s=n[p].trim();else{for(var c=n[p].trim().split(" ").reverse(),u=function(e){if(/^(?:(\d{1,3}\s?\-?\s?[a-z]{0,4}\s?\-?\s?[a-z]{0,4})|([a-z]{1,4}\s?\-?\s?\d{1,3})|(sn|S\/N|s\/n|s\-n)|([a-z]{1,4}\s?\+\s?[a-z]{1,4}))$/i.exec(e.trim())){l.p=t(e.trim());return!0}return!1},f=0,h=c[f].trim();f<c.length&&!u(h);)++f<c.length&&(h+=c[f]);if(l.p){for(var T=c,g=0;g<T.length;g++){for(var d=!1,y=0;y<T[g].split("").length;y++)l.p.indexOf(T[g][y])>-1&&(d=!0);if(d){T[g];T[g]="";if(l.p==t(h))break}}if(/^([^\,][a-z\xf1\xe1\xe9\xed\xf3\xfa\xfc\xe0\xe8\xec\xf2\xf9\s*\-\.\(\)\/0-9]+)$/i.test(c.reverse().join(" ").trim())){for(var C=[],m=c.reverse(),P=0;P<m.length;P++)if(1==m[P].trim().length){C.push(m[P].trim());m[P]=""}l.s=C.length>0?m.reverse().join(" ").trim()+self._LIKE_PATTERN+C.reverse().join(self._LIKE_PATTERN):m.reverse().join(" ").trim()}a.push({t:l.t,s:l.s+" "+l.p})}else l.s=n[p].trim()}a.push(l);r.call(this,a,o,i);return!0}return!1},s_or_t:function(e,t,r,a){var o=/^([^\,][a-z\xf1\xe1\xe9\xed\xf3\xfa\xfc\xe0\xe8\xec\xf2\xf9\s*\-\.\(\)\/0-9\<\>]+)$/i.exec(e);if(o&&o[1]){if(r){t.push({t:o[1].trim()});t.push({t:r,s:o[1].trim()})}else t.push({t:o[1].trim()});return!0}return!1},sp:function(e,r,a,o){var i=/^([^\,][a-z\xf1\xe1\xe9\xed\xf3\xfa\xfc\xe0\xe8\xec\xf2\xf9\s*\-\.\(\)\/]+)\s*\,?\s*((\d{1,3}\s?\-?\s?[a-z]{0,4}\s?\-?\s?[a-z]{0,4})|([a-z]{1,4}\s?\-?\s?\d{1,3})|(sn|S\/N|s\/n|s\-n)|([a-z]{1,4}\s?\+\s?[a-z]{1,4}))$/i.exec(e);if(i&&i[1]&&i[2]){a?r.push({t:a,s:i[1].trim(),p:t(i[2].trim())}):r.push({t:i[1].trim(),s:i[2].trim()});return!0}return!1},snp:function(e,r,a,o){var i=/^([^\,][0-9\s*\-\.\(\)\/]+)\s*\,?\s*(\d{1,3}\s?\-?\s?[a-z]{0,4}\s?\-?\s?[a-z]{0,4})|([a-z]{1,4}\s?\-?\s?\d{1,3})|(sn|S\/N|s\/n|s\-n)|([a-z]{1,4}\s?\+\s?[a-z]{1,4})$/i.exec(e);if(i&&i[1]&&i[2]&&a){r.push({t:a,s:i[1].trim(),p:t(i[2].trim())});return!0}return!1}};const t=function(e){for(var t=[function(e){return/^(\d{1,3})\s?\-?\s?([a-z]{0,4})\s?\-?\s?([a-z]{0,4})$/i.test(e)},function(e){return/^([a-z]{1,4})\s?\-?\s?(\d{1,3})$/i.test(e)},function(e){return/^(sn|S\/N|s\/n|s\-n)$/i.test(e)},function(e){return/^([a-z]{1,4}\s?\+\s?[a-z]{1,4})$/i.test(e)}],r=[function(e){var t=[],r=/^(\d{1,3})\s?\-?\s?([a-z]{0,4})\s?\-?\s?([a-z]{0,4})$/i.exec(e);if(r){for(var a=1;a<r.length;a++)r[a].trim().length>0&&t.push(r[a].trim());return t.join(self._LIKE_PATTERN)}return e},function(e){var t=[],r=/^([a-z]{1,4})\s?\-?\s?(\d{1,3})$/i.exec(e);if(r){for(var a=1;a<r.length;a++)r[a].trim().length>0&&t.push(r[a].trim());return t.join(self._LIKE_PATTERN)}return e},function(e){return/^(sn|S\/N|s\/n|s\-n)$/i.exec(e)?"s*n":e},function(e){/^([a-z]{1,4}\s?\+\s?[a-z]{1,4})$/i.exec(e);return e}],a=0;a<r.length&&!t[a].call(self,e);)a++;return a<r.length?r[a].call(self,e):e},r=function(e,t,r,a){const o=this;if(t)for(var i=e.length;i--;)if(a)e.push($.extend({},e[i],{t:t}));else if(e[i].t){var s=o.rootCfg.active.rootLabel.filter(function(t){return t.label.indexOf(o.removePunctuation(e[i].t).toLowerCase())>-1}.bind(o));1==s.length?e[i].t=s[0].id:s.length>1?s.map(function(t){var r=$.extend({},e[i]);r.t=t.id;e.push(r)}):0==s.length&&r&&e.splice(i,1)}},a=function(e,t){const r=this,a=r.rootCfg.active&&r.rootCfg.active.root||"",o=r.rootCfg.active&&r.rootCfg.active.limit||!1;var i=[];","==(t=t.trim()).charAt(t.length-1)&&(t=t.substring(0,t.length-1));if(function(){for(var e=[function(e){return e.length>=3},function(e){return!/^\d+$/.test(e)&&!/^\d+\,\s*\d+$/.test(e)}],a=0;a<e.length;a++)if(!e[a].call(r,t))return!1;return!0}()){var s=[];if(0===(s=e.map(function(e){return r.getSearchTypeByRole(e)}).filter(function(e){return e.stringPatternToCheck}).map(function(e){return e.stringPatternToCheck})).length){s=[r.stringPatternsValidators.tsp,r.stringPatternsValidators.spt,r.stringPatternsValidators.tnsp,r.stringPatternsValidators.ts,r.stringPatternsValidators.st];s=a&&t.split(",").length<3?[r.stringPatternsValidators.sp,r.stringPatternsValidators.snp,r.stringPatternsValidators.s_or_t].concat(s):s.concat([r.stringPatternsValidators.sp,r.stringPatternsValidators.snp,r.stringPatternsValidators.s_or_t])}var n=0;try{for(;n<s.length&&!s[n].call(r,t,i,a,o);)n++}catch(e){TC.error("Error seg\xfan el patr\xf3n: "+t,TC.Consts.msgErrorMode.EMAIL,"Error en la b\xfasqueda del callejero")}return i}return null},o=function(e,t,r){const a=this;if(r){var o=[];a._search.data=o;a.request||(a.request=[]);r.forEach(function(t,r){e.filter(function(e){var r=a.getSearchTypeByRole(e);return Object.keys(r.queryProperties).length===Object.keys(t).length}).map(function(e){var r=a.getSearchTypeByRole(e);a.request.push(function(e,t,r){const a=this;return $.ajax({url:e.url,type:"POST",contentType:"application/x-www-form-urlencoded;charset=UTF-8",dataType:"text",data:e.filter.getParams(r),beforeSend:function(){a.$list.html('<li><a class="tc-ctl-search-li-loading" href="#">'+a.getLocaleString("searching")+'<span class="tc-ctl-search-loading-spinner tc-ctl-search-loading"></span></a></li>');a.$text.trigger("targetUpdated.autocomplete")}}).done(t).fail(function(e){"abort"!==e.statusText&&alert("error")})}.call(a,r,function(e){o=o.concat(r.getSuggestionListElements(e))},t))})});$.when.apply($,a.request).then(function(){t.resolve(o)})}else t.resolve([])};e.getStringPattern=function(e,t){var r=new $.Deferred;t=function(e){e=this.removePunctuation(e);return(e=this.NORMAL_PATTERNS.ROMAN_NUMBER.test(e)?e.replace(this.NORMAL_PATTERNS.ABSOLUTE_NOT_DOT,""):e.replace(this.NORMAL_PATTERNS.ABSOLUTE,"")).toLowerCase()}.call(this,t);var i=/(.*)\((.*)\)/.exec(t);if(i&&i.length>2){var s=a.call(this,e,i[1]),n=a.call(this,e,i[1]+","+i[2]);n=(n||[]).concat(s||[]);o.call(this,e,r,n);return r}s=a.call(this,e,t);o.call(this,e,r,s);return r};e.getRoad=function(e){var t=this,r=new $.Deferred;if((e=e.trim()).length<2)r.resolve([]);else{var a=t.getSearchTypeByRole(TC.Consts.searchType.ROAD),o=a.getPattern().exec(e);if(o&&o[3]){var i=o[2]?o[2].trim()+"-"+o[3].trim():o[3].trim();o[4]&&o[4].length>0&&(i=i+"-"+o[4].trim());$.ajax({url:a.url+"?"+a.filter.getParams({t:i}),type:"GET",contentType:"application/x-www-form-urlencoded;charset=UTF-8",beforeSend:function(){t.$list.html('<li><a class="tc-ctl-search-li-loading" href="#">'+t.getLocaleString("searching")+'<span class="tc-ctl-search-loading-spinner tc-ctl-search-loading"></span></a></li>');t.$text.trigger("targetUpdated.autocomplete")}}).done(function(e){var t=[];if(e.totalFeatures>0){e.features.map(function(e){var r=a.outputProperties;if(!t.some(function(t){return t.text==e.properties[r[0]]})){var o=a.outputFormatLabel.tcFormat(a.outputProperties.map(function(t){return e.properties[t]})),i=a.outputProperties.map(function(t){return e.properties[t]}).join("-");t.push({id:a.dataIdProperty.map(function(t){return e.properties[t]}).join("#"),label:o,text:i,dataLayer:e.id.split(".")[0],dataRole:a.typeName})}});r.resolve(t)}else r.resolve([])}).fail(function(e){r.resolve([])})}else r.resolve([])}return r.promise()};e.getPK=function(e){var t=this,r=new $.Deferred;if((e=e.trim()).length<3)r.resolve([]);else{var a=t.getSearchTypeByRole(TC.Consts.searchType.ROADPK),o=a.getPattern().exec(e);if(o&&o[3]&&o[5]){var i=o[2]?o[2].trim()+"-"+o[3].trim():o[3].trim();o[4]&&o[4].length>0&&(i=i+"-"+o[4].trim());$.ajax({url:a.url+"?"+a.filter.getParams({t:i,s:o[5].trim()}),type:"GET",contentType:"application/x-www-form-urlencoded;charset=UTF-8",beforeSend:function(){t.$list.html('<li><a class="tc-ctl-search-li-loading" href="#">'+t.getLocaleString("searching")+'<span class="tc-ctl-search-loading-spinner tc-ctl-search-loading"></span></a></li>');t.$text.trigger("targetUpdated.autocomplete")}}).done(function(e){var t=[];if(e.totalFeatures>0){e.features.map(function(e){var r=a.outputProperties;if(!t.some(function(t){return t.label==e.properties[r[0]]})){var o=a.outputFormatLabel.tcFormat(a.outputProperties.map(function(t){return e.properties[t]}));t.push({id:a.dataIdProperty.map(function(t){return e.properties[t]}).join("#"),label:o,text:o,dataLayer:e.id.split(".")[0],dataRole:a.typeName})}});r.resolve(t)}else r.resolve([])}).fail(function(e){r.resolve([])})}else r.resolve([])}return r.promise()};e.search=function(e,t){var r=this,a=[];if(r.request){for(var o=0;o<r.request.length;o++){console.log("new criteria: search promise/s aborted");r.request[o].abort()}r.request=[]}if((e=$.trim(e)).length>0){e=e.toLowerCase();var i=[];r.allowedSearchTypes.forEach(function(t){t.parser?function(t){var o=new $.Deferred;i.push(o);$.when(t.call(r,e)).then(function(e){a=a.concat(e);o.resolve(a)})}(t.parser):console.log("Falta implementaci\xf3n del m\xe9todo parser")});$.when.apply(r,i).then(function(){a&&(r._search.data=a=a.sort(function(e,t){var r,a=/(\d+)/,o="";if(a.test(e.label)&&a.test(t.label)){r=e.label.match(a)[1];o=t.label.match(a)[1]}else{r=e.label;o=t.label}return r>o?1:r<o?-1:0}.bind(r)));t&&t(a);if(0===a.length){r.cleanMap();if(!r.layer||r.layer&&0===r.layer.features.length){r.$list.html('<li><a title="'+r.EMPTY_RESULTS_TITLE+'" class="tc-ctl-search-li-empty">'+r.EMPTY_RESULTS_LABEL+"</a></li>");r.$text.trigger("targetUpdated.autocomplete")}}r.lastPattern=""})}else r.cleanMap()};var i=function(e){if(e&&e.length>0)for(var t=0;t<e.length;t++)e[t].showsPopup!=this.queryableFeatures&&(e[t].showsPopup=this.queryableFeatures)};e._goToResult=function(e,t){var r=this,a=null;const o=$.Deferred();r.loading||(r.loading=r.map.getControlsByClass("TC.control.LoadingIndicator")[0]);var s;s=r.loading.addWait();if(Modernizr.mq("(max-width: 30em)")){r.$text.blur();r.map.$events.trigger($.Event(TC.Consts.event.TOOLSCLOSE),{})}r.cleanMap();var n=!1,l=!0;r.allowedSearchTypes.forEach(function(o){if(l)if(r.availableSearchTypes[o.typeName]){var i=t||r.getElementOnSuggestionList.call(r,e).dataRole;if(i){var s=r.getSearchTypeByRole(i);if(r.availableSearchTypes[i]&&s&&s.goTo)null!==(a=s.goTo.call(r,e,i))&&(l=!1);else if(!r.availableSearchTypes[i]&&s&&s.goTo){n=!0;null!==(a=s.goTo.call(r,e,i))&&(l=!1)}else console.log("Falta implementaci\xf3n del m\xe9todo goTo")}}else if(o.goTo){n=!0;null!==(a=o.goTo.call(r,e))&&(l=!1)}else console.log("Falta implementaci\xf3n del m\xe9todo goTo")});r.loading.removeWait(s);if(a){r.getLayer().then(function(e){switch(!0){case a.params.type==TC.Consts.layerType.VECTOR:for(var t=0;t<r.WFS_TYPE_ATTRS.length;t++)e.hasOwnProperty(r.WFS_TYPE_ATTRS[t])&&delete e[r.WFS_TYPE_ATTRS[t]];break;case a.params.type==TC.Consts.layerType.WFS:for(t=0;t<r.WFS_TYPE_ATTRS.length;t++)e[r.WFS_TYPE_ATTRS[t]]=a.params[r.WFS_TYPE_ATTRS[t]];s=r.loading.addWait()}e.type=a.params.type;e.refresh().then(function(){r.map.one(TC.Consts.event.LAYERUPDATE,function(t){if(t.layer==e){r.map.one(TC.Consts.event.FEATURESADD,function(t){if(t.layer==e){if(!t.layer.features||0==t.layer.features.length&&t.layer.wrap.layer.getSource().getFeatures()){r.$list.hide("fast");var o=t.layer.wrap.layer.getSource().getExtent(),n=t.layer.map.options.pointBoundsRadius;if(o[2]-o[0]==0){o[0]=o[0]-n;o[2]=o[2]+n}if(o[3]-o[1]==0){o[1]=o[1]-n;o[3]=o[3]+n}t.layer.map.setExtent(o);r.map.$events.trigger($.Event(TC.Consts.event.ZOOMTO,{extent:o,layer:t.layer}))}else if(t.layer.features&&t.layer.features.length>0){r.$list.hide("fast");i.call(r,t.layer.features);r.layer.map.zoomToFeatures(t.layer.features);r.map.$events.trigger($.Event(TC.Consts.event.FEATURESADD,{layer:r.layer,features:r.layer.features}))}else if(t.layer.features&&0==t.layer.features.length&&a.params.type==TC.Consts.layerType.WFS){r.$list.html(a.emptyResultHTML);r.$text.trigger("targetUpdated.autocomplete");r.map.$events.trigger($.Event(TC.Consts.event.SEARCHQUERYEMPTY))}r.loading.removeWait(s)}});if(t.layer.features&&t.layer.features.length>0){r.$list.hide("fast");i.call(r,t.layer.features);r.layer.map.zoomToFeatures(r.layer.features);r.map.$events.trigger($.Event(TC.Consts.event.FEATURESADD,{layer:r.layer,features:r.layer.features}));r.loading.removeWait(s)}else if(t.layer.features&&0==t.layer.features.length&&a.params.type==TC.Consts.layerType.WFS){r.$list.html(a.emptyResultHTML);r.$text.trigger("targetUpdated.autocomplete");t.newData&&t.newData.features&&t.newData.features.length>0||r.map.$events.trigger($.Event(TC.Consts.event.SEARCHQUERYEMPTY));r.loading.removeWait(s)}}})})});o.resolve(a)}else{o.reject();n||r.map.$events.trigger($.Event(TC.Consts.event.SEARCHQUERYEMPTY))}return o.promise()};e.goToResult=function(e,t){if(this.getSearchTypeByRole(t))return this._goToResult(e,t);if(this.availableSearchTypes[t]){this.addAllowedSearchType(t,this.availableSearchTypes[t],this);return this._goToResult(e,t)}alert("No se reconoce el tipo de b\xfasqueda: "+t)};e.goToCoordinates=function(e){var t={};if(/^X(\d+(?:[\.\,]\d+)?)Y(\d+(?:[\.\,]\d+)?)$/.test(e)||/^Lat((?:[+-]?)\d+(?:[.,]\d+)?)Lon((?:[+-]?)\d+(?:[.,]\d+)?)$/.test(e)){t.params={type:TC.Consts.layerType.VECTOR,styles:{marker:{url:this.layerStyleFN.bind(this,"marker","url",!0)}}};t.emptyResultHTML='<li><a class="tc-ctl-search-li-empty">'+this.OUTBBX_LABEL+"</a></li>";(function(e){var t=this;wait=t.loading.addWait();var r,a,o,i=t.getPoint(e);if(i){a=t.getLabel(e);o=t.layer.addMarker(i,$.extend({},t.map.options.styles.point,{title:a,group:a}));r=t.map.options.pointBoundsRadius;t.map.setExtent([i[0]-r,i[1]-r,i[0]+r,i[1]+r])}else{var s=/^Lat((?:[+-]?)\d+(?:\.\d+)?)Lon((?:[+-]?)\d+(?:\.\d+)?)$/.exec(e);e=t.LAT+s[2]+t.LON+s[1];if(i=t.getPoint(e)){a=t.getLabel(e);o=t.layer.addMarker(i,$.extend({},t.map.options.styles.point,{title:a,group:a}));r=t.map.options.pointBoundsRadius;t.map.setExtent([i[0]-r,i[1]-r,i[0]+r,i[1]+r]);t.$text.val(a)}}$.when(o).then(function(e){t.map.$events.trigger($.Event(TC.Consts.event.FEATURESADD,{layer:t.layer,features:[e]}));t.loading.removeWait(wait)})}).call(this,e);return t}return null};e.goToCadastralRef=function(e){var t={},r=new RegExp("^"+this.MUN+"(\\d+)"+this.POL+"(\\d{1,2})"+this.PAR+"{1}(\\d{1,4})");if(r.test(e)){var a=r.exec(e);TC.filter||TC.syncLoadJS(TC.apiLocation+"TC/Filter");var o=this.getSearchTypeByRole(TC.Consts.searchType.CADASTRAL);t.params={type:TC.Consts.layerType.WFS,url:o.url,version:o.version,geometryName:o.geometryName,featurePrefix:o.featurePrefix,featureType:o.featureType,properties:new TC.filter.and(new TC.filter.equalTo(o.queryProperties.firstQueryWord,$.trim(a[1])),new TC.filter.equalTo(o.queryProperties.secondQueryWord,$.trim(a[2])),new TC.filter.equalTo(o.queryProperties.thirdQueryWord,$.trim(a[3]))),outputFormat:o.outputFormat,styles:o.styles};t.emptyResultHTML='<li><a title="'+this.EMPTY_RESULTS_TITLE+'" class="tc-ctl-search-li-empty">'+this.EMPTY_RESULTS_LABEL+"</a></li>";return t}return null};e.goToRoad=function(e){var t={},r=this.getSearchTypeByRole(TC.Consts.searchType.ROAD);t.params={type:TC.Consts.layerType.WFS,url:r.url,version:r.version,geometryName:r.geometryName,featurePrefix:r.featurePrefix,featureType:r.getFeatureTypes(),maxFeatures:3e3,properties:r.filter.getGoToFilter(e),outputFormat:r.outputFormat,styles:r.styles};t.emptyResultHTML='<li><a title="'+this.EMPTY_RESULTS_TITLE+'" class="tc-ctl-search-li-empty">'+this.EMPTY_RESULTS_LABEL+"</a></li>";return t};e.goToPK=function(e){var t={},r=this.getSearchTypeByRole(TC.Consts.searchType.ROADPK);t.params={type:TC.Consts.layerType.WFS,url:r.url,version:r.version,geometryName:r.geometryName,featurePrefix:r.featurePrefix,featureType:r.getFeatureTypes(),maxFeatures:3e3,properties:r.filter.getGoToFilter(e),outputFormat:r.outputFormat,styles:r.styles};t.emptyResultHTML='<li><a title="'+this.EMPTY_RESULTS_TITLE+'" class="tc-ctl-search-li-empty">'+this.EMPTY_RESULTS_LABEL+"</a></li>";return t};e.goToStringPattern=function(e,t){var r={},a=this.getSearchTypeByRole(t);r.params={type:TC.Consts.layerType.WFS,url:a.url,version:a.version,geometryName:a.geometryName,featurePrefix:a.featurePrefix,featureType:a.getFeatureTypes(),maxFeatures:3e3,properties:a.filter.getGoToFilter(e),outputFormat:a.outputFormat,styles:a.styles};return r};e.getPoint=function(e){var t,r=this.map.wrap.isGeo(),a=/^X(\d+(?:\.\d+)?)Y(\d+(?:\.\d+)?)$/.exec(e);if(a&&3===a.length){t=[parseFloat(a[1]),parseFloat(a[2])];r&&(t=TC.Util.reproject(t,this.map.options.utmCrs,this.map.crs))}else{if((a=/^Lat((?:[+-]?)\d+(?:[.,]\d+)?)Lon((?:[+-]?)\d+(?:[.,]\d+)?)$/.exec(e))&&3===a.length){t=[parseFloat(a[2]),parseFloat(a[1])];if(!r)return TC.Util.reproject(t,this.map.options.geoCrs,this.map.crs)}if((a=/^Lon((?:[+-]?)\d+(?:[.,]\d+)?)Lat((?:[+-]?)\d+(?:[.,]\d+)?)$/.exec(e))&&3===a.length){t=[parseFloat(a[2]),parseFloat(a[1])];if(!r)return TC.Util.reproject(t,this.map.options.geoCrs,this.map.crs)}}return t};e.insideLimit=function(e){return!!function(e,t){return!(e instanceof Array)||t[0]>=e[0]&&t[0]<=e[2]&&t[1]>=e[1]&&t[1]<=e[3]}(this.map.options.maxExtent,e)};e.getPattern=function(){return this.$text.val()};e.getLabel=function(e){var t=e,r=TC.Util.getMapLocale(this.map);if(e.match(new RegExp("^(?:"+this.LAT+"[-\\d])|(?:"+this.UTMX+"[\\d])"))){(o=(t=t.replace(this.LAT,this.LAT_LABEL).replace(this.LON," "+this.LON_LABEL).replace(this.UTMX,this.UTMX_LABEL).replace(this.UTMY," "+this.UTMY_LABEL)).match(new RegExp("^"+$.trim(this.LAT_LABEL)+"*\\s*([-+]?\\d{1,3}([.,]\\d+)?)\\,?\\s*"+$.trim(this.LON_LABEL)+"*\\s*([-+]?\\d{1,2}([.,]\\d+)?)$")))&&(t=(t=t.replace(o[1],parseFloat(o[1]).toLocaleString(r))).replace(o[3],parseFloat(o[3]).toLocaleString(r)));var a=1.1.toLocaleString(r).substring(1,2);if(o=t.match(new RegExp("^"+$.trim(this.UTMX_LABEL)+"*\\s*([0-9]{"+this.UTMX_LEN+"}(?:[.,]\\d+)?)\\s*\\,?\\s*"+$.trim(this.UTMY_LABEL)+"*\\s*([0-9]{"+this.UTMY_LEN+"}(?:[.,]\\d+)?)$"))){Number.isInteger(parseFloat(o[1]))||(t=t.replace(o[1],o[1].replace(".",a)));Number.isInteger(parseFloat(o[2]))||(t=t.replace(o[2],o[2].replace(".",a)))}}else if(e.match(new RegExp("^(?:"+this.LON+"[-\\d])"))){(o=(t=t.replace(this.LON,this.LON_LABEL).replace(this.LAT," "+this.LAT_LABEL)).match(new RegExp("^"+$.trim(this.LON_LABEL)+"*\\s*([-+]?\\d{1,3}([.,]\\d+)?)\\,?\\s*"+$.trim(this.LAT_LABEL)+"*\\s*([-+]?\\d{1,2}([.,]\\d+)?)$")))&&(t=(t=t.replace(o[1],parseFloat(o[1]).toLocaleString(r))).replace(o[3],parseFloat(o[3]).toLocaleString(r)))}else if(e.match(new RegExp("^(?:(\\"+this.MUN+"{1})(.*)(\\"+this.POL+"{1})(\\d{1,2})(\\"+this.PAR+"{1})(\\d{1,4}))"))){var o=e.match(new RegExp("^(?:(\\"+this.MUN+"{1})(.*)(\\"+this.POL+"{1})(\\d{1,2})(\\"+this.PAR+"{1})(\\d{1,4}))"));t=this.MUN_LABEL+o[2]+", "+this.POL_LABEL+o[4]+", "+this.PAR_LABEL+o[6]}return t};e.removePunctuation=function(e){e=e||"";for(var t=new Array(e.length),r={"\xe1":"a","\xe0":"a","\xc1":"A","\xc0":"A","\xe9":"e","\xe8":"e","\xc9":"E","\xc8":"E","\xed":"i","\xec":"i","\xcd":"I","\xcc":"I","\xf3":"o","\xf2":"o","\xd3":"O","\xd2":"O","\xfa":"u","\xf9":"u","\xfc":"u","\xda":"U","\xd9":"U","\xdc":"U"},a=0,o=e.length;a<o;a++)t[a]=r[e.charAt(a)]||e.charAt(a);return t.join("")};e.decodeEntities=function(e){return $("<div/>").html(e).text()};e.exportState=function(){const e=this;return e.exportsState?{id:e.id,searchText:e.$text.val(),layer:e.layer.exportState({exportStyles:!1})}:null};e.importState=function(e){const t=this;t.$text.val(e.searchText);t.layer.importState(e.layer).then(function(){t.layer.features.forEach(function(e){e.setStyle(null)})})}}();String.prototype.tcFormat||(String.prototype.tcFormat=function(){var e=(arguments||[""])[0];return this.replace(/{(\d+)}/g,function(t,r){return void 0!==e[r]?e[r]:t})});String.prototype.splitRemoveWhiteSpaces||(String.prototype.splitRemoveWhiteSpaces=function(e){for(var t=[],r=this.split(e),a=0;a<r.length;a++)$.trim(r[a]).length>0&&t.push($.trim(r[a]));return t});String.prototype.toCamelCase||(String.prototype.toCamelCase=function(){var e=this.toLowerCase(),t=this.toLowerCase().match(/[^A-Z\xc1\xc9\xcd\xd3\xda\xdc\xc0\xc8\xcc\xd2\xd9\xe1\xe9\xed\xf3\xfa\xfc\xe0\xe8\xec\xf2\xf9a-z0-9_]+(.)/g);if(t)for(var r=0;r<t.length;r++)/[-;:.<>\{\}\[\]\/\s()]/g.test(t[r])&&(e=e.replace(t[r],t[r].toUpperCase()));return e.charAt(0).toUpperCase()+e.substring(1)});Array.prototype.hasOwnProperty("findByProperty")||Object.defineProperty(Array.prototype,"findByProperty",{enumerable:!1,writable:!0,value:function(e,t){for(var r=0;r<this.length;r++)if(this[r][e]==t)return this[r]}});String.prototype.endsWith||(String.prototype.endsWith=function(e,t){var r=this.toString();("number"!=typeof t||!isFinite(t)||Math.floor(t)!==t||t>r.length)&&(t=r.length);t-=e.length;var a=r.indexOf(e,t);return-1!==a&&a===t});