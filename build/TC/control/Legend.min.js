TC.control=TC.control||{};TC.control.MapContents||TC.syncLoadJS(TC.apiLocation+"TC/control/MapContents");TC.control.Legend=function(){TC.control.MapContents.apply(this,arguments)};TC.inherit(TC.control.Legend,TC.control.MapContents);!function(){var e=TC.control.Legend.prototype;e.CLASS="tc-ctl-legend";e.template={};e.template[e.CLASS]={1:function(e,n,t,l,r){var o,a=e.lookupProperty||function(e,n){if(Object.prototype.hasOwnProperty.call(e,n))return e[n]};return null!=(o=e.invokePartial(a(l,"tc-ctl-legend-node"),n,{name:"tc-ctl-legend-node",data:r,indent:"        ",helpers:t,partials:l,decorators:e.decorators}))?o:""},3:function(e,n,t,l,r){var o=e.lookupProperty||function(e,n){if(Object.prototype.hasOwnProperty.call(e,n))return e[n]};return'        <li class="tc-ctl-legend-empty">'+e.escapeExpression(o(t,"i18n").call(null!=n?n:e.nullContext||{},"noData",{name:"i18n",hash:{},data:r,loc:{start:{line:7,column:40},end:{line:7,column:57}}}))+"</li>\r\n"},compiler:[8,">= 4.3.0"],main:function(e,n,t,l,r){var o,a=null!=n?n:e.nullContext||{},i=e.lookupProperty||function(e,n){if(Object.prototype.hasOwnProperty.call(e,n))return e[n]};return"<h2>"+e.escapeExpression(i(t,"i18n").call(a,"legend",{name:"i18n",hash:{},data:r,loc:{start:{line:1,column:4},end:{line:1,column:21}}}))+'</h2>\r\n<div class="tc-ctl-legend-tree">\r\n    <ul class="tc-ctl-legend-branch">\r\n'+(null!=(o=i(t,"each").call(a,null!=n?i(n,"workLayers"):n,{name:"each",hash:{},fn:e.program(1,r,0),inverse:e.program(3,r,0),data:r,loc:{start:{line:4,column:8},end:{line:8,column:17}}}))?o:"")+"    </ul>\r\n</div>"},usePartial:!0,useData:!0};e.template[e.CLASS+"-node"]={1:function(e,n,t,l,r){var o,a=e.lookupProperty||function(e,n){if(Object.prototype.hasOwnProperty.call(e,n))return e[n]};return"    "+(null!=(o=e.lambda(null!=n?a(n,"customLegend"):n,n))?o:"")+"\r\n"},3:function(e,n,t,l,r){var o,a=null!=n?n:e.nullContext||{},i=e.lambda,c=e.escapeExpression,s=e.lookupProperty||function(e,n){if(Object.prototype.hasOwnProperty.call(e,n))return e[n]};return"    <li "+(null!=(o=s(t,"if").call(a,null!=n?s(n,"children"):n,{name:"if",hash:{},fn:e.program(4,r,0),inverse:e.program(6,r,0),data:r,loc:{start:{line:4,column:8},end:{line:4,column:112}}}))?o:"")+' data-layer-name="'+c(i(null!=n?s(n,"name"):n,n))+'" data-layer-uid="'+c(i(null!=n?s(n,"uid"):n,n))+'">\r\n        <div class="tc-ctl-legend-title">'+c(i(null!=n?s(n,"title"):n,n))+"</div>\r\n"+(null!=(o=s(t,"if").call(a,null!=n?s(n,"legend"):n,{name:"if",hash:{},fn:e.program(8,r,0),inverse:e.noop,data:r,loc:{start:{line:6,column:8},end:{line:17,column:15}}}))?o:"")+'        <ul class="tc-ctl-legend-branch">\r\n'+(null!=(o=s(t,"each").call(a,null!=n?s(n,"children"):n,{name:"each",hash:{},fn:e.program(18,r,0),inverse:e.noop,data:r,loc:{start:{line:19,column:12},end:{line:21,column:21}}}))?o:"")+"        </ul>\r\n    </li>\r\n"},4:function(e,n,t,l,r){return'class="tc-ctl-legend-node" '},6:function(e,n,t,l,r){return'class="tc-ctl-legend-node tc-ctl-legend-leaf" '},8:function(e,n,t,l,r){var o,a=null!=n?n:e.nullContext||{},i=e.lookupProperty||function(e,n){if(Object.prototype.hasOwnProperty.call(e,n))return e[n]};return'        <div class="tc-ctl-legend-watch">\r\n'+(null!=(o=i(t,"if").call(a,null!=(o=null!=n?i(n,"legend"):n)?i(o,"src"):o,{name:"if",hash:{},fn:e.program(9,r,0),inverse:e.program(14,r,0),data:r,loc:{start:{line:8,column:12},end:{line:14,column:19}}}))?o:"")+'        </div>\r\n        <div class="tc-ctl-legend-nvr">'+e.escapeExpression(i(t,"i18n").call(a,"notVisibleAtCurrentResolution",{name:"i18n",hash:{},data:r,loc:{start:{line:16,column:39},end:{line:16,column:79}}}))+"</div>\r\n"},9:function(e,n,t,l,r){var o,a=null!=n?n:e.nullContext||{},i=e.lookupProperty||function(e,n){if(Object.prototype.hasOwnProperty.call(e,n))return e[n]};return'            <img src="" data-img="'+e.escapeExpression(e.lambda(null!=(o=null!=n?i(n,"legend"):n)?i(o,"src"):o,n))+'" style="'+(null!=(o=i(t,"if").call(a,null!=(o=null!=n?i(n,"legend"):n)?i(o,"width"):o,{name:"if",hash:{},fn:e.program(10,r,0),inverse:e.noop,data:r,loc:{start:{line:9,column:57},end:{line:9,column:136}}}))?o:"")+(null!=(o=i(t,"if").call(a,null!=(o=null!=n?i(n,"legend"):n)?i(o,"scale"):o,{name:"if",hash:{},fn:e.program(12,r,0),inverse:e.noop,data:r,loc:{start:{line:9,column:136},end:{line:9,column:222}}}))?o:"")+'" />\r\n'},10:function(e,n,t,l,r){var o,a=e.lambda,i=e.escapeExpression,c=e.lookupProperty||function(e,n){if(Object.prototype.hasOwnProperty.call(e,n))return e[n]};return"width:"+i(a(null!=(o=null!=n?c(n,"legend"):n)?c(o,"width"):o,n))+"px;height:"+i(a(null!=(o=null!=n?c(n,"legend"):n)?c(o,"height"):o,n))+"px;"},12:function(e,n,t,l,r){var o,a=e.lookupProperty||function(e,n){if(Object.prototype.hasOwnProperty.call(e,n))return e[n]};return"transform:scale("+e.escapeExpression(e.lambda(null!=(o=null!=n?a(n,"legend"):n)?a(o,"scale"):o,n))+");transform-origin:0 50% 0;"},14:function(e,n,t,l,r){var o,a=e.lookupProperty||function(e,n){if(Object.prototype.hasOwnProperty.call(e,n))return e[n]};return null!=(o=a(t,"if").call(null!=n?n:e.nullContext||{},null!=(o=null!=n?a(n,"legend"):n)?a(o,"strokeColor"):o,{name:"if",hash:{},fn:e.program(15,r,0),inverse:e.noop,data:r,loc:{start:{line:11,column:16},end:{line:13,column:23}}}))?o:""},15:function(e,n,t,l,r){var o,a=e.lambda,i=e.escapeExpression,c=e.lookupProperty||function(e,n){if(Object.prototype.hasOwnProperty.call(e,n))return e[n]};return'                    <div class="tc-ctl-legend-img" style="border:solid '+i(a(null!=(o=null!=n?c(n,"legend"):n)?c(o,"strokeWidth"):o,n))+"px "+i(a(null!=(o=null!=n?c(n,"legend"):n)?c(o,"strokeColor"):o,n))+";background-color:"+i(a(null!=(o=null!=n?c(n,"legend"):n)?c(o,"fillColor"):o,n))+(null!=(o=c(t,"if").call(null!=n?n:e.nullContext||{},null!=(o=null!=n?c(n,"legend"):n)?c(o,"width"):o,{name:"if",hash:{},fn:e.program(16,r,0),inverse:e.noop,data:r,loc:{start:{line:12,column:156},end:{line:12,column:253}}}))?o:"")+'"></div>\r\n'},16:function(e,n,t,l,r){var o,a=e.lambda,i=e.escapeExpression,c=e.lookupProperty||function(e,n){if(Object.prototype.hasOwnProperty.call(e,n))return e[n]};return";width:"+i(a(null!=(o=null!=n?c(n,"legend"):n)?c(o,"width"):o,n))+"px;height:"+i(a(null!=(o=null!=n?c(n,"legend"):n)?c(o,"height"):o,n))+"px;border-radius:50%"},18:function(e,n,t,l,r){var o,a=e.lookupProperty||function(e,n){if(Object.prototype.hasOwnProperty.call(e,n))return e[n]};return null!=(o=e.invokePartial(a(l,"tc-ctl-legend-node"),n,{name:"tc-ctl-legend-node",data:r,indent:"                ",helpers:t,partials:l,decorators:e.decorators}))?o:""},compiler:[8,">= 4.3.0"],main:function(e,n,t,l,r){var o,a=e.lookupProperty||function(e,n){if(Object.prototype.hasOwnProperty.call(e,n))return e[n]};return null!=(o=a(t,"if").call(null!=n?n:e.nullContext||{},null!=n?a(n,"customLegend"):n,{name:"if",hash:{},fn:e.program(1,r,0),inverse:e.program(3,r,0),data:r,loc:{start:{line:1,column:0},end:{line:24,column:7}}}))?o:""},usePartial:!0,useData:!0};e.register=function(e){const n=this;e.on(TC.Consts.event.VIEWCHANGE,function(t){const l=t.view,r=n.loadGraphics.bind(n);l===TC.Consts.view.THREED?e.on(TC.Consts.event.LAYERADD,r):l===TC.Consts.view.DEFAULT&&e.off(TC.Consts.event.LAYERADD,r)});return TC.control.MapContents.prototype.register.call(n,e)};e.loadGraphics=function(){const e=this;e.getLayerUIElements().forEach(function(n){const t=e.map.getLayer(n.dataset.layerId);t&&n.querySelectorAll("li."+e.CLASS+"-node-visible").forEach(function(n){const l=n.querySelector("img");l&&void 0!==l.getAttribute("src")&&0===l.getAttribute("src").length&&e.styleLegendImage(l,t)})})};e.updateScale=function(){const e=this,n=e.CLASS+"-node-inscale",t=e.CLASS+"-node-outofscale";e.getLayerUIElements().forEach(function(l){const r=e.map.getLayer(l.dataset.layerId);if(r){let o=!1;const a=l.querySelectorAll("li");a.forEach(function(l){if(l.classList.contains(e.CLASS+"-node-visible")){const a=l.dataset.layerUid;if(r.isVisibleByScale(a)){o=!0;l.classList.remove(t);l.classList.add(n);const a=l.querySelector("img");a&&e.styleLegendImage(a,r)}else{l.classList.add(t);l.classList.remove(n)}}});o=o||!a.length;if(!a.length){const n=l.querySelector("img");n&&e.styleLegendImage(n)}l.classList.toggle(n,o);l.classList.toggle(t,!o)}})};e.update=function(){const e=this;e.getLayerUIElements().forEach(function(n){const t=e.map.getLayer(n.dataset.layerId);if(t){t.getTree();n.querySelectorAll("li").forEach(function(n){const l=n.dataset.layerUid;var r=e.CLASS+"-node-visible",o=e.CLASS+"-node-notvisible",a=e.CLASS+"-node-hasvisible";switch(t._cache.visibilityStates[l]){case TC.Consts.visibility.NOT_VISIBLE:n.classList.remove(r,a);n.classList.add(o);break;case TC.Consts.visibility.HAS_VISIBLE:n.classList.remove(r,o);n.classList.add(a);break;default:n.classList.remove(o,a);n.classList.add(r)}});e.updateLayerVisibility(t)}});e.updateScale()};e.updateLayerTree=function(e){var n=this;if(!e.isBase&&!e.options.stealth){if(e.hideTree||e.options.hideTree){e.tree=null;e.hideTree=e.options.hideTree=!1;e._cache.visibilityStates={}}TC.control.MapContents.prototype.updateLayerTree.call(n,e);n.div.querySelector("."+n.CLASS+"-empty").classList.add(TC.Consts.classes.HIDDEN);var t=n.layerTrees[e.id];e._title&&e._title!==e.title&&(t=Object.assign(t,{title:e._title}));n.getRenderedHtml(n.CLASS+"-node",t).then(function(t){const l=(new DOMParser).parseFromString(t,"text/html").body.firstChild,r=l.dataset.layerUid,o=n.div.querySelector("ul."+n.CLASS+"-branch"),a=o.querySelectorAll('li[data-layer-uid="'+r+'"]');if(1===a.length){const e=a[0];e.innerHTML=l.innerHTML;e.setAttribute("class",l.getAttribute("class"))}else{l.dataset.layerId=e.id;o.insertBefore(l,o.firstChild)}n.update()}).catch(function(e){TC.error(e)})}};e.removeLayer=function(e){e.isBase||TC.control.MapContents.prototype.removeLayer.call(this,e)};e.updateLayerVisibility=function(e){var n=this;n.getLayerUIElements().forEach(function(t){t.dataset.layerId===e.id&&t.classList.toggle(n.CLASS+"-node-notvisible",!e.getVisibility())})};e.getLayerUIElements=function(){return this.div.querySelector("ul."+this.CLASS+"-branch").querySelectorAll("li."+this.CLASS+"-node")}}();
//# sourceMappingURL=../maps/control/Legend.min.js.map