TC.control=TC.control||{};TC.control.ProjectionSelector||TC.syncLoadJS(TC.apiLocation+"TC/control/ProjectionSelector");!function(){TC.control.LayerCatalog=function(){this.layers=[];this.searchInit=!1;TC.control.ProjectionSelector.apply(this,arguments);this._selectors={LAYER_ROOT:"div."+this.CLASS+"-tree > ul."+this.CLASS+"-branch > li."+this.CLASS+"-node"};TC.Consts.classes.SELECTABLE||(TC.Consts.classes.SELECTABLE="tc-selectable");TC.Consts.classes.INCOMPATIBLE||(TC.Consts.classes.INCOMPATIBLE="tc-incompatible");TC.Consts.classes.ACTIVE||(TC.Consts.classes.ACTIVE="tc-active")};TC.inherit(TC.control.LayerCatalog,TC.control.ProjectionSelector);var e=TC.control.LayerCatalog.prototype;e.CLASS="tc-ctl-lcat";e.template={};e.template[e.CLASS]={1:function(e,t,n,l,a){var r,o=null!=t?t:e.nullContext||{},s=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return(null!=(r=s(n,"if").call(o,null!=t?s(t,"layerTrees"):t,{name:"if",hash:{},fn:e.program(2,a,0),inverse:e.noop,data:a,loc:{start:{line:4,column:8},end:{line:6,column:15}}}))?r:"")+(null!=(r=s(n,"if").call(o,null!=t?s(t,"layers"):t,{name:"if",hash:{},fn:e.program(2,a,0),inverse:e.noop,data:a,loc:{start:{line:7,column:8},end:{line:9,column:15}}}))?r:"")},2:function(e,t,n,l,a){var r=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'    <button class="tc-icon-btn tc-ctl-lcat-btn-search" title="'+e.escapeExpression(r(n,"i18n").call(null!=t?t:e.nullContext||{},"searchLayersByText",{name:"i18n",hash:{},data:a,loc:{start:{line:5,column:62},end:{line:5,column:91}}}))+'"></button>\r\n'},4:function(e,t,n,l,a){var r,o=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'    <ul class="tc-ctl-lcat-branch">\r\n'+(null!=(r=o(n,"each").call(null!=t?t:e.nullContext||{},null!=t?o(t,"layerTrees"):t,{name:"each",hash:{},fn:e.program(5,a,0),inverse:e.noop,data:a,loc:{start:{line:25,column:8},end:{line:27,column:17}}}))?r:"")+"    </ul>\r\n"},5:function(e,t,n,l,a){var r,o=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return null!=(r=e.invokePartial(o(l,"tc-ctl-lcat-branch"),t,{name:"tc-ctl-lcat-branch",data:a,indent:"            ",helpers:n,partials:l,decorators:e.decorators}))?r:""},7:function(e,t,n,l,a){var r,o=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return null!=(r=o(n,"if").call(null!=t?t:e.nullContext||{},null!=t?o(t,"layers"):t,{name:"if",hash:{},fn:e.program(8,a,0),inverse:e.program(11,a,0),data:a,loc:{start:{line:30,column:8},end:{line:40,column:15}}}))?r:""},8:function(e,t,n,l,a){var r,o=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'            <ul class="tc-ctl-lcat-branch">\r\n'+(null!=(r=o(n,"each").call(null!=t?t:e.nullContext||{},null!=t?o(t,"layers"):t,{name:"each",hash:{},fn:e.program(9,a,0),inverse:e.noop,data:a,loc:{start:{line:32,column:16},end:{line:34,column:25}}}))?r:"")+"            </ul>\r\n"},9:function(e,t,n,l,a){var r=e.lambda,o=e.escapeExpression,s=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'                    <li data-layer-id="'+o(r(null!=t?s(t,"id"):t,t))+'" title="'+o(s(n,"i18n").call(null!=t?t:e.nullContext||{},"loadingLayers",{name:"i18n",hash:{},data:a,loc:{start:{line:33,column:54},end:{line:33,column:78}}}))+'" class="tc-ctl-lcat-loading-node"> '+o(r(null!=t?s(t,"title"):t,t))+"</li>\r\n"},11:function(e,t,n,l,a){var r=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'            <div class="tc-ctl tc-ctl-lcat-loading">\r\n                <span>'+e.escapeExpression(r(n,"i18n").call(null!=t?t:e.nullContext||{},"loadingLayerTree",{name:"i18n",hash:{},data:a,loc:{start:{line:38,column:22},end:{line:38,column:49}}}))+"...</span>\r\n            </div>\r\n"},compiler:[8,">= 4.3.0"],main:function(e,t,n,l,a){var r,o=null!=t?t:e.nullContext||{},s=e.escapeExpression,c=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return"<h2>\r\n    "+s(c(n,"i18n").call(o,"availableLayers",{name:"i18n",hash:{},data:a,loc:{start:{line:2,column:4},end:{line:2,column:30}}}))+"\r\n"+(null!=(r=c(n,"if").call(o,null!=t?c(t,"enableSearch"):t,{name:"if",hash:{},fn:e.program(1,a,0),inverse:e.noop,data:a,loc:{start:{line:3,column:4},end:{line:10,column:11}}}))?r:"")+'</h2>\r\n\r\n\r\n<div class="tc-ctl-lcat-search tc-hidden tc-collapsed">\r\n    <div class="tc-group">\r\n        <input type="search" class="tc-ctl-lcat-input tc-textbox" placeholder="'+s(c(n,"i18n").call(o,"textToSearchInLayers",{name:"i18n",hash:{},data:a,loc:{start:{line:16,column:79},end:{line:16,column:110}}}))+'">\r\n    </div>\r\n    <ul></ul>\r\n\r\n</div>\r\n\r\n<div class="tc-ctl-lcat-tree">\r\n'+(null!=(r=c(n,"if").call(o,null!=t?c(t,"layerTrees"):t,{name:"if",hash:{},fn:e.program(4,a,0),inverse:e.program(7,a,0),data:a,loc:{start:{line:23,column:4},end:{line:41,column:11}}}))?r:"")+'</div>\r\n<div class="tc-ctl-lcat-info tc-hidden">\r\n'+(null!=(r=e.invokePartial(c(l,"tc-ctl-lcat-info"),t,{name:"tc-ctl-lcat-info",data:a,indent:"    ",helpers:n,partials:l,decorators:e.decorators}))?r:"")+"</div>"},usePartial:!0,useData:!0};e.template[e.CLASS+"-branch"]={1:function(e,t,n,l,a){var r,o=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'class="tc-ctl-lcat-node'+(null!=(r=o(n,"unless").call(null!=t?t:e.nullContext||{},null!=t?o(t,"expanded"):t,{name:"unless",hash:{},fn:e.program(2,a,0),inverse:e.noop,data:a,loc:{start:{line:1,column:43},end:{line:1,column:87}}}))?r:"")+'"'},2:function(e,t,n,l,a){return" tc-collapsed"},4:function(e,t,n,l,a){return'class="tc-ctl-lcat-node tc-ctl-lcat-leaf"'},6:function(e,t,n,l,a){var r,o=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return null!=(r=e.invokePartial(o(l,"tc-ctl-lcat-node"),t,{name:"tc-ctl-lcat-node",data:a,indent:"            ",helpers:n,partials:l,decorators:e.decorators}))?r:""},compiler:[8,">= 4.3.0"],main:function(e,t,n,l,a){var r,o=null!=t?t:e.nullContext||{},s=e.lambda,c=e.escapeExpression,i=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return"<li "+(null!=(r=i(n,"if").call(o,null!=t?i(t,"children"):t,{name:"if",hash:{},fn:e.program(1,a,0),inverse:e.program(4,a,0),data:a,loc:{start:{line:1,column:4},end:{line:1,column:144}}}))?r:"")+' data-layer-name="'+c(s(null!=t?i(t,"name"):t,t))+'" data-layer-uid="'+c(s(null!=t?i(t,"uid"):t,t))+'">\r\n    <button class="tc-ctl-lcat-collapse-btn"></button>\r\n    <span>'+c(s(null!=t?i(t,"title"):t,t))+'</span>\r\n    <ul class="tc-ctl-lcat-branch'+(null!=(r=i(n,"unless").call(o,null!=t?i(t,"expanded"):t,{name:"unless",hash:{},fn:e.program(2,a,0),inverse:e.noop,data:a,loc:{start:{line:4,column:33},end:{line:4,column:77}}}))?r:"")+'">\r\n'+(null!=(r=i(n,"each").call(o,null!=t?i(t,"children"):t,{name:"each",hash:{},fn:e.program(6,a,0),inverse:e.noop,data:a,loc:{start:{line:5,column:8},end:{line:7,column:17}}}))?r:"")+"    </ul>\r\n</li>"},usePartial:!0,useData:!0};e.template[e.CLASS+"-node"]={1:function(e,t,n,l,a){var r,o=null!=t?t:e.nullContext||{},s=e.lambda,c=e.escapeExpression,i=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return"<li "+(null!=(r=i(n,"if").call(o,null!=t?i(t,"children"):t,{name:"if",hash:{},fn:e.program(2,a,0),inverse:e.program(5,a,0),data:a,loc:{start:{line:2,column:4},end:{line:2,column:148}}}))?r:"")+' data-layer-name="'+c(s(null!=t?i(t,"name"):t,t))+'" data-layer-uid="'+c(s(null!=t?i(t,"uid"):t,t))+'">\r\n    '+(null!=(r=i(n,"if").call(o,null!=t?i(t,"children"):t,{name:"if",hash:{},fn:e.program(7,a,0),inverse:e.noop,data:a,loc:{start:{line:3,column:4},end:{line:3,column:77}}}))?r:"")+'\r\n    <span data-tooltip="'+(null!=(r=i(n,"if").call(o,null!=t?i(t,"name"):t,{name:"if",hash:{},fn:e.program(9,a,0),inverse:e.noop,data:a,loc:{start:{line:4,column:24},end:{line:4,column:69}}}))?r:"")+'">'+c(s(null!=t?i(t,"title"):t,t))+"</span>"+(null!=(r=i(n,"if").call(o,null!=t?i(t,"name"):t,{name:"if",hash:{},fn:e.program(11,a,0),inverse:e.program(13,a,0),data:a,loc:{start:{line:4,column:87},end:{line:13,column:11}}}))?r:"")+'    <ul class="tc-ctl-lcat-branch'+(null!=(r=i(n,"unless").call(o,null!=t?i(t,"expanded"):t,{name:"unless",hash:{},fn:e.program(3,a,0),inverse:e.noop,data:a,loc:{start:{line:14,column:33},end:{line:14,column:77}}}))?r:"")+'">\r\n'+(null!=(r=i(n,"each").call(o,null!=t?i(t,"children"):t,{name:"each",hash:{},fn:e.program(19,a,0),inverse:e.noop,data:a,loc:{start:{line:15,column:8},end:{line:17,column:17}}}))?r:"")+"    </ul>\r\n</li>\r\n"},2:function(e,t,n,l,a){var r,o=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return' class="tc-ctl-lcat-node'+(null!=(r=o(n,"unless").call(null!=t?t:e.nullContext||{},null!=t?o(t,"expanded"):t,{name:"unless",hash:{},fn:e.program(3,a,0),inverse:e.noop,data:a,loc:{start:{line:2,column:44},end:{line:2,column:88}}}))?r:"")+'" '},3:function(e,t,n,l,a){return" tc-collapsed"},5:function(e,t,n,l,a){return' class="tc-ctl-lcat-node tc-ctl-lcat-leaf" '},7:function(e,t,n,l,a){return'<button class="tc-ctl-lcat-collapse-btn"></button>'},9:function(e,t,n,l,a){var r=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return e.escapeExpression(r(n,"i18n").call(null!=t?t:e.nullContext||{},"clickToAddToMap",{name:"i18n",hash:{},data:a,loc:{start:{line:4,column:36},end:{line:4,column:62}}}))},11:function(e,t,n,l,a){var r=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<button title="'+e.escapeExpression(r(n,"i18n").call(null!=t?t:e.nullContext||{},"infoFromThisLayer",{name:"i18n",hash:{},data:a,loc:{start:{line:4,column:114},end:{line:4,column:142}}}))+'" class="tc-ctl-lcat-btn-info"></button>\r\n'},13:function(e,t,n,l,a){var r,o=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return null!=(r=o(n,"if").call(null!=t?t:e.nullContext||{},null!=t?o(t,"abstract"):t,{name:"if",hash:{},fn:e.program(14,a,0),inverse:e.program(16,a,0),data:a,loc:{start:{line:6,column:8},end:{line:12,column:15}}}))?r:""},14:function(e,t,n,l,a){var r=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'            <button title="'+e.escapeExpression(r(n,"i18n").call(null!=t?t:e.nullContext||{},"infoFromThisLayer",{name:"i18n",hash:{},data:a,loc:{start:{line:7,column:27},end:{line:7,column:55}}}))+'" class="tc-ctl-lcat-btn-info"></button>\r\n'},16:function(e,t,n,l,a){var r,o=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return null!=(r=o(n,"if").call(null!=t?t:e.nullContext||{},null!=t?o(t,"metadata"):t,{name:"if",hash:{},fn:e.program(17,a,0),inverse:e.noop,data:a,loc:{start:{line:9,column:12},end:{line:11,column:19}}}))?r:""},17:function(e,t,n,l,a){var r=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'                <button title="'+e.escapeExpression(r(n,"i18n").call(null!=t?t:e.nullContext||{},"infoFromThisLayer",{name:"i18n",hash:{},data:a,loc:{start:{line:10,column:31},end:{line:10,column:59}}}))+'" class="tc-ctl-lcat-btn-info"></button>\r\n'},19:function(e,t,n,l,a){var r,o=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return null!=(r=e.invokePartial(o(l,"tc-ctl-lcat-node"),t,{name:"tc-ctl-lcat-node",data:a,indent:"        ",helpers:n,partials:l,decorators:e.decorators}))?r:""},compiler:[8,">= 4.3.0"],main:function(e,t,n,l,a){var r,o=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return null!=(r=o(n,"if").call(null!=t?t:e.nullContext||{},null!=t?o(t,"isVisible"):t,{name:"if",hash:{},fn:e.program(1,a,0),inverse:e.noop,data:a,loc:{start:{line:1,column:0},end:{line:20,column:7}}}))?r:""},usePartial:!0,useData:!0};e.template[e.CLASS+"-info"]={1:function(e,t,n,l,a){var r,o=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div class="tc-ctl-lcat-abstract">\r\n    <h4>'+e.escapeExpression(o(n,"i18n").call(null!=t?t:e.nullContext||{},"abstract",{name:"i18n",hash:{},data:a,loc:{start:{line:6,column:8},end:{line:6,column:27}}}))+"</h4>\r\n    <div><pre>"+(null!=(r=e.lambda(null!=t?o(t,"abstract"):t,t))?r:"")+"</pre></div>\r\n</div>\r\n"},3:function(e,t,n,l,a){var r,o=null!=t?t:e.nullContext||{},s=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div class="tc-ctl-lcat-metadata">\r\n    <h4>'+e.escapeExpression(s(n,"i18n").call(o,"metadata",{name:"i18n",hash:{},data:a,loc:{start:{line:12,column:8},end:{line:12,column:27}}}))+"</h4>\r\n    <ul>\r\n"+(null!=(r=s(n,"each").call(o,null!=t?s(t,"metadata"):t,{name:"each",hash:{},fn:e.program(4,a,0),inverse:e.noop,data:a,loc:{start:{line:14,column:8},end:{line:16,column:17}}}))?r:"")+"    </ul>\r\n</div>\r\n"},4:function(e,t,n,l,a){var r,o=e.lambda,s=e.escapeExpression,c=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'        <li><a href="'+(null!=(r=o(null!=t?c(t,"url"):t,t))?r:"")+'" type="'+s(o(null!=t?c(t,"format"):t,t))+'" title="'+s(o(null!=t?c(t,"formatDescription"):t,t))+'" target="_blank">'+(null!=(r=o(null!=t?c(t,"formatDescription"):t,t))?r:"")+"</a></li>\r\n"},compiler:[8,">= 4.3.0"],main:function(e,t,n,l,a){var r,o=null!=t?t:e.nullContext||{},s=e.escapeExpression,c=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<a class="tc-ctl-lcat-info-close"></a>\r\n<h2>'+s(c(n,"i18n").call(o,"layerInfo",{name:"i18n",hash:{},data:a,loc:{start:{line:2,column:4},end:{line:2,column:24}}}))+'</h2>\r\n<h3 class="tc-ctl-lcat-title">'+s(e.lambda(null!=t?c(t,"title"):t,t))+"</h3>\r\n"+(null!=(r=c(n,"if").call(o,null!=t?c(t,"abstract"):t,{name:"if",hash:{},fn:e.program(1,a,0),inverse:e.noop,data:a,loc:{start:{line:4,column:0},end:{line:9,column:7}}}))?r:"")+(null!=(r=c(n,"if").call(o,null!=t?c(t,"metadata"):t,{name:"if",hash:{},fn:e.program(3,a,0),inverse:e.noop,data:a,loc:{start:{line:10,column:0},end:{line:19,column:7}}}))?r:"")},useData:!0};e.template[e.CLASS+"-results"]={1:function(e,t,n,l,a,r,o){var s,c=null!=t?t:e.nullContext||{},i=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return(null!=(s=i(n,"if").call(c,i(n,"gt").call(c,null!=o[1]?i(o[1],"servicesLooked"):o[1],1,{name:"gt",hash:{},data:a,loc:{start:{line:2,column:10},end:{line:2,column:34}}}),{name:"if",hash:{},fn:e.program(2,a,0,r,o),inverse:e.noop,data:a,loc:{start:{line:2,column:4},end:{line:5,column:11}}}))?s:"")+(null!=(s=i(n,"each").call(c,null!=t?i(t,"founds"):t,{name:"each",hash:{},fn:e.program(5,a,0,r,o),inverse:e.noop,data:a,loc:{start:{line:6,column:8},end:{line:11,column:14}}}))?s:"")+(null!=(s=i(n,"if").call(c,i(n,"gt").call(c,null!=o[1]?i(o[1],"servicesLooked"):o[1],1,{name:"gt",hash:{},data:a,loc:{start:{line:12,column:10},end:{line:12,column:34}}}),{name:"if",hash:{},fn:e.program(12,a,0,r,o),inverse:e.noop,data:a,loc:{start:{line:12,column:4},end:{line:14,column:11}}}))?s:"")},2:function(e,t,n,l,a){var r,o=e.lambda,s=e.escapeExpression,c=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<li class="tc-ctl-lcat-search-group '+(null!=(r=c(n,"if").call(null!=t?t:e.nullContext||{},null!=(r=null!=t?c(t,"service"):t)?c(r,"isCollapsed"):r,{name:"if",hash:{},fn:e.program(3,a,0),inverse:e.noop,data:a,loc:{start:{line:3,column:36},end:{line:3,column:82}}}))?r:"")+'" data-service-id="'+s(o(null!=(r=null!=t?c(t,"service"):t)?c(r,"id"):r,t))+'">\r\n    <h5>'+s(o(null!=(r=null!=t?c(t,"service"):t)?c(r,"title"):r,t))+"</h5><ul>\r\n"},3:function(e,t,n,l,a){return"tc-collapsed"},5:function(e,t,n,l,a){var r,o=e.lambda,s=e.escapeExpression,c=null!=t?t:e.nullContext||{},i=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'        <li data-layer-name="'+s(o(null!=t?i(t,"Name"):t,t))+'" '+(null!=(r=i(n,"if").call(c,null!=t?i(t,"alreadyAdded"):t,{name:"if",hash:{},fn:e.program(6,a,0),inverse:e.noop,data:a,loc:{start:{line:7,column:39},end:{line:7,column:85}}}))?r:"")+'>\r\n        <h5 class="tc-selectable"'+(null!=(r=i(n,"if").call(c,null!=t?i(t,"alreadyAdded"):t,{name:"if",hash:{},fn:e.program(8,a,0),inverse:e.program(10,a,0),data:a,loc:{start:{line:8,column:33},end:{line:8,column:154}}}))?r:"")+">"+s(o(null!=t?i(t,"Title"):t,t))+'</h5>\r\n        <button class="tc-ctl-lcat-search-btn-info" title="'+s(i(n,"i18n").call(c,"infoFromThisLayer",{name:"i18n",hash:{},data:a,loc:{start:{line:9,column:59},end:{line:9,column:87}}}))+'"></button>\r\n        </li>\r\n'},6:function(e,t,n,l,a){return' class="tc-checked"'},8:function(e,t,n,l,a){var r=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return' data-tooltip="'+e.escapeExpression(r(n,"i18n").call(null!=t?t:e.nullContext||{},"layerAlreadyAdded",{name:"i18n",hash:{},data:a,loc:{start:{line:8,column:68},end:{line:8,column:96}}}))+'"'},10:function(e,t,n,l,a){var r=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return' data-tooltip="'+e.escapeExpression(r(n,"i18n").call(null!=t?t:e.nullContext||{},"clickToAddToMap",{name:"i18n",hash:{},data:a,loc:{start:{line:8,column:120},end:{line:8,column:146}}}))+'"'},12:function(e,t,n,l,a){return"</ul></li>\r\n"},14:function(e,t,n,l,a){var r=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<li class="tc-ctl-lcat-no-results"><h5>'+e.escapeExpression(r(n,"i18n").call(null!=t?t:e.nullContext||{},"noMatches",{name:"i18n",hash:{},data:a,loc:{start:{line:16,column:39},end:{line:16,column:59}}}))+"</h5></li>\r\n"},compiler:[8,">= 4.3.0"],main:function(e,t,n,l,a,r,o){var s,c=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return null!=(s=c(n,"each").call(null!=t?t:e.nullContext||{},null!=t?c(t,"servicesFound"):t,{name:"each",hash:{},fn:e.program(1,a,0,r,o),inverse:e.program(14,a,0,r,o),data:a,loc:{start:{line:1,column:0},end:{line:17,column:9}}}))?s:""},useData:!0,useDepths:!0};e.template[e.CLASS+"-dialog"]={compiler:[8,">= 4.3.0"],main:function(e,t,n,l,a){var r=null!=t?t:e.nullContext||{},o=e.escapeExpression,s=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div class="tc-ctl-lcat-crs-dialog tc-modal">\r\n    <div class="tc-modal-background tc-modal-close"></div>\r\n    <div class="tc-modal-window">\r\n        <div class="tc-modal-header">\r\n            <h3>'+o(s(n,"i18n").call(r,"changeCRS",{name:"i18n",hash:{},data:a,loc:{start:{line:5,column:16},end:{line:5,column:36}}}))+'</h3>\r\n            <div class="tc-modal-close"></div>\r\n        </div>\r\n        <div class="tc-modal-body">\r\n            <p>'+o(s(n,"i18n").call(r,"wmsLayerNotCompatible.instructions",{name:"i18n",hash:{},data:a,loc:{start:{line:9,column:15},end:{line:9,column:60}}}))+'</p>\r\n            <ul class="tc-ctl-lcat-crs-list tc-crs-list"></ul>\r\n        </div>\r\n        <div class="tc-modal-footer">\r\n            <button type="button" class="tc-button tc-modal-close">'+o(s(n,"i18n").call(r,"close",{name:"i18n",hash:{},data:a,loc:{start:{line:13,column:67},end:{line:13,column:83}}}))+"</button>\r\n        </div>\r\n    </div>\r\n</div>\r\n"},useData:!0};const t=function(e,t){e.showProjectionChangeDialog({layer:t,closeCallback:function(){e.getLayerNodes(t).forEach(function(t){t.classList.remove(TC.Consts.classes.LOADING);t.querySelector("span").dataset.tooltip=e.getLocaleString("clickToAddToMap")})}})};e.register=function(e){const t=this,n=TC.control.ProjectionSelector.prototype.register.call(t,e),r=function(e,n){if(Array.isArray(t.options.layers)){for(var l=0;l<t.options.layers.length;l++){var a=t.options.layers[l];if(!a.type||a.type===TC.Consts.layerType.WMS){a.id||(a.id=TC.getUID());TC.Util.isPlainObject(a)&&(a=new TC.layer.Raster(a));t.layers.push(a)}}t.render(function(){e()})}else e()};t._readyPromise=new Promise(function(t,n){const l=function(n){if(n.layer===e.baseLayer){r(t);e.off(TC.Consts.event.LAYERUPDATE,l)}};e.loaded(function(){e.baseLayer.state&&e.baseLayer.state!==TC.Layer.state.IDLE?e.on(TC.Consts.event.LAYERUPDATE,l):r(t)})});var o=t.getLocaleString("clickToAddToMap");e.on(TC.Consts.event.BEFORELAYERADD+" "+TC.Consts.event.BEFOREUPDATEPARAMS,function(e){t.getLayerNodes(e.layer).forEach(function(e){e.classList.add(TC.Consts.classes.LOADING);delete e.querySelector("span").dataset.tooltip})}).on(TC.Consts.event.LAYERADD+" "+TC.Consts.event.UPDATEPARAMS,function(e){const n=e.layer;n.isBase||n.type!==TC.Consts.layerType.WMS||t.loaded().then(function(){if(t.getLayerRootNode(n))a.call(t,n);else{for(var e=!1,l=0,r=t.layers.length;l<r;l++){var o=t.layers[l];if(o.type===n.type&&o.options.url===n.options.url){e=!0;break}}if(e){t.layersToSetChecked||(t.layersToSetChecked=[]);t.layersToSetChecked.push(n)}else t.addLayer(new TC.layer.Raster({url:n.options.url,type:n.type,layerNames:[],title:n.title||n.wrap.getServiceTitle(),hideTitle:!0,hideTree:!1})).then(function(){a.call(t,n)})}})}).on(TC.Consts.event.LAYERERROR,function(e){const n=e.reason;if(t.layers.some(t=>t==e.layer)){n&&TC.alert(t.getLocaleString(n,{url:e.layer.url}));t.getLayerNodes(e.layer).forEach(function(e){e.classList.remove(TC.Consts.classes.LOADING)})}}).on(TC.Consts.event.LAYERREMOVE,function(e){const n=e.layer;t.getLayerNodes(n).forEach(function(e){e.classList.remove(TC.Consts.classes.CHECKED);e.querySelector("span").dataset.tooltip=o});(function(e){const n=[];if(!e.isBase){var l=e.options.url;t.list&&t.list.querySelectorAll("li").forEach(function(a){const r=t.getLayer(a.dataset.layerId);if(r&&r.type===e.type&&r.options.url===l)for(var o=0;o<e.names.length;o++)if(a.dataset.layerName===e.names[o]){n.push(a);break}})}return n})(n).forEach(function(e){e.classList.remove(TC.Consts.classes.CHECKED);e.querySelector("h5").dataset.tooltip=o});!function(e){var n=t.map.getControlsByClass(TC.control.WorkLayerManager)[0];if(n)for(var l=n.layers,a=0;a<l.length;a++){var r=l[a];r!==e&&t.getLayerNodes(r).forEach(function(e){e.classList.add(TC.Consts.classes.CHECKED);e.querySelector("span").dataset.tooltip=t.getLocaleString("layerAlreadyAdded")})}}(n);l.call(t)}).on(TC.Consts.event.EXTERNALSERVICEADDED,function(e){if(e&&e.layer){t.addLayer(e.layer);t.div.classList.remove(TC.Consts.classes.COLLAPSED)}}).on(TC.Consts.event.PROJECTIONCHANGE,function(e){t.update()});return n};const n=function(e){e.target.blur();e.stopPropagation();const t=e.target.parentElement;if("LI"===t.tagName&&!t.classList.contains(self.CLASS+"-leaf")){t.classList.toggle(TC.Consts.classes.COLLAPSED);t.querySelector("ul").classList.toggle(TC.Consts.classes.COLLAPSED)}},l=function(){const e=this;if("createEvent"in document){var t=document.createEvent("HTMLEvents");t.initEvent("keyup",!1,!0);e.textInput&&e.textInput.dispatchEvent(t)}else e.textInput&&e.textInput.fireEvent("keyup")},a=function(e){const t=this;t.getLayerNodes(e).forEach(function(e){e.classList.remove(TC.Consts.classes.LOADING);e.classList.add(TC.Consts.classes.CHECKED);e.querySelector("span").dataset.tooltip=t.getLocaleString("layerAlreadyAdded")});l.call(t)},r=function(e,t){const l=this;e.querySelectorAll("li > button."+l.CLASS+"-collapse-btn").forEach(function(e){e.addEventListener("click",n)});e.querySelectorAll("span").forEach(function(e){e.addEventListener("click",function(e){!function(e,t){const n=e.target.parentNode;if(!n.classList.contains(TC.Consts.classes.LOADING)&&!n.classList.contains(TC.Consts.classes.CHECKED)){e.preventDefault;var l,a=n.dataset.layerName;a=void 0!==a?a.toString():"";for(var r=0,o=t._roots.length;r<o;r++){const e=t._roots[r];if(e.contains(n)){l=t.getLayer(e.dataset.layerId);break}}l||(l=t.getLayer(n.dataset.layerId));if(l&&a){var s=1;/iPad/i.test(navigator.userAgent)?s=10:TC.Util.detectFirefox()&&(s=250);l.title||(l.title=l.getTree().title);n.classList.add(TC.Consts.classes.LOADING);n.querySelector("span").dataset.tooltip="";(c=n,new Promise(function(e,t){setTimeout(function(){c.offsetHeight=c.offsetHeight;c.offsetWidth=c.offsetWidth;e()},s)})).then(function(){t.addLayerToMap(l,a)});e.stopPropagation()}}var c}(e,l)})});l._roots=l.div.querySelectorAll(l._selectors.LAYER_ROOT);e.dataset.layerId=t.id;e.querySelectorAll("."+l.CLASS+"-btn-info").forEach(function(e){const n=e.parentElement.querySelector("span"),a=e.parentElement.dataset.layerName;if(a){n.classList.add(TC.Consts.classes.SELECTABLE);var r=t.getInfo(a);r.hasOwnProperty("abstract")||r.hasOwnProperty("legend")||r.hasOwnProperty("metadata")?e.addEventListener(TC.Consts.event.CLICK,function(e){e.stopPropagation();this.classList.toggle(TC.Consts.classes.CHECKED)?l.showLayerInfo(t,a):l.hideLayerInfo()},{passive:!0}):e.parentElement.removeChild(e);if(t.compatibleLayers&&t.compatibleLayers.indexOf(a)<0){n.classList.add(TC.Consts.classes.INCOMPATIBLE);n.setAttribute("title",l.getLocaleString("reprojectionNeeded"))}if(l.map)for(var o=0,s=l.map.workLayers.length;o<s;o++){var c=l.map.workLayers[o];if(c.type===TC.Consts.layerType.WMS&&c.url===t.url&&1===c.names.length&&c.names[0]===a){n.parentElement.classList.add(TC.Consts.classes.CHECKED);n.dataset.tooltip=l.getLocaleString("layerAlreadyAdded")}}}else e.addEventListener(TC.Consts.event.CLICK,function(e){e.stopPropagation();this.classList.toggle(TC.Consts.classes.CHECKED)?l.showLayerInfo(t,a,n.innerText):l.hideLayerInfo()},{passive:!0})});(function(){const e=this;e.layersToSetChecked&&e.layersToSetChecked.length>0&&e.layersToSetChecked.forEach(function(t,n,l){if(e.getLayerRootNode(t)){a.call(e,t);l.splice(n,1)}})}).call(l);l.getRenderedHtml(l.CLASS+"-dialog",null,function(e){l._dialogDiv.innerHTML=e})};e.renderBranch=function(e,t,n){const l=this;l.sourceLayers.unshift(e);e.getCapabilitiesPromise().then(function(e){l.getRenderedHtml(l.CLASS+"-branch",function(e){var t=e.getTree();const n=function(t,l){if(e.options.expandedNodeLevel>l){t.expanded=!0;for(var a=0;a<t.children.length;a++)n(t.children[a],l+1)}};!function t(n){for(var l=!1,a=0;a<n.children.length;a++)t(n.children[a])&&(l=!0);n.hasOwnProperty("isVisible")&&(n.isVisible=!e.names||!e.names.length||l||n.isVisible);return n.isVisible}(t);n(t,0);return t}(this),function(e){var a=document.createElement("template");a.innerHTML=e;const o=l.div.querySelector("."+l.CLASS+"-branch");var s=a.content?a.content.firstChild:a.firstChild,c=o.querySelector("li."+l.CLASS+'-loading-node[data-layer-id="'+this.id+'"]');c?o.replaceChild(s,c):o.insertAdjacentElement("afterbegin",s);r.call(l,s,this);1===o.childElementCount&&n();TC.Util.isFunction(t)&&t(l.sourceLayers[l.sourceLayers.map(function(e){return e&&e.id}).indexOf(this.id)])}.bind(this))}.bind(e)).catch(function(e){var t=l.layers.map(function(e){return e.id}).indexOf(this.id);l.layers.splice(t,1);var n=l.getLocaleString("lyrCtlg.errorLoadingNode",{serviceName:this.title}),a=l.div.querySelector("."+l.CLASS+"-branch").querySelector("li."+l.CLASS+'-loading-node[data-layer-id="'+this.id+'"]');a.classList.add("error");a.setAttribute("title",n);l.map.toast(n,{type:TC.Consts.msgType.ERROR})}.bind(e))};e.render=function(e){const n=this;n.sourceLayers=[];return n._set1stRenderPromise(new Promise(function(l,a){0===n.layers.length?n.renderData({layerTrees:[],enableSearch:!1},function(){TC.Util.isFunction(e)&&e();l()}):n.renderData({layers:n.layers,enableSearch:!0},function(){(function(){const e=this;e.textInput=e.div.querySelector("."+e.CLASS+"-input");e.list=e.div.querySelector("."+e.CLASS+"-search ul");e.textInput.addEventListener("mouseup",function(t){""!==e.textInput.value&&setTimeout(function(){""===e.textInput.value&&(e.list.innerHTML="")},1)});var n=[];TC._search=TC._search||{};TC._search.retryTimeout=null;TC.loadJS(!TC.UI||!TC.UI.autocomplete,[TC.apiLocation+"TC/ui/autocomplete.js"],function(){TC.UI.autocomplete.call(e.textInput,{link:"#",target:e.list,minLength:0,source:function(t,l){n=[];e._roots.forEach(function(e){e.querySelectorAll("li."+TC.Consts.classes.CHECKED).forEach(function(e){n.push(e.dataset.layerName)})});if((t=t.trim()).length<3)e.list.innerHTML="";else if(t.length>=3){TC._search.retryTimeout&&clearTimeout(TC._search.retryTimeout);TC._search.retryTimeout=setTimeout(function(){for(var n=[],a=0,r=e.sourceLayers.length;a<r;a++){const l=e.sourceLayers[a];var o=l.searchSubLayers(t);o.length&&n.push({service:{id:l.id,title:l.title||l.id},founds:o})}l({servicesFound:n,servicesLooked:e.sourceLayers.length})},TC._search.interval)}},callback:function(t){e.textInput.value=t.target.text||t.target.innerText;TC._search.lastPattern=e.textInput.value;e.goToResult(unescape(t.target.hash).substring(1));TC.UI.autocomplete.call(e.textInput,"clear")},buildHTML:function(t){var l=this.target;if(t.results&&t.results.servicesFound.length>0)for(var a=e.map.getLayerTree().workLayers,r=0;r<t.results.servicesFound.length;r++){for(var o=t.results.servicesFound[r].founds,s=0;s<o.length;s++){delete o[s].alreadyAdded;for(var c=0;c<a.length;c++)if(n.indexOf(o[s].Name)>=0){o[s].alreadyAdded=!0;break}if(!o[s].Name){o.splice(s,1);s--}}t.results.servicesFound[r].founds.length?e.div.querySelectorAll(".tc-ctl-lcat-search-group")[r]&&(t.results.servicesFound[r].service.isCollapsed=e.div.querySelectorAll(".tc-ctl-lcat-search-group")[r].classList.contains(TC.Consts.classes.COLLAPSED)):t.results.servicesFound.splice(r,1)}var i="";e.getRenderedHtml(e.CLASS+"-results",t.results).then(function(e){l.innerHTML=i=e});return i}})});if(!e.searchInit){e.div.querySelector("h2 button").addEventListener(TC.Consts.event.CLICK,function(t){t.target.blur();e.div.classList.remove(TC.Consts.classes.COLLAPSED);t.stopPropagation();const n=e.div.querySelector("."+e.CLASS+"-search"),l=e.div.querySelector("."+e.CLASS+"-tree"),a=e.div.querySelector("."+e.CLASS+"-info"),r=n.classList.contains(TC.Consts.classes.HIDDEN);n.classList.toggle(TC.Consts.classes.HIDDEN,!r);l.classList.toggle(TC.Consts.classes.HIDDEN,r);t.target.classList.toggle(e.CLASS+"-btn-tree",r);t.target.classList.toggle(e.CLASS+"-btn-search",!r);if(r){e.textInput.focus();t.target.setAttribute("title",e.getLocaleString("viewAvailableLayersTree"));0===e.div.querySelectorAll(".tc-ctl-lcat-search li button.tc-checked").length&&a.classList.add(TC.Consts.classes.HIDDEN)}else{t.target.setAttribute("title",e.getLocaleString("searchLayersByText"));e.div.querySelectorAll(".tc-ctl-lcat-tree li button.tc-checked").length>0&&a.classList.remove(TC.Consts.classes.HIDDEN)}},{passive:!0});e.div.addEventListener("click",TC.EventTarget.listenerBySelector("."+e.CLASS+"-search button."+e.CLASS+"-search-btn-info",function(t){t.stopPropagation();const n=t.target;if(n.classList.contains(TC.Consts.classes.CHECKED)){n.classList.remove(TC.Consts.classes.CHECKED);e.hideLayerInfo()}else{const t=n.parentElement;var l=t;do{l=l.parentElement}while(l&&"LI"!==l.tagName);e.showLayerInfo(e.layers.length>1?e.layers.filter(e=>e.id===l.dataset.serviceId)[0]:e.layers[0],t.dataset.layerName);n.classList.add(TC.Consts.classes.CHECKED)}}));const n="."+e.CLASS+"-search li";e.div.addEventListener("click",TC.EventTarget.listenerBySelector(n,function(l){l.stopPropagation();for(var a=l.target;a&&!a.matches(n);)a=a.parentElement;if(!a.classList.contains(e.CLASS+"-no-results"))if(a.classList.contains(e.CLASS+"-search-group"))a.classList.toggle(TC.Consts.classes.COLLAPSED);else{var r=a.dataset.layerName;if(r&&0!==(r=r.toString()).trim().length&&!a.classList.contains(TC.Consts.classes.CHECKED)){var o=a;do{o=o.parentElement}while(o&&!o.matches("li."+e.CLASS+"-search-group"));const n=o?e.layers.filter(e=>e.id===o.dataset.serviceId)[0]:e.layers[0],l=n.options.url,s=n.title,c=new TC.layer.Raster({id:e.getUID(),url:l,title:s,hideTitle:n.hideTitle||n.options.hideTitle,hideTree:!1,layerNames:[r]});if(c.isCompatible(e.map.crs)){e.map.addLayer(c,function(e){a.dataset.layerId=e.id;e.wrap.$events.on(TC.Consts.event.TILELOADERROR,function(e){var t=this.parent;401!==e.error.code&&403!==e.error.code||t.map.toast(e.error.text,{type:TC.Consts.msgType.ERROR});t.map.removeLayer(t)})});a.classList.add(TC.Consts.classes.CHECKED);a.querySelector("h5").dataset.tooltip=e.getLocaleString("layerAlreadyAdded")}else t(e,c)}}}));e.searchInit=!0}}).call(n);n.layers.forEach(function(t){n.renderBranch(t,e,l)})})}))};e.getLayerRootNode=function(e){const t=this;var n=null;if(!e.isBase){var l=e.options.url;t._roots&&t._roots.forEach(function(a){const r=t.getLayer(a.dataset.layerId);r&&r.type===e.type&&r.options.url===l&&(n=a)})}return n};e.getLayerNodes=function(e){const t=[],n=this.getLayerRootNode(e);if(n)for(var l=0;l<e.names.length;l++){const a=n.querySelector('li[data-layer-name="'+e.names[l]+'"]');if(a){t.push(a);a.querySelectorAll("li").forEach(function(e){t.push(e)})}}return t};e.showLayerInfo=function(e,t,n){const l=this;var a=null,r=l.div.querySelector("."+l.CLASS+"-info");const o=function(e,t){var n=!1;if(t){n=!0;r.dataset.layerName=e;r.classList.remove(TC.Consts.classes.HIDDEN);l.getRenderedHtml(l.CLASS+"-info",t).then(function(e){r.innerHTML=e;r.querySelector("."+l.CLASS+"-info-close").addEventListener(TC.Consts.event.CLICK,function(){l.hideLayerInfo()},{passive:!0})}).catch(function(e){TC.error(e)})}return n};l.div.querySelectorAll("."+l.CLASS+"-btn-info, ."+l.CLASS+"-search-btn-info").forEach(function(e){e.classList.remove(TC.Consts.classes.CHECKED)});for(var s=function(e,t){if(e.Title===t)return{title:t,abstract:e.Abstract,metadata:e.MetadataURL?e.MetadataURL.reduce(function(e,t){e.push({format:t.Format,formatDescription:TC.Util.getLocaleString(l.map.options.locale,TC.Util.getSimpleMimeType(t.Format))||TC.Util.getLocaleString(l.map.options.locale,"viewMetadata"),type:t.type,url:t.OnlineResource});return e},[]):null};if(e.Layer)for(var n=0;n<e.Layer.length;n++){const l=s(e.Layer[n],t);if(l)return l}},c=0,i=l._roots.length;c<i;c++){const r=l._roots[c];if(r.dataset.layerId===e.id){const c=r.querySelectorAll("."+l.CLASS+"-btn-info");for(var u=0,d=c.length;u<d;u++){const r=c[u];var p=r.parentElement.dataset.layerName;if(t&&p===t){const n=e.getInfo(t);l.div.querySelector('li [data-layer-name="'+p+'"] > button.'+l.CLASS+"-btn-info").classList.toggle(TC.Consts.classes.CHECKED,o(p,n));a=n;break}const i=r.parentElement.querySelector("span").innerText;if(!t&&n&&i===n){const t=s(e.capabilities.Capability.Layer,n);r.classList.toggle(TC.Consts.classes.CHECKED,o(i,t));a=t;break}}break}}return a};e.update=function(){const e=this;e.sourceLayers.forEach(function(t){t.getCapabilitiesPromise().then(function(){t.compatibleLayers=t.wrap.getCompatibleLayers(e.map.crs);const n=e.getLayerRootNode(t);n&&n.querySelectorAll("li[data-layer-name]").forEach(function(n){const l=n.dataset.layerName,a=n.querySelector("span."+TC.Consts.classes.SELECTABLE);if(t.compatibleLayers.indexOf(l)<0){a.classList.add(TC.Consts.classes.INCOMPATIBLE);a.setAttribute("title",e.getLocaleString("reprojectionNeeded"))}else{a.classList.remove(TC.Consts.classes.INCOMPATIBLE);a.removeAttribute("title")}})})})};e.hideLayerInfo=function(){this.div.querySelectorAll("."+this.CLASS+"-btn-info, ."+this.CLASS+"-search-btn-info").forEach(function(e){e.classList.remove(TC.Consts.classes.CHECKED)});this.div.querySelector("."+this.CLASS+"-info").classList.add(TC.Consts.classes.HIDDEN)};e.addLayer=function(e){const t=this;return new Promise(function(n,l){var a=[];t.options.layers&&t.options.layers.length&&(a=t.options.layers.filter(function(t){var n=TC.Util.reqGetMapOnCapabilities(t.url);return n&&n.replace(TC.Util.regex.PROTOCOL)==e.url.replace(TC.Util.regex.PROTOCOL)}));0==a.length&&(a=t.layers.filter(function(t){return t.url.replace(TC.Util.regex.PROTOCOL)==e.url.replace(TC.Util.regex.PROTOCOL)}));if(0==a.length){t.layers.unshift(e);e.getCapabilitiesPromise().then(function(){e.compatibleLayers=e.wrap.getCompatibleLayers(t.map.crs);e.title=e.title||e.wrap.getServiceTitle();t.renderBranch(e,function(){n()})})}else n()})};e.getLayer=function(e){const t=this;for(var n=0,l=t.layers.length;n<l;n++){const l=t.layers[n];if(l.id===e){var a=t.options.layers.filter(t=>t.id===e);a.length>0?l.hideTitle=l.options.hideTitle=a[0].hideTitle:l.hideTitle=l.options.hideTitle=!1;return l}}return null};e.addLayerToMap=function(e,n){const l=this,a=TC.Util.extend({},e.options);a.id=l.getUID();a.layerNames=[n];a.title=e.title;const r=new TC.layer.Raster(a);r.isCompatible(l.map.crs)?l.map.addLayer(a):t(l,r)};e.loaded=function(){return this._readyPromise};e.getAvailableCRS=function(e){e=e||{};return this.map.getCompatibleCRS({layers:this.map.workLayers.concat(this.map.baseLayer,e.layer),includeFallbacks:!0})};e.setProjection=function(e){const t=this;e=e||{};TC.loadProjDef({crs:e.crs,callback:function(){t.map.setProjection(e).then(function(){t._layerToAdd&&t.map.addLayer(t._layerToAdd);TC.Util.closeModal()})}})};e.showProjectionChangeDialog=function(e){this._layerToAdd=e.layer;TC.control.ProjectionSelector.prototype.showProjectionChangeDialog.call(this,e)}}();
//# sourceMappingURL=../maps/control/LayerCatalog.min.js.map