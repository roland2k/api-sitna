TC.control=TC.control||{};TC.control.MapContents||TC.syncLoadJS(TC.apiLocation+"TC/control/MapContents");TC.control.TOC=function(){TC.control.MapContents.apply(this,arguments)};TC.inherit(TC.control.TOC,TC.control.MapContents);!function(){var t=TC.control.TOC.prototype;t.CLASS="tc-ctl-toc";t.template={};t.template[t.CLASS]={1:function(t,e,n,l,a){var r,c=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(r=t.invokePartial(c(l,"tc-ctl-toc-wlbranch"),e,{name:"tc-ctl-toc-wlbranch",data:a,indent:"        ",helpers:n,partials:l,decorators:t.decorators}))?r:""},compiler:[8,">= 4.3.0"],main:function(t,e,n,l,a){var r,c=null!=e?e:t.nullContext||{},o=t.escapeExpression,i=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"<h2>"+o(i(n,"i18n").call(c,"worklayers",{name:"i18n",hash:{},data:a,loc:{start:{line:1,column:4},end:{line:1,column:25}}}))+'</h2>\r\n<div class="tc-ctl-toc-tree">\r\n    <div class="tc-ctl-toc-empty">'+o(i(n,"i18n").call(c,"noData",{name:"i18n",hash:{},data:a,loc:{start:{line:3,column:34},end:{line:3,column:51}}}))+'</div>\r\n    <ul class="tc-ctl-toc-branch tc-ctl-toc-wl">\r\n'+(null!=(r=i(n,"each").call(c,null!=e?i(e,"workLayers"):e,{name:"each",hash:{},fn:t.program(1,a,0),inverse:t.noop,data:a,loc:{start:{line:5,column:8},end:{line:7,column:17}}}))?r:"")+"    </ul>\r\n</div>"},usePartial:!0,useData:!0};t.template[t.CLASS+"-branch"]={1:function(t,e,n,l,a){return'class="tc-ctl-toc-node"'},3:function(t,e,n,l,a){return'class="tc-ctl-toc-node tc-ctl-toc-leaf"'},5:function(t,e,n,l,a){return" checked"},7:function(t,e,n,l,a){var r,c=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(r=t.invokePartial(c(l,"tc-ctl-toc-node"),e,{name:"tc-ctl-toc-node",data:a,indent:"            ",helpers:n,partials:l,decorators:t.decorators}))?r:""},compiler:[8,">= 4.3.0"],main:function(t,e,n,l,a){var r,c=null!=e?e:t.nullContext||{},o=t.lambda,i=t.escapeExpression,s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"<li "+(null!=(r=s(n,"if").call(c,null!=e?s(e,"children"):e,{name:"if",hash:{},fn:t.program(1,a,0),inverse:t.program(3,a,0),data:a,loc:{start:{line:1,column:4},end:{line:1,column:97}}}))?r:"")+' data-layer-name="'+i(o(null!=e?s(e,"name"):e,e))+'" data-layer-uid="'+i(o(null!=e?s(e,"uid"):e,e))+'">\r\n    <button class="tc-ctl-toc-collapse-btn"></button>\r\n    <input type="checkbox" class="tc-ctl-toc-branch-cb" name="toc" value="'+i(o(null!=e?s(e,"name"):e,e))+'"'+(null!=(r=s(n,"if").call(c,null!=e?s(e,"isVisible"):e,{name:"if",hash:{},fn:t.program(5,a,0),inverse:t.noop,data:a,loc:{start:{line:3,column:83},end:{line:3,column:115}}}))?r:"")+" /><span>"+i(o(null!=e?s(e,"title"):e,e))+'</span>\r\n    <ul class="tc-ctl-toc-branch">\r\n'+(null!=(r=s(n,"each").call(c,null!=e?s(e,"children"):e,{name:"each",hash:{},fn:t.program(7,a,0),inverse:t.noop,data:a,loc:{start:{line:5,column:8},end:{line:7,column:17}}}))?r:"")+"    </ul>\r\n</li>"},usePartial:!0,useData:!0};t.template[t.CLASS+"-node"]={1:function(t,e,n,l,a){return'class="tc-ctl-toc-node"'},3:function(t,e,n,l,a){return'class="tc-ctl-toc-node tc-ctl-toc-leaf"'},5:function(t,e,n,l,a){return'<button class="tc-ctl-toc-collapse-btn"></button>'},7:function(t,e,n,l,a){return" checked"},9:function(t,e,n,l,a){var r,c=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(r=t.invokePartial(c(l,"tc-ctl-toc-node"),e,{name:"tc-ctl-toc-node",data:a,indent:"            ",helpers:n,partials:l,decorators:t.decorators}))?r:""},compiler:[8,">= 4.3.0"],main:function(t,e,n,l,a){var r,c=null!=e?e:t.nullContext||{},o=t.lambda,i=t.escapeExpression,s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"<li "+(null!=(r=s(n,"if").call(c,null!=e?s(e,"children"):e,{name:"if",hash:{},fn:t.program(1,a,0),inverse:t.program(3,a,0),data:a,loc:{start:{line:1,column:4},end:{line:1,column:97}}}))?r:"")+' data-layer-name="'+i(o(null!=e?s(e,"name"):e,e))+'" data-layer-uid="'+i(o(null!=e?s(e,"uid"):e,e))+'">\r\n    '+(null!=(r=s(n,"if").call(c,null!=e?s(e,"children"):e,{name:"if",hash:{},fn:t.program(5,a,0),inverse:t.noop,data:a,loc:{start:{line:2,column:4},end:{line:2,column:76}}}))?r:"")+'\r\n    <input type="checkbox" name="toc" value="'+i(o(null!=e?s(e,"name"):e,e))+'"'+(null!=(r=s(n,"if").call(c,null!=e?s(e,"isVisible"):e,{name:"if",hash:{},fn:t.program(7,a,0),inverse:t.noop,data:a,loc:{start:{line:3,column:54},end:{line:3,column:86}}}))?r:"")+" /><span>"+i(o(null!=e?s(e,"title"):e,e))+'</span>\r\n    <ul class="tc-ctl-toc-branch">\r\n'+(null!=(r=s(n,"each").call(c,null!=e?s(e,"children"):e,{name:"each",hash:{},fn:t.program(9,a,0),inverse:t.noop,data:a,loc:{start:{line:5,column:8},end:{line:7,column:17}}}))?r:"")+"    </ul>\r\n</li>"},usePartial:!0,useData:!0};t.register=function(t){const e=this,n=TC.control.MapContents.prototype.register.call(e,t);t.on(TC.Consts.event.EXTERNALSERVICEADDED,function(t){e.onExternalServiceAdded(t)});return n};t.onExternalServiceAdded=function(t){const e=this;if(t&&t.layer){t.layer.map=e.map;e.map.addLayer(t.layer).then(function(n){e.updateLayerTree(t.layer)})}};t.addUIEventListeners=function(){const t=this;t.div.addEventListener("click",TC.EventTarget.listenerBySelector("input[type=checkbox]",function(e){const n=e.target;for(var l=n;l&&!l.matches("ul."+t.CLASS+"-wl");)l=l.parentElement;const a=[];for(var r=0,c=l.children.length;r<c;r++){child=l.children[r];"LI"===child.tagName&&a.push(child)}for(r=0,c=a.length;r<c;r++){const e=a[r];if(e.contains(n)){const l=t.map.getLayer(e.dataset.layerId);var o=n;do{o=o.parentElement}while(o&&"LI"!==o.tagName);const a=o.dataset.layerUid;l.setNodeVisibility(a,n.checked);break}}e.stopPropagation()}));t.div.addEventListener(TC.Consts.event.MOUSEUP,TC.EventTarget.listenerBySelector("button."+t.CLASS+"-collapse-btn",function(e){e.target.blur();const n=e.target.parentElement;if(!n.classList.contains(t.CLASS+"-leaf")){n.classList.toggle(TC.Consts.classes.COLLAPSED);n.querySelector("ul").classList.toggle(TC.Consts.classes.COLLAPSED);e.stopPropagation()}}))};t.update=function(){var t=this,e=function(t){for(var e=0,n=t.children.length;e<n;e++){const n=t.children[e];if(n.matches("input[type=checkbox]"))return n}return null};t.getLayerUIElements().forEach(function(n){const l=t.map.getLayer(n.dataset.layerId);if(l){e(n).checked=l.getVisibility();l.tree=null;n.querySelectorAll("li").forEach(function(t){const n=e(t),a=t.dataset.layerUid;switch(l.getNodeVisibility(a)){case TC.Consts.visibility.VISIBLE:case TC.Consts.visibility.NOT_VISIBLE_AT_RESOLUTION:n.checked=!0;n.indeterminate=!1;break;case TC.Consts.visibility.HAS_VISIBLE:n.checked=!1;n.indeterminate=!0;break;default:n.checked=!1;n.indeterminate=!1}})}});t.updateScale()};t.updateScale=function(){const t=this;t.getLayerUIElements().forEach(function(e){const n=t.map.getLayer(e.dataset.layerId);e.querySelectorAll("li").forEach(function(e){const l=e.dataset.layerUid;e.classList.toggle(t.CLASS+"-node-notvisible",!n.isVisibleByScale(l))})})};t.updateLayerTree=function(t){var e=this;if(!t.isBase&&!t.options.stealth){TC.control.MapContents.prototype.updateLayerTree.call(e,t);e.div.querySelector("."+e.CLASS+"-empty").classList.add(TC.Consts.classes.HIDDEN);e.getRenderedHtml(e.CLASS+"-branch",e.layerTrees[t.id]).then(function(n){const l=(new DOMParser).parseFromString(n,"text/html").body.firstChild,a=l.dataset.layerUid,r=e.div.querySelector("."+e.CLASS+'-wl li[data-layer-uid="'+a+'"]');if(r){r.innerHTML=l.innerHTML;r.setAttribute("class",l.getAttribute("class"));r.dataset.layerId||(r.dataset.layerId=t.id)}else{l.dataset.layerId=t.id;const n=e.div.querySelector("."+e.CLASS+"-wl");n.insertBefore(l,n.firstChild)}var c="ul."+e.CLASS+"-wl",o="ul."+e.CLASS+"-branch",i="li."+e.CLASS+"-node",s="li."+e.CLASS+"-leaf";e.div.querySelectorAll(c+" "+o+" "+o+","+c+" "+o+" "+i).forEach(function(t){t.matches(s)||t.classList.add(TC.Consts.classes.COLLAPSED)});e.update()}).catch(function(t){TC.error(t)})}};t.removeLayer=function(t){t.isBase||TC.control.MapContents.prototype.removeLayer.call(this,t)};t.updateLayerVisibility=function(t){var e=this;e.getLayerUIElements().forEach(function(n){if(n.dataset.layerId===t.id){var l=!t.getVisibility();n.querySelectorAll("input[type=checkbox]").forEach(function(t){t.matches("."+e.CLASS+"-branch-cb")?t.checked=!l:t.disabled=l})}})};t.updateLayerOrder=function(t,e,n){};t.render=function(t){const e=this;return TC.Control.prototype.render.call(e,function(){var n=e.options.controls||[];if(n.length>0){var l=n[0],a=document.createElement("div");e.div.appendChild(a);e.map.addControl(l.name,TC.Util.extend({div:a},l.options))}TC.Util.isFunction(t)&&t()})};t.getLayerUIElements=function(){const t=[],e=this.div.querySelector("ul."+this.CLASS+"-wl").children;for(var n=0,l=e.length;n<l;n++){child=e[n];"LI"===child.tagName&&t.push(child)}return t}}();
//# sourceMappingURL=../maps/control/TOC.min.js.map