TC.control=TC.control||{};TC.control.MapContents||TC.syncLoadJS(TC.apiLocation+"TC/control/MapContents");!function(){TC.control.BasemapSelector=function(){var e=this;TC.control.MapContents.apply(e,arguments);e.layerInfos={};e._cssClasses={LOAD_CRS_BUTTON:e.CLASS+"-crs-btn-load",CRS_DIALOG:e.CLASS+"-crs-dialog",CRS_LIST:e.CLASS+"-crs-list",VIEW_BTN:e.CLASS+"-btn-view",CURRENT_CRS_NAME:e.CLASS+"-cur-crs-name",CURRENT_CRS_CODE:e.CLASS+"-cur-crs-code",TREE:e.CLASS+"-tree",DETAILS:"tc-details",GRID:"tc-grid"};e._dialogDiv=TC.Util.getDiv(e.options.dialogDiv);window.$&&(e._$dialogDiv=$(e._dialogDiv));e.options.dialogDiv||document.body.appendChild(e._dialogDiv);e._dialogDiv.addEventListener(TC.Consts.event.CLICK,TC.EventTarget.listenerBySelector("button:not(.tc-modal-close)",function(t){if(t.target.classList.contains(e._cssClasses.LOAD_CRS_BUTTON)){e.loadFallbackProjections();return}TC.Util.closeModal();const a=t.target,n=a.dataset.crsCode,l=e._dialogDiv.querySelector("."+e.CLASS+"-crs-dialog");l.classList.add(TC.Consts.classes.HIDDEN);const s=e.getLayer(l.dataset.layerId);if(s)if(n)TC.loadProjDef({crs:n,callback:function(){e.map.setProjection({crs:n,baseLayer:s})}});else{const t=e.getFallbackLayer(a.dataset.fallbackLayerId);t&&e.map.setBaseLayer(t)}}),{passive:!0})};TC.inherit(TC.control.BasemapSelector,TC.control.MapContents);var e=TC.control.BasemapSelector.prototype;e.CLASS="tc-ctl-bms";e.template={};e.template[e.CLASS]={1:function(e,t,a,n,l,s,o){var r,i=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return null!=(r=e.invokePartial(i(n,"tc-ctl-bms-node"),t,{name:"tc-ctl-bms-node",hash:{controlId:null!=o[1]?i(o[1],"controlId"):o[1]},data:l,indent:"        ",helpers:a,partials:n,decorators:e.decorators}))?r:""},3:function(e,t,a,n,l){var s=null!=t?t:e.nullContext||{},o=e.escapeExpression,r=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'        <li class="tc-ctl-bms-node"><label class="tc-ctl-bms-more-node" title="'+o(r(a,"i18n").call(s,"moreBackgroundMaps",{name:"i18n",hash:{},data:l,loc:{start:{line:8,column:79},end:{line:8,column:108}}}))+'"><input type="radio" name="'+o(e.lambda(null!=t?r(t,"controlId"):t,t))+'-bm" value="moreLayers"><span></span></label>\r\n        <div class="tc-ctl-bms-info">\r\n            <h3>'+o(r(a,"i18n").call(s,"moreBackgroundMaps",{name:"i18n",hash:{},data:l,loc:{start:{line:10,column:16},end:{line:10,column:45}}}))+"</h3>\r\n        </div></li>\r\n"},compiler:[8,">= 4.3.0"],main:function(e,t,a,n,l,s,o){var r,i=null!=t?t:e.nullContext||{},c=e.escapeExpression,u=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return"<h2>"+c(u(a,"i18n").call(i,"backgroundMaps",{name:"i18n",hash:{},data:l,loc:{start:{line:1,column:4},end:{line:1,column:29}}}))+' <button class="tc-icon-btn tc-ctl-bms-btn-view tc-details" title="'+c(u(a,"i18n").call(i,"showDetailsView",{name:"i18n",hash:{},data:l,loc:{start:{line:1,column:96},end:{line:1,column:122}}}))+'"></button></h2>\r\n<div class="tc-ctl-bms-tree tc-grid">\r\n    <ul class="tc-ctl-bms-branch">\r\n'+(null!=(r=u(a,"each").call(i,null!=t?u(t,"baseLayers"):t,{name:"each",hash:{},fn:e.program(1,l,0,s,o),inverse:e.noop,data:l,loc:{start:{line:4,column:8},end:{line:6,column:17}}}))?r:"")+(null!=(r=u(a,"if").call(i,null!=t?u(t,"dialogMore"):t,{name:"if",hash:{},fn:e.program(3,l,0,s,o),inverse:e.noop,data:l,loc:{start:{line:7,column:8},end:{line:12,column:15}}}))?r:"")+"    </ul>\r\n</div>"},usePartial:!0,useData:!0,useDepths:!0};e.template[e.CLASS+"-node"]={1:function(e,t,a,n,l){var s,o=e.lambda,r=e.escapeExpression,i=null!=t?t:e.nullContext||{},c=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<li class="tc-ctl-bms-node" data-layer-name="'+r(o(null!=(s=null!=t?c(t,"layer"):t)?c(s,"name"):s,t))+'" data-layer-id="'+r(o(null!=(s=null!=t?c(t,"layer"):t)?c(s,"id"):s,t))+'" data-layer-uid="'+r(o(null!=(s=null!=t?c(t,"layer"):t)?c(s,"uid"):s,t))+'"><label'+(null!=(s=c(a,"if").call(i,null!=(s=null!=t?c(t,"layer"):t)?c(s,"legend"):s,{name:"if",hash:{},fn:e.program(2,l,0),inverse:e.noop,data:l,loc:{start:{line:2,column:127},end:{line:2,column:207}}}))?s:"")+(null!=(s=c(a,"if").call(i,null!=(s=null!=t?c(t,"layer"):t)?c(s,"thumbnail"):s,{name:"if",hash:{},fn:e.program(4,l,0),inverse:e.noop,data:l,loc:{start:{line:2,column:207},end:{line:2,column:289}}}))?s:"")+'>\r\n<input type="radio" name="'+r(o(null!=t?c(t,"controlId"):t,t))+'-bm" value="'+r(o(null!=(s=null!=t?c(t,"layer"):t)?c(s,"name"):s,t))+'"'+(null!=(s=c(a,"if").call(i,null!=(s=null!=t?c(t,"layer"):t)?c(s,"mustReproject"):s,{name:"if",hash:{},fn:e.program(6,l,0),inverse:e.noop,data:l,loc:{start:{line:3,column:66},end:{line:3,column:121}}}))?s:"")+">\r\n<span>"+r(o(null!=(s=null!=t?c(t,"layer"):t)?c(s,"title"):s,t))+'</span></label>\r\n<div class="tc-ctl-bms-info">\r\n    <h3>'+r(o(null!=(s=null!=t?c(t,"layer"):t)?c(s,"title"):s,t))+"</h3>\r\n"+(null!=(s=c(a,"if").call(i,null!=t?c(t,"info"):t,{name:"if",hash:{},fn:e.program(8,l,0),inverse:e.noop,data:l,loc:{start:{line:7,column:4},end:{line:19,column:11}}}))?s:"")+"</div>\r\n</li>\r\n"},2:function(e,t,a,n,l){var s,o=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return' style="background-image: url('+e.escapeExpression(e.lambda(null!=(s=null!=(s=null!=t?o(t,"layer"):t)?o(s,"legend"):s)?o(s,"src"):s,t))+')"'},4:function(e,t,a,n,l){var s,o=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return' style="background-image: url('+e.escapeExpression(e.lambda(null!=(s=null!=t?o(t,"layer"):t)?o(s,"thumbnail"):s,t))+')"'},6:function(e,t,a,n,l){return' class="tc-disabled"'},8:function(e,t,a,n,l){var s,o=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return"        <p>"+e.escapeExpression(e.lambda(null!=(s=null!=t?o(t,"info"):t)?o(s,"abstract"):s,t))+"</p>\r\n"+(null!=(s=o(a,"if").call(null!=t?t:e.nullContext||{},null!=(s=null!=t?o(t,"info"):t)?o(s,"metadata"):s,{name:"if",hash:{},fn:e.program(9,l,0),inverse:e.noop,data:l,loc:{start:{line:9,column:8},end:{line:18,column:15}}}))?s:"")},9:function(e,t,a,n,l){var s,o=null!=t?t:e.nullContext||{},r=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'        <div class="tc-ctl-bms-metadata">\r\n            <h4>'+e.escapeExpression(r(a,"i18n").call(o,"metadata",{name:"i18n",hash:{},data:l,loc:{start:{line:11,column:16},end:{line:11,column:35}}}))+"</h4>\r\n            <ul>\r\n"+(null!=(s=r(a,"each").call(o,null!=(s=null!=t?r(t,"info"):t)?r(s,"metadata"):s,{name:"each",hash:{},fn:e.program(10,l,0),inverse:e.noop,data:l,loc:{start:{line:13,column:12},end:{line:15,column:21}}}))?s:"")+"        </ul>\r\n        </div>\r\n"},10:function(e,t,a,n,l){var s,o=e.lambda,r=e.escapeExpression,i=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'                <li><a href="'+(null!=(s=o(null!=t?i(t,"url"):t,t))?s:"")+'" type="'+r(o(null!=t?i(t,"format"):t,t))+'" title="'+r(o(null!=t?i(t,"formatDescription"):t,t))+'" target="_blank">'+r(o(null!=t?i(t,"formatDescription"):t,t))+"</a></li>\r\n"},12:function(e,t,a,n,l){return'<li class="tc-ctl-bms-node"><label class="tc-loading"></label></li>\r\n'},compiler:[8,">= 4.3.0"],main:function(e,t,a,n,l){var s,o=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return null!=(s=o(a,"if").call(null!=t?t:e.nullContext||{},null!=t?o(t,"layer"):t,{name:"if",hash:{},fn:e.program(1,l,0),inverse:e.program(12,l,0),data:l,loc:{start:{line:1,column:0},end:{line:24,column:7}}}))?s:""},useData:!0};e.template[e.CLASS+"-dialog"]={compiler:[8,">= 4.3.0"],main:function(e,t,a,n,l){var s=null!=t?t:e.nullContext||{},o=e.escapeExpression,r=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<div class="tc-ctl-bms-more-dialog tc-modal tc-hidden">\r\n    <div class="tc-modal-background tc-modal-close"></div>\r\n    <div class="tc-modal-window">\r\n        <div class="tc-modal-header">\r\n            <h3>'+o(r(a,"i18n").call(s,"backgroundMaps",{name:"i18n",hash:{},data:l,loc:{start:{line:5,column:16},end:{line:5,column:41}}}))+'</h3>\r\n            <button class="tc-icon-btn tc-ctl-bms-btn-view tc-details" title="'+o(r(a,"i18n").call(s,"showDetailsView",{name:"i18n",hash:{},data:l,loc:{start:{line:6,column:78},end:{line:6,column:104}}}))+'"></button>\r\n            <div class="tc-modal-close"></div>\r\n        </div>\r\n        <div class="tc-modal-body">\r\n        </div>\r\n        <div class="tc-modal-footer">\r\n            <button type="button" class="tc-button tc-modal-close">'+o(r(a,"i18n").call(s,"close",{name:"i18n",hash:{},data:l,loc:{start:{line:12,column:67},end:{line:12,column:83}}}))+'</button>\r\n        </div>\r\n    </div>\r\n</div>\r\n<div class="tc-ctl-bms-crs-dialog tc-modal tc-hidden">\r\n    <div class="tc-modal-background tc-modal-close"></div>\r\n    <div class="tc-modal-window">\r\n        <div class="tc-modal-header">\r\n            <h3>'+o(r(a,"i18n").call(s,"baseLayerNotCompatible",{name:"i18n",hash:{},data:l,loc:{start:{line:20,column:16},end:{line:20,column:49}}}))+'</h3>\r\n            <div class="tc-modal-close"></div>\r\n        </div>\r\n        <div class="tc-modal-body">\r\n            <p>'+o(r(a,"i18n").call(s,"baseLayerNotCompatible.instructions",{name:"i18n",hash:{},data:l,loc:{start:{line:24,column:15},end:{line:24,column:61}}}))+'</p>\r\n            <ul class="tc-ctl-bms-crs-list tc-crs-list"></ul>\r\n        </div>\r\n        <div class="tc-modal-footer">\r\n            <button type="button" class="tc-button tc-modal-close">'+o(r(a,"i18n").call(s,"close",{name:"i18n",hash:{},data:l,loc:{start:{line:28,column:67},end:{line:28,column:83}}}))+"</button>\r\n        </div>\r\n    </div>\r\n</div>\r\n\r\n"},useData:!0};const t=function(e,t){for(;e&&!e.matches(t);)e=e.parentElement;return e},a=function(e,a){const n=this;var l=!0,s=e.target,o=n.getLayer(t(s,"li").dataset.layerId);if(n.options.dialogMore&&t(s,"."+n.CLASS+"-more-dialog")){const e=n.div.querySelectorAll("input[type=radio]");for(var r=0,i=e.length;r<i;r++){const a=n.getLayer(t(e[r],"li").dataset.layerId);if(a)switch(!0){case a.id===o.id:o=a}}}if(o!=n.map.getBaseLayer())if(o.mustReproject)if(n.map.on3DView){if(!o.getFallbackLayer()){n._currentSelection.checked=!0;e.stopPropagation();return}if(o.getFallbackLayer()){const e=o.getFallbackLayer();e&&e._capabilitiesPromise.then(function(){e.isCompatible(n.map.getCRS())&&n.map.setBaseLayer(o)});l=!0}}else{n._currentSelection&&(n._currentSelection.checked=!0);const e={layer:o},t=o.getFallbackLayer();t?t._capabilitiesPromise.then(function(){t.isCompatible(n.map.getCRS())&&(e.fallbackLayer=t);n.showProjectionChangeDialog(e)}):n.showProjectionChangeDialog(e);l=!1}else{(o.type===TC.Consts.layerType.WMS||o.type===TC.Consts.layerType.WMTS&&o.getProjection()!==n.map.crs)&&o.setProjection({crs:n.map.crs});n.map.setBaseLayer(o)}this._currentSelection&&(this._currentSelection.checked=!0);a&&a(l)};e.register=function(e){const t=this;return new Promise(function(n,l){TC.control.MapContents.prototype.register.call(t,e).then(function(l){t.div.querySelector(`.${t._cssClasses.VIEW_BTN}`).addEventListener(TC.Consts.event.CLICK,function(e){t.toggleView();e.target.blur();t.div.classList.remove(TC.Consts.classes.COLLAPSED);e.stopPropagation()},{passive:!0});t.options.dialogMore&&e.on(TC.Consts.event.VIEWCHANGE,function(){t._getMoreBaseLayers()});e.on(TC.Consts.event.BASELAYERCHANGE+" "+TC.Consts.event.PROJECTIONCHANGE+" "+TC.Consts.event.VIEWCHANGE,function(e){t.update(t.div,e.layer)});t.div.addEventListener("change",TC.EventTarget.listenerBySelector("input[type=radio]",function(e){"moreLayers"===e.target.value?t.showMoreLayersDialog():a.call(t,e);e.stopPropagation()}));n(l)})})};e.render=function(e){const t=this,n=TC.control.MapContents.prototype.render.call(t,e,TC.Util.extend({},t.options,{controlId:t.id}));t.getRenderedHtml(t.CLASS+"-dialog",null,function(e){t._dialogDiv.innerHTML=e;if(t.options.dialogMore){const e=t._dialogDiv.querySelector("."+t.CLASS+"-more-dialog");e.querySelector(`.${t._cssClasses.VIEW_BTN}`).addEventListener(TC.Consts.event.CLICK,function(e){t.toggleMoreLayersDialogView();e.target.blur();e.stopPropagation()},{passive:!0});e.addEventListener("change",TC.EventTarget.listenerBySelector("input[type=radio]",function(e){a.call(t,e,function(e){e&&TC.Util.closeModal()});e.stopPropagation()}))}});return n};e.update=async function(e,t){const a=this;e=e||a.div;await(a._moreBaseLayersPromise||a._getMoreBaseLayers());Array.from(e.querySelectorAll(`ul.${a.CLASS}-branch li`)).forEach(function(e,n,l){const s=a.getLayer(e.dataset.layerId);if(s){const n=t||a.map.baseLayer,o=e.querySelector("input[type=radio]"),r=s.getFallbackLayer&&s.getFallbackLayer();let i=n&&(n===s||n.id===s.id);if(!i){const t=r&&l.filter(t=>t!==e).some(e=>e.dataset.layerId===r.id);i=!t&&n&&(n===r||r&&n.id===r.id)}if(a.map.on3DView&&s.mustReproject&&r)r.getCapabilitiesPromise().then(function(){var t=!s.getFallbackLayer().isCompatible(a.map.getCRS());o.checked=i;if(t){o.classList.add(TC.Consts.classes.DISABLED);e.setAttribute("title",a.map.on3DView?a.getLocaleString("notAvailableTo3D"):a.getLocaleString("reprojectionNeeded"))}else{o.classList.remove(TC.Consts.classes.DISABLED);e.removeAttribute("title")}});else{o.checked=i;if(s.mustReproject){o.classList.add(TC.Consts.classes.DISABLED);e.setAttribute("title",a.map.on3DView?a.getLocaleString("notAvailableTo3D"):a.getLocaleString("reprojectionNeeded"))}else{o.classList.remove(TC.Consts.classes.DISABLED);e.removeAttribute("title")}}i&&(a._currentSelection=o)}});a.updateScale()};e.updateLayerTree=function(e){const t=this;if(e.isBase&&(!e.options.stealth||e.firstOption&&!e.firstOption.options.stealth)){TC.control.MapContents.prototype.updateLayerTree.call(t,e);const a=e.firstOption||e;a!==e&&(t.layerTrees[a.id]=a.getTree());a.getInfo&&(t.layerInfos[a.id]=a.getInfo(a.names[0]));t.getRenderedHtml(t.CLASS+"-node",{layer:t.layerTrees[a.id],info:t.layerInfos[a.id],controlId:t.id}).then(function(e){const n=(new DOMParser).parseFromString(e,"text/html").body.firstChild;var l=n.dataset.layerUid;const s=t.div.querySelector("."+t.CLASS+"-branch"),o=s.querySelector('li[data-layer-uid="'+l+'"]');if(o)o.innerHTML=n.innerHTML;else{n.dataset.layerId=a.id;const e=t.map.baseLayers.map(e=>e.firstOption||e).filter(e=>e&&!e.stealth).map(e=>e.id),l=e.indexOf(a.id);let o=!1;for(let t=l-1;t>=0;t--){const a=s.querySelector(`li[data-layer-id="${e[t]}"]`);if(a){a.insertAdjacentElement("afterend",n);o=!0;break}}if(!o){for(let t=l+1,a=e.length;t<a;t++){const a=s.querySelector(`li[data-layer-id="${e[t]}"]`);if(a){a.insertAdjacentElement("beforebegin",n);o=!0;break}}if(!o){const e=s.querySelector(`.${t.CLASS}-more-node`);e?e.parentElement.insertAdjacentElement("beforebegin",n):s.appendChild(n)}}t.update()}}).catch(function(e){TC.error(e)})}};e.updateLayerOrder=function(e,t,a){};e.removeLayer=function(e){const t=this;if(e.isBase){const l=t.div.querySelector("."+t.CLASS+"-branch").querySelectorAll("li");for(var a=0,n=l.length;a<n;a++){const t=l[a];if(t.dataset.layerId===e.id){t.parentElement.removeChild(t);break}}}};e.onErrorLayer=function(e){const t=this;e.isBase&&!e.options.stealth&&t.map.toast(t.getLocaleString("baseLayerNotAvailable",{mapName:e.title}),{type:TC.Consts.msgType.ERROR})};e.getFallbackLayer=function(e){const t=this,a=function(t){return t.fallbackLayer&&t.fallbackLayer.id===e};let n=t.map.baseLayers.filter(a),l=n.length?n[0].fallbackLayer:null;!l&&t._moreBaseLayers&&(l=(n=t._moreBaseLayers.filter(a)).length?n[0].fallbackLayer:null);return l};e.loadFallbackProjections=function(){const e=this;e._dialogDiv.querySelector("."+e._cssClasses.CRS_DIALOG).querySelectorAll("ul."+e._cssClasses.CRS_LIST+" li").forEach(function(t){t.classList.remove(TC.Consts.classes.HIDDEN);t.querySelector("button."+e._cssClasses.LOAD_CRS_BUTTON)&&t.classList.add(TC.Consts.classes.HIDDEN)})};e.showProjectionChangeDialog=function(e){const t=this,a=(e=e||{}).layer,n=t._dialogDiv.querySelector("."+t.CLASS+"-crs-dialog"),l=n.querySelector(".tc-modal-body");l.classList.add(TC.Consts.classes.LOADING);const s=a.getCompatibleCRS();n.classList.remove(TC.Consts.classes.HIDDEN);n.dataset.layerId=a.id;const o=n.querySelector("ul."+t.CLASS+"-crs-list");o.innerHTML="";t.map.loadProjections({crsList:t.map.getCompatibleCRS({layers:t.map.workLayers.concat(a),includeFallbacks:!0}),orderBy:"name"}).then(function(a){var n=!1;const r=document.createDocumentFragment();a.forEach(function(a){const l=document.createElement("li"),o=document.createElement("button");if(0===s.filter(function(e){return TC.Util.CRSCodesEqual(e,a.code)}).length){n=!0;o.innerHTML=a.name+" ("+a.code+")";e.layer.fallbackLayer&&(o.dataset.fallbackLayerId=e.layer.fallbackLayer.id);o.dataset.crsCode=a.code;o.classList.add(TC.Consts.classes.WARNING);l.classList.add(TC.Consts.classes.HIDDEN)}else{o.innerHTML=t.getLocaleString("changeMapToCrs",{crs:a.name+" ("+a.code+")"});o.dataset.crsCode=a.code}l.appendChild(o);r.appendChild(l)});if(e.fallbackLayer){const a=document.createElement("li"),n=document.createElement("button");n.innerHTML=t.getLocaleString("reprojectOnTheFly");n.dataset.fallbackLayerId=e.fallbackLayer.id;a.appendChild(n);r.appendChild(a)}if(n){const e=document.createElement("li"),a=document.createElement("button");a.classList.add(t._cssClasses.LOAD_CRS_BUTTON);a.innerHTML=t.getLocaleString("showOnTheFlyProjections");e.appendChild(a);r.appendChild(e)}o.appendChild(r);l.classList.remove(TC.Consts.classes.LOADING)});n.querySelector("."+t.CLASS+"-name").innerHTML=a.title||a.name;TC.Util.showModal(n)};e.showMoreLayersDialog=function(){const e=this,t=e._dialogDiv.querySelector("."+e.CLASS+"-more-dialog");t.classList.toggle(TC.Consts.classes.THREED,!!e.map.on3DView);const a=t.querySelector(".tc-modal-body");a.innerHTML="";a.classList.add(TC.Consts.classes.LOADING);t.classList.remove(TC.Consts.classes.HIDDEN);TC.Util.showModal(t,{closeCallback:function(){this._currentSelection.checked=!0;this.update()}.bind(e)});const n=e.div.querySelector(`.${e._cssClasses.TREE}`).classList.contains(e._cssClasses.GRID),l=t.querySelector(`.${e._cssClasses.VIEW_BTN}`);l.classList.toggle(e._cssClasses.DETAILS,n);l.classList.toggle(e._cssClasses.GRID,!n);l.setAttribute("title",e.getLocaleString(n?"showDetailsView":"showGridView"));const s=t=>{if(t){const a=t.getInfo?t.getInfo(t.names[0]):null;return{layer:t,info:a,controlId:e.id}}return{}},o=function(){const n=t.querySelector(`.${e._cssClasses.VIEW_BTN}`).classList.contains(e._cssClasses.DETAILS),l=e._moreBaseLayers.slice();for(var o=0,r=l.length;o<r;o++)l[o]||(l[o]=!1);e.getRenderedHtml(e.CLASS,{baseLayers:l.map(s),controlId:e.id},function(t){a.innerHTML=t;const l=a.querySelector(`.${e._cssClasses.TREE}`);l.classList.toggle(e._cssClasses.DETAILS,!n);l.classList.toggle(e._cssClasses.GRID,n);a.classList.remove(TC.Consts.classes.LOADING);e.update(a)})};e._getMoreBaseLayers(function(t){if(a.classList.contains(TC.Consts.classes.LOADING))o();else{const n=a.querySelector(`li.${e.CLASS}-node:nth-child(${t+1})`),l=e._moreBaseLayers[t];l&&e.getRenderedHtml(e.CLASS+"-node",s(l),function(t){n.insertAdjacentHTML("beforebegin",t);n.remove();e.update(a)})}}).then(function(){o()})};const n=function(e,t){const a=t.querySelector(`.${e._cssClasses.TREE}`);if(a){const n=t.querySelector(`.${e._cssClasses.VIEW_BTN}`),l=n.classList.toggle(e._cssClasses.DETAILS);n.setAttribute("title",e.getLocaleString(n.classList.toggle(e._cssClasses.GRID)?"showGridView":"showDetailsView"));a.classList.remove(e._cssClasses.DETAILS,e._cssClasses.GRID);setTimeout(()=>a.classList.add(l?e._cssClasses.GRID:e._cssClasses.DETAILS),20)}};e.toggleView=function(){n(this,this.div)};e.toggleMoreLayersDialogView=function(){const e=this;e._dialogDiv&&n(e,e._dialogDiv)};e.getLayer=function(e){return this.map&&(this.map.getLayer(e)||this._moreBaseLayers&&this._moreBaseLayers.filter(function(t){return t.id===e})[0])};const l=function(e){return new Promise(function(t,a){Promise.all([e.getCapabilitiesPromise(),e.getFallbackLayer()?e.getFallbackLayer().getCapabilitiesPromise():Promise.resolve()]).then(function(){t()})})};e._getMoreBaseLayers=function(e){const t=this;if(t._moreBaseLayers||t._moreBaseLayersPromise){if(t._moreBaseLayers)return new Promise(function(e,a){Promise.all(t._moreBaseLayers.filter(function(e){return e.type===TC.Consts.layerType.WMS||e.type===TC.Consts.layerType.WMTS}).map(function(e){return t.map.on3DView?l(e):e.getCapabilitiesPromise()})).then(function(){t._moreBaseLayers=t._moreBaseLayers.map(function(e){if(e.type===TC.Consts.layerType.WMTS){var a=e.wrap.getCompatibleMatrixSets(t.map.getCRS())[0];e.mustReproject=!a}else e.type===TC.Consts.layerType.WMS&&(e.mustReproject=!e.isCompatible(t.map.getCRS()));if(t.map.on3DView&&e.mustReproject&&e.getFallbackLayer&&e.getFallbackLayer()){e.mustReproject=!e.getFallbackLayer().isCompatible(t.map.getCRS());return e}return e});e(t._moreBaseLayers)})})}else t._moreBaseLayersPromise=new Promise(function(a,n){var s=TC.Cfg.availableBaseLayers.filter(function(e){return-1==TC.Cfg.availableBaseLayers.filter(function(e){return e.fallbackLayer}).map(function(e){return e.fallbackLayer}).indexOf(e.id)}).map(function(e){return e.type===TC.Consts.layerType.WMS||e.type===TC.Consts.layerType.WMTS?new TC.layer.Raster(e):e.type==TC.Consts.layerType.VECTOR?new TC.layer.Vector(e):void 0});t._moreBaseLayers=new Array(s.length);const o=function(a){const n=this;n.map=t.map;n.isBase=n.options.isBase=!0;if(n.type===TC.Consts.layerType.WMTS){var l=n.wrap.getCompatibleMatrixSets(t.map.getCRS())[0];n.mustReproject=!l}else n.type===TC.Consts.layerType.WMS&&(n.mustReproject=!n.isCompatible(t.map.getCRS()));t.map.on3DView&&n.mustReproject&&n.getFallbackLayer&&n.getFallbackLayer()&&(n.mustReproject=!n.getFallbackLayer().isCompatible(t.map.getCRS()));t._moreBaseLayers.splice(a,1,n);TC.Util.isFunction(e)&&e(a)};Promise.all(s.map(function(a,n){return new Promise(function(s,r){if(a.type===TC.Consts.layerType.WMS||a.type===TC.Consts.layerType.WMTS){(t.map.on3DView?l(a):a.getCapabilitiesPromise()).then(function(){o.call(a,n);s()},function(a){t._moreBaseLayers.splice(n,1,null);TC.Util.isFunction(e)&&e(n);s()})}else{o.call(a,n);s()}})})).finally(function(){t._moreBaseLayers=t._moreBaseLayers.filter(function(e){return null!==e});a(t._moreBaseLayers)})});return t._moreBaseLayersPromise}}();
//# sourceMappingURL=../maps/control/BasemapSelector.min.js.map