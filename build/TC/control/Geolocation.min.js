Math.hypot=Math.hypot||function(){for(var t=0,e=arguments.length,n=0;n<e;n++){if(arguments[n]===1/0||arguments[n]===-1/0)return 1/0;t+=arguments[n]*arguments[n]}return Math.sqrt(t)};!function(){for(var t=0,e=["ms","moz","webkit","o"],n=!(!window.performance||!window.performance.now),a=0,o=e.length;a<o&&!window.requestAnimationFrame;a+=1){window.requestAnimationFrame=window[e[a]+"RequestAnimationFrame"];window.cancelAnimationFrame=window[e[a]+"CancelAnimationFrame"]||window[e[a]+"CancelRequestAnimationFrame"]}window.requestAnimationFrame||(window.requestAnimationFrame=function(e,n){var a=(new Date).getTime(),o=Math.max(0,16-(a-t)),l=window.setTimeout(function(){e(a+o)},o);t=a+o;return l});window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){clearTimeout(t)});if(!n){var l=window.requestAnimationFrame,r=+new Date;window.requestAnimationFrame=function(t,e){l(function(e){return t(e<1e12?e:e-r)},e)}}}();!function(){if(window.performance){if(window.performance&&!window.performance.now){window.performance.offset=Date.now();window.performance.now=function(){return Date.now()-window.performance.offset}}}else window.performance={offset:Date.now(),now:function(){return Date.now()-this.offset}}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.control.infoShare||TC.syncLoadJS(TC.apiLocation+"TC/control/infoShare");TC.Consts.event.DIALOG=TC.Consts.event.DIALOG||"dialog.tc";TC.control.Geolocation=function(t){this._classSelector="."+this.CLASS;this._layerPromises={};this.Const={Classes:{ACTIVE:"tc-ctl-geolocation-active",CLOSED:"closed",SELECTEDTRACK:"selectedTrack",DRAWACTIVATED:"draw-activated",SIMULATIONACTIVATED:"simulation-activated"},Selector:{SIMULATE:".tc-btn-simulate",DRAW:".tc-draw",EDIT:".tc-btn-edit",DELETE:".tc-btn-delete",SAVE:".tc-btn-save",CANCEL:".tc-btn-cancel",EXPORT:".tc-btn-export",SHARE:".tc-btn-share",STOP:".tc-btn-stop",PAUSE:".tc-btn-pause",BACKWARD:".tc-btn-backward",FORWARD:".tc-btn-forward",SPEED:".tc-spn-speed"},LocalStorageKey:{TRACKING:"trk",TRACKINGTEMP:"trktemp",TRACKINGSHOWADVERTISEMENT:"trkAdvertisement",GPSSHOWADVERTISEMENT:"gpsAdvertisement",TEST:"test"},Message:{VALIDATENAME:""},Event:{POSITIONCHANGE:"positionchange.tc.geolocation",GPSPOSITIONCHANGE:"gpspositionchange.tc.geolocation",GPSPOSITIONERROR:"positionerror.tc.geolocation",STATEUPDATED:"stateupdated.tc.geolocation",GPSADD:"gpsadd.tc.geolocation",TRACKSNAPPING:"tracksnapping.tc.geolocation",DRAWTRACK:"drawtrack.tc.geolocation",CLEARTRACK:"cleartrack.tc.geolocation",IMPORTEDTRACK:"importedtrack.tc.geolocation"},MimeMap:{KML:"application/vnd.google-earth.kml+xml",GPX:"application/gpx+xml"},SupportedFileExtensions:[".kml",".gpx"],Tabs:{GPS:"gps"},Layers:{GPS:"gps",TRACK:"track",TRACKING:"tracking"}};TC.Control.apply(this,arguments);var e=t||{};this._dialogDiv=TC.Util.getDiv(e.dialogDiv);window.$&&(this._$dialogDiv=$(this._dialogDiv));e.dialogDiv||document.body.appendChild(this._dialogDiv);this._shareDialogDiv=TC.Util.getDiv({});document.body.appendChild(this._shareDialogDiv);this.delta=500;this.walkingSpeed=5e3;this.snappingTolerance=this.options.snappingTolerance||50;this.notificationConf={};this.exportsState=!0;this.storageCRS="EPSG:4326"};TC.inherit(TC.control.Geolocation,TC.Control);TC.mix(TC.control.Geolocation,TC.control.infoShare);!function(){var t=TC.control.Geolocation.prototype;t.CLASS="tc-ctl-geolocation";t.CHART_SIZE={MIN_HEIGHT:75,MAX_HEIGHT:128,MIN_WIDTH:315,MEDIUM_WIDTH:310,MAX_WIDTH:445};t.featuresToShare=[];TC.Consts.event.TOOLSCLOSE=TC.Consts.event.TOOLSCLOSE||"toolsclose.tc";TC.Consts.event.TOOLSOPEN=TC.Consts.event.TOOLSOPEN||"toolsopen.tc";t.template={};t.template[t.CLASS]={compiler:[8,">= 4.3.0"],main:function(t,e,n,a,o){var l=null!=e?e:t.nullContext||{},r=t.escapeExpression,i=t.lambda,c=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"<h2>"+r(c(n,"i18n").call(l,"geo",{name:"i18n",hash:{},data:o,loc:{start:{line:1,column:4},end:{line:1,column:18}}}))+'</h2>\r\n<div class="tc-ctl-geolocation-content">    \r\n    <div class="tc-ctl-geolocation-track">\r\n        <div class="tc-ctl-geolocation-track-snap-info"></div>                \r\n        <div class="tc-ctl-geolocation-track-panel-block" >\r\n            <input id="tc-ctl-geolocation-track-panel-opened-'+r(i(null!=e?c(e,"controlId"):e,e))+'" type="checkbox" checked/>\r\n            <label for="tc-ctl-geolocation-track-panel-opened-'+r(i(null!=e?c(e,"controlId"):e,e))+'" title="'+r(c(n,"i18n").call(l,"geo.trk.panel.help.1",{name:"i18n",hash:{},data:o,loc:{start:{line:7,column:84},end:{line:7,column:115}}}))+'">'+r(c(n,"i18n").call(l,"geo.trk.panel.help.2",{name:"i18n",hash:{},data:o,loc:{start:{line:7,column:117},end:{line:7,column:148}}}))+'</label>\r\n            <i class="tc-ctl-geolocation-track-panel-help icon-question-sign" title="'+r(c(n,"i18n").call(l,"geo.trk.panel.help.3",{name:"i18n",hash:{},data:o,loc:{start:{line:8,column:85},end:{line:8,column:116}}}))+'"></i>\r\n        </div>\r\n        <div class="tc-ctl-geolocation-track-mng">\r\n            <div class="tc-ctl-geolocation-select">\r\n                <label class="tc-ctl-geolocation-btn-track" title="'+r(c(n,"i18n").call(l,"geo.track.title",{name:"i18n",hash:{},data:o,loc:{start:{line:12,column:67},end:{line:12,column:93}}}))+'"><input type="radio" name="'+r(i(null!=e?c(e,"controlId"):e,e))+'-mode" checked value="tracks" /><span>'+r(c(n,"i18n").call(l,"geo.gps",{name:"i18n",hash:{},data:o,loc:{start:{line:12,column:172},end:{line:12,column:190}}}))+'</span></label><label \r\n\t\t\t\tclass="tc-ctl-geolocation-btn-tracks" title="'+r(c(n,"i18n").call(l,"geo.tracks.title",{name:"i18n",hash:{},data:o,loc:{start:{line:13,column:49},end:{line:13,column:76}}}))+'"><input type="radio" name="'+r(i(null!=e?c(e,"controlId"):e,e))+'-mode" value="track-available" /><span>'+r(c(n,"i18n").call(l,"geo.tracks",{name:"i18n",hash:{},data:o,loc:{start:{line:13,column:156},end:{line:13,column:177}}}))+'</span></label>                    \r\n            </div>                        \r\n            <div class="tc-ctl-geolocation-track-available tc-ctl-geolocation-track-cnt tc-ctl-geolocation-panel tc-hidden">\r\n                <i class="tc-ctl-geolocation-track-search-icon"></i>\r\n                <input id="tc-ctl-geolocation-track-available-srch" type="search" list="tc-ctl-geolocation-track-available-lst" class="tc-ctl-geolocation-track-available-srch tc-textbox" placeholder="'+r(c(n,"i18n").call(l,"geo.filter.plhr",{name:"i18n",hash:{},data:o,loc:{start:{line:17,column:200},end:{line:17,column:226}}}))+'" maxlength="200" />                \r\n                <ol id="tc-ctl-geolocation-track-available-lst" class="tc-ctl-geolocation-track-available-lst">\r\n                    <li class="tc-ctl-geolocation-track-available-empty"><span>'+r(c(n,"i18n").call(l,"geo.noTracks",{name:"i18n",hash:{},data:o,loc:{start:{line:19,column:79},end:{line:19,column:102}}}))+'</span></li>\r\n                    <li class="tc-ctl-geolocation-track-not" hidden><span>'+r(c(n,"i18n").call(l,"noMatches",{name:"i18n",hash:{},data:o,loc:{start:{line:20,column:74},end:{line:20,column:94}}}))+'</span></li>\r\n                </ol>\r\n                <div class="tc-ctl-geolocation-track-cnt">\r\n                    <input name="uploaded-file" id="uploaded-file-'+r(i(null!=e?c(e,"controlId"):e,e))+'" type="file" class="tc-ctl-geolocation-track-import tc-button" accept=".gpx,.kml,.kmz" disabled />\r\n                    <label class="tc-button tc-icon-button" for="uploaded-file-'+r(i(null!=e?c(e,"controlId"):e,e))+'" title="'+r(c(n,"i18n").call(l,"geo.trk.import.upload",{name:"i18n",hash:{},data:o,loc:{start:{line:24,column:101},end:{line:24,column:134}}}))+'">'+r(c(n,"i18n").call(l,"geo.trk.import.lbl",{name:"i18n",hash:{},data:o,loc:{start:{line:24,column:136},end:{line:24,column:165}}}))+'</label>\r\n                </div>\r\n            </div>\r\n            <div class="tc-ctl-geolocation-tracks tc-ctl-geolocation-panel">    \r\n                <div class="tc-alert alert-warning tc-hidden" >\r\n                    <p id="panel-msg">\r\n                        '+r(c(n,"i18n").call(l,"geo.trk.panel.1",{name:"i18n",hash:{},data:o,loc:{start:{line:30,column:24},end:{line:30,column:50}}}))+"                    \r\n                        <ul>\r\n                            <li>"+r(c(n,"i18n").call(l,"geo.trk.panel.2",{name:"i18n",hash:{},data:o,loc:{start:{line:32,column:32},end:{line:32,column:58}}}))+"</li>\r\n                            <li>"+r(c(n,"i18n").call(l,"geo.trk.panel.3",{name:"i18n",hash:{},data:o,loc:{start:{line:33,column:32},end:{line:33,column:58}}}))+"</li>\r\n                            <li>"+r(c(n,"i18n").call(l,"geo.trk.panel.4",{name:"i18n",hash:{},data:o,loc:{start:{line:34,column:32},end:{line:34,column:58}}}))+"</li>\r\n                            <li>"+r(c(n,"i18n").call(l,"geo.trk.panel.5",{name:"i18n",hash:{},data:o,loc:{start:{line:35,column:32},end:{line:35,column:58}}}))+'</li>\r\n                        </ul>\r\n                    </p>\r\n                </div>            \r\n                <div class="tc-ctl-geolocation-track-ui">   \r\n                    <div  class="tc-ctl-geolocation-track-render">\r\n                        <input id="tc-ctl-geolocation-track-render-'+r(i(null!=e?c(e,"controlId"):e,e))+'" type="checkbox" hidden checked />\r\n                        <label for="tc-ctl-geolocation-track-render-'+r(i(null!=e?c(e,"controlId"):e,e))+'" class="tc-ctl-geolocation-track-render" title="'+r(c(n,"i18n").call(l,"geo.trk.render",{name:"i18n",hash:{},data:o,loc:{start:{line:42,column:130},end:{line:42,column:155}}}))+'">'+r(c(n,"i18n").call(l,"geo.trk.render",{name:"i18n",hash:{},data:o,loc:{start:{line:42,column:157},end:{line:42,column:182}}}))+'</label>\r\n                    </div>\r\n                    <button class="tc-button tc-icon-button tc-ctl-geolocation-track-ui-activate" title="'+r(c(n,"i18n").call(l,"geo.track.activate.title",{name:"i18n",hash:{},data:o,loc:{start:{line:44,column:105},end:{line:44,column:140}}}))+'">'+r(c(n,"i18n").call(l,"geo.track.activate",{name:"i18n",hash:{},data:o,loc:{start:{line:44,column:142},end:{line:44,column:171}}}))+'</button>\r\n                    <button class="tc-button tc-icon-button tc-ctl-geolocation-track-ui-deactivate tc-hidden" title="'+r(c(n,"i18n").call(l,"geo.track.deactivate.title",{name:"i18n",hash:{},data:o,loc:{start:{line:45,column:117},end:{line:45,column:155}}}))+'">'+r(c(n,"i18n").call(l,"geo.track.deactivate",{name:"i18n",hash:{},data:o,loc:{start:{line:45,column:157},end:{line:45,column:188}}}))+'</button>\r\n                </div>\r\n                <div  class="tc-ctl-geolocation-track-current tc-ctl-geolocation-track-cnt">\r\n                    <input type="text" class="tc-ctl-geolocation-track-title tc-textbox" disabled placeholder="'+r(c(n,"i18n").call(l,"geo.trk.name.plhr",{name:"i18n",hash:{},data:o,loc:{start:{line:48,column:111},end:{line:48,column:139}}}))+'" maxlength="200" /><button \r\n\t\t\t\t\tclass="tc-button tc-icon-button tc-ctl-geolocation-track-save" disabled title="'+r(c(n,"i18n").call(l,"geo.trk.name.save",{name:"i18n",hash:{},data:o,loc:{start:{line:49,column:84},end:{line:49,column:112}}}))+'"></button>\r\n                    <input type="text" class="tc-ctl-geolocation-track-waypoint tc-textbox" disabled placeholder="'+r(c(n,"i18n").call(l,"geo.trk.wyp.plhr",{name:"i18n",hash:{},data:o,loc:{start:{line:50,column:114},end:{line:50,column:141}}}))+'" maxlength="200" /><button \r\n\t\t\t\t\tclass="tc-button tc-icon-button tc-ctl-geolocation-track-add-wpt" disabled title="'+r(c(n,"i18n").call(l,"geo.trk.wyp.save",{name:"i18n",hash:{},data:o,loc:{start:{line:51,column:87},end:{line:51,column:114}}}))+'"></button>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n<div class="tc-ctl-geolocation-track-center tc-hidden">\r\n    <button class="tc-float-btn" title="'+r(c(n,"i18n").call(l,"geo.trk.center",{name:"i18n",hash:{},data:o,loc:{start:{line:58,column:40},end:{line:58,column:65}}}))+'"></button>\r\n</div>\r\n\r\n\r\n'},useData:!0};t.template[t.CLASS+"-track-node"]={compiler:[8,">= 4.3.0"],main:function(t,e,n,a,o){var l=t.lambda,r=t.escapeExpression,i=null!=e?e:t.nullContext||{},c=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<li data-id="'+r(l(null!=e?c(e,"id"):e,e))+'" data-uid="'+r(l(null!=e?c(e,"uid"):e,e))+'">\r\n    <span class="tc-draw tc-selectable" title="'+r(l(null!=e?c(e,"name"):e,e))+'">'+r(l(null!=e?c(e,"name"):e,e))+'</span>\r\n    <input class="tc-textbox tc-hidden" type="text" value="'+r(l(null!=e?c(e,"name"):e,e))+'" />\r\n    <button class="tc-btn-share" title="'+r(c(n,"i18n").call(i,"tr.lst.share",{name:"i18n",hash:{},data:o,loc:{start:{line:4,column:40},end:{line:4,column:64}}}))+'"></button>\r\n    <button class="tc-btn-simulate" title="'+r(c(n,"i18n").call(i,"tr.lst.simulate",{name:"i18n",hash:{},data:o,loc:{start:{line:5,column:43},end:{line:5,column:70}}}))+'"></button>\r\n    <button hidden class="tc-btn-stop" title="'+r(c(n,"i18n").call(i,"tr.lst.stop",{name:"i18n",hash:{},data:o,loc:{start:{line:6,column:46},end:{line:6,column:69}}}))+'"></button>\r\n    <button class="tc-btn-edit" title="'+r(c(n,"i18n").call(i,"tr.lst.edit",{name:"i18n",hash:{},data:o,loc:{start:{line:7,column:39},end:{line:7,column:62}}}))+'"></button>\r\n    <button hidden class="tc-btn-pause" title="'+r(c(n,"i18n").call(i,"tr.lst.pause",{name:"i18n",hash:{},data:o,loc:{start:{line:8,column:47},end:{line:8,column:71}}}))+'"></button>\r\n    <button hidden class="tc-btn-backward" title="'+r(c(n,"i18n").call(i,"tr.lst.backward",{name:"i18n",hash:{},data:o,loc:{start:{line:9,column:50},end:{line:9,column:77}}}))+'"></button>\r\n    <label hidden class="tc-spn-speed" title="'+r(c(n,"i18n").call(i,"tr.lst.velocity",{name:"i18n",hash:{},data:o,loc:{start:{line:10,column:46},end:{line:10,column:73}}}))+'"></label>\r\n    <button hidden class="tc-btn-forward" title="'+r(c(n,"i18n").call(i,"tr.lst.forward",{name:"i18n",hash:{},data:o,loc:{start:{line:11,column:49},end:{line:11,column:75}}}))+'"></button>\r\n    <button class="tc-btn-save tc-hidden" title="'+r(c(n,"i18n").call(i,"save",{name:"i18n",hash:{},data:o,loc:{start:{line:12,column:49},end:{line:12,column:65}}}))+'"></button>\r\n    <button class="tc-btn-cancel tc-hidden" title="'+r(c(n,"i18n").call(i,"tr.lst.cancel",{name:"i18n",hash:{},data:o,loc:{start:{line:13,column:51},end:{line:13,column:76}}}))+'"></button>\r\n    <button class="tc-btn-export" title="'+r(c(n,"i18n").call(i,"tr.lst.download",{name:"i18n",hash:{},data:o,loc:{start:{line:14,column:41},end:{line:14,column:68}}}))+'"></button>\r\n    <button class="tc-btn-delete" title="'+r(c(n,"i18n").call(i,"tr.lst.delete",{name:"i18n",hash:{},data:o,loc:{start:{line:15,column:41},end:{line:15,column:66}}}))+'"></button>\r\n</li>\r\n'},useData:!0};t.template[t.CLASS+"-track-snapping-node"]={1:function(t,e,n,a,o){var l=t.escapeExpression,r=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"    <li>\r\n        <span>"+l(r(n,"i18n").call(null!=e?e:t.nullContext||{},"geo.trk.snapping.name",{name:"i18n",hash:{},data:o,loc:{start:{line:4,column:14},end:{line:4,column:46}}}))+":</span> "+l(t.lambda(null!=e?r(e,"n"):e,e))+"\r\n    </li>\r\n"},3:function(t,e,n,a,o){var l=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return t.escapeExpression(l(n,"i18n").call(null!=e?e:t.nullContext||{},"lon",{name:"i18n",hash:{},data:o,loc:{start:{line:7,column:28},end:{line:7,column:42}}}))},5:function(t,e,n,a,o){return"X"},7:function(t,e,n,a,o){var l=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return t.escapeExpression(l(n,"i18n").call(null!=e?e:t.nullContext||{},"lat",{name:"i18n",hash:{},data:o,loc:{start:{line:8,column:28},end:{line:8,column:42}}}))},9:function(t,e,n,a,o){return"Y"},11:function(t,e,n,a,o){var l,r=null!=e?e:t.nullContext||{},i=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(l=i(n,"unless").call(r,i(n,"eq").call(r,null!=e?i(e,"z"):e,0,{name:"eq",hash:{},data:o,loc:{start:{line:10,column:14},end:{line:10,column:22}}}),{name:"unless",hash:{},fn:t.program(12,o,0),inverse:t.noop,data:o,loc:{start:{line:10,column:4},end:{line:12,column:15}}}))?l:""},12:function(t,e,n,a,o){var l=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'    <li> <span>Z:</span> <span class="original"> '+t.escapeExpression(t.lambda(null!=e?l(e,"z"):e,e))+" </span></li>\r\n"},14:function(t,e,n,a,o){var l,r=null!=e?e:t.nullContext||{},i=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(l=i(n,"unless").call(r,i(n,"eq").call(r,null!=e?i(e,"mdtz"):e,0,{name:"eq",hash:{},data:o,loc:{start:{line:15,column:14},end:{line:15,column:25}}}),{name:"unless",hash:{},fn:t.program(15,o,0),inverse:t.noop,data:o,loc:{start:{line:15,column:4},end:{line:17,column:15}}}))?l:""},15:function(t,e,n,a,o){var l=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'    <li> <span>Z:</span> <span class="mdt"> '+t.escapeExpression(t.lambda(null!=e?l(e,"mdtz"):e,e))+" </span> </li>\r\n"},17:function(t,e,n,a,o){var l=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"    <li> "+t.escapeExpression(t.lambda(null!=e?l(e,"m"):e,e))+" </li>\r\n"},compiler:[8,">= 4.3.0"],main:function(t,e,n,a,o){var l,r=null!=e?e:t.nullContext||{},i=t.lambda,c=t.escapeExpression,s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"<ul>\r\n"+(null!=(l=s(n,"if").call(r,null!=e?s(e,"n"):e,{name:"if",hash:{},fn:t.program(1,o,0),inverse:t.noop,data:o,loc:{start:{line:2,column:4},end:{line:6,column:11}}}))?l:"")+"    <li> <span>"+(null!=(l=s(n,"if").call(r,null!=e?s(e,"isGeo"):e,{name:"if",hash:{},fn:t.program(3,o,0),inverse:t.program(5,o,0),data:o,loc:{start:{line:7,column:15},end:{line:7,column:58}}}))?l:"")+":</span> "+c(i(null!=e?s(e,"x"):e,e))+"</li>\r\n    <li> <span>"+(null!=(l=s(n,"if").call(r,null!=e?s(e,"isGeo"):e,{name:"if",hash:{},fn:t.program(7,o,0),inverse:t.program(9,o,0),data:o,loc:{start:{line:8,column:15},end:{line:8,column:58}}}))?l:"")+":</span> "+c(i(null!=e?s(e,"y"):e,e))+" </li>\r\n"+(null!=(l=s(n,"if").call(r,null!=e?s(e,"z"):e,{name:"if",hash:{},fn:t.program(11,o,0),inverse:t.noop,data:o,loc:{start:{line:9,column:4},end:{line:13,column:11}}}))?l:"")+(null!=(l=s(n,"if").call(r,null!=e?s(e,"mdtz"):e,{name:"if",hash:{},fn:t.program(14,o,0),inverse:t.noop,data:o,loc:{start:{line:14,column:4},end:{line:18,column:11}}}))?l:"")+(null!=(l=s(n,"if").call(r,null!=e?s(e,"m"):e,{name:"if",hash:{},fn:t.program(17,o,0),inverse:t.noop,data:o,loc:{start:{line:19,column:4},end:{line:21,column:11}}}))?l:"")+"</ul>"},useData:!0};t.template[t.CLASS+"-dialog"]={compiler:[8,">= 4.3.0"],main:function(t,e,n,a,o){var l=null!=e?e:t.nullContext||{},r=t.escapeExpression,i=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<div class="tc-ctl-geolocation-continue-track-dialog tc-modal" >\r\n    <div class="tc-modal-background tc-modal-close"></div>\r\n    <div class="tc-modal-window">\r\n        <div class="tc-modal-header">\r\n            <h3>'+r(i(n,"i18n").call(l,"geo.gps",{name:"i18n",hash:{},data:o,loc:{start:{line:5,column:16},end:{line:5,column:34}}}))+'</h3>\r\n            <div class="tc-modal-close"></div>\r\n        </div>\r\n        <div class="tc-modal-body">\r\n            <button class="tc-button tc-ctl-geolocation-track-continue"> '+r(i(n,"i18n").call(l,"geo.trk.dialog.cnt",{name:"i18n",hash:{},data:o,loc:{start:{line:9,column:73},end:{line:9,column:102}}}))+' </button>\r\n            <button class="tc-button tc-ctl-geolocation-track-new"> '+r(i(n,"i18n").call(l,"geo.trk.dialog.new",{name:"i18n",hash:{},data:o,loc:{start:{line:10,column:68},end:{line:10,column:97}}}))+' </button>            \r\n            <button class="tc-button tc-modal-close"> '+r(i(n,"i18n").call(l,"geo.trk.dialog.cancel",{name:"i18n",hash:{},data:o,loc:{start:{line:11,column:54},end:{line:11,column:86}}}))+' </button>\r\n        </div>\r\n    </div>\r\n</div>\r\n<div class="tc-ctl-geolocation-track-advert-dialog tc-modal" >\r\n    <div class="tc-modal-background tc-modal-close"></div>\r\n    <div class="tc-modal-window">\r\n        <div class="tc-modal-header">\r\n            <h3>'+r(i(n,"i18n").call(l,"geo.track.activate.title",{name:"i18n",hash:{},data:o,loc:{start:{line:19,column:16},end:{line:19,column:51}}}))+'</h3>\r\n            <div class="tc-modal-close"></div>\r\n        </div>\r\n        <div class="tc-modal-body">\r\n            <p id="pageBlurMsg">'+r(i(n,"i18n").call(l,"geo.trk.page.blur",{name:"i18n",hash:{},data:o,loc:{start:{line:23,column:32},end:{line:23,column:60}}}))+'</p>\r\n            <p class="tc-ctl-geolocation-track-advertisement p">                \r\n                <label> <input type="checkbox" name="checkbox" id="advertisement"> '+r(i(n,"i18n").call(l,"geo.trk.dialog.advertisement",{name:"i18n",hash:{},data:o,loc:{start:{line:25,column:83},end:{line:25,column:122}}}))+' </label>        \r\n            </p>\r\n        </div>\r\n        <div class="tc-modal-footer">\r\n            <button class="tc-button tc-ctl-geolocation-track-advert-ok"> '+r(i(n,"i18n").call(l,"ok",{name:"i18n",hash:{},data:o,loc:{start:{line:29,column:74},end:{line:29,column:87}}}))+" </button>\r\n        </div>\r\n    </div>\r\n</div>\r\n\r\n"},useData:!0};t.template[t.CLASS+"-tracking-toast"]={1:function(t,e,n,a,o){var l=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return t.escapeExpression(l(n,"i18n").call(null!=e?e:t.nullContext||{},"lon",{name:"i18n",hash:{},data:o,loc:{start:{line:3,column:25},end:{line:3,column:39}}}))},3:function(t,e,n,a,o){return"X"},5:function(t,e,n,a,o){var l=t.escapeExpression,r=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"        <th>"+l(r(n,"i18n").call(null!=e?e:t.nullContext||{},"geo.trk.accuracy",{name:"i18n",hash:{},data:o,loc:{start:{line:6,column:12},end:{line:6,column:39}}}))+":</th>\r\n        <td> "+l(t.lambda(null!=e?r(e,"accuracy"):e,e))+" m </td>\r\n"},7:function(t,e,n,a,o){var l=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return t.escapeExpression(l(n,"i18n").call(null!=e?e:t.nullContext||{},"lat",{name:"i18n",hash:{},data:o,loc:{start:{line:11,column:25},end:{line:11,column:39}}}))},9:function(t,e,n,a,o){return"Y"},11:function(t,e,n,a,o){var l=t.escapeExpression,r=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"        <th>"+l(r(n,"i18n").call(null!=e?e:t.nullContext||{},"geo.trk.speed",{name:"i18n",hash:{},data:o,loc:{start:{line:14,column:12},end:{line:14,column:36}}}))+":</th>\r\n        <td>"+l(t.lambda(null!=e?r(e,"speed"):e,e))+" km/h</td>\r\n"},13:function(t,e,n,a,o){var l,r=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"        <th>"+(null!=(l=r(n,"if").call(null!=e?e:t.nullContext||{},null!=e?r(e,"isGeo"):e,{name:"if",hash:{},fn:t.program(14,o,0),inverse:t.program(16,o,0),data:o,loc:{start:{line:20,column:12},end:{line:20,column:55}}}))?l:"")+":</th>\r\n        <td> "+t.escapeExpression(t.lambda(null!=e?r(e,"z"):e,e))+" m </td>\r\n"},14:function(t,e,n,a,o){var l=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return t.escapeExpression(l(n,"i18n").call(null!=e?e:t.nullContext||{},"ele",{name:"i18n",hash:{},data:o,loc:{start:{line:20,column:25},end:{line:20,column:39}}}))},16:function(t,e,n,a,o){return"Z"},18:function(t,e,n,a,o){var l=null!=e?e:t.nullContext||{},r=t.escapeExpression,i=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'        <th title="'+r(i(n,"i18n").call(l," mdt.title",{name:"i18n",hash:{},data:o,loc:{start:{line:24,column:19},end:{line:24,column:40}}}))+'">'+r(i(n,"i18n").call(l,"ele",{name:"i18n",hash:{},data:o,loc:{start:{line:24,column:42},end:{line:24,column:56}}}))+" ("+r(i(n,"i18n").call(l,"mdt",{name:"i18n",hash:{},data:o,loc:{start:{line:24,column:58},end:{line:24,column:72}}}))+"):</th>\r\n        <td>"+r(t.lambda(null!=e?i(e,"mdt"):e,e))+" m </td>\r\n"},compiler:[8,">= 4.3.0"],main:function(t,e,n,a,o){var l,r=null!=e?e:t.nullContext||{},i=t.lambda,c=t.escapeExpression,s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<table class="tc-ctl-geolocation-info-tracking">\r\n    <tr>\r\n        <th>'+(null!=(l=s(n,"if").call(r,null!=e?s(e,"isGeo"):e,{name:"if",hash:{},fn:t.program(1,o,0),inverse:t.program(3,o,0),data:o,loc:{start:{line:3,column:12},end:{line:3,column:55}}}))?l:"")+":</th>\r\n        <td> "+c(i(null!=e?s(e,"x"):e,e))+" </td>\r\n"+(null!=(l=s(n,"if").call(r,null!=e?s(e,"accuracy"):e,{name:"if",hash:{},fn:t.program(5,o,0),inverse:t.noop,data:o,loc:{start:{line:5,column:8},end:{line:8,column:15}}}))?l:"")+"    </tr>\r\n    <tr>\r\n        <th>"+(null!=(l=s(n,"if").call(r,null!=e?s(e,"isGeo"):e,{name:"if",hash:{},fn:t.program(7,o,0),inverse:t.program(9,o,0),data:o,loc:{start:{line:11,column:12},end:{line:11,column:55}}}))?l:"")+":</th>\r\n        <td> "+c(i(null!=e?s(e,"y"):e,e))+" </td>\r\n"+(null!=(l=s(n,"if").call(r,null!=e?s(e,"speed"):e,{name:"if",hash:{},fn:t.program(11,o,0),inverse:t.noop,data:o,loc:{start:{line:13,column:8},end:{line:16,column:15}}}))?l:"")+"    </tr>\r\n    <tr>\r\n"+(null!=(l=s(n,"if").call(r,null!=e?s(e,"z"):e,{name:"if",hash:{},fn:t.program(13,o,0),inverse:t.noop,data:o,loc:{start:{line:19,column:8},end:{line:22,column:15}}}))?l:"")+(null!=(l=s(n,"if").call(r,null!=e?s(e,"mdt"):e,{name:"if",hash:{},fn:t.program(18,o,0),inverse:t.noop,data:o,loc:{start:{line:23,column:8},end:{line:26,column:15}}}))?l:"")+"    </tr>    \r\n</table>\r\n"},useData:!0};t.template[t.CLASS+"-ext-dldlog"]={compiler:[8,">= 4.3.0"],main:function(t,e,n,a,o){var l=t.lambda,r=t.escapeExpression,i=null!=e?e:t.nullContext||{},c=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<div class="tc-ctl-geolocation-ext-dldlog tc-hidden">\r\n    <label>\r\n        <input type="radio" name="'+r(l(null!=e?c(e,"controlId"):e,e))+'-dldlog-source" value="track" checked />\r\n        <span>'+r(c(n,"i18n").call(i,"geo.profile.fromTrack.plural",{name:"i18n",hash:{},data:o,loc:{start:{line:4,column:14},end:{line:4,column:53}}}))+'</span>\r\n    </label>\r\n    <label>\r\n        <input type="radio" name="'+r(l(null!=e?c(e,"controlId"):e,e))+'-dldlog-source" value="mdt" />\r\n        <span title="'+r(c(n,"i18n").call(i,"mdt.title",{name:"i18n",hash:{},data:o,loc:{start:{line:8,column:21},end:{line:8,column:41}}}))+'">'+r(c(n,"i18n").call(i,"mdt",{name:"i18n",hash:{},data:o,loc:{start:{line:8,column:43},end:{line:8,column:57}}}))+"</span>\r\n    </label>\r\n</div>\r\n"},useData:!0};t.template[t.CLASS+"-share-dialog"]={compiler:[8,">= 4.3.0"],main:function(t,e,n,a,o){var l=null!=e?e:t.nullContext||{},r=t.escapeExpression,i=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<div class="tc-ctl-geolocation-dialog tc-ctl-geolocation-share-dialog tc-modal">\r\n    <div class="tc-modal-background tc-modal-close"></div>\r\n    <div class="tc-modal-window">\r\n        <div class="tc-modal-header">\r\n            <h3>'+r(i(n,"i18n").call(l,"geo.track.1",{name:"i18n",hash:{},data:o,loc:{start:{line:5,column:16},end:{line:5,column:38}}}))+" - "+r(i(n,"i18n").call(l,"share",{name:"i18n",hash:{},data:o,loc:{start:{line:5,column:41},end:{line:5,column:57}}}))+'</h3>\r\n            <div class="tc-modal-close"></div>\r\n        </div>\r\n        <div class="tc-modal-body">\r\n            <div class="tc-ctl-geolocation-share-dialog-ctl"></div>\r\n        </div>\r\n    </div>\r\n</div>\r\n\r\n\r\n'},useData:!0};var e=function(t){const e=this;t.layer;t.feature!==e.wrap.simulateMarker&&t.layer===e.layerTrack&&e.clearSelection()};t.register=function(t){const e=this,n=TC.Control.prototype.register.call(e,t);e.wrap=new TC.wrap.control.Geolocation(e);e.wrap.register(t);t._bufferFeatures=[];e.hillDeltaThreshold=e.options&&e.options.hillDeltaThreshold||e.map.options.elevation&&e.map.options.elevation.hillDeltaThreshold||20;t.addLayer({id:e.getUID(),type:TC.Consts.layerType.VECTOR,owner:e,stealth:!0,title:"Posicionar.GPS"}).then(function(t){e.layerGPS=t});t.addLayer({id:e.getUID(),type:TC.Consts.layerType.VECTOR,owner:e,stealth:!0,title:"Posicionar.Tracking",styles:{point:{radius:3,fillColor:"#00ced1",fillOpacity:function(){return this.track.renderTrack.checked?1:0}.bind(e),strokeColor:"#ffffff",fontColor:"#00ced1",labelOutlineColor:"#ffffff",labelOutlineWidth:1,label:function(t){var e=t.getData().name;return e=e&&(e+"").trim().length>0?(e+"").trim().toLowerCase():""}},line:{strokeOpacity:function(){return this.track.renderTrack.checked?1:0}.bind(e),strokeWidth:2,strokeColor:"#00ced1",lineDash:[.1,6]}}}).then(function(t){e.layerTracking=t});t.addLayer({id:e.getUID(),type:TC.Consts.layerType.VECTOR,owner:e,stealth:!0,title:"Posicionar.Track",styles:{line:{strokeWidth:2,strokeColor:"#C52737"},point:{radius:function(t){var e=t.getData().name;return e&&(e+"").trim().length>0?3:6},fillColor:"#C52737",strokeColor:"#ffffff",fontColor:"#C52737",fontSize:10,labelOutlineColor:"#ffffff",labelOutlineWidth:2,label:function(t){var e=t.getData().name;return e=e&&(e+"").trim().length>0?(e+"").trim().toLowerCase():""}}}}).then(function(t){e.layerTrack=t});t.on(TC.Consts.event.FEATURESIMPORT,function(t){const e=this,n=function(t){const n=t.fileName,a=t.dropTarget;var o="."+TC.Consts.format.KML.toLowerCase(),l="."+TC.Consts.format.GPX.toLowerCase();if(n.toLowerCase().indexOf(l)===n.length-l.length||n.toLowerCase().indexOf(o)===n.length-o.length&&a===e){e.clear(e.Const.Layers.TRACK);const a=function(){setTimeout(function(){e.map._bufferFeatures=e.map._bufferFeatures.concat(t.features);window.dropFilesCounter--;if(0===dropFilesCounter){e.map.zoomToFeatures(e.map._bufferFeatures);e.map._bufferFeatures=[];delete window.dropFilesCounter;var n=e.map.getLoadingIndicator();if(n){n.removeWait(e.map._fileDropLoadingIndicator);e.map._fileDropLoadingIndicator=null}e.off(e.Const.Event.IMPORTEDTRACK,a)}},0)};e.on(e.Const.Event.IMPORTEDTRACK,a);e.importTrack(t);/.kml$/g.test(n.toLowerCase())&&e.layerTrack&&e.layerTrack.styles&&e.layerTrack.features.forEach(function(t){TC.feature.Point&&t instanceof TC.feature.Point&&e.layerTrack.styles.point?t.setStyle(e.layerTrack.styles.point):TC.feature.Polyline&&t instanceof TC.feature.Polyline&&e.layerTrack.styles.line&&t.setStyle(e.layerTrack.styles.line)})}};if(e.working&&TC.Util.isFunction(e.working.then))e.working.then(n(t));else{e.working=!0;n(t)}}.bind(e));t.on(TC.Consts.event.PROJECTIONCHANGE,function(t){e.elevationChartData&&(e.elevationChartData.coords=TC.Util.reproject(e.elevationChartData.coords,t.oldCrs,t.newCrs))});t.on(TC.Consts.event.DIALOG,function(t){if(t.control)switch(t.action){case"share":t.control.caller!==e&&e.onShowShareDialog(t.control.caller);break;case"download":e.onShowDownloadDialog(t.control.caller)}});e.notificationConf=Object.assign(e.options.notification||{},{tag:"Geolocation Track",vibrate:[200],renotify:!0,requireInteraction:!0,body:e.getLocaleString("geo.trk.notification.body")},{title:e.options.notification&&e.options.notification.title?e.getLocaleString(e.options.notification.title):document.title});return n};t.getElevationControl=async function(){const t=this;if(!t.elevationControl){let e={};!t.options.displayElevation&&t.options.displayOn?e.displayOn=t.options.displayOn:t.options.displayElevation&&(e=t.options.displayElevation);t.options.hasOwnProperty("resolution")?e.resolution=t.options.resolution:e.resolution=0;t.elevationControl=await t.map.addControl("elevation",e);t.elevationControl._decorateChartPanel=function(){this.resultsPanel.setCurrentFeature=function(e){const a=this;a.currentFeature=t.layerTrack.features.filter(t=>!(TC.feature.Marker&&t instanceof TC.feature.Marker||TC.feature.Point&&t instanceof TC.feature.Point))[0];const o=t.getSelectedTrack();if(o){a.currentFeature.uid=o.dataset.uid;a.currentFeature.fileName=n.call(t,o)}}}}return t.elevationControl};t.render=function(t){const e=this;return e.getRenderedHtml(e.CLASS+"-dialog",null,function(t){e._dialogDiv.innerHTML=t}).then(function(){return e.getDownloadDialog().then(()=>{e._downloadDialog.caller=e;e.getRenderedHtml(e.CLASS+"-ext-dldlog",{controlId:e.id},function(n){var a=document.createElement("template");a.innerHTML=n;e._downloadDialogExtNode=a.content?a.content.firstChild:a.firstChild;e.getRenderedHtml(e.CLASS+"-share-dialog",{},function(n){e._shareDialogDiv.innerHTML=n;return e.renderData({controlId:e.id},t)})})})})};t.importTrack=function(t){var n=this;n.map.off(TC.Consts.event.FEATUREREMOVE,e);if(n.isDisabled)/.gpx$/g.test(t.fileName.toLowerCase())&&n.map.toast(n.getLocaleString("geo.trk.import.disabled"),{type:TC.Consts.msgType.WARNING});else if(t.fileName&&t.features&&t.features.length>0){var a=n.getLoadingIndicator().addWait();n.importedFileName=t.fileName;const e=[];for(var o=0,l=t.features.length;o<l;o++)e.push(n.layerTrack.addFeature(t.features[o]));Promise.all(e).then(function(){n.wrap.processImportedFeatures({wait:a,notReproject:t.notReproject});if(n.layerTrack){n.map&&n.map.layout&&n.map.layout.accordion&&n.div.classList.contains(TC.Consts.classes.COLLAPSED)&&n.map.controls.filter(function(t){return t!==n&&!t.containerControl}).forEach(function(t){t.div.classList.add(TC.Consts.classes.COLLAPSED)});n.div.classList.remove(TC.Consts.classes.COLLAPSED);n.div.querySelector("."+n.CLASS+"-btn-tracks > span").click();t.isShared||n.map.trigger(TC.Consts.event.TOOLSOPEN)}})}};t.prepareFeaturesToShare=function(t){const e=this;let n=t.uid;return new Promise(function(a,o){if(n){var l=e.availableTracks.filter(function(t){return t.uid.toString()===n.toString()})[0].data,r=(Math.pow(10,TC.Consts.DEGREE_PRECISION+1),(new ol.format.GeoJSON).readFeatures(l));const o=new Array(r.length);r.forEach(function(t,e){o[e]=TC.wrap.Feature.createFeature(t)});Promise.all(o).then(function(n){let o=n.map(function(t){const e={};switch(!0){case TC.feature.Marker&&t instanceof TC.feature.Marker:e.type=TC.Consts.geom.MARKER;break;case TC.feature.Point&&t instanceof TC.feature.Point:e.type=TC.Consts.geom.POINT;break;case TC.feature.Polyline&&t instanceof TC.feature.Polyline:e.type=TC.Consts.geom.POLYLINE;break;case TC.feature.MultiPolyline&&t instanceof TC.feature.MultiPolyline:e.type=TC.Consts.geom.MULTIPOLYLINE}e.id=t.id;e.geom=t.geometry;e.data=t.getData();return e});t.setFeaturesToShare&&(e.featuresToShare=o);a(o)})}else o()})};const n=function(t){var e=t.querySelector("span").textContent,n=new RegExp(this.Const.SupportedFileExtensions.join("|"),"gi");return e.replace(n,"")+"_"+TC.Util.getFormattedDate(new Date,!0)};t.onShowShareDialog=function(t){const e=this;if(t instanceof Element||t instanceof HTMLDocument)return t.classList.contains(e.CLASS+"-share-dialog")?TC.control.infoShare.onShowShareDialog.call(e):Promise.resolve();if(t===e)return TC.control.infoShare.onShowShareDialog.call(e);t!==e&&t.toShare&&t.toShare.feature&&t.toShare.feature.layer===e.layerTrack&&TC.Util.closeModal(function(){TC.control.infoShare.onCloseShareDialog.call(t);const n=e.getSelectedTrack();return n?e.shareTrack(n).then(function(){const t=e._shareDialogDiv.querySelector("."+e.CLASS+"-share-dialog");TC.Util.showModal(t,{openCallback:function(){return TC.control.infoShare.onShowShareDialog.call(e)},closeCallback:function(){TC.control.infoShare.onCloseShareDialog.call(e)}})}):Promise.resolve()})};var a=null,o=null;t.onShowDownloadDialog=function(t,e){const n=this,l=n._downloadDialog.getFeatures();if(t!==n&&n._downloadDialog.getFeatures().every(t=>t&&t.layer===n.layerTrack)){let t=n._downloadDialog.getOptions(),e=n.getDownloadDialogOptions();t.elevation=e.elevation;delete t.openCallback;n._downloadDialog.open(n._downloadDialog.getFeatures(),t)}1===l.length&&l.every(t=>t&&t.fileName)&&n._downloadDialog.setOptions({fileName:l[0].fileName});if(n.options.displayElevation&&(t===n||n._downloadDialog.getFeatures().every(t=>t&&t.layer===n.layerTrack))&&!n._downloadDialog.modalBody.querySelector("."+n.CLASS+"-ext-dldlog")){let t=n._downloadDialog.modalBody.querySelector("."+n._downloadDialog.CLASS+"-ext");if(t){t.appendChild(n._downloadDialogExtNode);o=n._downloadDialog.modalBody.querySelector("."+n._downloadDialog.CLASS+"-elev input[type='checkbox']");a=n._downloadDialog.modalBody.querySelector("."+n._downloadDialog.CLASS+"-ip");const r=n._downloadDialog.modalBody.querySelectorAll(`input[type=radio][name="${n.id}-dldlog-source"]`),i=function(t){const e=r[0];t?e.classList.contains(TC.Consts.classes.DISABLED)||e.classList.add(TC.Consts.classes.DISABLED):e.classList.remove(TC.Consts.classes.DISABLED)};let c=l.filter(t=>TC.feature.Polyline&&t instanceof TC.feature.Polyline)[0],s=(c.geometry[0],2===c.geometry[0].length);s?i(s):c.geometry[0].length>2&&i(c.geometry.map(t=>t[2]).every(t=>0===t));const d=function(){return a&&a.classList.contains(TC.Consts.classes.HIDDEN)},u=function(){if(r[0].checked&&!d())a.classList.add(TC.Consts.classes.HIDDEN);else if(r[0].checked){let t=new MutationObserver(function(e){e.filter(t=>"class"===t.attributeName).forEach(function(e){if(e.oldValue.indexOf(TC.Consts.classes.HIDDEN)>-1)if(r[0].checked){a.classList.add(TC.Consts.classes.HIDDEN);t.disconnect()}else t.disconnect()})}),e={attributes:!0,attributeOldValue:!0};t.observe(a,e)}else d()&&o.checked&&a.classList.remove(TC.Consts.classes.HIDDEN)};if(o){if(o.checked){u();n._downloadDialogExtNode.classList.remove(TC.Consts.classes.HIDDEN)}else n._downloadDialogExtNode.classList.contains(TC.Consts.classes.HIDDEN)||n._downloadDialogExtNode.classList.add(TC.Consts.classes.HIDDEN);o.addEventListener("change",function(){u();n._downloadDialogExtNode.classList.toggle(TC.Consts.classes.HIDDEN)})}if(r){u();r.forEach(t=>{if(!t.dataset.hasChangeEvent){t.dataset.hasChangeEvent=!0;t.addEventListener("change",async function(t){if(t.target.checked){u();let a;if("track"===t.target.value)a=l;else{let t=l,o=t.filter(t=>TC.feature.Polyline&&t instanceof TC.feature.Polyline)[0];e&&(a=t.filter(t=>TC.feature.Point&&t instanceof TC.feature.Point));let i=o.uid,c=P(i);if(c){let t=o.clone();t.setCoords(c.data.secondaryElevationProfileChartData[0].coords);if(e){a||(a=x.call(n)||[]);a.push(t)}else a=t}else{n._downloadDialog.modalBody.classList.add(TC.Consts.classes.LOADING);let t=await async function(t){const e=this;let n=O(t);if(n){console.log("Tengo datos en cache");return n.data}{console.log("NO tengo datos en cache");const n=await e.getElevationTool();if(n){let a=t.clone();try{let o=await n.setGeometry({features:[a],crs:e.map.crs});N(t,o[0]);return o[0]}catch(t){return null}}}}.call(n,o);if(t)e?a.push(t):a=t;else{n.map.toast(n.getLocaleString("elevation.error"),{type:TC.Consts.msgType.ERROR,duration:5e3});r[0].checked=!0}n._downloadDialog.modalBody.classList.remove(TC.Consts.classes.LOADING)}}n._downloadDialog.setFeatures(a)}})}});if(r[0].classList.contains(TC.Consts.classes.DISABLED)||"mdt"===document.querySelector("."+n.CLASS+"-ext-dldlog input[type=radio]:checked").value){const t=r[1];t.checked=!0;t.dispatchEvent(new Event("change"))}}1===l.length&&l[0].fileName&&n._downloadDialog.setOptions({fileName:l[0].fileName})}}};t.getDownloadDialogOptions=function(t){const e=this,n={title:e.getLocaleString("download"),fileName:t,openCallback:function(){e.onShowDownloadDialog(e,!0)}};e.options.displayElevation?n.elevation={resolution:e.options.displayElevation&&e.options.displayElevation.resolution||e.map.options.elevation&&e.map.options.elevation.resolution||20,sampleNumber:e.options.displayElevation&&e.options.displayElevation.sampleNumber||e.map.options.elevation&&e.map.options.elevation.sampleNumber||0,checked:!0}:n.elevation={checked:!0};return n};var l=!0;t.renderData=function(a,o){const s=this;var u=s.Const.Selector;return TC.Control.prototype.renderData.call(s,a,function(){const a=s.div.querySelectorAll(s._classSelector+"-panel");s.div.querySelectorAll("."+s.CLASS+"-select span").forEach(function(t){t.addEventListener(TC.Consts.event.CLICK,function(t){for(var e=t.target;e&&"LABEL"!==e.tagName;)e=e.parentElement;const n=e.querySelector(`input[type=radio][name="${s.id}-mode"]`).value;a.forEach(function(t){t.classList.toggle(TC.Consts.classes.HIDDEN,!t.matches("."+s.CLASS+"-"+n))})},{passive:!0})});s.track={activateButton:s.div.querySelector(s._classSelector+"-track-ui-activate"),deactivateButton:s.div.querySelector(s._classSelector+"-track-ui-deactivate"),trackSearch:s.div.querySelector(s._classSelector+"-track-available-srch"),trackImportFile:s.div.querySelector(s._classSelector+"-track-import"),trackSave:s.div.querySelector(s._classSelector+"-track-save"),trackAdd:s.div.querySelector(s._classSelector+"-track-add-wpt"),trackContinue:s._dialogDiv.querySelector("."+s.CLASS+"-track-continue"),trackRenew:s._dialogDiv.querySelector("."+s.CLASS+"-track-new"),trackClose:s._dialogDiv.querySelector("."+s.CLASS+"-continue-track-dialog button.tc-modal-close"),trackAdvertisementOK:s._dialogDiv.querySelector("."+s.CLASS+"-track-advert-ok")};s.track.trackList=s.div.querySelector(s._classSelector+"-track-available-lst");s.track.trackToolPanelOpened=s.div.querySelector("#tc-ctl-geolocation-track-panel-opened-"+s.id);s.div.querySelector("."+t.CLASS+"-track-panel-help").addEventListener("click",function(){c.call(s)});s.track.trackName=s.div.querySelector(s._classSelector+"-track-title");s.track.trackWPT=s.div.querySelector(s._classSelector+"-track-waypoint");TC.Util.detectMobile()&&matchMedia("screen and (max-height: 50em) and (max-width: 50em)").matches&&(s.track.trackToolPanelOpened.checked=!1);if(window.File&&window.FileReader&&window.FileList&&window.Blob){s.track.trackImportFile.disabled=!1;s.track.trackImportFile.addEventListener(TC.Consts.event.CLICK,function(t){const e=document.createElement("form"),n=this.parentElement;n.insertBefore(e,this);e.appendChild(this);e.reset();e.insertAdjacentElement("afterend",this);n.removeChild(e)},{passive:!0});const t=function(){s.map.off(TC.Consts.event.LAYERERROR,t);s.clearFileInput(s.track.trackImportFile);TC.alert(s.getLocaleString("geo.trk.upload.error3"))};s.track.trackImportFile.addEventListener("change",function(e){if(!s._cleaning){s.clear(s.Const.Layers.TRACK);if(s.map){s.map.on(TC.Consts.event.LAYERERROR,t);s.map.wrap.loadFiles(e.target.files,{control:s})}}})}else console.log("no es posible la importaci\xf3n");s.track.activateButton.addEventListener("click",function(){s.activateTracking();r.call(s)});s.track.deactivateButton.addEventListener("click",function(){s.deactivateTracking();i.call(s)});const A=function(){!function(t){t=t.toLowerCase();const e=Array.from(s.track.trackList.querySelectorAll("li"));e.forEach(function(t){t.style.display="none"});const n=e.filter(function(t){return t.matches("li:not([class]),li."+s.Const.Classes.SELECTEDTRACK)}),a=s.div.querySelector(s._classSelector+"-track-search-icon");if(0===t.length){n.forEach(function(t){t.style.display=""});a.style.visibility="visible"}else{a.style.visibility="hidden";var o=new RegExp(t,"i");n.forEach(function(t){t.style.display=o.test(t.querySelector("span").textContent)?"":"none"});n.some(function(t){return""===t.style.display})||e.forEach(function(t){t.matches('[class^="tc-ctl-geolocation-track-not"]')&&(t.style.display="")})}}(this.value.toLowerCase().trim())};s.track.trackSearch.addEventListener("keyup",A);s.track.trackSearch.addEventListener("search",A);s.track.trackSave.addEventListener("click",s.saveTrack.bind(s));s.track.trackAdd.addEventListener("click",s.addWaypoint.bind(s));const f=s.div.querySelector(s._classSelector+"-track-available-lst");var m=function(t,e){"LI"!==e.tagName&&(e=e.parentElement);const n=e.querySelector("input"),a=e.querySelector("span");if(t){n.classList.remove(TC.Consts.classes.HIDDEN);n.focus();n.value=a.textContent;a.classList.add(TC.Consts.classes.HIDDEN);e.dataset.title=e.title;e.title="";e.querySelector(u.SIMULATE).classList.add(TC.Consts.classes.HIDDEN);e.querySelector(u.EDIT).classList.add(TC.Consts.classes.HIDDEN);e.querySelector(u.DELETE).classList.add(TC.Consts.classes.HIDDEN);e.querySelector(u.DRAW).classList.add(TC.Consts.classes.HIDDEN);e.querySelector(u.EXPORT).classList.add(TC.Consts.classes.HIDDEN);e.querySelector(u.SHARE).classList.add(TC.Consts.classes.HIDDEN);e.querySelector(u.SAVE).classList.remove(TC.Consts.classes.HIDDEN);e.querySelector(u.CANCEL).classList.remove(TC.Consts.classes.HIDDEN)}else{n.classList.add(TC.Consts.classes.HIDDEN);a.classList.remove(TC.Consts.classes.HIDDEN);e.title=e.dataset.title;delete e.dataset.title;e.querySelector(u.SIMULATE).classList.remove(TC.Consts.classes.HIDDEN);e.querySelector(u.EDIT).classList.remove(TC.Consts.classes.HIDDEN);e.querySelector(u.DELETE).classList.remove(TC.Consts.classes.HIDDEN);e.querySelector(u.DRAW).classList.remove(TC.Consts.classes.HIDDEN);e.querySelector(u.EXPORT).classList.remove(TC.Consts.classes.HIDDEN);e.querySelector(u.SHARE).classList.remove(TC.Consts.classes.HIDDEN);e.querySelector(u.SAVE).classList.add(TC.Consts.classes.HIDDEN);e.querySelector(u.CANCEL).classList.add(TC.Consts.classes.HIDDEN)}};s.uiSimulate=function(t,e){if(e){var n=[u.SIMULATE,u.EDIT,u.DELETE,u.EXPORT,u.SHARE],a=[u.STOP,u.PAUSE,u.BACKWARD,u.FORWARD,u.SPEED],o="LI"===e.tagName?e:e.parentNode;n.forEach(function(e){o.querySelector(e).hidden=t});a.forEach(function(e){o.querySelector(e).hidden=!t})}};f.addEventListener("click",TC.EventTarget.listenerBySelector(u.SIMULATE,function(t){var e=s.getLoadingIndicator().addWait();t.target.parentElement.querySelector(u.SPEED).textContent="x 1";g(s,t.target).then(function(){s.getLoadingIndicator().removeWait(e)})}));f.addEventListener("click",TC.EventTarget.listenerBySelector(u.DRAW,function(t){var e=s.getLoadingIndicator().addWait();p(s,t.target).then(function(){s.getLoadingIndicator().removeWait(e)})}));s.on(s.Const.Event.IMPORTEDTRACK,function(t){if(s.isDisabled)s.map.toast(s.getLocaleString("geo.trk.import.disabled"),{type:TC.Consts.msgType.WARNING});else{const e=s.track.trackList.querySelector('li[data-id="'+t.index+'"]');p(s,e.querySelector(u.DRAW)).then(function(){if(s.loadingState){delete s.loadingState;delete s.toShare}});setTimeout(function(){s.track.trackList.scrollTop=t.index*e.offsetHeight},100)}});const h=function(t,e){t.track.trackList.querySelectorAll("li[data-id]").forEach(function(n){if(n.dataset.id!==e){const e=n.querySelector(u.SIMULATE),a=n.querySelector(u.PAUSE);e.classList.remove(t.Const.Classes.SIMULATIONACTIVATED);e.setAttribute("title",t.getLocaleString("tr.lst.simulate"));a.classList.remove("play");a.setAttribute("title",t.getLocaleString("tr.lst.pause"));t.uiSimulate(!1,n);m(!1,n)}})};var p=function(t,n){return new Promise(function(a,o){const l=n.parentElement;setTimeout(function(){if(l.classList.contains(t.Const.Classes.SELECTEDTRACK)){t.uiSimulate(!1,n);t.clear(t.Const.Layers.TRACK);t.map.off(TC.Consts.event.FEATUREREMOVE,e);n.setAttribute("title",n.textContent)}else if(t.getSelectedTrack()){h(t,l.dataset.id);t.working=t.drawTrack(l)}else t.working=t.drawTrack(l);l.classList.contains(t.Const.Classes.SELECTEDTRACK)?t.prepareFeaturesToShare({uid:l.dataset.uid,setFeaturesToShare:!0}).then(function(){a()}):a()},0)})},g=function(t,e){return new Promise(function(n,a){setTimeout(function(){const a=e.parentElement,o=t.getSelectedTrack();h(t,a.dataset.id);t.uiSimulate(!1,o);t.uiSimulate(!0,e);o&&a.dataset.id!==o.dataset.id&&t.clear(t.Const.Layers.TRACK);t.simulate_paused=!1;t.simulateTrack(a);n()},0)})};f.addEventListener("click",TC.EventTarget.listenerBySelector(s._classSelector+" "+u.EDIT,function(t){m(!0,t.target)}));f.addEventListener("click",TC.EventTarget.listenerBySelector(s._classSelector+" "+u.DELETE,function(t){s.removeTrack(t.target.parentElement)}));f.addEventListener("click",TC.EventTarget.listenerBySelector(s._classSelector+" "+u.SAVE,function(t){if(0===t.target.parentElement.querySelector("input").value.trim().length)TC.alert(s.getLocaleString("geo.trk.edit.alert"));else{s.editTrackName(t.target.parentElement.dataset.id,t.target.parentElement.querySelector("input").value);m(!1,t.target)}}));f.addEventListener("click",TC.EventTarget.listenerBySelector(s._classSelector+" "+u.CANCEL,function(t){m(!1,t.target)}));f.addEventListener("click",TC.EventTarget.listenerBySelector(s._classSelector+" "+u.SHARE,function(t){s.shareTrack(t.target.parentElement).then(function(){s.showShareDialog(s._shareDialogDiv)})}));f.addEventListener("click",TC.EventTarget.listenerBySelector(s._classSelector+" "+u.EXPORT,function(t){const e=t.target.parentElement;t.target.setAttribute("disabled","");s.export(e).then(a=>{s.getDownloadDialog().then(function(o){const l=s.getDownloadDialogOptions(n.call(s,e));o.open(a.map(t=>{t.uid=e.dataset.uid;return t}),l);t.target.removeAttribute("disabled")})})}));f.addEventListener("click",TC.EventTarget.listenerBySelector(s._classSelector+" "+u.STOP,function(t){s.uiSimulate(!1,t.target);s.wrap.simulateTrackEnd();const e=t.target.parentElement.querySelector(u.PAUSE);e.classList.remove("play");e.setAttribute("title",s.getLocaleString("tr.lst.pause"));t.target.parentElement.querySelector(u.SPEED).textContent="x 1";s.simulate_speed=1}));f.addEventListener("click",TC.EventTarget.listenerBySelector(s._classSelector+" "+u.PAUSE,function(t){s.simulate_paused=!t.target.classList.contains("play");s.simulate_paused&&(s.simulate_pausedElapse=-1);t.target.setAttribute("title",s.getLocaleString(s.simulate_paused?"tr.lst.play":"tr.lst.pause"));t.target.classList.toggle("play",!!s.simulate_paused)}));f.addEventListener("click",TC.EventTarget.listenerBySelector(s._classSelector+" "+u.BACKWARD,function(t){1==s.simulate_speed?s.simulate_speed=.5:s.simulate_speed=s.simulate_speed/2;t.target.parentElement.querySelector(s._classSelector+" "+u.FORWARD).disabled=!1;t.target.parentElement.querySelector(u.SPEED).textContent=s.simulate_speed<1?"/ "+1/s.simulate_speed:"x "+s.simulate_speed;.000244140625==s.simulate_speed&&(t.target.disabled=!0)}));f.addEventListener("click",TC.EventTarget.listenerBySelector(s._classSelector+" "+u.FORWARD,function(t){s.simulate_speed=s.simulate_speed/.5;t.target.parentElement.querySelector(u.SPEED).textContent=s.simulate_speed<1?"/ "+1/s.simulate_speed:"x "+s.simulate_speed;t.target.parentElement.querySelector(s._classSelector+" "+u.BACKWARD).disabled=!1;4096==s.simulate_speed&&(t.target.disabled=!0)}));s.track.trackContinue.addEventListener("click",function(){TC.Util.closeModal();d.call(s)});s.track.trackRenew.addEventListener("click",function(){delete s.sessionTracking;TC.Util.storage.setSessionLocalValue(s.Const.LocalStorageKey.TRACKINGTEMP,void 0);localforage.removeItem(s.Const.LocalStorageKey.TRACKINGTEMP);TC.Util.closeModal();d.call(s)});s.track.trackClose.addEventListener("click",function(){i.call(s)});s.track.trackAdvertisementOK.addEventListener("click",function(){const t=document.body.querySelectorAll('input[name*="Advertisement"]:checked');if(t.length>0){new Promise(function(t,e){window.localforage?t():TC.loadJS(!window.localforage,[TC.Consts.url.LOCALFORAGE],function(){t()})}).then(function(){localforage.setItem(t[0].getAttribute("name"),!1)})}TC.Util.closeModal()});s.track.renderTrack=s.div.querySelector("#tc-ctl-geolocation-track-render-"+s.id);s.track.renderTrack.addEventListener("change",function(){s.track.activateButton.classList.contains(TC.Consts.classes.HIDDEN)&&s.layerTracking.setVisibility(this.checked);l=this.checked});window.localforage?s.bindTracks():TC.loadJS(!window.localforage,[TC.Consts.url.LOCALFORAGE],function(){s.bindTracks()});TC.Util.isFunction(o)&&o()})};t.shareTrack=function(t){const e=this;return e.getShareDialog(e._shareDialogDiv).then(function(){return e.prepareFeaturesToShare({uid:t.dataset.uid,setFeaturesToShare:!1}).then(function(n){e.toShare={trackName:t.querySelector("span").innerHTML,features:n}})})};t.activate=function(){};t.deactivate=function(){TC.Util.closeModal();this.clearSelection();this.deactivateTracking()};var r=function(){this.track.activateButton.classList.add(TC.Consts.classes.HIDDEN);this.track.deactivateButton.classList.remove(TC.Consts.classes.HIDDEN)},i=function(){this.track.activateButton.classList.remove(TC.Consts.classes.HIDDEN);this.track.deactivateButton.classList.add(TC.Consts.classes.HIDDEN)},c=function(){this.map.toast(this.div.querySelector(".alert-warning").innerHTML,{duration:1e4})};t.markerStyle={radius:10,fillColor:[255,0,0,100],strokeColor:[255,255,255,255],strokeWidth:2};t.lineStyle={strokeWidth:2,strokeColor:[0,206,209,255]};t.setFormatInfoNewPosition=function(t){var e={},n=TC.Util.getMapLocale(this.map);if(this.map.on3DView){var a=this.map.crs!==this.map.view3D.crs?TC.Util.reproject(t.position,this.map.crs,this.map.view3D.crs):t.position;e.x=a[0].toLocaleString(n);e.y=a[1].toLocaleString(n);e.mdt=Math.round(this.map.view3D.getHeightFromMDT(a)).toLocaleString(n);e.isGeo=!0}else{e.x=Math.round(t.position[0]).toLocaleString(n);e.y=Math.round(t.position[1]).toLocaleString(n)}e.z=Math.round(t.altitude).toLocaleString(n);e.accuracy=Math.round(t.accuracy).toLocaleString(n);e.speed=t.speed.toLocaleString(n,{minimumFractionDigits:1,maximumFractionDigits:1});return e};t.getTrackInfoPanel=function(){const t=this;t.track._infoPanelPromise||(t.track._infoPanelPromise=new Promise(function(e,n){if(t.track.infoPanel)e(t.track.infoPanel);else{var a,o={content:"table",resize:!1,titles:{main:t.getLocaleString("geo.mylocation"),max:t.getLocaleString("geo.mylocation.show")},classes:{collapsed:"tracking"}};const n=function(t){o.position=t.POSITION.RIGHT;a=t.addControl("resultsPanel",o)};let r;!t.options.displayElevation&&t.options.displayOn?r=t.options.displayOn:t.options.displayElevation&&(r=t.options.displayElevation.displayOn);if(r){var l=t.map.getControlsByClass("TC.control."+r[0].toUpperCase()+r.substring(1))[0];l?n(l):t.map.addControl(r).then(n)}else{o.div=document.createElement("div");t.map.div.appendChild(o.div);a=t.map.addControl("resultsPanel",o)}a.then(function(n){t.track.infoPanel=n;e(n)})}}));return t.track._infoPanelPromise};t.renderInfoNewPosition=function(t){const e=this;e.getRenderedHtml(e.CLASS+"-tracking-toast",e.setFormatInfoNewPosition(t.pd),function(t){e.getTrackInfoPanel().then(function(n){if(!n.isMinimized()){e.map.getControlsByClass(TC.control.ResultsPanel).filter(t=>t.content===t.contentType.TABLE&&t!==n).forEach(function(t){t.close()});n.renderPromise().then(function(){n.options.collidingPriority=n.COLLIDING_PRIORITY.IGNORE;n.open(t)})}})})};var s=function(){this.track.trackToolPanelOpened.checked||this.map.trigger(TC.Consts.event.TOOLSCLOSE)},d=function(){var t=this;t.activate();r.call(t);s.call(t);t.on(t.Const.Event.POSITIONCHANGE,function(e){t.currentPoint=e.pd;t.renderInfoNewPosition(e);t.track.trackName.disabled=!1;t.track.trackSave.disabled=!1;t.track.trackWPT.disabled=!1;t.track.trackAdd.disabled=!1;TC.Util.storage.setSessionLocalValue(t.Const.LocalStorageKey.TRACKINGTEMP,t.wrap.formattedToStorage(t.layerTracking).features)});t.on(t.Const.Event.STATEUPDATED,function(t){});t.clear(t.Const.Layers.TRACKING);w.call(t,t.Const.LocalStorageKey.TRACKINGSHOWADVERTISEMENT);t.wrap.setTracking(!0)};let u=!1,A=null,f=null;"wakeLock"in navigator&&(u=!0);let m=null;var h,p,g,C=function(){var t=m=this;if(u){(async()=>{try{A=await navigator.wakeLock.request("screen");console.log("Wake Lock active");A.addEventListener("release",()=>{console.log("Wake Lock released")})}catch(t){console.error(t)}})()}else v.apply(t)},v=function(){if(!this.videoScreenOn){var t={WebM:"data:video/webm;base64,GkXfo0AgQoaBAUL3gQFC8oEEQvOBCEKCQAR3ZWJtQoeBAkKFgQIYU4BnQI0VSalmQCgq17FAAw9CQE2AQAZ3aGFtbXlXQUAGd2hhbW15RIlACECPQAAAAAAAFlSua0AxrkAu14EBY8WBAZyBACK1nEADdW5khkAFVl9WUDglhohAA1ZQOIOBAeBABrCBCLqBCB9DtnVAIueBAKNAHIEAAIAwAQCdASoIAAgAAUAmJaQAA3AA/vz0AAA=",MP4:"data:video/mp4;base64,AAAAHGZ0eXBpc29tAAACAGlzb21pc28ybXA0MQAAAAhmcmVlAAAAG21kYXQAAAGzABAHAAABthADAowdbb9/AAAC6W1vb3YAAABsbXZoZAAAAAB8JbCAfCWwgAAAA+gAAAAAAAEAAAEAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAIVdHJhawAAAFx0a2hkAAAAD3wlsIB8JbCAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAQAAAAAAIAAAACAAAAAABsW1kaWEAAAAgbWRoZAAAAAB8JbCAfCWwgAAAA+gAAAAAVcQAAAAAAC1oZGxyAAAAAAAAAAB2aWRlAAAAAAAAAAAAAAAAVmlkZW9IYW5kbGVyAAAAAVxtaW5mAAAAFHZtaGQAAAABAAAAAAAAAAAAAAAkZGluZgAAABxkcmVmAAAAAAAAAAEAAAAMdXJsIAAAAAEAAAEcc3RibAAAALhzdHNkAAAAAAAAAAEAAACobXA0dgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAIAAgASAAAAEgAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABj//wAAAFJlc2RzAAAAAANEAAEABDwgEQAAAAADDUAAAAAABS0AAAGwAQAAAbWJEwAAAQAAAAEgAMSNiB9FAEQBFGMAAAGyTGF2YzUyLjg3LjQGAQIAAAAYc3R0cwAAAAAAAAABAAAAAQAAAAAAAAAcc3RzYwAAAAAAAAABAAAAAQAAAAEAAAABAAAAFHN0c3oAAAAAAAAAEwAAAAEAAAAUc3RjbwAAAAAAAAABAAAALAAAAGB1ZHRhAAAAWG1ldGEAAAAAAAAAIWhkbHIAAAAAAAAAAG1kaXJhcHBsAAAAAAAAAAAAAAAAK2lsc3QAAAAjqXRvbwAAABtkYXRhAAAAAQAAAABMYXZmNTIuNzguMw=="};this.videoScreenOn=document.createElement("video");this.videoScreenOn.setAttribute("loop","");this.videoScreenOn.setAttribute("muted","");this.videoScreenOn.setAttribute("webkit-playsinline","");this.videoScreenOn.setAttribute("playsinline","");this.videoScreenOn.setAttribute("style","transform: translateZ(0px);");var e=document.createElement("source");e.src=t.WebM;e.type="video/webm";this.videoScreenOn.appendChild(e);var n=document.createElement("source");n.src=t.MP4;n.type="video/mp4";this.videoScreenOn.appendChild(n)}this.videoScreenOn.play()},k=function(){this.videoScreenOn&&this.videoScreenOn.pause()},T=function(){this.videoScreenOn&&this.videoScreenOn.paused&&this.videoScreenOn.play();L.apply(this)},S=async function(){var t=function(){var t=["webkit","moz","ms","o"];if("hidden"in document)return"hidden";for(var e=0;e<t.length;e++)if(t[e]+"Hidden"in document)return t[e]+"Hidden";return null}();if(document[t]){if(f)if(navigator.serviceWorker&&(navigator.serviceWorker.controller||this.map.getControlsByClass(TC.control.SWCacheClient).length&&"activated"===(await this.map.getControlsByClass(TC.control.SWCacheClient)[0].getServiceWorker()).state))try{(await navigator.serviceWorker.ready).showNotification(this.notificationConf.title,Object.assign(this.notificationConf,{actions:[{action:"back",title:this.getLocaleString("geo.trk.notification.backButton")}],data:{url:document.location.href}}))}catch(t){new Notification(this.notificationConf.title,this.notificationConf)}else{new Notification(this.notificationConf.title,this.notificationConf)}}else null!==A?C.apply(this):T.apply(this);!A&&this.videoScreenOn&&console.log("video is: "+this.videoScreenOn.paused)},y=function(){g||(g=S.bind(this));h||(h=function(){E.apply(this)}.bind(this));p||(p=T.bind(this));window.addEventListener("visibilitychange",g,!1);if(TC.Util.detectSafari()&&TC.browserFeatures.touch()&&!navigator.userAgent.match(/Android/i)&&!navigator.userAgent.match(/CriOS/i)){window.addEventListener("pagehide",h,!1);window.addEventListener("pageshow",p,!1)}else{window.addEventListener("blur",h,!1);window.addEventListener("focus",p,!1)}},E=function(){var t=TC.Util.storage.getSessionLocalValue(this.Const.LocalStorageKey.TRACKINGTEMP);t&&t.length>0&&localforage.setItem(this.Const.LocalStorageKey.TRACKINGTEMP,"string"==typeof t?t:JSON.stringify(t))},L=function(){var t=this;localforage.getItem(t.Const.LocalStorageKey.TRACKINGTEMP).then(function(e){null!==e&&"null"!==e&&e.length>0&&TC.Util.storage.setSessionLocalValue(t.Const.LocalStorageKey.TRACKINGTEMP,e)})},w=function(t){var e=this;new Promise(function(t,e){window.localforage?t():TC.loadJS(!window.localforage,[TC.Consts.url.LOCALFORAGE],function(){t()})}).then(function(){localforage.getItem(t).then(function(n){if(null==n){const n=e._dialogDiv.querySelector(".tc-ctl-geolocation-track-advert-dialog"),a=n.querySelector('input[type="checkbox"]');a.setAttribute("name",t);a.checked=!1;document.querySelector("#pageBlurMsg").textContent=TC.Util.detectMobile()?e.getLocaleString("geo.trk.page.blur"):e.getLocaleString("geo.trk.page.blur.desktop");n.querySelector("h3").textContent=t==e.Const.LocalStorageKey.GPSSHOWADVERTISEMENT?e.getLocaleString("geo.track.activate")+" "+e.getLocaleString("geo.gps"):e.getLocaleString("geo.track.activate.title");TC.Util.showModal(e._dialogDiv.querySelector(".tc-ctl-geolocation-track-advert-dialog"))}})});e.map.toast(TC.Util.detectMobile()?e.getLocaleString("geo.trk.page.blur"):e.getLocaleString("geo.trk.page.blur.desktop"),{type:TC.Consts.msgType.WARNING})};t._askTracking=function(t){TC.Util.showModal(this._dialogDiv.querySelector(".tc-ctl-geolocation-continue-track-dialog"),{closeCallback:function(){TC.Util.isFunction(t)&&t()}});return!0};t.activateTracking=function(){var t=this,e=!0;t.isActive||t.activate();t.clear(t.Const.Layers.TRACKING);try{TC.Util.storage.setSessionLocalValue(t.Const.LocalStorageKey.TEST,t.Const.LocalStorageKey.TEST)}catch(n){n.code===DOMException.QUOTA_EXCEEDED_ERR?TC.alert(t.getLocaleString("geo.error.trackinglocalstorage")):TC.error(n);e=!1}if(e){if(window.Notification||window.webkitNotifications){const t=window.Notification||window.webkitNotifications;"denied"===t.permission?f=null:"granted"===t.permission?f=t:t.requestPermission(function(e){"granted"===e&&(f=t)})}C.apply(t);y.apply(t);t.sessionTracking=TC.Util.storage.getSessionLocalValue(t.Const.LocalStorageKey.TRACKINGTEMP);if(t.sessionTracking){t._askTracking(function(){i.call(t)})||t.track.trackRenew.click()}else d.call(t)}else i.call(t)};t.deactivateTracking=function(){var t=this,e=function(){t.getTrackInfoPanel().then(t=>t.close());E.apply(t);t.wrap.setTracking(!1);delete t.geopositionTracking;l||t.div.querySelector(t._classSelector+"-track-render").querySelector("label").click();(function(){var t=m=this;u?A.release().then(()=>{A=null}):k.apply(t)}).apply(t);(function(){window.removeEventListener("visibilitychange",g,!1);if(TC.Util.detectSafari()&&TC.browserFeatures.touch()&&!navigator.userAgent.match(/Android/i)&&!navigator.userAgent.match(/CriOS/i)){window.removeEventListener("pagehide",h,!1);window.removeEventListener("pageshow",p,!1)}else{window.removeEventListener("blur",h,!1);window.removeEventListener("focus",p,!1)}}).apply(t);t.off(t.Const.Event.POSITIONCHANGE);t.off(t.Const.Event.STATEUPDATED);i.call(t);t.track.trackName.value="";t.track.trackName.disabled=!0;t.track.trackSave.disabled=!0;t.track.trackWPT.value="";t.track.trackWPT.disabled=!0;t.track.trackAdd.disabled=!0;t.clear(t.Const.Layers.TRACKING);t.clear(t.Const.Layers.GPS);return!0};if(t.wrap.hasCoordinates()){t.map.toast(t.getLocaleString("geo.trk.deactivate.alert"),{duration:1e4});return e()}return e()};t.getStoredTracks=function(){const t=this;return new Promise(function(e,n){var a=[];const o=function(t){0===D.length&&t.filter(t=>t.profile).forEach(t=>D.push({uid:t.uid,data:JSON.parse(t.profile)}));e(t)};localforage.keys().then(function(e){if(0==(e=e.filter(function(e){return 0!==e.indexOf(t.Const.LocalStorageKey.TRACKINGTEMP)&&0===e.indexOf(t.Const.LocalStorageKey.TRACKING)&&/trk#\d/i.exec(e)})).length){t.availableTracks=a;o(a)}const n=new Array(e.length);e.forEach(function(t,e){n[e]=new Promise(function(e,n){localforage.getItem(t,function(t,n){e(n)})})});Promise.all(n).then(function(e){if(e&&e.length){e.forEach(function(t){(t=JSON.parse(t))instanceof Array?a=a.concat(t):a.push(t)});var n=a.length>1?b(a):a;t.availableTracks=n;o(n)}})}).catch(e=>{console.log("Capturamos error que se produce por configuraci\xf3n del navegador.");TC.error(t.getLocaleString("couldNotAccessLocalStorage"))})})};var b=function(t){var e=[];for(var n in t)if(t[n]&&"object"==typeof t[n]){e.push(t[n]);e.sort(function(t,e){return"string"==typeof t.name&&TC.Util.isFunction(t.name.localeCompare)?t.name.localeCompare(e.name):0})}return e};t.setStoredTracks=function(t){const e=this;return new Promise(function(n,a){const o=[];t.forEach(function(t){o.push(new Promise(function(n,a){localforage.setItem(e.Const.LocalStorageKey.TRACKING+"#"+t.uid,JSON.stringify(t),function(t,e){n(e)})}))});Promise.all(o).then(function(){e.getStoredTracks().then(function(){e.bindTracks();n()})})})};t.getAvailableTracks=function(){const t=this;return new Promise(function(e,n){t.availableTracks?e(t.availableTracks):t.getStoredTracks().then(function(t){e(t)})})};t.bindTracks=function(){var t=this;t.track.trackList.querySelectorAll("li").forEach(function(t){t.style.display="none"});t.getAvailableTracks().then(function(e){if(M(e)){t.track.trackList.querySelectorAll('li[class^="tc-ctl-geolocation-track-available-empty"]').forEach(function(t){t.style.display=""});t.track.trackSearch.disabled=!0}else{const l=t.getSelectedTrack();var n;l&&(n=l.dataset.uid);t.track.trackList.querySelectorAll("li[data-id]").forEach(function(e){t.track.trackList.removeChild(e)});for(var a=0;a<e.length;a++){var o=e[a];"object"==typeof o&&t.getRenderedHtml(t.CLASS+"-track-node",{id:a,uid:o.uid,name:o.name?o.name.trim():""},function(e){const n=(new DOMParser).parseFromString(e,"text/html").body.firstChild;t.track.trackList.appendChild(n)})}n&&t.setSelectedTrack(t.track.trackList.querySelector('li[data-uid="'+n+'"]'));t.track.trackSearch.disabled=!1}})};t.chartProgressClear=function(){this.getElevationControl().then(t=>t&&t.removeElevationTooltip())};t.chartSetProgress=function(t,e,n,a){var o=this;if(o.elevationControl&&o.elevationControl.resultsPanel&&(!o.elevationControl.resultsPanel.isVisible()||o.elevationControl.resultsPanel.isMinimized()))return;var l,r=t.d,i=o.map.options.locale&&o.map.options.locale.replace("_","-")||void 0;parseInt(e[2].toFixed(0)).toLocaleString(i);if(r/1e3<1){l=Math.round(r/1e3*1e3);" m"}else{l=Math.round(r/1e3*100)/100;" km"}l=l.toLocaleString(i);const c=o.elevationChartData&&o.elevationChartData.secondaryElevationProfileChartData&&Array.isArray(o.elevationChartData.secondaryElevationProfileChartData)&&o.elevationChartData.secondaryElevationProfileChartData.length>0&&o.elevationChartData.secondaryElevationProfileChartData[0];if(c&&o.elevationChartData.secondaryElevationProfileChartData[0].elev&&!o.elevationChartData.secondaryElevationProfileChartData[0].elevCoords&&!o.elevationChartData.secondaryElevationProfileChartData[0].eleCoordinates){let t=[...o.elevationChartData.coords];if(Array.isArray(t)&&Array.isArray(t[0])){t.forEach((t,e)=>{t.splice(2,1,o.elevationChartData.secondaryElevationProfileChartData[0].ele[e])});o.elevationChartData.secondaryElevationProfileChartData[0].elevCoords=o.elevationChartData.secondaryElevationProfileChartData[0].eleCoordinates=t}}let s;if(c&&o.elevationChartData.secondaryElevationProfileChartData[0].eleCoordinates){s=TC.wrap.Geometry.getNearest(e,o.elevationChartData.secondaryElevationProfileChartData[0].eleCoordinates);s=parseInt(s[2].toFixed(0)).toLocaleString(i)}if(o.elevationChartData){let t=0;for(;o.elevationChartData.x[t]<=r;)t++;o.getElevationControl().then(e=>e&&e.getProfilePanel().then(function(e){if(e){e.chart.chart.tooltip.show({x:o.elevationChartData.x[0===t?0:t-1]});e.wrap.hideElevationMarker()}}))}};t._getTime=function(t,e){var n=e-t,a={},o=Math.floor(n/1e3/60/60/24);n-=1e3*o*60*60*24;var l=Math.floor(n/1e3/60/60);n-=1e3*l*60*60;a.h=l+24*o;var r=Math.floor(n/1e3/60);n-=1e3*r*60;a.m=r;a.s=Math.floor(n/1e3);return TC.Util.extend({},a,{toString:("00000"+a.h).slice(-2)+":"+("00000"+a.m).slice(-2)+":"+("00000"+a.s).slice(-2)})};t.simulateTrack=async function(t){var e=this;const n=await e.getElevationControl();n.removeElevationTooltip();e.simulate_speed=1;if(e.getSelectedTrack()===t&&n.resultsPanel&&n.resultsPanel.chart&&n.resultsPanel.chart.chart){e.hasElevation||(e.hasElevation=0!==n.elevationProfileChartData.min||0!==n.elevationProfileChartData.max);e.wrap.simulateTrack()}else e.drawTrack(t,!1).then(function(){if(e.elevationChartData&&0===e.elevationChartData.min&&0===e.elevationChartData.max){e.map.toast(e.getLocaleString("geo.trk.simulate.empty"),{duration:1e4});e.hasElevation=!1}else 0===e.elevationChartData.min&&0===e.elevationChartData.max||(e.hasElevation=!0);e.wrap.simulateTrack()})};t.drawTrack=function(t,e){var n=this;n.clear(n.Const.Layers.TRACK);s.call(n);return new Promise(function(e,a){n.setSelectedTrack(t);n.drawTrackingData(t).then(function(){n.elevationTrack(t).then(()=>{n.activate();e()}).catch(a)})})};const D=[],P=function(t){return D.filter(function(e){return e.uid.toString()===t.toString()})[0]},I=[];const O=function(t){let e=I.filter(function(e){return e.feature===t})[0];return e||I.filter(function(e){return 0===function(t,e){for(var n=[],a=[],o=0;o<t.length;o++)n[t[o]]=!0;for(o=0;o<e.length;o++)n[e[o]]?delete n[e[o]]:n[e[o]]=!0;for(var l in n)a.push(l);return a}(e.feature.geometry,t.geometry).length})[0]},N=function(t,e){var n=O(t);if(!n){n={feature:t};I.push(n)}n.data=e;return n},R=function(t){return TC.feature.Polyline&&t instanceof TC.feature.Polyline},x=function(){return this.layerTrack.features.filter(function(t){return TC.feature.Marker&&!(t instanceof TC.feature.Marker)&&!R(t)})};t.elevationTrack=function(t,a){var o=this;return new Promise((l,r)=>{if(a){o.wrap.simulateTrackEnd(a);o.uiSimulate(!1,t)}else{if(!o.onResize){o.onResize=o.elevationTrack.bind(o,t,!0);window.addEventListener("resize",o.onResize,!1)}o.getElevationControl().then(async function(a){if(a){let i=P(t.dataset.uid);if(i){o.options.displayElevation||delete i.data.secondaryElevationProfileChartData[0];o.elevationChartData=i.data;a.getProfilePanel().then(function(t){t.renderPromise().then(function(){t.doVisible();a.renderElevationProfile(o.elevationChartData)});t.setCurrentFeature()})}else{const l=await o.getTrackingData(t);if(o.layerTrack&&o.layerTrack.features){let i=o.layerTrack.features.filter(t=>R(t)&&(l.layout===ol.geom.GeometryLayout.XYZM||l.layout===ol.geom.GeometryLayout.XYZ||o.options.displayElevation));if(i.length>0){let r=i[0],c={};if(l.layout==ol.geom.GeometryLayout.XYZM||l.layout==ol.geom.GeometryLayout.XYM){let t=0;t=l.layout==ol.geom.GeometryLayout.XYZM?r.geometry[r.geometry.length-1][3]-r.geometry[0][3]:r.geometry[r.geometry.length-1][2]-r.geometry[0][2];c={s:Math.floor(t/1e3%60),m:Math.floor(t/6e4%60),h:Math.floor(t/36e5%24)}}let s={originalElevation:!0,onlyOriginalElevation:!o.options.displayElevation,ignoreCaching:!0,time:c,callback:function(){o.elevationChartData=a.elevationProfileChartData;o.hasElevation=0!==a.elevationProfileChartData.min||0!==a.elevationProfileChartData.max;(function(t,e,n){const a=this;var o=P(n);if(!o){o={uid:parseFloat(n)};D.push(o);a.getAvailableTracks().then(function(t){if(t){let o=t.findIndex(t=>t.uid.toString()===n);if(o>-1){t[o].profile=JSON.stringify(e);a.setStoredTracks(t)}}})}o.data=e;return o}).call(o,function(){return this.layerTrack.features.filter(function(t){return R(t)})[0]}.call(o),a.elevationProfileChartData,t.dataset.uid);e=e.bind(o);o.map.on(TC.Consts.event.FEATUREREMOVE,e);resultsPanelChart.div.addEventListener("mouseover",function(t){o.layerTrack&&o.layerTrack.getVisibility()&&o.layerTrack.getOpacity()>0&&o.wrap.activateSnapping.call(o.wrap)});resultsPanelChart.div.addEventListener("mouseout",function(t){o.layerTrack&&!o.layerTrack.getVisibility()&&0==o.layerTrack.getOpacity()&&o.wrap.deactivateSnapping.call(o.wrap)});o.map.on(TC.Consts.event.RESULTSPANELMIN,function(){o.chartProgressClear()}).on(TC.Consts.event.RESULTSPANELCLOSE,function(){o.chartProgressClear()});a.getProfilePanel().then(function(t){o.getSelectedTrack()&&(t.currentFeature.fileName=n.call(o,o.getSelectedTrack()))})}};a.displayElevationProfile(r,s)}else r()}else r()}l()}else r()}).catch(r)}})};t.clear=function(t){var e=this;if(e.onResize){window.removeEventListener("resize",e.onResize,!1);e.onResize=void 0}if(t==e.Const.Layers.TRACK){e.layerTrack.clearFeatures();e.getElevationControl().then(t=>t&&t.closeElevationProfile());delete e.elevationChartData;e.wrap.simulateTrackEnd();e.wrap.clear();e.track.trackList.querySelectorAll("li").forEach(function(t){t.classList.remove(e.Const.Classes.SELECTEDTRACK)});e.map.trigger(e.Const.Event.CLEARTRACK);e.featuresToShare=[];e.loadingState||delete e.toShare}else{e.layerTracking.clearFeatures();e.layerGPS.clearFeatures()}};t.saveTrack=function(t){const e=this;return new Promise(function(n,a){let o=t.message||e.getLocaleString("geo.trk.save.alert");var l=function(l){let r;r=e.getLoadingIndicator().addWait();let i=t.importedFileName||e.track.trackName.value.trim(),c=e.availableTracks;c||(c=[]);let d=e.wrap.formattedToStorage(l,!0,t.notReproject),u=function(t){e.track.trackName.value="";e.track.trackName.disabled=!0;e.track.trackSave.disabled=!0;e.track.trackWPT.value="";e.track.trackWPT.disabled=!0;e.track.trackAdd.disabled=!0;e.getLoadingIndicator().removeWait(t);s.call(e)},A={name:i,data:d.features,layout:d.layout,crs:e.storageCRS};const f=function(t){let e=JSON.parse(JSON.stringify(t));e.data=e.data.replace(/(\"id\"\s?\:\s?\"[a-z0-9]+\")/gi,'""');return hex_md5(JSON.stringify(e))};TC.loadJS(!window.hex_md5,[TC.apiLocation+TC.Consts.url.HASH],function(){let t=f(A),l=c.map(function(e){let n=JSON.parse(JSON.stringify(e));delete n.uid;delete n.profile;if(t===f(n))return e.uid;{const a=new ol.format.GeoJSON;let o=a.readFeatures(n.data),l=Math.pow(10,TC.Consts.DEGREE_PRECISION+1);o.forEach(function(t){let e=TC.Util.explodeGeometry(TC.Util.compactGeometry(t.getGeometry().getCoordinates(),l));t.getGeometry().setCoordinates(e)});n.data=a.writeFeatures(o);return t===hex_md5(JSON.stringify(n))?e.uid:null}}).filter(function(t){return null!==t});const i=function(t){return e.getStoredTracks().then(function(){e.bindTracks();let n;for(var a=0;a<e.availableTracks.length;a++)if(e.availableTracks[a].uid===t){n=a;break}return n})};if(0===l.length){A.uid=Date.now()+Math.random();c.push(A);c=b(c);try{e.setStoredTracks(c).then(function(){e.map.toast(o,{duration:3e3});u(r);i(A.uid).then(function(t){n(t)})})}catch(t){TC.alert(e.getLocaleString("geo.error.savelocalstorage")+": "+t.message);u(r);a(t)}}else{console.log("Ya existe un track con ese mismo hash");u(r);i(l[0]).then(function(t){n(t)})}})};if(e.importedFileName)l(e.layerTrack);else if(0==e.track.trackName.value.trim().length){e.track.trackName.value=(new Date).toLocaleString();l(e.layerTracking)}else l(e.layerTracking)})};t.addWaypoint=function(){var t=this.track.trackWPT.value.trim();t||(t=(new Date).toLocaleString());var e=this.getLoadingIndicator().addWait();s.call(this);this.wrap.addWaypoint(this.currentPoint.position,{name:t,ele:this.currentPoint.heading,time:(new Date).getTime()});this.track.trackWPT.value="";this.track.trackWPT.disabled=!0;this.track.trackAdd.disabled=!0;TC.Util.storage.setSessionLocalValue(this.Const.LocalStorageKey.TRACKINGTEMP,this.wrap.formattedToStorage(this.layerTracking).features);this.getLoadingIndicator().removeWait(e)};t.editTrackName=function(t,e){var n=this;n.getAvailableTracks().then(function(a){if(a&&a[t]){a[t].name=e;n.setStoredTracks(a)}})};t.removeTrack=function(t){var e=this;e.getAvailableTracks().then(function(n){if(n){var a=t.dataset.id;if(n[a]){var o=n[a].uid;TC.confirm(e.getLocaleString("geo.trk.delete.alert"),function(){const t=e.getSelectedTrack();t&&t.dataset.id===a&&e.clear(e.Const.Layers.TRACK);localforage.removeItem(e.Const.LocalStorageKey.TRACKING+"#"+o).then(function(){e.getStoredTracks().then(function(){e.bindTracks()})}).catch(function(t){console.log(t)})},function(){})}}})};t.setSelectedTrack=function(t){var e=this;e.isActive||e.activate();e.track.trackList.querySelectorAll("li[data-id] > span").forEach(function(t){t.setAttribute("title",t.textContent)});e.track.trackList.querySelectorAll("li").forEach(function(t){t.classList.remove(e.Const.Classes.SELECTEDTRACK)});t.classList.add(e.Const.Classes.SELECTEDTRACK);t.setAttribute("title",e.getLocaleString("tr.lst.clear")+" "+t.querySelector("span").textContent);t.querySelector(e.Const.Selector.DRAW).setAttribute("title",t.getAttribute("title"));e.loadingState||delete e.toShare};t.getSelectedTrack=function(){return this.track.trackList.querySelector("li."+this.Const.Classes.SELECTEDTRACK)};t.clearSelectedTrack=function(){const t=this,e=t.getSelectedTrack();if(e){if(t.onResize){window.removeEventListener("resize",t.onResize,!1);t.onResize=void 0}e.classList.remove(t.Const.Classes.SELECTEDTRACK);e.setAttribute("title",e.textContent);e.querySelector(t.Const.Selector.DRAW).setAttribute("title",e.getAttribute("title"));delete t.toShare}};t.clearSelection=function(){this.wrap.deactivateSnapping();this.getSelectedTrack()&&this.clearSelectedTrack();if(this.resultsPanelChart){this.resultsPanelChart.div.removeEventListener("mouseover",this.resultsPanelChart.deactivateSnapping);this.resultsPanelChart.div.removeEventListener("mouseout",this.resultsPanelChart.activateSnapping);this.resultsPanelChart.close()}this.clear(this.Const.Layers.TRACK)};t.drawTrackingData=function(t){const e=this;return new Promise(function(n,a){e.wrap.clear();e.getTrackingData(t).then(function(t){t.data;t.data&&e.wrap.drawTrackingData(t).then(function(){var t=e.layerTrack.features;if(t&&t.length>0){var a=t.filter(function(t){t.showsPopup=!1;return!!(TC.feature.MultiPolyline&&t instanceof TC.feature.MultiPolyline)||t instanceof TC.feature.Polyline}).map(function(t){return TC.feature.MultiPolyline&&t instanceof TC.feature.MultiPolyline?t.geometry[0]:t instanceof TC.feature.Polyline?t.geometry:void 0})[0];if(a){var o=a[0],l=a[a.length-1];o&&o!==l&&e.layerTrack.addMarker(o.slice().splice(0,2),{showsPopup:!1,cssClass:e.CLASS+"-track-marker-icon-end",anchor:[.5,1],notExport:!0});l&&e.layerTrack.addMarker(l.slice().splice(0,2),{showsPopup:!1,cssClass:e.CLASS+"-track-marker-icon",anchor:[.5,1],notExport:!0})}}e.layerTrack.setVisibility(!0);n()})})})};t.getTrackingData=function(t){const e=this;return new Promise(function(n,a){e.getAvailableTracks().then(function(a){if(a){const l=t.dataset.id;if(a[l]){var o=a[l].data;o=e.wrap.formattedFromStorage(o);n({data:o,layout:a[l].layout})}}else n()})})};t.export=function(t){return this.wrap.export(t)};t.clearFileInput=function(t){const e=document.createElement("form"),n=t.parentElement;n.insertBefore(e,t);e.appendChild(t);e.reset();e.insertAdjacentElement("afterend",t);n.removeChild(e)};t.getLoadingIndicator=function(){if(!this.loading){this.loading=this.map.getControlsByClass(TC.control.LoadingIndicator);this.loading&&this.loading.length>0&&(this.loading=this.loading[0])}return this.loading};t.onGeolocateError=function(t){var e;if(navigator.geolocation){this.currentPosition&&navigator.geolocation.clearWatch(this.currentPosition);if(this.currentPositionTrk){this.currentPositionTrk=this.currentPositionTrk instanceof Array?this.currentPositionTrk:[this.currentPositionTrk];this.currentPositionTrk.forEach(function(t){navigator.geolocation.clearWatch(t)});this.currentPositionTrk=[]}}this.currentPositionWaiting&&this.getLoadingIndicator().removeWait(this.currentPositionWaiting);switch(t.code){case t.PERMISSION_DENIED:e=this.getLocaleString("geo.error.permission_denied");break;case t.POSITION_UNAVAILABLE:e=this.getLocaleString("geo.error.position_unavailable");break;case t.TIMEOUT:e=this.getLocaleString("geo.error.timeout");break;default:e=this.getLocaleString("geo.error.default")}this.map.toast(e,{type:TC.Consts.msgType.WARNING});if(!this.geopositionTracking&&this.track){this.track.activateButton.classList.remove(TC.Consts.classes.HIDDEN);this.track.deactivateButton.classList.add(TC.Consts.classes.HIDDEN)}};var M=function(t){return!t||0===t.length};t.exportState=function(){const t=this;if(t.layerTrack&&t.track||t.toShare){let e={id:t.id};if(!t.toShare||t.toShare&&!t.toShare.doZoom){t.toShare={doZoom:!1};let n=Object.assign({},t.toShare),a=t.layerTrack.features;if(a.length>0&&t.featuresToShare&&t.featuresToShare.length>0)n.features=t.featuresToShare;else{const e=t.layerTrack.exportState({features:a});n.features=e.features}const o=t.getSelectedTrack();o&&(n.trackName=o.querySelector("span").innerHTML);e.trackResult=JSON.stringify(n)}else e.trackResult=JSON.stringify(t.toShare);return e}return null};t.importState=function(t){const e=this;if(e.map&&t.trackResult&&t.trackResult.length){e.enable();let n=JSON.parse(t.trackResult);if(n.features&&n.features.length>0){const t=new Array(n.features.length);n.features.forEach(function(e,n){const a={data:e.data,id:e.id,showsPopup:e.showsPopup};var o=e.geom;switch(e.type){case TC.Consts.geom.POLYLINE:t[n]=new TC.feature.Polyline(o,a);break;case TC.Consts.geom.MULTIPOLYLINE:t[n]=new TC.feature.MultiPolyline(o,a);break;case TC.Consts.geom.MARKER:t[n]=new TC.feature.Marker(o,a);break;case TC.Consts.geom.POINT:t[n]=new TC.feature.Point(o,a)}});if(n.hasOwnProperty("doZoom")){e.loadingState=!0;e.toShare={doZoom:n.doZoom}}Promise.all(t).then(function(t){var a={features:t,fileName:n.trackName,notReproject:!0,isShared:!0};e.availableTracks?e.importTrack(a):e.getStoredTracks().then(function(){e.importTrack(a)})})}}}}();
//# sourceMappingURL=../maps/control/Geolocation.min.js.map