Math.hypot=Math.hypot||function(){for(var t=0,e=arguments.length,n=0;n<e;n++){if(arguments[n]===1/0||arguments[n]===-1/0)return 1/0;t+=arguments[n]*arguments[n]}return Math.sqrt(t)};!function(){for(var t=0,e=["ms","moz","webkit","o"],n=!(!window.performance||!window.performance.now),a=0,o=e.length;a<o&&!window.requestAnimationFrame;a+=1){window.requestAnimationFrame=window[e[a]+"RequestAnimationFrame"];window.cancelAnimationFrame=window[e[a]+"CancelAnimationFrame"]||window[e[a]+"CancelRequestAnimationFrame"]}window.requestAnimationFrame||(window.requestAnimationFrame=function(e,n){var a=(new Date).getTime(),o=Math.max(0,16-(a-t)),l=window.setTimeout(function(){e(a+o)},o);t=a+o;return l});window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){clearTimeout(t)});if(!n){var l=window.requestAnimationFrame,i=+new Date;window.requestAnimationFrame=function(t,e){l(function(e){return t(e<1e12?e:e-i)},e)}}}();!function(){if(window.performance){if(window.performance&&!window.performance.now){window.performance.offset=Date.now();window.performance.now=function(){return Date.now()-window.performance.offset}}}else window.performance={offset:Date.now(),now:function(){return Date.now()-this.offset}}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.Consts.event.DIALOG=TC.Consts.event.DIALOG||"dialog.tc";TC.control.Geolocation=function(t){this._classSelector="."+this.CLASS;this._layerPromises={};this.Const={Classes:{ACTIVE:"tc-ctl-geolocation-active",CLOSED:"closed",SELECTEDTRACK:"selectedTrack",DRAWACTIVATED:"draw-activated",SIMULATIONACTIVATED:"simulation-activated"},Selector:{SIMULATE:".tc-btn-simulate",DRAW:".tc-draw",EDIT:".tc-btn-edit",DELETE:".tc-btn-delete",SAVE:".tc-btn-save",CANCEL:".tc-btn-cancel",EXPORT:".tc-btn-export",STOP:".tc-btn-stop",PAUSE:".tc-btn-pause",BACKWARD:".tc-btn-backward",FORWARD:".tc-btn-forward",SPEED:".tc-spn-speed"},LocalStorageKey:{TRACKING:"trk",TRACKINGTEMP:"trktemp",TRACKINGSHOWADVERTISEMENT:"trkAdvertisement",GPSSHOWADVERTISEMENT:"gpsAdvertisement",TEST:"test"},Message:{VALIDATENAME:""},Event:{POSITIONCHANGE:"positionchange.tc.geolocation",GPSPOSITIONCHANGE:"gpspositionchange.tc.geolocation",GPSPOSITIONERROR:"positionerror.tc.geolocation",STATEUPDATED:"stateupdated.tc.geolocation",GPSADD:"gpsadd.tc.geolocation",TRACKSNAPPING:"tracksnapping.tc.geolocation",DRAWTRACK:"drawtrack.tc.geolocation",CLEARTRACK:"cleartrack.tc.geolocation",IMPORTEDTRACK:"importedtrack.tc.geolocation"},MimeMap:{KML:"application/vnd.google-earth.kml+xml",GPX:"application/gpx+xml"},SupportedFileExtensions:[".kml",".gpx"],Tabs:{GPS:"gps"},Layers:{GPS:"gps",TRACK:"track",TRACKING:"tracking"}};TC.Control.apply(this,arguments);var e=t||{};this._dialogDiv=TC.Util.getDiv(e.dialogDiv);window.$&&(this._$dialogDiv=$(this._dialogDiv));e.dialogDiv||document.body.appendChild(this._dialogDiv);this.delta=500;this.walkingSpeed=5e3;this.snappingTolerance=this.options.snappingTolerance||50;this.exportsState=!0;this.storageCRS="EPSG:4326"};TC.inherit(TC.control.Geolocation,TC.Control);!function(){var t=TC.control.Geolocation.prototype;t.CLASS="tc-ctl-geolocation";t.CHART_SIZE={MIN_HEIGHT:75,MAX_HEIGHT:128,MIN_WIDTH:315,MEDIUM_WIDTH:310,MAX_WIDTH:445};t.featuresToShare=[];TC.Consts.event.TOOLSCLOSE=TC.Consts.event.TOOLSCLOSE||"toolsclose.tc";TC.Consts.event.TOOLSOPEN=TC.Consts.event.TOOLSOPEN||"toolsopen.tc";t.template={};t.template[t.CLASS]={compiler:[8,">= 4.3.0"],main:function(t,e,n,a,o){var l=null!=e?e:t.nullContext||{},i=t.escapeExpression,r=t.lambda,c=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"<h2>"+i(c(n,"i18n").call(l,"geo",{name:"i18n",hash:{},data:o,loc:{start:{line:1,column:4},end:{line:1,column:18}}}))+'</h2>\r\n<div class="tc-ctl-geolocation-content">    \r\n    <div class="tc-ctl-geolocation-track">\r\n        <div class="tc-ctl-geolocation-track-snap-info"></div>        \r\n        \x3c!-- img se insertan en el div del mapa--\x3e        \r\n        <div id="tc-ctl-geolocation-track-elevation-marker" class="tc-ctl-geolocation-trackMarker elevation" style="display: none;"></div>\r\n        <div class="tc-ctl-geolocation-track-panel-block" >\r\n            <input id="tc-ctl-geolocation-track-panel-opened-'+i(r(null!=e?c(e,"controlId"):e,e))+'" type="checkbox" checked/>\r\n            <label for="tc-ctl-geolocation-track-panel-opened-'+i(r(null!=e?c(e,"controlId"):e,e))+'" title="'+i(c(n,"i18n").call(l,"geo.trk.panel.help.1",{name:"i18n",hash:{},data:o,loc:{start:{line:9,column:84},end:{line:9,column:115}}}))+'">'+i(c(n,"i18n").call(l,"geo.trk.panel.help.2",{name:"i18n",hash:{},data:o,loc:{start:{line:9,column:117},end:{line:9,column:148}}}))+'</label>\r\n            <i class="tc-ctl-geolocation-track-panel-help icon-question-sign" title="'+i(c(n,"i18n").call(l,"geo.trk.panel.help.3",{name:"i18n",hash:{},data:o,loc:{start:{line:10,column:85},end:{line:10,column:116}}}))+'"></i>\r\n        </div>\r\n        <div class="tc-ctl-geolocation-track-mng">\r\n            <div class="tc-ctl-geolocation-select">\r\n                <label class="tc-ctl-geolocation-btn-track" title="'+i(c(n,"i18n").call(l,"geo.track.title",{name:"i18n",hash:{},data:o,loc:{start:{line:14,column:67},end:{line:14,column:93}}}))+'"><input type="radio" name="'+i(r(null!=e?c(e,"controlId"):e,e))+'-mode" checked value="tracks" /><span>'+i(c(n,"i18n").call(l,"geo.gps",{name:"i18n",hash:{},data:o,loc:{start:{line:14,column:172},end:{line:14,column:190}}}))+'</span></label><label \r\n\t\t\t\tclass="tc-ctl-geolocation-btn-tracks" title="'+i(c(n,"i18n").call(l,"geo.tracks.title",{name:"i18n",hash:{},data:o,loc:{start:{line:15,column:49},end:{line:15,column:76}}}))+'"><input type="radio" name="'+i(r(null!=e?c(e,"controlId"):e,e))+'-mode" value="track-available" /><span>'+i(c(n,"i18n").call(l,"geo.tracks",{name:"i18n",hash:{},data:o,loc:{start:{line:15,column:156},end:{line:15,column:177}}}))+'</span></label>                    \r\n            </div>                        \r\n            <div class="tc-ctl-geolocation-track-available tc-ctl-geolocation-track-cnt tc-ctl-geolocation-panel tc-hidden">\r\n                <i class="tc-ctl-geolocation-track-search-icon"></i>\r\n                <input id="tc-ctl-geolocation-track-available-srch" type="search" list="tc-ctl-geolocation-track-available-lst" class="tc-ctl-geolocation-track-available-srch tc-textbox" placeholder="'+i(c(n,"i18n").call(l,"geo.filter.plhr",{name:"i18n",hash:{},data:o,loc:{start:{line:19,column:200},end:{line:19,column:226}}}))+'" maxlength="200" />                \r\n                <ol id="tc-ctl-geolocation-track-available-lst" class="tc-ctl-geolocation-track-available-lst">\r\n                    <li class="tc-ctl-geolocation-track-available-empty"><span>'+i(c(n,"i18n").call(l,"geo.noTracks",{name:"i18n",hash:{},data:o,loc:{start:{line:21,column:79},end:{line:21,column:102}}}))+'</span></li>\r\n                    <li class="tc-ctl-geolocation-track-not" hidden><span>'+i(c(n,"i18n").call(l,"noMatches",{name:"i18n",hash:{},data:o,loc:{start:{line:22,column:74},end:{line:22,column:94}}}))+'</span></li>\r\n                </ol>\r\n                <div class="tc-ctl-geolocation-track-cnt">\r\n                    <input name="uploaded-file" id="uploaded-file-'+i(r(null!=e?c(e,"controlId"):e,e))+'" type="file" class="tc-ctl-geolocation-track-import tc-button" accept=".gpx,.kml,.kmz" disabled />\r\n                    <label class="tc-button tc-icon-button" for="uploaded-file-'+i(r(null!=e?c(e,"controlId"):e,e))+'" title="'+i(c(n,"i18n").call(l,"geo.trk.import.upload",{name:"i18n",hash:{},data:o,loc:{start:{line:26,column:101},end:{line:26,column:134}}}))+'">'+i(c(n,"i18n").call(l,"geo.trk.import.lbl",{name:"i18n",hash:{},data:o,loc:{start:{line:26,column:136},end:{line:26,column:165}}}))+'</label>\r\n                </div>\r\n            </div>\r\n            <div class="tc-ctl-geolocation-tracks tc-ctl-geolocation-panel">    \r\n                <div class="tc-alert alert-warning tc-hidden" >\r\n                    <p id="panel-msg">\r\n                        '+i(c(n,"i18n").call(l,"geo.trk.panel.1",{name:"i18n",hash:{},data:o,loc:{start:{line:32,column:24},end:{line:32,column:50}}}))+"                    \r\n                        <ul>\r\n                            <li>"+i(c(n,"i18n").call(l,"geo.trk.panel.2",{name:"i18n",hash:{},data:o,loc:{start:{line:34,column:32},end:{line:34,column:58}}}))+"</li>\r\n                            <li>"+i(c(n,"i18n").call(l,"geo.trk.panel.3",{name:"i18n",hash:{},data:o,loc:{start:{line:35,column:32},end:{line:35,column:58}}}))+"</li>\r\n                            <li>"+i(c(n,"i18n").call(l,"geo.trk.panel.4",{name:"i18n",hash:{},data:o,loc:{start:{line:36,column:32},end:{line:36,column:58}}}))+"</li>\r\n                            <li>"+i(c(n,"i18n").call(l,"geo.trk.panel.5",{name:"i18n",hash:{},data:o,loc:{start:{line:37,column:32},end:{line:37,column:58}}}))+'</li>\r\n                        </ul>\r\n                    </p>\r\n                </div>            \r\n                <div class="tc-ctl-geolocation-track-ui">   \r\n                    <div  class="tc-ctl-geolocation-track-render">\r\n                        <input id="tc-ctl-geolocation-track-render-'+i(r(null!=e?c(e,"controlId"):e,e))+'" type="checkbox" hidden checked />\r\n                        <label for="tc-ctl-geolocation-track-render-'+i(r(null!=e?c(e,"controlId"):e,e))+'" class="tc-ctl-geolocation-track-render" title="'+i(c(n,"i18n").call(l,"geo.trk.render",{name:"i18n",hash:{},data:o,loc:{start:{line:44,column:130},end:{line:44,column:155}}}))+'">'+i(c(n,"i18n").call(l,"geo.trk.render",{name:"i18n",hash:{},data:o,loc:{start:{line:44,column:157},end:{line:44,column:182}}}))+'</label>\r\n                    </div>\r\n                    <button class="tc-button tc-icon-button tc-ctl-geolocation-track-ui-activate" title="'+i(c(n,"i18n").call(l,"geo.track.activate.title",{name:"i18n",hash:{},data:o,loc:{start:{line:46,column:105},end:{line:46,column:140}}}))+'">'+i(c(n,"i18n").call(l,"geo.track.activate",{name:"i18n",hash:{},data:o,loc:{start:{line:46,column:142},end:{line:46,column:171}}}))+'</button>\r\n                    <button class="tc-button tc-icon-button tc-ctl-geolocation-track-ui-deactivate tc-hidden" title="'+i(c(n,"i18n").call(l,"geo.track.deactivate.title",{name:"i18n",hash:{},data:o,loc:{start:{line:47,column:117},end:{line:47,column:155}}}))+'">'+i(c(n,"i18n").call(l,"geo.track.deactivate",{name:"i18n",hash:{},data:o,loc:{start:{line:47,column:157},end:{line:47,column:188}}}))+'</button>\r\n                </div>\r\n                <div  class="tc-ctl-geolocation-track-current tc-ctl-geolocation-track-cnt">\r\n                    <input type="text" class="tc-ctl-geolocation-track-title tc-textbox" disabled placeholder="'+i(c(n,"i18n").call(l,"geo.trk.name.plhr",{name:"i18n",hash:{},data:o,loc:{start:{line:50,column:111},end:{line:50,column:139}}}))+'" maxlength="200" /><button \r\n\t\t\t\t\tclass="tc-button tc-icon-button tc-ctl-geolocation-track-save" disabled title="'+i(c(n,"i18n").call(l,"geo.trk.name.save",{name:"i18n",hash:{},data:o,loc:{start:{line:51,column:84},end:{line:51,column:112}}}))+'"></button>\r\n                    <input type="text" class="tc-ctl-geolocation-track-waypoint tc-textbox" disabled placeholder="'+i(c(n,"i18n").call(l,"geo.trk.wyp.plhr",{name:"i18n",hash:{},data:o,loc:{start:{line:52,column:114},end:{line:52,column:141}}}))+'" maxlength="200" /><button \r\n\t\t\t\t\tclass="tc-button tc-icon-button tc-ctl-geolocation-track-add-wpt" disabled title="'+i(c(n,"i18n").call(l,"geo.trk.wyp.save",{name:"i18n",hash:{},data:o,loc:{start:{line:53,column:87},end:{line:53,column:114}}}))+'"></button>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n<div class="tc-ctl-geolocation-track-center tc-hidden">\r\n    <button title="'+i(c(n,"i18n").call(l,"geo.trk.center",{name:"i18n",hash:{},data:o,loc:{start:{line:60,column:19},end:{line:60,column:44}}}))+'"></button>\r\n</div>\r\n\r\n\r\n'},useData:!0};t.template[t.CLASS+"-track-node"]={compiler:[8,">= 4.3.0"],main:function(t,e,n,a,o){var l=t.lambda,i=t.escapeExpression,r=null!=e?e:t.nullContext||{},c=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<li data-id="'+i(l(null!=e?c(e,"id"):e,e))+'" data-uid="'+i(l(null!=e?c(e,"uid"):e,e))+'">\r\n    <span class="tc-draw tc-selectable" title="'+i(l(null!=e?c(e,"name"):e,e))+'">'+i(l(null!=e?c(e,"name"):e,e))+'</span>\r\n    <input class="tc-textbox tc-hidden" type="text" value="'+i(l(null!=e?c(e,"name"):e,e))+'" />\r\n    <button class="tc-btn-simulate" title="'+i(c(n,"i18n").call(r,"tr.lst.simulate",{name:"i18n",hash:{},data:o,loc:{start:{line:4,column:43},end:{line:4,column:70}}}))+'"></button>\r\n    <button hidden class="tc-btn-stop" title="'+i(c(n,"i18n").call(r,"tr.lst.stop",{name:"i18n",hash:{},data:o,loc:{start:{line:5,column:46},end:{line:5,column:69}}}))+'"></button>\r\n    <button class="tc-btn-edit" title="'+i(c(n,"i18n").call(r,"tr.lst.edit",{name:"i18n",hash:{},data:o,loc:{start:{line:6,column:39},end:{line:6,column:62}}}))+'"></button>\r\n    <button hidden class="tc-btn-pause" title="'+i(c(n,"i18n").call(r,"tr.lst.pause",{name:"i18n",hash:{},data:o,loc:{start:{line:7,column:47},end:{line:7,column:71}}}))+'"></button>\r\n    <button hidden class="tc-btn-backward" title="'+i(c(n,"i18n").call(r,"tr.lst.backward",{name:"i18n",hash:{},data:o,loc:{start:{line:8,column:50},end:{line:8,column:77}}}))+'"></button>\r\n    <label hidden class="tc-spn-speed" title="'+i(c(n,"i18n").call(r,"tr.lst.velocity",{name:"i18n",hash:{},data:o,loc:{start:{line:9,column:46},end:{line:9,column:73}}}))+'"></label>\r\n    <button hidden class="tc-btn-forward" title="'+i(c(n,"i18n").call(r,"tr.lst.forward",{name:"i18n",hash:{},data:o,loc:{start:{line:10,column:49},end:{line:10,column:75}}}))+'"></button>\r\n    <button class="tc-btn-save tc-hidden" title="'+i(c(n,"i18n").call(r,"save",{name:"i18n",hash:{},data:o,loc:{start:{line:11,column:49},end:{line:11,column:65}}}))+'"></button>\r\n    <button class="tc-btn-cancel tc-hidden" title="'+i(c(n,"i18n").call(r,"tr.lst.cancel",{name:"i18n",hash:{},data:o,loc:{start:{line:12,column:51},end:{line:12,column:76}}}))+'"></button>\r\n    <button class="tc-btn-export" title="'+i(c(n,"i18n").call(r,"tr.lst.download",{name:"i18n",hash:{},data:o,loc:{start:{line:13,column:41},end:{line:13,column:68}}}))+'"></button>\r\n    <button class="tc-btn-delete" title="'+i(c(n,"i18n").call(r,"tr.lst.delete",{name:"i18n",hash:{},data:o,loc:{start:{line:14,column:41},end:{line:14,column:66}}}))+'"></button>\r\n</li>\r\n'},useData:!0};t.template[t.CLASS+"-track-snapping-node"]={1:function(t,e,n,a,o){var l=t.escapeExpression,i=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"    <li>\r\n        <span>"+l(i(n,"i18n").call(null!=e?e:t.nullContext||{},"geo.trk.snapping.name",{name:"i18n",hash:{},data:o,loc:{start:{line:4,column:14},end:{line:4,column:46}}}))+":</span> "+l(t.lambda(null!=e?i(e,"n"):e,e))+"\r\n    </li>\r\n"},3:function(t,e,n,a,o){var l=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return t.escapeExpression(l(n,"i18n").call(null!=e?e:t.nullContext||{},"lon",{name:"i18n",hash:{},data:o,loc:{start:{line:7,column:28},end:{line:7,column:42}}}))},5:function(t,e,n,a,o){return"X"},7:function(t,e,n,a,o){var l=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return t.escapeExpression(l(n,"i18n").call(null!=e?e:t.nullContext||{},"lat",{name:"i18n",hash:{},data:o,loc:{start:{line:8,column:28},end:{line:8,column:42}}}))},9:function(t,e,n,a,o){return"Y"},11:function(t,e,n,a,o){var l,i=null!=e?e:t.nullContext||{},r=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(l=r(n,"unless").call(i,r(n,"eq").call(i,null!=e?r(e,"z"):e,0,{name:"eq",hash:{},data:o,loc:{start:{line:10,column:14},end:{line:10,column:22}}}),{name:"unless",hash:{},fn:t.program(12,o,0),inverse:t.noop,data:o,loc:{start:{line:10,column:4},end:{line:12,column:15}}}))?l:""},12:function(t,e,n,a,o){var l=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'    <li> <span>Z:</span> <span class="original"> '+t.escapeExpression(t.lambda(null!=e?l(e,"z"):e,e))+" </span></li>\r\n"},14:function(t,e,n,a,o){var l,i=null!=e?e:t.nullContext||{},r=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(l=r(n,"unless").call(i,r(n,"eq").call(i,null!=e?r(e,"mdtz"):e,0,{name:"eq",hash:{},data:o,loc:{start:{line:15,column:14},end:{line:15,column:25}}}),{name:"unless",hash:{},fn:t.program(15,o,0),inverse:t.noop,data:o,loc:{start:{line:15,column:4},end:{line:17,column:15}}}))?l:""},15:function(t,e,n,a,o){var l=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'    <li> <span>Z:</span> <span class="mdt"> '+t.escapeExpression(t.lambda(null!=e?l(e,"mdtz"):e,e))+" </span> </li>\r\n"},17:function(t,e,n,a,o){var l=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"    <li> "+t.escapeExpression(t.lambda(null!=e?l(e,"m"):e,e))+" </li>\r\n"},compiler:[8,">= 4.3.0"],main:function(t,e,n,a,o){var l,i=null!=e?e:t.nullContext||{},r=t.lambda,c=t.escapeExpression,s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"<ul>\r\n"+(null!=(l=s(n,"if").call(i,null!=e?s(e,"n"):e,{name:"if",hash:{},fn:t.program(1,o,0),inverse:t.noop,data:o,loc:{start:{line:2,column:4},end:{line:6,column:11}}}))?l:"")+"    <li> <span>"+(null!=(l=s(n,"if").call(i,null!=e?s(e,"isGeo"):e,{name:"if",hash:{},fn:t.program(3,o,0),inverse:t.program(5,o,0),data:o,loc:{start:{line:7,column:15},end:{line:7,column:58}}}))?l:"")+":</span> "+c(r(null!=e?s(e,"x"):e,e))+"</li>\r\n    <li> <span>"+(null!=(l=s(n,"if").call(i,null!=e?s(e,"isGeo"):e,{name:"if",hash:{},fn:t.program(7,o,0),inverse:t.program(9,o,0),data:o,loc:{start:{line:8,column:15},end:{line:8,column:58}}}))?l:"")+":</span> "+c(r(null!=e?s(e,"y"):e,e))+" </li>\r\n"+(null!=(l=s(n,"if").call(i,null!=e?s(e,"z"):e,{name:"if",hash:{},fn:t.program(11,o,0),inverse:t.noop,data:o,loc:{start:{line:9,column:4},end:{line:13,column:11}}}))?l:"")+(null!=(l=s(n,"if").call(i,null!=e?s(e,"mdtz"):e,{name:"if",hash:{},fn:t.program(14,o,0),inverse:t.noop,data:o,loc:{start:{line:14,column:4},end:{line:18,column:11}}}))?l:"")+(null!=(l=s(n,"if").call(i,null!=e?s(e,"m"):e,{name:"if",hash:{},fn:t.program(17,o,0),inverse:t.noop,data:o,loc:{start:{line:19,column:4},end:{line:21,column:11}}}))?l:"")+"</ul>"},useData:!0};t.template[t.CLASS+"-dialog"]={compiler:[8,">= 4.3.0"],main:function(t,e,n,a,o){var l=null!=e?e:t.nullContext||{},i=t.escapeExpression,r=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<div class="tc-ctl-geolocation-continue-track-dialog tc-modal" >\r\n    <div class="tc-modal-background tc-modal-close"></div>\r\n    <div class="tc-modal-window">\r\n        <div class="tc-modal-header">\r\n            <h3>'+i(r(n,"i18n").call(l,"geo.gps",{name:"i18n",hash:{},data:o,loc:{start:{line:5,column:16},end:{line:5,column:34}}}))+'</h3>\r\n            <div class="tc-modal-close"></div>\r\n        </div>\r\n        <div class="tc-modal-body">\r\n            <button class="tc-button tc-ctl-geolocation-track-continue"> '+i(r(n,"i18n").call(l,"geo.trk.dialog.cnt",{name:"i18n",hash:{},data:o,loc:{start:{line:9,column:73},end:{line:9,column:102}}}))+' </button>\r\n            <button class="tc-button tc-ctl-geolocation-track-new"> '+i(r(n,"i18n").call(l,"geo.trk.dialog.new",{name:"i18n",hash:{},data:o,loc:{start:{line:10,column:68},end:{line:10,column:97}}}))+' </button>            \r\n            <button class="tc-button tc-modal-close"> '+i(r(n,"i18n").call(l,"geo.trk.dialog.cancel",{name:"i18n",hash:{},data:o,loc:{start:{line:11,column:54},end:{line:11,column:86}}}))+' </button>\r\n        </div>\r\n    </div>\r\n</div>\r\n<div class="tc-ctl-geolocation-track-advert-dialog tc-modal" >\r\n    <div class="tc-modal-background tc-modal-close"></div>\r\n    <div class="tc-modal-window">\r\n        <div class="tc-modal-header">\r\n            <h3>'+i(r(n,"i18n").call(l,"geo.track.activate.title",{name:"i18n",hash:{},data:o,loc:{start:{line:19,column:16},end:{line:19,column:51}}}))+'</h3>\r\n            <div class="tc-modal-close"></div>\r\n        </div>\r\n        <div class="tc-modal-body">\r\n            <p id="pageBlurMsg">'+i(r(n,"i18n").call(l,"geo.trk.page.blur",{name:"i18n",hash:{},data:o,loc:{start:{line:23,column:32},end:{line:23,column:60}}}))+'</p>\r\n            <p class="tc-ctl-geolocation-track-advertisement p">                \r\n                <label> <input type="checkbox" name="checkbox" id="advertisement"> '+i(r(n,"i18n").call(l,"geo.trk.dialog.advertisement",{name:"i18n",hash:{},data:o,loc:{start:{line:25,column:83},end:{line:25,column:122}}}))+' </label>        \r\n            </p>\r\n        </div>\r\n        <div class="tc-modal-footer">\r\n            <button class="tc-button tc-ctl-geolocation-track-advert-ok"> '+i(r(n,"i18n").call(l,"ok",{name:"i18n",hash:{},data:o,loc:{start:{line:29,column:74},end:{line:29,column:87}}}))+" </button>\r\n        </div>\r\n    </div>\r\n</div>\r\n\r\n"},useData:!0};t.template[t.CLASS+"-tracking-toast"]={1:function(t,e,n,a,o){var l=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return t.escapeExpression(l(n,"i18n").call(null!=e?e:t.nullContext||{},"lon",{name:"i18n",hash:{},data:o,loc:{start:{line:3,column:25},end:{line:3,column:39}}}))},3:function(t,e,n,a,o){return"X"},5:function(t,e,n,a,o){var l=t.escapeExpression,i=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"        <th>"+l(i(n,"i18n").call(null!=e?e:t.nullContext||{},"geo.trk.accuracy",{name:"i18n",hash:{},data:o,loc:{start:{line:6,column:12},end:{line:6,column:39}}}))+":</th>\r\n        <td> "+l(t.lambda(null!=e?i(e,"accuracy"):e,e))+" m </td>\r\n"},7:function(t,e,n,a,o){var l=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return t.escapeExpression(l(n,"i18n").call(null!=e?e:t.nullContext||{},"lat",{name:"i18n",hash:{},data:o,loc:{start:{line:11,column:25},end:{line:11,column:39}}}))},9:function(t,e,n,a,o){return"Y"},11:function(t,e,n,a,o){var l=t.escapeExpression,i=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"        <th>"+l(i(n,"i18n").call(null!=e?e:t.nullContext||{},"geo.trk.speed",{name:"i18n",hash:{},data:o,loc:{start:{line:14,column:12},end:{line:14,column:36}}}))+":</th>\r\n        <td>"+l(t.lambda(null!=e?i(e,"speed"):e,e))+" km/h</td>\r\n"},13:function(t,e,n,a,o){var l,i=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"        <th>"+(null!=(l=i(n,"if").call(null!=e?e:t.nullContext||{},null!=e?i(e,"isGeo"):e,{name:"if",hash:{},fn:t.program(14,o,0),inverse:t.program(16,o,0),data:o,loc:{start:{line:20,column:12},end:{line:20,column:55}}}))?l:"")+":</th>\r\n        <td> "+t.escapeExpression(t.lambda(null!=e?i(e,"z"):e,e))+" m </td>\r\n"},14:function(t,e,n,a,o){var l=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return t.escapeExpression(l(n,"i18n").call(null!=e?e:t.nullContext||{},"ele",{name:"i18n",hash:{},data:o,loc:{start:{line:20,column:25},end:{line:20,column:39}}}))},16:function(t,e,n,a,o){return"Z"},18:function(t,e,n,a,o){var l=null!=e?e:t.nullContext||{},i=t.escapeExpression,r=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'        <th title="'+i(r(n,"i18n").call(l," mdt.title",{name:"i18n",hash:{},data:o,loc:{start:{line:24,column:19},end:{line:24,column:40}}}))+'">'+i(r(n,"i18n").call(l,"ele",{name:"i18n",hash:{},data:o,loc:{start:{line:24,column:42},end:{line:24,column:56}}}))+" ("+i(r(n,"i18n").call(l,"mdt",{name:"i18n",hash:{},data:o,loc:{start:{line:24,column:58},end:{line:24,column:72}}}))+"):</th>\r\n        <td>"+i(t.lambda(null!=e?r(e,"mdt"):e,e))+" m </td>\r\n"},compiler:[8,">= 4.3.0"],main:function(t,e,n,a,o){var l,i=null!=e?e:t.nullContext||{},r=t.lambda,c=t.escapeExpression,s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<table class="tc-ctl-geolocation-info-tracking">\r\n    <tr>\r\n        <th>'+(null!=(l=s(n,"if").call(i,null!=e?s(e,"isGeo"):e,{name:"if",hash:{},fn:t.program(1,o,0),inverse:t.program(3,o,0),data:o,loc:{start:{line:3,column:12},end:{line:3,column:55}}}))?l:"")+":</th>\r\n        <td> "+c(r(null!=e?s(e,"x"):e,e))+" </td>\r\n"+(null!=(l=s(n,"if").call(i,null!=e?s(e,"accuracy"):e,{name:"if",hash:{},fn:t.program(5,o,0),inverse:t.noop,data:o,loc:{start:{line:5,column:8},end:{line:8,column:15}}}))?l:"")+"    </tr>\r\n    <tr>\r\n        <th>"+(null!=(l=s(n,"if").call(i,null!=e?s(e,"isGeo"):e,{name:"if",hash:{},fn:t.program(7,o,0),inverse:t.program(9,o,0),data:o,loc:{start:{line:11,column:12},end:{line:11,column:55}}}))?l:"")+":</th>\r\n        <td> "+c(r(null!=e?s(e,"y"):e,e))+" </td>\r\n"+(null!=(l=s(n,"if").call(i,null!=e?s(e,"speed"):e,{name:"if",hash:{},fn:t.program(11,o,0),inverse:t.noop,data:o,loc:{start:{line:13,column:8},end:{line:16,column:15}}}))?l:"")+"    </tr>\r\n    <tr>\r\n"+(null!=(l=s(n,"if").call(i,null!=e?s(e,"z"):e,{name:"if",hash:{},fn:t.program(13,o,0),inverse:t.noop,data:o,loc:{start:{line:19,column:8},end:{line:22,column:15}}}))?l:"")+(null!=(l=s(n,"if").call(i,null!=e?s(e,"mdt"):e,{name:"if",hash:{},fn:t.program(18,o,0),inverse:t.noop,data:o,loc:{start:{line:23,column:8},end:{line:26,column:15}}}))?l:"")+"    </tr>    \r\n</table>\r\n"},useData:!0};t.template[t.CLASS+"-ext-dldlog"]={compiler:[8,">= 4.3.0"],main:function(t,e,n,a,o){var l=t.lambda,i=t.escapeExpression,r=null!=e?e:t.nullContext||{},c=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'<div class="tc-ctl-geolocation-ext-dldlog tc-hidden">\r\n    <label>\r\n        <input type="radio" name="'+i(l(null!=e?c(e,"controlId"):e,e))+'-dldlog-source" value="track" checked />\r\n        <span>'+i(c(n,"i18n").call(r,"geo.profile.fromTrack.plural",{name:"i18n",hash:{},data:o,loc:{start:{line:4,column:14},end:{line:4,column:53}}}))+'</span>\r\n    </label>\r\n    <label>\r\n        <input type="radio" name="'+i(l(null!=e?c(e,"controlId"):e,e))+'-dldlog-source" value="mdt" />\r\n        <span title="'+i(c(n,"i18n").call(r,"mdt.title",{name:"i18n",hash:{},data:o,loc:{start:{line:8,column:21},end:{line:8,column:41}}}))+'">'+i(c(n,"i18n").call(r,"mdt",{name:"i18n",hash:{},data:o,loc:{start:{line:8,column:43},end:{line:8,column:57}}}))+"</span>\r\n    </label>\r\n</div>\r\n"},useData:!0};var e=function(t){const e=this;t.layer;t.feature!==e.wrap.simulateMarker&&t.layer===e.layerTrack&&e.clearSelection()};t.register=function(t){const e=this,n=TC.Control.prototype.register.call(e,t);e.wrap=new TC.wrap.control.Geolocation(e);e.wrap.register(t);e.hillDeltaThreshold=e.options&&e.options.hillDeltaThreshold||e.map.options.elevation&&e.map.options.elevation.hillDeltaThreshold||20;t.addLayer({id:e.getUID(),type:TC.Consts.layerType.VECTOR,owner:e,stealth:!0,title:"Posicionar.GPS"}).then(function(t){e.layerGPS=t});t.addLayer({id:e.getUID(),type:TC.Consts.layerType.VECTOR,owner:e,stealth:!0,title:"Posicionar.Tracking",styles:{point:{radius:3,fillColor:"#00ced1",fillOpacity:function(){return this.track.renderTrack.checked?1:0}.bind(e),strokeColor:"#ffffff",fontColor:"#00ced1",labelOutlineColor:"#ffffff",labelOutlineWidth:1,label:function(t){var e=t.getData().name;return e=e&&(e+"").trim().length>0?(e+"").trim().toLowerCase():""}},line:{strokeOpacity:function(){return this.track.renderTrack.checked?1:0}.bind(e),strokeWidth:2,strokeColor:"#00ced1",lineDash:[.1,6]}}}).then(function(t){e.layerTracking=t});t.addLayer({id:e.getUID(),type:TC.Consts.layerType.VECTOR,owner:e,stealth:!0,title:"Posicionar.Track",styles:{line:{strokeWidth:2,strokeColor:"#C52737"},point:{radius:function(t){var e=t.getData().name;return e&&(e+"").trim().length>0?3:6},fillColor:"#C52737",strokeColor:"#ffffff",fontColor:"#C52737",fontSize:10,labelOutlineColor:"#ffffff",labelOutlineWidth:2,label:function(t){var e=t.getData().name;return e=e&&(e+"").trim().length>0?(e+"").trim().toLowerCase():""}}}}).then(function(t){e.layerTrack=t});t.on(TC.Consts.event.FEATURESIMPORT,function(t){const e=this,n=function(t){const n=t.fileName,a=t.dropTarget;var o="."+TC.Consts.format.KML.toLowerCase(),l="."+TC.Consts.format.GPX.toLowerCase();if(n.toLowerCase().indexOf(l)===n.length-l.length||n.toLowerCase().indexOf(o)===n.length-o.length&&a===e){e.clear(e.Const.Layers.TRACK);e.importTrack(t);/.kml$/g.test(n.toLowerCase())&&e.layerTrack&&e.layerTrack.styles&&e.layerTrack.features.forEach(function(t){t instanceof TC.feature.Point&&e.layerTrack.styles.point?t.setStyle(e.layerTrack.styles.point):t instanceof TC.feature.Polyline&&e.layerTrack.styles.line&&t.setStyle(e.layerTrack.styles.line)})}};if(e.working&&TC.Util.isFunction(e.working.then))e.working.then(n(t));else{e.working=!0;n(t)}}.bind(e));t.on(TC.Consts.event.PROJECTIONCHANGE,function(t){e.elevationChartData&&(e.elevationChartData.coords=TC.Util.reproject(e.elevationChartData.coords,t.oldCrs,t.newCrs))});t.on(TC.Consts.event.DIALOG,function(t){t.control&&e.onShowDownloadDialog(t.control.caller)});return n};t.render=function(t){const e=this;return e.getRenderedHtml(e.CLASS+"-dialog",null,function(t){e._dialogDiv.innerHTML=t}).then(function(){return e.getDownloadDialog().then(()=>{e._downloadDialog.caller=e;e.getRenderedHtml(e.CLASS+"-ext-dldlog",{controlId:e.id},function(n){var a=document.createElement("template");a.innerHTML=n;e._downloadDialogExtNode=a.content?a.content.firstChild:a.firstChild;return e.renderData({controlId:e.id},t)})})})};t.importTrack=function(t){var n=this;n.map.off(TC.Consts.event.FEATUREREMOVE,e);if(n.isDisabled)/.gpx$/g.test(t.fileName.toLowerCase())&&n.map.toast(n.getLocaleString("geo.trk.import.disabled"),{type:TC.Consts.msgType.WARNING});else if(t.fileName&&t.features&&t.features.length>0){var a=n.getLoadingIndicator().addWait();n.importedFileName=t.fileName;const e=[];for(var o=0,l=t.features.length;o<l;o++)e.push(n.layerTrack.addFeature(t.features[o]));Promise.all(e).then(function(){n.wrap.processImportedFeatures({wait:a,notReproject:t.notReproject});if(n.layerTrack){n.map&&n.map.layout&&n.map.layout.accordion&&n.div.classList.contains(TC.Consts.classes.COLLAPSED)&&n.map.controls.filter(function(t){return t!==n&&!t.containerControl}).forEach(function(t){t.div.classList.add(TC.Consts.classes.COLLAPSED)});n.div.classList.remove(TC.Consts.classes.COLLAPSED);n.div.querySelector("."+n.CLASS+"-btn-tracks > span").click();t.isShared||n.map.trigger(TC.Consts.event.TOOLSOPEN)}})}};t.prepareFeaturesToShare=function(t){const e=this;return new Promise(function(n,a){if(t){var o=e.availableTracks.filter(function(e){return e.uid.toString()===t.toString()})[0].data,l=Math.pow(10,TC.Consts.DEGREE_PRECISION+1),i=(new ol.format.GeoJSON).readFeatures(o);const a=new Array(i.length);i.forEach(function(t,e){a[e]=TC.wrap.Feature.createFeature(t)});Promise.all(a).then(function(t){e.featuresToShare=t.map(function(t){const e={};switch(!0){case TC.feature.Marker&&t instanceof TC.feature.Marker:e.type=TC.Consts.geom.MARKER;break;case TC.feature.Point&&t instanceof TC.feature.Point:e.type=TC.Consts.geom.POINT;break;case TC.feature.Polyline&&t instanceof TC.feature.Polyline:e.type=TC.Consts.geom.POLYLINE;break;case TC.feature.MultiPolyline&&t instanceof TC.feature.MultiPolyline:e.type=TC.Consts.geom.MULTIPOLYLINE}e.id=t.id;e.geom=TC.Util.compactGeometry(t.geometry,l);e.data=t.getData();return e});n()})}else n()})};const n=function(t){var e=t.querySelector("span").textContent,n=new RegExp(this.Const.SupportedFileExtensions.join("|"),"gi");return e.replace(n,"")+"_"+TC.Util.getFormattedDate(new Date,!0)};var a=null,o=null;t.onShowDownloadDialog=function(t,e){const n=this,l=n._downloadDialog.getFeatures();if(t!==n&&n._downloadDialog.getFeatures().every(t=>t&&t.layer===n.layerTrack)){let t=n._downloadDialog.getOptions(),e=n.getDownloadDialogOptions();t.elevation=e.elevation;delete t.openCallback;n._downloadDialog.open(n._downloadDialog.getFeatures(),t)}1===l.length&&l.every(t=>t&&t.fileName)&&n._downloadDialog.setOptions({fileName:l[0].fileName});if(n.options.displayElevation&&(t===n||n._downloadDialog.getFeatures().every(t=>t&&t.layer===n.layerTrack))&&!n._downloadDialog.modalBody.querySelector("."+n.CLASS+"-ext-dldlog")){let t=n._downloadDialog.modalBody.querySelector("."+n._downloadDialog.CLASS+"-ext");if(t){t.appendChild(n._downloadDialogExtNode);o=n._downloadDialog.modalBody.querySelector("."+n._downloadDialog.CLASS+"-elev input[type='checkbox']");a=n._downloadDialog.modalBody.querySelector("."+n._downloadDialog.CLASS+"-ip");const i=n._downloadDialog.modalBody.querySelectorAll(`input[type=radio][name="${n.id}-dldlog-source"]`),r=function(t){const e=i[0];t?e.classList.contains(TC.Consts.classes.DISABLED)||e.classList.add(TC.Consts.classes.DISABLED):e.classList.remove(TC.Consts.classes.DISABLED)};let c=l.filter(t=>TC.feature.Polyline&&t instanceof TC.feature.Polyline)[0],s=(c.geometry[0],2===c.geometry[0].length);s?r(s):c.geometry[0].length>2&&r(c.geometry.map(t=>t[2]).every(t=>0===t));const d=function(){return a&&a.classList.contains(TC.Consts.classes.HIDDEN)},u=function(){if(i[0].checked&&!d())a.classList.add(TC.Consts.classes.HIDDEN);else if(i[0].checked){let t=new MutationObserver(function(e){e.filter(t=>"class"===t.attributeName).forEach(function(e){if(e.oldValue.indexOf(TC.Consts.classes.HIDDEN)>-1)if(i[0].checked){a.classList.add(TC.Consts.classes.HIDDEN);t.disconnect()}else t.disconnect()})}),e={attributes:!0,attributeOldValue:!0};t.observe(a,e)}else d()&&o.checked&&a.classList.remove(TC.Consts.classes.HIDDEN)};if(o){if(o.checked){u();n._downloadDialogExtNode.classList.remove(TC.Consts.classes.HIDDEN)}else n._downloadDialogExtNode.classList.contains(TC.Consts.classes.HIDDEN)||n._downloadDialogExtNode.classList.add(TC.Consts.classes.HIDDEN);o.addEventListener("change",function(){u();n._downloadDialogExtNode.classList.toggle(TC.Consts.classes.HIDDEN)})}if(i){u();i.forEach(t=>{if(!t.dataset.hasChangeEvent){t.dataset.hasChangeEvent=!0;t.addEventListener("change",async function(t){if(t.target.checked){u();let a;if("track"===t.target.value)a=l;else{let t=l,o=t.filter(t=>TC.feature.Polyline&&t instanceof TC.feature.Polyline)[0];e&&(a=t.filter(t=>TC.feature.Point&&t instanceof TC.feature.Point));let r=o.uid,c=y(r);if(c){let t=o.clone();t.setCoords(c.data.elevationFromServiceChartData.elevCoords);if(e){a||(a=w.call(n)||[]);a.push(t)}else a=t}else{n._downloadDialog.modalBody.classList.add(TC.Consts.classes.LOADING);let t=await async function(t){const e=this;let n=E(t);if(n){console.log("Tengo datos en cache");return n.data}{console.log("NO tengo datos en cache");const n=await e.getElevationTool();if(n){let a=t.clone();try{let o=await n.setGeometry({features:[a],crs:e.map.crs});L(t,o[0]);return o[0]}catch(t){return null}}}}.call(n,o);if(t)e?a.push(t):a=t;else{n.map.toast(n.getLocaleString("elevation.error"),{type:TC.Consts.msgType.ERROR,duration:5e3});i[0].checked=!0}n._downloadDialog.modalBody.classList.remove(TC.Consts.classes.LOADING)}}n._downloadDialog.setFeatures(a)}})}});if(i[0].classList.contains(TC.Consts.classes.DISABLED)){const t=i[1];t.checked=!0;t.dispatchEvent(new Event("change"))}}1===l.length&&l[0].fileName&&n._downloadDialog.setOptions({fileName:l[0].fileName})}}};t.getDownloadDialogOptions=function(t){const e=this,n={title:e.getLocaleString("download"),fileName:t,openCallback:function(){e.onShowDownloadDialog(e,!0)}};e.options.displayElevation?n.elevation={resolution:e.options.displayElevation&&e.options.displayElevation.resolution||e.map.options.elevation&&e.map.options.elevation.resolution||20,sampleNumber:e.options.displayElevation&&e.options.displayElevation.sampleNumber||e.map.options.elevation&&e.map.options.elevation.sampleNumber||0,checked:!0}:n.elevation={checked:!0};return n};var l=!0;t.renderData=function(a,o){const s=this;var d=s.Const.Selector;return TC.Control.prototype.renderData.call(s,a,function(){const a=s.div.querySelectorAll(s._classSelector+"-panel");s.div.querySelectorAll("."+s.CLASS+"-select span").forEach(function(t){t.addEventListener(TC.Consts.event.CLICK,function(t){for(var e=t.target;e&&"LABEL"!==e.tagName;)e=e.parentElement;const n=e.querySelector(`input[type=radio][name="${s.id}-mode"]`).value;a.forEach(function(t){t.classList.toggle(TC.Consts.classes.HIDDEN,!t.matches("."+s.CLASS+"-"+n))})},{passive:!0})});s.track={activateButton:s.div.querySelector(s._classSelector+"-track-ui-activate"),deactivateButton:s.div.querySelector(s._classSelector+"-track-ui-deactivate"),trackSearch:s.div.querySelector(s._classSelector+"-track-available-srch"),trackImportFile:s.div.querySelector(s._classSelector+"-track-import"),trackSave:s.div.querySelector(s._classSelector+"-track-save"),trackAdd:s.div.querySelector(s._classSelector+"-track-add-wpt"),trackContinue:s._dialogDiv.querySelector(".tc-ctl-geolocation-track-continue"),trackRenew:s._dialogDiv.querySelector(".tc-ctl-geolocation-track-new"),trackClose:s._dialogDiv.querySelector(".tc-ctl-geolocation-continue-track-dialog button.tc-modal-close"),trackAdvertisementOK:s._dialogDiv.querySelector(".tc-ctl-geolocation-track-advert-ok")};s.track.trackList=s.div.querySelector(s._classSelector+"-track-available-lst");s.track.trackToolPanelOpened=s.div.querySelector("#tc-ctl-geolocation-track-panel-opened-"+s.id);s.div.querySelector("."+t.CLASS+"-track-panel-help").addEventListener("click",function(){c.call(s)});s.track.trackName=s.div.querySelector(s._classSelector+"-track-title");s.track.trackWPT=s.div.querySelector(s._classSelector+"-track-waypoint");TC.Util.detectMobile()&&matchMedia("screen and (max-height: 50em) and (max-width: 50em)").matches&&(s.track.trackToolPanelOpened.checked=!1);if(window.File&&window.FileReader&&window.FileList&&window.Blob){s.track.trackImportFile.disabled=!1;s.track.trackImportFile.addEventListener(TC.Consts.event.CLICK,function(t){const e=document.createElement("form"),n=this.parentElement;n.insertBefore(e,this);e.appendChild(this);e.reset();e.insertAdjacentElement("afterend",this);n.removeChild(e)},{passive:!0});const t=function(){s.map.off(TC.Consts.event.LAYERERROR,t);s.clearFileInput(s.track.trackImportFile);TC.alert(s.getLocaleString("geo.trk.upload.error3"))};s.track.trackImportFile.addEventListener("change",function(e){if(!s._cleaning){s.clear(s.Const.Layers.TRACK);if(s.map){s.map.on(TC.Consts.event.LAYERERROR,t);s.map.wrap.loadFiles(e.target.files,{control:s})}}})}else console.log("no es posible la importaci\xf3n");s.track.activateButton.addEventListener("click",function(){s.activateTracking();i.call(s)});s.track.deactivateButton.addEventListener("click",function(){s.deactivateTracking();r.call(s)});const u=function(){!function(t){t=t.toLowerCase();const e=Array.from(s.track.trackList.querySelectorAll("li"));e.forEach(function(t){t.style.display="none"});const n=e.filter(function(t){return t.matches("li:not([class]),li."+s.Const.Classes.SELECTEDTRACK)}),a=s.div.querySelector(s._classSelector+"-track-search-icon");if(0===t.length){n.forEach(function(t){t.style.display=""});a.style.visibility="visible"}else{a.style.visibility="hidden";var o=new RegExp(t,"i");n.forEach(function(t){t.style.display=o.test(t.querySelector("span").textContent)?"":"none"});n.some(function(t){return""===t.style.display})||e.forEach(function(t){t.matches('[class^="tc-ctl-geolocation-track-not"]')&&(t.style.display="")})}}(this.value.toLowerCase().trim())};s.track.trackSearch.addEventListener("keyup",u);s.track.trackSearch.addEventListener("search",u);s.track.trackSave.addEventListener("click",s.saveTrack.bind(s));s.track.trackAdd.addEventListener("click",s.addWaypoint.bind(s));const m=s.div.querySelector(s._classSelector+"-track-available-lst");var p=function(t,e){"LI"!==e.tagName&&(e=e.parentElement);const n=e.querySelector("input"),a=e.querySelector("span");if(t){n.classList.remove(TC.Consts.classes.HIDDEN);n.focus();n.value=a.textContent;a.classList.add(TC.Consts.classes.HIDDEN);e.querySelector(d.SIMULATE).classList.add(TC.Consts.classes.HIDDEN);e.querySelector(d.EDIT).classList.add(TC.Consts.classes.HIDDEN);e.querySelector(d.DELETE).classList.add(TC.Consts.classes.HIDDEN);e.querySelector(d.DRAW).classList.add(TC.Consts.classes.HIDDEN);e.querySelector(d.EXPORT).classList.add(TC.Consts.classes.HIDDEN);e.querySelector(d.SAVE).classList.remove(TC.Consts.classes.HIDDEN);e.querySelector(d.CANCEL).classList.remove(TC.Consts.classes.HIDDEN)}else{n.classList.add(TC.Consts.classes.HIDDEN);a.classList.remove(TC.Consts.classes.HIDDEN);e.querySelector(d.SIMULATE).classList.remove(TC.Consts.classes.HIDDEN);e.querySelector(d.EDIT).classList.remove(TC.Consts.classes.HIDDEN);e.querySelector(d.DELETE).classList.remove(TC.Consts.classes.HIDDEN);e.querySelector(d.DRAW).classList.remove(TC.Consts.classes.HIDDEN);e.querySelector(d.EXPORT).classList.remove(TC.Consts.classes.HIDDEN);e.querySelector(d.SAVE).classList.add(TC.Consts.classes.HIDDEN);e.querySelector(d.CANCEL).classList.add(TC.Consts.classes.HIDDEN)}};s.uiSimulate=function(t,e){if(e){var n=[d.SIMULATE,d.EDIT,d.DELETE,d.EXPORT],a=[d.STOP,d.PAUSE,d.BACKWARD,d.FORWARD,d.SPEED],o="LI"===e.tagName?e:e.parentNode;n.forEach(function(e){o.querySelector(e).hidden=t});a.forEach(function(e){o.querySelector(e).hidden=!t})}};m.addEventListener("click",TC.EventTarget.listenerBySelector(d.SIMULATE,function(t){var e=s.getLoadingIndicator().addWait();t.target.parentElement.querySelector(d.SPEED).textContent="x 1";f(s,t.target).then(function(){s.getLoadingIndicator().removeWait(e)})}));m.addEventListener("click",TC.EventTarget.listenerBySelector(d.DRAW,function(t){var e=s.getLoadingIndicator().addWait();g(s,t.target).then(function(){s.getLoadingIndicator().removeWait(e)})}));s.on(s.Const.Event.IMPORTEDTRACK,function(t){if(s.isDisabled)s.map.toast(s.getLocaleString("geo.trk.import.disabled"),{type:TC.Consts.msgType.WARNING});else{const e=s.track.trackList.querySelector('li[data-id="'+t.index+'"]');g(s,e.querySelector(d.DRAW));setTimeout(function(){s.track.trackList.scrollTop=t.index*e.offsetHeight},100)}});const h=function(t,e){t.track.trackList.querySelectorAll("li[data-id]").forEach(function(n){if(n.dataset.id!==e){const e=n.querySelector(d.SIMULATE),a=n.querySelector(d.PAUSE);e.classList.remove(t.Const.Classes.SIMULATIONACTIVATED);e.setAttribute("title",t.getLocaleString("tr.lst.simulate"));a.classList.remove("play");a.setAttribute("title",t.getLocaleString("tr.lst.pause"));t.uiSimulate(!1,n);p(!1,n)}});t.clear(t.Const.Layers.TRACK)};var g=function(t,n){return new Promise(function(a,o){const l=n.parentElement;setTimeout(function(){if(l.classList.contains(t.Const.Classes.SELECTEDTRACK)){t.uiSimulate(!1,n);t.clear(t.Const.Layers.TRACK);t.map.off(TC.Consts.event.FEATUREREMOVE,e);n.setAttribute("title",n.textContent)}else if(t.getSelectedTrack()){h(t,l.dataset.id);t.working=t.drawTrack(l)}else t.working=t.drawTrack(l);l.classList.contains(t.Const.Classes.SELECTEDTRACK)?t.prepareFeaturesToShare(l.dataset.uid).then(function(){a()}):a()},0)})},f=function(t,e){return new Promise(function(n,a){setTimeout(function(){const a=e.parentElement;h(t,a.dataset.id);t.uiSimulate(!1,t.getSelectedTrack());t.uiSimulate(!0,e);t.simulate_paused=!1;t.simulateTrack(a);n()},0)})};m.addEventListener("click",TC.EventTarget.listenerBySelector(s._classSelector+" "+d.EDIT,function(t){p(!0,t.target)}));m.addEventListener("click",TC.EventTarget.listenerBySelector(s._classSelector+" "+d.DELETE,function(t){s.removeTrack(t.target.parentElement)}));m.addEventListener("click",TC.EventTarget.listenerBySelector(s._classSelector+" "+d.SAVE,function(t){if(0===t.target.parentElement.querySelector("input").value.trim().length)TC.alert(s.getLocaleString("geo.trk.edit.alert"));else{s.editTrackName(t.target.parentElement.dataset.id,t.target.parentElement.querySelector("input").value);p(!1,t.target)}}));m.addEventListener("click",TC.EventTarget.listenerBySelector(s._classSelector+" "+d.CANCEL,function(t){p(!1,t.target)}));m.addEventListener("click",TC.EventTarget.listenerBySelector(s._classSelector+" "+d.EXPORT,function(t){const e=t.target.parentElement;t.target.setAttribute("disabled","");s.export(e).then(a=>{s.getDownloadDialog().then(function(o){const l=s.getDownloadDialogOptions(n.call(s,e));o.open(a.map(t=>{t.uid=e.dataset.uid;return t}),l);t.target.removeAttribute("disabled")})})}));m.addEventListener("click",TC.EventTarget.listenerBySelector(s._classSelector+" "+d.STOP,function(t){s.uiSimulate(!1,t.target);s.wrap.simulateTrackEnd();const e=t.target.parentElement.querySelector(d.PAUSE);e.classList.remove("play");e.setAttribute("title",s.getLocaleString("tr.lst.pause"));t.target.parentElement.querySelector(d.SPEED).textContent="x 1";s.simulate_speed=1}));m.addEventListener("click",TC.EventTarget.listenerBySelector(s._classSelector+" "+d.PAUSE,function(t){s.simulate_paused=!t.target.classList.contains("play");s.simulate_paused&&(s.simulate_pausedElapse=-1);t.target.setAttribute("title",s.getLocaleString(s.simulate_paused?"tr.lst.play":"tr.lst.pause"));t.target.classList.toggle("play",!!s.simulate_paused)}));m.addEventListener("click",TC.EventTarget.listenerBySelector(s._classSelector+" "+d.BACKWARD,function(t){1==s.simulate_speed?s.simulate_speed=.5:s.simulate_speed=s.simulate_speed/2;t.target.parentElement.querySelector(s._classSelector+" "+d.FORWARD).disabled=!1;t.target.parentElement.querySelector(d.SPEED).textContent=s.simulate_speed<1?"/ "+1/s.simulate_speed:"x "+s.simulate_speed;.000244140625==s.simulate_speed&&(t.target.disabled=!0)}));m.addEventListener("click",TC.EventTarget.listenerBySelector(s._classSelector+" "+d.FORWARD,function(t){s.simulate_speed=s.simulate_speed/.5;t.target.parentElement.querySelector(d.SPEED).textContent=s.simulate_speed<1?"/ "+1/s.simulate_speed:"x "+s.simulate_speed;t.target.parentElement.querySelector(s._classSelector+" "+d.BACKWARD).disabled=!1;4096==s.simulate_speed&&(t.target.disabled=!0)}));s.track.trackContinue.addEventListener("click",function(){TC.Util.closeModal();A.call(s)});s.track.trackRenew.addEventListener("click",function(){delete s.sessionTracking;TC.Util.storage.setSessionLocalValue(s.Const.LocalStorageKey.TRACKINGTEMP,void 0);localforage.removeItem(s.Const.LocalStorageKey.TRACKINGTEMP);TC.Util.closeModal();A.call(s)});s.track.trackClose.addEventListener("click",function(){r.call(s)});s.track.trackAdvertisementOK.addEventListener("click",function(){const t=document.body.querySelectorAll('input[name*="Advertisement"]:checked');if(t.length>0){new Promise(function(t,e){window.localforage?t():TC.loadJS(!window.localforage,[TC.Consts.url.LOCALFORAGE],function(){t()})}).then(function(){localforage.setItem(t[0].getAttribute("name"),!1)})}TC.Util.closeModal()});s.track.renderTrack=document.querySelector("#tc-ctl-geolocation-track-render-"+s.id);s.track.renderTrack.addEventListener("change",function(){s.track.activateButton.classList.contains(TC.Consts.classes.HIDDEN)&&s.layerTracking.setVisibility(this.checked);l=this.checked});window.localforage?s.bindTracks():TC.loadJS(!window.localforage,[TC.Consts.url.LOCALFORAGE],function(){s.bindTracks()});TC.Util.isFunction(o)&&o()})};t.activate=function(){};t.deactivate=function(){TC.Util.closeModal();this.clearSelection();this.deactivateTracking()};var i=function(){this.track.activateButton.classList.add(TC.Consts.classes.HIDDEN);this.track.deactivateButton.classList.remove(TC.Consts.classes.HIDDEN)},r=function(){this.track.activateButton.classList.remove(TC.Consts.classes.HIDDEN);this.track.deactivateButton.classList.add(TC.Consts.classes.HIDDEN)},c=function(){this.map.toast(this.div.querySelector(".alert-warning").innerHTML,{duration:1e4})};t.markerStyle={radius:7,fillColor:[255,0,0,100],strokeColor:[255,255,255,255],strokeWidth:2};t.lineStyle={strokeWidth:2,strokeColor:[0,206,209,255]};t.setFormatInfoNewPosition=function(t){var e={},n=TC.Util.getMapLocale(this.map);if(this.map.on3DView){var a=this.map.crs!==this.map.view3D.crs?TC.Util.reproject(t.position,this.map.crs,this.map.view3D.crs):t.position;e.x=a[0].toLocaleString(n);e.y=a[1].toLocaleString(n);e.mdt=Math.round(this.map.view3D.getHeightFromMDT(a)).toLocaleString(n);e.isGeo=!0}else{e.x=Math.round(t.position[0]).toLocaleString(n);e.y=Math.round(t.position[1]).toLocaleString(n)}e.z=Math.round(t.altitude).toLocaleString(n);e.accuracy=Math.round(t.accuracy).toLocaleString(n);e.speed=t.speed.toLocaleString(n,{minimumFractionDigits:1,maximumFractionDigits:1});return e};t.getTrackInfoPanel=function(){const t=this;t.track._infoPanelPromise||(t.track._infoPanelPromise=new Promise(function(e,n){if(t.track.infoPanel)e(t.track.infoPanel);else{var a,o={content:"table",titles:{main:t.getLocaleString("geo.mylocation"),max:t.getLocaleString("geo.mylocation.show")},classes:{collapsed:"tracking"}};const n=function(t){o.position=t.POSITION.RIGHT;a=t.addControl("resultsPanel",o)};if(t.options.displayOn){var l=t.map.getControlsByClass("TC.control."+t.options.displayOn[0].toUpperCase()+t.options.displayOn.substring(1))[0];l?n(l):t.map.addControl(t.options.displayOn).then(n)}else{o.div=document.createElement("div");t.map.div.appendChild(o.div);a=t.map.addControl("resultsPanel",o)}a.then(function(n){t.track.infoPanel=n;e(n)})}}));return t.track._infoPanelPromise};t.renderInfoNewPosition=function(t){const e=this;e.getRenderedHtml(e.CLASS+"-tracking-toast",e.setFormatInfoNewPosition(t.pd),function(t){e.getTrackInfoPanel().then(function(n){if(!n.isMinimized()){e.map.getControlsByClass(TC.control.ResultsPanel).filter(t=>t.content===t.contentType.TABLE&&t!==n).forEach(function(t){t.close()});n.renderPromise().then(function(){n.open(t)})}})})};var s,d,u,m=function(){this.track.trackToolPanelOpened.checked||this.map.trigger(TC.Consts.event.TOOLSCLOSE)},A=function(){var t=this;t.activate();i.call(t);m.call(t);t.on(t.Const.Event.POSITIONCHANGE,function(e){t.currentPoint=e.pd;t.renderInfoNewPosition(e);t.track.trackName.disabled=!1;t.track.trackSave.disabled=!1;t.track.trackWPT.disabled=!1;t.track.trackAdd.disabled=!1;TC.Util.storage.setSessionLocalValue(t.Const.LocalStorageKey.TRACKINGTEMP,t.wrap.formattedToStorage(t.layerTracking).features)});t.on(t.Const.Event.STATEUPDATED,function(t){});t.clear(t.Const.Layers.TRACKING);v.call(t,t.Const.LocalStorageKey.TRACKINGSHOWADVERTISEMENT);t.wrap.setTracking(!0)},p=function(){this.videoScreenOn.paused&&this.videoScreenOn.play();C.apply(this)},h=function(){var t=function(){var t=["webkit","moz","ms","o"];if("hidden"in document)return"hidden";for(var e=0;e<t.length;e++)if(t[e]+"Hidden"in document)return t[e]+"Hidden";return null}();document[t]||p.apply(this);console.log("video is: "+this.videoScreenOn.paused)},g=function(){u||(u=h.bind(this));s||(s=function(){f.apply(this)}.bind(this));d||(d=p.bind(this));window.addEventListener("visibilitychange",u,!1);if(TC.Util.detectSafari()&&TC.browserFeatures.touch()&&!navigator.userAgent.match(/Android/i)&&!navigator.userAgent.match(/CriOS/i)){window.addEventListener("pagehide",s,!1);window.addEventListener("pageshow",d,!1)}else{window.addEventListener("blur",s,!1);window.addEventListener("focus",d,!1)}},f=function(){var t=TC.Util.storage.getSessionLocalValue(this.Const.LocalStorageKey.TRACKINGTEMP);t&&t.length>0&&localforage.setItem(this.Const.LocalStorageKey.TRACKINGTEMP,"string"==typeof t?t:JSON.stringify(t))},C=function(){var t=this;localforage.getItem(t.Const.LocalStorageKey.TRACKINGTEMP).then(function(e){null!==e&&"null"!==e&&e.length>0&&TC.Util.storage.setSessionLocalValue(t.Const.LocalStorageKey.TRACKINGTEMP,e)})},v=function(t){var e=this;new Promise(function(t,e){window.localforage?t():TC.loadJS(!window.localforage,[TC.Consts.url.LOCALFORAGE],function(){t()})}).then(function(){localforage.getItem(t).then(function(n){if(null==n){const n=e._dialogDiv.querySelector(".tc-ctl-geolocation-track-advert-dialog"),a=n.querySelector('input[type="checkbox"]');a.setAttribute("name",t);a.checked=!1;document.querySelector("#pageBlurMsg").textContent=TC.Util.detectMobile()?e.getLocaleString("geo.trk.page.blur"):e.getLocaleString("geo.trk.page.blur.desktop");n.querySelector("h3").textContent=t==e.Const.LocalStorageKey.GPSSHOWADVERTISEMENT?e.getLocaleString("geo.track.activate")+" "+e.getLocaleString("geo.gps"):e.getLocaleString("geo.track.activate.title");TC.Util.showModal(e._dialogDiv.querySelector(".tc-ctl-geolocation-track-advert-dialog"))}})});e.map.toast(TC.Util.detectMobile()?e.getLocaleString("geo.trk.page.blur"):e.getLocaleString("geo.trk.page.blur.desktop"),{type:TC.Consts.msgType.WARNING})};t._askTracking=function(t){TC.Util.showModal(this._dialogDiv.querySelector(".tc-ctl-geolocation-continue-track-dialog"),{closeCallback:function(){TC.Util.isFunction(t)&&t()}});return!0};t.activateTracking=function(){var t=this,e=!0;t.isActive||t.activate();t.clear(t.Const.Layers.TRACKING);try{TC.Util.storage.setSessionLocalValue(t.Const.LocalStorageKey.TEST,t.Const.LocalStorageKey.TEST)}catch(n){n.code===DOMException.QUOTA_EXCEEDED_ERR?TC.alert(t.getLocaleString("geo.error.trackinglocalstorage")):TC.error(n);e=!1}if(e){(function(){if(!this.videoScreenOn){var t={WebM:"data:video/webm;base64,GkXfo0AgQoaBAUL3gQFC8oEEQvOBCEKCQAR3ZWJtQoeBAkKFgQIYU4BnQI0VSalmQCgq17FAAw9CQE2AQAZ3aGFtbXlXQUAGd2hhbW15RIlACECPQAAAAAAAFlSua0AxrkAu14EBY8WBAZyBACK1nEADdW5khkAFVl9WUDglhohAA1ZQOIOBAeBABrCBCLqBCB9DtnVAIueBAKNAHIEAAIAwAQCdASoIAAgAAUAmJaQAA3AA/vz0AAA=",MP4:"data:video/mp4;base64,AAAAHGZ0eXBpc29tAAACAGlzb21pc28ybXA0MQAAAAhmcmVlAAAAG21kYXQAAAGzABAHAAABthADAowdbb9/AAAC6W1vb3YAAABsbXZoZAAAAAB8JbCAfCWwgAAAA+gAAAAAAAEAAAEAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAIVdHJhawAAAFx0a2hkAAAAD3wlsIB8JbCAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAQAAAAAAIAAAACAAAAAABsW1kaWEAAAAgbWRoZAAAAAB8JbCAfCWwgAAAA+gAAAAAVcQAAAAAAC1oZGxyAAAAAAAAAAB2aWRlAAAAAAAAAAAAAAAAVmlkZW9IYW5kbGVyAAAAAVxtaW5mAAAAFHZtaGQAAAABAAAAAAAAAAAAAAAkZGluZgAAABxkcmVmAAAAAAAAAAEAAAAMdXJsIAAAAAEAAAEcc3RibAAAALhzdHNkAAAAAAAAAAEAAACobXA0dgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAIAAgASAAAAEgAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABj//wAAAFJlc2RzAAAAAANEAAEABDwgEQAAAAADDUAAAAAABS0AAAGwAQAAAbWJEwAAAQAAAAEgAMSNiB9FAEQBFGMAAAGyTGF2YzUyLjg3LjQGAQIAAAAYc3R0cwAAAAAAAAABAAAAAQAAAAAAAAAcc3RzYwAAAAAAAAABAAAAAQAAAAEAAAABAAAAFHN0c3oAAAAAAAAAEwAAAAEAAAAUc3RjbwAAAAAAAAABAAAALAAAAGB1ZHRhAAAAWG1ldGEAAAAAAAAAIWhkbHIAAAAAAAAAAG1kaXJhcHBsAAAAAAAAAAAAAAAAK2lsc3QAAAAjqXRvbwAAABtkYXRhAAAAAQAAAABMYXZmNTIuNzguMw=="};this.videoScreenOn=document.createElement("video");this.videoScreenOn.setAttribute("loop","");this.videoScreenOn.setAttribute("muted","");this.videoScreenOn.setAttribute("webkit-playsinline","");this.videoScreenOn.setAttribute("playsinline","");this.videoScreenOn.setAttribute("style","transform: translateZ(0px);");var e=document.createElement("source");e.src=t.WebM;e.type="video/webm";this.videoScreenOn.appendChild(e);var n=document.createElement("source");n.src=t.MP4;n.type="video/mp4";this.videoScreenOn.appendChild(n)}this.videoScreenOn.play()}).apply(t);g.apply(t);t.sessionTracking=TC.Util.storage.getSessionLocalValue(t.Const.LocalStorageKey.TRACKINGTEMP);if(t.sessionTracking){t._askTracking(function(){r.call(t)})||t.track.trackRenew.click()}else A.call(t)}else r.call(t)};t.deactivateTracking=function(){var t=this,e=function(){t.getTrackInfoPanel().then(t=>t.close());f.apply(t);t.wrap.setTracking(!1);delete t.geopositionTracking;l||t.div.querySelector(t._classSelector+"-track-render").querySelector("label").click();(function(){this.videoScreenOn&&this.videoScreenOn.pause()}).apply(t);(function(){window.removeEventListener("visibilitychange",u,!1);if(TC.Util.detectSafari()&&TC.browserFeatures.touch()&&!navigator.userAgent.match(/Android/i)&&!navigator.userAgent.match(/CriOS/i)){window.removeEventListener("pagehide",s,!1);window.removeEventListener("pageshow",d,!1)}else{window.removeEventListener("blur",s,!1);window.removeEventListener("focus",d,!1)}}).apply(t);t.off(t.Const.Event.POSITIONCHANGE);t.off(t.Const.Event.STATEUPDATED);r.call(t);t.track.trackName.value="";t.track.trackName.disabled=!0;t.track.trackSave.disabled=!0;t.track.trackWPT.value="";t.track.trackWPT.disabled=!0;t.track.trackAdd.disabled=!0;t.clear(t.Const.Layers.TRACKING);t.clear(t.Const.Layers.GPS);return!0};if(t.wrap.hasCoordinates()){t.map.toast(t.getLocaleString("geo.trk.deactivate.alert"),{duration:1e4});return e()}return e()};t.getStoredTracks=function(){const t=this;return new Promise(function(e,n){var a=[];const o=function(t){0===k.length&&t.filter(t=>t.profile).forEach(t=>k.push({uid:t.uid,data:JSON.parse(t.profile)}));e(t)};localforage.keys().then(function(e){if(0==(e=e.filter(function(e){return 0!==e.indexOf(t.Const.LocalStorageKey.TRACKINGTEMP)&&0===e.indexOf(t.Const.LocalStorageKey.TRACKING)&&/trk#\d/i.exec(e)})).length){t.availableTracks=a;o(a)}const n=new Array(e.length);e.forEach(function(t,e){n[e]=new Promise(function(e,n){localforage.getItem(t,function(t,n){e(n)})})});Promise.all(n).then(function(e){if(e&&e.length){e.forEach(function(t){(t=JSON.parse(t))instanceof Array?a=a.concat(t):a.push(t)});var n=a.length>1?T(a):a;t.availableTracks=n;o(n)}})}).catch(e=>{console.log("Capturamos error que se produce por configuraci\xf3n del navegador.");TC.error(t.getLocaleString("couldNotAccessLocalStorage"))})})};var T=function(t){var e=[];for(var n in t)if(t[n]&&"object"==typeof t[n]){e.push(t[n]);e.sort(function(t,e){return"string"==typeof t.name&&TC.Util.isFunction(t.name.localeCompare)?t.name.localeCompare(e.name):0})}return e};t.setStoredTracks=function(t){const e=this;return new Promise(function(n,a){const o=[];t.forEach(function(t){o.push(new Promise(function(n,a){localforage.setItem(e.Const.LocalStorageKey.TRACKING+"#"+t.uid,JSON.stringify(t),function(t,e){n(e)})}))});Promise.all(o).then(function(){e.getStoredTracks().then(function(){e.bindTracks();n()})})})};t.getAvailableTracks=function(){const t=this;return new Promise(function(e,n){t.availableTracks?e(t.availableTracks):t.getStoredTracks().then(function(t){e(t)})})};t.bindTracks=function(){var t=this;t.track.trackList.querySelectorAll("li").forEach(function(t){t.style.display="none"});t.getAvailableTracks().then(function(e){if(I(e)){t.track.trackList.querySelectorAll('li[class^="tc-ctl-geolocation-track-available-empty"]').forEach(function(t){t.style.display=""});t.track.trackSearch.disabled=!0}else{const l=t.getSelectedTrack();var n;l&&(n=l.dataset.uid);t.track.trackList.querySelectorAll("li[data-id]").forEach(function(e){t.track.trackList.removeChild(e)});for(var a=0;a<e.length;a++){var o=e[a];"object"==typeof o&&t.getRenderedHtml(t.CLASS+"-track-node",{id:a,uid:o.uid,name:o.name?o.name.trim():""},function(e){const n=(new DOMParser).parseFromString(e,"text/html").body.firstChild;t.track.trackList.appendChild(n)})}n&&t.setSelectedTrack(t.track.trackList.querySelector('li[data-uid="'+n+'"]'));t.track.trackSearch.disabled=!1}})};t.chartProgressInit=function(){window.d3||TC.syncLoadJS(TC.Consts.url.D3C3);const t=d3.select(".c3-event-rects,.c3-event-rects-single").node().getBoundingClientRect();this.miDiv=document.createElement("div");this.miDiv.classList.add("miDiv");this.miDiv.style.width=t.width+"px";this.miDiv.style.height=t.height+"px";this.miProgressDiv=document.createElement("div");this.miProgressDiv.classList.add("miProgressDiv",this.CLASS+"-track-elevation-chart-progress",TC.Consts.classes.HIDDEN);this.miProgressDiv.style.width="0%";this.miProgressDiv.style.height=t.height+"px";this.miProgressTextDiv=document.createElement("div");this.miProgressTextDiv.classList.add("miProgressTextDiv","tc-ctl-geolocation-track-elevation-chart-progress","text");this.miProgressTextDiv.style.width=t.width+"px";this.miProgressTextDiv.style.height=t.height+"px";this.miDiv.style.top=t.top+"px";this.miDiv.style.left=t.left+"px";this.miDiv.style.bottom=t.bottom+"px";this.miDiv.style.right=t.right+"px";this.miDiv.style.position="absolute";this.miDiv.style.zIndex=10008;this.miDiv.style.display="none";this.miProgressDiv.appendChild(this.miProgressTextDiv);this.miDiv.appendChild(this.miProgressDiv);document.body.appendChild(this.miDiv)};t.chartProgressClear=function(){const t=this;if(t.miDiv){t.miDiv.parentElement.removeChild(t.miDiv);t.miDiv=null;t.miProgressDiv=null;t.miProgressTextDiv=null}};t.chartSetProgress=function(t,e,n,a){if(!this.resultsPanelChart.isVisible()||this.resultsPanelChart.isMinimized())return;this.miDiv&&"none"===this.miDiv.style.display&&(this.miDiv.style.display="");this.miProgressDiv.classList.remove(TC.Consts.classes.HIDDEN);var o=t.d,l=(o+Math.hypot(t.p[0]-e[0],t.p[1]-e[1]))/n*100;this.miProgressDiv.style.width=l+"%";var i,r,c=this.map.options.locale&&this.map.options.locale.replace("_","-")||void 0,s=parseInt(e[2].toFixed(0)).toLocaleString(c);if(o/1e3<1){i=Math.round(o/1e3*1e3);r=" m"}else{i=Math.round(o/1e3*100)/100;r=" km"}i=i.toLocaleString(c);let d,u=this.elevationChartData.coords.findIndex(t=>t.join()===e.join());this.elevationChartData.elevationFromServiceChartData&&(d=this.elevationChartData.elevationFromServiceChartData.ele[u]);this.miProgressTextDiv.innerHTML="<div><span>"+s+" m"+(d?" / "+d+" m":"")+"</span><br><span>"+i+r+"</span></div>"+(a?"<br><span>"+a.toString+"</span>":"")};t._getTime=function(t,e){var n=e-t,a={},o=Math.floor(n/1e3/60/60/24);n-=1e3*o*60*60*24;var l=Math.floor(n/1e3/60/60);n-=1e3*l*60*60;a.h=l+24*o;var i=Math.floor(n/1e3/60);n-=1e3*i*60;a.m=i;a.s=Math.floor(n/1e3);return TC.Util.extend({},a,{toString:("00000"+a.h).slice(-2)+":"+("00000"+a.m).slice(-2)+":"+("00000"+a.s).slice(-2)})};t.simulateTrack=function(t){var e=this;e.simulate_speed=1;e.drawTrack(t,!1).then(function(){if(e.elevationChartData&&0===e.elevationChartData.min&&0===e.elevationChartData.max){e.map.toast(e.getLocaleString("geo.trk.simulate.empty"),{duration:1e4});e.resultsPanelChart.chart.chart.show("ele2",{withLegend:!0});e.hasElevation=!1}e.wrap.simulateTrack()})};t.drawTrack=function(t,e){var n=this;m.call(n);return new Promise(function(e,a){n.setSelectedTrack(t);n.drawTrackingData(t).then(function(){n.elevationTrack(t).then(()=>{n.activate();e()})})})};const k=[],y=function(t){return k.filter(function(e){return e.uid.toString()===t.toString()})[0]},S=[];const E=function(t){let e=S.filter(function(e){return e.feature===t})[0];return e||S.filter(function(e){return 0===function(t,e){for(var n=[],a=[],o=0;o<t.length;o++)n[t[o]]=!0;for(o=0;o<e.length;o++)n[e[o]]?delete n[e[o]]:n[e[o]]=!0;for(var l in n)a.push(l);return a}(e.feature.geometry,t.geometry).length})[0]},L=function(t,e){var n=E(t);if(!n){n={feature:t};S.push(n)}n.data=e;return n},D=function(t){return TC.feature.Polyline&&t instanceof TC.feature.Polyline},w=function(){return this.layerTrack.features.filter(function(t){return TC.feature.Marker&&!(t instanceof TC.feature.Marker)&&!D(t)})},b=function(t,e,n){const a=this;let o=0===e?t:n[e-1];if(a.map.crs!==a.map.options.utmCrs){t=TC.Util.reproject(t,a.map.crs,a.map.options.utmCrs);o=TC.Util.reproject(o,a.map.crs,a.map.options.utmCrs)}const l=t[0]-o[0],i=t[1]-o[1];return Math.sqrt(l*l+i*i)},P=function(t){const e=this;return new Promise(async function(n,a){let o=function(){return this.layerTrack.features.filter(function(t){return D(t)})[0]}.call(e),l=y(t.dataset.uid);if(l){e.options.displayElevation||delete l.data.elevationFromServiceChartData;e.elevationChartData=l.data;n(e.elevationChartData)}else{const a=await e.getTrackingData(t);if(a.data){let l=a.data;let i=(new TC.wrap.parser.JSON).readFeatures(l).filter(t=>D(t)&&(a.layout===ol.geom.GeometryLayout.XYZM||a.layout===ol.geom.GeometryLayout.XYZ||e.options.displayElevation));if(i.length>0){let l=i[0],r={};if(a.layout==ol.geom.GeometryLayout.XYZM||a.layout==ol.geom.GeometryLayout.XYM){let t=0;t=a.layout==ol.geom.GeometryLayout.XYZM?l.geometry[l.geometry.length-1][3]-l.geometry[0][3]:l.geometry[l.geometry.length-1][2]-l.geometry[0][2];r={s:Math.floor(t/1e3%60),m:Math.floor(t/6e4%60),h:Math.floor(t/36e5%24)}}let c=0;const s=l.geometry.map(function(t,n,a){return[c+=b.call(e,t,n,a),t[2]]});let d=TC.Util.getElevationGain({coords:l.geometry,hillDeltaThreshold:e.hillDeltaThreshold}),u=s.map(t=>t[1]||0);e.elevationChartData=TC.Util.extend({},{time:r,x:s.map(t=>t[0]),ele:u,min:Math.min(...u),max:Math.max(...u),coords:l.geometry},d);if(e.options.displayElevation){let a=e.getLoadingIndicator().addWait();e.elevationChartData.showLegend=!0;(function(t){const e=this;return new Promise(async(n,a)=>{1===t.length&&(t=t.slice()).push(t[0]);const o=e.map.getLoadingIndicator(),l=o&&o.addWait();e.elevation||await e.getElevationTool();e.elevation.getElevation({crs:e.map.crs,coordinates:t,resolution:0,partialCallback:function(t){console.log("Recibimos respuesta parcial");if(t.every(t=>t.some(t=>null===t))){console.log("Todas las elevaciones son null pasamos de repintar");return}let n=0,a=Number.NEGATIVE_INFINITY,o=Number.POSITIVE_INFINITY,l={ele:t.map(function(t,l,i){n+=b.call(e,t,l,i);let r=t[2];if("number"==typeof r){a=Math.max(r,a);o=Math.min(r,o)}return[n,r]}).map(function(t){return t[1]}),type:"area-spline",max:a,min:o};e.elevationChartData.elevationFromServiceChartData=l;const i={coords:t};e.hillDeltaThreshold&&(i.hillDeltaThreshold=e.hillDeltaThreshold);TC.Util.extend(e.elevationChartData.elevationFromServiceChartData,TC.tool.Elevation.getElevationGain(i));e.elevationChartData.elevationFromServiceChartData.elevCoords=t;e.resultsPanelChart.loadDataOnChart(e.elevationChartData)}}).then(function(t){console.log("Recibimos respuesta final");o&&o.removeWait(l);n()}).catch(function(t){o&&o.removeWait(l);a()})})}).call(e,l.geometry).then(t=>{}).catch(t=>{e.map.toast(e.getLocaleString("elevation.error"),{type:TC.Consts.msgType.ERROR,duration:5e3})}).finally(()=>{(function(t,e,n){const a=this;var o=y(n);if(!o){o={uid:parseFloat(n)};k.push(o);a.getAvailableTracks().then(function(t){if(t){let o=t.findIndex(t=>t.uid.toString()===n);if(o>-1){t[o].profile=JSON.stringify(e);a.setStoredTracks(t)}}})}o.data=e;return o}).call(e,o,e.elevationChartData,t.dataset.uid);e.getLoadingIndicator().removeWait(a)});n(e.elevationChartData)}else 0===e.elevationChartData.min&&0===e.elevationChartData.max?n(null):n(e.elevationChartData)}else n(null)}else n(null)}})};t.elevationTrack=function(a,o){var l=this;return new Promise((i,r)=>{const c=function(){if(l.resultsPanelChart){l.resultsPanelChart.currentFeature=l.layerTrack.features.filter(t=>!(TC.feature.Marker&&t instanceof TC.feature.Marker||TC.feature.Point&&t instanceof TC.feature.Point))[0];const t=l.getSelectedTrack();if(t){l.resultsPanelChart.currentFeature.uid=t.dataset.uid;l.resultsPanelChart.currentFeature.fileName=n.call(l,t)}}};if(o){l.wrap.simulateTrackEnd(o);l.uiSimulate(!1,a);return}if(!l.onResize){l.onResize=l.elevationTrack.bind(l,a,!0);window.addEventListener("resize",l.onResize,!1)}l.track.elevationChart&&(l.track.elevationChart=l.track.elevationChart.destroy());const s=function(){P.call(l,a).then(function(t){if(null!=t){t.time&&(t.time=("00000"+t.time.h).slice(-2)+":"+("00000"+t.time.m).slice(-2)+":"+("00000"+t.time.s).slice(-2));l.hasElevation=!0}else{l.hasElevation=!1;t={msg:l.getLocaleString("geo.trk.chart.chpe.empty")}}t.minHeight=l.CHART_SIZE.MIN_HEIGHT;t.maxHeight=l.CHART_SIZE.MAX_HEIGHT;t.minWidth=l.CHART_SIZE.MIN_WIDTH;t.mediumWidth=l.CHART_SIZE.MEDIUM_WIDTH;t.maxWidth=l.CHART_SIZE.MAX_WIDTH;l.map.one(TC.Consts.event.DRAWCHART,function(t){l.chartProgressInit();i()});e=e.bind(l);l.map.on(TC.Consts.event.FEATUREREMOVE,e);l.map.trigger(l.Const.Event.DRAWTRACK,{data:t})})};if(l.resultsPanelChart){c();l.resultsPanelChart.open();s()}else{window.c3||TC.syncLoadJS(TC.Consts.url.D3C3||TC.apiLocation+"lib/d3c3/d3c3.min.js");var d,u={content:"chart",titles:{main:l.getLocaleString("geo.trk.chart.chpe"),max:l.getLocaleString("geo.trk.chart.chpe")},openOn:l.Const.Event.DRAWTRACK,closeOn:l.Const.Event.CLEARTRACK,chart:{ctx:l,onmouseout:t.removeElevationTooltip,tooltip:t.getElevationTooltip}};const e=function(t){u.position=t.POSITION.RIGHT;d=t.addControl("resultsPanel",u)};if(l.options.displayOn){var m=l.map.getControlsByClass("TC.control."+l.options.displayOn[0].toUpperCase()+l.options.displayOn.substring(1))[0];m?e(m):l.map.addControl(l.options.displayOn).then(e)}else{u.div=document.createElement("div");l.map.div.appendChild(u.div);d=l.map.addControl("resultsPanel",u)}d.then(function(t){t.caller=l;l.resultsPanelChart=t;c();t.renderPromise().then(function(){t.activateSnapping=function(t){l.layerTrack&&!l.layerTrack.getVisibility()&&0==l.layerTrack.getOpacity()&&l.wrap.deactivateSnapping.call(l.wrap)};t.deactivateSnapping=function(t){l.layerTrack&&l.layerTrack.getVisibility()&&l.layerTrack.getOpacity()>0&&l.wrap.activateSnapping.call(l.wrap)};t.div.addEventListener("mouseover",t.deactivateSnapping);t.div.addEventListener("mouseout",t.activateSnapping);l.map.on(TC.Consts.event.RESULTSPANELMIN,function(){l.miDiv&&(l.miDiv.style.display="none")}).on(TC.Consts.event.RESULTSPANELMAX,function(){l.miDiv&&(l.miDiv.style.display="none")}).on(TC.Consts.event.RESULTSPANELCLOSE,function(t){l.miDiv&&(l.miDiv.style.display="none")});s()})})}})};t.clear=function(t){var e=this;if(e.onResize){window.removeEventListener("resize",e.onResize,!1);e.onResize=void 0}if(t==e.Const.Layers.TRACK){e.layerTrack.clearFeatures();e.resultsPanelChart&&e.resultsPanelChart.close();delete e.elevationChartData;e.wrap.simulateTrackEnd();e.wrap.clear();e.track.trackList.querySelectorAll("li").forEach(function(t){t.classList.remove(e.Const.Classes.SELECTEDTRACK)});e.map.trigger(e.Const.Event.CLEARTRACK);e.featuresToShare=[]}else{e.layerTracking.clearFeatures();e.layerGPS.clearFeatures()}};t.saveTrack=function(t){const e=this;return new Promise(function(n,a){let o=t.message||e.getLocaleString("geo.trk.save.alert");var l=function(l){let i;i=e.getLoadingIndicator().addWait();let r=t.importedFileName||e.track.trackName.value.trim(),c=e.availableTracks;c||(c=[]);let s=e.wrap.formattedToStorage(l,!0,t.notReproject),d=function(t){e.track.trackName.value="";e.track.trackName.disabled=!0;e.track.trackSave.disabled=!0;e.track.trackWPT.value="";e.track.trackWPT.disabled=!0;e.track.trackAdd.disabled=!0;e.getLoadingIndicator().removeWait(t);m.call(e)},u={name:r,data:s.features,layout:s.layout,crs:e.storageCRS};const A=function(t){let e=JSON.parse(JSON.stringify(t));e.data=e.data.replace(/(\"id\"\s?\:\s?\"[a-z0-9]+\")/gi,'""');return hex_md5(JSON.stringify(e))};TC.loadJS(!window.hex_md5,[TC.apiLocation+TC.Consts.url.HASH],function(){let t=A(u),l=c.map(function(e){let n=JSON.parse(JSON.stringify(e));delete n.uid;delete n.profile;if(t===A(n))return e.uid;{const a=new ol.format.GeoJSON;let o=a.readFeatures(n.data),l=Math.pow(10,TC.Consts.DEGREE_PRECISION+1);o.forEach(function(t){let e=TC.Util.explodeGeometry(TC.Util.compactGeometry(t.getGeometry().getCoordinates(),l));t.getGeometry().setCoordinates(e)});n.data=a.writeFeatures(o);return t===hex_md5(JSON.stringify(n))?e.uid:null}}).filter(function(t){return null!==t});const r=function(t){return e.getStoredTracks().then(function(){e.bindTracks();let n;for(var a=0;a<e.availableTracks.length;a++)if(e.availableTracks[a].uid===t){n=a;break}return n})};if(0===l.length){u.uid=Date.now()+Math.random();c.push(u);c=T(c);try{e.setStoredTracks(c).then(function(){e.map.toast(o,{duration:3e3});d(i);r(u.uid).then(function(t){n(t)})})}catch(t){TC.alert(e.getLocaleString("geo.error.savelocalstorage")+": "+t.message);d(i);a(t)}}else{console.log("Ya existe un track con ese mismo hash");d(i);r(l[0]).then(function(t){n(t)})}})};if(e.importedFileName)l(e.layerTrack);else if(0==e.track.trackName.value.trim().length){e.track.trackName.value=(new Date).toLocaleString();l(e.layerTracking)}else l(e.layerTracking)})};t.addWaypoint=function(){var t=this.track.trackWPT.value.trim();t||(t=(new Date).toLocaleString());var e=this.getLoadingIndicator().addWait();m.call(this);this.wrap.addWaypoint(this.currentPoint.position,{name:t,ele:this.currentPoint.heading,time:(new Date).getTime()});this.track.trackWPT.value="";this.track.trackWPT.disabled=!0;this.track.trackAdd.disabled=!0;TC.Util.storage.setSessionLocalValue(this.Const.LocalStorageKey.TRACKINGTEMP,this.wrap.formattedToStorage(this.layerTracking).features);this.getLoadingIndicator().removeWait(e)};t.editTrackName=function(t,e){var n=this;n.getAvailableTracks().then(function(a){if(a&&a[t]){a[t].name=e;n.setStoredTracks(a)}})};t.removeTrack=function(t){var e=this;e.getAvailableTracks().then(function(n){if(n){var a=t.dataset.id;if(n[a]){var o=n[a].uid;TC.confirm(e.getLocaleString("geo.trk.delete.alert"),function(){const t=e.getSelectedTrack();t&&t.dataset.id===a&&e.clear(e.Const.Layers.TRACK);localforage.removeItem(e.Const.LocalStorageKey.TRACKING+"#"+o).then(function(){e.getStoredTracks().then(function(){e.bindTracks()})}).catch(function(t){console.log(t)})},function(){})}}})};t.setSelectedTrack=function(t){var e=this;e.isActive||e.activate();e.track.trackList.querySelectorAll("li[data-id] > span").forEach(function(t){t.setAttribute("title",t.textContent)});e.track.trackList.querySelectorAll("li").forEach(function(t){t.classList.remove(e.Const.Classes.SELECTEDTRACK)});t.classList.add(e.Const.Classes.SELECTEDTRACK);t.setAttribute("title",e.getLocaleString("tr.lst.clear")+" "+t.querySelector("span").textContent);t.querySelector(e.Const.Selector.DRAW).setAttribute("title",t.getAttribute("title"))};t.getSelectedTrack=function(){return this.track.trackList.querySelector("li."+this.Const.Classes.SELECTEDTRACK)};t.clearSelectedTrack=function(){const t=this,e=t.getSelectedTrack();if(e){if(t.onResize){window.removeEventListener("resize",t.onResize,!1);t.onResize=void 0}e.classList.remove(t.Const.Classes.SELECTEDTRACK);e.setAttribute("title",e.textContent);e.querySelector(t.Const.Selector.DRAW).setAttribute("title",e.getAttribute("title"))}};t.clearSelection=function(){this.wrap.deactivateSnapping();this.getSelectedTrack()&&this.clearSelectedTrack();if(this.resultsPanelChart){this.resultsPanelChart.div.removeEventListener("mouseover",this.resultsPanelChart.deactivateSnapping);this.resultsPanelChart.div.removeEventListener("mouseout",this.resultsPanelChart.activateSnapping);this.resultsPanelChart.close()}this.clear(this.Const.Layers.TRACK)};t.drawTrackingData=function(t){const e=this;return new Promise(function(n,a){e.wrap.clear();e.getTrackingData(t).then(function(t){t.data;t.data&&e.wrap.drawTrackingData(t).then(function(){var t=e.layerTrack.features;if(t&&t.length>0){var a=t.filter(function(t){t.showsPopup=!1;return!!(TC.feature.MultiPolyline&&t instanceof TC.feature.MultiPolyline)||t instanceof TC.feature.Polyline}).map(function(t){return TC.feature.MultiPolyline&&t instanceof TC.feature.MultiPolyline?t.geometry[0]:t instanceof TC.feature.Polyline?t.geometry:void 0})[0];if(a){var o=a[0],l=a[a.length-1];o&&o!==l&&e.layerTrack.addMarker(o.slice().splice(0,2),{showsPopup:!1,cssClass:e.CLASS+"-track-marker-icon-end",anchor:[.5,1],notExport:!0});l&&e.layerTrack.addMarker(l.slice().splice(0,2),{showsPopup:!1,cssClass:e.CLASS+"-track-marker-icon",anchor:[.5,1],notExport:!0})}}e.layerTrack.setVisibility(!0);n()})})})};t.getTrackingData=function(t){const e=this;return new Promise(function(n,a){e.getAvailableTracks().then(function(a){if(a){const l=t.dataset.id;if(a[l]){var o=a[l].data;o=e.wrap.formattedFromStorage(o);n({data:o,layout:a[l].layout})}}else n()})})};t.export=function(t){return this.wrap.export(t)};t.getElevationTooltip=function(t){this.wrap.showElevationMarker(t);return this.resultsPanelChart.getElevationChartTooltip(t)};t.removeElevationTooltip=function(){this.wrap.hideElevationMarker()};t.clearFileInput=function(t){const e=document.createElement("form"),n=t.parentElement;n.insertBefore(e,t);e.appendChild(t);e.reset();e.insertAdjacentElement("afterend",t);n.removeChild(e)};t.getLoadingIndicator=function(){if(!this.loading){this.loading=this.map.getControlsByClass(TC.control.LoadingIndicator);this.loading&&this.loading.length>0&&(this.loading=this.loading[0])}return this.loading};t.onGeolocateError=function(t){var e;if(navigator.geolocation){this.currentPosition&&navigator.geolocation.clearWatch(this.currentPosition);if(this.currentPositionTrk){this.currentPositionTrk=this.currentPositionTrk instanceof Array?this.currentPositionTrk:[this.currentPositionTrk];this.currentPositionTrk.forEach(function(t){navigator.geolocation.clearWatch(t)});this.currentPositionTrk=[]}}this.currentPositionWaiting&&this.getLoadingIndicator().removeWait(this.currentPositionWaiting);switch(t.code){case t.PERMISSION_DENIED:e=this.getLocaleString("geo.error.permission_denied");break;case t.POSITION_UNAVAILABLE:e=this.getLocaleString("geo.error.position_unavailable");break;case t.TIMEOUT:e=this.getLocaleString("geo.error.timeout");break;default:e=this.getLocaleString("geo.error.default")}this.map.toast(e,{type:TC.Consts.msgType.WARNING});if(!this.geopositionTracking&&this.track){this.track.activateButton.classList.remove(TC.Consts.classes.HIDDEN);this.track.deactivateButton.classList.add(TC.Consts.classes.HIDDEN)}};var I=function(t){return!t||0===t.length};t.exportState=function(){const t=this;if(t.exportsState){const n={};if(t.layerTrack&&t.track){var e=t.layerTrack.features;if(e.length>0&&t.featuresToShare&&t.featuresToShare.length>0)n.features=t.featuresToShare;else{const a=t.layerTrack.exportState({features:e});n.features=a.features}n.id=t.id;const a=t.getSelectedTrack();a&&(n.trackName=a.querySelector("span").innerHTML);return n}}return null};t.importState=function(t){const e=this;if(e.map&&t.features&&t.features.length){e.enable();if(t.features.length>0){const n=new Array(t.features.length);t.features.forEach(function(t,e){const a={data:t.data,id:t.id,showsPopup:t.showsPopup};var o=TC.Util.explodeGeometry(t.geom);switch(t.type){case TC.Consts.geom.POLYLINE:n[e]=new TC.feature.Polyline(o,a);break;case TC.Consts.geom.MULTIPOLYLINE:n[e]=new TC.feature.MultiPolyline(o,a);break;case TC.Consts.geom.MARKER:n[e]=new TC.feature.Marker(o,a);break;case TC.Consts.geom.POINT:n[e]=new TC.feature.Point(o,a)}});Promise.all(n).then(function(n){var a={features:n,fileName:t.trackName,notReproject:!0,isShared:!0};e.availableTracks?e.importTrack(a):e.getStoredTracks().then(function(){e.importTrack(a)})})}}}}();
//# sourceMappingURL=../maps/control/Geolocation.min.js.map