TC.control=TC.control||{};TC.control.ProjectionSelector||TC.syncLoadJS(TC.apiLocation+"TC/control/ProjectionSelector");TC.control.Coordinates=function(){TC.Control.apply(this,arguments);this.crs="";this.xy=[0,0,0];this.latLon=[0,0,0];this.x=0;this.y=0;this.lat=0;this.lon=0;this.units=TC.Consts.units.METERS;this.isGeo=!1;this.allowReprojection=!this.options.hasOwnProperty("allowReprojection")||this.options.allowReprojection;TC.control.ProjectionSelector.apply(this,arguments);TC.Util.extend(this._cssClasses,{CRS:this.CLASS+"-crs",GEOCRS:this.CLASS+"-geocrs",X:this.CLASS+"-x",Y:this.CLASS+"-y",LAT:this.CLASS+"-lat",LON:this.CLASS+"-lon",ELEVATION:this.CLASS+"-elevation",THREEDMARKER:this.CLASS+"-threed"});this.geoCrs=this.options.geoCrs||TC.Cfg.geoCrs;this.wrap=new TC.wrap.control.Coordinates(this)};TC.inherit(TC.control.Coordinates,TC.control.ProjectionSelector);!function(){var n=TC.control.Coordinates.prototype;n.CLASS="tc-ctl-coords";n.template={};n.template[n.CLASS]={1:function(n,t,o,e,s){return' class="tc-active"'},3:function(n,t,o,e,s){var l=n.escapeExpression,i=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return'<button class="tc-ctl-coords-crs" title="'+l(i(o,"i18n").call(null!=t?t:n.nullContext||{},"changeCRS",{name:"i18n",hash:{},data:s,loc:{start:{line:1,column:195},end:{line:1,column:215}}}))+'">'+l(n.lambda(null!=t?i(t,"crs"):t,t))+"</button>"},5:function(n,t,o,e,s){var l,i=null!=t?t:n.nullContext||{},a=n.escapeExpression,r=n.lambda,c=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return"    "+a(c(o,"i18n").call(i,"lat",{name:"i18n",hash:{},data:s,loc:{start:{line:4,column:4},end:{line:4,column:18}}}))+': <span class="tc-ctl-coords-lat">'+a(r(null!=t?c(t,"lat"):t,t))+"</span> "+a(c(o,"i18n").call(i,"lon",{name:"i18n",hash:{},data:s,loc:{start:{line:4,column:67},end:{line:4,column:81}}}))+': <span class="tc-ctl-coords-lon">'+a(r(null!=t?c(t,"lon"):t,t))+"</span> "+(null!=(l=c(o,"if").call(i,null!=t?c(t,"ele"):t,{name:"if",hash:{},fn:n.program(6,s,0),inverse:n.noop,data:s,loc:{start:{line:4,column:130},end:{line:4,column:217}}}))?l:"")+"\r\n"},6:function(n,t,o,e,s){var l=n.escapeExpression,i=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return l(i(o,"i18n").call(null!=t?t:n.nullContext||{},"ele",{name:"i18n",hash:{},data:s,loc:{start:{line:4,column:141},end:{line:4,column:155}}}))+': <span class="tc-ctl-coords-elevation">'+l(n.lambda(null!=t?i(t,"ele"):t,t))+"</span> "},8:function(n,t,o,e,s){var l,i=n.lambda,a=n.escapeExpression,r=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return'    x: <span class="tc-ctl-coords-x">'+a(i(null!=t?r(t,"x"):t,t))+'</span> y: <span class="tc-ctl-coords-y">'+a(i(null!=t?r(t,"y"):t,t))+"</span> "+(null!=(l=r(o,"if").call(null!=t?t:n.nullContext||{},null!=t?r(t,"ele"):t,{name:"if",hash:{},fn:n.program(9,s,0),inverse:n.noop,data:s,loc:{start:{line:6,column:96},end:{line:6,column:170}}}))?l:"")+"\r\n"},9:function(n,t,o,e,s){var l=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return'z: <span class="tc-ctl-coords-elevation">'+n.escapeExpression(n.lambda(null!=t?l(t,"ele"):t,t))+"</span> "},11:function(n,t,o,e,s){var l,i=null!=t?t:n.nullContext||{},a=n.escapeExpression,r=n.lambda,c=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return'<div class="tc-ctl-coords-alt">\r\n    <div class="tc-ctl-coords-xy">\r\n        '+a(c(o,"i18n").call(i,"lat",{name:"i18n",hash:{},data:s,loc:{start:{line:12,column:8},end:{line:12,column:22}}}))+': <span class="tc-ctl-coords-lat">'+a(r(null!=t?c(t,"lat"):t,t))+"</span> "+a(c(o,"i18n").call(i,"lon",{name:"i18n",hash:{},data:s,loc:{start:{line:12,column:71},end:{line:12,column:85}}}))+': <span class="tc-ctl-coords-lon">'+a(r(null!=t?c(t,"lon"):t,t))+"</span> "+(null!=(l=c(o,"if").call(i,null!=t?c(t,"ele"):t,{name:"if",hash:{},fn:n.program(6,s,0),inverse:n.noop,data:s,loc:{start:{line:12,column:134},end:{line:12,column:221}}}))?l:"")+"\r\n    </div>\r\n</div>\r\n"},compiler:[8,">= 4.3.0"],main:function(n,t,o,e,s){var l,i=null!=t?t:n.nullContext||{},a=n.escapeExpression,r=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return'<div title="'+a(r(o,"i18n").call(i,"crs",{name:"i18n",hash:{},data:s,loc:{start:{line:1,column:12},end:{line:1,column:26}}}))+'"'+(null!=(l=r(o,"if").call(i,null!=t?r(t,"allowReprojection"):t,{name:"if",hash:{},fn:n.program(1,s,0),inverse:n.noop,data:s,loc:{start:{line:1,column:27},end:{line:1,column:77}}}))?l:"")+'>CRS: <span class="tc-ctl-coords-crs">'+a(n.lambda(null!=t?r(t,"crs"):t,t))+"</span>"+(null!=(l=r(o,"if").call(i,null!=t?r(t,"allowReprojection"):t,{name:"if",hash:{},fn:n.program(3,s,0),inverse:n.noop,data:s,loc:{start:{line:1,column:129},end:{line:1,column:240}}}))?l:"")+'</div>\r\n<div class="tc-ctl-coords-xy">\r\n'+(null!=(l=r(o,"if").call(i,null!=t?r(t,"isGeo"):t,{name:"if",hash:{},fn:n.program(5,s,0),inverse:n.program(8,s,0),data:s,loc:{start:{line:3,column:4},end:{line:7,column:11}}}))?l:"")+"</div>\r\n"+(null!=(l=r(o,"if").call(i,null!=t?r(t,"showGeo"):t,{name:"if",hash:{},fn:n.program(11,s,0),inverse:n.noop,data:s,loc:{start:{line:9,column:0},end:{line:15,column:7}}}))?l:"")+'<span class="close"></span>'},useData:!0};n.template[n.CLASS+"-dialog"]={compiler:[8,">= 4.3.0"],main:function(n,t,o,e,s){var l=null!=t?t:n.nullContext||{},i=n.escapeExpression,a=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return'<div class="tc-ctl-coords-crs-dialog tc-modal">\r\n    <div class="tc-modal-background tc-modal-close"></div>\r\n    <div class="tc-modal-window">\r\n        <div class="tc-modal-header">\r\n            <h3>'+i(a(o,"i18n").call(l,"changeCRS",{name:"i18n",hash:{},data:s,loc:{start:{line:5,column:16},end:{line:5,column:36}}}))+'</h3>\r\n            <div class="tc-modal-close"></div>\r\n        </div>\r\n        <div class="tc-modal-body">\r\n            <p>'+i(a(o,"i18n").call(l,"coords.currentProjection",{name:"i18n",hash:{},data:s,loc:{start:{line:9,column:15},end:{line:9,column:50}}}))+'</p>\r\n            <p class="tc-ctl-coords-no-change">'+i(a(o,"i18n").call(l,"coords.noCrs.warning",!0,{name:"i18n",hash:{},data:s,loc:{start:{line:10,column:47},end:{line:10,column:83}}}))+'</p>\r\n            <div class="tc-ctl-coords-change">\r\n                <p>'+i(a(o,"i18n").call(l,"coords.instructions",!0,{name:"i18n",hash:{},data:s,loc:{start:{line:12,column:19},end:{line:12,column:54}}}))+'</p>\r\n                <p class="tc-msg-warning tc-hidden">'+i(a(o,"i18n").call(l,"coords.instructions.warning",!0,{name:"i18n",hash:{},data:s,loc:{start:{line:13,column:52},end:{line:13,column:95}}}))+'</p>\r\n            </div>\r\n            <ul class="tc-ctl-coords-crs-list tc-crs-list"></ul>\r\n        </div>\r\n        <div class="tc-modal-footer">\r\n            <button type="button" class="tc-button tc-modal-close">'+i(a(o,"i18n").call(l,"close",{name:"i18n",hash:{},data:s,loc:{start:{line:18,column:67},end:{line:18,column:83}}}))+"</button>\r\n        </div>\r\n    </div>\r\n</div>\r\n"},useData:!0};n.register=function(n){var t=this;const o=TC.control.ProjectionSelector.prototype.register.call(t,n);t.crs=t.map.crs;t.clear();n.on(TC.Consts.event.VIEWCHANGE,function(n){const o=n.view;if(o===TC.Consts.view.PRINTING)return;const e=function(n){t.isPointerOver(n)||t.clear()};if(o===TC.Consts.view.THREED){t.isGeo=!0;t.units=TC.Consts.units.DEGREES;t.crs=t.map.view3D.crs;t.map.view3D.container.addEventListener("mouseout",e);t.map.view3D.on(TC.Consts.event.MOUSEMOVE,function(n){if(n){if(TC.Util.detectMobile()){t.clear();t.coordsToClick({coordinate:[n.lon,n.lat,n.ele],cssClass:t._cssClasses.THREEDMARKER})}t.latLon=[n.lat,n.lon];if(n.ele>0){var o=TC.Util.getMapLocale(t.map);t.latLon.push(n.ele.toLocaleString(o)+"m")}t.update()}else t.clear()})}else if(o===TC.Consts.view.DEFAULT){t.isGeo=t.map.wrap.isGeo();t.units=TC.Consts.units.METERS;t.crs=t.map.crs;t.map.view3D&&t.map.view3D.container.removeEventListener("mouseout",e)}if(t.map.view3D){t.geoCrs=t.map.view3D.crs;t.render()}});n.loaded(function(){t.wrap.register(n).then(function(){t.render(function(){t.clear()})});TC.Util.detectMobile()&&t.renderPromise().then(function(){t.getLayer();t.activateCoords()});n.on(TC.Consts.event.PROJECTIONCHANGE,function(o){if(!n.on3DView){t.isGeo=n.wrap.isGeo();t.crs=o.newCrs;t.render()}});t.map.wrap.getViewport().then(function(n){t.renderPromise().then(function(){n.addEventListener(TC.Consts.event.MOUSEMOVE,function(n){t.map.on3DView||t.onMouseMove(n)});n.addEventListener(TC.Consts.event.MOUSELEAVE,function(n){t.onMouseLeave(n)})})})});return o};n.render=function(n){const t=this;return t._set1stRenderPromise(t.getRenderedHtml(t.CLASS+"-dialog",null,function(n){t._dialogDiv.innerHTML=n}).then(function(){return TC.Control.prototype.renderData.call(t,{x:t.x,y:t.y,lat:t.lat,lon:t.lon,ele:t.isGeo&&t.latLon.length>2?t.latLon[2]:!t.isGeo&&t.xy.length>2?t.xy[2]:null,crs:t.crs,geoCrs:t.geoCrs,isGeo:t.isGeo,showGeo:!t.isGeo&&t.options.showGeo,allowReprojection:t.allowReprojection},function(){const o=t.div.querySelector("button."+t._cssClasses.CRS);o&&o.addEventListener(TC.Consts.event.CLICK,function(n){t.showProjectionChangeDialog()},{passive:!0});TC.Util.isFunction(n)&&n()})}))};n.onMouseMove=function(n){this.wrap.onMouseMove(n)};n.onMouseLeave=function(n){const t=this;setTimeout(function(){if(!t.isPointerOver(n)){t.div.style.visibility="hidden";t.clear()}},200)};n.isPointerOver=function(n){var t=this.div.getBoundingClientRect();return t.left<=n.clientX&&t.left+t.width>=n.clientX&&t.top<=n.clientY&&t.top+t.height>=n.clientY};n.update=function(){const n=this;!n.isGeo&&n.options.showGeo&&(n.latLon=TC.Util.reproject(n.xy,n.crs,n.geoCrs).reverse());if(!n.isGeo){n.x=TC.Util.formatCoord(n.xy[0],TC.Consts.METER_PRECISION);n.y=TC.Util.formatCoord(n.xy[1],TC.Consts.METER_PRECISION)}if(n.isGeo||n.options.showGeo){n.lat=TC.Util.formatCoord(n.latLon[0],TC.Consts.DEGREE_PRECISION);n.lon=TC.Util.formatCoord(n.latLon[1],TC.Consts.DEGREE_PRECISION)}n.render(function(){const t=n.div.querySelector("span.close");if(TC.Util.detectMobile()){t.addEventListener("click",function(){n.div.classList.add(TC.Consts.classes.HIDDEN);n.clear()});t.style.display=""}else{n.div.classList.remove(TC.Consts.classes.HIDDEN);n.div.style.visibility="visible";t.style.display="none"}})};n.clear=function(){this.div.classList.add(TC.Consts.classes.HIDDEN);this.div.style.visibility="hidden";delete this.currentCoordsMarker;this.getLayer().then(function(n){n.features.length&&n.clearFeatures()})};n.deactivateCoords=function(){this.div.classList.add(TC.Consts.classes.HIDDEN);this.clear();this.wrap.coordsDeactivate()};n.activateCoords=function(){this.wrap.coordsActivate()};n.getCoords=function(){var n=this.map.getControlsByClass(TC.control.Popup);if(n&&n.length>0&&n[0].isVisible())this.coordsToPopup(n[0]);else{this.updateCoordsCtrl([(this.map.getExtent()[0]+this.map.getExtent()[2])/2,(this.map.getExtent()[1]+this.map.getExtent()[3])/2]);this.coordsToClick.call(this,{coordinate:this.xy})}};n.coordsToPopup=function(n){n&&this.updateCoordsCtrl(n.wrap.popup.getPosition())};n.updateCoordsCtrl=function(n){if(n){if(!this.isGeo){this.x=n[0];this.y=n[1];this.xy=[this.x,this.y];n.length>2&&this.xy.push(n[2])}if(this.isGeo||this.options.showGeo){this.lat=n[0];this.lon=n[1];this.latLon=[this.lat,this.lon];n.length>2&&this.latLon.push(n[2])}this.update()}};n.coordsToClick=function(n){var t=this;if(!t.map.div.classList.contains("tc-ctl-sv-active")||!t.map.div.classList.contains(TC.Consts.classes.COLLAPSED)){var o=t.div.getBoundingClientRect();if(o.left<=n.clientX&&n.clientX<=o.right&&o.top<=n.clientY&&n.clientY<=o.bottom){t.div.classList.add(TC.Consts.classes.HIDDEN);t.clear();return}t.div.classList.remove("tc-fading");setTimeout(function(){t.div.classList.add("tc-fading")},10);t.updateCoordsCtrl(n.coordinate);t.map.on3DView||t.coordsMarkerAdd(n.coordinate,n.cssClass);t.div.classList.remove(TC.Consts.classes.HIDDEN)}};n.coordsMarkerAdd=function(n,t){var o=this;o.currentCoordsMarker?o.currentCoordsMarker.setCoords(n):o.getLayer().then(function(e){e.addMarker(n,{title:"Coord",showsPopup:!1,cssClass:t||TC.Consts.classes.POINT,anchor:[.5,.5]}).then(function(n){o.currentCoordsMarker=n})})};n.getLayer=function(){const n=this;return new Promise(function(t,o){null==n.layer?n.map.addLayer({id:n.getUID(),type:TC.Consts.layerType.VECTOR,stealth:!0,owner:n,title:"Coordenadas"}).then(function(o){n.layer=o;n.layer.map.putLayerOnTop(n.layer);t(n.layer)}):t(n.layer)})}}();
//# sourceMappingURL=../maps/control/Coordinates.min.js.map