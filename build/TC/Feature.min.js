TC.feature=TC.feature||{};TC.Feature=function(t,e){this.wrap=new TC.wrap.Feature;this.wrap.parent=this;if(this.wrap.isNative(t)){this.wrap.feature=t;t._wrap=this.wrap;this.id=this.wrap.getId();this.geometry=this.wrap.getGeometry();t._folders&&(this.folders=t._folders);this.data=this.wrap.getData()}var o=this.options=TC.Util.extend(!0,{},e);this.id=this.id||o.id||TC.getUID();this.data=o.data||this.data||null;this._visibilityState=TC.Consts.visibility.VISIBLE;void 0===o.showsPopup?this.showsPopup=!0:this.showsPopup=o.showsPopup;this.layer=o.layer||null;this._selected=!1;o.selected&&this.select()};TC.Feature.prototype.STYLETYPE=TC.Consts.geom.POLYGON;TC.Feature.prototype.CLASSNAME="TC.Feature";TC.Feature.prototype.getPath=function(){var t=[];this.folders?t=this.folders:this.options.group&&(t=[this.options.group]);return t};TC.Feature.prototype.setVisibility=function(t){var e=this;if(!t&&e.showsPopup&&e.layer){var o=e.layer.map.getControlsByClass(TC.control.Popup).filter(function(t){return t.currentFeature===e});if(o.length>0){const t=o[0];t.isVisible()&&t.hide()}}if(t&&e._visibilityState===TC.Consts.visibility.NOT_VISIBLE||!t&&e._visibilityState===TC.Consts.visibility.VISIBLE){e._visibilityState=t?TC.Consts.visibility.VISIBLE:TC.Consts.visibility.NOT_VISIBLE;e.layer.wrap.setFeatureVisibility(e,t)}};TC.Feature.prototype.setId=function(t){this.id=t;this.wrap.setId(t)};TC.Feature.prototype.getBounds=function(){return this.wrap.getBounds()};TC.Feature.prototype.setStyle=function(t){this.wrap.setStyle(t)};TC.Feature.prototype.toggleSelectedStyle=function(t){const e=this;if(e._hasSelectedStyle!=t){e._hasSelectedStyle=t;e.wrap.toggleSelectedStyle(t)}};TC.Feature.prototype.getLegend=function(){this._legend||(this._legend=this.wrap.getLegend());return this._legend};TC.Feature.prototype.getCoords=function(){this.geometry=this.wrap.getGeometry();return this.geometry};TC.Feature.prototype.getCoordsArray=function(){const t=function(t){return Array.isArray(t)&&t.length>=2&&"number"==typeof t[0]&&"number"==typeof t[1]},e=function(e){return t(e)?[e]:e.reduce(o,[])},o=function(o,r){t(r)?o.push(r):o=o.concat(e(r));return o};return e(this.getCoords())};TC.Feature.prototype.getGeometryStride=function(){const t=this.getCoordsArray()[0];return t?t.length:0};TC.Feature.prototype.setCoords=function(t){const e=function(t){t.forEach(function(o,r){if(Array.isArray(o))e(o);else if(null===o)t[r]=0;else if("number"!=typeof o){console.log("Warning: coordinate does not have number type");t[r]=parseFloat(o)}})};Array.isArray(t)&&e(t);this.geometry=t;return this.wrap.setGeometry(t)};TC.Feature.prototype.getData=function(){return this.data?this.data:this.wrap.getData()};TC.Feature.prototype.setData=function(t){this.data=TC.Util.extend(this.data,t);this.wrap.setData(t)};TC.Feature.prototype.unsetData=function(t){delete this.data[t];this.wrap.unsetData(t)};TC.Feature.prototype.clearData=function(){this.data={};this.wrap.clearData()};TC.Feature.prototype.getInfo=function(t){var e=null,o=(t=t||{}).locale||this.layer&&this.layer.map&&TC.Util.getMapLocale(this.layer.map),r=this.getData();if("object"==typeof r){var s=this.wrap.getTemplate();if(s)e=s.replace(/\$\[?(?:\w+\/)*(\w+)\]/g,function(t,e){return r[e]});else{var n=[];const t=[],s=TC.Util.getLocaleString(o,"open"),a=TC.Util.getLocaleString(o,"linkInNewWindow"),l=function(t){let e;return e=TC.Util.isURL(t)?`<a href="${t}" target="_blank" title="${a}">${s}</a>`:void 0!==t?"number"==typeof t?TC.Util.formatNumber(t,o):t:"&mdash;"},p=function(t){var e=[];if(t instanceof Array){var r="complexAttr_"+TC.getUID();e.push(`<div class="complexAttr"><input type="checkbox" id="${r}" /><div><label for="${r}" title="" class="plus"></label>`);e.push(`<label for="${r}" title="" class="title">${t.length} ${TC.Util.getLocaleString(o,"featureInfo.complexData.array")}</label><br/>`);e.push('<table class="complexAttr"><tbody>');for(var s=0;s<t.length;s++){e.push("<tr><td>");(e=e.concat(p(t[s]))).push("</td></tr>")}e.push("</tbody></table></div></div>")}else if(t instanceof Object)if(t.getType){const o={type:t.getType(),coordinates:t.getCoordinates()};e=e.concat(p(o))}else{e.push('<table class="complexAttr"><tbody>');for(var s in t){e.push("<tr>");if(t[s]&&t[s]instanceof Array){e.push(`<th style="display:none">${s}</th>\n                                           <td><label for="${r}" class="title">${s}</label><br/>`);(e=e.concat(p(t[s]))).push("</div></td>")}else if(t[s]&&t[s]instanceof Object){r="complexAttr_"+TC.getUID();e.push(`<th style="display:none">${s}</th>\n                                           <td><input type="checkbox" id="${r}" /><div><label for="${r}" title="" class="plus"></label>`);e.push(`<label for="${r}" title="" class="title">${s}</label><br/>`);(e=e.concat(p(t[s]))).push("</div></td>")}else{e.push(`<th class="key">${s}</th>\n                                           <td class="value">`);(e=e.concat(p(t[s]))).push("</td>")}e.push("</tr>")}e.push("</tbody></table>")}else e.push(l(t));return e};for(var i in r){const e=r[i],o=i.match(/^h(\d)_/i);if(o)t[o[1]]=e;else if("string"==typeof e||"number"==typeof e||void 0===e)n.push(`<tr><th>${i}</th><td>${l(e)}</td></tr>`);else{n.push(`<tr><th>${i}</th><td>`);(n=n.concat(p(e))).push("</td></tr>")}}const u=t.map(function(t,e){if(t)return`<h${e}>${t}</h${e}>`}).filter(function(t){return t});u.length&&(n=u.concat(n));if(n.length>0){n.unshift('<table class="tc-attr">');n.push("</table>");e=n.join("")}}}else"string"==typeof r&&(e=r);if(!e){e=this.title;this.group&&(e+=" "+this.group)}e||(e=TC.Util.getLocaleString(o,"noData"));return e};TC.Feature.prototype.clone=function(){var t=this.wrap.cloneFeature();t._wrap=this.wrap;return new this.constructor(t,this.options)};TC.Feature.prototype.getStyle=function(){return this.wrap.getStyle()};TC.Feature.prototype.showPopup=function(t){const e=this,o=(t=t||{})&&t instanceof TC.Control?t:t.control,r=e.layer&&e.layer.map||o&&o.map;if(r){var s,n=o||e.popup;if(!n)for(var i=r.getControlsByClass("TC.control.Popup"),a=0,l=i.length;a<l;a++){var p=i[a];if(!p.caller){n=p;break}}if(n){n.currentFeature=e;s=Promise.resolve(n)}else s=r.addControl("popup");s.then(function(o){o.currentFeature=e;r.getControlsByClass(TC.control.Popup).filter(t=>t!==o&&t.isVisible()).forEach(t=>t.hide());e.wrap.showPopup(Object.assign({},t,{control:o}));const s=o.contentDiv.querySelector("table.tc-attr"),n=o.contentDiv.querySelectorAll("h1,h2,h3,h4,h5");if(s&&n.length){const t=s.getBoundingClientRect().width+"px";n.forEach(function(e){e.style.maxWidth=t})}r.trigger(TC.Consts.event.POPUP,{control:o});o.fitToView(!0)})}};TC.Feature.prototype.showResultsPanel=function(t){const e=this,o=(t=t||{})&&t instanceof TC.Control?t:t.control,r=e.layer&&e.layer.map||o&&o.map;if(r){var s,n={content:"table",titles:{main:TC.Util.getLocaleString(r.options.locale,"rsp.title"),max:TC.Util.getLocaleString(r.options.locale,"rsp.title")}},i=r.getControlsByClass("TC.control.ControlContainer")[0];if(i){n.position=i.POSITION.RIGHT;s=i.addControl("resultsPanel",n)}else{n.div=document.createElement("div");r.div.appendChild(n.div);s=r.addControl("resultsPanel",n)}s.then(function(t){t.currentFeature=e;0===r.getControlsByClass(TC.control.ControlContainer).length&&r.getControlsByClass(TC.control.ResultsPanel).filter(function(t){return"table"===t.options.content}).forEach(function(t){t.close()});r.getControlsByClass("TC.control.ResultsPanel").forEach(function(t){t.currentFeature&&!t.chart&&t.close()});t.menuDiv.innerHTML="";t.open(e.getInfo({locale:r.options.locale}),t.getInfoContainer());var o=function(e){r.off(TC.Consts.event.VIEWCHANGE,o);t.close()};r.on(TC.Consts.event.VIEWCHANGE,o)})}};TC.Feature.prototype.showInfo=function(t){const e=this;if((t=t||{}).control&&TC.control){const o=t.control;if(o instanceof TC.control.Popup){e.showPopup(t);return}if(o instanceof TC.control.ResultsPanel){e.showResultsPanel(t);return}}e.layer.map.on3DView||e.layer.map.defaultInfoContainer===TC.Consts.infoContainer.RESULTS_PANEL?e.showResultsPanel(t):e.showPopup(t)};TC.Feature.prototype.select=function(){this._selected=!0;this.layer&&this.layer.selectedFeatures.push(this);var t=this.options.selection||{};this.setStyle(TC.Util.extend({},TC.Cfg.styles.selection[this.STYLETYPE],t[this.STYLETYPE]))};TC.Feature.prototype.unselect=function(){const t=this;t._selected=!1;t.setStyle(t.options);if(t.layer){const e=t.layer.selectedFeatures.indexOf(t);e>=0&&t.layer.selectedFeatures.splice(e,1)}};TC.Feature.prototype.isSelected=function(){return this._selected};TC.Feature.prototype.toGML=function(t,e){return this.wrap.toGML(t,e)};
//# sourceMappingURL=maps/Feature.min.js.map