TC.feature=TC.feature||{};TC.Feature=function(t,e){let o;this.wrap=new TC.wrap.Feature;this.wrap.parent=this;if(this.wrap.isNative(t)){this.wrap.feature=t;t._wrap=this.wrap;o=this.wrap.getId();this.geometry=this.wrap.getGeometry();t._folders&&(this.folders=t._folders);this.setData(this.wrap.getData())}var r=this.options=TC.Util.extend(!0,{},e);this.id=o||r.id||TC.getUID();this.wrap.feature&&!o&&this.wrap.feature.setId(this.id);this.data=r.data||this.data||null;this._visibilityState=TC.Consts.visibility.VISIBLE;void 0===r.showsPopup?this.showsPopup=!0:this.showsPopup=r.showsPopup;this.layer=r.layer||null;this._selected=!1;r.selected&&this.select()};TC.Feature.prototype.STYLETYPE=TC.Consts.geom.POLYGON;TC.Feature.prototype.CLASSNAME="TC.Feature";TC.Feature.prototype.getPath=function(){var t=[];this.folders?t=this.folders:this.options.group&&(t=[this.options.group]);return t};TC.Feature.prototype.setVisibility=function(t){var e=this;if(!t&&e.showsPopup&&e.layer){var o=e.layer.map.getControlsByClass(TC.control.Popup).filter(function(t){return t.currentFeature===e});if(o.length>0){const t=o[0];t.isVisible()&&t.hide()}}if(t&&e._visibilityState===TC.Consts.visibility.NOT_VISIBLE||!t&&e._visibilityState===TC.Consts.visibility.VISIBLE){e._visibilityState=t?TC.Consts.visibility.VISIBLE:TC.Consts.visibility.NOT_VISIBLE;e.layer.wrap.setFeatureVisibility(e,t)}};TC.Feature.prototype.getId=function(){return this.wrap.getId()};TC.Feature.prototype.setId=function(t){this.id=t;this.wrap.setId(t)};TC.Feature.prototype.getBounds=function(){return this.wrap.getBounds()};TC.Feature.prototype.setStyle=function(t){this.wrap.setStyle(t)};TC.Feature.prototype.toggleSelectedStyle=function(t){const e=this;if(e._hasSelectedStyle!=t){e._hasSelectedStyle=t;e.wrap.toggleSelectedStyle(t)}};TC.Feature.prototype.getLegend=function(){this._legend||(this._legend=this.wrap.getLegend());return this._legend};TC.Feature.prototype.getCoords=function(){this.geometry=this.wrap.getGeometry();return this.geometry};TC.Feature.prototype.getCoordsArray=function(){const t=function(t){return Array.isArray(t)&&t.length>=2&&"number"==typeof t[0]&&"number"==typeof t[1]},e=function(e){return t(e)?[e]:e.reduce(o,[])},o=function(o,r){t(r)?o.push(r):o=o.concat(e(r));return o};return e(this.getCoords())};TC.Feature.prototype.getGeometryStride=function(){const t=this.getCoordsArray()[0];return t?t.length:0};TC.Feature.prototype.setCoords=function(t){const e=function(t){t.forEach(function(o,r){if(Array.isArray(o))e(o);else if(null===o)t[r]=0;else if("number"!=typeof o){console.log("Warning: coordinate does not have number type");t[r]=parseFloat(o)}})};Array.isArray(t)&&e(t);this.geometry=t;return this.wrap.setGeometry(t)};TC.Feature.prototype.getData=function(){return this.data?this.data:this.wrap.getData()};TC.Feature.prototype.setData=function(t){const e=this;if("string"==typeof t)e.data=t;else{e.data=TC.Util.extend(e.data,t);e.attributes=e.attributes||[];for(var o in t){let r=e.attributes.filter(t=>t.name===o)[0];r?r.value=t[o]:e.attributes.push({name:o,value:t[o]})}e.wrap.setData(t)}};TC.Feature.prototype.unsetData=function(t){const e=this;delete e.data[t];const o=(e.attributes||[]).filter(e=>e.name===t)[0];o&&e.attributes.splice(e.attributes.indexOf(o),1);e.wrap.unsetData(t)};TC.Feature.prototype.clearData=function(){this.data={};this.attributes=[];this.wrap.clearData()};TC.Feature.prototype.getInfo=function(t){var e=null,o=(t=t||{}).locale||this.layer&&this.layer.map&&TC.Util.getMapLocale(this.layer.map),r=this.getData();if("object"==typeof r){var s=this.wrap.getTemplate();if(s)e=s.replace(/\$\[?(?:\w+\/)*(\w+)\]/g,function(t,e){return r[e]});else{var n=[];const t=[],s=TC.Util.getLocaleString(o,"open"),i=TC.Util.getLocaleString(o,"linkInNewWindow"),l=function(t){let e;return e=TC.Util.isURL(t)?`<a href="${t}" target="_blank" title="${i}">${s}</a>`:void 0!==t?"number"==typeof t?TC.Util.formatNumber(t,o):t:"&mdash;"},u=function(t){var e=[];if(t instanceof Array){var r="complexAttr_"+TC.getUID();e.push(`<div class="complexAttr"><input type="checkbox" id="${r}" /><div><label for="${r}" title="" class="plus"></label>`);e.push(`<label for="${r}" title="" class="title">${t.length} ${TC.Util.getLocaleString(o,"featureInfo.complexData.array")}</label><br/>`);e.push('<table class="complexAttr"><tbody>');for(var s=0;s<t.length;s++){e.push("<tr><td>");(e=e.concat(u(t[s]))).push("</td></tr>")}e.push("</tbody></table></div></div>")}else if(t instanceof Object)if(t.getType){const o={type:t.getType(),coordinates:t.getCoordinates()};e=e.concat(u(o))}else{e.push('<table class="complexAttr"><tbody>');for(var s in t){e.push("<tr>");if(t[s]&&t[s]instanceof Array){e.push(`<th style="display:none">${s}</th>\n                                           <td><label for="${r}" class="title">${s}</label><br/>`);(e=e.concat(u(t[s]))).push("</div></td>")}else if(t[s]&&t[s]instanceof Object){r="complexAttr_"+TC.getUID();e.push(`<th style="display:none">${s}</th>\n                                           <td><input type="checkbox" id="${r}" /><div><label for="${r}" title="" class="plus"></label>`);e.push(`<label for="${r}" title="" class="title">${s}</label><br/>`);(e=e.concat(u(t[s]))).push("</div></td>")}else{e.push(`<th class="key">${s}</th>\n                                           <td class="value">`);(e=e.concat(u(t[s]))).push("</td>")}e.push("</tr>")}e.push("</tbody></table>")}else e.push(l(t));return e};for(var a in r){const e=r[a],o=a.match(/^h(\d)_/i);if(o)t[o[1]]=e;else if("string"==typeof e||"number"==typeof e||void 0===e)n.push(`<tr><th>${a}</th><td>${l(e)}</td></tr>`);else{n.push(`<tr><th>${a}</th><td>`);(n=n.concat(u(e))).push("</td></tr>")}}const p=t.map(function(t,e){if(t)return`<h${e}>${t}</h${e}>`}).filter(function(t){return t});p.length&&(n=p.concat(n));if(n.length>0){n.unshift('<table class="tc-attr">');n.push("</table>");e=n.join("")}}}else"string"==typeof r&&(e=r);if(!e){e=this.title;this.group&&(e+=" "+this.group)}e||(e=TC.Util.getLocaleString(o,"noData"));return e};TC.Feature.prototype.getTemplate=function(){let t=this.wrap.getTemplate();return t||null};TC.Feature.prototype.clone=function(){var t=this.wrap.cloneFeature();t._wrap=this.wrap;return new this.constructor(t,this.options)};TC.Feature.prototype.getStyle=function(){return this.wrap.getStyle()};TC.Feature.prototype.showPopup=async function(t){const e=this,o=(t=t||{})&&t instanceof TC.Control?t:t.control,r=e.layer&&e.layer.map||o&&o.map;if(r){let l=o||e.popup;if(!l)for(var s=r.getControlsByClass("TC.control.Popup"),n=0,a=s.length;n<a;n++){var i=s[n];if(!i.caller){l=i;break}}l||(l=await r.addControl("popup"));l.currentFeature=e;r.getControlsByClass(TC.control.Popup).filter(t=>t!==l&&t.isVisible()).forEach(t=>t.hide());e.wrap.showPopup(Object.assign({},t,{control:l}));r.trigger(TC.Consts.event.POPUP,{control:l});l.fitToView(!0);l.contentDiv.querySelectorAll("img").forEach(t=>t.addEventListener("load",()=>l.fitToView()));return l}return null};TC.Feature.prototype.showResultsPanel=async function(t){const e=this,o=(t=t||{})&&t instanceof TC.Control?t:t.control,r=e.layer&&e.layer.map||o&&o.map;if(r){let o;var s={content:"table",titles:{main:TC.Util.getLocaleString(r.options.locale,"rsp.title"),max:TC.Util.getLocaleString(r.options.locale,"rsp.title")}},n=r.getControlsByClass("TC.control.ControlContainer")[0];if(n){s.position=n.POSITION.RIGHT;o=await n.addControl("resultsPanel",s)}else{s.div=document.createElement("div");r.div.appendChild(s.div);o=await r.addControl("resultsPanel",s)}o.currentFeature=e;0===r.getControlsByClass(TC.control.ControlContainer).length&&r.getControlsByClass(TC.control.ResultsPanel).filter(function(t){return"table"===t.options.content}).forEach(function(t){t.close()});r.getControlsByClass("TC.control.ResultsPanel").forEach(function(t){t.currentFeature&&!t.chart&&t.close()});o.menuDiv.innerHTML="";o.open(t.html||e.getInfo({locale:r.options.locale}),o.getInfoContainer());var a=function(t){r.off(TC.Consts.event.VIEWCHANGE,a);o.close()};r.on(TC.Consts.event.VIEWCHANGE,a);return o}return null};TC.Feature.prototype.showInfo=function(t){const e=this;t=t||{};TC.loadJS(!TC.control||!TC.control.FeatureInfoCommons,TC.apiLocation+"TC/control/FeatureInfoCommons",async function(){let o;o=e.getTemplate()?e.getInfo():"string"==typeof e.data?e.data:await TC.control.FeatureInfoCommons.renderFeatureAttributeTable({attributes:e.attributes,singleFeature:!0});const r=TC.Util.extend({},t,{html:o});let s;if(t.control&&TC.control){const o=t.control;o instanceof TC.control.Popup?s=await e.showPopup(r):o instanceof TC.control.ResultsPanel&&(s=await e.showResultsPanel(r))}else s=e.layer.map.on3DView||e.layer.map.defaultInfoContainer===TC.Consts.infoContainer.RESULTS_PANEL?await e.showResultsPanel(r):await e.showPopup(r);TC.control.FeatureInfoCommons.addSpecialAttributeEventListeners(s.getContainerElement())})};TC.Feature.prototype.select=function(){this._selected=!0;this.layer&&this.layer.selectedFeatures.push(this);var t=this.options.selection||{};this.setStyle(TC.Util.extend({},TC.Cfg.styles.selection[this.STYLETYPE],t[this.STYLETYPE]))};TC.Feature.prototype.unselect=function(){const t=this;t._selected=!1;t.setStyle(t.options);if(t.layer){const e=t.layer.selectedFeatures.indexOf(t);e>=0&&t.layer.selectedFeatures.splice(e,1)}};TC.Feature.prototype.isSelected=function(){return this._selected};TC.Feature.prototype.toGML=function(t,e){return this.wrap.toGML(t,e)};
//# sourceMappingURL=maps/Feature.min.js.map