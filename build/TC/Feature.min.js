TC.feature=TC.feature||{};TC.Feature=function(t,e){this.wrap=new TC.wrap.Feature;this.wrap.parent=this;if($.isArray(t))this.geometry=t;else if(this.wrap.isNative(t)){this.wrap.feature=t;this.id=this.wrap.getId();this.geometry=this.wrap.getGeometry();this.folders=t._folders;this.data=this.wrap.getData()}var i=this.options=$.extend(!0,{},e);this.id=this.id||i.id||TC.getUID();this.data=i.data||this.data||null;this._visibilityState=TC.Consts.visibility.VISIBLE;void 0===i.showsPopup?this.showsPopup=!0:this.showsPopup=i.showsPopup;this.layer=i.layer||null;this._selected=!1;i.selected&&this.select()};TC.Feature.prototype.STYLETYPE=TC.Consts.geom.POLYGON;TC.Feature.prototype.CLASSNAME="TC.Feature";TC.Feature.prototype.getPath=function(){var t=[];this.folders?t=this.folders:this.options.group&&(t=[this.options.group]);return t};TC.Feature.prototype.setVisibility=function(t){if(t&&this._visibilityState===TC.Consts.visibility.NOT_VISIBLE||!t&&this._visibilityState===TC.Consts.visibility.VISIBLE){this._visibilityState=t?TC.Consts.visibility.VISIBLE:TC.Consts.visibility.NOT_VISIBLE;this.layer.wrap.setFeatureVisibility(this,t)}};TC.Feature.prototype.setId=function(t){this.id=t;this.wrap.setId(t)};TC.Feature.prototype.getBounds=function(){return this.wrap.getBounds()};TC.Feature.prototype.setStyle=function(t){this.wrap.setStyle(t)};TC.Feature.prototype.getLegend=function(){this._legend||(this._legend=this.wrap.getLegend());return this._legend};TC.Feature.prototype.getCoords=function(){return this.wrap.getGeometry()};TC.Feature.prototype.setCoords=function(t){this.geometry=t;return this.wrap.setGeometry(t)};TC.Feature.prototype.getData=function(){return this.data?this.data:this.wrap.getData()};TC.Feature.prototype.setData=function(t){this.data=$.extend(this.data,t);this.wrap.setData(t)};TC.Feature.prototype.getInfo=function(){var t=null,e=this.layer&&this.layer.map&&TC.Util.getMapLocale(this.layer.map),i=this.getData();if("object"==typeof i){var s=this.wrap.getTemplate();if(s)t=s.replace(/\$\[?(?:\w+\/)*(\w+)\]/g,function(t,e){return i[e]});else{var r=[],o=TC.Util.getLocaleString(e,"open");for(var a in i){var n=i[a];if("string"==typeof n||"number"==typeof n||void 0===n){r[r.length]="<tr><th>";r[r.length]=a;r[r.length]="</th><td>";if(TC.Util.isURL(n)){r[r.length]='<a href="';r[r.length]=n;r[r.length]='" target="_blank">';r[r.length]=o;r[r.length]="</a>"}else r[r.length]=void 0!==n?TC.Util.formatNumber(n,e):"&mdash;";r[r.length]="</td></tr>"}}if(r.length>0){r.unshift('<table class="tc-attr">');r[r.length]="</table>";t=r.join("")}}}else"string"==typeof i&&(t=i);if(!t){t=this.title;this.group&&(t+=" "+this.group)}t||(t=TC.Util.getLocaleString(e,"noData"));return t};TC.Feature.prototype.clone=function(){var t=this.wrap.cloneFeature();t._wrap=this.wrap;return new this.constructor(t,this.options)};TC.Feature.prototype.getStyle=function(){return this.wrap.getStyle()};TC.Feature.prototype.showPopup=function(t){var e=this;if(e.layer&&e.layer.map){var i,s=t||e.popup;if(!s)for(var r=e.layer.map.getControlsByClass("TC.control.Popup"),o=0,a=r.length;o<a;o++){var n=r[o];if(!n.caller){s=n;break}}s?(i=$.Deferred()).resolve(s):i=e.layer.map.addControl("popup");i.then(function(t){t.currentFeature=e;e.layer.map.getControlsByClass(TC.control.Popup).forEach(function(t){t.isVisible()&&t.hide()});e.wrap.showPopup(t);e.layer.map.$events.trigger($.Event(TC.Consts.event.POPUP,{control:t}));t.fitToView(!0)})}};TC.Feature.prototype.select=function(){this._selected=!0;this.layer&&this.layer.selectedFeatures.push(this);var t=this.options.selection||{};this.setStyle($.extend({},TC.Cfg.styles.selection[this.STYLETYPE],t[this.STYLETYPE]))};TC.Feature.prototype.unselect=function(){this._selected=!1;this.setStyle(this.options);if(this.layer){var t=$.inArray(this,this.layer.selectedFeatures);t>=0&&this.layer.selectedFeatures.splice(t,1)}};TC.Feature.prototype.isSelected=function(){return this._selected};TC.Feature.prototype.toGML=function(t,e){return this.wrap.toGML(t,e)};