TC.tool=TC.tool||{};TC.tool.ExcelExport=function(){this.stringifyField=function(t,e,r){if("string"==typeof t){t=t.replace(/"/g,'""');(r||t.indexOf(",")>-1||t.indexOf("\n")>-1||t.indexOf("\r")>-1)&&(t=e+t+e);return t}return"boolean"==typeof t?t?"TRUE":"FALSE":t};this.stringify=function(t,e){var r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",o=String.fromCharCode,a=function(){try{document.createElement("$")}catch(t){return t}}();window.btoa||(window.btoa=function(t){for(var e,o,n,s,i,l,c=0,d=t.length,p=Math.max,f="";c<d;){if(p(e=t.charCodeAt(c++)||0,o=t.charCodeAt(c++)||0,l=t.charCodeAt(c++)||0)>255)throw a;n=(3&e)<<4|o>>4&15;s=(15&o)<<2|l>>6&3;i=63&l;o?l||(i=64):s=i=64;f+=r.charAt(e>>2&63)+r.charAt(n)+r.charAt(s)+r.charAt(i)}return f});window.atob||(window.atob=function(t){var e,n,s,i,l,c=0,d=(t=t.replace(/=+$/,"")).length,p=[];if(d%4==1)throw a;for(;c<d;){e=(63&r.indexOf(t.charAt(c++)))<<2|(s=r.indexOf(t.charAt(c++)))>>4&3;n=(15&s)<<4|(i=r.indexOf(t.charAt(c++)))>>2&15;l=(3&i)<<6|63&r.indexOf(t.charAt(c++));p.push(o(e));n&&p.push(o(n));l&&p.push(o(l))}return p.join("")});var n=[];Array.isArray(t)?n=t:TC.Util.isFunction(t)&&(n=t());const s=function(t,e){var r=e||"";if(t instanceof Array){r+="<table><tbody>";for(var o=0;o<t.length;o++)r+="<tr><td>"+s(t[o],e)+"</td></tr>";r+="</tbody></table>"}else if(t instanceof Object){r+="<table><tbody>";for(var a in t){const o=t[a];r+="<tr><th>"+a+"</th>";if(o instanceof Object)r+="<td>"+s(o,e)+"</td></tr>";else{var n=i(o);t[a]=n.value;r+='<td class="'+n.class+'">';switch(!0){case"string"==typeof o&&o.startsWith("http"):r+='<a href="'+unescape(encodeURIComponent(o))+'">Abrir</a>';break;default:r+=o}r+="</td></tr>"}}r+="</tbody></table>"}else r+=t;return r},i=function(t){var e;if(null===t||"string"!=typeof t&&"number"!=typeof t)e=e instanceof Object?"":"string";else{t.value&&(t=t.value);if(-1!==(""+t).indexOf("%")){t=t.replace(" %","%").replace(/\.|,/g,f);e="percent"}else{var r=0;t&&(r="number"==typeof t?t:new Number(t.replace?t.replace(/\,/g,"").replace(/./g,".").trim():t.trim()));if(isNaN(r))e=/^\d{1,2}([.\/-])\d{1,2}\1(\d{4}|\d{2})$/.test(t)||/^[0-9]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][0-9]|3[0-1])[ ,T]{1}(2[0-3]|[01][0-9]):[0-5][0-9]:[0-5][0-9][Z]{0,1}$/.test(t)?"date":"string";else{t=r.toString().replace(".",f);e=r%1>0?"number2d":"number"}}}return{class:e,value:t}};for(var l='<thead valign="top">',c=0;c<1;c++){l+="<tr>";for(var d in n[c])Object.prototype.hasOwnProperty.call(n[c],d)&&(l+="<th>"+n[c][d]+"</th>");l+="</tr>"}l+="</thead>";l+="<tbody>";let p=navigator.language.substring(0,5);var f;try{f=1.1.toLocaleString(p).substring(1,2);1e3.toLocaleString(p).substring(1,2)}catch(t){f=1.1.toLocaleString("es-ES").substring(1,2);1e3.toLocaleString("es-ES").substring(1,2)}for(c=1;c<n.length;c++){l+="<tr>";for(d=0;d<n[c].length;d++)if(Object.prototype.hasOwnProperty.call(n[c],d)){var h=n[c][d];const t=i(h);if((h=t.value)instanceof Object)l+="<td>"+s(h)+"</td>";else{l+='<td class="'+t.class+'"';if(h&&(Object.prototype.hasOwnProperty.call(h,"rowspan")||Object.prototype.hasOwnProperty.call(h,"colspan"))){Object.prototype.hasOwnProperty.call(h,"rowspan")&&(l+=' valign="top" rowspan="'+h.rowspan+'">'+h.value+"</td>");Object.prototype.hasOwnProperty.call(h,"colspan")&&(l+=' colspan="'+h.colspan+'">'+h.value+"</td>");d++}else l+=">"+(null==h?"":h)+"</td>"}}l+="</tr>"}l+="</tbody>";var m='<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name=ProgId content=Excel.Sheet><meta name=Generator content="Microsoft Excel 9">\x3c!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>{worksheet}</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--\x3e<style>';m+=","===f?'\x3c!--table{mso-displayed-decimal-separator:","; mso-displayed-thousand-separator:".";}':'\x3c!--table{mso-displayed-decimal-separator:"."; mso-displayed-thousand-separator:",";}';m+="body {visibility:hidden;}";m+='.number{mso-number-format:"#,##0";} .number2d{mso-number-format:"#,##0.00";} .percent{mso-number-format:0.00%;} ';m+='.date{mso-number-format:"dd/mm/yyyy";} .string{mso-number-format:"@";} caption{text-align:left;}--\x3e</style></head><body><table><caption>{caption}</caption>{table}</table></body></html>';var b,u={worksheet:e.workSheet||"Hoja1",table:l,caption:e.title||""};return b=u,m.replace(/{(\w+)}/g,function(t,e){return b[e]})}};TC.tool.ExcelExport.prototype.Save=function(t,e,r){const o=this.stringify(e,{txtDelim:'"',fieldSep:";",title:r||""});var a=new Blob([o],{type:"text/csv;charset=utf-8;"});if(navigator.msSaveBlob)navigator.msSaveBlob(a,t);else{var n=document.createElement("a");if(void 0!==n.download){var s=URL.createObjectURL(a);n.setAttribute("href",s);n.setAttribute("download",t);n.style.visibility="hidden";document.body.appendChild(n);n.click();document.body.removeChild(n)}}};