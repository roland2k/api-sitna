function tXml(e,t){"use strict";t=t||{};var r=0,a="<",n="<".charCodeAt(0),i=">",o=">".charCodeAt(0),l="-".charCodeAt(0),u="/".charCodeAt(0),s="!".charCodeAt(0),f="'".charCodeAt(0),c='"'.charCodeAt(0),p="[".charCodeAt(0),y="]".charCodeAt(0);function h(){for(var t=[];e[r];){if(e.charCodeAt(r)==n){if(e.charCodeAt(r+1)===u){r=e.indexOf(i,r);return t}if(e.charCodeAt(r+1)===s){var a=e.charCodeAt(r+2);if(a!=p){if(a==l){for(;-1!==r&&(e.charCodeAt(r)!==o||e.charCodeAt(r-1)!=l||e.charCodeAt(r-2)!=l||-1==r);)r=e.indexOf(i,r+1);-1===r&&(r=e.length)}else{r+=2;for(;e.charCodeAt(r)!==o;)r++}r++;continue}}var f=C();t.push(f)}else{var c=d();c.trim().length>0&&t.push(c)}r++}return t}function d(){var t=r;-2===(r=e.indexOf(a,r)-1)&&(r=e.length);return e.slice(t,r+1)}var g="\n\t>/= ";function m(){for(var t=r,a=e[r];-1===g.indexOf(a);)":"===(a=e[++r])&&(t=++r);return e.slice(t,r)}var v=["img","br","input","meta","link"];function C(){var t={};r++;if(e.charCodeAt(r)===s&&e.charCodeAt(r+1)===p){for(var a=r+8;e.charCodeAt(r)!==o||e.charCodeAt(r-1)!==y||e.charCodeAt(r-2)!==y;)r++;return e.slice(a,r-2)}t.tagName=m();var n=!1;let i;for(;e.charCodeAt(r)!==o;){var l=e.charCodeAt(r);if(l>64&&l<91||l>96&&l<123){i=m();for(var d=e.charCodeAt(r);d!==f&&d!==c&&!(d>64&&d<91||d>96&&d<123)&&d!==o;){r++;d=e.charCodeAt(r)}if(!n){t.attributes={};n=!0}let a;if(d===f||d===c)a=x();else{a=null;r--}t.attributes[i]=a}r++}if(e.charCodeAt(r-1)!==u)if("script"==t.tagName){const a=r+1;r=e.indexOf("<\/script>",r);t.children=[e.slice(a,r-1)];r+=8}else if("style"==t.tagName){const a=r+1;r=e.indexOf("</style>",r);t.children=[e.slice(a,r-1)];r+=7}else if(-1==v.indexOf(t.tagName)){r++;t.children=h()}return t}function x(){var t=e[r],a=++r;r=e.indexOf(t,a);return e.slice(a,r)}var F,T=null;if(void 0!==t.attrValue){t.attrName=t.attrName||"id";T=[];for(;-1!==(r=(F=void 0,(F=new RegExp("\\s"+t.attrName+"\\s*=['\"]"+t.attrValue+"['\"]").exec(e))?F.index:-1));){-1!==(r=e.lastIndexOf("<",r))&&T.push(C());e=e.substr(r);r=0}}else T=h();t.filter&&(T=tXml.filter(T,t.filter));t.simplify&&(T=tXml.simplify(T));return T}tXml.simplify=function(e){var t={};if(!e||!e.length)return"";if(1===e.length&&"string"==typeof e[0])return e[0];e.forEach(function(e){if("object"==typeof e){t[e.tagName]||(t[e.tagName]=[]);var r=tXml.simplify(e.children);t[e.tagName].push(r);e.attributes&&(r._attributes=e.attributes)}});for(var r in t)1==t[r].length&&(t[r]=t[r][0]);return t};tXml.filter=function(e,t){var r=[];e.forEach(function(e){"object"==typeof e&&t(e)&&r.push(e);if(e.children){var a=tXml.filter(e.children,t);r=r.concat(a)}});return r};tXml.stringify=function(e){var t="";function r(e){if(e)for(var r=0;r<e.length;r++)"string"==typeof e[r]?t+=e[r].trim():a(e[r])}function a(e){t+="<"+e.tagName;for(var a in e.attributes)null===e.attributes[a]?t+=" "+a:-1===e.attributes[a].indexOf('"')?t+=" "+a+'="'+e.attributes[a].trim()+'"':t+=" "+a+"='"+e.attributes[a].trim()+"'";t+=">";r(e.children);t+="</"+e.tagName+">"}r(e);return t};tXml.toContentString=function(e){if(Array.isArray(e)){var t="";e.forEach(function(e){t=(t+=" "+tXml.toContentString(e)).trim()});return t}return"object"==typeof e?tXml.toContentString(e.children):" "+e};tXml.getElementById=function(e,t,r){var a=tXml(e,{attrValue:t,simplify:r});return r?a:a[0]};tXml.getElementsByClassName=function(e,t,r){return tXml(e,{attrName:"class",attrValue:"[a-zA-Z0-9-s ]*"+t+"[a-zA-Z0-9-s ]*",simplify:r})};"object"==typeof module&&(module.exports=tXml);!function(){var e,t,r,a,n,i,o,l,u,s,f,c=function(e){return e.href},p=function(e,t){if(Object.prototype.hasOwnProperty.call(e,t)){for(var r=e[t],a=r.length?r:[r],n=0,i=a.length;n<i;n++){var o=a[n];o.OnlineResource=c(o.OnlineResource)}e[t]=a}},y=[!1,!0],h=function(e){return e.split(" ").map(function(e){return parseFloat(e)})},d=function(e){for(var t=e.length?e:[e],r=new Array(t.length),a=0,n=t.length;a<n;a++){var i=t[a];if(!i.Constraint.length){i.Constraint=[i.Constraint];for(var o=0,l=i.Constraint.length;o<l;o++){var u=i.Constraint[o].AllowedValues;"string"==typeof u.Value&&(u.Value=[u.Value])}}r[a]={Constraint:i.Constraint,href:i.href}}return r},g=(e=["name","Name"],t=["Parameter","Constraint"],r=function(t){return t.reduce(function(t,r,a){if(e.some(e=>Object.prototype.hasOwnProperty.call(r,e))){var n=e.find(e=>Object.prototype.hasOwnProperty.call(r,e)),i=r[n].substring(r[n].indexOf(":")+1);delete r[n];t[i]=Object.prototype.hasOwnProperty.call(r,"AllowedValues")&&r.AllowedValues.Value||r;return t}return(0===a?[]:t).concat(r)},{})},a=function(t){var a={};return a=t instanceof Array?r(t):Object.prototype.hasOwnProperty.call(t,"AllowedValues")&&t.AllowedValues.Value&&e.find(e=>Object.prototype.hasOwnProperty.call(t,e))&&(a[t[e.find(e=>Object.prototype.hasOwnProperty.call(t,e))]]=t.AllowedValues.Value)&&a||t},n="1.0.0",i="1.1.0",o="2.0.0",l=function(e,l){switch(l){case n:var u=e.Capability.Request;if(u.GetFeature){var s=[];for(var f in u.GetFeature.ResultFormat)s.push(f.toLowerCase());u.GetFeature.outputFormat=s,delete u.GetFeature.ResultFormat,u.GetFeature.Operations=e.FeatureTypeList.Operations}return u;case i:return{};case o:var c={};for(var f in e.OperationsMetadata){var p={};if(e.OperationsMetadata[f]instanceof Array){p[f]=r(e.OperationsMetadata[f]);for(var y in p[f])p[f][y]=(e=>{var n={};if(e instanceof Array)return r(e);for(var i in e)t.find(e=>i===e)?n=Object.assign(n,a(e[t.find(e=>i===e)])):n[i]=e[i];return n})(p[f][y]);c=Object.assign(c,p[f])}}return c}return null},u=function(e,t){switch(t){case n:e.FeatureTypeList.FeatureType=e.FeatureTypeList.FeatureType instanceof Array?e.FeatureTypeList.FeatureType:[e.FeatureTypeList.FeatureType];for(var r={},a=0;a<e.FeatureTypeList.FeatureType.length;a++){r[(l=e.FeatureTypeList.FeatureType[a].Name).substring(l.indexOf(":")+1)]=e.FeatureTypeList.FeatureType[a]}return r;case i:return{};case o:e.FeatureTypeList.FeatureType=e.FeatureTypeList.FeatureType instanceof Array?e.FeatureTypeList.FeatureType:[e.FeatureTypeList.FeatureType];for(r={},a=0;a<e.FeatureTypeList.FeatureType.length;a++){var l;r[(l=e.FeatureTypeList.FeatureType[a].Name).substring(l.indexOf(":")+1)]=e.FeatureTypeList.FeatureType[a]}return r}return null},s=function(e,t){switch(t){case n:return e.Filter_Capabilities;case i:return{};case o:return e.Filter_Capabilities}return null},f=function(e,t){switch(t){case n:var r={};for(var a in e)"string"==typeof e[a]&&(r[a]=e[a]);return r;case i:return{};case o:r={};for(var a in e)"string"==typeof e[a]&&(r[a]=e[a]);return r}return{}},{Parse:function(){var e,t,r,a,c=arguments[0];switch(c.version){case n:e=n;break;case i:e=i;break;case o:e=o}t=l(c,e),r=u(c,e),a=s(c,e);var p=f(c,e),y={Operations:t,FeatureTypes:r,Filters:a};return Object.assign(y,p),y}}),m=function(e){var t=e.WMS_Capabilities||e["?xml"]&&(e["?xml"].WMS_Capabilities||e["?xml"].WMT_MS_Capabilities);if(t){!function e(t,r){Object.prototype.hasOwnProperty.call(t,"queryable")&&(t.queryable=y[t.queryable]);var a;if(Object.prototype.hasOwnProperty.call(t,"EX_GeographicBoundingBox")){a=t.EX_GeographicBoundingBox;t.EX_GeographicBoundingBox=[parseFloat(a.westBoundLongitude),parseFloat(a.southBoundLatitude),parseFloat(a.eastBoundLongitude),parseFloat(a.northBoundLatitude)]}if(Object.prototype.hasOwnProperty.call(t,"BoundingBox")){a=t.BoundingBox;a=t.BoundingBox.length?t.BoundingBox:[t.BoundingBox];t.BoundingBox=a.map(function(e){return{crs:e.CRS||e.SRS,extent:[parseFloat(e.minx),parseFloat(e.miny),parseFloat(e.maxx),parseFloat(e.maxy)],res:new Array(2)}})}Object.prototype.hasOwnProperty.call(t,"Attribution")&&t.Attribution.OnlineResource&&(t.Attribution.OnlineResource=c(t.Attribution.OnlineResource));p(t,"AuthorityURL");p(t,"MetadataURL");if(t.Style){t.Style.length||(t.Style=[t.Style]);for(var n=0,i=t.Style.length;n<i;n++)p(t.Style[n],"LegendURL")}var o="string"==typeof t.CRS?[t.CRS]:t.CRS;r&&t.CRS&&(t.CRS=o.concat(r));if(t.Layer){var l=t.Layer[1]?t.Layer:[t.Layer];t.Layer=l;for(n=0,i=l.length;n<i;n++){l[n].parent=t;e(l[n],o)}}}(t.Capability.Layer);var r=t.Capability.Request;!function(e){if(e){for(var t=e.DCPType.length?e.DCPType:[e.DCPType],r=0,a=t.length;r<a;r++){var n=t[r];for(var i in n){var o=n[i];for(var l in o){var u=o[l];u.OnlineResource=c(u.OnlineResource)}}}e.DCPType=t}}(r.GetMap);r.GetFeatureInfo&&(r.GetFeatureInfo.Format="string"==typeof r.GetFeatureInfo.Format?[r.GetFeatureInfo.Format]:r.GetFeatureInfo.Format)}return t},v=function(e){var t=e["?xml"]&&e["?xml"].Capabilities;if(t){!function(e){e.Layer.length||(e.Layer=[e.Layer]);for(var t=e.Layer,r=0,a=t.length;r<a;r++){var n=t[r];"string"==typeof n.Format&&(n.Format=[n.Format]);n.ResourceURL&&!n.ResourceURL.length&&(n.ResourceURL=[n.ResourceURL]);n.Style&&!Array.isArray(n.Style)&&(n.Style=[n.Style]);n.TileMatrixSetLink.length||(n.TileMatrixSetLink=[n.TileMatrixSetLink]);for(var i=0,o=n.TileMatrixSetLink.length;i<o;i++){var l=n.TileMatrixSetLink[i];if(l.TileMatrixSetLimits){l.TileMatrixSetLimits=l.TileMatrixSetLimits.TileMatrixLimits;for(var u=0,s=l.TileMatrixSetLimits.length;u<s;u++){var f=l.TileMatrixSetLimits[u];f.MaxTileCol=parseInt(f.MaxTileCol);f.MaxTileRow=parseInt(f.MaxTileRow);f.MinTileCol=parseInt(f.MinTileCol);f.MinTileRow=parseInt(f.MinTileRow)}}}if(n.WGS84BoundingBox){var c=h(n.WGS84BoundingBox.LowerCorner),p=h(n.WGS84BoundingBox.UpperCorner);n.WGS84BoundingBox=[c[0],c[1],p[0],p[1]]}}}(t.Contents);!function(e){e.TileMatrixSet.length||(e.TileMatrixSet=[e.TileMatrixSet]);e.TileMatrixSet.forEach(function(e){e.SupportedCRS=e.SupportedCRS.trim();if(e.BoundingBox){var t=h(e.BoundingBox.LowerCorner),r=h(e.BoundingBox.UpperCorner);e.BoundingBox=[t[0],t[1],r[0],r[1]]}e.TileMatrix.forEach(function(e){e.MatrixHeight=parseInt(e.MatrixHeight);e.MatrixWidth=parseInt(e.MatrixWidth);e.TileHeight=parseInt(e.TileHeight);e.TileWidth=parseInt(e.TileWidth);e.ScaleDenominator=parseFloat(e.ScaleDenominator);e.TopLeftCorner=h(e.TopLeftCorner)})})}(t.Contents);!function(e){for(var t=e.Operation.length?e.Operation:[e.Operation],r=0,a=t.length;r<a;r++){var n=t[r];for(var i in n.DCP){var o=n.DCP[i];for(var l in o)o[l]=d(o[l])}e[n.name]={DCP:n.DCP}}delete e.Operation}(t.OperationsMetadata)}return t};onmessage=function(e){var t,r=function e(t,r){var a={};if(!(t&&t.length||r))return"";if(1===(t=t||[]).length&&"string"==typeof t[0])return t[0];t.forEach(function(t){if("object"==typeof t){var r=t.tagName.indexOf("ows:"),n=r<0?t.tagName:t.tagName.substr(r+4);a[n]||(a[n]=[]);var i=e(t.children,t.attributes);a[n].push(i);if(t.attributes)for(var o in t.attributes)i[o]=t.attributes[o]}});for(var n in a)1==a[n].length&&(a[n]=a[n][0]);return a}(tXml(e.data.text));switch(e.data.type){case"WMS":t=m(r);break;case"WMTS":t=v(r);break;case"WFS":t=function(e){var t=e.WFS_Capabilities||e["?xml"]&&e["?xml"].WFS_Capabilities;if(t){t=g.Parse(t);for(var r in t)if("string"==typeof t[r]&&0===t[r].indexOf("http")){t["xmlns:"+r]=t[r];delete t[r]}delete t.updateSequence}return t}(r)}postMessage({state:t?"success":"error",capabilities:t})}}();